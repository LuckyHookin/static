var oM=Object.defineProperty,sM=Object.defineProperties;var aM=Object.getOwnPropertyDescriptors;var Up=Object.getOwnPropertySymbols;var tR=Object.prototype.hasOwnProperty,eR=Object.prototype.propertyIsEnumerable;var rR=(o,e,i)=>e in o?oM(o,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):o[e]=i,Dt=(o,e)=>{for(var i in e||(e={}))tR.call(e,i)&&rR(o,i,e[i]);if(Up)for(var i of Up(e))eR.call(e,i)&&rR(o,i,e[i]);return o},Qi=(o,e)=>sM(o,aM(e));var nR=(o,e)=>{var i={};for(var a in o)tR.call(o,a)&&e.indexOf(a)<0&&(i[a]=o[a]);if(o!=null&&Up)for(var a of Up(o))e.indexOf(a)<0&&eR.call(o,a)&&(i[a]=o[a]);return i};import{k as fu,t as Tc,a3 as _m,a6 as vm,a7 as Rc,s as Au,a8 as cM,a9 as lM,w as dM,aa as iR,a as gs,ab as uM,ac as hM,r as gu,o as Nn,c as Vi,i as Gi,A as Ql,F as va,x as Im,g as Vl,ad as pM,f as Rr,y as oR,z as mu,b as Cm,h as Gl,ae as fM,af as AM,ag as gM,p as sR,e as aR,a4 as mM,a5 as cR,ah as EM,K as _M,ai as vM,aj as IM,a2 as Sm,ak as CM,al as SM}from"./vendor.4887ee79.js";import{c as yM,i as TM,d as RM,s as wM,e as lR,t as dR,S as uR,f as bM,Y as Ia,m as NM,g as Ka,k as OM,h as kM,j as DM,l as Eu,o as LM,I as hR,C as MM,n as PM,p as BM,b as ym,R as Tm,q as Rm,u as UM,r as xM,a as FM,v as QM,w as VM,x as GM,y as _u,z as pR,A as fR,U as jM,B as WM,E as KM,D as HM,W as YM}from"./y-websocket.fbce0748.js";import{_ as vu,S as wc,a as wm,h as qM,u as JM}from"./index.2a75d556.js";const zM=o=>class{constructor(i){this._=i}destroy(){o(this._)}},XM=zM(clearTimeout),ZM=(o,e)=>new XM(setTimeout(e,o));function wi(o){this.content=o}wi.prototype={constructor:wi,find:function(o){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===o)return e;return-1},get:function(o){var e=this.find(o);return e==-1?void 0:this.content[e+1]},update:function(o,e,i){var a=i&&i!=o?this.remove(i):this,l=a.find(o),u=a.content.slice();return l==-1?u.push(i||o,e):(u[l+1]=e,i&&(u[l]=i)),new wi(u)},remove:function(o){var e=this.find(o);if(e==-1)return this;var i=this.content.slice();return i.splice(e,2),new wi(i)},addToStart:function(o,e){return new wi([o,e].concat(this.remove(o).content))},addToEnd:function(o,e){var i=this.remove(o).content.slice();return i.push(o,e),new wi(i)},addBefore:function(o,e,i){var a=this.remove(e),l=a.content.slice(),u=a.find(o);return l.splice(u==-1?l.length:u,0,e,i),new wi(l)},forEach:function(o){for(var e=0;e<this.content.length;e+=2)o(this.content[e],this.content[e+1])},prepend:function(o){return o=wi.from(o),o.size?new wi(o.content.concat(this.subtract(o).content)):this},append:function(o){return o=wi.from(o),o.size?new wi(this.subtract(o).content.concat(o.content)):this},subtract:function(o){var e=this;o=wi.from(o);for(var i=0;i<o.content.length;i+=2)e=e.remove(o.content[i]);return e},get size(){return this.content.length>>1}};wi.from=function(o){if(o instanceof wi)return o;var e=[];if(o)for(var i in o)e.push(i,o[i]);return new wi(e)};var AR=wi;function gR(o,e,i){for(var a=0;;a++){if(a==o.childCount||a==e.childCount)return o.childCount==e.childCount?null:i;var l=o.child(a),u=e.child(a);if(l==u){i+=l.nodeSize;continue}if(!l.sameMarkup(u))return i;if(l.isText&&l.text!=u.text){for(var f=0;l.text[f]==u.text[f];f++)i++;return i}if(l.content.size||u.content.size){var g=gR(l.content,u.content,i+1);if(g!=null)return g}i+=l.nodeSize}}function mR(o,e,i,a){for(var l=o.childCount,u=e.childCount;;){if(l==0||u==0)return l==u?null:{a:i,b:a};var f=o.child(--l),g=e.child(--u),_=f.nodeSize;if(f==g){i-=_,a-=_;continue}if(!f.sameMarkup(g))return{a:i,b:a};if(f.isText&&f.text!=g.text){for(var I=0,T=Math.min(f.text.length,g.text.length);I<T&&f.text[f.text.length-I-1]==g.text[g.text.length-I-1];)I++,i--,a--;return{a:i,b:a}}if(f.content.size||g.content.size){var N=mR(f.content,g.content,i-1,a-1);if(N)return N}i-=_,a-=_}}var Nt=function(e,i){if(this.content=e,this.size=i||0,i==null)for(var a=0;a<e.length;a++)this.size+=e[a].nodeSize},xp={firstChild:{configurable:!0},lastChild:{configurable:!0},childCount:{configurable:!0}};Nt.prototype.nodesBetween=function(e,i,a,l,u){l===void 0&&(l=0);for(var f=0,g=0;g<i;f++){var _=this.content[f],I=g+_.nodeSize;if(I>e&&a(_,l+g,u,f)!==!1&&_.content.size){var T=g+1;_.nodesBetween(Math.max(0,e-T),Math.min(_.content.size,i-T),a,l+T)}g=I}};Nt.prototype.descendants=function(e){this.nodesBetween(0,this.size,e)};Nt.prototype.textBetween=function(e,i,a,l){var u="",f=!0;return this.nodesBetween(e,i,function(g,_){g.isText?(u+=g.text.slice(Math.max(e,_)-_,i-_),f=!a):g.isLeaf&&l?(u+=typeof l=="function"?l(g):l,f=!a):!f&&g.isBlock&&(u+=a,f=!0)},0),u};Nt.prototype.append=function(e){if(!e.size)return this;if(!this.size)return e;var i=this.lastChild,a=e.firstChild,l=this.content.slice(),u=0;for(i.isText&&i.sameMarkup(a)&&(l[l.length-1]=i.withText(i.text+a.text),u=1);u<e.content.length;u++)l.push(e.content[u]);return new Nt(l,this.size+e.size)};Nt.prototype.cut=function(e,i){if(i==null&&(i=this.size),e==0&&i==this.size)return this;var a=[],l=0;if(i>e)for(var u=0,f=0;f<i;u++){var g=this.content[u],_=f+g.nodeSize;_>e&&((f<e||_>i)&&(g.isText?g=g.cut(Math.max(0,e-f),Math.min(g.text.length,i-f)):g=g.cut(Math.max(0,e-f-1),Math.min(g.content.size,i-f-1))),a.push(g),l+=g.nodeSize),f=_}return new Nt(a,l)};Nt.prototype.cutByIndex=function(e,i){return e==i?Nt.empty:e==0&&i==this.content.length?this:new Nt(this.content.slice(e,i))};Nt.prototype.replaceChild=function(e,i){var a=this.content[e];if(a==i)return this;var l=this.content.slice(),u=this.size+i.nodeSize-a.nodeSize;return l[e]=i,new Nt(l,u)};Nt.prototype.addToStart=function(e){return new Nt([e].concat(this.content),this.size+e.nodeSize)};Nt.prototype.addToEnd=function(e){return new Nt(this.content.concat(e),this.size+e.nodeSize)};Nt.prototype.eq=function(e){if(this.content.length!=e.content.length)return!1;for(var i=0;i<this.content.length;i++)if(!this.content[i].eq(e.content[i]))return!1;return!0};xp.firstChild.get=function(){return this.content.length?this.content[0]:null};xp.lastChild.get=function(){return this.content.length?this.content[this.content.length-1]:null};xp.childCount.get=function(){return this.content.length};Nt.prototype.child=function(e){var i=this.content[e];if(!i)throw new RangeError("Index "+e+" out of range for "+this);return i};Nt.prototype.maybeChild=function(e){return this.content[e]};Nt.prototype.forEach=function(e){for(var i=0,a=0;i<this.content.length;i++){var l=this.content[i];e(l,a,i),a+=l.nodeSize}};Nt.prototype.findDiffStart=function(e,i){return i===void 0&&(i=0),gR(this,e,i)};Nt.prototype.findDiffEnd=function(e,i,a){return i===void 0&&(i=this.size),a===void 0&&(a=e.size),mR(this,e,i,a)};Nt.prototype.findIndex=function(e,i){if(i===void 0&&(i=-1),e==0)return Fp(0,e);if(e==this.size)return Fp(this.content.length,e);if(e>this.size||e<0)throw new RangeError("Position "+e+" outside of fragment ("+this+")");for(var a=0,l=0;;a++){var u=this.child(a),f=l+u.nodeSize;if(f>=e)return f==e||i>0?Fp(a+1,f):Fp(a,l);l=f}};Nt.prototype.toString=function(){return"<"+this.toStringInner()+">"};Nt.prototype.toStringInner=function(){return this.content.join(", ")};Nt.prototype.toJSON=function(){return this.content.length?this.content.map(function(e){return e.toJSON()}):null};Nt.fromJSON=function(e,i){if(!i)return Nt.empty;if(!Array.isArray(i))throw new RangeError("Invalid input for Fragment.fromJSON");return new Nt(i.map(e.nodeFromJSON))};Nt.fromArray=function(e){if(!e.length)return Nt.empty;for(var i,a=0,l=0;l<e.length;l++){var u=e[l];a+=u.nodeSize,l&&u.isText&&e[l-1].sameMarkup(u)?(i||(i=e.slice(0,l)),i[i.length-1]=u.withText(i[i.length-1].text+u.text)):i&&i.push(u)}return new Nt(i||e,a)};Nt.from=function(e){if(!e)return Nt.empty;if(e instanceof Nt)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new Nt([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))};Object.defineProperties(Nt.prototype,xp);var bm={index:0,offset:0};function Fp(o,e){return bm.index=o,bm.offset=e,bm}Nt.empty=new Nt([],0);function Qp(o,e){if(o===e)return!0;if(!(o&&typeof o=="object")||!(e&&typeof e=="object"))return!1;var i=Array.isArray(o);if(Array.isArray(e)!=i)return!1;if(i){if(o.length!=e.length)return!1;for(var a=0;a<o.length;a++)if(!Qp(o[a],e[a]))return!1}else{for(var l in o)if(!(l in e)||!Qp(o[l],e[l]))return!1;for(var u in e)if(!(u in o))return!1}return!0}var or=function(e,i){this.type=e,this.attrs=i};or.prototype.addToSet=function(e){for(var i,a=!1,l=0;l<e.length;l++){var u=e[l];if(this.eq(u))return e;if(this.type.excludes(u.type))i||(i=e.slice(0,l));else{if(u.type.excludes(this.type))return e;!a&&u.type.rank>this.type.rank&&(i||(i=e.slice(0,l)),i.push(this),a=!0),i&&i.push(u)}}return i||(i=e.slice()),a||i.push(this),i};or.prototype.removeFromSet=function(e){for(var i=0;i<e.length;i++)if(this.eq(e[i]))return e.slice(0,i).concat(e.slice(i+1));return e};or.prototype.isInSet=function(e){for(var i=0;i<e.length;i++)if(this.eq(e[i]))return!0;return!1};or.prototype.eq=function(e){return this==e||this.type==e.type&&Qp(this.attrs,e.attrs)};or.prototype.toJSON=function(){var e={type:this.type.name};for(var i in this.attrs){e.attrs=this.attrs;break}return e};or.fromJSON=function(e,i){if(!i)throw new RangeError("Invalid input for Mark.fromJSON");var a=e.marks[i.type];if(!a)throw new RangeError("There is no mark type "+i.type+" in this schema");return a.create(i.attrs)};or.sameSet=function(e,i){if(e==i)return!0;if(e.length!=i.length)return!1;for(var a=0;a<e.length;a++)if(!e[a].eq(i[a]))return!1;return!0};or.setFrom=function(e){if(!e||e.length==0)return or.none;if(e instanceof or)return[e];var i=e.slice();return i.sort(function(a,l){return a.type.rank-l.type.rank}),i};or.none=[];function xs(o){var e=Error.call(this,o);return e.__proto__=xs.prototype,e}xs.prototype=Object.create(Error.prototype);xs.prototype.constructor=xs;xs.prototype.name="ReplaceError";var Ht=function(e,i,a){this.content=e,this.openStart=i,this.openEnd=a},ER={size:{configurable:!0}};ER.size.get=function(){return this.content.size-this.openStart-this.openEnd};Ht.prototype.insertAt=function(e,i){var a=vR(this.content,e+this.openStart,i,null);return a&&new Ht(a,this.openStart,this.openEnd)};Ht.prototype.removeBetween=function(e,i){return new Ht(_R(this.content,e+this.openStart,i+this.openStart),this.openStart,this.openEnd)};Ht.prototype.eq=function(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd};Ht.prototype.toString=function(){return this.content+"("+this.openStart+","+this.openEnd+")"};Ht.prototype.toJSON=function(){if(!this.content.size)return null;var e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e};Ht.fromJSON=function(e,i){if(!i)return Ht.empty;var a=i.openStart||0,l=i.openEnd||0;if(typeof a!="number"||typeof l!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new Ht(Nt.fromJSON(e,i.content),a,l)};Ht.maxOpen=function(e,i){i===void 0&&(i=!0);for(var a=0,l=0,u=e.firstChild;u&&!u.isLeaf&&(i||!u.type.spec.isolating);u=u.firstChild)a++;for(var f=e.lastChild;f&&!f.isLeaf&&(i||!f.type.spec.isolating);f=f.lastChild)l++;return new Ht(e,a,l)};Object.defineProperties(Ht.prototype,ER);function _R(o,e,i){var a=o.findIndex(e),l=a.index,u=a.offset,f=o.maybeChild(l),g=o.findIndex(i),_=g.index,I=g.offset;if(u==e||f.isText){if(I!=i&&!o.child(_).isText)throw new RangeError("Removing non-flat range");return o.cut(0,e).append(o.cut(i))}if(l!=_)throw new RangeError("Removing non-flat range");return o.replaceChild(l,f.copy(_R(f.content,e-u-1,i-u-1)))}function vR(o,e,i,a){var l=o.findIndex(e),u=l.index,f=l.offset,g=o.maybeChild(u);if(f==e||g.isText)return a&&!a.canReplace(u,u,i)?null:o.cut(0,e).append(i).append(o.cut(e));var _=vR(g.content,e-f-1,i);return _&&o.replaceChild(u,g.copy(_))}Ht.empty=new Ht(Nt.empty,0,0);function $M(o,e,i){if(i.openStart>o.depth)throw new xs("Inserted content deeper than insertion position");if(o.depth-i.openStart!=e.depth-i.openEnd)throw new xs("Inconsistent open depths");return IR(o,e,i,0)}function IR(o,e,i,a){var l=o.index(a),u=o.node(a);if(l==e.index(a)&&a<o.depth-i.openStart){var f=IR(o,e,i,a+1);return u.copy(u.content.replaceChild(l,f))}else if(i.content.size)if(!i.openStart&&!i.openEnd&&o.depth==a&&e.depth==a){var g=o.parent,_=g.content;return Nc(g,_.cut(0,o.parentOffset).append(i.content).append(_.cut(e.parentOffset)))}else{var I=tP(i,o),T=I.start,N=I.end;return Nc(u,SR(o,T,N,e,a))}else return Nc(u,Vp(o,e,a))}function CR(o,e){if(!e.type.compatibleContent(o.type))throw new xs("Cannot join "+e.type.name+" onto "+o.type.name)}function Nm(o,e,i){var a=o.node(i);return CR(a,e.node(i)),a}function bc(o,e){var i=e.length-1;i>=0&&o.isText&&o.sameMarkup(e[i])?e[i]=o.withText(e[i].text+o.text):e.push(o)}function Iu(o,e,i,a){var l=(e||o).node(i),u=0,f=e?e.index(i):l.childCount;o&&(u=o.index(i),o.depth>i?u++:o.textOffset&&(bc(o.nodeAfter,a),u++));for(var g=u;g<f;g++)bc(l.child(g),a);e&&e.depth==i&&e.textOffset&&bc(e.nodeBefore,a)}function Nc(o,e){if(!o.type.validContent(e))throw new xs("Invalid content for node "+o.type.name);return o.copy(e)}function SR(o,e,i,a,l){var u=o.depth>l&&Nm(o,e,l+1),f=a.depth>l&&Nm(i,a,l+1),g=[];return Iu(null,o,l,g),u&&f&&e.index(l)==i.index(l)?(CR(u,f),bc(Nc(u,SR(o,e,i,a,l+1)),g)):(u&&bc(Nc(u,Vp(o,e,l+1)),g),Iu(e,i,l,g),f&&bc(Nc(f,Vp(i,a,l+1)),g)),Iu(a,null,l,g),new Nt(g)}function Vp(o,e,i){var a=[];if(Iu(null,o,i,a),o.depth>i){var l=Nm(o,e,i+1);bc(Nc(l,Vp(o,e,i+1)),a)}return Iu(e,null,i,a),new Nt(a)}function tP(o,e){for(var i=e.depth-o.openStart,a=e.node(i),l=a.copy(o.content),u=i-1;u>=0;u--)l=e.node(u).copy(Nt.from(l));return{start:l.resolveNoCache(o.openStart+i),end:l.resolveNoCache(l.content.size-o.openEnd-i)}}var an=function(e,i,a){this.pos=e,this.path=i,this.depth=i.length/3-1,this.parentOffset=a},jl={parent:{configurable:!0},doc:{configurable:!0},textOffset:{configurable:!0},nodeAfter:{configurable:!0},nodeBefore:{configurable:!0}};an.prototype.resolveDepth=function(e){return e==null?this.depth:e<0?this.depth+e:e};jl.parent.get=function(){return this.node(this.depth)};jl.doc.get=function(){return this.node(0)};an.prototype.node=function(e){return this.path[this.resolveDepth(e)*3]};an.prototype.index=function(e){return this.path[this.resolveDepth(e)*3+1]};an.prototype.indexAfter=function(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)};an.prototype.start=function(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1};an.prototype.end=function(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size};an.prototype.before=function(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]};an.prototype.after=function(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize};jl.textOffset.get=function(){return this.pos-this.path[this.path.length-1]};jl.nodeAfter.get=function(){var o=this.parent,e=this.index(this.depth);if(e==o.childCount)return null;var i=this.pos-this.path[this.path.length-1],a=o.child(e);return i?o.child(e).cut(i):a};jl.nodeBefore.get=function(){var o=this.index(this.depth),e=this.pos-this.path[this.path.length-1];return e?this.parent.child(o).cut(0,e):o==0?null:this.parent.child(o-1)};an.prototype.posAtIndex=function(e,i){i=this.resolveDepth(i);for(var a=this.path[i*3],l=i==0?0:this.path[i*3-1]+1,u=0;u<e;u++)l+=a.child(u).nodeSize;return l};an.prototype.marks=function(){var e=this.parent,i=this.index();if(e.content.size==0)return or.none;if(this.textOffset)return e.child(i).marks;var a=e.maybeChild(i-1),l=e.maybeChild(i);if(!a){var u=a;a=l,l=u}for(var f=a.marks,g=0;g<f.length;g++)f[g].type.spec.inclusive===!1&&(!l||!f[g].isInSet(l.marks))&&(f=f[g--].removeFromSet(f));return f};an.prototype.marksAcross=function(e){var i=this.parent.maybeChild(this.index());if(!i||!i.isInline)return null;for(var a=i.marks,l=e.parent.maybeChild(e.index()),u=0;u<a.length;u++)a[u].type.spec.inclusive===!1&&(!l||!a[u].isInSet(l.marks))&&(a=a[u--].removeFromSet(a));return a};an.prototype.sharedDepth=function(e){for(var i=this.depth;i>0;i--)if(this.start(i)<=e&&this.end(i)>=e)return i;return 0};an.prototype.blockRange=function(e,i){if(e===void 0&&(e=this),e.pos<this.pos)return e.blockRange(this);for(var a=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);a>=0;a--)if(e.pos<=this.end(a)&&(!i||i(this.node(a))))return new Cu(this,e,a)};an.prototype.sameParent=function(e){return this.pos-this.parentOffset==e.pos-e.parentOffset};an.prototype.max=function(e){return e.pos>this.pos?e:this};an.prototype.min=function(e){return e.pos<this.pos?e:this};an.prototype.toString=function(){for(var e="",i=1;i<=this.depth;i++)e+=(e?"/":"")+this.node(i).type.name+"_"+this.index(i-1);return e+":"+this.parentOffset};an.resolve=function(e,i){if(!(i>=0&&i<=e.content.size))throw new RangeError("Position "+i+" out of range");for(var a=[],l=0,u=i,f=e;;){var g=f.content.findIndex(u),_=g.index,I=g.offset,T=u-I;if(a.push(f,_,l+I),!T||(f=f.child(_),f.isText))break;u=T-1,l+=I+1}return new an(i,a,u)};an.resolveCached=function(e,i){for(var a=0;a<Om.length;a++){var l=Om[a];if(l.pos==i&&l.doc==e)return l}var u=Om[km]=an.resolve(e,i);return km=(km+1)%eP,u};Object.defineProperties(an.prototype,jl);var Om=[],km=0,eP=12,Cu=function(e,i,a){this.$from=e,this.$to=i,this.depth=a},Wl={start:{configurable:!0},end:{configurable:!0},parent:{configurable:!0},startIndex:{configurable:!0},endIndex:{configurable:!0}};Wl.start.get=function(){return this.$from.before(this.depth+1)};Wl.end.get=function(){return this.$to.after(this.depth+1)};Wl.parent.get=function(){return this.$from.node(this.depth)};Wl.startIndex.get=function(){return this.$from.index(this.depth)};Wl.endIndex.get=function(){return this.$to.indexAfter(this.depth)};Object.defineProperties(Cu.prototype,Wl);var rP=Object.create(null),ar=function(e,i,a,l){this.type=e,this.attrs=i,this.content=a||Nt.empty,this.marks=l||or.none},wo={nodeSize:{configurable:!0},childCount:{configurable:!0},textContent:{configurable:!0},firstChild:{configurable:!0},lastChild:{configurable:!0},isBlock:{configurable:!0},isTextblock:{configurable:!0},inlineContent:{configurable:!0},isInline:{configurable:!0},isText:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};wo.nodeSize.get=function(){return this.isLeaf?1:2+this.content.size};wo.childCount.get=function(){return this.content.childCount};ar.prototype.child=function(e){return this.content.child(e)};ar.prototype.maybeChild=function(e){return this.content.maybeChild(e)};ar.prototype.forEach=function(e){this.content.forEach(e)};ar.prototype.nodesBetween=function(e,i,a,l){l===void 0&&(l=0),this.content.nodesBetween(e,i,a,l,this)};ar.prototype.descendants=function(e){this.nodesBetween(0,this.content.size,e)};wo.textContent.get=function(){return this.textBetween(0,this.content.size,"")};ar.prototype.textBetween=function(e,i,a,l){return this.content.textBetween(e,i,a,l)};wo.firstChild.get=function(){return this.content.firstChild};wo.lastChild.get=function(){return this.content.lastChild};ar.prototype.eq=function(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)};ar.prototype.sameMarkup=function(e){return this.hasMarkup(e.type,e.attrs,e.marks)};ar.prototype.hasMarkup=function(e,i,a){return this.type==e&&Qp(this.attrs,i||e.defaultAttrs||rP)&&or.sameSet(this.marks,a||or.none)};ar.prototype.copy=function(e){return e===void 0&&(e=null),e==this.content?this:new this.constructor(this.type,this.attrs,e,this.marks)};ar.prototype.mark=function(e){return e==this.marks?this:new this.constructor(this.type,this.attrs,this.content,e)};ar.prototype.cut=function(e,i){return e==0&&i==this.content.size?this:this.copy(this.content.cut(e,i))};ar.prototype.slice=function(e,i,a){if(i===void 0&&(i=this.content.size),a===void 0&&(a=!1),e==i)return Ht.empty;var l=this.resolve(e),u=this.resolve(i),f=a?0:l.sharedDepth(i),g=l.start(f),_=l.node(f),I=_.content.cut(l.pos-g,u.pos-g);return new Ht(I,l.depth-f,u.depth-f)};ar.prototype.replace=function(e,i,a){return $M(this.resolve(e),this.resolve(i),a)};ar.prototype.nodeAt=function(e){for(var i=this;;){var a=i.content.findIndex(e),l=a.index,u=a.offset;if(i=i.maybeChild(l),!i)return null;if(u==e||i.isText)return i;e-=u+1}};ar.prototype.childAfter=function(e){var i=this.content.findIndex(e),a=i.index,l=i.offset;return{node:this.content.maybeChild(a),index:a,offset:l}};ar.prototype.childBefore=function(e){if(e==0)return{node:null,index:0,offset:0};var i=this.content.findIndex(e),a=i.index,l=i.offset;if(l<e)return{node:this.content.child(a),index:a,offset:l};var u=this.content.child(a-1);return{node:u,index:a-1,offset:l-u.nodeSize}};ar.prototype.resolve=function(e){return an.resolveCached(this,e)};ar.prototype.resolveNoCache=function(e){return an.resolve(this,e)};ar.prototype.rangeHasMark=function(e,i,a){var l=!1;return i>e&&this.nodesBetween(e,i,function(u){return a.isInSet(u.marks)&&(l=!0),!l}),l};wo.isBlock.get=function(){return this.type.isBlock};wo.isTextblock.get=function(){return this.type.isTextblock};wo.inlineContent.get=function(){return this.type.inlineContent};wo.isInline.get=function(){return this.type.isInline};wo.isText.get=function(){return this.type.isText};wo.isLeaf.get=function(){return this.type.isLeaf};wo.isAtom.get=function(){return this.type.isAtom};ar.prototype.toString=function(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);var e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),yR(this.marks,e)};ar.prototype.contentMatchAt=function(e){var i=this.type.contentMatch.matchFragment(this.content,0,e);if(!i)throw new Error("Called contentMatchAt on a node with invalid content");return i};ar.prototype.canReplace=function(e,i,a,l,u){a===void 0&&(a=Nt.empty),l===void 0&&(l=0),u===void 0&&(u=a.childCount);var f=this.contentMatchAt(e).matchFragment(a,l,u),g=f&&f.matchFragment(this.content,i);if(!g||!g.validEnd)return!1;for(var _=l;_<u;_++)if(!this.type.allowsMarks(a.child(_).marks))return!1;return!0};ar.prototype.canReplaceWith=function(e,i,a,l){if(l&&!this.type.allowsMarks(l))return!1;var u=this.contentMatchAt(e).matchType(a),f=u&&u.matchFragment(this.content,i);return f?f.validEnd:!1};ar.prototype.canAppend=function(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)};ar.prototype.check=function(){if(!this.type.validContent(this.content))throw new RangeError("Invalid content for node "+this.type.name+": "+this.content.toString().slice(0,50));for(var e=or.none,i=0;i<this.marks.length;i++)e=this.marks[i].addToSet(e);if(!or.sameSet(e,this.marks))throw new RangeError("Invalid collection of marks for node "+this.type.name+": "+this.marks.map(function(a){return a.type.name}));this.content.forEach(function(a){return a.check()})};ar.prototype.toJSON=function(){var e={type:this.type.name};for(var i in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(function(a){return a.toJSON()})),e};ar.fromJSON=function(e,i){if(!i)throw new RangeError("Invalid input for Node.fromJSON");var a=null;if(i.marks){if(!Array.isArray(i.marks))throw new RangeError("Invalid mark data for Node.fromJSON");a=i.marks.map(e.markFromJSON)}if(i.type=="text"){if(typeof i.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(i.text,a)}var l=Nt.fromJSON(e,i.content);return e.nodeType(i.type).create(i.attrs,l,a)};Object.defineProperties(ar.prototype,wo);var nP=function(o){function e(a,l,u,f){if(o.call(this,a,l,null,f),!u)throw new RangeError("Empty text nodes are not allowed");this.text=u}o&&(e.__proto__=o),e.prototype=Object.create(o&&o.prototype),e.prototype.constructor=e;var i={textContent:{configurable:!0},nodeSize:{configurable:!0}};return e.prototype.toString=function(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):yR(this.marks,JSON.stringify(this.text))},i.textContent.get=function(){return this.text},e.prototype.textBetween=function(l,u){return this.text.slice(l,u)},i.nodeSize.get=function(){return this.text.length},e.prototype.mark=function(l){return l==this.marks?this:new e(this.type,this.attrs,this.text,l)},e.prototype.withText=function(l){return l==this.text?this:new e(this.type,this.attrs,l,this.marks)},e.prototype.cut=function(l,u){return l===void 0&&(l=0),u===void 0&&(u=this.text.length),l==0&&u==this.text.length?this:this.withText(this.text.slice(l,u))},e.prototype.eq=function(l){return this.sameMarkup(l)&&this.text==l.text},e.prototype.toJSON=function(){var l=o.prototype.toJSON.call(this);return l.text=this.text,l},Object.defineProperties(e.prototype,i),e}(ar);function yR(o,e){for(var i=o.length-1;i>=0;i--)e=o[i].type.name+"("+e+")";return e}var bi=function(e){this.validEnd=e,this.next=[],this.wrapCache=[]},Gp={inlineContent:{configurable:!0},defaultType:{configurable:!0},edgeCount:{configurable:!0}};bi.parse=function(e,i){var a=new jp(e,i);if(a.next==null)return bi.empty;var l=RR(a);a.next&&a.err("Unexpected trailing text");var u=dP(lP(l));return uP(u,a),u};bi.prototype.matchType=function(e){for(var i=0;i<this.next.length;i+=2)if(this.next[i]==e)return this.next[i+1];return null};bi.prototype.matchFragment=function(e,i,a){i===void 0&&(i=0),a===void 0&&(a=e.childCount);for(var l=this,u=i;l&&u<a;u++)l=l.matchType(e.child(u).type);return l};Gp.inlineContent.get=function(){var o=this.next[0];return o?o.isInline:!1};Gp.defaultType.get=function(){for(var o=0;o<this.next.length;o+=2){var e=this.next[o];if(!(e.isText||e.hasRequiredAttrs()))return e}};bi.prototype.compatible=function(e){for(var i=0;i<this.next.length;i+=2)for(var a=0;a<e.next.length;a+=2)if(this.next[i]==e.next[a])return!0;return!1};bi.prototype.fillBefore=function(e,i,a){i===void 0&&(i=!1),a===void 0&&(a=0);var l=[this];function u(f,g){var _=f.matchFragment(e,a);if(_&&(!i||_.validEnd))return Nt.from(g.map(function(F){return F.createAndFill()}));for(var I=0;I<f.next.length;I+=2){var T=f.next[I],N=f.next[I+1];if(!(T.isText||T.hasRequiredAttrs())&&l.indexOf(N)==-1){l.push(N);var D=u(N,g.concat(T));if(D)return D}}}return u(this,[])};bi.prototype.findWrapping=function(e){for(var i=0;i<this.wrapCache.length;i+=2)if(this.wrapCache[i]==e)return this.wrapCache[i+1];var a=this.computeWrapping(e);return this.wrapCache.push(e,a),a};bi.prototype.computeWrapping=function(e){for(var i=Object.create(null),a=[{match:this,type:null,via:null}];a.length;){var l=a.shift(),u=l.match;if(u.matchType(e)){for(var f=[],g=l;g.type;g=g.via)f.push(g.type);return f.reverse()}for(var _=0;_<u.next.length;_+=2){var I=u.next[_];!I.isLeaf&&!I.hasRequiredAttrs()&&!(I.name in i)&&(!l.type||u.next[_+1].validEnd)&&(a.push({match:I.contentMatch,type:I,via:l}),i[I.name]=!0)}}};Gp.edgeCount.get=function(){return this.next.length>>1};bi.prototype.edge=function(e){var i=e<<1;if(i>=this.next.length)throw new RangeError("There's no "+e+"th edge in this content match");return{type:this.next[i],next:this.next[i+1]}};bi.prototype.toString=function(){var e=[];function i(a){e.push(a);for(var l=1;l<a.next.length;l+=2)e.indexOf(a.next[l])==-1&&i(a.next[l])}return i(this),e.map(function(a,l){for(var u=l+(a.validEnd?"*":" ")+" ",f=0;f<a.next.length;f+=2)u+=(f?", ":"")+a.next[f].name+"->"+e.indexOf(a.next[f+1]);return u}).join(`
`)};Object.defineProperties(bi.prototype,Gp);bi.empty=new bi(!0);var jp=function(e,i){this.string=e,this.nodeTypes=i,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()},TR={next:{configurable:!0}};TR.next.get=function(){return this.tokens[this.pos]};jp.prototype.eat=function(e){return this.next==e&&(this.pos++||!0)};jp.prototype.err=function(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")};Object.defineProperties(jp.prototype,TR);function RR(o){var e=[];do e.push(iP(o));while(o.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function iP(o){var e=[];do e.push(oP(o));while(o.next&&o.next!=")"&&o.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function oP(o){for(var e=cP(o);;)if(o.eat("+"))e={type:"plus",expr:e};else if(o.eat("*"))e={type:"star",expr:e};else if(o.eat("?"))e={type:"opt",expr:e};else if(o.eat("{"))e=sP(o,e);else break;return e}function wR(o){/\D/.test(o.next)&&o.err("Expected number, got '"+o.next+"'");var e=Number(o.next);return o.pos++,e}function sP(o,e){var i=wR(o),a=i;return o.eat(",")&&(o.next!="}"?a=wR(o):a=-1),o.eat("}")||o.err("Unclosed braced range"),{type:"range",min:i,max:a,expr:e}}function aP(o,e){var i=o.nodeTypes,a=i[e];if(a)return[a];var l=[];for(var u in i){var f=i[u];f.groups.indexOf(e)>-1&&l.push(f)}return l.length==0&&o.err("No node type or group '"+e+"' found"),l}function cP(o){if(o.eat("(")){var e=RR(o);return o.eat(")")||o.err("Missing closing paren"),e}else if(/\W/.test(o.next))o.err("Unexpected token '"+o.next+"'");else{var i=aP(o,o.next).map(function(a){return o.inline==null?o.inline=a.isInline:o.inline!=a.isInline&&o.err("Mixing inline and block content"),{type:"name",value:a}});return o.pos++,i.length==1?i[0]:{type:"choice",exprs:i}}}function lP(o){var e=[[]];return l(u(o,0),i()),e;function i(){return e.push([])-1}function a(f,g,_){var I={term:_,to:g};return e[f].push(I),I}function l(f,g){f.forEach(function(_){return _.to=g})}function u(f,g){if(f.type=="choice")return f.exprs.reduce(function(it,z){return it.concat(u(z,g))},[]);if(f.type=="seq")for(var _=0;;_++){var I=u(f.exprs[_],g);if(_==f.exprs.length-1)return I;l(I,g=i())}else if(f.type=="star"){var T=i();return a(g,T),l(u(f.expr,T),T),[a(T)]}else if(f.type=="plus"){var N=i();return l(u(f.expr,g),N),l(u(f.expr,N),N),[a(N)]}else{if(f.type=="opt")return[a(g)].concat(u(f.expr,g));if(f.type=="range"){for(var D=g,F=0;F<f.min;F++){var K=i();l(u(f.expr,D),K),D=K}if(f.max==-1)l(u(f.expr,D),D);else for(var J=f.min;J<f.max;J++){var nt=i();a(D,nt),l(u(f.expr,D),nt),D=nt}return[a(D)]}else if(f.type=="name")return[a(g,null,f.value)]}}}function bR(o,e){return e-o}function NR(o,e){var i=[];return a(e),i.sort(bR);function a(l){var u=o[l];if(u.length==1&&!u[0].term)return a(u[0].to);i.push(l);for(var f=0;f<u.length;f++){var g=u[f],_=g.term,I=g.to;!_&&i.indexOf(I)==-1&&a(I)}}}function dP(o){var e=Object.create(null);return i(NR(o,0));function i(a){var l=[];a.forEach(function(_){o[_].forEach(function(I){var T=I.term,N=I.to;if(!!T){var D=l.indexOf(T),F=D>-1&&l[D+1];NR(o,N).forEach(function(K){F||l.push(T,F=[]),F.indexOf(K)==-1&&F.push(K)})}})});for(var u=e[a.join(",")]=new bi(a.indexOf(o.length-1)>-1),f=0;f<l.length;f+=2){var g=l[f+1].sort(bR);u.next.push(l[f],e[g.join(",")]||i(g))}return u}}function uP(o,e){for(var i=0,a=[o];i<a.length;i++){for(var l=a[i],u=!l.validEnd,f=[],g=0;g<l.next.length;g+=2){var _=l.next[g],I=l.next[g+1];f.push(_.name),u&&!(_.isText||_.hasRequiredAttrs())&&(u=!1),a.indexOf(I)==-1&&a.push(I)}u&&e.err("Only non-generatable nodes ("+f.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function OR(o){var e=Object.create(null);for(var i in o){var a=o[i];if(!a.hasDefault)return null;e[i]=a.default}return e}function kR(o,e){var i=Object.create(null);for(var a in o){var l=e&&e[a];if(l===void 0){var u=o[a];if(u.hasDefault)l=u.default;else throw new RangeError("No value supplied for attribute "+a)}i[a]=l}return i}function DR(o){var e=Object.create(null);if(o)for(var i in o)e[i]=new LR(o[i]);return e}var ji=function(e,i,a){this.name=e,this.schema=i,this.spec=a,this.groups=a.group?a.group.split(" "):[],this.attrs=DR(a.attrs),this.defaultAttrs=OR(this.attrs),this.contentMatch=null,this.markSet=null,this.inlineContent=null,this.isBlock=!(a.inline||e=="text"),this.isText=e=="text"},Kl={isInline:{configurable:!0},isTextblock:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0},whitespace:{configurable:!0}};Kl.isInline.get=function(){return!this.isBlock};Kl.isTextblock.get=function(){return this.isBlock&&this.inlineContent};Kl.isLeaf.get=function(){return this.contentMatch==bi.empty};Kl.isAtom.get=function(){return this.isLeaf||this.spec.atom};Kl.whitespace.get=function(){return this.spec.whitespace||(this.spec.code?"pre":"normal")};ji.prototype.hasRequiredAttrs=function(){for(var e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1};ji.prototype.compatibleContent=function(e){return this==e||this.contentMatch.compatible(e.contentMatch)};ji.prototype.computeAttrs=function(e){return!e&&this.defaultAttrs?this.defaultAttrs:kR(this.attrs,e)};ji.prototype.create=function(e,i,a){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new ar(this,this.computeAttrs(e),Nt.from(i),or.setFrom(a))};ji.prototype.createChecked=function(e,i,a){if(i=Nt.from(i),!this.validContent(i))throw new RangeError("Invalid content for node "+this.name);return new ar(this,this.computeAttrs(e),i,or.setFrom(a))};ji.prototype.createAndFill=function(e,i,a){if(e=this.computeAttrs(e),i=Nt.from(i),i.size){var l=this.contentMatch.fillBefore(i);if(!l)return null;i=l.append(i)}var u=this.contentMatch.matchFragment(i).fillBefore(Nt.empty,!0);return u?new ar(this,e,i.append(u),or.setFrom(a)):null};ji.prototype.validContent=function(e){var i=this.contentMatch.matchFragment(e);if(!i||!i.validEnd)return!1;for(var a=0;a<e.childCount;a++)if(!this.allowsMarks(e.child(a).marks))return!1;return!0};ji.prototype.allowsMarkType=function(e){return this.markSet==null||this.markSet.indexOf(e)>-1};ji.prototype.allowsMarks=function(e){if(this.markSet==null)return!0;for(var i=0;i<e.length;i++)if(!this.allowsMarkType(e[i].type))return!1;return!0};ji.prototype.allowedMarks=function(e){if(this.markSet==null)return e;for(var i,a=0;a<e.length;a++)this.allowsMarkType(e[a].type)?i&&i.push(e[a]):i||(i=e.slice(0,a));return i?i.length?i:or.empty:e};ji.compile=function(e,i){var a=Object.create(null);e.forEach(function(f,g){return a[f]=new ji(f,i,g)});var l=i.spec.topNode||"doc";if(!a[l])throw new RangeError("Schema is missing its top node type ('"+l+"')");if(!a.text)throw new RangeError("Every schema needs a 'text' type");for(var u in a.text.attrs)throw new RangeError("The text node type should not have attributes");return a};Object.defineProperties(ji.prototype,Kl);var LR=function(e){this.hasDefault=Object.prototype.hasOwnProperty.call(e,"default"),this.default=e.default},MR={isRequired:{configurable:!0}};MR.isRequired.get=function(){return!this.hasDefault};Object.defineProperties(LR.prototype,MR);var Ha=function(e,i,a,l){this.name=e,this.schema=a,this.spec=l,this.attrs=DR(l.attrs),this.rank=i,this.excluded=null;var u=OR(this.attrs);this.instance=u&&new or(this,u)};Ha.prototype.create=function(e){return!e&&this.instance?this.instance:new or(this,kR(this.attrs,e))};Ha.compile=function(e,i){var a=Object.create(null),l=0;return e.forEach(function(u,f){return a[u]=new Ha(u,l++,i,f)}),a};Ha.prototype.removeFromSet=function(e){for(var i=0;i<e.length;i++)e[i].type==this&&(e=e.slice(0,i).concat(e.slice(i+1)),i--);return e};Ha.prototype.isInSet=function(e){for(var i=0;i<e.length;i++)if(e[i].type==this)return e[i]};Ha.prototype.excludes=function(e){return this.excluded.indexOf(e)>-1};var Oc=function(e){this.spec={};for(var i in e)this.spec[i]=e[i];this.spec.nodes=AR.from(e.nodes),this.spec.marks=AR.from(e.marks),this.nodes=ji.compile(this.spec.nodes,this),this.marks=Ha.compile(this.spec.marks,this);var a=Object.create(null);for(var l in this.nodes){if(l in this.marks)throw new RangeError(l+" can not be both a node and a mark");var u=this.nodes[l],f=u.spec.content||"",g=u.spec.marks;u.contentMatch=a[f]||(a[f]=bi.parse(f,this.nodes)),u.inlineContent=u.contentMatch.inlineContent,u.markSet=g=="_"?null:g?PR(this,g.split(" ")):g==""||!u.inlineContent?[]:null}for(var _ in this.marks){var I=this.marks[_],T=I.spec.excludes;I.excluded=T==null?[I]:T==""?[]:PR(this,T.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached=Object.create(null),this.cached.wrappings=Object.create(null)};Oc.prototype.node=function(e,i,a,l){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof ji){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(i,a,l)};Oc.prototype.text=function(e,i){var a=this.nodes.text;return new nP(a,a.defaultAttrs,e,or.setFrom(i))};Oc.prototype.mark=function(e,i){return typeof e=="string"&&(e=this.marks[e]),e.create(i)};Oc.prototype.nodeFromJSON=function(e){return ar.fromJSON(this,e)};Oc.prototype.markFromJSON=function(e){return or.fromJSON(this,e)};Oc.prototype.nodeType=function(e){var i=this.nodes[e];if(!i)throw new RangeError("Unknown node type: "+e);return i};function PR(o,e){for(var i=[],a=0;a<e.length;a++){var l=e[a],u=o.marks[l],f=u;if(u)i.push(u);else for(var g in o.marks){var _=o.marks[g];(l=="_"||_.spec.group&&_.spec.group.split(" ").indexOf(l)>-1)&&i.push(f=_)}if(!f)throw new SyntaxError("Unknown mark type: '"+e[a]+"'")}return i}var ms=function(e,i){var a=this;this.schema=e,this.rules=i,this.tags=[],this.styles=[],i.forEach(function(l){l.tag?a.tags.push(l):l.style&&a.styles.push(l)}),this.normalizeLists=!this.tags.some(function(l){if(!/^(ul|ol)\b/.test(l.tag)||!l.node)return!1;var u=e.nodes[l.node];return u.contentMatch.matchType(u)})};ms.prototype.parse=function(e,i){i===void 0&&(i={});var a=new Xr(this,i,!1);return a.addAll(e,null,i.from,i.to),a.finish()};ms.prototype.parseSlice=function(e,i){i===void 0&&(i={});var a=new Xr(this,i,!0);return a.addAll(e,null,i.from,i.to),Ht.maxOpen(a.finish())};ms.prototype.matchTag=function(e,i,a){for(var l=a?this.tags.indexOf(a)+1:0;l<this.tags.length;l++){var u=this.tags[l];if(fP(e,u.tag)&&(u.namespace===void 0||e.namespaceURI==u.namespace)&&(!u.context||i.matchesContext(u.context))){if(u.getAttrs){var f=u.getAttrs(e);if(f===!1)continue;u.attrs=f}return u}}};ms.prototype.matchStyle=function(e,i,a,l){for(var u=l?this.styles.indexOf(l)+1:0;u<this.styles.length;u++){var f=this.styles[u];if(!(f.style.indexOf(e)!=0||f.context&&!a.matchesContext(f.context)||f.style.length>e.length&&(f.style.charCodeAt(e.length)!=61||f.style.slice(e.length+1)!=i))){if(f.getAttrs){var g=f.getAttrs(i);if(g===!1)continue;f.attrs=g}return f}}};ms.schemaRules=function(e){var i=[];function a(_){for(var I=_.priority==null?50:_.priority,T=0;T<i.length;T++){var N=i[T],D=N.priority==null?50:N.priority;if(D<I)break}i.splice(T,0,_)}var l=function(_){var I=e.marks[_].spec.parseDOM;I&&I.forEach(function(T){a(T=xR(T)),T.mark=_})};for(var u in e.marks)l(u);var f=function(_){var I=e.nodes[g].spec.parseDOM;I&&I.forEach(function(T){a(T=xR(T)),T.node=g})};for(var g in e.nodes)f();return i};ms.fromSchema=function(e){return e.cached.domParser||(e.cached.domParser=new ms(e,ms.schemaRules(e)))};var Dm={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},hP={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},BR={ol:!0,ul:!0},Wp=1,Kp=2,Su=4;function UR(o,e,i){return e!=null?(e?Wp:0)|(e==="full"?Kp:0):o&&o.whitespace=="pre"?Wp|Kp:i&~Su}var Ca=function(e,i,a,l,u,f,g){this.type=e,this.attrs=i,this.solid=u,this.match=f||(g&Su?null:e.contentMatch),this.options=g,this.content=[],this.marks=a,this.activeMarks=or.none,this.pendingMarks=l,this.stashMarks=[]};Ca.prototype.findWrapping=function(e){if(!this.match){if(!this.type)return[];var i=this.type.contentMatch.fillBefore(Nt.from(e));if(i)this.match=this.type.contentMatch.matchFragment(i);else{var a=this.type.contentMatch,l;return(l=a.findWrapping(e.type))?(this.match=a,l):null}}return this.match.findWrapping(e.type)};Ca.prototype.finish=function(e){if(!(this.options&Wp)){var i=this.content[this.content.length-1],a;i&&i.isText&&(a=/[ \t\r\n\u000c]+$/.exec(i.text))&&(i.text.length==a[0].length?this.content.pop():this.content[this.content.length-1]=i.withText(i.text.slice(0,i.text.length-a[0].length)))}var l=Nt.from(this.content);return!e&&this.match&&(l=l.append(this.match.fillBefore(Nt.empty,!0))),this.type?this.type.create(this.attrs,l,this.marks):l};Ca.prototype.popFromStashMark=function(e){for(var i=this.stashMarks.length-1;i>=0;i--)if(e.eq(this.stashMarks[i]))return this.stashMarks.splice(i,1)[0]};Ca.prototype.applyPending=function(e){for(var i=0,a=this.pendingMarks;i<a.length;i++){var l=a[i];(this.type?this.type.allowsMarkType(l.type):gP(l.type,e))&&!l.isInSet(this.activeMarks)&&(this.activeMarks=l.addToSet(this.activeMarks),this.pendingMarks=l.removeFromSet(this.pendingMarks))}};Ca.prototype.inlineContext=function(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!Dm.hasOwnProperty(e.parentNode.nodeName.toLowerCase())};var Xr=function(e,i,a){this.parser=e,this.options=i,this.isOpen=a;var l=i.topNode,u,f=UR(null,i.preserveWhitespace,0)|(a?Su:0);l?u=new Ca(l.type,l.attrs,or.none,or.none,!0,i.topMatch||l.type.contentMatch,f):a?u=new Ca(null,null,or.none,or.none,!0,null,f):u=new Ca(e.schema.topNodeType,null,or.none,or.none,!0,null,f),this.nodes=[u],this.open=0,this.find=i.findPositions,this.needsBlock=!1},Lm={top:{configurable:!0},currentPos:{configurable:!0}};Lm.top.get=function(){return this.nodes[this.open]};Xr.prototype.addDOM=function(e){if(e.nodeType==3)this.addTextNode(e);else if(e.nodeType==1){var i=e.getAttribute("style"),a=i?this.readStyles(AP(i)):null,l=this.top;if(a!=null)for(var u=0;u<a.length;u++)this.addPendingMark(a[u]);if(this.addElement(e),a!=null)for(var f=0;f<a.length;f++)this.removePendingMark(a[f],l)}};Xr.prototype.addTextNode=function(e){var i=e.nodeValue,a=this.top;if(a.options&Kp||a.inlineContext(e)||/[^ \t\r\n\u000c]/.test(i)){if(a.options&Wp)a.options&Kp?i=i.replace(/\r\n?/g,`
`):i=i.replace(/\r?\n|\r/g," ");else if(i=i.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(i)&&this.open==this.nodes.length-1){var l=a.content[a.content.length-1],u=e.previousSibling;(!l||u&&u.nodeName=="BR"||l.isText&&/[ \t\r\n\u000c]$/.test(l.text))&&(i=i.slice(1))}i&&this.insertNode(this.parser.schema.text(i)),this.findInText(e)}else this.findInside(e)};Xr.prototype.addElement=function(e,i){var a=e.nodeName.toLowerCase(),l;BR.hasOwnProperty(a)&&this.parser.normalizeLists&&pP(e);var u=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(l=this.parser.matchTag(e,this,i));if(u?u.ignore:hP.hasOwnProperty(a))this.findInside(e),this.ignoreFallback(e);else if(!u||u.skip||u.closeParent){u&&u.closeParent?this.open=Math.max(0,this.open-1):u&&u.skip.nodeType&&(e=u.skip);var f,g=this.top,_=this.needsBlock;if(Dm.hasOwnProperty(a))f=!0,g.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e);return}this.addAll(e),f&&this.sync(g),this.needsBlock=_}else this.addElementByRule(e,u,u.consuming===!1?l:null)};Xr.prototype.leafFallback=function(e){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`))};Xr.prototype.ignoreFallback=function(e){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"))};Xr.prototype.readStyles=function(e){var i=or.none;t:for(var a=0;a<e.length;a+=2)for(var l=null;;){var u=this.parser.matchStyle(e[a],e[a+1],this,l);if(!u)continue t;if(u.ignore)return null;if(i=this.parser.schema.marks[u.mark].create(u.attrs).addToSet(i),u.consuming===!1)l=u;else break}return i};Xr.prototype.addElementByRule=function(e,i,a){var l=this,u,f,g,_;i.node?(f=this.parser.schema.nodes[i.node],f.isLeaf?this.insertNode(f.create(i.attrs))||this.leafFallback(e):u=this.enter(f,i.attrs,i.preserveWhitespace)):(g=this.parser.schema.marks[i.mark],_=g.create(i.attrs),this.addPendingMark(_));var I=this.top;if(f&&f.isLeaf)this.findInside(e);else if(a)this.addElement(e,a);else if(i.getContent)this.findInside(e),i.getContent(e,this.parser.schema).forEach(function(N){return l.insertNode(N)});else{var T=i.contentElement;typeof T=="string"?T=e.querySelector(T):typeof T=="function"&&(T=T(e)),T||(T=e),this.findAround(e,T,!0),this.addAll(T,u)}u&&(this.sync(I),this.open--),_&&this.removePendingMark(_,I)};Xr.prototype.addAll=function(e,i,a,l){for(var u=a||0,f=a?e.childNodes[a]:e.firstChild,g=l==null?null:e.childNodes[l];f!=g;f=f.nextSibling,++u)this.findAtPoint(e,u),this.addDOM(f),i&&Dm.hasOwnProperty(f.nodeName.toLowerCase())&&this.sync(i);this.findAtPoint(e,u)};Xr.prototype.findPlace=function(e){for(var i,a,l=this.open;l>=0;l--){var u=this.nodes[l],f=u.findWrapping(e);if(f&&(!i||i.length>f.length)&&(i=f,a=u,!f.length)||u.solid)break}if(!i)return!1;this.sync(a);for(var g=0;g<i.length;g++)this.enterInner(i[g],null,!1);return!0};Xr.prototype.insertNode=function(e){if(e.isInline&&this.needsBlock&&!this.top.type){var i=this.textblockFromContext();i&&this.enterInner(i)}if(this.findPlace(e)){this.closeExtra();var a=this.top;a.applyPending(e.type),a.match&&(a.match=a.match.matchType(e.type));for(var l=a.activeMarks,u=0;u<e.marks.length;u++)(!a.type||a.type.allowsMarkType(e.marks[u].type))&&(l=e.marks[u].addToSet(l));return a.content.push(e.mark(l)),!0}return!1};Xr.prototype.enter=function(e,i,a){var l=this.findPlace(e.create(i));return l&&this.enterInner(e,i,!0,a),l};Xr.prototype.enterInner=function(e,i,a,l){this.closeExtra();var u=this.top;u.applyPending(e),u.match=u.match&&u.match.matchType(e,i);var f=UR(e,l,u.options);u.options&Su&&u.content.length==0&&(f|=Su),this.nodes.push(new Ca(e,i,u.activeMarks,u.pendingMarks,a,null,f)),this.open++};Xr.prototype.closeExtra=function(e){var i=this.nodes.length-1;if(i>this.open){for(;i>this.open;i--)this.nodes[i-1].content.push(this.nodes[i].finish(e));this.nodes.length=this.open+1}};Xr.prototype.finish=function(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)};Xr.prototype.sync=function(e){for(var i=this.open;i>=0;i--)if(this.nodes[i]==e){this.open=i;return}};Lm.currentPos.get=function(){this.closeExtra();for(var o=0,e=this.open;e>=0;e--){for(var i=this.nodes[e].content,a=i.length-1;a>=0;a--)o+=i[a].nodeSize;e&&o++}return o};Xr.prototype.findAtPoint=function(e,i){if(this.find)for(var a=0;a<this.find.length;a++)this.find[a].node==e&&this.find[a].offset==i&&(this.find[a].pos=this.currentPos)};Xr.prototype.findInside=function(e){if(this.find)for(var i=0;i<this.find.length;i++)this.find[i].pos==null&&e.nodeType==1&&e.contains(this.find[i].node)&&(this.find[i].pos=this.currentPos)};Xr.prototype.findAround=function(e,i,a){if(e!=i&&this.find){for(var l=0;l<this.find.length;l++)if(this.find[l].pos==null&&e.nodeType==1&&e.contains(this.find[l].node)){var u=i.compareDocumentPosition(this.find[l].node);u&(a?2:4)&&(this.find[l].pos=this.currentPos)}}};Xr.prototype.findInText=function(e){if(this.find)for(var i=0;i<this.find.length;i++)this.find[i].node==e&&(this.find[i].pos=this.currentPos-(e.nodeValue.length-this.find[i].offset))};Xr.prototype.matchesContext=function(e){var i=this;if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);var a=e.split("/"),l=this.options.context,u=!this.isOpen&&(!l||l.parent.type==this.nodes[0].type),f=-(l?l.depth+1:0)+(u?0:1),g=function(_,I){for(;_>=0;_--){var T=a[_];if(T==""){if(_==a.length-1||_==0)continue;for(;I>=f;I--)if(g(_-1,I))return!0;return!1}else{var N=I>0||I==0&&u?i.nodes[I].type:l&&I>=f?l.node(I-f).type:null;if(!N||N.name!=T&&N.groups.indexOf(T)==-1)return!1;I--}}return!0};return g(a.length-1,this.open)};Xr.prototype.textblockFromContext=function(){var e=this.options.context;if(e)for(var i=e.depth;i>=0;i--){var a=e.node(i).contentMatchAt(e.indexAfter(i)).defaultType;if(a&&a.isTextblock&&a.defaultAttrs)return a}for(var l in this.parser.schema.nodes){var u=this.parser.schema.nodes[l];if(u.isTextblock&&u.defaultAttrs)return u}};Xr.prototype.addPendingMark=function(e){var i=mP(e,this.top.pendingMarks);i&&this.top.stashMarks.push(i),this.top.pendingMarks=e.addToSet(this.top.pendingMarks)};Xr.prototype.removePendingMark=function(e,i){for(var a=this.open;a>=0;a--){var l=this.nodes[a],u=l.pendingMarks.lastIndexOf(e);if(u>-1)l.pendingMarks=e.removeFromSet(l.pendingMarks);else{l.activeMarks=e.removeFromSet(l.activeMarks);var f=l.popFromStashMark(e);f&&l.type&&l.type.allowsMarkType(f.type)&&(l.activeMarks=f.addToSet(l.activeMarks))}if(l==i)break}};Object.defineProperties(Xr.prototype,Lm);function pP(o){for(var e=o.firstChild,i=null;e;e=e.nextSibling){var a=e.nodeType==1?e.nodeName.toLowerCase():null;a&&BR.hasOwnProperty(a)&&i?(i.appendChild(e),e=i):a=="li"?i=e:a&&(i=null)}}function fP(o,e){return(o.matches||o.msMatchesSelector||o.webkitMatchesSelector||o.mozMatchesSelector).call(o,e)}function AP(o){for(var e=/\s*([\w-]+)\s*:\s*([^;]+)/g,i,a=[];i=e.exec(o);)a.push(i[1],i[2].trim());return a}function xR(o){var e={};for(var i in o)e[i]=o[i];return e}function gP(o,e){var i=e.schema.nodes,a=function(f){var g=i[f];if(!!g.allowsMarkType(o)){var _=[],I=function(T){_.push(T);for(var N=0;N<T.edgeCount;N++){var D=T.edge(N),F=D.type,K=D.next;if(F==e||_.indexOf(K)<0&&I(K))return!0}};if(I(g.contentMatch))return{v:!0}}};for(var l in i){var u=a(l);if(u)return u.v}}function mP(o,e){for(var i=0;i<e.length;i++)if(o.eq(e[i]))return e[i]}var li=function(e,i){this.nodes=e||{},this.marks=i||{}};li.prototype.serializeFragment=function(e,i,a){var l=this;i===void 0&&(i={}),a||(a=Mm(i).createDocumentFragment());var u=a,f=null;return e.forEach(function(g){if(f||g.marks.length){f||(f=[]);for(var _=0,I=0;_<f.length&&I<g.marks.length;){var T=g.marks[I];if(!l.marks[T.type.name]){I++;continue}if(!T.eq(f[_])||T.type.spec.spanning===!1)break;_+=2,I++}for(;_<f.length;)u=f.pop(),f.pop();for(;I<g.marks.length;){var N=g.marks[I++],D=l.serializeMark(N,g.isInline,i);D&&(f.push(N,u),u.appendChild(D.dom),u=D.contentDOM||D.dom)}}u.appendChild(l.serializeNodeInner(g,i))}),a};li.prototype.serializeNodeInner=function(e,i){i===void 0&&(i={});var a=li.renderSpec(Mm(i),this.nodes[e.type.name](e)),l=a.dom,u=a.contentDOM;if(u){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");i.onContent?i.onContent(e,u,i):this.serializeFragment(e.content,i,u)}return l};li.prototype.serializeNode=function(e,i){i===void 0&&(i={});for(var a=this.serializeNodeInner(e,i),l=e.marks.length-1;l>=0;l--){var u=this.serializeMark(e.marks[l],e.isInline,i);u&&((u.contentDOM||u.dom).appendChild(a),a=u.dom)}return a};li.prototype.serializeMark=function(e,i,a){a===void 0&&(a={});var l=this.marks[e.type.name];return l&&li.renderSpec(Mm(a),l(e,i))};li.renderSpec=function(e,i,a){if(a===void 0&&(a=null),typeof i=="string")return{dom:e.createTextNode(i)};if(i.nodeType!=null)return{dom:i};if(i.dom&&i.dom.nodeType!=null)return i;var l=i[0],u=l.indexOf(" ");u>0&&(a=l.slice(0,u),l=l.slice(u+1));var f=null,g=a?e.createElementNS(a,l):e.createElement(l),_=i[1],I=1;if(_&&typeof _=="object"&&_.nodeType==null&&!Array.isArray(_)){I=2;for(var T in _)if(_[T]!=null){var N=T.indexOf(" ");N>0?g.setAttributeNS(T.slice(0,N),T.slice(N+1),_[T]):g.setAttribute(T,_[T])}}for(var D=I;D<i.length;D++){var F=i[D];if(F===0){if(D<i.length-1||D>I)throw new RangeError("Content hole must be the only child of its parent node");return{dom:g,contentDOM:g}}else{var K=li.renderSpec(e,F,a),J=K.dom,nt=K.contentDOM;if(g.appendChild(J),nt){if(f)throw new RangeError("Multiple content holes");f=nt}}}return{dom:g,contentDOM:f}};li.fromSchema=function(e){return e.cached.domSerializer||(e.cached.domSerializer=new li(this.nodesFromSchema(e),this.marksFromSchema(e)))};li.nodesFromSchema=function(e){var i=FR(e.nodes);return i.text||(i.text=function(a){return a.text}),i};li.marksFromSchema=function(e){return FR(e.marks)};function FR(o){var e={};for(var i in o){var a=o[i].spec.toDOM;a&&(e[i]=a)}return e}function Mm(o){return o.document||window.document}var QR=65535,VR=Math.pow(2,16);function EP(o,e){return o+e*VR}function GR(o){return o&QR}function _P(o){return(o-(o&QR))/VR}var Pm=function(e,i,a){i===void 0&&(i=!1),a===void 0&&(a=null),this.pos=e,this.deleted=i,this.recover=a},di=function(e,i){i===void 0&&(i=!1),this.ranges=e,this.inverted=i};di.prototype.recover=function(e){var i=0,a=GR(e);if(!this.inverted)for(var l=0;l<a;l++)i+=this.ranges[l*3+2]-this.ranges[l*3+1];return this.ranges[a*3]+i+_P(e)};di.prototype.mapResult=function(e,i){return i===void 0&&(i=1),this._map(e,i,!1)};di.prototype.map=function(e,i){return i===void 0&&(i=1),this._map(e,i,!0)};di.prototype._map=function(e,i,a){for(var l=0,u=this.inverted?2:1,f=this.inverted?1:2,g=0;g<this.ranges.length;g+=3){var _=this.ranges[g]-(this.inverted?l:0);if(_>e)break;var I=this.ranges[g+u],T=this.ranges[g+f],N=_+I;if(e<=N){var D=I?e==_?-1:e==N?1:i:i,F=_+l+(D<0?0:T);if(a)return F;var K=e==(i<0?_:N)?null:EP(g/3,e-_);return new Pm(F,i<0?e!=_:e!=N,K)}l+=T-I}return a?e+l:new Pm(e+l)};di.prototype.touches=function(e,i){for(var a=0,l=GR(i),u=this.inverted?2:1,f=this.inverted?1:2,g=0;g<this.ranges.length;g+=3){var _=this.ranges[g]-(this.inverted?a:0);if(_>e)break;var I=this.ranges[g+u],T=_+I;if(e<=T&&g==l*3)return!0;a+=this.ranges[g+f]-I}return!1};di.prototype.forEach=function(e){for(var i=this.inverted?2:1,a=this.inverted?1:2,l=0,u=0;l<this.ranges.length;l+=3){var f=this.ranges[l],g=f-(this.inverted?u:0),_=f+(this.inverted?0:u),I=this.ranges[l+i],T=this.ranges[l+a];e(g,g+I,_,_+T),u+=T-I}};di.prototype.invert=function(){return new di(this.ranges,!this.inverted)};di.prototype.toString=function(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)};di.offset=function(e){return e==0?di.empty:new di(e<0?[0,-e,0]:[0,0,e])};di.empty=new di([]);var Ni=function(e,i,a,l){this.maps=e||[],this.from=a||0,this.to=l==null?this.maps.length:l,this.mirror=i};Ni.prototype.slice=function(e,i){return e===void 0&&(e=0),i===void 0&&(i=this.maps.length),new Ni(this.maps,this.mirror,e,i)};Ni.prototype.copy=function(){return new Ni(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)};Ni.prototype.appendMap=function(e,i){this.to=this.maps.push(e),i!=null&&this.setMirror(this.maps.length-1,i)};Ni.prototype.appendMapping=function(e){for(var i=0,a=this.maps.length;i<e.maps.length;i++){var l=e.getMirror(i);this.appendMap(e.maps[i],l!=null&&l<i?a+l:null)}};Ni.prototype.getMirror=function(e){if(this.mirror){for(var i=0;i<this.mirror.length;i++)if(this.mirror[i]==e)return this.mirror[i+(i%2?-1:1)]}};Ni.prototype.setMirror=function(e,i){this.mirror||(this.mirror=[]),this.mirror.push(e,i)};Ni.prototype.appendMappingInverted=function(e){for(var i=e.maps.length-1,a=this.maps.length+e.maps.length;i>=0;i--){var l=e.getMirror(i);this.appendMap(e.maps[i].invert(),l!=null&&l>i?a-l-1:null)}};Ni.prototype.invert=function(){var e=new Ni;return e.appendMappingInverted(this),e};Ni.prototype.map=function(e,i){if(i===void 0&&(i=1),this.mirror)return this._map(e,i,!0);for(var a=this.from;a<this.to;a++)e=this.maps[a].map(e,i);return e};Ni.prototype.mapResult=function(e,i){return i===void 0&&(i=1),this._map(e,i,!1)};Ni.prototype._map=function(e,i,a){for(var l=!1,u=this.from;u<this.to;u++){var f=this.maps[u],g=f.mapResult(e,i);if(g.recover!=null){var _=this.getMirror(u);if(_!=null&&_>u&&_<this.to){u=_,e=this.maps[_].recover(g.recover);continue}}g.deleted&&(l=!0),e=g.pos}return a?e:new Pm(e,l)};function Hl(o){var e=Error.call(this,o);return e.__proto__=Hl.prototype,e}Hl.prototype=Object.create(Error.prototype);Hl.prototype.constructor=Hl;Hl.prototype.name="TransformError";var On=function(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new Ni},Bm={before:{configurable:!0},docChanged:{configurable:!0}};Bm.before.get=function(){return this.docs.length?this.docs[0]:this.doc};On.prototype.step=function(e){var i=this.maybeStep(e);if(i.failed)throw new Hl(i.failed);return this};On.prototype.maybeStep=function(e){var i=e.apply(this.doc);return i.failed||this.addStep(e,i.doc),i};Bm.docChanged.get=function(){return this.steps.length>0};On.prototype.addStep=function(e,i){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=i};Object.defineProperties(On.prototype,Bm);function Hp(){throw new Error("Override me")}var Um=Object.create(null),Oi=function(){};Oi.prototype.apply=function(e){return Hp()};Oi.prototype.getMap=function(){return di.empty};Oi.prototype.invert=function(e){return Hp()};Oi.prototype.map=function(e){return Hp()};Oi.prototype.merge=function(e){return null};Oi.prototype.toJSON=function(){return Hp()};Oi.fromJSON=function(e,i){if(!i||!i.stepType)throw new RangeError("Invalid input for Step.fromJSON");var a=Um[i.stepType];if(!a)throw new RangeError("No step type "+i.stepType+" defined");return a.fromJSON(e,i)};Oi.jsonID=function(e,i){if(e in Um)throw new RangeError("Duplicate use of step JSON ID "+e);return Um[e]=i,i.prototype.jsonID=e,i};var Wi=function(e,i){this.doc=e,this.failed=i};Wi.ok=function(e){return new Wi(e,null)};Wi.fail=function(e){return new Wi(null,e)};Wi.fromReplace=function(e,i,a,l){try{return Wi.ok(e.replace(i,a,l))}catch(u){if(u instanceof xs)return Wi.fail(u.message);throw u}};var Sa=function(o){function e(i,a,l,u){o.call(this),this.from=i,this.to=a,this.slice=l,this.structure=!!u}return o&&(e.__proto__=o),e.prototype=Object.create(o&&o.prototype),e.prototype.constructor=e,e.prototype.apply=function(a){return this.structure&&xm(a,this.from,this.to)?Wi.fail("Structure replace would overwrite content"):Wi.fromReplace(a,this.from,this.to,this.slice)},e.prototype.getMap=function(){return new di([this.from,this.to-this.from,this.slice.size])},e.prototype.invert=function(a){return new e(this.from,this.from+this.slice.size,a.slice(this.from,this.to))},e.prototype.map=function(a){var l=a.mapResult(this.from,1),u=a.mapResult(this.to,-1);return l.deleted&&u.deleted?null:new e(l.pos,Math.max(l.pos,u.pos),this.slice)},e.prototype.merge=function(a){if(!(a instanceof e)||a.structure||this.structure)return null;if(this.from+this.slice.size==a.from&&!this.slice.openEnd&&!a.slice.openStart){var l=this.slice.size+a.slice.size==0?Ht.empty:new Ht(this.slice.content.append(a.slice.content),this.slice.openStart,a.slice.openEnd);return new e(this.from,this.to+(a.to-a.from),l,this.structure)}else if(a.to==this.from&&!this.slice.openStart&&!a.slice.openEnd){var u=this.slice.size+a.slice.size==0?Ht.empty:new Ht(a.slice.content.append(this.slice.content),a.slice.openStart,this.slice.openEnd);return new e(a.from,this.to,u,this.structure)}else return null},e.prototype.toJSON=function(){var a={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(a.slice=this.slice.toJSON()),this.structure&&(a.structure=!0),a},e.fromJSON=function(a,l){if(typeof l.from!="number"||typeof l.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new e(l.from,l.to,Ht.fromJSON(a,l.slice),!!l.structure)},e}(Oi);Oi.jsonID("replace",Sa);var lo=function(o){function e(i,a,l,u,f,g,_){o.call(this),this.from=i,this.to=a,this.gapFrom=l,this.gapTo=u,this.slice=f,this.insert=g,this.structure=!!_}return o&&(e.__proto__=o),e.prototype=Object.create(o&&o.prototype),e.prototype.constructor=e,e.prototype.apply=function(a){if(this.structure&&(xm(a,this.from,this.gapFrom)||xm(a,this.gapTo,this.to)))return Wi.fail("Structure gap-replace would overwrite content");var l=a.slice(this.gapFrom,this.gapTo);if(l.openStart||l.openEnd)return Wi.fail("Gap is not a flat range");var u=this.slice.insertAt(this.insert,l.content);return u?Wi.fromReplace(a,this.from,this.to,u):Wi.fail("Content does not fit in gap")},e.prototype.getMap=function(){return new di([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])},e.prototype.invert=function(a){var l=this.gapTo-this.gapFrom;return new e(this.from,this.from+this.slice.size+l,this.from+this.insert,this.from+this.insert+l,a.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)},e.prototype.map=function(a){var l=a.mapResult(this.from,1),u=a.mapResult(this.to,-1),f=a.map(this.gapFrom,-1),g=a.map(this.gapTo,1);return l.deleted&&u.deleted||f<l.pos||g>u.pos?null:new e(l.pos,u.pos,f,g,this.slice,this.insert,this.structure)},e.prototype.toJSON=function(){var a={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(a.slice=this.slice.toJSON()),this.structure&&(a.structure=!0),a},e.fromJSON=function(a,l){if(typeof l.from!="number"||typeof l.to!="number"||typeof l.gapFrom!="number"||typeof l.gapTo!="number"||typeof l.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new e(l.from,l.to,l.gapFrom,l.gapTo,Ht.fromJSON(a,l.slice),l.insert,!!l.structure)},e}(Oi);Oi.jsonID("replaceAround",lo);function xm(o,e,i){for(var a=o.resolve(e),l=i-e,u=a.depth;l>0&&u>0&&a.indexAfter(u)==a.node(u).childCount;)u--,l--;if(l>0)for(var f=a.node(u).maybeChild(a.indexAfter(u));l>0;){if(!f||f.isLeaf)return!0;f=f.firstChild,l--}return!1}function vP(o,e,i){return(e==0||o.canReplace(e,o.childCount))&&(i==o.childCount||o.canReplace(0,i))}function Yl(o){for(var e=o.parent,i=e.content.cutByIndex(o.startIndex,o.endIndex),a=o.depth;;--a){var l=o.$from.node(a),u=o.$from.index(a),f=o.$to.indexAfter(a);if(a<o.depth&&l.canReplace(u,f,i))return a;if(a==0||l.type.spec.isolating||!vP(l,u,f))break}}On.prototype.lift=function(o,e){for(var i=o.$from,a=o.$to,l=o.depth,u=i.before(l+1),f=a.after(l+1),g=u,_=f,I=Nt.empty,T=0,N=l,D=!1;N>e;N--)D||i.index(N)>0?(D=!0,I=Nt.from(i.node(N).copy(I)),T++):g--;for(var F=Nt.empty,K=0,J=l,nt=!1;J>e;J--)nt||a.after(J+1)<a.end(J)?(nt=!0,F=Nt.from(a.node(J).copy(F)),K++):_++;return this.step(new lo(g,_,u,f,new Ht(I.append(F),T,K),I.size-T,!0))};function Fm(o,e,i,a){a===void 0&&(a=o);var l=IP(o,e),u=l&&CP(a,e);return u?l.map(jR).concat({type:e,attrs:i}).concat(u.map(jR)):null}function jR(o){return{type:o,attrs:null}}function IP(o,e){var i=o.parent,a=o.startIndex,l=o.endIndex,u=i.contentMatchAt(a).findWrapping(e);if(!u)return null;var f=u.length?u[0]:e;return i.canReplaceWith(a,l,f)?u:null}function CP(o,e){var i=o.parent,a=o.startIndex,l=o.endIndex,u=i.child(a),f=e.contentMatch.findWrapping(u.type);if(!f)return null;for(var g=f.length?f[f.length-1]:e,_=g.contentMatch,I=a;_&&I<l;I++)_=_.matchType(i.child(I).type);return!_||!_.validEnd?null:f}On.prototype.wrap=function(o,e){for(var i=Nt.empty,a=e.length-1;a>=0;a--)i=Nt.from(e[a].type.create(e[a].attrs,i));var l=o.start,u=o.end;return this.step(new lo(l,u,l,u,new Ht(i,0,0),e.length,!0))};On.prototype.setBlockType=function(o,e,i,a){var l=this;if(e===void 0&&(e=o),!i.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");var u=this.steps.length;return this.doc.nodesBetween(o,e,function(f,g){if(f.isTextblock&&!f.hasMarkup(i,a)&&SP(l.doc,l.mapping.slice(u).map(g),i)){l.clearIncompatible(l.mapping.slice(u).map(g,1),i);var _=l.mapping.slice(u),I=_.map(g,1),T=_.map(g+f.nodeSize,1);return l.step(new lo(I,T,I+1,T-1,new Ht(Nt.from(i.create(a,null,f.marks)),0,0),1,!0)),!1}}),this};function SP(o,e,i){var a=o.resolve(e),l=a.index();return a.parent.canReplaceWith(l,l+1,i)}On.prototype.setNodeMarkup=function(o,e,i,a){var l=this.doc.nodeAt(o);if(!l)throw new RangeError("No node at given position");e||(e=l.type);var u=e.create(i,null,a||l.marks);if(l.isLeaf)return this.replaceWith(o,o+l.nodeSize,u);if(!e.validContent(l.content))throw new RangeError("Invalid content for node type "+e.name);return this.step(new lo(o,o+l.nodeSize,o+1,o+l.nodeSize-1,new Ht(Nt.from(u),0,0),1,!0))};function ya(o,e,i,a){i===void 0&&(i=1);var l=o.resolve(e),u=l.depth-i,f=a&&a[a.length-1]||l.parent;if(u<0||l.parent.type.spec.isolating||!l.parent.canReplace(l.index(),l.parent.childCount)||!f.type.validContent(l.parent.content.cutByIndex(l.index(),l.parent.childCount)))return!1;for(var g=l.depth-1,_=i-2;g>u;g--,_--){var I=l.node(g),T=l.index(g);if(I.type.spec.isolating)return!1;var N=I.content.cutByIndex(T,I.childCount),D=a&&a[_]||I;if(D!=I&&(N=N.replaceChild(0,D.type.create(D.attrs))),!I.canReplace(T+1,I.childCount)||!D.type.validContent(N))return!1}var F=l.indexAfter(u),K=a&&a[0];return l.node(u).canReplaceWith(F,F,K?K.type:l.node(u+1).type)}On.prototype.split=function(o,e,i){e===void 0&&(e=1);for(var a=this.doc.resolve(o),l=Nt.empty,u=Nt.empty,f=a.depth,g=a.depth-e,_=e-1;f>g;f--,_--){l=Nt.from(a.node(f).copy(l));var I=i&&i[_];u=Nt.from(I?I.type.create(I.attrs,u):a.node(f).copy(u))}return this.step(new Sa(o,o,new Ht(l.append(u),e,e),!0))};function yu(o,e){var i=o.resolve(e),a=i.index();return yP(i.nodeBefore,i.nodeAfter)&&i.parent.canReplace(a,a+1)}function yP(o,e){return o&&e&&!o.isLeaf&&o.canAppend(e)}On.prototype.join=function(o,e){e===void 0&&(e=1);var i=new Sa(o-e,o+e,Ht.empty,!0);return this.step(i)};function TP(o,e,i){var a=o.resolve(e);if(a.parent.canReplaceWith(a.index(),a.index(),i))return e;if(a.parentOffset==0)for(var l=a.depth-1;l>=0;l--){var u=a.index(l);if(a.node(l).canReplaceWith(u,u,i))return a.before(l+1);if(u>0)return null}if(a.parentOffset==a.parent.content.size)for(var f=a.depth-1;f>=0;f--){var g=a.indexAfter(f);if(a.node(f).canReplaceWith(g,g,i))return a.after(f+1);if(g<a.node(f).childCount)return null}}function WR(o,e,i){var a=o.resolve(e);if(!i.content.size)return e;for(var l=i.content,u=0;u<i.openStart;u++)l=l.firstChild.content;for(var f=1;f<=(i.openStart==0&&i.size?2:1);f++)for(var g=a.depth;g>=0;g--){var _=g==a.depth?0:a.pos<=(a.start(g+1)+a.end(g+1))/2?-1:1,I=a.index(g)+(_>0?1:0),T=a.node(g),N=!1;if(f==1)N=T.canReplace(I,I,l);else{var D=T.contentMatchAt(I).findWrapping(l.firstChild.type);N=D&&T.canReplaceWith(I,I,D[0])}if(N)return _==0?a.pos:_<0?a.before(g+1):a.after(g+1)}return null}function Qm(o,e,i){for(var a=[],l=0;l<o.childCount;l++){var u=o.child(l);u.content.size&&(u=u.copy(Qm(u.content,e,u))),u.isInline&&(u=e(u,i,l)),a.push(u)}return Nt.fromArray(a)}var Vm=function(o){function e(i,a,l){o.call(this),this.from=i,this.to=a,this.mark=l}return o&&(e.__proto__=o),e.prototype=Object.create(o&&o.prototype),e.prototype.constructor=e,e.prototype.apply=function(a){var l=this,u=a.slice(this.from,this.to),f=a.resolve(this.from),g=f.node(f.sharedDepth(this.to)),_=new Ht(Qm(u.content,function(I,T){return!I.isAtom||!T.type.allowsMarkType(l.mark.type)?I:I.mark(l.mark.addToSet(I.marks))},g),u.openStart,u.openEnd);return Wi.fromReplace(a,this.from,this.to,_)},e.prototype.invert=function(){return new Tu(this.from,this.to,this.mark)},e.prototype.map=function(a){var l=a.mapResult(this.from,1),u=a.mapResult(this.to,-1);return l.deleted&&u.deleted||l.pos>=u.pos?null:new e(l.pos,u.pos,this.mark)},e.prototype.merge=function(a){if(a instanceof e&&a.mark.eq(this.mark)&&this.from<=a.to&&this.to>=a.from)return new e(Math.min(this.from,a.from),Math.max(this.to,a.to),this.mark)},e.prototype.toJSON=function(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},e.fromJSON=function(a,l){if(typeof l.from!="number"||typeof l.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new e(l.from,l.to,a.markFromJSON(l.mark))},e}(Oi);Oi.jsonID("addMark",Vm);var Tu=function(o){function e(i,a,l){o.call(this),this.from=i,this.to=a,this.mark=l}return o&&(e.__proto__=o),e.prototype=Object.create(o&&o.prototype),e.prototype.constructor=e,e.prototype.apply=function(a){var l=this,u=a.slice(this.from,this.to),f=new Ht(Qm(u.content,function(g){return g.mark(l.mark.removeFromSet(g.marks))}),u.openStart,u.openEnd);return Wi.fromReplace(a,this.from,this.to,f)},e.prototype.invert=function(){return new Vm(this.from,this.to,this.mark)},e.prototype.map=function(a){var l=a.mapResult(this.from,1),u=a.mapResult(this.to,-1);return l.deleted&&u.deleted||l.pos>=u.pos?null:new e(l.pos,u.pos,this.mark)},e.prototype.merge=function(a){if(a instanceof e&&a.mark.eq(this.mark)&&this.from<=a.to&&this.to>=a.from)return new e(Math.min(this.from,a.from),Math.max(this.to,a.to),this.mark)},e.prototype.toJSON=function(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},e.fromJSON=function(a,l){if(typeof l.from!="number"||typeof l.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new e(l.from,l.to,a.markFromJSON(l.mark))},e}(Oi);Oi.jsonID("removeMark",Tu);On.prototype.addMark=function(o,e,i){var a=this,l=[],u=[],f=null,g=null;return this.doc.nodesBetween(o,e,function(_,I,T){if(!!_.isInline){var N=_.marks;if(!i.isInSet(N)&&T.type.allowsMarkType(i.type)){for(var D=Math.max(I,o),F=Math.min(I+_.nodeSize,e),K=i.addToSet(N),J=0;J<N.length;J++)N[J].isInSet(K)||(f&&f.to==D&&f.mark.eq(N[J])?f.to=F:l.push(f=new Tu(D,F,N[J])));g&&g.to==D?g.to=F:u.push(g=new Vm(D,F,i))}}}),l.forEach(function(_){return a.step(_)}),u.forEach(function(_){return a.step(_)}),this};On.prototype.removeMark=function(o,e,i){var a=this;i===void 0&&(i=null);var l=[],u=0;return this.doc.nodesBetween(o,e,function(f,g){if(!!f.isInline){u++;var _=null;if(i instanceof Ha)for(var I=f.marks,T;T=i.isInSet(I);)(_||(_=[])).push(T),I=T.removeFromSet(I);else i?i.isInSet(f.marks)&&(_=[i]):_=f.marks;if(_&&_.length)for(var N=Math.min(g+f.nodeSize,e),D=0;D<_.length;D++){for(var F=_[D],K=void 0,J=0;J<l.length;J++){var nt=l[J];nt.step==u-1&&F.eq(l[J].style)&&(K=nt)}K?(K.to=N,K.step=u):l.push({style:F,from:Math.max(g,o),to:N,step:u})}}}),l.forEach(function(f){return a.step(new Tu(f.from,f.to,f.style))}),this};On.prototype.clearIncompatible=function(o,e,i){i===void 0&&(i=e.contentMatch);for(var a=this.doc.nodeAt(o),l=[],u=o+1,f=0;f<a.childCount;f++){var g=a.child(f),_=u+g.nodeSize,I=i.matchType(g.type,g.attrs);if(!I)l.push(new Sa(u,_,Ht.empty));else{i=I;for(var T=0;T<g.marks.length;T++)e.allowsMarkType(g.marks[T].type)||this.step(new Tu(u,_,g.marks[T]))}u=_}if(!i.validEnd){var N=i.fillBefore(Nt.empty,!0);this.replace(u,u,new Ht(N,0,0))}for(var D=l.length-1;D>=0;D--)this.step(l[D]);return this};function Gm(o,e,i,a){if(i===void 0&&(i=e),a===void 0&&(a=Ht.empty),e==i&&!a.size)return null;var l=o.resolve(e),u=o.resolve(i);return KR(l,u,a)?new Sa(e,i,a):new qo(l,u,a).fit()}On.prototype.replace=function(o,e,i){e===void 0&&(e=o),i===void 0&&(i=Ht.empty);var a=Gm(this.doc,o,e,i);return a&&this.step(a),this};On.prototype.replaceWith=function(o,e,i){return this.replace(o,e,new Ht(Nt.from(i),0,0))};On.prototype.delete=function(o,e){return this.replace(o,e,Ht.empty)};On.prototype.insert=function(o,e){return this.replaceWith(o,o,e)};function KR(o,e,i){return!i.openStart&&!i.openEnd&&o.start()==e.start()&&o.parent.canReplace(o.index(),e.index(),i.content)}var qo=function(e,i,a){this.$to=i,this.$from=e,this.unplaced=a,this.frontier=[];for(var l=0;l<=e.depth;l++){var u=e.node(l);this.frontier.push({type:u.type,match:u.contentMatchAt(e.indexAfter(l))})}this.placed=Nt.empty;for(var f=e.depth;f>0;f--)this.placed=Nt.from(e.node(f).copy(this.placed))},HR={depth:{configurable:!0}};HR.depth.get=function(){return this.frontier.length-1};qo.prototype.fit=function(){for(;this.unplaced.size;){var e=this.findFittable();e?this.placeNodes(e):this.openMore()||this.dropNode()}var i=this.mustMoveInline(),a=this.placed.size-this.depth-this.$from.depth,l=this.$from,u=this.close(i<0?this.$to:l.doc.resolve(i));if(!u)return null;for(var f=this.placed,g=l.depth,_=u.depth;g&&_&&f.childCount==1;)f=f.firstChild.content,g--,_--;var I=new Ht(f,g,_);if(i>-1)return new lo(l.pos,i,this.$to.pos,this.$to.end(),I,a);if(I.size||l.pos!=this.$to.pos)return new Sa(l.pos,u.pos,I)};qo.prototype.findFittable=function(){for(var e=1;e<=2;e++)for(var i=this.unplaced.openStart;i>=0;i--){var a=void 0,l=void 0;i?(l=jm(this.unplaced.content,i-1).firstChild,a=l.content):a=this.unplaced.content;for(var u=a.firstChild,f=this.depth;f>=0;f--){var g=this.frontier[f],_=g.type,I=g.match,T=void 0,N=void 0;if(e==1&&(u?I.matchType(u.type)||(N=I.fillBefore(Nt.from(u),!1)):_.compatibleContent(l.type)))return{sliceDepth:i,frontierDepth:f,parent:l,inject:N};if(e==2&&u&&(T=I.findWrapping(u.type)))return{sliceDepth:i,frontierDepth:f,parent:l,wrap:T};if(l&&I.matchType(l.type))break}}};qo.prototype.openMore=function(){var e=this.unplaced,i=e.content,a=e.openStart,l=e.openEnd,u=jm(i,a);return!u.childCount||u.firstChild.isLeaf?!1:(this.unplaced=new Ht(i,a+1,Math.max(l,u.size+a>=i.size-l?a+1:0)),!0)};qo.prototype.dropNode=function(){var e=this.unplaced,i=e.content,a=e.openStart,l=e.openEnd,u=jm(i,a);if(u.childCount<=1&&a>0){var f=i.size-a<=a+u.size;this.unplaced=new Ht(Ru(i,a-1,1),a-1,f?a-1:l)}else this.unplaced=new Ht(Ru(i,a,1),a,l)};qo.prototype.placeNodes=function(e){for(var i=e.sliceDepth,a=e.frontierDepth,l=e.parent,u=e.inject,f=e.wrap;this.depth>a;)this.closeFrontierNode();if(f)for(var g=0;g<f.length;g++)this.openFrontierNode(f[g]);var _=this.unplaced,I=l?l.content:_.content,T=_.openStart-i,N=0,D=[],F=this.frontier[a],K=F.match,J=F.type;if(u){for(var nt=0;nt<u.childCount;nt++)D.push(u.child(nt));K=K.matchFragment(u)}for(var it=I.size+i-(_.content.size-_.openEnd);N<I.childCount;){var z=I.child(N),Ot=K.matchType(z.type);if(!Ot)break;N++,(N>1||T==0||z.content.size)&&(K=Ot,D.push(YR(z.mark(J.allowedMarks(z.marks)),N==1?T:0,N==I.childCount?it:-1)))}var X=N==I.childCount;X||(it=-1),this.placed=wu(this.placed,a,Nt.from(D)),this.frontier[a].match=K,X&&it<0&&l&&l.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(var yt=0,Mt=I;yt<it;yt++){var $t=Mt.lastChild;this.frontier.push({type:$t.type,match:$t.contentMatchAt($t.childCount)}),Mt=$t.content}this.unplaced=X?i==0?Ht.empty:new Ht(Ru(_.content,i-1,1),i-1,it<0?_.openEnd:i-1):new Ht(Ru(_.content,i,N),_.openStart,_.openEnd)};qo.prototype.mustMoveInline=function(){if(!this.$to.parent.isTextblock||this.$to.end()==this.$to.pos)return-1;var e=this.frontier[this.depth],i;if(!e.type.isTextblock||!Wm(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(i=this.findCloseLevel(this.$to))&&i.depth==this.depth)return-1;for(var a=this.$to,l=a.depth,u=this.$to.after(l);l>1&&u==this.$to.end(--l);)++u;return u};qo.prototype.findCloseLevel=function(e){t:for(var i=Math.min(this.depth,e.depth);i>=0;i--){var a=this.frontier[i],l=a.match,u=a.type,f=i<e.depth&&e.end(i+1)==e.pos+(e.depth-(i+1)),g=Wm(e,i,u,l,f);if(!!g){for(var _=i-1;_>=0;_--){var I=this.frontier[_],T=I.match,N=I.type,D=Wm(e,_,N,T,!0);if(!D||D.childCount)continue t}return{depth:i,fit:g,move:f?e.doc.resolve(e.after(i+1)):e}}}};qo.prototype.close=function(e){var i=this.findCloseLevel(e);if(!i)return null;for(;this.depth>i.depth;)this.closeFrontierNode();i.fit.childCount&&(this.placed=wu(this.placed,i.depth,i.fit)),e=i.move;for(var a=i.depth+1;a<=e.depth;a++){var l=e.node(a),u=l.type.contentMatch.fillBefore(l.content,!0,e.index(a));this.openFrontierNode(l.type,l.attrs,u)}return e};qo.prototype.openFrontierNode=function(e,i,a){var l=this.frontier[this.depth];l.match=l.match.matchType(e),this.placed=wu(this.placed,this.depth,Nt.from(e.create(i,a))),this.frontier.push({type:e,match:e.contentMatch})};qo.prototype.closeFrontierNode=function(){var e=this.frontier.pop(),i=e.match.fillBefore(Nt.empty,!0);i.childCount&&(this.placed=wu(this.placed,this.frontier.length,i))};Object.defineProperties(qo.prototype,HR);function Ru(o,e,i){return e==0?o.cutByIndex(i):o.replaceChild(0,o.firstChild.copy(Ru(o.firstChild.content,e-1,i)))}function wu(o,e,i){return e==0?o.append(i):o.replaceChild(o.childCount-1,o.lastChild.copy(wu(o.lastChild.content,e-1,i)))}function jm(o,e){for(var i=0;i<e;i++)o=o.firstChild.content;return o}function YR(o,e,i){if(e<=0)return o;var a=o.content;return e>1&&(a=a.replaceChild(0,YR(a.firstChild,e-1,a.childCount==1?i-1:0))),e>0&&(a=o.type.contentMatch.fillBefore(a).append(a),i<=0&&(a=a.append(o.type.contentMatch.matchFragment(a).fillBefore(Nt.empty,!0)))),o.copy(a)}function Wm(o,e,i,a,l){var u=o.node(e),f=l?o.indexAfter(e):o.index(e);if(f==u.childCount&&!i.compatibleContent(u.type))return null;var g=a.fillBefore(u.content,!0,f);return g&&!RP(i,u.content,f)?g:null}function RP(o,e,i){for(var a=i;a<e.childCount;a++)if(!o.allowsMarks(e.child(a).marks))return!0;return!1}On.prototype.replaceRange=function(o,e,i){if(!i.size)return this.deleteRange(o,e);var a=this.doc.resolve(o),l=this.doc.resolve(e);if(KR(a,l,i))return this.step(new Sa(o,e,i));var u=JR(a,this.doc.resolve(e));u[u.length-1]==0&&u.pop();var f=-(a.depth+1);u.unshift(f);for(var g=a.depth,_=a.pos-1;g>0;g--,_--){var I=a.node(g).type.spec;if(I.defining||I.isolating)break;u.indexOf(g)>-1?f=g:a.before(g)==_&&u.splice(1,0,-g)}for(var T=u.indexOf(f),N=[],D=i.openStart,F=i.content,K=0;;K++){var J=F.firstChild;if(N.push(J),K==i.openStart)break;F=J.content}D>0&&N[D-1].type.spec.defining&&a.node(T).type!=N[D-1].type?D-=1:D>=2&&N[D-1].isTextblock&&N[D-2].type.spec.defining&&a.node(T).type!=N[D-2].type&&(D-=2);for(var nt=i.openStart;nt>=0;nt--){var it=(nt+D+1)%(i.openStart+1),z=N[it];if(!!z)for(var Ot=0;Ot<u.length;Ot++){var X=u[(Ot+T)%u.length],yt=!0;X<0&&(yt=!1,X=-X);var Mt=a.node(X-1),$t=a.index(X-1);if(Mt.canReplaceWith($t,$t,z.type,z.marks))return this.replace(a.before(X),yt?l.after(X):e,new Ht(qR(i.content,0,i.openStart,it),it,i.openEnd))}}for(var ge=this.steps.length,Te=u.length-1;Te>=0&&(this.replace(o,e,i),!(this.steps.length>ge));Te--){var Se=u[Te];Se<0||(o=a.before(Se),e=l.after(Se))}return this};function qR(o,e,i,a,l){if(e<i){var u=o.firstChild;o=o.replaceChild(0,u.copy(qR(u.content,e+1,i,a,u)))}if(e>a){var f=l.contentMatchAt(0),g=f.fillBefore(o).append(o);o=g.append(f.matchFragment(g).fillBefore(Nt.empty,!0))}return o}On.prototype.replaceRangeWith=function(o,e,i){if(!i.isInline&&o==e&&this.doc.resolve(o).parent.content.size){var a=TP(this.doc,o,i.type);a!=null&&(o=e=a)}return this.replaceRange(o,e,new Ht(Nt.from(i),0,0))};On.prototype.deleteRange=function(o,e){for(var i=this.doc.resolve(o),a=this.doc.resolve(e),l=JR(i,a),u=0;u<l.length;u++){var f=l[u],g=u==l.length-1;if(g&&f==0||i.node(f).type.contentMatch.validEnd)return this.delete(i.start(f),a.end(f));if(f>0&&(g||i.node(f-1).canReplace(i.index(f-1),a.indexAfter(f-1))))return this.delete(i.before(f),a.after(f))}for(var _=1;_<=i.depth&&_<=a.depth;_++)if(o-i.start(_)==i.depth-_&&e>i.end(_)&&a.end(_)-e!=a.depth-_)return this.delete(i.before(_),e);return this.delete(o,e)};function JR(o,e){for(var i=[],a=Math.min(o.depth,e.depth),l=a;l>=0;l--){var u=o.start(l);if(u<o.pos-(o.depth-l)||e.end(l)>e.pos+(e.depth-l)||o.node(l).type.spec.isolating||e.node(l).type.spec.isolating)break;(u==e.start(l)||l==o.depth&&l==e.depth&&o.parent.inlineContent&&e.parent.inlineContent&&l&&e.start(l-1)==u-1)&&i.push(l)}return i}var Km=Object.create(null),Ce=function(e,i,a){this.ranges=a||[new wP(e.min(i),e.max(i))],this.$anchor=e,this.$head=i},Ya={anchor:{configurable:!0},head:{configurable:!0},from:{configurable:!0},to:{configurable:!0},$from:{configurable:!0},$to:{configurable:!0},empty:{configurable:!0}};Ya.anchor.get=function(){return this.$anchor.pos};Ya.head.get=function(){return this.$head.pos};Ya.from.get=function(){return this.$from.pos};Ya.to.get=function(){return this.$to.pos};Ya.$from.get=function(){return this.ranges[0].$from};Ya.$to.get=function(){return this.ranges[0].$to};Ya.empty.get=function(){for(var o=this.ranges,e=0;e<o.length;e++)if(o[e].$from.pos!=o[e].$to.pos)return!1;return!0};Ce.prototype.content=function(){return this.$from.node(0).slice(this.from,this.to,!0)};Ce.prototype.replace=function(e,i){i===void 0&&(i=Ht.empty);for(var a=i.content.lastChild,l=null,u=0;u<i.openEnd;u++)l=a,a=a.lastChild;for(var f=e.steps.length,g=this.ranges,_=0;_<g.length;_++){var I=g[_],T=I.$from,N=I.$to,D=e.mapping.slice(f);e.replaceRange(D.map(T.pos),D.map(N.pos),_?Ht.empty:i),_==0&&zR(e,f,(a?a.isInline:l&&l.isTextblock)?-1:1)}};Ce.prototype.replaceWith=function(e,i){for(var a=e.steps.length,l=this.ranges,u=0;u<l.length;u++){var f=l[u],g=f.$from,_=f.$to,I=e.mapping.slice(a),T=I.map(g.pos),N=I.map(_.pos);u?e.deleteRange(T,N):(e.replaceRangeWith(T,N,i),zR(e,a,i.isInline?-1:1))}};Ce.findFrom=function(e,i,a){var l=e.parent.inlineContent?new cr(e):ql(e.node(0),e.parent,e.pos,e.index(),i,a);if(l)return l;for(var u=e.depth-1;u>=0;u--){var f=i<0?ql(e.node(0),e.node(u),e.before(u+1),e.index(u),i,a):ql(e.node(0),e.node(u),e.after(u+1),e.index(u)+1,i,a);if(f)return f}};Ce.near=function(e,i){return i===void 0&&(i=1),this.findFrom(e,i)||this.findFrom(e,-i)||new Ta(e.node(0))};Ce.atStart=function(e){return ql(e,e,0,0,1)||new Ta(e)};Ce.atEnd=function(e){return ql(e,e,e.content.size,e.childCount,-1)||new Ta(e)};Ce.fromJSON=function(e,i){if(!i||!i.type)throw new RangeError("Invalid input for Selection.fromJSON");var a=Km[i.type];if(!a)throw new RangeError("No selection type "+i.type+" defined");return a.fromJSON(e,i)};Ce.jsonID=function(e,i){if(e in Km)throw new RangeError("Duplicate use of selection JSON ID "+e);return Km[e]=i,i.prototype.jsonID=e,i};Ce.prototype.getBookmark=function(){return cr.between(this.$anchor,this.$head).getBookmark()};Object.defineProperties(Ce.prototype,Ya);Ce.prototype.visible=!0;var wP=function(e,i){this.$from=e,this.$to=i},cr=function(o){function e(a,l){l===void 0&&(l=a),o.call(this,a,l)}o&&(e.__proto__=o),e.prototype=Object.create(o&&o.prototype),e.prototype.constructor=e;var i={$cursor:{configurable:!0}};return i.$cursor.get=function(){return this.$anchor.pos==this.$head.pos?this.$head:null},e.prototype.map=function(l,u){var f=l.resolve(u.map(this.head));if(!f.parent.inlineContent)return o.near(f);var g=l.resolve(u.map(this.anchor));return new e(g.parent.inlineContent?g:f,f)},e.prototype.replace=function(l,u){if(u===void 0&&(u=Ht.empty),o.prototype.replace.call(this,l,u),u==Ht.empty){var f=this.$from.marksAcross(this.$to);f&&l.ensureMarks(f)}},e.prototype.eq=function(l){return l instanceof e&&l.anchor==this.anchor&&l.head==this.head},e.prototype.getBookmark=function(){return new bu(this.anchor,this.head)},e.prototype.toJSON=function(){return{type:"text",anchor:this.anchor,head:this.head}},e.fromJSON=function(l,u){if(typeof u.anchor!="number"||typeof u.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new e(l.resolve(u.anchor),l.resolve(u.head))},e.create=function(l,u,f){f===void 0&&(f=u);var g=l.resolve(u);return new this(g,f==u?g:l.resolve(f))},e.between=function(l,u,f){var g=l.pos-u.pos;if((!f||g)&&(f=g>=0?1:-1),!u.parent.inlineContent){var _=o.findFrom(u,f,!0)||o.findFrom(u,-f,!0);if(_)u=_.$head;else return o.near(u,f)}return l.parent.inlineContent||(g==0?l=u:(l=(o.findFrom(l,-f,!0)||o.findFrom(l,f,!0)).$anchor,l.pos<u.pos!=g<0&&(l=u))),new e(l,u)},Object.defineProperties(e.prototype,i),e}(Ce);Ce.jsonID("text",cr);var bu=function(e,i){this.anchor=e,this.head=i};bu.prototype.map=function(e){return new bu(e.map(this.anchor),e.map(this.head))};bu.prototype.resolve=function(e){return cr.between(e.resolve(this.anchor),e.resolve(this.head))};var ke=function(o){function e(i){var a=i.nodeAfter,l=i.node(0).resolve(i.pos+a.nodeSize);o.call(this,i,l),this.node=a}return o&&(e.__proto__=o),e.prototype=Object.create(o&&o.prototype),e.prototype.constructor=e,e.prototype.map=function(a,l){var u=l.mapResult(this.anchor),f=u.deleted,g=u.pos,_=a.resolve(g);return f?o.near(_):new e(_)},e.prototype.content=function(){return new Ht(Nt.from(this.node),0,0)},e.prototype.eq=function(a){return a instanceof e&&a.anchor==this.anchor},e.prototype.toJSON=function(){return{type:"node",anchor:this.anchor}},e.prototype.getBookmark=function(){return new Yp(this.anchor)},e.fromJSON=function(a,l){if(typeof l.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new e(a.resolve(l.anchor))},e.create=function(a,l){return new this(a.resolve(l))},e.isSelectable=function(a){return!a.isText&&a.type.spec.selectable!==!1},e}(Ce);ke.prototype.visible=!1;Ce.jsonID("node",ke);var Yp=function(e){this.anchor=e};Yp.prototype.map=function(e){var i=e.mapResult(this.anchor),a=i.deleted,l=i.pos;return a?new bu(l,l):new Yp(l)};Yp.prototype.resolve=function(e){var i=e.resolve(this.anchor),a=i.nodeAfter;return a&&ke.isSelectable(a)?new ke(i):Ce.near(i)};var Ta=function(o){function e(i){o.call(this,i.resolve(0),i.resolve(i.content.size))}return o&&(e.__proto__=o),e.prototype=Object.create(o&&o.prototype),e.prototype.constructor=e,e.prototype.replace=function(a,l){if(l===void 0&&(l=Ht.empty),l==Ht.empty){a.delete(0,a.doc.content.size);var u=o.atStart(a.doc);u.eq(a.selection)||a.setSelection(u)}else o.prototype.replace.call(this,a,l)},e.prototype.toJSON=function(){return{type:"all"}},e.fromJSON=function(a){return new e(a)},e.prototype.map=function(a){return new e(a)},e.prototype.eq=function(a){return a instanceof e},e.prototype.getBookmark=function(){return bP},e}(Ce);Ce.jsonID("all",Ta);var bP={map:function(){return this},resolve:function(e){return new Ta(e)}};function ql(o,e,i,a,l,u){if(e.inlineContent)return cr.create(o,i);for(var f=a-(l>0?0:1);l>0?f<e.childCount:f>=0;f+=l){var g=e.child(f);if(g.isAtom){if(!u&&ke.isSelectable(g))return ke.create(o,i-(l<0?g.nodeSize:0))}else{var _=ql(o,g,i+l,l<0?g.childCount:0,l,u);if(_)return _}i+=g.nodeSize*l}}function zR(o,e,i){var a=o.steps.length-1;if(!(a<e)){var l=o.steps[a];if(l instanceof Sa||l instanceof lo){var u=o.mapping.maps[a],f;u.forEach(function(g,_,I,T){f==null&&(f=T)}),o.setSelection(Ce.near(o.doc.resolve(f),i))}}}var XR=1,qp=2,ZR=4,NP=function(o){function e(a){o.call(this,a.doc),this.time=Date.now(),this.curSelection=a.selection,this.curSelectionFor=0,this.storedMarks=a.storedMarks,this.updated=0,this.meta=Object.create(null)}o&&(e.__proto__=o),e.prototype=Object.create(o&&o.prototype),e.prototype.constructor=e;var i={selection:{configurable:!0},selectionSet:{configurable:!0},storedMarksSet:{configurable:!0},isGeneric:{configurable:!0},scrolledIntoView:{configurable:!0}};return i.selection.get=function(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection},e.prototype.setSelection=function(l){if(l.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=l,this.curSelectionFor=this.steps.length,this.updated=(this.updated|XR)&~qp,this.storedMarks=null,this},i.selectionSet.get=function(){return(this.updated&XR)>0},e.prototype.setStoredMarks=function(l){return this.storedMarks=l,this.updated|=qp,this},e.prototype.ensureMarks=function(l){return or.sameSet(this.storedMarks||this.selection.$from.marks(),l)||this.setStoredMarks(l),this},e.prototype.addStoredMark=function(l){return this.ensureMarks(l.addToSet(this.storedMarks||this.selection.$head.marks()))},e.prototype.removeStoredMark=function(l){return this.ensureMarks(l.removeFromSet(this.storedMarks||this.selection.$head.marks()))},i.storedMarksSet.get=function(){return(this.updated&qp)>0},e.prototype.addStep=function(l,u){o.prototype.addStep.call(this,l,u),this.updated=this.updated&~qp,this.storedMarks=null},e.prototype.setTime=function(l){return this.time=l,this},e.prototype.replaceSelection=function(l){return this.selection.replace(this,l),this},e.prototype.replaceSelectionWith=function(l,u){var f=this.selection;return u!==!1&&(l=l.mark(this.storedMarks||(f.empty?f.$from.marks():f.$from.marksAcross(f.$to)||or.none))),f.replaceWith(this,l),this},e.prototype.deleteSelection=function(){return this.selection.replace(this),this},e.prototype.insertText=function(l,u,f){f===void 0&&(f=u);var g=this.doc.type.schema;if(u==null)return l?this.replaceSelectionWith(g.text(l),!0):this.deleteSelection();if(!l)return this.deleteRange(u,f);var _=this.storedMarks;if(!_){var I=this.doc.resolve(u);_=f==u?I.marks():I.marksAcross(this.doc.resolve(f))}return this.replaceRangeWith(u,f,g.text(l,_)),this.selection.empty||this.setSelection(Ce.near(this.selection.$to)),this},e.prototype.setMeta=function(l,u){return this.meta[typeof l=="string"?l:l.key]=u,this},e.prototype.getMeta=function(l){return this.meta[typeof l=="string"?l:l.key]},i.isGeneric.get=function(){for(var a in this.meta)return!1;return!0},e.prototype.scrollIntoView=function(){return this.updated|=ZR,this},i.scrolledIntoView.get=function(){return(this.updated&ZR)>0},Object.defineProperties(e.prototype,i),e}(On);function $R(o,e){return!e||!o?o:o.bind(e)}var Nu=function(e,i,a){this.name=e,this.init=$R(i.init,a),this.apply=$R(i.apply,a)},OP=[new Nu("doc",{init:function(e){return e.doc||e.schema.topNodeType.createAndFill()},apply:function(e){return e.doc}}),new Nu("selection",{init:function(e,i){return e.selection||Ce.atStart(i.doc)},apply:function(e){return e.selection}}),new Nu("storedMarks",{init:function(e){return e.storedMarks||null},apply:function(e,i,a,l){return l.selection.$cursor?e.storedMarks:null}}),new Nu("scrollToSelection",{init:function(){return 0},apply:function(e,i){return e.scrolledIntoView?i+1:i}})],Hm=function(e,i){var a=this;this.schema=e,this.fields=OP.concat(),this.plugins=[],this.pluginsByKey=Object.create(null),i&&i.forEach(function(l){if(a.pluginsByKey[l.key])throw new RangeError("Adding different instances of a keyed plugin ("+l.key+")");a.plugins.push(l),a.pluginsByKey[l.key]=l,l.spec.state&&a.fields.push(new Nu(l.key,l.spec.state,l))})},ki=function(e){this.config=e},Jp={schema:{configurable:!0},plugins:{configurable:!0},tr:{configurable:!0}};Jp.schema.get=function(){return this.config.schema};Jp.plugins.get=function(){return this.config.plugins};ki.prototype.apply=function(e){return this.applyTransaction(e).state};ki.prototype.filterTransaction=function(e,i){i===void 0&&(i=-1);for(var a=0;a<this.config.plugins.length;a++)if(a!=i){var l=this.config.plugins[a];if(l.spec.filterTransaction&&!l.spec.filterTransaction.call(l,e,this))return!1}return!0};ki.prototype.applyTransaction=function(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};for(var i=[e],a=this.applyInner(e),l=null;;){for(var u=!1,f=0;f<this.config.plugins.length;f++){var g=this.config.plugins[f];if(g.spec.appendTransaction){var _=l?l[f].n:0,I=l?l[f].state:this,T=_<i.length&&g.spec.appendTransaction.call(g,_?i.slice(_):i,I,a);if(T&&a.filterTransaction(T,f)){if(T.setMeta("appendedTransaction",e),!l){l=[];for(var N=0;N<this.config.plugins.length;N++)l.push(N<f?{state:a,n:i.length}:{state:this,n:0})}i.push(T),a=a.applyInner(T),u=!0}l&&(l[f]={state:a,n:i.length})}}if(!u)return{state:a,transactions:i}}};ki.prototype.applyInner=function(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");for(var i=new ki(this.config),a=this.config.fields,l=0;l<a.length;l++){var u=a[l];i[u.name]=u.apply(e,this[u.name],this,i)}for(var f=0;f<Ou.length;f++)Ou[f](this,e,i);return i};Jp.tr.get=function(){return new NP(this)};ki.create=function(e){for(var i=new Hm(e.doc?e.doc.type.schema:e.schema,e.plugins),a=new ki(i),l=0;l<i.fields.length;l++)a[i.fields[l].name]=i.fields[l].init(e,a);return a};ki.prototype.reconfigure=function(e){for(var i=new Hm(this.schema,e.plugins),a=i.fields,l=new ki(i),u=0;u<a.length;u++){var f=a[u].name;l[f]=this.hasOwnProperty(f)?this[f]:a[u].init(e,l)}return l};ki.prototype.toJSON=function(e){var i={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(i.storedMarks=this.storedMarks.map(function(f){return f.toJSON()})),e&&typeof e=="object")for(var a in e){if(a=="doc"||a=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");var l=e[a],u=l.spec.state;u&&u.toJSON&&(i[a]=u.toJSON.call(l,this[l.key]))}return i};ki.fromJSON=function(e,i,a){if(!i)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");var l=new Hm(e.schema,e.plugins),u=new ki(l);return l.fields.forEach(function(f){if(f.name=="doc")u.doc=ar.fromJSON(e.schema,i.doc);else if(f.name=="selection")u.selection=Ce.fromJSON(u.doc,i.selection);else if(f.name=="storedMarks")i.storedMarks&&(u.storedMarks=i.storedMarks.map(e.schema.markFromJSON));else{if(a)for(var g in a){var _=a[g],I=_.spec.state;if(_.key==f.name&&I&&I.fromJSON&&Object.prototype.hasOwnProperty.call(i,g)){u[f.name]=I.fromJSON.call(_,e,i[g],u);return}}u[f.name]=f.init(e,u)}}),u};ki.addApplyListener=function(e){Ou.push(e)};ki.removeApplyListener=function(e){var i=Ou.indexOf(e);i>-1&&Ou.splice(i,1)};Object.defineProperties(ki.prototype,Jp);var Ou=[];function t0(o,e,i){for(var a in o){var l=o[a];l instanceof Function?l=l.bind(e):a=="handleDOMEvents"&&(l=t0(l,e,{})),i[a]=l}return i}var ni=function(e){this.props={},e.props&&t0(e.props,this,this.props),this.spec=e,this.key=e.key?e.key.key:e0("plugin")};ni.prototype.getState=function(e){return e[this.key]};var Ym=Object.create(null);function e0(o){return o in Ym?o+"$"+ ++Ym[o]:(Ym[o]=0,o+"$")}var Ki=function(e){e===void 0&&(e="key"),this.key=e0(e)};Ki.prototype.get=function(e){return e.config.pluginsByKey[this.key]};Ki.prototype.getState=function(e){return e[this.key]};function qm(o,e){return o.selection.empty?!1:(e&&e(o.tr.deleteSelection().scrollIntoView()),!0)}function r0(o,e,i){var a=o.selection,l=a.$cursor;if(!l||(i?!i.endOfTextblock("backward",o):l.parentOffset>0))return!1;var u=i0(l);if(!u){var f=l.blockRange(),g=f&&Yl(f);return g==null?!1:(e&&e(o.tr.lift(f,g).scrollIntoView()),!0)}var _=u.nodeBefore;if(!_.type.spec.isolating&&h0(o,u,e))return!0;if(l.parent.content.size==0&&(Jl(_,"end")||ke.isSelectable(_))){var I=Gm(o.doc,l.before(),l.after(),Ht.empty);if(I.slice.size<I.to-I.from){if(e){var T=o.tr.step(I);T.setSelection(Jl(_,"end")?Ce.findFrom(T.doc.resolve(T.mapping.map(u.pos,-1)),-1):ke.create(T.doc,u.pos-_.nodeSize)),e(T.scrollIntoView())}return!0}}return _.isAtom&&u.depth==l.depth-1?(e&&e(o.tr.delete(u.pos-_.nodeSize,u.pos).scrollIntoView()),!0):!1}function Jl(o,e,i){for(;o;o=e=="start"?o.firstChild:o.lastChild){if(o.isTextblock)return!0;if(i&&o.childCount!=1)return!1}return!1}function n0(o,e,i){var a=o.selection,l=a.$head,u=a.empty,f=l;if(!u)return!1;if(l.parent.isTextblock){if(i?!i.endOfTextblock("backward",o):l.parentOffset>0)return!1;f=i0(l)}var g=f&&f.nodeBefore;return!g||!ke.isSelectable(g)?!1:(e&&e(o.tr.setSelection(ke.create(o.doc,f.pos-g.nodeSize)).scrollIntoView()),!0)}function i0(o){if(!o.parent.type.spec.isolating)for(var e=o.depth-1;e>=0;e--){if(o.index(e)>0)return o.doc.resolve(o.before(e+1));if(o.node(e).type.spec.isolating)break}return null}function o0(o,e,i){var a=o.selection,l=a.$cursor;if(!l||(i?!i.endOfTextblock("forward",o):l.parentOffset<l.parent.content.size))return!1;var u=a0(l);if(!u)return!1;var f=u.nodeAfter;if(h0(o,u,e))return!0;if(l.parent.content.size==0&&(Jl(f,"start")||ke.isSelectable(f))){var g=Gm(o.doc,l.before(),l.after(),Ht.empty);if(g.slice.size<g.to-g.from){if(e){var _=o.tr.step(g);_.setSelection(Jl(f,"start")?Ce.findFrom(_.doc.resolve(_.mapping.map(u.pos)),1):ke.create(_.doc,_.mapping.map(u.pos))),e(_.scrollIntoView())}return!0}}return f.isAtom&&u.depth==l.depth-1?(e&&e(o.tr.delete(u.pos,u.pos+f.nodeSize).scrollIntoView()),!0):!1}function s0(o,e,i){var a=o.selection,l=a.$head,u=a.empty,f=l;if(!u)return!1;if(l.parent.isTextblock){if(i?!i.endOfTextblock("forward",o):l.parentOffset<l.parent.content.size)return!1;f=a0(l)}var g=f&&f.nodeAfter;return!g||!ke.isSelectable(g)?!1:(e&&e(o.tr.setSelection(ke.create(o.doc,f.pos)).scrollIntoView()),!0)}function a0(o){if(!o.parent.type.spec.isolating)for(var e=o.depth-1;e>=0;e--){var i=o.node(e);if(o.index(e)+1<i.childCount)return o.doc.resolve(o.after(e+1));if(i.type.spec.isolating)break}return null}function kP(o,e){var i=o.selection,a=i.$from,l=i.$to,u=a.blockRange(l),f=u&&Yl(u);return f==null?!1:(e&&e(o.tr.lift(u,f).scrollIntoView()),!0)}function c0(o,e){var i=o.selection,a=i.$head,l=i.$anchor;return!a.parent.type.spec.code||!a.sameParent(l)?!1:(e&&e(o.tr.insertText(`
`).scrollIntoView()),!0)}function Jm(o){for(var e=0;e<o.edgeCount;e++){var i=o.edge(e),a=i.type;if(a.isTextblock&&!a.hasRequiredAttrs())return a}return null}function l0(o,e){var i=o.selection,a=i.$head,l=i.$anchor;if(!a.parent.type.spec.code||!a.sameParent(l))return!1;var u=a.node(-1),f=a.indexAfter(-1),g=Jm(u.contentMatchAt(f));if(!u.canReplaceWith(f,f,g))return!1;if(e){var _=a.after(),I=o.tr.replaceWith(_,_,g.createAndFill());I.setSelection(Ce.near(I.doc.resolve(_),1)),e(I.scrollIntoView())}return!0}function d0(o,e){var i=o.selection,a=i.$from,l=i.$to;if(i instanceof Ta||a.parent.inlineContent||l.parent.inlineContent)return!1;var u=Jm(l.parent.contentMatchAt(l.indexAfter()));if(!u||!u.isTextblock)return!1;if(e){var f=(!a.parentOffset&&l.index()<l.parent.childCount?a:l).pos,g=o.tr.insert(f,u.createAndFill());g.setSelection(cr.create(g.doc,f+1)),e(g.scrollIntoView())}return!0}function u0(o,e){var i=o.selection,a=i.$cursor;if(!a||a.parent.content.size)return!1;if(a.depth>1&&a.after()!=a.end(-1)){var l=a.before();if(ya(o.doc,l))return e&&e(o.tr.split(l).scrollIntoView()),!0}var u=a.blockRange(),f=u&&Yl(u);return f==null?!1:(e&&e(o.tr.lift(u,f).scrollIntoView()),!0)}function DP(o,e){var i=o.selection,a=i.$from,l=i.$to;if(o.selection instanceof ke&&o.selection.node.isBlock)return!a.parentOffset||!ya(o.doc,a.pos)?!1:(e&&e(o.tr.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;if(e){var u=l.parentOffset==l.parent.content.size,f=o.tr;(o.selection instanceof cr||o.selection instanceof Ta)&&f.deleteSelection();var g=a.depth==0?null:Jm(a.node(-1).contentMatchAt(a.indexAfter(-1))),_=u&&g?[{type:g}]:null,I=ya(f.doc,f.mapping.map(a.pos),1,_);if(!_&&!I&&ya(f.doc,f.mapping.map(a.pos),1,g&&[{type:g}])&&(_=[{type:g}],I=!0),I&&(f.split(f.mapping.map(a.pos),1,_),!u&&!a.parentOffset&&a.parent.type!=g)){var T=f.mapping.map(a.before()),N=f.doc.resolve(T);a.node(-1).canReplaceWith(N.index(),N.index()+1,g)&&f.setNodeMarkup(f.mapping.map(a.before()),g)}e(f.scrollIntoView())}return!0}function LP(o,e){var i=o.selection,a=i.$from,l=i.to,u,f=a.sharedDepth(l);return f==0?!1:(u=a.before(f),e&&e(o.tr.setSelection(ke.create(o.doc,u))),!0)}function MP(o,e){return e&&e(o.tr.setSelection(new Ta(o.doc))),!0}function PP(o,e,i){var a=e.nodeBefore,l=e.nodeAfter,u=e.index();return!a||!l||!a.type.compatibleContent(l.type)?!1:!a.content.size&&e.parent.canReplace(u-1,u)?(i&&i(o.tr.delete(e.pos-a.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(u,u+1)||!(l.isTextblock||yu(o.doc,e.pos))?!1:(i&&i(o.tr.clearIncompatible(e.pos,a.type,a.contentMatchAt(a.childCount)).join(e.pos).scrollIntoView()),!0)}function h0(o,e,i){var a=e.nodeBefore,l=e.nodeAfter,u,f;if(a.type.spec.isolating||l.type.spec.isolating)return!1;if(PP(o,e,i))return!0;var g=e.parent.canReplace(e.index(),e.index()+1);if(g&&(u=(f=a.contentMatchAt(a.childCount)).findWrapping(l.type))&&f.matchType(u[0]||l.type).validEnd){if(i){for(var _=e.pos+l.nodeSize,I=Nt.empty,T=u.length-1;T>=0;T--)I=Nt.from(u[T].create(null,I));I=Nt.from(a.copy(I));var N=o.tr.step(new lo(e.pos-1,_,e.pos,_,new Ht(I,1,0),u.length,!0)),D=_+2*u.length;yu(N.doc,D)&&N.join(D),i(N.scrollIntoView())}return!0}var F=Ce.findFrom(e,1),K=F&&F.$from.blockRange(F.$to),J=K&&Yl(K);if(J!=null&&J>=e.depth)return i&&i(o.tr.lift(K,J).scrollIntoView()),!0;if(g&&Jl(l,"start",!0)&&Jl(a,"end")){for(var nt=a,it=[];it.push(nt),!nt.isTextblock;)nt=nt.lastChild;for(var z=l,Ot=1;!z.isTextblock;z=z.firstChild)Ot++;if(nt.canReplace(nt.childCount,nt.childCount,z.content)){if(i){for(var X=Nt.empty,yt=it.length-1;yt>=0;yt--)X=Nt.from(it[yt].copy(X));var Mt=o.tr.step(new lo(e.pos-it.length,e.pos+l.nodeSize,e.pos+Ot,e.pos+l.nodeSize-Ot,new Ht(X,it.length,0),0,!0));i(Mt.scrollIntoView())}return!0}}return!1}function p0(o){return function(e,i){for(var a=e.selection,l=o<0?a.$from:a.$to,u=l.depth;l.node(u).isInline;){if(!u)return!1;u--}return l.node(u).isTextblock?(i&&i(e.tr.setSelection(cr.create(e.doc,o<0?l.start(u):l.end(u)))),!0):!1}}var f0=p0(-1),A0=p0(1);function BP(o,e){return function(i,a){var l=i.selection,u=l.$from,f=l.$to,g=u.blockRange(f),_=g&&Fm(g,o,e);return _?(a&&a(i.tr.wrap(g,_).scrollIntoView()),!0):!1}}function g0(o,e){return function(i,a){var l=i.selection,u=l.from,f=l.to,g=!1;return i.doc.nodesBetween(u,f,function(_,I){if(g)return!1;if(!(!_.isTextblock||_.hasMarkup(o,e)))if(_.type==o)g=!0;else{var T=i.doc.resolve(I),N=T.index();g=T.parent.canReplaceWith(N,N+1,o)}}),g?(a&&a(i.tr.setBlockType(u,f,o,e).scrollIntoView()),!0):!1}}function zm(){for(var o=[],e=arguments.length;e--;)o[e]=arguments[e];return function(i,a,l){for(var u=0;u<o.length;u++)if(o[u](i,a,l))return!0;return!1}}var Xm=zm(qm,r0,n0),m0=zm(qm,o0,s0),Fs={Enter:zm(c0,d0,u0,DP),"Mod-Enter":l0,Backspace:Xm,"Mod-Backspace":Xm,"Shift-Backspace":Xm,Delete:m0,"Mod-Delete":m0,"Mod-a":MP},UP={"Ctrl-h":Fs.Backspace,"Alt-Backspace":Fs["Mod-Backspace"],"Ctrl-d":Fs.Delete,"Ctrl-Alt-Backspace":Fs["Mod-Delete"],"Alt-Delete":Fs["Mod-Delete"],"Alt-d":Fs["Mod-Delete"],"Ctrl-a":f0,"Ctrl-e":A0};for(var E0 in Fs)UP[E0]=Fs[E0];Fs.Home=f0;Fs.End=A0;typeof navigator!="undefined"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os!="undefined"&&os.platform()=="darwin";function xP(o,e){return function(i,a){var l=i.selection,u=l.$from,f=l.$to,g=u.blockRange(f),_=!1,I=g;if(!g)return!1;if(g.depth>=2&&u.node(g.depth-1).type.compatibleContent(o)&&g.startIndex==0){if(u.index(g.depth-1)==0)return!1;var T=i.doc.resolve(g.start-2);I=new Cu(T,T,g.depth),g.endIndex<g.parent.childCount&&(g=new Cu(u,i.doc.resolve(f.end(g.depth)),g.depth)),_=!0}var N=Fm(I,o,e,g);return N?(a&&a(FP(i.tr,g,N,_,o).scrollIntoView()),!0):!1}}function FP(o,e,i,a,l){for(var u=Nt.empty,f=i.length-1;f>=0;f--)u=Nt.from(i[f].type.create(i[f].attrs,u));o.step(new lo(e.start-(a?2:0),e.end,e.start,e.end,new Ht(u,0,0),i.length,!0));for(var g=0,_=0;_<i.length;_++)i[_].type==l&&(g=_+1);for(var I=i.length-g,T=e.start+i.length-(a?2:0),N=e.parent,D=e.startIndex,F=e.endIndex,K=!0;D<F;D++,K=!1)!K&&ya(o.doc,T,I)&&(o.split(T,I),T+=2*I),T+=N.child(D).nodeSize;return o}function QP(o){return function(e,i){var a=e.selection,l=a.$from,u=a.$to,f=l.blockRange(u,function(g){return g.childCount&&g.firstChild.type==o});return f?i?l.node(f.depth-1).type==o?VP(e,i,o,f):GP(e,i,f):!0:!1}}function VP(o,e,i,a){var l=o.tr,u=a.end,f=a.$to.end(a.depth);return u<f&&(l.step(new lo(u-1,f,u,f,new Ht(Nt.from(i.create(null,a.parent.copy())),1,0),1,!0)),a=new Cu(l.doc.resolve(a.$from.pos),l.doc.resolve(f),a.depth)),e(l.lift(a,Yl(a)).scrollIntoView()),!0}function GP(o,e,i){for(var a=o.tr,l=i.parent,u=i.end,f=i.endIndex-1,g=i.startIndex;f>g;f--)u-=l.child(f).nodeSize,a.delete(u-1,u+1);var _=a.doc.resolve(i.start),I=_.nodeAfter;if(a.mapping.map(i.end)!=i.start+_.nodeAfter.nodeSize)return!1;var T=i.startIndex==0,N=i.endIndex==l.childCount,D=_.node(-1),F=_.index(-1);if(!D.canReplace(F+(T?0:1),F+1,I.content.append(N?Nt.empty:Nt.from(l))))return!1;var K=_.pos,J=K+I.nodeSize;return a.step(new lo(K-(T?1:0),J+(N?1:0),K+1,J-1,new Ht((T?Nt.empty:Nt.from(l.copy(Nt.empty))).append(N?Nt.empty:Nt.from(l.copy(Nt.empty))),T?0:1,N?0:1),T?0:1)),e(a.scrollIntoView()),!0}function jP(o){return function(e,i){var a=e.selection,l=a.$from,u=a.$to,f=l.blockRange(u,function(J){return J.childCount&&J.firstChild.type==o});if(!f)return!1;var g=f.startIndex;if(g==0)return!1;var _=f.parent,I=_.child(g-1);if(I.type!=o)return!1;if(i){var T=I.lastChild&&I.lastChild.type==_.type,N=Nt.from(T?o.create():null),D=new Ht(Nt.from(o.create(null,Nt.from(_.type.create(null,N)))),T?3:1,0),F=f.start,K=f.end;i(e.tr.step(new lo(F-(T?3:1),K,F,K,D,1,!0)).scrollIntoView())}return!0}}var Bt={};if(typeof navigator!="undefined"&&typeof document!="undefined"){var Zm=/Edge\/(\d+)/.exec(navigator.userAgent),_0=/MSIE \d/.test(navigator.userAgent),$m=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),tE=Bt.ie=!!(_0||$m||Zm);Bt.ie_version=_0?document.documentMode||6:$m?+$m[1]:Zm?+Zm[1]:null,Bt.gecko=!tE&&/gecko\/(\d+)/i.test(navigator.userAgent),Bt.gecko_version=Bt.gecko&&+(/Firefox\/(\d+)/.exec(navigator.userAgent)||[0,0])[1];var eE=!tE&&/Chrome\/(\d+)/.exec(navigator.userAgent);Bt.chrome=!!eE,Bt.chrome_version=eE&&+eE[1],Bt.safari=!tE&&/Apple Computer/.test(navigator.vendor),Bt.ios=Bt.safari&&(/Mobile\/\w+/.test(navigator.userAgent)||navigator.maxTouchPoints>2),Bt.mac=Bt.ios||/Mac/.test(navigator.platform),Bt.android=/Android \d/.test(navigator.userAgent),Bt.webkit="webkitFontSmoothing"in document.documentElement.style,Bt.webkit_version=Bt.webkit&&+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]}var bo=function(o){for(var e=0;;e++)if(o=o.previousSibling,!o)return e},rE=function(o){var e=o.assignedSlot||o.parentNode;return e&&e.nodeType==11?e.host:e},v0=null,Ra=function(o,e,i){var a=v0||(v0=document.createRange());return a.setEnd(o,i==null?o.nodeValue.length:i),a.setStart(o,e||0),a},ku=function(o,e,i,a){return i&&(I0(o,e,i,a,-1)||I0(o,e,i,a,1))},WP=/^(img|br|input|textarea|hr)$/i;function I0(o,e,i,a,l){for(;;){if(o==i&&e==a)return!0;if(e==(l<0?0:Qs(o))){var u=o.parentNode;if(u.nodeType!=1||HP(o)||WP.test(o.nodeName)||o.contentEditable=="false")return!1;e=bo(o)+(l<0?0:1),o=u}else if(o.nodeType==1){if(o=o.childNodes[e+(l<0?-1:0)],o.contentEditable=="false")return!1;e=l<0?Qs(o):0}else return!1}}function Qs(o){return o.nodeType==3?o.nodeValue.length:o.childNodes.length}function KP(o,e,i){for(var a=e==0,l=e==Qs(o);a||l;){if(o==i)return!0;var u=bo(o);if(o=o.parentNode,!o)return!1;a=a&&u==0,l=l&&u==Qs(o)}}function HP(o){for(var e,i=o;i&&!(e=i.pmViewDesc);i=i.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==o||e.contentDOM==o)}var nE=function(o){var e=o.isCollapsed;return e&&Bt.chrome&&o.rangeCount&&!o.getRangeAt(0).collapsed&&(e=!1),e};function zl(o,e){var i=document.createEvent("Event");return i.initEvent("keydown",!0,!0),i.keyCode=o,i.key=i.code=e,i}function YP(o){return{left:0,right:o.documentElement.clientWidth,top:0,bottom:o.documentElement.clientHeight}}function qa(o,e){return typeof o=="number"?o:o[e]}function qP(o){var e=o.getBoundingClientRect(),i=e.width/o.offsetWidth||1,a=e.height/o.offsetHeight||1;return{left:e.left,right:e.left+o.clientWidth*i,top:e.top,bottom:e.top+o.clientHeight*a}}function C0(o,e,i){for(var a=o.someProp("scrollThreshold")||0,l=o.someProp("scrollMargin")||5,u=o.dom.ownerDocument,f=i||o.dom;f;f=rE(f))if(f.nodeType==1){var g=f==u.body||f.nodeType!=1,_=g?YP(u):qP(f),I=0,T=0;if(e.top<_.top+qa(a,"top")?T=-(_.top-e.top+qa(l,"top")):e.bottom>_.bottom-qa(a,"bottom")&&(T=e.bottom-_.bottom+qa(l,"bottom")),e.left<_.left+qa(a,"left")?I=-(_.left-e.left+qa(l,"left")):e.right>_.right-qa(a,"right")&&(I=e.right-_.right+qa(l,"right")),I||T)if(g)u.defaultView.scrollBy(I,T);else{var N=f.scrollLeft,D=f.scrollTop;T&&(f.scrollTop+=T),I&&(f.scrollLeft+=I);var F=f.scrollLeft-N,K=f.scrollTop-D;e={left:e.left-F,top:e.top-K,right:e.right-F,bottom:e.bottom-K}}if(g)break}}function JP(o){for(var e=o.dom.getBoundingClientRect(),i=Math.max(0,e.top),a,l,u=(e.left+e.right)/2,f=i+1;f<Math.min(innerHeight,e.bottom);f+=5){var g=o.root.elementFromPoint(u,f);if(!(g==o.dom||!o.dom.contains(g))){var _=g.getBoundingClientRect();if(_.top>=i-20){a=g,l=_.top;break}}}return{refDOM:a,refTop:l,stack:S0(o.dom)}}function S0(o){for(var e=[],i=o.ownerDocument;o&&(e.push({dom:o,top:o.scrollTop,left:o.scrollLeft}),o!=i);o=rE(o));return e}function zP(o){var e=o.refDOM,i=o.refTop,a=o.stack,l=e?e.getBoundingClientRect().top:0;y0(a,l==0?0:l-i)}function y0(o,e){for(var i=0;i<o.length;i++){var a=o[i],l=a.dom,u=a.top,f=a.left;l.scrollTop!=u+e&&(l.scrollTop=u+e),l.scrollLeft!=f&&(l.scrollLeft=f)}}var Xl=null;function XP(o){if(o.setActive)return o.setActive();if(Xl)return o.focus(Xl);var e=S0(o);o.focus(Xl==null?{get preventScroll(){return Xl={preventScroll:!0},!0}}:void 0),Xl||(Xl=!1,y0(e,0))}function T0(o,e){for(var i,a=2e8,l,u=0,f=e.top,g=e.top,_=o.firstChild,I=0;_;_=_.nextSibling,I++){var T=void 0;if(_.nodeType==1)T=_.getClientRects();else if(_.nodeType==3)T=Ra(_).getClientRects();else continue;for(var N=0;N<T.length;N++){var D=T[N];if(D.top<=f&&D.bottom>=g){f=Math.max(D.bottom,f),g=Math.min(D.top,g);var F=D.left>e.left?D.left-e.left:D.right<e.left?e.left-D.right:0;if(F<a){i=_,a=F,l=F&&i.nodeType==3?{left:D.right<e.left?D.right:D.left,top:e.top}:e,_.nodeType==1&&F&&(u=I+(e.left>=(D.left+D.right)/2?1:0));continue}}!i&&(e.left>=D.right&&e.top>=D.top||e.left>=D.left&&e.top>=D.bottom)&&(u=I+1)}}return i&&i.nodeType==3?ZP(i,l):!i||a&&i.nodeType==1?{node:o,offset:u}:T0(i,l)}function ZP(o,e){for(var i=o.nodeValue.length,a=document.createRange(),l=0;l<i;l++){a.setEnd(o,l+1),a.setStart(o,l);var u=Ja(a,1);if(u.top!=u.bottom&&iE(e,u))return{node:o,offset:l+(e.left>=(u.left+u.right)/2?1:0)}}return{node:o,offset:0}}function iE(o,e){return o.left>=e.left-1&&o.left<=e.right+1&&o.top>=e.top-1&&o.top<=e.bottom+1}function $P(o,e){var i=o.parentNode;return i&&/^li$/i.test(i.nodeName)&&e.left<o.getBoundingClientRect().left?i:o}function tB(o,e,i){var a=T0(e,i),l=a.node,u=a.offset,f=-1;if(l.nodeType==1&&!l.firstChild){var g=l.getBoundingClientRect();f=g.left!=g.right&&i.left>(g.left+g.right)/2?1:-1}return o.docView.posFromDOM(l,u,f)}function eB(o,e,i,a){for(var l=-1,u=e;u!=o.dom;){var f=o.docView.nearestDesc(u,!0);if(!f)return null;if(f.node.isBlock&&f.parent){var g=f.dom.getBoundingClientRect();if(g.left>a.left||g.top>a.top)l=f.posBefore;else if(g.right<a.left||g.bottom<a.top)l=f.posAfter;else break}u=f.dom.parentNode}return l>-1?l:o.docView.posFromDOM(e,i)}function R0(o,e,i){var a=o.childNodes.length;if(a&&i.top<i.bottom)for(var l=Math.max(0,Math.min(a-1,Math.floor(a*(e.top-i.top)/(i.bottom-i.top))-2)),u=l;;){var f=o.childNodes[u];if(f.nodeType==1)for(var g=f.getClientRects(),_=0;_<g.length;_++){var I=g[_];if(iE(e,I))return R0(f,e,I)}if((u=(u+1)%a)==l)break}return o}function rB(o,e){var i,a,l=o.dom.ownerDocument,u,f;if(l.caretPositionFromPoint)try{var g=l.caretPositionFromPoint(e.left,e.top);g&&(i=g,u=i.offsetNode,f=i.offset)}catch{}if(!u&&l.caretRangeFromPoint){var _=l.caretRangeFromPoint(e.left,e.top);_&&(a=_,u=a.startContainer,f=a.startOffset)}var I=(o.root.elementFromPoint?o.root:l).elementFromPoint(e.left,e.top+1),T;if(!I||!o.dom.contains(I.nodeType!=1?I.parentNode:I)){var N=o.dom.getBoundingClientRect();if(!iE(e,N)||(I=R0(o.dom,e,N),!I))return null}if(Bt.safari)for(var D=I;u&&D;D=rE(D))D.draggable&&(u=f=null);if(I=$P(I,e),u){if(Bt.gecko&&u.nodeType==1&&(f=Math.min(f,u.childNodes.length),f<u.childNodes.length)){var F=u.childNodes[f],K;F.nodeName=="IMG"&&(K=F.getBoundingClientRect()).right<=e.left&&K.bottom>e.top&&f++}u==o.dom&&f==u.childNodes.length-1&&u.lastChild.nodeType==1&&e.top>u.lastChild.getBoundingClientRect().bottom?T=o.state.doc.content.size:(f==0||u.nodeType!=1||u.childNodes[f-1].nodeName!="BR")&&(T=eB(o,u,f,e))}T==null&&(T=tB(o,I,e));var J=o.docView.nearestDesc(I,!0);return{pos:T,inside:J?J.posAtStart-J.border:-1}}function Ja(o,e){var i=o.getClientRects();return i.length?i[e<0?0:i.length-1]:o.getBoundingClientRect()}var nB=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function w0(o,e,i){var a=o.docView.domFromPos(e,i<0?-1:1),l=a.node,u=a.offset,f=Bt.webkit||Bt.gecko;if(l.nodeType==3)if(f&&(nB.test(l.nodeValue)||(i<0?!u:u==l.nodeValue.length))){var g=Ja(Ra(l,u,u),i);if(Bt.gecko&&u&&/\s/.test(l.nodeValue[u-1])&&u<l.nodeValue.length){var _=Ja(Ra(l,u-1,u-1),-1);if(_.top==g.top){var I=Ja(Ra(l,u,u+1),-1);if(I.top!=g.top)return Du(I,I.left<_.left)}}return g}else{var T=u,N=u,D=i<0?1:-1;return i<0&&!u?(N++,D=-1):i>=0&&u==l.nodeValue.length?(T--,D=1):i<0?T--:N++,Du(Ja(Ra(l,T,N),D),D<0)}if(!o.state.doc.resolve(e).parent.inlineContent){if(u&&(i<0||u==Qs(l))){var F=l.childNodes[u-1];if(F.nodeType==1)return oE(F.getBoundingClientRect(),!1)}if(u<Qs(l)){var K=l.childNodes[u];if(K.nodeType==1)return oE(K.getBoundingClientRect(),!0)}return oE(l.getBoundingClientRect(),i>=0)}if(u&&(i<0||u==Qs(l))){var J=l.childNodes[u-1],nt=J.nodeType==3?Ra(J,Qs(J)-(f?0:1)):J.nodeType==1&&(J.nodeName!="BR"||!J.nextSibling)?J:null;if(nt)return Du(Ja(nt,1),!1)}if(u<Qs(l)){for(var it=l.childNodes[u];it.pmViewDesc&&it.pmViewDesc.ignoreForCoords;)it=it.nextSibling;var z=it?it.nodeType==3?Ra(it,0,f?0:1):it.nodeType==1?it:null:null;if(z)return Du(Ja(z,-1),!0)}return Du(Ja(l.nodeType==3?Ra(l):l,-i),i>=0)}function Du(o,e){if(o.width==0)return o;var i=e?o.left:o.right;return{top:o.top,bottom:o.bottom,left:i,right:i}}function oE(o,e){if(o.height==0)return o;var i=e?o.top:o.bottom;return{top:i,bottom:i,left:o.left,right:o.right}}function b0(o,e,i){var a=o.state,l=o.root.activeElement;a!=e&&o.updateState(e),l!=o.dom&&o.focus();try{return i()}finally{a!=e&&o.updateState(a),l!=o.dom&&l&&l.focus()}}function iB(o,e,i){var a=e.selection,l=i=="up"?a.$from:a.$to;return b0(o,e,function(){for(var u=o.docView.domFromPos(l.pos,i=="up"?-1:1),f=u.node;;){var g=o.docView.nearestDesc(f,!0);if(!g)break;if(g.node.isBlock){f=g.dom;break}f=g.dom.parentNode}for(var _=w0(o,l.pos,1),I=f.firstChild;I;I=I.nextSibling){var T=void 0;if(I.nodeType==1)T=I.getClientRects();else if(I.nodeType==3)T=Ra(I,0,I.nodeValue.length).getClientRects();else continue;for(var N=0;N<T.length;N++){var D=T[N];if(D.bottom>D.top+1&&(i=="up"?_.top-D.top>(D.bottom-_.top)*2:D.bottom-_.bottom>(_.bottom-D.top)*2))return!1}}return!0})}var oB=/[\u0590-\u08ac]/;function sB(o,e,i){var a=e.selection,l=a.$head;if(!l.parent.isTextblock)return!1;var u=l.parentOffset,f=!u,g=u==l.parent.content.size,_=o.root.getSelection();return!oB.test(l.parent.textContent)||!_.modify?i=="left"||i=="backward"?f:g:b0(o,e,function(){var I=_.getRangeAt(0),T=_.focusNode,N=_.focusOffset,D=_.caretBidiLevel;_.modify("move",i,"character");var F=l.depth?o.docView.domAfterPos(l.before()):o.dom,K=!F.contains(_.focusNode.nodeType==1?_.focusNode:_.focusNode.parentNode)||T==_.focusNode&&N==_.focusOffset;return _.removeAllRanges(),_.addRange(I),D!=null&&(_.caretBidiLevel=D),K})}var N0=null,O0=null,k0=!1;function aB(o,e,i){return N0==e&&O0==i?k0:(N0=e,O0=i,k0=i=="up"||i=="down"?iB(o,e,i):sB(o,e,i))}var Es=0,D0=1,Lu=2,wa=3,Vr=function(e,i,a,l){this.parent=e,this.children=i,this.dom=a,a.pmViewDesc=this,this.contentDOM=l,this.dirty=Es},Vs={size:{configurable:!0},border:{configurable:!0},posBefore:{configurable:!0},posAtStart:{configurable:!0},posAfter:{configurable:!0},posAtEnd:{configurable:!0},contentLost:{configurable:!0},domAtom:{configurable:!0},ignoreForCoords:{configurable:!0}};Vr.prototype.matchesWidget=function(){return!1};Vr.prototype.matchesMark=function(){return!1};Vr.prototype.matchesNode=function(){return!1};Vr.prototype.matchesHack=function(e){return!1};Vr.prototype.parseRule=function(){return null};Vr.prototype.stopEvent=function(){return!1};Vs.size.get=function(){for(var o=0,e=0;e<this.children.length;e++)o+=this.children[e].size;return o};Vs.border.get=function(){return 0};Vr.prototype.destroy=function(){this.parent=null,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=null);for(var e=0;e<this.children.length;e++)this.children[e].destroy()};Vr.prototype.posBeforeChild=function(e){for(var i=0,a=this.posAtStart;i<this.children.length;i++){var l=this.children[i];if(l==e)return a;a+=l.size}};Vs.posBefore.get=function(){return this.parent.posBeforeChild(this)};Vs.posAtStart.get=function(){return this.parent?this.parent.posBeforeChild(this)+this.border:0};Vs.posAfter.get=function(){return this.posBefore+this.size};Vs.posAtEnd.get=function(){return this.posAtStart+this.size-2*this.border};Vr.prototype.localPosFromDOM=function(e,i,a){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(a<0){var l,u;if(e==this.contentDOM)l=e.childNodes[i-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;l=e.previousSibling}for(;l&&!((u=l.pmViewDesc)&&u.parent==this);)l=l.previousSibling;return l?this.posBeforeChild(u)+u.size:this.posAtStart}else{var f,g;if(e==this.contentDOM)f=e.childNodes[i];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;f=e.nextSibling}for(;f&&!((g=f.pmViewDesc)&&g.parent==this);)f=f.nextSibling;return f?this.posBeforeChild(g):this.posAtEnd}var _;if(e==this.dom&&this.contentDOM)_=i>bo(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))_=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(i==0)for(var I=e;;I=I.parentNode){if(I==this.dom){_=!1;break}if(I.parentNode.firstChild!=I)break}if(_==null&&i==e.childNodes.length)for(var T=e;;T=T.parentNode){if(T==this.dom){_=!0;break}if(T.parentNode.lastChild!=T)break}}return(_==null?a>0:_)?this.posAtEnd:this.posAtStart};Vr.prototype.nearestDesc=function(e,i){for(var a=!0,l=e;l;l=l.parentNode){var u=this.getDesc(l);if(u&&(!i||u.node))if(a&&u.nodeDOM&&!(u.nodeDOM.nodeType==1?u.nodeDOM.contains(e.nodeType==1?e:e.parentNode):u.nodeDOM==e))a=!1;else return u}};Vr.prototype.getDesc=function(e){for(var i=e.pmViewDesc,a=i;a;a=a.parent)if(a==this)return i};Vr.prototype.posFromDOM=function(e,i,a){for(var l=e;l;l=l.parentNode){var u=this.getDesc(l);if(u)return u.localPosFromDOM(e,i,a)}return-1};Vr.prototype.descAt=function(e){for(var i=0,a=0;i<this.children.length;i++){var l=this.children[i],u=a+l.size;if(a==e&&u!=a){for(;!l.border&&l.children.length;)l=l.children[0];return l}if(e<u)return l.descAt(e-a-l.border);a=u}};Vr.prototype.domFromPos=function(e,i){if(!this.contentDOM)return{node:this.dom,offset:0};for(var a=0,l=0,u=0;a<this.children.length;a++){var f=this.children[a],g=u+f.size;if(g>e||f instanceof B0){l=e-u;break}u=g}if(l)return this.children[a].domFromPos(l-this.children[a].border,i);for(var _=void 0;a&&!(_=this.children[a-1]).size&&_ instanceof L0&&_.widget.type.side>=0;a--);if(i<=0){for(var I,T=!0;I=a?this.children[a-1]:null,!(!I||I.dom.parentNode==this.contentDOM);a--,T=!1);return I&&i&&T&&!I.border&&!I.domAtom?I.domFromPos(I.size,i):{node:this.contentDOM,offset:I?bo(I.dom)+1:0}}else{for(var N,D=!0;N=a<this.children.length?this.children[a]:null,!(!N||N.dom.parentNode==this.contentDOM);a++,D=!1);return N&&D&&!N.border&&!N.domAtom?N.domFromPos(0,i):{node:this.contentDOM,offset:N?bo(N.dom):this.contentDOM.childNodes.length}}};Vr.prototype.parseRange=function(e,i,a){if(a===void 0&&(a=0),this.children.length==0)return{node:this.contentDOM,from:e,to:i,fromOffset:0,toOffset:this.contentDOM.childNodes.length};for(var l=-1,u=-1,f=a,g=0;;g++){var _=this.children[g],I=f+_.size;if(l==-1&&e<=I){var T=f+_.border;if(e>=T&&i<=I-_.border&&_.node&&_.contentDOM&&this.contentDOM.contains(_.contentDOM))return _.parseRange(e,i,T);e=f;for(var N=g;N>0;N--){var D=this.children[N-1];if(D.size&&D.dom.parentNode==this.contentDOM&&!D.emptyChildAt(1)){l=bo(D.dom)+1;break}e-=D.size}l==-1&&(l=0)}if(l>-1&&(I>i||g==this.children.length-1)){i=I;for(var F=g+1;F<this.children.length;F++){var K=this.children[F];if(K.size&&K.dom.parentNode==this.contentDOM&&!K.emptyChildAt(-1)){u=bo(K.dom);break}i+=K.size}u==-1&&(u=this.contentDOM.childNodes.length);break}f=I}return{node:this.contentDOM,from:e,to:i,fromOffset:l,toOffset:u}};Vr.prototype.emptyChildAt=function(e){if(this.border||!this.contentDOM||!this.children.length)return!1;var i=this.children[e<0?0:this.children.length-1];return i.size==0||i.emptyChildAt(e)};Vr.prototype.domAfterPos=function(e){var i=this.domFromPos(e,0),a=i.node,l=i.offset;if(a.nodeType!=1||l==a.childNodes.length)throw new RangeError("No node after pos "+e);return a.childNodes[l]};Vr.prototype.setSelection=function(e,i,a,l){for(var u=Math.min(e,i),f=Math.max(e,i),g=0,_=0;g<this.children.length;g++){var I=this.children[g],T=_+I.size;if(u>_&&f<T)return I.setSelection(e-_-I.border,i-_-I.border,a,l);_=T}var N=this.domFromPos(e,e?-1:1),D=i==e?N:this.domFromPos(i,i?-1:1),F=a.getSelection(),K=!1;if((Bt.gecko||Bt.safari)&&e==i){var J=N.node,nt=N.offset;if(J.nodeType==3){if(K=nt&&J.nodeValue[nt-1]==`
`,K&&nt==J.nodeValue.length)for(var it=J,z=void 0;it;it=it.parentNode){if(z=it.nextSibling){z.nodeName=="BR"&&(N=D={node:z.parentNode,offset:bo(z)+1});break}var Ot=it.pmViewDesc;if(Ot&&Ot.node&&Ot.node.isBlock)break}}else{var X=J.childNodes[nt-1];K=X&&(X.nodeName=="BR"||X.contentEditable=="false")}}if(Bt.gecko&&F.focusNode&&F.focusNode!=D.node&&F.focusNode.nodeType==1){var yt=F.focusNode.childNodes[F.focusOffset];yt&&yt.contentEditable=="false"&&(l=!0)}if(!(!(l||K&&Bt.safari)&&ku(N.node,N.offset,F.anchorNode,F.anchorOffset)&&ku(D.node,D.offset,F.focusNode,F.focusOffset))){var Mt=!1;if((F.extend||e==i)&&!K){F.collapse(N.node,N.offset);try{e!=i&&F.extend(D.node,D.offset),Mt=!0}catch(Te){if(!(Te instanceof DOMException))throw Te}}if(!Mt){if(e>i){var $t=N;N=D,D=$t}var ge=document.createRange();ge.setEnd(D.node,D.offset),ge.setStart(N.node,N.offset),F.removeAllRanges(),F.addRange(ge)}}};Vr.prototype.ignoreMutation=function(e){return!this.contentDOM&&e.type!="selection"};Vs.contentLost.get=function(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)};Vr.prototype.markDirty=function(e,i){for(var a=0,l=0;l<this.children.length;l++){var u=this.children[l],f=a+u.size;if(a==f?e<=f&&i>=a:e<f&&i>a){var g=a+u.border,_=f-u.border;if(e>=g&&i<=_){this.dirty=e==a||i==f?Lu:D0,e==g&&i==_&&(u.contentLost||u.dom.parentNode!=this.contentDOM)?u.dirty=wa:u.markDirty(e-g,i-g);return}else u.dirty=u.dom==u.contentDOM&&u.dom.parentNode==this.contentDOM&&!u.children.length?Lu:wa}a=f}this.dirty=Lu};Vr.prototype.markParentsDirty=function(){for(var e=1,i=this.parent;i;i=i.parent,e++){var a=e==1?Lu:D0;i.dirty<a&&(i.dirty=a)}};Vs.domAtom.get=function(){return!1};Vs.ignoreForCoords.get=function(){return!1};Object.defineProperties(Vr.prototype,Vs);var za=[],L0=function(o){function e(a,l,u,f){var g,_=l.type.toDOM;if(typeof _=="function"&&(_=_(u,function(){if(!g)return f;if(g.parent)return g.parent.posBeforeChild(g)})),!l.type.spec.raw){if(_.nodeType!=1){var I=document.createElement("span");I.appendChild(_),_=I}_.contentEditable=!1,_.classList.add("ProseMirror-widget")}o.call(this,a,za,_,null),this.widget=l,g=this}o&&(e.__proto__=o),e.prototype=Object.create(o&&o.prototype),e.prototype.constructor=e;var i={domAtom:{configurable:!0}};return e.prototype.matchesWidget=function(l){return this.dirty==Es&&l.type.eq(this.widget.type)},e.prototype.parseRule=function(){return{ignore:!0}},e.prototype.stopEvent=function(l){var u=this.widget.spec.stopEvent;return u?u(l):!1},e.prototype.ignoreMutation=function(l){return l.type!="selection"||this.widget.spec.ignoreSelection},e.prototype.destroy=function(){this.widget.type.destroy(this.dom),o.prototype.destroy.call(this)},i.domAtom.get=function(){return!0},Object.defineProperties(e.prototype,i),e}(Vr),cB=function(o){function e(a,l,u,f){o.call(this,a,za,l,null),this.textDOM=u,this.text=f}o&&(e.__proto__=o),e.prototype=Object.create(o&&o.prototype),e.prototype.constructor=e;var i={size:{configurable:!0}};return i.size.get=function(){return this.text.length},e.prototype.localPosFromDOM=function(l,u){return l!=this.textDOM?this.posAtStart+(u?this.size:0):this.posAtStart+u},e.prototype.domFromPos=function(l){return{node:this.textDOM,offset:l}},e.prototype.ignoreMutation=function(l){return l.type==="characterData"&&l.target.nodeValue==l.oldValue},Object.defineProperties(e.prototype,i),e}(Vr),zp=function(o){function e(i,a,l,u){o.call(this,i,[],l,u),this.mark=a}return o&&(e.__proto__=o),e.prototype=Object.create(o&&o.prototype),e.prototype.constructor=e,e.create=function(a,l,u,f){var g=f.nodeViews[l.type.name],_=g&&g(l,f,u);return(!_||!_.dom)&&(_=li.renderSpec(document,l.type.spec.toDOM(l,u))),new e(a,l,_.dom,_.contentDOM||_.dom)},e.prototype.parseRule=function(){return this.dirty&wa||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}},e.prototype.matchesMark=function(a){return this.dirty!=wa&&this.mark.eq(a)},e.prototype.markDirty=function(a,l){if(o.prototype.markDirty.call(this,a,l),this.dirty!=Es){for(var u=this.parent;!u.node;)u=u.parent;u.dirty<this.dirty&&(u.dirty=this.dirty),this.dirty=Es}},e.prototype.slice=function(a,l,u){var f=e.create(this.parent,this.mark,!0,u),g=this.children,_=this.size;l<_&&(g=cE(g,l,_,u)),a>0&&(g=cE(g,0,a,u));for(var I=0;I<g.length;I++)g[I].parent=f;return f.children=g,f},e}(Vr),Mu=function(o){function e(a,l,u,f,g,_,I,T,N){o.call(this,a,l.isLeaf?za:[],g,_),this.nodeDOM=I,this.node=l,this.outerDeco=u,this.innerDeco=f,_&&this.updateChildren(T,N)}o&&(e.__proto__=o),e.prototype=Object.create(o&&o.prototype),e.prototype.constructor=e;var i={size:{configurable:!0},border:{configurable:!0},domAtom:{configurable:!0}};return e.create=function(l,u,f,g,_,I){var T,N=_.nodeViews[u.type.name],D,F=N&&N(u,_,function(){if(!D)return I;if(D.parent)return D.parent.posBeforeChild(D)},f,g),K=F&&F.dom,J=F&&F.contentDOM;if(u.isText){if(!K)K=document.createTextNode(u.text);else if(K.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else K||(T=li.renderSpec(document,u.type.spec.toDOM(u)),K=T.dom,J=T.contentDOM);!J&&!u.isText&&K.nodeName!="BR"&&(K.hasAttribute("contenteditable")||(K.contentEditable=!1),u.type.spec.draggable&&(K.draggable=!0));var nt=K;return K=F0(K,f,u),F?D=new lB(l,u,f,g,K,J,nt,F,_,I+1):u.isText?new P0(l,u,f,g,K,nt,_):new e(l,u,f,g,K,J,nt,_,I+1)},e.prototype.parseRule=function(){var l=this;if(this.node.type.spec.reparseInView)return null;var u={node:this.node.type.name,attrs:this.node.attrs};return this.node.type.whitespace=="pre"&&(u.preserveWhitespace="full"),this.contentDOM&&!this.contentLost?u.contentElement=this.contentDOM:u.getContent=function(){return l.contentDOM?Nt.empty:l.node.content},u},e.prototype.matchesNode=function(l,u,f){return this.dirty==Es&&l.eq(this.node)&&aE(u,this.outerDeco)&&f.eq(this.innerDeco)},i.size.get=function(){return this.node.nodeSize},i.border.get=function(){return this.node.isLeaf?0:1},e.prototype.updateChildren=function(l,u){var f=this,g=this.node.inlineContent,_=u,I=l.composing&&this.localCompositionInfo(l,u),T=I&&I.pos>-1?I:null,N=I&&I.pos<0,D=new Jo(this,T&&T.node);pB(this.node,this.innerDeco,function(F,K,J){F.spec.marks?D.syncToMarks(F.spec.marks,g,l):F.type.side>=0&&!J&&D.syncToMarks(K==f.node.childCount?or.none:f.node.child(K).marks,g,l),D.placeWidget(F,l,_)},function(F,K,J,nt){D.syncToMarks(F.marks,g,l);var it;D.findNodeMatch(F,K,J,nt)||N&&l.state.selection.from>_&&l.state.selection.to<_+F.nodeSize&&(it=D.findIndexWithChild(I.node))>-1&&D.updateNodeAt(F,K,J,it,l)||D.updateNextNode(F,K,J,l,nt)||D.addNode(F,K,J,l,_),_+=F.nodeSize}),D.syncToMarks(za,g,l),this.node.isTextblock&&D.addTextblockHacks(),D.destroyRest(),(D.changed||this.dirty==Lu)&&(T&&this.protectLocalComposition(l,T),U0(this.contentDOM,this.children,l),Bt.ios&&fB(this.dom))},e.prototype.localCompositionInfo=function(l,u){var f=l.state.selection,g=f.from,_=f.to;if(!(!(l.state.selection instanceof cr)||g<u||_>u+this.node.content.size)){var I=l.root.getSelection(),T=AB(I.focusNode,I.focusOffset);if(!(!T||!this.dom.contains(T.parentNode)))if(this.node.inlineContent){var N=T.nodeValue,D=gB(this.node.content,N,g-u,_-u);return D<0?null:{node:T,pos:D,text:N}}else return{node:T,pos:-1}}},e.prototype.protectLocalComposition=function(l,u){var f=u.node,g=u.pos,_=u.text;if(!this.getDesc(f)){for(var I=f;I.parentNode!=this.contentDOM;I=I.parentNode){for(;I.previousSibling;)I.parentNode.removeChild(I.previousSibling);for(;I.nextSibling;)I.parentNode.removeChild(I.nextSibling);I.pmViewDesc&&(I.pmViewDesc=null)}var T=new cB(this,I,f,_);l.compositionNodes.push(T),this.children=cE(this.children,g,g+_.length,l,T)}},e.prototype.update=function(l,u,f,g){return this.dirty==wa||!l.sameMarkup(this.node)?!1:(this.updateInner(l,u,f,g),!0)},e.prototype.updateInner=function(l,u,f,g){this.updateOuterDeco(u),this.node=l,this.innerDeco=f,this.contentDOM&&this.updateChildren(g,this.posAtStart),this.dirty=Es},e.prototype.updateOuterDeco=function(l){if(!aE(l,this.outerDeco)){var u=this.nodeDOM.nodeType!=1,f=this.dom;this.dom=x0(this.dom,this.nodeDOM,sE(this.outerDeco,this.node,u),sE(l,this.node,u)),this.dom!=f&&(f.pmViewDesc=null,this.dom.pmViewDesc=this),this.outerDeco=l}},e.prototype.selectNode=function(){this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.dom.draggable=!0)},e.prototype.deselectNode=function(){this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.dom.removeAttribute("draggable")},i.domAtom.get=function(){return this.node.isAtom},Object.defineProperties(e.prototype,i),e}(Vr);function M0(o,e,i,a,l){return F0(a,e,o),new Mu(null,o,e,i,a,a,a,l,0)}var P0=function(o){function e(a,l,u,f,g,_,I){o.call(this,a,l,u,f,g,null,_,I)}o&&(e.__proto__=o),e.prototype=Object.create(o&&o.prototype),e.prototype.constructor=e;var i={domAtom:{configurable:!0}};return e.prototype.parseRule=function(){for(var l=this.nodeDOM.parentNode;l&&l!=this.dom&&!l.pmIsDeco;)l=l.parentNode;return{skip:l||!0}},e.prototype.update=function(l,u,f,g){return this.dirty==wa||this.dirty!=Es&&!this.inParent()||!l.sameMarkup(this.node)?!1:(this.updateOuterDeco(u),(this.dirty!=Es||l.text!=this.node.text)&&l.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=l.text,g.trackWrites==this.nodeDOM&&(g.trackWrites=null)),this.node=l,this.dirty=Es,!0)},e.prototype.inParent=function(){for(var l=this.parent.contentDOM,u=this.nodeDOM;u;u=u.parentNode)if(u==l)return!0;return!1},e.prototype.domFromPos=function(l){return{node:this.nodeDOM,offset:l}},e.prototype.localPosFromDOM=function(l,u,f){return l==this.nodeDOM?this.posAtStart+Math.min(u,this.node.text.length):o.prototype.localPosFromDOM.call(this,l,u,f)},e.prototype.ignoreMutation=function(l){return l.type!="characterData"&&l.type!="selection"},e.prototype.slice=function(l,u,f){var g=this.node.cut(l,u),_=document.createTextNode(g.text);return new e(this.parent,g,this.outerDeco,this.innerDeco,_,_,f)},e.prototype.markDirty=function(l,u){o.prototype.markDirty.call(this,l,u),this.dom!=this.nodeDOM&&(l==0||u==this.nodeDOM.nodeValue.length)&&(this.dirty=wa)},i.domAtom.get=function(){return!1},Object.defineProperties(e.prototype,i),e}(Mu),B0=function(o){function e(){o.apply(this,arguments)}o&&(e.__proto__=o),e.prototype=Object.create(o&&o.prototype),e.prototype.constructor=e;var i={domAtom:{configurable:!0},ignoreForCoords:{configurable:!0}};return e.prototype.parseRule=function(){return{ignore:!0}},e.prototype.matchesHack=function(l){return this.dirty==Es&&this.dom.nodeName==l},i.domAtom.get=function(){return!0},i.ignoreForCoords.get=function(){return this.dom.nodeName=="IMG"},Object.defineProperties(e.prototype,i),e}(Vr),lB=function(o){function e(i,a,l,u,f,g,_,I,T,N){o.call(this,i,a,l,u,f,g,_,T,N),this.spec=I}return o&&(e.__proto__=o),e.prototype=Object.create(o&&o.prototype),e.prototype.constructor=e,e.prototype.update=function(a,l,u,f){if(this.dirty==wa)return!1;if(this.spec.update){var g=this.spec.update(a,l,u);return g&&this.updateInner(a,l,u,f),g}else return!this.contentDOM&&!a.isLeaf?!1:o.prototype.update.call(this,a,l,u,f)},e.prototype.selectNode=function(){this.spec.selectNode?this.spec.selectNode():o.prototype.selectNode.call(this)},e.prototype.deselectNode=function(){this.spec.deselectNode?this.spec.deselectNode():o.prototype.deselectNode.call(this)},e.prototype.setSelection=function(a,l,u,f){this.spec.setSelection?this.spec.setSelection(a,l,u):o.prototype.setSelection.call(this,a,l,u,f)},e.prototype.destroy=function(){this.spec.destroy&&this.spec.destroy(),o.prototype.destroy.call(this)},e.prototype.stopEvent=function(a){return this.spec.stopEvent?this.spec.stopEvent(a):!1},e.prototype.ignoreMutation=function(a){return this.spec.ignoreMutation?this.spec.ignoreMutation(a):o.prototype.ignoreMutation.call(this,a)},e}(Mu);function U0(o,e,i){for(var a=o.firstChild,l=!1,u=0;u<e.length;u++){var f=e[u],g=f.dom;if(g.parentNode==o){for(;g!=a;)a=Q0(a),l=!0;a=a.nextSibling}else l=!0,o.insertBefore(g,a);if(f instanceof zp){var _=a?a.previousSibling:o.lastChild;U0(f.contentDOM,f.children,i),a=_?_.nextSibling:o.firstChild}}for(;a;)a=Q0(a),l=!0;l&&i.trackWrites==o&&(i.trackWrites=null)}function Pu(o){o&&(this.nodeName=o)}Pu.prototype=Object.create(null);var kc=[new Pu];function sE(o,e,i){if(o.length==0)return kc;for(var a=i?kc[0]:new Pu,l=[a],u=0;u<o.length;u++){var f=o[u].type.attrs;if(!!f){f.nodeName&&l.push(a=new Pu(f.nodeName));for(var g in f){var _=f[g];_!=null&&(i&&l.length==1&&l.push(a=new Pu(e.isInline?"span":"div")),g=="class"?a.class=(a.class?a.class+" ":"")+_:g=="style"?a.style=(a.style?a.style+";":"")+_:g!="nodeName"&&(a[g]=_))}}}return l}function x0(o,e,i,a){if(i==kc&&a==kc)return e;for(var l=e,u=0;u<a.length;u++){var f=a[u],g=i[u];if(u){var _=void 0;g&&g.nodeName==f.nodeName&&l!=o&&(_=l.parentNode)&&_.tagName.toLowerCase()==f.nodeName||(_=document.createElement(f.nodeName),_.pmIsDeco=!0,_.appendChild(l),g=kc[0]),l=_}dB(l,g||kc[0],f)}return l}function dB(o,e,i){for(var a in e)a!="class"&&a!="style"&&a!="nodeName"&&!(a in i)&&o.removeAttribute(a);for(var l in i)l!="class"&&l!="style"&&l!="nodeName"&&i[l]!=e[l]&&o.setAttribute(l,i[l]);if(e.class!=i.class){for(var u=e.class?e.class.split(" ").filter(Boolean):za,f=i.class?i.class.split(" ").filter(Boolean):za,g=0;g<u.length;g++)f.indexOf(u[g])==-1&&o.classList.remove(u[g]);for(var _=0;_<f.length;_++)u.indexOf(f[_])==-1&&o.classList.add(f[_]);o.classList.length==0&&o.removeAttribute("class")}if(e.style!=i.style){if(e.style)for(var I=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,T;T=I.exec(e.style);)o.style.removeProperty(T[1]);i.style&&(o.style.cssText+=i.style)}}function F0(o,e,i){return x0(o,o,kc,sE(e,i,o.nodeType!=1))}function aE(o,e){if(o.length!=e.length)return!1;for(var i=0;i<o.length;i++)if(!o[i].type.eq(e[i].type))return!1;return!0}function Q0(o){var e=o.nextSibling;return o.parentNode.removeChild(o),e}var Jo=function(e,i){this.top=e,this.lock=i,this.index=0,this.stack=[],this.changed=!1,this.preMatch=uB(e.node.content,e)};Jo.prototype.destroyBetween=function(e,i){if(e!=i){for(var a=e;a<i;a++)this.top.children[a].destroy();this.top.children.splice(e,i-e),this.changed=!0}};Jo.prototype.destroyRest=function(){this.destroyBetween(this.index,this.top.children.length)};Jo.prototype.syncToMarks=function(e,i,a){for(var l=0,u=this.stack.length>>1,f=Math.min(u,e.length);l<f&&(l==u-1?this.top:this.stack[l+1<<1]).matchesMark(e[l])&&e[l].type.spec.spanning!==!1;)l++;for(;l<u;)this.destroyRest(),this.top.dirty=Es,this.index=this.stack.pop(),this.top=this.stack.pop(),u--;for(;u<e.length;){this.stack.push(this.top,this.index+1);for(var g=-1,_=this.index;_<Math.min(this.index+3,this.top.children.length);_++)if(this.top.children[_].matchesMark(e[u])){g=_;break}if(g>-1)g>this.index&&(this.changed=!0,this.destroyBetween(this.index,g)),this.top=this.top.children[this.index];else{var I=zp.create(this.top,e[u],i,a);this.top.children.splice(this.index,0,I),this.top=I,this.changed=!0}this.index=0,u++}};Jo.prototype.findNodeMatch=function(e,i,a,l){var u=-1,f;if(l>=this.preMatch.index&&(f=this.preMatch.matches[l-this.preMatch.index]).parent==this.top&&f.matchesNode(e,i,a))u=this.top.children.indexOf(f,this.index);else for(var g=this.index,_=Math.min(this.top.children.length,g+5);g<_;g++){var I=this.top.children[g];if(I.matchesNode(e,i,a)&&!this.preMatch.matched.has(I)){u=g;break}}return u<0?!1:(this.destroyBetween(this.index,u),this.index++,!0)};Jo.prototype.updateNodeAt=function(e,i,a,l,u){var f=this.top.children[l];return f.update(e,i,a,u)?(this.destroyBetween(this.index,l),this.index=l+1,!0):!1};Jo.prototype.findIndexWithChild=function(e){for(;;){var i=e.parentNode;if(!i)return-1;if(i==this.top.contentDOM){var a=e.pmViewDesc;if(a){for(var l=this.index;l<this.top.children.length;l++)if(this.top.children[l]==a)return l}return-1}e=i}};Jo.prototype.updateNextNode=function(e,i,a,l,u){for(var f=this.index;f<this.top.children.length;f++){var g=this.top.children[f];if(g instanceof Mu){var _=this.preMatch.matched.get(g);if(_!=null&&_!=u)return!1;var I=g.dom,T=this.lock&&(I==this.lock||I.nodeType==1&&I.contains(this.lock.parentNode))&&!(e.isText&&g.node&&g.node.isText&&g.nodeDOM.nodeValue==e.text&&g.dirty!=wa&&aE(i,g.outerDeco));if(!T&&g.update(e,i,a,l))return this.destroyBetween(this.index,f),g.dom!=I&&(this.changed=!0),this.index++,!0;break}}return!1};Jo.prototype.addNode=function(e,i,a,l,u){this.top.children.splice(this.index++,0,Mu.create(this.top,e,i,a,l,u)),this.changed=!0};Jo.prototype.placeWidget=function(e,i,a){var l=this.index<this.top.children.length?this.top.children[this.index]:null;if(l&&l.matchesWidget(e)&&(e==l.widget||!l.widget.type.toDOM.parentNode))this.index++;else{var u=new L0(this.top,e,i,a);this.top.children.splice(this.index++,0,u),this.changed=!0}};Jo.prototype.addTextblockHacks=function(){for(var e=this.top.children[this.index-1];e instanceof zp;)e=e.children[e.children.length-1];(!e||!(e instanceof P0)||/\n$/.test(e.node.text))&&((Bt.safari||Bt.chrome)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG"),this.addHackNode("BR"))};Jo.prototype.addHackNode=function(e){if(this.index<this.top.children.length&&this.top.children[this.index].matchesHack(e))this.index++;else{var i=document.createElement(e);e=="IMG"&&(i.className="ProseMirror-separator"),e=="BR"&&(i.className="ProseMirror-trailingBreak"),this.top.children.splice(this.index++,0,new B0(this.top,za,i,null)),this.changed=!0}};function uB(o,e){var i=e,a=i.children.length,l=o.childCount,u=new Map,f=[];t:for(;l>0;){for(var g=void 0;;)if(a){var _=i.children[a-1];if(_ instanceof zp)i=_,a=_.children.length;else{g=_,a--;break}}else{if(i==e)break t;a=i.parent.children.indexOf(i),i=i.parent}var I=g.node;if(!!I){if(I!=o.child(l-1))break;--l,u.set(g,l),f.push(g)}}return{index:l,matched:u,matches:f.reverse()}}function hB(o,e){return o.type.side-e.type.side}function pB(o,e,i,a){var l=e.locals(o),u=0;if(l.length==0){for(var f=0;f<o.childCount;f++){var g=o.child(f);a(g,l,e.forChild(u,g),f),u+=g.nodeSize}return}for(var _=0,I=[],T=null,N=0;;){if(_<l.length&&l[_].to==u){for(var D=l[_++],F=void 0;_<l.length&&l[_].to==u;)(F||(F=[D])).push(l[_++]);if(F){F.sort(hB);for(var K=0;K<F.length;K++)i(F[K],N,!!T)}else i(D,N,!!T)}var J=void 0,nt=void 0;if(T)nt=-1,J=T,T=null;else if(N<o.childCount)nt=N,J=o.child(N++);else break;for(var it=0;it<I.length;it++)I[it].to<=u&&I.splice(it--,1);for(;_<l.length&&l[_].from<=u&&l[_].to>u;)I.push(l[_++]);var z=u+J.nodeSize;if(J.isText){var Ot=z;_<l.length&&l[_].from<Ot&&(Ot=l[_].from);for(var X=0;X<I.length;X++)I[X].to<Ot&&(Ot=I[X].to);Ot<z&&(T=J.cut(Ot-u),J=J.cut(0,Ot-u),z=Ot,nt=-1)}var yt=I.length?J.isInline&&!J.isLeaf?I.filter(function(Mt){return!Mt.inline}):I.slice():za;a(J,yt,e.forChild(u,J),nt),u=z}}function fB(o){if(o.nodeName=="UL"||o.nodeName=="OL"){var e=o.style.cssText;o.style.cssText=e+"; list-style: square !important",window.getComputedStyle(o).listStyle,o.style.cssText=e}}function AB(o,e){for(;;){if(o.nodeType==3)return o;if(o.nodeType==1&&e>0){if(o.childNodes.length>e&&o.childNodes[e].nodeType==3)return o.childNodes[e];o=o.childNodes[e-1],e=Qs(o)}else if(o.nodeType==1&&e<o.childNodes.length)o=o.childNodes[e],e=0;else return null}}function gB(o,e,i,a){for(var l=0,u=0;l<o.childCount&&u<=a;){var f=o.child(l++),g=u;if(u+=f.nodeSize,!!f.isText){for(var _=f.text;l<o.childCount;){var I=o.child(l++);if(u+=I.nodeSize,!I.isText)break;_+=I.text}if(u>=i&&g<a){var T=_.lastIndexOf(e,a-g-1);if(T>=0&&T+e.length+g>=i)return g+T}}}return-1}function cE(o,e,i,a,l){for(var u=[],f=0,g=0;f<o.length;f++){var _=o[f],I=g,T=g+=_.size;I>=i||T<=e?u.push(_):(I<e&&u.push(_.slice(0,e-I,a)),l&&(u.push(l),l=null),T>i&&u.push(_.slice(i-I,_.size,a)))}return u}function V0(o,e){var i=o.root.getSelection(),a=o.state.doc;if(!i.focusNode)return null;var l=o.docView.nearestDesc(i.focusNode),u=l&&l.size==0,f=o.docView.posFromDOM(i.focusNode,i.focusOffset);if(f<0)return null;var g=a.resolve(f),_,I;if(nE(i)){for(_=g;l&&!l.node;)l=l.parent;if(l&&l.node.isAtom&&ke.isSelectable(l.node)&&l.parent&&!(l.node.isInline&&KP(i.focusNode,i.focusOffset,l.dom))){var T=l.posBefore;I=new ke(f==T?g:a.resolve(T))}}else{var N=o.docView.posFromDOM(i.anchorNode,i.anchorOffset);if(N<0)return null;_=a.resolve(N)}if(!I){var D=e=="pointer"||o.state.selection.head<g.pos&&!u?1:-1;I=dE(o,_,g,D)}return I}function G0(o){return o.editable?o.hasFocus():uE(o)&&document.activeElement&&document.activeElement.contains(o.dom)}function Xa(o,e){var i=o.state.selection;if(H0(o,i),!!G0(o)){if(!e&&o.mouseDown&&o.mouseDown.allowDefault&&Bt.chrome){var a=o.root.getSelection(),l=o.domObserver.currentSelection;if(a.anchorNode&&ku(a.anchorNode,a.anchorOffset,l.anchorNode,l.anchorOffset)){o.mouseDown.delayedSelectionSync=!0,o.domObserver.setCurSelection();return}}if(o.domObserver.disconnectSelection(),o.cursorWrapper)EB(o);else{var u=i.anchor,f=i.head,g,_;j0&&!(i instanceof cr)&&(i.$from.parent.inlineContent||(g=W0(o,i.from)),!i.empty&&!i.$from.parent.inlineContent&&(_=W0(o,i.to))),o.docView.setSelection(u,f,o.root,e),j0&&(g&&K0(g),_&&K0(_)),i.visible?o.dom.classList.remove("ProseMirror-hideselection"):(o.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&mB(o))}o.domObserver.setCurSelection(),o.domObserver.connectSelection()}}var j0=Bt.safari||Bt.chrome&&Bt.chrome_version<63;function W0(o,e){var i=o.docView.domFromPos(e,0),a=i.node,l=i.offset,u=l<a.childNodes.length?a.childNodes[l]:null,f=l?a.childNodes[l-1]:null;if(Bt.safari&&u&&u.contentEditable=="false")return lE(u);if((!u||u.contentEditable=="false")&&(!f||f.contentEditable=="false")){if(u)return lE(u);if(f)return lE(f)}}function lE(o){return o.contentEditable="true",Bt.safari&&o.draggable&&(o.draggable=!1,o.wasDraggable=!0),o}function K0(o){o.contentEditable="false",o.wasDraggable&&(o.draggable=!0,o.wasDraggable=null)}function mB(o){var e=o.dom.ownerDocument;e.removeEventListener("selectionchange",o.hideSelectionGuard);var i=o.root.getSelection(),a=i.anchorNode,l=i.anchorOffset;e.addEventListener("selectionchange",o.hideSelectionGuard=function(){(i.anchorNode!=a||i.anchorOffset!=l)&&(e.removeEventListener("selectionchange",o.hideSelectionGuard),setTimeout(function(){(!G0(o)||o.state.selection.visible)&&o.dom.classList.remove("ProseMirror-hideselection")},20))})}function EB(o){var e=o.root.getSelection(),i=document.createRange(),a=o.cursorWrapper.dom,l=a.nodeName=="IMG";l?i.setEnd(a.parentNode,bo(a)+1):i.setEnd(a,0),i.collapse(!1),e.removeAllRanges(),e.addRange(i),!l&&!o.state.selection.visible&&Bt.ie&&Bt.ie_version<=11&&(a.disabled=!0,a.disabled=!1)}function H0(o,e){if(e instanceof ke){var i=o.docView.descAt(e.from);i!=o.lastSelectedViewDesc&&(Y0(o),i&&i.selectNode(),o.lastSelectedViewDesc=i)}else Y0(o)}function Y0(o){o.lastSelectedViewDesc&&(o.lastSelectedViewDesc.parent&&o.lastSelectedViewDesc.deselectNode(),o.lastSelectedViewDesc=null)}function dE(o,e,i,a){return o.someProp("createSelectionBetween",function(l){return l(o,e,i)})||cr.between(e,i,a)}function _B(o){return o.editable&&o.root.activeElement!=o.dom?!1:uE(o)}function uE(o){var e=o.root.getSelection();if(!e.anchorNode)return!1;try{return o.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(o.editable||o.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function vB(o){var e=o.docView.domFromPos(o.state.selection.anchor,0),i=o.root.getSelection();return ku(e.node,e.offset,i.anchorNode,i.anchorOffset)}function hE(o,e){var i=o.selection,a=i.$anchor,l=i.$head,u=e>0?a.max(l):a.min(l),f=u.parent.inlineContent?u.depth?o.doc.resolve(e>0?u.after():u.before()):null:u;return f&&Ce.findFrom(f,e)}function Dc(o,e){return o.dispatch(o.state.tr.setSelection(e).scrollIntoView()),!0}function q0(o,e,i){var a=o.state.selection;if(a instanceof cr){if(!a.empty||i.indexOf("s")>-1)return!1;if(o.endOfTextblock(e>0?"right":"left")){var l=hE(o.state,e);return l&&l instanceof ke?Dc(o,l):!1}else if(!(Bt.mac&&i.indexOf("m")>-1)){var u=a.$head,f=u.textOffset?null:e<0?u.nodeBefore:u.nodeAfter,g;if(!f||f.isText)return!1;var _=e<0?u.pos-f.nodeSize:u.pos;return f.isAtom||(g=o.docView.descAt(_))&&!g.contentDOM?ke.isSelectable(f)?Dc(o,new ke(e<0?o.state.doc.resolve(u.pos-f.nodeSize):u)):Bt.webkit?Dc(o,new cr(o.state.doc.resolve(e<0?_:_+f.nodeSize))):!1:!1}}else{if(a instanceof ke&&a.node.isInline)return Dc(o,new cr(e>0?a.$to:a.$from));var I=hE(o.state,e);return I?Dc(o,I):!1}}function Xp(o){return o.nodeType==3?o.nodeValue.length:o.childNodes.length}function Bu(o){var e=o.pmViewDesc;return e&&e.size==0&&(o.nextSibling||o.nodeName!="BR")}function pE(o){var e=o.root.getSelection(),i=e.focusNode,a=e.focusOffset;if(!!i){var l,u,f=!1;for(Bt.gecko&&i.nodeType==1&&a<Xp(i)&&Bu(i.childNodes[a])&&(f=!0);;)if(a>0){if(i.nodeType!=1)break;var g=i.childNodes[a-1];if(Bu(g))l=i,u=--a;else if(g.nodeType==3)i=g,a=i.nodeValue.length;else break}else{if(J0(i))break;for(var _=i.previousSibling;_&&Bu(_);)l=i.parentNode,u=bo(_),_=_.previousSibling;if(_)i=_,a=Xp(i);else{if(i=i.parentNode,i==o.dom)break;a=0}}f?AE(o,e,i,a):l&&AE(o,e,l,u)}}function fE(o){var e=o.root.getSelection(),i=e.focusNode,a=e.focusOffset;if(!!i){for(var l=Xp(i),u,f;;)if(a<l){if(i.nodeType!=1)break;var g=i.childNodes[a];if(Bu(g))u=i,f=++a;else break}else{if(J0(i))break;for(var _=i.nextSibling;_&&Bu(_);)u=_.parentNode,f=bo(_)+1,_=_.nextSibling;if(_)i=_,a=0,l=Xp(i);else{if(i=i.parentNode,i==o.dom)break;a=l=0}}u&&AE(o,e,u,f)}}function J0(o){var e=o.pmViewDesc;return e&&e.node&&e.node.isBlock}function AE(o,e,i,a){if(nE(e)){var l=document.createRange();l.setEnd(i,a),l.setStart(i,a),e.removeAllRanges(),e.addRange(l)}else e.extend&&e.extend(i,a);o.domObserver.setCurSelection();var u=o.state;setTimeout(function(){o.state==u&&Xa(o)},50)}function z0(o,e,i){var a=o.state.selection;if(a instanceof cr&&!a.empty||i.indexOf("s")>-1||Bt.mac&&i.indexOf("m")>-1)return!1;var l=a.$from,u=a.$to;if(!l.parent.inlineContent||o.endOfTextblock(e<0?"up":"down")){var f=hE(o.state,e);if(f&&f instanceof ke)return Dc(o,f)}if(!l.parent.inlineContent){var g=e<0?l:u,_=a instanceof Ta?Ce.near(g,e):Ce.findFrom(g,e);return _?Dc(o,_):!1}return!1}function X0(o,e){if(!(o.state.selection instanceof cr))return!0;var i=o.state.selection,a=i.$head,l=i.$anchor,u=i.empty;if(!a.sameParent(l))return!0;if(!u)return!1;if(o.endOfTextblock(e>0?"forward":"backward"))return!0;var f=!a.textOffset&&(e<0?a.nodeBefore:a.nodeAfter);if(f&&!f.isText){var g=o.state.tr;return e<0?g.delete(a.pos-f.nodeSize,a.pos):g.delete(a.pos,a.pos+f.nodeSize),o.dispatch(g),!0}return!1}function Z0(o,e,i){o.domObserver.stop(),e.contentEditable=i,o.domObserver.start()}function IB(o){if(!(!Bt.safari||o.state.selection.$head.parentOffset>0)){var e=o.root.getSelection(),i=e.focusNode,a=e.focusOffset;if(i&&i.nodeType==1&&a==0&&i.firstChild&&i.firstChild.contentEditable=="false"){var l=i.firstChild;Z0(o,l,!0),setTimeout(function(){return Z0(o,l,!1)},20)}}}function CB(o){var e="";return o.ctrlKey&&(e+="c"),o.metaKey&&(e+="m"),o.altKey&&(e+="a"),o.shiftKey&&(e+="s"),e}function SB(o,e){var i=e.keyCode,a=CB(e);return i==8||Bt.mac&&i==72&&a=="c"?X0(o,-1)||pE(o):i==46||Bt.mac&&i==68&&a=="c"?X0(o,1)||fE(o):i==13||i==27?!0:i==37?q0(o,-1,a)||pE(o):i==39?q0(o,1,a)||fE(o):i==38?z0(o,-1,a)||pE(o):i==40?IB(o)||z0(o,1,a)||fE(o):a==(Bt.mac?"m":"c")&&(i==66||i==73||i==89||i==90)}function yB(o,e,i){var a=o.docView.parseRange(e,i),l=a.node,u=a.fromOffset,f=a.toOffset,g=a.from,_=a.to,I=o.root.getSelection(),T=null,N=I.anchorNode;if(N&&o.dom.contains(N.nodeType==1?N:N.parentNode)&&(T=[{node:N,offset:I.anchorOffset}],nE(I)||T.push({node:I.focusNode,offset:I.focusOffset})),Bt.chrome&&o.lastKeyCode===8)for(var D=f;D>u;D--){var F=l.childNodes[D-1],K=F.pmViewDesc;if(F.nodeName=="BR"&&!K){f=D;break}if(!K||K.size)break}var J=o.state.doc,nt=o.someProp("domParser")||ms.fromSchema(o.state.schema),it=J.resolve(g),z=null,Ot=nt.parse(l,{topNode:it.parent,topMatch:it.parent.contentMatchAt(it.index()),topOpen:!0,from:u,to:f,preserveWhitespace:it.parent.type.whitespace=="pre"?"full":!0,editableContent:!0,findPositions:T,ruleFromNode:TB,context:it});if(T&&T[0].pos!=null){var X=T[0].pos,yt=T[1]&&T[1].pos;yt==null&&(yt=X),z={anchor:X+g,head:yt+g}}return{doc:Ot,sel:z,from:g,to:_}}function TB(o){var e=o.pmViewDesc;if(e)return e.parseRule();if(o.nodeName=="BR"&&o.parentNode){if(Bt.safari&&/^(ul|ol)$/i.test(o.parentNode.nodeName)){var i=document.createElement("div");return i.appendChild(document.createElement("li")),{skip:i}}else if(o.parentNode.lastChild==o||Bt.safari&&/^(tr|table)$/i.test(o.parentNode.nodeName))return{ignore:!0}}else if(o.nodeName=="IMG"&&o.getAttribute("mark-placeholder"))return{ignore:!0}}function RB(o,e,i,a,l){if(e<0){var u=o.lastSelectionTime>Date.now()-50?o.lastSelectionOrigin:null,f=V0(o,u);if(f&&!o.state.selection.eq(f)){var g=o.state.tr.setSelection(f);u=="pointer"?g.setMeta("pointer",!0):u=="key"&&g.scrollIntoView(),o.dispatch(g)}return}var _=o.state.doc.resolve(e),I=_.sharedDepth(i);e=_.before(I+1),i=o.state.doc.resolve(i).after(I+1);var T=o.state.selection,N=yB(o,e,i);if(Bt.chrome&&o.cursorWrapper&&N.sel&&N.sel.anchor==o.cursorWrapper.deco.from){var D=o.cursorWrapper.deco.type.toDOM.nextSibling,F=D&&D.nodeValue?D.nodeValue.length:1;N.sel={anchor:N.sel.anchor+F,head:N.sel.anchor+F}}var K=o.state.doc,J=K.slice(N.from,N.to),nt,it;o.lastKeyCode===8&&Date.now()-100<o.lastKeyCodeTime?(nt=o.state.selection.to,it="end"):(nt=o.state.selection.from,it="start"),o.lastKeyCode=null;var z=NB(J.content,N.doc.content,N.from,nt,it);if(!z)if(a&&T instanceof cr&&!T.empty&&T.$head.sameParent(T.$anchor)&&!o.composing&&!(N.sel&&N.sel.anchor!=N.sel.head))z={start:T.from,endA:T.to,endB:T.to};else if((Bt.ios&&o.lastIOSEnter>Date.now()-225||Bt.android)&&l.some(function($e){return $e.nodeName=="DIV"||$e.nodeName=="P"})&&o.someProp("handleKeyDown",function($e){return $e(o,zl(13,"Enter"))})){o.lastIOSEnter=0;return}else{if(N.sel){var Ot=$0(o,o.state.doc,N.sel);Ot&&!Ot.eq(o.state.selection)&&o.dispatch(o.state.tr.setSelection(Ot))}return}o.domChangeCount++,o.state.selection.from<o.state.selection.to&&z.start==z.endB&&o.state.selection instanceof cr&&(z.start>o.state.selection.from&&z.start<=o.state.selection.from+2?z.start=o.state.selection.from:z.endA<o.state.selection.to&&z.endA>=o.state.selection.to-2&&(z.endB+=o.state.selection.to-z.endA,z.endA=o.state.selection.to)),Bt.ie&&Bt.ie_version<=11&&z.endB==z.start+1&&z.endA==z.start&&z.start>N.from&&N.doc.textBetween(z.start-N.from-1,z.start-N.from+1)==" \xA0"&&(z.start--,z.endA--,z.endB--);var X=N.doc.resolveNoCache(z.start-N.from),yt=N.doc.resolveNoCache(z.endB-N.from),Mt=X.sameParent(yt)&&X.parent.inlineContent,$t;if((Bt.ios&&o.lastIOSEnter>Date.now()-225&&(!Mt||l.some(function($e){return $e.nodeName=="DIV"||$e.nodeName=="P"}))||!Mt&&X.pos<N.doc.content.size&&($t=Ce.findFrom(N.doc.resolve(X.pos+1),1,!0))&&$t.head==yt.pos)&&o.someProp("handleKeyDown",function($e){return $e(o,zl(13,"Enter"))})){o.lastIOSEnter=0;return}if(o.state.selection.anchor>z.start&&bB(K,z.start,z.endA,X,yt)&&o.someProp("handleKeyDown",function($e){return $e(o,zl(8,"Backspace"))})){Bt.android&&Bt.chrome&&o.domObserver.suppressSelectionUpdates();return}Bt.chrome&&Bt.android&&z.toB==z.from&&(o.lastAndroidDelete=Date.now()),Bt.android&&!Mt&&X.start()!=yt.start()&&yt.parentOffset==0&&X.depth==yt.depth&&N.sel&&N.sel.anchor==N.sel.head&&N.sel.head==z.endA&&(z.endB-=2,yt=N.doc.resolveNoCache(z.endB-N.from),setTimeout(function(){o.someProp("handleKeyDown",function($e){return $e(o,zl(13,"Enter"))})},20));var ge=z.start,Te=z.endA,Se,lr,Er,sr;if(Mt){if(X.pos==yt.pos)Bt.ie&&Bt.ie_version<=11&&X.parentOffset==0&&(o.domObserver.suppressSelectionUpdates(),setTimeout(function(){return Xa(o)},20)),Se=o.state.tr.delete(ge,Te),lr=K.resolve(z.start).marksAcross(K.resolve(z.endA));else if(z.endA==z.endB&&(sr=K.resolve(z.start))&&(Er=wB(X.parent.content.cut(X.parentOffset,yt.parentOffset),sr.parent.content.cut(sr.parentOffset,z.endA-sr.start()))))Se=o.state.tr,Er.type=="add"?Se.addMark(ge,Te,Er.mark):Se.removeMark(ge,Te,Er.mark);else if(X.parent.child(X.index()).isText&&X.index()==yt.index()-(yt.textOffset?0:1)){var Yn=X.parent.textBetween(X.parentOffset,yt.parentOffset);if(o.someProp("handleTextInput",function($e){return $e(o,ge,Te,Yn)}))return;Se=o.state.tr.insertText(Yn,ge,Te)}}if(Se||(Se=o.state.tr.replace(ge,Te,N.doc.slice(z.start-N.from,z.endB-N.from))),N.sel){var br=$0(o,Se.doc,N.sel);br&&!(Bt.chrome&&Bt.android&&o.composing&&br.empty&&(z.start!=z.endB||o.lastAndroidDelete<Date.now()-100)&&(br.head==ge||br.head==Se.mapping.map(Te)-1)||Bt.ie&&br.empty&&br.head==ge)&&Se.setSelection(br)}lr&&Se.ensureMarks(lr),o.dispatch(Se.scrollIntoView())}function $0(o,e,i){return Math.max(i.anchor,i.head)>e.content.size?null:dE(o,e.resolve(i.anchor),e.resolve(i.head))}function wB(o,e){for(var i=o.firstChild.marks,a=e.firstChild.marks,l=i,u=a,f,g,_,I=0;I<a.length;I++)l=a[I].removeFromSet(l);for(var T=0;T<i.length;T++)u=i[T].removeFromSet(u);if(l.length==1&&u.length==0)g=l[0],f="add",_=function(F){return F.mark(g.addToSet(F.marks))};else if(l.length==0&&u.length==1)g=u[0],f="remove",_=function(F){return F.mark(g.removeFromSet(F.marks))};else return null;for(var N=[],D=0;D<e.childCount;D++)N.push(_(e.child(D)));if(Nt.from(N).eq(o))return{mark:g,type:f}}function bB(o,e,i,a,l){if(!a.parent.isTextblock||i-e<=l.pos-a.pos||gE(a,!0,!1)<l.pos)return!1;var u=o.resolve(e);if(u.parentOffset<u.parent.content.size||!u.parent.isTextblock)return!1;var f=o.resolve(gE(u,!0,!0));return!f.parent.isTextblock||f.pos>i||gE(f,!0,!1)<i?!1:a.parent.content.cut(a.parentOffset).eq(f.parent.content)}function gE(o,e,i){for(var a=o.depth,l=e?o.end():o.pos;a>0&&(e||o.indexAfter(a)==o.node(a).childCount);)a--,l++,e=!1;if(i)for(var u=o.node(a).maybeChild(o.indexAfter(a));u&&!u.isLeaf;)u=u.firstChild,l++;return l}function NB(o,e,i,a,l){var u=o.findDiffStart(e,i);if(u==null)return null;var f=o.findDiffEnd(e,i+o.size,i+e.size),g=f.a,_=f.b;if(l=="end"){var I=Math.max(0,u-Math.min(g,_));a-=g+I-u}if(g<u&&o.size<e.size){var T=a<=u&&a>=g?u-a:0;u-=T,_=u+(_-g),g=u}else if(_<u){var N=a<=u&&a>=_?u-a:0;u-=N,g=u+(g-_),_=u}return{start:u,endA:g,endB:_}}function tw(o,e){for(var i=[],a=e.content,l=e.openStart,u=e.openEnd;l>1&&u>1&&a.childCount==1&&a.firstChild.childCount==1;){l--,u--;var f=a.firstChild;i.push(f.type.name,f.attrs!=f.type.defaultAttrs?f.attrs:null),a=f.content}var g=o.someProp("clipboardSerializer")||li.fromSchema(o.state.schema),_=cw(),I=_.createElement("div");I.appendChild(g.serializeFragment(a,{document:_}));for(var T=I.firstChild,N;T&&T.nodeType==1&&(N=sw[T.nodeName.toLowerCase()]);){for(var D=N.length-1;D>=0;D--){for(var F=_.createElement(N[D]);I.firstChild;)F.appendChild(I.firstChild);I.appendChild(F),N[D]!="tbody"&&(l++,u++)}T=I.firstChild}T&&T.nodeType==1&&T.setAttribute("data-pm-slice",l+" "+u+" "+JSON.stringify(i));var K=o.someProp("clipboardTextSerializer",function(J){return J(e)})||e.content.textBetween(0,e.content.size,`

`);return{dom:I,text:K}}function ew(o,e,i,a,l){var u,f=l.parent.type.spec.code,g;if(!i&&!e)return null;var _=e&&(a||f||!i);if(_){if(o.someProp("transformPastedText",function(yt){e=yt(e,f||a)}),f)return e?new Ht(Nt.from(o.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0):Ht.empty;var I=o.someProp("clipboardTextParser",function(yt){return yt(e,l,a)});if(I)g=I;else{var T=l.marks(),N=o.state,D=N.schema,F=li.fromSchema(D);u=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(function(yt){var Mt=u.appendChild(document.createElement("p"));yt&&Mt.appendChild(F.serializeNode(D.text(yt,T)))})}}else o.someProp("transformPastedHTML",function(yt){i=yt(i)}),u=DB(i),Bt.webkit&&LB(u);var K=u&&u.querySelector("[data-pm-slice]"),J=K&&/^(\d+) (\d+) (.*)/.exec(K.getAttribute("data-pm-slice"));if(!g){var nt=o.someProp("clipboardParser")||o.someProp("domParser")||ms.fromSchema(o.state.schema);g=nt.parseSlice(u,{preserveWhitespace:!!(_||J),context:l,ruleFromNode:function(Mt){if(Mt.nodeName=="BR"&&!Mt.nextSibling&&Mt.parentNode&&!OB.test(Mt.parentNode.nodeName))return{ignore:!0}}})}if(J)g=MB(ow(g,+J[1],+J[2]),J[3]);else if(g=Ht.maxOpen(kB(g.content,l),!0),g.openStart||g.openEnd){for(var it=0,z=0,Ot=g.content.firstChild;it<g.openStart&&!Ot.type.spec.isolating;it++,Ot=Ot.firstChild);for(var X=g.content.lastChild;z<g.openEnd&&!X.type.spec.isolating;z++,X=X.lastChild);g=ow(g,it,z)}return o.someProp("transformPasted",function(yt){g=yt(g)}),g}var OB=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function kB(o,e){if(o.childCount<2)return o;for(var i=function(u){var f=e.node(u),g=f.contentMatchAt(e.index(u)),_=void 0,I=[];if(o.forEach(function(T){if(!!I){var N=g.findWrapping(T.type),D;if(!N)return I=null;if(D=I.length&&_.length&&nw(N,_,T,I[I.length-1],0))I[I.length-1]=D;else{I.length&&(I[I.length-1]=iw(I[I.length-1],_.length));var F=rw(T,N);I.push(F),g=g.matchType(F.type,F.attrs),_=N}}}),I)return{v:Nt.from(I)}},a=e.depth;a>=0;a--){var l=i(a);if(l)return l.v}return o}function rw(o,e,i){i===void 0&&(i=0);for(var a=e.length-1;a>=i;a--)o=e[a].create(null,Nt.from(o));return o}function nw(o,e,i,a,l){if(l<o.length&&l<e.length&&o[l]==e[l]){var u=nw(o,e,i,a.lastChild,l+1);if(u)return a.copy(a.content.replaceChild(a.childCount-1,u));var f=a.contentMatchAt(a.childCount);if(f.matchType(l==o.length-1?i.type:o[l+1]))return a.copy(a.content.append(Nt.from(rw(i,o,l+1))))}}function iw(o,e){if(e==0)return o;var i=o.content.replaceChild(o.childCount-1,iw(o.lastChild,e-1)),a=o.contentMatchAt(o.childCount).fillBefore(Nt.empty,!0);return o.copy(i.append(a))}function mE(o,e,i,a,l,u){var f=e<0?o.firstChild:o.lastChild,g=f.content;return l<a-1&&(g=mE(g,e,i,a,l+1,u)),l>=i&&(g=e<0?f.contentMatchAt(0).fillBefore(g,o.childCount>1||u<=l).append(g):g.append(f.contentMatchAt(f.childCount).fillBefore(Nt.empty,!0))),o.replaceChild(e<0?0:o.childCount-1,f.copy(g))}function ow(o,e,i){return e<o.openStart&&(o=new Ht(mE(o.content,-1,e,o.openStart,0,o.openEnd),e,o.openEnd)),i<o.openEnd&&(o=new Ht(mE(o.content,1,i,o.openEnd,0,0),o.openStart,i)),o}var sw={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]},aw=null;function cw(){return aw||(aw=document.implementation.createHTMLDocument("title"))}function DB(o){var e=/^(\s*<meta [^>]*>)*/.exec(o);e&&(o=o.slice(e[0].length));var i=cw().createElement("div"),a=/<([a-z][^>\s]+)/i.exec(o),l;if((l=a&&sw[a[1].toLowerCase()])&&(o=l.map(function(f){return"<"+f+">"}).join("")+o+l.map(function(f){return"</"+f+">"}).reverse().join("")),i.innerHTML=o,l)for(var u=0;u<l.length;u++)i=i.querySelector(l[u])||i;return i}function LB(o){for(var e=o.querySelectorAll(Bt.chrome?"span:not([class]):not([style])":"span.Apple-converted-space"),i=0;i<e.length;i++){var a=e[i];a.childNodes.length==1&&a.textContent=="\xA0"&&a.parentNode&&a.parentNode.replaceChild(o.ownerDocument.createTextNode(" "),a)}}function MB(o,e){if(!o.size)return o;var i=o.content.firstChild.type.schema,a;try{a=JSON.parse(e)}catch{return o}for(var l=o.content,u=o.openStart,f=o.openEnd,g=a.length-2;g>=0;g-=2){var _=i.nodes[a[g]];if(!_||_.hasRequiredAttrs())break;l=Nt.from(_.create(a[g+1],l)),u++,f++}return new Ht(l,u,f)}var PB={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},EE=Bt.ie&&Bt.ie_version<=11,_E=function(){this.anchorNode=this.anchorOffset=this.focusNode=this.focusOffset=null};_E.prototype.set=function(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset};_E.prototype.eq=function(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset};var No=function(e,i){var a=this;this.view=e,this.handleDOMChange=i,this.queue=[],this.flushingSoon=-1,this.observer=window.MutationObserver&&new window.MutationObserver(function(l){for(var u=0;u<l.length;u++)a.queue.push(l[u]);Bt.ie&&Bt.ie_version<=11&&l.some(function(f){return f.type=="childList"&&f.removedNodes.length||f.type=="characterData"&&f.oldValue.length>f.target.nodeValue.length})?a.flushSoon():a.flush()}),this.currentSelection=new _E,EE&&(this.onCharData=function(l){a.queue.push({target:l.target,type:"characterData",oldValue:l.prevValue}),a.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.suppressingSelectionUpdates=!1};No.prototype.flushSoon=function(){var e=this;this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(function(){e.flushingSoon=-1,e.flush()},20))};No.prototype.forceFlush=function(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())};No.prototype.start=function(){this.observer&&this.observer.observe(this.view.dom,PB),EE&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()};No.prototype.stop=function(){var e=this;if(this.observer){var i=this.observer.takeRecords();if(i.length){for(var a=0;a<i.length;a++)this.queue.push(i[a]);window.setTimeout(function(){return e.flush()},20)}this.observer.disconnect()}EE&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()};No.prototype.connectSelection=function(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)};No.prototype.disconnectSelection=function(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)};No.prototype.suppressSelectionUpdates=function(){var e=this;this.suppressingSelectionUpdates=!0,setTimeout(function(){return e.suppressingSelectionUpdates=!1},50)};No.prototype.onSelectionChange=function(){if(!!_B(this.view)){if(this.suppressingSelectionUpdates)return Xa(this.view);if(Bt.ie&&Bt.ie_version<=11&&!this.view.state.selection.empty){var e=this.view.root.getSelection();if(e.focusNode&&ku(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}};No.prototype.setCurSelection=function(){this.currentSelection.set(this.view.root.getSelection())};No.prototype.ignoreSelectionChange=function(e){if(e.rangeCount==0)return!0;var i=e.getRangeAt(0).commonAncestorContainer,a=this.view.docView.nearestDesc(i);if(a&&a.ignoreMutation({type:"selection",target:i.nodeType==3?i.parentNode:i}))return this.setCurSelection(),!0};No.prototype.flush=function(){if(!(!this.view.docView||this.flushingSoon>-1)){var e=this.observer?this.observer.takeRecords():[];this.queue.length&&(e=this.queue.concat(e),this.queue.length=0);var i=this.view.root.getSelection(),a=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(i)&&uE(this.view)&&!this.ignoreSelectionChange(i),l=-1,u=-1,f=!1,g=[];if(this.view.editable)for(var _=0;_<e.length;_++){var I=this.registerMutation(e[_],g);I&&(l=l<0?I.from:Math.min(I.from,l),u=u<0?I.to:Math.max(I.to,u),I.typeOver&&(f=!0))}if(Bt.gecko&&g.length>1){var T=g.filter(function(F){return F.nodeName=="BR"});if(T.length==2){var N=T[0],D=T[1];N.parentNode&&N.parentNode.parentNode==D.parentNode?D.remove():N.remove()}}(l>-1||a)&&(l>-1&&(this.view.docView.markDirty(l,u),BB(this.view)),this.handleDOMChange(l,u,f,g),this.view.docView.dirty?this.view.updateState(this.view.state):this.currentSelection.eq(i)||Xa(this.view),this.currentSelection.set(i))}};No.prototype.registerMutation=function(e,i){if(i.indexOf(e.target)>-1)return null;var a=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(a==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!a||a.ignoreMutation(e))return null;if(e.type=="childList"){for(var l=0;l<e.addedNodes.length;l++)i.push(e.addedNodes[l]);if(a.contentDOM&&a.contentDOM!=a.dom&&!a.contentDOM.contains(e.target))return{from:a.posBefore,to:a.posAfter};var u=e.previousSibling,f=e.nextSibling;if(Bt.ie&&Bt.ie_version<=11&&e.addedNodes.length)for(var g=0;g<e.addedNodes.length;g++){var _=e.addedNodes[g],I=_.previousSibling,T=_.nextSibling;(!I||Array.prototype.indexOf.call(e.addedNodes,I)<0)&&(u=I),(!T||Array.prototype.indexOf.call(e.addedNodes,T)<0)&&(f=T)}var N=u&&u.parentNode==e.target?bo(u)+1:0,D=a.localPosFromDOM(e.target,N,-1),F=f&&f.parentNode==e.target?bo(f):e.target.childNodes.length,K=a.localPosFromDOM(e.target,F,1);return{from:D,to:K}}else return e.type=="attributes"?{from:a.posAtStart-a.border,to:a.posAtEnd+a.border}:{from:a.posAtStart,to:a.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}};var lw=!1;function BB(o){lw||(lw=!0,getComputedStyle(o.dom).whiteSpace=="normal"&&console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."))}var uo={},Hi={};function UB(o){o.shiftKey=!1,o.mouseDown=null,o.lastKeyCode=null,o.lastKeyCodeTime=0,o.lastClick={time:0,x:0,y:0,type:""},o.lastSelectionOrigin=null,o.lastSelectionTime=0,o.lastIOSEnter=0,o.lastIOSEnterFallbackTimeout=null,o.lastAndroidDelete=0,o.composing=!1,o.composingTimeout=null,o.compositionNodes=[],o.compositionEndedAt=-2e8,o.domObserver=new No(o,function(a,l,u,f){return RB(o,a,l,u,f)}),o.domObserver.start(),o.domChangeCount=0,o.eventHandlers=Object.create(null);var e=function(a){var l=uo[a];o.dom.addEventListener(a,o.eventHandlers[a]=function(u){FB(o,u)&&!IE(o,u)&&(o.editable||!(u.type in Hi))&&l(o,u)})};for(var i in uo)e(i);Bt.safari&&o.dom.addEventListener("input",function(){return null}),vE(o)}function Lc(o,e){o.lastSelectionOrigin=e,o.lastSelectionTime=Date.now()}function xB(o){o.domObserver.stop();for(var e in o.eventHandlers)o.dom.removeEventListener(e,o.eventHandlers[e]);clearTimeout(o.composingTimeout),clearTimeout(o.lastIOSEnterFallbackTimeout)}function vE(o){o.someProp("handleDOMEvents",function(e){for(var i in e)o.eventHandlers[i]||o.dom.addEventListener(i,o.eventHandlers[i]=function(a){return IE(o,a)})})}function IE(o,e){return o.someProp("handleDOMEvents",function(i){var a=i[e.type];return a?a(o,e)||e.defaultPrevented:!1})}function FB(o,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(var i=e.target;i!=o.dom;i=i.parentNode)if(!i||i.nodeType==11||i.pmViewDesc&&i.pmViewDesc.stopEvent(e))return!1;return!0}function QB(o,e){!IE(o,e)&&uo[e.type]&&(o.editable||!(e.type in Hi))&&uo[e.type](o,e)}Hi.keydown=function(o,e){if(o.shiftKey=e.keyCode==16||e.shiftKey,!uw(o,e)&&(o.lastKeyCode=e.keyCode,o.lastKeyCodeTime=Date.now(),!(Bt.android&&Bt.chrome&&e.keyCode==13)))if(e.keyCode!=229&&o.domObserver.forceFlush(),Bt.ios&&e.keyCode==13&&!e.ctrlKey&&!e.altKey&&!e.metaKey){var i=Date.now();o.lastIOSEnter=i,o.lastIOSEnterFallbackTimeout=setTimeout(function(){o.lastIOSEnter==i&&(o.someProp("handleKeyDown",function(a){return a(o,zl(13,"Enter"))}),o.lastIOSEnter=0)},200)}else o.someProp("handleKeyDown",function(a){return a(o,e)})||SB(o,e)?e.preventDefault():Lc(o,"key")};Hi.keyup=function(o,e){e.keyCode==16&&(o.shiftKey=!1)};Hi.keypress=function(o,e){if(!(uw(o,e)||!e.charCode||e.ctrlKey&&!e.altKey||Bt.mac&&e.metaKey)){if(o.someProp("handleKeyPress",function(l){return l(o,e)})){e.preventDefault();return}var i=o.state.selection;if(!(i instanceof cr)||!i.$from.sameParent(i.$to)){var a=String.fromCharCode(e.charCode);o.someProp("handleTextInput",function(l){return l(o,i.$from.pos,i.$to.pos,a)})||o.dispatch(o.state.tr.insertText(a).scrollIntoView()),e.preventDefault()}}};function Zp(o){return{left:o.clientX,top:o.clientY}}function VB(o,e){var i=e.x-o.clientX,a=e.y-o.clientY;return i*i+a*a<100}function CE(o,e,i,a,l){if(a==-1)return!1;for(var u=o.state.doc.resolve(a),f=function(I){if(o.someProp(e,function(T){return I>u.depth?T(o,i,u.nodeAfter,u.before(I),l,!0):T(o,i,u.node(I),u.before(I),l,!1)}))return{v:!0}},g=u.depth+1;g>0;g--){var _=f(g);if(_)return _.v}return!1}function Zl(o,e,i){o.focused||o.focus();var a=o.state.tr.setSelection(e);i=="pointer"&&a.setMeta("pointer",!0),o.dispatch(a)}function GB(o,e){if(e==-1)return!1;var i=o.state.doc.resolve(e),a=i.nodeAfter;return a&&a.isAtom&&ke.isSelectable(a)?(Zl(o,new ke(i),"pointer"),!0):!1}function jB(o,e){if(e==-1)return!1;var i=o.state.selection,a,l;i instanceof ke&&(a=i.node);for(var u=o.state.doc.resolve(e),f=u.depth+1;f>0;f--){var g=f>u.depth?u.nodeAfter:u.node(f);if(ke.isSelectable(g)){a&&i.$from.depth>0&&f>=i.$from.depth&&u.before(i.$from.depth+1)==i.$from.pos?l=u.before(i.$from.depth):l=u.before(f);break}}return l!=null?(Zl(o,ke.create(o.state.doc,l),"pointer"),!0):!1}function WB(o,e,i,a,l){return CE(o,"handleClickOn",e,i,a)||o.someProp("handleClick",function(u){return u(o,e,a)})||(l?jB(o,i):GB(o,i))}function KB(o,e,i,a){return CE(o,"handleDoubleClickOn",e,i,a)||o.someProp("handleDoubleClick",function(l){return l(o,e,a)})}function HB(o,e,i,a){return CE(o,"handleTripleClickOn",e,i,a)||o.someProp("handleTripleClick",function(l){return l(o,e,a)})||YB(o,i,a)}function YB(o,e,i){if(i.button!=0)return!1;var a=o.state.doc;if(e==-1)return a.inlineContent?(Zl(o,cr.create(a,0,a.content.size),"pointer"),!0):!1;for(var l=a.resolve(e),u=l.depth+1;u>0;u--){var f=u>l.depth?l.nodeAfter:l.node(u),g=l.before(u);if(f.inlineContent)Zl(o,cr.create(a,g+1,g+1+f.content.size),"pointer");else if(ke.isSelectable(f))Zl(o,ke.create(a,g),"pointer");else continue;return!0}}function SE(o){return tf(o)}var dw=Bt.mac?"metaKey":"ctrlKey";uo.mousedown=function(o,e){o.shiftKey=e.shiftKey;var i=SE(o),a=Date.now(),l="singleClick";a-o.lastClick.time<500&&VB(e,o.lastClick)&&!e[dw]&&(o.lastClick.type=="singleClick"?l="doubleClick":o.lastClick.type=="doubleClick"&&(l="tripleClick")),o.lastClick={time:a,x:e.clientX,y:e.clientY,type:l};var u=o.posAtCoords(Zp(e));!u||(l=="singleClick"?(o.mouseDown&&o.mouseDown.done(),o.mouseDown=new $p(o,u,e,i)):(l=="doubleClick"?KB:HB)(o,u.pos,u.inside,e)?e.preventDefault():Lc(o,"pointer"))};var $p=function(e,i,a,l){var u=this;this.view=e,this.startDoc=e.state.doc,this.pos=i,this.event=a,this.flushed=l,this.selectNode=a[dw],this.allowDefault=a.shiftKey,this.delayedSelectionSync=!1;var f,g;if(i.inside>-1)f=e.state.doc.nodeAt(i.inside),g=i.inside;else{var _=e.state.doc.resolve(i.pos);f=_.parent,g=_.depth?_.before():0}this.mightDrag=null;var I=l?null:a.target,T=I?e.docView.nearestDesc(I,!0):null;this.target=T?T.dom:null;var N=e.state,D=N.selection;(a.button==0&&f.type.spec.draggable&&f.type.spec.selectable!==!1||D instanceof ke&&D.from<=g&&D.to>g)&&(this.mightDrag={node:f,pos:g,addAttr:this.target&&!this.target.draggable,setUneditable:this.target&&Bt.gecko&&!this.target.hasAttribute("contentEditable")}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(function(){u.view.mouseDown==u&&u.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),Lc(e,"pointer")};$p.prototype.done=function(){var e=this;this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(function(){return Xa(e.view)}),this.view.mouseDown=null};$p.prototype.up=function(e){if(this.done(),!!this.view.dom.contains(e.target.nodeType==3?e.target.parentNode:e.target)){var i=this.pos;this.view.state.doc!=this.startDoc&&(i=this.view.posAtCoords(Zp(e))),this.allowDefault||!i?Lc(this.view,"pointer"):WB(this.view,i.pos,i.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||Bt.safari&&this.mightDrag&&!this.mightDrag.node.isAtom||Bt.chrome&&!(this.view.state.selection instanceof cr)&&Math.min(Math.abs(i.pos-this.view.state.selection.from),Math.abs(i.pos-this.view.state.selection.to))<=2)?(Zl(this.view,Ce.near(this.view.state.doc.resolve(i.pos)),"pointer"),e.preventDefault()):Lc(this.view,"pointer")}};$p.prototype.move=function(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0),Lc(this.view,"pointer"),e.buttons==0&&this.done()};uo.touchdown=function(o){SE(o),Lc(o,"pointer")};uo.contextmenu=function(o){return SE(o)};function uw(o,e){return o.composing?!0:Bt.safari&&Math.abs(e.timeStamp-o.compositionEndedAt)<500?(o.compositionEndedAt=-2e8,!0):!1}var qB=Bt.android?5e3:-1;Hi.compositionstart=Hi.compositionupdate=function(o){if(!o.composing){o.domObserver.flush();var e=o.state,i=e.selection.$from;if(e.selection.empty&&(e.storedMarks||!i.textOffset&&i.parentOffset&&i.nodeBefore.marks.some(function(g){return g.type.spec.inclusive===!1})))o.markCursor=o.state.storedMarks||i.marks(),tf(o,!0),o.markCursor=null;else if(tf(o),Bt.gecko&&e.selection.empty&&i.parentOffset&&!i.textOffset&&i.nodeBefore.marks.length)for(var a=o.root.getSelection(),l=a.focusNode,u=a.focusOffset;l&&l.nodeType==1&&u!=0;){var f=u<0?l.lastChild:l.childNodes[u-1];if(!f)break;if(f.nodeType==3){a.collapse(f,f.nodeValue.length);break}else l=f,u=-1}o.composing=!0}hw(o,qB)};Hi.compositionend=function(o,e){o.composing&&(o.composing=!1,o.compositionEndedAt=e.timeStamp,hw(o,20))};function hw(o,e){clearTimeout(o.composingTimeout),e>-1&&(o.composingTimeout=setTimeout(function(){return tf(o)},e))}function pw(o){for(o.composing&&(o.composing=!1,o.compositionEndedAt=JB());o.compositionNodes.length>0;)o.compositionNodes.pop().markParentsDirty()}function JB(){var o=document.createEvent("Event");return o.initEvent("event",!0,!0),o.timeStamp}function tf(o,e){if(!(Bt.android&&o.domObserver.flushingSoon>=0)){if(o.domObserver.forceFlush(),pw(o),e||o.docView.dirty){var i=V0(o);return i&&!i.eq(o.state.selection)?o.dispatch(o.state.tr.setSelection(i)):o.updateState(o.state),!0}return!1}}function zB(o,e){if(!!o.dom.parentNode){var i=o.dom.parentNode.appendChild(document.createElement("div"));i.appendChild(e),i.style.cssText="position: fixed; left: -10000px; top: 10px";var a=getSelection(),l=document.createRange();l.selectNodeContents(e),o.dom.blur(),a.removeAllRanges(),a.addRange(l),setTimeout(function(){i.parentNode&&i.parentNode.removeChild(i),o.focus()},50)}}var $l=Bt.ie&&Bt.ie_version<15||Bt.ios&&Bt.webkit_version<604;uo.copy=Hi.cut=function(o,e){var i=o.state.selection,a=e.type=="cut";if(!i.empty){var l=$l?null:e.clipboardData,u=i.content(),f=tw(o,u),g=f.dom,_=f.text;l?(e.preventDefault(),l.clearData(),l.setData("text/html",g.innerHTML),l.setData("text/plain",_)):zB(o,g),a&&o.dispatch(o.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))}};function XB(o){return o.openStart==0&&o.openEnd==0&&o.content.childCount==1?o.content.firstChild:null}function ZB(o,e){if(!!o.dom.parentNode){var i=o.shiftKey||o.state.selection.$from.parent.type.spec.code,a=o.dom.parentNode.appendChild(document.createElement(i?"textarea":"div"));i||(a.contentEditable="true"),a.style.cssText="position: fixed; left: -10000px; top: 10px",a.focus(),setTimeout(function(){o.focus(),a.parentNode&&a.parentNode.removeChild(a),i?yE(o,a.value,null,e):yE(o,a.textContent,a.innerHTML,e)},50)}}function yE(o,e,i,a){var l=ew(o,e,i,o.shiftKey,o.state.selection.$from);if(o.someProp("handlePaste",function(g){return g(o,a,l||Ht.empty)}))return!0;if(!l)return!1;var u=XB(l),f=u?o.state.tr.replaceSelectionWith(u,o.shiftKey):o.state.tr.replaceSelection(l);return o.dispatch(f.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}Hi.paste=function(o,e){if(!(o.composing&&!Bt.android)){var i=$l?null:e.clipboardData;i&&yE(o,i.getData("text/plain"),i.getData("text/html"),e)?e.preventDefault():ZB(o,e)}};var $B=function(e,i){this.slice=e,this.move=i},fw=Bt.mac?"altKey":"ctrlKey";uo.dragstart=function(o,e){var i=o.mouseDown;if(i&&i.done(),!!e.dataTransfer){var a=o.state.selection,l=a.empty?null:o.posAtCoords(Zp(e));if(!(l&&l.pos>=a.from&&l.pos<=(a instanceof ke?a.to-1:a.to))){if(i&&i.mightDrag)o.dispatch(o.state.tr.setSelection(ke.create(o.state.doc,i.mightDrag.pos)));else if(e.target&&e.target.nodeType==1){var u=o.docView.nearestDesc(e.target,!0);u&&u.node.type.spec.draggable&&u!=o.docView&&o.dispatch(o.state.tr.setSelection(ke.create(o.state.doc,u.posBefore)))}}var f=o.state.selection.content(),g=tw(o,f),_=g.dom,I=g.text;e.dataTransfer.clearData(),e.dataTransfer.setData($l?"Text":"text/html",_.innerHTML),e.dataTransfer.effectAllowed="copyMove",$l||e.dataTransfer.setData("text/plain",I),o.dragging=new $B(f,!e[fw])}};uo.dragend=function(o){var e=o.dragging;window.setTimeout(function(){o.dragging==e&&(o.dragging=null)},50)};Hi.dragover=Hi.dragenter=function(o,e){return e.preventDefault()};Hi.drop=function(o,e){var i=o.dragging;if(o.dragging=null,!!e.dataTransfer){var a=o.posAtCoords(Zp(e));if(!!a){var l=o.state.doc.resolve(a.pos);if(!!l){var u=i&&i.slice;u?o.someProp("transformPasted",function(K){u=K(u)}):u=ew(o,e.dataTransfer.getData($l?"Text":"text/plain"),$l?null:e.dataTransfer.getData("text/html"),!1,l);var f=i&&!e[fw];if(o.someProp("handleDrop",function(K){return K(o,e,u||Ht.empty,f)})){e.preventDefault();return}if(!!u){e.preventDefault();var g=u?WR(o.state.doc,l.pos,u):l.pos;g==null&&(g=l.pos);var _=o.state.tr;f&&_.deleteSelection();var I=_.mapping.map(g),T=u.openStart==0&&u.openEnd==0&&u.content.childCount==1,N=_.doc;if(T?_.replaceRangeWith(I,I,u.content.firstChild):_.replaceRange(I,I,u),!_.doc.eq(N)){var D=_.doc.resolve(I);if(T&&ke.isSelectable(u.content.firstChild)&&D.nodeAfter&&D.nodeAfter.sameMarkup(u.content.firstChild))_.setSelection(new ke(D));else{var F=_.mapping.map(g);_.mapping.maps[_.mapping.maps.length-1].forEach(function(K,J,nt,it){return F=it}),_.setSelection(dE(o,D,_.doc.resolve(F)))}o.focus(),o.dispatch(_.setMeta("uiEvent","drop"))}}}}}};uo.focus=function(o){o.focused||(o.domObserver.stop(),o.dom.classList.add("ProseMirror-focused"),o.domObserver.start(),o.focused=!0,setTimeout(function(){o.docView&&o.hasFocus()&&!o.domObserver.currentSelection.eq(o.root.getSelection())&&Xa(o)},20))};uo.blur=function(o,e){o.focused&&(o.domObserver.stop(),o.dom.classList.remove("ProseMirror-focused"),o.domObserver.start(),e.relatedTarget&&o.dom.contains(e.relatedTarget)&&o.domObserver.currentSelection.set({}),o.focused=!1)};uo.beforeinput=function(o,e){if(Bt.chrome&&Bt.android&&e.inputType=="deleteContentBackward"){o.domObserver.flushSoon();var i=o.domChangeCount;setTimeout(function(){if(o.domChangeCount==i&&(o.dom.blur(),o.focus(),!o.someProp("handleKeyDown",function(u){return u(o,zl(8,"Backspace"))}))){var a=o.state.selection,l=a.$cursor;l&&l.pos>0&&o.dispatch(o.state.tr.delete(l.pos-1,l.pos).scrollIntoView())}},50)}};for(var Aw in Hi)uo[Aw]=Hi[Aw];function Uu(o,e){if(o==e)return!0;for(var i in o)if(o[i]!==e[i])return!1;for(var a in e)if(!(a in o))return!1;return!0}var td=function(e,i){this.spec=i||Mc,this.side=this.spec.side||0,this.toDOM=e};td.prototype.map=function(e,i,a,l){var u=e.mapResult(i.from+l,this.side<0?-1:1),f=u.pos,g=u.deleted;return g?null:new Qn(f-a,f-a,this)};td.prototype.valid=function(){return!0};td.prototype.eq=function(e){return this==e||e instanceof td&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&Uu(this.spec,e.spec))};td.prototype.destroy=function(e){this.spec.destroy&&this.spec.destroy(e)};var _s=function(e,i){this.spec=i||Mc,this.attrs=e};_s.prototype.map=function(e,i,a,l){var u=e.map(i.from+l,this.spec.inclusiveStart?-1:1)-a,f=e.map(i.to+l,this.spec.inclusiveEnd?1:-1)-a;return u>=f?null:new Qn(u,f,this)};_s.prototype.valid=function(e,i){return i.from<i.to};_s.prototype.eq=function(e){return this==e||e instanceof _s&&Uu(this.attrs,e.attrs)&&Uu(this.spec,e.spec)};_s.is=function(e){return e.type instanceof _s};var xu=function(e,i){this.spec=i||Mc,this.attrs=e};xu.prototype.map=function(e,i,a,l){var u=e.mapResult(i.from+l,1);if(u.deleted)return null;var f=e.mapResult(i.to+l,-1);return f.deleted||f.pos<=u.pos?null:new Qn(u.pos-a,f.pos-a,this)};xu.prototype.valid=function(e,i){var a=e.content.findIndex(i.from),l=a.index,u=a.offset,f;return u==i.from&&!(f=e.child(l)).isText&&u+f.nodeSize==i.to};xu.prototype.eq=function(e){return this==e||e instanceof xu&&Uu(this.attrs,e.attrs)&&Uu(this.spec,e.spec)};var Qn=function(e,i,a){this.from=e,this.to=i,this.type=a},TE={spec:{configurable:!0},inline:{configurable:!0}};Qn.prototype.copy=function(e,i){return new Qn(e,i,this.type)};Qn.prototype.eq=function(e,i){return i===void 0&&(i=0),this.type.eq(e.type)&&this.from+i==e.from&&this.to+i==e.to};Qn.prototype.map=function(e,i,a){return this.type.map(e,this,i,a)};Qn.widget=function(e,i,a){return new Qn(e,e,new td(i,a))};Qn.inline=function(e,i,a,l){return new Qn(e,i,new _s(a,l))};Qn.node=function(e,i,a,l){return new Qn(e,i,new xu(a,l))};TE.spec.get=function(){return this.type.spec};TE.inline.get=function(){return this.type instanceof _s};Object.defineProperties(Qn.prototype,TE);var ef=[],Mc={},wr=function(e,i){this.local=e&&e.length?e:ef,this.children=i&&i.length?i:ef};wr.create=function(e,i){return i.length?rf(i,e,0,Mc):ui};wr.prototype.find=function(e,i,a){var l=[];return this.findInner(e==null?0:e,i==null?1e9:i,l,0,a),l};wr.prototype.findInner=function(e,i,a,l,u){for(var f=0;f<this.local.length;f++){var g=this.local[f];g.from<=i&&g.to>=e&&(!u||u(g.spec))&&a.push(g.copy(g.from+l,g.to+l))}for(var _=0;_<this.children.length;_+=3)if(this.children[_]<i&&this.children[_+1]>e){var I=this.children[_]+1;this.children[_+2].findInner(e-I,i-I,a,l+I,u)}};wr.prototype.map=function(e,i,a){return this==ui||e.maps.length==0?this:this.mapInner(e,i,0,0,a||Mc)};wr.prototype.mapInner=function(e,i,a,l,u){for(var f,g=0;g<this.local.length;g++){var _=this.local[g].map(e,a,l);_&&_.type.valid(i,_)?(f||(f=[])).push(_):u.onRemove&&u.onRemove(this.local[g].spec)}return this.children.length?tU(this.children,f,e,i,a,l,u):f?new wr(f.sort(Pc)):ui};wr.prototype.add=function(e,i){return i.length?this==ui?wr.create(e,i):this.addInner(e,i,0):this};wr.prototype.addInner=function(e,i,a){var l=this,u,f=0;e.forEach(function(I,T){var N=T+a,D;if(!!(D=mw(i,I,N))){for(u||(u=l.children.slice());f<u.length&&u[f]<T;)f+=3;u[f]==T?u[f+2]=u[f+2].addInner(I,D,N+1):u.splice(f,0,T,T+I.nodeSize,rf(D,I,N+1,Mc)),f+=3}});for(var g=gw(f?Ew(i):i,-a),_=0;_<g.length;_++)g[_].type.valid(e,g[_])||g.splice(_--,1);return new wr(g.length?this.local.concat(g).sort(Pc):this.local,u||this.children)};wr.prototype.remove=function(e){return e.length==0||this==ui?this:this.removeInner(e,0)};wr.prototype.removeInner=function(e,i){for(var a=this.children,l=this.local,u=0;u<a.length;u+=3){for(var f=void 0,g=a[u]+i,_=a[u+1]+i,I=0,T=void 0;I<e.length;I++)(T=e[I])&&T.from>g&&T.to<_&&(e[I]=null,(f||(f=[])).push(T));if(!!f){a==this.children&&(a=this.children.slice());var N=a[u+2].removeInner(f,g+1);N!=ui?a[u+2]=N:(a.splice(u,3),u-=3)}}if(l.length){for(var D=0,F=void 0;D<e.length;D++)if(F=e[D])for(var K=0;K<l.length;K++)l[K].eq(F,i)&&(l==this.local&&(l=this.local.slice()),l.splice(K--,1))}return a==this.children&&l==this.local?this:l.length||a.length?new wr(l,a):ui};wr.prototype.forChild=function(e,i){if(this==ui)return this;if(i.isLeaf)return wr.empty;for(var a,l,u=0;u<this.children.length;u+=3)if(this.children[u]>=e){this.children[u]==e&&(a=this.children[u+2]);break}for(var f=e+1,g=f+i.content.size,_=0;_<this.local.length;_++){var I=this.local[_];if(I.from<g&&I.to>f&&I.type instanceof _s){var T=Math.max(f,I.from)-f,N=Math.min(g,I.to)-f;T<N&&(l||(l=[])).push(I.copy(T,N))}}if(l){var D=new wr(l.sort(Pc));return a?new zo([D,a]):D}return a||ui};wr.prototype.eq=function(e){if(this==e)return!0;if(!(e instanceof wr)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(var i=0;i<this.local.length;i++)if(!this.local[i].eq(e.local[i]))return!1;for(var a=0;a<this.children.length;a+=3)if(this.children[a]!=e.children[a]||this.children[a+1]!=e.children[a+1]||!this.children[a+2].eq(e.children[a+2]))return!1;return!0};wr.prototype.locals=function(e){return RE(this.localsInner(e))};wr.prototype.localsInner=function(e){if(this==ui)return ef;if(e.inlineContent||!this.local.some(_s.is))return this.local;for(var i=[],a=0;a<this.local.length;a++)this.local[a].type instanceof _s||i.push(this.local[a]);return i};var ui=new wr;wr.empty=ui;wr.removeOverlap=RE;var zo=function(e){this.members=e};zo.prototype.map=function(e,i){var a=this.members.map(function(l){return l.map(e,i,Mc)});return zo.from(a)};zo.prototype.forChild=function(e,i){if(i.isLeaf)return wr.empty;for(var a=[],l=0;l<this.members.length;l++){var u=this.members[l].forChild(e,i);u!=ui&&(u instanceof zo?a=a.concat(u.members):a.push(u))}return zo.from(a)};zo.prototype.eq=function(e){if(!(e instanceof zo)||e.members.length!=this.members.length)return!1;for(var i=0;i<this.members.length;i++)if(!this.members[i].eq(e.members[i]))return!1;return!0};zo.prototype.locals=function(e){for(var i,a=!0,l=0;l<this.members.length;l++){var u=this.members[l].localsInner(e);if(!!u.length)if(!i)i=u;else{a&&(i=i.slice(),a=!1);for(var f=0;f<u.length;f++)i.push(u[f])}}return i?RE(a?i:i.sort(Pc)):ef};zo.from=function(e){switch(e.length){case 0:return ui;case 1:return e[0];default:return new zo(e)}};function tU(o,e,i,a,l,u,f){for(var g=o.slice(),_=function(lr,Er,sr,Yn){for(var br=0;br<g.length;br+=3){var $e=g[br+1],_n=void 0;$e==-1||lr>$e+u||(Er>=g[br]+u?g[br+1]=-1:sr>=l&&(_n=Yn-sr-(Er-lr))&&(g[br]+=_n,g[br+1]+=_n))}},I=0;I<i.maps.length;I++)i.maps[I].forEach(_);for(var T=!1,N=0;N<g.length;N+=3)if(g[N+1]==-1){var D=i.map(o[N]+u),F=D-l;if(F<0||F>=a.content.size){T=!0;continue}var K=i.map(o[N+1]+u,-1),J=K-l,nt=a.content.findIndex(F),it=nt.index,z=nt.offset,Ot=a.maybeChild(it);if(Ot&&z==F&&z+Ot.nodeSize==J){var X=g[N+2].mapInner(i,Ot,D+1,o[N]+u+1,f);X!=ui?(g[N]=F,g[N+1]=J,g[N+2]=X):(g[N+1]=-2,T=!0)}else T=!0}if(T){var yt=eU(g,o,e||[],i,l,u,f),Mt=rf(yt,a,0,f);e=Mt.local;for(var $t=0;$t<g.length;$t+=3)g[$t+1]<0&&(g.splice($t,3),$t-=3);for(var ge=0,Te=0;ge<Mt.children.length;ge+=3){for(var Se=Mt.children[ge];Te<g.length&&g[Te]<Se;)Te+=3;g.splice(Te,0,Mt.children[ge],Mt.children[ge+1],Mt.children[ge+2])}}return new wr(e&&e.sort(Pc),g)}function gw(o,e){if(!e||!o.length)return o;for(var i=[],a=0;a<o.length;a++){var l=o[a];i.push(new Qn(l.from+e,l.to+e,l.type))}return i}function eU(o,e,i,a,l,u,f){function g(I,T){for(var N=0;N<I.local.length;N++){var D=I.local[N].map(a,l,T);D?i.push(D):f.onRemove&&f.onRemove(I.local[N].spec)}for(var F=0;F<I.children.length;F+=3)g(I.children[F+2],I.children[F]+T+1)}for(var _=0;_<o.length;_+=3)o[_+1]==-1&&g(o[_+2],e[_]+u+1);return i}function mw(o,e,i){if(e.isLeaf)return null;for(var a=i+e.nodeSize,l=null,u=0,f=void 0;u<o.length;u++)(f=o[u])&&f.from>i&&f.to<a&&((l||(l=[])).push(f),o[u]=null);return l}function Ew(o){for(var e=[],i=0;i<o.length;i++)o[i]!=null&&e.push(o[i]);return e}function rf(o,e,i,a){var l=[],u=!1;e.forEach(function(_,I){var T=mw(o,_,I+i);if(T){u=!0;var N=rf(T,_,i+I+1,a);N!=ui&&l.push(I,I+_.nodeSize,N)}});for(var f=gw(u?Ew(o):o,-i).sort(Pc),g=0;g<f.length;g++)f[g].type.valid(e,f[g])||(a.onRemove&&a.onRemove(f[g].spec),f.splice(g--,1));return f.length||l.length?new wr(f,l):ui}function Pc(o,e){return o.from-e.from||o.to-e.to}function RE(o){for(var e=o,i=0;i<e.length-1;i++){var a=e[i];if(a.from!=a.to)for(var l=i+1;l<e.length;l++){var u=e[l];if(u.from==a.from){u.to!=a.to&&(e==o&&(e=o.slice()),e[l]=u.copy(u.from,a.to),_w(e,l+1,u.copy(a.to,u.to)));continue}else{u.from<a.to&&(e==o&&(e=o.slice()),e[i]=a.copy(a.from,u.from),_w(e,l,a.copy(u.from,a.to)));break}}}return e}function _w(o,e,i){for(;e<o.length&&Pc(i,o[e])>0;)e++;o.splice(e,0,i)}function wE(o){var e=[];return o.someProp("decorations",function(i){var a=i(o.state);a&&a!=ui&&e.push(a)}),o.cursorWrapper&&e.push(wr.create(o.state.doc,[o.cursorWrapper.deco])),zo.from(e)}var Vn=function(e,i){this._props=i,this.state=i.state,this.directPlugins=i.plugins||[],this.directPlugins.forEach(yw),this.dispatch=this.dispatch.bind(this),this._root=null,this.focused=!1,this.trackWrites=null,this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):e.apply?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=Cw(this),this.markCursor=null,this.cursorWrapper=null,Iw(this),this.nodeViews=Sw(this),this.docView=M0(this.state.doc,vw(this),wE(this),this.dom,this),this.lastSelectedViewDesc=null,this.dragging=null,UB(this),this.prevDirectPlugins=[],this.pluginViews=[],this.updatePluginViews()},nf={props:{configurable:!0},root:{configurable:!0},isDestroyed:{configurable:!0}};nf.props.get=function(){if(this._props.state!=this.state){var o=this._props;this._props={};for(var e in o)this._props[e]=o[e];this._props.state=this.state}return this._props};Vn.prototype.update=function(e){e.handleDOMEvents!=this._props.handleDOMEvents&&vE(this),this._props=e,e.plugins&&(e.plugins.forEach(yw),this.directPlugins=e.plugins),this.updateStateInner(e.state,!0)};Vn.prototype.setProps=function(e){var i={};for(var a in this._props)i[a]=this._props[a];i.state=this.state;for(var l in e)i[l]=e[l];this.update(i)};Vn.prototype.updateState=function(e){this.updateStateInner(e,this.state.plugins!=e.plugins)};Vn.prototype.updateStateInner=function(e,i){var a=this,l=this.state,u=!1,f=!1;if(e.storedMarks&&this.composing&&(pw(this),f=!0),this.state=e,i){var g=Sw(this);nU(g,this.nodeViews)&&(this.nodeViews=g,u=!0),vE(this)}this.editable=Cw(this),Iw(this);var _=wE(this),I=vw(this),T=i?"reset":e.scrollToSelection>l.scrollToSelection?"to selection":"preserve",N=u||!this.docView.matchesNode(e.doc,I,_);(N||!e.selection.eq(l.selection))&&(f=!0);var D=T=="preserve"&&f&&this.dom.style.overflowAnchor==null&&JP(this);if(f){this.domObserver.stop();var F=N&&(Bt.ie||Bt.chrome)&&!this.composing&&!l.selection.empty&&!e.selection.empty&&rU(l.selection,e.selection);if(N){var K=Bt.chrome?this.trackWrites=this.root.getSelection().focusNode:null;(u||!this.docView.update(e.doc,I,_,this))&&(this.docView.updateOuterDeco([]),this.docView.destroy(),this.docView=M0(e.doc,I,_,this.dom,this)),K&&!this.trackWrites&&(F=!0)}F||!(this.mouseDown&&this.domObserver.currentSelection.eq(this.root.getSelection())&&vB(this))?Xa(this,F):(H0(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}if(this.updatePluginViews(l),T=="reset")this.dom.scrollTop=0;else if(T=="to selection"){var J=this.root.getSelection().focusNode;this.someProp("handleScrollToSelection",function(nt){return nt(a)})||(e.selection instanceof ke?C0(this,this.docView.domAfterPos(e.selection.from).getBoundingClientRect(),J):C0(this,this.coordsAtPos(e.selection.head,1),J))}else D&&zP(D)};Vn.prototype.destroyPluginViews=function(){for(var e;e=this.pluginViews.pop();)e.destroy&&e.destroy()};Vn.prototype.updatePluginViews=function(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(var i=0;i<this.directPlugins.length;i++){var a=this.directPlugins[i];a.spec.view&&this.pluginViews.push(a.spec.view(this))}for(var l=0;l<this.state.plugins.length;l++){var u=this.state.plugins[l];u.spec.view&&this.pluginViews.push(u.spec.view(this))}}else for(var f=0;f<this.pluginViews.length;f++){var g=this.pluginViews[f];g.update&&g.update(this,e)}};Vn.prototype.someProp=function(e,i){var a=this._props&&this._props[e],l;if(a!=null&&(l=i?i(a):a))return l;for(var u=0;u<this.directPlugins.length;u++){var f=this.directPlugins[u].props[e];if(f!=null&&(l=i?i(f):f))return l}var g=this.state.plugins;if(g)for(var _=0;_<g.length;_++){var I=g[_].props[e];if(I!=null&&(l=i?i(I):I))return l}};Vn.prototype.hasFocus=function(){return this.root.activeElement==this.dom};Vn.prototype.focus=function(){this.domObserver.stop(),this.editable&&XP(this.dom),Xa(this),this.domObserver.start()};nf.root.get=function(){var o=this._root;if(o==null){for(var e=this.dom.parentNode;e;e=e.parentNode)if(e.nodeType==9||e.nodeType==11&&e.host)return e.getSelection||(Object.getPrototypeOf(e).getSelection=function(){return document.getSelection()}),this._root=e}return o||document};Vn.prototype.posAtCoords=function(e){return rB(this,e)};Vn.prototype.coordsAtPos=function(e,i){return i===void 0&&(i=1),w0(this,e,i)};Vn.prototype.domAtPos=function(e,i){return i===void 0&&(i=0),this.docView.domFromPos(e,i)};Vn.prototype.nodeDOM=function(e){var i=this.docView.descAt(e);return i?i.nodeDOM:null};Vn.prototype.posAtDOM=function(e,i,a){a===void 0&&(a=-1);var l=this.docView.posFromDOM(e,i,a);if(l==null)throw new RangeError("DOM position not inside the editor");return l};Vn.prototype.endOfTextblock=function(e,i){return aB(this,i||this.state,e)};Vn.prototype.destroy=function(){!this.docView||(xB(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],wE(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null)};nf.isDestroyed.get=function(){return this.docView==null};Vn.prototype.dispatchEvent=function(e){return QB(this,e)};Vn.prototype.dispatch=function(e){var i=this._props.dispatchTransaction;i?i.call(this,e):this.updateState(this.state.apply(e))};Object.defineProperties(Vn.prototype,nf);function vw(o){var e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(o.editable),e.translate="no",o.someProp("attributes",function(i){if(typeof i=="function"&&(i=i(o.state)),i)for(var a in i)a=="class"&&(e.class+=" "+i[a]),a=="style"?e.style=(e.style?e.style+";":"")+i[a]:!e[a]&&a!="contenteditable"&&a!="nodeName"&&(e[a]=String(i[a]))}),[Qn.node(0,o.state.doc.content.size,e)]}function Iw(o){if(o.markCursor){var e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),o.cursorWrapper={dom:e,deco:Qn.widget(o.state.selection.head,e,{raw:!0,marks:o.markCursor})}}else o.cursorWrapper=null}function Cw(o){return!o.someProp("editable",function(e){return e(o.state)===!1})}function rU(o,e){var i=Math.min(o.$anchor.sharedDepth(o.head),e.$anchor.sharedDepth(e.head));return o.$anchor.start(i)!=e.$anchor.start(i)}function Sw(o){var e={};return o.someProp("nodeViews",function(i){for(var a in i)Object.prototype.hasOwnProperty.call(e,a)||(e[a]=i[a])}),e}function nU(o,e){var i=0,a=0;for(var l in o){if(o[l]!=e[l])return!0;i++}for(var u in e)a++;return i!=a}function yw(o){if(o.spec.state||o.spec.filterTransaction||o.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var Za={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",229:"q"},of={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"',229:"Q"},Tw=typeof navigator!="undefined"&&/Chrome\/(\d+)/.exec(navigator.userAgent),iU=typeof navigator!="undefined"&&/Apple Computer/.test(navigator.vendor),oU=typeof navigator!="undefined"&&/Gecko\/\d+/.test(navigator.userAgent),Rw=typeof navigator!="undefined"&&/Mac/.test(navigator.platform),sU=typeof navigator!="undefined"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),aU=Tw&&(Rw||+Tw[1]<57)||oU&&Rw;for(var hi=0;hi<10;hi++)Za[48+hi]=Za[96+hi]=String(hi);for(var hi=1;hi<=24;hi++)Za[hi+111]="F"+hi;for(var hi=65;hi<=90;hi++)Za[hi]=String.fromCharCode(hi+32),of[hi]=String.fromCharCode(hi);for(var bE in Za)of.hasOwnProperty(bE)||(of[bE]=Za[bE]);function cU(o){var e=aU&&(o.ctrlKey||o.altKey||o.metaKey)||(iU||sU)&&o.shiftKey&&o.key&&o.key.length==1,i=!e&&o.key||(o.shiftKey?of:Za)[o.keyCode]||o.key||"Unidentified";return i=="Esc"&&(i="Escape"),i=="Del"&&(i="Delete"),i=="Left"&&(i="ArrowLeft"),i=="Up"&&(i="ArrowUp"),i=="Right"&&(i="ArrowRight"),i=="Down"&&(i="ArrowDown"),i}var lU=typeof navigator!="undefined"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!1;function dU(o){var e=o.split(/-(?!$)/),i=e[e.length-1];i=="Space"&&(i=" ");for(var a,l,u,f,g=0;g<e.length-1;g++){var _=e[g];if(/^(cmd|meta|m)$/i.test(_))f=!0;else if(/^a(lt)?$/i.test(_))a=!0;else if(/^(c|ctrl|control)$/i.test(_))l=!0;else if(/^s(hift)?$/i.test(_))u=!0;else if(/^mod$/i.test(_))lU?f=!0:l=!0;else throw new Error("Unrecognized modifier name: "+_)}return a&&(i="Alt-"+i),l&&(i="Ctrl-"+i),f&&(i="Meta-"+i),u&&(i="Shift-"+i),i}function uU(o){var e=Object.create(null);for(var i in o)e[dU(i)]=o[i];return e}function NE(o,e,i){return e.altKey&&(o="Alt-"+o),e.ctrlKey&&(o="Ctrl-"+o),e.metaKey&&(o="Meta-"+o),i!==!1&&e.shiftKey&&(o="Shift-"+o),o}function hU(o){return new ni({props:{handleKeyDown:ww(o)}})}function ww(o){var e=uU(o);return function(i,a){var l=cU(a),u=l.length==1&&l!=" ",f,g=e[NE(l,a,!u)];if(g&&g(i.state,i.dispatch,i))return!0;if(u&&(a.shiftKey||a.altKey||a.metaKey||l.charCodeAt(0)>127)&&(f=Za[a.keyCode])&&f!=l){var _=e[NE(f,a,!0)];if(_&&_(i.state,i.dispatch,i))return!0}else if(u&&a.shiftKey){var I=e[NE(l,a,!0)];if(I&&I(i.state,i.dispatch,i))return!0}return!1}}function pU(o){return Object.prototype.toString.call(o).slice(8,-1)}function OE(o){return pU(o)!=="Object"?!1:o.constructor===Object&&Object.getPrototypeOf(o)===Object.prototype}function sf(o,e){const i=Dt({},o);return OE(o)&&OE(e)&&Object.keys(e).forEach(a=>{OE(e[a])?a in o?i[a]=sf(o[a],e[a]):Object.assign(i,{[a]:e[a]}):Object.assign(i,{[a]:e[a]})}),i}function bw(o){return typeof o=="function"}function Ve(o,e=void 0,...i){return bw(o)?e?o.bind(e)(...i):o(...i):o}function ie(o,e,i){return o.config[e]===void 0&&o.parent?ie(o.parent,e,i):typeof o.config[e]=="function"?o.config[e].bind(Qi(Dt({},i),{parent:o.parent?ie(o.parent,e,i):null})):o.config[e]}class ii{constructor(e={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config=Dt(Dt({},this.config),e),this.name=this.config.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=Ve(ie(this,"addOptions",{name:this.name}))),this.storage=Ve(ie(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new ii(e)}configure(e={}){const i=this.extend();return i.options=sf(this.options,e),i.storage=Ve(ie(i,"addStorage",{name:i.name,options:i.options})),i}extend(e={}){const i=new ii(e);return i.parent=this,this.child=i,i.name=e.name?e.name:i.parent.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${i.name}".`),i.options=Ve(ie(i,"addOptions",{name:i.name})),i.storage=Ve(ie(i,"addStorage",{name:i.name,options:i.options})),i}}function Nw(o,e,i){const{from:a,to:l}=e,{blockSeparator:u=`

`,textSerializers:f={}}=i||{};let g="",_=!0;return o.nodesBetween(a,l,(I,T,N,D)=>{var F;const K=f==null?void 0:f[I.type.name];K?(I.isBlock&&!_&&(g+=u,_=!0),g+=K({node:I,pos:T,parent:N,index:D})):I.isText?(g+=(F=I==null?void 0:I.text)===null||F===void 0?void 0:F.slice(Math.max(a,T)-T,l-T),_=!1):I.isBlock&&!_&&(g+=u,_=!0)}),g}function Ow(o){return Object.fromEntries(Object.entries(o.nodes).filter(([,e])=>e.spec.toText).map(([e,i])=>[e,i.spec.toText]))}const fU=ii.create({name:"clipboardTextSerializer",addProseMirrorPlugins(){return[new ni({key:new Ki("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:o}=this,{state:e,schema:i}=o,{doc:a,selection:l}=e,{ranges:u}=l,f=Math.min(...u.map(T=>T.$from.pos)),g=Math.max(...u.map(T=>T.$to.pos)),_=Ow(i);return Nw(a,{from:f,to:g},{textSerializers:_})}}})]}}),AU=()=>({editor:o,view:e})=>(requestAnimationFrame(()=>{var i;o.isDestroyed||(e.dom.blur(),(i=window==null?void 0:window.getSelection())===null||i===void 0||i.removeAllRanges())}),!0);var gU=Object.freeze({__proto__:null,blur:AU});const mU=(o=!1)=>({commands:e})=>e.setContent("",o);var EU=Object.freeze({__proto__:null,clearContent:mU});const _U=()=>({state:o,tr:e,dispatch:i})=>{const{selection:a}=e,{ranges:l}=a;return i&&l.forEach(({$from:u,$to:f})=>{o.doc.nodesBetween(u.pos,f.pos,(g,_)=>{if(g.type.isText)return;const{doc:I,mapping:T}=e,N=I.resolve(T.map(_)),D=I.resolve(T.map(_+g.nodeSize)),F=N.blockRange(D);if(!F)return;const K=Yl(F);if(g.type.isTextblock){const{defaultType:J}=N.parent.contentMatchAt(N.index());e.setNodeMarkup(F.start,J)}(K||K===0)&&e.lift(F,K)})}),!0};var vU=Object.freeze({__proto__:null,clearNodes:_U});const IU=o=>e=>o(e);var CU=Object.freeze({__proto__:null,command:IU});const SU=()=>({state:o,dispatch:e})=>d0(o,e);var yU=Object.freeze({__proto__:null,createParagraphNear:SU});function oi(o,e){if(typeof o=="string"){if(!e.nodes[o])throw Error(`There is no node type named '${o}'. Maybe you forgot to add the extension?`);return e.nodes[o]}return o}const TU=o=>({tr:e,state:i,dispatch:a})=>{const l=oi(o,i.schema),u=e.selection.$anchor;for(let f=u.depth;f>0;f-=1)if(u.node(f).type===l){if(a){const _=u.before(f),I=u.after(f);e.delete(_,I).scrollIntoView()}return!0}return!1};var RU=Object.freeze({__proto__:null,deleteNode:TU});const wU=o=>({tr:e,dispatch:i})=>{const{from:a,to:l}=o;return i&&e.delete(a,l),!0};var bU=Object.freeze({__proto__:null,deleteRange:wU});const NU=()=>({state:o,dispatch:e})=>qm(o,e);var OU=Object.freeze({__proto__:null,deleteSelection:NU});const kU=()=>({commands:o})=>o.keyboardShortcut("Enter");var DU=Object.freeze({__proto__:null,enter:kU});const LU=()=>({state:o,dispatch:e})=>l0(o,e);var MU=Object.freeze({__proto__:null,exitCode:LU});function $a(o,e){if(typeof o=="string"){if(!e.marks[o])throw Error(`There is no mark type named '${o}'. Maybe you forgot to add the extension?`);return e.marks[o]}return o}function kE(o){return Object.prototype.toString.call(o)==="[object RegExp]"}function af(o,e,i={strict:!0}){const a=Object.keys(e);return a.length?a.every(l=>i.strict?e[l]===o[l]:kE(e[l])?e[l].test(o[l]):e[l]===o[l]):!0}function DE(o,e,i={}){return o.find(a=>a.type===e&&af(a.attrs,i))}function PU(o,e,i={}){return!!DE(o,e,i)}function LE(o,e,i={}){if(!o||!e)return;const a=o.parent.childAfter(o.parentOffset);if(!a.node)return;const l=DE(a.node.marks,e,i);if(!l)return;let u=o.index(),f=o.start()+a.offset,g=u+1,_=f+a.node.nodeSize;for(DE(a.node.marks,e,i);u>0&&l.isInSet(o.parent.child(u-1).marks);)u-=1,f-=o.parent.child(u).nodeSize;for(;g<o.parent.childCount&&PU(o.parent.child(g).marks,e,i);)_+=o.parent.child(g).nodeSize,g+=1;return{from:f,to:_}}const BU=(o,e={})=>({tr:i,state:a,dispatch:l})=>{const u=$a(o,a.schema),{doc:f,selection:g}=i,{$from:_,from:I,to:T}=g;if(l){const N=LE(_,u,e);if(N&&N.from<=I&&N.to>=T){const D=cr.create(f,N.from,N.to);i.setSelection(D)}}return!0};var UU=Object.freeze({__proto__:null,extendMarkRange:BU});const xU=o=>e=>{const i=typeof o=="function"?o(e):o;for(let a=0;a<i.length;a+=1)if(i[a](e))return!0;return!1};var FU=Object.freeze({__proto__:null,first:xU});function QU(o){var e;return((e=o.constructor)===null||e===void 0?void 0:e.toString().substring(0,5))==="class"}function ME(o){return o&&typeof o=="object"&&!Array.isArray(o)&&!QU(o)}function kw(o){return ME(o)&&o instanceof cr}function VU(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}function Bc(o=0,e=0,i=0){return Math.min(Math.max(o,e),i)}function Dw(o,e=null){if(!e)return null;if(e==="start"||e===!0)return Ce.atStart(o);if(e==="end")return Ce.atEnd(o);if(e==="all")return cr.create(o,0,o.content.size);const i=Ce.atStart(o).from,a=Ce.atEnd(o).to,l=Bc(e,i,a),u=Bc(e,i,a);return cr.create(o,l,u)}const GU=(o=null,e)=>({editor:i,view:a,tr:l,dispatch:u})=>{e=Dt({scrollIntoView:!0},e);const f=()=>{VU()&&a.dom.focus(),requestAnimationFrame(()=>{i.isDestroyed||(a.focus(),(e==null?void 0:e.scrollIntoView)&&i.commands.scrollIntoView())})};if(a.hasFocus()&&o===null||o===!1)return!0;if(u&&o===null&&!kw(i.state.selection))return f(),!0;const g=Dw(i.state.doc,o)||i.state.selection,_=i.state.selection.eq(g);return u&&(_||l.setSelection(g),_&&l.storedMarks&&l.setStoredMarks(l.storedMarks),f()),!0};var jU=Object.freeze({__proto__:null,focus:GU});const WU=(o,e)=>i=>o.every((a,l)=>e(a,Qi(Dt({},i),{index:l})));var KU=Object.freeze({__proto__:null,forEach:WU});const HU=(o,e)=>({tr:i,commands:a})=>a.insertContentAt({from:i.selection.from,to:i.selection.to},o,e);var YU=Object.freeze({__proto__:null,insertContent:HU});function Lw(o){const e=`<body>${o}</body>`;return new window.DOMParser().parseFromString(e,"text/html").body}function cf(o,e,i){if(i=Dt({slice:!0,parseOptions:{}},i),typeof o=="object"&&o!==null)try{return Array.isArray(o)?Nt.fromArray(o.map(a=>e.nodeFromJSON(a))):e.nodeFromJSON(o)}catch(a){return console.warn("[tiptap warn]: Invalid content.","Passed value:",o,"Error:",a),cf("",e,i)}if(typeof o=="string"){const a=ms.fromSchema(e);return i.slice?a.parseSlice(Lw(o),i.parseOptions).content:a.parse(Lw(o),i.parseOptions)}return cf("",e,i)}function qU(o,e,i){const a=o.steps.length-1;if(a<e)return;const l=o.steps[a];if(!(l instanceof Sa||l instanceof lo))return;const u=o.mapping.maps[a];let f=0;u.forEach((g,_,I,T)=>{f===0&&(f=T)}),o.setSelection(Ce.near(o.doc.resolve(f),i))}const JU=o=>o.toString().startsWith("<"),zU=(o,e,i)=>({tr:a,dispatch:l,editor:u})=>{if(l){i=Dt({parseOptions:{},updateSelection:!0},i);const f=cf(e,u.schema,{parseOptions:Dt({preserveWhitespace:"full"},i.parseOptions)});if(f.toString()==="<>")return!0;let{from:g,to:_}=typeof o=="number"?{from:o,to:o}:o,I=!0,T=!0;if((JU(f)?f:[f]).forEach(D=>{D.check(),I=I?D.isText&&D.marks.length===0:!1,T=T?D.isBlock:!1}),g===_&&T){const{parent:D}=a.doc.resolve(g);D.isTextblock&&!D.type.spec.code&&!D.childCount&&(g-=1,_+=1)}I?a.insertText(e,g,_):a.replaceWith(g,_,f),i.updateSelection&&qU(a,a.steps.length-1,-1)}return!0};var XU=Object.freeze({__proto__:null,insertContentAt:zU});const ZU=()=>({state:o,dispatch:e})=>r0(o,e);var $U=Object.freeze({__proto__:null,joinBackward:ZU});const tx=()=>({state:o,dispatch:e})=>o0(o,e);var ex=Object.freeze({__proto__:null,joinForward:tx});const rx=typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1;function nx(o){const e=o.split(/-(?!$)/);let i=e[e.length-1];i==="Space"&&(i=" ");let a,l,u,f;for(let g=0;g<e.length-1;g+=1){const _=e[g];if(/^(cmd|meta|m)$/i.test(_))f=!0;else if(/^a(lt)?$/i.test(_))a=!0;else if(/^(c|ctrl|control)$/i.test(_))l=!0;else if(/^s(hift)?$/i.test(_))u=!0;else if(/^mod$/i.test(_))rx?f=!0:l=!0;else throw new Error(`Unrecognized modifier name: ${_}`)}return a&&(i=`Alt-${i}`),l&&(i=`Ctrl-${i}`),f&&(i=`Meta-${i}`),u&&(i=`Shift-${i}`),i}const ix=o=>({editor:e,view:i,tr:a,dispatch:l})=>{const u=nx(o).split(/-(?!$)/),f=u.find(I=>!["Alt","Ctrl","Meta","Shift"].includes(I)),g=new KeyboardEvent("keydown",{key:f==="Space"?" ":f,altKey:u.includes("Alt"),ctrlKey:u.includes("Ctrl"),metaKey:u.includes("Meta"),shiftKey:u.includes("Shift"),bubbles:!0,cancelable:!0}),_=e.captureTransaction(()=>{i.someProp("handleKeyDown",I=>I(i,g))});return _==null||_.steps.forEach(I=>{const T=I.map(a.mapping);T&&l&&a.maybeStep(T)}),!0};var ox=Object.freeze({__proto__:null,keyboardShortcut:ix});function Fu(o,e,i={}){const{from:a,to:l,empty:u}=o.selection,f=e?oi(e,o.schema):null,g=[];o.doc.nodesBetween(a,l,(N,D)=>{if(N.isText)return;const F=Math.max(a,D),K=Math.min(l,D+N.nodeSize);g.push({node:N,from:F,to:K})});const _=l-a,I=g.filter(N=>f?f.name===N.node.type.name:!0).filter(N=>af(N.node.attrs,i,{strict:!1}));return u?!!I.length:I.reduce((N,D)=>N+D.to-D.from,0)>=_}const sx=(o,e={})=>({state:i,dispatch:a})=>{const l=oi(o,i.schema);return Fu(i,l,e)?kP(i,a):!1};var ax=Object.freeze({__proto__:null,lift:sx});const cx=()=>({state:o,dispatch:e})=>u0(o,e);var lx=Object.freeze({__proto__:null,liftEmptyBlock:cx});const dx=o=>({state:e,dispatch:i})=>{const a=oi(o,e.schema);return QP(a)(e,i)};var ux=Object.freeze({__proto__:null,liftListItem:dx});const hx=()=>({state:o,dispatch:e})=>c0(o,e);var px=Object.freeze({__proto__:null,newlineInCode:hx});function lf(o,e){return e.nodes[o]?"node":e.marks[o]?"mark":null}function Mw(o,e){const i=typeof e=="string"?[e]:e;return Object.keys(o).reduce((a,l)=>(i.includes(l)||(a[l]=o[l]),a),{})}const fx=(o,e)=>({tr:i,state:a,dispatch:l})=>{let u=null,f=null;const g=lf(typeof o=="string"?o:o.name,a.schema);return g?(g==="node"&&(u=oi(o,a.schema)),g==="mark"&&(f=$a(o,a.schema)),l&&i.selection.ranges.forEach(_=>{a.doc.nodesBetween(_.$from.pos,_.$to.pos,(I,T)=>{u&&u===I.type&&i.setNodeMarkup(T,void 0,Mw(I.attrs,e)),f&&I.marks.length&&I.marks.forEach(N=>{f===N.type&&i.addMark(T,T+I.nodeSize,f.create(Mw(N.attrs,e)))})})}),!0):!1};var Ax=Object.freeze({__proto__:null,resetAttributes:fx});const gx=()=>({tr:o,dispatch:e})=>(e&&o.scrollIntoView(),!0);var mx=Object.freeze({__proto__:null,scrollIntoView:gx});const Ex=()=>({tr:o,commands:e})=>e.setTextSelection({from:0,to:o.doc.content.size});var _x=Object.freeze({__proto__:null,selectAll:Ex});const vx=()=>({state:o,dispatch:e})=>n0(o,e);var Ix=Object.freeze({__proto__:null,selectNodeBackward:vx});const Cx=()=>({state:o,dispatch:e})=>s0(o,e);var Sx=Object.freeze({__proto__:null,selectNodeForward:Cx});const yx=()=>({state:o,dispatch:e})=>LP(o,e);var Tx=Object.freeze({__proto__:null,selectParentNode:yx});function Pw(o,e,i={}){return cf(o,e,{slice:!1,parseOptions:i})}const Rx=(o,e=!1,i={})=>({tr:a,editor:l,dispatch:u})=>{const{doc:f}=a,g=Pw(o,l.schema,i),_=cr.create(f,0,f.content.size);return u&&a.setSelection(_).replaceSelectionWith(g,!1).setMeta("preventUpdate",!e),!0};var wx=Object.freeze({__proto__:null,setContent:Rx});function Bw(o,e){const i=$a(e,o.schema),{from:a,to:l,empty:u}=o.selection,f=[];u?(o.storedMarks&&f.push(...o.storedMarks),f.push(...o.selection.$head.marks())):o.doc.nodesBetween(a,l,_=>{f.push(..._.marks)});const g=f.find(_=>_.type.name===i.name);return g?Dt({},g.attrs):{}}const bx=(o,e={})=>({tr:i,state:a,dispatch:l})=>{const{selection:u}=i,{empty:f,ranges:g}=u,_=$a(o,a.schema);if(l)if(f){const I=Bw(a,_);i.addStoredMark(_.create(Dt(Dt({},I),e)))}else g.forEach(I=>{const T=I.$from.pos,N=I.$to.pos;a.doc.nodesBetween(T,N,(D,F)=>{const K=Math.max(F,T),J=Math.min(F+D.nodeSize,N);D.marks.find(it=>it.type===_)?D.marks.forEach(it=>{_===it.type&&i.addMark(K,J,_.create(Dt(Dt({},it.attrs),e)))}):i.addMark(K,J,_.create(e))})});return!0};var Nx=Object.freeze({__proto__:null,setMark:bx});const Ox=(o,e)=>({tr:i})=>(i.setMeta(o,e),!0);var kx=Object.freeze({__proto__:null,setMeta:Ox});const Dx=(o,e={})=>({state:i,dispatch:a,chain:l})=>{const u=oi(o,i.schema);return u.isTextblock?l().command(({commands:f})=>g0(u,e)(i)?!0:f.clearNodes()).command(({state:f})=>g0(u,e)(f,a)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)};var Lx=Object.freeze({__proto__:null,setNode:Dx});const Mx=o=>({tr:e,dispatch:i})=>{if(i){const{doc:a}=e,l=Ce.atStart(a).from,u=Ce.atEnd(a).to,f=Bc(o,l,u),g=ke.create(a,f);e.setSelection(g)}return!0};var Px=Object.freeze({__proto__:null,setNodeSelection:Mx});const Bx=o=>({tr:e,dispatch:i})=>{if(i){const{doc:a}=e,{from:l,to:u}=typeof o=="number"?{from:o,to:o}:o,f=Ce.atStart(a).from,g=Ce.atEnd(a).to,_=Bc(l,f,g),I=Bc(u,f,g),T=cr.create(a,_,I);e.setSelection(T)}return!0};var Ux=Object.freeze({__proto__:null,setTextSelection:Bx});const xx=o=>({state:e,dispatch:i})=>{const a=oi(o,e.schema);return jP(a)(e,i)};var Fx=Object.freeze({__proto__:null,sinkListItem:xx});function df(o,e,i){return Object.fromEntries(Object.entries(i).filter(([a])=>{const l=o.find(u=>u.type===e&&u.name===a);return l?l.attribute.keepOnSplit:!1}))}function Qx(o){for(let e=0;e<o.edgeCount;e+=1){const{type:i}=o.edge(e);if(i.isTextblock&&!i.hasRequiredAttrs())return i}return null}function Uw(o,e){const i=o.storedMarks||o.selection.$to.parentOffset&&o.selection.$from.marks();if(i){const a=i.filter(l=>e==null?void 0:e.includes(l.type.name));o.tr.ensureMarks(a)}}const Vx=({keepMarks:o=!0}={})=>({tr:e,state:i,dispatch:a,editor:l})=>{const{selection:u,doc:f}=e,{$from:g,$to:_}=u,I=l.extensionManager.attributes,T=df(I,g.node().type.name,g.node().attrs);if(u instanceof ke&&u.node.isBlock)return!g.parentOffset||!ya(f,g.pos)?!1:(a&&(o&&Uw(i,l.extensionManager.splittableMarks),e.split(g.pos).scrollIntoView()),!0);if(!g.parent.isBlock)return!1;if(a){const N=_.parentOffset===_.parent.content.size;u instanceof cr&&e.deleteSelection();const D=g.depth===0?void 0:Qx(g.node(-1).contentMatchAt(g.indexAfter(-1)));let F=N&&D?[{type:D,attrs:T}]:void 0,K=ya(e.doc,e.mapping.map(g.pos),1,F);if(!F&&!K&&ya(e.doc,e.mapping.map(g.pos),1,D?[{type:D}]:void 0)&&(K=!0,F=D?[{type:D,attrs:T}]:void 0),K&&(e.split(e.mapping.map(g.pos),1,F),D&&!N&&!g.parentOffset&&g.parent.type!==D)){const J=e.mapping.map(g.before()),nt=e.doc.resolve(J);g.node(-1).canReplaceWith(nt.index(),nt.index()+1,D)&&e.setNodeMarkup(e.mapping.map(g.before()),D)}o&&Uw(i,l.extensionManager.splittableMarks),e.scrollIntoView()}return!0};var Gx=Object.freeze({__proto__:null,splitBlock:Vx});const jx=o=>({tr:e,state:i,dispatch:a,editor:l})=>{var u;const f=oi(o,i.schema),{$from:g,$to:_}=i.selection,I=i.selection.node;if(I&&I.isBlock||g.depth<2||!g.sameParent(_))return!1;const T=g.node(-1);if(T.type!==f)return!1;const N=l.extensionManager.attributes;if(g.parent.content.size===0&&g.node(-1).childCount===g.indexAfter(-1)){if(g.depth===2||g.node(-3).type!==f||g.index(-2)!==g.node(-2).childCount-1)return!1;if(a){let nt=Nt.empty;const it=g.index(-1)?1:g.index(-2)?2:3;for(let $t=g.depth-it;$t>=g.depth-3;$t-=1)nt=Nt.from(g.node($t).copy(nt));const z=g.indexAfter(-1)<g.node(-2).childCount?1:g.indexAfter(-2)<g.node(-3).childCount?2:3,Ot=df(N,g.node().type.name,g.node().attrs),X=((u=f.contentMatch.defaultType)===null||u===void 0?void 0:u.createAndFill(Ot))||void 0;nt=nt.append(Nt.from(f.createAndFill(null,X)||void 0));const yt=g.before(g.depth-(it-1));e.replace(yt,g.after(-z),new Ht(nt,4-it,0));let Mt=-1;e.doc.nodesBetween(yt,e.doc.content.size,($t,ge)=>{if(Mt>-1)return!1;$t.isTextblock&&$t.content.size===0&&(Mt=ge+1)}),Mt>-1&&e.setSelection(cr.near(e.doc.resolve(Mt))),e.scrollIntoView()}return!0}const D=_.pos===g.end()?T.contentMatchAt(0).defaultType:null,F=df(N,T.type.name,T.attrs),K=df(N,g.node().type.name,g.node().attrs);e.delete(g.pos,_.pos);const J=D?[{type:f,attrs:F},{type:D,attrs:K}]:[{type:f,attrs:F}];return ya(e.doc,g.pos,2)?(a&&e.split(g.pos,2,J).scrollIntoView(),!0):!1};var Wx=Object.freeze({__proto__:null,splitListItem:jx});function Kx(o,e){for(let i=o.depth;i>0;i-=1){const a=o.node(i);if(e(a))return{pos:i>0?o.before(i):0,start:o.start(i),depth:i,node:a}}}function PE(o){return e=>Kx(e.$from,o)}function uf(o){const e=o.filter(l=>l.type==="extension"),i=o.filter(l=>l.type==="node"),a=o.filter(l=>l.type==="mark");return{baseExtensions:e,nodeExtensions:i,markExtensions:a}}function xw(o,e){const{nodeExtensions:i}=uf(e),a=i.find(f=>f.name===o);if(!a)return!1;const l={name:a.name,options:a.options,storage:a.storage},u=Ve(ie(a,"group",l));return typeof u!="string"?!1:u.split(" ").includes("list")}const Fw=(o,e)=>{const i=PE(f=>f.type===e)(o.selection);if(!i)return!0;const a=o.doc.resolve(Math.max(0,i.pos-1)).before(i.depth);if(a===void 0)return!0;const l=o.doc.nodeAt(a);return i.node.type===(l==null?void 0:l.type)&&yu(o.doc,i.pos)&&o.join(i.pos),!0},Qw=(o,e)=>{const i=PE(f=>f.type===e)(o.selection);if(!i)return!0;const a=o.doc.resolve(i.start).after(i.depth);if(a===void 0)return!0;const l=o.doc.nodeAt(a);return i.node.type===(l==null?void 0:l.type)&&yu(o.doc,a)&&o.join(a),!0},Hx=(o,e)=>({editor:i,tr:a,state:l,dispatch:u,chain:f,commands:g,can:_})=>{const{extensions:I}=i.extensionManager,T=oi(o,l.schema),N=oi(e,l.schema),{selection:D}=l,{$from:F,$to:K}=D,J=F.blockRange(K);if(!J)return!1;const nt=PE(it=>xw(it.type.name,I))(D);if(J.depth>=1&&nt&&J.depth-nt.depth<=1){if(nt.node.type===T)return g.liftListItem(N);if(xw(nt.node.type.name,I)&&T.validContent(nt.node.content)&&u)return f().command(()=>(a.setNodeMarkup(nt.pos,T),!0)).command(()=>Fw(a,T)).command(()=>Qw(a,T)).run()}return f().command(()=>_().wrapInList(T)?!0:g.clearNodes()).wrapInList(T).command(()=>Fw(a,T)).command(()=>Qw(a,T)).run()};var Yx=Object.freeze({__proto__:null,toggleList:Hx});function BE(o,e,i={}){const{empty:a,ranges:l}=o.selection,u=e?$a(e,o.schema):null;if(a)return!!(o.storedMarks||o.selection.$from.marks()).filter(N=>u?u.name===N.type.name:!0).find(N=>af(N.attrs,i,{strict:!1}));let f=0;const g=[];if(l.forEach(({$from:N,$to:D})=>{const F=N.pos,K=D.pos;o.doc.nodesBetween(F,K,(J,nt)=>{if(!J.isText&&!J.marks.length)return;const it=Math.max(F,nt),z=Math.min(K,nt+J.nodeSize);f+=z-it,g.push(...J.marks.map(X=>({mark:X,from:it,to:z})))})}),f===0)return!1;const _=g.filter(N=>u?u.name===N.mark.type.name:!0).filter(N=>af(N.mark.attrs,i,{strict:!1})).reduce((N,D)=>N+D.to-D.from,0),I=g.filter(N=>u?N.mark.type!==u&&N.mark.type.excludes(u):!0).reduce((N,D)=>N+D.to-D.from,0);return(_>0?_+I:_)>=f}const qx=(o,e={},i={})=>({state:a,commands:l})=>{const{extendEmptyMarkRange:u=!1}=i,f=$a(o,a.schema);return BE(a,f,e)?l.unsetMark(f,{extendEmptyMarkRange:u}):l.setMark(f,e)};var Jx=Object.freeze({__proto__:null,toggleMark:qx});const zx=(o,e,i={})=>({state:a,commands:l})=>{const u=oi(o,a.schema),f=oi(e,a.schema);return Fu(a,u,i)?l.setNode(f):l.setNode(u,i)};var Xx=Object.freeze({__proto__:null,toggleNode:zx});const Zx=(o,e={})=>({state:i,commands:a})=>{const l=oi(o,i.schema);return Fu(i,l,e)?a.lift(l):a.wrapIn(l,e)};var $x=Object.freeze({__proto__:null,toggleWrap:Zx});const t3=()=>({state:o,dispatch:e})=>{const i=o.plugins;for(let a=0;a<i.length;a+=1){const l=i[a];let u;if(l.spec.isInputRules&&(u=l.getState(o))){if(e){const f=o.tr,g=u.transform;for(let _=g.steps.length-1;_>=0;_-=1)f.step(g.steps[_].invert(g.docs[_]));if(u.text){const _=f.doc.resolve(u.from).marks();f.replaceWith(u.from,u.to,o.schema.text(u.text,_))}else f.delete(u.from,u.to)}return!0}}return!1};var e3=Object.freeze({__proto__:null,undoInputRule:t3});const r3=()=>({tr:o,dispatch:e})=>{const{selection:i}=o,{empty:a,ranges:l}=i;return a||e&&l.forEach(u=>{o.removeMark(u.$from.pos,u.$to.pos)}),!0};var n3=Object.freeze({__proto__:null,unsetAllMarks:r3});const i3=(o,e={})=>({tr:i,state:a,dispatch:l})=>{var u;const{extendEmptyMarkRange:f=!1}=e,{selection:g}=i,_=$a(o,a.schema),{$from:I,empty:T,ranges:N}=g;if(!l)return!0;if(T&&f){let{from:D,to:F}=g;const K=(u=I.marks().find(nt=>nt.type===_))===null||u===void 0?void 0:u.attrs,J=LE(I,_,K);J&&(D=J.from,F=J.to),i.removeMark(D,F,_)}else N.forEach(D=>{i.removeMark(D.$from.pos,D.$to.pos,_)});return i.removeStoredMark(_),!0};var o3=Object.freeze({__proto__:null,unsetMark:i3});const s3=(o,e={})=>({tr:i,state:a,dispatch:l})=>{let u=null,f=null;const g=lf(typeof o=="string"?o:o.name,a.schema);return g?(g==="node"&&(u=oi(o,a.schema)),g==="mark"&&(f=$a(o,a.schema)),l&&i.selection.ranges.forEach(_=>{const I=_.$from.pos,T=_.$to.pos;a.doc.nodesBetween(I,T,(N,D)=>{u&&u===N.type&&i.setNodeMarkup(D,void 0,Dt(Dt({},N.attrs),e)),f&&N.marks.length&&N.marks.forEach(F=>{if(f===F.type){const K=Math.max(D,I),J=Math.min(D+N.nodeSize,T);i.addMark(K,J,f.create(Dt(Dt({},F.attrs),e)))}})})}),!0):!1};var a3=Object.freeze({__proto__:null,updateAttributes:s3});const c3=(o,e={})=>({state:i,dispatch:a})=>{const l=oi(o,i.schema);return BP(l,e)(i,a)};var l3=Object.freeze({__proto__:null,wrapIn:c3});const d3=(o,e={})=>({state:i,dispatch:a})=>{const l=oi(o,i.schema);return xP(l,e)(i,a)};var u3=Object.freeze({__proto__:null,wrapInList:d3});const h3=ii.create({name:"commands",addCommands(){return Dt(Dt(Dt(Dt(Dt(Dt(Dt(Dt(Dt(Dt(Dt(Dt(Dt(Dt(Dt(Dt(Dt(Dt(Dt(Dt(Dt(Dt(Dt(Dt(Dt(Dt(Dt(Dt(Dt(Dt(Dt(Dt(Dt(Dt(Dt(Dt(Dt(Dt(Dt(Dt(Dt(Dt(Dt(Dt(Dt(Dt(Dt(Dt({},gU),EU),vU),CU),yU),RU),bU),OU),DU),MU),UU),FU),jU),KU),YU),XU),$U),ex),ox),ax),lx),ux),px),Ax),mx),_x),Ix),Sx),Tx),wx),Nx),kx),Lx),Px),Ux),Fx),Gx),Wx),Yx),Jx),Xx),$x),e3),n3),o3),a3),l3),u3)}}),p3=ii.create({name:"editable",addProseMirrorPlugins(){return[new ni({key:new Ki("editable"),props:{editable:()=>this.editor.options.editable}})]}}),f3=ii.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:o}=this;return[new ni({key:new Ki("focusEvents"),props:{handleDOMEvents:{focus:(e,i)=>{o.isFocused=!0;const a=o.state.tr.setMeta("focus",{event:i}).setMeta("addToHistory",!1);return e.dispatch(a),!1},blur:(e,i)=>{o.isFocused=!1;const a=o.state.tr.setMeta("blur",{event:i}).setMeta("addToHistory",!1);return e.dispatch(a),!1}}}})]}});function hf(o){const{state:e,transaction:i}=o;let{selection:a}=i,{doc:l}=i,{storedMarks:u}=i;return Qi(Dt({},e),{schema:e.schema,plugins:e.plugins,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return u},get selection(){return a},get doc(){return l},get tr(){return a=i.selection,l=i.doc,u=i.storedMarks,i}})}class pf{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:i,state:a}=this,{view:l}=i,{tr:u}=a,f=this.buildProps(u);return Object.fromEntries(Object.entries(e).map(([g,_])=>[g,(...T)=>{const N=_(...T)(f);return!u.getMeta("preventDispatch")&&!this.hasCustomState&&l.dispatch(u),N}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,i=!0){const{rawCommands:a,editor:l,state:u}=this,{view:f}=l,g=[],_=!!e,I=e||u.tr,T=()=>(!_&&i&&!I.getMeta("preventDispatch")&&!this.hasCustomState&&f.dispatch(I),g.every(D=>D===!0)),N=Qi(Dt({},Object.fromEntries(Object.entries(a).map(([D,F])=>[D,(...J)=>{const nt=this.buildProps(I,i),it=F(...J)(nt);return g.push(it),N}]))),{run:T});return N}createCan(e){const{rawCommands:i,state:a}=this,l=void 0,u=e||a.tr,f=this.buildProps(u,l),g=Object.fromEntries(Object.entries(i).map(([_,I])=>[_,(...T)=>I(...T)(Qi(Dt({},f),{dispatch:l}))]));return Qi(Dt({},g),{chain:()=>this.createChain(u,l)})}buildProps(e,i=!0){const{rawCommands:a,editor:l,state:u}=this,{view:f}=l;u.storedMarks&&e.setStoredMarks(u.storedMarks);const g={tr:e,editor:l,view:f,state:hf({state:u,transaction:e}),dispatch:i?()=>{}:void 0,chain:()=>this.createChain(e),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(a).map(([_,I])=>[_,(...T)=>I(...T)(g)]))}};return g}}const A3=ii.create({name:"keymap",addKeyboardShortcuts(){const o=()=>this.editor.commands.first(({commands:i})=>[()=>i.undoInputRule(),()=>i.command(({tr:a})=>{const{selection:l,doc:u}=a,{empty:f,$anchor:g}=l,{pos:_,parent:I}=g,T=Ce.atStart(u).from===_;return!f||!T||!I.type.isTextblock||I.textContent.length?!1:i.clearNodes()}),()=>i.deleteSelection(),()=>i.joinBackward(),()=>i.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:i})=>[()=>i.deleteSelection(),()=>i.joinForward(),()=>i.selectNodeForward()]);return{Enter:()=>this.editor.commands.first(({commands:i})=>[()=>i.newlineInCode(),()=>i.createParagraphNear(),()=>i.liftEmptyBlock(),()=>i.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:o,"Mod-Backspace":o,"Shift-Backspace":o,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()}},addProseMirrorPlugins(){return[new ni({key:new Ki("clearDocument"),appendTransaction:(o,e,i)=>{if(!(o.some(K=>K.docChanged)&&!e.doc.eq(i.doc)))return;const{empty:l,from:u,to:f}=e.selection,g=Ce.atStart(e.doc).from,_=Ce.atEnd(e.doc).to,I=u===g&&f===_,T=i.doc.textBetween(0,i.doc.content.size," "," ").length===0;if(l||!I||!T)return;const N=i.tr,D=hf({state:i,transaction:N}),{commands:F}=new pf({editor:this.editor,state:D});if(F.clearNodes(),!!N.steps.length)return N}})]}}),g3=ii.create({name:"tabindex",addProseMirrorPlugins(){return[new ni({key:new Ki("tabindex"),props:{attributes:{tabindex:"0"}}})]}});var m3=Object.freeze({__proto__:null,ClipboardTextSerializer:fU,Commands:h3,Editable:p3,FocusEvents:f3,Keymap:A3,Tabindex:g3});function E3(o,e){const i=oi(e,o.schema),{from:a,to:l}=o.selection,u=[];o.doc.nodesBetween(a,l,g=>{u.push(g)});const f=u.reverse().find(g=>g.type.name===i.name);return f?Dt({},f.attrs):{}}function _3(o,e){const i=lf(typeof e=="string"?e:e.name,o.schema);return i==="node"?E3(o,e):i==="mark"?Bw(o,e):{}}function v3(o,e,i={}){if(!e)return Fu(o,null,i)||BE(o,null,i);const a=lf(e,o.schema);return a==="node"?Fu(o,e,i):a==="mark"?BE(o,e,i):!1}function I3(o,e){const i=li.fromSchema(e).serializeFragment(o),l=document.implementation.createHTMLDocument().createElement("div");return l.appendChild(i),l.innerHTML}function C3(o,e){const i={from:0,to:o.content.size};return Nw(o,i,e)}function S3(o){var e;const i=(e=o.type.createAndFill())===null||e===void 0?void 0:e.toJSON(),a=o.toJSON();return JSON.stringify(i)===JSON.stringify(a)}function y3(o){const e=document.querySelector("style[data-tiptap-style]");if(e!==null)return e;const i=document.createElement("style");return i.setAttribute("data-tiptap-style",""),i.innerHTML=o,document.getElementsByTagName("head")[0].appendChild(i),i}class ff{constructor(e){this.find=e.find,this.handler=e.handler}}const T3=(o,e)=>{if(kE(e))return e.exec(o);const i=e(o);if(!i)return null;const a=[];return a.push(i.text),a.index=i.index,a.input=o,a.data=i.data,i.replaceWith&&(i.text.includes(i.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),a.push(i.replaceWith)),a};function UE(o){var e;const{editor:i,from:a,to:l,text:u,rules:f,plugin:g}=o,{view:_}=i;if(_.composing)return!1;const I=_.state.doc.resolve(a);if(I.parent.type.spec.code||!!((e=I.nodeBefore||I.nodeAfter)===null||e===void 0?void 0:e.marks.find(F=>F.type.spec.code)))return!1;let T=!1;const N=500,D=I.parent.textBetween(Math.max(0,I.parentOffset-N),I.parentOffset,void 0," ")+u;return f.forEach(F=>{if(T)return;const K=T3(D,F.find);if(!K)return;const J=_.state.tr,nt=hf({state:_.state,transaction:J}),it={from:a-(K[0].length-u.length),to:l},{commands:z,chain:Ot,can:X}=new pf({editor:i,state:nt});F.handler({state:nt,range:it,match:K,commands:z,chain:Ot,can:X})===null||!J.steps.length||(J.setMeta(g,{transform:J,from:a,to:l,text:u}),_.dispatch(J),T=!0)}),T}function R3(o){const{editor:e,rules:i}=o,a=new ni({state:{init(){return null},apply(l,u){const f=l.getMeta(this);return f||(l.selectionSet||l.docChanged?null:u)}},props:{handleTextInput(l,u,f,g){return UE({editor:e,from:u,to:f,text:g,rules:i,plugin:a})},handleDOMEvents:{compositionend:l=>(setTimeout(()=>{const{$cursor:u}=l.state.selection;u&&UE({editor:e,from:u.pos,to:u.pos,text:"",rules:i,plugin:a})}),!1)},handleKeyDown(l,u){if(u.key!=="Enter")return!1;const{$cursor:f}=l.state.selection;return f?UE({editor:e,from:f.pos,to:f.pos,text:`
`,rules:i,plugin:a}):!1}},isInputRules:!0});return a}function w3(o){return typeof o=="number"}class b3{constructor(e){this.find=e.find,this.handler=e.handler}}const N3=(o,e)=>{if(kE(e))return[...o.matchAll(e)];const i=e(o);return i?i.map(a=>{const l=[];return l.push(a.text),l.index=a.index,l.input=o,l.data=a.data,a.replaceWith&&(a.text.includes(a.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),l.push(a.replaceWith)),l}):[]};function O3(o){const{editor:e,state:i,from:a,to:l,rule:u}=o,{commands:f,chain:g,can:_}=new pf({editor:e,state:i}),I=[];return i.doc.nodesBetween(a,l,(N,D)=>{if(!N.isTextblock||N.type.spec.code)return;const F=Math.max(a,D),K=Math.min(l,D+N.content.size),J=N.textBetween(F-D,K-D,void 0,"\uFFFC");N3(J,u.find).forEach(it=>{if(it.index===void 0)return;const z=F+it.index+1,Ot=z+it[0].length,X={from:i.tr.mapping.map(z),to:i.tr.mapping.map(Ot)},yt=u.handler({state:i,range:X,match:it,commands:f,chain:g,can:_});I.push(yt)})}),I.every(N=>N!==null)}function k3(o){const{editor:e,rules:i}=o;let a=null,l=!1,u=!1;return i.map(g=>new ni({view(_){const I=T=>{var N;a=((N=_.dom.parentElement)===null||N===void 0?void 0:N.contains(T.target))?_.dom.parentElement:null};return window.addEventListener("dragstart",I),{destroy(){window.removeEventListener("dragstart",I)}}},props:{handleDOMEvents:{drop:_=>(u=a===_.dom.parentElement,!1),paste:(_,I)=>{var T;const N=(T=I.clipboardData)===null||T===void 0?void 0:T.getData("text/html");return l=!!(N==null?void 0:N.includes("data-pm-slice")),!1}}},appendTransaction:(_,I,T)=>{const N=_[0],D=N.getMeta("uiEvent")==="paste"&&!l,F=N.getMeta("uiEvent")==="drop"&&!u;if(!D&&!F)return;const K=I.doc.content.findDiffStart(T.doc.content),J=I.doc.content.findDiffEnd(T.doc.content);if(!w3(K)||!J||K===J.b)return;const nt=T.tr,it=hf({state:T,transaction:nt});if(!(!O3({editor:e,state:it,from:Math.max(K-1,0),to:J.b,rule:g})||!nt.steps.length))return nt}}))}function Vw(o){const e=[],{nodeExtensions:i,markExtensions:a}=uf(o),l=[...i,...a],u={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0};return o.forEach(f=>{const g={name:f.name,options:f.options,storage:f.storage},_=ie(f,"addGlobalAttributes",g);if(!_)return;_().forEach(T=>{T.types.forEach(N=>{Object.entries(T.attributes).forEach(([D,F])=>{e.push({type:N,name:D,attribute:Dt(Dt({},u),F)})})})})}),l.forEach(f=>{const g={name:f.name,options:f.options,storage:f.storage},_=ie(f,"addAttributes",g);if(!_)return;const I=_();Object.entries(I).forEach(([T,N])=>{e.push({type:f.name,name:T,attribute:Dt(Dt({},u),N)})})}),e}function pi(...o){return o.filter(e=>!!e).reduce((e,i)=>{const a=Dt({},e);return Object.entries(i).forEach(([l,u])=>{if(!a[l]){a[l]=u;return}l==="class"?a[l]=[a[l],u].join(" "):l==="style"?a[l]=[a[l],u].join("; "):a[l]=u}),a},{})}function xE(o,e){return e.filter(i=>i.attribute.rendered).map(i=>i.attribute.renderHTML?i.attribute.renderHTML(o.attrs)||{}:{[i.name]:o.attrs[i.name]}).reduce((i,a)=>pi(i,a),{})}function D3(o={}){return Object.keys(o).length===0&&o.constructor===Object}function L3(o){return typeof o!="string"?o:o.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(o):o==="true"?!0:o==="false"?!1:o}function Gw(o,e){return o.style?o:Qi(Dt({},o),{getAttrs:i=>{const a=o.getAttrs?o.getAttrs(i):o.attrs;if(a===!1)return!1;const l=e.filter(u=>u.attribute.rendered).reduce((u,f)=>{const g=f.attribute.parseHTML?f.attribute.parseHTML(i):L3(i.getAttribute(f.name));return ME(g)&&console.warn(`[tiptap warn]: BREAKING CHANGE: "parseHTML" for your attribute "${f.name}" returns an object but should return the value itself. If this is expected you can ignore this message. This warning will be removed in one of the next releases. Further information: https://github.com/ueberdosis/tiptap/issues/1863`),g==null?u:Qi(Dt({},u),{[f.name]:g})},{});return Dt(Dt({},a),l)}})}function jw(o){return Object.fromEntries(Object.entries(o).filter(([e,i])=>e==="attrs"&&D3(i)?!1:i!=null))}function M3(o){var e;const i=Vw(o),{nodeExtensions:a,markExtensions:l}=uf(o),u=(e=a.find(_=>ie(_,"topNode")))===null||e===void 0?void 0:e.name,f=Object.fromEntries(a.map(_=>{const I=i.filter(nt=>nt.type===_.name),T={name:_.name,options:_.options,storage:_.storage},N=o.reduce((nt,it)=>{const z=ie(it,"extendNodeSchema",T);return Dt(Dt({},nt),z?z(_):{})},{}),D=jw(Qi(Dt({},N),{content:Ve(ie(_,"content",T)),marks:Ve(ie(_,"marks",T)),group:Ve(ie(_,"group",T)),inline:Ve(ie(_,"inline",T)),atom:Ve(ie(_,"atom",T)),selectable:Ve(ie(_,"selectable",T)),draggable:Ve(ie(_,"draggable",T)),code:Ve(ie(_,"code",T)),defining:Ve(ie(_,"defining",T)),isolating:Ve(ie(_,"isolating",T)),attrs:Object.fromEntries(I.map(nt=>{var it;return[nt.name,{default:(it=nt==null?void 0:nt.attribute)===null||it===void 0?void 0:it.default}]}))})),F=Ve(ie(_,"parseHTML",T));F&&(D.parseDOM=F.map(nt=>Gw(nt,I)));const K=ie(_,"renderHTML",T);K&&(D.toDOM=nt=>K({node:nt,HTMLAttributes:xE(nt,I)}));const J=ie(_,"renderText",T);return J&&(D.toText=J),[_.name,D]})),g=Object.fromEntries(l.map(_=>{const I=i.filter(J=>J.type===_.name),T={name:_.name,options:_.options,storage:_.storage},N=o.reduce((J,nt)=>{const it=ie(nt,"extendMarkSchema",T);return Dt(Dt({},J),it?it(_):{})},{}),D=jw(Qi(Dt({},N),{inclusive:Ve(ie(_,"inclusive",T)),excludes:Ve(ie(_,"excludes",T)),group:Ve(ie(_,"group",T)),spanning:Ve(ie(_,"spanning",T)),code:Ve(ie(_,"code",T)),attrs:Object.fromEntries(I.map(J=>{var nt;return[J.name,{default:(nt=J==null?void 0:J.attribute)===null||nt===void 0?void 0:nt.default}]}))})),F=Ve(ie(_,"parseHTML",T));F&&(D.parseDOM=F.map(J=>Gw(J,I)));const K=ie(_,"renderHTML",T);return K&&(D.toDOM=J=>K({mark:J,HTMLAttributes:xE(J,I)})),[_.name,D]}));return new Oc({topNode:u,nodes:f,marks:g})}function FE(o,e){return e.nodes[o]||e.marks[o]||null}function Ww(o,e){return Array.isArray(e)?e.some(i=>(typeof i=="string"?i:i.name)===o.name):e}function P3(o){const e=o.filter((i,a)=>o.indexOf(i)!==a);return[...new Set(e)]}class ed{constructor(e,i){this.splittableMarks=[],this.editor=i,this.extensions=ed.resolve(e),this.schema=M3(this.extensions),this.extensions.forEach(a=>{var l;this.editor.extensionStorage[a.name]=a.storage;const u={name:a.name,options:a.options,storage:a.storage,editor:this.editor,type:FE(a.name,this.schema)};a.type==="mark"&&((l=Ve(ie(a,"keepOnSplit",u)))!==null&&l!==void 0?l:!0)&&this.splittableMarks.push(a.name);const f=ie(a,"onBeforeCreate",u);f&&this.editor.on("beforeCreate",f);const g=ie(a,"onCreate",u);g&&this.editor.on("create",g);const _=ie(a,"onUpdate",u);_&&this.editor.on("update",_);const I=ie(a,"onSelectionUpdate",u);I&&this.editor.on("selectionUpdate",I);const T=ie(a,"onTransaction",u);T&&this.editor.on("transaction",T);const N=ie(a,"onFocus",u);N&&this.editor.on("focus",N);const D=ie(a,"onBlur",u);D&&this.editor.on("blur",D);const F=ie(a,"onDestroy",u);F&&this.editor.on("destroy",F)})}static resolve(e){const i=ed.sort(ed.flatten(e)),a=P3(i.map(l=>l.name));return a.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${a.map(l=>`'${l}'`).join(", ")}]. This can lead to issues.`),i}static flatten(e){return e.map(i=>{const a={name:i.name,options:i.options,storage:i.storage},l=ie(i,"addExtensions",a);return l?[i,...this.flatten(l())]:i}).flat(10)}static sort(e){const i=100;return e.sort((a,l)=>{const u=ie(a,"priority")||i,f=ie(l,"priority")||i;return u>f?-1:u<f?1:0})}get commands(){return this.extensions.reduce((e,i)=>{const a={name:i.name,options:i.options,storage:i.storage,editor:this.editor,type:FE(i.name,this.schema)},l=ie(i,"addCommands",a);return l?Dt(Dt({},e),l()):e},{})}get plugins(){const{editor:e}=this,i=ed.sort([...this.extensions].reverse()),a=[],l=[],u=i.map(f=>{const g={name:f.name,options:f.options,storage:f.storage,editor:e,type:FE(f.name,this.schema)},_=[],I=ie(f,"addKeyboardShortcuts",g);if(I){const F=Object.fromEntries(Object.entries(I()).map(([J,nt])=>[J,()=>nt({editor:e})])),K=hU(F);_.push(K)}const T=ie(f,"addInputRules",g);Ww(f,e.options.enableInputRules)&&T&&a.push(...T());const N=ie(f,"addPasteRules",g);Ww(f,e.options.enablePasteRules)&&N&&l.push(...N());const D=ie(f,"addProseMirrorPlugins",g);if(D){const F=D();_.push(...F)}return _}).flat();return[R3({editor:e,rules:a}),...k3({editor:e,rules:l}),...u]}get attributes(){return Vw(this.extensions)}get nodeViews(){const{editor:e}=this,{nodeExtensions:i}=uf(this.extensions);return Object.fromEntries(i.filter(a=>!!ie(a,"addNodeView")).map(a=>{const l=this.attributes.filter(_=>_.type===a.name),u={name:a.name,options:a.options,storage:a.storage,editor:e,type:oi(a.name,this.schema)},f=ie(a,"addNodeView",u);if(!f)return[];const g=(_,I,T,N)=>{const D=xE(_,l);return f()({editor:e,node:_,getPos:T,decorations:N,HTMLAttributes:D,extension:a})};return[a.name,g]}))}}class B3{constructor(){this.callbacks={}}on(e,i){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(i),this}emit(e,...i){const a=this.callbacks[e];return a&&a.forEach(l=>l.apply(this,i)),this}off(e,i){const a=this.callbacks[e];return a&&(i?this.callbacks[e]=a.filter(l=>l!==i):delete this.callbacks[e]),this}removeAllListeners(){this.callbacks={}}}const U3=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 1px !important;
  height: 1px !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}

.tippy-box[data-animation=fade][data-state=hidden] {
  opacity: 0
}`;class x3 extends B3{constructor(e={}){super();this.isFocused=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(e),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}))},0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=y3(U3))}setOptions(e={}){this.options=Dt(Dt({},this.options),e),!(!this.view||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(e){this.setOptions({editable:e})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(e,i){const a=bw(i)?i(e,this.state.plugins):[...this.state.plugins,e],l=this.state.reconfigure({plugins:a});this.view.updateState(l)}unregisterPlugin(e){if(this.isDestroyed)return;const i=typeof e=="string"?`${e}$`:e.key,a=this.state.reconfigure({plugins:this.state.plugins.filter(l=>!l.key.startsWith(i))});this.view.updateState(a)}createExtensionManager(){const i=[...this.options.enableCoreExtensions?Object.values(m3):[],...this.options.extensions].filter(a=>["extension","node","mark"].includes(a==null?void 0:a.type));this.extensionManager=new ed(i,this)}createCommandManager(){this.commandManager=new pf({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){const e=Pw(this.options.content,this.schema,this.options.parseOptions),i=Dw(e,this.options.autofocus);this.view=new Vn(this.options.element,Qi(Dt({},this.options.editorProps),{dispatchTransaction:this.dispatchTransaction.bind(this),state:ki.create({doc:e,selection:i})}));const a=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(a),this.createNodeViews();const l=this.view.dom;l.editor=this}createNodeViews(){this.view.setProps({nodeViews:this.extensionManager.nodeViews})}captureTransaction(e){this.isCapturingTransaction=!0,e(),this.isCapturingTransaction=!1;const i=this.capturedTransaction;return this.capturedTransaction=null,i}dispatchTransaction(e){if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=e;return}e.steps.forEach(f=>{var g;return(g=this.capturedTransaction)===null||g===void 0?void 0:g.step(f)});return}const i=this.state.apply(e),a=!this.state.selection.eq(i.selection);this.view.updateState(i),this.emit("transaction",{editor:this,transaction:e}),a&&this.emit("selectionUpdate",{editor:this,transaction:e});const l=e.getMeta("focus"),u=e.getMeta("blur");l&&this.emit("focus",{editor:this,event:l.event,transaction:e}),u&&this.emit("blur",{editor:this,event:u.event,transaction:e}),!(!e.docChanged||e.getMeta("preventUpdate"))&&this.emit("update",{editor:this,transaction:e})}getAttributes(e){return _3(this.state,e)}isActive(e,i){const a=typeof e=="string"?e:null,l=typeof e=="string"?i:e;return v3(this.state,a,l)}getJSON(){return this.state.doc.toJSON()}getHTML(){return I3(this.state.doc.content,this.schema)}getText(e){const{blockSeparator:i=`

`,textSerializers:a={}}=e||{};return C3(this.state.doc,{blockSeparator:i,textSerializers:Dt(Dt({},a),Ow(this.schema))})}get isEmpty(){return S3(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){this.emit("destroy"),this.view&&this.view.destroy(),this.removeAllListeners()}get isDestroyed(){var e;return!((e=this.view)===null||e===void 0?void 0:e.docView)}}class Di{constructor(e={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config=Dt(Dt({},this.config),e),this.name=this.config.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=Ve(ie(this,"addOptions",{name:this.name}))),this.storage=Ve(ie(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Di(e)}configure(e={}){const i=this.extend();return i.options=sf(this.options,e),i.storage=Ve(ie(i,"addStorage",{name:i.name,options:i.options})),i}extend(e={}){const i=new Di(e);return i.parent=this,this.child=i,i.name=e.name?e.name:i.parent.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${i.name}".`),i.options=Ve(ie(i,"addOptions",{name:i.name})),i.storage=Ve(ie(i,"addStorage",{name:i.name,options:i.options})),i}}class tc{constructor(e={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config=Dt(Dt({},this.config),e),this.name=this.config.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=Ve(ie(this,"addOptions",{name:this.name}))),this.storage=Ve(ie(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new tc(e)}configure(e={}){const i=this.extend();return i.options=sf(this.options,e),i.storage=Ve(ie(i,"addStorage",{name:i.name,options:i.options})),i}extend(e={}){const i=new tc(e);return i.parent=this,this.child=i,i.name=e.name?e.name:i.parent.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${i.name}".`),i.options=Ve(ie(i,"addOptions",{name:i.name})),i.storage=Ve(ie(i,"addStorage",{name:i.name,options:i.options})),i}}function F3(o){return new ff({find:o.find,handler:({state:e,range:i,match:a})=>{const l=Ve(o.getAttributes,void 0,a)||{},{tr:u}=e,f=i.from;let g=i.to;if(a[1]){const _=a[0].lastIndexOf(a[1]);let I=f+_;I>g?I=g:g=I+a[1].length;const T=a[0][a[0].length-1];u.insertText(T,f+a[0].length-1),u.replaceWith(I,g,o.type.create(l))}else a[0]&&u.replaceWith(f,g,o.type.create(l))}})}function Kw(o,e,i){const a=[];return o===e?i.resolve(o).marks().forEach(l=>{const u=i.resolve(o-1),f=LE(u,l.type);!f||a.push(Dt({mark:l},f))}):i.nodesBetween(o,e,(l,u)=>{a.push(...l.marks.map(f=>({from:u,to:u+l.nodeSize,mark:f})))}),a}function Uc(o){return new ff({find:o.find,handler:({state:e,range:i,match:a})=>{const l=Ve(o.getAttributes,void 0,a);if(l===!1||l===null)return null;const{tr:u}=e,f=a[a.length-1],g=a[0];let _=i.to;if(f){const I=g.search(/\S/),T=i.from+g.indexOf(f),N=T+f.length;if(Kw(i.from,i.to,e.doc).filter(F=>F.mark.type.excluded.find(J=>J===o.type&&J!==F.mark.type)).filter(F=>F.to>T).length)return null;N<i.to&&u.delete(N,i.to),T>i.from&&u.delete(i.from+I,T),_=i.from+I+f.length,u.addMark(i.from+I,_,o.type.create(l||{})),u.removeStoredMark(o.type)}}})}function QE(o){return new ff({find:o.find,handler:({state:e,range:i,match:a})=>{const l=e.doc.resolve(i.from),u=Ve(o.getAttributes,void 0,a)||{};if(!l.node(-1).canReplaceWith(l.index(-1),l.indexAfter(-1),o.type))return null;e.tr.delete(i.from,i.to).setBlockType(i.from,i.from,o.type,u)}})}function Af(o){return new ff({find:o.find,handler:({state:e,range:i,match:a})=>{const l=Ve(o.getAttributes,void 0,a)||{},u=e.tr.delete(i.from,i.to),g=u.doc.resolve(i.from).blockRange(),_=g&&Fm(g,o.type,l);if(!_)return null;u.wrap(g,_);const I=u.doc.resolve(i.from-1).nodeBefore;I&&I.type===o.type&&yu(u.doc,i.from-1)&&(!o.joinPredicate||o.joinPredicate(a,I))&&u.join(i.from-1)}})}function xc(o){return new b3({find:o.find,handler:({state:e,range:i,match:a})=>{const l=Ve(o.getAttributes,void 0,a);if(l===!1||l===null)return null;const{tr:u}=e,f=a[a.length-1],g=a[0];let _=i.to;if(f){const I=g.search(/\S/),T=i.from+g.indexOf(f),N=T+f.length;if(Kw(i.from,i.to,e.doc).filter(F=>F.mark.type.excluded.find(J=>J===o.type&&J!==F.mark.type)).filter(F=>F.to>T).length)return null;N<i.to&&u.delete(N,i.to),T>i.from&&u.delete(i.from+I,T),_=i.from+I+f.length,u.addMark(i.from+I,_,o.type.create(l||{})),u.removeStoredMark(o.type)}}})}function Q3(o){return ME(o)&&o instanceof ke}function Hw(o,e,i){const a=0,l=o.state.doc.content.size,u=Bc(e,a,l),f=Bc(i,a,l),g=o.coordsAtPos(u),_=o.coordsAtPos(f,-1),I=Math.min(g.top,_.top),T=Math.max(g.bottom,_.bottom),N=Math.min(g.left,_.left),D=Math.max(g.right,_.right),F=D-N,K=T-I,it={top:I,bottom:T,left:N,right:D,width:F,height:K,x:N,y:I};return Qi(Dt({},it),{toJSON:()=>it})}var ho="top",Xo="bottom",Zo="right",po="left",VE="auto",Qu=[ho,Xo,Zo,po],rd="start",Vu="end",V3="clippingParents",Yw="viewport",Gu="popper",G3="reference",qw=Qu.reduce(function(o,e){return o.concat([e+"-"+rd,e+"-"+Vu])},[]),Jw=[].concat(Qu,[VE]).reduce(function(o,e){return o.concat([e,e+"-"+rd,e+"-"+Vu])},[]),j3="beforeRead",W3="read",K3="afterRead",H3="beforeMain",Y3="main",q3="afterMain",J3="beforeWrite",z3="write",X3="afterWrite",Z3=[j3,W3,K3,H3,Y3,q3,J3,z3,X3];function Gs(o){return o?(o.nodeName||"").toLowerCase():null}function vs(o){if(o==null)return window;if(o.toString()!=="[object Window]"){var e=o.ownerDocument;return e&&e.defaultView||window}return o}function nd(o){var e=vs(o).Element;return o instanceof e||o instanceof Element}function $o(o){var e=vs(o).HTMLElement;return o instanceof e||o instanceof HTMLElement}function zw(o){if(typeof ShadowRoot=="undefined")return!1;var e=vs(o).ShadowRoot;return o instanceof e||o instanceof ShadowRoot}function $3(o){var e=o.state;Object.keys(e.elements).forEach(function(i){var a=e.styles[i]||{},l=e.attributes[i]||{},u=e.elements[i];!$o(u)||!Gs(u)||(Object.assign(u.style,a),Object.keys(l).forEach(function(f){var g=l[f];g===!1?u.removeAttribute(f):u.setAttribute(f,g===!0?"":g)}))})}function tF(o){var e=o.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach(function(a){var l=e.elements[a],u=e.attributes[a]||{},f=Object.keys(e.styles.hasOwnProperty(a)?e.styles[a]:i[a]),g=f.reduce(function(_,I){return _[I]="",_},{});!$o(l)||!Gs(l)||(Object.assign(l.style,g),Object.keys(u).forEach(function(_){l.removeAttribute(_)}))})}}var Xw={name:"applyStyles",enabled:!0,phase:"write",fn:$3,effect:tF,requires:["computeStyles"]};function js(o){return o.split("-")[0]}var Fc=Math.max,gf=Math.min,id=Math.round;function od(o,e){e===void 0&&(e=!1);var i=o.getBoundingClientRect(),a=1,l=1;if($o(o)&&e){var u=o.offsetHeight,f=o.offsetWidth;f>0&&(a=id(i.width)/f||1),u>0&&(l=id(i.height)/u||1)}return{width:i.width/a,height:i.height/l,top:i.top/l,right:i.right/a,bottom:i.bottom/l,left:i.left/a,x:i.left/a,y:i.top/l}}function GE(o){var e=od(o),i=o.offsetWidth,a=o.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-a)<=1&&(a=e.height),{x:o.offsetLeft,y:o.offsetTop,width:i,height:a}}function Zw(o,e){var i=e.getRootNode&&e.getRootNode();if(o.contains(e))return!0;if(i&&zw(i)){var a=e;do{if(a&&o.isSameNode(a))return!0;a=a.parentNode||a.host}while(a)}return!1}function ba(o){return vs(o).getComputedStyle(o)}function eF(o){return["table","td","th"].indexOf(Gs(o))>=0}function ec(o){return((nd(o)?o.ownerDocument:o.document)||window.document).documentElement}function mf(o){return Gs(o)==="html"?o:o.assignedSlot||o.parentNode||(zw(o)?o.host:null)||ec(o)}function $w(o){return!$o(o)||ba(o).position==="fixed"?null:o.offsetParent}function rF(o){var e=navigator.userAgent.toLowerCase().indexOf("firefox")!==-1,i=navigator.userAgent.indexOf("Trident")!==-1;if(i&&$o(o)){var a=ba(o);if(a.position==="fixed")return null}for(var l=mf(o);$o(l)&&["html","body"].indexOf(Gs(l))<0;){var u=ba(l);if(u.transform!=="none"||u.perspective!=="none"||u.contain==="paint"||["transform","perspective"].indexOf(u.willChange)!==-1||e&&u.willChange==="filter"||e&&u.filter&&u.filter!=="none")return l;l=l.parentNode}return null}function ju(o){for(var e=vs(o),i=$w(o);i&&eF(i)&&ba(i).position==="static";)i=$w(i);return i&&(Gs(i)==="html"||Gs(i)==="body"&&ba(i).position==="static")?e:i||rF(o)||e}function jE(o){return["top","bottom"].indexOf(o)>=0?"x":"y"}function Wu(o,e,i){return Fc(o,gf(e,i))}function nF(o,e,i){var a=Wu(o,e,i);return a>i?i:a}function tb(){return{top:0,right:0,bottom:0,left:0}}function eb(o){return Object.assign({},tb(),o)}function rb(o,e){return e.reduce(function(i,a){return i[a]=o,i},{})}var iF=function(e,i){return e=typeof e=="function"?e(Object.assign({},i.rects,{placement:i.placement})):e,eb(typeof e!="number"?e:rb(e,Qu))};function oF(o){var e,i=o.state,a=o.name,l=o.options,u=i.elements.arrow,f=i.modifiersData.popperOffsets,g=js(i.placement),_=jE(g),I=[po,Zo].indexOf(g)>=0,T=I?"height":"width";if(!(!u||!f)){var N=iF(l.padding,i),D=GE(u),F=_==="y"?ho:po,K=_==="y"?Xo:Zo,J=i.rects.reference[T]+i.rects.reference[_]-f[_]-i.rects.popper[T],nt=f[_]-i.rects.reference[_],it=ju(u),z=it?_==="y"?it.clientHeight||0:it.clientWidth||0:0,Ot=J/2-nt/2,X=N[F],yt=z-D[T]-N[K],Mt=z/2-D[T]/2+Ot,$t=Wu(X,Mt,yt),ge=_;i.modifiersData[a]=(e={},e[ge]=$t,e.centerOffset=$t-Mt,e)}}function sF(o){var e=o.state,i=o.options,a=i.element,l=a===void 0?"[data-popper-arrow]":a;l!=null&&(typeof l=="string"&&(l=e.elements.popper.querySelector(l),!l)||!Zw(e.elements.popper,l)||(e.elements.arrow=l))}var aF={name:"arrow",enabled:!0,phase:"main",fn:oF,effect:sF,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function sd(o){return o.split("-")[1]}var cF={top:"auto",right:"auto",bottom:"auto",left:"auto"};function lF(o){var e=o.x,i=o.y,a=window,l=a.devicePixelRatio||1;return{x:id(e*l)/l||0,y:id(i*l)/l||0}}function nb(o){var e,i=o.popper,a=o.popperRect,l=o.placement,u=o.variation,f=o.offsets,g=o.position,_=o.gpuAcceleration,I=o.adaptive,T=o.roundOffsets,N=o.isFixed,D=f.x,F=D===void 0?0:D,K=f.y,J=K===void 0?0:K,nt=typeof T=="function"?T({x:F,y:J}):{x:F,y:J};F=nt.x,J=nt.y;var it=f.hasOwnProperty("x"),z=f.hasOwnProperty("y"),Ot=po,X=ho,yt=window;if(I){var Mt=ju(i),$t="clientHeight",ge="clientWidth";if(Mt===vs(i)&&(Mt=ec(i),ba(Mt).position!=="static"&&g==="absolute"&&($t="scrollHeight",ge="scrollWidth")),Mt=Mt,l===ho||(l===po||l===Zo)&&u===Vu){X=Xo;var Te=N&&yt.visualViewport?yt.visualViewport.height:Mt[$t];J-=Te-a.height,J*=_?1:-1}if(l===po||(l===ho||l===Xo)&&u===Vu){Ot=Zo;var Se=N&&yt.visualViewport?yt.visualViewport.width:Mt[ge];F-=Se-a.width,F*=_?1:-1}}var lr=Object.assign({position:g},I&&cF),Er=T===!0?lF({x:F,y:J}):{x:F,y:J};if(F=Er.x,J=Er.y,_){var sr;return Object.assign({},lr,(sr={},sr[X]=z?"0":"",sr[Ot]=it?"0":"",sr.transform=(yt.devicePixelRatio||1)<=1?"translate("+F+"px, "+J+"px)":"translate3d("+F+"px, "+J+"px, 0)",sr))}return Object.assign({},lr,(e={},e[X]=z?J+"px":"",e[Ot]=it?F+"px":"",e.transform="",e))}function dF(o){var e=o.state,i=o.options,a=i.gpuAcceleration,l=a===void 0?!0:a,u=i.adaptive,f=u===void 0?!0:u,g=i.roundOffsets,_=g===void 0?!0:g,I={placement:js(e.placement),variation:sd(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:l,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,nb(Object.assign({},I,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:f,roundOffsets:_})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,nb(Object.assign({},I,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:_})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}var uF={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:dF,data:{}},Ef={passive:!0};function hF(o){var e=o.state,i=o.instance,a=o.options,l=a.scroll,u=l===void 0?!0:l,f=a.resize,g=f===void 0?!0:f,_=vs(e.elements.popper),I=[].concat(e.scrollParents.reference,e.scrollParents.popper);return u&&I.forEach(function(T){T.addEventListener("scroll",i.update,Ef)}),g&&_.addEventListener("resize",i.update,Ef),function(){u&&I.forEach(function(T){T.removeEventListener("scroll",i.update,Ef)}),g&&_.removeEventListener("resize",i.update,Ef)}}var pF={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:hF,data:{}},fF={left:"right",right:"left",bottom:"top",top:"bottom"};function _f(o){return o.replace(/left|right|bottom|top/g,function(e){return fF[e]})}var AF={start:"end",end:"start"};function ib(o){return o.replace(/start|end/g,function(e){return AF[e]})}function WE(o){var e=vs(o),i=e.pageXOffset,a=e.pageYOffset;return{scrollLeft:i,scrollTop:a}}function KE(o){return od(ec(o)).left+WE(o).scrollLeft}function gF(o){var e=vs(o),i=ec(o),a=e.visualViewport,l=i.clientWidth,u=i.clientHeight,f=0,g=0;return a&&(l=a.width,u=a.height,/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||(f=a.offsetLeft,g=a.offsetTop)),{width:l,height:u,x:f+KE(o),y:g}}function mF(o){var e,i=ec(o),a=WE(o),l=(e=o.ownerDocument)==null?void 0:e.body,u=Fc(i.scrollWidth,i.clientWidth,l?l.scrollWidth:0,l?l.clientWidth:0),f=Fc(i.scrollHeight,i.clientHeight,l?l.scrollHeight:0,l?l.clientHeight:0),g=-a.scrollLeft+KE(o),_=-a.scrollTop;return ba(l||i).direction==="rtl"&&(g+=Fc(i.clientWidth,l?l.clientWidth:0)-u),{width:u,height:f,x:g,y:_}}function HE(o){var e=ba(o),i=e.overflow,a=e.overflowX,l=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+l+a)}function ob(o){return["html","body","#document"].indexOf(Gs(o))>=0?o.ownerDocument.body:$o(o)&&HE(o)?o:ob(mf(o))}function Ku(o,e){var i;e===void 0&&(e=[]);var a=ob(o),l=a===((i=o.ownerDocument)==null?void 0:i.body),u=vs(a),f=l?[u].concat(u.visualViewport||[],HE(a)?a:[]):a,g=e.concat(f);return l?g:g.concat(Ku(mf(f)))}function YE(o){return Object.assign({},o,{left:o.x,top:o.y,right:o.x+o.width,bottom:o.y+o.height})}function EF(o){var e=od(o);return e.top=e.top+o.clientTop,e.left=e.left+o.clientLeft,e.bottom=e.top+o.clientHeight,e.right=e.left+o.clientWidth,e.width=o.clientWidth,e.height=o.clientHeight,e.x=e.left,e.y=e.top,e}function sb(o,e){return e===Yw?YE(gF(o)):nd(e)?EF(e):YE(mF(ec(o)))}function _F(o){var e=Ku(mf(o)),i=["absolute","fixed"].indexOf(ba(o).position)>=0,a=i&&$o(o)?ju(o):o;return nd(a)?e.filter(function(l){return nd(l)&&Zw(l,a)&&Gs(l)!=="body"}):[]}function vF(o,e,i){var a=e==="clippingParents"?_F(o):[].concat(e),l=[].concat(a,[i]),u=l[0],f=l.reduce(function(g,_){var I=sb(o,_);return g.top=Fc(I.top,g.top),g.right=gf(I.right,g.right),g.bottom=gf(I.bottom,g.bottom),g.left=Fc(I.left,g.left),g},sb(o,u));return f.width=f.right-f.left,f.height=f.bottom-f.top,f.x=f.left,f.y=f.top,f}function ab(o){var e=o.reference,i=o.element,a=o.placement,l=a?js(a):null,u=a?sd(a):null,f=e.x+e.width/2-i.width/2,g=e.y+e.height/2-i.height/2,_;switch(l){case ho:_={x:f,y:e.y-i.height};break;case Xo:_={x:f,y:e.y+e.height};break;case Zo:_={x:e.x+e.width,y:g};break;case po:_={x:e.x-i.width,y:g};break;default:_={x:e.x,y:e.y}}var I=l?jE(l):null;if(I!=null){var T=I==="y"?"height":"width";switch(u){case rd:_[I]=_[I]-(e[T]/2-i[T]/2);break;case Vu:_[I]=_[I]+(e[T]/2-i[T]/2);break}}return _}function Hu(o,e){e===void 0&&(e={});var i=e,a=i.placement,l=a===void 0?o.placement:a,u=i.boundary,f=u===void 0?V3:u,g=i.rootBoundary,_=g===void 0?Yw:g,I=i.elementContext,T=I===void 0?Gu:I,N=i.altBoundary,D=N===void 0?!1:N,F=i.padding,K=F===void 0?0:F,J=eb(typeof K!="number"?K:rb(K,Qu)),nt=T===Gu?G3:Gu,it=o.rects.popper,z=o.elements[D?nt:T],Ot=vF(nd(z)?z:z.contextElement||ec(o.elements.popper),f,_),X=od(o.elements.reference),yt=ab({reference:X,element:it,strategy:"absolute",placement:l}),Mt=YE(Object.assign({},it,yt)),$t=T===Gu?Mt:X,ge={top:Ot.top-$t.top+J.top,bottom:$t.bottom-Ot.bottom+J.bottom,left:Ot.left-$t.left+J.left,right:$t.right-Ot.right+J.right},Te=o.modifiersData.offset;if(T===Gu&&Te){var Se=Te[l];Object.keys(ge).forEach(function(lr){var Er=[Zo,Xo].indexOf(lr)>=0?1:-1,sr=[ho,Xo].indexOf(lr)>=0?"y":"x";ge[lr]+=Se[sr]*Er})}return ge}function IF(o,e){e===void 0&&(e={});var i=e,a=i.placement,l=i.boundary,u=i.rootBoundary,f=i.padding,g=i.flipVariations,_=i.allowedAutoPlacements,I=_===void 0?Jw:_,T=sd(a),N=T?g?qw:qw.filter(function(K){return sd(K)===T}):Qu,D=N.filter(function(K){return I.indexOf(K)>=0});D.length===0&&(D=N);var F=D.reduce(function(K,J){return K[J]=Hu(o,{placement:J,boundary:l,rootBoundary:u,padding:f})[js(J)],K},{});return Object.keys(F).sort(function(K,J){return F[K]-F[J]})}function CF(o){if(js(o)===VE)return[];var e=_f(o);return[ib(o),e,ib(e)]}function SF(o){var e=o.state,i=o.options,a=o.name;if(!e.modifiersData[a]._skip){for(var l=i.mainAxis,u=l===void 0?!0:l,f=i.altAxis,g=f===void 0?!0:f,_=i.fallbackPlacements,I=i.padding,T=i.boundary,N=i.rootBoundary,D=i.altBoundary,F=i.flipVariations,K=F===void 0?!0:F,J=i.allowedAutoPlacements,nt=e.options.placement,it=js(nt),z=it===nt,Ot=_||(z||!K?[_f(nt)]:CF(nt)),X=[nt].concat(Ot).reduce(function(un,tn){return un.concat(js(tn)===VE?IF(e,{placement:tn,boundary:T,rootBoundary:N,padding:I,flipVariations:K,allowedAutoPlacements:J}):tn)},[]),yt=e.rects.reference,Mt=e.rects.popper,$t=new Map,ge=!0,Te=X[0],Se=0;Se<X.length;Se++){var lr=X[Se],Er=js(lr),sr=sd(lr)===rd,Yn=[ho,Xo].indexOf(Er)>=0,br=Yn?"width":"height",$e=Hu(e,{placement:lr,boundary:T,rootBoundary:N,altBoundary:D,padding:I}),_n=Yn?sr?Zo:po:sr?Xo:ho;yt[br]>Mt[br]&&(_n=_f(_n));var Dn=_f(_n),_e=[];if(u&&_e.push($e[Er]<=0),g&&_e.push($e[_n]<=0,$e[Dn]<=0),_e.every(function(un){return un})){Te=lr,ge=!1;break}$t.set(lr,_e)}if(ge)for(var dn=K?3:1,mi=function(tn){var es=X.find(function(Oa){var qt=$t.get(Oa);if(qt)return qt.slice(0,tn).every(function(ka){return ka})});if(es)return Te=es,"break"},Nr=dn;Nr>0;Nr--){var Ss=mi(Nr);if(Ss==="break")break}e.placement!==Te&&(e.modifiersData[a]._skip=!0,e.placement=Te,e.reset=!0)}}var yF={name:"flip",enabled:!0,phase:"main",fn:SF,requiresIfExists:["offset"],data:{_skip:!1}};function cb(o,e,i){return i===void 0&&(i={x:0,y:0}),{top:o.top-e.height-i.y,right:o.right-e.width+i.x,bottom:o.bottom-e.height+i.y,left:o.left-e.width-i.x}}function lb(o){return[ho,Zo,Xo,po].some(function(e){return o[e]>=0})}function TF(o){var e=o.state,i=o.name,a=e.rects.reference,l=e.rects.popper,u=e.modifiersData.preventOverflow,f=Hu(e,{elementContext:"reference"}),g=Hu(e,{altBoundary:!0}),_=cb(f,a),I=cb(g,l,u),T=lb(_),N=lb(I);e.modifiersData[i]={referenceClippingOffsets:_,popperEscapeOffsets:I,isReferenceHidden:T,hasPopperEscaped:N},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":T,"data-popper-escaped":N})}var RF={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:TF};function wF(o,e,i){var a=js(o),l=[po,ho].indexOf(a)>=0?-1:1,u=typeof i=="function"?i(Object.assign({},e,{placement:o})):i,f=u[0],g=u[1];return f=f||0,g=(g||0)*l,[po,Zo].indexOf(a)>=0?{x:g,y:f}:{x:f,y:g}}function bF(o){var e=o.state,i=o.options,a=o.name,l=i.offset,u=l===void 0?[0,0]:l,f=Jw.reduce(function(T,N){return T[N]=wF(N,e.rects,u),T},{}),g=f[e.placement],_=g.x,I=g.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=_,e.modifiersData.popperOffsets.y+=I),e.modifiersData[a]=f}var NF={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:bF};function OF(o){var e=o.state,i=o.name;e.modifiersData[i]=ab({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}var kF={name:"popperOffsets",enabled:!0,phase:"read",fn:OF,data:{}};function DF(o){return o==="x"?"y":"x"}function LF(o){var e=o.state,i=o.options,a=o.name,l=i.mainAxis,u=l===void 0?!0:l,f=i.altAxis,g=f===void 0?!1:f,_=i.boundary,I=i.rootBoundary,T=i.altBoundary,N=i.padding,D=i.tether,F=D===void 0?!0:D,K=i.tetherOffset,J=K===void 0?0:K,nt=Hu(e,{boundary:_,rootBoundary:I,padding:N,altBoundary:T}),it=js(e.placement),z=sd(e.placement),Ot=!z,X=jE(it),yt=DF(X),Mt=e.modifiersData.popperOffsets,$t=e.rects.reference,ge=e.rects.popper,Te=typeof J=="function"?J(Object.assign({},e.rects,{placement:e.placement})):J,Se=typeof Te=="number"?{mainAxis:Te,altAxis:Te}:Object.assign({mainAxis:0,altAxis:0},Te),lr=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,Er={x:0,y:0};if(!!Mt){if(u){var sr,Yn=X==="y"?ho:po,br=X==="y"?Xo:Zo,$e=X==="y"?"height":"width",_n=Mt[X],Dn=_n+nt[Yn],_e=_n-nt[br],dn=F?-ge[$e]/2:0,mi=z===rd?$t[$e]:ge[$e],Nr=z===rd?-ge[$e]:-$t[$e],Ss=e.elements.arrow,un=F&&Ss?GE(Ss):{width:0,height:0},tn=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:tb(),es=tn[Yn],Oa=tn[br],qt=Wu(0,$t[$e],un[$e]),ka=Ot?$t[$e]/2-dn-qt-es-Se.mainAxis:mi-qt-es-Se.mainAxis,ys=Ot?-$t[$e]/2+dn+qt+Oa+Se.mainAxis:Nr+qt+Oa+Se.mainAxis,fo=e.elements.arrow&&ju(e.elements.arrow),Hc=fo?X==="y"?fo.clientTop||0:fo.clientLeft||0:0,Ln=(sr=lr==null?void 0:lr[X])!=null?sr:0,Yc=_n+ka-Ln-Hc,qc=_n+ys-Ln,Ao=Wu(F?gf(Dn,Yc):Dn,_n,F?Fc(_e,qc):_e);Mt[X]=Ao,Er[X]=Ao-_n}if(g){var Da,La=X==="x"?ho:po,rs=X==="x"?Xo:Zo,ns=Mt[yt],is=yt==="y"?"height":"width",Ts=ns+nt[La],Ei=ns-nt[rs],qs=[ho,po].indexOf(it)!==-1,He=(Da=lr==null?void 0:lr[yt])!=null?Da:0,ac=qs?Ts:ns-$t[is]-ge[is]-He+Se.altAxis,qn=qs?ns+$t[is]+ge[is]-He-Se.altAxis:Ei,Js=F&&qs?nF(ac,ns,qn):Wu(F?ac:Ts,ns,F?qn:Ei);Mt[yt]=Js,Er[yt]=Js-ns}e.modifiersData[a]=Er}}var MF={name:"preventOverflow",enabled:!0,phase:"main",fn:LF,requiresIfExists:["offset"]};function PF(o){return{scrollLeft:o.scrollLeft,scrollTop:o.scrollTop}}function BF(o){return o===vs(o)||!$o(o)?WE(o):PF(o)}function UF(o){var e=o.getBoundingClientRect(),i=id(e.width)/o.offsetWidth||1,a=id(e.height)/o.offsetHeight||1;return i!==1||a!==1}function xF(o,e,i){i===void 0&&(i=!1);var a=$o(e),l=$o(e)&&UF(e),u=ec(e),f=od(o,l),g={scrollLeft:0,scrollTop:0},_={x:0,y:0};return(a||!a&&!i)&&((Gs(e)!=="body"||HE(u))&&(g=BF(e)),$o(e)?(_=od(e,!0),_.x+=e.clientLeft,_.y+=e.clientTop):u&&(_.x=KE(u))),{x:f.left+g.scrollLeft-_.x,y:f.top+g.scrollTop-_.y,width:f.width,height:f.height}}function FF(o){var e=new Map,i=new Set,a=[];o.forEach(function(u){e.set(u.name,u)});function l(u){i.add(u.name);var f=[].concat(u.requires||[],u.requiresIfExists||[]);f.forEach(function(g){if(!i.has(g)){var _=e.get(g);_&&l(_)}}),a.push(u)}return o.forEach(function(u){i.has(u.name)||l(u)}),a}function QF(o){var e=FF(o);return Z3.reduce(function(i,a){return i.concat(e.filter(function(l){return l.phase===a}))},[])}function VF(o){var e;return function(){return e||(e=new Promise(function(i){Promise.resolve().then(function(){e=void 0,i(o())})})),e}}function GF(o){var e=o.reduce(function(i,a){var l=i[a.name];return i[a.name]=l?Object.assign({},l,a,{options:Object.assign({},l.options,a.options),data:Object.assign({},l.data,a.data)}):a,i},{});return Object.keys(e).map(function(i){return e[i]})}var db={placement:"bottom",modifiers:[],strategy:"absolute"};function ub(){for(var o=arguments.length,e=new Array(o),i=0;i<o;i++)e[i]=arguments[i];return!e.some(function(a){return!(a&&typeof a.getBoundingClientRect=="function")})}function jF(o){o===void 0&&(o={});var e=o,i=e.defaultModifiers,a=i===void 0?[]:i,l=e.defaultOptions,u=l===void 0?db:l;return function(g,_,I){I===void 0&&(I=u);var T={placement:"bottom",orderedModifiers:[],options:Object.assign({},db,u),modifiersData:{},elements:{reference:g,popper:_},attributes:{},styles:{}},N=[],D=!1,F={state:T,setOptions:function(it){var z=typeof it=="function"?it(T.options):it;J(),T.options=Object.assign({},u,T.options,z),T.scrollParents={reference:nd(g)?Ku(g):g.contextElement?Ku(g.contextElement):[],popper:Ku(_)};var Ot=QF(GF([].concat(a,T.options.modifiers)));return T.orderedModifiers=Ot.filter(function(X){return X.enabled}),K(),F.update()},forceUpdate:function(){if(!D){var it=T.elements,z=it.reference,Ot=it.popper;if(!!ub(z,Ot)){T.rects={reference:xF(z,ju(Ot),T.options.strategy==="fixed"),popper:GE(Ot)},T.reset=!1,T.placement=T.options.placement,T.orderedModifiers.forEach(function(Se){return T.modifiersData[Se.name]=Object.assign({},Se.data)});for(var X=0;X<T.orderedModifiers.length;X++){if(T.reset===!0){T.reset=!1,X=-1;continue}var yt=T.orderedModifiers[X],Mt=yt.fn,$t=yt.options,ge=$t===void 0?{}:$t,Te=yt.name;typeof Mt=="function"&&(T=Mt({state:T,options:ge,name:Te,instance:F})||T)}}}},update:VF(function(){return new Promise(function(nt){F.forceUpdate(),nt(T)})}),destroy:function(){J(),D=!0}};if(!ub(g,_))return F;F.setOptions(I).then(function(nt){!D&&I.onFirstUpdate&&I.onFirstUpdate(nt)});function K(){T.orderedModifiers.forEach(function(nt){var it=nt.name,z=nt.options,Ot=z===void 0?{}:z,X=nt.effect;if(typeof X=="function"){var yt=X({state:T,name:it,instance:F,options:Ot}),Mt=function(){};N.push(yt||Mt)}})}function J(){N.forEach(function(nt){return nt()}),N=[]}return F}}var WF=[pF,kF,uF,Xw,NF,yF,MF,aF,RF],KF=jF({defaultModifiers:WF}),HF="tippy-box",hb="tippy-content",YF="tippy-backdrop",pb="tippy-arrow",fb="tippy-svg-arrow",Qc={passive:!0,capture:!0},Ab=function(){return document.body};function qE(o,e,i){if(Array.isArray(o)){var a=o[e];return a==null?Array.isArray(i)?i[e]:i:a}return o}function JE(o,e){var i={}.toString.call(o);return i.indexOf("[object")===0&&i.indexOf(e+"]")>-1}function gb(o,e){return typeof o=="function"?o.apply(void 0,e):o}function mb(o,e){if(e===0)return o;var i;return function(a){clearTimeout(i),i=setTimeout(function(){o(a)},e)}}function qF(o){return o.split(/\s+/).filter(Boolean)}function ad(o){return[].concat(o)}function Eb(o,e){o.indexOf(e)===-1&&o.push(e)}function JF(o){return o.filter(function(e,i){return o.indexOf(e)===i})}function zF(o){return o.split("-")[0]}function vf(o){return[].slice.call(o)}function _b(o){return Object.keys(o).reduce(function(e,i){return o[i]!==void 0&&(e[i]=o[i]),e},{})}function Yu(){return document.createElement("div")}function If(o){return["Element","Fragment"].some(function(e){return JE(o,e)})}function XF(o){return JE(o,"NodeList")}function ZF(o){return JE(o,"MouseEvent")}function $F(o){return!!(o&&o._tippy&&o._tippy.reference===o)}function tQ(o){return If(o)?[o]:XF(o)?vf(o):Array.isArray(o)?o:vf(document.querySelectorAll(o))}function zE(o,e){o.forEach(function(i){i&&(i.style.transitionDuration=e+"ms")})}function vb(o,e){o.forEach(function(i){i&&i.setAttribute("data-state",e)})}function eQ(o){var e,i=ad(o),a=i[0];return a!=null&&(e=a.ownerDocument)!=null&&e.body?a.ownerDocument:document}function rQ(o,e){var i=e.clientX,a=e.clientY;return o.every(function(l){var u=l.popperRect,f=l.popperState,g=l.props,_=g.interactiveBorder,I=zF(f.placement),T=f.modifiersData.offset;if(!T)return!0;var N=I==="bottom"?T.top.y:0,D=I==="top"?T.bottom.y:0,F=I==="right"?T.left.x:0,K=I==="left"?T.right.x:0,J=u.top-a+N>_,nt=a-u.bottom-D>_,it=u.left-i+F>_,z=i-u.right-K>_;return J||nt||it||z})}function XE(o,e,i){var a=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(l){o[a](l,i)})}function Ib(o,e){for(var i=e;i;){var a;if(o.contains(i))return!0;i=i.getRootNode==null||(a=i.getRootNode())==null?void 0:a.host}return!1}var Ws={isTouch:!1},Cb=0;function nQ(){Ws.isTouch||(Ws.isTouch=!0,window.performance&&document.addEventListener("mousemove",Sb))}function Sb(){var o=performance.now();o-Cb<20&&(Ws.isTouch=!1,document.removeEventListener("mousemove",Sb)),Cb=o}function iQ(){var o=document.activeElement;if($F(o)){var e=o._tippy;o.blur&&!e.state.isVisible&&o.blur()}}function oQ(){document.addEventListener("touchstart",nQ,Qc),window.addEventListener("blur",iQ)}var sQ=typeof window!="undefined"&&typeof document!="undefined",aQ=sQ?!!window.msCrypto:!1,cQ={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},lQ={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},Is=Object.assign({appendTo:Ab,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},cQ,lQ),dQ=Object.keys(Is),uQ=function(e){var i=Object.keys(e);i.forEach(function(a){Is[a]=e[a]})};function yb(o){var e=o.plugins||[],i=e.reduce(function(a,l){var u=l.name,f=l.defaultValue;if(u){var g;a[u]=o[u]!==void 0?o[u]:(g=Is[u])!=null?g:f}return a},{});return Object.assign({},o,i)}function hQ(o,e){var i=e?Object.keys(yb(Object.assign({},Is,{plugins:e}))):dQ,a=i.reduce(function(l,u){var f=(o.getAttribute("data-tippy-"+u)||"").trim();if(!f)return l;if(u==="content")l[u]=f;else try{l[u]=JSON.parse(f)}catch{l[u]=f}return l},{});return a}function Tb(o,e){var i=Object.assign({},e,{content:gb(e.content,[o])},e.ignoreAttributes?{}:hQ(o,e.plugins));return i.aria=Object.assign({},Is.aria,i.aria),i.aria={expanded:i.aria.expanded==="auto"?e.interactive:i.aria.expanded,content:i.aria.content==="auto"?e.interactive?null:"describedby":i.aria.content},i}var pQ=function(){return"innerHTML"};function ZE(o,e){o[pQ()]=e}function Rb(o){var e=Yu();return o===!0?e.className=pb:(e.className=fb,If(o)?e.appendChild(o):ZE(e,o)),e}function wb(o,e){If(e.content)?(ZE(o,""),o.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?ZE(o,e.content):o.textContent=e.content)}function $E(o){var e=o.firstElementChild,i=vf(e.children);return{box:e,content:i.find(function(a){return a.classList.contains(hb)}),arrow:i.find(function(a){return a.classList.contains(pb)||a.classList.contains(fb)}),backdrop:i.find(function(a){return a.classList.contains(YF)})}}function bb(o){var e=Yu(),i=Yu();i.className=HF,i.setAttribute("data-state","hidden"),i.setAttribute("tabindex","-1");var a=Yu();a.className=hb,a.setAttribute("data-state","hidden"),wb(a,o.props),e.appendChild(i),i.appendChild(a),l(o.props,o.props);function l(u,f){var g=$E(e),_=g.box,I=g.content,T=g.arrow;f.theme?_.setAttribute("data-theme",f.theme):_.removeAttribute("data-theme"),typeof f.animation=="string"?_.setAttribute("data-animation",f.animation):_.removeAttribute("data-animation"),f.inertia?_.setAttribute("data-inertia",""):_.removeAttribute("data-inertia"),_.style.maxWidth=typeof f.maxWidth=="number"?f.maxWidth+"px":f.maxWidth,f.role?_.setAttribute("role",f.role):_.removeAttribute("role"),(u.content!==f.content||u.allowHTML!==f.allowHTML)&&wb(I,o.props),f.arrow?T?u.arrow!==f.arrow&&(_.removeChild(T),_.appendChild(Rb(f.arrow))):_.appendChild(Rb(f.arrow)):T&&_.removeChild(T)}return{popper:e,onUpdate:l}}bb.$$tippy=!0;var fQ=1,Cf=[],t_=[];function AQ(o,e){var i=Tb(o,Object.assign({},Is,yb(_b(e)))),a,l,u,f=!1,g=!1,_=!1,I=!1,T,N,D,F=[],K=mb(Yc,i.interactiveDebounce),J,nt=fQ++,it=null,z=JF(i.plugins),Ot={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},X={id:nt,reference:o,popper:Yu(),popperInstance:it,props:i,state:Ot,plugins:z,clearDelayTimeouts:ac,setProps:qn,setContent:Js,show:jf,hide:ch,hideWithInteractivity:lh,enable:qs,disable:He,unmount:Wf,destroy:Kf};if(!i.render)return X;var yt=i.render(X),Mt=yt.popper,$t=yt.onUpdate;Mt.setAttribute("data-tippy-root",""),Mt.id="tippy-"+X.id,X.popper=Mt,o._tippy=X,Mt._tippy=X;var ge=z.map(function(Rt){return Rt.fn(X)}),Te=o.hasAttribute("aria-expanded");return fo(),dn(),_n(),Dn("onCreate",[X]),i.showOnCreate&&Ts(),Mt.addEventListener("mouseenter",function(){X.props.interactive&&X.state.isVisible&&X.clearDelayTimeouts()}),Mt.addEventListener("mouseleave",function(){X.props.interactive&&X.props.trigger.indexOf("mouseenter")>=0&&Yn().addEventListener("mousemove",K)}),X;function Se(){var Rt=X.props.touch;return Array.isArray(Rt)?Rt:[Rt,0]}function lr(){return Se()[0]==="hold"}function Er(){var Rt;return!!((Rt=X.props.render)!=null&&Rt.$$tippy)}function sr(){return J||o}function Yn(){var Rt=sr().parentNode;return Rt?eQ(Rt):document}function br(){return $E(Mt)}function $e(Rt){return X.state.isMounted&&!X.state.isVisible||Ws.isTouch||T&&T.type==="focus"?0:qE(X.props.delay,Rt?0:1,Is.delay)}function _n(Rt){Rt===void 0&&(Rt=!1),Mt.style.pointerEvents=X.props.interactive&&!Rt?"":"none",Mt.style.zIndex=""+X.props.zIndex}function Dn(Rt,Xt,ht){if(ht===void 0&&(ht=!0),ge.forEach(function(ve){ve[Rt]&&ve[Rt].apply(ve,Xt)}),ht){var tr;(tr=X.props)[Rt].apply(tr,Xt)}}function _e(){var Rt=X.props.aria;if(!!Rt.content){var Xt="aria-"+Rt.content,ht=Mt.id,tr=ad(X.props.triggerTarget||o);tr.forEach(function(ve){var hn=ve.getAttribute(Xt);if(X.state.isVisible)ve.setAttribute(Xt,hn?hn+" "+ht:ht);else{var Mi=hn&&hn.replace(ht,"").trim();Mi?ve.setAttribute(Xt,Mi):ve.removeAttribute(Xt)}})}}function dn(){if(!(Te||!X.props.aria.expanded)){var Rt=ad(X.props.triggerTarget||o);Rt.forEach(function(Xt){X.props.interactive?Xt.setAttribute("aria-expanded",X.state.isVisible&&Xt===sr()?"true":"false"):Xt.removeAttribute("aria-expanded")})}}function mi(){Yn().removeEventListener("mousemove",K),Cf=Cf.filter(function(Rt){return Rt!==K})}function Nr(Rt){if(!(Ws.isTouch&&(_||Rt.type==="mousedown"))){var Xt=Rt.composedPath&&Rt.composedPath()[0]||Rt.target;if(!(X.props.interactive&&Ib(Mt,Xt))){if(ad(X.props.triggerTarget||o).some(function(ht){return Ib(ht,Xt)})){if(Ws.isTouch||X.state.isVisible&&X.props.trigger.indexOf("click")>=0)return}else Dn("onClickOutside",[X,Rt]);X.props.hideOnClick===!0&&(X.clearDelayTimeouts(),X.hide(),g=!0,setTimeout(function(){g=!1}),X.state.isMounted||es())}}}function Ss(){_=!0}function un(){_=!1}function tn(){var Rt=Yn();Rt.addEventListener("mousedown",Nr,!0),Rt.addEventListener("touchend",Nr,Qc),Rt.addEventListener("touchstart",un,Qc),Rt.addEventListener("touchmove",Ss,Qc)}function es(){var Rt=Yn();Rt.removeEventListener("mousedown",Nr,!0),Rt.removeEventListener("touchend",Nr,Qc),Rt.removeEventListener("touchstart",un,Qc),Rt.removeEventListener("touchmove",Ss,Qc)}function Oa(Rt,Xt){ka(Rt,function(){!X.state.isVisible&&Mt.parentNode&&Mt.parentNode.contains(Mt)&&Xt()})}function qt(Rt,Xt){ka(Rt,Xt)}function ka(Rt,Xt){var ht=br().box;function tr(ve){ve.target===ht&&(XE(ht,"remove",tr),Xt())}if(Rt===0)return Xt();XE(ht,"remove",N),XE(ht,"add",tr),N=tr}function ys(Rt,Xt,ht){ht===void 0&&(ht=!1);var tr=ad(X.props.triggerTarget||o);tr.forEach(function(ve){ve.addEventListener(Rt,Xt,ht),F.push({node:ve,eventType:Rt,handler:Xt,options:ht})})}function fo(){lr()&&(ys("touchstart",Ln,{passive:!0}),ys("touchend",qc,{passive:!0})),qF(X.props.trigger).forEach(function(Rt){if(Rt!=="manual")switch(ys(Rt,Ln),Rt){case"mouseenter":ys("mouseleave",qc);break;case"focus":ys(aQ?"focusout":"blur",Ao);break;case"focusin":ys("focusout",Ao);break}})}function Hc(){F.forEach(function(Rt){var Xt=Rt.node,ht=Rt.eventType,tr=Rt.handler,ve=Rt.options;Xt.removeEventListener(ht,tr,ve)}),F=[]}function Ln(Rt){var Xt,ht=!1;if(!(!X.state.isEnabled||Da(Rt)||g)){var tr=((Xt=T)==null?void 0:Xt.type)==="focus";T=Rt,J=Rt.currentTarget,dn(),!X.state.isVisible&&ZF(Rt)&&Cf.forEach(function(ve){return ve(Rt)}),Rt.type==="click"&&(X.props.trigger.indexOf("mouseenter")<0||f)&&X.props.hideOnClick!==!1&&X.state.isVisible?ht=!0:Ts(Rt),Rt.type==="click"&&(f=!ht),ht&&!tr&&Ei(Rt)}}function Yc(Rt){var Xt=Rt.target,ht=sr().contains(Xt)||Mt.contains(Xt);if(!(Rt.type==="mousemove"&&ht)){var tr=is().concat(Mt).map(function(ve){var hn,Mi=ve._tippy,zs=(hn=Mi.popperInstance)==null?void 0:hn.state;return zs?{popperRect:ve.getBoundingClientRect(),popperState:zs,props:i}:null}).filter(Boolean);rQ(tr,Rt)&&(mi(),Ei(Rt))}}function qc(Rt){var Xt=Da(Rt)||X.props.trigger.indexOf("click")>=0&&f;if(!Xt){if(X.props.interactive){X.hideWithInteractivity(Rt);return}Ei(Rt)}}function Ao(Rt){X.props.trigger.indexOf("focusin")<0&&Rt.target!==sr()||X.props.interactive&&Rt.relatedTarget&&Mt.contains(Rt.relatedTarget)||Ei(Rt)}function Da(Rt){return Ws.isTouch?lr()!==Rt.type.indexOf("touch")>=0:!1}function La(){rs();var Rt=X.props,Xt=Rt.popperOptions,ht=Rt.placement,tr=Rt.offset,ve=Rt.getReferenceClientRect,hn=Rt.moveTransition,Mi=Er()?$E(Mt).arrow:null,zs=ve?{getBoundingClientRect:ve,contextElement:ve.contextElement||sr()}:o,Do={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(Zs){var si=Zs.state;if(Er()){var dh=br(),Ma=dh.box;["placement","reference-hidden","escaped"].forEach(function(Pa){Pa==="placement"?Ma.setAttribute("data-placement",si.placement):si.attributes.popper["data-popper-"+Pa]?Ma.setAttribute("data-"+Pa,""):Ma.removeAttribute("data-"+Pa)}),si.attributes.popper={}}}},Xs=[{name:"offset",options:{offset:tr}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!hn}},Do];Er()&&Mi&&Xs.push({name:"arrow",options:{element:Mi,padding:3}}),Xs.push.apply(Xs,(Xt==null?void 0:Xt.modifiers)||[]),X.popperInstance=KF(zs,Mt,Object.assign({},Xt,{placement:ht,onFirstUpdate:D,modifiers:Xs}))}function rs(){X.popperInstance&&(X.popperInstance.destroy(),X.popperInstance=null)}function ns(){var Rt=X.props.appendTo,Xt,ht=sr();X.props.interactive&&Rt===Ab||Rt==="parent"?Xt=ht.parentNode:Xt=gb(Rt,[ht]),Xt.contains(Mt)||Xt.appendChild(Mt),X.state.isMounted=!0,La()}function is(){return vf(Mt.querySelectorAll("[data-tippy-root]"))}function Ts(Rt){X.clearDelayTimeouts(),Rt&&Dn("onTrigger",[X,Rt]),tn();var Xt=$e(!0),ht=Se(),tr=ht[0],ve=ht[1];Ws.isTouch&&tr==="hold"&&ve&&(Xt=ve),Xt?a=setTimeout(function(){X.show()},Xt):X.show()}function Ei(Rt){if(X.clearDelayTimeouts(),Dn("onUntrigger",[X,Rt]),!X.state.isVisible){es();return}if(!(X.props.trigger.indexOf("mouseenter")>=0&&X.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(Rt.type)>=0&&f)){var Xt=$e(!1);Xt?l=setTimeout(function(){X.state.isVisible&&X.hide()},Xt):u=requestAnimationFrame(function(){X.hide()})}}function qs(){X.state.isEnabled=!0}function He(){X.hide(),X.state.isEnabled=!1}function ac(){clearTimeout(a),clearTimeout(l),cancelAnimationFrame(u)}function qn(Rt){if(!X.state.isDestroyed){Dn("onBeforeUpdate",[X,Rt]),Hc();var Xt=X.props,ht=Tb(o,Object.assign({},Xt,_b(Rt),{ignoreAttributes:!0}));X.props=ht,fo(),Xt.interactiveDebounce!==ht.interactiveDebounce&&(mi(),K=mb(Yc,ht.interactiveDebounce)),Xt.triggerTarget&&!ht.triggerTarget?ad(Xt.triggerTarget).forEach(function(tr){tr.removeAttribute("aria-expanded")}):ht.triggerTarget&&o.removeAttribute("aria-expanded"),dn(),_n(),$t&&$t(Xt,ht),X.popperInstance&&(La(),is().forEach(function(tr){requestAnimationFrame(tr._tippy.popperInstance.forceUpdate)})),Dn("onAfterUpdate",[X,Rt])}}function Js(Rt){X.setProps({content:Rt})}function jf(){var Rt=X.state.isVisible,Xt=X.state.isDestroyed,ht=!X.state.isEnabled,tr=Ws.isTouch&&!X.props.touch,ve=qE(X.props.duration,0,Is.duration);if(!(Rt||Xt||ht||tr)&&!sr().hasAttribute("disabled")&&(Dn("onShow",[X],!1),X.props.onShow(X)!==!1)){if(X.state.isVisible=!0,Er()&&(Mt.style.visibility="visible"),_n(),tn(),X.state.isMounted||(Mt.style.transition="none"),Er()){var hn=br(),Mi=hn.box,zs=hn.content;zE([Mi,zs],0)}D=function(){var Xs;if(!(!X.state.isVisible||I)){if(I=!0,Mt.offsetHeight,Mt.style.transition=X.props.moveTransition,Er()&&X.props.animation){var fd=br(),Zs=fd.box,si=fd.content;zE([Zs,si],ve),vb([Zs,si],"visible")}_e(),dn(),Eb(t_,X),(Xs=X.popperInstance)==null||Xs.forceUpdate(),Dn("onMount",[X]),X.props.animation&&Er()&&qt(ve,function(){X.state.isShown=!0,Dn("onShown",[X])})}},ns()}}function ch(){var Rt=!X.state.isVisible,Xt=X.state.isDestroyed,ht=!X.state.isEnabled,tr=qE(X.props.duration,1,Is.duration);if(!(Rt||Xt||ht)&&(Dn("onHide",[X],!1),X.props.onHide(X)!==!1)){if(X.state.isVisible=!1,X.state.isShown=!1,I=!1,f=!1,Er()&&(Mt.style.visibility="hidden"),mi(),es(),_n(!0),Er()){var ve=br(),hn=ve.box,Mi=ve.content;X.props.animation&&(zE([hn,Mi],tr),vb([hn,Mi],"hidden"))}_e(),dn(),X.props.animation?Er()&&Oa(tr,X.unmount):X.unmount()}}function lh(Rt){Yn().addEventListener("mousemove",K),Eb(Cf,K),K(Rt)}function Wf(){X.state.isVisible&&X.hide(),!!X.state.isMounted&&(rs(),is().forEach(function(Rt){Rt._tippy.unmount()}),Mt.parentNode&&Mt.parentNode.removeChild(Mt),t_=t_.filter(function(Rt){return Rt!==X}),X.state.isMounted=!1,Dn("onHidden",[X]))}function Kf(){X.state.isDestroyed||(X.clearDelayTimeouts(),X.unmount(),Hc(),delete o._tippy,X.state.isDestroyed=!0,Dn("onDestroy",[X]))}}function cd(o,e){e===void 0&&(e={});var i=Is.plugins.concat(e.plugins||[]);oQ();var a=Object.assign({},e,{plugins:i}),l=tQ(o),u=l.reduce(function(f,g){var _=g&&AQ(g,a);return _&&f.push(_),f},[]);return If(o)?u[0]:u}cd.defaultProps=Is;cd.setDefaultProps=uQ;cd.currentInput=Ws;Object.assign({},Xw,{effect:function(e){var i=e.state,a={popper:{position:i.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(i.elements.popper.style,a.popper),i.styles=a,i.elements.arrow&&Object.assign(i.elements.arrow.style,a.arrow)}});cd.setDefaultProps({render:bb});class gQ{constructor({editor:e,element:i,view:a,tippyOptions:l={},shouldShow:u}){this.preventHide=!1,this.shouldShow=({view:f,state:g,from:_,to:I})=>{const{doc:T,selection:N}=g,{empty:D}=N,F=!T.textBetween(_,I).length&&kw(g.selection);return!(!f.hasFocus()||D||F)},this.mousedownHandler=()=>{this.preventHide=!0},this.dragstartHandler=()=>{this.hide()},this.focusHandler=()=>{setTimeout(()=>this.update(this.editor.view))},this.blurHandler=({event:f})=>{var g;if(this.preventHide){this.preventHide=!1;return}(f==null?void 0:f.relatedTarget)&&((g=this.element.parentNode)===null||g===void 0?void 0:g.contains(f.relatedTarget))||this.hide()},this.editor=e,this.element=i,this.view=a,u&&(this.shouldShow=u),this.element.addEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.view.dom.addEventListener("dragstart",this.dragstartHandler),this.editor.on("focus",this.focusHandler),this.editor.on("blur",this.blurHandler),this.tippyOptions=l,this.element.remove(),this.element.style.visibility="visible"}createTooltip(){const{element:e}=this.editor.options,i=!!e.parentElement;this.tippy||!i||(this.tippy=cd(e,Dt({duration:0,getReferenceClientRect:null,content:this.element,interactive:!0,trigger:"manual",placement:"top",hideOnClick:"toggle"},this.tippyOptions)),this.tippy.popper.firstChild&&this.tippy.popper.firstChild.addEventListener("blur",a=>{this.blurHandler({event:a})}))}update(e,i){var a,l;const{state:u,composing:f}=e,{doc:g,selection:_}=u,I=i&&i.doc.eq(g)&&i.selection.eq(_);if(f||I)return;this.createTooltip();const{ranges:T}=_,N=Math.min(...T.map(K=>K.$from.pos)),D=Math.max(...T.map(K=>K.$to.pos));if(!((a=this.shouldShow)===null||a===void 0?void 0:a.call(this,{editor:this.editor,view:e,state:u,oldState:i,from:N,to:D}))){this.hide();return}(l=this.tippy)===null||l===void 0||l.setProps({getReferenceClientRect:()=>{if(Q3(u.selection)){const K=e.nodeDOM(N);if(K)return K.getBoundingClientRect()}return Hw(e,N,D)}}),this.show()}show(){var e;(e=this.tippy)===null||e===void 0||e.show()}hide(){var e;(e=this.tippy)===null||e===void 0||e.hide()}destroy(){var e;(e=this.tippy)===null||e===void 0||e.destroy(),this.element.removeEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.view.dom.removeEventListener("dragstart",this.dragstartHandler),this.editor.off("focus",this.focusHandler),this.editor.off("blur",this.blurHandler)}}const Nb=o=>new ni({key:typeof o.pluginKey=="string"?new Ki(o.pluginKey):o.pluginKey,view:e=>new gQ(Dt({view:e},o))});ii.create({name:"bubbleMenu",addOptions(){return{element:null,tippyOptions:{},pluginKey:"bubbleMenu",shouldShow:null}},addProseMirrorPlugins(){return this.options.element?[Nb({pluginKey:this.options.pluginKey,editor:this.editor,element:this.options.element,tippyOptions:this.options.tippyOptions,shouldShow:this.options.shouldShow})]:[]}});class mQ{constructor({editor:e,element:i,view:a,tippyOptions:l={},shouldShow:u}){this.preventHide=!1,this.shouldShow=({view:f,state:g})=>{const{selection:_}=g,{$anchor:I,empty:T}=_,N=I.depth===1,D=I.parent.isTextblock&&!I.parent.type.spec.code&&!I.parent.textContent;return!(!f.hasFocus()||!T||!N||!D)},this.mousedownHandler=()=>{this.preventHide=!0},this.focusHandler=()=>{setTimeout(()=>this.update(this.editor.view))},this.blurHandler=({event:f})=>{var g;if(this.preventHide){this.preventHide=!1;return}(f==null?void 0:f.relatedTarget)&&((g=this.element.parentNode)===null||g===void 0?void 0:g.contains(f.relatedTarget))||this.hide()},this.editor=e,this.element=i,this.view=a,u&&(this.shouldShow=u),this.element.addEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.editor.on("focus",this.focusHandler),this.editor.on("blur",this.blurHandler),this.tippyOptions=l,this.element.remove(),this.element.style.visibility="visible"}createTooltip(){const{element:e}=this.editor.options,i=!!e.parentElement;this.tippy||!i||(this.tippy=cd(e,Dt({duration:0,getReferenceClientRect:null,content:this.element,interactive:!0,trigger:"manual",placement:"right",hideOnClick:"toggle"},this.tippyOptions)),this.tippy.popper.firstChild&&this.tippy.popper.firstChild.addEventListener("blur",a=>{this.blurHandler({event:a})}))}update(e,i){var a,l;const{state:u}=e,{doc:f,selection:g}=u,{from:_,to:I}=g;if(i&&i.doc.eq(f)&&i.selection.eq(g))return;if(this.createTooltip(),!((a=this.shouldShow)===null||a===void 0?void 0:a.call(this,{editor:this.editor,view:e,state:u,oldState:i}))){this.hide();return}(l=this.tippy)===null||l===void 0||l.setProps({getReferenceClientRect:()=>Hw(e,_,I)}),this.show()}show(){var e;(e=this.tippy)===null||e===void 0||e.show()}hide(){var e;(e=this.tippy)===null||e===void 0||e.hide()}destroy(){var e;(e=this.tippy)===null||e===void 0||e.destroy(),this.element.removeEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.editor.off("focus",this.focusHandler),this.editor.off("blur",this.blurHandler)}}const Ob=o=>new ni({key:typeof o.pluginKey=="string"?new Ki(o.pluginKey):o.pluginKey,view:e=>new mQ(Dt({view:e},o))});ii.create({name:"floatingMenu",addOptions(){return{element:null,tippyOptions:{},pluginKey:"floatingMenu",shouldShow:null}},addProseMirrorPlugins(){return this.options.element?[Ob({pluginKey:this.options.pluginKey,editor:this.editor,element:this.options.element,tippyOptions:this.options.tippyOptions,shouldShow:this.options.shouldShow})]:[]}});fu({name:"BubbleMenu",props:{pluginKey:{type:null,default:"bubbleMenu"},editor:{type:Object,required:!0},tippyOptions:{type:Object,default:()=>({})},shouldShow:{type:Function,default:null}},setup(o,{slots:e}){const i=Tc(null);return _m(()=>{const{pluginKey:a,editor:l,tippyOptions:u,shouldShow:f}=o;l.registerPlugin(Nb({pluginKey:a,editor:l,element:i.value,tippyOptions:u,shouldShow:f}))}),vm(()=>{const{pluginKey:a,editor:l}=o;l.unregisterPlugin(a)}),()=>{var a;return Rc("div",{ref:i},(a=e.default)===null||a===void 0?void 0:a.call(e))}}});function kb(o){return cM((e,i)=>({get(){return e(),o},set(a){o=a,requestAnimationFrame(()=>{requestAnimationFrame(()=>{i()})})}}))}class EQ extends x3{constructor(e={}){super(e);return this.vueRenderers=Au(new Map),this.contentComponent=null,this.reactiveState=kb(this.view.state),this.reactiveExtensionStorage=kb(this.extensionStorage),this.on("transaction",()=>{this.reactiveState.value=this.view.state,this.reactiveExtensionStorage.value=this.extensionStorage}),lM(this)}get state(){return this.reactiveState?this.reactiveState.value:this.view.state}get storage(){return this.reactiveExtensionStorage?this.reactiveExtensionStorage.value:super.storage}registerPlugin(e,i){super.registerPlugin(e,i),this.reactiveState.value=this.view.state}unregisterPlugin(e){super.unregisterPlugin(e),this.reactiveState.value=this.view.state}}const _Q=fu({name:"EditorContent",props:{editor:{default:null,type:Object}},setup(o){const e=Tc(),i=hM();return dM(()=>{const a=o.editor;a&&a.options.element&&e.value&&iR(()=>{if(!e.value||!a.options.element.firstChild)return;const l=gs(e.value);e.value.append(...a.options.element.childNodes),a.contentComponent=i.ctx._,a.setOptions({element:l}),a.createNodeViews()})}),vm(()=>{const a=o.editor;if(!a||(a.isDestroyed||a.view.setProps({nodeViews:{}}),a.contentComponent=null,!a.options.element.firstChild))return;const l=document.createElement("div");l.append(...a.options.element.childNodes),a.setOptions({element:l})}),{rootEl:e}},render(){const o=[];return this.editor&&this.editor.vueRenderers.forEach(e=>{const i=Rc(uM,{to:e.teleportElement,key:e.id},Rc(e.component,Dt({ref:e.id},e.props)));o.push(i)}),Rc("div",{ref:e=>{this.rootEl=e}},...o)}});fu({name:"FloatingMenu",props:{pluginKey:{type:null,default:"floatingMenu"},editor:{type:Object,required:!0},tippyOptions:{type:Object,default:()=>({})},shouldShow:{type:Function,default:null}},setup(o,{slots:e}){const i=Tc(null);return _m(()=>{const{pluginKey:a,editor:l,tippyOptions:u,shouldShow:f}=o;l.registerPlugin(Ob({pluginKey:a,editor:l,element:i.value,tippyOptions:u,shouldShow:f}))}),vm(()=>{const{pluginKey:a,editor:l}=o;l.unregisterPlugin(a)}),()=>{var a;return Rc("div",{ref:i},(a=e.default)===null||a===void 0?void 0:a.call(e))}}});fu({props:{as:{type:String,default:"div"}},inject:["onDragStart","decorationClasses"],render(){var o,e;return Rc(this.as,{class:this.decorationClasses.value,style:{whiteSpace:"normal"},"data-node-view-wrapper":"",onDragstart:this.onDragStart},(e=(o=this.$slots).default)===null||e===void 0?void 0:e.call(o))}});fu({props:{as:{type:String,default:"div"}},render(){return Rc(this.as,{style:{whiteSpace:"pre-wrap"},"data-node-view-content":""})}});const vQ=/^\s*>\s$/,IQ=Di.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:o}){return["blockquote",pi(this.options.HTMLAttributes,o),0]},addCommands(){return{setBlockquote:()=>({commands:o})=>o.wrapIn(this.name),toggleBlockquote:()=>({commands:o})=>o.toggleWrap(this.name),unsetBlockquote:()=>({commands:o})=>o.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[Af({find:vQ,type:this.type})]}}),CQ=/(?:^|\s)((?:\*\*)((?:[^*]+))(?:\*\*))$/,SQ=/(?:^|\s)((?:\*\*)((?:[^*]+))(?:\*\*))/g,yQ=/(?:^|\s)((?:__)((?:[^__]+))(?:__))$/,TQ=/(?:^|\s)((?:__)((?:[^__]+))(?:__))/g,RQ=tc.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:o=>o.style.fontWeight!=="normal"&&null},{style:"font-weight",getAttrs:o=>/^(bold(er)?|[5-9]\d{2,})$/.test(o)&&null}]},renderHTML({HTMLAttributes:o}){return["strong",pi(this.options.HTMLAttributes,o),0]},addCommands(){return{setBold:()=>({commands:o})=>o.setMark(this.name),toggleBold:()=>({commands:o})=>o.toggleMark(this.name),unsetBold:()=>({commands:o})=>o.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold()}},addInputRules(){return[Uc({find:CQ,type:this.type}),Uc({find:yQ,type:this.type})]},addPasteRules(){return[xc({find:SQ,type:this.type}),xc({find:TQ,type:this.type})]}}),wQ=/^\s*([-+*])\s$/,bQ=Di.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:o}){return["ul",pi(this.options.HTMLAttributes,o),0]},addCommands(){return{toggleBulletList:()=>({commands:o})=>o.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){return[Af({find:wQ,type:this.type})]}}),NQ=/(?:^|\s)((?:`)((?:[^`]+))(?:`))$/,OQ=/(?:^|\s)((?:`)((?:[^`]+))(?:`))/g,kQ=tc.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:o}){return["code",pi(this.options.HTMLAttributes,o),0]},addCommands(){return{setCode:()=>({commands:o})=>o.setMark(this.name),toggleCode:()=>({commands:o})=>o.toggleMark(this.name),unsetCode:()=>({commands:o})=>o.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[Uc({find:NQ,type:this.type})]},addPasteRules(){return[xc({find:OQ,type:this.type})]}}),DQ=/^```([a-z]+)?[\s\n]$/,LQ=/^~~~([a-z]+)?[\s\n]$/,MQ=Di.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:null,parseHTML:o=>{var e;const{languageClassPrefix:i}=this.options,u=[...((e=o.firstElementChild)===null||e===void 0?void 0:e.classList)||[]].filter(f=>f.startsWith(i)).map(f=>f.replace(i,""))[0];return u||null},renderHTML:o=>o.language?{class:this.options.languageClassPrefix+o.language}:null}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({HTMLAttributes:o}){return["pre",this.options.HTMLAttributes,["code",o,0]]},addCommands(){return{setCodeBlock:o=>({commands:e})=>e.setNode(this.name,o),toggleCodeBlock:o=>({commands:e})=>e.toggleNode(this.name,"paragraph",o)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:o,$anchor:e}=this.editor.state.selection,i=e.pos===1;return!o||e.parent.type.name!==this.name?!1:i||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Enter:({editor:o})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=o,{selection:i}=e,{$from:a,empty:l}=i;if(!l||a.parent.type!==this.type)return!1;const u=a.parentOffset===a.parent.nodeSize-2,f=a.parent.textContent.endsWith(`

`);return!u||!f?!1:o.chain().command(({tr:g})=>(g.delete(a.pos-2,a.pos),!0)).exitCode().run()},ArrowDown:({editor:o})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=o,{selection:i,doc:a}=e,{$from:l,empty:u}=i;if(!u||l.parent.type!==this.type||!(l.parentOffset===l.parent.nodeSize-2))return!1;const g=l.after();return g===void 0||a.nodeAt(g)?!1:o.commands.exitCode()}}},addInputRules(){return[QE({find:DQ,type:this.type,getAttributes:o=>({language:o[1]})}),QE({find:LQ,type:this.type,getAttributes:o=>({language:o[1]})})]},addProseMirrorPlugins(){return[new ni({key:new Ki("codeBlockVSCodeHandler"),props:{handlePaste:(o,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const i=e.clipboardData.getData("text/plain"),a=e.clipboardData.getData("vscode-editor-data"),l=a?JSON.parse(a):void 0,u=l==null?void 0:l.mode;if(!i||!u)return!1;const{tr:f}=o.state;return f.replaceSelectionWith(this.type.create({language:u})),f.setSelection(cr.near(f.doc.resolve(Math.max(0,f.selection.from-2)))),f.insertText(i.replace(/\r\n?/g,`
`)),f.setMeta("paste",!0),o.dispatch(f),!0}}})]}}),PQ=Di.create({name:"doc",topNode:!0,content:"block+"});function BQ(o){return o===void 0&&(o={}),new ni({view:function(i){return new Ks(i,o)}})}var Ks=function(e,i){var a=this;this.editorView=e,this.width=i.width||1,this.color=i.color||"black",this.class=i.class,this.cursorPos=null,this.element=null,this.timeout=null,this.handlers=["dragover","dragend","drop","dragleave"].map(function(l){var u=function(f){return a[l](f)};return e.dom.addEventListener(l,u),{name:l,handler:u}})};Ks.prototype.destroy=function(){var e=this;this.handlers.forEach(function(i){var a=i.name,l=i.handler;return e.editorView.dom.removeEventListener(a,l)})};Ks.prototype.update=function(e,i){this.cursorPos!=null&&i.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())};Ks.prototype.setCursor=function(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())};Ks.prototype.updateOverlay=function(){var e=this.editorView.state.doc.resolve(this.cursorPos),i;if(!e.parent.inlineContent){var a=e.nodeBefore,l=e.nodeAfter;if(a||l){var u=this.editorView.nodeDOM(this.cursorPos-(a?a.nodeSize:0)).getBoundingClientRect(),f=a?u.bottom:u.top;a&&l&&(f=(f+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),i={left:u.left,right:u.right,top:f-this.width/2,bottom:f+this.width/2}}}if(!i){var g=this.editorView.coordsAtPos(this.cursorPos);i={left:g.left-this.width/2,right:g.left+this.width/2,top:g.top,bottom:g.bottom}}var _=this.editorView.dom.offsetParent;this.element||(this.element=_.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none; background-color: "+this.color);var I,T;if(!_||_==document.body&&getComputedStyle(_).position=="static")I=-pageXOffset,T=-pageYOffset;else{var N=_.getBoundingClientRect();I=N.left-_.scrollLeft,T=N.top-_.scrollTop}this.element.style.left=i.left-I+"px",this.element.style.top=i.top-T+"px",this.element.style.width=i.right-i.left+"px",this.element.style.height=i.bottom-i.top+"px"};Ks.prototype.scheduleRemoval=function(e){var i=this;clearTimeout(this.timeout),this.timeout=setTimeout(function(){return i.setCursor(null)},e)};Ks.prototype.dragover=function(e){if(!!this.editorView.editable){var i=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),a=i&&i.inside>=0&&this.editorView.state.doc.nodeAt(i.inside),l=a&&a.type.spec.disableDropCursor,u=typeof l=="function"?l(this.editorView,i):l;if(i&&!u){var f=i.pos;if(this.editorView.dragging&&this.editorView.dragging.slice&&(f=WR(this.editorView.state.doc,f,this.editorView.dragging.slice),f==null))return this.setCursor(null);this.setCursor(f),this.scheduleRemoval(5e3)}}};Ks.prototype.dragend=function(){this.scheduleRemoval(20)};Ks.prototype.drop=function(){this.scheduleRemoval(20)};Ks.prototype.dragleave=function(e){(e.target==this.editorView.dom||!this.editorView.dom.contains(e.relatedTarget))&&this.setCursor(null)};const UQ=ii.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:null}},addProseMirrorPlugins(){return[BQ(this.options)]}});var Cs=function(o){function e(i){o.call(this,i,i)}return o&&(e.__proto__=o),e.prototype=Object.create(o&&o.prototype),e.prototype.constructor=e,e.prototype.map=function(a,l){var u=a.resolve(l.map(this.head));return e.valid(u)?new e(u):o.near(u)},e.prototype.content=function(){return Ht.empty},e.prototype.eq=function(a){return a instanceof e&&a.head==this.head},e.prototype.toJSON=function(){return{type:"gapcursor",pos:this.head}},e.fromJSON=function(a,l){if(typeof l.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new e(a.resolve(l.pos))},e.prototype.getBookmark=function(){return new Sf(this.anchor)},e.valid=function(a){var l=a.parent;if(l.isTextblock||!xQ(a)||!FQ(a))return!1;var u=l.type.spec.allowGapCursor;if(u!=null)return u;var f=l.contentMatchAt(a.index()).defaultType;return f&&f.isTextblock},e.findFrom=function(a,l,u){t:for(;;){if(!u&&e.valid(a))return a;for(var f=a.pos,g=null,_=a.depth;;_--){var I=a.node(_);if(l>0?a.indexAfter(_)<I.childCount:a.index(_)>0){g=I.child(l>0?a.indexAfter(_):a.index(_)-1);break}else if(_==0)return null;f+=l;var T=a.doc.resolve(f);if(e.valid(T))return T}for(;;){var N=l>0?g.firstChild:g.lastChild;if(!N){if(g.isAtom&&!g.isText&&!ke.isSelectable(g)){a=a.doc.resolve(f+g.nodeSize*l),u=!1;continue t}break}g=N,f+=l;var D=a.doc.resolve(f);if(e.valid(D))return D}return null}},e}(Ce);Cs.prototype.visible=!1;Ce.jsonID("gapcursor",Cs);var Sf=function(e){this.pos=e};Sf.prototype.map=function(e){return new Sf(e.map(this.pos))};Sf.prototype.resolve=function(e){var i=e.resolve(this.pos);return Cs.valid(i)?new Cs(i):Ce.near(i)};function xQ(o){for(var e=o.depth;e>=0;e--){var i=o.index(e),a=o.node(e);if(i==0){if(a.type.spec.isolating)return!0;continue}for(var l=a.child(i-1);;l=l.lastChild){if(l.childCount==0&&!l.inlineContent||l.isAtom||l.type.spec.isolating)return!0;if(l.inlineContent)return!1}}return!0}function FQ(o){for(var e=o.depth;e>=0;e--){var i=o.indexAfter(e),a=o.node(e);if(i==a.childCount){if(a.type.spec.isolating)return!0;continue}for(var l=a.child(i);;l=l.firstChild){if(l.childCount==0&&!l.inlineContent||l.isAtom||l.type.spec.isolating)return!0;if(l.inlineContent)return!1}}return!0}var QQ=function(){return new ni({props:{decorations:jQ,createSelectionBetween:function(e,i,a){if(i.pos==a.pos&&Cs.valid(a))return new Cs(a)},handleClick:GQ,handleKeyDown:VQ}})},VQ=ww({ArrowLeft:yf("horiz",-1),ArrowRight:yf("horiz",1),ArrowUp:yf("vert",-1),ArrowDown:yf("vert",1)});function yf(o,e){var i=o=="vert"?e>0?"down":"up":e>0?"right":"left";return function(a,l,u){var f=a.selection,g=e>0?f.$to:f.$from,_=f.empty;if(f instanceof cr){if(!u.endOfTextblock(i)||g.depth==0)return!1;_=!1,g=a.doc.resolve(e>0?g.after():g.before())}var I=Cs.findFrom(g,e,_);return I?(l&&l(a.tr.setSelection(new Cs(I))),!0):!1}}function GQ(o,e,i){if(!o.editable)return!1;var a=o.state.doc.resolve(e);if(!Cs.valid(a))return!1;var l=o.posAtCoords({left:i.clientX,top:i.clientY}),u=l.inside;return u>-1&&ke.isSelectable(o.state.doc.nodeAt(u))?!1:(o.dispatch(o.state.tr.setSelection(new Cs(a))),!0)}function jQ(o){if(!(o.selection instanceof Cs))return null;var e=document.createElement("div");return e.className="ProseMirror-gapcursor",wr.create(o.doc,[Qn.widget(o.selection.head,e,{key:"gapcursor"})])}const WQ=ii.create({name:"gapCursor",addProseMirrorPlugins(){return[QQ()]},extendNodeSchema(o){var e;const i={name:o.name,options:o.options,storage:o.storage};return{allowGapCursor:(e=Ve(ie(o,"allowGapCursor",i)))!==null&&e!==void 0?e:null}}}),KQ=Di.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:o}){return["br",pi(this.options.HTMLAttributes,o)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:o,chain:e,state:i,editor:a})=>o.first([()=>o.exitCode(),()=>o.command(()=>{const{selection:l,storedMarks:u}=i;if(l.$from.parent.type.spec.isolating)return!1;const{keepMarks:f}=this.options,{splittableMarks:g}=a.extensionManager,_=u||l.$to.parentOffset&&l.$from.marks();return e().insertContent({type:this.name}).command(({tr:I,dispatch:T})=>{if(T&&_&&f){const N=_.filter(D=>g.includes(D.type.name));I.ensureMarks(N)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),HQ=Di.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(o=>({tag:`h${o}`,attrs:{level:o}}))},renderHTML({node:o,HTMLAttributes:e}){return[`h${this.options.levels.includes(o.attrs.level)?o.attrs.level:this.options.levels[0]}`,pi(this.options.HTMLAttributes,e),0]},addCommands(){return{setHeading:o=>({commands:e})=>this.options.levels.includes(o.level)?e.setNode(this.name,o):!1,toggleHeading:o=>({commands:e})=>this.options.levels.includes(o.level)?e.toggleNode(this.name,"paragraph",o):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((o,e)=>Qi(Dt({},o),{[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(o=>QE({find:new RegExp(`^(#{1,${o}})\\s$`),type:this.type,getAttributes:{level:o}}))}});var Tf=200,fi=function(){};fi.prototype.append=function(e){return e.length?(e=fi.from(e),!this.length&&e||e.length<Tf&&this.leafAppend(e)||this.length<Tf&&e.leafPrepend(this)||this.appendInner(e)):this};fi.prototype.prepend=function(e){return e.length?fi.from(e).append(this):this};fi.prototype.appendInner=function(e){return new YQ(this,e)};fi.prototype.slice=function(e,i){return e===void 0&&(e=0),i===void 0&&(i=this.length),e>=i?fi.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,i))};fi.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};fi.prototype.forEach=function(e,i,a){i===void 0&&(i=0),a===void 0&&(a=this.length),i<=a?this.forEachInner(e,i,a,0):this.forEachInvertedInner(e,i,a,0)};fi.prototype.map=function(e,i,a){i===void 0&&(i=0),a===void 0&&(a=this.length);var l=[];return this.forEach(function(u,f){return l.push(e(u,f))},i,a),l};fi.from=function(e){return e instanceof fi?e:e&&e.length?new Db(e):fi.empty};var Db=function(o){function e(a){o.call(this),this.values=a}o&&(e.__proto__=o),e.prototype=Object.create(o&&o.prototype),e.prototype.constructor=e;var i={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(l,u){return l==0&&u==this.length?this:new e(this.values.slice(l,u))},e.prototype.getInner=function(l){return this.values[l]},e.prototype.forEachInner=function(l,u,f,g){for(var _=u;_<f;_++)if(l(this.values[_],g+_)===!1)return!1},e.prototype.forEachInvertedInner=function(l,u,f,g){for(var _=u-1;_>=f;_--)if(l(this.values[_],g+_)===!1)return!1},e.prototype.leafAppend=function(l){if(this.length+l.length<=Tf)return new e(this.values.concat(l.flatten()))},e.prototype.leafPrepend=function(l){if(this.length+l.length<=Tf)return new e(l.flatten().concat(this.values))},i.length.get=function(){return this.values.length},i.depth.get=function(){return 0},Object.defineProperties(e.prototype,i),e}(fi);fi.empty=new Db([]);var YQ=function(o){function e(i,a){o.call(this),this.left=i,this.right=a,this.length=i.length+a.length,this.depth=Math.max(i.depth,a.depth)+1}return o&&(e.__proto__=o),e.prototype=Object.create(o&&o.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(a){return a<this.left.length?this.left.get(a):this.right.get(a-this.left.length)},e.prototype.forEachInner=function(a,l,u,f){var g=this.left.length;if(l<g&&this.left.forEachInner(a,l,Math.min(u,g),f)===!1||u>g&&this.right.forEachInner(a,Math.max(l-g,0),Math.min(this.length,u)-g,f+g)===!1)return!1},e.prototype.forEachInvertedInner=function(a,l,u,f){var g=this.left.length;if(l>g&&this.right.forEachInvertedInner(a,l-g,Math.max(u,g)-g,f+g)===!1||u<g&&this.left.forEachInvertedInner(a,Math.min(l,g),u,f)===!1)return!1},e.prototype.sliceInner=function(a,l){if(a==0&&l==this.length)return this;var u=this.left.length;return l<=u?this.left.slice(a,l):a>=u?this.right.slice(a-u,l-u):this.left.slice(a,u).append(this.right.slice(0,l-u))},e.prototype.leafAppend=function(a){var l=this.right.leafAppend(a);if(l)return new e(this.left,l)},e.prototype.leafPrepend=function(a){var l=this.left.leafPrepend(a);if(l)return new e(l,this.right)},e.prototype.appendInner=function(a){return this.left.depth>=Math.max(this.right.depth,a.depth)+1?new e(this.left,new e(this.right,a)):new e(this,a)},e}(fi),Lb=fi,qQ=500,Ai=function(e,i){this.items=e,this.eventCount=i};Ai.prototype.popEvent=function(e,i){var a=this;if(this.eventCount==0)return null;for(var l=this.items.length;;l--){var u=this.items.get(l-1);if(u.selection){--l;break}}var f,g;i&&(f=this.remapping(l,this.items.length),g=f.maps.length);var _=e.tr,I,T,N=[],D=[];return this.items.forEach(function(F,K){if(!F.step){f||(f=a.remapping(l,K+1),g=f.maps.length),g--,D.push(F);return}if(f){D.push(new Hs(F.map));var J=F.step.map(f.slice(g)),nt;J&&_.maybeStep(J).doc&&(nt=_.mapping.maps[_.mapping.maps.length-1],N.push(new Hs(nt,null,null,N.length+D.length))),g--,nt&&f.appendMap(nt,g)}else _.maybeStep(F.step);if(F.selection)return I=f?F.selection.map(f.slice(g)):F.selection,T=new Ai(a.items.slice(0,l).append(D.reverse().concat(N)),a.eventCount-1),!1},this.items.length,0),{remaining:T,transform:_,selection:I}};Ai.prototype.addTransform=function(e,i,a,l){for(var u=[],f=this.eventCount,g=this.items,_=!l&&g.length?g.get(g.length-1):null,I=0;I<e.steps.length;I++){var T=e.steps[I].invert(e.docs[I]),N=new Hs(e.mapping.maps[I],T,i),D=void 0;(D=_&&_.merge(N))&&(N=D,I?u.pop():g=g.slice(0,g.length-1)),u.push(N),i&&(f++,i=null),l||(_=N)}var F=f-a.depth;return F>zQ&&(g=JQ(g,F),f-=F),new Ai(g.append(u),f)};Ai.prototype.remapping=function(e,i){var a=new Ni;return this.items.forEach(function(l,u){var f=l.mirrorOffset!=null&&u-l.mirrorOffset>=e?a.maps.length-l.mirrorOffset:null;a.appendMap(l.map,f)},e,i),a};Ai.prototype.addMaps=function(e){return this.eventCount==0?this:new Ai(this.items.append(e.map(function(i){return new Hs(i)})),this.eventCount)};Ai.prototype.rebased=function(e,i){if(!this.eventCount)return this;var a=[],l=Math.max(0,this.items.length-i),u=e.mapping,f=e.steps.length,g=this.eventCount;this.items.forEach(function(F){F.selection&&g--},l);var _=i;this.items.forEach(function(F){var K=u.getMirror(--_);if(K!=null){f=Math.min(f,K);var J=u.maps[K];if(F.step){var nt=e.steps[K].invert(e.docs[K]),it=F.selection&&F.selection.map(u.slice(_+1,K));it&&g++,a.push(new Hs(J,nt,it))}else a.push(new Hs(J))}},l);for(var I=[],T=i;T<f;T++)I.push(new Hs(u.maps[T]));var N=this.items.slice(0,l).append(I).append(a),D=new Ai(N,g);return D.emptyItemCount()>qQ&&(D=D.compress(this.items.length-a.length)),D};Ai.prototype.emptyItemCount=function(){var e=0;return this.items.forEach(function(i){i.step||e++}),e};Ai.prototype.compress=function(e){e===void 0&&(e=this.items.length);var i=this.remapping(0,e),a=i.maps.length,l=[],u=0;return this.items.forEach(function(f,g){if(g>=e)l.push(f),f.selection&&u++;else if(f.step){var _=f.step.map(i.slice(a)),I=_&&_.getMap();if(a--,I&&i.appendMap(I,a),_){var T=f.selection&&f.selection.map(i.slice(a));T&&u++;var N=new Hs(I.invert(),_,T),D,F=l.length-1;(D=l.length&&l[F].merge(N))?l[F]=D:l.push(N)}}else f.map&&a--},this.items.length,0),new Ai(Lb.from(l.reverse()),u)};Ai.empty=new Ai(Lb.empty,0);function JQ(o,e){var i;return o.forEach(function(a,l){if(a.selection&&e--==0)return i=l,!1}),o.slice(i)}var Hs=function(e,i,a,l){this.map=e,this.step=i,this.selection=a,this.mirrorOffset=l};Hs.prototype.merge=function(e){if(this.step&&e.step&&!e.selection){var i=e.step.merge(this.step);if(i)return new Hs(i.getMap().invert(),i,this.selection)}};var rc=function(e,i,a,l){this.done=e,this.undone=i,this.prevRanges=a,this.prevTime=l},zQ=20;function XQ(o,e,i,a){var l=i.getMeta(nc),u;if(l)return l.historyState;i.getMeta($Q)&&(o=new rc(o.done,o.undone,null,0));var f=i.getMeta("appendedTransaction");if(i.steps.length==0)return o;if(f&&f.getMeta(nc))return f.getMeta(nc).redo?new rc(o.done.addTransform(i,null,a,Rf(e)),o.undone,Mb(i.mapping.maps[i.steps.length-1]),o.prevTime):new rc(o.done,o.undone.addTransform(i,null,a,Rf(e)),null,o.prevTime);if(i.getMeta("addToHistory")!==!1&&!(f&&f.getMeta("addToHistory")===!1)){var g=o.prevTime==0||!f&&(o.prevTime<(i.time||0)-a.newGroupDelay||!ZQ(i,o.prevRanges)),_=f?e_(o.prevRanges,i.mapping):Mb(i.mapping.maps[i.steps.length-1]);return new rc(o.done.addTransform(i,g?e.selection.getBookmark():null,a,Rf(e)),Ai.empty,_,i.time)}else return(u=i.getMeta("rebased"))?new rc(o.done.rebased(i,u),o.undone.rebased(i,u),e_(o.prevRanges,i.mapping),o.prevTime):new rc(o.done.addMaps(i.mapping.maps),o.undone.addMaps(i.mapping.maps),e_(o.prevRanges,i.mapping),o.prevTime)}function ZQ(o,e){if(!e)return!1;if(!o.docChanged)return!0;var i=!1;return o.mapping.maps[0].forEach(function(a,l){for(var u=0;u<e.length;u+=2)a<=e[u+1]&&l>=e[u]&&(i=!0)}),i}function Mb(o){var e=[];return o.forEach(function(i,a,l,u){return e.push(l,u)}),e}function e_(o,e){if(!o)return null;for(var i=[],a=0;a<o.length;a+=2){var l=e.map(o[a],1),u=e.map(o[a+1],-1);l<=u&&i.push(l,u)}return i}function Pb(o,e,i,a){var l=Rf(e),u=nc.get(e).spec.config,f=(a?o.undone:o.done).popEvent(e,l);if(!!f){var g=f.selection.resolve(f.transform.doc),_=(a?o.done:o.undone).addTransform(f.transform,e.selection.getBookmark(),u,l),I=new rc(a?_:f.remaining,a?f.remaining:_,null,0);i(f.transform.setSelection(g).setMeta(nc,{redo:a,historyState:I}).scrollIntoView())}}var r_=!1,Bb=null;function Rf(o){var e=o.plugins;if(Bb!=e){r_=!1,Bb=e;for(var i=0;i<e.length;i++)if(e[i].spec.historyPreserveItems){r_=!0;break}}return r_}var nc=new Ki("history"),$Q=new Ki("closeHistory");function t4(o){return o={depth:o&&o.depth||100,newGroupDelay:o&&o.newGroupDelay||500},new ni({key:nc,state:{init:function(){return new rc(Ai.empty,Ai.empty,null,0)},apply:function(i,a,l){return XQ(a,l,i,o)}},config:o,props:{handleDOMEvents:{beforeinput:function(i,a){var l=a.inputType=="historyUndo"?Ub(i.state,i.dispatch):a.inputType=="historyRedo"?xb(i.state,i.dispatch):!1;return l&&a.preventDefault(),l}}}})}function Ub(o,e){var i=nc.getState(o);return!i||i.done.eventCount==0?!1:(e&&Pb(i,o,e,!1),!0)}function xb(o,e){var i=nc.getState(o);return!i||i.undone.eventCount==0?!1:(e&&Pb(i,o,e,!0),!0)}const e4=ii.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:o,dispatch:e})=>Ub(o,e),redo:()=>({state:o,dispatch:e})=>xb(o,e)}},addProseMirrorPlugins(){return[t4(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Mod-y":()=>this.editor.commands.redo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-\u044F":()=>this.editor.commands.undo(),"Shift-Mod-\u044F":()=>this.editor.commands.redo()}}}),r4=Di.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:o}){return["hr",pi(this.options.HTMLAttributes,o)]},addCommands(){return{setHorizontalRule:()=>({chain:o})=>o().insertContent({type:this.name}).command(({tr:e,dispatch:i})=>{var a;if(i){const{parent:l,pos:u}=e.selection.$from,f=u+1;if(e.doc.nodeAt(f))e.setSelection(cr.create(e.doc,f));else{const _=(a=l.type.contentMatch.defaultType)===null||a===void 0?void 0:a.create();_&&(e.insert(f,_),e.setSelection(cr.create(e.doc,f)))}e.scrollIntoView()}return!0}).run()}},addInputRules(){return[F3({find:/^(?:---|—-|___\s|\*\*\*\s)$/,type:this.type})]}}),n4=/(?:^|\s)((?:\*)((?:[^*]+))(?:\*))$/,i4=/(?:^|\s)((?:\*)((?:[^*]+))(?:\*))/g,o4=/(?:^|\s)((?:_)((?:[^_]+))(?:_))$/,s4=/(?:^|\s)((?:_)((?:[^_]+))(?:_))/g,a4=tc.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:o=>o.style.fontStyle!=="normal"&&null},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:o}){return["em",pi(this.options.HTMLAttributes,o),0]},addCommands(){return{setItalic:()=>({commands:o})=>o.setMark(this.name),toggleItalic:()=>({commands:o})=>o.toggleMark(this.name),unsetItalic:()=>({commands:o})=>o.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[Uc({find:n4,type:this.type}),Uc({find:o4,type:this.type})]},addPasteRules(){return[xc({find:i4,type:this.type}),xc({find:s4,type:this.type})]}}),c4=Di.create({name:"listItem",addOptions(){return{HTMLAttributes:{}}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:o}){return["li",pi(this.options.HTMLAttributes,o),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),l4=/^(\d+)\.\s$/,d4=Di.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:o=>o.hasAttribute("start")?parseInt(o.getAttribute("start")||"",10):1}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:o}){const a=o,{start:e}=a,i=nR(a,["start"]);return e===1?["ol",pi(this.options.HTMLAttributes,i),0]:["ol",pi(this.options.HTMLAttributes,o),0]},addCommands(){return{toggleOrderedList:()=>({commands:o})=>o.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){return[Af({find:l4,type:this.type,getAttributes:o=>({start:+o[1]}),joinPredicate:(o,e)=>e.childCount+e.attrs.start===+o[1]})]}}),u4=Di.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:o}){return["p",pi(this.options.HTMLAttributes,o),0]},addCommands(){return{setParagraph:()=>({commands:o})=>o.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),h4=/(?:^|\s)((?:~~)((?:[^~]+))(?:~~))$/,p4=/(?:^|\s)((?:~~)((?:[^~]+))(?:~~))/g,f4=tc.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:o=>o.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:o}){return["s",pi(this.options.HTMLAttributes,o),0]},addCommands(){return{setStrike:()=>({commands:o})=>o.setMark(this.name),toggleStrike:()=>({commands:o})=>o.toggleMark(this.name),unsetStrike:()=>({commands:o})=>o.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-x":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[Uc({find:h4,type:this.type})]},addPasteRules(){return[xc({find:p4,type:this.type})]}}),A4=Di.create({name:"text",group:"inline"}),g4=ii.create({name:"starterKit",addExtensions(){var o,e,i,a,l,u,f,g,_,I,T,N,D,F,K,J,nt,it;const z=[];return this.options.blockquote!==!1&&z.push(IQ.configure((o=this.options)===null||o===void 0?void 0:o.blockquote)),this.options.bold!==!1&&z.push(RQ.configure((e=this.options)===null||e===void 0?void 0:e.bold)),this.options.bulletList!==!1&&z.push(bQ.configure((i=this.options)===null||i===void 0?void 0:i.bulletList)),this.options.code!==!1&&z.push(kQ.configure((a=this.options)===null||a===void 0?void 0:a.code)),this.options.codeBlock!==!1&&z.push(MQ.configure((l=this.options)===null||l===void 0?void 0:l.codeBlock)),this.options.document!==!1&&z.push(PQ.configure((u=this.options)===null||u===void 0?void 0:u.document)),this.options.dropcursor!==!1&&z.push(UQ.configure((f=this.options)===null||f===void 0?void 0:f.dropcursor)),this.options.gapcursor!==!1&&z.push(WQ.configure((g=this.options)===null||g===void 0?void 0:g.gapcursor)),this.options.hardBreak!==!1&&z.push(KQ.configure((_=this.options)===null||_===void 0?void 0:_.hardBreak)),this.options.heading!==!1&&z.push(HQ.configure((I=this.options)===null||I===void 0?void 0:I.heading)),this.options.history!==!1&&z.push(e4.configure((T=this.options)===null||T===void 0?void 0:T.history)),this.options.horizontalRule!==!1&&z.push(r4.configure((N=this.options)===null||N===void 0?void 0:N.horizontalRule)),this.options.italic!==!1&&z.push(a4.configure((D=this.options)===null||D===void 0?void 0:D.italic)),this.options.listItem!==!1&&z.push(c4.configure((F=this.options)===null||F===void 0?void 0:F.listItem)),this.options.orderedList!==!1&&z.push(d4.configure((K=this.options)===null||K===void 0?void 0:K.orderedList)),this.options.paragraph!==!1&&z.push(u4.configure((J=this.options)===null||J===void 0?void 0:J.paragraph)),this.options.strike!==!1&&z.push(f4.configure((nt=this.options)===null||nt===void 0?void 0:nt.strike)),this.options.text!==!1&&z.push(A4.configure((it=this.options)===null||it===void 0?void 0:it.text)),z}}),m4=(o,e)=>{let i=0,a=0;for(;i<o.length&&i<e.length&&o[i]===e[i];)i++;if(i!==o.length||i!==e.length)for(;a+i<o.length&&a+i<e.length&&o[o.length-a-1]===e[e.length-a-1];)a++;return{index:i,remove:o.length-i-a,insert:e.slice(i,e.length-a)}},E4=m4,Tn=new Ki("y-sync"),Vc=new Ki("y-undo"),wf=new Ki("yjs-cursor"),bf=(o,e)=>e===void 0?!o.deleted:e.sv.has(o.id.client)&&e.sv.get(o.id.client)>o.id.clock&&!bM(e.ds,o.id),_4=[{light:"#ecd44433",dark:"#ecd444"}],v4=(o,e,i)=>{if(!o.has(i)){if(o.size<e.length){const a=BM();o.forEach(l=>a.add(l)),e=e.filter(l=>!a.has(l))}o.set(i,LM(e))}return o.get(i)},I4=(o,{colors:e=_4,colorMapping:i=new Map,permanentUserData:a=null}={})=>{let l=!1;const u=new ni({props:{editable:f=>{const g=Tn.getState(f);return g.snapshot==null&&g.prevSnapshot==null}},key:Tn,state:{init:(f,g)=>({type:o,doc:o.doc,binding:null,snapshot:null,prevSnapshot:null,isChangeOrigin:!1,colors:e,colorMapping:i,permanentUserData:a}),apply:(f,g)=>{const _=f.getMeta(Tn);if(_!==void 0){g=Object.assign({},g);for(const I in _)g[I]=_[I]}return g.isChangeOrigin=_!==void 0&&!!_.isChangeOrigin,g.binding!==null&&_!==void 0&&(_.snapshot!=null||_.prevSnapshot!=null)&&setTimeout(()=>{_.restore==null?g.binding._renderSnapshot(_.snapshot,_.prevSnapshot,g):(g.binding._renderSnapshot(_.snapshot,_.snapshot,g),delete g.restore,delete g.snapshot,delete g.prevSnapshot,g.binding._prosemirrorChanged(g.binding.prosemirrorView.state.doc))},0),g}},view:f=>{const g=new S4(o,f);return setTimeout(()=>{g._forceRerender(),f.dispatch(f.state.tr.setMeta(Tn,{binding:g}))},0),{update:()=>{const _=u.getState(f.state);_.snapshot==null&&_.prevSnapshot==null&&(l||f.state.doc.content.findDiffStart(f.state.doc.type.createAndFill().content)!==null)&&(l=!0,g._prosemirrorChanged(f.state.doc))},destroy:()=>{g.destroy()}}}});return u},C4=(o,e,i)=>{if(e!==null&&e.anchor!==null&&e.head!==null){const a=zu(i.doc,i.type,e.anchor,i.mapping),l=zu(i.doc,i.type,e.head,i.mapping);a!==null&&l!==null&&(o=o.setSelection(cr.create(o.doc,a,l)))}},n_=(o,e)=>({anchor:Df(e.selection.anchor,o.type,o.mapping),head:Df(e.selection.head,o.type,o.mapping)});class S4{constructor(e,i){this.type=e,this.prosemirrorView=i,this.mux=yM(),this.mapping=new Map,this._observeFunction=this._typeChanged.bind(this),this.doc=e.doc,this.beforeTransactionSelection=null,this.beforeAllTransactions=()=>{this.beforeTransactionSelection===null&&(this.beforeTransactionSelection=n_(this,i.state))},this.afterAllTransactions=()=>{this.beforeTransactionSelection=null},this.doc.on("beforeAllTransactions",this.beforeAllTransactions),this.doc.on("afterAllTransactions",this.afterAllTransactions),e.observeDeep(this._observeFunction),this._domSelectionInView=null}_isLocalCursorInView(){return this.prosemirrorView.hasFocus()?(TM&&this._domSelectionInView===null&&(setTimeout(()=>{this._domSelectionInView=null},0),this._domSelectionInView=this._isDomSelectionInView()),this._domSelectionInView):!1}_isDomSelectionInView(){const e=this.prosemirrorView._root.getSelection(),i=this.prosemirrorView._root.createRange();i.setStart(e.anchorNode,e.anchorOffset),i.setEnd(e.focusNode,e.focusOffset),i.getClientRects().length===0&&i.startContainer&&i.collapsed&&i.selectNodeContents(i.startContainer);const l=i.getBoundingClientRect(),u=RM.documentElement;return l.bottom>=0&&l.right>=0&&l.left<=(window.innerWidth||u.clientWidth||0)&&l.top<=(window.innerHeight||u.clientHeight||0)}renderSnapshot(e,i){i||(i=kM(DM(),new Map)),this.prosemirrorView.dispatch(this.prosemirrorView.state.tr.setMeta(Tn,{snapshot:e,prevSnapshot:i}))}unrenderSnapshot(){this.mapping=new Map,this.mux(()=>{const e=this.type.toArray().map(a=>Nf(a,this.prosemirrorView.state.schema,this.mapping)).filter(a=>a!==null),i=this.prosemirrorView.state.tr.replace(0,this.prosemirrorView.state.doc.content.size,new Ht(new Nt(e),0,0));i.setMeta(Tn,{snapshot:null,prevSnapshot:null}),this.prosemirrorView.dispatch(i)})}_forceRerender(){this.mapping=new Map,this.mux(()=>{const e=this.type.toArray().map(a=>Nf(a,this.prosemirrorView.state.schema,this.mapping)).filter(a=>a!==null),i=this.prosemirrorView.state.tr.replace(0,this.prosemirrorView.state.doc.content.size,new Ht(new Nt(e),0,0));this.prosemirrorView.dispatch(i.setMeta(Tn,{isChangeOrigin:!0}))})}_renderSnapshot(e,i,a){e||(e=wM(this.doc)),this.mapping=new Map,this.mux(()=>{this.doc.transact(l=>{const u=a.permanentUserData;u&&u.dss.forEach(I=>{lR(l,I,T=>{})});const f=(I,T)=>{const N=I==="added"?u.getUserByClientId(T.client):u.getUserByDeletedId(T);return{user:N,type:I,color:v4(a.colorMapping,a.colors,N)}},g=dR(this.type,new uR(i.ds,e.sv)).map(I=>!I._item.deleted||bf(I._item,e)||bf(I._item,i)?Nf(I,this.prosemirrorView.state.schema,new Map,e,i,f):null).filter(I=>I!==null),_=this.prosemirrorView.state.tr.replace(0,this.prosemirrorView.state.doc.content.size,new Ht(new Nt(g),0,0));this.prosemirrorView.dispatch(_.setMeta(Tn,{isChangeOrigin:!0}))},Tn)})}_typeChanged(e,i){const a=Tn.getState(this.prosemirrorView.state);if(e.length===0||a.snapshot!=null||a.prevSnapshot!=null){this.renderSnapshot(a.snapshot,a.prevSnapshot);return}this.mux(()=>{const l=(g,_)=>this.mapping.delete(_);lR(i,i.deleteSet,g=>g.constructor===hR&&this.mapping.delete(g.content.type)),i.changed.forEach(l),i.changedParentTypes.forEach(l);const u=this.type.toArray().map(g=>Fb(g,this.prosemirrorView.state.schema,this.mapping)).filter(g=>g!==null);let f=this.prosemirrorView.state.tr.replace(0,this.prosemirrorView.state.doc.content.size,new Ht(new Nt(u),0,0));C4(f,this.beforeTransactionSelection,this),f=f.setMeta(Tn,{isChangeOrigin:!0}),this.beforeTransactionSelection!==null&&this._isLocalCursorInView()&&f.scrollIntoView(),this.prosemirrorView.dispatch(f)})}_prosemirrorChanged(e){this.mux(()=>{this.doc.transact(()=>{s_(this.doc,this.type,e,this.mapping),this.beforeTransactionSelection=n_(this,this.prosemirrorView.state)},Tn)})}destroy(){this.type.unobserveDeep(this._observeFunction),this.doc.off("beforeAllTransactions",this.beforeAllTransactions),this.doc.off("afterAllTransactions",this.afterAllTransactions)}}const Fb=(o,e,i,a,l,u)=>{const f=i.get(o);if(f===void 0){if(o instanceof Ia)return Nf(o,e,i,a,l,u);throw NM()}return f},Nf=(o,e,i,a,l,u)=>{const f=[],g=_=>{if(_.constructor===Ia){const I=Fb(_,e,i,a,l,u);I!==null&&f.push(I)}else{const I=y4(_,e,i,a,l,u);I!==null&&I.forEach(T=>{T!==null&&f.push(T)})}};a===void 0||l===void 0?o.toArray().forEach(g):dR(o,new uR(l.ds,a.sv)).forEach(g);try{const _=o.getAttributes(a);a!==void 0&&(bf(o._item,a)?bf(o._item,l)||(_.ychange=u?u("added",o._item.id):{type:"added"}):_.ychange=u?u("removed",o._item.id):{type:"removed"});const I=e.node(o.nodeName,_,f);return i.set(o,I),I}catch{return o.doc.transact(I=>{o._item.delete(I)},Tn),i.delete(o),null}},y4=(o,e,i,a,l,u)=>{const f=[],g=o.toDelta(a,l,u);try{for(let _=0;_<g.length;_++){const I=g[_],T=[];for(const N in I.attributes)T.push(e.mark(N,I.attributes[N]));f.push(e.text(I.insert,T))}}catch{return o.doc.transact(I=>{o._item.delete(I)},Tn),null}return f},T4=(o,e)=>{const i=new Ka,a=o.map(l=>({insert:l.text,attributes:jb(l.marks)}));return i.applyDelta(a),e.set(i,o),i},R4=(o,e)=>{const i=new Ia(o.type.name);for(const a in o.attrs){const l=o.attrs[a];l!==null&&a!=="ychange"&&i.setAttribute(a,l)}return i.insert(0,Of(o).map(a=>i_(a,e))),e.set(i,o),i},i_=(o,e)=>o instanceof Array?T4(o,e):R4(o,e),Qb=o=>typeof o=="object"&&o!==null,o_=(o,e)=>{const i=Object.keys(o).filter(l=>o[l]!==null);let a=i.length===Object.keys(e).filter(l=>e[l]!==null).length;for(let l=0;l<i.length&&a;l++){const u=i[l],f=o[u],g=e[u];a=u==="ychange"||f===g||Qb(f)&&Qb(g)&&o_(f,g)}return a},Of=o=>{const e=o.content.content,i=[];for(let a=0;a<e.length;a++){const l=e[a];if(l.isText){const u=[];for(let f=e[a];a<e.length&&f.isText;f=e[++a])u.push(f);a--,i.push(u)}else i.push(l)}return i},Vb=(o,e)=>{const i=o.toDelta();return i.length===e.length&&i.every((a,l)=>a.insert===e[l].text&&OM(a.attributes||{}).length===e[l].marks.length&&e[l].marks.every(u=>o_(a.attributes[u.type.name]||{},u.attrs)))},qu=(o,e)=>{if(o instanceof Ia&&!(e instanceof Array)&&a_(o,e)){const i=Of(e);return o._length===i.length&&o_(o.getAttributes(),e.attrs)&&o.toArray().every((a,l)=>qu(a,i[l]))}return o instanceof Ka&&e instanceof Array&&Vb(o,e)},kf=(o,e)=>o===e||o instanceof Array&&e instanceof Array&&o.length===e.length&&o.every((i,a)=>e[a]===i),Gb=(o,e,i)=>{const a=o.toArray(),l=Of(e),u=l.length,f=a.length,g=Eu(f,u);let _=0,I=0,T=!1;for(;_<g;_++){const N=a[_],D=l[_];if(kf(i.get(N),D))T=!0;else if(!qu(N,D))break}for(;_+I<g;I++){const N=a[f-I-1],D=l[u-I-1];if(kf(i.get(N),D))T=!0;else if(!qu(N,D))break}return{equalityFactor:_+I,foundMappedChild:T}},w4=o=>{let e="",i=o._start;const a={};for(;i!==null;)i.deleted||(i.countable&&i.content instanceof MM?e+=i.content.str:i.content instanceof PM&&(a[i.content.key]=null)),i=i.right;return{str:e,nAttrs:a}},b4=(o,e,i)=>{i.set(o,e);const{nAttrs:a,str:l}=w4(o),u=e.map(I=>({insert:I.text,attributes:Object.assign({},a,jb(I.marks))})),{insert:f,remove:g,index:_}=E4(l,u.map(I=>I.insert).join(""));o.delete(_,g),o.insert(_,f),o.applyDelta(u.map(I=>({retain:I.insert.length,attributes:I.attributes})))},jb=o=>{const e={};return o.forEach(i=>{i.type.name!=="ychange"&&(e[i.type.name]=i.attrs)}),e},s_=(o,e,i,a)=>{if(e instanceof Ia&&e.nodeName!==i.type.name)throw new Error("node name mismatch!");if(a.set(e,i),e instanceof Ia){const N=e.getAttributes(),D=i.attrs;for(const F in D)D[F]!==null?N[F]!==D[F]&&F!=="ychange"&&e.setAttribute(F,D[F]):e.removeAttribute(F);for(const F in N)D[F]===void 0&&e.removeAttribute(F)}const l=Of(i),u=l.length,f=e.toArray(),g=f.length,_=Eu(u,g);let I=0,T=0;for(;I<_;I++){const N=f[I],D=l[I];if(!kf(a.get(N),D))if(qu(N,D))a.set(N,D);else break}for(;T+I+1<_;T++){const N=f[g-T-1],D=l[u-T-1];if(!kf(a.get(N),D))if(qu(N,D))a.set(N,D);else break}o.transact(()=>{for(;g-I-T>0&&u-I-T>0;){const D=f[I],F=l[I],K=f[g-T-1],J=l[u-T-1];if(D instanceof Ka&&F instanceof Array)Vb(D,F)||b4(D,F,a),I+=1;else{let nt=D instanceof Ia&&a_(D,F),it=K instanceof Ia&&a_(K,J);if(nt&&it){const z=Gb(D,F,a),Ot=Gb(K,J,a);z.foundMappedChild&&!Ot.foundMappedChild?it=!1:!z.foundMappedChild&&Ot.foundMappedChild||z.equalityFactor<Ot.equalityFactor?nt=!1:it=!1}nt?(s_(o,D,F,a),I+=1):it?(s_(o,K,J,a),T+=1):(e.delete(I,1),e.insert(I,[i_(F,a)]),I+=1)}}const N=g-I-T;if(N>0&&e.delete(I,N),I+T<u){const D=[];for(let F=I;F<u-T;F++)D.push(i_(l[F],a));e.insert(I,D)}},Tn)},a_=(o,e)=>!(e instanceof Array)&&o.nodeName===e.type.name;let Ju=null;const N4=()=>{const o=Ju;Ju=null,o.forEach((e,i)=>{const a=i.state.tr;e.forEach((l,u)=>{a.setMeta(u,l)}),i.dispatch(a)})},O4=(o,e,i)=>{Ju||(Ju=new Map,ZM(0,N4)),VM(Ju,o,GM).set(e,i)},Df=(o,e,i)=>{if(o===0)return ym(e,0);let a=e._first===null?null:e._first.content.type;for(;a!==null&&e!==a;){if(a instanceof Ka){if(a._length>=o)return ym(a,o);if(o-=a._length,a._item!==null&&a._item.next!==null)a=a._item.next.content.type;else{do a=a._item===null?null:a._item.parent,o--;while(a!==e&&a!==null&&a._item!==null&&a._item.next===null);a!==null&&a!==e&&(a=a._item===null?null:a._item.next.content.type)}}else{const l=(i.get(a)||{nodeSize:0}).nodeSize;if(a._first!==null&&o<l)a=a._first.content.type,o--;else{if(o===1&&a._length===0&&l>1)return new Tm(a._item===null?null:a._item.id,a._item===null?Rm(a):null,null);if(o-=l,a._item!==null&&a._item.next!==null)a=a._item.next.content.type;else{if(o===0)return a=a._item===null?a:a._item.parent,new Tm(a._item===null?null:a._item.id,a._item===null?Rm(a):null,null);do a=a._item.parent,o--;while(a!==e&&a._item.next===null);a!==e&&(a=a._item.next.content.type)}}}if(a===null)throw UM();if(o===0&&a.constructor!==Ka&&a!==e)return k4(a._item.parent,a._item)}return ym(e,e._length)},k4=(o,e)=>{let i=null,a=null;return o._item===null?a=Rm(o):i=xM(o._item.id.client,o._item.id.clock),new Tm(i,a,e.id)},zu=(o,e,i,a)=>{const l=FM(i,o);if(l===null||l.type!==e&&!QM(e,l.type._item))return null;let u=l.type,f=0;if(u.constructor===Ka)f=l.index;else if(u._item===null||!u._item.deleted){let g=u._first,_=0;for(;_<u._length&&_<l.index&&g!==null;){if(!g.deleted){const I=g.content.type;_++,I instanceof Ka?f+=I._length:f+=a.get(I).nodeSize}g=g.right}f+=1}for(;u!==e&&u._item!==null;){const g=u._item.parent;if(g._item===null||!g._item.deleted){f+=1;let _=g._first;for(;_!==null;){const I=_.content.type;if(I===u)break;_.deleted||(I instanceof Ka?f+=I._length:f+=a.get(I).nodeSize),_=_.right}}u=g}return f-1},D4=o=>{const e=document.createElement("span");e.classList.add("ProseMirror-yjs-cursor"),e.setAttribute("style",`border-color: ${o.color}`);const i=document.createElement("div");return i.setAttribute("style",`background-color: ${o.color}`),i.insertBefore(document.createTextNode(o.name),null),e.insertBefore(i,null),e},L4=/^#[0-9a-fA-F]{6}$/,Wb=(o,e,i)=>{const a=Tn.getState(o),l=a.doc,u=[];return a.snapshot!=null||a.prevSnapshot!=null||a.binding===null?wr.create(o.doc,[]):(e.getStates().forEach((f,g)=>{if(g!==l.clientID&&f.cursor!=null){const _=f.user||{};_.color==null?_.color="#ffa500":L4.test(_.color)||console.warn("A user uses an unsupported color format",_),_.name==null&&(_.name=`User: ${g}`);let I=zu(l,a.type,_u(f.cursor.anchor),a.binding.mapping),T=zu(l,a.type,_u(f.cursor.head),a.binding.mapping);if(I!==null&&T!==null){const N=pR(o.doc.content.size-1,0);I=Eu(I,N),T=Eu(T,N),u.push(Qn.widget(T,()=>i(_),{key:g+"",side:10}));const D=Eu(I,T),F=pR(I,T);u.push(Qn.inline(D,F,{style:`background-color: ${_.color}70`},{inclusiveEnd:!0,inclusiveStart:!1}))}}}),wr.create(o.doc,u))},M4=(o,{cursorBuilder:e=D4,getSelection:i=l=>l.selection}={},a="cursor")=>new ni({key:wf,state:{init(l,u){return Wb(u,o,e)},apply(l,u,f,g){const _=Tn.getState(g),I=l.getMeta(wf);return _&&_.isChangeOrigin||I&&I.awarenessUpdated?Wb(g,o,e):u.map(l.mapping,l.doc)}},props:{decorations:l=>wf.getState(l)},view:l=>{const u=()=>{l.docView&&O4(l,wf,{awarenessUpdated:!0})},f=()=>{const g=Tn.getState(l.state),_=o.getLocalState()||{};if(l.hasFocus()&&g.binding!==null){const I=i(l.state),T=Df(I.anchor,g.type,g.binding.mapping),N=Df(I.head,g.type,g.binding.mapping);(_.cursor==null||!fR(_u(_.cursor.anchor),T)||!fR(_u(_.cursor.head),N))&&o.setLocalStateField(a,{anchor:T,head:N})}else _.cursor!=null&&zu(g.doc,g.type,_u(_.cursor.anchor),g.binding.mapping)!==null&&o.setLocalStateField(a,null)};return o.on("change",u),l.dom.addEventListener("focusin",f),l.dom.addEventListener("focusout",f),{update:f,destroy:()=>{l.dom.removeEventListener("focusin",f),l.dom.removeEventListener("focusout",f),o.off("change",u),o.setLocalStateField(a,null)}}}}),P4=o=>{const e=Vc.getState(o).undoManager;if(e!=null)return e.undo(),!0},B4=o=>{const e=Vc.getState(o).undoManager;if(e!=null)return e.redo(),!0},U4=new Set(["paragraph"]),x4=(o,e)=>!(o instanceof hR)||!(o.content instanceof WM)||!(o.content.type instanceof KM||o.content.type instanceof Ia&&e.has(o.content.type.nodeName))||o.content.type._length===0,F4=({protectedNodes:o=U4,trackedOrigins:e=[],undoManager:i=null}={})=>new ni({key:Vc,state:{init:(a,l)=>{const u=Tn.getState(l),f=i||new jM(u.type,{trackedOrigins:new Set([Tn].concat(e)),deleteFilter:g=>x4(g,o)});return{undoManager:f,prevSel:null,hasUndoOps:f.undoStack.length>0,hasRedoOps:f.redoStack.length>0}},apply:(a,l,u,f)=>{const g=Tn.getState(f).binding,_=l.undoManager,I=_.undoStack.length>0,T=_.redoStack.length>0;return g?{undoManager:_,prevSel:n_(g,u),hasUndoOps:I,hasRedoOps:T}:I!==l.hasUndoOps||T!==l.hasRedoOps?Object.assign({},l,{hasUndoOps:_.undoStack.length>0,hasRedoOps:_.redoStack.length>0}):l}},view:a=>{const l=Tn.getState(a.state),u=Vc.getState(a.state).undoManager;return u.on("stack-item-added",({stackItem:f})=>{const g=l.binding;g&&f.meta.set(g,Vc.getState(a.state).prevSel)}),u.on("stack-item-popped",({stackItem:f})=>{const g=l.binding;g&&(g.beforeTransactionSelection=f.meta.get(g)||g.beforeTransactionSelection)}),{destroy:()=>{u.destroy()}}}}),Q4=ii.create({name:"collaboration",priority:1e3,addOptions(){return{document:null,field:"default",fragment:null}},onCreate(){this.editor.extensionManager.extensions.find(o=>o.name==="history")&&console.warn('[tiptap warn]: "@tiptap/extension-collaboration" comes with its own history support and is not compatible with "@tiptap/extension-history".')},addCommands(){return{undo:()=>({tr:o,state:e,dispatch:i})=>(o.setMeta("preventDispatch",!0),Vc.getState(e).undoManager.undoStack.length===0?!1:i?P4(e):!0),redo:()=>({tr:o,state:e,dispatch:i})=>(o.setMeta("preventDispatch",!0),Vc.getState(e).undoManager.redoStack.length===0?!1:i?B4(e):!0)}},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Mod-y":()=>this.editor.commands.redo(),"Shift-Mod-z":()=>this.editor.commands.redo()}},addProseMirrorPlugins(){const o=this.options.fragment?this.options.fragment:this.options.document.getXmlFragment(this.options.field);return[I4(o),F4()]}}),Kb=o=>Array.from(o.entries()).map(([e,i])=>Dt({clientId:e},i.user)),Hb=()=>null,V4=ii.create({name:"collaborationCursor",addOptions(){return{provider:null,user:{name:null,color:null},render:o=>{const e=document.createElement("span");e.classList.add("collaboration-cursor__caret"),e.setAttribute("style",`border-color: ${o.color}`);const i=document.createElement("div");return i.classList.add("collaboration-cursor__label"),i.setAttribute("style",`background-color: ${o.color}`),i.insertBefore(document.createTextNode(o.name),null),e.insertBefore(i,null),e},onUpdate:Hb}},onCreate(){this.options.onUpdate!==Hb&&console.warn('[tiptap warn]: DEPRECATED: The "onUpdate" option is deprecated. Please use `editor.storage.collaborationCursor.users` instead. Read more: https://tiptap.dev/api/extensions/collaboration-cursor')},addStorage(){return{users:[]}},addCommands(){return{updateUser:o=>()=>(this.options.user=o,this.options.provider.awareness.setLocalStateField("user",this.options.user),!0),user:o=>({editor:e})=>(console.warn('[tiptap warn]: DEPRECATED: The "user" command is deprecated. Please use "updateUser" instead. Read more: https://tiptap.dev/api/extensions/collaboration-cursor'),e.commands.updateUser(o))}},addProseMirrorPlugins(){return[M4((()=>(this.options.provider.awareness.setLocalStateField("user",this.options.user),this.storage.users=Kb(this.options.provider.awareness.states),this.options.provider.awareness.on("update",()=>{this.storage.users=Kb(this.options.provider.awareness.states)}),this.options.provider.awareness))(),{cursorBuilder:this.options.render})]}}),G4=Di.create({name:"taskList",addOptions(){return{itemTypeName:"taskItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:o}){return["ul",pi(this.options.HTMLAttributes,o,{"data-type":this.name}),0]},addCommands(){return{toggleTaskList:()=>({commands:o})=>o.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}}),j4=/^\s*(\[([ |x])\])\s$/,W4=Di.create({name:"taskItem",addOptions(){return{nested:!1,HTMLAttributes:{}}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:o=>o.getAttribute("data-checked")==="true",renderHTML:o=>({"data-checked":o.checked})}}},parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:o,HTMLAttributes:e}){return["li",pi(this.options.HTMLAttributes,e,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:o.attrs.checked?"checked":null}],["span"]],["div",0]]},addKeyboardShortcuts(){const o={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?Qi(Dt({},o),{Tab:()=>this.editor.commands.sinkListItem(this.name)}):o},addNodeView(){return({node:o,HTMLAttributes:e,getPos:i,editor:a})=>{const l=document.createElement("li"),u=document.createElement("label"),f=document.createElement("span"),g=document.createElement("input"),_=document.createElement("div");return u.contentEditable="false",g.type="checkbox",g.addEventListener("change",I=>{if(!a.isEditable){g.checked=!g.checked;return}const{checked:T}=I.target;a.isEditable&&typeof i=="function"&&a.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:N})=>(N.setNodeMarkup(i(),void 0,{checked:T}),!0)).run()}),Object.entries(this.options.HTMLAttributes).forEach(([I,T])=>{l.setAttribute(I,T)}),l.dataset.checked=o.attrs.checked,o.attrs.checked&&g.setAttribute("checked","checked"),u.append(g,f),l.append(u,_),Object.entries(e).forEach(([I,T])=>{l.setAttribute(I,T)}),{dom:l,contentDOM:_,update:I=>I.type!==this.type?!1:(l.dataset.checked=I.attrs.checked,I.attrs.checked?g.setAttribute("checked","checked"):g.removeAttribute("checked"),!0)}}},addInputRules(){return[Af({find:j4,type:this.type,getAttributes:o=>({checked:o[o.length-1]==="x"})})]}}),K4=/(?:^|\s)((?:==)((?:[^~=]+))(?:==))$/,H4=/(?:^|\s)((?:==)((?:[^~=]+))(?:==))/g,Y4=tc.create({name:"highlight",addOptions(){return{multicolor:!1,HTMLAttributes:{}}},addAttributes(){return this.options.multicolor?{color:{default:null,parseHTML:o=>o.getAttribute("data-color")||o.style.backgroundColor,renderHTML:o=>o.color?{"data-color":o.color,style:`background-color: ${o.color}`}:{}}}:{}},parseHTML(){return[{tag:"mark"}]},renderHTML({HTMLAttributes:o}){return["mark",pi(this.options.HTMLAttributes,o),0]},addCommands(){return{setHighlight:o=>({commands:e})=>e.setMark(this.name,o),toggleHighlight:o=>({commands:e})=>e.toggleMark(this.name,o),unsetHighlight:()=>({commands:o})=>o.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-h":()=>this.editor.commands.toggleHighlight()}},addInputRules(){return[Uc({find:K4,type:this.type})]},addPasteRules(){return[xc({find:H4,type:this.type})]}});function Yb(o,e,i){for(var a=0;;a++){if(a==o.childCount||a==e.childCount)return o.childCount==e.childCount?null:i;var l=o.child(a),u=e.child(a);if(l==u){i+=l.nodeSize;continue}if(!l.sameMarkup(u))return i;if(l.isText&&l.text!=u.text){for(var f=0;l.text[f]==u.text[f];f++)i++;return i}if(l.content.size||u.content.size){var g=Yb(l.content,u.content,i+1);if(g!=null)return g}i+=l.nodeSize}}function qb(o,e,i,a){for(var l=o.childCount,u=e.childCount;;){if(l==0||u==0)return l==u?null:{a:i,b:a};var f=o.child(--l),g=e.child(--u),_=f.nodeSize;if(f==g){i-=_,a-=_;continue}if(!f.sameMarkup(g))return{a:i,b:a};if(f.isText&&f.text!=g.text){for(var I=0,T=Math.min(f.text.length,g.text.length);I<T&&f.text[f.text.length-I-1]==g.text[g.text.length-I-1];)I++,i--,a--;return{a:i,b:a}}if(f.content.size||g.content.size){var N=qb(f.content,g.content,i-1,a-1);if(N)return N}i-=_,a-=_}}var jt=function(e,i){if(this.content=e,this.size=i||0,i==null)for(var a=0;a<e.length;a++)this.size+=e[a].nodeSize},Lf={firstChild:{configurable:!0},lastChild:{configurable:!0},childCount:{configurable:!0}};jt.prototype.nodesBetween=function(e,i,a,l,u){l===void 0&&(l=0);for(var f=0,g=0;g<i;f++){var _=this.content[f],I=g+_.nodeSize;if(I>e&&a(_,l+g,u,f)!==!1&&_.content.size){var T=g+1;_.nodesBetween(Math.max(0,e-T),Math.min(_.content.size,i-T),a,l+T)}g=I}};jt.prototype.descendants=function(e){this.nodesBetween(0,this.size,e)};jt.prototype.textBetween=function(e,i,a,l){var u="",f=!0;return this.nodesBetween(e,i,function(g,_){g.isText?(u+=g.text.slice(Math.max(e,_)-_,i-_),f=!a):g.isLeaf&&l?(u+=typeof l=="function"?l(g):l,f=!a):!f&&g.isBlock&&(u+=a,f=!0)},0),u};jt.prototype.append=function(e){if(!e.size)return this;if(!this.size)return e;var i=this.lastChild,a=e.firstChild,l=this.content.slice(),u=0;for(i.isText&&i.sameMarkup(a)&&(l[l.length-1]=i.withText(i.text+a.text),u=1);u<e.content.length;u++)l.push(e.content[u]);return new jt(l,this.size+e.size)};jt.prototype.cut=function(e,i){if(i==null&&(i=this.size),e==0&&i==this.size)return this;var a=[],l=0;if(i>e)for(var u=0,f=0;f<i;u++){var g=this.content[u],_=f+g.nodeSize;_>e&&((f<e||_>i)&&(g.isText?g=g.cut(Math.max(0,e-f),Math.min(g.text.length,i-f)):g=g.cut(Math.max(0,e-f-1),Math.min(g.content.size,i-f-1))),a.push(g),l+=g.nodeSize),f=_}return new jt(a,l)};jt.prototype.cutByIndex=function(e,i){return e==i?jt.empty:e==0&&i==this.content.length?this:new jt(this.content.slice(e,i))};jt.prototype.replaceChild=function(e,i){var a=this.content[e];if(a==i)return this;var l=this.content.slice(),u=this.size+i.nodeSize-a.nodeSize;return l[e]=i,new jt(l,u)};jt.prototype.addToStart=function(e){return new jt([e].concat(this.content),this.size+e.nodeSize)};jt.prototype.addToEnd=function(e){return new jt(this.content.concat(e),this.size+e.nodeSize)};jt.prototype.eq=function(e){if(this.content.length!=e.content.length)return!1;for(var i=0;i<this.content.length;i++)if(!this.content[i].eq(e.content[i]))return!1;return!0};Lf.firstChild.get=function(){return this.content.length?this.content[0]:null};Lf.lastChild.get=function(){return this.content.length?this.content[this.content.length-1]:null};Lf.childCount.get=function(){return this.content.length};jt.prototype.child=function(e){var i=this.content[e];if(!i)throw new RangeError("Index "+e+" out of range for "+this);return i};jt.prototype.maybeChild=function(e){return this.content[e]};jt.prototype.forEach=function(e){for(var i=0,a=0;i<this.content.length;i++){var l=this.content[i];e(l,a,i),a+=l.nodeSize}};jt.prototype.findDiffStart=function(e,i){return i===void 0&&(i=0),Yb(this,e,i)};jt.prototype.findDiffEnd=function(e,i,a){return i===void 0&&(i=this.size),a===void 0&&(a=e.size),qb(this,e,i,a)};jt.prototype.findIndex=function(e,i){if(i===void 0&&(i=-1),e==0)return Mf(0,e);if(e==this.size)return Mf(this.content.length,e);if(e>this.size||e<0)throw new RangeError("Position "+e+" outside of fragment ("+this+")");for(var a=0,l=0;;a++){var u=this.child(a),f=l+u.nodeSize;if(f>=e)return f==e||i>0?Mf(a+1,f):Mf(a,l);l=f}};jt.prototype.toString=function(){return"<"+this.toStringInner()+">"};jt.prototype.toStringInner=function(){return this.content.join(", ")};jt.prototype.toJSON=function(){return this.content.length?this.content.map(function(e){return e.toJSON()}):null};jt.fromJSON=function(e,i){if(!i)return jt.empty;if(!Array.isArray(i))throw new RangeError("Invalid input for Fragment.fromJSON");return new jt(i.map(e.nodeFromJSON))};jt.fromArray=function(e){if(!e.length)return jt.empty;for(var i,a=0,l=0;l<e.length;l++){var u=e[l];a+=u.nodeSize,l&&u.isText&&e[l-1].sameMarkup(u)?(i||(i=e.slice(0,l)),i[i.length-1]=u.withText(i[i.length-1].text+u.text)):i&&i.push(u)}return new jt(i||e,a)};jt.from=function(e){if(!e)return jt.empty;if(e instanceof jt)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new jt([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))};Object.defineProperties(jt.prototype,Lf);var c_={index:0,offset:0};function Mf(o,e){return c_.index=o,c_.offset=e,c_}jt.empty=new jt([],0);function Pf(o,e){if(o===e)return!0;if(!(o&&typeof o=="object")||!(e&&typeof e=="object"))return!1;var i=Array.isArray(o);if(Array.isArray(e)!=i)return!1;if(i){if(o.length!=e.length)return!1;for(var a=0;a<o.length;a++)if(!Pf(o[a],e[a]))return!1}else{for(var l in o)if(!(l in e)||!Pf(o[l],e[l]))return!1;for(var u in e)if(!(u in o))return!1}return!0}var gr=function(e,i){this.type=e,this.attrs=i};gr.prototype.addToSet=function(e){for(var i,a=!1,l=0;l<e.length;l++){var u=e[l];if(this.eq(u))return e;if(this.type.excludes(u.type))i||(i=e.slice(0,l));else{if(u.type.excludes(this.type))return e;!a&&u.type.rank>this.type.rank&&(i||(i=e.slice(0,l)),i.push(this),a=!0),i&&i.push(u)}}return i||(i=e.slice()),a||i.push(this),i};gr.prototype.removeFromSet=function(e){for(var i=0;i<e.length;i++)if(this.eq(e[i]))return e.slice(0,i).concat(e.slice(i+1));return e};gr.prototype.isInSet=function(e){for(var i=0;i<e.length;i++)if(this.eq(e[i]))return!0;return!1};gr.prototype.eq=function(e){return this==e||this.type==e.type&&Pf(this.attrs,e.attrs)};gr.prototype.toJSON=function(){var e={type:this.type.name};for(var i in this.attrs){e.attrs=this.attrs;break}return e};gr.fromJSON=function(e,i){if(!i)throw new RangeError("Invalid input for Mark.fromJSON");var a=e.marks[i.type];if(!a)throw new RangeError("There is no mark type "+i.type+" in this schema");return a.create(i.attrs)};gr.sameSet=function(e,i){if(e==i)return!0;if(e.length!=i.length)return!1;for(var a=0;a<e.length;a++)if(!e[a].eq(i[a]))return!1;return!0};gr.setFrom=function(e){if(!e||e.length==0)return gr.none;if(e instanceof gr)return[e];var i=e.slice();return i.sort(function(a,l){return a.type.rank-l.type.rank}),i};gr.none=[];function Ys(o){var e=Error.call(this,o);return e.__proto__=Ys.prototype,e}Ys.prototype=Object.create(Error.prototype);Ys.prototype.constructor=Ys;Ys.prototype.name="ReplaceError";var Ae=function(e,i,a){this.content=e,this.openStart=i,this.openEnd=a},Jb={size:{configurable:!0}};Jb.size.get=function(){return this.content.size-this.openStart-this.openEnd};Ae.prototype.insertAt=function(e,i){var a=Xb(this.content,e+this.openStart,i,null);return a&&new Ae(a,this.openStart,this.openEnd)};Ae.prototype.removeBetween=function(e,i){return new Ae(zb(this.content,e+this.openStart,i+this.openStart),this.openStart,this.openEnd)};Ae.prototype.eq=function(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd};Ae.prototype.toString=function(){return this.content+"("+this.openStart+","+this.openEnd+")"};Ae.prototype.toJSON=function(){if(!this.content.size)return null;var e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e};Ae.fromJSON=function(e,i){if(!i)return Ae.empty;var a=i.openStart||0,l=i.openEnd||0;if(typeof a!="number"||typeof l!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new Ae(jt.fromJSON(e,i.content),a,l)};Ae.maxOpen=function(e,i){i===void 0&&(i=!0);for(var a=0,l=0,u=e.firstChild;u&&!u.isLeaf&&(i||!u.type.spec.isolating);u=u.firstChild)a++;for(var f=e.lastChild;f&&!f.isLeaf&&(i||!f.type.spec.isolating);f=f.lastChild)l++;return new Ae(e,a,l)};Object.defineProperties(Ae.prototype,Jb);function zb(o,e,i){var a=o.findIndex(e),l=a.index,u=a.offset,f=o.maybeChild(l),g=o.findIndex(i),_=g.index,I=g.offset;if(u==e||f.isText){if(I!=i&&!o.child(_).isText)throw new RangeError("Removing non-flat range");return o.cut(0,e).append(o.cut(i))}if(l!=_)throw new RangeError("Removing non-flat range");return o.replaceChild(l,f.copy(zb(f.content,e-u-1,i-u-1)))}function Xb(o,e,i,a){var l=o.findIndex(e),u=l.index,f=l.offset,g=o.maybeChild(u);if(f==e||g.isText)return a&&!a.canReplace(u,u,i)?null:o.cut(0,e).append(i).append(o.cut(e));var _=Xb(g.content,e-f-1,i);return _&&o.replaceChild(u,g.copy(_))}Ae.empty=new Ae(jt.empty,0,0);function q4(o,e,i){if(i.openStart>o.depth)throw new Ys("Inserted content deeper than insertion position");if(o.depth-i.openStart!=e.depth-i.openEnd)throw new Ys("Inconsistent open depths");return Zb(o,e,i,0)}function Zb(o,e,i,a){var l=o.index(a),u=o.node(a);if(l==e.index(a)&&a<o.depth-i.openStart){var f=Zb(o,e,i,a+1);return u.copy(u.content.replaceChild(l,f))}else if(i.content.size)if(!i.openStart&&!i.openEnd&&o.depth==a&&e.depth==a){var g=o.parent,_=g.content;return jc(g,_.cut(0,o.parentOffset).append(i.content).append(_.cut(e.parentOffset)))}else{var I=J4(i,o),T=I.start,N=I.end;return jc(u,tN(o,T,N,e,a))}else return jc(u,Bf(o,e,a))}function $b(o,e){if(!e.type.compatibleContent(o.type))throw new Ys("Cannot join "+e.type.name+" onto "+o.type.name)}function l_(o,e,i){var a=o.node(i);return $b(a,e.node(i)),a}function Gc(o,e){var i=e.length-1;i>=0&&o.isText&&o.sameMarkup(e[i])?e[i]=o.withText(e[i].text+o.text):e.push(o)}function Xu(o,e,i,a){var l=(e||o).node(i),u=0,f=e?e.index(i):l.childCount;o&&(u=o.index(i),o.depth>i?u++:o.textOffset&&(Gc(o.nodeAfter,a),u++));for(var g=u;g<f;g++)Gc(l.child(g),a);e&&e.depth==i&&e.textOffset&&Gc(e.nodeBefore,a)}function jc(o,e){if(!o.type.validContent(e))throw new Ys("Invalid content for node "+o.type.name);return o.copy(e)}function tN(o,e,i,a,l){var u=o.depth>l&&l_(o,e,l+1),f=a.depth>l&&l_(i,a,l+1),g=[];return Xu(null,o,l,g),u&&f&&e.index(l)==i.index(l)?($b(u,f),Gc(jc(u,tN(o,e,i,a,l+1)),g)):(u&&Gc(jc(u,Bf(o,e,l+1)),g),Xu(e,i,l,g),f&&Gc(jc(f,Bf(i,a,l+1)),g)),Xu(a,null,l,g),new jt(g)}function Bf(o,e,i){var a=[];if(Xu(null,o,i,a),o.depth>i){var l=l_(o,e,i+1);Gc(jc(l,Bf(o,e,i+1)),a)}return Xu(e,null,i,a),new jt(a)}function J4(o,e){for(var i=e.depth-o.openStart,a=e.node(i),l=a.copy(o.content),u=i-1;u>=0;u--)l=e.node(u).copy(jt.from(l));return{start:l.resolveNoCache(o.openStart+i),end:l.resolveNoCache(l.content.size-o.openEnd-i)}}var cn=function(e,i,a){this.pos=e,this.path=i,this.depth=i.length/3-1,this.parentOffset=a},ld={parent:{configurable:!0},doc:{configurable:!0},textOffset:{configurable:!0},nodeAfter:{configurable:!0},nodeBefore:{configurable:!0}};cn.prototype.resolveDepth=function(e){return e==null?this.depth:e<0?this.depth+e:e};ld.parent.get=function(){return this.node(this.depth)};ld.doc.get=function(){return this.node(0)};cn.prototype.node=function(e){return this.path[this.resolveDepth(e)*3]};cn.prototype.index=function(e){return this.path[this.resolveDepth(e)*3+1]};cn.prototype.indexAfter=function(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)};cn.prototype.start=function(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1};cn.prototype.end=function(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size};cn.prototype.before=function(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]};cn.prototype.after=function(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize};ld.textOffset.get=function(){return this.pos-this.path[this.path.length-1]};ld.nodeAfter.get=function(){var o=this.parent,e=this.index(this.depth);if(e==o.childCount)return null;var i=this.pos-this.path[this.path.length-1],a=o.child(e);return i?o.child(e).cut(i):a};ld.nodeBefore.get=function(){var o=this.index(this.depth),e=this.pos-this.path[this.path.length-1];return e?this.parent.child(o).cut(0,e):o==0?null:this.parent.child(o-1)};cn.prototype.posAtIndex=function(e,i){i=this.resolveDepth(i);for(var a=this.path[i*3],l=i==0?0:this.path[i*3-1]+1,u=0;u<e;u++)l+=a.child(u).nodeSize;return l};cn.prototype.marks=function(){var e=this.parent,i=this.index();if(e.content.size==0)return gr.none;if(this.textOffset)return e.child(i).marks;var a=e.maybeChild(i-1),l=e.maybeChild(i);if(!a){var u=a;a=l,l=u}for(var f=a.marks,g=0;g<f.length;g++)f[g].type.spec.inclusive===!1&&(!l||!f[g].isInSet(l.marks))&&(f=f[g--].removeFromSet(f));return f};cn.prototype.marksAcross=function(e){var i=this.parent.maybeChild(this.index());if(!i||!i.isInline)return null;for(var a=i.marks,l=e.parent.maybeChild(e.index()),u=0;u<a.length;u++)a[u].type.spec.inclusive===!1&&(!l||!a[u].isInSet(l.marks))&&(a=a[u--].removeFromSet(a));return a};cn.prototype.sharedDepth=function(e){for(var i=this.depth;i>0;i--)if(this.start(i)<=e&&this.end(i)>=e)return i;return 0};cn.prototype.blockRange=function(e,i){if(e===void 0&&(e=this),e.pos<this.pos)return e.blockRange(this);for(var a=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);a>=0;a--)if(e.pos<=this.end(a)&&(!i||i(this.node(a))))return new eN(this,e,a)};cn.prototype.sameParent=function(e){return this.pos-this.parentOffset==e.pos-e.parentOffset};cn.prototype.max=function(e){return e.pos>this.pos?e:this};cn.prototype.min=function(e){return e.pos<this.pos?e:this};cn.prototype.toString=function(){for(var e="",i=1;i<=this.depth;i++)e+=(e?"/":"")+this.node(i).type.name+"_"+this.index(i-1);return e+":"+this.parentOffset};cn.resolve=function(e,i){if(!(i>=0&&i<=e.content.size))throw new RangeError("Position "+i+" out of range");for(var a=[],l=0,u=i,f=e;;){var g=f.content.findIndex(u),_=g.index,I=g.offset,T=u-I;if(a.push(f,_,l+I),!T||(f=f.child(_),f.isText))break;u=T-1,l+=I+1}return new cn(i,a,u)};cn.resolveCached=function(e,i){for(var a=0;a<d_.length;a++){var l=d_[a];if(l.pos==i&&l.doc==e)return l}var u=d_[u_]=cn.resolve(e,i);return u_=(u_+1)%z4,u};Object.defineProperties(cn.prototype,ld);var d_=[],u_=0,z4=12,eN=function(e,i,a){this.$from=e,this.$to=i,this.depth=a},dd={start:{configurable:!0},end:{configurable:!0},parent:{configurable:!0},startIndex:{configurable:!0},endIndex:{configurable:!0}};dd.start.get=function(){return this.$from.before(this.depth+1)};dd.end.get=function(){return this.$to.after(this.depth+1)};dd.parent.get=function(){return this.$from.node(this.depth)};dd.startIndex.get=function(){return this.$from.index(this.depth)};dd.endIndex.get=function(){return this.$to.indexAfter(this.depth)};Object.defineProperties(eN.prototype,dd);var X4=Object.create(null),mr=function(e,i,a,l){this.type=e,this.attrs=i,this.content=a||jt.empty,this.marks=l||gr.none},Oo={nodeSize:{configurable:!0},childCount:{configurable:!0},textContent:{configurable:!0},firstChild:{configurable:!0},lastChild:{configurable:!0},isBlock:{configurable:!0},isTextblock:{configurable:!0},inlineContent:{configurable:!0},isInline:{configurable:!0},isText:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};Oo.nodeSize.get=function(){return this.isLeaf?1:2+this.content.size};Oo.childCount.get=function(){return this.content.childCount};mr.prototype.child=function(e){return this.content.child(e)};mr.prototype.maybeChild=function(e){return this.content.maybeChild(e)};mr.prototype.forEach=function(e){this.content.forEach(e)};mr.prototype.nodesBetween=function(e,i,a,l){l===void 0&&(l=0),this.content.nodesBetween(e,i,a,l,this)};mr.prototype.descendants=function(e){this.nodesBetween(0,this.content.size,e)};Oo.textContent.get=function(){return this.textBetween(0,this.content.size,"")};mr.prototype.textBetween=function(e,i,a,l){return this.content.textBetween(e,i,a,l)};Oo.firstChild.get=function(){return this.content.firstChild};Oo.lastChild.get=function(){return this.content.lastChild};mr.prototype.eq=function(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)};mr.prototype.sameMarkup=function(e){return this.hasMarkup(e.type,e.attrs,e.marks)};mr.prototype.hasMarkup=function(e,i,a){return this.type==e&&Pf(this.attrs,i||e.defaultAttrs||X4)&&gr.sameSet(this.marks,a||gr.none)};mr.prototype.copy=function(e){return e===void 0&&(e=null),e==this.content?this:new this.constructor(this.type,this.attrs,e,this.marks)};mr.prototype.mark=function(e){return e==this.marks?this:new this.constructor(this.type,this.attrs,this.content,e)};mr.prototype.cut=function(e,i){return e==0&&i==this.content.size?this:this.copy(this.content.cut(e,i))};mr.prototype.slice=function(e,i,a){if(i===void 0&&(i=this.content.size),a===void 0&&(a=!1),e==i)return Ae.empty;var l=this.resolve(e),u=this.resolve(i),f=a?0:l.sharedDepth(i),g=l.start(f),_=l.node(f),I=_.content.cut(l.pos-g,u.pos-g);return new Ae(I,l.depth-f,u.depth-f)};mr.prototype.replace=function(e,i,a){return q4(this.resolve(e),this.resolve(i),a)};mr.prototype.nodeAt=function(e){for(var i=this;;){var a=i.content.findIndex(e),l=a.index,u=a.offset;if(i=i.maybeChild(l),!i)return null;if(u==e||i.isText)return i;e-=u+1}};mr.prototype.childAfter=function(e){var i=this.content.findIndex(e),a=i.index,l=i.offset;return{node:this.content.maybeChild(a),index:a,offset:l}};mr.prototype.childBefore=function(e){if(e==0)return{node:null,index:0,offset:0};var i=this.content.findIndex(e),a=i.index,l=i.offset;if(l<e)return{node:this.content.child(a),index:a,offset:l};var u=this.content.child(a-1);return{node:u,index:a-1,offset:l-u.nodeSize}};mr.prototype.resolve=function(e){return cn.resolveCached(this,e)};mr.prototype.resolveNoCache=function(e){return cn.resolve(this,e)};mr.prototype.rangeHasMark=function(e,i,a){var l=!1;return i>e&&this.nodesBetween(e,i,function(u){return a.isInSet(u.marks)&&(l=!0),!l}),l};Oo.isBlock.get=function(){return this.type.isBlock};Oo.isTextblock.get=function(){return this.type.isTextblock};Oo.inlineContent.get=function(){return this.type.inlineContent};Oo.isInline.get=function(){return this.type.isInline};Oo.isText.get=function(){return this.type.isText};Oo.isLeaf.get=function(){return this.type.isLeaf};Oo.isAtom.get=function(){return this.type.isAtom};mr.prototype.toString=function(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);var e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),Z4(this.marks,e)};mr.prototype.contentMatchAt=function(e){var i=this.type.contentMatch.matchFragment(this.content,0,e);if(!i)throw new Error("Called contentMatchAt on a node with invalid content");return i};mr.prototype.canReplace=function(e,i,a,l,u){a===void 0&&(a=jt.empty),l===void 0&&(l=0),u===void 0&&(u=a.childCount);var f=this.contentMatchAt(e).matchFragment(a,l,u),g=f&&f.matchFragment(this.content,i);if(!g||!g.validEnd)return!1;for(var _=l;_<u;_++)if(!this.type.allowsMarks(a.child(_).marks))return!1;return!0};mr.prototype.canReplaceWith=function(e,i,a,l){if(l&&!this.type.allowsMarks(l))return!1;var u=this.contentMatchAt(e).matchType(a),f=u&&u.matchFragment(this.content,i);return f?f.validEnd:!1};mr.prototype.canAppend=function(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)};mr.prototype.check=function(){if(!this.type.validContent(this.content))throw new RangeError("Invalid content for node "+this.type.name+": "+this.content.toString().slice(0,50));for(var e=gr.none,i=0;i<this.marks.length;i++)e=this.marks[i].addToSet(e);if(!gr.sameSet(e,this.marks))throw new RangeError("Invalid collection of marks for node "+this.type.name+": "+this.marks.map(function(a){return a.type.name}));this.content.forEach(function(a){return a.check()})};mr.prototype.toJSON=function(){var e={type:this.type.name};for(var i in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(function(a){return a.toJSON()})),e};mr.fromJSON=function(e,i){if(!i)throw new RangeError("Invalid input for Node.fromJSON");var a=null;if(i.marks){if(!Array.isArray(i.marks))throw new RangeError("Invalid mark data for Node.fromJSON");a=i.marks.map(e.markFromJSON)}if(i.type=="text"){if(typeof i.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(i.text,a)}var l=jt.fromJSON(e,i.content);return e.nodeType(i.type).create(i.attrs,l,a)};Object.defineProperties(mr.prototype,Oo);function Z4(o,e){for(var i=o.length-1;i>=0;i--)e=o[i].type.name+"("+e+")";return e}var Yi=function(e){this.validEnd=e,this.next=[],this.wrapCache=[]},Uf={inlineContent:{configurable:!0},defaultType:{configurable:!0},edgeCount:{configurable:!0}};Yi.parse=function(e,i){var a=new xf(e,i);if(a.next==null)return Yi.empty;var l=nN(a);a.next&&a.err("Unexpected trailing text");var u=oV(iV(l));return sV(u,a),u};Yi.prototype.matchType=function(e){for(var i=0;i<this.next.length;i+=2)if(this.next[i]==e)return this.next[i+1];return null};Yi.prototype.matchFragment=function(e,i,a){i===void 0&&(i=0),a===void 0&&(a=e.childCount);for(var l=this,u=i;l&&u<a;u++)l=l.matchType(e.child(u).type);return l};Uf.inlineContent.get=function(){var o=this.next[0];return o?o.isInline:!1};Uf.defaultType.get=function(){for(var o=0;o<this.next.length;o+=2){var e=this.next[o];if(!(e.isText||e.hasRequiredAttrs()))return e}};Yi.prototype.compatible=function(e){for(var i=0;i<this.next.length;i+=2)for(var a=0;a<e.next.length;a+=2)if(this.next[i]==e.next[a])return!0;return!1};Yi.prototype.fillBefore=function(e,i,a){i===void 0&&(i=!1),a===void 0&&(a=0);var l=[this];function u(f,g){var _=f.matchFragment(e,a);if(_&&(!i||_.validEnd))return jt.from(g.map(function(F){return F.createAndFill()}));for(var I=0;I<f.next.length;I+=2){var T=f.next[I],N=f.next[I+1];if(!(T.isText||T.hasRequiredAttrs())&&l.indexOf(N)==-1){l.push(N);var D=u(N,g.concat(T));if(D)return D}}}return u(this,[])};Yi.prototype.findWrapping=function(e){for(var i=0;i<this.wrapCache.length;i+=2)if(this.wrapCache[i]==e)return this.wrapCache[i+1];var a=this.computeWrapping(e);return this.wrapCache.push(e,a),a};Yi.prototype.computeWrapping=function(e){for(var i=Object.create(null),a=[{match:this,type:null,via:null}];a.length;){var l=a.shift(),u=l.match;if(u.matchType(e)){for(var f=[],g=l;g.type;g=g.via)f.push(g.type);return f.reverse()}for(var _=0;_<u.next.length;_+=2){var I=u.next[_];!I.isLeaf&&!I.hasRequiredAttrs()&&!(I.name in i)&&(!l.type||u.next[_+1].validEnd)&&(a.push({match:I.contentMatch,type:I,via:l}),i[I.name]=!0)}}};Uf.edgeCount.get=function(){return this.next.length>>1};Yi.prototype.edge=function(e){var i=e<<1;if(i>=this.next.length)throw new RangeError("There's no "+e+"th edge in this content match");return{type:this.next[i],next:this.next[i+1]}};Yi.prototype.toString=function(){var e=[];function i(a){e.push(a);for(var l=1;l<a.next.length;l+=2)e.indexOf(a.next[l])==-1&&i(a.next[l])}return i(this),e.map(function(a,l){for(var u=l+(a.validEnd?"*":" ")+" ",f=0;f<a.next.length;f+=2)u+=(f?", ":"")+a.next[f].name+"->"+e.indexOf(a.next[f+1]);return u}).join(`
`)};Object.defineProperties(Yi.prototype,Uf);Yi.empty=new Yi(!0);var xf=function(e,i){this.string=e,this.nodeTypes=i,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()},rN={next:{configurable:!0}};rN.next.get=function(){return this.tokens[this.pos]};xf.prototype.eat=function(e){return this.next==e&&(this.pos++||!0)};xf.prototype.err=function(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")};Object.defineProperties(xf.prototype,rN);function nN(o){var e=[];do e.push($4(o));while(o.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function $4(o){var e=[];do e.push(tV(o));while(o.next&&o.next!=")"&&o.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function tV(o){for(var e=nV(o);;)if(o.eat("+"))e={type:"plus",expr:e};else if(o.eat("*"))e={type:"star",expr:e};else if(o.eat("?"))e={type:"opt",expr:e};else if(o.eat("{"))e=eV(o,e);else break;return e}function iN(o){/\D/.test(o.next)&&o.err("Expected number, got '"+o.next+"'");var e=Number(o.next);return o.pos++,e}function eV(o,e){var i=iN(o),a=i;return o.eat(",")&&(o.next!="}"?a=iN(o):a=-1),o.eat("}")||o.err("Unclosed braced range"),{type:"range",min:i,max:a,expr:e}}function rV(o,e){var i=o.nodeTypes,a=i[e];if(a)return[a];var l=[];for(var u in i){var f=i[u];f.groups.indexOf(e)>-1&&l.push(f)}return l.length==0&&o.err("No node type or group '"+e+"' found"),l}function nV(o){if(o.eat("(")){var e=nN(o);return o.eat(")")||o.err("Missing closing paren"),e}else if(/\W/.test(o.next))o.err("Unexpected token '"+o.next+"'");else{var i=rV(o,o.next).map(function(a){return o.inline==null?o.inline=a.isInline:o.inline!=a.isInline&&o.err("Mixing inline and block content"),{type:"name",value:a}});return o.pos++,i.length==1?i[0]:{type:"choice",exprs:i}}}function iV(o){var e=[[]];return l(u(o,0),i()),e;function i(){return e.push([])-1}function a(f,g,_){var I={term:_,to:g};return e[f].push(I),I}function l(f,g){f.forEach(function(_){return _.to=g})}function u(f,g){if(f.type=="choice")return f.exprs.reduce(function(it,z){return it.concat(u(z,g))},[]);if(f.type=="seq")for(var _=0;;_++){var I=u(f.exprs[_],g);if(_==f.exprs.length-1)return I;l(I,g=i())}else if(f.type=="star"){var T=i();return a(g,T),l(u(f.expr,T),T),[a(T)]}else if(f.type=="plus"){var N=i();return l(u(f.expr,g),N),l(u(f.expr,N),N),[a(N)]}else{if(f.type=="opt")return[a(g)].concat(u(f.expr,g));if(f.type=="range"){for(var D=g,F=0;F<f.min;F++){var K=i();l(u(f.expr,D),K),D=K}if(f.max==-1)l(u(f.expr,D),D);else for(var J=f.min;J<f.max;J++){var nt=i();a(D,nt),l(u(f.expr,D),nt),D=nt}return[a(D)]}else if(f.type=="name")return[a(g,null,f.value)]}}}function oN(o,e){return e-o}function sN(o,e){var i=[];return a(e),i.sort(oN);function a(l){var u=o[l];if(u.length==1&&!u[0].term)return a(u[0].to);i.push(l);for(var f=0;f<u.length;f++){var g=u[f],_=g.term,I=g.to;!_&&i.indexOf(I)==-1&&a(I)}}}function oV(o){var e=Object.create(null);return i(sN(o,0));function i(a){var l=[];a.forEach(function(_){o[_].forEach(function(I){var T=I.term,N=I.to;if(!!T){var D=l.indexOf(T),F=D>-1&&l[D+1];sN(o,N).forEach(function(K){F||l.push(T,F=[]),F.indexOf(K)==-1&&F.push(K)})}})});for(var u=e[a.join(",")]=new Yi(a.indexOf(o.length-1)>-1),f=0;f<l.length;f+=2){var g=l[f+1].sort(oN);u.next.push(l[f],e[g.join(",")]||i(g))}return u}}function sV(o,e){for(var i=0,a=[o];i<a.length;i++){for(var l=a[i],u=!l.validEnd,f=[],g=0;g<l.next.length;g+=2){var _=l.next[g],I=l.next[g+1];f.push(_.name),u&&!(_.isText||_.hasRequiredAttrs())&&(u=!1),a.indexOf(I)==-1&&a.push(I)}u&&e.err("Only non-generatable nodes ("+f.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function aN(o){var e=Object.create(null);for(var i in o){var a=o[i];if(!a.hasDefault)return null;e[i]=a.default}return e}function cN(o,e){var i=Object.create(null);for(var a in o){var l=e&&e[a];if(l===void 0){var u=o[a];if(u.hasDefault)l=u.default;else throw new RangeError("No value supplied for attribute "+a)}i[a]=l}return i}function lN(o){var e=Object.create(null);if(o)for(var i in o)e[i]=new dN(o[i]);return e}var ko=function(e,i,a){this.name=e,this.schema=i,this.spec=a,this.groups=a.group?a.group.split(" "):[],this.attrs=lN(a.attrs),this.defaultAttrs=aN(this.attrs),this.contentMatch=null,this.markSet=null,this.inlineContent=null,this.isBlock=!(a.inline||e=="text"),this.isText=e=="text"},Zu={isInline:{configurable:!0},isTextblock:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};Zu.isInline.get=function(){return!this.isBlock};Zu.isTextblock.get=function(){return this.isBlock&&this.inlineContent};Zu.isLeaf.get=function(){return this.contentMatch==Yi.empty};Zu.isAtom.get=function(){return this.isLeaf||this.spec.atom};ko.prototype.hasRequiredAttrs=function(){for(var e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1};ko.prototype.compatibleContent=function(e){return this==e||this.contentMatch.compatible(e.contentMatch)};ko.prototype.computeAttrs=function(e){return!e&&this.defaultAttrs?this.defaultAttrs:cN(this.attrs,e)};ko.prototype.create=function(e,i,a){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new mr(this,this.computeAttrs(e),jt.from(i),gr.setFrom(a))};ko.prototype.createChecked=function(e,i,a){if(i=jt.from(i),!this.validContent(i))throw new RangeError("Invalid content for node "+this.name);return new mr(this,this.computeAttrs(e),i,gr.setFrom(a))};ko.prototype.createAndFill=function(e,i,a){if(e=this.computeAttrs(e),i=jt.from(i),i.size){var l=this.contentMatch.fillBefore(i);if(!l)return null;i=l.append(i)}var u=this.contentMatch.matchFragment(i).fillBefore(jt.empty,!0);return u?new mr(this,e,i.append(u),gr.setFrom(a)):null};ko.prototype.validContent=function(e){var i=this.contentMatch.matchFragment(e);if(!i||!i.validEnd)return!1;for(var a=0;a<e.childCount;a++)if(!this.allowsMarks(e.child(a).marks))return!1;return!0};ko.prototype.allowsMarkType=function(e){return this.markSet==null||this.markSet.indexOf(e)>-1};ko.prototype.allowsMarks=function(e){if(this.markSet==null)return!0;for(var i=0;i<e.length;i++)if(!this.allowsMarkType(e[i].type))return!1;return!0};ko.prototype.allowedMarks=function(e){if(this.markSet==null)return e;for(var i,a=0;a<e.length;a++)this.allowsMarkType(e[a].type)?i&&i.push(e[a]):i||(i=e.slice(0,a));return i?i.length?i:gr.empty:e};ko.compile=function(e,i){var a=Object.create(null);e.forEach(function(f,g){return a[f]=new ko(f,i,g)});var l=i.spec.topNode||"doc";if(!a[l])throw new RangeError("Schema is missing its top node type ('"+l+"')");if(!a.text)throw new RangeError("Every schema needs a 'text' type");for(var u in a.text.attrs)throw new RangeError("The text node type should not have attributes");return a};Object.defineProperties(ko.prototype,Zu);var dN=function(e){this.hasDefault=Object.prototype.hasOwnProperty.call(e,"default"),this.default=e.default},uN={isRequired:{configurable:!0}};uN.isRequired.get=function(){return!this.hasDefault};Object.defineProperties(dN.prototype,uN);var Wc=function(e,i,a,l){this.name=e,this.schema=a,this.spec=l,this.attrs=lN(l.attrs),this.rank=i,this.excluded=null;var u=aN(this.attrs);this.instance=u&&new gr(this,u)};Wc.prototype.create=function(e){return!e&&this.instance?this.instance:new gr(this,cN(this.attrs,e))};Wc.compile=function(e,i){var a=Object.create(null),l=0;return e.forEach(function(u,f){return a[u]=new Wc(u,l++,i,f)}),a};Wc.prototype.removeFromSet=function(e){for(var i=0;i<e.length;i++)e[i].type==this&&(e=e.slice(0,i).concat(e.slice(i+1)),i--);return e};Wc.prototype.isInSet=function(e){for(var i=0;i<e.length;i++)if(e[i].type==this)return e[i]};Wc.prototype.excludes=function(e){return this.excluded.indexOf(e)>-1};var h_={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},aV={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},hN={ol:!0,ul:!0},p_=1,f_=2,$u=4;function pN(o){return(o?p_:0)|(o==="full"?f_:0)}var Na=function(e,i,a,l,u,f,g){this.type=e,this.attrs=i,this.solid=u,this.match=f||(g&$u?null:e.contentMatch),this.options=g,this.content=[],this.marks=a,this.activeMarks=gr.none,this.pendingMarks=l,this.stashMarks=[]};Na.prototype.findWrapping=function(e){if(!this.match){if(!this.type)return[];var i=this.type.contentMatch.fillBefore(jt.from(e));if(i)this.match=this.type.contentMatch.matchFragment(i);else{var a=this.type.contentMatch,l;return(l=a.findWrapping(e.type))?(this.match=a,l):null}}return this.match.findWrapping(e.type)};Na.prototype.finish=function(e){if(!(this.options&p_)){var i=this.content[this.content.length-1],a;i&&i.isText&&(a=/[ \t\r\n\u000c]+$/.exec(i.text))&&(i.text.length==a[0].length?this.content.pop():this.content[this.content.length-1]=i.withText(i.text.slice(0,i.text.length-a[0].length)))}var l=jt.from(this.content);return!e&&this.match&&(l=l.append(this.match.fillBefore(jt.empty,!0))),this.type?this.type.create(this.attrs,l,this.marks):l};Na.prototype.popFromStashMark=function(e){for(var i=this.stashMarks.length-1;i>=0;i--)if(e.eq(this.stashMarks[i]))return this.stashMarks.splice(i,1)[0]};Na.prototype.applyPending=function(e){for(var i=0,a=this.pendingMarks;i<a.length;i++){var l=a[i];(this.type?this.type.allowsMarkType(l.type):dV(l.type,e))&&!l.isInSet(this.activeMarks)&&(this.activeMarks=l.addToSet(this.activeMarks),this.pendingMarks=l.removeFromSet(this.pendingMarks))}};Na.prototype.inlineContext=function(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!h_.hasOwnProperty(e.parentNode.nodeName.toLowerCase())};var ln=function(e,i,a){this.parser=e,this.options=i,this.isOpen=a;var l=i.topNode,u,f=pN(i.preserveWhitespace)|(a?$u:0);l?u=new Na(l.type,l.attrs,gr.none,gr.none,!0,i.topMatch||l.type.contentMatch,f):a?u=new Na(null,null,gr.none,gr.none,!0,null,f):u=new Na(e.schema.topNodeType,null,gr.none,gr.none,!0,null,f),this.nodes=[u],this.open=0,this.find=i.findPositions,this.needsBlock=!1},A_={top:{configurable:!0},currentPos:{configurable:!0}};A_.top.get=function(){return this.nodes[this.open]};ln.prototype.addDOM=function(e){if(e.nodeType==3)this.addTextNode(e);else if(e.nodeType==1){var i=e.getAttribute("style"),a=i?this.readStyles(lV(i)):null,l=this.top;if(a!=null)for(var u=0;u<a.length;u++)this.addPendingMark(a[u]);if(this.addElement(e),a!=null)for(var f=0;f<a.length;f++)this.removePendingMark(a[f],l)}};ln.prototype.addTextNode=function(e){var i=e.nodeValue,a=this.top;if(a.options&f_||a.inlineContext(e)||/[^ \t\r\n\u000c]/.test(i)){if(a.options&p_)a.options&f_?i=i.replace(/\r\n?/g,`
`):i=i.replace(/\r?\n|\r/g," ");else if(i=i.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(i)&&this.open==this.nodes.length-1){var l=a.content[a.content.length-1],u=e.previousSibling;(!l||u&&u.nodeName=="BR"||l.isText&&/[ \t\r\n\u000c]$/.test(l.text))&&(i=i.slice(1))}i&&this.insertNode(this.parser.schema.text(i)),this.findInText(e)}else this.findInside(e)};ln.prototype.addElement=function(e,i){var a=e.nodeName.toLowerCase(),l;hN.hasOwnProperty(a)&&this.parser.normalizeLists&&cV(e);var u=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(l=this.parser.matchTag(e,this,i));if(u?u.ignore:aV.hasOwnProperty(a))this.findInside(e),this.ignoreFallback(e);else if(!u||u.skip||u.closeParent){u&&u.closeParent?this.open=Math.max(0,this.open-1):u&&u.skip.nodeType&&(e=u.skip);var f,g=this.top,_=this.needsBlock;if(h_.hasOwnProperty(a))f=!0,g.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e);return}this.addAll(e),f&&this.sync(g),this.needsBlock=_}else this.addElementByRule(e,u,u.consuming===!1?l:null)};ln.prototype.leafFallback=function(e){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`))};ln.prototype.ignoreFallback=function(e){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"))};ln.prototype.readStyles=function(e){var i=gr.none;t:for(var a=0;a<e.length;a+=2)for(var l=null;;){var u=this.parser.matchStyle(e[a],e[a+1],this,l);if(!u)continue t;if(u.ignore)return null;if(i=this.parser.schema.marks[u.mark].create(u.attrs).addToSet(i),u.consuming===!1)l=u;else break}return i};ln.prototype.addElementByRule=function(e,i,a){var l=this,u,f,g,_;i.node?(f=this.parser.schema.nodes[i.node],f.isLeaf?this.insertNode(f.create(i.attrs))||this.leafFallback(e):u=this.enter(f,i.attrs,i.preserveWhitespace)):(g=this.parser.schema.marks[i.mark],_=g.create(i.attrs),this.addPendingMark(_));var I=this.top;if(f&&f.isLeaf)this.findInside(e);else if(a)this.addElement(e,a);else if(i.getContent)this.findInside(e),i.getContent(e,this.parser.schema).forEach(function(N){return l.insertNode(N)});else{var T=i.contentElement;typeof T=="string"?T=e.querySelector(T):typeof T=="function"&&(T=T(e)),T||(T=e),this.findAround(e,T,!0),this.addAll(T,u)}u&&(this.sync(I),this.open--),_&&this.removePendingMark(_,I)};ln.prototype.addAll=function(e,i,a,l){for(var u=a||0,f=a?e.childNodes[a]:e.firstChild,g=l==null?null:e.childNodes[l];f!=g;f=f.nextSibling,++u)this.findAtPoint(e,u),this.addDOM(f),i&&h_.hasOwnProperty(f.nodeName.toLowerCase())&&this.sync(i);this.findAtPoint(e,u)};ln.prototype.findPlace=function(e){for(var i,a,l=this.open;l>=0;l--){var u=this.nodes[l],f=u.findWrapping(e);if(f&&(!i||i.length>f.length)&&(i=f,a=u,!f.length)||u.solid)break}if(!i)return!1;this.sync(a);for(var g=0;g<i.length;g++)this.enterInner(i[g],null,!1);return!0};ln.prototype.insertNode=function(e){if(e.isInline&&this.needsBlock&&!this.top.type){var i=this.textblockFromContext();i&&this.enterInner(i)}if(this.findPlace(e)){this.closeExtra();var a=this.top;a.applyPending(e.type),a.match&&(a.match=a.match.matchType(e.type));for(var l=a.activeMarks,u=0;u<e.marks.length;u++)(!a.type||a.type.allowsMarkType(e.marks[u].type))&&(l=e.marks[u].addToSet(l));return a.content.push(e.mark(l)),!0}return!1};ln.prototype.enter=function(e,i,a){var l=this.findPlace(e.create(i));return l&&this.enterInner(e,i,!0,a),l};ln.prototype.enterInner=function(e,i,a,l){this.closeExtra();var u=this.top;u.applyPending(e),u.match=u.match&&u.match.matchType(e,i);var f=l==null?u.options&~$u:pN(l);u.options&$u&&u.content.length==0&&(f|=$u),this.nodes.push(new Na(e,i,u.activeMarks,u.pendingMarks,a,null,f)),this.open++};ln.prototype.closeExtra=function(e){var i=this.nodes.length-1;if(i>this.open){for(;i>this.open;i--)this.nodes[i-1].content.push(this.nodes[i].finish(e));this.nodes.length=this.open+1}};ln.prototype.finish=function(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)};ln.prototype.sync=function(e){for(var i=this.open;i>=0;i--)if(this.nodes[i]==e){this.open=i;return}};A_.currentPos.get=function(){this.closeExtra();for(var o=0,e=this.open;e>=0;e--){for(var i=this.nodes[e].content,a=i.length-1;a>=0;a--)o+=i[a].nodeSize;e&&o++}return o};ln.prototype.findAtPoint=function(e,i){if(this.find)for(var a=0;a<this.find.length;a++)this.find[a].node==e&&this.find[a].offset==i&&(this.find[a].pos=this.currentPos)};ln.prototype.findInside=function(e){if(this.find)for(var i=0;i<this.find.length;i++)this.find[i].pos==null&&e.nodeType==1&&e.contains(this.find[i].node)&&(this.find[i].pos=this.currentPos)};ln.prototype.findAround=function(e,i,a){if(e!=i&&this.find){for(var l=0;l<this.find.length;l++)if(this.find[l].pos==null&&e.nodeType==1&&e.contains(this.find[l].node)){var u=i.compareDocumentPosition(this.find[l].node);u&(a?2:4)&&(this.find[l].pos=this.currentPos)}}};ln.prototype.findInText=function(e){if(this.find)for(var i=0;i<this.find.length;i++)this.find[i].node==e&&(this.find[i].pos=this.currentPos-(e.nodeValue.length-this.find[i].offset))};ln.prototype.matchesContext=function(e){var i=this;if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);var a=e.split("/"),l=this.options.context,u=!this.isOpen&&(!l||l.parent.type==this.nodes[0].type),f=-(l?l.depth+1:0)+(u?0:1),g=function(_,I){for(;_>=0;_--){var T=a[_];if(T==""){if(_==a.length-1||_==0)continue;for(;I>=f;I--)if(g(_-1,I))return!0;return!1}else{var N=I>0||I==0&&u?i.nodes[I].type:l&&I>=f?l.node(I-f).type:null;if(!N||N.name!=T&&N.groups.indexOf(T)==-1)return!1;I--}}return!0};return g(a.length-1,this.open)};ln.prototype.textblockFromContext=function(){var e=this.options.context;if(e)for(var i=e.depth;i>=0;i--){var a=e.node(i).contentMatchAt(e.indexAfter(i)).defaultType;if(a&&a.isTextblock&&a.defaultAttrs)return a}for(var l in this.parser.schema.nodes){var u=this.parser.schema.nodes[l];if(u.isTextblock&&u.defaultAttrs)return u}};ln.prototype.addPendingMark=function(e){var i=uV(e,this.top.pendingMarks);i&&this.top.stashMarks.push(i),this.top.pendingMarks=e.addToSet(this.top.pendingMarks)};ln.prototype.removePendingMark=function(e,i){for(var a=this.open;a>=0;a--){var l=this.nodes[a],u=l.pendingMarks.lastIndexOf(e);if(u>-1)l.pendingMarks=e.removeFromSet(l.pendingMarks);else{l.activeMarks=e.removeFromSet(l.activeMarks);var f=l.popFromStashMark(e);f&&l.type&&l.type.allowsMarkType(f.type)&&(l.activeMarks=f.addToSet(l.activeMarks))}if(l==i)break}};Object.defineProperties(ln.prototype,A_);function cV(o){for(var e=o.firstChild,i=null;e;e=e.nextSibling){var a=e.nodeType==1?e.nodeName.toLowerCase():null;a&&hN.hasOwnProperty(a)&&i?(i.appendChild(e),e=i):a=="li"?i=e:a&&(i=null)}}function lV(o){for(var e=/\s*([\w-]+)\s*:\s*([^;]+)/g,i,a=[];i=e.exec(o);)a.push(i[1],i[2].trim());return a}function dV(o,e){var i=e.schema.nodes,a=function(f){var g=i[f];if(!!g.allowsMarkType(o)){var _=[],I=function(T){_.push(T);for(var N=0;N<T.edgeCount;N++){var D=T.edge(N),F=D.type,K=D.next;if(F==e||_.indexOf(K)<0&&I(K))return!0}};if(I(g.contentMatch))return{v:!0}}};for(var l in i){var u=a(l);if(u)return u.v}}function uV(o,e){for(var i=0;i<e.length;i++)if(o.eq(e[i]))return e[i]}var fN=65535,AN=Math.pow(2,16);function hV(o,e){return o+e*AN}function gN(o){return o&fN}function pV(o){return(o-(o&fN))/AN}var g_=function(e,i,a){i===void 0&&(i=!1),a===void 0&&(a=null),this.pos=e,this.deleted=i,this.recover=a},gi=function(e,i){i===void 0&&(i=!1),this.ranges=e,this.inverted=i};gi.prototype.recover=function(e){var i=0,a=gN(e);if(!this.inverted)for(var l=0;l<a;l++)i+=this.ranges[l*3+2]-this.ranges[l*3+1];return this.ranges[a*3]+i+pV(e)};gi.prototype.mapResult=function(e,i){return i===void 0&&(i=1),this._map(e,i,!1)};gi.prototype.map=function(e,i){return i===void 0&&(i=1),this._map(e,i,!0)};gi.prototype._map=function(e,i,a){for(var l=0,u=this.inverted?2:1,f=this.inverted?1:2,g=0;g<this.ranges.length;g+=3){var _=this.ranges[g]-(this.inverted?l:0);if(_>e)break;var I=this.ranges[g+u],T=this.ranges[g+f],N=_+I;if(e<=N){var D=I?e==_?-1:e==N?1:i:i,F=_+l+(D<0?0:T);if(a)return F;var K=e==(i<0?_:N)?null:hV(g/3,e-_);return new g_(F,i<0?e!=_:e!=N,K)}l+=T-I}return a?e+l:new g_(e+l)};gi.prototype.touches=function(e,i){for(var a=0,l=gN(i),u=this.inverted?2:1,f=this.inverted?1:2,g=0;g<this.ranges.length;g+=3){var _=this.ranges[g]-(this.inverted?a:0);if(_>e)break;var I=this.ranges[g+u],T=_+I;if(e<=T&&g==l*3)return!0;a+=this.ranges[g+f]-I}return!1};gi.prototype.forEach=function(e){for(var i=this.inverted?2:1,a=this.inverted?1:2,l=0,u=0;l<this.ranges.length;l+=3){var f=this.ranges[l],g=f-(this.inverted?u:0),_=f+(this.inverted?0:u),I=this.ranges[l+i],T=this.ranges[l+a];e(g,g+I,_,_+T),u+=T-I}};gi.prototype.invert=function(){return new gi(this.ranges,!this.inverted)};gi.prototype.toString=function(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)};gi.offset=function(e){return e==0?gi.empty:new gi(e<0?[0,-e,0]:[0,0,e])};gi.empty=new gi([]);var qi=function(e,i,a,l){this.maps=e||[],this.from=a||0,this.to=l==null?this.maps.length:l,this.mirror=i};qi.prototype.slice=function(e,i){return e===void 0&&(e=0),i===void 0&&(i=this.maps.length),new qi(this.maps,this.mirror,e,i)};qi.prototype.copy=function(){return new qi(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)};qi.prototype.appendMap=function(e,i){this.to=this.maps.push(e),i!=null&&this.setMirror(this.maps.length-1,i)};qi.prototype.appendMapping=function(e){for(var i=0,a=this.maps.length;i<e.maps.length;i++){var l=e.getMirror(i);this.appendMap(e.maps[i],l!=null&&l<i?a+l:null)}};qi.prototype.getMirror=function(e){if(this.mirror){for(var i=0;i<this.mirror.length;i++)if(this.mirror[i]==e)return this.mirror[i+(i%2?-1:1)]}};qi.prototype.setMirror=function(e,i){this.mirror||(this.mirror=[]),this.mirror.push(e,i)};qi.prototype.appendMappingInverted=function(e){for(var i=e.maps.length-1,a=this.maps.length+e.maps.length;i>=0;i--){var l=e.getMirror(i);this.appendMap(e.maps[i].invert(),l!=null&&l>i?a-l-1:null)}};qi.prototype.invert=function(){var e=new qi;return e.appendMappingInverted(this),e};qi.prototype.map=function(e,i){if(i===void 0&&(i=1),this.mirror)return this._map(e,i,!0);for(var a=this.from;a<this.to;a++)e=this.maps[a].map(e,i);return e};qi.prototype.mapResult=function(e,i){return i===void 0&&(i=1),this._map(e,i,!1)};qi.prototype._map=function(e,i,a){for(var l=!1,u=this.from;u<this.to;u++){var f=this.maps[u],g=f.mapResult(e,i);if(g.recover!=null){var _=this.getMirror(u);if(_!=null&&_>u&&_<this.to){u=_,e=this.maps[_].recover(g.recover);continue}}g.deleted&&(l=!0),e=g.pos}return a?e:new g_(e,l)};function ud(o){var e=Error.call(this,o);return e.__proto__=ud.prototype,e}ud.prototype=Object.create(Error.prototype);ud.prototype.constructor=ud;ud.prototype.name="TransformError";var kn=function(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new qi},m_={before:{configurable:!0},docChanged:{configurable:!0}};m_.before.get=function(){return this.docs.length?this.docs[0]:this.doc};kn.prototype.step=function(e){var i=this.maybeStep(e);if(i.failed)throw new ud(i.failed);return this};kn.prototype.maybeStep=function(e){var i=e.apply(this.doc);return i.failed||this.addStep(e,i.doc),i};m_.docChanged.get=function(){return this.steps.length>0};kn.prototype.addStep=function(e,i){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=i};Object.defineProperties(kn.prototype,m_);function Ff(){throw new Error("Override me")}var E_=Object.create(null),Li=function(){};Li.prototype.apply=function(e){return Ff()};Li.prototype.getMap=function(){return gi.empty};Li.prototype.invert=function(e){return Ff()};Li.prototype.map=function(e){return Ff()};Li.prototype.merge=function(e){return null};Li.prototype.toJSON=function(){return Ff()};Li.fromJSON=function(e,i){if(!i||!i.stepType)throw new RangeError("Invalid input for Step.fromJSON");var a=E_[i.stepType];if(!a)throw new RangeError("No step type "+i.stepType+" defined");return a.fromJSON(e,i)};Li.jsonID=function(e,i){if(e in E_)throw new RangeError("Duplicate use of step JSON ID "+e);return E_[e]=i,i.prototype.jsonID=e,i};var Ji=function(e,i){this.doc=e,this.failed=i};Ji.ok=function(e){return new Ji(e,null)};Ji.fail=function(e){return new Ji(null,e)};Ji.fromReplace=function(e,i,a,l){try{return Ji.ok(e.replace(i,a,l))}catch(u){if(u instanceof Ys)return Ji.fail(u.message);throw u}};var ic=function(o){function e(i,a,l,u){o.call(this),this.from=i,this.to=a,this.slice=l,this.structure=!!u}return o&&(e.__proto__=o),e.prototype=Object.create(o&&o.prototype),e.prototype.constructor=e,e.prototype.apply=function(a){return this.structure&&__(a,this.from,this.to)?Ji.fail("Structure replace would overwrite content"):Ji.fromReplace(a,this.from,this.to,this.slice)},e.prototype.getMap=function(){return new gi([this.from,this.to-this.from,this.slice.size])},e.prototype.invert=function(a){return new e(this.from,this.from+this.slice.size,a.slice(this.from,this.to))},e.prototype.map=function(a){var l=a.mapResult(this.from,1),u=a.mapResult(this.to,-1);return l.deleted&&u.deleted?null:new e(l.pos,Math.max(l.pos,u.pos),this.slice)},e.prototype.merge=function(a){if(!(a instanceof e)||a.structure||this.structure)return null;if(this.from+this.slice.size==a.from&&!this.slice.openEnd&&!a.slice.openStart){var l=this.slice.size+a.slice.size==0?Ae.empty:new Ae(this.slice.content.append(a.slice.content),this.slice.openStart,a.slice.openEnd);return new e(this.from,this.to+(a.to-a.from),l,this.structure)}else if(a.to==this.from&&!this.slice.openStart&&!a.slice.openEnd){var u=this.slice.size+a.slice.size==0?Ae.empty:new Ae(a.slice.content.append(this.slice.content),a.slice.openStart,this.slice.openEnd);return new e(a.from,this.to,u,this.structure)}else return null},e.prototype.toJSON=function(){var a={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(a.slice=this.slice.toJSON()),this.structure&&(a.structure=!0),a},e.fromJSON=function(a,l){if(typeof l.from!="number"||typeof l.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new e(l.from,l.to,Ae.fromJSON(a,l.slice),!!l.structure)},e}(Li);Li.jsonID("replace",ic);var Kc=function(o){function e(i,a,l,u,f,g,_){o.call(this),this.from=i,this.to=a,this.gapFrom=l,this.gapTo=u,this.slice=f,this.insert=g,this.structure=!!_}return o&&(e.__proto__=o),e.prototype=Object.create(o&&o.prototype),e.prototype.constructor=e,e.prototype.apply=function(a){if(this.structure&&(__(a,this.from,this.gapFrom)||__(a,this.gapTo,this.to)))return Ji.fail("Structure gap-replace would overwrite content");var l=a.slice(this.gapFrom,this.gapTo);if(l.openStart||l.openEnd)return Ji.fail("Gap is not a flat range");var u=this.slice.insertAt(this.insert,l.content);return u?Ji.fromReplace(a,this.from,this.to,u):Ji.fail("Content does not fit in gap")},e.prototype.getMap=function(){return new gi([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])},e.prototype.invert=function(a){var l=this.gapTo-this.gapFrom;return new e(this.from,this.from+this.slice.size+l,this.from+this.insert,this.from+this.insert+l,a.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)},e.prototype.map=function(a){var l=a.mapResult(this.from,1),u=a.mapResult(this.to,-1),f=a.map(this.gapFrom,-1),g=a.map(this.gapTo,1);return l.deleted&&u.deleted||f<l.pos||g>u.pos?null:new e(l.pos,u.pos,f,g,this.slice,this.insert,this.structure)},e.prototype.toJSON=function(){var a={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(a.slice=this.slice.toJSON()),this.structure&&(a.structure=!0),a},e.fromJSON=function(a,l){if(typeof l.from!="number"||typeof l.to!="number"||typeof l.gapFrom!="number"||typeof l.gapTo!="number"||typeof l.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new e(l.from,l.to,l.gapFrom,l.gapTo,Ae.fromJSON(a,l.slice),l.insert,!!l.structure)},e}(Li);Li.jsonID("replaceAround",Kc);function __(o,e,i){for(var a=o.resolve(e),l=i-e,u=a.depth;l>0&&u>0&&a.indexAfter(u)==a.node(u).childCount;)u--,l--;if(l>0)for(var f=a.node(u).maybeChild(a.indexAfter(u));l>0;){if(!f||f.isLeaf)return!0;f=f.firstChild,l--}return!1}kn.prototype.lift=function(o,e){for(var i=o.$from,a=o.$to,l=o.depth,u=i.before(l+1),f=a.after(l+1),g=u,_=f,I=jt.empty,T=0,N=l,D=!1;N>e;N--)D||i.index(N)>0?(D=!0,I=jt.from(i.node(N).copy(I)),T++):g--;for(var F=jt.empty,K=0,J=l,nt=!1;J>e;J--)nt||a.after(J+1)<a.end(J)?(nt=!0,F=jt.from(a.node(J).copy(F)),K++):_++;return this.step(new Kc(g,_,u,f,new Ae(I.append(F),T,K),I.size-T,!0))};kn.prototype.wrap=function(o,e){for(var i=jt.empty,a=e.length-1;a>=0;a--)i=jt.from(e[a].type.create(e[a].attrs,i));var l=o.start,u=o.end;return this.step(new Kc(l,u,l,u,new Ae(i,0,0),e.length,!0))};kn.prototype.setBlockType=function(o,e,i,a){var l=this;if(e===void 0&&(e=o),!i.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");var u=this.steps.length;return this.doc.nodesBetween(o,e,function(f,g){if(f.isTextblock&&!f.hasMarkup(i,a)&&fV(l.doc,l.mapping.slice(u).map(g),i)){l.clearIncompatible(l.mapping.slice(u).map(g,1),i);var _=l.mapping.slice(u),I=_.map(g,1),T=_.map(g+f.nodeSize,1);return l.step(new Kc(I,T,I+1,T-1,new Ae(jt.from(i.create(a,null,f.marks)),0,0),1,!0)),!1}}),this};function fV(o,e,i){var a=o.resolve(e),l=a.index();return a.parent.canReplaceWith(l,l+1,i)}kn.prototype.setNodeMarkup=function(o,e,i,a){var l=this.doc.nodeAt(o);if(!l)throw new RangeError("No node at given position");e||(e=l.type);var u=e.create(i,null,a||l.marks);if(l.isLeaf)return this.replaceWith(o,o+l.nodeSize,u);if(!e.validContent(l.content))throw new RangeError("Invalid content for node type "+e.name);return this.step(new Kc(o,o+l.nodeSize,o+1,o+l.nodeSize-1,new Ae(jt.from(u),0,0),1,!0))};kn.prototype.split=function(o,e,i){e===void 0&&(e=1);for(var a=this.doc.resolve(o),l=jt.empty,u=jt.empty,f=a.depth,g=a.depth-e,_=e-1;f>g;f--,_--){l=jt.from(a.node(f).copy(l));var I=i&&i[_];u=jt.from(I?I.type.create(I.attrs,u):a.node(f).copy(u))}return this.step(new ic(o,o,new Ae(l.append(u),e,e),!0))};kn.prototype.join=function(o,e){e===void 0&&(e=1);var i=new ic(o-e,o+e,Ae.empty,!0);return this.step(i)};function AV(o,e,i){var a=o.resolve(e);if(a.parent.canReplaceWith(a.index(),a.index(),i))return e;if(a.parentOffset==0)for(var l=a.depth-1;l>=0;l--){var u=a.index(l);if(a.node(l).canReplaceWith(u,u,i))return a.before(l+1);if(u>0)return null}if(a.parentOffset==a.parent.content.size)for(var f=a.depth-1;f>=0;f--){var g=a.indexAfter(f);if(a.node(f).canReplaceWith(g,g,i))return a.after(f+1);if(g<a.node(f).childCount)return null}}function v_(o,e,i){for(var a=[],l=0;l<o.childCount;l++){var u=o.child(l);u.content.size&&(u=u.copy(v_(u.content,e,u))),u.isInline&&(u=e(u,i,l)),a.push(u)}return jt.fromArray(a)}var I_=function(o){function e(i,a,l){o.call(this),this.from=i,this.to=a,this.mark=l}return o&&(e.__proto__=o),e.prototype=Object.create(o&&o.prototype),e.prototype.constructor=e,e.prototype.apply=function(a){var l=this,u=a.slice(this.from,this.to),f=a.resolve(this.from),g=f.node(f.sharedDepth(this.to)),_=new Ae(v_(u.content,function(I,T){return!I.isAtom||!T.type.allowsMarkType(l.mark.type)?I:I.mark(l.mark.addToSet(I.marks))},g),u.openStart,u.openEnd);return Ji.fromReplace(a,this.from,this.to,_)},e.prototype.invert=function(){return new th(this.from,this.to,this.mark)},e.prototype.map=function(a){var l=a.mapResult(this.from,1),u=a.mapResult(this.to,-1);return l.deleted&&u.deleted||l.pos>=u.pos?null:new e(l.pos,u.pos,this.mark)},e.prototype.merge=function(a){if(a instanceof e&&a.mark.eq(this.mark)&&this.from<=a.to&&this.to>=a.from)return new e(Math.min(this.from,a.from),Math.max(this.to,a.to),this.mark)},e.prototype.toJSON=function(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},e.fromJSON=function(a,l){if(typeof l.from!="number"||typeof l.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new e(l.from,l.to,a.markFromJSON(l.mark))},e}(Li);Li.jsonID("addMark",I_);var th=function(o){function e(i,a,l){o.call(this),this.from=i,this.to=a,this.mark=l}return o&&(e.__proto__=o),e.prototype=Object.create(o&&o.prototype),e.prototype.constructor=e,e.prototype.apply=function(a){var l=this,u=a.slice(this.from,this.to),f=new Ae(v_(u.content,function(g){return g.mark(l.mark.removeFromSet(g.marks))}),u.openStart,u.openEnd);return Ji.fromReplace(a,this.from,this.to,f)},e.prototype.invert=function(){return new I_(this.from,this.to,this.mark)},e.prototype.map=function(a){var l=a.mapResult(this.from,1),u=a.mapResult(this.to,-1);return l.deleted&&u.deleted||l.pos>=u.pos?null:new e(l.pos,u.pos,this.mark)},e.prototype.merge=function(a){if(a instanceof e&&a.mark.eq(this.mark)&&this.from<=a.to&&this.to>=a.from)return new e(Math.min(this.from,a.from),Math.max(this.to,a.to),this.mark)},e.prototype.toJSON=function(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},e.fromJSON=function(a,l){if(typeof l.from!="number"||typeof l.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new e(l.from,l.to,a.markFromJSON(l.mark))},e}(Li);Li.jsonID("removeMark",th);kn.prototype.addMark=function(o,e,i){var a=this,l=[],u=[],f=null,g=null;return this.doc.nodesBetween(o,e,function(_,I,T){if(!!_.isInline){var N=_.marks;if(!i.isInSet(N)&&T.type.allowsMarkType(i.type)){for(var D=Math.max(I,o),F=Math.min(I+_.nodeSize,e),K=i.addToSet(N),J=0;J<N.length;J++)N[J].isInSet(K)||(f&&f.to==D&&f.mark.eq(N[J])?f.to=F:l.push(f=new th(D,F,N[J])));g&&g.to==D?g.to=F:u.push(g=new I_(D,F,i))}}}),l.forEach(function(_){return a.step(_)}),u.forEach(function(_){return a.step(_)}),this};kn.prototype.removeMark=function(o,e,i){var a=this;i===void 0&&(i=null);var l=[],u=0;return this.doc.nodesBetween(o,e,function(f,g){if(!!f.isInline){u++;var _=null;if(i instanceof Wc)for(var I=f.marks,T;T=i.isInSet(I);)(_||(_=[])).push(T),I=T.removeFromSet(I);else i?i.isInSet(f.marks)&&(_=[i]):_=f.marks;if(_&&_.length)for(var N=Math.min(g+f.nodeSize,e),D=0;D<_.length;D++){for(var F=_[D],K=void 0,J=0;J<l.length;J++){var nt=l[J];nt.step==u-1&&F.eq(l[J].style)&&(K=nt)}K?(K.to=N,K.step=u):l.push({style:F,from:Math.max(g,o),to:N,step:u})}}}),l.forEach(function(f){return a.step(new th(f.from,f.to,f.style))}),this};kn.prototype.clearIncompatible=function(o,e,i){i===void 0&&(i=e.contentMatch);for(var a=this.doc.nodeAt(o),l=[],u=o+1,f=0;f<a.childCount;f++){var g=a.child(f),_=u+g.nodeSize,I=i.matchType(g.type,g.attrs);if(!I)l.push(new ic(u,_,Ae.empty));else{i=I;for(var T=0;T<g.marks.length;T++)e.allowsMarkType(g.marks[T].type)||this.step(new th(u,_,g.marks[T]))}u=_}if(!i.validEnd){var N=i.fillBefore(jt.empty,!0);this.replace(u,u,new Ae(N,0,0))}for(var D=l.length-1;D>=0;D--)this.step(l[D]);return this};function gV(o,e,i,a){if(i===void 0&&(i=e),a===void 0&&(a=Ae.empty),e==i&&!a.size)return null;var l=o.resolve(e),u=o.resolve(i);return mN(l,u,a)?new ic(e,i,a):new ts(l,u,a).fit()}kn.prototype.replace=function(o,e,i){e===void 0&&(e=o),i===void 0&&(i=Ae.empty);var a=gV(this.doc,o,e,i);return a&&this.step(a),this};kn.prototype.replaceWith=function(o,e,i){return this.replace(o,e,new Ae(jt.from(i),0,0))};kn.prototype.delete=function(o,e){return this.replace(o,e,Ae.empty)};kn.prototype.insert=function(o,e){return this.replaceWith(o,o,e)};function mN(o,e,i){return!i.openStart&&!i.openEnd&&o.start()==e.start()&&o.parent.canReplace(o.index(),e.index(),i.content)}var ts=function(e,i,a){this.$to=i,this.$from=e,this.unplaced=a,this.frontier=[];for(var l=0;l<=e.depth;l++){var u=e.node(l);this.frontier.push({type:u.type,match:u.contentMatchAt(e.indexAfter(l))})}this.placed=jt.empty;for(var f=e.depth;f>0;f--)this.placed=jt.from(e.node(f).copy(this.placed))},EN={depth:{configurable:!0}};EN.depth.get=function(){return this.frontier.length-1};ts.prototype.fit=function(){for(;this.unplaced.size;){var e=this.findFittable();e?this.placeNodes(e):this.openMore()||this.dropNode()}var i=this.mustMoveInline(),a=this.placed.size-this.depth-this.$from.depth,l=this.$from,u=this.close(i<0?this.$to:l.doc.resolve(i));if(!u)return null;for(var f=this.placed,g=l.depth,_=u.depth;g&&_&&f.childCount==1;)f=f.firstChild.content,g--,_--;var I=new Ae(f,g,_);if(i>-1)return new Kc(l.pos,i,this.$to.pos,this.$to.end(),I,a);if(I.size||l.pos!=this.$to.pos)return new ic(l.pos,u.pos,I)};ts.prototype.findFittable=function(){for(var e=1;e<=2;e++)for(var i=this.unplaced.openStart;i>=0;i--){var a=void 0,l=void 0;i?(l=C_(this.unplaced.content,i-1).firstChild,a=l.content):a=this.unplaced.content;for(var u=a.firstChild,f=this.depth;f>=0;f--){var g=this.frontier[f],_=g.type,I=g.match,T=void 0,N=void 0;if(e==1&&(u?I.matchType(u.type)||(N=I.fillBefore(jt.from(u),!1)):_.compatibleContent(l.type)))return{sliceDepth:i,frontierDepth:f,parent:l,inject:N};if(e==2&&u&&(T=I.findWrapping(u.type)))return{sliceDepth:i,frontierDepth:f,parent:l,wrap:T};if(l&&I.matchType(l.type))break}}};ts.prototype.openMore=function(){var e=this.unplaced,i=e.content,a=e.openStart,l=e.openEnd,u=C_(i,a);return!u.childCount||u.firstChild.isLeaf?!1:(this.unplaced=new Ae(i,a+1,Math.max(l,u.size+a>=i.size-l?a+1:0)),!0)};ts.prototype.dropNode=function(){var e=this.unplaced,i=e.content,a=e.openStart,l=e.openEnd,u=C_(i,a);if(u.childCount<=1&&a>0){var f=i.size-a<=a+u.size;this.unplaced=new Ae(eh(i,a-1,1),a-1,f?a-1:l)}else this.unplaced=new Ae(eh(i,a,1),a,l)};ts.prototype.placeNodes=function(e){for(var i=e.sliceDepth,a=e.frontierDepth,l=e.parent,u=e.inject,f=e.wrap;this.depth>a;)this.closeFrontierNode();if(f)for(var g=0;g<f.length;g++)this.openFrontierNode(f[g]);var _=this.unplaced,I=l?l.content:_.content,T=_.openStart-i,N=0,D=[],F=this.frontier[a],K=F.match,J=F.type;if(u){for(var nt=0;nt<u.childCount;nt++)D.push(u.child(nt));K=K.matchFragment(u)}for(var it=I.size+i-(_.content.size-_.openEnd);N<I.childCount;){var z=I.child(N),Ot=K.matchType(z.type);if(!Ot)break;N++,(N>1||T==0||z.content.size)&&(K=Ot,D.push(_N(z.mark(J.allowedMarks(z.marks)),N==1?T:0,N==I.childCount?it:-1)))}var X=N==I.childCount;X||(it=-1),this.placed=rh(this.placed,a,jt.from(D)),this.frontier[a].match=K,X&&it<0&&l&&l.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(var yt=0,Mt=I;yt<it;yt++){var $t=Mt.lastChild;this.frontier.push({type:$t.type,match:$t.contentMatchAt($t.childCount)}),Mt=$t.content}this.unplaced=X?i==0?Ae.empty:new Ae(eh(_.content,i-1,1),i-1,it<0?_.openEnd:i-1):new Ae(eh(_.content,i,N),_.openStart,_.openEnd)};ts.prototype.mustMoveInline=function(){if(!this.$to.parent.isTextblock||this.$to.end()==this.$to.pos)return-1;var e=this.frontier[this.depth],i;if(!e.type.isTextblock||!S_(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(i=this.findCloseLevel(this.$to))&&i.depth==this.depth)return-1;for(var a=this.$to,l=a.depth,u=this.$to.after(l);l>1&&u==this.$to.end(--l);)++u;return u};ts.prototype.findCloseLevel=function(e){t:for(var i=Math.min(this.depth,e.depth);i>=0;i--){var a=this.frontier[i],l=a.match,u=a.type,f=i<e.depth&&e.end(i+1)==e.pos+(e.depth-(i+1)),g=S_(e,i,u,l,f);if(!!g){for(var _=i-1;_>=0;_--){var I=this.frontier[_],T=I.match,N=I.type,D=S_(e,_,N,T,!0);if(!D||D.childCount)continue t}return{depth:i,fit:g,move:f?e.doc.resolve(e.after(i+1)):e}}}};ts.prototype.close=function(e){var i=this.findCloseLevel(e);if(!i)return null;for(;this.depth>i.depth;)this.closeFrontierNode();i.fit.childCount&&(this.placed=rh(this.placed,i.depth,i.fit)),e=i.move;for(var a=i.depth+1;a<=e.depth;a++){var l=e.node(a),u=l.type.contentMatch.fillBefore(l.content,!0,e.index(a));this.openFrontierNode(l.type,l.attrs,u)}return e};ts.prototype.openFrontierNode=function(e,i,a){var l=this.frontier[this.depth];l.match=l.match.matchType(e),this.placed=rh(this.placed,this.depth,jt.from(e.create(i,a))),this.frontier.push({type:e,match:e.contentMatch})};ts.prototype.closeFrontierNode=function(){var e=this.frontier.pop(),i=e.match.fillBefore(jt.empty,!0);i.childCount&&(this.placed=rh(this.placed,this.frontier.length,i))};Object.defineProperties(ts.prototype,EN);function eh(o,e,i){return e==0?o.cutByIndex(i):o.replaceChild(0,o.firstChild.copy(eh(o.firstChild.content,e-1,i)))}function rh(o,e,i){return e==0?o.append(i):o.replaceChild(o.childCount-1,o.lastChild.copy(rh(o.lastChild.content,e-1,i)))}function C_(o,e){for(var i=0;i<e;i++)o=o.firstChild.content;return o}function _N(o,e,i){if(e<=0)return o;var a=o.content;return e>1&&(a=a.replaceChild(0,_N(a.firstChild,e-1,a.childCount==1?i-1:0))),e>0&&(a=o.type.contentMatch.fillBefore(a).append(a),i<=0&&(a=a.append(o.type.contentMatch.matchFragment(a).fillBefore(jt.empty,!0)))),o.copy(a)}function S_(o,e,i,a,l){var u=o.node(e),f=l?o.indexAfter(e):o.index(e);if(f==u.childCount&&!i.compatibleContent(u.type))return null;var g=a.fillBefore(u.content,!0,f);return g&&!mV(i,u.content,f)?g:null}function mV(o,e,i){for(var a=i;a<e.childCount;a++)if(!o.allowsMarks(e.child(a).marks))return!0;return!1}kn.prototype.replaceRange=function(o,e,i){if(!i.size)return this.deleteRange(o,e);var a=this.doc.resolve(o),l=this.doc.resolve(e);if(mN(a,l,i))return this.step(new ic(o,e,i));var u=IN(a,this.doc.resolve(e));u[u.length-1]==0&&u.pop();var f=-(a.depth+1);u.unshift(f);for(var g=a.depth,_=a.pos-1;g>0;g--,_--){var I=a.node(g).type.spec;if(I.defining||I.isolating)break;u.indexOf(g)>-1?f=g:a.before(g)==_&&u.splice(1,0,-g)}for(var T=u.indexOf(f),N=[],D=i.openStart,F=i.content,K=0;;K++){var J=F.firstChild;if(N.push(J),K==i.openStart)break;F=J.content}D>0&&N[D-1].type.spec.defining&&a.node(T).type!=N[D-1].type?D-=1:D>=2&&N[D-1].isTextblock&&N[D-2].type.spec.defining&&a.node(T).type!=N[D-2].type&&(D-=2);for(var nt=i.openStart;nt>=0;nt--){var it=(nt+D+1)%(i.openStart+1),z=N[it];if(!!z)for(var Ot=0;Ot<u.length;Ot++){var X=u[(Ot+T)%u.length],yt=!0;X<0&&(yt=!1,X=-X);var Mt=a.node(X-1),$t=a.index(X-1);if(Mt.canReplaceWith($t,$t,z.type,z.marks))return this.replace(a.before(X),yt?l.after(X):e,new Ae(vN(i.content,0,i.openStart,it),it,i.openEnd))}}for(var ge=this.steps.length,Te=u.length-1;Te>=0&&(this.replace(o,e,i),!(this.steps.length>ge));Te--){var Se=u[Te];Se<0||(o=a.before(Se),e=l.after(Se))}return this};function vN(o,e,i,a,l){if(e<i){var u=o.firstChild;o=o.replaceChild(0,u.copy(vN(u.content,e+1,i,a,u)))}if(e>a){var f=l.contentMatchAt(0),g=f.fillBefore(o).append(o);o=g.append(f.matchFragment(g).fillBefore(jt.empty,!0))}return o}kn.prototype.replaceRangeWith=function(o,e,i){if(!i.isInline&&o==e&&this.doc.resolve(o).parent.content.size){var a=AV(this.doc,o,i.type);a!=null&&(o=e=a)}return this.replaceRange(o,e,new Ae(jt.from(i),0,0))};kn.prototype.deleteRange=function(o,e){for(var i=this.doc.resolve(o),a=this.doc.resolve(e),l=IN(i,a),u=0;u<l.length;u++){var f=l[u],g=u==l.length-1;if(g&&f==0||i.node(f).type.contentMatch.validEnd)return this.delete(i.start(f),a.end(f));if(f>0&&(g||i.node(f-1).canReplace(i.index(f-1),a.indexAfter(f-1))))return this.delete(i.before(f),a.after(f))}for(var _=1;_<=i.depth&&_<=a.depth;_++)if(o-i.start(_)==i.depth-_&&e>i.end(_)&&a.end(_)-e!=a.depth-_)return this.delete(i.before(_),e);return this.delete(o,e)};function IN(o,e){for(var i=[],a=Math.min(o.depth,e.depth),l=a;l>=0;l--){var u=o.start(l);if(u<o.pos-(o.depth-l)||e.end(l)>e.pos+(e.depth-l)||o.node(l).type.spec.isolating||e.node(l).type.spec.isolating)break;(u==e.start(l)||l==o.depth&&l==e.depth&&o.parent.inlineContent&&e.parent.inlineContent&&l&&e.start(l-1)==u-1)&&i.push(l)}return i}var y_=Object.create(null),En=function(e,i,a){this.ranges=a||[new EV(e.min(i),e.max(i))],this.$anchor=e,this.$head=i},oc={anchor:{configurable:!0},head:{configurable:!0},from:{configurable:!0},to:{configurable:!0},$from:{configurable:!0},$to:{configurable:!0},empty:{configurable:!0}};oc.anchor.get=function(){return this.$anchor.pos};oc.head.get=function(){return this.$head.pos};oc.from.get=function(){return this.$from.pos};oc.to.get=function(){return this.$to.pos};oc.$from.get=function(){return this.ranges[0].$from};oc.$to.get=function(){return this.ranges[0].$to};oc.empty.get=function(){for(var o=this.ranges,e=0;e<o.length;e++)if(o[e].$from.pos!=o[e].$to.pos)return!1;return!0};En.prototype.content=function(){return this.$from.node(0).slice(this.from,this.to,!0)};En.prototype.replace=function(e,i){i===void 0&&(i=Ae.empty);for(var a=i.content.lastChild,l=null,u=0;u<i.openEnd;u++)l=a,a=a.lastChild;for(var f=e.steps.length,g=this.ranges,_=0;_<g.length;_++){var I=g[_],T=I.$from,N=I.$to,D=e.mapping.slice(f);e.replaceRange(D.map(T.pos),D.map(N.pos),_?Ae.empty:i),_==0&&CN(e,f,(a?a.isInline:l&&l.isTextblock)?-1:1)}};En.prototype.replaceWith=function(e,i){for(var a=e.steps.length,l=this.ranges,u=0;u<l.length;u++){var f=l[u],g=f.$from,_=f.$to,I=e.mapping.slice(a),T=I.map(g.pos),N=I.map(_.pos);u?e.deleteRange(T,N):(e.replaceRangeWith(T,N,i),CN(e,a,i.isInline?-1:1))}};En.findFrom=function(e,i,a){var l=e.parent.inlineContent?new nh(e):pd(e.node(0),e.parent,e.pos,e.index(),i,a);if(l)return l;for(var u=e.depth-1;u>=0;u--){var f=i<0?pd(e.node(0),e.node(u),e.before(u+1),e.index(u),i,a):pd(e.node(0),e.node(u),e.after(u+1),e.index(u)+1,i,a);if(f)return f}};En.near=function(e,i){return i===void 0&&(i=1),this.findFrom(e,i)||this.findFrom(e,-i)||new oh(e.node(0))};En.atStart=function(e){return pd(e,e,0,0,1)||new oh(e)};En.atEnd=function(e){return pd(e,e,e.content.size,e.childCount,-1)||new oh(e)};En.fromJSON=function(e,i){if(!i||!i.type)throw new RangeError("Invalid input for Selection.fromJSON");var a=y_[i.type];if(!a)throw new RangeError("No selection type "+i.type+" defined");return a.fromJSON(e,i)};En.jsonID=function(e,i){if(e in y_)throw new RangeError("Duplicate use of selection JSON ID "+e);return y_[e]=i,i.prototype.jsonID=e,i};En.prototype.getBookmark=function(){return nh.between(this.$anchor,this.$head).getBookmark()};Object.defineProperties(En.prototype,oc);En.prototype.visible=!0;var EV=function(e,i){this.$from=e,this.$to=i},nh=function(o){function e(a,l){l===void 0&&(l=a),o.call(this,a,l)}o&&(e.__proto__=o),e.prototype=Object.create(o&&o.prototype),e.prototype.constructor=e;var i={$cursor:{configurable:!0}};return i.$cursor.get=function(){return this.$anchor.pos==this.$head.pos?this.$head:null},e.prototype.map=function(l,u){var f=l.resolve(u.map(this.head));if(!f.parent.inlineContent)return o.near(f);var g=l.resolve(u.map(this.anchor));return new e(g.parent.inlineContent?g:f,f)},e.prototype.replace=function(l,u){if(u===void 0&&(u=Ae.empty),o.prototype.replace.call(this,l,u),u==Ae.empty){var f=this.$from.marksAcross(this.$to);f&&l.ensureMarks(f)}},e.prototype.eq=function(l){return l instanceof e&&l.anchor==this.anchor&&l.head==this.head},e.prototype.getBookmark=function(){return new ih(this.anchor,this.head)},e.prototype.toJSON=function(){return{type:"text",anchor:this.anchor,head:this.head}},e.fromJSON=function(l,u){if(typeof u.anchor!="number"||typeof u.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new e(l.resolve(u.anchor),l.resolve(u.head))},e.create=function(l,u,f){f===void 0&&(f=u);var g=l.resolve(u);return new this(g,f==u?g:l.resolve(f))},e.between=function(l,u,f){var g=l.pos-u.pos;if((!f||g)&&(f=g>=0?1:-1),!u.parent.inlineContent){var _=o.findFrom(u,f,!0)||o.findFrom(u,-f,!0);if(_)u=_.$head;else return o.near(u,f)}return l.parent.inlineContent||(g==0?l=u:(l=(o.findFrom(l,-f,!0)||o.findFrom(l,f,!0)).$anchor,l.pos<u.pos!=g<0&&(l=u))),new e(l,u)},Object.defineProperties(e.prototype,i),e}(En);En.jsonID("text",nh);var ih=function(e,i){this.anchor=e,this.head=i};ih.prototype.map=function(e){return new ih(e.map(this.anchor),e.map(this.head))};ih.prototype.resolve=function(e){return nh.between(e.resolve(this.anchor),e.resolve(this.head))};var hd=function(o){function e(i){var a=i.nodeAfter,l=i.node(0).resolve(i.pos+a.nodeSize);o.call(this,i,l),this.node=a}return o&&(e.__proto__=o),e.prototype=Object.create(o&&o.prototype),e.prototype.constructor=e,e.prototype.map=function(a,l){var u=l.mapResult(this.anchor),f=u.deleted,g=u.pos,_=a.resolve(g);return f?o.near(_):new e(_)},e.prototype.content=function(){return new Ae(jt.from(this.node),0,0)},e.prototype.eq=function(a){return a instanceof e&&a.anchor==this.anchor},e.prototype.toJSON=function(){return{type:"node",anchor:this.anchor}},e.prototype.getBookmark=function(){return new Qf(this.anchor)},e.fromJSON=function(a,l){if(typeof l.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new e(a.resolve(l.anchor))},e.create=function(a,l){return new this(a.resolve(l))},e.isSelectable=function(a){return!a.isText&&a.type.spec.selectable!==!1},e}(En);hd.prototype.visible=!1;En.jsonID("node",hd);var Qf=function(e){this.anchor=e};Qf.prototype.map=function(e){var i=e.mapResult(this.anchor),a=i.deleted,l=i.pos;return a?new ih(l,l):new Qf(l)};Qf.prototype.resolve=function(e){var i=e.resolve(this.anchor),a=i.nodeAfter;return a&&hd.isSelectable(a)?new hd(i):En.near(i)};var oh=function(o){function e(i){o.call(this,i.resolve(0),i.resolve(i.content.size))}return o&&(e.__proto__=o),e.prototype=Object.create(o&&o.prototype),e.prototype.constructor=e,e.prototype.replace=function(a,l){if(l===void 0&&(l=Ae.empty),l==Ae.empty){a.delete(0,a.doc.content.size);var u=o.atStart(a.doc);u.eq(a.selection)||a.setSelection(u)}else o.prototype.replace.call(this,a,l)},e.prototype.toJSON=function(){return{type:"all"}},e.fromJSON=function(a){return new e(a)},e.prototype.map=function(a){return new e(a)},e.prototype.eq=function(a){return a instanceof e},e.prototype.getBookmark=function(){return _V},e}(En);En.jsonID("all",oh);var _V={map:function(){return this},resolve:function(e){return new oh(e)}};function pd(o,e,i,a,l,u){if(e.inlineContent)return nh.create(o,i);for(var f=a-(l>0?0:1);l>0?f<e.childCount:f>=0;f+=l){var g=e.child(f);if(g.isAtom){if(!u&&hd.isSelectable(g))return hd.create(o,i-(l<0?g.nodeSize:0))}else{var _=pd(o,g,i+l,l<0?g.childCount:0,l,u);if(_)return _}i+=g.nodeSize*l}}function CN(o,e,i){var a=o.steps.length-1;if(!(a<e)){var l=o.steps[a];if(l instanceof ic||l instanceof Kc){var u=o.mapping.maps[a],f;u.forEach(function(g,_,I,T){f==null&&(f=T)}),o.setSelection(En.near(o.doc.resolve(f),i))}}}var SN=1,Vf=2,yN=4,vV=function(o){function e(a){o.call(this,a.doc),this.time=Date.now(),this.curSelection=a.selection,this.curSelectionFor=0,this.storedMarks=a.storedMarks,this.updated=0,this.meta=Object.create(null)}o&&(e.__proto__=o),e.prototype=Object.create(o&&o.prototype),e.prototype.constructor=e;var i={selection:{configurable:!0},selectionSet:{configurable:!0},storedMarksSet:{configurable:!0},isGeneric:{configurable:!0},scrolledIntoView:{configurable:!0}};return i.selection.get=function(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection},e.prototype.setSelection=function(l){if(l.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=l,this.curSelectionFor=this.steps.length,this.updated=(this.updated|SN)&~Vf,this.storedMarks=null,this},i.selectionSet.get=function(){return(this.updated&SN)>0},e.prototype.setStoredMarks=function(l){return this.storedMarks=l,this.updated|=Vf,this},e.prototype.ensureMarks=function(l){return gr.sameSet(this.storedMarks||this.selection.$from.marks(),l)||this.setStoredMarks(l),this},e.prototype.addStoredMark=function(l){return this.ensureMarks(l.addToSet(this.storedMarks||this.selection.$head.marks()))},e.prototype.removeStoredMark=function(l){return this.ensureMarks(l.removeFromSet(this.storedMarks||this.selection.$head.marks()))},i.storedMarksSet.get=function(){return(this.updated&Vf)>0},e.prototype.addStep=function(l,u){o.prototype.addStep.call(this,l,u),this.updated=this.updated&~Vf,this.storedMarks=null},e.prototype.setTime=function(l){return this.time=l,this},e.prototype.replaceSelection=function(l){return this.selection.replace(this,l),this},e.prototype.replaceSelectionWith=function(l,u){var f=this.selection;return u!==!1&&(l=l.mark(this.storedMarks||(f.empty?f.$from.marks():f.$from.marksAcross(f.$to)||gr.none))),f.replaceWith(this,l),this},e.prototype.deleteSelection=function(){return this.selection.replace(this),this},e.prototype.insertText=function(l,u,f){f===void 0&&(f=u);var g=this.doc.type.schema;if(u==null)return l?this.replaceSelectionWith(g.text(l),!0):this.deleteSelection();if(!l)return this.deleteRange(u,f);var _=this.storedMarks;if(!_){var I=this.doc.resolve(u);_=f==u?I.marks():I.marksAcross(this.doc.resolve(f))}return this.replaceRangeWith(u,f,g.text(l,_)),this.selection.empty||this.setSelection(En.near(this.selection.$to)),this},e.prototype.setMeta=function(l,u){return this.meta[typeof l=="string"?l:l.key]=u,this},e.prototype.getMeta=function(l){return this.meta[typeof l=="string"?l:l.key]},i.isGeneric.get=function(){for(var a in this.meta)return!1;return!0},e.prototype.scrollIntoView=function(){return this.updated|=yN,this},i.scrolledIntoView.get=function(){return(this.updated&yN)>0},Object.defineProperties(e.prototype,i),e}(kn);function TN(o,e){return!e||!o?o:o.bind(e)}var sh=function(e,i,a){this.name=e,this.init=TN(i.init,a),this.apply=TN(i.apply,a)},IV=[new sh("doc",{init:function(e){return e.doc||e.schema.topNodeType.createAndFill()},apply:function(e){return e.doc}}),new sh("selection",{init:function(e,i){return e.selection||En.atStart(i.doc)},apply:function(e){return e.selection}}),new sh("storedMarks",{init:function(e){return e.storedMarks||null},apply:function(e,i,a,l){return l.selection.$cursor?e.storedMarks:null}}),new sh("scrollToSelection",{init:function(){return 0},apply:function(e,i){return e.scrolledIntoView?i+1:i}})],T_=function(e,i){var a=this;this.schema=e,this.fields=IV.concat(),this.plugins=[],this.pluginsByKey=Object.create(null),i&&i.forEach(function(l){if(a.pluginsByKey[l.key])throw new RangeError("Adding different instances of a keyed plugin ("+l.key+")");a.plugins.push(l),a.pluginsByKey[l.key]=l,l.spec.state&&a.fields.push(new sh(l.key,l.spec.state,l))})},zi=function(e){this.config=e},Gf={schema:{configurable:!0},plugins:{configurable:!0},tr:{configurable:!0}};Gf.schema.get=function(){return this.config.schema};Gf.plugins.get=function(){return this.config.plugins};zi.prototype.apply=function(e){return this.applyTransaction(e).state};zi.prototype.filterTransaction=function(e,i){i===void 0&&(i=-1);for(var a=0;a<this.config.plugins.length;a++)if(a!=i){var l=this.config.plugins[a];if(l.spec.filterTransaction&&!l.spec.filterTransaction.call(l,e,this))return!1}return!0};zi.prototype.applyTransaction=function(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};for(var i=[e],a=this.applyInner(e),l=null;;){for(var u=!1,f=0;f<this.config.plugins.length;f++){var g=this.config.plugins[f];if(g.spec.appendTransaction){var _=l?l[f].n:0,I=l?l[f].state:this,T=_<i.length&&g.spec.appendTransaction.call(g,_?i.slice(_):i,I,a);if(T&&a.filterTransaction(T,f)){if(T.setMeta("appendedTransaction",e),!l){l=[];for(var N=0;N<this.config.plugins.length;N++)l.push(N<f?{state:a,n:i.length}:{state:this,n:0})}i.push(T),a=a.applyInner(T),u=!0}l&&(l[f]={state:a,n:i.length})}}if(!u)return{state:a,transactions:i}}};zi.prototype.applyInner=function(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");for(var i=new zi(this.config),a=this.config.fields,l=0;l<a.length;l++){var u=a[l];i[u.name]=u.apply(e,this[u.name],this,i)}for(var f=0;f<ah.length;f++)ah[f](this,e,i);return i};Gf.tr.get=function(){return new vV(this)};zi.create=function(e){for(var i=new T_(e.doc?e.doc.type.schema:e.schema,e.plugins),a=new zi(i),l=0;l<i.fields.length;l++)a[i.fields[l].name]=i.fields[l].init(e,a);return a};zi.prototype.reconfigure=function(e){for(var i=new T_(this.schema,e.plugins),a=i.fields,l=new zi(i),u=0;u<a.length;u++){var f=a[u].name;l[f]=this.hasOwnProperty(f)?this[f]:a[u].init(e,l)}return l};zi.prototype.toJSON=function(e){var i={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(i.storedMarks=this.storedMarks.map(function(f){return f.toJSON()})),e&&typeof e=="object")for(var a in e){if(a=="doc"||a=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");var l=e[a],u=l.spec.state;u&&u.toJSON&&(i[a]=u.toJSON.call(l,this[l.key]))}return i};zi.fromJSON=function(e,i,a){if(!i)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");var l=new T_(e.schema,e.plugins),u=new zi(l);return l.fields.forEach(function(f){if(f.name=="doc")u.doc=mr.fromJSON(e.schema,i.doc);else if(f.name=="selection")u.selection=En.fromJSON(u.doc,i.selection);else if(f.name=="storedMarks")i.storedMarks&&(u.storedMarks=i.storedMarks.map(e.schema.markFromJSON));else{if(a)for(var g in a){var _=a[g],I=_.spec.state;if(_.key==f.name&&I&&I.fromJSON&&Object.prototype.hasOwnProperty.call(i,g)){u[f.name]=I.fromJSON.call(_,e,i[g],u);return}}u[f.name]=f.init(e,u)}}),u};zi.addApplyListener=function(e){ah.push(e)};zi.removeApplyListener=function(e){var i=ah.indexOf(e);i>-1&&ah.splice(i,1)};Object.defineProperties(zi.prototype,Gf);var ah=[];function RN(o,e,i){for(var a in o){var l=o[a];l instanceof Function?l=l.bind(e):a=="handleDOMEvents"&&(l=RN(l,e,{})),i[a]=l}return i}var wN=function(e){this.props={},e.props&&RN(e.props,this,this.props),this.spec=e,this.key=e.key?e.key.key:bN("plugin")};wN.prototype.getState=function(e){return e[this.key]};var R_=Object.create(null);function bN(o){return o in R_?o+"$"+ ++R_[o]:(R_[o]=0,o+"$")}var w_=function(e){e===void 0&&(e="key"),this.key=bN(e)};w_.prototype.get=function(e){return e.config.pluginsByKey[this.key]};w_.prototype.getState=function(e){return e[this.key]};const CV=ii.create({name:"characterCount",addOptions(){return{limit:null,mode:"textSize"}},addStorage(){return{characters:()=>0,words:()=>0}},onBeforeCreate(){this.storage.characters=o=>{const e=(o==null?void 0:o.node)||this.editor.state.doc;return((o==null?void 0:o.mode)||this.options.mode)==="textSize"?e.textBetween(0,e.content.size,void 0," ").length:e.nodeSize},this.storage.words=o=>{const e=(o==null?void 0:o.node)||this.editor.state.doc;return e.textBetween(0,e.content.size," "," ").split(" ").filter(l=>l!=="").length}},addProseMirrorPlugins(){return[new wN({key:new w_("characterCount"),filterTransaction:(o,e)=>{const i=this.options.limit;if(!o.docChanged||i===0||i===null||i===void 0)return!0;const a=this.storage.characters({node:e.doc}),l=this.storage.characters({node:o.doc});if(l<=i||a>i&&l>i&&l<=a)return!0;if(a>i&&l>i&&l>a||!o.getMeta("paste"))return!1;const f=o.selection.$head.pos,g=l-i,_=f-g,I=f;return o.deleteRange(_,I),!(this.storage.characters({node:o.doc})>i)}})]}});const SV={props:{icon:{type:String,required:!0},title:{type:String,required:!0},action:{type:Function,required:!0},isActive:{type:Function,default:null}},components:{SvgIcon:wc}},yV=["title"];function TV(o,e,i,a,l,u){const f=gu("SvgIcon");return Nn(),Vi("button",{class:Ql(["menu-item",{"is-active":i.isActive?i.isActive():null}]),onClick:e[0]||(e[0]=(...g)=>i.action&&i.action(...g)),title:i.title},[Gi(f,{name:"tiptap-"+i.icon},null,8,["name"])],10,yV)}var RV=vu(SV,[["render",TV],["__scopeId","data-v-d2d2a634"]]);const wV={components:{MenuItem:RV},props:{editor:{type:Object,required:!0}},data(){return{items:[{icon:"bold",title:"Bold",action:()=>this.editor.chain().focus().toggleBold().run(),isActive:()=>this.editor.isActive("bold")},{icon:"italic",title:"Italic",action:()=>this.editor.chain().focus().toggleItalic().run(),isActive:()=>this.editor.isActive("italic")},{icon:"strikethrough",title:"Strike",action:()=>this.editor.chain().focus().toggleStrike().run(),isActive:()=>this.editor.isActive("strike")},{icon:"code-view",title:"Code",action:()=>this.editor.chain().focus().toggleCode().run(),isActive:()=>this.editor.isActive("code")},{icon:"mark-pen-line",title:"Highlight",action:()=>this.editor.chain().focus().toggleHighlight().run(),isActive:()=>this.editor.isActive("highlight")},{type:"divider"},{icon:"h-1",title:"Heading 1",action:()=>this.editor.chain().focus().toggleHeading({level:1}).run(),isActive:()=>this.editor.isActive("heading",{level:1})},{icon:"h-2",title:"Heading 2",action:()=>this.editor.chain().focus().toggleHeading({level:2}).run(),isActive:()=>this.editor.isActive("heading",{level:2})},{icon:"paragraph",title:"Paragraph",action:()=>this.editor.chain().focus().setParagraph().run(),isActive:()=>this.editor.isActive("paragraph")},{icon:"list-unordered",title:"Bullet List",action:()=>this.editor.chain().focus().toggleBulletList().run(),isActive:()=>this.editor.isActive("bulletList")},{icon:"list-ordered",title:"Ordered List",action:()=>this.editor.chain().focus().toggleOrderedList().run(),isActive:()=>this.editor.isActive("orderedList")},{icon:"list-check-2",title:"Task List",action:()=>this.editor.chain().focus().toggleTaskList().run(),isActive:()=>this.editor.isActive("taskList")},{icon:"code-box-line",title:"Code Block",action:()=>this.editor.chain().focus().toggleCodeBlock().run(),isActive:()=>this.editor.isActive("codeBlock")},{type:"divider"},{icon:"double-quotes-l",title:"Blockquote",action:()=>this.editor.chain().focus().toggleBlockquote().run(),isActive:()=>this.editor.isActive("blockquote")},{icon:"separator",title:"Horizontal Rule",action:()=>this.editor.chain().focus().setHorizontalRule().run()},{type:"divider"},{icon:"text-wrap",title:"Hard Break",action:()=>this.editor.chain().focus().setHardBreak().run()},{icon:"format-clear",title:"Clear Format",action:()=>this.editor.chain().focus().clearNodes().unsetAllMarks().run()},{type:"divider"},{icon:"arrow-go-back-line",title:"Undo",action:()=>this.editor.chain().focus().undo().run()},{icon:"arrow-go-forward-line",title:"Redo",action:()=>this.editor.chain().focus().redo().run()}]}}};function bV(o,e,i,a,l,u){const f=gu("menu-item");return Nn(),Vi("div",null,[(Nn(!0),Vi(va,null,Im(l.items,(g,_)=>(Nn(),Vi(va,null,[g.type==="divider"?(Nn(),Vi("div",{class:"divider",key:`divider${_}`})):(Nn(),Vl(f,pM({key:1,key:_},g),null,16))],64))),256))])}var NV=vu(wV,[["render",bV],["__scopeId","data-v-1ebce63e"]]);const NN=wm(),ON=o=>o[Math.floor(Math.random()*o.length)],OV={components:{EditorContent:_Q,MenuBar:NV},data(){return{currentUser:JSON.parse(localStorage.getItem("currentUser"))||{name:this.getRandomName(),color:this.getRandomColor()},provider:null,editor:null,users:[],status:"connecting"}},mounted(){const o=new HM;this.provider=new YM("wss://ws1.hookin.fun","f452c7864b7a575cf23e0850cf0c9291",o),this.provider.on("status",e=>{this.status=e.status}),this.editor=new EQ({extensions:[g4.configure({history:!1}),Y4,G4,W4,Q4.configure({document:o}),V4.configure({provider:this.provider,user:this.currentUser}),CV.configure({limit:1e4})]})},methods:{setName(){const o=(window.prompt("Name")||"").trim().substring(0,32);if(o)return this.updateCurrentUser({name:o})},updateCurrentUser(o){this.currentUser=Dt(Dt({},this.currentUser),o),this.editor.chain().focus().user(this.currentUser).run(),localStorage.setItem("currentUser",JSON.stringify(this.currentUser))},getRandomColor(){return ON(["#958DF1","#F98181","#FBBC88","#FAF594","#70CFF8","#94FADB","#B9F18D"])},getRandomName(){return NN.uid==0?ON(["\u6BB5\u8A89","\u6728\u5A49\u6E05","\u865A\u7AF9","\u674E\u6E05\u9732","\u6653\u857E","\u6BB5\u6B63\u660E","\u9EC4\u7709\u50E7","\u65E0\u5D16\u5B50","\u7384\u9EC4\u5B50","\u5353\u4E0D\u51E1","\u53F8\u9A6C\u6797","\u674E\u767D","\u9646\u6E38","\u674E\u6E05\u7167","\u675C\u752B","\u767D\u5C45\u6613","\u675C\u7267","\u82CF\u8F7C","\u738B\u5B89\u77F3","\u6768\u4E07\u91CC","\u5B5F\u6D69\u7136","\u8F9B\u5F03\u75BE","\u8303\u4EF2\u6DF9","\u738B\u7EF4","\u6B27\u9633\u4FEE"]):NN.name}},beforeUnmount(){this.editor.destroy(),this.provider.destroy()}},kV={key:0,class:"editor"},DV={class:"editor__footer"},LV=oR(" \u8FDE\u63A5\u4E2D\u2026\u2026 "),MV={class:"editor__name"};function PV(o,e,i,a,l,u){const f=gu("menu-bar"),g=gu("editor-content");return l.editor?(Nn(),Vi("div",kV,[Gi(f,{class:"editor__header",editor:l.editor},null,8,["editor"]),Gi(g,{class:"editor__content",editor:l.editor},null,8,["editor"]),Rr("div",DV,[Rr("div",{class:Ql(`editor__status editor__status--${l.status}`)},[l.status==="connected"?(Nn(),Vi(va,{key:0},[oR(mu(l.editor.storage.collaborationCursor.users.length)+" user"+mu(l.editor.storage.collaborationCursor.users.length===1?"":"s"),1)],64)):(Nn(),Vi(va,{key:1},[LV],64))],2),Rr("div",MV,[Rr("button",{onClick:e[0]||(e[0]=(..._)=>u.setName&&u.setName(..._))},mu(l.currentUser.name),1)])])])):Cm("",!0)}var BV=vu(OV,[["render",PV],["__scopeId","data-v-f9ecf2a6"]]);const UV={setup(o){const e=Au([{name:"\u97F3\u9891",value:0},{name:"\u89C6\u9891",value:1}]),i=Tc(0),a=l=>{i.value=l};return(l,u)=>(Nn(),Vl(gs(gM),{onChange:a},{default:Gl(()=>[Gi(gs(AM),{class:"flex p-1 space-x-1 bg-indigo-500 rounded-lg dark border dark:border-gray-600 transition"},{default:Gl(()=>[(Nn(!0),Vi(va,null,Im(gs(e),f=>(Nn(),Vl(gs(fM),{as:"template",key:f.value},{default:Gl(({selected:g})=>[Rr("button",{class:Ql(["w-full py-1 text-sm leading-5 font-mediumtext-white text-white font-bold rounded-md","focus:outline-none focus:ring-2 ring-offset-2 ring-offset-indigo-300",g?"bg-white shadow text-indigo-700":"hover:bg-white/[0.12]"])},mu(f.name),3)]),_:2},1024))),128))]),_:1})]),_:1}))}};const sc=o=>(sR("data-v-294d886e"),o=o(),aR(),o),xV={as:"nav",class:"bg-gray-800 rounded-b-md fixed top-0 w-full z-10"},FV={class:"max-w-7xl mx-auto px-2 sm:px-6 lg:px-8"},QV={class:"relative flex items-center justify-between h-16"},VV={class:"flex-1 flex items-center justify-center sm:justify-start"},GV={class:"absolute inset-y-0 inset-x-0 right-0 flex items-center px-2 sm:static sm:inset-auto sm:pr-0"},jV={class:"video-btn mr-4"},WV=sc(()=>Rr("span",{class:"sr-only"},"Open live",-1)),KV={class:"w-80"},HV=sc(()=>Rr("div",null,"\u656C\u8BF7\u671F\u5F85~",-1)),YV=sc(()=>Rr("hr",{class:"my-4"},null,-1)),qV={class:"flex items-center"},JV=sc(()=>Rr("div",{class:"w-24 text-right"},"\u5206\u4EAB\u6A21\u5F0F\uFF1A",-1)),zV={class:"w-40"},XV=sc(()=>Rr("button",{class:"close-btn"},"\u5173\u95ED",-1)),ZV=sc(()=>Rr("div",{class:"flex-grow"},null,-1)),$V=sc(()=>Rr("span",{class:"sr-only"},"Copy Share Link",-1)),t5=sc(()=>Rr("div",{class:"leave-btn"},"\u79BB\u5F00",-1)),e5={setup(o){const e=window.location.href,i=()=>{navigator.clipboard.writeText(e)};return(a,l)=>{const u=gu("Popover");return Nn(),Vi("nav",xV,[Rr("div",FV,[Rr("div",QV,[Rr("div",VV,[Gi(wc,{name:"logo",class:"h-8 w-8"})]),Rr("div",GV,[Gi(u,null,{content:Gl(()=>[Rr("div",KV,[HV,YV,Rr("div",qV,[JV,Rr("div",zV,[Gi(UV)]),XV])])]),default:Gl(()=>[Rr("button",jV,[WV,Gi(wc,{name:"toolbar-live",class:"h-6 w-6"})])]),_:1}),ZV,Rr("button",{title:"\u70B9\u51FB\u5206\u4EAB\u6B64\u623F\u95F4 share",class:"text-gray-300 hover:text-white cursor-pointer mr-4",onClick:i},[$V,Gi(wc,{name:"toolbar-share",class:"inline-block h-5 w-5"})]),t5])])])])}}};var r5=vu(e5,[["__scopeId","data-v-294d886e"]]);const n5=o=>(sR("data-v-16c6c8e9"),o=o(),aR(),o),i5={class:"z-10 absolute flex left-0 right-0 group-hover:bg-gray-800 text-white p-1 transition"},o5={class:"sm-btn w-5 bg-indigo-600 text-center overflow-hidden",title:"\u540D\u79F0"},s5=["title"],a5=["title"],c5=n5(()=>Rr("div",{class:"flex-1"},null,-1)),l5=["id","onClick"],d5={directives:{drag:{mounted(o){const e=window.getComputedStyle(o,null);o.onmousedown=i=>{const a=i.clientX,l=i.clientY,u=+e.right.replace(/\px/g,""),f=+e.bottom.replace(/\px/g,""),g=+e.width.replace(/\px/g,""),_=+e.height.replace(/\px/g,""),I=window.innerWidth,T=window.innerHeight;document.onmousemove=function(N){const D=N.clientX-a,F=N.clientY-l,K=u-D,J=f-F;K<0||J<0||K>I-g||J>T-_||(o.style.right=K+"px",o.style.bottom=J+"px")},document.onmouseup=function(N){document.onmousemove=null,document.onmouseup=null}}}}}},u5=Object.assign(d5,{props:{name:{type:String,default:"\u6211"},liveUser:{type:Object},className:{type:String,default:"h-[8rem] bottom-2"}},emits:["close","video","audio"],setup(o,{emit:e}){const i=o,a=Tc(null);mM(window,"resize",()=>{const u=window.getComputedStyle(a.value,null),f=+u.left.replace(/\px/g,""),g=+u.top.replace(/\px/g,"");(f<0||g<0)&&(a.value.style.right="8px",a.value.style.bottom="8px")});const l=()=>{};return cR(()=>{}),(u,f)=>{const g=EM("drag");return _M((Nn(),Vi("div",{ref_key:"target",ref:a,class:Ql(["fixed cursor-move min-w-[10rem] min-h-[2.5rem] right-2 select-none z-10 bg-gray-100 rounded overflow-hidden border-4 border-indigo-300 shadow-md hover:shadow-lg transition group",o.className]),style:IM(o.liveUser.hasOpenVideo?"":"height:0;")},[Rr("div",i5,[Rr("div",o5,mu(i.name[0]),1),Rr("button",{class:Ql(["sm-btn",o.liveUser.hasOpenVideo?"":"active"]),title:o.liveUser.hasOpenVideo?"\u505C\u6B62\u5F55\u50CF":"\u5F00\u59CB\u5F55\u50CF",onClick:f[0]||(f[0]=_=>u.$emit("video",o.name))},[Gi(wc,{name:"live-camera-off",class:"w-5 h-5"})],10,s5),Rr("button",{class:Ql(["sm-btn",o.liveUser.hasOpenAudio?"":"active"]),title:o.liveUser.hasOpenAudio?"\u505C\u6B62\u5F55\u97F3":"\u5F00\u59CB\u5F55\u97F3",onClick:f[1]||(f[1]=_=>u.$emit("audio",o.name))},[Gi(wc,{name:"live-mic-off",class:"w-5 h-5"})],10,a5),c5,Rr("button",{class:"close-btn",onClick:f[2]||(f[2]=_=>u.$emit("close",o.name)),title:"\u5173\u95ED"},[Gi(wc,{name:"close",class:"h-5 w-5"})])]),Rr("div",{class:"player",id:"player-"+o.liveUser.uid,onClick:vM(l,["stop"])},null,8,l5)],6)),[[g]])}}});var kN=vu(u5,[["__scopeId","data-v-16c6c8e9"]]),DN={exports:{}};(function(o,e){(function(i,a){o.exports=a()})(Sm,function(){var i=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof Sm!="undefined"?Sm:typeof self!="undefined"?self:{};function a(r,t,n){return r(n={path:t,exports:{},require:function(s,c){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(c==null&&n.path)}},n.exports),n.exports}var l=function(r){return r&&r.Math==Math&&r},u=l(typeof globalThis=="object"&&globalThis)||l(typeof window=="object"&&window)||l(typeof self=="object"&&self)||l(typeof i=="object"&&i)||Function("return this")(),f=function(r){try{return!!r()}catch{return!0}},g=!f(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7}),_={}.propertyIsEnumerable,I=Object.getOwnPropertyDescriptor,T={f:I&&!_.call({1:2},1)?function(r){var t=I(this,r);return!!t&&t.enumerable}:_},N=function(r,t){return{enumerable:!(1&r),configurable:!(2&r),writable:!(4&r),value:t}},D={}.toString,F=function(r){return D.call(r).slice(8,-1)},K="".split,J=f(function(){return!Object("z").propertyIsEnumerable(0)})?function(r){return F(r)=="String"?K.call(r,""):Object(r)}:Object,nt=function(r){if(r==null)throw TypeError("Can't call method on "+r);return r},it=function(r){return J(nt(r))},z=function(r){return typeof r=="object"?r!==null:typeof r=="function"},Ot=function(r,t){if(!z(r))return r;var n,s;if(t&&typeof(n=r.toString)=="function"&&!z(s=n.call(r))||typeof(n=r.valueOf)=="function"&&!z(s=n.call(r))||!t&&typeof(n=r.toString)=="function"&&!z(s=n.call(r)))return s;throw TypeError("Can't convert object to primitive value")},X={}.hasOwnProperty,yt=function(r,t){return X.call(r,t)},Mt=u.document,$t=z(Mt)&&z(Mt.createElement),ge=function(r){return $t?Mt.createElement(r):{}},Te=!g&&!f(function(){return Object.defineProperty(ge("div"),"a",{get:function(){return 7}}).a!=7}),Se=Object.getOwnPropertyDescriptor,lr={f:g?Se:function(r,t){if(r=it(r),t=Ot(t,!0),Te)try{return Se(r,t)}catch{}if(yt(r,t))return N(!T.f.call(r,t),r[t])}},Er=/#|\.prototype\./,sr=function(r,t){var n=br[Yn(r)];return n==_n||n!=$e&&(typeof t=="function"?f(t):!!t)},Yn=sr.normalize=function(r){return String(r).replace(Er,".").toLowerCase()},br=sr.data={},$e=sr.NATIVE="N",_n=sr.POLYFILL="P",Dn=sr,_e={},dn=function(r){if(typeof r!="function")throw TypeError(String(r)+" is not a function");return r},mi=function(r,t,n){if(dn(r),t===void 0)return r;switch(n){case 0:return function(){return r.call(t)};case 1:return function(s){return r.call(t,s)};case 2:return function(s,c){return r.call(t,s,c)};case 3:return function(s,c,d){return r.call(t,s,c,d)}}return function(){return r.apply(t,arguments)}},Nr=function(r){if(!z(r))throw TypeError(String(r)+" is not an object");return r},Ss=Object.defineProperty,un={f:g?Ss:function(r,t,n){if(Nr(r),t=Ot(t,!0),Nr(n),Te)try{return Ss(r,t,n)}catch{}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(r[t]=n.value),r}},tn=g?function(r,t,n){return un.f(r,t,N(1,n))}:function(r,t,n){return r[t]=n,r},es=lr.f,Oa=function(r){var t=function(n,s,c){if(this instanceof r){switch(arguments.length){case 0:return new r;case 1:return new r(n);case 2:return new r(n,s)}return new r(n,s,c)}return r.apply(this,arguments)};return t.prototype=r.prototype,t},qt=function(r,t){var n,s,c,d,h,p,A,m,E=r.target,v=r.global,C=r.stat,b=r.proto,y=v?u:C?u[E]:(u[E]||{}).prototype,w=v?_e:_e[E]||(_e[E]={}),k=w.prototype;for(c in t)n=!Dn(v?c:E+(C?".":"#")+c,r.forced)&&y&&yt(y,c),h=w[c],n&&(p=r.noTargetGet?(m=es(y,c))&&m.value:y[c]),d=n&&p?p:t[c],n&&typeof h==typeof d||(A=r.bind&&n?mi(d,u):r.wrap&&n?Oa(d):b&&typeof d=="function"?mi(Function.call,d):d,(r.sham||d&&d.sham||h&&h.sham)&&tn(A,"sham",!0),w[c]=A,b&&(yt(_e,s=E+"Prototype")||tn(_e,s,{}),_e[s][c]=d,r.real&&k&&!k[c]&&tn(k,c,d)))},ka=Math.ceil,ys=Math.floor,fo=function(r){return isNaN(r=+r)?0:(r>0?ys:ka)(r)},Hc=Math.min,Ln=function(r){return r>0?Hc(fo(r),9007199254740991):0},Yc=Math.max,qc=Math.min,Ao=function(r,t){var n=fo(r);return n<0?Yc(n+t,0):qc(n,t)},Da=function(r){return function(t,n,s){var c,d=it(t),h=Ln(d.length),p=Ao(s,h);if(r&&n!=n){for(;h>p;)if((c=d[p++])!=c)return!0}else for(;h>p;p++)if((r||p in d)&&d[p]===n)return r||p||0;return!r&&-1}},La={includes:Da(!0),indexOf:Da(!1)},rs={},ns=La.indexOf,is=function(r,t){var n,s=it(r),c=0,d=[];for(n in s)!yt(rs,n)&&yt(s,n)&&d.push(n);for(;t.length>c;)yt(s,n=t[c++])&&(~ns(d,n)||d.push(n));return d},Ts=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Ei=Object.keys||function(r){return is(r,Ts)},qs=g?Object.defineProperties:function(r,t){Nr(r);for(var n,s=Ei(t),c=s.length,d=0;c>d;)un.f(r,n=s[d++],t[n]);return r};qt({target:"Object",stat:!0,forced:!g,sham:!g},{defineProperties:qs});var He=a(function(r){var t=_e.Object,n=r.exports=function(s,c){return t.defineProperties(s,c)};t.defineProperties.sham&&(n.sham=!0)}),ac=function(r){return typeof r=="function"?r:void 0},qn=function(r,t){return arguments.length<2?ac(_e[r])||ac(u[r]):_e[r]&&_e[r][t]||u[r]&&u[r][t]},Js=qn("JSON","stringify"),jf=/[\uD800-\uDFFF]/g,ch=/^[\uD800-\uDBFF]$/,lh=/^[\uDC00-\uDFFF]$/,Wf=function(r,t,n){var s=n.charAt(t-1),c=n.charAt(t+1);return ch.test(r)&&!lh.test(c)||lh.test(r)&&!ch.test(s)?"\\u"+r.charCodeAt(0).toString(16):r},Kf=f(function(){return Js("\uDF06\uD834")!=='"\\udf06\\ud834"'||Js("\uDEAD")!=='"\\udead"'});Js&&qt({target:"JSON",stat:!0,forced:Kf},{stringify:function(r,t,n){var s=Js.apply(null,arguments);return typeof s=="string"?s.replace(jf,Wf):s}}),_e.JSON||(_e.JSON={stringify:JSON.stringify});var Rt,Xt,ht=function(r,t,n){return _e.JSON.stringify.apply(null,arguments)},tr=Array.isArray||function(r){return F(r)=="Array"},ve=function(r){return Object(nt(r))},hn=function(r,t,n){var s=Ot(t);s in r?un.f(r,s,N(0,n)):r[s]=n},Mi="__core-js_shared__",zs=u[Mi]||function(r,t){try{tn(u,r,t)}catch{u[r]=t}return t}(Mi,{}),Do=a(function(r){(r.exports=function(t,n){return zs[t]||(zs[t]=n!==void 0?n:{})})("versions",[]).push({version:"3.4.3",mode:"pure",copyright:"\xA9 2019 Denis Pushkarev (zloirock.ru)"})}),Xs=0,fd=Math.random(),Zs=function(r){return"Symbol("+String(r===void 0?"":r)+")_"+(++Xs+fd).toString(36)},si=!!Object.getOwnPropertySymbols&&!f(function(){return!String(Symbol())}),dh=si&&!Symbol.sham&&typeof Symbol()=="symbol",Ma=Do("wks"),Pa=u.Symbol,LN=dh?Pa:Zs,pn=function(r){return yt(Ma,r)||(si&&yt(Pa,r)?Ma[r]=Pa[r]:Ma[r]=LN("Symbol."+r)),Ma[r]},MN=pn("species"),Hf=function(r,t){var n;return tr(r)&&(typeof(n=r.constructor)!="function"||n!==Array&&!tr(n.prototype)?z(n)&&(n=n[MN])===null&&(n=void 0):n=void 0),new(n===void 0?Array:n)(t===0?0:t)},Jc=qn("navigator","userAgent")||"",N_=u.process,O_=N_&&N_.versions,k_=O_&&O_.v8;k_?Xt=(Rt=k_.split("."))[0]+Rt[1]:Jc&&(!(Rt=Jc.match(/Edge\/(\d+)/))||Rt[1]>=74)&&(Rt=Jc.match(/Chrome\/(\d+)/))&&(Xt=Rt[1]);var uh=Xt&&+Xt,PN=pn("species"),Ad=function(r){return uh>=51||!f(function(){var t=[];return(t.constructor={})[PN]=function(){return{foo:1}},t[r](Boolean).foo!==1})},D_=pn("isConcatSpreadable"),L_=9007199254740991,M_="Maximum allowed index exceeded",BN=uh>=51||!f(function(){var r=[];return r[D_]=!1,r.concat()[0]!==r}),UN=Ad("concat"),xN=function(r){if(!z(r))return!1;var t=r[D_];return t!==void 0?!!t:tr(r)};qt({target:"Array",proto:!0,forced:!BN||!UN},{concat:function(r){var t,n,s,c,d,h=ve(this),p=Hf(h,0),A=0;for(t=-1,s=arguments.length;t<s;t++)if(xN(d=t===-1?h:arguments[t])){if(A+(c=Ln(d.length))>L_)throw TypeError(M_);for(n=0;n<c;n++,A++)n in d&&hn(p,A,d[n])}else{if(A>=L_)throw TypeError(M_);hn(p,A++,d)}return p.length=A,p}});var Zr=function(r){return _e[r+"Prototype"]},FN=Zr("Array").concat,P_=Array.prototype,O=function(r){var t=r.concat;return r===P_||r instanceof Array&&t===P_.concat?FN:t},QN=!f(function(){return Object.isExtensible(Object.preventExtensions({}))}),hh=a(function(r){var t=un.f,n=Zs("meta"),s=0,c=Object.isExtensible||function(){return!0},d=function(p){t(p,n,{value:{objectID:"O"+ ++s,weakData:{}}})},h=r.exports={REQUIRED:!1,fastKey:function(p,A){if(!z(p))return typeof p=="symbol"?p:(typeof p=="string"?"S":"P")+p;if(!yt(p,n)){if(!c(p))return"F";if(!A)return"E";d(p)}return p[n].objectID},getWeakData:function(p,A){if(!yt(p,n)){if(!c(p))return!0;if(!A)return!1;d(p)}return p[n].weakData},onFreeze:function(p){return QN&&h.REQUIRED&&c(p)&&!yt(p,n)&&d(p),p}};rs[n]=!0}),$s={},VN=pn("iterator"),GN=Array.prototype,B_=function(r){return r!==void 0&&($s.Array===r||GN[VN]===r)},U_={};U_[pn("toStringTag")]="z";var ph,gd,fh,Yf=String(U_)==="[object z]",jN=pn("toStringTag"),WN=F(function(){return arguments}())=="Arguments",cc=Yf?F:function(r){var t,n,s;return r===void 0?"Undefined":r===null?"Null":typeof(n=function(c,d){try{return c[d]}catch{}}(t=Object(r),jN))=="string"?n:WN?F(t):(s=F(t))=="Object"&&typeof t.callee=="function"?"Arguments":s},KN=pn("iterator"),md=function(r){if(r!=null)return r[KN]||r["@@iterator"]||$s[cc(r)]},x_=function(r,t,n,s){try{return s?t(Nr(n)[0],n[1]):t(n)}catch(d){var c=r.return;throw c!==void 0&&Nr(c.call(r)),d}},Ba=a(function(r){var t=function(n,s){this.stopped=n,this.result=s};(r.exports=function(n,s,c,d,h){var p,A,m,E,v,C,b,y=mi(s,c,d?2:1);if(h)p=n;else{if(typeof(A=md(n))!="function")throw TypeError("Target is not iterable");if(B_(A)){for(m=0,E=Ln(n.length);E>m;m++)if((v=d?y(Nr(b=n[m])[0],b[1]):y(n[m]))&&v instanceof t)return v;return new t(!1)}p=A.call(n)}for(C=p.next;!(b=C.call(p)).done;)if(typeof(v=x_(p,y,b.value,d))=="object"&&v&&v instanceof t)return v;return new t(!1)}).stop=function(n){return new t(!0,n)}}),zc=function(r,t,n){if(!(r instanceof t))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return r},HN=Yf?{}.toString:function(){return"[object "+cc(this)+"]"},YN=un.f,F_=pn("toStringTag"),ta=function(r,t,n,s){if(r){var c=n?r:r.prototype;yt(c,F_)||YN(c,F_,{configurable:!0,value:t}),s&&!Yf&&tn(c,"toString",HN)}},qN=[].push,lc=function(r){var t=r==1,n=r==2,s=r==3,c=r==4,d=r==6,h=r==5||d;return function(p,A,m,E){for(var v,C,b=ve(p),y=J(b),w=mi(A,m,3),k=Ln(y.length),P=0,V=E||Hf,j=t?V(p,k):n?V(p,0):void 0;k>P;P++)if((h||P in y)&&(C=w(v=y[P],P,b),r)){if(t)j[P]=C;else if(C)switch(r){case 3:return!0;case 5:return v;case 6:return P;case 2:qN.call(j,v)}else if(c)return!1}return d?-1:s||c?c:j}},ss={forEach:lc(0),map:lc(1),filter:lc(2),some:lc(3),every:lc(4),find:lc(5),findIndex:lc(6)},JN=Do("native-function-to-string",Function.toString),Q_=u.WeakMap,V_=typeof Q_=="function"&&/native code/.test(JN.call(Q_)),G_=Do("keys"),Ah=function(r){return G_[r]||(G_[r]=Zs(r))},zN=u.WeakMap;if(V_){var Xc=new zN,XN=Xc.get,ZN=Xc.has,$N=Xc.set;ph=function(r,t){return $N.call(Xc,r,t),t},gd=function(r){return XN.call(Xc,r)||{}},fh=function(r){return ZN.call(Xc,r)}}else{var Ed=Ah("state");rs[Ed]=!0,ph=function(r,t){return tn(r,Ed,t),t},gd=function(r){return yt(r,Ed)?r[Ed]:{}},fh=function(r){return yt(r,Ed)}}var fn={set:ph,get:gd,has:fh,enforce:function(r){return fh(r)?gd(r):ph(r,{})},getterFor:function(r){return function(t){var n;if(!z(t)||(n=gd(t)).type!==r)throw TypeError("Incompatible receiver, "+r+" required");return n}}},tO=un.f,eO=ss.forEach,rO=fn.set,nO=fn.getterFor,j_=function(r,t,n){var s,c=r.indexOf("Map")!==-1,d=r.indexOf("Weak")!==-1,h=c?"set":"add",p=u[r],A=p&&p.prototype,m={};if(g&&typeof p=="function"&&(d||A.forEach&&!f(function(){new p().entries().next()}))){s=t(function(v,C){rO(zc(v,s,r),{type:r,collection:new p}),C!=null&&Ba(C,v[h],v,c)});var E=nO(r);eO(["add","clear","delete","forEach","get","has","set","keys","values","entries"],function(v){var C=v=="add"||v=="set";!(v in A)||d&&v=="clear"||tn(s.prototype,v,function(b,y){var w=E(this).collection;if(!C&&d&&!z(b))return v=="get"&&void 0;var k=w[v](b===0?0:b,y);return C?this:k})}),d||tO(s.prototype,"size",{configurable:!0,get:function(){return E(this).collection.size}})}else s=n.getConstructor(t,r,c,h),hh.REQUIRED=!0;return ta(s,r,!1,!0),m[r]=s,qt({global:!0,forced:!0},m),d||n.setStrong(s,r,c),s},qf=qn("document","documentElement"),W_=Ah("IE_PROTO"),Jf=function(){},gh=function(){var r,t=ge("iframe"),n=Ts.length;for(t.style.display="none",qf.appendChild(t),t.src=String("javascript:"),(r=t.contentWindow.document).open(),r.write("<script>document.F=Object<\/script>"),r.close(),gh=r.F;n--;)delete gh.prototype[Ts[n]];return gh()},Rs=Object.create||function(r,t){var n;return r!==null?(Jf.prototype=Nr(r),n=new Jf,Jf.prototype=null,n[W_]=r):n=gh(),t===void 0?n:qs(n,t)};rs[W_]=!0;var mh,K_,H_,ea=function(r,t,n,s){s&&s.enumerable?r[t]=n:tn(r,t,n)},dc=function(r,t,n){for(var s in t)n&&n.unsafe&&r[s]?r[s]=t[s]:ea(r,s,t[s],n);return r},Y_=!f(function(){function r(){}return r.prototype.constructor=null,Object.getPrototypeOf(new r)!==r.prototype}),q_=Ah("IE_PROTO"),iO=Object.prototype,Zc=Y_?Object.getPrototypeOf:function(r){return r=ve(r),yt(r,q_)?r[q_]:typeof r.constructor=="function"&&r instanceof r.constructor?r.constructor.prototype:r instanceof Object?iO:null},J_=(pn("iterator"),!1);[].keys&&("next"in(H_=[].keys())?(K_=Zc(Zc(H_)))!==Object.prototype&&(mh=K_):J_=!0),mh==null&&(mh={});var zf={IteratorPrototype:mh,BUGGY_SAFARI_ITERATORS:J_},oO=zf.IteratorPrototype,sO=function(){return this},z_=function(r,t,n){var s=t+" Iterator";return r.prototype=Rs(oO,{next:N(1,n)}),ta(r,s,!1,!0),$s[s]=sO,r},Xf=Object.setPrototypeOf||("__proto__"in{}?function(){var r,t=!1,n={};try{(r=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),t=n instanceof Array}catch{}return function(s,c){return Nr(s),function(d){if(!z(d)&&d!==null)throw TypeError("Can't set "+String(d)+" as a prototype")}(c),t?r.call(s,c):s.__proto__=c,s}}():void 0),aO=zf.IteratorPrototype,Eh=zf.BUGGY_SAFARI_ITERATORS,Zf=pn("iterator"),X_="keys",_h="values",Z_="entries",cO=function(){return this},$f=function(r,t,n,s,c,d,h){z_(n,t,s);var p,A,m,E=function(P){if(P===c&&w)return w;if(!Eh&&P in b)return b[P];switch(P){case X_:case _h:case Z_:return function(){return new n(this,P)}}return function(){return new n(this)}},v=t+" Iterator",C=!1,b=r.prototype,y=b[Zf]||b["@@iterator"]||c&&b[c],w=!Eh&&y||E(c),k=t=="Array"&&b.entries||y;if(k&&(p=Zc(k.call(new r)),aO!==Object.prototype&&p.next&&(ta(p,v,!0,!0),$s[v]=cO)),c==_h&&y&&y.name!==_h&&(C=!0,w=function(){return y.call(this)}),h&&b[Zf]!==w&&tn(b,Zf,w),$s[t]=w,c)if(A={values:E(_h),keys:d?w:E(X_),entries:E(Z_)},h)for(m in A)(Eh||C||!(m in b))&&ea(b,m,A[m]);else qt({target:t,proto:!0,forced:Eh||C},A);return A},$_=pn("species"),tv=function(r){var t=qn(r),n=un.f;g&&t&&!t[$_]&&n(t,$_,{configurable:!0,get:function(){return this}})},lO=un.f,ev=hh.fastKey,rv=fn.set,tA=fn.getterFor,nv=(j_("Map",function(r){return function(){return r(this,arguments.length?arguments[0]:void 0)}},{getConstructor:function(r,t,n,s){var c=r(function(A,m){zc(A,c,t),rv(A,{type:t,index:Rs(null),first:void 0,last:void 0,size:0}),g||(A.size=0),m!=null&&Ba(m,A[s],A,n)}),d=tA(t),h=function(A,m,E){var v,C,b=d(A),y=p(A,m);return y?y.value=E:(b.last=y={index:C=ev(m,!0),key:m,value:E,previous:v=b.last,next:void 0,removed:!1},b.first||(b.first=y),v&&(v.next=y),g?b.size++:A.size++,C!=="F"&&(b.index[C]=y)),A},p=function(A,m){var E,v=d(A),C=ev(m);if(C!=="F")return v.index[C];for(E=v.first;E;E=E.next)if(E.key==m)return E};return dc(c.prototype,{clear:function(){for(var A=d(this),m=A.index,E=A.first;E;)E.removed=!0,E.previous&&(E.previous=E.previous.next=void 0),delete m[E.index],E=E.next;A.first=A.last=void 0,g?A.size=0:this.size=0},delete:function(A){var m=this,E=d(m),v=p(m,A);if(v){var C=v.next,b=v.previous;delete E.index[v.index],v.removed=!0,b&&(b.next=C),C&&(C.previous=b),E.first==v&&(E.first=C),E.last==v&&(E.last=b),g?E.size--:m.size--}return!!v},forEach:function(A){for(var m,E=d(this),v=mi(A,arguments.length>1?arguments[1]:void 0,3);m=m?m.next:E.first;)for(v(m.value,m.key,this);m&&m.removed;)m=m.previous},has:function(A){return!!p(this,A)}}),dc(c.prototype,n?{get:function(A){var m=p(this,A);return m&&m.value},set:function(A,m){return h(this,A===0?0:A,m)}}:{add:function(A){return h(this,A=A===0?0:A,A)}}),g&&lO(c.prototype,"size",{get:function(){return d(this).size}}),c},setStrong:function(r,t,n){var s=t+" Iterator",c=tA(t),d=tA(s);$f(r,t,function(h,p){rv(this,{type:s,target:h,state:c(h),kind:p,last:void 0})},function(){for(var h=d(this),p=h.kind,A=h.last;A&&A.removed;)A=A.previous;return h.target&&(h.last=A=A?A.next:h.state.first)?p=="keys"?{value:A.key,done:!1}:p=="values"?{value:A.value,done:!1}:{value:[A.key,A.value],done:!1}:(h.target=void 0,{value:void 0,done:!0})},n?"entries":"values",!n,!0),tv(t)}}),function(r){return function(t,n){var s,c,d=String(nt(t)),h=fo(n),p=d.length;return h<0||h>=p?r?"":void 0:(s=d.charCodeAt(h))<55296||s>56319||h+1===p||(c=d.charCodeAt(h+1))<56320||c>57343?r?d.charAt(h):s:r?d.slice(h,h+2):c-56320+(s-55296<<10)+65536}}),iv={codeAt:nv(!1),charAt:nv(!0)},dO=iv.charAt,ov="String Iterator",uO=fn.set,hO=fn.getterFor(ov);$f(String,"String",function(r){uO(this,{type:ov,string:String(r),index:0})},function(){var r,t=hO(this),n=t.string,s=t.index;return s>=n.length?{value:void 0,done:!0}:(r=dO(n,s),t.index+=r.length,{value:r,done:!1})});var sv="Array Iterator",pO=fn.set,fO=fn.getterFor(sv);$f(Array,"Array",function(r,t){pO(this,{type:sv,target:it(r),index:0,kind:t})},function(){var r=fO(this),t=r.target,n=r.kind,s=r.index++;return!t||s>=t.length?(r.target=void 0,{value:void 0,done:!0}):n=="keys"?{value:s,done:!1}:n=="values"?{value:t[s],done:!1}:{value:[s,t[s]],done:!1}},"values"),$s.Arguments=$s.Array;var av=pn("toStringTag");for(var eA in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}){var cv=u[eA],rA=cv&&cv.prototype;rA&&!rA[av]&&tn(rA,av,eA),$s[eA]=$s.Array}var re=_e.Map,AO=pn("match"),nA=function(r){if(function(t){var n;return z(t)&&((n=t[AO])!==void 0?!!n:F(t)=="RegExp")}(r))throw TypeError("The method doesn't accept regular expressions");return r},gO=pn("match"),iA=function(r){var t=/./;try{"/./"[r](t)}catch{try{return t[gO]=!1,"/./"[r](t)}catch{}}return!1},lv="".endsWith,mO=Math.min,EO=iA("endsWith");qt({target:"String",proto:!0,forced:!EO},{endsWith:function(r){var t=String(nt(this));nA(r);var n=arguments.length>1?arguments[1]:void 0,s=Ln(t.length),c=n===void 0?s:mO(Ln(n),s),d=String(r);return lv?lv.call(t,d,c):t.slice(c-d.length,c)===d}});var _O=Zr("String").endsWith,dv=String.prototype,uv=function(r){var t=r.endsWith;return typeof r=="string"||r===dv||r instanceof String&&t===dv.endsWith?_O:t},uc=function(r,t){var n=[][r];return!n||!f(function(){n.call(null,t||function(){throw 1},1)})},vO=ss.forEach,hv=uc("forEach")?function(r){return vO(this,r,arguments.length>1?arguments[1]:void 0)}:[].forEach;qt({target:"Array",proto:!0,forced:[].forEach!=hv},{forEach:hv});var IO=Zr("Array").forEach,pv=Array.prototype,CO={DOMTokenList:!0,NodeList:!0},G=function(r){var t=r.forEach;return r===pv||r instanceof Array&&t===pv.forEach||CO.hasOwnProperty(cc(r))?IO:t},_d={f:Object.getOwnPropertySymbols},vh=Object.assign,vd=!vh||f(function(){var r={},t={},n=Symbol(),s="abcdefghijklmnopqrst";return r[n]=7,s.split("").forEach(function(c){t[c]=c}),vh({},r)[n]!=7||Ei(vh({},t)).join("")!=s})?function(r,t){for(var n=ve(r),s=arguments.length,c=1,d=_d.f,h=T.f;s>c;)for(var p,A=J(arguments[c++]),m=d?Ei(A).concat(d(A)):Ei(A),E=m.length,v=0;E>v;)p=m[v++],g&&!h.call(A,p)||(n[p]=A[p]);return n}:vh;qt({target:"Object",stat:!0,forced:Object.assign!==vd},{assign:vd});var hr=_e.Object.assign,SO=f(function(){Ei(1)});qt({target:"Object",stat:!0,forced:SO},{keys:function(r){return Ei(ve(r))}});var le=_e.Object.keys,fv=function(r){return function(t,n,s,c){dn(n);var d=ve(t),h=J(d),p=Ln(d.length),A=r?p-1:0,m=r?-1:1;if(s<2)for(;;){if(A in h){c=h[A],A+=m;break}if(A+=m,r?A<0:p<=A)throw TypeError("Reduce of empty array with no initial value")}for(;r?A>=0:p>A;A+=m)A in h&&(c=n(c,h[A],A,d));return c}},yO={left:fv(!1),right:fv(!0)}.left;qt({target:"Array",proto:!0,forced:uc("reduce")},{reduce:function(r){return yO(this,r,arguments.length,arguments.length>1?arguments[1]:void 0)}});var TO=Zr("Array").reduce,Av=Array.prototype,Ih=function(r){var t=r.reduce;return r===Av||r instanceof Array&&t===Av.reduce?TO:t};qt({target:"Object",stat:!0,forced:!g,sham:!g},{defineProperty:un.f});var gv=a(function(r){var t=_e.Object,n=r.exports=function(s,c,d){return t.defineProperty(s,c,d)};t.defineProperty.sham&&(n.sham=!0)}),se=gv,Id=`	
\v\f\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF`,Ch="["+Id+"]",RO=RegExp("^"+Ch+Ch+"*"),wO=RegExp(Ch+Ch+"*$"),oA=function(r){return function(t){var n=String(nt(t));return 1&r&&(n=n.replace(RO,"")),2&r&&(n=n.replace(wO,"")),n}},mv={start:oA(1),end:oA(2),trim:oA(3)},bO=mv.trim,Sh=u.parseInt,NO=/^[+-]?0[Xx]/,Ev=Sh(Id+"08")!==8||Sh(Id+"0x16")!==22?function(r,t){var n=bO(String(r));return Sh(n,t>>>0||(NO.test(n)?16:10))}:Sh;qt({global:!0,forced:parseInt!=Ev},{parseInt:Ev});var Sr=_e.parseInt;let _v=!0,vv=!0;function Cd(r,t,n){const s=r.match(t);return s&&s.length>=n&&Sr(s[n],10)}function $c(r,t,n){if(!r.RTCPeerConnection)return;const s=r.RTCPeerConnection.prototype,c=s.addEventListener;s.addEventListener=function(h,p){if(h!==t)return c.apply(this,arguments);const A=m=>{const E=n(m);E&&p(E)};return this._eventMap=this._eventMap||{},this._eventMap[p]=A,c.apply(this,[h,A])};const d=s.removeEventListener;s.removeEventListener=function(h,p){if(h!==t||!this._eventMap||!this._eventMap[p])return d.apply(this,arguments);const A=this._eventMap[p];return delete this._eventMap[p],d.apply(this,[h,A])},se(s,"on"+t,{get(){return this["_on"+t]},set(h){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),h&&this.addEventListener(t,this["_on"+t]=h)},enumerable:!0,configurable:!0})}function OO(r){return typeof r!="boolean"?new Error("Argument type: "+typeof r+". Please use a boolean."):(_v=r,r?"adapter.js logging disabled":"adapter.js logging enabled")}function kO(r){return typeof r!="boolean"?new Error("Argument type: "+typeof r+". Please use a boolean."):(vv=!r,"adapter.js deprecation warnings "+(r?"disabled":"enabled"))}function sA(){if(typeof window=="object"){if(_v)return;typeof console!="undefined"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function yh(r,t){vv&&console.warn(r+" is deprecated, please use "+t+" instead.")}function ra(r){const{navigator:t}=r,n={browser:null,version:null};if(r===void 0||!r.navigator)return n.browser="Not a browser.",n;if(t.mozGetUserMedia)n.browser="firefox",n.version=Cd(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||r.isSecureContext===!1&&r.webkitRTCPeerConnection&&!r.RTCIceGatherer)n.browser="chrome",n.version=Cd(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))n.browser="edge",n.version=Cd(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!r.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return n.browser="Not a supported browser.",n;n.browser="safari",n.version=Cd(t.userAgent,/AppleWebKit\/(\d+)\./,1),n.supportsUnifiedPlan=r.RTCRtpTransceiver&&"currentDirection"in r.RTCRtpTransceiver.prototype}return n}function Iv(r){return Object.prototype.toString.call(r)==="[object Object]"}function Cv(r){var t;return Iv(r)?Ih(t=le(r)).call(t,function(n,s){const c=Iv(r[s]),d=c?Cv(r[s]):r[s],h=c&&!le(d).length;return d===void 0||h?n:hr(n,{[s]:d})},{}):r}function Sv(r,t,n){const s=n?"outbound-rtp":"inbound-rtp",c=new re;if(t===null)return c;const d=[];return G(r).call(r,h=>{h.type==="track"&&h.trackIdentifier===t.id&&d.push(h)}),G(d).call(d,h=>{G(r).call(r,p=>{p.type===s&&p.trackId===h.id&&function A(m,E,v){var C;E&&!v.has(E.id)&&(v.set(E.id,E),G(C=le(E)).call(C,b=>{if(uv(b).call(b,"Id"))A(m,m.get(E[b]),v);else if(uv(b).call(b,"Ids")){var y;G(y=E[b]).call(y,w=>{A(m,m.get(w),v)})}}))}(r,p,c)})}),c}var yv=lr.f,DO=f(function(){yv(1)});qt({target:"Object",stat:!0,forced:!g||DO,sham:!g},{getOwnPropertyDescriptor:function(r,t){return yv(it(r),t)}});var Wt=a(function(r){var t=_e.Object,n=r.exports=function(s,c){return t.getOwnPropertyDescriptor(s,c)};t.getOwnPropertyDescriptor.sham&&(n.sham=!0)}),LO=ss.filter;qt({target:"Array",proto:!0,forced:!Ad("filter")},{filter:function(r){return LO(this,r,arguments.length>1?arguments[1]:void 0)}});var MO=Zr("Array").filter,Tv=Array.prototype,kt=function(r){var t=r.filter;return r===Tv||r instanceof Array&&t===Tv.filter?MO:t},PO=u.Promise,Rv=pn("iterator"),wv=!1;try{var BO=0,bv={next:function(){return{done:!!BO++}},return:function(){wv=!0}};bv[Rv]=function(){return this},Array.from(bv,function(){throw 2})}catch{}var tl,Nv,aA,Ov=function(r,t){if(!t&&!wv)return!1;var n=!1;try{var s={};s[Rv]=function(){return{next:function(){return{done:n=!0}}}},r(s)}catch{}return n},UO=pn("species"),kv=function(r,t){var n,s=Nr(r).constructor;return s===void 0||(n=Nr(s)[UO])==null?t:dn(n)},Dv=/(iphone|ipod|ipad).*applewebkit/i.test(Jc),Lv=u.location,cA=u.setImmediate,lA=u.clearImmediate,Mv=u.process,Pv=u.MessageChannel,dA=u.Dispatch,uA=0,Sd={},xO="onreadystatechange",hA=function(r){if(Sd.hasOwnProperty(r)){var t=Sd[r];delete Sd[r],t()}},pA=function(r){return function(){hA(r)}},Bv=function(r){hA(r.data)},Uv=function(r){u.postMessage(r+"",Lv.protocol+"//"+Lv.host)};cA&&lA||(cA=function(r){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return Sd[++uA]=function(){(typeof r=="function"?r:Function(r)).apply(void 0,t)},tl(uA),uA},lA=function(r){delete Sd[r]},F(Mv)=="process"?tl=function(r){Mv.nextTick(pA(r))}:dA&&dA.now?tl=function(r){dA.now(pA(r))}:Pv&&!Dv?(aA=(Nv=new Pv).port2,Nv.port1.onmessage=Bv,tl=mi(aA.postMessage,aA,1)):!u.addEventListener||typeof postMessage!="function"||u.importScripts||f(Uv)?tl=xO in ge("script")?function(r){qf.appendChild(ge("script")).onreadystatechange=function(){qf.removeChild(this),hA(r)}}:function(r){setTimeout(pA(r),0)}:(tl=Uv,u.addEventListener("message",Bv,!1)));var yd,hc,Td,el,fA,AA,gA,xv,Fv={set:cA,clear:lA},FO=lr.f,QO=Fv.set,Qv=u.MutationObserver||u.WebKitMutationObserver,mA=u.process,EA=u.Promise,Vv=F(mA)=="process",Gv=FO(u,"queueMicrotask"),jv=Gv&&Gv.value;jv||(yd=function(){var r,t;for(Vv&&(r=mA.domain)&&r.exit();hc;){t=hc.fn,hc=hc.next;try{t()}catch(n){throw hc?el():Td=void 0,n}}Td=void 0,r&&r.enter()},Vv?el=function(){mA.nextTick(yd)}:Qv&&!Dv?(fA=!0,AA=document.createTextNode(""),new Qv(yd).observe(AA,{characterData:!0}),el=function(){AA.data=fA=!fA}):EA&&EA.resolve?(gA=EA.resolve(void 0),xv=gA.then,el=function(){xv.call(gA,yd)}):el=function(){QO.call(u,yd)});var _A,Wv,vA,Kv=jv||function(r){var t={fn:r,next:void 0};Td&&(Td.next=t),hc||(hc=t,el()),Td=t},VO=function(r){var t,n;this.promise=new r(function(s,c){if(t!==void 0||n!==void 0)throw TypeError("Bad Promise constructor");t=s,n=c}),this.resolve=dn(t),this.reject=dn(n)},rl={f:function(r){return new VO(r)}},IA=function(r,t){if(Nr(r),z(t)&&t.constructor===r)return t;var n=rl.f(r);return(0,n.resolve)(t),n.promise},nl=function(r){try{return{error:!1,value:r()}}catch(t){return{error:!0,value:t}}},Hv=Fv.set,GO=pn("species"),ws="Promise",Yv=fn.get,jO=fn.set,WO=fn.getterFor(ws),Xi=PO,qv=u.TypeError,CA=u.document,Th=u.process,KO=Do("inspectSource"),il=(qn("fetch"),rl.f),HO=il,Rd=F(Th)=="process",YO=!!(CA&&CA.createEvent&&u.dispatchEvent),Jv="unhandledrejection",Rh=Dn(ws,function(){if(KO(Xi)===String(Xi)&&(uh===66||!Rd&&typeof PromiseRejectionEvent!="function")||!Xi.prototype.finally)return!0;if(uh>=51&&/native code/.test(Xi))return!1;var r=Xi.resolve(1),t=function(n){n(function(){},function(){})};return(r.constructor={})[GO]=t,!(r.then(function(){})instanceof t)}),qO=Rh||!Ov(function(r){Xi.all(r).catch(function(){})}),zv=function(r){var t;return!(!z(r)||typeof(t=r.then)!="function")&&t},SA=function(r,t,n){if(!t.notified){t.notified=!0;var s=t.reactions;Kv(function(){for(var c=t.value,d=t.state==1,h=0;s.length>h;){var p,A,m,E=s[h++],v=d?E.ok:E.fail,C=E.resolve,b=E.reject,y=E.domain;try{v?(d||(t.rejection===2&&zO(r,t),t.rejection=1),v===!0?p=c:(y&&y.enter(),p=v(c),y&&(y.exit(),m=!0)),p===E.promise?b(qv("Promise-chain cycle")):(A=zv(p))?A.call(p,C,b):C(p)):b(c)}catch(w){y&&!m&&y.exit(),b(w)}}t.reactions=[],t.notified=!1,n&&!t.rejection&&JO(r,t)})}},Xv=function(r,t,n){var s,c;YO?((s=CA.createEvent("Event")).promise=t,s.reason=n,s.initEvent(r,!1,!0),u.dispatchEvent(s)):s={promise:t,reason:n},(c=u["on"+r])?c(s):r===Jv&&function(d,h){var p=u.console;p&&p.error&&(arguments.length===1?p.error(d):p.error(d,h))}("Unhandled promise rejection",n)},JO=function(r,t){Hv.call(u,function(){var n,s=t.value;if(Zv(t)&&(n=nl(function(){Rd?Th.emit("unhandledRejection",s,r):Xv(Jv,r,s)}),t.rejection=Rd||Zv(t)?2:1,n.error))throw n.value})},Zv=function(r){return r.rejection!==1&&!r.parent},zO=function(r,t){Hv.call(u,function(){Rd?Th.emit("rejectionHandled",r):Xv("rejectionhandled",r,t.value)})},ol=function(r,t,n,s){return function(c){r(t,n,c,s)}},sl=function(r,t,n,s){t.done||(t.done=!0,s&&(t=s),t.value=n,t.state=2,SA(r,t,!0))},yA=function(r,t,n,s){if(!t.done){t.done=!0,s&&(t=s);try{if(r===n)throw qv("Promise can't be resolved itself");var c=zv(n);c?Kv(function(){var d={done:!1};try{c.call(n,ol(yA,r,d,t),ol(sl,r,d,t))}catch(h){sl(r,d,h,t)}}):(t.value=n,t.state=1,SA(r,t,!1))}catch(d){sl(r,{done:!1},d,t)}}};Rh&&(Xi=function(r){zc(this,Xi,ws),dn(r),_A.call(this);var t=Yv(this);try{r(ol(yA,this,t),ol(sl,this,t))}catch(n){sl(this,t,n)}},(_A=function(r){jO(this,{type:ws,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=dc(Xi.prototype,{then:function(r,t){var n=WO(this),s=il(kv(this,Xi));return s.ok=typeof r!="function"||r,s.fail=typeof t=="function"&&t,s.domain=Rd?Th.domain:void 0,n.parent=!0,n.reactions.push(s),n.state!=0&&SA(this,n,!1),s.promise},catch:function(r){return this.then(void 0,r)}}),Wv=function(){var r=new _A,t=Yv(r);this.promise=r,this.resolve=ol(yA,r,t),this.reject=ol(sl,r,t)},rl.f=il=function(r){return r===Xi||r===vA?new Wv(r):HO(r)}),qt({global:!0,wrap:!0,forced:Rh},{Promise:Xi}),ta(Xi,ws,!1,!0),tv(ws),vA=qn(ws),qt({target:ws,stat:!0,forced:Rh},{reject:function(r){var t=il(this);return t.reject.call(void 0,r),t.promise}}),qt({target:ws,stat:!0,forced:!0},{resolve:function(r){return IA(this===vA?Xi:this,r)}}),qt({target:ws,stat:!0,forced:qO},{all:function(r){var t=this,n=il(t),s=n.resolve,c=n.reject,d=nl(function(){var h=dn(t.resolve),p=[],A=0,m=1;Ba(r,function(E){var v=A++,C=!1;p.push(void 0),m++,h.call(t,E).then(function(b){C||(C=!0,p[v]=b,--m||s(p))},c)}),--m||s(p)});return d.error&&c(d.value),n.promise},race:function(r){var t=this,n=il(t),s=n.reject,c=nl(function(){var d=dn(t.resolve);Ba(r,function(h){d.call(t,h).then(n.resolve,s)})});return c.error&&s(c.value),n.promise}}),qt({target:"Promise",stat:!0},{allSettled:function(r){var t=this,n=rl.f(t),s=n.resolve,c=n.reject,d=nl(function(){var h=dn(t.resolve),p=[],A=0,m=1;Ba(r,function(E){var v=A++,C=!1;p.push(void 0),m++,h.call(t,E).then(function(b){C||(C=!0,p[v]={status:"fulfilled",value:b},--m||s(p))},function(b){C||(C=!0,p[v]={status:"rejected",reason:b},--m||s(p))})}),--m||s(p)});return d.error&&c(d.value),n.promise}}),qt({target:"Promise",proto:!0,real:!0},{finally:function(r){var t=kv(this,qn("Promise")),n=typeof r=="function";return this.then(n?function(s){return IA(t,r()).then(function(){return s})}:r,n?function(s){return IA(t,r()).then(function(){throw s})}:r)}});var $v=_e.Promise,dt=$v,XO=ss.map;qt({target:"Array",proto:!0,forced:!Ad("map")},{map:function(r){return XO(this,r,arguments.length>1?arguments[1]:void 0)}});var ZO=Zr("Array").map,tI=Array.prototype,ft=function(r){var t=r.map;return r===tI||r instanceof Array&&t===tI.map?ZO:t},$O=Math.max,t2=Math.min,e2=9007199254740991,r2="Maximum allowed length exceeded";qt({target:"Array",proto:!0,forced:!Ad("splice")},{splice:function(r,t){var n,s,c,d,h,p,A=ve(this),m=Ln(A.length),E=Ao(r,m),v=arguments.length;if(v===0?n=s=0:v===1?(n=0,s=m-E):(n=v-2,s=t2($O(fo(t),0),m-E)),m+n-s>e2)throw TypeError(r2);for(c=Hf(A,s),d=0;d<s;d++)(h=E+d)in A&&hn(c,d,A[h]);if(c.length=s,n<s){for(d=E;d<m-s;d++)p=d+n,(h=d+s)in A?A[p]=A[h]:delete A[p];for(d=m;d>m-s+n;d--)delete A[d-1]}else if(n>s)for(d=m-s;d>E;d--)p=d+n-1,(h=d+s-1)in A?A[p]=A[h]:delete A[p];for(d=0;d<n;d++)A[d+E]=arguments[d+2];return A.length=m-s+n,c}});var n2=Zr("Array").splice,eI=Array.prototype,Ye=function(r){var t=r.splice;return r===eI||r instanceof Array&&t===eI.splice?n2:t},i2=La.indexOf,rI=[].indexOf,nI=!!rI&&1/[1].indexOf(1,-0)<0,o2=uc("indexOf");qt({target:"Array",proto:!0,forced:nI||o2},{indexOf:function(r){return nI?rI.apply(this,arguments)||0:i2(this,r,arguments.length>1?arguments[1]:void 0)}});var s2=Zr("Array").indexOf,iI=Array.prototype,Ft=function(r){var t=r.indexOf;return r===iI||r instanceof Array&&t===iI.indexOf?s2:t},a2=pn("species"),c2=[].slice,l2=Math.max;qt({target:"Array",proto:!0,forced:!Ad("slice")},{slice:function(r,t){var n,s,c,d=it(this),h=Ln(d.length),p=Ao(r,h),A=Ao(t===void 0?h:t,h);if(tr(d)&&(typeof(n=d.constructor)!="function"||n!==Array&&!tr(n.prototype)?z(n)&&(n=n[a2])===null&&(n=void 0):n=void 0,n===Array||n===void 0))return c2.call(d,p,A);for(s=new(n===void 0?Array:n)(l2(A-p,0)),c=0;p<A;p++,c++)p in d&&hn(s,c,d[p]);return s.length=c,s}});var d2=Zr("Array").slice,oI=Array.prototype,en=function(r){var t=r.slice;return r===oI||r instanceof Array&&t===oI.slice?d2:t},u2=ss.find,h2="find",sI=!0;h2 in[]&&Array(1).find(function(){sI=!1}),qt({target:"Array",proto:!0,forced:sI},{find:function(r){return u2(this,r,arguments.length>1?arguments[1]:void 0)}});var p2=Zr("Array").find,aI=Array.prototype,_t=function(r){var t=r.find;return r===aI||r instanceof Array&&t===aI.find?p2:t},cI=[].slice,TA={},f2=function(r,t,n){if(!(t in TA)){for(var s=[],c=0;c<t;c++)s[c]="a["+c+"]";TA[t]=Function("C,a","return new C("+s.join(",")+")")}return TA[t](r,n)},A2=Function.bind||function(r){var t=dn(this),n=cI.call(arguments,1),s=function(){var c=n.concat(cI.call(arguments));return this instanceof s?f2(t,c.length,c):t.apply(r,c)};return z(t.prototype)&&(s.prototype=t.prototype),s};qt({target:"Function",proto:!0},{bind:A2});var g2=Zr("Function").bind,lI=Function.prototype,Mr=function(r){var t=r.bind;return r===lI||r instanceof Function&&t===lI.bind?g2:t},m2=La.includes;qt({target:"Array",proto:!0},{includes:function(r){return m2(this,r,arguments.length>1?arguments[1]:void 0)}});var E2=Zr("Array").includes;qt({target:"String",proto:!0,forced:!iA("includes")},{includes:function(r){return!!~String(nt(this)).indexOf(nA(r),arguments.length>1?arguments[1]:void 0)}});var _2=Zr("String").includes,dI=Array.prototype,uI=String.prototype,zt=function(r){var t=r.includes;return r===dI||r instanceof Array&&t===dI.includes?E2:typeof r=="string"||r===uI||r instanceof String&&t===uI.includes?_2:t},v2=ss.some;qt({target:"Array",proto:!0,forced:uc("some")},{some:function(r){return v2(this,r,arguments.length>1?arguments[1]:void 0)}});var I2=Zr("Array").some,hI=Array.prototype,bs=function(r){var t=r.some;return r===hI||r instanceof Array&&t===hI.some?I2:t};const pI=sA;function fI(r){const t=r&&r.navigator;if(!t.mediaDevices)return;const n=ra(r),s=function(A){var m;if(typeof A!="object"||A.mandatory||A.optional)return A;const E={};var v;return G(m=le(A)).call(m,C=>{if(C==="require"||C==="advanced"||C==="mediaSource")return;const b=typeof A[C]=="object"?A[C]:{ideal:A[C]};b.exact!==void 0&&typeof b.exact=="number"&&(b.min=b.max=b.exact);const y=function(k,P){return k?k+P.charAt(0).toUpperCase()+en(P).call(P,1):P==="deviceId"?"sourceId":P};if(b.ideal!==void 0){E.optional=E.optional||[];let k={};typeof b.ideal=="number"?(k[y("min",C)]=b.ideal,E.optional.push(k),k={},k[y("max",C)]=b.ideal,E.optional.push(k)):(k[y("",C)]=b.ideal,E.optional.push(k))}var w;b.exact!==void 0&&typeof b.exact!="number"?(E.mandatory=E.mandatory||{},E.mandatory[y("",C)]=b.exact):G(w=["min","max"]).call(w,k=>{b[k]!==void 0&&(E.mandatory=E.mandatory||{},E.mandatory[y(k,C)]=b[k])})}),A.advanced&&(E.optional=O(v=E.optional||[]).call(v,A.advanced)),E},c=function(A,m){if(n.version>=61)return m(A);if((A=JSON.parse(ht(A)))&&typeof A.audio=="object"){const E=function(v,C,b){C in v&&!(b in v)&&(v[b]=v[C],delete v[C])};E((A=JSON.parse(ht(A))).audio,"autoGainControl","googAutoGainControl"),E(A.audio,"noiseSuppression","googNoiseSuppression"),A.audio=s(A.audio)}if(A&&typeof A.video=="object"){let E=A.video.facingMode;E=E&&(typeof E=="object"?E:{ideal:E});const v=n.version<66;if(E&&(E.exact==="user"||E.exact==="environment"||E.ideal==="user"||E.ideal==="environment")&&(!t.mediaDevices.getSupportedConstraints||!t.mediaDevices.getSupportedConstraints().facingMode||v)){let C;if(delete A.video.facingMode,E.exact==="environment"||E.ideal==="environment"?C=["back","rear"]:E.exact!=="user"&&E.ideal!=="user"||(C=["front"]),C)return t.mediaDevices.enumerateDevices().then(b=>{b=kt(b).call(b,w=>w.kind==="videoinput");let y=_t(b).call(b,w=>bs(C).call(C,k=>{var P;return zt(P=w.label.toLowerCase()).call(P,k)}));return!y&&b.length&&zt(C).call(C,"back")&&(y=b[b.length-1]),y&&(A.video.deviceId=E.exact?{exact:y.deviceId}:{ideal:y.deviceId}),A.video=s(A.video),pI("chrome: "+ht(A)),m(A)})}A.video=s(A.video)}return pI("chrome: "+ht(A)),m(A)},d=function(A){return n.version>=64?A:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[A.name]||A.name,message:A.message,constraint:A.constraint||A.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},h=function(A,m,E){c(A,v=>{t.webkitGetUserMedia(v,m,C=>{E&&E(d(C))})})};if(t.getUserMedia=Mr(h).call(h,t),t.mediaDevices.getUserMedia){var p;const A=Mr(p=t.mediaDevices.getUserMedia).call(p,t.mediaDevices);t.mediaDevices.getUserMedia=function(m){return c(m,E=>A(E).then(v=>{var C;if(E.audio&&!v.getAudioTracks().length||E.video&&!v.getVideoTracks().length)throw G(C=v.getTracks()).call(C,b=>{b.stop()}),new DOMException("","NotFoundError");return v},v=>dt.reject(d(v))))}}}function AI(r){r.MediaStream=r.MediaStream||r.webkitMediaStream}function gI(r){if(typeof r=="object"&&r.RTCPeerConnection&&!("ontrack"in r.RTCPeerConnection.prototype)){se(r.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const t=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{var s;n.stream.addEventListener("addtrack",c=>{let d;var h;r.RTCPeerConnection.prototype.getReceivers?d=_t(h=this.getReceivers()).call(h,A=>A.track&&A.track.id===c.track.id):d={track:c.track};const p=new Event("track");p.track=c.track,p.receiver=d,p.transceiver={receiver:d},p.streams=[n.stream],this.dispatchEvent(p)}),G(s=n.stream.getTracks()).call(s,c=>{let d;var h;r.RTCPeerConnection.prototype.getReceivers?d=_t(h=this.getReceivers()).call(h,A=>A.track&&A.track.id===c.id):d={track:c};const p=new Event("track");p.track=c,p.receiver=d,p.transceiver={receiver:d},p.streams=[n.stream],this.dispatchEvent(p)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else $c(r,"track",t=>(t.transceiver||se(t,"transceiver",{value:{receiver:t.receiver}}),t))}function mI(r){if(typeof r=="object"&&r.RTCPeerConnection&&!("getSenders"in r.RTCPeerConnection.prototype)&&"createDTMFSender"in r.RTCPeerConnection.prototype){const t=function(c,d){return{track:d,get dtmf(){return this._dtmf===void 0&&(d.kind==="audio"?this._dtmf=c.createDTMFSender(d):this._dtmf=null),this._dtmf},_pc:c}};if(!r.RTCPeerConnection.prototype.getSenders){r.RTCPeerConnection.prototype.getSenders=function(){var h;return this._senders=this._senders||[],en(h=this._senders).call(h)};const c=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addTrack=function(h,p){let A=c.apply(this,arguments);return A||(A=t(this,h),this._senders.push(A)),A};const d=r.RTCPeerConnection.prototype.removeTrack;r.RTCPeerConnection.prototype.removeTrack=function(h){var p;d.apply(this,arguments);const A=Ft(p=this._senders).call(p,h);var m;A!==-1&&Ye(m=this._senders).call(m,A,1)}}const n=r.RTCPeerConnection.prototype.addStream;r.RTCPeerConnection.prototype.addStream=function(c){var d;this._senders=this._senders||[],n.apply(this,[c]),G(d=c.getTracks()).call(d,h=>{this._senders.push(t(this,h))})};const s=r.RTCPeerConnection.prototype.removeStream;r.RTCPeerConnection.prototype.removeStream=function(c){var d;this._senders=this._senders||[],s.apply(this,[c]),G(d=c.getTracks()).call(d,h=>{var p;const A=_t(p=this._senders).call(p,v=>v.track===h);var m,E;A&&Ye(m=this._senders).call(m,Ft(E=this._senders).call(E,A),1)})}}else if(typeof r=="object"&&r.RTCPeerConnection&&"getSenders"in r.RTCPeerConnection.prototype&&"createDTMFSender"in r.RTCPeerConnection.prototype&&r.RTCRtpSender&&!("dtmf"in r.RTCRtpSender.prototype)){const t=r.RTCPeerConnection.prototype.getSenders;r.RTCPeerConnection.prototype.getSenders=function(){const n=t.apply(this,[]);return G(n).call(n,s=>s._pc=this),n},se(r.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function EI(r){if(!r.RTCPeerConnection)return;const t=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(){const[n,s,c]=arguments;if(arguments.length>0&&typeof n=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof n!="function"))return t.apply(this,[]);const d=function(p){const A={},m=p.result();return G(m).call(m,E=>{var v;const C={id:E.id,timestamp:E.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[E.type]||E.type};G(v=E.names()).call(v,b=>{C[b]=E.stat(b)}),A[C.id]=C}),A},h=function(p){var A;return new re(ft(A=le(p)).call(A,m=>[m,p[m]]))};if(arguments.length>=2){const p=function(A){s(h(d(A)))};return t.apply(this,[p,n])}return new dt((p,A)=>{t.apply(this,[function(m){p(h(d(m)))},A])}).then(s,c)}}function _I(r){if(!(typeof r=="object"&&r.RTCPeerConnection&&r.RTCRtpSender&&r.RTCRtpReceiver))return;if(!("getStats"in r.RTCRtpSender.prototype)){const n=r.RTCPeerConnection.prototype.getSenders;n&&(r.RTCPeerConnection.prototype.getSenders=function(){const c=n.apply(this,[]);return G(c).call(c,d=>d._pc=this),c});const s=r.RTCPeerConnection.prototype.addTrack;s&&(r.RTCPeerConnection.prototype.addTrack=function(){const c=s.apply(this,arguments);return c._pc=this,c}),r.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then(d=>Sv(d,c.track,!0))}}if(!("getStats"in r.RTCRtpReceiver.prototype)){const n=r.RTCPeerConnection.prototype.getReceivers;n&&(r.RTCPeerConnection.prototype.getReceivers=function(){const s=n.apply(this,[]);return G(s).call(s,c=>c._pc=this),s}),$c(r,"track",s=>(s.receiver._pc=s.srcElement,s)),r.RTCRtpReceiver.prototype.getStats=function(){const s=this;return this._pc.getStats().then(c=>Sv(c,s.track,!1))}}if(!("getStats"in r.RTCRtpSender.prototype)||!("getStats"in r.RTCRtpReceiver.prototype))return;const t=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof r.MediaStreamTrack){var n,s;const c=arguments[0];let d,h,p;return G(n=this.getSenders()).call(n,A=>{A.track===c&&(d?p=!0:d=A)}),G(s=this.getReceivers()).call(s,A=>(A.track===c&&(h?p=!0:h=A),A.track===c)),p||d&&h?dt.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):d?d.getStats():h?h.getStats():dt.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function vI(r){r.RTCPeerConnection.prototype.getLocalStreams=function(){var d;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},ft(d=le(this._shimmedLocalStreams)).call(d,h=>this._shimmedLocalStreams[h][0])};const t=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addTrack=function(d,h){var p;if(!h)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const A=t.apply(this,arguments);return this._shimmedLocalStreams[h.id]?Ft(p=this._shimmedLocalStreams[h.id]).call(p,A)===-1&&this._shimmedLocalStreams[h.id].push(A):this._shimmedLocalStreams[h.id]=[h,A],A};const n=r.RTCPeerConnection.prototype.addStream;r.RTCPeerConnection.prototype.addStream=function(d){var h,p,A;this._shimmedLocalStreams=this._shimmedLocalStreams||{},G(h=d.getTracks()).call(h,v=>{var C;if(_t(C=this.getSenders()).call(C,b=>b.track===v))throw new DOMException("Track already exists.","InvalidAccessError")});const m=this.getSenders();n.apply(this,arguments);const E=kt(p=this.getSenders()).call(p,v=>Ft(m).call(m,v)===-1);this._shimmedLocalStreams[d.id]=O(A=[d]).call(A,E)};const s=r.RTCPeerConnection.prototype.removeStream;r.RTCPeerConnection.prototype.removeStream=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[d.id],s.apply(this,arguments)};const c=r.RTCPeerConnection.prototype.removeTrack;r.RTCPeerConnection.prototype.removeTrack=function(d){var h;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},d&&G(h=le(this._shimmedLocalStreams)).call(h,p=>{var A;const m=Ft(A=this._shimmedLocalStreams[p]).call(A,d);var E;m!==-1&&Ye(E=this._shimmedLocalStreams[p]).call(E,m,1),this._shimmedLocalStreams[p].length===1&&delete this._shimmedLocalStreams[p]}),c.apply(this,arguments)}}function II(r){var t;if(!r.RTCPeerConnection)return;const n=ra(r);if(r.RTCPeerConnection.prototype.addTrack&&n.version>=65)return vI(r);const s=r.RTCPeerConnection.prototype.getLocalStreams;r.RTCPeerConnection.prototype.getLocalStreams=function(){const E=s.apply(this);return this._reverseStreams=this._reverseStreams||{},ft(E).call(E,v=>this._reverseStreams[v.id])};const c=r.RTCPeerConnection.prototype.addStream;r.RTCPeerConnection.prototype.addStream=function(E){var v;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},G(v=E.getTracks()).call(v,C=>{var b;if(_t(b=this.getSenders()).call(b,y=>y.track===C))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[E.id]){const C=new r.MediaStream(E.getTracks());this._streams[E.id]=C,this._reverseStreams[C.id]=E,E=C}c.apply(this,[E])};const d=r.RTCPeerConnection.prototype.removeStream;function h(E,v){var C;let b=v.sdp;return G(C=le(E._reverseStreams||[])).call(C,y=>{const w=E._reverseStreams[y],k=E._streams[w.id];b=b.replace(new RegExp(k.id,"g"),w.id)}),new RTCSessionDescription({type:v.type,sdp:b})}function p(E,v){var C;let b=v.sdp;return G(C=le(E._reverseStreams||[])).call(C,y=>{const w=E._reverseStreams[y],k=E._streams[w.id];b=b.replace(new RegExp(w.id,"g"),k.id)}),new RTCSessionDescription({type:v.type,sdp:b})}r.RTCPeerConnection.prototype.removeStream=function(E){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},d.apply(this,[this._streams[E.id]||E]),delete this._reverseStreams[this._streams[E.id]?this._streams[E.id].id:E.id],delete this._streams[E.id]},r.RTCPeerConnection.prototype.addTrack=function(E,v){var C,b,y;if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const w=en([]).call(arguments,1);if(w.length!==1||!_t(C=w[0].getTracks()).call(C,V=>V===E))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(_t(b=this.getSenders()).call(b,V=>V.track===E))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const P=this._streams[v.id];if(P)P.addTrack(E),dt.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const V=new r.MediaStream([E]);this._streams[v.id]=V,this._reverseStreams[V.id]=v,this.addStream(V)}return _t(y=this.getSenders()).call(y,V=>V.track===E)},G(t=["createOffer","createAnswer"]).call(t,function(E){const v=r.RTCPeerConnection.prototype[E],C={[E](){const b=arguments;return arguments.length&&typeof arguments[0]=="function"?v.apply(this,[y=>{const w=h(this,y);b[0].apply(null,[w])},y=>{b[1]&&b[1].apply(null,y)},arguments[2]]):v.apply(this,arguments).then(y=>h(this,y))}};r.RTCPeerConnection.prototype[E]=C[E]});const A=r.RTCPeerConnection.prototype.setLocalDescription;r.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=p(this,arguments[0]),A.apply(this,arguments)):A.apply(this,arguments)};const m=Wt(r.RTCPeerConnection.prototype,"localDescription");se(r.RTCPeerConnection.prototype,"localDescription",{get(){const E=m.get.apply(this);return E.type===""?E:h(this,E)}}),r.RTCPeerConnection.prototype.removeTrack=function(E){var v;if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!E._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(E._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let C;this._streams=this._streams||{},G(v=le(this._streams)).call(v,b=>{var y;_t(y=this._streams[b].getTracks()).call(y,w=>E.track===w)&&(C=this._streams[b])}),C&&(C.getTracks().length===1?this.removeStream(this._reverseStreams[C.id]):C.removeTrack(E.track),this.dispatchEvent(new Event("negotiationneeded")))}}function RA(r){const t=ra(r);if(!r.RTCPeerConnection&&r.webkitRTCPeerConnection&&(r.RTCPeerConnection=r.webkitRTCPeerConnection),!r.RTCPeerConnection)return;var n;t.version<53&&G(n=["setLocalDescription","setRemoteDescription","addIceCandidate"]).call(n,function(c){const d=r.RTCPeerConnection.prototype[c],h={[c](){return arguments[0]=new(c==="addIceCandidate"?r.RTCIceCandidate:r.RTCSessionDescription)(arguments[0]),d.apply(this,arguments)}};r.RTCPeerConnection.prototype[c]=h[c]});const s=r.RTCPeerConnection.prototype.addIceCandidate;r.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?t.version<78&&arguments[0]&&arguments[0].candidate===""?dt.resolve():s.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),dt.resolve())}}function CI(r){$c(r,"negotiationneeded",t=>{if(t.target.signalingState==="stable")return t})}var SI=Object.freeze({__proto__:null,shimMediaStream:AI,shimOnTrack:gI,shimGetSendersWithDtmf:mI,shimGetStats:EI,shimSenderReceiverGetStats:_I,shimAddTrackRemoveTrackWithNative:vI,shimAddTrackRemoveTrack:II,shimPeerConnection:RA,fixNegotiationNeeded:CI,shimGetUserMedia:fI,shimGetDisplayMedia:function(r,t){r.navigator.mediaDevices&&"getDisplayMedia"in r.navigator.mediaDevices||r.navigator.mediaDevices&&(typeof t=="function"?r.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(s=>{const c=n.video&&n.video.width,d=n.video&&n.video.height,h=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:s,maxFrameRate:h||3}},c&&(n.video.mandatory.maxWidth=c),d&&(n.video.mandatory.maxHeight=d),r.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}}),yI="".startsWith,C2=Math.min,S2=iA("startsWith");qt({target:"String",proto:!0,forced:!S2},{startsWith:function(r){var t=String(nt(this));nA(r);var n=Ln(C2(arguments.length>1?arguments[1]:void 0,t.length)),s=String(r);return yI?yI.call(t,s,n):t.slice(n,n+s.length)===s}});var y2=Zr("String").startsWith,TI=String.prototype,al=function(r){var t=r.startsWith;return typeof r=="string"||r===TI||r instanceof String&&t===TI.startsWith?y2:t},wd,T2=mv.trim;qt({target:"String",proto:!0,forced:(wd="trim",f(function(){return!!Id[wd]()||"\u200B\x85\u180E"[wd]()!="\u200B\x85\u180E"||Id[wd].name!==wd}))},{trim:function(){return T2(this)}});var R2=Zr("String").trim,RI=String.prototype,pc=function(r){var t=r.trim;return typeof r=="string"||r===RI||r instanceof String&&t===RI.trim?R2:t},pe=a(function(r){var t={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};t.localCName=t.generateIdentifier(),t.splitLines=function(n){var s;return ft(s=pc(n).call(n).split(`
`)).call(s,function(c){return pc(c).call(c)})},t.splitSections=function(n){var s=n.split(`
m=`);return ft(s).call(s,function(c,d){var h;return pc(h=d>0?"m="+c:c).call(h)+`\r
`})},t.getDescription=function(n){var s=t.splitSections(n);return s&&s[0]},t.getMediaSections=function(n){var s=t.splitSections(n);return s.shift(),s},t.matchPrefix=function(n,s){var c;return kt(c=t.splitLines(n)).call(c,function(d){return Ft(d).call(d,s)===0})},t.parseCandidate=function(n){for(var s,c={foundation:(s=Ft(n).call(n,"a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" "))[0],component:Sr(s[1],10),protocol:s[2].toLowerCase(),priority:Sr(s[3],10),ip:s[4],address:s[4],port:Sr(s[5],10),type:s[7]},d=8;d<s.length;d+=2)switch(s[d]){case"raddr":c.relatedAddress=s[d+1];break;case"rport":c.relatedPort=Sr(s[d+1],10);break;case"tcptype":c.tcpType=s[d+1];break;case"ufrag":c.ufrag=s[d+1],c.usernameFragment=s[d+1];break;default:c[s[d]]=s[d+1]}return c},t.writeCandidate=function(n){var s=[];s.push(n.foundation),s.push(n.component),s.push(n.protocol.toUpperCase()),s.push(n.priority),s.push(n.address||n.ip),s.push(n.port);var c=n.type;return s.push("typ"),s.push(c),c!=="host"&&n.relatedAddress&&n.relatedPort&&(s.push("raddr"),s.push(n.relatedAddress),s.push("rport"),s.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(s.push("tcptype"),s.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(s.push("ufrag"),s.push(n.usernameFragment||n.ufrag)),"candidate:"+s.join(" ")},t.parseIceOptions=function(n){return n.substr(14).split(" ")},t.parseRtpMap=function(n){var s=n.substr(9).split(" "),c={payloadType:Sr(s.shift(),10)};return s=s[0].split("/"),c.name=s[0],c.clockRate=Sr(s[1],10),c.channels=s.length===3?Sr(s[2],10):1,c.numChannels=c.channels,c},t.writeRtpMap=function(n){var s=n.payloadType;n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType);var c=n.channels||n.numChannels||1;return"a=rtpmap:"+s+" "+n.name+"/"+n.clockRate+(c!==1?"/"+c:"")+`\r
`},t.parseExtmap=function(n){var s,c=n.substr(9).split(" ");return{id:Sr(c[0],10),direction:Ft(s=c[0]).call(s,"/")>0?c[0].split("/")[1]:"sendrecv",uri:c[1]}},t.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+`\r
`},t.parseFmtp=function(n){for(var s,c={},d=n.substr(Ft(n).call(n," ")+1).split(";"),h=0;h<d.length;h++){var p,A;s=pc(p=d[h]).call(p).split("="),c[pc(A=s[0]).call(A)]=s[1]}return c},t.writeFmtp=function(n){var s="",c=n.payloadType;if(n.preferredPayloadType!==void 0&&(c=n.preferredPayloadType),n.parameters&&le(n.parameters).length){var d,h=[];G(d=le(n.parameters)).call(d,function(p){n.parameters[p]?h.push(p+"="+n.parameters[p]):h.push(p)}),s+="a=fmtp:"+c+" "+h.join(";")+`\r
`}return s},t.parseRtcpFb=function(n){var s=n.substr(Ft(n).call(n," ")+1).split(" ");return{type:s.shift(),parameter:s.join(" ")}},t.writeRtcpFb=function(n){var s,c="",d=n.payloadType;return n.preferredPayloadType!==void 0&&(d=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&G(s=n.rtcpFeedback).call(s,function(h){c+="a=rtcp-fb:"+d+" "+h.type+(h.parameter&&h.parameter.length?" "+h.parameter:"")+`\r
`}),c},t.parseSsrcMedia=function(n){var s=Ft(n).call(n," "),c={ssrc:Sr(n.substr(7,s-7),10)},d=Ft(n).call(n,":",s);return d>-1?(c.attribute=n.substr(s+1,d-s-1),c.value=n.substr(d+1)):c.attribute=n.substr(s+1),c},t.parseSsrcGroup=function(n){var s=n.substr(13).split(" ");return{semantics:s.shift(),ssrcs:ft(s).call(s,function(c){return Sr(c,10)})}},t.getMid=function(n){var s=t.matchPrefix(n,"a=mid:")[0];if(s)return s.substr(6)},t.parseFingerprint=function(n){var s=n.substr(14).split(" ");return{algorithm:s[0].toLowerCase(),value:s[1]}},t.getDtlsParameters=function(n,s){var c=t.matchPrefix(n+s,"a=fingerprint:");return{role:"auto",fingerprints:ft(c).call(c,t.parseFingerprint)}},t.writeDtlsParameters=function(n,s){var c,d="a=setup:"+s+`\r
`;return G(c=n.fingerprints).call(c,function(h){d+="a=fingerprint:"+h.algorithm+" "+h.value+`\r
`}),d},t.getIceParameters=function(n,s){var c=t.splitLines(n);return c=O(c).call(c,t.splitLines(s)),{usernameFragment:kt(c).call(c,function(d){return Ft(d).call(d,"a=ice-ufrag:")===0})[0].substr(12),password:kt(c).call(c,function(d){return Ft(d).call(d,"a=ice-pwd:")===0})[0].substr(10)}},t.writeIceParameters=function(n){return"a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`},t.parseRtpParameters=function(n){for(var s,c={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},d=t.splitLines(n)[0].split(" "),h=3;h<d.length;h++){var p=d[h],A=t.matchPrefix(n,"a=rtpmap:"+p+" ")[0];if(A){var m,E=t.parseRtpMap(A),v=t.matchPrefix(n,"a=fmtp:"+p+" ");switch(E.parameters=v.length?t.parseFmtp(v[0]):{},E.rtcpFeedback=ft(m=t.matchPrefix(n,"a=rtcp-fb:"+p+" ")).call(m,t.parseRtcpFb),c.codecs.push(E),E.name.toUpperCase()){case"RED":case"ULPFEC":c.fecMechanisms.push(E.name.toUpperCase())}}}return G(s=t.matchPrefix(n,"a=extmap:")).call(s,function(C){c.headerExtensions.push(t.parseExtmap(C))}),c},t.writeRtpDescription=function(n,s){var c,d,h,p="";p+="m="+n+" ",p+=s.codecs.length>0?"9":"0",p+=" UDP/TLS/RTP/SAVPF ",p+=ft(c=s.codecs).call(c,function(E){return E.preferredPayloadType!==void 0?E.preferredPayloadType:E.payloadType}).join(" ")+`\r
`,p+=`c=IN IP4 0.0.0.0\r
`,p+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,G(d=s.codecs).call(d,function(E){p+=t.writeRtpMap(E),p+=t.writeFmtp(E),p+=t.writeRtcpFb(E)});var A,m=0;return G(h=s.codecs).call(h,function(E){E.maxptime>m&&(m=E.maxptime)}),m>0&&(p+="a=maxptime:"+m+`\r
`),p+=`a=rtcp-mux\r
`,s.headerExtensions&&G(A=s.headerExtensions).call(A,function(E){p+=t.writeExtmap(E)}),p},t.parseRtpEncodingParameters=function(n){var s,c,d,h,p,A,m,E=[],v=t.parseRtpParameters(n),C=Ft(s=v.fecMechanisms).call(s,"RED")!==-1,b=Ft(c=v.fecMechanisms).call(c,"ULPFEC")!==-1,y=kt(d=ft(h=t.matchPrefix(n,"a=ssrc:")).call(h,function(st){return t.parseSsrcMedia(st)})).call(d,function(st){return st.attribute==="cname"}),w=y.length>0&&y[0].ssrc,k=ft(p=t.matchPrefix(n,"a=ssrc-group:FID")).call(p,function(st){var mt=st.substr(17).split(" ");return ft(mt).call(mt,function(Et){return Sr(Et,10)})});k.length>0&&k[0].length>1&&k[0][0]===w&&(m=k[0][1]),G(A=v.codecs).call(A,function(st){if(st.name.toUpperCase()==="RTX"&&st.parameters.apt){var mt={ssrc:w,codecPayloadType:Sr(st.parameters.apt,10)};w&&m&&(mt.rtx={ssrc:m}),E.push(mt),C&&((mt=JSON.parse(ht(mt))).fec={ssrc:w,mechanism:b?"red+ulpfec":"red"},E.push(mt))}}),E.length===0&&w&&E.push({ssrc:w});var P,V,j=t.matchPrefix(n,"b=");return j.length&&(j=Ft(P=j[0]).call(P,"b=TIAS:")===0?Sr(j[0].substr(7),10):Ft(V=j[0]).call(V,"b=AS:")===0?1e3*Sr(j[0].substr(5),10)*.95-16e3:void 0,G(E).call(E,function(st){st.maxBitrate=j})),E},t.parseRtcpParameters=function(n){var s,c,d={},h=kt(s=ft(c=t.matchPrefix(n,"a=ssrc:")).call(c,function(m){return t.parseSsrcMedia(m)})).call(s,function(m){return m.attribute==="cname"})[0];h&&(d.cname=h.value,d.ssrc=h.ssrc);var p=t.matchPrefix(n,"a=rtcp-rsize");d.reducedSize=p.length>0,d.compound=p.length===0;var A=t.matchPrefix(n,"a=rtcp-mux");return d.mux=A.length>0,d},t.parseMsid=function(n){var s,c,d,h=t.matchPrefix(n,"a=msid:");if(h.length===1)return{stream:(d=h[0].substr(7).split(" "))[0],track:d[1]};var p=kt(s=ft(c=t.matchPrefix(n,"a=ssrc:")).call(c,function(A){return t.parseSsrcMedia(A)})).call(s,function(A){return A.attribute==="msid"});return p.length>0?{stream:(d=p[0].value.split(" "))[0],track:d[1]}:void 0},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(n,s,c){var d=s!==void 0?s:2;return`v=0\r
o=`+(c||"thisisadapterortc")+" "+(n||t.generateSessionId())+" "+d+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.writeMediaSection=function(n,s,c,d){var h=t.writeRtpDescription(n.kind,s);if(h+=t.writeIceParameters(n.iceGatherer.getLocalParameters()),h+=t.writeDtlsParameters(n.dtlsTransport.getLocalParameters(),c==="offer"?"actpass":"active"),h+="a=mid:"+n.mid+`\r
`,n.direction?h+="a="+n.direction+`\r
`:n.rtpSender&&n.rtpReceiver?h+=`a=sendrecv\r
`:n.rtpSender?h+=`a=sendonly\r
`:n.rtpReceiver?h+=`a=recvonly\r
`:h+=`a=inactive\r
`,n.rtpSender){var p="msid:"+d.id+" "+n.rtpSender.track.id+`\r
`;h+="a="+p,h+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" "+p,n.sendEncodingParameters[0].rtx&&(h+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" "+p,h+="a=ssrc-group:FID "+n.sendEncodingParameters[0].ssrc+" "+n.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return h+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" cname:"+t.localCName+`\r
`,n.rtpSender&&n.sendEncodingParameters[0].rtx&&(h+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" cname:"+t.localCName+`\r
`),h},t.getDirection=function(n,s){for(var c=t.splitLines(n),d=0;d<c.length;d++)switch(c[d]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[d].substr(2)}return s?t.getDirection(s):"sendrecv"},t.getKind=function(n){return t.splitLines(n)[0].split(" ")[0].substr(2)},t.isRejected=function(n){return n.split(" ",2)[1]==="0"},t.parseMLine=function(n){var s=t.splitLines(n)[0].substr(2).split(" ");return{kind:s[0],port:Sr(s[1],10),protocol:s[2],fmt:en(s).call(s,3).join(" ")}},t.parseOLine=function(n){var s=t.matchPrefix(n,"o=")[0].substr(2).split(" ");return{username:s[0],sessionId:s[1],sessionVersion:Sr(s[2],10),netType:s[3],addressType:s[4],address:s[5]}},t.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;for(var s=t.splitLines(n),c=0;c<s.length;c++)if(s[c].length<2||s[c].charAt(1)!=="=")return!1;return!0},r.exports=t});function wI(r,t,n,s,c){var d=pe.writeRtpDescription(r.kind,t);if(d+=pe.writeIceParameters(r.iceGatherer.getLocalParameters()),d+=pe.writeDtlsParameters(r.dtlsTransport.getLocalParameters(),n==="offer"?"actpass":c||"active"),d+="a=mid:"+r.mid+`\r
`,r.rtpSender&&r.rtpReceiver?d+=`a=sendrecv\r
`:r.rtpSender?d+=`a=sendonly\r
`:r.rtpReceiver?d+=`a=recvonly\r
`:d+=`a=inactive\r
`,r.rtpSender){var h=r.rtpSender._initialTrackId||r.rtpSender.track.id;r.rtpSender._initialTrackId=h;var p="msid:"+(s?s.id:"-")+" "+h+`\r
`;d+="a="+p,d+="a=ssrc:"+r.sendEncodingParameters[0].ssrc+" "+p,r.sendEncodingParameters[0].rtx&&(d+="a=ssrc:"+r.sendEncodingParameters[0].rtx.ssrc+" "+p,d+="a=ssrc-group:FID "+r.sendEncodingParameters[0].ssrc+" "+r.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return d+="a=ssrc:"+r.sendEncodingParameters[0].ssrc+" cname:"+pe.localCName+`\r
`,r.rtpSender&&r.sendEncodingParameters[0].rtx&&(d+="a=ssrc:"+r.sendEncodingParameters[0].rtx.ssrc+" cname:"+pe.localCName+`\r
`),d}function wh(r,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]},s=function(d,h){d=parseInt(d,10);for(var p=0;p<h.length;p++)if(h[p].payloadType===d||h[p].preferredPayloadType===d)return h[p]},c=function(d,h,p,A){var m=s(d.parameters.apt,p),E=s(h.parameters.apt,A);return m&&E&&m.name.toLowerCase()===E.name.toLowerCase()};return r.codecs.forEach(function(d){for(var h=0;h<t.codecs.length;h++){var p=t.codecs[h];if(d.name.toLowerCase()===p.name.toLowerCase()&&d.clockRate===p.clockRate){if(d.name.toLowerCase()==="rtx"&&d.parameters&&p.parameters.apt&&!c(d,p,r.codecs,t.codecs))continue;(p=JSON.parse(JSON.stringify(p))).numChannels=Math.min(d.numChannels,p.numChannels),n.codecs.push(p),p.rtcpFeedback=p.rtcpFeedback.filter(function(A){for(var m=0;m<d.rtcpFeedback.length;m++)if(d.rtcpFeedback[m].type===A.type&&d.rtcpFeedback[m].parameter===A.parameter)return!0;return!1});break}}}),r.headerExtensions.forEach(function(d){for(var h=0;h<t.headerExtensions.length;h++){var p=t.headerExtensions[h];if(d.uri===p.uri){n.headerExtensions.push(p);break}}}),n}function bI(r,t,n){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][r].indexOf(n)!==-1}function wA(r,t){var n=r.getRemoteCandidates().find(function(s){return t.foundation===s.foundation&&t.ip===s.ip&&t.port===s.port&&t.priority===s.priority&&t.protocol===s.protocol&&t.type===s.type});return n||r.addRemoteCandidate(t),!n}function _i(r,t){var n=new Error(t);return n.name=r,n.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[r],n}var w2=function(r,t){function n(h,p){p.addTrack(h),p.dispatchEvent(new r.MediaStreamTrackEvent("addtrack",{track:h}))}function s(h,p,A,m){var E=new Event("track");E.track=p,E.receiver=A,E.transceiver={receiver:A},E.streams=m,r.setTimeout(function(){h._dispatchEvent("track",E)})}var c=function(h){var p=this,A=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(E){p[E]=A[E].bind(A)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",h=JSON.parse(JSON.stringify(h||{})),this.usingBundle=h.bundlePolicy==="max-bundle",h.rtcpMuxPolicy==="negotiate")throw _i("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(h.rtcpMuxPolicy||(h.rtcpMuxPolicy="require"),h.iceTransportPolicy){case"all":case"relay":break;default:h.iceTransportPolicy="all"}switch(h.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:h.bundlePolicy="balanced"}if(h.iceServers=function(E,v){var C=!1;return(E=JSON.parse(JSON.stringify(E))).filter(function(b){if(b&&(b.urls||b.url)){var y=b.urls||b.url;b.url&&!b.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var w=typeof y=="string";return w&&(y=[y]),y=y.filter(function(k){return k.indexOf("turn:")!==0||k.indexOf("transport=udp")===-1||k.indexOf("turn:[")!==-1||C?k.indexOf("stun:")===0&&v>=14393&&k.indexOf("?transport=udp")===-1:(C=!0,!0)}),delete b.url,b.urls=w?y[0]:y,!!y.length}})}(h.iceServers||[],t),this._iceGatherers=[],h.iceCandidatePoolSize)for(var m=h.iceCandidatePoolSize;m>0;m--)this._iceGatherers.push(new r.RTCIceGatherer({iceServers:h.iceServers,gatherPolicy:h.iceTransportPolicy}));else h.iceCandidatePoolSize=0;this._config=h,this.transceivers=[],this._sdpSessionId=pe.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(c.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(c.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),c.prototype.onicecandidate=null,c.prototype.onaddstream=null,c.prototype.ontrack=null,c.prototype.onremovestream=null,c.prototype.onsignalingstatechange=null,c.prototype.oniceconnectionstatechange=null,c.prototype.onconnectionstatechange=null,c.prototype.onicegatheringstatechange=null,c.prototype.onnegotiationneeded=null,c.prototype.ondatachannel=null,c.prototype._dispatchEvent=function(h,p){this._isClosed||(this.dispatchEvent(p),typeof this["on"+h]=="function"&&this["on"+h](p))},c.prototype._emitGatheringStateChange=function(){var h=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",h)},c.prototype.getConfiguration=function(){return this._config},c.prototype.getLocalStreams=function(){return this.localStreams},c.prototype.getRemoteStreams=function(){return this.remoteStreams},c.prototype._createTransceiver=function(h,p){var A=this.transceivers.length>0,m={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:h,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&A)m.iceTransport=this.transceivers[0].iceTransport,m.dtlsTransport=this.transceivers[0].dtlsTransport;else{var E=this._createIceAndDtlsTransports();m.iceTransport=E.iceTransport,m.dtlsTransport=E.dtlsTransport}return p||this.transceivers.push(m),m},c.prototype.addTrack=function(h,p){if(this._isClosed)throw _i("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var A;if(this.transceivers.find(function(E){return E.track===h}))throw _i("InvalidAccessError","Track already exists.");for(var m=0;m<this.transceivers.length;m++)this.transceivers[m].track||this.transceivers[m].kind!==h.kind||(A=this.transceivers[m]);return A||(A=this._createTransceiver(h.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(p)===-1&&this.localStreams.push(p),A.track=h,A.stream=p,A.rtpSender=new r.RTCRtpSender(h,A.dtlsTransport),A.rtpSender},c.prototype.addStream=function(h){var p=this;if(t>=15025)h.getTracks().forEach(function(m){p.addTrack(m,h)});else{var A=h.clone();h.getTracks().forEach(function(m,E){var v=A.getTracks()[E];m.addEventListener("enabled",function(C){v.enabled=C.enabled})}),A.getTracks().forEach(function(m){p.addTrack(m,A)})}},c.prototype.removeTrack=function(h){if(this._isClosed)throw _i("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(h instanceof r.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var p=this.transceivers.find(function(m){return m.rtpSender===h});if(!p)throw _i("InvalidAccessError","Sender was not created by this connection.");var A=p.stream;p.rtpSender.stop(),p.rtpSender=null,p.track=null,p.stream=null,this.transceivers.map(function(m){return m.stream}).indexOf(A)===-1&&this.localStreams.indexOf(A)>-1&&this.localStreams.splice(this.localStreams.indexOf(A),1),this._maybeFireNegotiationNeeded()},c.prototype.removeStream=function(h){var p=this;h.getTracks().forEach(function(A){var m=p.getSenders().find(function(E){return E.track===A});m&&p.removeTrack(m)})},c.prototype.getSenders=function(){return this.transceivers.filter(function(h){return!!h.rtpSender}).map(function(h){return h.rtpSender})},c.prototype.getReceivers=function(){return this.transceivers.filter(function(h){return!!h.rtpReceiver}).map(function(h){return h.rtpReceiver})},c.prototype._createIceGatherer=function(h,p){var A=this;if(p&&h>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var m=new r.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(m,"state",{value:"new",writable:!0}),this.transceivers[h].bufferedCandidateEvents=[],this.transceivers[h].bufferCandidates=function(E){var v=!E.candidate||Object.keys(E.candidate).length===0;m.state=v?"completed":"gathering",A.transceivers[h].bufferedCandidateEvents!==null&&A.transceivers[h].bufferedCandidateEvents.push(E)},m.addEventListener("localcandidate",this.transceivers[h].bufferCandidates),m},c.prototype._gather=function(h,p){var A=this,m=this.transceivers[p].iceGatherer;if(!m.onlocalcandidate){var E=this.transceivers[p].bufferedCandidateEvents;this.transceivers[p].bufferedCandidateEvents=null,m.removeEventListener("localcandidate",this.transceivers[p].bufferCandidates),m.onlocalcandidate=function(v){if(!(A.usingBundle&&p>0)){var C=new Event("icecandidate");C.candidate={sdpMid:h,sdpMLineIndex:p};var b=v.candidate,y=!b||Object.keys(b).length===0;if(y)m.state!=="new"&&m.state!=="gathering"||(m.state="completed");else{m.state==="new"&&(m.state="gathering"),b.component=1,b.ufrag=m.getLocalParameters().usernameFragment;var w=pe.writeCandidate(b);C.candidate=Object.assign(C.candidate,pe.parseCandidate(w)),C.candidate.candidate=w,C.candidate.toJSON=function(){return{candidate:C.candidate.candidate,sdpMid:C.candidate.sdpMid,sdpMLineIndex:C.candidate.sdpMLineIndex,usernameFragment:C.candidate.usernameFragment}}}var k=pe.getMediaSections(A._localDescription.sdp);k[C.candidate.sdpMLineIndex]+=y?`a=end-of-candidates\r
`:"a="+C.candidate.candidate+`\r
`,A._localDescription.sdp=pe.getDescription(A._localDescription.sdp)+k.join("");var P=A.transceivers.every(function(V){return V.iceGatherer&&V.iceGatherer.state==="completed"});A.iceGatheringState!=="gathering"&&(A.iceGatheringState="gathering",A._emitGatheringStateChange()),y||A._dispatchEvent("icecandidate",C),P&&(A._dispatchEvent("icecandidate",new Event("icecandidate")),A.iceGatheringState="complete",A._emitGatheringStateChange())}},r.setTimeout(function(){E.forEach(function(v){m.onlocalcandidate(v)})},0)}},c.prototype._createIceAndDtlsTransports=function(){var h=this,p=new r.RTCIceTransport(null);p.onicestatechange=function(){h._updateIceConnectionState(),h._updateConnectionState()};var A=new r.RTCDtlsTransport(p);return A.ondtlsstatechange=function(){h._updateConnectionState()},A.onerror=function(){Object.defineProperty(A,"state",{value:"failed",writable:!0}),h._updateConnectionState()},{iceTransport:p,dtlsTransport:A}},c.prototype._disposeIceAndDtlsTransports=function(h){var p=this.transceivers[h].iceGatherer;p&&(delete p.onlocalcandidate,delete this.transceivers[h].iceGatherer);var A=this.transceivers[h].iceTransport;A&&(delete A.onicestatechange,delete this.transceivers[h].iceTransport);var m=this.transceivers[h].dtlsTransport;m&&(delete m.ondtlsstatechange,delete m.onerror,delete this.transceivers[h].dtlsTransport)},c.prototype._transceive=function(h,p,A){var m=wh(h.localCapabilities,h.remoteCapabilities);p&&h.rtpSender&&(m.encodings=h.sendEncodingParameters,m.rtcp={cname:pe.localCName,compound:h.rtcpParameters.compound},h.recvEncodingParameters.length&&(m.rtcp.ssrc=h.recvEncodingParameters[0].ssrc),h.rtpSender.send(m)),A&&h.rtpReceiver&&m.codecs.length>0&&(h.kind==="video"&&h.recvEncodingParameters&&t<15019&&h.recvEncodingParameters.forEach(function(E){delete E.rtx}),h.recvEncodingParameters.length?m.encodings=h.recvEncodingParameters:m.encodings=[{}],m.rtcp={compound:h.rtcpParameters.compound},h.rtcpParameters.cname&&(m.rtcp.cname=h.rtcpParameters.cname),h.sendEncodingParameters.length&&(m.rtcp.ssrc=h.sendEncodingParameters[0].ssrc),h.rtpReceiver.receive(m))},c.prototype.setLocalDescription=function(h){var p,A,m=this;if(["offer","answer"].indexOf(h.type)===-1)return Promise.reject(_i("TypeError",'Unsupported type "'+h.type+'"'));if(!bI("setLocalDescription",h.type,m.signalingState)||m._isClosed)return Promise.reject(_i("InvalidStateError","Can not set local "+h.type+" in state "+m.signalingState));if(h.type==="offer")p=pe.splitSections(h.sdp),A=p.shift(),p.forEach(function(v,C){var b=pe.parseRtpParameters(v);m.transceivers[C].localCapabilities=b}),m.transceivers.forEach(function(v,C){m._gather(v.mid,C)});else if(h.type==="answer"){p=pe.splitSections(m._remoteDescription.sdp),A=p.shift();var E=pe.matchPrefix(A,"a=ice-lite").length>0;p.forEach(function(v,C){var b=m.transceivers[C],y=b.iceGatherer,w=b.iceTransport,k=b.dtlsTransport,P=b.localCapabilities,V=b.remoteCapabilities;if(!(pe.isRejected(v)&&pe.matchPrefix(v,"a=bundle-only").length===0)&&!b.rejected){var j=pe.getIceParameters(v,A),st=pe.getDtlsParameters(v,A);E&&(st.role="server"),m.usingBundle&&C!==0||(m._gather(b.mid,C),w.state==="new"&&w.start(y,j,E?"controlling":"controlled"),k.state==="new"&&k.start(st));var mt=wh(P,V);m._transceive(b,mt.codecs.length>0,!1)}})}return m._localDescription={type:h.type,sdp:h.sdp},h.type==="offer"?m._updateSignalingState("have-local-offer"):m._updateSignalingState("stable"),Promise.resolve()},c.prototype.setRemoteDescription=function(h){var p=this;if(["offer","answer"].indexOf(h.type)===-1)return Promise.reject(_i("TypeError",'Unsupported type "'+h.type+'"'));if(!bI("setRemoteDescription",h.type,p.signalingState)||p._isClosed)return Promise.reject(_i("InvalidStateError","Can not set remote "+h.type+" in state "+p.signalingState));var A={};p.remoteStreams.forEach(function(w){A[w.id]=w});var m=[],E=pe.splitSections(h.sdp),v=E.shift(),C=pe.matchPrefix(v,"a=ice-lite").length>0,b=pe.matchPrefix(v,"a=group:BUNDLE ").length>0;p.usingBundle=b;var y=pe.matchPrefix(v,"a=ice-options:")[0];return p.canTrickleIceCandidates=!!y&&y.substr(14).split(" ").indexOf("trickle")>=0,E.forEach(function(w,k){var P=pe.splitLines(w),V=pe.getKind(w),j=pe.isRejected(w)&&pe.matchPrefix(w,"a=bundle-only").length===0,st=P[0].substr(2).split(" ")[2],mt=pe.getDirection(w,v),Et=pe.parseMsid(w),At=pe.getMid(w)||pe.generateIdentifier();if(j||V==="application"&&(st==="DTLS/SCTP"||st==="UDP/DTLS/SCTP"))p.transceivers[k]={mid:At,kind:V,protocol:st,rejected:!0};else{var $,rt,W,H,U,Tt,It,Ct,Ut;!j&&p.transceivers[k]&&p.transceivers[k].rejected&&(p.transceivers[k]=p._createTransceiver(V,!0));var Y,tt,vt=pe.parseRtpParameters(w);j||(Y=pe.getIceParameters(w,v),(tt=pe.getDtlsParameters(w,v)).role="client"),It=pe.parseRtpEncodingParameters(w);var at=pe.parseRtcpParameters(w),Lt=pe.matchPrefix(w,"a=end-of-candidates",v).length>0,lt=pe.matchPrefix(w,"a=candidate:").map(function(Q){return pe.parseCandidate(Q)}).filter(function(Q){return Q.component===1});if((h.type==="offer"||h.type==="answer")&&!j&&b&&k>0&&p.transceivers[k]&&(p._disposeIceAndDtlsTransports(k),p.transceivers[k].iceGatherer=p.transceivers[0].iceGatherer,p.transceivers[k].iceTransport=p.transceivers[0].iceTransport,p.transceivers[k].dtlsTransport=p.transceivers[0].dtlsTransport,p.transceivers[k].rtpSender&&p.transceivers[k].rtpSender.setTransport(p.transceivers[0].dtlsTransport),p.transceivers[k].rtpReceiver&&p.transceivers[k].rtpReceiver.setTransport(p.transceivers[0].dtlsTransport)),h.type!=="offer"||j)h.type==="answer"&&!j&&(rt=($=p.transceivers[k]).iceGatherer,W=$.iceTransport,H=$.dtlsTransport,U=$.rtpReceiver,Tt=$.sendEncodingParameters,Ct=$.localCapabilities,p.transceivers[k].recvEncodingParameters=It,p.transceivers[k].remoteCapabilities=vt,p.transceivers[k].rtcpParameters=at,lt.length&&W.state==="new"&&(!C&&!Lt||b&&k!==0?lt.forEach(function(Q){wA($.iceTransport,Q)}):W.setRemoteCandidates(lt)),b&&k!==0||(W.state==="new"&&W.start(rt,Y,"controlling"),H.state==="new"&&H.start(tt)),!wh($.localCapabilities,$.remoteCapabilities).codecs.filter(function(Q){return Q.name.toLowerCase()==="rtx"}).length&&$.sendEncodingParameters[0].rtx&&delete $.sendEncodingParameters[0].rtx,p._transceive($,mt==="sendrecv"||mt==="recvonly",mt==="sendrecv"||mt==="sendonly"),!U||mt!=="sendrecv"&&mt!=="sendonly"?delete $.rtpReceiver:(Ut=U.track,Et?(A[Et.stream]||(A[Et.stream]=new r.MediaStream),n(Ut,A[Et.stream]),m.push([Ut,U,A[Et.stream]])):(A.default||(A.default=new r.MediaStream),n(Ut,A.default),m.push([Ut,U,A.default]))));else{($=p.transceivers[k]||p._createTransceiver(V)).mid=At,$.iceGatherer||($.iceGatherer=p._createIceGatherer(k,b)),lt.length&&$.iceTransport.state==="new"&&(!Lt||b&&k!==0?lt.forEach(function(Q){wA($.iceTransport,Q)}):$.iceTransport.setRemoteCandidates(lt)),Ct=r.RTCRtpReceiver.getCapabilities(V),t<15019&&(Ct.codecs=Ct.codecs.filter(function(Q){return Q.name!=="rtx"})),Tt=$.sendEncodingParameters||[{ssrc:1001*(2*k+2)}];var R,B=!1;mt==="sendrecv"||mt==="sendonly"?(B=!$.rtpReceiver,U=$.rtpReceiver||new r.RTCRtpReceiver($.dtlsTransport,V),B&&(Ut=U.track,Et&&Et.stream==="-"||(Et?(A[Et.stream]||(A[Et.stream]=new r.MediaStream,Object.defineProperty(A[Et.stream],"id",{get:function(){return Et.stream}})),Object.defineProperty(Ut,"id",{get:function(){return Et.track}}),R=A[Et.stream]):(A.default||(A.default=new r.MediaStream),R=A.default)),R&&(n(Ut,R),$.associatedRemoteMediaStreams.push(R)),m.push([Ut,U,R]))):$.rtpReceiver&&$.rtpReceiver.track&&($.associatedRemoteMediaStreams.forEach(function(Q){var ut=Q.getTracks().find(function(Vt){return Vt.id===$.rtpReceiver.track.id});ut&&function(Vt,Ue){Ue.removeTrack(Vt),Ue.dispatchEvent(new r.MediaStreamTrackEvent("removetrack",{track:Vt}))}(ut,Q)}),$.associatedRemoteMediaStreams=[]),$.localCapabilities=Ct,$.remoteCapabilities=vt,$.rtpReceiver=U,$.rtcpParameters=at,$.sendEncodingParameters=Tt,$.recvEncodingParameters=It,p._transceive(p.transceivers[k],!1,B)}}}),p._dtlsRole===void 0&&(p._dtlsRole=h.type==="offer"?"active":"passive"),p._remoteDescription={type:h.type,sdp:h.sdp},h.type==="offer"?p._updateSignalingState("have-remote-offer"):p._updateSignalingState("stable"),Object.keys(A).forEach(function(w){var k=A[w];if(k.getTracks().length){if(p.remoteStreams.indexOf(k)===-1){p.remoteStreams.push(k);var P=new Event("addstream");P.stream=k,r.setTimeout(function(){p._dispatchEvent("addstream",P)})}m.forEach(function(V){var j=V[0],st=V[1];k.id===V[2].id&&s(p,j,st,[k])})}}),m.forEach(function(w){w[2]||s(p,w[0],w[1],[])}),r.setTimeout(function(){p&&p.transceivers&&p.transceivers.forEach(function(w){w.iceTransport&&w.iceTransport.state==="new"&&w.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),w.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},c.prototype.close=function(){this.transceivers.forEach(function(h){h.iceTransport&&h.iceTransport.stop(),h.dtlsTransport&&h.dtlsTransport.stop(),h.rtpSender&&h.rtpSender.stop(),h.rtpReceiver&&h.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},c.prototype._updateSignalingState=function(h){this.signalingState=h;var p=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",p)},c.prototype._maybeFireNegotiationNeeded=function(){var h=this;this.signalingState==="stable"&&this.needNegotiation!==!0&&(this.needNegotiation=!0,r.setTimeout(function(){if(h.needNegotiation){h.needNegotiation=!1;var p=new Event("negotiationneeded");h._dispatchEvent("negotiationneeded",p)}},0))},c.prototype._updateIceConnectionState=function(){var h,p={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(m){m.iceTransport&&!m.rejected&&p[m.iceTransport.state]++}),h="new",p.failed>0?h="failed":p.checking>0?h="checking":p.disconnected>0?h="disconnected":p.new>0?h="new":p.connected>0?h="connected":p.completed>0&&(h="completed"),h!==this.iceConnectionState){this.iceConnectionState=h;var A=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",A)}},c.prototype._updateConnectionState=function(){var h,p={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(m){m.iceTransport&&m.dtlsTransport&&!m.rejected&&(p[m.iceTransport.state]++,p[m.dtlsTransport.state]++)}),p.connected+=p.completed,h="new",p.failed>0?h="failed":p.connecting>0?h="connecting":p.disconnected>0?h="disconnected":p.new>0?h="new":p.connected>0&&(h="connected"),h!==this.connectionState){this.connectionState=h;var A=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",A)}},c.prototype.createOffer=function(){var h=this;if(h._isClosed)return Promise.reject(_i("InvalidStateError","Can not call createOffer after close"));var p=h.transceivers.filter(function(C){return C.kind==="audio"}).length,A=h.transceivers.filter(function(C){return C.kind==="video"}).length,m=arguments[0];if(m){if(m.mandatory||m.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");m.offerToReceiveAudio!==void 0&&(p=m.offerToReceiveAudio===!0?1:m.offerToReceiveAudio===!1?0:m.offerToReceiveAudio),m.offerToReceiveVideo!==void 0&&(A=m.offerToReceiveVideo===!0?1:m.offerToReceiveVideo===!1?0:m.offerToReceiveVideo)}for(h.transceivers.forEach(function(C){C.kind==="audio"?--p<0&&(C.wantReceive=!1):C.kind==="video"&&--A<0&&(C.wantReceive=!1)});p>0||A>0;)p>0&&(h._createTransceiver("audio"),p--),A>0&&(h._createTransceiver("video"),A--);var E=pe.writeSessionBoilerplate(h._sdpSessionId,h._sdpSessionVersion++);h.transceivers.forEach(function(C,b){var y=C.track,w=C.kind,k=C.mid||pe.generateIdentifier();C.mid=k,C.iceGatherer||(C.iceGatherer=h._createIceGatherer(b,h.usingBundle));var P=r.RTCRtpSender.getCapabilities(w);t<15019&&(P.codecs=P.codecs.filter(function(j){return j.name!=="rtx"})),P.codecs.forEach(function(j){j.name==="H264"&&j.parameters["level-asymmetry-allowed"]===void 0&&(j.parameters["level-asymmetry-allowed"]="1"),C.remoteCapabilities&&C.remoteCapabilities.codecs&&C.remoteCapabilities.codecs.forEach(function(st){j.name.toLowerCase()===st.name.toLowerCase()&&j.clockRate===st.clockRate&&(j.preferredPayloadType=st.payloadType)})}),P.headerExtensions.forEach(function(j){(C.remoteCapabilities&&C.remoteCapabilities.headerExtensions||[]).forEach(function(st){j.uri===st.uri&&(j.id=st.id)})});var V=C.sendEncodingParameters||[{ssrc:1001*(2*b+1)}];y&&t>=15019&&w==="video"&&!V[0].rtx&&(V[0].rtx={ssrc:V[0].ssrc+1}),C.wantReceive&&(C.rtpReceiver=new r.RTCRtpReceiver(C.dtlsTransport,w)),C.localCapabilities=P,C.sendEncodingParameters=V}),h._config.bundlePolicy!=="max-compat"&&(E+="a=group:BUNDLE "+h.transceivers.map(function(C){return C.mid}).join(" ")+`\r
`),E+=`a=ice-options:trickle\r
`,h.transceivers.forEach(function(C,b){E+=wI(C,C.localCapabilities,"offer",C.stream,h._dtlsRole),E+=`a=rtcp-rsize\r
`,!C.iceGatherer||h.iceGatheringState==="new"||b!==0&&h.usingBundle||(C.iceGatherer.getLocalCandidates().forEach(function(y){y.component=1,E+="a="+pe.writeCandidate(y)+`\r
`}),C.iceGatherer.state==="completed"&&(E+=`a=end-of-candidates\r
`))});var v=new r.RTCSessionDescription({type:"offer",sdp:E});return Promise.resolve(v)},c.prototype.createAnswer=function(){var h=this;if(h._isClosed)return Promise.reject(_i("InvalidStateError","Can not call createAnswer after close"));if(h.signalingState!=="have-remote-offer"&&h.signalingState!=="have-local-pranswer")return Promise.reject(_i("InvalidStateError","Can not call createAnswer in signalingState "+h.signalingState));var p=pe.writeSessionBoilerplate(h._sdpSessionId,h._sdpSessionVersion++);h.usingBundle&&(p+="a=group:BUNDLE "+h.transceivers.map(function(E){return E.mid}).join(" ")+`\r
`),p+=`a=ice-options:trickle\r
`;var A=pe.getMediaSections(h._remoteDescription.sdp).length;h.transceivers.forEach(function(E,v){if(!(v+1>A)){if(E.rejected)return E.kind==="application"?E.protocol==="DTLS/SCTP"?p+=`m=application 0 DTLS/SCTP 5000\r
`:p+="m=application 0 "+E.protocol+` webrtc-datachannel\r
`:E.kind==="audio"?p+=`m=audio 0 UDP/TLS/RTP/SAVPF 0\r
a=rtpmap:0 PCMU/8000\r
`:E.kind==="video"&&(p+=`m=video 0 UDP/TLS/RTP/SAVPF 120\r
a=rtpmap:120 VP8/90000\r
`),void(p+=`c=IN IP4 0.0.0.0\r
a=inactive\r
a=mid:`+E.mid+`\r
`);var C;E.stream&&(E.kind==="audio"?C=E.stream.getAudioTracks()[0]:E.kind==="video"&&(C=E.stream.getVideoTracks()[0]),C&&t>=15019&&E.kind==="video"&&!E.sendEncodingParameters[0].rtx&&(E.sendEncodingParameters[0].rtx={ssrc:E.sendEncodingParameters[0].ssrc+1}));var b=wh(E.localCapabilities,E.remoteCapabilities);!b.codecs.filter(function(y){return y.name.toLowerCase()==="rtx"}).length&&E.sendEncodingParameters[0].rtx&&delete E.sendEncodingParameters[0].rtx,p+=wI(E,b,"answer",E.stream,h._dtlsRole),E.rtcpParameters&&E.rtcpParameters.reducedSize&&(p+=`a=rtcp-rsize\r
`)}});var m=new r.RTCSessionDescription({type:"answer",sdp:p});return Promise.resolve(m)},c.prototype.addIceCandidate=function(h){var p,A=this;return h&&h.sdpMLineIndex===void 0&&!h.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(m,E){if(!A._remoteDescription)return E(_i("InvalidStateError","Can not add ICE candidate without a remote description"));if(h&&h.candidate!==""){var v=h.sdpMLineIndex;if(h.sdpMid){for(var C=0;C<A.transceivers.length;C++)if(A.transceivers[C].mid===h.sdpMid){v=C;break}}var b=A.transceivers[v];if(!b)return E(_i("OperationError","Can not add ICE candidate"));if(b.rejected)return m();var y=Object.keys(h.candidate).length>0?pe.parseCandidate(h.candidate):{};if(y.protocol==="tcp"&&(y.port===0||y.port===9)||y.component&&y.component!==1)return m();if((v===0||v>0&&b.iceTransport!==A.transceivers[0].iceTransport)&&!wA(b.iceTransport,y))return E(_i("OperationError","Can not add ICE candidate"));var w=h.candidate.trim();w.indexOf("a=")===0&&(w=w.substr(2)),(p=pe.getMediaSections(A._remoteDescription.sdp))[v]+="a="+(y.type?w:"end-of-candidates")+`\r
`,A._remoteDescription.sdp=pe.getDescription(A._remoteDescription.sdp)+p.join("")}else for(var k=0;k<A.transceivers.length&&(A.transceivers[k].rejected||(A.transceivers[k].iceTransport.addRemoteCandidate({}),(p=pe.getMediaSections(A._remoteDescription.sdp))[k]+=`a=end-of-candidates\r
`,A._remoteDescription.sdp=pe.getDescription(A._remoteDescription.sdp)+p.join(""),!A.usingBundle));k++);m()})},c.prototype.getStats=function(h){if(h&&h instanceof r.MediaStreamTrack){var p=null;if(this.transceivers.forEach(function(m){m.rtpSender&&m.rtpSender.track===h?p=m.rtpSender:m.rtpReceiver&&m.rtpReceiver.track===h&&(p=m.rtpReceiver)}),!p)throw _i("InvalidAccessError","Invalid selector.");return p.getStats()}var A=[];return this.transceivers.forEach(function(m){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(E){m[E]&&A.push(m[E].getStats())})}),Promise.all(A).then(function(m){var E=new Map;return m.forEach(function(v){v.forEach(function(C){E.set(C.id,C)})}),E})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(h){var p=r[h];if(p&&p.prototype&&p.prototype.getStats){var A=p.prototype.getStats;p.prototype.getStats=function(){return A.apply(this).then(function(m){var E=new Map;return Object.keys(m).forEach(function(v){var C;m[v].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(C=m[v]).type]||C.type,E.set(v,m[v])}),E})}}});var d=["createOffer","createAnswer"];return d.forEach(function(h){var p=c.prototype[h];c.prototype[h]=function(){var A=arguments;return typeof A[0]=="function"||typeof A[1]=="function"?p.apply(this,[arguments[2]]).then(function(m){typeof A[0]=="function"&&A[0].apply(null,[m])},function(m){typeof A[1]=="function"&&A[1].apply(null,[m])}):p.apply(this,arguments)}}),(d=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(h){var p=c.prototype[h];c.prototype[h]=function(){var A=arguments;return typeof A[1]=="function"||typeof A[2]=="function"?p.apply(this,arguments).then(function(){typeof A[1]=="function"&&A[1].apply(null)},function(m){typeof A[2]=="function"&&A[2].apply(null,[m])}):p.apply(this,arguments)}}),["getStats"].forEach(function(h){var p=c.prototype[h];c.prototype[h]=function(){var A=arguments;return typeof A[1]=="function"?p.apply(this,arguments).then(function(){typeof A[1]=="function"&&A[1].apply(null)}):p.apply(this,arguments)}}),c};function NI(r){var t;const n=r&&r.navigator,s=Mr(t=n.mediaDevices.getUserMedia).call(t,n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return s(c).catch(d=>dt.reject(function(h){return{name:{PermissionDeniedError:"NotAllowedError"}[h.name]||h.name,message:h.message,constraint:h.constraint,toString(){return this.name}}}(d)))}}function OI(r){var t;"getDisplayMedia"in r.navigator&&r.navigator.mediaDevices&&(r.navigator.mediaDevices&&"getDisplayMedia"in r.navigator.mediaDevices||(r.navigator.mediaDevices.getDisplayMedia=Mr(t=r.navigator.getDisplayMedia).call(t,r.navigator)))}function bA(r){const t=ra(r);if(r.RTCIceGatherer&&(r.RTCIceCandidate||(r.RTCIceCandidate=function(s){return s}),r.RTCSessionDescription||(r.RTCSessionDescription=function(s){return s}),t.version<15025)){const s=Wt(r.MediaStreamTrack.prototype,"enabled");se(r.MediaStreamTrack.prototype,"enabled",{set(c){s.set.call(this,c);const d=new Event("enabled");d.enabled=c,this.dispatchEvent(d)}})}r.RTCRtpSender&&!("dtmf"in r.RTCRtpSender.prototype)&&se(r.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=new r.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}}),r.RTCDtmfSender&&!r.RTCDTMFSender&&(r.RTCDTMFSender=r.RTCDtmfSender);const n=w2(r,t.version);r.RTCPeerConnection=function(s){return s&&s.iceServers&&(s.iceServers=function(c,d){let h=!1;return c=JSON.parse(ht(c)),kt(c).call(c,p=>{if(p&&(p.urls||p.url)){var A=p.urls||p.url;p.url&&!p.urls&&yh("RTCIceServer.url","RTCIceServer.urls");const m=typeof A=="string";return m&&(A=[A]),A=kt(A).call(A,E=>{if(Ft(E).call(E,"stun:")===0)return!1;const v=al(E).call(E,"turn")&&!al(E).call(E,"turn:[")&&zt(E).call(E,"transport=udp");return v&&!h?(h=!0,!0):v&&!h}),delete p.url,p.urls=m?A[0]:A,!!A.length}})}(s.iceServers,t.version),sA("ICE servers after filtering:",s.iceServers)),new n(s)},r.RTCPeerConnection.prototype=n.prototype}function kI(r){r.RTCRtpSender&&!("replaceTrack"in r.RTCRtpSender.prototype)&&(r.RTCRtpSender.prototype.replaceTrack=r.RTCRtpSender.prototype.setTrack)}var DI=Object.freeze({__proto__:null,shimPeerConnection:bA,shimReplaceTrack:kI,shimGetUserMedia:NI,shimGetDisplayMedia:OI});function LI(r){const t=ra(r),n=r&&r.navigator,s=r&&r.MediaStreamTrack;if(n.getUserMedia=function(d,h,p){yh("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(d).then(h,p)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){var c;const d=function(p,A,m){A in p&&!(m in p)&&(p[m]=p[A],delete p[A])},h=Mr(c=n.mediaDevices.getUserMedia).call(c,n.mediaDevices);if(n.mediaDevices.getUserMedia=function(p){return typeof p=="object"&&typeof p.audio=="object"&&(p=JSON.parse(ht(p)),d(p.audio,"autoGainControl","mozAutoGainControl"),d(p.audio,"noiseSuppression","mozNoiseSuppression")),h(p)},s&&s.prototype.getSettings){const p=s.prototype.getSettings;s.prototype.getSettings=function(){const A=p.apply(this,arguments);return d(A,"mozAutoGainControl","autoGainControl"),d(A,"mozNoiseSuppression","noiseSuppression"),A}}if(s&&s.prototype.applyConstraints){const p=s.prototype.applyConstraints;s.prototype.applyConstraints=function(A){return this.kind==="audio"&&typeof A=="object"&&(A=JSON.parse(ht(A)),d(A,"autoGainControl","mozAutoGainControl"),d(A,"noiseSuppression","mozNoiseSuppression")),p.apply(this,[A])}}}}function MI(r){typeof r=="object"&&r.RTCTrackEvent&&"receiver"in r.RTCTrackEvent.prototype&&!("transceiver"in r.RTCTrackEvent.prototype)&&se(r.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function NA(r){const t=ra(r);if(typeof r!="object"||!r.RTCPeerConnection&&!r.mozRTCPeerConnection)return;var n;!r.RTCPeerConnection&&r.mozRTCPeerConnection&&(r.RTCPeerConnection=r.mozRTCPeerConnection),t.version<53&&G(n=["setLocalDescription","setRemoteDescription","addIceCandidate"]).call(n,function(h){const p=r.RTCPeerConnection.prototype[h],A={[h](){return arguments[0]=new(h==="addIceCandidate"?r.RTCIceCandidate:r.RTCSessionDescription)(arguments[0]),p.apply(this,arguments)}};r.RTCPeerConnection.prototype[h]=A[h]});const s=r.RTCPeerConnection.prototype.addIceCandidate;r.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?t.version<68&&arguments[0]&&arguments[0].candidate===""?dt.resolve():s.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),dt.resolve())};const c={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},d=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(){const[h,p,A]=arguments;return d.apply(this,[h||null]).then(m=>{if(t.version<53&&!p)try{G(m).call(m,E=>{E.type=c[E.type]||E.type})}catch(E){if(E.name!=="TypeError")throw E;G(m).call(m,(v,C)=>{m.set(C,hr({},v,{type:c[v.type]||v.type}))})}return m}).then(p,A)}}function PI(r){if(typeof r!="object"||!r.RTCPeerConnection||!r.RTCRtpSender||r.RTCRtpSender&&"getStats"in r.RTCRtpSender.prototype)return;const t=r.RTCPeerConnection.prototype.getSenders;t&&(r.RTCPeerConnection.prototype.getSenders=function(){const s=t.apply(this,[]);return G(s).call(s,c=>c._pc=this),s});const n=r.RTCPeerConnection.prototype.addTrack;n&&(r.RTCPeerConnection.prototype.addTrack=function(){const s=n.apply(this,arguments);return s._pc=this,s}),r.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):dt.resolve(new re)}}function BI(r){if(typeof r!="object"||!r.RTCPeerConnection||!r.RTCRtpSender||r.RTCRtpSender&&"getStats"in r.RTCRtpReceiver.prototype)return;const t=r.RTCPeerConnection.prototype.getReceivers;t&&(r.RTCPeerConnection.prototype.getReceivers=function(){const n=t.apply(this,[]);return G(n).call(n,s=>s._pc=this),n}),$c(r,"track",n=>(n.receiver._pc=n.srcElement,n)),r.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function UI(r){r.RTCPeerConnection&&!("removeStream"in r.RTCPeerConnection.prototype)&&(r.RTCPeerConnection.prototype.removeStream=function(t){var n;yh("removeStream","removeTrack"),G(n=this.getSenders()).call(n,s=>{var c;s.track&&zt(c=t.getTracks()).call(c,s.track)&&this.removeTrack(s)})})}function xI(r){r.DataChannel&&!r.RTCDataChannel&&(r.RTCDataChannel=r.DataChannel)}var FI=Object.freeze({__proto__:null,shimOnTrack:MI,shimPeerConnection:NA,shimSenderGetStats:PI,shimReceiverGetStats:BI,shimRemoveStream:UI,shimRTCDataChannel:xI,shimGetUserMedia:LI,shimGetDisplayMedia:function(r,t){r.navigator.mediaDevices&&"getDisplayMedia"in r.navigator.mediaDevices||r.navigator.mediaDevices&&(r.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const s=new DOMException("getDisplayMedia without video constraints is undefined");return s.name="NotFoundError",s.code=8,dt.reject(s)}return n.video===!0?n.video={mediaSource:t}:n.video.mediaSource=t,r.navigator.mediaDevices.getUserMedia(n)})}});function QI(r){if(typeof r=="object"&&r.RTCPeerConnection){if("getLocalStreams"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in r.RTCPeerConnection.prototype)){const t=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addStream=function(n){var s,c,d;this._localStreams||(this._localStreams=[]),zt(s=this._localStreams).call(s,n)||this._localStreams.push(n),G(c=n.getAudioTracks()).call(c,h=>t.call(this,h,n)),G(d=n.getVideoTracks()).call(d,h=>t.call(this,h,n))},r.RTCPeerConnection.prototype.addTrack=function(n,s){var c;return s&&(this._localStreams?zt(c=this._localStreams).call(c,s)||this._localStreams.push(s):this._localStreams=[s]),t.call(this,n,s)}}"removeStream"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.removeStream=function(t){var n,s,c;this._localStreams||(this._localStreams=[]);const d=Ft(n=this._localStreams).call(n,t);if(d===-1)return;Ye(s=this._localStreams).call(s,d,1);const h=t.getTracks();G(c=this.getSenders()).call(c,p=>{zt(h).call(h,p.track)&&this.removeTrack(p)})})}}function VI(r){if(typeof r=="object"&&r.RTCPeerConnection&&("getRemoteStreams"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in r.RTCPeerConnection.prototype))){se(r.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=s=>{var c;G(c=s.streams).call(c,d=>{var h;if(this._remoteStreams||(this._remoteStreams=[]),zt(h=this._remoteStreams).call(h,d))return;this._remoteStreams.push(d);const p=new Event("addstream");p.stream=d,this.dispatchEvent(p)})})}});const t=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(s){var c;G(c=s.streams).call(c,d=>{var h;if(n._remoteStreams||(n._remoteStreams=[]),Ft(h=n._remoteStreams).call(h,d)>=0)return;n._remoteStreams.push(d);const p=new Event("addstream");p.stream=d,n.dispatchEvent(p)})}),t.apply(n,arguments)}}}function GI(r){if(typeof r!="object"||!r.RTCPeerConnection)return;const t=r.RTCPeerConnection.prototype,n=t.createOffer,s=t.createAnswer,c=t.setLocalDescription,d=t.setRemoteDescription,h=t.addIceCandidate;t.createOffer=function(A,m){const E=arguments.length>=2?arguments[2]:arguments[0],v=n.apply(this,[E]);return m?(v.then(A,m),dt.resolve()):v},t.createAnswer=function(A,m){const E=arguments.length>=2?arguments[2]:arguments[0],v=s.apply(this,[E]);return m?(v.then(A,m),dt.resolve()):v};let p=function(A,m,E){const v=c.apply(this,[A]);return E?(v.then(m,E),dt.resolve()):v};t.setLocalDescription=p,p=function(A,m,E){const v=d.apply(this,[A]);return E?(v.then(m,E),dt.resolve()):v},t.setRemoteDescription=p,p=function(A,m,E){const v=h.apply(this,[A]);return E?(v.then(m,E),dt.resolve()):v},t.addIceCandidate=p}function jI(r){const t=r&&r.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var n;const c=t.mediaDevices,d=Mr(n=c.getUserMedia).call(n,c);t.mediaDevices.getUserMedia=h=>d(WI(h))}var s;!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=Mr(s=function(c,d,h){t.mediaDevices.getUserMedia(c).then(d,h)}).call(s,t))}function WI(r){return r&&r.video!==void 0?hr({},r,{video:Cv(r.video)}):r}function KI(r){const t=r.RTCPeerConnection;r.RTCPeerConnection=function(n,s){if(n&&n.iceServers){const c=[];for(let d=0;d<n.iceServers.length;d++){let h=n.iceServers[d];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(yh("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(ht(h)),h.urls=h.url,delete h.url,c.push(h)):c.push(n.iceServers[d])}n.iceServers=c}return new t(n,s)},r.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in r.RTCPeerConnection&&se(r.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function HI(r){typeof r=="object"&&r.RTCPeerConnection&&"receiver"in r.RTCTrackEvent.prototype&&!r.RTCTransceiver&&se(r.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function YI(r){const t=r.RTCPeerConnection.prototype.createOffer;r.RTCPeerConnection.prototype.createOffer=function(n){if(n){var s,c;n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const d=_t(s=this.getTransceivers()).call(s,p=>p.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&d?d.direction==="sendrecv"?d.setDirection?d.setDirection("sendonly"):d.direction="sendonly":d.direction==="recvonly"&&(d.setDirection?d.setDirection("inactive"):d.direction="inactive"):n.offerToReceiveAudio!==!0||d||this.addTransceiver("audio"),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const h=_t(c=this.getTransceivers()).call(c,p=>p.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&h?h.direction==="sendrecv"?h.setDirection?h.setDirection("sendonly"):h.direction="sendonly":h.direction==="recvonly"&&(h.setDirection?h.setDirection("inactive"):h.direction="inactive"):n.offerToReceiveVideo!==!0||h||this.addTransceiver("video")}return t.apply(this,arguments)}}var qI=Object.freeze({__proto__:null,shimLocalStreamsAPI:QI,shimRemoteStreamsAPI:VI,shimCallbacksAPI:GI,shimGetUserMedia:jI,shimConstraints:WI,shimRTCIceServerUrls:KI,shimTrackEventTransceiver:HI,shimCreateOfferLegacy:YI});function bh(r){if(!r.RTCIceCandidate||r.RTCIceCandidate&&"foundation"in r.RTCIceCandidate.prototype)return;const t=r.RTCIceCandidate;r.RTCIceCandidate=function(n){var s;if(typeof n=="object"&&n.candidate&&Ft(s=n.candidate).call(s,"a=")===0&&((n=JSON.parse(ht(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const c=new t(n),d=pe.parseCandidate(n.candidate),h=hr(c,d);return h.toJSON=function(){return{candidate:h.candidate,sdpMid:h.sdpMid,sdpMLineIndex:h.sdpMLineIndex,usernameFragment:h.usernameFragment}},h}return new t(n)},r.RTCIceCandidate.prototype=t.prototype,$c(r,"icecandidate",n=>(n.candidate&&se(n,"candidate",{value:new r.RTCIceCandidate(n.candidate),writable:"false"}),n))}function bd(r){if(!r.RTCPeerConnection)return;const t=ra(r);"sctp"in r.RTCPeerConnection.prototype||se(r.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n=function(p){if(!p||!p.sdp)return!1;const A=pe.splitSections(p.sdp);return A.shift(),bs(A).call(A,m=>{var E;const v=pe.parseMLine(m);return v&&v.kind==="application"&&Ft(E=v.protocol).call(E,"SCTP")!==-1})},s=function(p){const A=p.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(A===null||A.length<2)return-1;const m=Sr(A[1],10);return m!=m?-1:m},c=function(p){let A=65536;return t.browser==="firefox"&&(A=t.version<57?p===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),A},d=function(p,A){let m=65536;t.browser==="firefox"&&t.version===57&&(m=65535);const E=pe.matchPrefix(p.sdp,"a=max-message-size:");return E.length>0?m=Sr(E[0].substr(19),10):t.browser==="firefox"&&A!==-1&&(m=2147483637),m},h=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:p}=this.getConfiguration();p==="plan-b"&&se(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const p=s(arguments[0]),A=c(p),m=d(arguments[0],p);let E;E=A===0&&m===0?Number.POSITIVE_INFINITY:A===0||m===0?Math.max(A,m):Math.min(A,m);const v={};se(v,"maxMessageSize",{get:()=>E}),this._sctp=v}return h.apply(this,arguments)}}function Nd(r){if(!r.RTCPeerConnection||!("createDataChannel"in r.RTCPeerConnection.prototype))return;function t(s,c){const d=s.send;s.send=function(){const h=arguments[0],p=h.length||h.size||h.byteLength;if(s.readyState==="open"&&c.sctp&&p>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return d.apply(s,arguments)}}const n=r.RTCPeerConnection.prototype.createDataChannel;r.RTCPeerConnection.prototype.createDataChannel=function(){const s=n.apply(this,arguments);return t(s,this),s},$c(r,"datachannel",s=>(t(s.channel,s.target),s))}function OA(r){var t;if(!r.RTCPeerConnection||"connectionState"in r.RTCPeerConnection.prototype)return;const n=r.RTCPeerConnection.prototype;se(n,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),se(n,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(s){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),s&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=s)},enumerable:!0,configurable:!0}),G(t=["setLocalDescription","setRemoteDescription"]).call(t,s=>{const c=n[s];n[s]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=d=>{const h=d.target;if(h._lastConnectionState!==h.connectionState){h._lastConnectionState=h.connectionState;const p=new Event("connectionstatechange",d);h.dispatchEvent(p)}return d},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),c.apply(this,arguments)}})}function kA(r){if(!r.RTCPeerConnection)return;const t=ra(r);if(t.browser==="chrome"&&t.version>=71)return;const n=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(s){var c,d;return s&&s.sdp&&Ft(c=s.sdp).call(c,`
a=extmap-allow-mixed`)!==-1&&(s.sdp=kt(d=s.sdp.split(`
`)).call(d,h=>pc(h).call(h)!=="a=extmap-allow-mixed").join(`
`)),n.apply(this,arguments)}}var b2=Object.freeze({__proto__:null,shimRTCIceCandidate:bh,shimMaxMessageSize:bd,shimSendThrowTypeError:Nd,shimConnectionState:OA,removeAllowExtmapMixed:kA});(function({window:r}={},t={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){const n=sA,s=ra(r),c={browserDetails:s,commonShim:b2,extractVersion:Cd,disableLog:OO,disableWarnings:kO};switch(s.browser){case"chrome":if(!SI||!RA||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),c;n("adapter.js shimming chrome."),c.browserShim=SI,fI(r),AI(r),RA(r),gI(r),II(r),mI(r),EI(r),_I(r),CI(r),bh(r),OA(r),bd(r),Nd(r),kA(r);break;case"firefox":if(!FI||!NA||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),c;n("adapter.js shimming firefox."),c.browserShim=FI,LI(r),NA(r),MI(r),UI(r),PI(r),BI(r),xI(r),bh(r),OA(r),bd(r),Nd(r);break;case"edge":if(!DI||!bA||!t.shimEdge)return n("MS edge shim is not included in this adapter release."),c;n("adapter.js shimming edge."),c.browserShim=DI,NI(r),OI(r),bA(r),kI(r),bd(r),Nd(r);break;case"safari":if(!qI||!t.shimSafari)return n("Safari shim is not included in this adapter release."),c;n("adapter.js shimming safari."),c.browserShim=qI,KI(r),YI(r),GI(r),QI(r),VI(r),HI(r),jI(r),bh(r),bd(r),Nd(r),kA(r);break;default:n("Unsupported browser!")}})({window});var Mn,Re;(function(r){r.WIN_10="Windows 10",r.WIN_81="Windows 8.1",r.WIN_8="Windows 8",r.WIN_7="Windows 7",r.WIN_VISTA="Windows Vista",r.WIN_SERVER_2003="Windows Server 2003",r.WIN_XP="Windows XP",r.WIN_2000="Windows 2000",r.ANDROID="Android",r.OPEN_BSD="Open BSD",r.SUN_OS="Sun OS",r.LINUX="Linux",r.IOS="iOS",r.MAC_OS="Mac OS",r.QNX="QNX",r.UNIX="UNIX",r.BEOS="BeOS",r.OS_2="OS/2",r.SEARCH_BOT="Search Bot"})(Mn||(Mn={})),function(r){r.CHROME="Chrome",r.SAFARI="Safari",r.EDGE="Edge",r.FIREFOX="Firefox",r.OPERA="OPR",r.QQ="QQBrowser",r.WECHAT="MicroMessenger"}(Re||(Re={}));const DA=new(a(function(r,t){/*!@license
	 * UAParser.js v0.7.28
	 * Lightweight JavaScript-based User-Agent string parser
	 * https://github.com/faisalman/ua-parser-js
	 *
	 * Copyright © 2012-2021 Faisal Salman <f@faisalman.com>
	 * Licensed under MIT License
	 */(function(n,s){var c="function",d="object",h="string",p="model",A="name",m="type",E="vendor",v="version",C="architecture",b="console",y="mobile",w="tablet",k="smarttv",P="wearable",V="embedded",j={extend:function(W,H){var U={};for(var Tt in W)H[Tt]&&H[Tt].length%2==0?U[Tt]=H[Tt].concat(W[Tt]):U[Tt]=W[Tt];return U},has:function(W,H){return typeof W===h&&H.toLowerCase().indexOf(W.toLowerCase())!==-1},lowerize:function(W){return W.toLowerCase()},major:function(W){return typeof W===h?W.replace(/[^\d\.]/g,"").split(".")[0]:s},trim:function(W,H){return W=W.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),H===void 0?W:W.substring(0,255)}},st={rgx:function(W,H){for(var U,Tt,It,Ct,Ut,Y,tt=0;tt<H.length&&!Ut;){var vt=H[tt],at=H[tt+1];for(U=Tt=0;U<vt.length&&!Ut;)if(Ut=vt[U++].exec(W))for(It=0;It<at.length;It++)Y=Ut[++Tt],typeof(Ct=at[It])===d&&Ct.length>0?Ct.length==2?typeof Ct[1]==c?this[Ct[0]]=Ct[1].call(this,Y):this[Ct[0]]=Ct[1]:Ct.length==3?typeof Ct[1]!==c||Ct[1].exec&&Ct[1].test?this[Ct[0]]=Y?Y.replace(Ct[1],Ct[2]):s:this[Ct[0]]=Y?Ct[1].call(this,Y,Ct[2]):s:Ct.length==4&&(this[Ct[0]]=Y?Ct[3].call(this,Y.replace(Ct[1],Ct[2])):s):this[Ct]=Y||s;tt+=2}},str:function(W,H){for(var U in H)if(typeof H[U]===d&&H[U].length>0){for(var Tt=0;Tt<H[U].length;Tt++)if(j.has(H[U][Tt],W))return U==="?"?s:U}else if(j.has(H[U],W))return U==="?"?s:U;return W}},mt={browser:{oldSafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}},oldEdge:{version:{.1:"12.",21:"13.",31:"14.",39:"15.",41:"16.",42:"17.",44:"18."}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},Et={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[v,[A,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[v,[A,"Edge"]],[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]{3,6})\b.+version\/([\w\.-]+)/i,/(opera)(?:.+version\/|[\/\s]+)([\w\.]+)/i],[A,v],[/opios[\/\s]+([\w\.]+)/i],[v,[A,"Opera Mini"]],[/\sopr\/([\w\.]+)/i],[v,[A,"Opera"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]*)/i,/(avant\s|iemobile|slim)(?:browser)?[\/\s]?([\w\.]*)/i,/(ba?idubrowser)[\/\s]?([\w\.]+)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon)\/([\w\.-]+)/i,/(rekonq|puffin|brave|whale|qqbrowserlite|qq)\/([\w\.]+)/i,/(weibo)__([\d\.]+)/i],[A,v],[/(?:[\s\/]uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],[v,[A,"UCBrowser"]],[/(?:windowswechat)?\sqbcore\/([\w\.]+)\b.*(?:windowswechat)?/i],[v,[A,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[v,[A,"WeChat"]],[/konqueror\/([\w\.]+)/i],[v,[A,"Konqueror"]],[/trident.+rv[:\s]([\w\.]{1,9})\b.+like\sgecko/i],[v,[A,"IE"]],[/yabrowser\/([\w\.]+)/i],[v,[A,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[A,/(.+)/,"$1 Secure Browser"],v],[/focus\/([\w\.]+)/i],[v,[A,"Firefox Focus"]],[/opt\/([\w\.]+)/i],[v,[A,"Opera Touch"]],[/coc_coc_browser\/([\w\.]+)/i],[v,[A,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[v,[A,"Dolphin"]],[/coast\/([\w\.]+)/i],[v,[A,"Opera Coast"]],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[v,[A,"MIUI Browser"]],[/fxios\/([\w\.-]+)/i],[v,[A,"Firefox"]],[/(qihu|qhbrowser|qihoobrowser|360browser)/i],[[A,"360 Browser"]],[/(oculus|samsung|sailfish)browser\/([\w\.]+)/i],[[A,/(.+)/,"$1 Browser"],v],[/(comodo_dragon)\/([\w\.]+)/i],[[A,/_/g," "],v],[/\s(electron)\/([\w\.]+)\ssafari/i,/(tesla)(?:\sqtcarbrowser|\/(20[12]\d\.[\w\.-]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/\s]?([\w\.]+)/i],[A,v],[/(MetaSr)[\/\s]?([\w\.]+)/i,/(LBBROWSER)/i],[A],[/;fbav\/([\w\.]+);/i],[v,[A,"Facebook"]],[/FBAN\/FBIOS|FB_IAB\/FB4A/i],[[A,"Facebook"]],[/safari\s(line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/\s]([\w\.-]+)/i],[A,v],[/\bgsa\/([\w\.]+)\s.*safari\//i],[v,[A,"GSA"]],[/headlesschrome(?:\/([\w\.]+)|\s)/i],[v,[A,"Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[A,"Chrome WebView"],v],[/droid.+\sversion\/([\w\.]+)\b.+(?:mobile\ssafari|safari)/i],[v,[A,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],[A,v],[/version\/([\w\.]+)\s.*mobile\/\w+\s(safari)/i],[v,[A,"Mobile Safari"]],[/version\/([\w\.]+)\s.*(mobile\s?safari|safari)/i],[v,A],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[A,[v,st.str,mt.browser.oldSafari.version]],[/(webkit|khtml)\/([\w\.]+)/i],[A,v],[/(navigator|netscape)\/([\w\.-]+)/i],[[A,"Netscape"],v],[/ile\svr;\srv:([\w\.]+)\).+firefox/i],[v,[A,"Firefox Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([\w\.-]+)$/i,/(firefox)\/([\w\.]+)\s[\w\s\-]+\/[\w\.]+$/i,/(mozilla)\/([\w\.]+)\s.+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]*)/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[A,v]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[C,"amd64"]],[/(ia32(?=;))/i],[[C,j.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[C,"ia32"]],[/\b(aarch64|armv?8e?l?)\b/i],[[C,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[C,"armhf"]],[/windows\s(ce|mobile);\sppc;/i],[[C,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[C,/ower/,"",j.lowerize]],[/(sun4\w)[;\)]/i],[[C,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?:64|(?=v(?:[1-7]|[5-7]1)l?|;|eabi))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[C,j.lowerize]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[pt]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus\s10)/i],[p,[E,"Samsung"],[m,w]],[/\b((?:s[cgp]h|gt|sm)-\w+|galaxy\snexus)/i,/\ssamsung[\s-]([\w-]+)/i,/sec-(sgh\w+)/i],[p,[E,"Samsung"],[m,y]],[/\((ip(?:hone|od)[\s\w]*);/i],[p,[E,"Apple"],[m,y]],[/\((ipad);[\w\s\),;-]+apple/i,/applecoremedia\/[\w\.]+\s\((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[p,[E,"Apple"],[m,w]],[/\b((?:agr|ags[23]|bah2?|sht?)-a?[lw]\d{2})/i],[p,[E,"Huawei"],[m,w]],[/d\/huawei([\w\s-]+)[;\)]/i,/\b(nexus\s6p|vog-[at]?l\d\d|ane-[at]?l[x\d]\d|eml-a?l\d\da?|lya-[at]?l\d[\dc]|clt-a?l\d\di?|ele-l\d\d)/i,/\b(\w{2,4}-[atu][ln][01259][019])[;\)\s]/i],[p,[E,"Huawei"],[m,y]],[/\b(poco[\s\w]+)(?:\sbuild|\))/i,/\b;\s(\w+)\sbuild\/hm\1/i,/\b(hm[\s\-_]?note?[\s_]?(?:\d\w)?)\sbuild/i,/\b(redmi[\s\-_]?(?:note|k)?[\w\s_]+)(?:\sbuild|\))/i,/\b(mi[\s\-_]?(?:a\d|one|one[\s_]plus|note lte)?[\s_]?(?:\d?\w?)[\s_]?(?:plus)?)\sbuild/i],[[p,/_/g," "],[E,"Xiaomi"],[m,y]],[/\b(mi[\s\-_]?(?:pad)(?:[\w\s_]+))(?:\sbuild|\))/i],[[p,/_/g," "],[E,"Xiaomi"],[m,w]],[/;\s(\w+)\sbuild.+\soppo/i,/\s(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007)\b/i],[p,[E,"OPPO"],[m,y]],[/\svivo\s(\w+)(?:\sbuild|\))/i,/\s(v[12]\d{3}\w?[at])(?:\sbuild|;)/i],[p,[E,"Vivo"],[m,y]],[/\s(rmx[12]\d{3})(?:\sbuild|;)/i],[p,[E,"Realme"],[m,y]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?:?(\s4g)?)\b[\w\s]+build\//i,/\smot(?:orola)?[\s-](\w*)/i,/((?:moto[\s\w\(\)]+|xt\d{3,4}|nexus\s6)(?=\sbuild|\)))/i],[p,[E,"Motorola"],[m,y]],[/\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[p,[E,"Motorola"],[m,w]],[/((?=lg)?[vl]k\-?\d{3})\sbuild|\s3\.[\s\w;-]{10}lg?-([06cv9]{3,4})/i],[p,[E,"LG"],[m,w]],[/(lm-?f100[nv]?|nexus\s[45])/i,/lg[e;\s\/-]+((?!browser|netcast)\w+)/i,/\blg(\-?[\d\w]+)\sbuild/i],[p,[E,"LG"],[m,y]],[/(ideatab[\w\-\s]+)/i,/lenovo\s?(s(?:5000|6000)(?:[\w-]+)|tab(?:[\s\w]+)|yt[\d\w-]{6}|tb[\d\w-]{6})/i],[p,[E,"Lenovo"],[m,w]],[/(?:maemo|nokia).*(n900|lumia\s\d+)/i,/nokia[\s_-]?([\w\.-]*)/i],[[p,/_/g," "],[E,"Nokia"],[m,y]],[/droid.+;\s(pixel\sc)[\s)]/i],[p,[E,"Google"],[m,w]],[/droid.+;\s(pixel[\s\daxl]{0,6})(?:\sbuild|\))/i],[p,[E,"Google"],[m,y]],[/droid.+\s([c-g]\d{4}|so[-l]\w+|xq-a\w[4-7][12])(?=\sbuild\/|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[p,[E,"Sony"],[m,y]],[/sony\stablet\s[ps]\sbuild\//i,/(?:sony)?sgp\w+(?:\sbuild\/|\))/i],[[p,"Xperia Tablet"],[E,"Sony"],[m,w]],[/\s(kb2005|in20[12]5|be20[12][59])\b/i,/\ba000(1)\sbuild/i,/\boneplus\s(a\d{4})[\s)]/i],[p,[E,"OnePlus"],[m,y]],[/(alexa)webm/i,/(kf[a-z]{2}wi)(\sbuild\/|\))/i,/(kf[a-z]+)(\sbuild\/|\)).+silk\//i],[p,[E,"Amazon"],[m,w]],[/(sd|kf)[0349hijorstuw]+(\sbuild\/|\)).+silk\//i],[[p,"Fire Phone"],[E,"Amazon"],[m,y]],[/\((playbook);[\w\s\),;-]+(rim)/i],[p,E,[m,w]],[/((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10;\s(\w+)/i],[p,[E,"BlackBerry"],[m,y]],[/(?:\b|asus_)(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus\s7|padfone|p00[cj])/i],[p,[E,"ASUS"],[m,w]],[/\s(z[es]6[027][01][km][ls]|zenfone\s\d\w?)\b/i],[p,[E,"ASUS"],[m,y]],[/(nexus\s9)/i],[p,[E,"HTC"],[m,w]],[/(htc)[;_\s-]{1,2}([\w\s]+(?=\)|\sbuild)|\w+)/i,/(zte)-(\w*)/i,/(alcatel|geeksphone|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]*)/i],[E,[p,/_/g," "],[m,y]],[/droid[x\d\.\s;]+\s([ab][1-7]\-?[0178a]\d\d?)/i],[p,[E,"Acer"],[m,w]],[/droid.+;\s(m[1-5]\snote)\sbuild/i,/\bmz-([\w-]{2,})/i],[p,[E,"Meizu"],[m,y]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]*)/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i,/(microsoft);\s(lumia[\s\w]+)/i,/(lenovo)[_\s-]?([\w-]+)/i,/linux;.+(jolla);/i,/droid.+;\s(oppo)\s?([\w\s]+)\sbuild/i],[E,p,[m,y]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i,/[;\/]\s?(le[\s\-]+pan)[\s\-]+(\w{1,9})\sbuild/i,/[;\/]\s?(trinity)[\-\s]*(t\d{3})\sbuild/i,/\b(gigaset)[\s\-]+(q\w{1,9})\sbuild/i,/\b(vodafone)\s([\w\s]+)(?:\)|\sbuild)/i],[E,p,[m,w]],[/\s(surface\sduo)\s/i],[p,[E,"Microsoft"],[m,w]],[/droid\s[\d\.]+;\s(fp\du?)\sbuild/i],[p,[E,"Fairphone"],[m,y]],[/\s(u304aa)\sbuild/i],[p,[E,"AT&T"],[m,y]],[/sie-(\w*)/i],[p,[E,"Siemens"],[m,y]],[/[;\/]\s?(rct\w+)\sbuild/i],[p,[E,"RCA"],[m,w]],[/[;\/\s](venue[\d\s]{2,7})\sbuild/i],[p,[E,"Dell"],[m,w]],[/[;\/]\s?(q(?:mv|ta)\w+)\sbuild/i],[p,[E,"Verizon"],[m,w]],[/[;\/]\s(?:barnes[&\s]+noble\s|bn[rt])([\w\s\+]*)\sbuild/i],[p,[E,"Barnes & Noble"],[m,w]],[/[;\/]\s(tm\d{3}\w+)\sbuild/i],[p,[E,"NuVision"],[m,w]],[/;\s(k88)\sbuild/i],[p,[E,"ZTE"],[m,w]],[/;\s(nx\d{3}j)\sbuild/i],[p,[E,"ZTE"],[m,y]],[/[;\/]\s?(gen\d{3})\sbuild.*49h/i],[p,[E,"Swiss"],[m,y]],[/[;\/]\s?(zur\d{3})\sbuild/i],[p,[E,"Swiss"],[m,w]],[/[;\/]\s?((zeki)?tb.*\b)\sbuild/i],[p,[E,"Zeki"],[m,w]],[/[;\/]\s([yr]\d{2})\sbuild/i,/[;\/]\s(dragon[\-\s]+touch\s|dt)(\w{5})\sbuild/i],[[E,"Dragon Touch"],p,[m,w]],[/[;\/]\s?(ns-?\w{0,9})\sbuild/i],[p,[E,"Insignia"],[m,w]],[/[;\/]\s?((nxa|Next)-?\w{0,9})\sbuild/i],[p,[E,"NextBook"],[m,w]],[/[;\/]\s?(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05]))\sbuild/i],[[E,"Voice"],p,[m,y]],[/[;\/]\s?(lvtel\-)?(v1[12])\sbuild/i],[[E,"LvTel"],p,[m,y]],[/;\s(ph-1)\s/i],[p,[E,"Essential"],[m,y]],[/[;\/]\s?(v(100md|700na|7011|917g).*\b)\sbuild/i],[p,[E,"Envizen"],[m,w]],[/[;\/]\s?(trio[\s\w\-\.]+)\sbuild/i],[p,[E,"MachSpeed"],[m,w]],[/[;\/]\s?tu_(1491)\sbuild/i],[p,[E,"Rotor"],[m,w]],[/(shield[\w\s]+)\sbuild/i],[p,[E,"Nvidia"],[m,w]],[/(sprint)\s(\w+)/i],[E,p,[m,y]],[/(kin\.[onetw]{3})/i],[[p,/\./g," "],[E,"Microsoft"],[m,y]],[/droid\s[\d\.]+;\s(cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[p,[E,"Zebra"],[m,w]],[/droid\s[\d\.]+;\s(ec30|ps20|tc[2-8]\d[kx])\)/i],[p,[E,"Zebra"],[m,y]],[/\s(ouya)\s/i,/(nintendo)\s([wids3utch]+)/i],[E,p,[m,b]],[/droid.+;\s(shield)\sbuild/i],[p,[E,"Nvidia"],[m,b]],[/(playstation\s[345portablevi]+)/i],[p,[E,"Sony"],[m,b]],[/[\s\(;](xbox(?:\sone)?(?!;\sxbox))[\s\);]/i],[p,[E,"Microsoft"],[m,b]],[/smart-tv.+(samsung)/i],[E,[m,k]],[/hbbtv.+maple;(\d+)/i],[[p,/^/,"SmartTV"],[E,"Samsung"],[m,k]],[/(?:linux;\snetcast.+smarttv|lg\snetcast\.tv-201\d)/i],[[E,"LG"],[m,k]],[/(apple)\s?tv/i],[E,[p,"Apple TV"],[m,k]],[/crkey/i],[[p,"Chromecast"],[E,"Google"],[m,k]],[/droid.+aft([\w])(\sbuild\/|\))/i],[p,[E,"Amazon"],[m,k]],[/\(dtv[\);].+(aquos)/i],[p,[E,"Sharp"],[m,k]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[E,j.trim],[p,j.trim],[m,k]],[/[\s\/\(](android\s|smart[-\s]?|opera\s)tv[;\)\s]/i],[[m,k]],[/((pebble))app\/[\d\.]+\s/i],[E,p,[m,P]],[/droid.+;\s(glass)\s\d/i],[p,[E,"Google"],[m,P]],[/droid\s[\d\.]+;\s(wt63?0{2,3})\)/i],[p,[E,"Zebra"],[m,P]],[/(tesla)(?:\sqtcarbrowser|\/20[12]\d\.[\w\.-]+)/i],[E,[m,V]],[/droid .+?; ([^;]+?)(?: build|\) applewebkit).+? mobile safari/i],[p,[m,y]],[/droid .+?;\s([^;]+?)(?: build|\) applewebkit).+?(?! mobile) safari/i],[p,[m,w]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[m,j.lowerize]],[/(android[\w\.\s\-]{0,9});.+build/i],[p,[E,"Generic"]],[/(phone)/i],[[m,y]]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[v,[A,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[v,[A,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[A,v],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[v,A]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[A,v],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s\w]*)/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)(?!.+xbox)/i],[A,[v,st.str,mt.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[A,"Windows"],[v,st.str,mt.os.windows.version]],[/ip[honead]{2,4}\b(?:.*os\s([\w]+)\slike\smac|;\sopera)/i,/cfnetwork\/.+darwin/i],[[v,/_/g,"."],[A,"iOS"]],[/(mac\sos\sx)\s?([\w\s\.]*)/i,/(macintosh|mac(?=_powerpc)\s)(?!.+haiku)/i],[[A,"Mac OS"],[v,/_/g,"."]],[/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|sailfish|contiki)[\/\s-]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/\s]([\w\.]+)/i,/\((series40);/i],[A,v],[/\(bb(10);/i],[v,[A,"BlackBerry"]],[/(?:symbian\s?os|symbos|s60(?=;)|series60)[\/\s-]?([\w\.]*)/i],[v,[A,"Symbian"]],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[A,"Firefox OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[v,[A,"webOS"]],[/crkey\/([\d\.]+)/i],[v,[A,"Chromecast"]],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[A,"Chromium OS"],v],[/(nintendo|playstation)\s([wids345portablevuch]+)/i,/(xbox);\s+xbox\s([^\);]+)/i,/(mint)[\/\s\(\)]?(\w*)/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?=\slinux)|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus|raspbian)(?:\sgnu\/linux)?(?:\slinux)?[\/\s-]?(?!chrom|package)([\w\.-]*)/i,/(hurd|linux)\s?([\w\.]*)/i,/(gnu)\s?([\w\.]*)/i,/\s([frentopc-]{0,4}bsd|dragonfly)\s?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku)\s(\w+)/i],[A,v],[/(sunos)\s?([\w\.\d]*)/i],[[A,"Solaris"],v],[/((?:open)?solaris)[\/\s-]?([\w\.]*)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.])*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms|fuchsia)/i,/(unix)\s?([\w\.]*)/i],[A,v]]},At=function(W,H){if(typeof W=="object"&&(H=W,W=s),!(this instanceof At))return new At(W,H).getResult();var U=W||(n!==void 0&&n.navigator&&n.navigator.userAgent?n.navigator.userAgent:""),Tt=H?j.extend(Et,H):Et;return this.getBrowser=function(){var It={name:s,version:s};return st.rgx.call(It,U,Tt.browser),It.major=j.major(It.version),It},this.getCPU=function(){var It={architecture:s};return st.rgx.call(It,U,Tt.cpu),It},this.getDevice=function(){var It={vendor:s,model:s,type:s};return st.rgx.call(It,U,Tt.device),It},this.getEngine=function(){var It={name:s,version:s};return st.rgx.call(It,U,Tt.engine),It},this.getOS=function(){var It={name:s,version:s};return st.rgx.call(It,U,Tt.os),It},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return U},this.setUA=function(It){return U=typeof It===h&&It.length>255?j.trim(It,255):It,this},this.setUA(U),this};At.VERSION="0.7.28",At.BROWSER={NAME:A,MAJOR:"major",VERSION:v},At.CPU={ARCHITECTURE:C},At.DEVICE={MODEL:p,VENDOR:E,TYPE:m,CONSOLE:b,MOBILE:y,SMARTTV:k,TABLET:w,WEARABLE:P,EMBEDDED:V},At.ENGINE={NAME:A,VERSION:v},At.OS={NAME:A,VERSION:v},r.exports&&(t=r.exports=At),t.UAParser=At;var $=n!==void 0&&(n.jQuery||n.Zepto);if($&&!$.ua){var rt=new At;$.ua=rt.getResult(),$.ua.get=function(){return rt.getUA()},$.ua.set=function(W){rt.setUA(W);var H=rt.getResult();for(var U in H)$.ua[U]=H[U]}}})(typeof window=="object"?window:i)}));let na=DA.getResult();function we(r){return r&&DA.setUA(r),na=DA.getResult(),{name:N2(na),version:O2(na),os:k2(na),osVersion:na.os.version}}function N2(r){if(r.engine.name==="Blink"&&r.browser.name!=="WeChat")return Re.CHROME;switch(r.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Re.CHROME;case"Safari":case"Mobile Safari":return Re.SAFARI;case"Edge":return Re.EDGE;case"Firefox":return Re.FIREFOX;case"QQBrowser":return Re.QQ;case"Opera":return Re.OPERA;case"WeChat":return Re.WECHAT;default:return r.browser.name||""}}function O2(r){let t;return t=r.engine.name==="Blink"?r.engine.version||"":r.browser.version||"",t.split(".")[0]}function k2(r){switch(r.os.name){case"Windows":return r.os.version?r.os.name+" "+r.os.version:r.os.name;default:return r.os.name||""}}function Nh(){return we().os}function Od(){const r=we();return!!(na.engine.name==="WebKit"&&r.os===Mn.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&r.name!==Re.SAFARI||vi()&&r.name!==Re.SAFARI)}function D2(){const r=we();if(Od()){if(r.os===Mn.MAC_OS)return!0;if(r.os===Mn.IOS){const t=na.os.version&&na.os.version.split(".");if(t&&Number(t[0])===14&&t[1]&&Number(t[1])>=3||t&&Number(t[0])>14)return!0}}return!1}function L2(){return na.engine.name==="WebKit"}function kd(){return we().name===Re.CHROME}function Pi(){return we().name===Re.SAFARI}function Gr(){return we().name===Re.FIREFOX}function vi(){return we().os===Mn.IOS}function ia(){const r=we();if(r.os!==Mn.IOS||!r.osVersion)return!1;const t=r.osVersion.split(".");return Number(t[0])===15}function JI(){const r=we();if(r.os!==Mn.IOS||!r.osVersion)return!1;const t=r.osVersion.split(".");return Number(t[0])===15&&Number(t[1])===0}function zI(){const r=we();if(r.os!==Mn.IOS||!r.osVersion)return!1;const t=r.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function as(){return Pi()&&navigator.maxTouchPoints>0}function Oh(){return we().name===Re.WECHAT}function XI(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function cl(){const r=we();return r.name===Re.EDGE||r.name===Re.SAFARI?!1:!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}qt({target:"Date",stat:!0},{now:function(){return new Date().getTime()}});var pt=_e.Date.now,M2=[].slice,P2=/MSIE .\./.test(Jc),ZI=function(r){return function(t,n){var s=arguments.length>2,c=s?M2.call(arguments,2):void 0;return r(s?function(){(typeof t=="function"?t:Function(t)).apply(this,c)}:t,n)}};qt({global:!0,bind:!0,forced:P2},{setTimeout:ZI(u.setTimeout),setInterval:ZI(u.setInterval)});var vn=_e.setTimeout,$I=function(r,t){return function(){for(var n=new Array(arguments.length),s=0;s<n.length;s++)n[s]=arguments[s];return r.apply(t,n)}},ll=Object.prototype.toString;function tC(r){return ll.call(r)==="[object Array]"}function eC(r){return r!==null&&typeof r=="object"}function rC(r){return ll.call(r)==="[object Function]"}function kh(r,t){if(r!=null)if(typeof r!="object"&&(r=[r]),tC(r))for(var n=0,s=r.length;n<s;n++)t.call(null,r[n],n,r);else for(var c in r)Object.prototype.hasOwnProperty.call(r,c)&&t.call(null,r[c],c,r)}var me={isArray:tC,isArrayBuffer:function(r){return ll.call(r)==="[object ArrayBuffer]"},isBuffer:function(r){return r!=null&&r.constructor!=null&&typeof r.constructor.isBuffer=="function"&&r.constructor.isBuffer(r)},isFormData:function(r){return typeof FormData!="undefined"&&r instanceof FormData},isArrayBufferView:function(r){return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?ArrayBuffer.isView(r):r&&r.buffer&&r.buffer instanceof ArrayBuffer},isString:function(r){return typeof r=="string"},isNumber:function(r){return typeof r=="number"},isObject:eC,isUndefined:function(r){return r===void 0},isDate:function(r){return ll.call(r)==="[object Date]"},isFile:function(r){return ll.call(r)==="[object File]"},isBlob:function(r){return ll.call(r)==="[object Blob]"},isFunction:rC,isStream:function(r){return eC(r)&&rC(r.pipe)},isURLSearchParams:function(r){return typeof URLSearchParams!="undefined"&&r instanceof URLSearchParams},isStandardBrowserEnv:function(){return(typeof navigator=="undefined"||navigator.product!=="ReactNative"&&navigator.product!=="NativeScript"&&navigator.product!=="NS")&&typeof window!="undefined"&&typeof document!="undefined"},forEach:kh,merge:function r(){var t={};function n(d,h){typeof t[h]=="object"&&typeof d=="object"?t[h]=r(t[h],d):t[h]=d}for(var s=0,c=arguments.length;s<c;s++)kh(arguments[s],n);return t},deepMerge:function r(){var t={};function n(d,h){typeof t[h]=="object"&&typeof d=="object"?t[h]=r(t[h],d):t[h]=typeof d=="object"?r({},d):d}for(var s=0,c=arguments.length;s<c;s++)kh(arguments[s],n);return t},extend:function(r,t,n){return kh(t,function(s,c){r[c]=n&&typeof s=="function"?$I(s,n):s}),r},trim:function(r){return r.replace(/^\s*/,"").replace(/\s*$/,"")}};function nC(r){return encodeURIComponent(r).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var iC=function(r,t,n){if(!t)return r;var s;if(n)s=n(t);else if(me.isURLSearchParams(t))s=t.toString();else{var c=[];me.forEach(t,function(h,p){h!=null&&(me.isArray(h)?p+="[]":h=[h],me.forEach(h,function(A){me.isDate(A)?A=A.toISOString():me.isObject(A)&&(A=JSON.stringify(A)),c.push(nC(p)+"="+nC(A))}))}),s=c.join("&")}if(s){var d=r.indexOf("#");d!==-1&&(r=r.slice(0,d)),r+=(r.indexOf("?")===-1?"?":"&")+s}return r};function Dh(){this.handlers=[]}Dh.prototype.use=function(r,t){return this.handlers.push({fulfilled:r,rejected:t}),this.handlers.length-1},Dh.prototype.eject=function(r){this.handlers[r]&&(this.handlers[r]=null)},Dh.prototype.forEach=function(r){me.forEach(this.handlers,function(t){t!==null&&r(t)})};var oC=Dh,LA=function(r,t,n){return me.forEach(n,function(s){r=s(r,t)}),r},sC=function(r){return!(!r||!r.__CANCEL__)},aC=function(r,t){me.forEach(r,function(n,s){s!==t&&s.toUpperCase()===t.toUpperCase()&&(r[t]=n,delete r[s])})},Lh=function(r,t,n,s,c){return function(d,h,p,A,m){return d.config=h,p&&(d.code=p),d.request=A,d.response=m,d.isAxiosError=!0,d.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},d}(new Error(r),t,n,s,c)},B2=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],U2=me.isStandardBrowserEnv()?function(){var r,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function s(c){var d=c;return t&&(n.setAttribute("href",d),d=n.href),n.setAttribute("href",d),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:n.pathname.charAt(0)==="/"?n.pathname:"/"+n.pathname}}return r=s(window.location.href),function(c){var d=me.isString(c)?s(c):c;return d.protocol===r.protocol&&d.host===r.host}}():function(){return!0},x2=me.isStandardBrowserEnv()?{write:function(r,t,n,s,c,d){var h=[];h.push(r+"="+encodeURIComponent(t)),me.isNumber(n)&&h.push("expires="+new Date(n).toGMTString()),me.isString(s)&&h.push("path="+s),me.isString(c)&&h.push("domain="+c),d===!0&&h.push("secure"),document.cookie=h.join("; ")},read:function(r){var t=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(r){this.write(r,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},F2=function(r){return new Promise(function(t,n){var s=r.data,c=r.headers;me.isFormData(s)&&delete c["Content-Type"];var d=new XMLHttpRequest;if(r.auth){var h=r.auth.username||"",p=r.auth.password||"";c.Authorization="Basic "+btoa(h+":"+p)}if(d.open(r.method.toUpperCase(),iC(r.url,r.params,r.paramsSerializer),!0),d.timeout=r.timeout,d.onreadystatechange=function(){if(d&&d.readyState===4&&(d.status!==0||d.responseURL&&d.responseURL.indexOf("file:")===0)){var E,v,C,b,y,w="getAllResponseHeaders"in d?(E=d.getAllResponseHeaders(),y={},E&&me.forEach(E.split(`
`),function(P){if(b=P.indexOf(":"),v=me.trim(P.substr(0,b)).toLowerCase(),C=me.trim(P.substr(b+1)),v){if(y[v]&&B2.indexOf(v)>=0)return;y[v]=v==="set-cookie"?(y[v]?y[v]:[]).concat([C]):y[v]?y[v]+", "+C:C}}),y):null,k={data:r.responseType&&r.responseType!=="text"?d.response:d.responseText,status:d.status,statusText:d.statusText,headers:w,config:r,request:d};(function(P,V,j){var st=j.config.validateStatus;!st||st(j.status)?P(j):V(Lh("Request failed with status code "+j.status,j.config,null,j.request,j))})(t,n,k),d=null}},d.onabort=function(){d&&(n(Lh("Request aborted",r,"ECONNABORTED",d)),d=null)},d.onerror=function(){n(Lh("Network Error",r,null,d)),d=null},d.ontimeout=function(){n(Lh("timeout of "+r.timeout+"ms exceeded",r,"ECONNABORTED",d)),d=null},me.isStandardBrowserEnv()){var A=x2,m=(r.withCredentials||U2(r.url))&&r.xsrfCookieName?A.read(r.xsrfCookieName):void 0;m&&(c[r.xsrfHeaderName]=m)}if("setRequestHeader"in d&&me.forEach(c,function(E,v){s===void 0&&v.toLowerCase()==="content-type"?delete c[v]:d.setRequestHeader(v,E)}),r.withCredentials&&(d.withCredentials=!0),r.responseType)try{d.responseType=r.responseType}catch(E){if(r.responseType!=="json")throw E}typeof r.onDownloadProgress=="function"&&d.addEventListener("progress",r.onDownloadProgress),typeof r.onUploadProgress=="function"&&d.upload&&d.upload.addEventListener("progress",r.onUploadProgress),r.cancelToken&&r.cancelToken.promise.then(function(E){d&&(d.abort(),n(E),d=null)}),s===void 0&&(s=null),d.send(s)})},Q2={"Content-Type":"application/x-www-form-urlencoded"};function cC(r,t){!me.isUndefined(r)&&me.isUndefined(r["Content-Type"])&&(r["Content-Type"]=t)}var MA={adapter:function(){var r;return(typeof process!="undefined"&&Object.prototype.toString.call(process)==="[object process]"||typeof XMLHttpRequest!="undefined")&&(r=F2),r}(),transformRequest:[function(r,t){return aC(t,"Accept"),aC(t,"Content-Type"),me.isFormData(r)||me.isArrayBuffer(r)||me.isBuffer(r)||me.isStream(r)||me.isFile(r)||me.isBlob(r)?r:me.isArrayBufferView(r)?r.buffer:me.isURLSearchParams(r)?(cC(t,"application/x-www-form-urlencoded;charset=utf-8"),r.toString()):me.isObject(r)?(cC(t,"application/json;charset=utf-8"),JSON.stringify(r)):r}],transformResponse:[function(r){if(typeof r=="string")try{r=JSON.parse(r)}catch{}return r}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(r){return r>=200&&r<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};me.forEach(["delete","get","head"],function(r){MA.headers[r]={}}),me.forEach(["post","put","patch"],function(r){MA.headers[r]=me.merge(Q2)});var lC=MA;function PA(r){r.cancelToken&&r.cancelToken.throwIfRequested()}var V2=function(r){var t,n;return PA(r),r.baseURL&&!function(s){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(s)}(r.url)&&(r.url=(t=r.baseURL,(n=r.url)?t.replace(/\/+$/,"")+"/"+n.replace(/^\/+/,""):t)),r.headers=r.headers||{},r.data=LA(r.data,r.headers,r.transformRequest),r.headers=me.merge(r.headers.common||{},r.headers[r.method]||{},r.headers||{}),me.forEach(["delete","get","head","post","put","patch","common"],function(s){delete r.headers[s]}),(r.adapter||lC.adapter)(r).then(function(s){return PA(r),s.data=LA(s.data,s.headers,r.transformResponse),s},function(s){return sC(s)||(PA(r),s&&s.response&&(s.response.data=LA(s.response.data,s.response.headers,r.transformResponse))),Promise.reject(s)})},BA=function(r,t){t=t||{};var n={};return me.forEach(["url","method","params","data"],function(s){t[s]!==void 0&&(n[s]=t[s])}),me.forEach(["headers","auth","proxy"],function(s){me.isObject(t[s])?n[s]=me.deepMerge(r[s],t[s]):t[s]!==void 0?n[s]=t[s]:me.isObject(r[s])?n[s]=me.deepMerge(r[s]):r[s]!==void 0&&(n[s]=r[s])}),me.forEach(["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","maxContentLength","validateStatus","maxRedirects","httpAgent","httpsAgent","cancelToken","socketPath"],function(s){t[s]!==void 0?n[s]=t[s]:r[s]!==void 0&&(n[s]=r[s])}),n};function Dd(r){this.defaults=r,this.interceptors={request:new oC,response:new oC}}Dd.prototype.request=function(r){typeof r=="string"?(r=arguments[1]||{}).url=arguments[0]:r=r||{},(r=BA(this.defaults,r)).method=r.method?r.method.toLowerCase():"get";var t=[V2,void 0],n=Promise.resolve(r);for(this.interceptors.request.forEach(function(s){t.unshift(s.fulfilled,s.rejected)}),this.interceptors.response.forEach(function(s){t.push(s.fulfilled,s.rejected)});t.length;)n=n.then(t.shift(),t.shift());return n},Dd.prototype.getUri=function(r){return r=BA(this.defaults,r),iC(r.url,r.params,r.paramsSerializer).replace(/^\?/,"")},me.forEach(["delete","get","head","options"],function(r){Dd.prototype[r]=function(t,n){return this.request(me.merge(n||{},{method:r,url:t}))}}),me.forEach(["post","put","patch"],function(r){Dd.prototype[r]=function(t,n,s){return this.request(me.merge(s||{},{method:r,url:t,data:n}))}});var Mh=Dd;function UA(r){this.message=r}UA.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},UA.prototype.__CANCEL__=!0;var dC=UA;function Ph(r){if(typeof r!="function")throw new TypeError("executor must be a function.");var t;this.promise=new Promise(function(s){t=s});var n=this;r(function(s){n.reason||(n.reason=new dC(s),t(n.reason))})}Ph.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},Ph.source=function(){var r;return{token:new Ph(function(t){r=t}),cancel:r}};var G2=Ph;function uC(r){var t=new Mh(r),n=$I(Mh.prototype.request,t);return me.extend(n,Mh.prototype,t),me.extend(n,t),n}var Ns=uC(lC);Ns.Axios=Mh,Ns.create=function(r){return uC(BA(Ns.defaults,r))},Ns.Cancel=dC,Ns.CancelToken=G2,Ns.isCancel=sC,Ns.all=function(r){return Promise.all(r)},Ns.spread=function(r){return function(t){return r.apply(null,t)}};var hC=Ns,j2=Ns;hC.default=j2;var Lo=hC;function xA(){const r=new Date;return r.toTimeString().split(" ")[0]+":"+r.getMilliseconds()}const go={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},Bh=pt(),FA=r=>{for(const t in go)if(Object.prototype.hasOwnProperty.call(go,t)&&go[t]===r)return t;return"DEFAULT"},S=new class{constructor(){this.logLevel=go.DEBUG,this.uploadState="collecting",this.uploadLogWaitingList=[],this.uploadLogUploadingList=[],this.uploadErrorCount=0,this.currentLogID=0}debug(...r){var t;const n=O(t=[go.DEBUG]).call(t,r);this.log.apply(this,n)}info(...r){var t;const n=O(t=[go.INFO]).call(t,r);this.log.apply(this,n)}warning(...r){var t;const n=O(t=[go.WARNING]).call(t,r);this.log.apply(this,n)}error(...r){var t;const n=O(t=[go.ERROR]).call(t,r);this.log.apply(this,n)}upload(...r){var t;const n=O(t=[go.DEBUG]).call(t,r);this.uploadLog.apply(this,n)}setLogLevel(r){r=Math.min(Math.max(0,r),4),this.logLevel=r}enableLogUpload(){jr("UPLOAD_LOG",!0)}disableLogUpload(){jr("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(r){this.proxyServerURL=r}log(...r){var t,n,s,c;if(pt()-Bh<100)return void vn(()=>{this.log(...r)},pt()-Bh);const d=Math.max(0,Math.min(4,r[0]));if(r[0]=xA()+" Agora-SDK [".concat(FA(d),"]:"),this.appendLogToWaitingList(d,r),d<this.logLevel)return;const h=xA()+" %cAgora-SDK [".concat(FA(d),"]:");let p=[];switch(d){case go.DEBUG:p=O(t=[h,"color: #64B5F6;"]).call(t,en(r).call(r,1)),console.log.apply(console,p);break;case go.INFO:p=O(n=[h,"color: #1E88E5; font-weight: bold;"]).call(n,en(r).call(r,1)),console.log.apply(console,p);break;case go.WARNING:p=O(s=[h,"color: #FB8C00; font-weight: bold;"]).call(s,en(r).call(r,1)),console.warn.apply(console,p);break;case go.ERROR:p=O(c=[h,"color: #B00020; font-weight: bold;"]).call(c,en(r).call(r,1)),console.error.apply(console,p)}}uploadLog(...r){if(pt()-Bh<100)return void vn(()=>{this.uploadLog(...r)},pt()-Bh);const t=Math.max(0,Math.min(4,r[0]));r[0]=xA()+" Agora-SDK [".concat(FA(t),"]:"),this.appendLogToWaitingList(t,r)}appendLogToWaitingList(r,...t){if(!ot("UPLOAD_LOG"))return;let n="";G(t).call(t,s=>{typeof s=="object"&&(s=ht(s)),n+="".concat(s," ")}),this.uploadLogWaitingList.push({payload_str:n,log_level:r,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){var r;const t=this.uploadLogUploadingList,n={sdk_version:Pn,process_id:ot("PROCESS_ID"),payload:ht(t)},s=await Lo.post(this.url||(this.proxyServerURL?O(r="https://".concat(this.proxyServerURL,"/ls/?h=")).call(r,ot("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(ot("LOG_UPLOAD_SERVER"),"/upload/v1")),n,{responseType:"text"});if(s.data!=="OK")throw new Error("unexpected upload log response: "+s.data);this.uploadLogUploadingList=[]}uploadLogInterval(){if(this.uploadLogUploadingList.length!==0||this.uploadLogWaitingList.length!==0){var r;this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=Ye(r=this.uploadLogWaitingList).call(r,0,10)),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),3e3)}).catch(t=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),200):window.setTimeout(()=>this.uploadLogInterval(),1e3)})}}},dl="v4.8.1-0-ge9003043(1/5/2022, 3:55:58 PM)",Pn=function(r){if(r.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return r;const t=r.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(t&&t[1]&&t[2]){var n;const d=t[1],h=t[2];return O(n="".concat(d,".")).call(n,h)}const s=r.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(s&&s[1]&&s[2]){var c;const d=s[1],h=s[2];return O(c="".concat(d,".")).call(c,100*(Number(h)+1))}return"4.0.0.999"}("4.8.1"),Ld=function(){try{return JSON.parse("true")===!0}catch{return!0}}(),qe={username:"test",password:"111111",turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1},W2={"90p":Ee(160,90),"90p_1":Ee(160,90),"120p":Ee(160,120,15,30,65),"120p_1":Ee(160,120,15,30,65),"120p_3":Ee(120,120,15,30,50),"120p_4":Ee(212,120),"180p":Ee(320,180,15,30,140),"180p_1":Ee(320,180,15,30,140),"180p_3":Ee(180,180,15,30,100),"180p_4":Ee(240,180,15,30,120),"240p":Ee(320,240,15,40,200),"240p_1":Ee(320,240,15,40,200),"240p_3":Ee(240,240,15,40,140),"240p_4":Ee(424,240,15,40,220),"360p":Ee(640,360,15,80,400),"360p_1":Ee(640,360,15,80,400),"360p_3":Ee(360,360,15,80,260),"360p_4":Ee(640,360,30,80,600),"360p_6":Ee(360,360,30,80,400),"360p_7":Ee(480,360,15,80,320),"360p_8":Ee(480,360,30,80,490),"360p_9":Ee(640,360,15,80,800),"360p_10":Ee(640,360,24,80,800),"360p_11":Ee(640,360,24,80,1e3),"480p":Ee(640,480,15,100,500),"480p_1":Ee(640,480,15,100,500),"480p_2":Ee(640,480,30,100,1e3),"480p_3":Ee(480,480,15,100,400),"480p_4":Ee(640,480,30,100,750),"480p_6":Ee(480,480,30,100,600),"480p_8":Ee(848,480,15,100,610),"480p_9":Ee(848,480,30,100,930),"480p_10":Ee(640,480,10,100,400),"720p":Ee(1280,720,15,120,1130),"720p_1":Ee(1280,720,15,120,1130),"720p_2":Ee(1280,720,30,120,2e3),"720p_3":Ee(1280,720,30,120,1710),"720p_5":Ee(960,720,15,120,910),"720p_6":Ee(960,720,30,120,1380),"1080p":Ee(1920,1080,15,120,2080),"1080p_1":Ee(1920,1080,15,120,2080),"1080p_2":Ee(1920,1080,30,120,3e3),"1080p_3":Ee(1920,1080,30,120,3150),"1080p_5":Ee(1920,1080,60,120,4780),"1440p":Ee(2560,1440,30,120,4850),"1440p_1":Ee(2560,1440,30,120,4850),"1440p_2":Ee(2560,1440,60,120,7350),"4k":Ee(3840,2160,30,120,8910),"4k_1":Ee(3840,2160,30,120,8910),"4k_3":Ee(3840,2160,60,120,13500)},K2={"480p":Mo(640,480,5),"480p_1":Mo(640,480,5),"480p_2":Mo(640,480,30),"480p_3":Mo(640,480,15),"720p":Mo(1280,720,5),"720p_1":Mo(1280,720,5),"720p_2":Mo(1280,720,30),"720p_3":Mo(1280,720,15),"1080p":Mo(1920,1080,5),"1080p_1":Mo(1920,1080,5),"1080p_2":Mo(1920,1080,30),"1080p_3":Mo(1920,1080,15)},H2={"1SL1TL":VA(1,1),"3SL3TL":VA(3,3),"2SL3TL":VA(2,3)};function cs(r){return typeof r=="string"?hr({},W2[r]):r}function Md(r){return typeof r=="string"?hr({},K2[r]):r}function Ua(r){return typeof r=="string"?hr({},H2[r]):r}const Y2={speech_low_quality:ul(16e3,!1),speech_standard:ul(32e3,!1,18),music_standard:ul(48e3,!1),standard_stereo:ul(48e3,!0,56),high_quality:ul(48e3,!1,128),high_quality_stereo:ul(48e3,!0,192)};function fc(r){return typeof r=="string"?hr({},Y2[r]):r}function jr(r,t,n){var s,c;zt(s=le(Ii)).call(s,r)&&(!n&&zt(c=le(QA)).call(c,r)||(Ii[r]=t))}function ot(r){return Ii[r]}const Ii={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],SUBSCRIBE_TCC:!0,PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,USE_RTX:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,SDK_FALLBACK:!0,ENUMERATE_DEVICES_INTERVAL:!0,H264_PROFILE_LEVEL_ID:"",SDP_LOGGING:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},USE_NEW_TOKEN:!0},QA={};function ul(r,t,n){return{sampleRate:r,stereo:t,bitrate:n}}function Ee(r,t,n,s,c){return{width:r,height:t,frameRate:n,bitrateMin:s,bitrateMax:c}}function Mo(r,t,n,s,c){return{width:{max:r},height:{max:t},frameRate:n,bitrateMin:s,bitrateMax:c}}function VA(r,t){return{numSpatialLayers:r,numTemporalLayers:t}}Ld||(Ii.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Ii.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Ii.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Ii.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Ii.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Ii.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Ii.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Ii.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Ii.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Ii.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Ii.AREAS=["NORTH_AMERICA","OVERSEA"]);const pC=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],ls=[],oa=[];function fC(r){zt(ls).call(ls,r)||ls.push(r)}function AC(r){const t=Ft(ls).call(ls,r);t!==-1&&Ye(ls).call(ls,t,1)}function gC(r){zt(oa).call(oa,r)||oa.push(r)}function mC(r){const t=Ft(oa).call(oa,r);t!==-1&&Ye(oa).call(oa,t,1)}var GA=[],EC=GA.sort,q2=f(function(){GA.sort(void 0)}),J2=f(function(){GA.sort(null)}),z2=uc("sort");qt({target:"Array",proto:!0,forced:q2||!J2||z2},{sort:function(r){return r===void 0?EC.call(ve(this)):EC.call(ve(this),dn(r))}});var X2=Zr("Array").sort,_C=Array.prototype,xa=function(r){var t=r.sort;return r===_C||r instanceof Array&&t===_C.sort?X2:t};qt({target:"Array",stat:!0},{isArray:tr});var L,vC,Gn,$r=_e.Array.isArray;(function(r){r.UNEXPECTED_ERROR="UNEXPECTED_ERROR",r.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",r.TIMEOUT="TIMEOUT",r.INVALID_PARAMS="INVALID_PARAMS",r.NOT_READABLE="NOT_READABLE",r.NOT_SUPPORTED="NOT_SUPPORTED",r.INVALID_OPERATION="INVALID_OPERATION",r.OPERATION_ABORTED="OPERATION_ABORTED",r.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",r.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",r.NETWORK_ERROR="NETWORK_ERROR",r.NETWORK_TIMEOUT="NETWORK_TIMEOUT",r.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",r.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",r.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",r.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",r.ELECTRON_IS_NULL="ELECTRON_IS_NULL",r.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",r.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",r.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",r.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",r.PERMISSION_DENIED="PERMISSION_DENIED",r.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",r.TRACK_IS_DISABLED="TRACK_IS_DISABLED",r.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",r.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",r.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",r.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",r.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",r.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",r.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",r.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",r.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",r.UID_CONFLICT="UID_CONFLICT",r.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",r.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",r.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",r.INVALID_TRACK="INVALID_TRACK",r.SENDER_NOT_FOUND="SENDER_NOT_FOUND",r.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",r.SET_ANSWER_FAILED="SET_ANSWER_FAILED",r.ICE_FAILED="ICE_FAILED",r.PC_CLOSED="PC_CLOSED",r.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",r.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",r.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",r.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",r.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",r.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",r.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",r.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",r.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",r.INVALID_REMOTE_USER="INVALID_REMOTE_USER",r.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",r.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",r.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",r.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",r.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",r.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",r.WS_ABORT="WS_ABORT",r.WS_DISCONNECT="WS_DISCONNECT",r.WS_ERR="WS_ERR",r.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",r.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",r.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",r.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",r.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",r.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",r.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",r.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",r.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",r.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",r.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",r.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",r.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",r.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",r.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",r.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",r.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",r.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",r.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",r.INVALID_PLUGIN="INVALID_PLUGIN",r.DISCONNECT_P2P="DISCONNECT_P2P"})(L||(L={}));class M extends Error{constructor(t,n="",s){var c;super(n),this.name="AgoraRTCException",this.code=t,this.message=O(c="AgoraRTCError ".concat(this.code,": ")).call(c,n),this.data=s}toString(){var t;return this.data?O(t="data: ".concat(ht(this.data),`
`)).call(t,this.stack):"".concat(this.stack)}print(t="error"){return t==="error"&&S.error(this.toString()),t==="warning"&&S.warning(this.toString()),this}throw(){throw this.print(),this}}function Ac(r,t){if(typeof r!="boolean")throw new M(L.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function Pr(r,t,n){var s;if(!zt(n).call(n,r))throw new M(L.INVALID_PARAMS,O(s="".concat(t," can only be set as ")).call(s,ht(n)))}function Ie(r,t,n=1,s=1e4,c=!0){if(r<n||r>s||c&&!function(p){return typeof p=="number"&&p%1==0}(r)){var d,h;throw new M(L.INVALID_PARAMS,O(d=O(h="invalid ".concat(t,": the value range is [")).call(h,n,", ")).call(d,s,"]. integer only"))}}function pr(r,t,n=1,s=255,c=!0){if(r==null)throw new M(L.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));var d,h,p;if(!IC(r,n,s,c))throw new M(L.INVALID_PARAMS,O(d=O(h=O(p="Invalid ".concat(t||"string param",": Length of the string: [")).call(p,n,",")).call(h,s,"].")).call(d,c?" ASCII characters only.":""))}function Uh(r,t){if(!$r(r))throw new M(L.INVALID_PARAMS,"".concat(t," should be an array"))}function xh(r){if(typeof r!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(r))throw S.error("Invalid Channel Name ".concat(r)),new M(L.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function Fh(r){var t,n;if(n=r,!(typeof n=="number"&&Math.floor(n)===n&&0<=n&&n<=4294967295||IC(r,1,255)))throw S.error(O(t="Invalid UID ".concat(r," ")).call(t,typeof r)),new M(L.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");typeof r=="string"&&S.warning("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}function er(r){return r==null}function IC(r,t=1,n=255,s=!0){return typeof r=="string"&&r.length<=n&&r.length>=t&&(!s||function(c){if(typeof c!="string")return!1;for(let d=0;d<c.length;d+=1){const h=c.charCodeAt(d);if(h<0||h>255)return!1}return!0}(r))}(function(r){r.FREE="free",r.UPLOADING="uploading"})(vC||(vC={})),function(r){r.NONE="none",r.INIT="init",r.CANPLAY="canplay",r.PLAYING="playing",r.PAUSED="paused",r.SUSPEND="suspend",r.STALLED="stalled",r.WAITING="waiting",r.ERROR="error",r.DESTROYED="destroyed",r.ABORT="abort",r.ENDED="ended",r.EMPTIED="emptied",r.LOADEDDATA="loadeddata"}(Gn||(Gn={}));const jA={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};qt({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991});var CC=9007199254740991;qt({target:"Number",stat:!0},{MIN_SAFE_INTEGER:-9007199254740991});var SC=-9007199254740991;function Z2(r){return pr(r.reportId,"params.reportId",0,100,!1),pr(r.category,"params.category",0,100,!1),pr(r.event,"params.event",0,100,!1),pr(r.label,"params.label",0,100,!1),Ie(r.value,"params.value",SC,CC,!1),!0}const $2={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};var jn,kr,yC,Kt,Yt,gc,sa,hl,Pd,Zi,Jn,oe,Qe,Ci,In,ye,xe,Po,rr,TC,Bo;function RC(r){return Ie(r.timeout,"config.timeout",0,1e5),Ie(r.timeoutFactor,"config.timeoutFactor",0,100,!1),Ie(r.maxRetryCount,"config.maxRetryConfig",0,1/0),Ie(r.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}function Qh(r){if(!$r(r)||r.length<1)return!1;try{G(r).call(r,t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function wC(r){return pr(r.turnServerURL,"turnServerURL"),pr(r.username,"username"),pr(r.password,"password"),r.udpport&&Ie(r.udpport,"udpport",1,99999,!0),r.forceturn&&Ac(r.forceturn,"forceturn"),r.security&&Ac(r.security,"security"),r.tcpport&&Ie(r.tcpport,"tcpport",1,99999,!0),!0}function bC(r){return r.level!==void 0&&Pr(r.level,"level",[1,2,3]),!0}(function(r){r.PUBLISH="publish",r.SUBSCRIBE="subscribe",r.WS_COMPRESSOR_INIT="ws_compressor_init",r.SESSION_INIT="session_init",r.JOIN_CHOOSE_SERVER="join_choose_server",r.REQ_USER_ACCOUNT="req_user_account",r.JOIN_GATEWAY="join_gateway",r.STREAM_SWITCH="stream_switch",r.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",r.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",r.FIRST_VIDEO_RECEIVED="first_video_received",r.FIRST_AUDIO_RECEIVED="first_audio_received",r.FIRST_VIDEO_DECODE="first_video_decode",r.FIRST_AUDIO_DECODE="first_audio_decode",r.ON_ADD_AUDIO_STREAM="on_add_audio_stream",r.ON_ADD_VIDEO_STREAM="on_add_video_stream",r.ON_UPDATE_STREAM="on_update_stream",r.ON_REMOVE_STREAM="on_remove_stream",r.USER_ANALYTICS="req_user_analytics"})(jn||(jn={})),function(r){r.SESSION="io.agora.pb.Wrtc.Session",r.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",r.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",r.JOIN_GATEWAT="io.agora.pb.Wrtc.JoinGateway",r.PUBLISH="io.agora.pb.Wrtc.Publish",r.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",r.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",r.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",r.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",r.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",r.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",r.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",r.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",r.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",r.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",r.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",r.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",r.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",r.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",r.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",r.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",r.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",r.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",r.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",r.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",r.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",r.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",r.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",r.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed"}(kr||(kr={})),function(r){r[r.WORKER_EVENT=156]="WORKER_EVENT",r[r.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}(yC||(yC={})),function(r){r.CREATE_CLIENT="createClient",r.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",r.SET_AREA="setArea",r.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",r.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",r.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",r.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",r.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",r.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",r.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",r.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",r.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",r.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",r.START_PROXY_SERVER="Client.startProxyServer",r.STOP_PROXY_SERVER="Client.stopProxyServer",r.SET_PROXY_SERVER="Client.setProxyServer",r.SET_TURN_SERVER="Client.setTurnServer",r.SET_CLIENT_ROLE="Client.setClientRole",r.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",r.ENABLE_DUAL_STREAM="Client.enableDualStream",r.DISABLE_DUAL_STREAM="Client.disableDualStream",r.JOIN="Client.join",r.LEAVE="Client.leave",r.PUBLISH="Client.publish",r.UNPUBLISH="Client.unpublish",r.SUBSCRIBE="Client.subscribe",r.UNSUBSCRIBE="Client.unsubscribe",r.RENEW_TOKEN="Client.renewToken",r.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",r.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",r.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",r.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",r.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",r.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",r.START_LIVE_STREAMING="Client.startLiveStreaming",r.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",r.STOP_LIVE_STREAMING="Client.stopLiveStreaming",r.ADD_INJECT_STREAM_URL="Client.addInjectStreamUrl",r.REMOVE_INJECT_STREAM_URL="Client.removeInjectStreamUrl",r.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",r.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",r.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",r.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",r.SET_CONFIG_DISTRIBUTE="_configDistribute",r.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",r.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",r.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",r.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",r.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",r.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",r.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",r.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",r.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",r.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",r.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",r.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",r.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",r.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",r.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",r.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",r.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",r.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",r.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",r.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",r.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",r.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",r.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",r.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",r.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",r.STREAM_TYPE_CHANGE="streamTypeChange",r.CONNECTION_STATE_CHANGE="connectionStateChange",r.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage"}(Kt||(Kt={})),function(r){r.TRACER="tracer"}(Yt||(Yt={})),function(r){r.IDLE="IDLE",r.INITING="INITING",r.INITEND="INITEND"}(gc||(gc={})),function(r){r.STATE_CHANGE="state_change",r.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",r.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",r.CAMERA_DEVICE_CHANGED="cameraDeviceChanged"}(sa||(sa={})),function(r){r[r.ACCESS_POINT=101]="ACCESS_POINT",r[r.UNILBS=201]="UNILBS",r[r.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR"}(hl||(hl={})),function(r){r[r.IIIEGAL_APPID=1]="IIIEGAL_APPID",r[r.IIIEGAL_UID=2]="IIIEGAL_UID",r[r.INTERNAL_ERROR=3]="INTERNAL_ERROR"}(Pd||(Pd={})),function(r){r[r.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",r[r.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",r[r.INTERNAL_ERROR=8]="INTERNAL_ERROR",r[r.NO_AUTHORIZED=9]="NO_AUTHORIZED",r[r.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",r[r.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",r[r.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",r[r.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",r[r.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",r[r.USER_OVERLOAD=16]="USER_OVERLOAD",r[r.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",r[r.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND"}(Zi||(Zi={})),function(r){r[r.NO_FLAG_SET=100]="NO_FLAG_SET",r[r.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",r[r.INVALID_FALG_SET=102]="INVALID_FALG_SET",r[r.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",r[r.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",r[r.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",r[r.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",r[r.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",r[r.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",r[r.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",r[r.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",r[r.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",r[r.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",r[r.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",r[r.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",r[r.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",r[r.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV"}(Jn||(Jn={})),function(r){r[r.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",r[r.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",r[r.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",r[r.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",r[r.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",r[r.K_TICKET_INVALID=7]="K_TICKET_INVALID",r[r.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",r[r.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",r[r.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",r[r.K_UID_BANNED=14]="K_UID_BANNED",r[r.K_IP_BANNED=15]="K_IP_BANNED",r[r.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",r[r.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",r[r.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",r[r.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",r[r.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",r[r.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",r[r.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",r[r.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",r[r.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",r[r.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",r[r.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",r[r.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",r[r.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",r[r.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",r[r.ERR_INVALID_UID=117]="ERR_INVALID_UID",r[r.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",r[r.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",r[r.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",r[r.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",r[r.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",r[r.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",r[r.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",r[r.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",r[r.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",r[r.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",r[r.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",r[r.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",r[r.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",r[r.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",r[r.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",r[r.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",r[r.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",r[r.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",r[r.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",r[r.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",r[r.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",r[r.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",r[r.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",r[r.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",r[r.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",r[r.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",r[r.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",r[r.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",r[r.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY"}(oe||(oe={})),function(r){r.CONNECTION_STATE_CHANGE="connection-state-change",r.MEDIA_RECONNECT_START="media-reconnect-start",r.MEDIA_RECONNECT_END="media-reconnect-end",r.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",r.USER_JOINED="user-joined",r.USER_LEAVED="user-left",r.USER_PUBLISHED="user-published",r.USER_UNPUBLISHED="user-unpublished",r.USER_INFO_UPDATED="user-info-updated",r.CLIENT_BANNED="client-banned",r.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",r.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",r.VOLUME_INDICATOR="volume-indicator",r.CRYPT_ERROR="crypt-error",r.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",r.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",r.NETWORK_QUALITY="network-quality",r.STREAM_TYPE_CHANGED="stream-type-changed",r.STREAM_FALLBACK="stream-fallback",r.RECEIVE_METADATA="receive-metadata",r.STREAM_MESSAGE="stream-message",r.LIVE_STREAMING_ERROR="live-streaming-error",r.LIVE_STREAMING_WARNING="live-streaming-warning",r.INJECT_STREAM_STATUS="stream-inject-status",r.EXCEPTION="exception",r.ERROR="error",r.P2P_LOST="p2p_lost"}(Qe||(Qe={})),function(r){r.NETWORK_ERROR="NETWORK_ERROR",r.SERVER_ERROR="SERVER_ERROR",r.MULTI_IP="MULTI_IP",r.TIMEOUT="TIMEOUT",r.OFFLINE="OFFLINE",r.LEAVE="LEAVE",r.P2P_FAILED="P2P_FAILED"}(Ci||(Ci={})),function(r){r.CONNECTING="connecting",r.CONNECTED="connected",r.RECONNECTING="reconnecting",r.CLOSED="closed"}(In||(In={})),function(r){r.WS_CONNECTED="ws_connected",r.WS_RECONNECTING="ws_reconnecting",r.WS_CLOSED="ws_closed",r.ON_BINARY_DATA="on_binary_data",r.REQUEST_RECOVER="request_recover",r.REQUEST_JOIN_INFO="request_join_info",r.REQUEST_REJOIN_INFO="req_rejoin_info",r.IS_P2P_DISCONNECTED="is_p2p_dis",r.DISCONNECT_P2P="dis_p2p",r.NEED_RENEW_SESSION="need-sid",r.REPORT_JOIN_GATEWAY="report_join_gateway",r.REQUEST_TIMEOUT="request_timeout",r.REQUEST_SUCCESS="request_success",r.JOIN_RESPONSE="join_response"}(ye||(ye={})),function(r){r.PING="ping",r.PING_BACK="ping_back",r.JOIN="join_v3",r.REJOIN="rejoin_v3",r.LEAVE="leave",r.SET_CLIENT_ROLE="set_client_role",r.PUBLISH="publish",r.UNPUBLISH="unpublish",r.SUBSCRIBE="subscribe",r.UNSUBSCRIBE="unsubscribe",r.SUBSCRIBE_CHANGE="subscribe_change",r.TRAFFIC_STATS="traffic_stats",r.RENEW_TOKEN="renew_token",r.SWITCH_VIDEO_STREAM="switch_video_stream",r.SET_FALLBACK_OPTION="set_fallback_option",r.GATEWAY_INFO="gateway_info",r.CONTROL="control",r.SEND_METADATA="send_metadata",r.DATA_STREAM="data_stream",r.PICK_SVC_LAYER="pick_svc_layer",r.RESTART_ICE="restart_ice",r.CONNECT_PC="connect_pc"}(xe||(xe={})),function(r){r.PUBLISH_STATS="publish_stats",r.PUBLISH_RELATED_STATS="publish_related_stats",r.SUBSCRIBE_STATS="subscribe_stats",r.SUBSCRIBE_RELATED_STATS="subscribe_related_stats",r.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length"}(Po||(Po={})),function(r){r.ON_USER_ONLINE="on_user_online",r.ON_USER_OFFLINE="on_user_offline",r.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",r.ON_PUBLISH_STREAM="on_publish_stream",r.ON_UPLINK_STATS="on_uplink_stats",r.ON_P2P_LOST="on_p2p_lost",r.ON_REMOVE_STREAM="on_remove_stream",r.ON_ADD_AUDIO_STREAM="on_add_audio_stream",r.ON_ADD_VIDEO_STREAM="on_add_video_stream",r.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",r.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",r.ON_USER_BANNED="on_user_banned",r.ON_NOTIFICATION="on_notification",r.ON_CRYPT_ERROR="on_crypt_error",r.MUTE_AUDIO="mute_audio",r.MUTE_VIDEO="mute_video",r.UNMUTE_AUDIO="unmute_audio",r.UNMUTE_VIDEO="unmute_video",r.ON_P2P_OK="on_p2p_ok",r.RECEIVE_METADATA="receive_metadata",r.ON_DATA_STREAM="on_data_stream",r.ENABLE_LOCAL_VIDEO="enable_local_video",r.DISABLE_LOCAL_VIDEO="disable_local_video",r.ENABLE_LOCAL_AUDIO="enable_local_audio",r.DISABLE_LOCAL_AUDIO="disable_local_audio"}(rr||(rr={})),function(r){r.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",r.NEED_ANSWER="NEED_ANSWER",r.NEED_RENEGOTIATE="NEED_RENEGOTIATE",r.P2P_LOST="P2P_LOST",r.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",r.NEED_UNPUB="NEED_UNPUB",r.NEED_UNSUB="NEED_UNSUB",r.NEED_UPLOAD="NEED_UPLOAD",r.NEED_CONTROL="NEED_CONTROL",r.START_RECONNECT="START_RECONNECT",r.END_RECONNECT="END_RECONNECT",r.NEED_SIGNAL_RTT="NEED_SIGNAL_RTT"}(TC||(TC={})),function(r){r.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",r.RECEIVE_TRACK_BUFFER="receive_track_buffer",r.ON_AUDIO_BUFFER="on_audio_buffer"}(Bo||(Bo={}));const Bd={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,currentPacketLossRate:0},Ud={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},Vh={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},WA={uplinkNetworkQuality:0,downlinkNetworkQuality:0},Gh={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};var Je,Wr;(function(r){r.CONNECTED="websocket:connected",r.RECONNECTING="websocket:reconnecting",r.WILL_RECONNECT="websocket:will_reconnect",r.CLOSED="websocket:closed",r.FAILED="websocket:failed",r.ON_MESSAGE="websocket:on_message",r.REQUEST_NEW_URLS="websocket:request_new_urls"})(Je||(Je={})),function(r){r.TRANSCODE="mix_streaming",r.RAW="raw_streaming",r.INJECT="inject_streaming"}(Wr||(Wr={}));const tk={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},KA={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function HA(r,t){pr(r.url,"".concat(t,".url"),1,1e3,!1),er(r.x)||Ie(r.x,"".concat(t,".x"),0,1e4),er(r.y)||Ie(r.y,"".concat(t,".y"),0,1e4),er(r.width)||Ie(r.width,"".concat(t,".width"),0,1e4),er(r.height)||Ie(r.height,"".concat(t,".height"),0,1e4),er(r.zOrder)||Ie(r.zOrder,"".concat(t,".zOrder"),0,255),er(r.alpha)||Ie(r.alpha,"".concat(t,".alpha"),0,1,!1)}const ek={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},rk={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};var Uo,pl,Or,NC,zn,Kr,Ir,Jt,Xn,aa,fl;function OC(r){if(!r.channelName)throw new M(L.INVALID_PARAMS,"invalid channelName in info");if(!r.uid||typeof r.uid!="number")throw new M(L.INVALID_PARAMS,"invalid uid in info, uid must be a number");return r.token&&pr(r.token,"info.token",1,2047),Fh(r.uid),xh(r.channelName),!0}function kC(r){return Pr(r,"mediaSource",["screen","window","application"]),!0}(function(r){r.WARNING="@live_uap-warning",r.ERROR="@line_uap-error",r.PUBLISH_STREAM_STATUS="@live_uap-publish-status",r.INJECT_STREAM_STATUS="@live_uap-inject-status",r.WORKER_STATUS="@live_uap-worker-status",r.REQUEST_NEW_ADDRESS="@live_uap-request-address"})(Uo||(Uo={})),function(r){r.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager"}(pl||(pl={})),function(r){r[r.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",r[r.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",r[r.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",r[r.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",r[r.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",r[r.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",r[r.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",r[r.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",r[r.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",r[r.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",r[r.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",r[r.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",r[r.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",r[r.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",r[r.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",r[r.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",r[r.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",r[r.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",r[r.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",r[r.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",r[r.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(Or||(Or={})),function(r){r.CONNECT_FAILED="connect failed",r.CONNECT_TIMEOUT="connect timeout",r.WS_DISCONNECTED="websocket disconnected",r.REQUEST_TIMEOUT="request timeout",r.REQUEST_FAILED="request failed",r.WAIT_STATUS_TIMEOUT="wait status timeout",r.WAIT_STATUS_ERROR="wait status error",r.BAD_STATE="bad state",r.WS_ABORT="ws abort",r.AP_REQUEST_TIMEOUT="AP request timeout",r.AP_JSON_PARSE_ERROR="AP json parse error",r.AP_REQUEST_ERROR="AP request error",r.AP_REQUEST_ABORT="AP request abort"}(NC||(NC={})),function(r){r[r.SetSdkProfile=0]="SetSdkProfile",r[r.SetSourceChannel=1]="SetSourceChannel",r[r.SetSourceUserId=2]="SetSourceUserId",r[r.SetDestChannel=3]="SetDestChannel",r[r.StartPacketTransfer=4]="StartPacketTransfer",r[r.StopPacketTransfer=5]="StopPacketTransfer",r[r.UpdateDestChannel=6]="UpdateDestChannel",r[r.Reconnect=7]="Reconnect",r[r.SetVideoProfile=8]="SetVideoProfile"}(zn||(zn={})),function(r){r.High="high",r.Low="low",r.Audio="audio",r.Screen="screen",r.ScreenLow="screen_low"}(Kr||(Kr={})),function(r){r.DISCONNECT="disconnect",r.CONNECTION_STATE_CHANGE="connection-state-change",r.NETWORK_QUALITY="network-quality",r.STREAM_TYPE_CHANGE="stream-type-change",r.IS_P2P_DISCONNECTED="is-p2p-dis",r.DISCONNECT_P2P="dis-p2p",r.REQUEST_NEW_GATEWAY_LIST="req-gate-url",r.NEED_RENEW_SESSION="need-sid",r.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",r.JOIN_RESPONSE="join-response"}(Ir||(Ir={})),function(r){r.NEED_RENEGOTIATE="@need_renegotiate",r.NEED_REPLACE_TRACK="@need_replace_track",r.NEED_CLOSE="@need_close",r.NEED_ENABLE_TRACK="@need_enable_track",r.NEED_DISABLE_TRACK="@need_disable_track",r.NEED_SESSION_ID="@need_sid",r.SET_OPTIMIZATION_MODE="@set_optimization_mode",r.GET_STATS="@get_stats",r.GET_LOW_VIDEO_TRACK="@get_low_video_track",r.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",r.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",r.NEED_MUTE_TRACK="@need_mute_track",r.NEED_UNMUTE_TRACK="@need_unmute_track"}(Jt||(Jt={})),function(r){r.SCREEN_TRACK="screen_track",r.LOW_STREAM="low_stream"}(Xn||(Xn={})),function(r){r.SOURCE_STATE_CHANGE="source-state-change",r.TRACK_ENDED="track-ended",r.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",r.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status"}(aa||(aa={})),function(r){r.FIRST_FRAME_DECODED="first-frame-decoded",r.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status"}(fl||(fl={}));const DC=["AFRICA","ASIA","CHINA","EUROPE","GLOBAL","INDIA","JAPAN","NORTH_AMERICA","OCEANIA","OVERSEA","SOUTH_AMERICA","KOREA"];var Rn;(function(r){r.CHINA="CN",r.ASIA="AS",r.NORTH_AMERICA="NA",r.EUROPE="EU",r.JAPAN="JP",r.INDIA="IN",r.KOREA="KR",r.OCEANIA="OC",r.SOUTH_AMERICA="SA",r.AFRICA="AF",r.OVERSEA="OVERSEA",r.GLOBAL="GLOBAL"})(Rn||(Rn={}));const YA={CHINA:{},ASIA:{CODE:Rn.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Rn.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Rn.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Rn.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","	uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Rn.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Rn.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Rn.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Rn.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Rn.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Rn.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Rn.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]}};var xd,LC,nr,xt,$i,ze,mo,Al;Ld&&(YA.CHINA={CODE:Rn.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),function(r){r.UPDATE_BITRATE_LIMIT="update_bitrate_limit"}(xd||(xd={}));class Hr{constructor(){this._events={},this.addListener=this.on}getListeners(t){var n;return this._events[t]?ft(n=this._events[t]).call(n,s=>s.listener):[]}on(t,n){this._events[t]||(this._events[t]=[]);const s=this._events[t];this._indexOfListener(s,n)===-1&&s.push({listener:n,once:!1})}once(t,n){this._events[t]||(this._events[t]=[]);const s=this._events[t];this._indexOfListener(s,n)===-1&&s.push({listener:n,once:!0})}off(t,n){if(!this._events[t])return;const s=this._events[t],c=this._indexOfListener(s,n);c!==-1&&Ye(s).call(s,c,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t,...n){var s;this._events[t]||(this._events[t]=[]);const c=ft(s=this._events[t]).call(s,d=>d);for(let d=0;d<c.length;d+=1){const h=c[d];h.once&&this.off(t,h.listener),h.listener.apply(this,n||[])}}_indexOfListener(t,n){let s=t.length;for(;s--;)if(t[s].listener===n)return s;return-1}}class MC extends Hr{constructor(t,n){super()}}(function(r){r.SEND="sendonly",r.RECV="recvonly",r.SENDRECV="sendrecv",r.INACTIVE="inactive"})(LC||(LC={})),function(r){r.VIDEO="video",r.AUDIO="audio"}(nr||(nr={})),function(r){r.LocalVideoTrack="videoTrack",r.LocalAudioTrack="audioTrack",r.LocalVideoLowTrack="videoLowTrack"}(xt||(xt={})),function(r){r.New="new",r.Connected="connected",r.Reconnecting="reconnecting",r.Disconnected="disconnected"}($i||($i={})),function(r){r.StateChange="stateChange",r.IceConnectionStateChange="iceConnectionStateChange",r.RequestMuteLocal="requestMuteLocal",r.RequestUnmuteLocal="requestUnmuteLocal",r.RequestRePublish="requestRePublish",r.RequestReSubscribe="requestReSubscribe",r.RequestUploadStats="requestUploadStats",r.MediaReconnectStart="MediaReconnectStart",r.MediaReconnectEnd="MediaReconnectEnd",r.NeedSignalRTT="NeedSignalRTT",r.RequestRestartICE="RequestRestartIce",r.PeerConnectionStateChange="PeerConnectionStateChange",r.RequestReconnect="RequestReconnect",r.RequestReconnectPC="RequestReconnectPC",r.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",r.P2PLost="P2PLost"}(ze||(ze={})),function(r){r.ONLINE="ONLINE",r.OFFLINE="OFFLINE"}(mo||(mo={})),function(r){r.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",r.ONLINE="ONLINE",r.OFFLINE="OFFLINE"}(Al||(Al={}));const nk={join:["startJoin","startRequestAp","startJoinGateway","finishJoin"],publish:["startPublish"]},Si={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1};function Dr(){return Si}var ik=Ts.concat("length","prototype"),qA={f:Object.getOwnPropertyNames||function(r){return is(r,ik)}},ok=qn("Reflect","ownKeys")||function(r){var t=qA.f(Nr(r)),n=_d.f;return n?t.concat(n(r)):t};qt({target:"Object",stat:!0,sham:!g},{getOwnPropertyDescriptors:function(r){for(var t,n,s=it(r),c=lr.f,d=ok(s),h={},p=0;d.length>p;)(n=c(s,t=d[p++]))!==void 0&&hn(h,t,n);return h}});var te=_e.Object.getOwnPropertyDescriptors,PC=qA.f,sk={}.toString,BC=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],UC={f:function(r){return BC&&sk.call(r)=="[object Window]"?function(t){try{return PC(t)}catch{return BC.slice()}}(r):PC(it(r))}},jh={f:pn},ak=un.f,Wn=function(r){var t=_e.Symbol||(_e.Symbol={});yt(t,r)||ak(t,r,{value:jh.f(r)})},Wh=ss.forEach,to=Ah("hidden"),Kh="Symbol",xC=pn("toPrimitive"),ck=fn.set,FC=fn.getterFor(Kh),ds=Object.prototype,Eo=u.Symbol,Fd=qn("JSON","stringify"),QC=lr.f,Fa=un.f,VC=UC.f,lk=T.f,ca=Do("symbols"),Qd=Do("op-symbols"),JA=Do("string-to-symbol-registry"),zA=Do("symbol-to-string-registry"),dk=Do("wks"),XA=u.QObject,ZA=!XA||!XA.prototype||!XA.prototype.findChild,$A=g&&f(function(){return Rs(Fa({},"a",{get:function(){return Fa(this,"a",{value:7}).a}})).a!=7})?function(r,t,n){var s=QC(ds,t);s&&delete ds[t],Fa(r,t,n),s&&r!==ds&&Fa(ds,t,s)}:Fa,GC=function(r,t){var n=ca[r]=Rs(Eo.prototype);return ck(n,{type:Kh,tag:r,description:t}),g||(n.description=t),n},tg=si&&typeof Eo.iterator=="symbol"?function(r){return typeof r=="symbol"}:function(r){return Object(r)instanceof Eo},Hh=function(r,t,n){r===ds&&Hh(Qd,t,n),Nr(r);var s=Ot(t,!0);return Nr(n),yt(ca,s)?(n.enumerable?(yt(r,to)&&r[to][s]&&(r[to][s]=!1),n=Rs(n,{enumerable:N(0,!1)})):(yt(r,to)||Fa(r,to,N(1,{})),r[to][s]=!0),$A(r,s,n)):Fa(r,s,n)},jC=function(r,t){Nr(r);var n=it(t),s=Ei(n).concat(eg(n));return Wh(s,function(c){g&&!WC.call(n,c)||Hh(r,c,n[c])}),r},WC=function(r){var t=Ot(r,!0),n=lk.call(this,t);return!(this===ds&&yt(ca,t)&&!yt(Qd,t))&&(!(n||!yt(this,t)||!yt(ca,t)||yt(this,to)&&this[to][t])||n)},KC=function(r,t){var n=it(r),s=Ot(t,!0);if(n!==ds||!yt(ca,s)||yt(Qd,s)){var c=QC(n,s);return!c||!yt(ca,s)||yt(n,to)&&n[to][s]||(c.enumerable=!0),c}},HC=function(r){var t=VC(it(r)),n=[];return Wh(t,function(s){yt(ca,s)||yt(rs,s)||n.push(s)}),n},eg=function(r){var t=r===ds,n=VC(t?Qd:it(r)),s=[];return Wh(n,function(c){!yt(ca,c)||t&&!yt(ds,c)||s.push(ca[c])}),s};if(si||(ea((Eo=function(){if(this instanceof Eo)throw TypeError("Symbol is not a constructor");var r=arguments.length&&arguments[0]!==void 0?String(arguments[0]):void 0,t=Zs(r),n=function(s){this===ds&&n.call(Qd,s),yt(this,to)&&yt(this[to],t)&&(this[to][t]=!1),$A(this,t,N(1,s))};return g&&ZA&&$A(ds,t,{configurable:!0,set:n}),GC(t,r)}).prototype,"toString",function(){return FC(this).tag}),T.f=WC,un.f=Hh,lr.f=KC,qA.f=UC.f=HC,_d.f=eg,g&&Fa(Eo.prototype,"description",{configurable:!0,get:function(){return FC(this).description}})),dh||(jh.f=function(r){return GC(pn(r),r)}),qt({global:!0,wrap:!0,forced:!si,sham:!si},{Symbol:Eo}),Wh(Ei(dk),function(r){Wn(r)}),qt({target:Kh,stat:!0,forced:!si},{for:function(r){var t=String(r);if(yt(JA,t))return JA[t];var n=Eo(t);return JA[t]=n,zA[n]=t,n},keyFor:function(r){if(!tg(r))throw TypeError(r+" is not a symbol");if(yt(zA,r))return zA[r]},useSetter:function(){ZA=!0},useSimple:function(){ZA=!1}}),qt({target:"Object",stat:!0,forced:!si,sham:!g},{create:function(r,t){return t===void 0?Rs(r):jC(Rs(r),t)},defineProperty:Hh,defineProperties:jC,getOwnPropertyDescriptor:KC}),qt({target:"Object",stat:!0,forced:!si},{getOwnPropertyNames:HC,getOwnPropertySymbols:eg}),qt({target:"Object",stat:!0,forced:f(function(){_d.f(1)})},{getOwnPropertySymbols:function(r){return _d.f(ve(r))}}),Fd){var uk=!si||f(function(){var r=Eo();return Fd([r])!="[null]"||Fd({a:r})!="{}"||Fd(Object(r))!="{}"});qt({target:"JSON",stat:!0,forced:uk},{stringify:function(r,t,n){for(var s,c=[r],d=1;arguments.length>d;)c.push(arguments[d++]);if(s=t,(z(t)||r!==void 0)&&!tg(r))return tr(t)||(t=function(h,p){if(typeof s=="function"&&(p=s.call(this,h,p)),!tg(p))return p}),c[1]=t,Fd.apply(null,c)}})}Eo.prototype[xC]||tn(Eo.prototype,xC,Eo.prototype.valueOf),ta(Eo,Kh),rs[to]=!0;var ee=_e.Object.getOwnPropertySymbols,hk=gv,ai,_r=function(r,t,n){return t in r?hk(r,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):r[t]=n,r};(function(r){r[r.CHOOSE_SERVER=11]="CHOOSE_SERVER",r[r.CLOUD_PROXY=18]="CLOUD_PROXY",r[r.CLOUD_PROXY_5=20]="CLOUD_PROXY_5"})(ai||(ai={}));var pk=Zr("Array").entries,YC=Array.prototype,fk={DOMTokenList:!0,NodeList:!0},rn=function(r){var t=r.entries;return r===YC||r instanceof Array&&t===YC.entries||fk.hasOwnProperty(cc(r))?pk:t},mc=function(r){var t,n,s,c,d,h=ve(r),p=typeof this=="function"?this:Array,A=arguments.length,m=A>1?arguments[1]:void 0,E=m!==void 0,v=0,C=md(h);if(E&&(m=mi(m,A>2?arguments[2]:void 0,2)),C==null||p==Array&&B_(C))for(n=new p(t=Ln(h.length));t>v;v++)hn(n,v,E?m(h[v],v):h[v]);else for(d=(c=C.call(h)).next,n=new p;!(s=d.call(c)).done;v++)hn(n,v,E?x_(c,m,[s.value,v],!0):s.value);return n.length=v,n},Ak=!Ov(function(r){Array.from(r)});qt({target:"Array",stat:!0,forced:Ak},{from:mc});var Fe=_e.Array.from,gk=Zr("Array").keys,qC=Array.prototype,mk={DOMTokenList:!0,NodeList:!0},Ec=function(r){var t=r.keys;return r===qC||r instanceof Array&&t===qC.keys||mk.hasOwnProperty(cc(r))?gk:t};function JC(r,t){var n=le(r);if(ee){var s=ee(r);t&&(s=kt(s).call(s,function(c){return Wt(r,c).enumerable})),n.push.apply(n,s)}return n}let Yh=0,rg=0;function Bn(r,t,n){return new dt((s,c)=>{t.timeout=t.timeout||ot("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=ht(t.data),Yh+=Il(t.data)):n&&(t.data.size?Yh+=t.data.size:t.data instanceof FormData?Yh+=function(d){let h=0;return/DingTalk/i.test(navigator.userAgent)&&d.realFormData&&(d=d.realFormData),G(d).call(d,p=>{h+=typeof p=="string"?Il(p):p.size}),h+138}(t.data):Yh+=Il(ht(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=r,Lo.request(t).then(d=>{typeof d.data=="string"?rg+=Il(d.data):d.data instanceof ArrayBuffer||d.data instanceof Uint8Array?rg+=d.data.byteLength:rg+=Il(ht(d.data)),s(d.data)}).catch(d=>{Lo.isCancel(d)?c(new M(L.OPERATION_ABORTED,"cancel token canceled")):d.code==="ECONNABORTED"?c(new M(L.NETWORK_TIMEOUT,d.message)):d.response?c(new M(L.NETWORK_RESPONSE_ERROR,d.response.status)):c(new M(L.NETWORK_ERROR,d.message))})})}async function zC(r,t){const n=new Blob([t.data],{type:"buffer"});return await Bn(r,function(s){for(var c=1;c<arguments.length;c++){var d,h=arguments[c]!=null?arguments[c]:{};if(c%2)G(d=JC(Object(h),!0)).call(d,function(A){_r(s,A,h[A])});else if(te)He(s,te(h));else{var p;G(p=JC(Object(h))).call(p,function(A){se(s,A,Wt(h,A))})}}return s}({},t,{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const yr=new class extends Hr{constructor(){super(),this._moduleName="network-indicator",this._networkState=mo.ONLINE,window.addEventListener("online",()=>{this.networkState=mo.ONLINE}),window.addEventListener("offline",()=>{this.networkState=mo.OFFLINE})}set networkState(r){S.info("[".concat(this._moduleName,"]")+"network state changed, "+this._networkState+" -> "+r),this.emit(Al.NETWORK_STATE_CHANGE,r,this._networkState),r===mo.ONLINE?this.emit(Al.ONLINE):r===mo.OFFLINE&&(this.onlineWaiter=new dt(t=>{this.once(Al.ONLINE,()=>{this.onlineWaiter=void 0,t(mo.ONLINE)})}),this.emit(Al.OFFLINE)),this._networkState=r}get networkState(){return this._networkState}},Ne={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function ng(r,t){const n=t.timeout*Math.pow(t.timeoutFactor,r);return Math.min(t.maxRetryTimeout,n)}function Zn(r,t,n,s){const c=hr({},Ne,s);let d=c.timeout;const h=async()=>{await Ur(d),d*=c.timeoutFactor,d=Math.min(c.maxRetryTimeout,d)};let p=!1;const A=new dt(async(m,E)=>{t=t||(()=>!1),n=n||(()=>!0);for(let v=0;v<c.maxRetryCount;v+=1){if(p)return E(new M(L.OPERATION_ABORTED));try{const C=await r();if(!t(C,v)||v+1===c.maxRetryCount)return m(C);await h()}catch(C){if(!n(C,v)||v+1===c.maxRetryCount)return E(C);await h()}}});return A.cancel=()=>p=!0,A}let ig=!1;const eo=new class extends Hr{};function XC(){const r=we();if(!ig){const t=n=>{n.preventDefault(),ig=!1,r.os!=="Android"||r.name!=="Chrome"&&r.name!==Re.WECHAT?(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0)):document.body.removeEventListener("click",t,!0)};ig=!0,r.os!=="Android"||r.name!=="Chrome"&&r.name!==Re.WECHAT?(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)):document.body.addEventListener("click",t,!0),S.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),eo.onAutoplayFailed?eo.onAutoplayFailed():eo.onAudioAutoplayFailed?S.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):S.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),eo.emit("autoplay-failed")}}function ZC(r,t){var n=le(r);if(ee){var s=ee(r);t&&(s=kt(s).call(s,function(c){return Wt(r,c).enumerable})),n.push.apply(n,s)}return n}function An(r){for(var t=1;t<arguments.length;t++){var n,s=arguments[t]!=null?arguments[t]:{};if(t%2)G(n=ZC(Object(s),!0)).call(n,function(d){_r(r,d,s[d])});else if(te)He(r,te(s));else{var c;G(c=ZC(Object(s))).call(c,function(d){se(r,d,Wt(s,d))})}}return r}function Vd(r={report:gt}){return function(t,n,s){const c=t[n];if(typeof c=="function"){const d=t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name;s.value=function(...h){var p;const A=r.report.reportApiInvoke(this._sessionId||null,{name:O(p="".concat(d,".")).call(p,n),options:h,tag:Yt.TRACER});try{const m=c.apply(this,h);return A.onSuccess(),m}catch(m){throw A.onError(m),m}}}return s}}function qh(r={report:gt}){return function(t,n,s){const c=t[n];if(typeof c=="function"){const d=t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name;s.value=async function(...h){var p;const A=r.report.reportApiInvoke(this._sessionId||null,{name:O(p="".concat(d,".")).call(p,n),options:h,tag:Yt.TRACER});try{const m=await c.apply(this,h);return A.onSuccess(),m}catch(m){throw A.onError(m),m}}}return s}}const gt=new class{constructor(){var r,t;this.baseInfoMap=new re,this.clientList=ls,this.keyEventUploadPendingItems=[],this.normalEventUploadPendingItems=[],this.apiInvokeUploadPendingItems=[],this.apiInvokeCount=0,this.ltsList=[],this.lastSendNormalEventTime=pt(),this.customReportCount=0,this.eventUploadTimer=window.setInterval(Mr(r=this.doSend).call(r,this),ot("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(Mr(t=this.appendSessionId).call(t,this),ot("EVENT_REPORT_SEND_INTERVAL"))}reportApiInvoke(r,t,n){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;const s=pt();this.apiInvokeCount+=1;const c=this.apiInvokeCount,d=()=>({tag:t.tag,invokeId:c,sid:r,name:t.name,apiInvokeTime:s,options:t.options,states:t.states||null}),h=!!ot("SHOW_REPORT_INVOKER_LOG");h&&S.info("".concat(t.name," start"),t.options);let p=!1;Ur(t.timeout).then(()=>{p||(this.sendApiInvoke(An({},d(),{error:L.API_INVOKE_TIMEOUT,success:!1})),S.debug("".concat(t.name," timeout")))});const A=new M(L.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:m=>{const E=()=>{if(p)throw A;return p=!0,this.sendApiInvoke(An({},d(),{success:!0},t.reportResult&&{result:m})),h&&S.info("".concat(t.name," onSuccess")),m};return n?np(E,t.name+"Success",n,()=>p=!0):E()},onError:m=>{const E=()=>{if(p)throw m;p=!0,this.sendApiInvoke(An({},d(),{success:!1,error:m.toString()})),h&&S.info("".concat(t.name," onFailure"),m.toString())};return n?np(E,t.name+"Error",n,()=>p=!0):E()}}}sessionInit(r,t){if(this.baseInfoMap.has(r))return;const n=pt(),s=this.createBaseInfo(r,n);s.cname=t.cname;const c=hr({},{willUploadConsoleLog:ot("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:Ld?"global":"oversea",areas:ot("AREAS")&&ot("AREAS").join(",")},t.extend),d=pt(),h=An({},s,{eventType:jn.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,build:dl,lts:d,elapse:d-n,extend:ht(c),mode:t.mode,process:ot("PROCESS_ID"),success:!0,version:Pn});this.send({type:kr.SESSION,data:h},!0)}joinChooseServer(r,t){const n=this.baseInfoMap.get(r);if(!n)return;const s=n.info,c=pt(),d=An({},s,{eventType:jn.JOIN_CHOOSE_SERVER,lts:c,eventElapse:c-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:c-n.startTime,success:t.succ,chooseServerAddrList:ht(t.serverList),uid:t.uid?Sr(t.uid):null,cid:t.cid?Sr(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0});this.send({type:kr.JOIN_CHOOSE_SERVER,data:d},!0)}reqUserAccount(r,t){const n=this.baseInfoMap.get(r);if(!n)return;const s=n.info,c=pt(),d=An({},s,{eventType:jn.REQ_USER_ACCOUNT,lts:c,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:c-n.startTime,eventElapse:c-t.lts,extend:ht(t.extend)});this.send({type:kr.REQ_USER_ACCOUNT,data:d},!0)}joinGateway(r,t){const n=this.baseInfoMap.get(r);if(!n)return;const s=n.info;t.vid&&(s.vid=t.vid),s.uid=t.uid,s.cid=t.cid;const c=pt(),d=An({},s,{eventType:jn.JOIN_GATEWAY,lts:c,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,elapse:c-n.startTime,eventElapse:c-t.lts});t.succ&&(n.lastJoinSuccessTime=c),this.send({type:kr.JOIN_GATEWAT,data:d},!0)}joinChannelTimeout(r,t){const n=this.baseInfoMap.get(r);if(!n)return;const s=pt(),c=An({},n.info,{lts:s,timeout:t,elapse:s-n.startTime});this.send({type:kr.JOIN_CHANNEL_TIMEOUT,data:c},!0)}publish(r,t){const n=this.baseInfoMap.get(r);if(!n)return;const s=n.info,c=pt(),d=An({},s,{eventType:jn.PUBLISH,lts:c,eventElapse:t.eventElapse,elapse:c-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:kr.PUBLISH,data:d},!0)}subscribe(r,t){const n=this.baseInfoMap.get(r);if(!n)return;const s=n.info,c=pt(),d=An({},s,{eventType:jn.SUBSCRIBE,lts:c,eventElapse:t.eventElapse,elapse:c-n.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid});typeof t.peerid=="string"?d.peerSuid=t.peerid:d.peer=t.peerid,this.send({type:kr.SUBSCRIBE,data:d},!0)}wsCompressorInit(r){var t;const n=[...Ec(t=this.baseInfoMap).call(t)],s=n.length?n[0]:"UnableToGetSid",c=this.baseInfoMap.get(s);if(!c)return;const d=c.info,h=pt(),p=An({},d,{eventType:jn.WS_COMPRESSOR_INIT,lts:h,eventElapse:r.eventElapse,elapse:h-c.startTime,status:r.status?1:2});this.send({type:kr.WS_COMPRESSOR_INIT,data:p},!0)}firstRemoteFrame(r,t,n,s){const c=this.baseInfoMap.get(r);if(!c)return;const d=c.info,h=pt(),p=An({},d,{},s,{elapse:h-c.startTime,eventType:t,lts:h});this.send({type:n,data:p},!0)}onGatewayStream(r,t,n,s){const c=this.baseInfoMap.get(r);if(!c)return;const d=An({},c.info,{},s,{eventType:t,lts:pt()});this.send({type:n,data:d},!0)}streamSwitch(r,t){const n=this.baseInfoMap.get(r);if(!n)return;const s=n.info,c=pt(),d=An({},s,{eventType:jn.STREAM_SWITCH,lts:c,isDual:t.isdual,elapse:c-n.startTime,success:t.succ});this.send({type:kr.STREAM_SWITCH,data:d},!0)}requestProxyAppCenter(r,t){const n=this.baseInfoMap.get(r);if(!n)return;const s=n.info,c=pt(),d=An({},s,{eventType:jn.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-t.lts,elapse:c-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:kr.REQUEST_PROXY_APPCENTER,data:d},!0)}requestProxyWorkerManager(r,t){const n=this.baseInfoMap.get(r);if(!n)return;const s=n.info,c=pt(),d=An({},s,{eventType:jn.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-t.lts,elapse:c-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:kr.REQUEST_PROXY_WORKER_MANAGER,data:d},!0)}setProxyServer(r){this.proxyServer=r,r?S.debug("reportProxyServerurl: ".concat(r)):S.debug("disable reportProxyServerurl: ".concat(r))}peerPublishStatus(r,t){const n=this.baseInfoMap.get(r);if(!n)return;const s=n.info,c=pt(),d=An({},s,{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:c,elapse:c-n.startTime,joinChannelSuccessElapse:c-(n.lastJoinSuccessTime||c)});this.send({type:kr.PEER_PUBLISH_STATUS,data:d},!0)}workerEvent(r,t){const n=this.baseInfoMap.get(r);if(!n)return;const s=n.info,c=pt(),d=SS(An({},s,{},t,{elapse:c-n.startTime,lts:c,productType:"WebRTC"}),"payload",1300);G(d).call(d,h=>this.send({type:kr.WORKER_EVENT,data:h},!0))}apworkerEvent(r,t){const n=this.baseInfoMap.get(r);if(!n)return;const s=n.info,c=pt(),d=An({},s,{},t,{elapse:c-n.startTime,lts:c});this.send({type:kr.AP_WORKER_EVENT,data:d},!0)}joinWebProxyAP(r,t){const n=this.baseInfoMap.get(r);if(!n)return;const s=n.info,c=pt(),d=An({},s,{},t,{elapse:c-n.startTime,lts:c,extend:t.extend||void 0});this.send({type:kr.JOIN_WEB_PROXY_AP,data:d},!0)}WebSocketQuit(r,t){const n=this.baseInfoMap.get(r);if(!n)return;const s=n.info,c=pt(),d=An({},s,{},t,{elapse:c-n.startTime,lts:c});this.send({type:kr.WEBSOCKET_QUIT,data:d},!0)}async sendCustomReportMessage(r,t){if(this.customReportCount+=t.length,this.customReportCount>ot("CUSTOM_REPORT_LIMIT"))throw new M(L.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const n=ft(t).call(t,c=>({type:kr.USER_ANALYTICS,data:An({sid:r},c)})),s={msgType:"EventMessages",sentTs:Math.round(pt()/1e3),payloads:ft(n).call(n,c=>ht(c))};try{await this.postDataToStatsCollector(s)}catch(c){throw S.error("send custom report message failed",c.toString()),new M(L.CUSTOM_REPORT_SEND_FAILED,c.message)}}autoplayFailed(r,t,n,s){if(!r)return;const c=this.baseInfoMap.get(r);if(!c)return;const d=c.info,h=pt(),p=An({},d,{vid:d.vid===void 0?0:Number(d.vid),lts:h,elapse:h-c.startTime,cbRegistered:eo.onAutoplayFailed||eo.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:s,extend:void 0});this.send({type:kr.AUTOPLAY_FAILED,data:p},!0)}sendApiInvoke(r){const t=ot("NOT_REPORT_EVENT");if(r.tag&&zt(t)&&zt(t).call(t,r.tag))return!1;if(r.sid===null)return this.apiInvokeUploadPendingItems.push(r),!1;const n=this.baseInfoMap.get(r.sid);if(!n)return this.apiInvokeUploadPendingItems.push(r),!1;const{cname:s,uid:c,cid:d}=n.info;r.lts=r.lts||pt();const h={invokeId:r.invokeId,sid:r.sid,cname:s,cid:d,uid:c,lts:r.lts,success:r.success,elapse:r.lts-n.startTime,execElapse:r.lts-r.apiInvokeTime,apiName:r.name,options:r.options?ht(r.options):void 0,execStates:r.states?ht(r.states):void 0,execResult:r.result?ht(r.result):void 0,errorCode:r.error?ht(r.error):void 0};return this.send({type:kr.API_INVOKE,data:h},!1),!0}appendSessionId(){var r;G(r=this.clientList).call(r,t=>{if(t._sessionId){const n=this.apiInvokeUploadPendingItems.length;for(let s=0;s<n;s++){const c=this.apiInvokeUploadPendingItems.shift();c&&(c.sid=t._sessionId,this.sendApiInvoke(hr({},c)))}}})}send(r,t){if(t)return this.keyEventUploadPendingItems.push(r),void this.sendItems(this.keyEventUploadPendingItems,!0);var n;this.normalEventUploadPendingItems.push(r),this.normalEventUploadPendingItems.length>ot("NORMAL_EVENT_QUEUE_CAPACITY")&&Ye(n=this.normalEventUploadPendingItems).call(n,0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&pt()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(r,t){const n=[],s=[];for(;r.length;){const p=r.shift();n.length<20?n.push(p):s.push(p)}r.push(...s);for(const p of[...n]){var c,d;Ft(c=this.ltsList).call(c,p.data.lts)!==-1?(p.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(p.data.lts)):(this.ltsList.push(p.data.lts),xa(d=this.ltsList).call(d,(A,m)=>A-m))}t||(this.lastSendNormalEventTime=pt());const h={msgType:"EventMessages",sentTs:Math.round(pt()/1e3),payloads:ft(n).call(n,p=>ht(p)),vid:(p=>{const A=p&&p.data.sid&&this.baseInfoMap.get(p.data.sid);return A&&A.info.vid&&+A.info.vid||0})(n[0])};return n.length&&this.postDataToStatsCollector(h).catch((p=>A=>{var m,E,v;ot("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=O(m=this.keyEventUploadPendingItems).call(m,p):(this.normalEventUploadPendingItems=O(E=this.normalEventUploadPendingItems).call(E,p),this.normalEventUploadPendingItems.length>ot("NORMAL_EVENT_QUEUE_CAPACITY")&&(Ye(v=this.normalEventUploadPendingItems).call(v,0,this.normalEventUploadPendingItems.length-ot("NORMAL_EVENT_QUEUE_CAPACITY")),S.warning("report: drop normal events"))))})(n)),r}async postDataToStatsCollector(r,t=!1){var n,s,c;yr.networkState===mo.OFFLINE&&await dt.race([yr.onlineWaiter,Ur(2*Ne.maxRetryTimeout)]);const d=t?"/events/proto-raws":"/events/messages";let h=this.url||(this.proxyServer?O(n=O(s="https://".concat(this.proxyServer,"/rs/?h=")).call(s,ot("EVENT_REPORT_DOMAIN"),"&p=6443&d=")).call(n,d):O(c="https://".concat(ot("EVENT_REPORT_DOMAIN"),":6443")).call(c,d));for(let E=0;E<2;E+=1){var p,A,m;E===1&&(h=this.backupUrl||(this.proxyServer?O(p=O(A="https://".concat(this.proxyServer,"/rs/?h=")).call(A,ot("EVENT_REPORT_BACKUP_DOMAIN"),"&p=6443&d=")).call(p,d):O(m="https://".concat(ot("EVENT_REPORT_BACKUP_DOMAIN"),":6443")).call(m,d)));try{t?await zC(h,{timeout:1e4,data:r}):await Bn(h,{timeout:1e4,data:r})}catch(v){if(E===1)throw v;continue}return}}createBaseInfo(r,t){const n=hr({},$2);return n.sid=r,this.baseInfoMap.set(r,{info:n,startTime:t}),n}reportResourceTiming(r,t){const n=performance.getEntriesByName(r),s=n[n.length-1];s&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:s,tag:Yt.TRACER}).onSuccess()}};class $C extends Hr{constructor(t,n){super(),this._hints=[],this._isClosed=!1,this._ID=n||Le(8,"track-"),this._originMediaStreamTrack=t,this._mediaStreamTrack=t,gC(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){if(!t){const n=gt.reportApiInvoke(null,{name:Kt.GET_MEDIA_STREAM_TRACK,options:[],tag:Yt.TRACER});this._mediaStreamTrack&&typeof this._mediaStreamTrack.label=="string"?n.onSuccess(this._mediaStreamTrack.label):n.onSuccess("")}return this._mediaStreamTrack}close(){this._isClosed=!0,mC(this)}}let Ek=1;class Un{constructor(t){var n;this.lockingPromise=dt.resolve(),this.locks=0,this.name="",this.lockId=Ek++,t&&(this.name=t),S.debug(O(n="[lock-".concat(this.name,"-")).call(n,this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(t){var n,s,c;let d;this.locks+=1,S.debug(O(n=O(s=O(c="[lock-".concat(this.name,"-")).call(c,this.lockId,"] is locked, current queue ")).call(s,this.locks,". ")).call(n,typeof t=="string"?t:""));const h=new dt(A=>{d=()=>{var m,E,v;this.locks-=1,S.debug(O(m=O(E=O(v="[lock-".concat(this.name,"-")).call(v,this.lockId,"] is not locked, current queue ")).call(E,this.locks,". ")).call(m,typeof t=="string"?t:"")),A()}}),p=this.lockingPromise.then(()=>d);return this.lockingPromise=this.lockingPromise.then(()=>h),p}}function gl(r,t){return function(n,s,c){const d=n[s];if(typeof d!="function")throw new Error("Cannot use mutex on object property.");return c.value=async function(...h){var p;const A=this[t];var m;if(!A)throw new Error(O(m="mutex property key ".concat(t," doesn't exist on ")).call(m,r));const E=await A.lock(O(p="From ".concat(r,".")).call(p,s));try{return await d.apply(this,h)}finally{E()}},c}}class la extends $C{constructor(t,n){super(t,n),this._enabled=!0,this._muted=!1,this._isClosed=!1,this._trackProcessors=[],this._handleTrackEnded=()=>{this.onTrackEnded()},this._enabledMutex=new Un("".concat(n)),t.addEventListener("ended",this._handleTrackEnded)}get muted(){return this._muted}get enabled(){return this._enabled}getTrackLabel(){return this._originMediaStreamTrack.label}close(){var t;this._isClosed||(this.stop(),G(t=this._trackProcessors).call(t,n=>n.destroy()),this._trackProcessors=[],this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,S.debug("[".concat(this.getTrackId(),"] close")),this.emit(Jt.NEED_CLOSE),super.close())}async _registerTrackProcessor(t){var n;if(Ft(n=this._trackProcessors).call(n,t)!==-1)return;const s=this._trackProcessors[this._trackProcessors.length-1];this._trackProcessors.push(t),t.onOutputChange=async()=>{const c=t.output||this._originMediaStreamTrack;this._mediaStreamTrack=c,this._updatePlayerSource(),await Xe(this,Jt.NEED_REPLACE_TRACK,this)},s?(s.onOutputChange=async()=>{s.output&&await t.setInput(s.output)},await t.setInput(s.output||s.input||this._originMediaStreamTrack)):await t.setInput(this._originMediaStreamTrack)}_getOutputFromProcessors(){if(this._trackProcessors.length===0)return this._originMediaStreamTrack;const t=this._trackProcessors[this._trackProcessors.length-1];return t.output||t.input||this._originMediaStreamTrack}async _updateOriginMediaStreamTrack(t,n){if(t!==this._originMediaStreamTrack){if(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop(),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._trackProcessors.length>0){await this._trackProcessors[0].setInput(t);const s=this._getOutputFromProcessors();this._mediaStreamTrack=s}else this._mediaStreamTrack=this._originMediaStreamTrack;this._updatePlayerSource(),await Xe(this,Jt.NEED_REPLACE_TRACK,this)}}_getDefaultPlayerConfig(){return{}}onTrackEnded(){S.debug("[".concat(this.getTrackId(),"] track ended")),this.emit(aa.TRACK_ENDED)}stateCheck(t,n){var s,c,d;if(S.debug(O(s=O(c=O(d="check track state, [muted: ".concat(this._muted,", enabled: ")).call(d,this._enabled,"] to [")).call(c,t,": ")).call(s,n,"]")),Ac(n,t),this._enabled&&this._muted&&t==="enabled"&&n===!1)throw new M(L.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print();if(!this._enabled&&!this._muted&&t==="muted"&&n===!0)throw new M(L.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print()}}var Lr;(function(r){r.IOS_15_INTERRUPTION_START="ios15-interruption-start",r.IOS_15_INTERRUPTION_END="ios15-interruption-end",r.IOS_INTERRUPTION_START="ios-interruption-start",r.IOS_INTERRUPTION_END="ios-interruption-end",r.STATE_CHANGE="state-change"})(Lr||(Lr={}));const tS=window.AudioContext||window.webkitAudioContext;let xo=null;const ue=new class extends Hr{constructor(){super(...arguments),this.onLocalAudioTrackMute=()=>{S.info("ios15-interruption-start"),this.emit(Lr.IOS_15_INTERRUPTION_START)},this.onLocalAudioTrackUnmute=async()=>{S.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?S.info("ios15-interruption-end-canceled"):(xo&&await xo.suspend(),this.emit(Lr.IOS_15_INTERRUPTION_END))}}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(r){S.debug("webaudio bindInterruptDetectorTrack ".concat(r.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=r,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(r){S.debug("webaudio unbindInterruptDetectorTrack ".concat(r.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===r&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function _k(){tS?(S.info("create audio context"),xo=new tS,ue.curState=xo.state,xo.onstatechange=()=>{var r;ue.prevState=ue.curState,ue.curState=xo?xo.state:void 0,(vi()||as())&&ue.prevState==="running"&&ue.curState==="interrupted"&&(S.info("ios-interruption-start"),ue.emit(Lr.IOS_INTERRUPTION_START)),(vi()||as())&&ue.prevState==="interrupted"&&ue.curState==="running"&&(S.info("ios-interruption-end"),ue.emit(Lr.IOS_INTERRUPTION_END)),ue.prevState!==ue.curState&&(S.debug("AudioContext State Change",O(r="".concat(ue.prevState,"=>")).call(r,ue.curState)),ue.emit(Lr.STATE_CHANGE))},async function(r){const t=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let n,s=!1,c=!1,d=!1;function h(w){r.state==="running"?p(!1):vi()||as()?r.state==="suspended"&&(p(!0),w&&r.resume().then(m,m)):r.state!=="closed"&&(p(!0),w&&r.resume().then(m,m))}function p(w){if(s!==w){s=w;for(let k=0,P=t;k<P.length;k+=1){const V=P[k];w?window.addEventListener(V,E,{capture:!0,passive:!0}):window.removeEventListener(V,E,{capture:!0,passive:!0})}}}function A(){h(!0)}function m(){h(!1)}function E(){h(!0)}function v(w){if(!d)if(n.paused)if(w){C(!1),d=!0;let k;try{k=n.play(),k?k.then(b,b):(n.addEventListener("playing",b),n.addEventListener("abort",b),n.addEventListener("error",b))}catch{b()}}else C(!0);else C(!1)}function C(w){if(c!==w){c=w;for(let k=0,P=t;k<P.length;k++){const V=P[k];w?window.addEventListener(V,y,{capture:!0,passive:!0}):window.removeEventListener(V,y,{capture:!0,passive:!0})}}}function b(){n.removeEventListener("playing",b),n.removeEventListener("abort",b),n.removeEventListener("error",b),d=!1,v(!1)}function y(){v(!0)}if(vi()){const w=r.createMediaStreamDestination(),k=document.createElement("div");k.innerHTML="<audio x-webkit-airplay='deny'></audio>",n=k.children.item(0),n.controls=!1,n.disableRemotePlayback=!0,n.preload="auto",n.srcObject=w.stream,v(!0)}ue.on(Lr.STATE_CHANGE,A),h(!1)}(xo)):S.error("your browser is not support web audio")}function ml(){if(!xo){if(_k(),!xo)throw new M(L.NOT_SUPPORTED,"can not create audio context");return xo}return xo}function Gd(r){if(function(){if(og!==null)return og;const s=ml(),c=s.createBufferSource(),d=s.createGain(),h=s.createGain();c.connect(d),c.connect(h),c.disconnect(d);let p=!1;try{c.disconnect(d)}catch{p=!0}return c.disconnect(),og=p,p}())return;S.debug("polyfill audio node");const t=r.connect,n=r.disconnect;r.connect=(s,c,d)=>{var h;return r._inputNodes||(r._inputNodes=[]),zt(h=r._inputNodes).call(h,s)||(s instanceof AudioNode?(r._inputNodes.push(s),t.call(r,s,c,d)):t.call(r,s,c)),r},r.disconnect=(s,c,d)=>{n.call(r),s?da(r._inputNodes,s):r._inputNodes=[];for(const h of r._inputNodes)t.call(r,h)}}let og=null;function Jh(r,t){const n=1/t,s=ml();let c=s.createGain();c.gain.value=0,c.connect(s.destination);let d=!1;const h=()=>{if(d)return void(c=null);const p=s.createOscillator();p.onended=h,p.connect(c),p.start(0),p.stop(s.currentTime+n),r(s.currentTime)};return h(),()=>{d=!0}}class eS extends Hr{constructor(){super(),this.isPlayed=!1,this.audioOutputLevel=0,this.isDestroyed=!1,this.isNoAudioInput=!1,this._noAudioInputCount=0,this.context=ml(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Gd(this.outputNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.smoothingTimeConstant=.4,this.analyserNode.fftSize=2048}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(Bo.ON_AUDIO_BUFFER,function(s){for(let c=0;c<s.outputBuffer.numberOfChannels;c+=1){const d=s.outputBuffer.getChannelData(c);for(let h=0;h<d.length;h+=1)d[h]=0}return s.inputBuffer}(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Dr().webAudioMediaStreamDest)throw new M(L.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&on(()=>{ue.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){if(!this.context||vi()||as()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode)return 0;const t=new Uint8Array(this.analyserNode.frequencyBinCount);this.analyserNode.getByteFrequencyData(t);let n=0;for(let s=0;s<t.length;s++)n+=s<64?Math.abs(10*t[s]):Math.abs(6*t[s]/15);return n/t.length/255}async checkHasAudioInput(t=0){if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;if(vi()||as()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume(),!this.analyserNode)return!1;const n=new Uint8Array(this.analyserNode.frequencyBinCount);this.analyserNode.getByteFrequencyData(n);let s=!1;for(let c=0;c<n.length;c++)n[c]!==0&&(s=!0);return s?(this.isNoAudioInput=!1,!0):(await Ur(200),await this.checkHasAudioInput(t?t+1:1)&&s)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}setMute(t){t?(this.disconnect(),this.audioOutputLevel=0):this.connect()}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){this.sourceNode&&this.sourceNode.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){this.sourceNode&&this.sourceNode.connect(this.outputNode),this.outputNode.connect(this.analyserNode)}}class zh extends eS{constructor(t,n){var s;if(super(),this.isCurrentTrackCloned=!1,this.isRemoteTrack=!1,this.rebuildWebAudio=async()=>{if(S.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void S.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>S.info("resume success")),S.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const h=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?h.stop():this.isCurrentTrackCloned=!0;const p=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(p),Gd(this.sourceNode),this.analyserNode=this.context.createAnalyser();const A=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(A,this.context.currentTime),Gd(this.outputNode),this.connect(),this.audioElement.srcObject=p,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()},t.kind!=="audio")throw new M(L.UNEXPECTED_ERROR);this.track=t;const c=new MediaStream([this.track]);this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(c),Gd(this.sourceNode),this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=c;const d=we();n&&d.os===Mn.IOS&&Number((s=d.osVersion)===null||s===void 0?void 0:s.split(".")[0])<15&&(ue.on(Lr.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(h=>{h||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}get isFreeze(){return!1}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;const n=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(n),Gd(this.sourceNode),this.sourceNode.connect(this.outputNode),this.audioElement.srcObject=n}destroy(){this.audioElement.srcObject=null,this.audioElement.remove(),ue.off("state-change",this.rebuildWebAudio),super.destroy()}}async function rS(r,t){const n=(c,d)=>c?typeof c!="number"?c.max||c.exact||c.ideal||c.min||d:c:d,s={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r,maxHeight:n(t.height,1080),maxWidth:n(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(s.video.mandatory.maxFrameRate=t.frameRate.max,s.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(s.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(s)}async function vk(r){const t=await sg(r.mediaSource),n=await function(s){return new dt((c,d)=>{const h=document.createElement("div");h.innerText="share screen",h.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const p=document.createElement("div");p.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const A=document.createElement("div");A.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",A.setAttribute("style","height: 12%;");const m=document.createElement("div");m.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const E=document.createElement("div");E.setAttribute("style","text-align: right; padding: 16px 0;");const v=document.createElement("button");v.innerHTML="cancel",v.setAttribute("style","width: 85px;"),v.onclick=()=>{document.body.removeChild(C);const b=new Error("NotAllowedError");b.name="NotAllowedError",d(b)},E.appendChild(v),p.appendChild(A),p.appendChild(m),p.appendChild(E);const C=document.createElement("div");C.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),C.appendChild(h),C.appendChild(p),document.body.appendChild(C),ft(s).call(s,b=>{if(b.id){const y=document.createElement("div");y.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let w=b.thumbnail;const{width:k}=w.getSize();k>1920&&(w=w.resize({width:1920})),y.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+w.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+(b.name.replace(/[\u00A0-\u9999<>\&]/g,function(P){return"&#"+P.charCodeAt(0)+";"})+"</span>"),y.onclick=()=>{document.body.removeChild(C),c(b.id)},m.appendChild(y)}})})}(t);return await rS(n,r)}async function sg(r){let t=["window","screen"];r!=="application"&&r!=="window"||(t=["window"]),r==="screen"&&(t=["screen"]);const n=nS();if(!n)throw new M(L.ELECTRON_IS_NULL);let s=null;try{s=n.desktopCapturer.getSources({types:t})}catch{s=null}s&&s.then||(s=new dt((c,d)=>{n.desktopCapturer.getSources({types:t},(h,p)=>{h?d(h):c(p)})}));try{return await s}catch(c){throw new M(L.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,c.toString())}}let Xh=null;function nS(){if(Xh)return Xh;try{return Xh=window.require("electron"),Xh}catch{return null}}const ag=new Un("safari");let iS=!1,oS=!1;async function nn(r,t){let n=0,s=null;for(;n<2;)try{s=await Ik(r,t,n>0);break}catch(h){var c,d;if(h instanceof M)throw S.error(O(d="[".concat(t,"] ")).call(d,h.toString())),h;const p=Zh(h.name||h.code||h,h.message);if(p.code===L.MEDIA_OPTION_INVALID){S.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,await Ur(500);continue}throw S.error(O(c="[".concat(t,"] ")).call(c,p.toString())),p}if(!s)throw new M(L.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return s}async function Ik(r,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new M(L.NOT_SUPPORTED,"can not find getUserMedia");n&&(r.video&&(delete r.video.width,delete r.video.height),r.screen&&(delete r.screen.width,delete r.screen.height));const s=Dr(),c=new MediaStream;if(r.audioSource&&c.addTrack(r.audioSource),r.videoSource&&c.addTrack(r.videoSource),!r.audio&&!r.video&&!r.screen)return S.debug("Using Video Source/ Audio Source"),c;if(r.screen)if(nS())r.screen.sourceId?El(c,await rS(r.screen.sourceId,r.screen)):El(c,await vk(r.screen));else if(kd()&&r.screen.extensionId&&r.screen.mandatory){if(!s.getStreamFromExtension)throw new M(L.NOT_SUPPORTED,"This browser does not support screen sharing");S.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const v=await(h=r.screen.extensionId,p=t,new dt((C,b)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},w=>{if(!w||!w.streamId)return S.error("[".concat(p,"] No response from Chrome Plugin. Plugin not installed properly"),w),void b(new M(L.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));C(w.streamId)})}catch(w){var y;S.error(O(y="[".concat(p,"] AgoraRTC screensharing plugin is not accessible(")).call(y,h,")"),w.toString()),b(new M(L.CHROME_PLUGIN_NOT_INSTALL))}}));r.screen.mandatory.chromeMediaSourceId=v,El(c,await navigator.mediaDevices.getUserMedia({video:{mandatory:r.screen.mandatory}}))}else if(s.getDisplayMedia){r.screen.mediaSource&&kC(r.screen.mediaSource);const v={width:r.screen.width,height:r.screen.height,frameRate:r.screen.frameRate,displaySurface:r.screen.mediaSource==="screen"?"monitor":r.screen.mediaSource};S.debug("[".concat(t,"] getDisplayMedia:"),ht({video:v,audio:!!r.screenAudio})),El(c,await navigator.mediaDevices.getDisplayMedia({video:v,audio:!!r.screenAudio}))}else{if(!Gr())throw S.error("[".concat(t,"] This browser does not support screenSharing")),new M(L.NOT_SUPPORTED,"This browser does not support screen sharing");{var d;r.screen.mediaSource&&kC(r.screen.mediaSource);const v={video:{mediaSource:r.screen.mediaSource,width:r.screen.width,height:r.screen.height,frameRate:r.screen.frameRate}};S.debug(O(d="[".concat(t,"] getUserMedia: ")).call(d,ht(v))),El(c,await navigator.mediaDevices.getUserMedia(v))}}var h,p;if(!r.video&&!r.audio)return c;const A={video:r.video,audio:r.audio};S.debug("[".concat(t,"] GetUserMedia"),ht(A)),we();let m,E=null;(Pi()||vi()||Od())&&(E=await ag.lock());try{m=await navigator.mediaDevices.getUserMedia(A)}catch(v){throw E&&E(),v}return A.audio&&(iS=!0),A.video&&(oS=!0),El(c,m),E&&E(),c}function Zh(r,t){switch(r){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":var n;return new M(L.MEDIA_OPTION_INVALID,O(n="".concat(r,": ")).call(n,t));case"NotFoundError":case"DevicesNotFoundError":var s;return new M(L.DEVICE_NOT_FOUND,O(s="".concat(r,": ")).call(s,t));case"NotSupportedError":var c;return new M(L.NOT_SUPPORTED,O(c="".concat(r,": ")).call(c,t));case"NotReadableError":var d;return new M(L.NOT_READABLE,O(d="".concat(r,": ")).call(d,t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":var h;return new M(L.PERMISSION_DENIED,O(h="".concat(r,": ")).call(h,t));case"ConstraintNotSatisfiedError":var p;return new M(L.CONSTRAINT_NOT_SATISFIED,O(p="".concat(r,": ")).call(p,t));default:var A;return S.error("getUserMedia unexpected error",r),new M(L.UNEXPECTED_ERROR,O(A="".concat(r,": ")).call(A,t))}}function El(r,t){const n=r.getVideoTracks()[0],s=r.getAudioTracks()[0],c=t.getVideoTracks()[0],d=t.getAudioTracks()[0];d&&(s&&r.removeTrack(s),r.addTrack(d)),c&&(n&&r.removeTrack(n),r.addTrack(c))}const gn=new class extends Hr{constructor(){super(),this._state=gc.IDLE,this.isAccessMicrophonePermission=!1,this.isAccessCameraPermission=!1,this.lastAccessMicrophonePermission=!1,this.lastAccessCameraPermission=!1,this.checkdeviceMatched=!1,this.deviceInfoMap=new re,this.init().then(()=>{var r;navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",Mr(r=this.updateDevicesInfo).call(r,this)),window.setInterval(()=>!Oh()&&ot("ENUMERATE_DEVICES_INTERVAL")&&this.updateDevicesInfo(),6e4)}).catch(r=>S.error(r.toString()))}get state(){return this._state}set state(r){r!==this._state&&(this.emit(sa.STATE_CHANGE,r),this._state=r)}async enumerateDevices(r,t,n=!1){if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new M(L.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const s=await navigator.mediaDevices.enumerateDevices(),c=this.checkMediaDeviceInfoIsOk(s);let d=!this.isAccessMicrophonePermission&&r,h=!this.isAccessCameraPermission&&t;c.audio&&(d=!1),c.video&&(h=!1);let p=null,A=null,m=null;if(!n&&(d||h)){if(ag.isLocked&&(S.debug("[device manager] wait GUM lock"),(await ag.lock())(),S.debug("[device manager] GUM unlock")),iS&&(d=!1,this.isAccessMicrophonePermission=!0),oS&&(h=!1,this.isAccessCameraPermission=!0),S.debug("[device manager] check media device permissions",r,t,d,h),d&&h){try{m=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(k){const P=Zh(k.name||k.code||k,k.message);if(P.code===L.PERMISSION_DENIED)throw P;S.warning("getUserMedia failed in getDevices",P)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(d){try{p=await navigator.mediaDevices.getUserMedia({audio:r})}catch(k){const P=Zh(k.name||k.code||k,k.message);if(P.code===L.PERMISSION_DENIED)throw P;S.warning("getUserMedia failed in getDevices",P)}this.isAccessMicrophonePermission=!0}else if(h){try{A=await navigator.mediaDevices.getUserMedia({video:t})}catch(k){const P=Zh(k.name||k.code||k,k.message);if(P.code===L.PERMISSION_DENIED)throw P;S.warning("getUserMedia failed in getDevices",P)}this.isAccessCameraPermission=!0}S.debug("[device manager] mic permission",r,"cam permission",t)}try{var E,v,C;const k=await navigator.mediaDevices.enumerateDevices();return p&&G(E=p.getTracks()).call(E,P=>P.stop()),A&&G(v=A.getTracks()).call(v,P=>P.stop()),m&&G(C=m.getTracks()).call(C,P=>P.stop()),p=null,A=null,m=null,k}catch(k){var b,y,w;return p&&G(b=p.getTracks()).call(b,P=>P.stop()),A&&G(y=A.getTracks()).call(y,P=>P.stop()),m&&G(w=m.getTracks()).call(w,P=>P.stop()),p=null,A=null,m=null,new M(L.ENUMERATE_DEVICES_FAILED,k.toString()).throw()}}async getRecordingDevices(r=!1){const t=await this.enumerateDevices(!0,!1,r);return kt(t).call(t,n=>n.kind==="audioinput")}async getCamerasDevices(r=!1){const t=await this.enumerateDevices(!1,!0,r);return kt(t).call(t,n=>n.kind==="videoinput")}async getSpeakers(r=!1){const t=await this.enumerateDevices(!0,!1,r);return kt(t).call(t,n=>n.kind==="audiooutput")}searchDeviceNameById(r){const t=this.deviceInfoMap.get(r);return t?t.device.label||t.device.deviceId:null}searchDeviceIdByName(r){var t;let n=null;return G(t=this.deviceInfoMap).call(t,s=>{s.device.label===r&&(n=s.device.deviceId)}),n}async getDeviceById(r){const t=await this.enumerateDevices(!0,!0,!0),n=_t(t).call(t,s=>s.deviceId===r);if(!n)throw new M(L.DEVICE_NOT_FOUND,"deviceId: ".concat(r));return n}async init(){this.state=gc.INITING;try{await this.updateDevicesInfo(),this.state=gc.INITEND}catch(r){throw S.warning("Device Detection functionality cannot start properly.",r.toString()),this.state=gc.IDLE,!function(){return typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1"}()&&new M(L.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),r}}async updateDevicesInfo(){var r;const t=await this.enumerateDevices(!0,!0,!0),n=pt(),s=[];if(t[0]&&t[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const p=_t(t).call(t,m=>m.kind==="audioinput"&&m.deviceId==="default"),A=_t(t).call(t,m=>m.kind==="audiooutput"&&m.deviceId==="default");if(p&&A)if(A.groupId===p.groupId){var c;S.debug(O(c="[device-check] default input ".concat(p.label," and output ")).call(c,A.label," is the same group"))}else{var d;S.warning(O(d="[device-check] default input ".concat(p.label," and output ")).call(d,A.label," is not the same group"))}else S.debug("[device-check] default input or output not found")}const h=this.checkMediaDeviceInfoIsOk(t);if(G(t).call(t,p=>{if(!p.deviceId)return;const A=this.deviceInfoMap.get(p.deviceId);if((A?A.state:"INACTIVE")!=="ACTIVE"){const m={initAt:n,updateAt:n,device:p,state:"ACTIVE"};this.deviceInfoMap.set(p.deviceId,m),s.push(m)}A&&(A.updateAt=n)}),G(r=this.deviceInfoMap).call(r,(p,A)=>{p.state==="ACTIVE"&&p.updateAt!==n&&(p.state="INACTIVE",s.push(p))}),this.state!==gc.INITEND)return h.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(h.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));G(s).call(s,p=>{switch(p.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(sa.RECORDING_DEVICE_CHANGED,p);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(sa.CAMERA_DEVICE_CHANGED,p);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(sa.PLAYOUT_DEVICE_CHANGED,p)}}),h.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),h.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(r){const t=kt(r).call(r,c=>c.kind==="audioinput"),n=kt(r).call(r,c=>c.kind==="videoinput"),s={audio:!1,video:!1};for(const c of t)if(c.label&&c.deviceId){s.audio=!0;break}for(const c of n)if(c.label&&c.deviceId){s.video=!0;break}return s}},sS=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended"],Yr=new class{constructor(){this.elementMap=new re,this.elementStateMap=new re,this.elementsNeedToResume=[],this.sinkIdMap=new re,this.autoResumeAfterInterruption=()=>{var r,t;G(r=Fe(rn(t=this.elementMap).call(t))).call(r,([n,s])=>{const c=this.elementStateMap.get(n),d=s.srcObject.getAudioTracks()[0];ia()?d&&d.readyState==="live"&&ue.curState==="running"&&(S.debug("auto resume after interruption for iOS 15"),s.pause(),s.play()):c&&c==="paused"&&d&&d.readyState==="live"&&ue.curState==="running"&&(S.debug("auto resume after interruption for iOS"),s.play())})},this.autoResumeAfterInterruptionOnIOS15=()=>{var r,t;G(r=Fe(rn(t=this.elementMap).call(t))).call(r,([n,s])=>{const c=s.srcObject.getAudioTracks()[0];c&&c.readyState==="live"&&(S.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),s.pause(),s.play())})},this.autoResumeAudioElement(),ue.on(Lr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),ue.on(Lr.IOS_15_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15),ue.on(Lr.STATE_CHANGE,()=>{vi()&&ue.prevState==="suspended"&&ue.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(r,t){const n=this.elementMap.get(r);if(this.sinkIdMap.set(r,t),n)try{await n.setSinkId(t)}catch(s){throw new M(L.PERMISSION_DENIED,"can not set sink id: "+s.toString())}}play(r,t,n,s){if(this.elementMap.has(t))return;const c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([r]),this.bindAudioElementEvents(t,c),this.elementMap.set(t,c),this.elementStateMap.set(t,Gn.INIT),this.setVolume(t,n);const d=this.sinkIdMap.get(t);if(d)try{c.setSinkId(d).catch(p=>{S.warning("[".concat(t,"] set sink id failed"),p.toString())})}catch(p){S.warning("[".concat(t,"] set sink id failed"),p.toString())}const h=c.play();h&&h.then&&h.catch(p=>{s&&gt.autoplayFailed(s,"audio",p.message,t),S.warning("audio element play warning",p.toString()),this.elementMap.has(t)&&p.name==="NotAllowedError"&&(S.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),on(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),XC()}))})}updateTrack(r,t){const n=this.elementMap.get(r);n&&(n.srcObject=new MediaStream([t]))}isPlaying(r){return this.elementMap.has(r)}setVolume(r,t){const n=this.elementMap.get(r);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}stop(r){var t,n;const s=this.elementMap.get(r);if(this.sinkIdMap.delete(r),!s)return;const c=Ft(t=this.elementsNeedToResume).call(t,s);Ye(n=this.elementsNeedToResume).call(n,c,1),s.srcObject=null,s.remove(),this.elementMap.delete(r),this.elementStateMap.delete(r)}bindAudioElementEvents(r,t){G(sS).call(sS,n=>{t.addEventListener(n,s=>{var c,d;const h=this.elementStateMap.get(r),p=s.type==="pause"?"paused":s.type;S.debug(O(c=O(d="[".concat(r,"] audio-element-status change ")).call(d,h," => ")).call(c,p)),this.elementStateMap.set(r,p)})})}getPlayerState(r){return this.elementStateMap.get(r)||"uninit"}autoResumeAudioElement(){const r=()=>{var t;G(t=this.elementsNeedToResume).call(t,n=>{n.play().then(s=>{S.debug("Auto resume audio element success")}).catch(s=>{S.warning("Auto resume audio element failed!",s)})}),this.elementsNeedToResume=[]};new dt(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{const t=we();t.os!=="Android"||t.name!=="Chrome"&&t.name!==Re.WECHAT?(document.body.addEventListener("touchstart",r,!0),document.body.addEventListener("mousedown",r,!0)):document.body.addEventListener("click",r,!0)})}};function Br(){return function(r,t,n){const s=r[t];typeof s=="function"&&(n.value=function(...c){this._isClosed&&new M(L.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning");const d=s.apply(this,c);return d instanceof dt?new dt((h,p)=>{d.then(h).catch(p)}):d})}}function aS(r,t){var n=le(r);if(ee){var s=ee(r);t&&(s=kt(s).call(s,function(c){return Wt(r,c).enumerable})),n.push.apply(n,s)}return n}function $h(r){for(var t=1;t<arguments.length;t++){var n,s=arguments[t]!=null?arguments[t]:{};if(t%2)G(n=aS(Object(s),!0)).call(n,function(d){_r(r,d,s[d])});else if(te)He(r,te(s));else{var c;G(c=aS(Object(s))).call(c,function(d){se(r,d,Wt(s,d))})}}return r}var ro=function(r,t,n,s){var c,d=arguments.length,h=d<3?t:s===null?s=Wt(t,n):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(r,t,n,s);else for(var p=r.length-1;p>=0;p--)(c=r[p])&&(h=(d<3?c(h):d>3?c(t,n,h):c(t,n))||h);return d>3&&h&&se(t,n,h),h},De=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)};class qr extends la{constructor(t,n,s){super(t,s),this.trackMediaType="audio",this._enabled=!0,this._volume=100,this._useAudioElement=!1,this._bypassWebAudio=!1,this._encoderConfig=n,this._source=new zh(t)}get isPlaying(){return this._useAudioElement?Yr.isPlaying(this.getTrackId()):this._source.isPlayed}setVolume(t){Ie(t,"volume",0,1e3);const n=gt.reportApiInvoke(null,{tag:Yt.TRACER,name:Kt.LOCAL_AUDIO_TRACK_SET_VOLUME,options:[this.getTrackId(),t]},300);this._volume=t,this._source.setVolume(t/100),this._useAudioElement&&Yr.setVolume(this.getTrackId(),t);try{if(this._bypassWebAudio)return S.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio.")),void n.onSuccess();const s=this._source.createOutputTrack();this._mediaStreamTrack!==s&&(this._mediaStreamTrack=s,Xe(this,Jt.NEED_REPLACE_TRACK,this).then(()=>{S.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(c=>{S.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),c)}))}catch{}n.onSuccess()}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}async setPlaybackDevice(t){const n=gt.reportApiInvoke(null,{tag:Yt.TRACER,name:Kt.REMOTE_AUDIO_SET_OUTPUT_DEVICE,options:[this.getTrackId(),t]});if(!this._useAudioElement)throw new M(L.NOT_SUPPORTED,"your browser does not support setting the audio output device");try{await Yr.setSinkID(this.getTrackId(),t)}catch(s){throw n.onError(s),s}n.onSuccess()}async setEnabled(t,n,s){if(!s){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(S.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){this._originMediaStreamTrack.enabled=!0;try{var c;s||(this._enabled=!0),await Xe(this,Jt.NEED_ENABLE_TRACK,this),S.info(O(c="[".concat(this.getTrackId(),"] setEnabled to ")).call(c,t," success"))}catch(d){throw s||(this._enabled=!1),S.error("[".concat(this.getTrackId(),"] setEnabled to true error"),d.toString()),d}}else{this._originMediaStreamTrack.enabled=!1,s||(this._enabled=!1);try{await Xe(this,Jt.NEED_DISABLE_TRACK,this)}catch(d){throw s||(this._enabled=!0),S.error("[".concat(this.getTrackId(),"] setEnabled to false error"),d.toString()),d}}}async setMuted(t){var n;t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._mediaStreamTrack.enabled=!t,S.debug(O(n="[".concat(this.getTrackId(),"] start set muted: ")).call(n,t)),t?await Xe(this,Jt.NEED_MUTE_TRACK,this):await Xe(this,Jt.NEED_UNMUTE_TRACK,this))}getStats(){return ks(()=>{S.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Io(this,Jt.GET_STATS)||$h({},Bd)}setAudioFrameCallback(t,n=4096){if(!t)return this._source.removeAllListeners(Bo.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(n),this._source.removeAllListeners(Bo.ON_AUDIO_BUFFER),this._source.on(Bo.ON_AUDIO_BUFFER,s=>t(s))}play(){const t=gt.reportApiInvoke(null,{tag:Yt.TRACER,name:Kt.LOCAL_AUDIO_TRACK_PLAY,options:[this.getTrackId()]});S.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(S.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Yr.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play(),t.onSuccess()}stop(){const t=gt.reportApiInvoke(null,{tag:Yt.TRACER,name:Kt.LOCAL_AUDIO_TRACK_STOP,options:[this.getTrackId()]});S.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Yr.stop(this.getTrackId()):this._source.stop(),t.onSuccess()}close(){super.close(),this._source.destroy()}_updatePlayerSource(){S.debug("[".concat(this.getTrackId(),"] update player source track")),this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Yr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(t,n){this._originMediaStreamTrack!==t&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t.addEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop(),this._originMediaStreamTrack=t,this._source.updateTrack(this._originMediaStreamTrack),this._mediaStreamTrack!==this._source.outputTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Xe(this,Jt.NEED_REPLACE_TRACK,this)))}renewMediaStreamTrack(){return dt.resolve(void 0)}}ro([Br(),De("design:type",Function),De("design:paramtypes",[String]),De("design:returntype",dt)],qr.prototype,"setPlaybackDevice",null),ro([gl("LocalAudioTrack","_enabledMutex"),Br(),De("design:type",Function),De("design:paramtypes",[Boolean,Object,Boolean]),De("design:returntype",dt)],qr.prototype,"setEnabled",null),ro([gl("LocalAudioTrack","_enabledMutex"),Br(),qh({report:gt}),De("design:type",Function),De("design:paramtypes",[Boolean]),De("design:returntype",dt)],qr.prototype,"setMuted",null),ro([Br(),De("design:type",Function),De("design:paramtypes",[]),De("design:returntype",Object)],qr.prototype,"getStats",null),ro([Br(),De("design:type",Function),De("design:paramtypes",[Object,Number]),De("design:returntype",void 0)],qr.prototype,"setAudioFrameCallback",null),ro([Br(),De("design:type",Function),De("design:paramtypes",[]),De("design:returntype",void 0)],qr.prototype,"play",null),ro([Br(),De("design:type",Function),De("design:paramtypes",[]),De("design:returntype",void 0)],qr.prototype,"stop",null);class jd extends qr{constructor(t,n,s,c){super(t,n.encoderConfig?fc(n.encoderConfig):{},c),this._deviceName="default",this._enabled=!0,this._config=n,this._constraints=s,this._deviceName=t.label,typeof n.bypassWebAudio=="boolean"&&(this._bypassWebAudio=n.bypassWebAudio),ia()&&ue.bindInterruptDetectorTrack(this)}async setDevice(t){var n,s;const c=gt.reportApiInvoke(null,{tag:Yt.TRACER,name:Kt.MIC_AUDIO_TRACK_SET_DEVICE,options:[this.getTrackId(),t]});if(S.info(O(n="[".concat(this.getTrackId(),"] start set device to ")).call(n,t)),this._enabled)try{const d=await gn.getDeviceById(t),h={};h.audio=$h({},this._constraints),h.audio.deviceId={exact:t},this._originMediaStreamTrack.stop();let p=null;try{p=await nn(h,this.getTrackId())}catch(A){throw S.error("[".concat(this.getTrackId(),"] setDevice failed"),A.toString()),p=await nn({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(p.getAudioTracks()[0],!1),A}await this._updateOriginMediaStreamTrack(p.getAudioTracks()[0],!1),this._deviceName=d.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(d){throw c.onError(d),S.error("[".concat(this.getTrackId(),"] setDevice error"),d.toString()),d}else try{const d=await gn.getDeviceById(t);this._deviceName=d.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(d){throw c.onError(d),S.error("[".concat(this.getTrackId(),"] setDevice error"),d.toString()),d}c.onSuccess(),S.info(O(s="[".concat(this.getTrackId(),"] set device to ")).call(s,t," success"))}async setEnabled(t,n,s){if(n)return S.debug("[".concat(this.getTrackId,"] setEnabled false (do not close microphone)")),await super.setEnabled(t);if(!s){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(S.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),s||(this._enabled=!1);try{await Xe(this,Jt.NEED_DISABLE_TRACK,this)}catch(h){throw S.error("[".concat(this.getTrackId(),"] setEnabled false failed"),h.toString()),h}return}const c=$h({},this._constraints),d=gn.searchDeviceIdByName(this._deviceName);d&&!c.deviceId&&(c.deviceId=d);try{s||(this._enabled=!0);const h=await nn({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),await Xe(this,Jt.NEED_ENABLE_TRACK,this)}catch(h){throw s||(this._enabled=!1),S.error("[".concat(this.getTrackId(),"] setEnabled true failed"),h.toString()),h}S.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),ia()&&ue.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((vi()||as())&&this._enabled&&!this._isClosed&&ue.duringInterruption){const t=async()=>{ue.off(Lr.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(S.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};ue.on(Lr.IOS_INTERRUPTION_END,t)}else S.debug("[".concat(this.getTrackId(),"] track ended")),this.emit(aa.TRACK_ENDED)}async renewMediaStreamTrack(){const t=$h({},this._constraints),n=gn.searchDeviceIdByName(this._deviceName);n&&!t.deviceId&&(t.deviceId=n);const s=await nn({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!0)}}ro([Br(),De("design:type",Function),De("design:paramtypes",[String]),De("design:returntype",dt)],jd.prototype,"setDevice",null),ro([gl("MicrophoneAudioTrack","_enabledMutex"),Br(),De("design:type",Function),De("design:paramtypes",[Boolean,Boolean,Boolean]),De("design:returntype",dt)],jd.prototype,"setEnabled",null);class _l extends qr{constructor(t,n,s,c){super(n.createOutputTrack(),s,c),this.source=t,this._bufferSource=n,this._bufferSource.on(Bo.AUDIO_SOURCE_STATE_CHANGE,d=>{this.emit(aa.SOURCE_STATE_CHANGE,d)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(t){const n=gt.reportApiInvoke(null,{tag:Yt.TRACER,name:Kt.BUFFER_AUDIO_TRACK_START,options:[this.getTrackId(),t,this.duration]});t&&this._bufferSource.updateOptions(t),this._bufferSource.startProcessAudioBuffer(),n.onSuccess()}pauseProcessAudioBuffer(){const t=gt.reportApiInvoke(null,{tag:Yt.TRACER,name:Kt.BUFFER_AUDIO_TRACK_PAUSE,options:[this.getTrackId()]});this._bufferSource.pauseProcessAudioBuffer(),t.onSuccess()}seekAudioBuffer(t){const n=gt.reportApiInvoke(null,{tag:Yt.TRACER,name:Kt.BUFFER_AUDIO_TRACK_SEEK,options:[this.getTrackId()]});this._bufferSource.seekAudioBuffer(t),n.onSuccess()}resumeProcessAudioBuffer(){const t=gt.reportApiInvoke(null,{tag:Yt.TRACER,name:Kt.BUFFER_AUDIO_TRACK_RESUME,options:[this.getTrackId()]});this._bufferSource.resumeProcessAudioBuffer(),t.onSuccess()}stopProcessAudioBuffer(){const t=gt.reportApiInvoke(null,{tag:Yt.TRACER,name:Kt.BUFFER_AUDIO_TRACK_STOP,options:[this.getTrackId()]});this._bufferSource.stopProcessAudioBuffer(),t.onSuccess()}}ro([Br(),De("design:type",Function),De("design:paramtypes",[Object]),De("design:returntype",void 0)],_l.prototype,"startProcessAudioBuffer",null),ro([Br(),De("design:type",Function),De("design:paramtypes",[]),De("design:returntype",void 0)],_l.prototype,"pauseProcessAudioBuffer",null),ro([Br(),De("design:type",Function),De("design:paramtypes",[Number]),De("design:returntype",void 0)],_l.prototype,"seekAudioBuffer",null),ro([Br(),De("design:type",Function),De("design:paramtypes",[]),De("design:returntype",void 0)],_l.prototype,"resumeProcessAudioBuffer",null),ro([Br(),De("design:type",Function),De("design:paramtypes",[]),De("design:returntype",void 0)],_l.prototype,"stopProcessAudioBuffer",null);class _o extends qr{constructor(){const t=ml().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,Le(8,"track-mix-"));try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}hasAudioTrack(t){var n;return Ft(n=this.trackList).call(n,t)!==-1}addAudioTrack(t){var n;Ft(n=this.trackList).call(n,t)===-1?(S.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):S.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){var n;if(Ft(n=this.trackList).call(n,t)!==-1){S.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}da(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){var t;const n={};G(t=this.trackList).call(t,s=>{s._encoderConfig&&((s._encoderConfig.bitrate||0)>(n.bitrate||0)&&(n.bitrate=s._encoderConfig.bitrate),(s._encoderConfig.sampleRate||0)>(n.sampleRate||0)&&(n.sampleRate=s._encoderConfig.sampleRate),(s._encoderConfig.sampleSize||0)>(n.sampleSize||0)&&(n.sampleSize=s._encoderConfig.sampleSize),s._encoderConfig.stereo&&(n.stereo=!0))}),this._encoderConfig=n}}class Ck extends Hr{constructor(){super(...arguments),this.resultStorage=new re}setLocalAudioStats(t,n,s){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(s,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(s,n))}setLocalVideoStats(t,n,s){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(s,n)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(s,n)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(s))}setRemoteAudioStats(t,n){const s=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",s,this.checkAudioOutputLevel(n))}setRemoteVideoStats(t,n){const s=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",s,this.checkVideoDecode(n))}record(t,n,s){this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const c=this.resultStorage.get(t);if(c&&(c.result.push(s),c.result.length>=5)){var d;const h=zt(d=c.result).call(d,!0);c.isPrevNormal&&!h&&this.emit("exception",cS[t],t,n),!c.isPrevNormal&&h&&this.emit("exception",cS[t]+2e3,t+"_RECOVER",n),c.isPrevNormal=h,c.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,n){return n instanceof _o&&!n.isActive||!!n.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,n){let s=null;n._encoderConfig&&n._encoderConfig.frameRate&&(s=Qa(n._encoderConfig.frameRate));const c=t.captureFrameRate;return!s||!c||!(s>10&&c<5||s<10&&s>=5&&c<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checkSendVideoBitrate(t,n){return!!n.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,n){return n instanceof _o&&!n.isActive||!!n.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}const cS={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},vo=new class{markSubscribeStart(r,t){var n;performance.mark(O(n="agora-web-sdk/".concat(r,"/subscribe-")).call(n,t))}markPublishStart(r,t){var n;performance.mark(O(n="agora-web-sdk/".concat(r,"/publish-")).call(n,t))}measureFromSubscribeStart(r,t){var n;const s=performance.getEntriesByName(O(n="agora-web-sdk/".concat(r,"/subscribe-")).call(n,t));if(s.length>0){const c=s[s.length-1];return performance.now()-c.startTime}return 0}measureFromPublishStart(r,t){var n;const s=performance.getEntriesByName(O(n="agora-web-sdk/".concat(r,"/publish-")).call(n,t));if(s.length>0){const c=s[s.length-1];return Math.round(performance.now()-c.startTime)}return 0}};function lS(r,t){var n=le(r);if(ee){var s=ee(r);t&&(s=kt(s).call(s,function(c){return Wt(r,c).enumerable})),n.push.apply(n,s)}return n}function _c(r){for(var t=1;t<arguments.length;t++){var n,s=arguments[t]!=null?arguments[t]:{};if(t%2)G(n=lS(Object(s),!0)).call(n,function(d){_r(r,d,s[d])});else if(te)He(r,te(s));else{var c;G(c=lS(Object(s))).call(c,function(d){se(r,d,Wt(s,d))})}}return r}class vl{constructor(t){this.localStats=new re,this.remoteStats=new re,this.trafficStatsPeerList=[],this.updateStats=()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))},this.store=t,this.updateStatsInterval=window.setInterval(this.updateStats,1e3),this.exceptionMonitor=new Ck,this.exceptionMonitor.on("exception",(n,s,c)=>{this.onStatsException&&this.onStatsException(n,s,c)})}reset(){this.localStats=new re,this.remoteStats=new re,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(xt.LocalAudioTrack)||_c({},Bd)}getLocalVideoTrackStats(){return this.localStats.get(xt.LocalVideoTrack)||_c({},Ud)}getRemoteAudioTrackStats(t){const n=(p,A)=>{var m;if(!this.trafficStats)return A;const E=_t(m=this.trafficStats.peer_delay).call(m,v=>v.peer_uid===p);return E&&(A.publishDuration=E.B_ppad+(pt()-this.trafficStats.timestamp)),A},s={};if(t){var c;const p=(c=this.remoteStats.get(t))===null||c===void 0?void 0:c.audioStats;p&&(s[t]=n(t,p))}else{var d,h;G(d=Fe(rn(h=this.remoteStats).call(h))).call(d,([p,{audioStats:A}])=>{A&&(s[p]=n(p,A))})}return s}getRemoteNetworkQualityStats(t){const n={};if(t){var s;const h=(s=this.remoteStats.get(t))===null||s===void 0?void 0:s.networkStats;h&&(n[t]=h)}else{var c,d;G(c=Fe(rn(d=this.remoteStats).call(d))).call(c,([h,{networkStats:p}])=>{p&&(n[h]=p)})}return n}getRemoteVideoTrackStats(t){const n=(p,A)=>{var m;if(!this.trafficStats)return A;const E=_t(m=this.trafficStats.peer_delay).call(m,v=>v.peer_uid===p);return E&&(A.publishDuration=E.B_ppvd+(pt()-this.trafficStats.timestamp)),A},s={};if(t){var c;const p=(c=this.remoteStats.get(t))===null||c===void 0?void 0:c.videoStats;p&&(s[t]=n(t,p))}else{var d,h;G(d=Fe(rn(h=this.remoteStats).call(h))).call(d,([p,{videoStats:A}])=>{A&&(s[p]=n(p,A))})}return s}getRTCStats(){var t;let n=0,s=0,c=0,d=0;const h=this.localStats.get(xt.LocalAudioTrack);h&&(n+=h.sendBytes,s+=h.sendBitrate);const p=this.localStats.get(xt.LocalVideoTrack);p&&(n+=p.sendBytes,s+=p.sendBitrate);const A=this.localStats.get(xt.LocalVideoLowTrack);A&&(n+=A.sendBytes,s+=A.sendBitrate),G(t=this.remoteStats).call(t,({audioStats:E,videoStats:v})=>{E&&(c+=E.receiveBytes,d+=E.receiveBitrate),v&&(c+=v.receiveBytes,d+=v.receiveBitrate)});let m=1;return this.trafficStats&&(m+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:m,SendBitrate:s,SendBytes:n,RecvBytes:c,RecvBitrate:d,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){var n;const s=kt(n=t.peer_delay).call(n,c=>{var d;return Ft(d=this.trafficStatsPeerList).call(d,c.peer_uid)===-1});G(s).call(s,c=>{var d;const h=(d=this.p2pChannel)===null||d===void 0?void 0:d.getRemoteMedia(c.peer_uid),p=h!=null&&h.videoSSRC?vo.measureFromSubscribeStart(this.store.clientId,h.videoSSRC):0,A=h!=null&&h.audioSSRC?vo.measureFromSubscribeStart(this.store.clientId,h.audioSSRC):0;c.B_ppad!==void 0&&c.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(c.peer_uid,c.B_ppad,c.B_ppvd,p>A?p:A),this.trafficStatsPeerList.push(c.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){var n;this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&S.debug(O(n="[".concat(this.store.clientId,"]: Period fir changes to ")).call(n,t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,n,s){if(!t)return!1;const c=!!s&&n.framesDecodeFreezeTime>s.framesDecodeFreezeTime,d=!s||n.framesDecodeCount>s.framesDecodeCount;return c||!d}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){var n,s;G(n=Fe(rn(s=this.localStats).call(s))).call(n,([c,d])=>{switch(c){case xt.LocalVideoTrack:case xt.LocalVideoLowTrack:{const A=d,m=_c({},Ud),E=t.getStats(),v=t.getLocalMedia(c);if(E){var h;const C=_t(h=E.videoSend).call(h,b=>b.ssrc===(v==null?void 0:v.ssrcs[0].ssrcId));if(C){const b=t.getLocalVideoSize(),y=t.getEncoderConfig(xt.LocalVideoTrack);C.codec!=="H264"&&C.codec!=="VP8"&&C.codec!=="VP9"&&C.codec!=="AV1X"||(m.codecType=C.codec),m.sendBytes=C.bytes,m.sendBitrate=A?8*Math.max(0,m.sendBytes-A.sendBytes):0,C.inputFrame?(m.captureFrameRate=C.inputFrame.frameRate,m.captureResolutionHeight=C.inputFrame.height,m.captureResolutionWidth=C.inputFrame.width):b&&(m.captureResolutionWidth=b.width,m.captureResolutionHeight=b.height),C.sentFrame?(m.sendFrameRate=C.sentFrame.frameRate,m.sendResolutionHeight=C.sentFrame.height,m.sendResolutionWidth=C.sentFrame.width):b&&(m.sendResolutionWidth=b.width,m.sendResolutionHeight=b.height),C.avgEncodeMs&&(m.encodeDelay=C.avgEncodeMs),y&&y.bitrateMax&&(m.targetSendBitrate=1e3*y.bitrateMax),m.sendPackets=C.packets,m.sendPacketsLost=C.packetsLost,m.totalDuration=A?A.totalDuration+1:1,m.totalFreezeTime=A?A.totalFreezeTime:0,this.isLocalVideoFreeze(C)&&(m.totalFreezeTime+=1)}this.trafficStats&&(m.sendPacketsLost=this.trafficStats.B_pvlr4/100)}this.localStats.set(c,m),m&&v&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,v.track,m);break}case xt.LocalAudioTrack:{const A=d,m=_c({},Bd),E=t.getStats(),v=t.getLocalMedia(c);if(E){var p;const C=_t(p=E.audioSend).call(p,b=>b.ssrc===(v==null?void 0:v.ssrcs[0].ssrcId));if(C){if(C.codec!=="opus"&&C.codec!=="aac"||(m.codecType=C.codec),C.inputLevel)m.sendVolumeLevel=Math.round(32767*C.inputLevel);else{const b=t.getLocalAudioVolume();b&&(m.sendVolumeLevel=Math.round(32767*b))}m.sendBytes=C.bytes,m.sendPackets=C.packets,m.sendPacketsLost=C.packetsLost,m.sendBitrate=A?8*Math.max(0,m.sendBytes-A.sendBytes):0}}this.trafficStats&&(m.sendPacketsLost=this.trafficStats.B_pvlr4/100),this.localStats.set(xt.LocalAudioTrack,m),m&&v&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,v.track,m);break}}})}updateRemoteStats(t){var n,s;G(n=Fe(rn(s=this.remoteStats).call(s))).call(n,([c,{videoStats:d,audioStats:h,videoPcStats:p}])=>{var A,m,E;const v=h,C=d,b=p,y=_c({},Vh),w=_c({},Gh),k=_c({},WA),{audioTrack:P,videoTrack:V,audioSSRC:j,videoSSRC:st}=t.getRemoteMedia(c),mt=t.getStats(),Et=mt==null?void 0:_t(A=mt.audioRecv).call(A,rt=>rt.ssrc===j),At=mt==null?void 0:_t(m=mt.videoRecv).call(m,rt=>rt.ssrc===st),$=this.trafficStats&&_t(E=this.trafficStats.peer_delay).call(E,rt=>rt.peer_uid===c);if(Et&&(Et.codec!=="opus"&&Et.codec!=="aac"||(y.codecType=Et.codec),Et.outputLevel?y.receiveLevel=Math.round(32767*Et.outputLevel):P&&(y.receiveLevel=Math.round(32767*P.getVolumeLevel())),y.receiveBytes=Et.bytes,y.receivePackets=Et.packets,y.receivePacketsLost=Et.packetsLost,y.packetLossRate=y.receivePacketsLost/(y.receivePackets+y.receivePacketsLost),y.receiveBitrate=v?8*Math.max(0,y.receiveBytes-v.receiveBytes):0,y.totalDuration=v?v.totalDuration+1:1,y.totalFreezeTime=v?v.totalFreezeTime:0,y.freezeRate=y.totalFreezeTime/y.totalDuration,y.receiveDelay=Et.jitterBufferMs,y.totalDuration>10&&vl.isRemoteAudioFreeze(P)&&(y.totalFreezeTime+=1)),At){At.codec!=="H264"&&At.codec!=="VP8"&&At.codec!=="VP9"&&At.codec!=="AV1X"||(w.codecType=At.codec),w.receiveBytes=At.bytes,w.receiveBitrate=C?8*Math.max(0,w.receiveBytes-C.receiveBytes):0,w.decodeFrameRate=At.decodeFrameRate<0?0:At.decodeFrameRate,w.renderFrameRate=At.decodeFrameRate<0?0:At.decodeFrameRate,At.outputFrame&&(w.renderFrameRate=At.outputFrame.frameRate),At.receivedFrame?(w.receiveFrameRate=At.receivedFrame.frameRate,w.receiveResolutionHeight=At.receivedFrame.height,w.receiveResolutionWidth=At.receivedFrame.width):V&&(w.receiveResolutionHeight=V._videoHeight||0,w.receiveResolutionWidth=V._videoWidth||0),At.framesRateFirefox!==void 0&&(w.receiveFrameRate=Math.round(At.framesRateFirefox)),w.receivePackets=At.packets,w.receivePacketsLost=At.packetsLost,w.packetLossRate=w.receivePacketsLost/(w.receivePackets+w.receivePacketsLost),w.totalDuration=C?C.totalDuration+1:1,w.totalFreezeTime=C?C.totalFreezeTime:0,w.receiveDelay=At.jitterBufferMs||0;const rt=!!st&&t.getRemoteVideoIsReady(st);V&&rt&&vl.isRemoteVideoFreeze(V,At,b)&&(w.totalFreezeTime+=1),w.freezeRate=w.totalFreezeTime/w.totalDuration}$&&(y.end2EndDelay=$.B_ad,w.end2EndDelay=$.B_vd,y.transportDelay=$.B_ed,w.transportDelay=$.B_ed,y.currentPacketLossRate=$.B_ealr4/100,w.currentPacketLossRate=$.B_evlr4/100,k.uplinkNetworkQuality=$.B_punq?$.B_punq:0,k.downlinkNetworkQuality=$.B_pdnq?$.B_pdnq:0),this.remoteStats.set(c,{audioStats:y,videoStats:w,videoPcStats:At,networkStats:k}),P&&this.exceptionMonitor.setRemoteAudioStats(P,y),V&&this.exceptionMonitor.setRemoteVideoStats(V,w)})}}var Sk="".repeat||function(r){var t=String(nt(this)),n="",s=fo(r);if(s<0||s==1/0)throw RangeError("Wrong number of repetitions");for(;s>0;(s>>>=1)&&(t+=t))1&s&&(n+=t);return n},yk=Math.ceil,dS=function(r){return function(t,n,s){var c,d,h=String(nt(t)),p=h.length,A=s===void 0?" ":String(s),m=Ln(n);return m<=p||A==""?h:(c=m-p,(d=Sk.call(A,yk(c/A.length))).length>c&&(d=d.slice(0,c)),r?h+d:d+h)}},Tk={start:dS(!1),end:dS(!0)},Rk=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(Jc),wk=Tk.start;qt({target:"String",proto:!0,forced:Rk},{padStart:function(r){return wk(this,r,arguments.length>1?arguments[1]:void 0)}});var bk=Zr("String").padStart,uS=String.prototype,Nk=function(r){var t=r.padStart;return typeof r=="string"||r===uS||r instanceof String&&t===uS.padStart?bk:t};function hS(r){return new TextEncoder().encode(r)}const pS=async r=>{const t=Wd(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),n=await window.crypto.subtle.importKey("spki",t,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),s=hS(r),c=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},n,s);return vc(new Uint8Array(c))},Ok=async r=>function(t,n){let s="";const c=new Uint8Array(t);return G(c).call(c,d=>{var h;s+=Nk(h=d.toString(n)).call(h,2,"0")}),s}(await crypto.subtle.digest("SHA-256",hS(r)),16);function fS(r,t){var n=le(r);if(ee){var s=ee(r);t&&(s=kt(s).call(s,function(c){return Wt(r,c).enumerable})),n.push.apply(n,s)}return n}function AS(r){for(var t=1;t<arguments.length;t++){var n,s=arguments[t]!=null?arguments[t]:{};if(t%2)G(n=fS(Object(s),!0)).call(n,function(d){_r(r,d,s[d])});else if(te)He(r,te(s));else{var c;G(c=fS(Object(s))).call(c,function(d){se(r,d,Wt(s,d))})}}return r}function kk(r){if(!r.address||!r.tcp)throw new M(L.UNEXPECTED_RESPONSE,"Invalid address format ".concat(r));return r.address.match(/^[\.\:\d]+$/)?"".concat(r.address.replace(/[^\d]/g,"-"),".edge.agora.io"):(S.info("Cannot recognized as IP address ".concat(r.address,". Used As Host instead")),O(t="".concat(r.address,":")).call(t,r.tcp));var t}function gS(r){var t;return r.match(/^[\.\:\d]+$/)?O(t="".concat(r.replace(/[^\d]/g,"-"),".")).call(t,ot("TURN_DOMAIN")):(S.info("Cannot recognized as IP address ".concat(r,". Used As Host instead")),r)}function mS(r,t){var n;const s=ot("GATEWAY_DOMAINS");let c=s[1]&&Ft(t).call(t,s[1])!==-1?1:0;return r.addresses=r.addresses||[],{gatewayAddrs:ft(n=r.addresses).call(n,d=>{var h,p,A;return d.ip.match(/^[\.\:\d]+$/)?O(h=O(p="".concat(d.ip.replace(/[^\d]/g,"-"),".")).call(p,s[c++%s.length],":")).call(h,d.port):(S.info("Cannot recognized as IP address ".concat(d.ip,". Used As Host instead")),O(A="".concat(d.ip,":")).call(A,d.port))}),uid:r.uid,cid:r.cid,vid:r.detail&&r.detail[8],uni_lbs_ip:r.detail&&r.detail[1],res:r,csIp:r.detail&&r.detail[502]}}function Qa(r){return typeof r=="number"?r:r.exact||r.ideal||r.max||r.min||0}function ES(r){var t;const n=r._encoderConfig;if(!n)return{};const s={resolution:n.width&&n.height?O(t="".concat(Qa(n.width),"x")).call(t,Qa(n.height)):void 0,maxVideoBW:n.bitrateMax,minVideoBW:n.bitrateMin};return typeof n.frameRate=="number"?(s.maxFrameRate=n.frameRate,s.minFrameRate=n.frameRate):n.frameRate&&(s.maxFrameRate=n.frameRate.max||n.frameRate.ideal||n.frameRate.exact||n.frameRate.min,s.minFrameRate=n.frameRate.min||n.frameRate.ideal||n.frameRate.exact||n.frameRate.max),s}function _S(r,t,n){var s,c,d;const h=_t(s=t.videoSend).call(s,m=>m.ssrc===r);if(!h)return null;const p=n==null||(c=_t(d=n.videoSend).call(d,m=>m.ssrc===r))===null||c===void 0?void 0:c.inputFrame,A={id:Le(10,""),timestamp:new Date(t.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:h.ssrc.toString()};return h.inputFrame&&(p&&h.inputFrame.height===p.height||(A.A_fhi=h.inputFrame.height?h.inputFrame.height.toString():"0"),p&&h.inputFrame.width===p.width||(A.A_fwi=h.inputFrame.width?h.inputFrame.width.toString():"0"),p&&h.inputFrame.frameRate===p.frameRate||(A.A_fri=h.inputFrame.frameRate?h.inputFrame.frameRate.toString():"0")),A}function vS(r){return r>=0&&r<.17?1:r>=.17&&r<.36?2:r>=.36&&r<.59?3:r>=.59&&r<=1?4:r>1?5:0}function cg(r,t){var n;let s,c,d;switch(t){case ai.CHOOSE_SERVER:s=4096,c="choose server";break;case ai.CLOUD_PROXY:s=1048576,c="proxy";break;case ai.CLOUD_PROXY_5:s=4194304,c="proxy5";break;default:throw new M(L.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:r.detail&&r.detail[502],retry:!1})}if(G(n=r.response_body).call(n,h=>{var p;h.buffer&&h.buffer.flag===s&&(d={code:h.buffer.code,addresses:ft(p=h.buffer.edges_services).call(p,A=>AS({},A,{ticket:h.buffer.cert})),server_ts:r.enter_ts,uid:h.buffer.uid,cid:h.buffer.cid,cname:h.buffer.cname,detail:AS({},h.buffer.detail,{},r.detail),flag:h.buffer.flag,opid:r.opid})}),!d)throw new M(L.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:r.detail&&r.detail[502]});return d}async function Dk(r,t){var n;return await dt.all(ft(n=r.addresses).call(n,async s=>({address:s.ip,tcpport:s.port,udpport:s.port,username:t?t.toString():qe.username,password:t?await Ok(t.toString()):qe.password})))}function Lk(r,t){const n=t._videoHeight||t.getMediaStreamTrack(!0).getSettings().height;return n?n/Qa(r.height):4}var IS;function CS(r,t){var n=le(r);if(ee){var s=ee(r);t&&(s=kt(s).call(s,function(c){return Wt(r,c).enumerable})),n.push.apply(n,s)}return n}function lg(r){for(var t=1;t<arguments.length;t++){var n,s=arguments[t]!=null?arguments[t]:{};if(t%2)G(n=CS(Object(s),!0)).call(n,function(d){_r(r,d,s[d])});else if(te)He(r,te(s));else{var c;G(c=CS(Object(s))).call(c,function(d){se(r,d,Wt(s,d))})}}return r}function Il(r){return window.TextEncoder?new TextEncoder().encode(r).length:r.length}function SS(r,t,n){const s=r[t];if(!s||typeof s!="string")return[r];r[t]="";const c=Il(ht(r));let d=0;const h=[];let p=0;for(let A=0;A<s.length;A++)p+=s.charCodeAt(A)<=127?1:3,p<=n-c||(h[h.length]=lg({},r,{[t]:s.substring(d,A)}),d=A,p=s.charCodeAt(A)<=127?1:3);return d!==s.length-1&&(h[h.length]=lg({},r,{[t]:s.substring(d)})),h}function Ur(r){return new dt(t=>{window.setTimeout(t,r)})}function Mk(r){const t=new M(L.TIMEOUT,"timeout");return new dt((n,s)=>{window.setTimeout(()=>s(t),r)})}function yS(r,t){return t===1/0?r:dt.race([r,Mk(t)])}function Le(r=7,t){var n,s;const c=Math.random().toString(16).substr(2,r).toLowerCase();return c.length===r?O(n="".concat(t)).call(n,c):O(s="".concat(t)).call(s,c)+Le(r-c.length,"")}function tp(){return Le(32,"").toUpperCase()}const Cl=()=>{};function ep(r){return new dt((t,n)=>{let s=!1;const c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);const d=vi()?"canplay":"playing";c.addEventListener(d,()=>{const h=c.videoWidth,p=c.videoHeight;!h&&Gr()||(s=!0,c.srcObject=null,c.remove(),t([h,p]))}),c.srcObject=new MediaStream([r]),c.play().catch(Cl),vn(()=>{s||(c.srcObject=null,c.remove(),t([c.videoWidth,c.videoHeight]))},4e3)})}function Os(r){return dt.all(ft(r).call(r,t=>t.then(n=>{throw n},n=>n))).then(t=>{throw t},t=>t)}function xr(r,t,...n){return r.getListeners(t).length===0?dt.reject(new M(L.UNEXPECTED_ERROR,"can not emit promise")):new dt((s,c)=>{r.emit(t,...n,s,c)})}function Xe(r,t,...n){return r.getListeners(t).length===0?dt.resolve():xr(r,t,...n)}function Io(r,t,...n){return r.getListeners(t).length===0?null:Va(r,t,...n)}function Va(r,t,...n){let s=null,c=null;if(r.emit(t,...n,d=>{s=d},d=>{c=d}),c!==null)throw c;if(s===null)throw new M(L.UNEXPECTED_ERROR,"handler is not sync");return s}function da(r,t){const n=Ft(r).call(r,t);n!==-1&&Ye(r).call(r,n,1)}function rp(r){const t=[];return G(r).call(r,n=>{Ft(t).call(t,n)===-1&&t.push(n)}),t}function on(r){dt.resolve().then(r)}function wn(r){return JSON.parse(ht(r))}const TS={};function ks(r,t){TS[t]||(TS[t]=!0,r())}function Wd(r){const t=window.atob(r),n=new Uint8Array(new ArrayBuffer(t.length));for(let s=0;s<t.length;s+=1)n[s]=t.charCodeAt(s);return n}function vc(r){let t="";for(let n=0;n<r.length;n+=1)t+=String.fromCharCode(r[n]);return window.btoa(t)}const RS=new class{constructor(){this.fnMap=new re}throttleByKey(r,t,n,s,...c){if(this.fnMap.has(t)){const d=this.fnMap.get(t);if(d.threshold!==n){d.fn(...d.args),clearTimeout(d.timer);const h=window.setTimeout(()=>{const p=this.fnMap.get(t);p&&p.fn(...p.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:r,threshold:n,timer:h,args:c,skipFn:s})}else d.skipFn&&d.skipFn(...d.args),this.fnMap.set(t,lg({},d,{fn:r,args:c,skipFn:s}))}else{const d=window.setTimeout(()=>{const h=this.fnMap.get(t);h&&h.fn(...h.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:r,threshold:n,timer:d,args:c,skipFn:s})}}},np=Mr(IS=RS.throttleByKey).call(IS,RS),Co=async({fragementLength:r,referenceList:t,asyncMapHandler:n,allFailedhandler:s,promisesCollector:c})=>{let d=0;const h=r;let p,A=0;const m=async()=>{const E=(()=>{const v=d*h,C=v+h,b=en(t).call(t,v,C);return ft(b).call(b,n)})();c&&c.push(...E);try{p=await Os(E)}catch(v){if(A+=h,d++,!(A>=t.length))return void await m();s(v)}G(E).call(E,v=>v.cancel())};return await m(),p};var Pk=Zr("Array").values,wS=Array.prototype,Bk={DOMTokenList:!0,NodeList:!0},ua=function(r){var t=r.values;return r===wS||r instanceof Array&&t===wS.values||Bk.hasOwnProperty(cc(r))?Pk:t};const Uk={[hl.ACCESS_POINT]:{[Jn.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Jn.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Jn.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Jn.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Jn.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Jn.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voice service available",retry:!0},[Jn.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Jn.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Jn.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Jn.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Jn.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Jn.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Jn.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Jn.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Jn.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Jn.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[hl.UNILBS]:{[Zi.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Zi.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Zi.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Zi.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Zi.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Zi.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Zi.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Zi.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Zi.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Zi.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Zi.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Zi.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[hl.STRING_UID_ALLOCATOR]:{[Pd.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[Pd.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[Pd.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function ha(r){const t=Uk[Math.floor(r/1e4)];if(!t)return{desc:"unkonw error",retry:!1};const n=t[r%1e4];if(!n){if(Math.floor(r/1e4)===hl.ACCESS_POINT){const s=r%1e4;if(s.toString()[0]==="1")return{desc:r.toString(),retry:!1};if(s.toString()[0]==="2")return{desc:r.toString(),retry:!0}}return{desc:"unkonw error",retry:!1}}return n}const xk={[oe.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[oe.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[oe.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[oe.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[oe.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[oe.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[oe.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[oe.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[oe.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[oe.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[oe.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[oe.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[oe.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[oe.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[oe.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[oe.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[oe.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[oe.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[oe.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[oe.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[oe.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[oe.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[oe.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[oe.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[oe.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[oe.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[oe.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[oe.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[oe.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[oe.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[oe.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[oe.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[oe.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[oe.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[oe.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[oe.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[oe.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[oe.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[oe.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[oe.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[oe.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[oe.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[oe.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[oe.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[oe.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[oe.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[oe.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[oe.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[oe.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[oe.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[oe.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[oe.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[oe.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[oe.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[oe.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[oe.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"}};function ip(r){return xk[r]||{desc:"UNKNOW_ERROR_".concat(r),action:"failed"}}var Fk=a(function(r,t){r.exports=function(){var n={d:function(Z,x){for(var q in x)n.o(x,q)&&!n.o(Z,q)&&Object.defineProperty(Z,q,{enumerable:!0,get:x[q]})},o:function(Z,x){return Object.prototype.hasOwnProperty.call(Z,x)},r:function(Z){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(Z,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(Z,"__esModule",{value:!0})}},s={};n.r(s),n.d(s,{DataViewIndexOutOfBoundsError:function(){return ut},DecodeError:function(){return st},Decoder:function(){return Tr},EXT_TIMESTAMP:function(){return mt},Encoder:function(){return Ct},ExtData:function(){return V},ExtensionCodec:function(){return U},decode:function(){return ri},decodeArrayStream:function(){return Ri},decodeAsync:function(){return zr},decodeMulti:function(){return fs},decodeMultiStream:function(){return As},decodeStream:function(){return _a},decodeTimestampExtension:function(){return W},decodeTimestampToTimeSpec:function(){return rt},encode:function(){return Y},encodeDateToTimeSpec:function(){return At},encodeTimeSpecToTimestamp:function(){return Et},encodeTimestampExtension:function(){return $}});var c=4294967295;function d(Z,x,q){var ct=Math.floor(q/4294967296),et=q;Z.setUint32(x,ct),Z.setUint32(x+4,et)}function h(Z,x){return 4294967296*Z.getInt32(x)+Z.getUint32(x+4)}var p=function(Z,x){var q=typeof Symbol=="function"&&Z[Symbol.iterator];if(!q)return Z;var ct,et,wt=q.call(Z),St=[];try{for(;(x===void 0||x-- >0)&&!(ct=wt.next()).done;)St.push(ct.value)}catch(Qt){et={error:Qt}}finally{try{ct&&!ct.done&&(q=wt.return)&&q.call(wt)}finally{if(et)throw et.error}}return St},A=function(Z,x){for(var q=0,ct=x.length,et=Z.length;q<ct;q++,et++)Z[et]=x[q];return Z},m=typeof TextEncoder!="undefined"&&typeof TextDecoder!="undefined";function E(Z){for(var x=Z.length,q=0,ct=0;ct<x;){var et=Z.charCodeAt(ct++);if((4294967168&et)!=0)if((4294965248&et)==0)q+=2;else{if(et>=55296&&et<=56319&&ct<x){var wt=Z.charCodeAt(ct);(64512&wt)==56320&&(++ct,et=((1023&et)<<10)+(1023&wt)+65536)}q+=(4294901760&et)==0?3:4}else q++}return q}var v=m?new TextEncoder:void 0,C=m?typeof process!="undefined"?200:0:c,b=(v==null?void 0:v.encodeInto)?function(Z,x,q){v.encodeInto(Z,x.subarray(q))}:function(Z,x,q){x.set(v.encode(Z),q)};function y(Z,x,q){for(var ct=x,et=ct+q,wt=[],St="";ct<et;){var Qt=Z[ct++];if((128&Qt)==0)wt.push(Qt);else if((224&Qt)==192){var ce=63&Z[ct++];wt.push((31&Qt)<<6|ce)}else if((240&Qt)==224){ce=63&Z[ct++];var fe=63&Z[ct++];wt.push((31&Qt)<<12|ce<<6|fe)}else if((248&Qt)==240){var Pt=(7&Qt)<<18|(ce=63&Z[ct++])<<12|(fe=63&Z[ct++])<<6|63&Z[ct++];Pt>65535&&(Pt-=65536,wt.push(Pt>>>10&1023|55296),Pt=56320|1023&Pt),wt.push(Pt)}else wt.push(Qt);wt.length>=4096&&(St+=String.fromCharCode.apply(String,A([],p(wt))),wt.length=0)}return wt.length>0&&(St+=String.fromCharCode.apply(String,A([],p(wt)))),St}var w,k=m?new TextDecoder:null,P=m?typeof process!="undefined"?200:0:c,V=function(Z,x){this.type=Z,this.data=x},j=(w=function(Z,x){return(w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(q,ct){q.__proto__=ct}||function(q,ct){for(var et in ct)Object.prototype.hasOwnProperty.call(ct,et)&&(q[et]=ct[et])})(Z,x)},function(Z,x){if(typeof x!="function"&&x!==null)throw new TypeError("Class extends value "+String(x)+" is not a constructor or null");function q(){this.constructor=Z}w(Z,x),Z.prototype=x===null?Object.create(x):(q.prototype=x.prototype,new q)}),st=function(Z){function x(q){var ct=Z.call(this,q)||this,et=Object.create(x.prototype);return Object.setPrototypeOf(ct,et),Object.defineProperty(ct,"name",{configurable:!0,enumerable:!1,value:x.name}),ct}return j(x,Z),x}(Error),mt=-1;function Et(Z){var x,q=Z.sec,ct=Z.nsec;if(q>=0&&ct>=0&&q<=17179869183){if(ct===0&&q<=4294967295){var et=new Uint8Array(4);return(x=new DataView(et.buffer)).setUint32(0,q),et}var wt=q/4294967296,St=4294967295&q;return et=new Uint8Array(8),(x=new DataView(et.buffer)).setUint32(0,ct<<2|3&wt),x.setUint32(4,St),et}return et=new Uint8Array(12),(x=new DataView(et.buffer)).setUint32(0,ct),d(x,4,q),et}function At(Z){var x=Z.getTime(),q=Math.floor(x/1e3),ct=1e6*(x-1e3*q),et=Math.floor(ct/1e9);return{sec:q+et,nsec:ct-1e9*et}}function $(Z){return Z instanceof Date?Et(At(Z)):null}function rt(Z){var x=new DataView(Z.buffer,Z.byteOffset,Z.byteLength);switch(Z.byteLength){case 4:return{sec:x.getUint32(0),nsec:0};case 8:var q=x.getUint32(0);return{sec:4294967296*(3&q)+x.getUint32(4),nsec:q>>>2};case 12:return{sec:h(x,4),nsec:x.getUint32(0)};default:throw new st("Unrecognized data size for timestamp (expected 4, 8, or 12): "+Z.length)}}function W(Z){var x=rt(Z);return new Date(1e3*x.sec+x.nsec/1e6)}var H={type:mt,encode:$,decode:W},U=function(){function Z(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(H)}return Z.prototype.register=function(x){var q=x.type,ct=x.encode,et=x.decode;if(q>=0)this.encoders[q]=ct,this.decoders[q]=et;else{var wt=1+q;this.builtInEncoders[wt]=ct,this.builtInDecoders[wt]=et}},Z.prototype.tryToEncode=function(x,q){for(var ct=0;ct<this.builtInEncoders.length;ct++)if((et=this.builtInEncoders[ct])!=null&&(wt=et(x,q))!=null)return new V(-1-ct,wt);for(ct=0;ct<this.encoders.length;ct++){var et,wt;if((et=this.encoders[ct])!=null&&(wt=et(x,q))!=null)return new V(ct,wt)}return x instanceof V?x:null},Z.prototype.decode=function(x,q,ct){var et=q<0?this.builtInDecoders[-1-q]:this.decoders[q];return et?et(x,q,ct):new V(q,x)},Z.defaultCodec=new Z,Z}();function Tt(Z){return Z instanceof Uint8Array?Z:ArrayBuffer.isView(Z)?new Uint8Array(Z.buffer,Z.byteOffset,Z.byteLength):Z instanceof ArrayBuffer?new Uint8Array(Z):Uint8Array.from(Z)}var It=function(Z){var x=typeof Symbol=="function"&&Symbol.iterator,q=x&&Z[x],ct=0;if(q)return q.call(Z);if(Z&&typeof Z.length=="number")return{next:function(){return Z&&ct>=Z.length&&(Z=void 0),{value:Z&&Z[ct++],done:!Z}}};throw new TypeError(x?"Object is not iterable.":"Symbol.iterator is not defined.")},Ct=function(){function Z(x,q,ct,et,wt,St,Qt,ce){x===void 0&&(x=U.defaultCodec),q===void 0&&(q=void 0),ct===void 0&&(ct=100),et===void 0&&(et=2048),wt===void 0&&(wt=!1),St===void 0&&(St=!1),Qt===void 0&&(Qt=!1),ce===void 0&&(ce=!1),this.extensionCodec=x,this.context=q,this.maxDepth=ct,this.initialBufferSize=et,this.sortKeys=wt,this.forceFloat32=St,this.ignoreUndefined=Qt,this.forceIntegerToFloat=ce,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}return Z.prototype.getUint8Array=function(){return this.bytes.subarray(0,this.pos)},Z.prototype.reinitializeState=function(){this.pos=0},Z.prototype.encode=function(x){return this.reinitializeState(),this.doEncode(x,1),this.getUint8Array()},Z.prototype.doEncode=function(x,q){if(q>this.maxDepth)throw new Error("Too deep objects in depth "+q);x==null?this.encodeNil():typeof x=="boolean"?this.encodeBoolean(x):typeof x=="number"?this.encodeNumber(x):typeof x=="string"?this.encodeString(x):this.encodeObject(x,q)},Z.prototype.ensureBufferSizeToWrite=function(x){var q=this.pos+x;this.view.byteLength<q&&this.resizeBuffer(2*q)},Z.prototype.resizeBuffer=function(x){var q=new ArrayBuffer(x),ct=new Uint8Array(q),et=new DataView(q);ct.set(this.bytes),this.view=et,this.bytes=ct},Z.prototype.encodeNil=function(){this.writeU8(192)},Z.prototype.encodeBoolean=function(x){x===!1?this.writeU8(194):this.writeU8(195)},Z.prototype.encodeNumber=function(x){Number.isSafeInteger(x)&&!this.forceIntegerToFloat?x>=0?x<128?this.writeU8(x):x<256?(this.writeU8(204),this.writeU8(x)):x<65536?(this.writeU8(205),this.writeU16(x)):x<4294967296?(this.writeU8(206),this.writeU32(x)):(this.writeU8(207),this.writeU64(x)):x>=-32?this.writeU8(224|x+32):x>=-128?(this.writeU8(208),this.writeI8(x)):x>=-32768?(this.writeU8(209),this.writeI16(x)):x>=-2147483648?(this.writeU8(210),this.writeI32(x)):(this.writeU8(211),this.writeI64(x)):this.forceFloat32?(this.writeU8(202),this.writeF32(x)):(this.writeU8(203),this.writeF64(x))},Z.prototype.writeStringHeader=function(x){if(x<32)this.writeU8(160+x);else if(x<256)this.writeU8(217),this.writeU8(x);else if(x<65536)this.writeU8(218),this.writeU16(x);else{if(!(x<4294967296))throw new Error("Too long string: "+x+" bytes in UTF-8");this.writeU8(219),this.writeU32(x)}},Z.prototype.encodeString=function(x){if(x.length>C){var q=E(x);this.ensureBufferSizeToWrite(5+q),this.writeStringHeader(q),b(x,this.bytes,this.pos),this.pos+=q}else q=E(x),this.ensureBufferSizeToWrite(5+q),this.writeStringHeader(q),function(ct,et,wt){for(var St=ct.length,Qt=wt,ce=0;ce<St;){var fe=ct.charCodeAt(ce++);if((4294967168&fe)!=0){if((4294965248&fe)==0)et[Qt++]=fe>>6&31|192;else{if(fe>=55296&&fe<=56319&&ce<St){var Pt=ct.charCodeAt(ce);(64512&Pt)==56320&&(++ce,fe=((1023&fe)<<10)+(1023&Pt)+65536)}(4294901760&fe)==0?(et[Qt++]=fe>>12&15|224,et[Qt++]=fe>>6&63|128):(et[Qt++]=fe>>18&7|240,et[Qt++]=fe>>12&63|128,et[Qt++]=fe>>6&63|128)}et[Qt++]=63&fe|128}else et[Qt++]=fe}}(x,this.bytes,this.pos),this.pos+=q},Z.prototype.encodeObject=function(x,q){var ct=this.extensionCodec.tryToEncode(x,this.context);if(ct!=null)this.encodeExtension(ct);else if(Array.isArray(x))this.encodeArray(x,q);else if(ArrayBuffer.isView(x))this.encodeBinary(x);else{if(typeof x!="object")throw new Error("Unrecognized object: "+Object.prototype.toString.apply(x));this.encodeMap(x,q)}},Z.prototype.encodeBinary=function(x){var q=x.byteLength;if(q<256)this.writeU8(196),this.writeU8(q);else if(q<65536)this.writeU8(197),this.writeU16(q);else{if(!(q<4294967296))throw new Error("Too large binary: "+q);this.writeU8(198),this.writeU32(q)}var ct=Tt(x);this.writeU8a(ct)},Z.prototype.encodeArray=function(x,q){var ct,et,wt=x.length;if(wt<16)this.writeU8(144+wt);else if(wt<65536)this.writeU8(220),this.writeU16(wt);else{if(!(wt<4294967296))throw new Error("Too large array: "+wt);this.writeU8(221),this.writeU32(wt)}try{for(var St=It(x),Qt=St.next();!Qt.done;Qt=St.next()){var ce=Qt.value;this.doEncode(ce,q+1)}}catch(fe){ct={error:fe}}finally{try{Qt&&!Qt.done&&(et=St.return)&&et.call(St)}finally{if(ct)throw ct.error}}},Z.prototype.countWithoutUndefined=function(x,q){var ct,et,wt=0;try{for(var St=It(q),Qt=St.next();!Qt.done;Qt=St.next())x[Qt.value]!==void 0&&wt++}catch(ce){ct={error:ce}}finally{try{Qt&&!Qt.done&&(et=St.return)&&et.call(St)}finally{if(ct)throw ct.error}}return wt},Z.prototype.encodeMap=function(x,q){var ct,et,wt=Object.keys(x);this.sortKeys&&wt.sort();var St=this.ignoreUndefined?this.countWithoutUndefined(x,wt):wt.length;if(St<16)this.writeU8(128+St);else if(St<65536)this.writeU8(222),this.writeU16(St);else{if(!(St<4294967296))throw new Error("Too large map object: "+St);this.writeU8(223),this.writeU32(St)}try{for(var Qt=It(wt),ce=Qt.next();!ce.done;ce=Qt.next()){var fe=ce.value,Pt=x[fe];this.ignoreUndefined&&Pt===void 0||(this.encodeString(fe),this.doEncode(Pt,q+1))}}catch(Gt){ct={error:Gt}}finally{try{ce&&!ce.done&&(et=Qt.return)&&et.call(Qt)}finally{if(ct)throw ct.error}}},Z.prototype.encodeExtension=function(x){var q=x.data.length;if(q===1)this.writeU8(212);else if(q===2)this.writeU8(213);else if(q===4)this.writeU8(214);else if(q===8)this.writeU8(215);else if(q===16)this.writeU8(216);else if(q<256)this.writeU8(199),this.writeU8(q);else if(q<65536)this.writeU8(200),this.writeU16(q);else{if(!(q<4294967296))throw new Error("Too large extension object: "+q);this.writeU8(201),this.writeU32(q)}this.writeI8(x.type),this.writeU8a(x.data)},Z.prototype.writeU8=function(x){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,x),this.pos++},Z.prototype.writeU8a=function(x){var q=x.length;this.ensureBufferSizeToWrite(q),this.bytes.set(x,this.pos),this.pos+=q},Z.prototype.writeI8=function(x){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,x),this.pos++},Z.prototype.writeU16=function(x){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,x),this.pos+=2},Z.prototype.writeI16=function(x){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,x),this.pos+=2},Z.prototype.writeU32=function(x){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,x),this.pos+=4},Z.prototype.writeI32=function(x){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,x),this.pos+=4},Z.prototype.writeF32=function(x){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,x),this.pos+=4},Z.prototype.writeF64=function(x){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,x),this.pos+=8},Z.prototype.writeU64=function(x){this.ensureBufferSizeToWrite(8),function(q,ct,et){var wt=et/4294967296,St=et;q.setUint32(ct,wt),q.setUint32(ct+4,St)}(this.view,this.pos,x),this.pos+=8},Z.prototype.writeI64=function(x){this.ensureBufferSizeToWrite(8),d(this.view,this.pos,x),this.pos+=8},Z}(),Ut={};function Y(Z,x){return x===void 0&&(x=Ut),new Ct(x.extensionCodec,x.context,x.maxDepth,x.initialBufferSize,x.sortKeys,x.forceFloat32,x.ignoreUndefined,x.forceIntegerToFloat).encode(Z)}function tt(Z){return(Z<0?"-":"")+"0x"+Math.abs(Z).toString(16).padStart(2,"0")}var vt=function(){function Z(x,q){x===void 0&&(x=16),q===void 0&&(q=16),this.maxKeyLength=x,this.maxLengthPerKey=q,this.hit=0,this.miss=0,this.caches=[];for(var ct=0;ct<this.maxKeyLength;ct++)this.caches.push([])}return Z.prototype.canBeCached=function(x){return x>0&&x<=this.maxKeyLength},Z.prototype.find=function(x,q,ct){var et,wt,St=this.caches[ct-1];try{t:for(var Qt=function(ne){var Ke=typeof Symbol=="function"&&Symbol.iterator,yn=Ke&&ne[Ke],Fi=0;if(yn)return yn.call(ne);if(ne&&typeof ne.length=="number")return{next:function(){return ne&&Fi>=ne.length&&(ne=void 0),{value:ne&&ne[Fi++],done:!ne}}};throw new TypeError(Ke?"Object is not iterable.":"Symbol.iterator is not defined.")}(St),ce=Qt.next();!ce.done;ce=Qt.next()){for(var fe=ce.value,Pt=fe.bytes,Gt=0;Gt<ct;Gt++)if(Pt[Gt]!==x[q+Gt])continue t;return fe.str}}catch(ne){et={error:ne}}finally{try{ce&&!ce.done&&(wt=Qt.return)&&wt.call(Qt)}finally{if(et)throw et.error}}return null},Z.prototype.store=function(x,q){var ct=this.caches[x.length-1],et={bytes:x,str:q};ct.length>=this.maxLengthPerKey?ct[Math.random()*ct.length|0]=et:ct.push(et)},Z.prototype.decode=function(x,q,ct){var et=this.find(x,q,ct);if(et!=null)return this.hit++,et;this.miss++;var wt=y(x,q,ct),St=Uint8Array.prototype.slice.call(x,q,q+ct);return this.store(St,wt),wt},Z}(),at=function(Z,x){var q,ct,et,wt,St={label:0,sent:function(){if(1&et[0])throw et[1];return et[1]},trys:[],ops:[]};return wt={next:Qt(0),throw:Qt(1),return:Qt(2)},typeof Symbol=="function"&&(wt[Symbol.iterator]=function(){return this}),wt;function Qt(ce){return function(fe){return function(Pt){if(q)throw new TypeError("Generator is already executing.");for(;St;)try{if(q=1,ct&&(et=2&Pt[0]?ct.return:Pt[0]?ct.throw||((et=ct.return)&&et.call(ct),0):ct.next)&&!(et=et.call(ct,Pt[1])).done)return et;switch(ct=0,et&&(Pt=[2&Pt[0],et.value]),Pt[0]){case 0:case 1:et=Pt;break;case 4:return St.label++,{value:Pt[1],done:!1};case 5:St.label++,ct=Pt[1],Pt=[0];continue;case 7:Pt=St.ops.pop(),St.trys.pop();continue;default:if(!((et=(et=St.trys).length>0&&et[et.length-1])||Pt[0]!==6&&Pt[0]!==2)){St=0;continue}if(Pt[0]===3&&(!et||Pt[1]>et[0]&&Pt[1]<et[3])){St.label=Pt[1];break}if(Pt[0]===6&&St.label<et[1]){St.label=et[1],et=Pt;break}if(et&&St.label<et[2]){St.label=et[2],St.ops.push(Pt);break}et[2]&&St.ops.pop(),St.trys.pop();continue}Pt=x.call(Z,St)}catch(Gt){Pt=[6,Gt],ct=0}finally{q=et=0}if(5&Pt[0])throw Pt[1];return{value:Pt[0]?Pt[1]:void 0,done:!0}}([ce,fe])}}},Lt=function(Z){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var x,q=Z[Symbol.asyncIterator];return q?q.call(Z):(Z=typeof __values=="function"?__values(Z):Z[Symbol.iterator](),x={},ct("next"),ct("throw"),ct("return"),x[Symbol.asyncIterator]=function(){return this},x);function ct(et){x[et]=Z[et]&&function(wt){return new Promise(function(St,Qt){(function(ce,fe,Pt,Gt){Promise.resolve(Gt).then(function(ne){ce({value:ne,done:Pt})},fe)})(St,Qt,(wt=Z[et](wt)).done,wt.value)})}}},lt=function(Z){return this instanceof lt?(this.v=Z,this):new lt(Z)},R=function(Z,x,q){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var ct,et=q.apply(Z,x||[]),wt=[];return ct={},St("next"),St("throw"),St("return"),ct[Symbol.asyncIterator]=function(){return this},ct;function St(Gt){et[Gt]&&(ct[Gt]=function(ne){return new Promise(function(Ke,yn){wt.push([Gt,ne,Ke,yn])>1||Qt(Gt,ne)})})}function Qt(Gt,ne){try{(Ke=et[Gt](ne)).value instanceof lt?Promise.resolve(Ke.value.v).then(ce,fe):Pt(wt[0][2],Ke)}catch(yn){Pt(wt[0][3],yn)}var Ke}function ce(Gt){Qt("next",Gt)}function fe(Gt){Qt("throw",Gt)}function Pt(Gt,ne){Gt(ne),wt.shift(),wt.length&&Qt(wt[0][0],wt[0][1])}},B=new DataView(new ArrayBuffer(0)),Q=new Uint8Array(B.buffer),ut=function(){try{B.getInt8(0)}catch(Z){return Z.constructor}throw new Error("never reached")}(),Vt=new ut("Insufficient data"),Ue=new vt,Tr=function(){function Z(x,q,ct,et,wt,St,Qt,ce){x===void 0&&(x=U.defaultCodec),q===void 0&&(q=void 0),ct===void 0&&(ct=c),et===void 0&&(et=c),wt===void 0&&(wt=c),St===void 0&&(St=c),Qt===void 0&&(Qt=c),ce===void 0&&(ce=Ue),this.extensionCodec=x,this.context=q,this.maxStrLength=ct,this.maxBinLength=et,this.maxArrayLength=wt,this.maxMapLength=St,this.maxExtLength=Qt,this.keyDecoder=ce,this.totalPos=0,this.pos=0,this.view=B,this.bytes=Q,this.headByte=-1,this.stack=[]}return Z.prototype.reinitializeState=function(){this.totalPos=0,this.headByte=-1,this.stack.length=0},Z.prototype.setBuffer=function(x){this.bytes=Tt(x),this.view=function(q){if(q instanceof ArrayBuffer)return new DataView(q);var ct=Tt(q);return new DataView(ct.buffer,ct.byteOffset,ct.byteLength)}(this.bytes),this.pos=0},Z.prototype.appendBuffer=function(x){if(this.headByte!==-1||this.hasRemaining(1)){var q=this.bytes.subarray(this.pos),ct=Tt(x),et=new Uint8Array(q.length+ct.length);et.set(q),et.set(ct,q.length),this.setBuffer(et)}else this.setBuffer(x)},Z.prototype.hasRemaining=function(x){return this.view.byteLength-this.pos>=x},Z.prototype.createExtraByteError=function(x){var q=this.view,ct=this.pos;return new RangeError("Extra "+(q.byteLength-ct)+" of "+q.byteLength+" byte(s) found at buffer["+x+"]")},Z.prototype.decode=function(x){this.reinitializeState(),this.setBuffer(x);var q=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return q},Z.prototype.decodeMulti=function(x){return at(this,function(q){switch(q.label){case 0:this.reinitializeState(),this.setBuffer(x),q.label=1;case 1:return this.hasRemaining(1)?[4,this.doDecodeSync()]:[3,3];case 2:return q.sent(),[3,1];case 3:return[2]}})},Z.prototype.decodeAsync=function(x){var q,ct,et,wt,St,Qt,ce,fe;return St=this,Qt=void 0,fe=function(){var Pt,Gt,ne,Ke,yn,Fi,Ro,Cr;return at(this,function(Yo){switch(Yo.label){case 0:Pt=!1,Yo.label=1;case 1:Yo.trys.push([1,6,7,12]),q=Lt(x),Yo.label=2;case 2:return[4,q.next()];case 3:if((ct=Yo.sent()).done)return[3,5];if(ne=ct.value,Pt)throw this.createExtraByteError(this.totalPos);this.appendBuffer(ne);try{Gt=this.doDecodeSync(),Pt=!0}catch($1){if(!($1 instanceof ut))throw $1}this.totalPos+=this.pos,Yo.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return Ke=Yo.sent(),et={error:Ke},[3,12];case 7:return Yo.trys.push([7,,10,11]),ct&&!ct.done&&(wt=q.return)?[4,wt.call(q)]:[3,9];case 8:Yo.sent(),Yo.label=9;case 9:return[3,11];case 10:if(et)throw et.error;return[7];case 11:return[7];case 12:if(Pt){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return[2,Gt]}throw Fi=(yn=this).headByte,Ro=yn.pos,Cr=yn.totalPos,new RangeError("Insufficient data in parsing "+tt(Fi)+" at "+Cr+" ("+Ro+" in the current buffer)")}})},new((ce=void 0)||(ce=Promise))(function(Pt,Gt){function ne(Fi){try{yn(fe.next(Fi))}catch(Ro){Gt(Ro)}}function Ke(Fi){try{yn(fe.throw(Fi))}catch(Ro){Gt(Ro)}}function yn(Fi){var Ro;Fi.done?Pt(Fi.value):(Ro=Fi.value,Ro instanceof ce?Ro:new ce(function(Cr){Cr(Ro)})).then(ne,Ke)}yn((fe=fe.apply(St,Qt||[])).next())})},Z.prototype.decodeArrayStream=function(x){return this.decodeMultiAsync(x,!0)},Z.prototype.decodeStream=function(x){return this.decodeMultiAsync(x,!1)},Z.prototype.decodeMultiAsync=function(x,q){return R(this,arguments,function(){var ct,et,wt,St,Qt,ce,fe,Pt,Gt;return at(this,function(ne){switch(ne.label){case 0:ct=q,et=-1,ne.label=1;case 1:ne.trys.push([1,13,14,19]),wt=Lt(x),ne.label=2;case 2:return[4,lt(wt.next())];case 3:if((St=ne.sent()).done)return[3,12];if(Qt=St.value,q&&et===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(Qt),ct&&(et=this.readArraySize(),ct=!1,this.complete()),ne.label=4;case 4:ne.trys.push([4,9,,10]),ne.label=5;case 5:return[4,lt(this.doDecodeSync())];case 6:return[4,ne.sent()];case 7:return ne.sent(),--et==0?[3,8]:[3,5];case 8:return[3,10];case 9:if(!((ce=ne.sent())instanceof ut))throw ce;return[3,10];case 10:this.totalPos+=this.pos,ne.label=11;case 11:return[3,2];case 12:return[3,19];case 13:return fe=ne.sent(),Pt={error:fe},[3,19];case 14:return ne.trys.push([14,,17,18]),St&&!St.done&&(Gt=wt.return)?[4,lt(Gt.call(wt))]:[3,16];case 15:ne.sent(),ne.label=16;case 16:return[3,18];case 17:if(Pt)throw Pt.error;return[7];case 18:return[7];case 19:return[2]}})})},Z.prototype.doDecodeSync=function(){t:for(;;){var x=this.readHeadByte(),q=void 0;if(x>=224)q=x-256;else if(x<192)if(x<128)q=x;else if(x<144){if((et=x-128)!=0){this.pushMapState(et),this.complete();continue t}q={}}else if(x<160){if((et=x-144)!=0){this.pushArrayState(et),this.complete();continue t}q=[]}else{var ct=x-160;q=this.decodeUtf8String(ct,0)}else if(x===192)q=null;else if(x===194)q=!1;else if(x===195)q=!0;else if(x===202)q=this.readF32();else if(x===203)q=this.readF64();else if(x===204)q=this.readU8();else if(x===205)q=this.readU16();else if(x===206)q=this.readU32();else if(x===207)q=this.readU64();else if(x===208)q=this.readI8();else if(x===209)q=this.readI16();else if(x===210)q=this.readI32();else if(x===211)q=this.readI64();else if(x===217)ct=this.lookU8(),q=this.decodeUtf8String(ct,1);else if(x===218)ct=this.lookU16(),q=this.decodeUtf8String(ct,2);else if(x===219)ct=this.lookU32(),q=this.decodeUtf8String(ct,4);else if(x===220){if((et=this.readU16())!==0){this.pushArrayState(et),this.complete();continue t}q=[]}else if(x===221){if((et=this.readU32())!==0){this.pushArrayState(et),this.complete();continue t}q=[]}else if(x===222){if((et=this.readU16())!==0){this.pushMapState(et),this.complete();continue t}q={}}else if(x===223){if((et=this.readU32())!==0){this.pushMapState(et),this.complete();continue t}q={}}else if(x===196){var et=this.lookU8();q=this.decodeBinary(et,1)}else if(x===197)et=this.lookU16(),q=this.decodeBinary(et,2);else if(x===198)et=this.lookU32(),q=this.decodeBinary(et,4);else if(x===212)q=this.decodeExtension(1,0);else if(x===213)q=this.decodeExtension(2,0);else if(x===214)q=this.decodeExtension(4,0);else if(x===215)q=this.decodeExtension(8,0);else if(x===216)q=this.decodeExtension(16,0);else if(x===199)et=this.lookU8(),q=this.decodeExtension(et,1);else if(x===200)et=this.lookU16(),q=this.decodeExtension(et,2);else{if(x!==201)throw new st("Unrecognized type byte: "+tt(x));et=this.lookU32(),q=this.decodeExtension(et,4)}this.complete();for(var wt=this.stack;wt.length>0;){var St=wt[wt.length-1];if(St.type===0){if(St.array[St.position]=q,St.position++,St.position!==St.size)continue t;wt.pop(),q=St.array}else{if(St.type===1){if((Qt=typeof q)!="string"&&Qt!=="number")throw new st("The type of key must be string or number but "+typeof q);if(q==="__proto__")throw new st("The key __proto__ is not allowed");St.key=q,St.type=2;continue t}if(St.map[St.key]=q,St.readCount++,St.readCount!==St.size){St.key=null,St.type=1;continue t}wt.pop(),q=St.map}}return q}var Qt},Z.prototype.readHeadByte=function(){return this.headByte===-1&&(this.headByte=this.readU8()),this.headByte},Z.prototype.complete=function(){this.headByte=-1},Z.prototype.readArraySize=function(){var x=this.readHeadByte();switch(x){case 220:return this.readU16();case 221:return this.readU32();default:if(x<160)return x-144;throw new st("Unrecognized array type byte: "+tt(x))}},Z.prototype.pushMapState=function(x){if(x>this.maxMapLength)throw new st("Max length exceeded: map length ("+x+") > maxMapLengthLength ("+this.maxMapLength+")");this.stack.push({type:1,size:x,key:null,readCount:0,map:{}})},Z.prototype.pushArrayState=function(x){if(x>this.maxArrayLength)throw new st("Max length exceeded: array length ("+x+") > maxArrayLength ("+this.maxArrayLength+")");this.stack.push({type:0,size:x,array:new Array(x),position:0})},Z.prototype.decodeUtf8String=function(x,q){var ct;if(x>this.maxStrLength)throw new st("Max length exceeded: UTF-8 byte length ("+x+") > maxStrLength ("+this.maxStrLength+")");if(this.bytes.byteLength<this.pos+q+x)throw Vt;var et,wt=this.pos+q;return et=this.stateIsMapKey()&&((ct=this.keyDecoder)===null||ct===void 0?void 0:ct.canBeCached(x))?this.keyDecoder.decode(this.bytes,wt,x):x>P?function(St,Qt,ce){var fe=St.subarray(Qt,Qt+ce);return k.decode(fe)}(this.bytes,wt,x):y(this.bytes,wt,x),this.pos+=q+x,et},Z.prototype.stateIsMapKey=function(){return this.stack.length>0&&this.stack[this.stack.length-1].type===1},Z.prototype.decodeBinary=function(x,q){if(x>this.maxBinLength)throw new st("Max length exceeded: bin length ("+x+") > maxBinLength ("+this.maxBinLength+")");if(!this.hasRemaining(x+q))throw Vt;var ct=this.pos+q,et=this.bytes.subarray(ct,ct+x);return this.pos+=q+x,et},Z.prototype.decodeExtension=function(x,q){if(x>this.maxExtLength)throw new st("Max length exceeded: ext length ("+x+") > maxExtLength ("+this.maxExtLength+")");var ct=this.view.getInt8(this.pos+q),et=this.decodeBinary(x,q+1);return this.extensionCodec.decode(et,ct,this.context)},Z.prototype.lookU8=function(){return this.view.getUint8(this.pos)},Z.prototype.lookU16=function(){return this.view.getUint16(this.pos)},Z.prototype.lookU32=function(){return this.view.getUint32(this.pos)},Z.prototype.readU8=function(){var x=this.view.getUint8(this.pos);return this.pos++,x},Z.prototype.readI8=function(){var x=this.view.getInt8(this.pos);return this.pos++,x},Z.prototype.readU16=function(){var x=this.view.getUint16(this.pos);return this.pos+=2,x},Z.prototype.readI16=function(){var x=this.view.getInt16(this.pos);return this.pos+=2,x},Z.prototype.readU32=function(){var x=this.view.getUint32(this.pos);return this.pos+=4,x},Z.prototype.readI32=function(){var x=this.view.getInt32(this.pos);return this.pos+=4,x},Z.prototype.readU64=function(){var x,q,ct=(x=this.view,q=this.pos,4294967296*x.getUint32(q)+x.getUint32(q+4));return this.pos+=8,ct},Z.prototype.readI64=function(){var x=h(this.view,this.pos);return this.pos+=8,x},Z.prototype.readF32=function(){var x=this.view.getFloat32(this.pos);return this.pos+=4,x},Z.prototype.readF64=function(){var x=this.view.getFloat64(this.pos);return this.pos+=8,x},Z}(),We={};function ri(Z,x){return x===void 0&&(x=We),new Tr(x.extensionCodec,x.context,x.maxStrLength,x.maxBinLength,x.maxArrayLength,x.maxMapLength,x.maxExtLength).decode(Z)}function fs(Z,x){return x===void 0&&(x=We),new Tr(x.extensionCodec,x.context,x.maxStrLength,x.maxBinLength,x.maxArrayLength,x.maxMapLength,x.maxExtLength).decodeMulti(Z)}var Ti=function(Z,x){var q,ct,et,wt,St={label:0,sent:function(){if(1&et[0])throw et[1];return et[1]},trys:[],ops:[]};return wt={next:Qt(0),throw:Qt(1),return:Qt(2)},typeof Symbol=="function"&&(wt[Symbol.iterator]=function(){return this}),wt;function Qt(ce){return function(fe){return function(Pt){if(q)throw new TypeError("Generator is already executing.");for(;St;)try{if(q=1,ct&&(et=2&Pt[0]?ct.return:Pt[0]?ct.throw||((et=ct.return)&&et.call(ct),0):ct.next)&&!(et=et.call(ct,Pt[1])).done)return et;switch(ct=0,et&&(Pt=[2&Pt[0],et.value]),Pt[0]){case 0:case 1:et=Pt;break;case 4:return St.label++,{value:Pt[1],done:!1};case 5:St.label++,ct=Pt[1],Pt=[0];continue;case 7:Pt=St.ops.pop(),St.trys.pop();continue;default:if(!((et=(et=St.trys).length>0&&et[et.length-1])||Pt[0]!==6&&Pt[0]!==2)){St=0;continue}if(Pt[0]===3&&(!et||Pt[1]>et[0]&&Pt[1]<et[3])){St.label=Pt[1];break}if(Pt[0]===6&&St.label<et[1]){St.label=et[1],et=Pt;break}if(et&&St.label<et[2]){St.label=et[2],St.ops.push(Pt);break}et[2]&&St.ops.pop(),St.trys.pop();continue}Pt=x.call(Z,St)}catch(Gt){Pt=[6,Gt],ct=0}finally{q=et=0}if(5&Pt[0])throw Pt[1];return{value:Pt[0]?Pt[1]:void 0,done:!0}}([ce,fe])}}},Fn=function(Z){return this instanceof Fn?(this.v=Z,this):new Fn(Z)},yc=function(Z,x,q){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var ct,et=q.apply(Z,x||[]),wt=[];return ct={},St("next"),St("throw"),St("return"),ct[Symbol.asyncIterator]=function(){return this},ct;function St(Gt){et[Gt]&&(ct[Gt]=function(ne){return new Promise(function(Ke,yn){wt.push([Gt,ne,Ke,yn])>1||Qt(Gt,ne)})})}function Qt(Gt,ne){try{(Ke=et[Gt](ne)).value instanceof Fn?Promise.resolve(Ke.value.v).then(ce,fe):Pt(wt[0][2],Ke)}catch(yn){Pt(wt[0][3],yn)}var Ke}function ce(Gt){Qt("next",Gt)}function fe(Gt){Qt("throw",Gt)}function Pt(Gt,ne){Gt(ne),wt.shift(),wt.length&&Qt(wt[0][0],wt[0][1])}};function Ea(Z){if(Z==null)throw new Error("Assertion Failure: value must not be null nor undefined")}function sn(Z){return Z[Symbol.asyncIterator]!=null?Z:function(x){return yc(this,arguments,function(){var q,ct,et,wt;return Ti(this,function(St){switch(St.label){case 0:q=x.getReader(),St.label=1;case 1:St.trys.push([1,,9,10]),St.label=2;case 2:return[4,Fn(q.read())];case 3:return ct=St.sent(),et=ct.done,wt=ct.value,et?[4,Fn(void 0)]:[3,5];case 4:return[2,St.sent()];case 5:return Ea(wt),[4,Fn(wt)];case 6:return[4,St.sent()];case 7:return St.sent(),[3,2];case 8:return[3,10];case 9:return q.releaseLock(),[7];case 10:return[2]}})})}(Z)}function zr(Z,x){return x===void 0&&(x=We),q=this,ct=void 0,wt=function(){var St;return function(Qt,ce){var fe,Pt,Gt,ne,Ke={label:0,sent:function(){if(1&Gt[0])throw Gt[1];return Gt[1]},trys:[],ops:[]};return ne={next:yn(0),throw:yn(1),return:yn(2)},typeof Symbol=="function"&&(ne[Symbol.iterator]=function(){return this}),ne;function yn(Fi){return function(Ro){return function(Cr){if(fe)throw new TypeError("Generator is already executing.");for(;Ke;)try{if(fe=1,Pt&&(Gt=2&Cr[0]?Pt.return:Cr[0]?Pt.throw||((Gt=Pt.return)&&Gt.call(Pt),0):Pt.next)&&!(Gt=Gt.call(Pt,Cr[1])).done)return Gt;switch(Pt=0,Gt&&(Cr=[2&Cr[0],Gt.value]),Cr[0]){case 0:case 1:Gt=Cr;break;case 4:return Ke.label++,{value:Cr[1],done:!1};case 5:Ke.label++,Pt=Cr[1],Cr=[0];continue;case 7:Cr=Ke.ops.pop(),Ke.trys.pop();continue;default:if(!((Gt=(Gt=Ke.trys).length>0&&Gt[Gt.length-1])||Cr[0]!==6&&Cr[0]!==2)){Ke=0;continue}if(Cr[0]===3&&(!Gt||Cr[1]>Gt[0]&&Cr[1]<Gt[3])){Ke.label=Cr[1];break}if(Cr[0]===6&&Ke.label<Gt[1]){Ke.label=Gt[1],Gt=Cr;break}if(Gt&&Ke.label<Gt[2]){Ke.label=Gt[2],Ke.ops.push(Cr);break}Gt[2]&&Ke.ops.pop(),Ke.trys.pop();continue}Cr=ce.call(Qt,Ke)}catch(Yo){Cr=[6,Yo],Pt=0}finally{fe=Gt=0}if(5&Cr[0])throw Cr[1];return{value:Cr[0]?Cr[1]:void 0,done:!0}}([Fi,Ro])}}}(this,function(Qt){return St=sn(Z),[2,new Tr(x.extensionCodec,x.context,x.maxStrLength,x.maxBinLength,x.maxArrayLength,x.maxMapLength,x.maxExtLength).decodeAsync(St)]})},new((et=void 0)||(et=Promise))(function(St,Qt){function ce(Gt){try{Pt(wt.next(Gt))}catch(ne){Qt(ne)}}function fe(Gt){try{Pt(wt.throw(Gt))}catch(ne){Qt(ne)}}function Pt(Gt){var ne;Gt.done?St(Gt.value):(ne=Gt.value,ne instanceof et?ne:new et(function(Ke){Ke(ne)})).then(ce,fe)}Pt((wt=wt.apply(q,ct||[])).next())});var q,ct,et,wt}function Ri(Z,x){x===void 0&&(x=We);var q=sn(Z);return new Tr(x.extensionCodec,x.context,x.maxStrLength,x.maxBinLength,x.maxArrayLength,x.maxMapLength,x.maxExtLength).decodeArrayStream(q)}function As(Z,x){x===void 0&&(x=We);var q=sn(Z);return new Tr(x.extensionCodec,x.context,x.maxStrLength,x.maxBinLength,x.maxArrayLength,x.maxMapLength,x.maxExtLength).decodeStream(q)}function _a(Z,x){return x===void 0&&(x=We),As(Z,x)}return s}()}),Qk=Math.min;qt({target:"Array",proto:!0},{copyWithin:[].copyWithin||function(r,t){var n=ve(this),s=Ln(n.length),c=Ao(r,s),d=Ao(t,s),h=arguments.length>2?arguments[2]:void 0,p=Qk((h===void 0?s:Ao(h,s))-d,s-c),A=1;for(d<c&&c<d+p&&(A=-1,d+=p-1,c+=p-1);p-- >0;)d in n?n[c]=n[d]:delete n[c],c+=A,d+=A;return n}});var Vk=Zr("Array").copyWithin,bS=Array.prototype,Gk=function(r){var t=r.copyWithin;return r===bS||r instanceof Array&&t===bS.copyWithin?Vk:t},jk=ss.every;qt({target:"Array",proto:!0,forced:uc("every")},{every:function(r){return jk(this,r,arguments.length>1?arguments[1]:void 0)}});var Wk=Zr("Array").every,NS=Array.prototype,Kk=function(r){var t=r.every;return r===NS||r instanceof Array&&t===NS.every?Wk:t},op=hh.getWeakData,Hk=fn.set,Yk=fn.getterFor,qk=ss.find,Jk=ss.findIndex,zk=0,sp=function(r){return r.frozen||(r.frozen=new OS)},OS=function(){this.entries=[]},dg=function(r,t){return qk(r.entries,function(n){return n[0]===t})};OS.prototype={get:function(r){var t=dg(this,r);if(t)return t[1]},has:function(r){return!!dg(this,r)},set:function(r,t){var n=dg(this,r);n?n[1]=t:this.entries.push([r,t])},delete:function(r){var t=Jk(this.entries,function(n){return n[0]===r});return~t&&this.entries.splice(t,1),!!~t}};var kS={getConstructor:function(r,t,n,s){var c=r(function(p,A){zc(p,c,t),Hk(p,{type:t,id:zk++,frozen:void 0}),A!=null&&Ba(A,p[s],p,n)}),d=Yk(t),h=function(p,A,m){var E=d(p),v=op(Nr(A),!0);return v===!0?sp(E).set(A,m):v[E.id]=m,p};return dc(c.prototype,{delete:function(p){var A=d(this);if(!z(p))return!1;var m=op(p);return m===!0?sp(A).delete(p):m&&yt(m,A.id)&&delete m[A.id]},has:function(p){var A=d(this);if(!z(p))return!1;var m=op(p);return m===!0?sp(A).has(p):m&&yt(m,A.id)}}),dc(c.prototype,n?{get:function(p){var A=d(this);if(z(p)){var m=op(p);return m===!0?sp(A).get(p):m?m[A.id]:void 0}},set:function(p,A){return h(this,p,A)}}:{add:function(p){return h(this,p,!0)}}),c}},Xk=(a(function(r){var t,n=fn.enforce,s=!u.ActiveXObject&&"ActiveXObject"in u,c=Object.isExtensible,d=function(C){return function(){return C(this,arguments.length?arguments[0]:void 0)}},h=r.exports=j_("WeakMap",d,kS);if(V_&&s){t=kS.getConstructor(d,"WeakMap",!0),hh.REQUIRED=!0;var p=h.prototype,A=p.delete,m=p.has,E=p.get,v=p.set;dc(p,{delete:function(C){if(z(C)&&!c(C)){var b=n(this);return b.frozen||(b.frozen=new t),A.call(this,C)||b.frozen.delete(C)}return A.call(this,C)},has:function(C){if(z(C)&&!c(C)){var b=n(this);return b.frozen||(b.frozen=new t),m.call(this,C)||b.frozen.has(C)}return m.call(this,C)},get:function(C){if(z(C)&&!c(C)){var b=n(this);return b.frozen||(b.frozen=new t),m.call(this,C)?E.call(this,C):b.frozen.get(C)}return E.call(this,C)},set:function(C,b){if(z(C)&&!c(C)){var y=n(this);y.frozen||(y.frozen=new t),m.call(this,C)?v.call(this,C,b):y.frozen.set(C,b)}else v.call(this,C,b);return this}})}}),Math.min),ug=[].lastIndexOf,DS=!!ug&&1/[1].lastIndexOf(1,-0)<0,Zk=uc("lastIndexOf"),LS=DS||Zk?function(r){if(DS)return ug.apply(this,arguments)||0;var t=it(this),n=Ln(t.length),s=n-1;for(arguments.length>1&&(s=Xk(s,fo(arguments[1]))),s<0&&(s=n+s);s>=0;s--)if(s in t&&t[s]===r)return s||0;return-1}:ug;qt({target:"Array",proto:!0,forced:LS!==[].lastIndexOf},{lastIndexOf:LS});var $k=Zr("Array").lastIndexOf,MS=Array.prototype,tD=function(r){var t=r.lastIndexOf;return r===MS||r instanceof Array&&t===MS.lastIndexOf?$k:t};const eD=()=>function(r){var t;const n=ft(t=window.atob(r).split("")).call(t,s=>s.charCodeAt(0));return new Uint8Array(n,0,n.length/Uint8Array.BYTES_PER_ELEMENT)}("AGFzbQEAAAABMAlgA39/fwF/YAF/AGACf38AYAF/AX9gAn9/AX9gA39/fwBgBH9/f38AYAABf2AAAAI6AgNlbnYWZW1zY3JpcHRlbl9yZXNpemVfaGVhcAADA2VudhVlbXNjcmlwdGVuX21lbWNweV9iaWcAAAMjIggAAAAAAQEDAQEEBAQEAQEGAQYCBQUAAgAHAwEDAAIHAQMEBQFwAQYGBQYBAYACgAIGCQF/AUHQ48ACCweUAQoGbWVtb3J5AgARX193YXNtX2NhbGxfY3RvcnMAAhlfX2luZGlyZWN0X2Z1bmN0aW9uX3RhYmxlAQAGbWFsbG9jABwEZnJlZQAdEF9fZXJybm9fbG9jYXRpb24AGwx6bGliQ29tcHJlc3MAGglzdGFja1NhdmUAIQxzdGFja1Jlc3RvcmUAIgpzdGFja0FsbG9jACMJCwEAQQELBRgZDA0PCq6FAiIDAAELpQcBBH8gAEH//wNxIQMgAEEQdiEEQQEhACACQQFGBEAgAyABLQAAaiIAQfH/A2sgACAAQfD/A0sbIgAgBGoiA0EQdCIEQYCAPGogBCADQfD/A0sbIAByDwsgAQR/IAJBEE8EQAJAAkACQCACQa8rSwRAA0AgAkGwK2shAkHbAiEFIAEhAANAIAMgAC0AAGoiAyAEaiADIAAtAAFqIgNqIAMgAC0AAmoiA2ogAyAALQADaiIDaiADIAAtAARqIgNqIAMgAC0ABWoiA2ogAyAALQAGaiIDaiADIAAtAAdqIgNqIAMgAC0ACGoiA2ogAyAALQAJaiIDaiADIAAtAApqIgNqIAMgAC0AC2oiA2ogAyAALQAMaiIDaiADIAAtAA1qIgNqIAMgAC0ADmoiA2ogAyAALQAPaiIDaiEEIABBEGohACAFQQFrIgUNAAsgBEHx/wNwIQQgA0Hx/wNwIQMgAUGwK2ohASACQa8rSw0ACyACRQ0DIAJBEEkNAQsDQCADIAEtAABqIgAgBGogACABLQABaiIAaiAAIAEtAAJqIgBqIAAgAS0AA2oiAGogACABLQAEaiIAaiAAIAEtAAVqIgBqIAAgAS0ABmoiAGogACABLQAHaiIAaiAAIAEtAAhqIgBqIAAgAS0ACWoiAGogACABLQAKaiIAaiAAIAEtAAtqIgBqIAAgAS0ADGoiAGogACABLQANaiIAaiAAIAEtAA5qIgBqIAAgAS0AD2oiA2ohBCABQRBqIQEgAkEQayICQQ9LDQALIAJFDQELIAJBAWshBiACQQNxIgUEQCABIQADQCACQQFrIQIgAyAALQAAaiIDIARqIQQgAEEBaiIBIQAgBUEBayIFDQALCyAGQQNJDQADQCADIAEtAABqIgAgAS0AAWoiBSABLQACaiIGIAEtAANqIgMgBiAFIAAgBGpqamohBCABQQRqIQEgAkEEayICDQALCyAEQfH/A3AhBCADQfH/A3AhAwsgBEEQdCADcg8LAkAgAkUNACACQQFrIQYgAkEDcSIFBEAgASEAA0AgAkEBayECIAMgAC0AAGoiAyAEaiEEIABBAWoiASEAIAVBAWsiBQ0ACwsgBkEDSQ0AA0AgAyABLQAAaiIAIAEtAAFqIgUgAS0AAmoiBiABLQADaiIDIAYgBSAAIARqampqIQQgAUEEaiEBIAJBBGsiAg0ACwsgBEHx/wNwQRB0IANB8f8DayADIANB8P8DSxtyBSAACwsKACAAIAEgAhADC4UJAQJ/IAFFBEBBAA8LIABBf3MhAAJAIAJFDQAgAUEDcUUNACABLQAAIABB/wFxc0ECdEGACGooAgAgAEEIdnMhACACQQFrIgRBACABQQFqIgNBA3EbRQRAIAMhASAEIQIMAQsgAS0AASAAQf8BcXNBAnRBgAhqKAIAIABBCHZzIQAgAUECaiEDAkAgAkECayIERQ0AIANBA3FFDQAgAS0AAiAAQf8BcXNBAnRBgAhqKAIAIABBCHZzIQAgAUEDaiEDAkAgAkEDayIERQ0AIANBA3FFDQAgAS0AAyAAQf8BcXNBAnRBgAhqKAIAIABBCHZzIQAgAkEEayECIAFBBGohAQwCCyADIQEgBCECDAELIAMhASAEIQILIAJBH0sEQANAIAEoAhwgASgCGCABKAIUIAEoAhAgASgCDCABKAIIIAEoAgQgASgCACAAcyIAQQZ2QfwHcUGAGGooAgAgAEH/AXFBAnRBgCBqKAIAcyAAQQ52QfwHcUGAEGooAgBzIABBFnZB/AdxQYAIaigCAHNzIgBBBnZB/AdxQYAYaigCACAAQf8BcUECdEGAIGooAgBzIABBDnZB/AdxQYAQaigCAHMgAEEWdkH8B3FBgAhqKAIAc3MiAEEGdkH8B3FBgBhqKAIAIABB/wFxQQJ0QYAgaigCAHMgAEEOdkH8B3FBgBBqKAIAcyAAQRZ2QfwHcUGACGooAgBzcyIAQQZ2QfwHcUGAGGooAgAgAEH/AXFBAnRBgCBqKAIAcyAAQQ52QfwHcUGAEGooAgBzIABBFnZB/AdxQYAIaigCAHNzIgBBBnZB/AdxQYAYaigCACAAQf8BcUECdEGAIGooAgBzIABBDnZB/AdxQYAQaigCAHMgAEEWdkH8B3FBgAhqKAIAc3MiAEEGdkH8B3FBgBhqKAIAIABB/wFxQQJ0QYAgaigCAHMgAEEOdkH8B3FBgBBqKAIAcyAAQRZ2QfwHcUGACGooAgBzcyIAQQZ2QfwHcUGAGGooAgAgAEH/AXFBAnRBgCBqKAIAcyAAQQ52QfwHcUGAEGooAgBzIABBFnZB/AdxQYAIaigCAHNzIgBBBnZB/AdxQYAYaigCACAAQf8BcUECdEGAIGooAgBzIABBDnZB/AdxQYAQaigCAHMgAEEWdkH8B3FBgAhqKAIAcyEAIAFBIGohASACQSBrIgJBH0sNAAsLIAJBA0sEQANAIAEoAgAgAHMiAEEGdkH8B3FBgBhqKAIAIABB/wFxQQJ0QYAgaigCAHMgAEEOdkH8B3FBgBBqKAIAcyAAQRZ2QfwHcUGACGooAgBzIQAgAUEEaiEBIAJBBGsiAkEDSw0ACwsCQCACRQ0AIAJBAXEEfyABLQAAIABB/wFxc0ECdEGACGooAgAgAEEIdnMhACABQQFqIQEgAkEBawUgAgshAyACQQFGDQADQCABLQABIAEtAAAgAEH/AXFzQQJ0QYAIaigCACAAQQh2cyIAQf8BcXNBAnRBgAhqKAIAIABBCHZzIQAgAUECaiEBIANBAmsiAw0ACwsgAEF/cwsKACAAIAEgAhAFC9wEAQN/AkBByN8ALQAAQTFHDQAgAEUNACAAQQA2AhggACgCICIBRQRAIABBADYCKCAAQQE2AiBBASEBCyAAKAIkRQRAIABBAjYCJAsgACgCKEEBQcQtIAERAAAiAUUNACAAIAE2AhwgAUEPNgIwIAFBADYCHCABQQA2AhggAUEqNgIEIAEgADYCACABQQs2AlAgAUGAgAI2AiwgAUH//wE2AjQgAUGAEDYCTCABQQQ2AlggAUH/DzYCVCABIAAoAihBgIACQQIgACgCIBEAADYCOCABIAAoAiggASgCLEECIAAoAiARAAA2AkAgACgCKCABKAJMQQIgACgCIBEAACECIAFBADYCwC0gASACNgJEIAFBgAg2ApwtIAEgACgCKEGACEEEIAAoAiARAAAiAjYCCCABIAEoApwtIgNBAnQ2AgwCQAJAIAEoAjhFDQAgASgCQEUNACACRQ0AIAEoAkQNAQsgAUGaBTYCBCAAQbjfACgCADYCGCAAEAgPCyABQQA2AogBIAFBCTYChAEgAUEIOgAkIAEgAiADQQNsajYCmC0gASACIANBfnFqNgKkLSAAEAkNACAAKAIcIgAgACgCLEEBdDYCPCAAKAJEIgEgACgCTEEBdEECayIDakEAOwEAIAEgAxAgIABBADYCtC0gAEKAgICAIDcCdCAAQgA3AmggAEKAgICAIDcCXCAAQQA2AkggACAAKAKEAUEMbCIBQYTIAGovAQA2ApABIAAgAUGAyABqLwEANgKMASAAIAFBgsgAai8BADYCgAEgACABQYbIAGovAQA2AnwLC6kCAQN/AkAgAEUNACAAKAIgRQ0AIAAoAiQiA0UNACAAKAIcIgFFDQAgASgCACAARw0AAkACQCABKAIEIgJBOWsOOQECAgICAgICAgICAgECAgIBAgICAgICAgICAgICAgICAgIBAgICAgICAgICAgIBAgICAgICAgICAQALIAJBmgVGDQAgAkEqRw0BCwJ/An8CfyABKAIIIgIEQCAAKAIoIAIgAxECACAAKAIcIQELIAEoAkQiAgsEQCAAKAIoIAIgACgCJBECACAAKAIcIQELIAEoAkAiAgsEQCAAKAIoIAIgACgCJBECACAAKAIcIQELIAEoAjgiAgsEQCAAKAIoIAIgACgCJBECACAAKAIcIQELIAAoAiggASAAKAIkEQIAIABBADYCHAsLlgIBA39BfiECAkAgAEUNACAAKAIgRQ0AIAAoAiRFDQAgACgCHCIBRQ0AIAEoAgAgAEcNAAJAAkAgASgCBCIDQTlrDjkBAgICAgICAgICAgIBAgICAQICAgICAgICAgICAgICAgICAQICAgICAgICAgICAQICAgICAgICAgEACyADQZoFRg0AIANBKkcNAQsgAEECNgIsIABBADYCCCAAQgA3AhQgAUEANgIUIAEgASgCCDYCECABKAIYIgJBf0wEQCABQQAgAmsiAjYCGAsgAUE5QSpB8QAgAhsgAkECRhs2AgQgAAJ/IAJBAkYEQEEAQQBBABAGDAELQQBBAEEAEAQLNgIwQQAhAiABQQA2AiggARAQCyACC9wIAQt/IAAoAiwiB0GGAmshCyAAKAJ0IQUgByEBA0AgACgCPCAFayAAKAJsIghrIQYgASALaiAITQRAIAAoAjgiASABIAdqIAcgBmsQHxogACAAKAJwIAdrNgJwIAAgACgCbCAHayIINgJsIAAgACgCXCAHazYCXCAAKAJMIgRBAWshCiAAKAJEIARBAXRqIQMgACgCLCEBIARBA3EiAgRAA0AgA0ECayIDQQAgAy8BACIFIAFrIgkgBSAJSRs7AQAgBEEBayEEIAJBAWsiAg0ACwsgCkEDTwRAA0AgA0ECayICQQAgAi8BACICIAFrIgUgAiAFSRs7AQAgA0EEayICQQAgAi8BACICIAFrIgUgAiAFSRs7AQAgA0EGayICQQAgAi8BACICIAFrIgUgAiAFSRs7AQAgA0EIayIDQQAgAy8BACICIAFrIgUgAiAFSRs7AQAgBEEEayIEDQALCyABQQFrIQogACgCQCABQQF0aiEDIAEhBCABQQNxIgIEQANAIANBAmsiA0EAIAMvAQAiBSABayIJIAUgCUkbOwEAIARBAWshBCACQQFrIgINAAsLIApBA08EQANAIANBAmsiAkEAIAIvAQAiAiABayIFIAIgBUkbOwEAIANBBGsiAkEAIAIvAQAiAiABayIFIAIgBUkbOwEAIANBBmsiAkEAIAIvAQAiAiABayIFIAIgBUkbOwEAIANBCGsiA0EAIAMvAQAiAiABayIFIAIgBUkbOwEAIARBBGsiBA0ACwsgBiAHaiEGCwJAIAAoAgAiASgCBCIERQ0AIAAoAnQhAiAGIAQgBCAGSxsiAwRAIAAoAjghBSABIAQgA2s2AgQgBSAIaiACaiABKAIAIAMQHyEEAkACQAJAIAEoAhwoAhhBAWsOAgABAgsgASABKAIwIAQgAxAENgIwDAELIAEgASgCMCAEIAMQBjYCMAsgASABKAIAIANqNgIAIAEgASgCCCADajYCCCAAKAJ0IQILIAAgAiADaiIFNgJ0AkAgACgCtC0iAyAFakEDSQ0AIAAgACgCOCIJIAAoAmwgA2siAWoiBC0AACICNgJIIAAgACgCVCIIIAQtAAEgAiAAKAJYIgZ0c3EiBDYCSANAIANFDQEgACABIAlqLQACIAQgBnRzIAhxIgQ2AkggACgCQCAAKAI0IAFxQQF0aiAAKAJEIARBAXRqIgIvAQA7AQAgAiABOwEAIAAgA0EBayIDNgK0LSABQQFqIQEgAyAFakECSw0ACwsgBUGFAksNACAAKAIAKAIERQ0AIAAoAiwhAQwBCwsCQCAAKAI8IgQgACgCwC0iAU0NACAAKAJ0IAAoAmxqIgMgAUsEQCAAKAI4IANqIAQgA2siAUGCAiABQYICSRsiARAgIAAgASADajYCwC0PCyADQYICaiIDIAFNDQAgACgCOCABaiAEIAFrIgQgAyABayIBIAEgBEsbIgEQICAAIAAoAsAtIAFqNgLALQsLsSwBCn8CQCAARQ0AIAAoAiBFDQAgACgCJEUNACAAKAIcIgFFDQAgASgCACAARw0AAkACQCABKAIEIgNBOWsOOQECAgICAgICAgICAgECAgIBAgICAgICAgICAgICAgICAgIBAgICAgICAgICAgIBAgICAgICAgICAQALIANBmgVGDQAgA0EqRw0BCwJAAkAgACgCDEUNACAAKAIEIgIEQCAAKAIARQ0BCyADQZoFRw0BCyAAQbDfACgCADYCGA8LIAAoAhBFBEAgAEG83wAoAgA2AhgPCyABKAIoIQUgAUEDNgIoAkAgASgCFARAIAEQEwJAIAAoAhAiAyABKAIUIgQgAyAESRsiAkUNACAAKAIMIAEoAhAgAhAfGiAAIAAoAgwgAmo2AgwgASABKAIQIAJqNgIQIAAgACgCFCACajYCFCAAIAAoAhAgAmsiAzYCECABIAEoAhQgAmsiBDYCFCAEDQAgASABKAIINgIQQQAhBAsgAwRAIAEoAgQhAwwCCyABQX82AigPCyACDQAgBUEBdEF3QQAgBUEEShtqQQZIDQAgAEG83wAoAgA2AhgPCwJAAkACQAJAAn8CQAJAAkACQAJAAkAgA0EqRwRAIANBmgVHDQEgACgCBEUNAiAAQbzfACgCADYCGA8LIAEoAjBBDHRBgPABayEDQQAhAgJAIAEoAogBQQFKDQAgASgChAEiBUECSA0AQcAAIQIgBUEGSA0AQYABQcABIAVBBkYbIQILIAEgBEEBajYCFCABKAIIIARqIAIgA3IiAkEgciACIAEoAmwbIgJBCHY6AAAgASABKAIUIgNBAWo2AhQgAyABKAIIaiACQR9wIAJyQR9zOgAAIAEoAmwEQCAAKAIwIQIgASABKAIUIgNBAWo2AhQgAyABKAIIaiACQRh2OgAAIAEgASgCFCIDQQFqNgIUIAMgASgCCGogAkEQdjoAACAAKAIwIQIgASABKAIUIgNBAWo2AhQgAyABKAIIaiACQQh2OgAAIAEgASgCFCIDQQFqNgIUIAMgASgCCGogAjoAAAsgAEEAQQBBABAENgIwIAFB8QA2AgQgACgCHCICEBMCQCAAKAIQIgMgAigCFCIEIAMgBEkbIgNFDQAgACgCDCACKAIQIAMQHxogACAAKAIMIANqNgIMIAIgAigCECADajYCECAAIAAoAhQgA2o2AhQgACAAKAIQIANrNgIQIAIgAigCFCADayIDNgIUIAMNACACIAIoAgg2AhALIAEoAhQNBCABKAIEIQMLAkACQAJAAkACQAJAAkAgA0E5RgR/IABBAEEAQQAQBjYCMCABIAEoAhQiAkEBajYCFCACIAEoAghqQR86AAAgASABKAIUIgJBAWo2AhQgAiABKAIIakGLAToAACABIAEoAhQiAkEBajYCFCACIAEoAghqQQg6AAAgASgCHCICDQIgASABKAIUIgJBAWo2AhQgAiABKAIIakEAOgAAIAEgASgCFCICQQFqNgIUIAIgASgCCGpBADoAACABIAEoAhQiAkEBajYCFCACIAEoAghqQQA6AAAgASABKAIUIgJBAWo2AhQgAiABKAIIakEAOgAAIAEgASgCFCICQQFqNgIUIAIgASgCCGpBADoAAEECIQIgASgChAEiA0EJRwRAQQQgASgCiAFBAUpBAnQgA0ECSBshAgsgASABKAIUIgNBAWo2AhQgAyABKAIIaiACOgAAIAEgASgCFCICQQFqNgIUIAIgASgCCGpBAzoAACABQfEANgIEIAAoAhwiAhATAkAgACgCECIDIAIoAhQiBCADIARJGyIDRQ0AIAAoAgwgAigCECADEB8aIAAgACgCDCADajYCDCACIAIoAhAgA2o2AhAgACAAKAIUIANqNgIUIAAgACgCECADazYCECACIAIoAhQgA2siAzYCFCADDQAgAiACKAIINgIQCyABKAIUDQEgASgCBAUgAwtBxQBrDiMCBgYGAwYGBgYGBgYGBgYGBgYGBgYGBAYGBgYGBgYGBgYGBQYLIAFBfzYCKA8LIAIoAiQhAyACKAIcIQQgAigCECEFIAIoAiwhBiACKAIAIQggASABKAIUIgdBAWo2AhRBAiECIAcgASgCCGogBkEAR0EBdCAIQQBHciAFQQBHQQJ0ciAEQQBHQQN0ciADQQBHQQR0cjoAACABKAIcKAIEIQMgASABKAIUIgRBAWo2AhQgBCABKAIIaiADOgAAIAEoAhwoAgQhAyABIAEoAhQiBEEBajYCFCAEIAEoAghqIANBCHY6AAAgASgCHC8BBiEDIAEgASgCFCIEQQFqNgIUIAQgASgCCGogAzoAACABKAIcLQAHIQMgASABKAIUIgRBAWo2AhQgBCABKAIIaiADOgAAIAEoAoQBIgNBCUcEQEEEIAEoAogBQQFKQQJ0IANBAkgbIQILIAEgASgCFCIDQQFqNgIUIAMgASgCCGogAjoAACABKAIcKAIMIQIgASABKAIUIgNBAWo2AhQgAyABKAIIaiACOgAAIAEoAhwiAigCEAR/IAIoAhQhAiABIAEoAhQiA0EBajYCFCADIAEoAghqIAI6AAAgASgCHCgCFCECIAEgASgCFCIDQQFqNgIUIAMgASgCCGogAkEIdjoAACABKAIcBSACCygCLARAIAAgACgCMCABKAIIIAEoAhQQBjYCMAsgAUHFADYCBCABQQA2AiALIAEoAhwiBCgCECIDBEAgASgCFCICIAQvARQgASgCICIGayIFaiABKAIMIgRLBEADQCABKAIIIAJqIAMgBmogBCACayIEEB8aIAEgASgCDCIDNgIUAkAgAiADTw0AIAEoAhwoAixFDQAgACAAKAIwIAEoAgggAmogAyACaxAGNgIwCyABIAEoAiAgBGo2AiAgACgCHCICEBMCQCAAKAIQIgMgAigCFCIGIAMgBkkbIgNFDQAgACgCDCACKAIQIAMQHxogACAAKAIMIANqNgIMIAIgAigCECADajYCECAAIAAoAhQgA2o2AhQgACAAKAIQIANrNgIQIAIgAigCFCADayIDNgIUIAMNACACIAIoAgg2AhALIAEoAhQEQCABQX82AigPCyABKAIgIQYgASgCHCgCECEDQQAhAiAFIARrIgUgASgCDCIESw0ACwsgASgCCCACaiADIAZqIAUQHxogASABKAIUIAVqIgM2AhQCQCACIANPDQAgASgCHCgCLEUNACAAIAAoAjAgASgCCCACaiADIAJrEAY2AjALIAFBADYCIAsgAUHJADYCBAsgASgCHCgCHARAIAEoAhQiAiEFA0ACQCACIAEoAgxHDQACQCACIAVNDQAgASgCHCgCLEUNACAAIAAoAjAgASgCCCAFaiACIAVrEAY2AjALIAAoAhwiAhATAkAgACgCECIDIAIoAhQiBCADIARJGyIDRQ0AIAAoAgwgAigCECADEB8aIAAgACgCDCADajYCDCACIAIoAhAgA2o2AhAgACAAKAIUIANqNgIUIAAgACgCECADazYCECACIAIoAhQgA2siAzYCFCADDQAgAiACKAIINgIQC0EAIQJBACEFIAEoAhRFDQAgAUF/NgIoDwsgASgCHCgCHCEDIAEgASgCICIEQQFqNgIgIAMgBGotAAAhAyABIAJBAWo2AhQgASgCCCACaiADOgAAIAMEQCABKAIUIQIMAQsLAkAgASgCHCgCLEUNACABKAIUIgIgBU0NACAAIAAoAjAgASgCCCAFaiACIAVrEAY2AjALIAFBADYCIAsgAUHbADYCBAsCQCABKAIcKAIkRQ0AIAEoAhQiAiEFA0ACQCACIAEoAgxHDQACQCACIAVNDQAgASgCHCgCLEUNACAAIAAoAjAgASgCCCAFaiACIAVrEAY2AjALIAAoAhwiAhATAkAgACgCECIDIAIoAhQiBCADIARJGyIDRQ0AIAAoAgwgAigCECADEB8aIAAgACgCDCADajYCDCACIAIoAhAgA2o2AhAgACAAKAIUIANqNgIUIAAgACgCECADazYCECACIAIoAhQgA2siAzYCFCADDQAgAiACKAIINgIQC0EAIQJBACEFIAEoAhRFDQAgAUF/NgIoDwsgASgCHCgCJCEDIAEgASgCICIEQQFqNgIgIAMgBGotAAAhAyABIAJBAWo2AhQgASgCCCACaiADOgAAIAMEQCABKAIUIQIMAQsLIAEoAhwoAixFDQAgASgCFCICIAVNDQAgACAAKAIwIAEoAgggBWogAiAFaxAGNgIwCyABQecANgIECyABKAIcKAIsBEAgASgCDCABKAIUIgJBAmpJBEAgACgCHCICEBMCQCAAKAIQIgMgAigCFCIEIAMgBEkbIgNFDQAgACgCDCACKAIQIAMQHxogACAAKAIMIANqNgIMIAIgAigCECADajYCECAAIAAoAhQgA2o2AhQgACAAKAIQIANrNgIQIAIgAigCFCADayIDNgIUIAMNACACIAIoAgg2AhALIAEoAhQNBUEAIQILIAAoAjAhAyABIAJBAWo2AhQgASgCCCACaiADOgAAIAAoAjAhAiABIAEoAhQiA0EBajYCFCADIAEoAghqIAJBCHY6AAAgAEEAQQBBABAGNgIwCyABQfEANgIEIAAoAhwiAhATAkAgACgCECIDIAIoAhQiBCADIARJGyIDRQ0AIAAoAgwgAigCECADEB8aIAAgACgCDCADajYCDCACIAIoAhAgA2o2AhAgACAAKAIUIANqNgIUIAAgACgCECADazYCECACIAIoAhQgA2siAzYCFCADDQAgAiACKAIINgIQCyABKAIURQ0AIAFBfzYCKA8LIAAoAgQNAQsgASgCdA0AIAEoAgRBmgVGDQgLIAEoAoQBIgJFBEAgAUEDEAwMBAsCQAJAIAEoAogBQQJrDgIAAQQLA0ACQAJAIAEoAnQNACABEAogASgCdA0AIAFBADYCtC0MAQsgAUEANgJgIAEoAjggASgCbGotAAAhAiABKAKkLSABKAKgLSIDQQF0akEAOwEAIAEgA0EBajYCoC0gAyABKAKYLWogAjoAACABIAJBAnRqQZQBaiICIAIvAQBBAWo7AQAgASABKAJ0QQFrNgJ0IAEgASgCbEEBaiICNgJsIAEoAqAtIAEoApwtQQFrRw0BIAEgASgCXCIEQQBOBH8gASgCOCAEagVBAAsgAiAEa0EAEBQgASABKAJsNgJcIAEoAgAiAigCHCIDEBMCQCACKAIQIgQgAygCFCIFIAQgBUkbIgRFDQAgAigCDCADKAIQIAQQHxogAiACKAIMIARqNgIMIAMgAygCECAEajYCECACIAIoAhQgBGo2AhQgAiACKAIQIARrNgIQIAMgAygCFCAEayICNgIUIAINACADIAMoAgg2AhALIAEoAgAoAhANAQwHCwsgASgCoC1FDQcgASABKAJcIgNBAE4EfyABKAI4IANqBUEACyABKAJsIANrQQAQFCABIAEoAmw2AlwgASgCACICKAIcIgMQEwJAIAIoAhAiBCADKAIUIgUgBCAFSRsiBEUNACACKAIMIAMoAhAgBBAfGiACIAIoAgwgBGo2AgwgAyADKAIQIARqNgIQIAIgAigCFCAEajYCFCACIAIoAhAgBGs2AhAgAyADKAIUIARrIgI2AhQgAg0AIAMgAygCCDYCEAsgASgCACgCEEUNBQwHCwNAAkACQAJAIAEoAnQiAkGDAk8EQCABQQA2AmAMAQsgARAKIAEoAnQiAgRAIAFBADYCYCACQQJLDQEgASgCbCEDDAILIAFBADYCtC0gASgCoC1FDQogASABKAJcIgNBAE4EfyABKAI4IANqBUEACyABKAJsIANrQQAQFCABIAEoAmw2AlwgASgCACICKAIcIgMQEwJAIAIoAhAiBCADKAIUIgUgBCAFSRsiBEUNACACKAIMIAMoAhAgBBAfGiACIAIoAgwgBGo2AgwgAyADKAIQIARqNgIQIAIgAigCFCAEajYCFCACIAIoAhAgBGs2AhAgAyADKAIUIARrIgI2AhQgAg0AIAMgAygCCDYCEAsgASgCACgCEEUNCAwKCyABKAJsIgNFBEBBACEDDAELIAEoAjggA2oiBkEBayIFLQAAIgQgBi0AAEcNACAEIAUtAAJHDQAgBCAFLQADRw0AIAZBggJqIQlBfyEIAkACQAJAAkACQAJAA0AgBiAIaiIFLQAEIARGBEAgBCAFLQAFRw0CIAQgBS0ABkcNAyAEIAUtAAdHDQQgBCAGIAhBCGoiCmoiBy0AAEcNByAEIAUtAAlHDQUgBCAFLQAKRw0GIAVBC2ohByAIQfYBSg0HIAohCCAEIActAABGDQEMBwsLIAVBBGohBwwFCyAFQQVqIQcMBAsgBUEGaiEHDAMLIAVBB2ohBwwCCyAFQQlqIQcMAQsgBUEKaiEHCyABIAIgByAJa0GCAmoiBCACIARJGyICNgJgIAJBA0kNACABKAKkLSABKAKgLSIDQQF0akEBOwEAIAEgA0EBajYCoC0gAyABKAKYLWogAkEDayICOgAAIAJB/wFxQYDNAGotAABBAnQgAWpBmAlqIgIgAi8BAEEBajsBACABQYDJAC0AAEECdGpBiBNqIgIgAi8BAEEBajsBACABKAJgIQIgAUEANgJgIAEgASgCdCACazYCdCABIAIgASgCbGoiAjYCbCABKAKgLSABKAKcLUEBa0cNAgwBCyABKAI4IANqLQAAIQIgASgCpC0gASgCoC0iA0EBdGpBADsBACABIANBAWo2AqAtIAMgASgCmC1qIAI6AAAgASACQQJ0akGUAWoiAiACLwEAQQFqOwEAIAEgASgCdEEBazYCdCABIAEoAmxBAWoiAjYCbCABKAKgLSABKAKcLUEBa0cNAQsgASABKAJcIgRBAE4EfyABKAI4IARqBUEACyACIARrQQAQFCABIAEoAmw2AlwgASgCACICKAIcIgMQEwJAIAIoAhAiBCADKAIUIgUgBCAFSRsiBEUNACACKAIMIAMoAhAgBBAfGiACIAIoAgwgBGo2AgwgAyADKAIQIARqNgIQIAIgAigCFCAEajYCFCACIAIoAhAgBGs2AhAgAyADKAIUIARrIgI2AhQgAg0AIAMgAygCCDYCEAsgASgCACgCEA0ACwwECyABQX82AigPCyABQX82AigPCyABQQMgAkEMbEGIyABqKAIAEQQACyICQX5xQQJGBEAgAUGaBTYCBAsgAkF9cQ0BCyAAKAIQDQMgAUF/NgIoDwsgAkEBRw0BCyABQQBBAEEAEBIgASgCRCICIAEoAkxBAXRBAmsiA2pBADsBACACIAMQICABKAJ0RQRAIAFBADYCtC0gAUEANgJcIAFBADYCbAsgACgCHCICEBMCQCAAKAIQIgQgAigCFCIDIAMgBEsbIgNFDQAgACgCDCACKAIQIAMQHxogACAAKAIMIANqNgIMIAIgAigCECADajYCECAAIAAoAhQgA2o2AhQgACAAKAIQIANrIgQ2AhAgAiACKAIUIANrIgM2AhQgAw0AIAIgAigCCDYCEAsgBA0AIAFBfzYCKAsLC7YNAQt/IAAoAgAiBCgCBCEJQQEhCAJAIAQoAhAiAyAAKAK8LUEqakEDdSICSQ0AIAAoAiwiBSAAKAIMQQVrIgYgBSAGSRshCiABQQRHIQsDQCAKIAMgAmsiAyAAKAJsIAAoAlxrIgYgBCgCBGoiAkH//wMgAkH//wNJGyIFIAMgBUkbIgNLBEAgAiADRw0CIAFFDQIgCyADRXENAgsgAEEAQQAgAUEERiACIANGcSIHEBIgACgCFCAAKAIIakEEayADOgAAIAAoAhQgACgCCGpBA2sgA0EIdjoAACAAKAIUIAAoAghqQQJrIANBf3MiAjoAACAAKAIUIAAoAghqQQFrIAJBCHY6AAAgACgCACICKAIcIgQQEwJAIAIoAhAiBSAEKAIUIgwgBSAMSRsiBUUNACACKAIMIAQoAhAgBRAfGiACIAIoAgwgBWo2AgwgBCAEKAIQIAVqNgIQIAIgAigCFCAFajYCFCACIAIoAhAgBWs2AhAgBCAEKAIUIAVrIgI2AhQgAg0AIAQgBCgCCDYCEAsCfyAGBEAgACgCACgCDCAAKAI4IAAoAlxqIAMgBiADIAZJGyICEB8aIAAoAgAiBCAEKAIMIAJqNgIMIAQgBCgCECACazYCECAEIAQoAhQgAmo2AhQgACAAKAJcIAJqNgJcIAMgAmshAwsgAwsEQCAAKAIAIgIoAgwhBSADIAIoAgQiBiADIAZJGyIEBEAgAiAGIARrNgIEIAUgAigCACAEEB8hBQJAAkACQCACKAIcKAIYQQFrDgIAAQILIAIgAigCMCAFIAQQBDYCMAwBCyACIAIoAjAgBSAEEAY2AjALIAIgAigCACAEajYCACACIAIoAgggBGo2AgggACgCACICKAIMIQULIAIgAyAFajYCDCACIAIoAhAgA2s2AhAgAiACKAIUIANqNgIUCyAAKAIAIQQgBwRAQQAhCAwCCyAEKAIQIgMgACgCvC1BKmpBA3UiAk8NAAsLAkAgCSAEKAIEayIDRQRAIAAoAmwhAgwBCwJAIAAoAiwiAiADTQRAIABBAjYCsC0gACgCOCAEKAIAIAJrIAIQHxogACAAKAIsIgQ2AmwgBCECDAELAkAgACgCPCAAKAJsIgRrIANLDQAgACAEIAJrIgQ2AmwgACgCOCIFIAIgBWogBBAfGiAAKAKwLSICQQFLDQAgACACQQFqNgKwLQsgACgCOCAAKAJsaiAAKAIAKAIAIANrIAMQHxogACAAKAJsIANqIgI2AmwgACgCLCEECyAAIAI2AlwgACAEIAAoArQtIgVrIgQgAyADIARLGyAFajYCtC0LIAIgACgCwC1LBEAgACACNgLALQtBAyEDAkAgCEUNACAAKAIAIgQoAgQhAwJAAkAgAUF7cUUNACADDQBBASEDIAIgACgCXEYNAiAAKAI8IAJBf3NqIQVBACEDDAELIAMgACgCPCACQX9zaiIFTQ0AIAAoAlwiByAAKAIsIgZIDQAgACACIAZrIgM2AmwgACAHIAZrNgJcIAAoAjgiAiACIAZqIAMQHxogACgCsC0iA0EBTQRAIAAgA0EBajYCsC0LIAAoAiwgBWohBSAAKAIAIgQoAgQhAwsCQCADIAUgAyAFSRsiAkUEQCAAKAJsIQMMAQsgACgCbCEFIAAoAjghBiAEIAMgAms2AgQgBSAGaiAEKAIAIAIQHyEDAkACQAJAIAQoAhwoAhhBAWsOAgABAgsgBCAEKAIwIAMgAhAENgIwDAELIAQgBCgCMCADIAIQBjYCMAsgBCAEKAIAIAJqNgIAIAQgBCgCCCACajYCCCAAIAAoAmwgAmoiAzYCbAsgAyAAKALALUsEQCAAIAM2AsAtCyADIAAoAlwiBmsiBCAAKAIsIgMgACgCDCAAKAK8LUEqakEDdWsiAkH//wMgAkH//wNJGyICIAIgA0sbSQRAQQAhAyABRQ0BIAFBBEYgBEEAR3JFDQEgAiAESQ0BIAAoAgAoAgQNAQtBACEFIAAgACgCOCAGaiACIAQgAiAESRsiAwJ/IAFBBEYEQCAAKAIAKAIERSACIARPcSEFCyAFCxASIAAgACgCXCADajYCXCAAKAIAIgAoAhwiAxATAkAgACgCECICIAMoAhQiBCACIARJGyICRQ0AIAAoAgwgAygCECACEB8aIAAgACgCDCACajYCDCADIAMoAhAgAmo2AhAgACAAKAIUIAJqNgIUIAAgACgCECACazYCECADIAMoAhQgAmsiADYCFCAADQAgAyADKAIINgIQC0ECQQAgBRshAwsgAwu5CwENfwJAA0ACQAJAIAAoAnRBhQJNBEAgABAKIAAoAnQhAgJAIAENACACQYYCTw0AQQAPCyACRQ0EIAJBA0kNAQsgACAAKAJUIAAoAmwiAiAAKAI4ai0AAiAAKAJIIAAoAlh0c3EiAzYCSCAAKAJAIAIgACgCNHFBAXRqIAAoAkQgA0EBdGoiBC8BACIDOwEAIAQgAjsBACADRQ0AIAAoAixBhgJrIAIgA2tJDQAgACAAIAMQDiICNgJgDAELIAAoAmAhAgsCQCACQQNPBEAgACgCpC0gACgCoC0iA0EBdGogACgCbCAAKAJwayIEOwEAIAAgA0EBajYCoC0gAyAAKAKYLWogAkEDayICOgAAIAJB/wFxQYDNAGotAABBAnQgAGpBmAlqIgIgAi8BAEEBajsBACAAIARBAWtB//8DcSICIAJBB3ZBgAJqIAJBgAJJG0GAyQBqLQAAQQJ0akGIE2oiAiACLwEAQQFqOwEAIAAgACgCdCAAKAJgIgJrIgM2AnQgACgCnC1BAWshBiAAKAKgLSEHAkAgA0EDSQ0AIAIgACgCgAFLDQAgACACQQFrIgM2AmAgACgCSCEEIAAoAmwhAiAAKAI0IQggACgCQCEJIAAoAkQhCiAAKAJUIQsgACgCOCEMIAAoAlghDQNAIAAgAiIFQQFqIgI2AmwgACAFIAxqLQADIAQgDXRzIAtxIgQ2AkggCSACIAhxQQF0aiAKIARBAXRqIg4vAQA7AQAgDiACOwEAIAAgA0EBayIDNgJgIAMNAAsgACAFQQJqIgI2AmwgBiAHRw0DDAILIABBADYCYCAAIAAoAmwgAmoiAjYCbCAAIAAoAjggAmoiAy0AACIENgJIIAAgACgCVCADLQABIAQgACgCWHRzcTYCSCAGIAdHDQIMAQsgACgCOCAAKAJsai0AACECIAAoAqQtIAAoAqAtIgNBAXRqQQA7AQAgACADQQFqNgKgLSADIAAoApgtaiACOgAAIAAgAkECdGpBlAFqIgIgAi8BAEEBajsBACAAIAAoAnRBAWs2AnQgACAAKAJsQQFqIgI2AmwgACgCoC0gACgCnC1BAWtHDQELQQAhAyAAIAAoAlwiBEEATgR/IAAoAjggBGoFIAMLIAIgBGtBABAUIAAgACgCbDYCXCAAKAIAIgIoAhwiAxATAkAgAigCECIEIAMoAhQiBSAEIAVJGyIERQ0AIAIoAgwgAygCECAEEB8aIAIgAigCDCAEajYCDCADIAMoAhAgBGo2AhAgAiACKAIUIARqNgIUIAIgAigCECAEazYCECADIAMoAhQgBGsiAjYCFCACDQAgAyADKAIINgIQCyAAKAIAKAIQDQALQQAPCyAAIAAoAmwiAkECIAJBAkkbNgK0LSABQQRGBEBBACEDIAAgACgCXCIEQQBOBH8gACgCOCAEagUgAwsgAiAEa0EBEBQgACAAKAJsNgJcIAAoAgAiAigCHCIDEBMCQCACKAIQIgQgAygCFCIFIAQgBUkbIgRFDQAgAigCDCADKAIQIAQQHxogAiACKAIMIARqNgIMIAMgAygCECAEajYCECACIAIoAhQgBGo2AhQgAiACKAIQIARrNgIQIAMgAygCFCAEayICNgIUIAINACADIAMoAgg2AhALQQNBAiAAKAIAKAIQGw8LAkAgACgCoC1FDQBBACEDIAAgACgCXCIEQQBOBH8gACgCOCAEagUgAwsgAiAEa0EAEBQgACAAKAJsNgJcIAAoAgAiAigCHCIDEBMCQCACKAIQIgQgAygCFCIFIAQgBUkbIgRFDQAgAigCDCADKAIQIAQQHxogAiACKAIMIARqNgIMIAMgAygCECAEajYCECACIAIoAhQgBGo2AhQgAiACKAIQIARrNgIQIAMgAygCFCAEayICNgIUIAINACADIAMoAgg2AhALIAAoAgAoAhANAEEADwtBAQukBAEQfyAAKAJ8IgMgA0ECdiAAKAJ4IgQgACgCjAFJGyEJQQAgACgCbCIDIAAoAixrQYYCaiICIAIgA0sbIQwgACgCdCIHIAAoApABIgIgAiAHSxshDSAAKAI4Ig4gA2oiBUGCAmohDyAEIAVqIgMtAAAhCiADQQFrLQAAIQsgACgCNCEQIAAoAkAhEQNAAkACQCABIA5qIgMgBGoiAi0AACAKRw0AIAJBAWstAAAgC0cNACADLQAAIAUtAABHDQBBAiEGIAMtAAEgBS0AAUcNAAJAAkACQAJAAkACQAJAA0AgBSAGaiICLQABIAMtAANHDQYgAi0AAiADLQAERw0FIAItAAMgAy0ABUcNBCACLQAEIAMtAAZHDQMgAi0ABSADLQAHRw0CIAItAAYgAy0ACEcNASACLQAHIAMtAAlGBEAgBkH5AUshCCAFIAZBCGoiBmohAiAIDQggAy0ACiEIIANBCGohAyACLQAAIAhGDQEMCAsLIAJBB2ohAgwGCyACQQZqIQIMBQsgAkEFaiECDAQLIAJBBGohAgwDCyACQQNqIQIMAgsgAkECaiECDAELIAJBAWohAgsgAiAPayICQYICaiIDIARMDQAgACABNgJwIAMgDU4EQCADIQQMAgsgAyAFai0AACEKIAIgBWotAIECIQsgAyEECyAJQQFrIglFDQAgDCARIAEgEHFBAXRqLwEAIgFJDQELCyAHIAQgBCAHSxsL3Q4BB38DQAJAAkACQCAAKAJ0QYUCSw0AIAAQCiAAKAJ0IQICQCABDQAgAkGGAk8NAEEADwsgAkUNAiACQQJLDQAgACAAKAJgIgI2AnggACAAKAJwNgJkQQIhAyAAQQI2AmAMAQtBAiEDIAAgACgCVCAAKAJsIgIgACgCOGotAAIgACgCSCAAKAJYdHNxIgQ2AkggACgCQCACIAAoAjRxQQF0aiAAKAJEIARBAXRqIgUvAQAiBDsBACAFIAI7AQAgACAAKAJgIgI2AnggACAAKAJwNgJkIABBAjYCYCAERQ0AAkAgAiAAKAKAAU8NACAAKAIsQYYCayAAKAJsIARrSQ0AIAAgACAEEA4iAzYCYCADQQVLDQAgACgCiAFBAUcEQCADQQNHDQFBAyEDIAAoAmwgACgCcGtBgSBJDQELQQIhAyAAQQI2AmALIAAoAnghAgsCQCACQQNJDQAgAiADSQ0AIAAoAnQhBCAAKAKkLSAAKAKgLSIDQQF0aiAAKAJsIgUgACgCZEF/c2oiBjsBACAAIANBAWo2AqAtIAMgACgCmC1qIAJBA2siAjoAACACQf8BcUGAzQBqLQAAQQJ0IABqQZgJaiICIAIvAQBBAWo7AQAgACAGQQFrQf//A3EiAiACQQd2QYACaiACQYACSRtBgMkAai0AAEECdGpBiBNqIgIgAi8BAEEBajsBACAAIAAoAngiAkECayIDNgJ4IAAgACgCdCACa0EBajYCdCAEIAVqQQNrIQUgACgCnC1BAWshByAAKAJsIQIgACgCoC0hCANAIAAgAiIEQQFqIgI2AmwgAiAFTQRAIAAgACgCVCAEIAAoAjhqLQADIAAoAkggACgCWHRzcSIGNgJIIAAoAkAgACgCNCACcUEBdGogACgCRCAGQQF0aiIGLwEAOwEAIAYgAjsBAAsgACADQQFrIgM2AnggAw0ACyAAQQI2AmAgAEEANgJoIAAgBEECaiICNgJsIAcgCEcNAkEAIQMgACAAKAJcIgRBAE4EfyAAKAI4IARqBSADCyACIARrQQAQFCAAIAAoAmw2AlwgACgCACICKAIcIgMQEwJAIAIoAhAiBCADKAIUIgUgBCAFSRsiBEUNACACKAIMIAMoAhAgBBAfGiACIAIoAgwgBGo2AgwgAyADKAIQIARqNgIQIAIgAigCFCAEajYCFCACIAIoAhAgBGs2AhAgAyADKAIUIARrIgI2AhQgAg0AIAMgAygCCDYCEAsgACgCACgCEA0CQQAPCyAAKAJoBEAgACgCbCAAKAI4akEBay0AACECIAAoAqQtIAAoAqAtIgNBAXRqQQA7AQAgACADQQFqNgKgLSADIAAoApgtaiACOgAAIAAgAkECdGpBlAFqIgIgAi8BAEEBajsBAAJAIAAoAqAtIAAoApwtQQFrRw0AQQAhAyAAIAAoAlwiAkEATgR/IAAoAjggAmoFIAMLIAAoAmwgAmtBABAUIAAgACgCbDYCXCAAKAIAIgIoAhwiAxATIAIoAhAiBCADKAIUIgUgBCAFSRsiBEUNACACKAIMIAMoAhAgBBAfGiACIAIoAgwgBGo2AgwgAyADKAIQIARqNgIQIAIgAigCFCAEajYCFCACIAIoAhAgBGs2AhAgAyADKAIUIARrIgI2AhQgAg0AIAMgAygCCDYCEAsgACAAKAJsQQFqNgJsIAAgACgCdEEBazYCdCAAKAIAKAIQDQJBAA8FIABBATYCaCAAIAAoAmxBAWo2AmwgACAAKAJ0QQFrNgJ0DAILAAsLIAAoAmgEQCAAKAJsIAAoAjhqQQFrLQAAIQIgACgCpC0gACgCoC0iA0EBdGpBADsBACAAIANBAWo2AqAtIAMgACgCmC1qIAI6AAAgACACQQJ0akGUAWoiAiACLwEAQQFqOwEAIABBADYCaAsgACAAKAJsIgJBAiACQQJJGzYCtC0gAUEERgRAQQAhAyAAIAAoAlwiBEEATgR/IAAoAjggBGoFIAMLIAIgBGtBARAUIAAgACgCbDYCXCAAKAIAIgIoAhwiAxATAkAgAigCECIEIAMoAhQiBSAEIAVJGyIERQ0AIAIoAgwgAygCECAEEB8aIAIgAigCDCAEajYCDCADIAMoAhAgBGo2AhAgAiACKAIUIARqNgIUIAIgAigCECAEazYCECADIAMoAhQgBGsiAjYCFCACDQAgAyADKAIINgIQC0EDQQIgACgCACgCEBsPCwJAIAAoAqAtRQ0AQQAhAyAAIAAoAlwiBEEATgR/IAAoAjggBGoFIAMLIAIgBGtBABAUIAAgACgCbDYCXCAAKAIAIgIoAhwiAxATAkAgAigCECIEIAMoAhQiBSAEIAVJGyIERQ0AIAIoAgwgAygCECAEEB8aIAIgAigCDCAEajYCDCADIAMoAhAgBGo2AhAgAiACKAIUIARqNgIUIAIgAigCECAEazYCECADIAMoAhQgBGsiAjYCFCACDQAgAyADKAIINgIQCyAAKAIAKAIQDQBBAA8LQQELYQAgAEEANgK8LSAAQQA7AbgtIABBuBZqQajPADYCACAAIABB/BRqNgKwFiAAQawWakGUzwA2AgAgACAAQYgTajYCpBYgAEGgFmpBgM8ANgIAIAAgAEGUAWo2ApgWIAAQEQvwBAEDfyAAQZQBaiECA0AgAiABQQJ0IgNqQQA7AQAgAiADQQRyakEAOwEAIAFBAmoiAUGeAkcNAAsgAEEAOwH8FCAAQQA7AYgTIABBxBVqQQA7AQAgAEHAFWpBADsBACAAQbwVakEAOwEAIABBuBVqQQA7AQAgAEG0FWpBADsBACAAQbAVakEAOwEAIABBrBVqQQA7AQAgAEGoFWpBADsBACAAQaQVakEAOwEAIABBoBVqQQA7AQAgAEGcFWpBADsBACAAQZgVakEAOwEAIABBlBVqQQA7AQAgAEGQFWpBADsBACAAQYwVakEAOwEAIABBiBVqQQA7AQAgAEGEFWpBADsBACAAQYAVakEAOwEAIABB/BNqQQA7AQAgAEH4E2pBADsBACAAQfQTakEAOwEAIABB8BNqQQA7AQAgAEHsE2pBADsBACAAQegTakEAOwEAIABB5BNqQQA7AQAgAEHgE2pBADsBACAAQdwTakEAOwEAIABB2BNqQQA7AQAgAEHUE2pBADsBACAAQdATakEAOwEAIABBzBNqQQA7AQAgAEHIE2pBADsBACAAQcQTakEAOwEAIABBwBNqQQA7AQAgAEG8E2pBADsBACAAQbgTakEAOwEAIABBtBNqQQA7AQAgAEGwE2pBADsBACAAQawTakEAOwEAIABBqBNqQQA7AQAgAEGkE2pBADsBACAAQaATakEAOwEAIABBnBNqQQA7AQAgAEGYE2pBADsBACAAQZQTakEAOwEAIABBkBNqQQA7AQAgAEGME2pBADsBACAAQgA3AqwtIABBlAlqQQE7AQAgAEEANgKoLSAAQQA2AqAtC7IDAQJ/IAAgAC8BuC0gA0H//wNxIgUgACgCvC0iBHRyIgM7AbgtAkACQAJ/IARBDk4EQCAAIAAoAhQiBEEBajYCFCAEIAAoAghqIAM6AAAgACAAKAIUIgNBAWo2AhQgAyAAKAIIaiAAQbktai0AADoAACAAIAVBECAAKAK8LSIEa3YiAzsBuC0gBEENawwBCyAEQQNqCyIEQQlOBEAgACAAKAIUIgRBAWo2AhQgBCAAKAIIaiADOgAAIAAgACgCFCIDQQFqNgIUIAMgACgCCGohBCAAQbktai0AACEDDAELIARBAUgNASAAIAAoAhQiBEEBajYCFCAEIAAoAghqIQQLIAQgAzoAAAsgAEEANgK8LSAAQQA7AbgtIAAgACgCFCIDQQFqNgIUIAMgACgCCGogAjoAACAAIAAoAhQiA0EBajYCFCADIAAoAghqIAJBCHY6AAAgACAAKAIUIgNBAWo2AhQgAyAAKAIIaiACQX9zIgM6AAAgACAAKAIUIgRBAWo2AhQgBCAAKAIIaiADQQh2OgAAIAAoAgggACgCFGogASACEB8aIAAgACgCFCACajYCFAusAQEBfwJAIAACfyAAKAK8LSIBQRBGBEAgACAAKAIUIgFBAWo2AhQgASAAKAIIaiAALQC4LToAACAAIAAoAhQiAUEBajYCFCABIAAoAghqIABBuS1qLQAAOgAAIABBADsBuC1BAAwBCyABQQhIDQEgACAAKAIUIgFBAWo2AhQgASAAKAIIaiAALQC4LToAACAAIABBuS1qLQAAOwG4LSAAKAK8LUEIaws2ArwtCwuhEwENfwJ/AkACQAJAIAAoAoQBQQFOBEAgACgCACIGKAIsQQJHDQNB/4D/n38hBANAAkAgBEEBcUUNACAAIAVBAnRqLwGUAUUNAEEAIQQMBAsCQCAEQQJxRQ0AIAAgBUECdEEEcmovAZQBRQ0AQQAhBAwECyAEQQJ2IQQgBUECaiIFQSBHDQALDAELIAJBBWoiBQwDCwJAIAAvAbgBDQAgAC8BvAENACAALwHIAQ0AQSAhBQNAIAAgBUECdCIEai8BlAENASAAIARBBHJqLwGUAQ0BIAAgBEEIcmovAZQBDQEgACAEQQxyai8BlAENAUEAIQQgBUEEaiIFQYACRw0ACwwBC0EBIQQLIAYgBDYCLAsgACAAQZgWahAVIAAgAEGkFmoQFSAALwGWASEEIAAgAEGcFmooAgAiCkECdGpB//8DOwGaASAKQQBOBEBBB0GKASAEGyEJQQRBAyAEGyELIABBwBVqIQ4gAEHEFWohDyAAQbwVaiEQQX8hDANAIAQhBSAAIAgiDUEBaiIIQQJ0ai8BlgEhBAJAAkAgB0EBaiIGIAlODQAgBCAFRw0AIAYhBwwBCwJ/IAYgC0gEQCAAIAVBAnRqQfwUaiIHLwEAIAZqDAELIAUEQCAFIAxHBEAgACAFQQJ0akH8FGoiBiAGLwEAQQFqOwEACyAQIgcvAQBBAWoMAQsgB0EJTARAIA4iBy8BAEEBagwBCyAPIgcvAQBBAWoLIQYgByAGOwEAQQAhBwJ/IARFBEBBAyELQYoBDAELQQNBBCAEIAVGIgYbIQtBBkEHIAYbCyEJIAUhDAsgCiANRw0ACwsgAEGKE2ovAQAhBCAAIABBqBZqKAIAIgpBAnRqQY4TakH//wM7AQBBACEHIApBAE4EQEEHQYoBIAQbIQlBBEEDIAQbIQsgAEHAFWohDiAAQcQVaiEPIABBvBVqIRBBfyEMQQAhCANAIAQhBSAAIAgiDUEBaiIIQQJ0akGKE2ovAQAhBAJAAkAgB0EBaiIGIAlODQAgBCAFRw0AIAYhBwwBCwJ/IAYgC0gEQCAAIAVBAnRqQfwUaiIHLwEAIAZqDAELIAUEQCAFIAxHBEAgACAFQQJ0akH8FGoiBiAGLwEAQQFqOwEACyAQIgcvAQBBAWoMAQsgB0EJTARAIA4iBy8BAEEBagwBCyAPIgcvAQBBAWoLIQYgByAGOwEAQQAhBwJ/IARFBEBBAyELQYoBDAELQQNBBCAEIAVGIgYbIQtBBkEHIAYbCyEJIAUhDAsgCiANRw0ACwsgACAAQbAWahAVIAAgACgCqC0Cf0ESIABBuhVqLwEADQAaQREgAEGCFWovAQANABpBECAAQbYVai8BAA0AGkEPIABBhhVqLwEADQAaQQ4gAEGyFWovAQANABpBDSAAQYoVai8BAA0AGkEMIABBrhVqLwEADQAaQQsgAEGOFWovAQANABpBCiAAQaoVai8BAA0AGkEJIABBkhVqLwEADQAaQQggAEGmFWovAQANABpBByAAQZYVai8BAA0AGkEGIABBohVqLwEADQAaQQUgAEGaFWovAQANABpBBCAAQZ4Vai8BAA0AGkEDQQIgAEH+FGovAQAbCyIIQQNsaiIEQRFqNgKoLSAEQRtqQQN2IgQgACgCrC1BCmpBA3YiBSAEIAVJGwshBAJAAkAgAUUNACACQQRqIARLDQAgACABIAIgAxASDAELIAAoArwtIQYCQCAEIAVHBEAgACgCiAFBBEcNAQsgACAALwG4LSADQQJqQf//A3EiBCAGdHIiBTsBuC0gAAJ/IAZBDk4EQCAAIAAoAhQiBkEBajYCFCAGIAAoAghqIAU6AAAgACAAKAIUIgVBAWo2AhQgBSAAKAIIaiAAQbktai0AADoAACAAIARBECAAKAK8LSIFa3Y7AbgtIAVBDWsMAQsgBkEDags2ArwtIABBwM8AQcDYABAWDAELIAAvAbgtIANBBGpB//8DcSIHIAZ0ciEFAkAgBkEOTgRAIAAgBTsBuC0gACAAKAIUIgRBAWo2AhQgBCAAKAIIaiAFOgAAIAAgACgCFCIEQQFqNgIUIAQgACgCCGogAEG5LWotAAA6AAAgACgCvC0iBUENayEEIAdBECAFa3YhBQwBCyAGQQNqIQQLIAAgBDYCvC0gAEGcFmooAgAiCkGA/gNqQf//A3EiByAEdCEGIABBqBZqKAIAIQkCfyAEQQxOBEAgACAFIAZyIgQ7AbgtIAAgACgCFCIFQQFqNgIUIAUgACgCCGogBDoAACAAIAAoAhQiBEEBajYCFCAEIAAoAghqIABBuS1qLQAAOgAAIAAoArwtIgVBC2shBCAHQRAgBWt2DAELIARBBWohBCAFIAZyCyEFIAAgBDYCvC0gCUH//wNxIgcgBHQhBgJ/IARBDE4EQCAAIAUgBnIiBDsBuC0gACAAKAIUIgVBAWo2AhQgBSAAKAIIaiAEOgAAIAAgACgCFCIEQQFqNgIUIAQgACgCCGogAEG5LWotAAA6AAAgACgCvC0iBUELayEEIAdBECAFa3YMAQsgBEEFaiEEIAUgBnILIQUgACAENgK8LSAIQf3/A2pB//8DcSIHIAR0IQYCfyAEQQ1OBEAgACAFIAZyIgQ7AbgtIAAgACgCFCIFQQFqNgIUIAUgACgCCGogBDoAACAAIAAoAhQiBEEBajYCFCAEIAAoAghqIABBuS1qLQAAOgAAIAAoArwtIgVBDGshBCAHQRAgBWt2DAELIARBBGohBCAFIAZyCyEGIAAgBDYCvC1BACEFIABBuS1qIQ0DQCAAIAYgACAFQZDcAGotAABBAnRqQf4Uai8BACIHIAR0ciIGOwG4LSAAAn8gBEEOTgRAIAAgACgCFCIEQQFqNgIUIAQgACgCCGogBjoAACAAIAAoAhQiBEEBajYCFCAEIAAoAghqIA0tAAA6AAAgACAHQRAgACgCvC0iBGt2IgY7AbgtIARBDWsMAQsgBEEDagsiBDYCvC0gBSAIRyEHIAVBAWohBSAHDQALIAAgAEGUAWoiBCAKEBcgACAAQYgTaiIFIAkQFyAAIAQgBRAWCyAAEBEgAwRAAkACfyAAKAK8LSIEQQlOBEAgACAAKAIUIgRBAWo2AhQgBCAAKAIIaiAALQC4LToAACAAIAAoAhQiBEEBajYCFCAEIAAoAghqIQQgAEG5LWotAAAMAQsgBEEBSA0BIAAgACgCFCIEQQFqNgIUIAQgACgCCGohBCAALQC4LQshBSAEIAU6AAALIABBADYCvC0gAEEAOwG4LQsLsRUBFX8jAEEgayEKIAEoAgAhCSABKAIIIgIoAgAhBSACKAIMIQ0gAEKAgICA0McANwLQKEF/IRACQCANQQBKBEBBACECA0ACQCAJIAJBAnRqIgMvAQAEQCAAIAAoAtAoQQFqIgM2AtAoIAAgA0ECdGpB3BZqIAI2AgAgACACakHYKGpBADoAACACIRAMAQsgA0EAOwECCyACQQFqIgIgDUcNAAsgACgC0CgiBEEBSg0BCwNAIAAgBEEBaiICNgLQKCAAIAJBAnRqQdwWaiAQQQFqIgNBACAQQQJIIgQbIgI2AgAgCSACQQJ0IgdqQQE7AQAgACACakHYKGpBADoAACAAIAAoAqgtQQFrNgKoLSAFBEAgACAAKAKsLSAFIAdqLwECazYCrC0LIAMgECAEGyEQIAAoAtAoIgRBAkgNAAsLIAEgEDYCBCAEQQF2IQgDQCAAIAhBAnRqQdwWaigCACELAkAgCCICQQF0IgMgBEoNACAAIAtqQdgoaiEPIAkgC0ECdGohBiAIIQUDQAJAIAMgBE4EQCADIQIMAQsgCSAAQdwWaiICIANBAXIiBEECdGooAgAiDkECdGovAQAiByAJIAIgA0ECdGooAgAiDEECdGovAQAiAk8EQCACIAdHBEAgAyECDAILIAMhAiAAQdgoaiIDIA5qLQAAIAMgDGotAABLDQELIAQhAgsgBi8BACIEIAkgACACQQJ0akHcFmooAgAiA0ECdGovAQAiB0kEQCAFIQIMAgsCQCAEIAdHDQAgDy0AACAAIANqQdgoai0AAEsNACAFIQIMAgsgACAFQQJ0akHcFmogAzYCACACIQUgAkEBdCIDIAAoAtAoIgRMDQALCyAAIAJBAnRqQdwWaiALNgIAIAhBAk4EQCAIQQFrIQggACgC0CghBAwBCwsgACgC0CghAwNAIA0hCCAAIANBAWsiBDYC0CggACgC4BYhCyAAIAAgA0ECdGpB3BZqKAIAIg02AuAWQQEhAgJAIANBA0gNACAAIA1qQdgoaiEPQQIhAyAJIA1BAnRqIQZBASEFA0ACQCADIAROBEAgAyECDAELIAkgAEHcFmoiAiADQQFyIgRBAnRqKAIAIg5BAnRqLwEAIgcgCSACIANBAnRqKAIAIgxBAnRqLwEAIgJPBEAgAiAHRwRAIAMhAgwCCyADIQIgAEHYKGoiAyAOai0AACADIAxqLQAASw0BCyAEIQILIAYvAQAiBCAJIAAgAkECdGpB3BZqKAIAIgNBAnRqLwEAIgdJBEAgBSECDAILAkAgBCAHRw0AIA8tAAAgACADakHYKGotAABLDQAgBSECDAILIAAgBUECdGpB3BZqIAM2AgAgAiEFIAJBAXQiAyAAKALQKCIETA0ACwtBAiEDIABB3BZqIgYgAkECdGogDTYCACAAIAAoAtQoQQFrIgQ2AtQoIAAoAuAWIQIgBiAEQQJ0aiALNgIAIAAgACgC1ChBAWsiBDYC1CggBiAEQQJ0aiACNgIAIAkgCEECdGoiDiAJIAJBAnRqIgQvAQAgCSALQQJ0aiIFLwEAajsBACAAQdgoaiIMIAhqIg8gAiAMai0AACICIAsgDGotAAAiByACIAdLG0EBajoAACAEIAg7AQIgBSAIOwECIAAgCDYC4BZBASEFQQEhAgJAIAAoAtAoIgRBAkgNAANAAn8gAyADIARODQAaIAkgBiADQQFyIgRBAnRqKAIAIgtBAnRqLwEAIgIgCSAGIANBAnRqKAIAIg1BAnRqLwEAIgdPBEAgAyACIAdHDQEaIAMgCyAMai0AACAMIA1qLQAASw0BGgsgBAshAiAOLwEAIgQgCSAAIAJBAnRqQdwWaigCACIDQQJ0ai8BACIHSQRAIAUhAgwCCwJAIAQgB0cNACAPLQAAIAAgA2pB2ChqLQAASw0AIAUhAgwCCyAAIAVBAnRqQdwWaiADNgIAIAIhBSACQQF0IgMgACgC0CgiBEwNAAsLIAhBAWohDSAAIAJBAnRqQdwWaiAINgIAIAAoAtAoIgNBAUoNAAsgACAAKALUKEEBayICNgLUKCAAQdwWaiIDIAJBAnRqIAAoAuAWNgIAIAEoAgQhByABKAIIIgIoAhAhBiACKAIIIREgAigCBCETIAIoAgAhEiABKAIAIQwgAEHUFmoiAUIANwEAIABBzBZqIhRCADcBACAAQcQWaiIVQgA3AQAgAEG8FmoiFkIANwEAQQAhCCAMIAMgACgC1ChBAnRqKAIAQQJ0akEAOwECAkAgACgC1CgiAkG7BEoNACACQQFqIQJBACEOA0AgDCAAIAJBAnRqQdwWaigCACIEQQJ0Ig1qIgUgDCAFLwECQQJ0ai8BAiIDQQFqIAYgAyAGSBsiDzsBAiADIAZOIQMCQCAEIAdKDQAgACAPQQF0akG8FmoiCyALLwEAQQFqOwEAQQAhCyAEIBFOBEAgEyAEIBFrQQJ0aigCACELCyAAIAAoAqgtIAUvAQAiBCALIA9qbGo2AqgtIBJFDQAgACAAKAKsLSALIA0gEmovAQJqIARsajYCrC0LIAMgDmohDiACQQFqIgJBvQRHDQALIA5FDQAgACAGQQF0akG8FmohDwNAIAYhAgNAIAAgAiIDQQFrIgJBAXRqQbwWaiIELwEAIgVFDQALIAQgBUEBazsBACAAIANBAXRqQbwWaiICIAIvAQBBAmo7AQAgDyAPLwEAQQFrIgI7AQAgDkECSiEDIA5BAmshDiADDQALIAZFDQBBvQQhBQNAIAJB//8DcSEDIAUhAgNAIAMEQCAAIAJBAWsiAkECdGpB3BZqKAIAIgQgB0oNASAMIARBAnRqIgQvAQIiBSAGRwRAIAAgACgCqC0gBC8BACAGIAVrbGo2AqgtIAQgBjsBAgsgA0EBayEDIAIhBQwBCwsgBkEBayIGRQ0BIAAgBkEBdGpBvBZqLwEAIQIMAAsACyAKIBYvAQBBAXQiAjsBAiAKIAIgAEG+FmovAQBqQQF0IgI7AQQgCiACIABBwBZqLwEAakEBdCICOwEGIAogAiAAQcIWai8BAGpBAXQiAjsBCCAKIAIgFS8BAGpBAXQiAjsBCiAKIAIgAEHGFmovAQBqQQF0IgI7AQwgCiACIABByBZqLwEAakEBdCICOwEOIAogAiAAQcoWai8BAGpBAXQiAjsBECAKIAIgFC8BAGpBAXQiAjsBEiAKIAIgAEHOFmovAQBqQQF0IgI7ARQgCiACIABB0BZqLwEAakEBdCICOwEWIAogAiAAQdIWai8BAGpBAXQiAjsBGCAKIAEvAQAgAmpBAXQiAjsBGiAKIABB1hZqLwEAIAJqQQF0IgI7ARwgCiACIABB2BZqLwEAakEBdDsBHiAQQQBOBEADQCAJIAhBAnRqIgcvAQIiBARAIAogBEEBdGoiACAALwEAIgBBAWo7AQAgBEEDcSEDQQAhAiAEQQFrQQNPBEAgBEH8/wNxIQUDQCAAQQN2QQFxIABBAnZBAXEgAEECcSACIABBAXFyQQJ0cnJBAXRyIgRBAXQhAiAAQQR2IQAgBUEEayIFDQALCyADBEADQCACIABBAXFyIgRBAXQhAiAAQQF2IQAgA0EBayIDDQALCyAHIAQ7AQALIAggEEchACAIQQFqIQggAA0ACwsL2QgBCn8CQCAAKAKgLUUEQCAAKAK8LSEDDAELIABBuS1qIQgDQCAEQQFqIQogACgCmC0gBGotAAAhBQJAIAACfyAAKAKkLSAEQQF0ai8BACIHRQRAIAEgBUECdGoiAy8BAiEEIAAgAC8BuC0gAy8BACIFIAAoArwtIgN0ciIHOwG4LUEQIARrIANIBEAgACAAKAIUIgNBAWo2AhQgAyAAKAIIaiAHOgAAIAAgACgCFCIDQQFqNgIUIAMgACgCCGogCC0AADoAACAAIAVBECAAKAK8LSIDa3Y7AbgtIAMgBGpBEGsMAgsgAyAEagwBCyAFQYDNAGotAAAiC0ECdCIJQYAIciABaiIDLwEGIQQgACAALwG4LSADLwEEIgwgACgCvC0iBnRyIgM7AbgtIAACf0EQIARrIAZIBEAgACAAKAIUIgZBAWo2AhQgBiAAKAIIaiADOgAAIAAgACgCFCIDQQFqNgIUIAMgACgCCGogCC0AADoAACAAIAxBECAAKAK8LSIGa3YiAzsBuC0gBCAGakEQawwBCyAEIAZqCyIENgK8LSALQQhrQRNNBEAgACADIAUgCUGw3ABqKAIAa0H//wNxIgYgBHRyIgM7AbgtIAACf0EQIAlBwNkAaigCACIFayAESARAIAAgACgCFCIEQQFqNgIUIAQgACgCCGogAzoAACAAIAAoAhQiBEEBajYCFCAEIAAoAghqIAgtAAA6AAAgACAGQRAgACgCvC0iBGt2IgM7AbgtIAQgBWpBEGsMAQsgBCAFagsiBDYCvC0LIAIgB0EBayIFIAVBB3ZBgAJqIAVBgAJJG0GAyQBqLQAAIgtBAnQiCWoiBi8BAiEHIAAgAyAGLwEAIgwgBHRyIgY7AbgtIAACf0EQIAdrIARIBEAgACAAKAIUIgRBAWo2AhQgBCAAKAIIaiAGOgAAIAAgACgCFCIEQQFqNgIUIAQgACgCCGogCC0AADoAACAAIAxBECAAKAK8LSIEa3YiBjsBuC0gBCAHakEQawwBCyAEIAdqCyIDNgK8LSALQQRJDQEgACAGIAUgCUGw3QBqKAIAa0H//wNxIgUgA3RyIgc7AbgtQRAgCUHA2gBqKAIAIgRrIANIBEAgACAAKAIUIgNBAWo2AhQgAyAAKAIIaiAHOgAAIAAgACgCFCIDQQFqNgIUIAMgACgCCGogCC0AADoAACAAIAVBECAAKAK8LSIDa3Y7AbgtIAMgBGpBEGsMAQsgAyAEagsiAzYCvC0LIAoiBCAAKAKgLUkNAAsLIAFBgghqLwEAIQQgACAALwG4LSABLwGACCIKIAN0ciIFOwG4LUEQIARrIANIBEAgACAAKAIUIgNBAWo2AhQgAyAAKAIIaiAFOgAAIAAgACgCFCIDQQFqNgIUIAMgACgCCGogAEG5LWotAAA6AAAgACAKQRAgACgCvC0iA2t2OwG4LSAAIAMgBGpBEGs2ArwtDwsgACADIARqNgK8LQuXCwEMfyACQQBOBEBBBEEDIAEvAQIiChshBkEHQYoBIAobIQMgAEG5LWohCEF/IQcDQCAKIQkgASALIgxBAWoiC0ECdGovAQIhCgJAAkAgBUEBaiIEIANODQAgCSAKRw0AIAQhBQwBCwJAIAQgBkgEQCAAIAlBAnRqIgVB/BRqIQ0gBUH+FGohDiAAKAK8LSEFA0AgDi8BACEDIAAgAC8BuC0gDS8BACIGIAV0ciIHOwG4LSAAAn9BECADayAFSARAIAAgACgCFCIFQQFqNgIUIAUgACgCCGogBzoAACAAIAAoAhQiBUEBajYCFCAFIAAoAghqIAgtAAA6AAAgACAGQRAgACgCvC0iBWt2OwG4LSADIAVqQRBrDAELIAMgBWoLIgU2ArwtIARBAWsiBA0ACwwBCyAAAn8gCQRAAkAgByAJRgRAIAAoArwtIQMgBCEFDAELIAAgCUECdGoiBEH+FGovAQAhAyAAIAAvAbgtIARB/BRqLwEAIgYgACgCvC0iBHRyIgc7AbgtIAACf0EQIANrIARIBEAgACAAKAIUIgRBAWo2AhQgBCAAKAIIaiAHOgAAIAAgACgCFCIEQQFqNgIUIAQgACgCCGogCC0AADoAACAAIAZBECAAKAK8LSIEa3Y7AbgtIAMgBGpBEGsMAQsgAyAEagsiAzYCvC0LIAAvAbgtIAAvAbwVIgcgA3RyIQQCQEEQIAAvAb4VIgZrIANIBEAgACAEOwG4LSAAIAAoAhQiA0EBajYCFCADIAAoAghqIAQ6AAAgACAAKAIUIgNBAWo2AhQgAyAAKAIIaiAILQAAOgAAIAYgACgCvC0iBGpBEGshAyAHQRAgBGt2IQQMAQsgAyAGaiEDCyAAIAM2ArwtIAAgBCAFQf3/A2pB//8DcSIFIAN0ciIEOwG4LSADQQ9OBEAgACAAKAIUIgNBAWo2AhQgAyAAKAIIaiAEOgAAIAAgACgCFCIDQQFqNgIUIAMgACgCCGogCC0AADoAACAAIAVBECAAKAK8LSIDa3Y7AbgtIANBDmsMAgsgA0ECagwBCyAFQQlMBEAgAC8BuC0gAC8BwBUiByAAKAK8LSIDdHIhBAJAQRAgAC8BwhUiBmsgA0gEQCAAIAQ7AbgtIAAgACgCFCIDQQFqNgIUIAMgACgCCGogBDoAACAAIAAoAhQiA0EBajYCFCADIAAoAghqIAgtAAA6AAAgBiAAKAK8LSIEakEQayEDIAdBECAEa3YhBAwBCyADIAZqIQMLIAAgAzYCvC0gACAEIAVB/v8DakH//wNxIgUgA3RyIgQ7AbgtIANBDk4EQCAAIAAoAhQiA0EBajYCFCADIAAoAghqIAQ6AAAgACAAKAIUIgNBAWo2AhQgAyAAKAIIaiAILQAAOgAAIAAgBUEQIAAoArwtIgNrdjsBuC0gA0ENawwCCyADQQNqDAELIAAvAbgtIAAvAcQVIgcgACgCvC0iA3RyIQQCQEEQIAAvAcYVIgZrIANIBEAgACAEOwG4LSAAIAAoAhQiA0EBajYCFCADIAAoAghqIAQ6AAAgACAAKAIUIgNBAWo2AhQgAyAAKAIIaiAILQAAOgAAIAYgACgCvC0iBGpBEGshAyAHQRAgBGt2IQQMAQsgAyAGaiEDCyAAIAM2ArwtIAAgBCAFQfb/A2pB//8DcSIFIAN0ciIEOwG4LSADQQpOBEAgACAAKAIUIgNBAWo2AhQgAyAAKAIIaiAEOgAAIAAgACgCFCIDQQFqNgIUIAMgACgCCGogCC0AADoAACAAIAVBECAAKAK8LSIDa3Y7AbgtIANBCWsMAQsgA0EHags2ArwtC0EAIQUCfyAKRQRAQYoBIQNBAwwBC0EGQQcgCSAKRiIEGyEDQQNBBCAEGwshBiAJIQcLIAIgDEcNAAsLCwkAIAEgAmwQHAsGACABEB0LXwEBfyMAQUBqIgMkACADQQA2AjAgA0IANwMoIAMgADYCCCADIAI2AhQgAyABNgIMIAMgAUEDbDYCGCADQQhqEAcgA0EIahALIANBCGoQCCADKAIcIQEgA0FAayQAIAELBgBB1N8AC6QuAQx/IwBBEGsiDCQAAkACQAJAAkACQAJAAkACQAJAAkACQAJAIABB9AFNBEBB2N8AKAIAIgZBECAAQQtqQXhxIABBC0kbIgRBA3YiAXYiAEEDcQRAIABBf3NBAXEgAWoiAkEDdCIDQYjgAGooAgAiAUEIaiEAAkAgASgCCCIEIANBgOAAaiIDRgRAQdjfACAGQX4gAndxNgIADAELIAQgAzYCDCADIAQ2AggLIAEgAkEDdCICQQNyNgIEIAEgAmoiASABKAIEQQFyNgIEDA0LIARB4N8AKAIAIghNDQEgAARAAkAgACABdEECIAF0IgBBACAAa3JxIgBBACAAa3FBAWsiACAAQQx2QRBxIgB2IgFBBXZBCHEiAiAAciABIAJ2IgBBAnZBBHEiAXIgACABdiIAQQF2QQJxIgFyIAAgAXYiAEEBdkEBcSIBciAAIAF2aiICQQN0IgNBiOAAaigCACIBKAIIIgAgA0GA4ABqIgNGBEBB2N8AIAZBfiACd3EiBjYCAAwBCyAAIAM2AgwgAyAANgIICyABQQhqIQAgASAEQQNyNgIEIAEgBGoiAyACQQN0IgUgBGsiAkEBcjYCBCABIAVqIAI2AgAgCARAIAhBA3YiBUEDdEGA4ABqIQRB7N8AKAIAIQECfyAGQQEgBXQiBXFFBEBB2N8AIAUgBnI2AgAgBAwBCyAEKAIICyEFIAQgATYCCCAFIAE2AgwgASAENgIMIAEgBTYCCAtB7N8AIAM2AgBB4N8AIAI2AgAMDQtB3N8AKAIAIglFDQEgCUEAIAlrcUEBayIAIABBDHZBEHEiAHYiAUEFdkEIcSICIAByIAEgAnYiAEECdkEEcSIBciAAIAF2IgBBAXZBAnEiAXIgACABdiIAQQF2QQFxIgFyIAAgAXZqQQJ0QYjiAGooAgAiAygCBEF4cSAEayEBIAMhAgNAAkAgAigCECIARQRAIAIoAhQiAEUNAQsgACgCBEF4cSAEayICIAEgASACSyICGyEBIAAgAyACGyEDIAAhAgwBCwsgAyAEaiILIANNDQIgAygCGCEKIAMgAygCDCIFRwRAIAMoAggiAEHo3wAoAgBJGiAAIAU2AgwgBSAANgIIDAwLIANBFGoiAigCACIARQRAIAMoAhAiAEUNBCADQRBqIQILA0AgAiEHIAAiBUEUaiICKAIAIgANACAFQRBqIQIgBSgCECIADQALIAdBADYCAAwLC0F/IQQgAEG/f0sNACAAQQtqIgBBeHEhBEHc3wAoAgAiCEUNAEEfIQcgBEH///8HTQRAIABBCHYiACAAQYD+P2pBEHZBCHEiAHQiASABQYDgH2pBEHZBBHEiAXQiAiACQYCAD2pBEHZBAnEiAnRBD3YgACABciACcmsiAEEBdCAEIABBFWp2QQFxckEcaiEHC0EAIARrIQECQAJAAkAgB0ECdEGI4gBqKAIAIgJFBEBBACEADAELQQAhACAEQQBBGSAHQQF2ayAHQR9GG3QhAwNAAkAgAigCBEF4cSAEayIGIAFPDQAgAiEFIAYiAQ0AQQAhASACIQAMAwsgACACKAIUIgYgBiACIANBHXZBBHFqKAIQIgJGGyAAIAYbIQAgA0EBdCEDIAINAAsLIAAgBXJFBEBBAiAHdCIAQQAgAGtyIAhxIgBFDQMgAEEAIABrcUEBayIAIABBDHZBEHEiAHYiAkEFdkEIcSIDIAByIAIgA3YiAEECdkEEcSICciAAIAJ2IgBBAXZBAnEiAnIgACACdiIAQQF2QQFxIgJyIAAgAnZqQQJ0QYjiAGooAgAhAAsgAEUNAQsDQCAAKAIEQXhxIARrIgYgAUkhAyAGIAEgAxshASAAIAUgAxshBSAAKAIQIgIEfyACBSAAKAIUCyIADQALCyAFRQ0AIAFB4N8AKAIAIARrTw0AIAQgBWoiByAFTQ0BIAUoAhghCSAFIAUoAgwiA0cEQCAFKAIIIgBB6N8AKAIASRogACADNgIMIAMgADYCCAwKCyAFQRRqIgIoAgAiAEUEQCAFKAIQIgBFDQQgBUEQaiECCwNAIAIhBiAAIgNBFGoiAigCACIADQAgA0EQaiECIAMoAhAiAA0ACyAGQQA2AgAMCQsgBEHg3wAoAgAiAE0EQEHs3wAoAgAhAQJAIAAgBGsiAkEQTwRAQeDfACACNgIAQezfACABIARqIgM2AgAgAyACQQFyNgIEIAAgAWogAjYCACABIARBA3I2AgQMAQtB7N8AQQA2AgBB4N8AQQA2AgAgASAAQQNyNgIEIAAgAWoiACAAKAIEQQFyNgIECyABQQhqIQAMCwsgBEHk3wAoAgAiA0kEQEHk3wAgAyAEayIBNgIAQfDfAEHw3wAoAgAiACAEaiICNgIAIAIgAUEBcjYCBCAAIARBA3I2AgQgAEEIaiEADAsLQQAhACAEQS9qIggCf0Gw4wAoAgAEQEG44wAoAgAMAQtBvOMAQn83AgBBtOMAQoCggICAgAQ3AgBBsOMAIAxBDGpBcHFB2KrVqgVzNgIAQcTjAEEANgIAQZTjAEEANgIAQYAgCyIBaiIGQQAgAWsiB3EiBSAETQ0KQZDjACgCACIBBEBBiOMAKAIAIgIgBWoiCSACTQ0LIAEgCUkNCwtBlOMALQAAQQRxDQUCQAJAQfDfACgCACIBBEBBmOMAIQADQCABIAAoAgAiAk8EQCACIAAoAgRqIAFLDQMLIAAoAggiAA0ACwtBABAeIgNBf0YNBiAFIQZBtOMAKAIAIgBBAWsiASADcQRAIAUgA2sgASADakEAIABrcWohBgsgBCAGTw0GIAZB/v///wdLDQZBkOMAKAIAIgAEQEGI4wAoAgAiASAGaiICIAFNDQcgACACSQ0HCyAGEB4iACADRw0BDAgLIAYgA2sgB3EiBkH+////B0sNBSAGEB4iAyAAKAIAIAAoAgRqRg0EIAMhAAsCQCAEQTBqIAZNDQAgAEF/Rg0AQbjjACgCACIBIAggBmtqQQAgAWtxIgFB/v///wdLBEAgACEDDAgLIAEQHkF/RwRAIAEgBmohBiAAIQMMCAtBACAGaxAeGgwFCyAAIQMgAEF/Rw0GDAQLAAtBACEFDAcLQQAhAwwFCyADQX9HDQILQZTjAEGU4wAoAgBBBHI2AgALIAVB/v///wdLDQEgBRAeIgNBABAeIgBPDQEgA0F/Rg0BIABBf0YNASAAIANrIgYgBEEoak0NAQtBiOMAQYjjACgCACAGaiIANgIAQYzjACgCACAASQRAQYzjACAANgIACwJAAkACQEHw3wAoAgAiAQRAQZjjACEAA0AgAyAAKAIAIgIgACgCBCIFakYNAiAAKAIIIgANAAsMAgtB6N8AKAIAIgBBACAAIANNG0UEQEHo3wAgAzYCAAtBACEAQZzjACAGNgIAQZjjACADNgIAQfjfAEF/NgIAQfzfAEGw4wAoAgA2AgBBpOMAQQA2AgADQCAAQQN0IgFBiOAAaiABQYDgAGoiAjYCACABQYzgAGogAjYCACAAQQFqIgBBIEcNAAtB5N8AIAZBKGsiAEF4IANrQQdxQQAgA0EIakEHcRsiAWsiAjYCAEHw3wAgASADaiIBNgIAIAEgAkEBcjYCBCAAIANqQSg2AgRB9N8AQcDjACgCADYCAAwCCyABIANPDQAgASACSQ0AIAAoAgxBCHENACAAIAUgBmo2AgRB8N8AIAFBeCABa0EHcUEAIAFBCGpBB3EbIgBqIgI2AgBB5N8AQeTfACgCACAGaiIDIABrIgA2AgAgAiAAQQFyNgIEIAEgA2pBKDYCBEH03wBBwOMAKAIANgIADAELQejfACgCACADSwRAQejfACADNgIACyADIAZqIQJBmOMAIQACQAJAAkACQAJAAkADQCACIAAoAgBHBEAgACgCCCIADQEMAgsLIAAtAAxBCHFFDQELQZjjACEAA0AgASAAKAIAIgJPBEAgAiAAKAIEaiICIAFLDQMLIAAoAgghAAwACwALIAAgAzYCACAAIAAoAgQgBmo2AgQgA0F4IANrQQdxQQAgA0EIakEHcRtqIgcgBEEDcjYCBCACQXggAmtBB3FBACACQQhqQQdxG2oiBiAHayAEayECIAQgB2ohBCABIAZGBEBB8N8AIAQ2AgBB5N8AQeTfACgCACACaiIANgIAIAQgAEEBcjYCBAwDCyAGQezfACgCAEYEQEHs3wAgBDYCAEHg3wBB4N8AKAIAIAJqIgA2AgAgBCAAQQFyNgIEIAAgBGogADYCAAwDCyAGKAIEIgBBA3FBAUYEQCAAQXhxIQgCQCAAQf8BTQRAIAYoAggiASAAQQN2IgVBA3RBgOAAakYaIAEgBigCDCIARgRAQdjfAEHY3wAoAgBBfiAFd3E2AgAMAgsgASAANgIMIAAgATYCCAwBCyAGKAIYIQkCQCAGIAYoAgwiA0cEQCAGKAIIIgAgAzYCDCADIAA2AggMAQsCQCAGQRRqIgAoAgAiAQ0AIAZBEGoiACgCACIBDQBBACEDDAELA0AgACEFIAEiA0EUaiIAKAIAIgENACADQRBqIQAgAygCECIBDQALIAVBADYCAAsgCUUNAAJAIAYgBigCHCIBQQJ0QYjiAGoiACgCAEYEQCAAIAM2AgAgAw0BQdzfAEHc3wAoAgBBfiABd3E2AgAMAgsgCUEQQRQgCSgCECAGRhtqIAM2AgAgA0UNAQsgAyAJNgIYIAYoAhAiAARAIAMgADYCECAAIAM2AhgLIAYoAhQiAEUNACADIAA2AhQgACADNgIYCyAGIAhqIQYgAiAIaiECCyAGIAYoAgRBfnE2AgQgBCACQQFyNgIEIAIgBGogAjYCACACQf8BTQRAIAJBA3YiAUEDdEGA4ABqIQACf0HY3wAoAgAiAkEBIAF0IgFxRQRAQdjfACABIAJyNgIAIAAMAQsgACgCCAshASAAIAQ2AgggASAENgIMIAQgADYCDCAEIAE2AggMAwtBHyEAIAJB////B00EQCACQQh2IgAgAEGA/j9qQRB2QQhxIgB0IgEgAUGA4B9qQRB2QQRxIgF0IgMgA0GAgA9qQRB2QQJxIgN0QQ92IAAgAXIgA3JrIgBBAXQgAiAAQRVqdkEBcXJBHGohAAsgBCAANgIcIARCADcCECAAQQJ0QYjiAGohAQJAQdzfACgCACIDQQEgAHQiBXFFBEBB3N8AIAMgBXI2AgAgASAENgIAIAQgATYCGAwBCyACQQBBGSAAQQF2ayAAQR9GG3QhACABKAIAIQMDQCADIgEoAgRBeHEgAkYNAyAAQR12IQMgAEEBdCEAIAEgA0EEcWpBEGoiBSgCACIDDQALIAUgBDYCACAEIAE2AhgLIAQgBDYCDCAEIAQ2AggMAgtB5N8AIAZBKGsiAEF4IANrQQdxQQAgA0EIakEHcRsiBWsiBzYCAEHw3wAgAyAFaiIFNgIAIAUgB0EBcjYCBCAAIANqQSg2AgRB9N8AQcDjACgCADYCACABIAJBJyACa0EHcUEAIAJBJ2tBB3EbakEvayIAIAAgAUEQakkbIgVBGzYCBCAFQaDjACkCADcCECAFQZjjACkCADcCCEGg4wAgBUEIajYCAEGc4wAgBjYCAEGY4wAgAzYCAEGk4wBBADYCACAFQRhqIQADQCAAQQc2AgQgAEEIaiEDIABBBGohACACIANLDQALIAEgBUYNAyAFIAUoAgRBfnE2AgQgASAFIAFrIgZBAXI2AgQgBSAGNgIAIAZB/wFNBEAgBkEDdiICQQN0QYDgAGohAAJ/QdjfACgCACIDQQEgAnQiAnFFBEBB2N8AIAIgA3I2AgAgAAwBCyAAKAIICyECIAAgATYCCCACIAE2AgwgASAANgIMIAEgAjYCCAwEC0EfIQAgAUIANwIQIAZB////B00EQCAGQQh2IgAgAEGA/j9qQRB2QQhxIgB0IgIgAkGA4B9qQRB2QQRxIgJ0IgMgA0GAgA9qQRB2QQJxIgN0QQ92IAAgAnIgA3JrIgBBAXQgBiAAQRVqdkEBcXJBHGohAAsgASAANgIcIABBAnRBiOIAaiECAkBB3N8AKAIAIgNBASAAdCIFcUUEQEHc3wAgAyAFcjYCACACIAE2AgAgASACNgIYDAELIAZBAEEZIABBAXZrIABBH0YbdCEAIAIoAgAhAwNAIAMiAigCBEF4cSAGRg0EIABBHXYhAyAAQQF0IQAgAiADQQRxakEQaiIFKAIAIgMNAAsgBSABNgIAIAEgAjYCGAsgASABNgIMIAEgATYCCAwDCyABKAIIIgAgBDYCDCABIAQ2AgggBEEANgIYIAQgATYCDCAEIAA2AggLIAdBCGohAAwFCyACKAIIIgAgATYCDCACIAE2AgggAUEANgIYIAEgAjYCDCABIAA2AggLQeTfACgCACIAIARNDQBB5N8AIAAgBGsiATYCAEHw3wBB8N8AKAIAIgAgBGoiAjYCACACIAFBAXI2AgQgACAEQQNyNgIEIABBCGohAAwDC0HU3wBBMDYCAEEAIQAMAgsCQCAJRQ0AAkAgBSgCHCICQQJ0QYjiAGoiACgCACAFRgRAIAAgAzYCACADDQFB3N8AIAhBfiACd3EiCDYCAAwCCyAJQRBBFCAJKAIQIAVGG2ogAzYCACADRQ0BCyADIAk2AhggBSgCECIABEAgAyAANgIQIAAgAzYCGAsgBSgCFCIARQ0AIAMgADYCFCAAIAM2AhgLAkAgAUEPTQRAIAUgASAEaiIAQQNyNgIEIAAgBWoiACAAKAIEQQFyNgIEDAELIAUgBEEDcjYCBCAHIAFBAXI2AgQgASAHaiABNgIAIAFB/wFNBEAgAUEDdiIBQQN0QYDgAGohAAJ/QdjfACgCACICQQEgAXQiAXFFBEBB2N8AIAEgAnI2AgAgAAwBCyAAKAIICyEBIAAgBzYCCCABIAc2AgwgByAANgIMIAcgATYCCAwBC0EfIQAgAUH///8HTQRAIAFBCHYiACAAQYD+P2pBEHZBCHEiAHQiAiACQYDgH2pBEHZBBHEiAnQiBCAEQYCAD2pBEHZBAnEiBHRBD3YgACACciAEcmsiAEEBdCABIABBFWp2QQFxckEcaiEACyAHIAA2AhwgB0IANwIQIABBAnRBiOIAaiECAkACQCAIQQEgAHQiBHFFBEBB3N8AIAQgCHI2AgAgAiAHNgIAIAcgAjYCGAwBCyABQQBBGSAAQQF2ayAAQR9GG3QhACACKAIAIQQDQCAEIgIoAgRBeHEgAUYNAiAAQR12IQQgAEEBdCEAIAIgBEEEcWpBEGoiAygCACIEDQALIAMgBzYCACAHIAI2AhgLIAcgBzYCDCAHIAc2AggMAQsgAigCCCIAIAc2AgwgAiAHNgIIIAdBADYCGCAHIAI2AgwgByAANgIICyAFQQhqIQAMAQsCQCAKRQ0AAkAgAygCHCICQQJ0QYjiAGoiACgCACADRgRAIAAgBTYCACAFDQFB3N8AIAlBfiACd3E2AgAMAgsgCkEQQRQgCigCECADRhtqIAU2AgAgBUUNAQsgBSAKNgIYIAMoAhAiAARAIAUgADYCECAAIAU2AhgLIAMoAhQiAEUNACAFIAA2AhQgACAFNgIYCwJAIAFBD00EQCADIAEgBGoiAEEDcjYCBCAAIANqIgAgACgCBEEBcjYCBAwBCyADIARBA3I2AgQgCyABQQFyNgIEIAEgC2ogATYCACAIBEAgCEEDdiIEQQN0QYDgAGohAkHs3wAoAgAhAAJ/QQEgBHQiBCAGcUUEQEHY3wAgBCAGcjYCACACDAELIAIoAggLIQQgAiAANgIIIAQgADYCDCAAIAI2AgwgACAENgIIC0Hs3wAgCzYCAEHg3wAgATYCAAsgA0EIaiEACyAMQRBqJAAgAAvMDAEHfwJAIABFDQAgAEEIayICIABBBGsoAgAiAUF4cSIAaiEFAkAgAUEBcQ0AIAFBA3FFDQEgAiACKAIAIgFrIgJB6N8AKAIASQ0BIAAgAWohACACQezfACgCAEcEQCABQf8BTQRAIAIoAggiBCABQQN2IgdBA3RBgOAAakYaIAQgAigCDCIBRgRAQdjfAEHY3wAoAgBBfiAHd3E2AgAMAwsgBCABNgIMIAEgBDYCCAwCCyACKAIYIQYCQCACIAIoAgwiA0cEQCACKAIIIgEgAzYCDCADIAE2AggMAQsCQCACQRRqIgEoAgAiBA0AIAJBEGoiASgCACIEDQBBACEDDAELA0AgASEHIAQiA0EUaiIBKAIAIgQNACADQRBqIQEgAygCECIEDQALIAdBADYCAAsgBkUNAQJAIAIgAigCHCIEQQJ0QYjiAGoiASgCAEYEQCABIAM2AgAgAw0BQdzfAEHc3wAoAgBBfiAEd3E2AgAMAwsgBkEQQRQgBigCECACRhtqIAM2AgAgA0UNAgsgAyAGNgIYIAIoAhAiAQRAIAMgATYCECABIAM2AhgLIAIoAhQiAUUNASADIAE2AhQgASADNgIYDAELIAUoAgQiAUEDcUEDRw0AQeDfACAANgIAIAUgAUF+cTYCBCACIABBAXI2AgQgACACaiAANgIADwsgAiAFTw0AIAUoAgQiAUEBcUUNAAJAIAFBAnFFBEAgBUHw3wAoAgBGBEBB8N8AIAI2AgBB5N8AQeTfACgCACAAaiIANgIAIAIgAEEBcjYCBCACQezfACgCAEcNA0Hg3wBBADYCAEHs3wBBADYCAA8LIAVB7N8AKAIARgRAQezfACACNgIAQeDfAEHg3wAoAgAgAGoiADYCACACIABBAXI2AgQgACACaiAANgIADwsgAUF4cSAAaiEAAkAgAUH/AU0EQCAFKAIIIgQgAUEDdiIHQQN0QYDgAGpGGiAEIAUoAgwiAUYEQEHY3wBB2N8AKAIAQX4gB3dxNgIADAILIAQgATYCDCABIAQ2AggMAQsgBSgCGCEGAkAgBSAFKAIMIgNHBEAgBSgCCCIBQejfACgCAEkaIAEgAzYCDCADIAE2AggMAQsCQCAFQRRqIgEoAgAiBA0AIAVBEGoiASgCACIEDQBBACEDDAELA0AgASEHIAQiA0EUaiIBKAIAIgQNACADQRBqIQEgAygCECIEDQALIAdBADYCAAsgBkUNAAJAIAUgBSgCHCIEQQJ0QYjiAGoiASgCAEYEQCABIAM2AgAgAw0BQdzfAEHc3wAoAgBBfiAEd3E2AgAMAgsgBkEQQRQgBigCECAFRhtqIAM2AgAgA0UNAQsgAyAGNgIYIAUoAhAiAQRAIAMgATYCECABIAM2AhgLIAUoAhQiAUUNACADIAE2AhQgASADNgIYCyACIABBAXI2AgQgACACaiAANgIAIAJB7N8AKAIARw0BQeDfACAANgIADwsgBSABQX5xNgIEIAIgAEEBcjYCBCAAIAJqIAA2AgALIABB/wFNBEAgAEEDdiIBQQN0QYDgAGohAAJ/QdjfACgCACIEQQEgAXQiAXFFBEBB2N8AIAEgBHI2AgAgAAwBCyAAKAIICyEBIAAgAjYCCCABIAI2AgwgAiAANgIMIAIgATYCCA8LQR8hASACQgA3AhAgAEH///8HTQRAIABBCHYiASABQYD+P2pBEHZBCHEiAXQiBCAEQYDgH2pBEHZBBHEiBHQiAyADQYCAD2pBEHZBAnEiA3RBD3YgASAEciADcmsiAUEBdCAAIAFBFWp2QQFxckEcaiEBCyACIAE2AhwgAUECdEGI4gBqIQQCQAJAAkBB3N8AKAIAIgNBASABdCIFcUUEQEHc3wAgAyAFcjYCACAEIAI2AgAgAiAENgIYDAELIABBAEEZIAFBAXZrIAFBH0YbdCEBIAQoAgAhAwNAIAMiBCgCBEF4cSAARg0CIAFBHXYhAyABQQF0IQEgBCADQQRxakEQaiIFKAIAIgMNAAsgBSACNgIAIAIgBDYCGAsgAiACNgIMIAIgAjYCCAwBCyAEKAIIIgAgAjYCDCAEIAI2AgggAkEANgIYIAIgBDYCDCACIAA2AggLQfjfAEH43wAoAgBBAWsiAkF/IAIbNgIACwtVAQJ/QdDfACgCACIBIABBA2pBfHEiAmohAAJAIAJBAU5BACAAIAFNGw0APwBBEHQgAEkEQCAAEABFDQELQdDfACAANgIAIAEPC0HU3wBBMDYCAEF/C4IEAQN/IAJBgARPBEAgACABIAIQARogAA8LIAAgAmohAwJAIAAgAXNBA3FFBEACQCACQQFIBEAgACECDAELIABBA3FFBEAgACECDAELIAAhAgNAIAIgAS0AADoAACABQQFqIQEgAkEBaiICIANPDQEgAkEDcQ0ACwsCQCADQXxxIgRBwABJDQAgAiAEQUBqIgVLDQADQCACIAEoAgA2AgAgAiABKAIENgIEIAIgASgCCDYCCCACIAEoAgw2AgwgAiABKAIQNgIQIAIgASgCFDYCFCACIAEoAhg2AhggAiABKAIcNgIcIAIgASgCIDYCICACIAEoAiQ2AiQgAiABKAIoNgIoIAIgASgCLDYCLCACIAEoAjA2AjAgAiABKAI0NgI0IAIgASgCODYCOCACIAEoAjw2AjwgAUFAayEBIAJBQGsiAiAFTQ0ACwsgAiAETw0BA0AgAiABKAIANgIAIAFBBGohASACQQRqIgIgBEkNAAsMAQsgA0EESQRAIAAhAgwBCyAAIANBBGsiBEsEQCAAIQIMAQsgACECA0AgAiABLQAAOgAAIAIgAS0AAToAASACIAEtAAI6AAIgAiABLQADOgADIAFBBGohASACQQRqIgIgBE0NAAsLIAIgA0kEQANAIAIgAS0AADoAACABQQFqIQEgAkEBaiICIANHDQALCyAAC9YCAQJ/AkAgAUUNACAAIAFqIgJBAWtBADoAACAAQQA6AAAgAUEDSQ0AIAJBAmtBADoAACAAQQA6AAEgAkEDa0EAOgAAIABBADoAAiABQQdJDQAgAkEEa0EAOgAAIABBADoAAyABQQlJDQAgAEEAIABrQQNxIgNqIgJBADYCACACIAEgA2tBfHEiA2oiAUEEa0EANgIAIANBCUkNACACQQA2AgggAkEANgIEIAFBCGtBADYCACABQQxrQQA2AgAgA0EZSQ0AIAJBADYCGCACQQA2AhQgAkEANgIQIAJBADYCDCABQRBrQQA2AgAgAUEUa0EANgIAIAFBGGtBADYCACABQRxrQQA2AgAgAyACQQRxQRhyIgNrIgFBIEkNACACIANqIQIDQCACQgA3AxggAkIANwMQIAJCADcDCCACQgA3AwAgAkEgaiECIAFBIGsiAUEfSw0ACwsLBAAjAAsGACAAJAALEAAjACAAa0FwcSIAJAAgAAsLvVYIAEGECAvxQJYwB3csYQ7uulEJmRnEbQeP9GpwNaVj6aOVZJ4yiNsOpLjceR7p1eCI2dKXK0y2Cb18sX4HLbjnkR2/kGQQtx3yILBqSHG5895BvoR91Noa6+TdbVG11PTHhdODVphsE8Coa2R6+WL97Mllik9cARTZbAZjYz0P+vUNCI3IIG47XhBpTORBYNVycWei0eQDPEfUBEv9hQ3Sa7UKpfqotTVsmLJC1sm720D5vKzjbNgydVzfRc8N1txZPdGrrDDZJjoA3lGAUdfIFmHQv7X0tCEjxLNWmZW6zw+lvbieuAIoCIgFX7LZDMYk6Quxh3xvLxFMaFirHWHBPS1mtpBB3HYGcdsBvCDSmCoQ1e+JhbFxH7W2BqXkv58z1LjooskHeDT5AA+OqAmWGJgO4bsNan8tPW0Il2xkkQFcY+b0UWtrYmFsHNgwZYVOAGLy7ZUGbHulARvB9AiCV8QP9cbZsGVQ6bcS6ri+i3yIufzfHd1iSS3aFfN804xlTNT7WGGyTc5RtTp0ALyj4jC71EGl30rXldg9bcTRpPv01tNq6WlD/NluNEaIZ63QuGDacy0EROUdAzNfTAqqyXwN3TxxBVCqQQInEBALvoYgDMkltWhXs4VvIAnUZrmf5GHODvneXpjJ2SkimNCwtKjXxxc9s1mBDbQuO1y9t61susAgg7jttrO/mgzitgOa0rF0OUfV6q930p0VJtsEgxbccxILY+OEO2SUPmptDahaanoLzw7knf8JkyeuAAqxngd9RJMP8NKjCIdo8gEe/sIGaV1XYvfLZ2WAcTZsGecGa252G9T+4CvTiVp62hDMSt1nb9+5+fnvvo5DvrcX1Y6wYOij1tZ+k9GhxMLYOFLy30/xZ7vRZ1e8pt0GtT9LNrJI2isN2EwbCq/2SgM2YHoEQcPvYN9V32eo745uMXm+aUaMs2HLGoNmvKDSbyU24mhSlXcMzANHC7u5FgIiLyYFVb47usUoC72yklq0KwRqs1yn/9fCMc/QtYue2Swdrt5bsMJkmybyY+yco2p1CpNtAqkGCZw/Ng7rhWcHchNXAAWCSr+VFHq44q4rsXs4G7YMm47Skg2+1eW379x8Id/bC9TS04ZC4tTx+LPdaG6D2h/NFr6BWya59uF3sG93R7cY5loIiHBqD//KOwZmXAsBEf+eZY9prmL40/9rYUXPbBZ44gqg7tIN11SDBE7CswM5YSZnp/cWYNBNR2lJ23duPkpq0a7cWtbZZgvfQPA72DdTrrypxZ673n/Pskfp/7UwHPK9vYrCusowk7NTpqO0JAU20LqTBtfNKVfeVL9n2SMuemazuEphxAIbaF2UK28qN74LtKGODMMb3wVaje8CLQAAAABBMRsZgmI2MsNTLSsExWxkRfR3fYanWlbHlkFPCIrZyEm7wtGK6O/6y9n04wxPtaxNfq61ji2Dns8cmIdREsJKECPZU9Nw9HiSQe9hVdeuLhTmtTfXtZgcloSDBVmYG4IYqQCb2/otsJrLNqldXXfmHGxs/98/QdSeDlrNoiSEleMVn4wgRrKnYXepvqbh6PHn0PPoJIPew2Wyxdqqrl1d659GRCjMa29p/XB2rmsxOe9aKiAsCQcLbTgcEvM2Rt+yB13GcVRw7TBla/T38yq7tsIxonWRHIk0oAeQ+7yfF7qNhA553qklOO+yPP9583O+SOhqfRvFQTwq3lgFT3nwRH5i6YctT8LGHFTbAYoVlEC7Do2D6COmwtk4vw3FoDhM9Lshj6eWCs6WjRMJAMxcSDHXRYti+m7KU+F3VF27uhVsoKPWP42Ilw6WkVCY194RqczH0vrh7JPL+vVc12JyHeZ5a961VECfhE9ZWBIOFhkjFQ/acDgkm0EjPadr/WXmWuZ8JQnLV2Q40E6jrpEB4p+KGCHMpzNg/bwqr+Ekre7QP7QtgxKfbLIJhqskSMnqFVPQKUZ++2h3ZeL2eT8vt0gkNnQbCR01KhIE8rxTS7ONSFJw3mV5Me9+YP7z5ue/wv3+fJHQ1T2gy8z6NoqDuweRmnhUvLE5ZaeoS5iDOwqpmCLJ+rUJiMuuEE9d718ObPRGzT/ZbYwOwnRDElrzAiNB6sFwbMGAQXfYR9c2lwbmLY7FtQClhIQbvBqKQXFbu1pomOh3Q9nZbFoeTy0VX342DJwtGyfdHAA+EgCYuVMxg6CQYq6L0VO1khbF9N1X9O/ElKfC79WW2fbpvAeuqI0ct2veMZwq7yqF7XlryqxIcNNvG134LipG4eE23magB8V/Y1ToVCJl803l87ICpMKpG2eRhDAmoJ8puK7F5Pmf3v06zPPWe/3oz7xrqYD9WrKZPgmfsn84hKuwJBws8RUHNTJGKh5zdzEHtOFwSPXQa1E2g0Z6d7JdY07X+ssP5uHSzLXM+Y2E1+BKEpavCyONtshwoJ2JQbuERl0jAwdsOBrEPxUxhQ4OKEKYT2cDqVR+wPp5VYHLYkwfxTiBXvQjmJ2nDrPclhWqGwBU5VoxT/yZYmLX2FN5zhdP4UlWfvpQlS3Xe9QczGITio0tUruWNJHoux/Q2aAG7PN+Xq3CZUdukUhsL6BTdeg2EjqpBwkjalQkCCtlPxHkeaeWpUi8j2YbkaQnKoq94LzL8qGN0Oti3v3AI+/m2b3hvBT80KcNP4OKJn6ykT+5JNBw+BXLaTtG5kJ6d/1btWtl3PRafsU3CVPudjhI97GuCbjwnxKhM8w/inL9JJMAAAAAN2rCAW7UhANZvkYC3KgJB+vCywayfI0EhRZPBbhREw6PO9EP1oWXDeHvVQxk+RoJU5PYCAotngo9R1wLcKMmHEfJ5B0ed6IfKR1gHqwLLxubYe0awt+rGPW1aRnI8jUS/5j3E6YmsRGRTHMQFFo8FSMw/hR6jrgWTeR6F+BGTTjXLI85jpLJO7n4Czo87kQ/C4SGPlI6wDxlUAI9WBdeNm99nDc2w9o1AakYNIS/VzGz1ZUw6mvTMt0BETOQ5Wskp4+pJf4x7yfJWy0mTE1iI3snoCIimeYgFfMkISi0eCof3rorRmD8KXEKPij0HHEtw3azLJrI9S6tojcvwI2acPfnWHGuWR5zmTPcchwlk3crT1F2cvEXdEWb1XV43Il+T7ZLfxYIDX0hYs98pHSAeZMeQnjKoAR6/crGe7AuvGyHRH5t3vo4b+mQ+m5shrVrW+x3agJSMWg1OPNpCH+vYj8VbWNmqythUcHpYNTXpmXjvWRkugMiZo1p4Gcgy9dIF6EVSU4fU0t5dZFK/GPeT8sJHE6St1pMpd2YTZiaxEav8AZH9k5ARcEkgkREMs1Bc1gPQCrmSUIdjItDUGjxVGcCM1U+vHVXCda3VozA+FO7qjpS4hR8UNV+vlHoOeJa31MgW4btZlmxh6RYNJHrXQP7KVxaRW9ebS+tX4AbNeG3cffg7s+x4tmlc+Ncszzma9n+5zJnuOUFDXrkOEom7w8g5O5WnqLsYfRg7eTiL+jTiO3pijar671caerwuBP9x9LR/J5sl/6pBlX/LBAa+ht62PtCxJ75da5c+EjpAPN/g8LyJj2E8BFXRvGUQQn0oyvL9fqVjffN/0/2YF142Vc3utgOifzaOeM+27z1cd6Ln7Pf0iH13eVLN9zYDGvX72ap1rbY79SBsi3VBKRi0DPOoNFqcObTXRok0hD+XsUnlJzEfiraxklAGMfMVlfC+zyVw6KC08GV6BHAqK9Ny5/Fj8rGe8nI8RELyXQHRMxDbYbNGtPAzy25As5Alq+Rd/xtkC5CK5IZKOmTnD6mlqtUZJfy6iKVxYDglPjHvJ/PrX6elhM4nKF5+p0kb7WYEwV3mUq7MZt90fOaMDWJjQdfS4xe4Q2OaYvPj+ydgIrb90KLgkkEibUjxoiIZJqDvw5YguawHoDR2tyBVMyThGOmUYU6GBeHDXLVhqDQ4qmXuiCozgRmqvlupKt8eOuuSxIprxKsb60lxq2sGIHxpy/rM6Z2VXWkQT+3pcQp+KDzQzqhqv18o52XvqLQc8S15xkGtL6nQLaJzYK3DNvNsjuxD7NiD0mxVWWLsGgi17tfSBW6BvZTuDGckbm0it68g+AcvdpeWr/tNJi+AAAAAGVnvLiLyAmq7q+1EleXYo8y8N433F9rJbk4153vKLTFik8IfWTgvW8BhwHXuL/WSt3YavIzd9/gVhBjWJ9XGVD6MKXoFJ8Q+nH4rELIwHvfrafHZ0MIcnUmb87NcH+tlRUYES37t6Q/ntAYhyfozxpCj3OirCDGsMlHegg+rzKgW8iOGLVnOwrQAIeyaThQLwxf7Jfi8FmFh5flPdGHhmW04DrdWk+Pzz8oM3eGEOTq43dYUg3Y7UBov1H4ofgr8MSfl0gqMCJaT1ee4vZvSX+TCPXHfadA1RjA/G1O0J81K7cjjcUYlp+gfyonGUf9unwgQQKSj/QQ9+hIqD1YFJtYP6gjtpAdMdP3oYlqz3YUD6jKrOEHf76EYMMG0nCgXrcXHOZZuKn0PN8VTIXnwtHggH5pDi/Le2tId8OiDw3Lx2ixcynHBGFMoLjZ9ZhvRJD/0/x+UGbuGzfaVk0nuQ4oQAW2xu+wpKOIDBwasNuBf9dnOZF40iv0H26TA/cmO2aQmoOIPy+R7ViTKVRgRLQxB/gM36hNHrrP8abs35L+ibguRmcXm1QCcCfsu0jwcd4vTMkwgPnbVedFY5ygP2v5x4PTF2g2wXIPinnLN13krlDhXED/VE4lmOj2c4iLrhbvNxb4QIIEnSc+vCQf6SFBeFWZr9fgi8qwXDM7tlntXtHlVbB+UEfVGez/bCE7YglGh9rn6TLIgo6OcNSe7Six+VGQX1bkgjoxWDqDCY+n5m4zHwjBhg1tpjq1pOFAvcGG/AUvKUkXSk71r/N2IjKWEZ6KeL4rmB3ZlyBLyfR4Lq5IwMAB/dKlZkFqHF6W93k5Kk+Xlp9d8vEj5QUZa01gftf1jtFi5+u23l9SjgnCN+m1etlGAGi8IbzQ6jHfiI9WYzBh+dYiBJ5qmr2mvQfYwQG/Nm60rVMJCBWaTnId/ynOpRGGe7d04ccPzdkQkqi+rCpGERk4I3algHVmxtgQAXpg/q7PcpvJc8oi8aRXR5YY76k5rf3MXhFFBu5NdmOJ8c6NJkTc6EH4ZFF5L/k0HpNB2rEmU7/WmuvpxvmzjKFFC2IO8BkHaUyhvlGbPNs2J4Q1mZKWUP4uLpm5VCb83uieEnFdjHcW4TTOLjapq0mKEUXmPwMggYO7dpHg4xP2XFv9WelJmD5V8SEGgmxEYT7Uqs6Lxs+pN344QX/WXSbDbrOJdnzW7srEb9YdWQqxoeHkHhTzgXmoS9dpyxOyDnerXKHCuTnGfgGA/qmc5ZkVJAs2oDZuURyOpxZmhsJx2j4s3m8sSbnTlPCBBAmV5rixe0kNox4usRtIPtJDLVlu+8P22+mmkWdRH6mwzHrODHSUYblm8QYF3gAAAAB3BzCW7g5hLJkJUboHbcQZcGr0j+ljpTWeZJWjDtuIMnncuKTg1ekel9LZiAm2TCt+sXy957gtB5C/HZEdtxBkarAg8vO5cUiEvkHeGtrUfW3d5Ov01LVRg9OFxxNsmFZka6jA/WL5eoplyewUAVxPYwZs2foPPWONCA31O24gyExpEF7VYEHkomdxcjwD5NFLBNRH0g2F/aUKtWs1taj6QrKYbNu7ydasvPlAMths40XfXHXc1g3Pq9E9WSbZMKxR3gA6yNdRgL/QYRYhtPS1VrPEI8+6lZm4vaUPKAK4nl8FiAjGDNmysQvpJC9vfIdYaEwRwWEdq7ZmLT123EGQAdtxBpjSILzv1RAqcbGFiQa2tR+fv+Sl6LjUM3gHyaIPAPk0lgmojuEOmBh/ag27CG09LZFkbJfmY1wBa2tR9BxsYWKFZTDY8mIATmwGle0bAaV7ggj0wfUPxFdlsNnGErfpUIu+uOr8uYh8Yt0d3xXaLUmM03zz+9RMZU2yYVg6tVHOo7wAdNS7MOJK36VBPdiV16TRxG3T1vT7Q2npajRu2fytZ4hG2mC40EQELXMzAx3lqgpMX90NfMlQBXE8JwJBqr4LEBDJDCCGV2i1JSBvhbO5ZtQJzmHkn17e+Q4p2cmYsNCYIsfXqLRZsz0XLrQNgbe9XDvAumyt7biDIJq/s7YDtuIMdLHSmurVRzmd0nevBNsmFXPcFoPjYwsSlGQ7hA1taj56alqo5A7PC5MJ/50KAK4nfQeesfAPk0SHCKPSHgHyaGkGwv73YlddgGVnyxlsNnFuawbn/tQbdonTK+AQ2npaZ91KzPm532+Ovu/5F7e+Q2CwjtXW1qPoodGTfjjYwsRP3/JS0btn8aa8V2c/tQbdSLI2S9gNK9qvChtMNgNK9kEEemDfYO/DqGffVTFuju9Gab55y2GzjLxmgxolb9KgUmjiNswMd5W7C0cDIgIWuVUFJi/Fuju+sr0LKCu0WpJcs2oEwtf/p7XQzzEs2Z6LW96uHZtkwrDsY/ImdWqjnAJtkwqcCQap6w42P3IHZ4UFAFcTlb9KguK4ehR7sSuuDLYbOJLSjpvl1b4NfNzvtwvb3yGG09LU8dTiQmjds/gf2oNugb4Wzfa5JltvsHfhGLdHd4gIWub/D2pwZgY7yhEBC1yPZZ7/+GKuaWFr/9MWbM9FoArieNcN0u5OBINUOQOzwqdnJmHQYBb3SWlHTT5ud9uu0WpK2dZa3EDfC2Y32DvwqbyuU967nsVHss9/MLX/6b298hzKusKKU7OTMCS0o6a60DYFzdcGk1TeVykj2We/s2Z6LsRhSrhdaBsCKm8rlLQLvjfDDI6hWgXfGy0C740AAAAAGRsxQTI2YoIrLVPDZGzFBH139EVWWqeGT0GWx8jZigjRwrtJ+u/oiuP02custU8Mta5+TZ6DLY6HmBzPSsISUVPZIxB49HDTYe9Bki6u11U3teYUHJi11wWDhJaCG5hZmwCpGLAt+tupNsua5nddXf9sbBzUQT/fzVoOnpWEJKKMnxXjp7JGIL6pd2Hx6OGm6PPQ58PegyTaxbJlXV2uqkRGn+tva8wodnD9aTkxa64gKlrvCwcJLBIcOG3fRjbzxl0Hsu1wVHH0a2Uwuyrz96IxwraJHJF1kAegNBefvPsOhI26JaneeTyy7zhz83n/auhIvkHFG31Y3io88HlPBelifkTCTy2H21QcxpQVigGNDrtApiPog7842cI4oMUNIbv0TAqWp48TjZbOXMwACUXXMUhu+mKLd+FTyrq7XVSjoGwViI0/1pGWDpfe15hQx8ypEezh+tL1+suTcmLXXGt55h1AVLXeWU+EnxYOElgPFSMZJDhw2j0jQZtl/WunfOZa5lfLCSVO0DhkAZGuoxiKn+Izp8whKrz9YK0k4a+0P9DunxKDLYYJsmzJSCSr0FMV6vt+RiniZXdoLz959jYkSLcdCRt0BBIqNUtTvPJSSI2zeWXecGB+7zHn5vP+/v3Cv9XQkXzMy6A9g4o2+pqRB7uxvFR4qKdlOTuDmEsimKkKCbX6yRCuy4hf711PRvRsDm3ZP810wg6M81oSQ+pBIwLBbHDB2HdBgJc210eOLeYGpQC1xbwbhIRxQYoaaFq7W0N36JhabNnZFS1PHgw2fl8nGy2cPgAc3bmYABKggzFTi65ikJK1U9Hd9MUWxO/0V+/Cp5T22ZbVrge86bccjaicMd5rhSrvKspree3TcEis+F0bb+FGKi5m3jbhf8UHoFToVGNN82UiArLz5RupwqQwhJFnKZ+gJuTFrrj93p/51vPMOs/o/XuAqWu8mbJa/bKfCT6rhDh/LBwksDUHFfEeKkYyBzF3c0hw4bRRa9D1ekaDNmNdsnfL+tdO0uHmD/nMtczg14SNr5YSSraNIwudoHDIhLtBiQMjXUYaOGwHMRU/xCgODoVnT5hCflSpA1V5+sBMYsuBgTjFH5gj9F6zDqedqhWW3OVUABv8TzFa12Jimc55U9hJ4U8XUPp+VnvXLZVizBzULY2KEzSWu1Ifu+iRBqDZ0F5+8+xHZcKtbEiRbnVToC86EjboIwkHqQgkVGoRP2Urlqd55I+8SKWkkRtmvYoqJ/LLvODr0I2hwP3eYtnm7yMUvOG9DafQ/CaKgz8/kbJ+cNAkuWnLFfhC5kY7W/13etxla7XFflr07lMJN/dIOHa4Ca6xoRKf8Io/zDOTJP1yAAAAAAHCajcDhNRuAka+WQcJqNwGy8LrBI18sgVPFoUOE1G4D9E7jw2XhdYMVe/hCRr5ZAjYk1MKni0KC1xHPRwmo3Ad5MlHH6J3Hh5gHSkbLwusGu1hmxir38IZabX1EjXyyBP3mP8RsSamEHNMkRU8WhQU/jAjFriOehd65E04TUbgOY8s1zvJko46C/i5P0TuPD6GhAs8wDpSPQJQZTZeF1g3nH1vNdrDNjQYqQExV7+EMJXVszLTa+ozEQHdJGvlkCWpj6cn7zH+Ji1bySNiTUwioCd7IOaZIiEk8xUqeLQoK7reHyn8YEYoPgpxLXEc9CyzdsMu9ciaLzeirXCajcBxWOf3cx5ZrnLcM5l3kyUcdlFPK3QX8XJ11ZtFfonceH9Ltk99DQgWfM9iIXmAdKR4Qh6TegSgynvGyv1svC6wbX5Eh284+t5u+pDpa7WGbGp37FtoMVICafM4NWKvfwhjbRU/YSurZmDpwVFlptfUZGS942YiA7pn4GmNSNfLIEkVoRdLUx9OSpF1eU/eY/xOHAnLTFq3kk2Y3aVGxJqYRwbwr0VATvZEgiTBQc0yREAPWHNCSeYqQ4uMHVTxaFBVMwJnV3W8Pla31glT+MCMUjqqu1B8FOJRvn7VWuI56FsgU99ZZu2GWKSHsV3rkTRcKfsDXm9FWl+tL23hNRuA4Pdxt+Kxz+7jc6XZ5jyzXOf+2WvluGcy5HoNBe8mSjju5CAP7KKeVu1g9GHoL+Lk6e2I0+urNorqaVy9/RO48PzR0sf+l2ye/1UGqfoaECz72Hob+Z7EQvhcrnXzAOlI8sKDf/CEPSbxRlcR9AlBlPXLK6P3jZX69k//zdl4XWDYujdX2vyJDts+4znecfW837Ofi931IdLcN0vl12sM2NapZu/U79i21S2ygdBipATRoM4z0+ZwatIkGl3FXv4QxJyUJ8baKn7HGEBJwldWzMOVPPvB04KiwBHolctNr6jKj8WfyMl7xskLEfHMRAd0zYZtQ8/A0xrOArktka+WQJBt/HeSK0Iuk+koGZamPpyXZFSrlSLq8pTggMWfvMf4nn6tz5w4E5ad+nmhmLVvJJl3BRObMbtKmvPRfY2JNTCMS18Hjg3hXo/Pi2mKgJ3si0L324kESYKIxiO1g5pkiIJYDr+AHrDmgdza0YSTzFSFUaZjhxcYOobVcg2p4tCgqCC6l6pmBM6rpG75rut4fK8pEkutb6wSrK3GJafxgRimM+svpHVVdqW3P0Gg+CnEoTpD86N8/aqivpedtcRz0LQGGee2QKe+t4LNibLN2wyzD7E7sUkPYrCLZVW71yJouhVIX7hT9ga5kZwxvN6KtL0c4IO/Wl7avpg07QAAAAC4vGdlqgnIixK1r+6PYpdXN97wMiVrX9yd1zi5xbQo730IT4pvveBk1wGHAUrWv7jyatjd4N93M1hjEFZQGVef6KUw+voQnxRCrPhx33vAyGfHp611cghDzc5vJpWtf3AtERgVP6S3+4cY0J4az+gnonOPQrDGIKwIekfJoDKvPhiOyFsKO2e1socA0C9QOGmX7F8MhVnw4j3ll4dlhofR3TrgtM+PT1p3Myg/6uQQhlJYd+NA7dgN+FG/aPAr+KFIl5/EWiIwKuKeV09/SW/2x/UIk9VAp31t/MAYNZ/QTo0jtyuflhjFJyp/oLr9RxkCQSB8EPSPkqhI6PebFFg9I6g/WDEdkLaJoffTFHbPaqzKqA++fwfhBsNghF6gcNLmHBe39Km4WUwV3zzRwueFaX6A4HvLLw7Dd0hryw0PonOxaMdhBMcp2bigTERvmPX80/+Q7mZQflbaNxsOuSdNtgVAKKSw78YcDIijgduwGjln138r0niRk24f9Dsm9wODmpBmkS8/iCmTWO20RGBUDPgHMR5NqN+m8c+6/pLf7EYuuIlUmxdn7CdwAnHwSLvJTC/e2/mAMGNF51VrP6Cc04PH+cE2aBd5ig9y5F03y1zhUK5OVP9A9uiYJa6LiHMWN+8WBIJA+Lw+J50h6R8kmVV4QYvg168zXLDK7Vm2O1Xl0V5HUH6w/+wZ1WI7IWzah0YJyDLp53COjoIo7Z7UkFH5sYLkVl86WDE6p48Jgx8zbuYNhsEItTqmbb1A4aQF/IbBF0kpL6/1TkoyInbzip4Rlpgrvnggl9kdePTJS8BIri7S/QHAakFmpfeWXhxPKjl5XZ+Wl+Uj8fJNaxkF9dd+YOdi0Y5f3rbrwgmOUnq16TdoAEbZ0LwhvIjfMeowY1aPItb5YZpqngQHvaa9vwHB2K20bjYVCAlTHXJOmqXOKf+3e4YRD8fhdJIQ2c0qrL6oOBkRRoCldiPYxmZ1YHoBEHLPrv7Kc8mbV6TxIu8Ylkf9rTmpRRFezHZN7gbO8Ylj3EQmjWT4Qej5L3lRQZMeNFMmsdrrmta/s/nG6QtFoYwZ8A5ioUxpBzybUb6EJzbblpKZNS4u/lAmVLmZnuje/IxdcRI04RZ3qTYuzhGKSasDP+ZFu4OBIOPgkXZbXPYTSelZ/fFVPphsggYh1D5hRMaLzqp+N6nP1n9BOG7DJl18domzxMru1lkd1m/hobEK8xQe5EuoeYETy2nXq3cOsrnCoVwBfsY5nKn+gCQVmeU2oDYLjhxRboZmFqc+2nHCLG/eLJTTuUkJBIHwsbjmlaMNSXsbsS4eQ9I+SPtuWS3p2/bDUWeRpsywqR90DM56ZrlhlN4FBvEAAAAAAAAAAAMAAAAEAAQACAAEAAQAAAAEAAUAEAAIAAQAAAAEAAYAIAAgAAQAAAAEAAQAEAAQAAUAAAAIABAAIAAgAAUAAAAIABAAgACAAAUAAAAIACAAgAAAAQUAAAAgAIAAAgEABAUAAAAgAAIBAgEAEAUAQYHJAAu2EAECAwQEBQUGBgYGBwcHBwgICAgICAgICQkJCQkJCQkKCgoKCgoKCgoKCgoKCgoKCwsLCwsLCwsLCwsLCwsLCwwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDwAAEBESEhMTFBQUFBUVFRUWFhYWFhYWFhcXFxcXFxcXGBgYGBgYGBgYGBgYGBgYGBkZGRkZGRkZGRkZGRkZGRkaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHB0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0AAQIDBAUGBwgICQkKCgsLDAwMDA0NDQ0ODg4ODw8PDxAQEBAQEBAQERERERERERESEhISEhISEhMTExMTExMTFBQUFBQUFBQUFBQUFBQUFBUVFRUVFRUVFRUVFRUVFRUWFhYWFhYWFhYWFhYWFhYWFxcXFxcXFxcXFxcXFxcXFxgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxscwCcAAMAsAAABAQAAHgEAAA8AAABALAAAQC0AAAAAAAAeAAAADwAAAAAAAADALQAAAAAAABMAAAAHAAAAAAAAAAwACACMAAgATAAIAMwACAAsAAgArAAIAGwACADsAAgAHAAIAJwACABcAAgA3AAIADwACAC8AAgAfAAIAPwACAACAAgAggAIAEIACADCAAgAIgAIAKIACABiAAgA4gAIABIACACSAAgAUgAIANIACAAyAAgAsgAIAHIACADyAAgACgAIAIoACABKAAgAygAIACoACACqAAgAagAIAOoACAAaAAgAmgAIAFoACADaAAgAOgAIALoACAB6AAgA+gAIAAYACACGAAgARgAIAMYACAAmAAgApgAIAGYACADmAAgAFgAIAJYACABWAAgA1gAIADYACAC2AAgAdgAIAPYACAAOAAgAjgAIAE4ACADOAAgALgAIAK4ACABuAAgA7gAIAB4ACACeAAgAXgAIAN4ACAA+AAgAvgAIAH4ACAD+AAgAAQAIAIEACABBAAgAwQAIACEACAChAAgAYQAIAOEACAARAAgAkQAIAFEACADRAAgAMQAIALEACABxAAgA8QAIAAkACACJAAgASQAIAMkACAApAAgAqQAIAGkACADpAAgAGQAIAJkACABZAAgA2QAIADkACAC5AAgAeQAIAPkACAAFAAgAhQAIAEUACADFAAgAJQAIAKUACABlAAgA5QAIABUACACVAAgAVQAIANUACAA1AAgAtQAIAHUACAD1AAgADQAIAI0ACABNAAgAzQAIAC0ACACtAAgAbQAIAO0ACAAdAAgAnQAIAF0ACADdAAgAPQAIAL0ACAB9AAgA/QAIABMACQATAQkAkwAJAJMBCQBTAAkAUwEJANMACQDTAQkAMwAJADMBCQCzAAkAswEJAHMACQBzAQkA8wAJAPMBCQALAAkACwEJAIsACQCLAQkASwAJAEsBCQDLAAkAywEJACsACQArAQkAqwAJAKsBCQBrAAkAawEJAOsACQDrAQkAGwAJABsBCQCbAAkAmwEJAFsACQBbAQkA2wAJANsBCQA7AAkAOwEJALsACQC7AQkAewAJAHsBCQD7AAkA+wEJAAcACQAHAQkAhwAJAIcBCQBHAAkARwEJAMcACQDHAQkAJwAJACcBCQCnAAkApwEJAGcACQBnAQkA5wAJAOcBCQAXAAkAFwEJAJcACQCXAQkAVwAJAFcBCQDXAAkA1wEJADcACQA3AQkAtwAJALcBCQB3AAkAdwEJAPcACQD3AQkADwAJAA8BCQCPAAkAjwEJAE8ACQBPAQkAzwAJAM8BCQAvAAkALwEJAK8ACQCvAQkAbwAJAG8BCQDvAAkA7wEJAB8ACQAfAQkAnwAJAJ8BCQBfAAkAXwEJAN8ACQDfAQkAPwAJAD8BCQC/AAkAvwEJAH8ACQB/AQkA/wAJAP8BCQAAAAcAQAAHACAABwBgAAcAEAAHAFAABwAwAAcAcAAHAAgABwBIAAcAKAAHAGgABwAYAAcAWAAHADgABwB4AAcABAAHAEQABwAkAAcAZAAHABQABwBUAAcANAAHAHQABwADAAgAgwAIAEMACADDAAgAIwAIAKMACABjAAgA4wAIAAAABQAQAAUACAAFABgABQAEAAUAFAAFAAwABQAcAAUAAgAFABIABQAKAAUAGgAFAAYABQAWAAUADgAFAB4ABQABAAUAEQAFAAkABQAZAAUABQAFABUABQANAAUAHQAFAAMABQATAAUACwAFABsABQAHAAUAFwAFAEHg2QALTQEAAAABAAAAAQAAAAEAAAACAAAAAgAAAAIAAAACAAAAAwAAAAMAAAADAAAAAwAAAAQAAAAEAAAABAAAAAQAAAAFAAAABQAAAAUAAAAFAEHQ2gALZQEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAUAAAAGAAAABgAAAAcAAAAHAAAACAAAAAgAAAAJAAAACQAAAAoAAAAKAAAACwAAAAsAAAAMAAAADAAAAA0AAAANAEGA3AALIwIAAAADAAAABwAAAAAAAAAQERIACAcJBgoFCwQMAw0CDgEPAEG03AALaQEAAAACAAAAAwAAAAQAAAAFAAAABgAAAAcAAAAIAAAACgAAAAwAAAAOAAAAEAAAABQAAAAYAAAAHAAAACAAAAAoAAAAMAAAADgAAABAAAAAUAAAAGAAAABwAAAAgAAAAKAAAADAAAAA4ABBtN0AC5oCAQAAAAIAAAADAAAABAAAAAYAAAAIAAAADAAAABAAAAAYAAAAIAAAADAAAABAAAAAYAAAAIAAAADAAAAAAAEAAIABAAAAAgAAAAMAAAAEAAAABgAAAAgAAAAMAAAAEAAAABgAAAAgAAAAMAAAAEAAAABgAABuZWVkIGRpY3Rpb25hcnkAc3RyZWFtIGVuZAAAZmlsZSBlcnJvcgBzdHJlYW0gZXJyb3IAZGF0YSBlcnJvcgBpbnN1ZmZpY2llbnQgbWVtb3J5AGJ1ZmZlciBlcnJvcgBpbmNvbXBhdGlibGUgdmVyc2lvbgAAAAAoLwAAOC8AAEMvAABELwAATy8AAFwvAABnLwAAey8AAIgvAABDLwAAMS4yLjExAEHQ3wALA9AxUA==");let hg,pa;async function rD(){var r,t;if(hg)return hg;const n={};let s,c={};for(s in n)Object.prototype.hasOwnProperty.call(n,s)&&(c[s]=n[s]);let d=!1,h=!1;d=typeof window=="object",h=typeof importScripts=="function",typeof process=="object"&&typeof process.versions=="object"&&process.versions.node;let p="";(d||h)&&(h?p=self.location.href:typeof document!="undefined"&&document.currentScript&&(p=document.currentScript.src),p=Ft(p).call(p,"blob:")!==0?p.substr(0,tD(p).call(p,"/")+1):""),n.print||Mr(r=console.log).call(r,console);const A=n.printErr||Mr(t=console.warn).call(t,console);for(s in c)Object.prototype.hasOwnProperty.call(c,s)&&(n[s]=c[s]);let m;c=null,typeof WebAssembly!="object"&&At("no native wasm support detected");let E=!1;function v(at){const Lt=n["_"+at];var lt;return lt="Cannot call unknown function "+at+", make sure it is exported",Lt||At("Assertion failed: "+lt),Lt}function C(at,Lt,lt,R,B){const Q={string:function(We){let ri=0;if(We!=null&&We!==0){const fs=1+(We.length<<2);ri=tt(fs),function(Ti,Fn,yc){(function(Ea,sn,zr,Ri){if(!(Ri>0))return 0;const As=zr+Ri-1;for(let _a=0;_a<Ea.length;++_a){let Z=Ea.charCodeAt(_a);if(Z>=55296&&Z<=57343&&(Z=65536+((1023&Z)<<10)|1023&Ea.charCodeAt(++_a)),Z<=127){if(zr>=As)break;sn[zr++]=Z}else if(Z<=2047){if(zr+1>=As)break;sn[zr++]=192|Z>>6,sn[zr++]=128|63&Z}else if(Z<=65535){if(zr+2>=As)break;sn[zr++]=224|Z>>12,sn[zr++]=128|Z>>6&63,sn[zr++]=128|63&Z}else{if(zr+3>=As)break;sn[zr++]=240|Z>>18,sn[zr++]=128|Z>>12&63,sn[zr++]=128|Z>>6&63,sn[zr++]=128|63&Z}}sn[zr]=0})(Ti,w,Fn,yc)}(We,ri,fs)}return ri},array:function(We){const ri=tt(We.length);var fs,Ti;return fs=We,Ti=ri,y.set(fs,Ti),ri}},ut=v(at),Vt=[];let Ue=0;if(R)for(let We=0;We<R.length;We++){const ri=Q[lt[We]];ri?(Ue===0&&(Ue=Ut()),Vt[We]=ri(R[We])):Vt[We]=R[We]}let Tr=ut.apply(null,Vt);return Tr=function(We){return Lt==="string"?(ri=We)?function(Ti,Fn,yc){const Ea=Fn+yc;let sn=Fn,zr="";for(;Ti[sn]&&!(sn>=Ea);)++sn;if(sn-Fn>16&&Ti.subarray&&b)return b.decode(Ti.subarray(Fn,sn));for(;Fn<sn;){let Ri=Ti[Fn++];if(!(128&Ri)){zr+=String.fromCharCode(Ri);continue}const As=63&Ti[Fn++];if((224&Ri)==192){zr+=String.fromCharCode((31&Ri)<<6|As);continue}const _a=63&Ti[Fn++];if(Ri=(240&Ri)==224?(15&Ri)<<12|As<<6|_a:(7&Ri)<<18|As<<12|_a<<6|63&Ti[Fn++],Ri<65536)zr+=String.fromCharCode(Ri);else{const Z=Ri-65536;zr+=String.fromCharCode(55296|Z>>10,56320|1023&Z)}}return zr}(w,ri,fs):"":Lt==="boolean"?Boolean(We):We;var ri,fs}(Tr),Ue!==0&&Y(Ue),Tr}const b=typeof TextDecoder!="undefined"?new TextDecoder("utf8"):void 0;typeof TextDecoder!="undefined"&&new TextDecoder("utf-16le");let y,w,k;const P=[],V=[],j=[],st=[];V.push({func:function(){It()}});let mt=0,Et=null;function At(at){throw n.onAbort&&n.onAbort(at),A(at+=""),E=!0,at="abort("+at+"). Build with -s ASSERTIONS=1 for more info.",new WebAssembly.RuntimeError(at)}n.preloadedImages={},n.preloadedAudios={};let $="deflate.wasm";var rt,W;function H(at){for(;at.length>0;){const Lt=at.shift();if(typeof Lt=="function"){Lt(n);continue}const lt=Lt.func;typeof lt=="number"?Lt.arg===void 0?k.get(lt)():k.get(lt)(Lt.arg):lt(Lt.arg===void 0?null:Lt.arg)}}W="data:application/octet-stream;base64,",al(rt=$).call(rt,W)||($=function(at){return n.locateFile?n.locateFile(at,p):p+at}($));const U={emscripten_memcpy_big:function(at,Lt,lt){Gk(w).call(w,at,Lt,Lt+lt)},emscripten_resize_heap:function(at){At("OOM")}};await async function(){const at={env:U,wasi_snapshot_preview1:U};function Lt(B,Q){const ut=B.exports;var Vt;n.asm=ut,m=n.asm.memory,Vt=m.buffer,n.HEAP8=y=new Int8Array(Vt),n.HEAP16=new Int16Array(Vt),n.HEAP32=new Int32Array(Vt),n.HEAPU8=w=new Uint8Array(Vt),n.HEAPU16=new Uint16Array(Vt),n.HEAPU32=new Uint32Array(Vt),n.HEAPF32=new Float32Array(Vt),n.HEAPF64=new Float64Array(Vt),k=n.asm.__indirect_function_table,function(Ue){if(mt--,n.monitorRunDependencies&&n.monitorRunDependencies(mt),mt==0&&Et){const Tr=Et;Et=null,Tr()}}()}function lt(B){Lt(B.instance)}function R(B){return new dt((Q,ut)=>{Q(eD().buffer)}).then(function(Q){return WebAssembly.instantiate(Q,at)}).then(B,function(Q){A("failed to asynchronously prepare wasm: "+Q),At(Q)})}if(mt++,n.monitorRunDependencies&&n.monitorRunDependencies(mt),n.instantiateWasm)try{return n.instantiateWasm(at,Lt)}catch(B){return A("Module.instantiateWasm callback failed with error: "+B),!1}return await R(lt),{}}();let Tt,It=n.___wasm_call_ctors=function(){return(It=n.___wasm_call_ctors=n.asm.__wasm_call_ctors).apply(null,arguments)},Ct=n._malloc=function(){return(Ct=n._malloc=n.asm.malloc).apply(null,arguments)};n._free=function(){return(n._free=n.asm.free).apply(null,arguments)},n.___errno_location=function(){return(n.___errno_location=n.asm.__errno_location).apply(null,arguments)},n._zlibCompress=function(){return(n._zlibCompress=n.asm.zlibCompress).apply(null,arguments)};let Ut=n.stackSave=function(){return(Ut=n.stackSave=n.asm.stackSave).apply(null,arguments)},Y=n.stackRestore=function(){return(Y=n.stackRestore=n.asm.stackRestore).apply(null,arguments)},tt=n.stackAlloc=function(){return(tt=n.stackAlloc=n.asm.stackAlloc).apply(null,arguments)};function vt(at){function Lt(){Tt||(Tt=!0,n.calledRun=!0,E||(H(V),H(j),n.onRuntimeInitialized&&n.onRuntimeInitialized(),function(){if(n.postRun)for(typeof n.postRun=="function"&&(n.postRun=[n.postRun]);n.postRun.length;)lt=n.postRun.shift(),st.unshift(lt);var lt;H(st)}()))}mt>0||(function(){if(n.preRun)for(typeof n.preRun=="function"&&(n.preRun=[n.preRun]);n.preRun.length;)lt=n.preRun.shift(),P.unshift(lt);var lt;H(P)}(),mt>0||(n.setStatus?(n.setStatus("Running..."),vn(function(){vn(function(){n.setStatus("")},1),Lt()},1)):Lt()))}if(n.ccall=C,n.cwrap=function(at,Lt,lt,R){const B=Kk(lt=lt||[]).call(lt,function(Q){return Q==="number"});return Lt!=="string"&&B&&!R?v(at):function(){return C(at,Lt,lt,arguments)}},n.allocate=function(at,Lt){let lt;return lt=Lt==1?tt(at.length):Ct(at.length),at.subarray||en(at)?w.set(at,lt):w.set(new Uint8Array(at),lt),lt},Et=function at(){Tt||vt(),Tt||(Et=at)},n.run=vt,n.preInit)for(typeof n.preInit=="function"&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.pop()();return vt(),hg=n,n}const PS=Uint8Array.BYTES_PER_ELEMENT,nD={bytesReceived:"br",frameDropped:"fd",frameReceived:"fr",googJitterReceived:"jr",isAudioMute:"am",isFreeze:"fz",mediaType:"mt",packetsLost:"pl",packetsReceived:"pr",peerId:"pid",id:"id",ssrc:"ssrc",timestamp:"ts",type:"tp",frameRateInput:"fi",frameRateSent:"fs",googRtt:"rt",isVideoMute:"vm"},iD={stats:"sts",state:"st",stream_id:"stid",session_id:"seid",stream_type:"stt",app_id:"aid",channel_key:"ck",channel_name:"cn",sdk_version:"sv",browser:"b",process_id:"pcid",mode:"m",codec:"c",role:"r",has_changed_gateway:"hcg",ap_response:"ar",extends:"es",details:"d",features:"ft",p2p_id:"ppid",sdp:"sdp",audio:"a",video:"v",attributes:"at",hq:"h",lq:"l",stereo:"str",speech:"spe",extend:"e",pingpongElapse:"ppe"},oD={_message:"m",_type:"t",_id:"id"},sD={join_v2:"j2",publish:"pub",publish_related_stats:"prs",ping:"pi",traffic_stats:"ts",ping_back:"pib",publish_stats:"pubs"};let pg;class aD{constructor(){}async init(){pg||(pg=(await(async()=>(pa||(pa=await rD()),{zlibCompress:n=>{var s;const c=new Uint8Array(n),d=PS*c.byteLength,h=pa._malloc(d),p=pa._malloc(3*d);for(let E=0;E<d;E++)pa.HEAP8[h/PS+E]=c[E];const A=pa._zlibCompress(h,d,p),m=new Uint8Array(en(s=pa.HEAP8).call(s,p,p+A));return pa._free(h),pa._free(p),m}}))()).zlibCompress),this.zlibCompress=pg}msgPackCompress(t){return Fk.encode(t)}compress(t){const n=pt(),s=this.compressKeyAndValue(JSON.parse(ht(t))),c=this.msgPackCompress(s),d=this.zlibCompress(c),h=new Uint8Array([49,49,49,50,...Fe(d)]);return{origin:hr({},t),originLength:ht(t).length,shortKeyAndValue:s,msgpackSer:c,compressed:h,compressedLength:h.length,time:pt()-n}}compressKeyAndValue(t){return this._ObjectKeyCompress(this._typeCompress(t))}_typeCompress(t){const n=t._type;if(!n)return t;const s=sD[n];return t._type=s||n,t}_ObjectKeyCompress(t){const n=t._message;if(n){const s=n.stats;s&&(n.stats=this._statsCompress(s)),t._message=this._messageCompress(n)}return this._reportCompress(t)}_statsCompress(t){return this._keyCompress(t,nD)}_messageCompress(t){return this._keyCompress(t,iD)}_reportCompress(t){return this._keyCompress(t,oD)}_keyCompress(t,n){const s={},c=le(t);return Ih(c).call(c,(d,h)=>{const p=t[h];return n[h]?s[n[h]]=p:s[h]=p,s},s),s}}class cD extends Hr{constructor(t){super(),this.lowPriorityQueue=[],this.highPriorityQueue=[],this.AgoraWebSocketManager=t}get queue(){return[...this.highPriorityQueue,...this.lowPriorityQueue]}reset(){this.lowPriorityQueue=[],this.highPriorityQueue=[]}pushMessage(t,n=!1){n?this.highPriorityQueue.push(t):this.lowPriorityQueue.push(t),this.sendMessage()}sendMessage(){const t=this.queue.length;let n=0;n=t<5?15*t:60+3*(t-4),vn(()=>{this._sendMessage()},n)}_sendMessage(){var t;if(!this.queue.length)return;const n=this.AgoraWebSocketManager.getConnection();if(!n||n.readyState!==1)return;const s=this.queue.shift();return zt(t=this.lowPriorityQueue).call(t,s)?this.lowPriorityQueue.shift():this.highPriorityQueue.shift(),n.send(s.compressed),s}}class ap extends Hr{constructor(t,n,s=!1,c=!1){super(),this.connectionID=0,this.currentURLIndex=0,this.reconnectMode="tryNext",this._state="closed",this.reconnectCount=0,this.isCompressorInitSuccess=!1,this.tryDoubleDomain=!1,this.wsInflateLength=0,this.wsDeflateLength=0,this.closeEstablishingWs=()=>{},this.name=t,this.retryConfig=n,this.useCompress=s,this.tryDoubleDomain=c}get url(){return this.websocket?this.websocket.url:null}get ipPortTuple(){if(!this.url)return[void 0,void 0];const t=/^wss:\/\/(\d+-\d+-\d+-\d+)\..+:(\d+)\/?$/.exec(this.url);return t&&t[1]&&t[2]?[t[1].split("-").join("."),t[2]]:[void 0,void 0]}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(Je.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Je.CONNECTED):this._state==="closed"?this.emit(Je.CLOSED):this._state==="failed"&&this.emit(Je.FAILED))}getConnection(){return this.websocket||void 0}init(t){const n=(s,c)=>{this.urls=t;const d=this.urls[this.currentURLIndex];this.state="connecting",this.messageSender=new cD(this),this.createWebSocketConnection(d).then(s).catch(c),this.once(Je.CLOSED,()=>c(new M(L.WS_DISCONNECT))),this.once(Je.CONNECTED,()=>s())};return new dt((s,c)=>{this.compressor=new aD,this.compressor.init().then(()=>{var d;S.debug("websocket compressor initialized successfully"),gt.wsCompressorInit({status:!0,ec:null,eventElapse:1}),this.isCompressorInitSuccess=!0,this.compress=Mr(d=this.compressor.compress).call(d,this.compressor),n(s,c)}).catch(d=>{n(s,c),S.debug("websocket compressor failed to initialize"),gt.wsCompressorInit({status:!1,ec:d?d.message||d.toString():"Empty Error",eventElapse:1})})})}close(t,n){if(this.currentURLIndex=0,this.reconnectCount=0,this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const s=this.websocket;n?vn(()=>s.close(),500):s.close(),this.websocket=void 0}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,n){if(!this.websocket)return void S.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),S.debug("[".concat(this.name,"] reconnect is triggered initiative"));const s=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),s&&Mr(s).call(s,this.websocket)({code:9999,reason:n})}sendMessage(t,n=!1){if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new M(L.WS_ABORT,"websocket is not ready");try{let s=null;if(this.isCompressorInitSuccess&&this.useCompress&&ot("WEBSOCKET_COMPRESS"))s=this.compress(t),this.setWsInflateData(s);else{if(this.isCompressorInitSuccess&&this.useCompress){const d=this.compress(t);this.setWsInflateData(d)}const c=ht(t);s={compressed:c,compressedLength:c.length,origin:t}}n?this.websocket.send(s.compressed):this.messageSender.pushMessage(s)}catch(s){throw new M(L.WS_ERR,"send websocket message error"+s.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t,n){return this.connectionID+=1,this.connectionID,new dt((s,c)=>{var d,h;const p=()=>{S.debug("[".concat(this.name,"] websocket opened:"),t),this.reconnectMode="retry",this.state="connected",this.reconnectCount=0,s()},A=async E=>{var v,C,b,y;if(S.debug(O(v=O(C=O(b=O(y="[".concat(this.name,"] websocket close ")).call(y,this.websocket&&this.websocket.url,", code: ")).call(b,E.code,", reason: ")).call(C,E.reason,", current mode: ")).call(v,this.reconnectMode)),this.reconnectCount<this.retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=E.reason,this.state="reconnecting");const w=Io(this,Je.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,k=await this.reconnectWithAction(w);if(this.state==="closed")return void S.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!k)return c(new M(L.WS_DISCONNECT,"websocket reconnect failed: ".concat(E.code))),void this.close(!0);s()}else c(new M(L.WS_DISCONNECT,"websocket close: ".concat(E.code))),this.close()},m=E=>{this.emit(Je.ON_MESSAGE,E)};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),ot("GATEWAY_WSS_ADDRESS")&&al(d=this.name).call(d,"gateway")&&(t=ot("GATEWAY_WSS_ADDRESS")),S.debug(O(h="[".concat(this.name,"] start connect, url: ")).call(h,t)),this.chooseBestWebsocketConnection(t,!!n).then(E=>{this.websocket=E,p&&p(),E.onclose=A,E.onmessage=m}).catch(E=>{if(this.state!=="closed"){if(E instanceof M&&E.code===L.WS_ERR){var v;const C=new M(L.WS_ERR,"init websocket failed! Error: ".concat(E.toString()));return S.error(O(v="[".concat(this.name,"]")).call(v,C)),void c(C)}A&&A(E)}else c(new M(L.WS_DISCONNECT,"websocket is closed: ".concat(E.toString())))})})}async reconnectWithAction(t,n){var s,c;if(!n&&this.reconnectCount>=this.retryConfig.maxRetryCount||!this.urls||this.state==="closed")return!1;this.onlineReconnectListener||yr.networkState!==mo.OFFLINE||(this.onlineReconnectListener=yr.onlineWaiter&&yr.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));const d=ng(this.reconnectCount,this.retryConfig);if(S.debug(O(s=O(c="[".concat(this.name,"] wait ")).call(c,d,"ms to reconnect websocket, mode: ")).call(s,t)),await dt.race([Ur(d),this.onlineReconnectListener||new dt(()=>{})]),this.state==="closed")return!1;this.reconnectCount+=1;try{if(t==="retry"){const A=this.urls[this.currentURLIndex];await this.createWebSocketConnection(A)}else if(t==="tryNext"){var h,p;if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return await this.reconnectWithAction("recover");S.debug(O(h=O(p="[".concat(this.name,"] websocket url length: ")).call(p,this.urls.length," current index: ")).call(h,this.currentURLIndex));const A=this.urls[this.currentURLIndex];await this.createWebSocketConnection(A)}else if(t==="recover"){S.debug("[".concat(this.name,"] request new urls")),this.urls=await xr(this,Je.REQUEST_NEW_URLS),this.currentURLIndex=0;const A=this.urls[this.currentURLIndex];await this.createWebSocketConnection(A)}return!0}catch(A){return S.error("[".concat(this.name,"] reconnect failed"),A.toString()),await this.reconnectWithAction(t)}}async chooseBestWebsocketConnection(t,n){return new dt((s,c)=>{let d=!1;const h=[];this.closeEstablishingWs=()=>{S.debug("[choose-best-ws] close establishing websockets"),G(h).call(h,b=>{b.onclose=null,b.onopen=null,b.onmessage=null,b.close()}),c(new M(L.WS_ABORT,"choose best websocket aborted"))};const p=ot("GATEWAY_DOMAINS");let A;const m=Ft(t).call(t,"?h="),E=_t(p).call(p,b=>m!==-1?zt(t).call(t,b,m):zt(t).call(t,b));S.debug("[choose-best-ws] currentDomain: ",E,", domains: ",p);let v=!this.tryDoubleDomain||n||!E;if(!v&&E){try{G(p).call(p,b=>{const y=m===-1?t.replace(E,b):t.substr(0,m)+t.substr(m).replace(E,b),w=new WebSocket(y);w.binaryType="arraybuffer",h.push(w),S.debug("[choose-best-ws] ws is connecting:",w.url)})}catch{for(S.debug("[choose-best-ws] ws create failed, fallback to single url"),G(h).call(h,y=>y.close());h.length;)h.pop();v=!0}G(h).call(h,b=>{b.onopen=()=>{var y;d||(G(y=kt(h).call(h,w=>w!==b)).call(y,w=>{S.debug("[choose-best-ws]close backup websocket: ".concat(w.url)),w.close()}),d=!0,s(b))},b.onclose=y=>{A=y,!d&&(_t(h).call(h,w=>!(w.readyState===WebSocket.CLOSED||w.readyState===WebSocket.CLOSING))||(S.debug("[choose-best-ws] all websocket is closed"),d=!0,c(A)))},b.onmessage=y=>{var w;S.debug(O(w="[choose-best-ws]".concat(b.url," onmessage: ")).call(w,y.data))}}),Ur(5e3).then(()=>{G(h).call(h,b=>{b.readyState!==WebSocket.OPEN&&b.close()})})}if(v){let b;S.debug("[choose-best-ws] use single url: ",t);try{b=new WebSocket(t),h.push(b),b.binaryType="arraybuffer"}catch(y){var C;const w=new M(L.WS_ERR,"init websocket failed! Error: ".concat(y.toString()));return S.error(O(C="[".concat(this.name,"]")).call(C,w)),void c(w)}b.onopen=()=>{s(b)},b.onclose=y=>{c(y)},b.onmessage=y=>{var w;S.debug(O(w="[choose-best-ws]".concat(b.url," onmessage: ")).call(w,y.data))},Ur(5e3).then(()=>{b&&b.readyState!==WebSocket.OPEN&&b.close()})}}).finally(()=>{this.closeEstablishingWs=void 0})}}class BS{constructor(t){this.input=[],this.size=t}add(t){var n;this.input.push(t),this.input.length>this.size&&Ye(n=this.input).call(n,0,1)}mean(){var t;return this.input.length===0?0:Ih(t=this.input).call(t,(n,s)=>n+s)/this.input.length}}class lD extends Hr{constructor(t){super(),this._connectionState=In.CLOSED,this.openConnectionTime=pt(),this.lastMsgTime=pt(),this.uploadCache=[],this.rttRolling=new BS(5),this.pingpongTimeoutCount=0,this.onWebsocketMessage=n=>{if(n.data instanceof ArrayBuffer)return void this.emit(ye.ON_BINARY_DATA,n.data);const s=JSON.parse(n.data);if(this.lastMsgTime=pt(),Object.prototype.hasOwnProperty.call(s,"_id")){const c="res-@".concat(s._id);this.emit(c,s._result,s._message)}else if(Object.prototype.hasOwnProperty.call(s,"_type")&&(this.emit(s._type,s._message),s._type===rr.ON_NOTIFICATION&&this.handleNotification(s._message),s._type===rr.ON_USER_BANNED))switch(s._message.error_code){case 14:this.close("UID_BANNED");break;case 15:this.close("IP_BANNED");break;case 16:this.close("CHANNEL_BANNED")}},this.clientId=t.clientId,this.spec=t,this.websocket=new ap("gateway-".concat(this.clientId),this.spec.retryConfig,!0,!0),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===In.CONNECTED&&this.reconnect("retry",Ci.OFFLINE)})}get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===In.CONNECTED?this.emit(ye.WS_CONNECTED):t===In.RECONNECTING?this.emit(ye.WS_RECONNECTING,this._websocketReconnectReason):t===In.CLOSED&&this.emit(ye.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}async request(t,n,s,c){var d,h,p,A,m;const E=Le(6,""),v={_id:E,_type:t,_message:n},C=this.websocket.connectionID,b=()=>new dt((j,st)=>{if(this.connectionState===In.CONNECTED)return j();const mt=()=>{this.off(ye.WS_CLOSED,Et),j()},Et=()=>{this.off(ye.WS_CONNECTED,mt),st(new M(L.WS_ABORT))};this.once(ye.WS_CONNECTED,mt),this.once(ye.WS_CLOSED,Et),t!==xe.PUBLISH&&t!==xe.SUBSCRIBE&&t!==xe.UNSUBSCRIBE&&t!==xe.UNPUBLISH&&t!==xe.CONTROL||this.once(ye.DISCONNECT_P2P,()=>{st(new M(L.DISCONNECT_P2P))})});if(this.connectionState!==In.CONNECTING&&this.connectionState!==In.RECONNECTING||t===xe.JOIN||t===xe.REJOIN||await b(),this.websocket.sendMessage(v,!0),c)return;const y=new dt((j,st)=>{let mt=!1;const Et=($,rt)=>{mt=!0,j({isSuccess:$==="success",message:rt||{}}),this.off(ye.WS_CLOSED,At),this.off(ye.WS_RECONNECTING,At),this.emit(ye.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(E),Et);const At=()=>{st(new M(L.WS_ABORT,"type: ".concat(t))),this.off(ye.WS_CLOSED,At),this.off(ye.WS_RECONNECTING,At),this.off("res-@".concat(E),Et)};this.once(ye.WS_CLOSED,At),this.once(ye.WS_RECONNECTING,At),Ur(ot("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==C||mt||(S.warning("ws request timeout, type: ".concat(t)),this.emit(ye.REQUEST_TIMEOUT,t,n))})});let w=null;try{w=await y}catch(j){if(this.connectionState===In.CLOSED||t===xe.LEAVE)throw new M(L.WS_ABORT);return!this.spec.forceWaitGatewayResponse||s?j.throw():t===xe.JOIN||t===xe.REJOIN?null:(await b(),await this.request(t,n))}if(w.isSuccess)return w.message;const k=Number(w.message.error_code||w.message.code),P=ip(k),V=new M(L.UNEXPECTED_RESPONSE,O(d="".concat(P.desc,": ")).call(d,w.message.error_str),{code:k,data:w.message});return P.action==="success"?w.message:(S.warning(O(h=O(p=O(A=O(m="[".concat(this.websocket.connectionID,"] unexpected response from type ")).call(m,t,", error_code: ")).call(A,k,", message: ")).call(p,P.desc,", action: ")).call(h,P.action)),P.action==="failed"?V.throw():P.action==="quit"?(this.initError=V,this.close(),V.throw()):(k===oe.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=w.message.option,S.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Ci.MULTI_IP)):this.reconnect(P.action,Ci.SERVER_ERROR),t===xe.JOIN||t===xe.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new dt(s=>{const c=d=>{(!n||n(d))&&(this.off(t,c),s(d))};this.on(t,c)})}upload(t,n){const s={_type:t,_message:n};try{this.websocket.sendMessage(s)}catch{const h=ot("MAX_UPLOAD_CACHE")||50;var c;this.uploadCache.push(s),this.uploadCache.length>h&&Ye(c=this.uploadCache).call(c,0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{var p;if(this.connectionState!==In.CONNECTED)return;const A=Ye(p=this.uploadCache).call(p,0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(A._type,A._message)},ot("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const s={_type:t,_message:n};this.websocket.sendMessage(s)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,new dt((n,s)=>{this.once(ye.WS_CONNECTED,()=>n(this.joinResponse)),this.once(ye.WS_CLOSED,()=>s(this.initError||new M(L.WS_ABORT))),this.connectionState=In.CONNECTING,this.websocket.init(t).catch(s),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||"LEAVE",this.connectionState=In.CLOSED,this.websocket.close()}async join(){var t;if(!this.joinResponse){const n=await xr(this,ye.REQUEST_JOIN_INFO),s=await this.request(xe.JOIN,n);if(!s)return this.emit(ye.REPORT_JOIN_GATEWAY,L.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(ye.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=In.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(Mr(t=this.handlePingPong).call(t,this),3e3),!0}async rejoin(){var t,n;if(!this.reconnectToken)throw new M(L.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const s=Va(this,ye.REQUEST_REJOIN_INFO);s.token=this.reconnectToken;const c=await this.request(xe.REJOIN,s);return!!c&&(this.connectionState=In.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(Mr(t=this.handlePingPong).call(t,this),3e3),c.peers&&G(n=c.peers).call(n,d=>{this.emit(rr.ON_USER_ONLINE,{uid:d.uid}),d.audio_mute?this.emit(rr.MUTE_AUDIO,{uid:d.uid}):this.emit(rr.UNMUTE_AUDIO,{uid:d.uid}),d.video_mute?this.emit(rr.MUTE_VIDEO,{uid:d.uid}):this.emit(rr.UNMUTE_VIDEO,{uid:d.uid}),d.audio_enable_local?this.emit(rr.ENABLE_LOCAL_AUDIO,{uid:d.uid}):this.emit(rr.DISABLE_LOCAL_AUDIO,{uid:d.uid}),d.video_enable_local?this.emit(rr.ENABLE_LOCAL_VIDEO,{uid:d.uid}):this.emit(rr.DISABLE_LOCAL_VIDEO,{uid:d.uid}),d.audio||d.video||this.emit(rr.ON_REMOVE_STREAM,{uid:d.uid,uint_id:d.uint_id}),d.audio&&this.emit(rr.ON_ADD_AUDIO_STREAM,{uid:d.uid,uint_id:d.uint_id,audio:!0}),d.video&&this.emit(rr.ON_ADD_VIDEO_STREAM,{uid:d.uid,uint_id:d.uint_id,video:!0})}),!0)}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}handleNotification(t){S.debug("[".concat(this.clientId,"] receive notification: "),t);const n=ip(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close("UID_BANNED"),void this.close()):void this.reconnect(n.action,Ci.SERVER_ERROR);S.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=ot("PING_PONG_TIME_OUT"),n=pt();this.pingpongTimeoutCount>=t&&(S.warning("PINGPONG Timeout. Last Socket Message: ".concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>ot("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Ci.TIMEOUT):this.request(xe.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const s=pt()-n;this.rttRolling.add(s),ot("REPORT_STATS")&&this.send(xe.PING_BACK,{pingpongElapse:s})}).catch(s=>{})}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:n}=this.websocket.getWsInflateData();t!==0&&n!==0&&this.upload(Po.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(Je.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Je.CLOSED,()=>{this.connectionState=In.CLOSED}),this.websocket.on(Je.FAILED,()=>{this._disconnectedReason="NETWORK_ERROR",this.connectionState=In.CLOSED}),this.websocket.on(Je.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===In.CONNECTED?this.connectionState=In.RECONNECTING:this.connectionState=In.CONNECTING}),this.websocket.on(Je.WILL_RECONNECT,(t,n)=>{if(Va(this,ye.IS_P2P_DISCONNECTED)&&t==="retry")return this.reconnectToken=void 0,this.emit(ye.NEED_RENEW_SESSION),this.emit(ye.DISCONNECT_P2P),n("tryNext");t!=="retry"&&(this.reconnectToken=void 0,this.emit(ye.NEED_RENEW_SESSION),this.emit(ye.DISCONNECT_P2P)),n(t)}),this.websocket.on(Je.CONNECTED,()=>{this.openConnectionTime=pt(),this.reconnectToken?this.rejoin().catch(t=>{var n;S.warning(O(n="[".concat(this.clientId,"] rejoin failed ")).call(n,t)),this.reconnect("tryNext",Ci.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(ye.REPORT_JOIN_GATEWAY,t.message||t.code,this.url||""),t instanceof M&&t.code===L.UNEXPECTED_RESPONSE&&t.data.code===oe.ERR_NO_AUTHORIZED)return S.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Ci.SERVER_ERROR);S.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Ci.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(Je.REQUEST_NEW_URLS,(t,n)=>{xr(this,ye.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)})}}function US(r,t){var n=le(r);if(ee){var s=ee(r);t&&(s=kt(s).call(s,function(c){return Wt(r,c).enumerable})),n.push.apply(n,s)}return n}function cp(r){for(var t=1;t<arguments.length;t++){var n,s=arguments[t]!=null?arguments[t]:{};if(t%2)G(n=US(Object(s),!0)).call(n,function(d){_r(r,d,s[d])});else if(te)He(r,te(s));else{var c;G(c=US(Object(s))).call(c,function(d){se(r,d,Wt(s,d))})}}return r}const fg=new re;class dD extends Hr{constructor(t,n){super(),this.inChannelInfo={joinAt:null,duration:0},this._state="DISCONNECTED",this.isSignalRecover=!1,this.hasChangeBGPAddress=!1,this.joinGatewayStartTime=0,this._signalTimeout=!1,this.store=t,this.spec=n,this.signal=new lD(cp({},n,{retryConfig:n.websocketRetryConfig})),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}get state(){return this._state}set state(t){if(t===this._state)return;const n=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(Ir.CONNECTION_STATE_CHANGE,t,n,this._disconnectedReason):this.emit(Ir.CONNECTION_STATE_CHANGE,t,n)}async join(t,n){var s,c;this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const d=pt();let h=fg.get(t.cname);if(h||(h=new re,fg.set(t.cname,h)),h.has(t.uid)){const m=new M(L.UID_CONFLICT);throw gt.joinGateway(t.sid,{lts:d,succ:!1,ec:m.message,addr:null,uid:t.uid,cid:t.cid}),m}h.set(t.uid,!0),this.joinInfo=t,this.key=n;const p=t.proxyServer?ft(s=t.gatewayAddrs).call(s,m=>{var E,v;const C=m.split(":");return O(E=O(v="wss://".concat(t.proxyServer,"/ws/?h=")).call(v,C[0],"&p=")).call(E,C[1])}):ft(c=t.gatewayAddrs).call(c,m=>"wss://".concat(m));let A=0;this.joinGatewayStartTime=d;try{A=(await this.signal.init(p)).uid}catch(m){throw S.error("[".concat(this.store.clientId,"] User join failed"),m.toString()),gt.joinGateway(t.sid,{lts:d,succ:!1,ec:m.message,addr:this.signal.url,uid:t.uid,cid:t.cid}),h.delete(t.uid),this.signal.close(),m}return this.state="CONNECTED",this.inChannelInfo.joinAt=pt(),S.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(m=>{S.warning("[".concat(this.store.clientId,"] get traffic stats error"),m.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Ir.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Ir.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Ir.NETWORK_QUALITY,{uplinkNetworkQuality:vS(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:vS(this._statsCollector.trafficStats.B_dnq)}):this.emit(Ir.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),A}async leave(t=!1){if(this.state!=="DISCONNECTED"){this.state="DISCONNECTING";try{t||this.signal.connectionState!==In.CONNECTED||await yS(this.signal.request(xe.LEAVE,void 0,!0),3e3)}catch(n){S.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),n)}this.signal.close(),this.reset(),this.state="DISCONNECTED"}}async publish(t,n,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new M(L.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const c={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:ot("PUB_EXTEND")};try{return(await this.signal.request(xe.PUBLISH,c,!0))._message}catch(d){if(s&&d.data&&d.data.code===oe.ERR_PUBLISH_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),d.toString()),await this.tryUnpubBeforeRepub(t,n),this.publish(t,n,!1);throw d}}async unpublish(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new M(L.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(xe.UNPUBLISH,{stream_id:n,ortc:t},!0)}catch(s){S.warning("unpublish warning: ",s)}}async subscribe(t,n,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new M(L.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const c={stream_id:t,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,tcc:!!ot("SUBSCRIBE_TCC"),extend:ot("SUB_EXTEND"),ssrcId:n.ssrcId};try{return(await this.signal.request(xe.SUBSCRIBE,c,!0))._message}catch(d){if(s&&d.data&&d.data.code===oe.ERR_SUBSCRIBE_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),d.toString()),await this.tryUnsubBeforeResub(t,n),await this.subscribe(t,n,!1);throw d}}async unsubscribe(t,n){try{await this.signal.request(xe.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:n},!0)}catch(s){S.warning("unsubscribe warning: ",s)}}async reconnectPC(t){const{iceParameters:n,dtlsParameters:s,rtpCapabilities:c}=t;return{gatewayEstablishParams:await this.signal.request(xe.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:s,rtpCapabilities:c}},!0)}}getGatewayInfo(){return this.signal.request(xe.GATEWAY_INFO)}renewToken(t){return this.signal.request(xe.RENEW_TOKEN,t)}async setClientRole(t,n){if(n&&(this._clientRoleOptions=hr({},n)),this.state!=="CONNECTED")return void(this.role=t);let s;s=t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:0,await this.signal.request(xe.SET_CLIENT_ROLE,{role:t,level:s}),this.role=t}async setRemoteVideoStreamType(t,n){await this.signal.request(xe.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:n})}async setStreamFallbackOption(t,n){await this.signal.request(xe.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:n})}async pickSVCLayer(t,n){await this.signal.request(xe.PICK_SVC_LAYER,{stream_id:t,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=pt()-this.inChannelInfo.joinAt),cp({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(xe.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=pt()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=fg.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=function(n){const s=n.match(/(wss\:\/\/)?([^:]+):(\d+)/);return s?{username:qe.username,password:qe.password,turnServerURL:s[2],tcpport:Sr(s[3])+30,udpport:Sr(s[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex])||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(cp({},qe,{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){var t;if(this.state!=="CONNECTED")return;const n=await this.signal.request(xe.TRAFFIC_STATS,void 0,!0);n.timestamp=pt(),G(t=n.peer_delay).call(t,s=>{var c;const d=this._statsCollector.trafficStats&&_t(c=this._statsCollector.trafficStats.peer_delay).call(c,h=>h.peer_uid===s.peer_uid);d&&d.B_st!==s.B_st&&on(()=>{this.emit(Ir.STREAM_TYPE_CHANGE,s.peer_uid,s.B_st)})}),this._statsCollector.updateTrafficStats(n)}getJoinMessage(t){if(!this.joinInfo||!this.key)throw new M(L.UNEXPECTED_ERROR,"can not generate join message, no join info");const n=hr({},this.joinInfo.apResponse);let s=ot("REPORT_APP_SCENARIO");if(typeof s!="string")try{s=ht(s)}catch{s=void 0}s&&s.length>128&&(s=void 0);const c=cp({p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Pn,browser:navigator.userAgent,process_id:ot("PROCESS_ID"),mode:this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:n,extend:ot("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:s},t);return this.joinInfo.stringUid&&(c.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(c.aes_mode=this.joinInfo.aesmode,ot("ENCRYPT_AES")?(c.aes_secret=this.joinInfo.aespassword,c.aes_encrypt=!0):c.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(c.aes_salt=this.joinInfo.aessalt)),n.addresses[this.signal.websocket.currentURLIndex]&&(c.ap_response.ticket=n.addresses[this.signal.websocket.currentURLIndex].ticket,delete n.addresses),c}getRejoinMessage(){if(!this.joinInfo)throw new M(L.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(ye.WS_RECONNECTING,t=>{this.joinInfo&&gt.WebSocketQuit(this.joinInfo.sid,{lts:pt(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||Ci.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",gt.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode}),this.isSignalRecover=!1,this.joinGatewayStartTime=pt())}),this.signal.on(ye.WS_CLOSED,t=>{let n;switch(t){case"LEAVE":n=Ci.LEAVE;break;case"UID_BANNED":case"IP_BANNED":case"CHANNEL_BANNED":case"SERVER_ERROR":n=Ci.SERVER_ERROR;break;default:n=Ci.NETWORK_ERROR}S.debug("[signal] websocket closed, reason: ".concat(n||"undefined -> "+Ci.NETWORK_ERROR)),this.joinInfo&&gt.WebSocketQuit(this.joinInfo.sid,{lts:pt(),succ:t==="LEAVE"?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this.reset(),this._disconnectedReason=t,this.state="DISCONNECTED"}),this.signal.on(ye.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){var t,n,s;if(this.role==="audience"&&this._clientRoleOptions&&this._clientRoleOptions.level&&(S.debug(O(t=O(n=O(s="[".concat(this.store.clientId,"] patch to send set client role, role: ")).call(s,this.role,", mode: ")).call(n,this.spec.mode,", level: ")).call(t,this._clientRoleOptions&&this._clientRoleOptions.level)),this.setClientRole(this.role,this._clientRoleOptions)),gt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid}),this.joinInfo.useLocalAccessPoint){const d=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);var c;if(!d)return void S.error(O(c="[".concat(this.store.clientId,"] set local access point after joined failed: ")).call(c,d));jr("EVENT_REPORT_DOMAIN",d[1]),jr("EVENT_REPORT_BACKUP_DOMAIN",d[1]),jr("LOG_UPLOAD_SERVER","".concat(d[1],":6444"))}}}),this.signal.on(rr.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(ye.REQUEST_RECOVER,(t,n,s)=>{if(!this.joinInfo)return s(new M(L.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,xr(this,Ir.REQUEST_NEW_GATEWAY_LIST).then(n).catch(s)}),this.signal.on(ye.REQUEST_JOIN_INFO,async t=>{var n;this.updateTurnConfigFromSignal();const{iceParameters:s,dtlsParameters:c,rtpCapabilities:d}=await xr(this,Ir.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:(n=this.joinInfo)===null||n===void 0?void 0:n.turnServer});t(this.getJoinMessage({ortc:{iceParameters:s,dtlsParameters:c,rtpCapabilities:d}}))}),this.signal.on(ye.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(ye.REPORT_JOIN_GATEWAY,(t,n)=>{this.joinInfo&&gt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:t,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid})}),this.signal.on(ye.IS_P2P_DISCONNECTED,t=>{t(Va(this,Ir.IS_P2P_DISCONNECTED))}),this.signal.on(ye.DISCONNECT_P2P,()=>{this.emit(Ir.DISCONNECT_P2P)}),this.signal.on(ye.NEED_RENEW_SESSION,()=>{this.emit(Ir.NEED_RENEW_SESSION)}),this.signal.on(ye.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(ye.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(ye.JOIN_RESPONSE,t=>{this.emit(Ir.JOIN_RESPONSE,t)})}async tryUnsubBeforeResub(t,n){try{await this.signal.request(xe.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[n]},!0)}catch(s){throw S.warning("unsubscribe warning",s),s}}async tryUnpubBeforeRepub(t,n){try{await this.signal.request(xe.UNPUBLISH,{stream_id:t,ortc:n},!0)}catch(s){throw S.warning("unpublish warning: ",s),s}}async muteLocal(t,n){const s={action:_t(t).call(t,c=>c.stream_type===Kr.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(xe.CONTROL,s,!0,!0)}catch(c){throw S.warning("gateway unmuteLocal warning: ",c),c}}async unmuteLocal(t,n){const s={action:_t(t).call(t,c=>c.stream_type===Kr.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(xe.CONTROL,s,!0,!0)}catch(c){throw S.warning("gateway muteLocal warning: ",c),c}}uploadStats(t,n){this.signal.upload(t,n)}getSignalRTT(){return this.signal.rtt}async restartICE(t){const n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return{response:await this.signal.request(xe.RESTART_ICE,n,!0)}}catch(s){throw S.warning("P2PChannel.restartICE warning: ",s),s}}reconnect(){this.state==="CONNECTED"&&this.signal.reconnect(void 0,Ci.P2P_FAILED)}}var uD=pn("iterator"),Ag=!f(function(){var r=new URL("b?a=1&b=2&c=3","http://a"),t=r.searchParams,n="";return r.pathname="c%20d",t.forEach(function(s,c){t.delete("b"),n+=c+s}),!r.toJSON||!t.sort||r.href!=="http://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[uD]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://\u0442\u0435\u0441\u0442").host!=="xn--e1aybc"||new URL("http://a#\u0431").hash!=="#%D0%B1"||n!=="a1c3"||new URL("http://x",void 0).host!=="x"}),gg=2147483647,hD=/[^\0-\u007E]/,pD=/[.\u3002\uFF0E\uFF61]/g,xS="Overflow: input needs wider integers to process",Sl=Math.floor,mg=String.fromCharCode,FS=function(r){return r+22+75*(r<26)},fD=function(r,t,n){var s=0;for(r=n?Sl(r/700):r>>1,r+=Sl(r/t);r>455;s+=36)r=Sl(r/35);return Sl(s+36*r/(r+38))},AD=function(r){var t,n,s=[],c=(r=function(P){for(var V=[],j=0,st=P.length;j<st;){var mt=P.charCodeAt(j++);if(mt>=55296&&mt<=56319&&j<st){var Et=P.charCodeAt(j++);(64512&Et)==56320?V.push(((1023&mt)<<10)+(1023&Et)+65536):(V.push(mt),j--)}else V.push(mt)}return V}(r)).length,d=128,h=0,p=72;for(t=0;t<r.length;t++)(n=r[t])<128&&s.push(mg(n));var A=s.length,m=A;for(A&&s.push("-");m<c;){var E=gg;for(t=0;t<r.length;t++)(n=r[t])>=d&&n<E&&(E=n);var v=m+1;if(E-d>Sl((gg-h)/v))throw RangeError(xS);for(h+=(E-d)*v,d=E,t=0;t<r.length;t++){if((n=r[t])<d&&++h>gg)throw RangeError(xS);if(n==d){for(var C=h,b=36;;b+=36){var y=b<=p?1:b>=p+26?26:b-p;if(C<y)break;var w=C-y,k=36-y;s.push(mg(FS(y+w%k))),C=Sl(w/k)}s.push(mg(FS(C))),p=fD(h,v,m==A),h=0,++m}}++h,++d}return s.join("")},QS=function(r){var t=md(r);if(typeof t!="function")throw TypeError(String(r)+" is not iterable");return Nr(t.call(r))},VS=qn("fetch"),Eg=qn("Headers"),gD=pn("iterator"),Kd="URLSearchParams",GS="URLSearchParamsIterator",jS=fn.set,us=fn.getterFor(Kd),mD=fn.getterFor(GS),ED=/\+/g,WS=Array(4),_D=function(r){return WS[r-1]||(WS[r-1]=RegExp("((?:%[\\da-f]{2}){"+r+"})","gi"))},vD=function(r){try{return decodeURIComponent(r)}catch{return r}},KS=function(r){var t=r.replace(ED," "),n=4;try{return decodeURIComponent(t)}catch{for(;n;)t=t.replace(_D(n--),vD);return t}},ID=/[!'()~]|%20/g,CD={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},SD=function(r){return CD[r]},HS=function(r){return encodeURIComponent(r).replace(ID,SD)},YS=function(r,t){if(t)for(var n,s,c=t.split("&"),d=0;d<c.length;)(n=c[d++]).length&&(s=n.split("="),r.push({key:KS(s.shift()),value:KS(s.join("="))}))},yD=function(r){this.entries.length=0,YS(this.entries,r)},yl=function(r,t){if(r<t)throw TypeError("Not enough arguments")},_g=z_(function(r,t){jS(this,{type:GS,iterator:QS(us(r).entries),kind:t})},"Iterator",function(){var r=mD(this),t=r.kind,n=r.iterator.next(),s=n.value;return n.done||(n.value=t==="keys"?s.key:t==="values"?s.value:[s.key,s.value]),n}),Hd=function(){zc(this,Hd,Kd);var r,t,n,s,c,d,h,p,A,m=arguments.length>0?arguments[0]:void 0,E=this,v=[];if(jS(E,{type:Kd,entries:v,updateURL:function(){},updateSearchParams:yD}),m!==void 0)if(z(m))if(typeof(r=md(m))=="function")for(n=(t=r.call(m)).next;!(s=n.call(t)).done;){if((h=(d=(c=QS(Nr(s.value))).next).call(c)).done||(p=d.call(c)).done||!d.call(c).done)throw TypeError("Expected sequence with length 2");v.push({key:h.value+"",value:p.value+""})}else for(A in m)yt(m,A)&&v.push({key:A,value:m[A]+""});else YS(v,typeof m=="string"?m.charAt(0)==="?"?m.slice(1):m:m+"")},lp=Hd.prototype;dc(lp,{append:function(r,t){yl(arguments.length,2);var n=us(this);n.entries.push({key:r+"",value:t+""}),n.updateURL()},delete:function(r){yl(arguments.length,1);for(var t=us(this),n=t.entries,s=r+"",c=0;c<n.length;)n[c].key===s?n.splice(c,1):c++;t.updateURL()},get:function(r){yl(arguments.length,1);for(var t=us(this).entries,n=r+"",s=0;s<t.length;s++)if(t[s].key===n)return t[s].value;return null},getAll:function(r){yl(arguments.length,1);for(var t=us(this).entries,n=r+"",s=[],c=0;c<t.length;c++)t[c].key===n&&s.push(t[c].value);return s},has:function(r){yl(arguments.length,1);for(var t=us(this).entries,n=r+"",s=0;s<t.length;)if(t[s++].key===n)return!0;return!1},set:function(r,t){yl(arguments.length,1);for(var n,s=us(this),c=s.entries,d=!1,h=r+"",p=t+"",A=0;A<c.length;A++)(n=c[A]).key===h&&(d?c.splice(A--,1):(d=!0,n.value=p));d||c.push({key:h,value:p}),s.updateURL()},sort:function(){var r,t,n,s=us(this),c=s.entries,d=c.slice();for(c.length=0,n=0;n<d.length;n++){for(r=d[n],t=0;t<n;t++)if(c[t].key>r.key){c.splice(t,0,r);break}t===n&&c.push(r)}s.updateURL()},forEach:function(r){for(var t,n=us(this).entries,s=mi(r,arguments.length>1?arguments[1]:void 0,3),c=0;c<n.length;)s((t=n[c++]).value,t.key,this)},keys:function(){return new _g(this,"keys")},values:function(){return new _g(this,"values")},entries:function(){return new _g(this,"entries")}},{enumerable:!0}),ea(lp,gD,lp.entries),ea(lp,"toString",function(){for(var r,t=us(this).entries,n=[],s=0;s<t.length;)r=t[s++],n.push(HS(r.key)+"="+HS(r.value));return n.join("&")},{enumerable:!0}),ta(Hd,Kd),qt({global:!0,forced:!Ag},{URLSearchParams:Hd}),Ag||typeof VS!="function"||typeof Eg!="function"||qt({global:!0,enumerable:!0,forced:!0},{fetch:function(r){var t,n,s,c=[r];return arguments.length>1&&(z(t=arguments[1])&&(n=t.body,cc(n)===Kd&&((s=t.headers?new Eg(t.headers):new Eg).has("content-type")||s.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),t=Rs(t,{body:N(0,String(n)),headers:N(0,s)}))),c.push(t)),VS.apply(this,c)}});var Fo,qS={URLSearchParams:Hd,getState:us},TD=iv.codeAt,Yd=u.URL,RD=qS.URLSearchParams,vg=qS.getState,wD=fn.set,mn=fn.getterFor("URL"),bD=Math.floor,JS=Math.pow,Ig="Invalid scheme",Ic="Invalid host",zS="Invalid port",XS=/[A-Za-z]/,ND=/[\d+\-.A-Za-z]/,Cg=/\d/,OD=/^(0x|0X)/,kD=/^[0-7]+$/,DD=/^\d+$/,ZS=/^[\dA-Fa-f]+$/,LD=/[\u0000\u0009\u000A\u000D #%/:?@[\\]]/,MD=/[\u0000\u0009\u000A\u000D #/:?@[\\]]/,PD=/^[\u0000-\u001F ]+|[\u0000-\u001F ]+$/g,BD=/[\u0009\u000A\u000D]/g,Sg=function(r,t){var n,s,c;if(t.charAt(0)=="["){if(t.charAt(t.length-1)!="]"||!(n=xD(t.slice(1,-1))))return Ic;r.host=n}else if($n(r)){if(t=function(d){var h,p,A=[],m=d.toLowerCase().replace(pD,".").split(".");for(h=0;h<m.length;h++)p=m[h],A.push(hD.test(p)?"xn--"+AD(p):p);return A.join(".")}(t),LD.test(t)||(n=UD(t))===null)return Ic;r.host=n}else{if(MD.test(t))return Ic;for(n="",s=mc(t),c=0;c<s.length;c++)n+=Ga(s[c],dp);r.host=n}},UD=function(r){var t,n,s,c,d,h,p,A=r.split(".");if(A.length&&A[A.length-1]==""&&A.pop(),(t=A.length)>4)return r;for(n=[],s=0;s<t;s++){if((c=A[s])=="")return r;if(d=10,c.length>1&&c.charAt(0)=="0"&&(d=OD.test(c)?16:8,c=c.slice(d==8?1:2)),c==="")h=0;else{if(!(d==10?DD:d==8?kD:ZS).test(c))return r;h=parseInt(c,d)}n.push(h)}for(s=0;s<t;s++)if(h=n[s],s==t-1){if(h>=JS(256,5-t))return null}else if(h>255)return null;for(p=n.pop(),s=0;s<n.length;s++)p+=n[s]*JS(256,3-s);return p},xD=function(r){var t,n,s,c,d,h,p,A=[0,0,0,0,0,0,0,0],m=0,E=null,v=0,C=function(){return r.charAt(v)};if(C()==":"){if(r.charAt(1)!=":")return;v+=2,E=++m}for(;C();){if(m==8)return;if(C()!=":"){for(t=n=0;n<4&&ZS.test(C());)t=16*t+parseInt(C(),16),v++,n++;if(C()=="."){if(n==0||(v-=n,m>6))return;for(s=0;C();){if(c=null,s>0){if(!(C()=="."&&s<4))return;v++}if(!Cg.test(C()))return;for(;Cg.test(C());){if(d=parseInt(C(),10),c===null)c=d;else{if(c==0)return;c=10*c+d}if(c>255)return;v++}A[m]=256*A[m]+c,++s!=2&&s!=4||m++}if(s!=4)return;break}if(C()==":"){if(v++,!C())return}else if(C())return;A[m++]=t}else{if(E!==null)return;v++,E=++m}}if(E!==null)for(h=m-E,m=7;m!=0&&h>0;)p=A[m],A[m--]=A[E+h-1],A[E+--h]=p;else if(m!=8)return;return A},qd=function(r){var t,n,s,c;if(typeof r=="number"){for(t=[],n=0;n<4;n++)t.unshift(r%256),r=bD(r/256);return t.join(".")}if(typeof r=="object"){for(t="",s=function(d){for(var h=null,p=1,A=null,m=0,E=0;E<8;E++)d[E]!==0?(m>p&&(h=A,p=m),A=null,m=0):(A===null&&(A=E),++m);return m>p&&(h=A,p=m),h}(r),n=0;n<8;n++)c&&r[n]===0||(c&&(c=!1),s===n?(t+=n?":":"::",c=!0):(t+=r[n].toString(16),n<7&&(t+=":")));return"["+t+"]"}return r},dp={},$S=vd({},dp,{" ":1,'"':1,"<":1,">":1,"`":1}),ty=vd({},$S,{"#":1,"?":1,"{":1,"}":1}),yg=vd({},ty,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Ga=function(r,t){var n=TD(r,0);return n>32&&n<127&&!yt(t,r)?r:encodeURIComponent(r)},up={ftp:21,file:null,http:80,https:443,ws:80,wss:443},$n=function(r){return yt(up,r.scheme)},Tg=function(r){return r.username!=""||r.password!=""},Rg=function(r){return!r.host||r.cannotBeABaseURL||r.scheme=="file"},Jd=function(r,t){var n;return r.length==2&&XS.test(r.charAt(0))&&((n=r.charAt(1))==":"||!t&&n=="|")},ey=function(r){var t;return r.length>1&&Jd(r.slice(0,2))&&(r.length==2||(t=r.charAt(2))==="/"||t==="\\"||t==="?"||t==="#")},ry=function(r){var t=r.path,n=t.length;!n||r.scheme=="file"&&n==1&&Jd(t[0],!0)||t.pop()},FD=function(r){return r==="."||r.toLowerCase()==="%2e"},wg={},ny={},bg={},iy={},oy={},Ng={},sy={},ay={},hp={},pp={},Og={},kg={},Dg={},Lg={},cy={},Mg={},Tl={},Ds={},ly={},Cc={},fa={},Ls=function(r,t,n,s){var c,d,h,p,A,m=n||wg,E=0,v="",C=!1,b=!1,y=!1;for(n||(r.scheme="",r.username="",r.password="",r.host=null,r.port=null,r.path=[],r.query=null,r.fragment=null,r.cannotBeABaseURL=!1,t=t.replace(PD,"")),t=t.replace(BD,""),c=mc(t);E<=c.length;){switch(d=c[E],m){case wg:if(!d||!XS.test(d)){if(n)return Ig;m=bg;continue}v+=d.toLowerCase(),m=ny;break;case ny:if(d&&(ND.test(d)||d=="+"||d=="-"||d=="."))v+=d.toLowerCase();else{if(d!=":"){if(n)return Ig;v="",m=bg,E=0;continue}if(n&&($n(r)!=yt(up,v)||v=="file"&&(Tg(r)||r.port!==null)||r.scheme=="file"&&!r.host))return;if(r.scheme=v,n)return void($n(r)&&up[r.scheme]==r.port&&(r.port=null));v="",r.scheme=="file"?m=Lg:$n(r)&&s&&s.scheme==r.scheme?m=iy:$n(r)?m=ay:c[E+1]=="/"?(m=oy,E++):(r.cannotBeABaseURL=!0,r.path.push(""),m=ly)}break;case bg:if(!s||s.cannotBeABaseURL&&d!="#")return Ig;if(s.cannotBeABaseURL&&d=="#"){r.scheme=s.scheme,r.path=s.path.slice(),r.query=s.query,r.fragment="",r.cannotBeABaseURL=!0,m=fa;break}m=s.scheme=="file"?Lg:Ng;continue;case iy:if(d!="/"||c[E+1]!="/"){m=Ng;continue}m=hp,E++;break;case oy:if(d=="/"){m=pp;break}m=Ds;continue;case Ng:if(r.scheme=s.scheme,d==Fo)r.username=s.username,r.password=s.password,r.host=s.host,r.port=s.port,r.path=s.path.slice(),r.query=s.query;else if(d=="/"||d=="\\"&&$n(r))m=sy;else if(d=="?")r.username=s.username,r.password=s.password,r.host=s.host,r.port=s.port,r.path=s.path.slice(),r.query="",m=Cc;else{if(d!="#"){r.username=s.username,r.password=s.password,r.host=s.host,r.port=s.port,r.path=s.path.slice(),r.path.pop(),m=Ds;continue}r.username=s.username,r.password=s.password,r.host=s.host,r.port=s.port,r.path=s.path.slice(),r.query=s.query,r.fragment="",m=fa}break;case sy:if(!$n(r)||d!="/"&&d!="\\"){if(d!="/"){r.username=s.username,r.password=s.password,r.host=s.host,r.port=s.port,m=Ds;continue}m=pp}else m=hp;break;case ay:if(m=hp,d!="/"||v.charAt(E+1)!="/")continue;E++;break;case hp:if(d!="/"&&d!="\\"){m=pp;continue}break;case pp:if(d=="@"){C&&(v="%40"+v),C=!0,h=mc(v);for(var w=0;w<h.length;w++){var k=h[w];if(k!=":"||y){var P=Ga(k,yg);y?r.password+=P:r.username+=P}else y=!0}v=""}else if(d==Fo||d=="/"||d=="?"||d=="#"||d=="\\"&&$n(r)){if(C&&v=="")return"Invalid authority";E-=mc(v).length+1,v="",m=Og}else v+=d;break;case Og:case kg:if(n&&r.scheme=="file"){m=Mg;continue}if(d!=":"||b){if(d==Fo||d=="/"||d=="?"||d=="#"||d=="\\"&&$n(r)){if($n(r)&&v=="")return Ic;if(n&&v==""&&(Tg(r)||r.port!==null))return;if(p=Sg(r,v))return p;if(v="",m=Tl,n)return;continue}d=="["?b=!0:d=="]"&&(b=!1),v+=d}else{if(v=="")return Ic;if(p=Sg(r,v))return p;if(v="",m=Dg,n==kg)return}break;case Dg:if(!Cg.test(d)){if(d==Fo||d=="/"||d=="?"||d=="#"||d=="\\"&&$n(r)||n){if(v!=""){var V=parseInt(v,10);if(V>65535)return zS;r.port=$n(r)&&V===up[r.scheme]?null:V,v=""}if(n)return;m=Tl;continue}return zS}v+=d;break;case Lg:if(r.scheme="file",d=="/"||d=="\\")m=cy;else{if(!s||s.scheme!="file"){m=Ds;continue}if(d==Fo)r.host=s.host,r.path=s.path.slice(),r.query=s.query;else if(d=="?")r.host=s.host,r.path=s.path.slice(),r.query="",m=Cc;else{if(d!="#"){ey(c.slice(E).join(""))||(r.host=s.host,r.path=s.path.slice(),ry(r)),m=Ds;continue}r.host=s.host,r.path=s.path.slice(),r.query=s.query,r.fragment="",m=fa}}break;case cy:if(d=="/"||d=="\\"){m=Mg;break}s&&s.scheme=="file"&&!ey(c.slice(E).join(""))&&(Jd(s.path[0],!0)?r.path.push(s.path[0]):r.host=s.host),m=Ds;continue;case Mg:if(d==Fo||d=="/"||d=="\\"||d=="?"||d=="#"){if(!n&&Jd(v))m=Ds;else if(v==""){if(r.host="",n)return;m=Tl}else{if(p=Sg(r,v))return p;if(r.host=="localhost"&&(r.host=""),n)return;v="",m=Tl}continue}v+=d;break;case Tl:if($n(r)){if(m=Ds,d!="/"&&d!="\\")continue}else if(n||d!="?")if(n||d!="#"){if(d!=Fo&&(m=Ds,d!="/"))continue}else r.fragment="",m=fa;else r.query="",m=Cc;break;case Ds:if(d==Fo||d=="/"||d=="\\"&&$n(r)||!n&&(d=="?"||d=="#")){if((A=(A=v).toLowerCase())===".."||A==="%2e."||A===".%2e"||A==="%2e%2e"?(ry(r),d=="/"||d=="\\"&&$n(r)||r.path.push("")):FD(v)?d=="/"||d=="\\"&&$n(r)||r.path.push(""):(r.scheme=="file"&&!r.path.length&&Jd(v)&&(r.host&&(r.host=""),v=v.charAt(0)+":"),r.path.push(v)),v="",r.scheme=="file"&&(d==Fo||d=="?"||d=="#"))for(;r.path.length>1&&r.path[0]==="";)r.path.shift();d=="?"?(r.query="",m=Cc):d=="#"&&(r.fragment="",m=fa)}else v+=Ga(d,ty);break;case ly:d=="?"?(r.query="",m=Cc):d=="#"?(r.fragment="",m=fa):d!=Fo&&(r.path[0]+=Ga(d,dp));break;case Cc:n||d!="#"?d!=Fo&&(d=="'"&&$n(r)?r.query+="%27":r.query+=d=="#"?"%23":Ga(d,dp)):(r.fragment="",m=fa);break;case fa:d!=Fo&&(r.fragment+=Ga(d,$S))}E++}},Sc=function(r){var t,n,s=zc(this,Sc,"URL"),c=arguments.length>1?arguments[1]:void 0,d=String(r),h=wD(s,{type:"URL"});if(c!==void 0){if(c instanceof Sc)t=mn(c);else if(n=Ls(t={},String(c)))throw TypeError(n)}if(n=Ls(h,d,null,t))throw TypeError(n);var p=h.searchParams=new RD,A=vg(p);A.updateSearchParams(h.query),A.updateURL=function(){h.query=String(p)||null},g||(s.href=fp.call(s),s.origin=dy.call(s),s.protocol=uy.call(s),s.username=hy.call(s),s.password=py.call(s),s.host=fy.call(s),s.hostname=Ay.call(s),s.port=gy.call(s),s.pathname=my.call(s),s.search=Ey.call(s),s.searchParams=_y.call(s),s.hash=vy.call(s))},Pg=Sc.prototype,fp=function(){var r=mn(this),t=r.scheme,n=r.username,s=r.password,c=r.host,d=r.port,h=r.path,p=r.query,A=r.fragment,m=t+":";return c!==null?(m+="//",Tg(r)&&(m+=n+(s?":"+s:"")+"@"),m+=qd(c),d!==null&&(m+=":"+d)):t=="file"&&(m+="//"),m+=r.cannotBeABaseURL?h[0]:h.length?"/"+h.join("/"):"",p!==null&&(m+="?"+p),A!==null&&(m+="#"+A),m},dy=function(){var r=mn(this),t=r.scheme,n=r.port;if(t=="blob")try{return new URL(t.path[0]).origin}catch{return"null"}return t!="file"&&$n(r)?t+"://"+qd(r.host)+(n!==null?":"+n:""):"null"},uy=function(){return mn(this).scheme+":"},hy=function(){return mn(this).username},py=function(){return mn(this).password},fy=function(){var r=mn(this),t=r.host,n=r.port;return t===null?"":n===null?qd(t):qd(t)+":"+n},Ay=function(){var r=mn(this).host;return r===null?"":qd(r)},gy=function(){var r=mn(this).port;return r===null?"":String(r)},my=function(){var r=mn(this),t=r.path;return r.cannotBeABaseURL?t[0]:t.length?"/"+t.join("/"):""},Ey=function(){var r=mn(this).query;return r?"?"+r:""},_y=function(){return mn(this).searchParams},vy=function(){var r=mn(this).fragment;return r?"#"+r:""},Qo=function(r,t){return{get:r,set:t,configurable:!0,enumerable:!0}};if(g&&qs(Pg,{href:Qo(fp,function(r){var t=mn(this),n=String(r),s=Ls(t,n);if(s)throw TypeError(s);vg(t.searchParams).updateSearchParams(t.query)}),origin:Qo(dy),protocol:Qo(uy,function(r){var t=mn(this);Ls(t,String(r)+":",wg)}),username:Qo(hy,function(r){var t=mn(this),n=mc(String(r));if(!Rg(t)){t.username="";for(var s=0;s<n.length;s++)t.username+=Ga(n[s],yg)}}),password:Qo(py,function(r){var t=mn(this),n=mc(String(r));if(!Rg(t)){t.password="";for(var s=0;s<n.length;s++)t.password+=Ga(n[s],yg)}}),host:Qo(fy,function(r){var t=mn(this);t.cannotBeABaseURL||Ls(t,String(r),Og)}),hostname:Qo(Ay,function(r){var t=mn(this);t.cannotBeABaseURL||Ls(t,String(r),kg)}),port:Qo(gy,function(r){var t=mn(this);Rg(t)||((r=String(r))==""?t.port=null:Ls(t,r,Dg))}),pathname:Qo(my,function(r){var t=mn(this);t.cannotBeABaseURL||(t.path=[],Ls(t,r+"",Tl))}),search:Qo(Ey,function(r){var t=mn(this);(r=String(r))==""?t.query=null:(r.charAt(0)=="?"&&(r=r.slice(1)),t.query="",Ls(t,r,Cc)),vg(t.searchParams).updateSearchParams(t.query)}),searchParams:Qo(_y),hash:Qo(vy,function(r){var t=mn(this);(r=String(r))!=""?(r.charAt(0)=="#"&&(r=r.slice(1)),t.fragment="",Ls(t,r,fa)):t.fragment=null})}),ea(Pg,"toJSON",function(){return fp.call(this)},{enumerable:!0}),ea(Pg,"toString",function(){return fp.call(this)},{enumerable:!0}),Yd){var Iy=Yd.createObjectURL,Cy=Yd.revokeObjectURL;Iy&&ea(Sc,"createObjectURL",function(r){return Iy.apply(Yd,arguments)}),Cy&&ea(Sc,"revokeObjectURL",function(r){return Cy.apply(Yd,arguments)})}ta(Sc,"URL"),qt({global:!0,forced:!Ag,sham:!g},{URL:Sc});var Sy=_e.URL;function yy(r,t){var n=le(r);if(ee){var s=ee(r);t&&(s=kt(s).call(s,function(c){return Wt(r,c).enumerable})),n.push.apply(n,s)}return n}(function(){var r;function t(Y){var tt=0;return function(){return tt<Y.length?{done:!1,value:Y[tt++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(Y,tt,vt){return Y==Array.prototype||Y==Object.prototype||(Y[tt]=vt.value),Y},s,c=function(Y){Y=[typeof globalThis=="object"&&globalThis,Y,typeof window=="object"&&window,typeof self=="object"&&self,typeof i=="object"&&i];for(var tt=0;tt<Y.length;++tt){var vt=Y[tt];if(vt&&vt.Math==Math)return vt}throw Error("Cannot find global object")}(this);function d(Y,tt){if(tt)t:{var vt=c;Y=Y.split(".");for(var at=0;at<Y.length-1;at++){var Lt=Y[at];if(!(Lt in vt))break t;vt=vt[Lt]}(tt=tt(at=vt[Y=Y[Y.length-1]]))!=at&&tt!=null&&n(vt,Y,{configurable:!0,writable:!0,value:tt})}}function h(Y){return(Y={next:Y})[Symbol.iterator]=function(){return this},Y}function p(Y){var tt=typeof Symbol!="undefined"&&Symbol.iterator&&Y[Symbol.iterator];return tt?tt.call(Y):{next:t(Y)}}if(d("Symbol",function(Y){function tt(Lt,lt){this.A=Lt,n(this,"description",{configurable:!0,writable:!0,value:lt})}if(Y)return Y;tt.prototype.toString=function(){return this.A};var vt="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",at=0;return function Lt(lt){if(this instanceof Lt)throw new TypeError("Symbol is not a constructor");return new tt(vt+(lt||"")+"_"+at++,lt)}}),d("Symbol.iterator",function(Y){if(Y)return Y;Y=Symbol("Symbol.iterator");for(var tt="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),vt=0;vt<tt.length;vt++){var at=c[tt[vt]];typeof at=="function"&&typeof at.prototype[Y]!="function"&&n(at.prototype,Y,{configurable:!0,writable:!0,value:function(){return h(t(this))}})}return Y}),typeof Object.setPrototypeOf=="function")s=Object.setPrototypeOf;else{var A;t:{var m={};try{m.__proto__={a:!0},A=m.a;break t}catch{}A=!1}s=A?function(Y,tt){if(Y.__proto__=tt,Y.__proto__!==tt)throw new TypeError(Y+" is not extensible");return Y}:null}var E=s;function v(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function C(Y){if(Y.m)throw new TypeError("Generator is already running");Y.m=!0}function b(Y,tt){return Y.h=3,{value:tt}}function y(Y){this.g=new v,this.G=Y}function w(Y,tt,vt,at){try{var Lt=tt.call(Y.g.j,vt);if(!(Lt instanceof Object))throw new TypeError("Iterator result "+Lt+" is not an object");if(!Lt.done)return Y.g.m=!1,Lt;var lt=Lt.value}catch(R){return Y.g.j=null,Y.g.s(R),k(Y)}return Y.g.j=null,at.call(Y.g,lt),k(Y)}function k(Y){for(;Y.g.h;)try{var tt=Y.G(Y.g);if(tt)return Y.g.m=!1,{value:tt.value,done:!1}}catch(vt){Y.g.v=void 0,Y.g.s(vt)}if(Y.g.m=!1,Y.g.l){if(tt=Y.g.l,Y.g.l=null,tt.F)throw tt.D;return{value:tt.return,done:!0}}return{value:void 0,done:!0}}function P(Y){this.next=function(tt){return Y.o(tt)},this.throw=function(tt){return Y.s(tt)},this.return=function(tt){return function(vt,at){C(vt.g);var Lt=vt.g.j;return Lt?w(vt,"return"in Lt?Lt.return:function(lt){return{value:lt,done:!0}},at,vt.g.return):(vt.g.return(at),k(vt))}(Y,tt)},this[Symbol.iterator]=function(){return this}}function V(Y,tt){return tt=new P(new y(tt)),E&&Y.prototype&&E(tt,Y.prototype),tt}if(v.prototype.o=function(Y){this.v=Y},v.prototype.s=function(Y){this.l={D:Y,F:!0},this.h=this.C||this.u},v.prototype.return=function(Y){this.l={return:Y},this.h=this.u},y.prototype.o=function(Y){return C(this.g),this.g.j?w(this,this.g.j.next,Y,this.g.o):(this.g.o(Y),k(this))},y.prototype.s=function(Y){return C(this.g),this.g.j?w(this,this.g.j.throw,Y,this.g.o):(this.g.s(Y),k(this))},d("Array.prototype.entries",function(Y){return Y||function(){return function(tt,vt){tt instanceof String&&(tt+="");var at=0,Lt=!1,lt={next:function(){if(!Lt&&at<tt.length){var R=at++;return{value:vt(R,tt[R]),done:!1}}return Lt=!0,{done:!0,value:void 0}}};return lt[Symbol.iterator]=function(){return lt},lt}(this,function(tt,vt){return[tt,vt]})}}),typeof Blob!="undefined"&&(typeof FormData=="undefined"||!FormData.prototype.keys)){var j=function(Y,tt){for(var vt=0;vt<Y.length;vt++)tt(Y[vt])},st=function(Y){return Y.replace(/\r?\n|\r/g,`\r
`)},mt=function(Y,tt,vt){return tt instanceof Blob?(vt=vt!==void 0?String(vt+""):typeof tt.name=="string"?tt.name:"blob",tt.name===vt&&Object.prototype.toString.call(tt)!=="[object Blob]"||(tt=new File([tt],vt)),[String(Y),tt]):[String(Y),String(tt)]},Et=function(Y,tt){if(Y.length<tt)throw new TypeError(tt+" argument required, but only "+Y.length+" present.")},At=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,$=At.FormData,rt=At.XMLHttpRequest&&At.XMLHttpRequest.prototype.send,W=At.Request&&At.fetch,H=At.navigator&&At.navigator.sendBeacon,U=At.Element&&At.Element.prototype,Tt=At.Symbol&&Symbol.toStringTag;Tt&&(Blob.prototype[Tt]||(Blob.prototype[Tt]="Blob"),"File"in At&&!File.prototype[Tt]&&(File.prototype[Tt]="File"));try{new File([],"")}catch{At.File=function(tt,vt,at){return tt=new Blob(tt,at||{}),Object.defineProperties(tt,{name:{value:vt},lastModified:{value:+(at&&at.lastModified!==void 0?new Date(at.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),Tt&&Object.defineProperty(tt,Tt,{value:"File"}),tt}}var It=function(Y){return Y.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Ct=function(Y){this.i=[];var tt=this;Y&&j(Y.elements,function(vt){if(vt.name&&!vt.disabled&&vt.type!=="submit"&&vt.type!=="button"&&!vt.matches("form fieldset[disabled] *"))if(vt.type==="file"){var at=vt.files&&vt.files.length?vt.files:[new File([],"",{type:"application/octet-stream"})];j(at,function(Lt){tt.append(vt.name,Lt)})}else vt.type==="select-multiple"||vt.type==="select-one"?j(vt.options,function(Lt){!Lt.disabled&&Lt.selected&&tt.append(vt.name,Lt.value)}):vt.type==="checkbox"||vt.type==="radio"?vt.checked&&tt.append(vt.name,vt.value):(at=vt.type==="textarea"?st(vt.value):vt.value,tt.append(vt.name,at))})};if((r=Ct.prototype).append=function(Y,tt,vt){Et(arguments,2),this.i.push(mt(Y,tt,vt))},r.delete=function(Y){Et(arguments,1);var tt=[];Y=String(Y),j(this.i,function(vt){vt[0]!==Y&&tt.push(vt)}),this.i=tt},r.entries=function Y(){var tt,vt=this;return V(Y,function(at){if(at.h==1&&(tt=0),at.h!=3)return tt<vt.i.length?at=b(at,vt.i[tt]):(at.h=0,at=void 0),at;tt++,at.h=2})},r.forEach=function(Y,tt){Et(arguments,1);for(var vt=p(this),at=vt.next();!at.done;at=vt.next()){var Lt=p(at.value);at=Lt.next().value,Lt=Lt.next().value,Y.call(tt,Lt,at,this)}},r.get=function(Y){Et(arguments,1);var tt=this.i;Y=String(Y);for(var vt=0;vt<tt.length;vt++)if(tt[vt][0]===Y)return tt[vt][1];return null},r.getAll=function(Y){Et(arguments,1);var tt=[];return Y=String(Y),j(this.i,function(vt){vt[0]===Y&&tt.push(vt[1])}),tt},r.has=function(Y){Et(arguments,1),Y=String(Y);for(var tt=0;tt<this.i.length;tt++)if(this.i[tt][0]===Y)return!0;return!1},r.keys=function Y(){var tt,vt,at,Lt,lt=this;return V(Y,function(R){if(R.h==1&&(tt=p(lt),vt=tt.next()),R.h!=3)return vt.done?void(R.h=0):(at=vt.value,Lt=p(at),b(R,Lt.next().value));vt=tt.next(),R.h=2})},r.set=function(Y,tt,vt){Et(arguments,2),Y=String(Y);var at=[],Lt=mt(Y,tt,vt),lt=!0;j(this.i,function(R){R[0]===Y?lt&&(lt=!at.push(Lt)):at.push(R)}),lt&&at.push(Lt),this.i=at},r.values=function Y(){var tt,vt,at,Lt,lt=this;return V(Y,function(R){if(R.h==1&&(tt=p(lt),vt=tt.next()),R.h!=3)return vt.done?void(R.h=0):(at=vt.value,(Lt=p(at)).next(),b(R,Lt.next().value));vt=tt.next(),R.h=2})},Ct.prototype._asNative=function(){for(var Y=new $,tt=p(this),vt=tt.next();!vt.done;vt=tt.next()){var at=p(vt.value);vt=at.next().value,at=at.next().value,Y.append(vt,at)}return Y},Ct.prototype._blob=function(){var Y="----formdata-polyfill-"+Math.random(),tt=[],vt="--"+Y+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(at,Lt){return typeof at=="string"?tt.push(vt+It(st(Lt))+`"\r
\r
`+st(at)+`\r
`):tt.push(vt+It(st(Lt))+'"; filename="'+It(at.name)+`"\r
Content-Type: `+(at.type||"application/octet-stream")+`\r
\r
`,at,`\r
`)}),tt.push("--"+Y+"--"),new Blob(tt,{type:"multipart/form-data; boundary="+Y})},Ct.prototype[Symbol.iterator]=function(){return this.entries()},Ct.prototype.toString=function(){return"[object FormData]"},U&&!U.matches&&(U.matches=U.matchesSelector||U.mozMatchesSelector||U.msMatchesSelector||U.oMatchesSelector||U.webkitMatchesSelector||function(Y){for(var tt=(Y=(this.document||this.ownerDocument).querySelectorAll(Y)).length;0<=--tt&&Y.item(tt)!==this;);return-1<tt}),Tt&&(Ct.prototype[Tt]="FormData"),rt){var Ut=At.XMLHttpRequest.prototype.setRequestHeader;At.XMLHttpRequest.prototype.setRequestHeader=function(Y,tt){Ut.call(this,Y,tt),Y.toLowerCase()==="content-type"&&(this.B=!0)},At.XMLHttpRequest.prototype.send=function(Y){Y instanceof Ct?(Y=Y._blob(),this.B||this.setRequestHeader("Content-Type",Y.type),rt.call(this,Y)):rt.call(this,Y)}}W&&(At.fetch=function(Y,tt){return tt&&tt.body&&tt.body instanceof Ct&&(tt.body=tt.body._blob()),W.call(this,Y,tt)}),H&&(At.navigator.sendBeacon=function(Y,tt){return tt instanceof Ct&&(tt=tt._asNative()),H.call(this,Y,tt)}),At.FormData=Ct}})();let Bg=1;function QD(r,t,n,s,c){Bg+=1;const d={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(pt()/1e3),seq:Bg,requestId:Bg,version:Pn,cname:n.cname},h={service_name:t,json_body:ht(d)};let p,A,m=r[0];return Zn(async()=>{p=pt();const E=await Bn(m,{data:h,cancelToken:s,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(A=pt()-p,E.code!==0){const y=new M(L.UNEXPECTED_RESPONSE,"live streaming ap error, code"+E.code,{retry:!0,responseTime:A});throw S.error(y.toString()),y}const v=JSON.parse(E.json_body);if(v.code!==200){var C;const y=new M(L.UNEXPECTED_RESPONSE,O(C="live streaming app center error, code: ".concat(v.code,", reason: ")).call(C,v.reason),{code:v.code,responseTime:A});throw S.error(y.toString()),y}if(!v.servers||v.servers.length===0){const y=new M(L.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:v.code,responseTime:A});throw S.error(y.toString()),y}const b=function(y,w){var k;return{addressList:ft(k=y.servers).call(k,P=>{var V,j,st;return O(V=O(j=O(st="wss://".concat(P.address.replace(/\./g,"-"),".")).call(st,ot("WORKER_DOMAIN"),":")).call(j,P.wss,"?serviceName=")).call(V,encodeURIComponent(w))}),workerToken:y.workerToken,vid:y.vid}}(v,t);return ot("LIVE_STREAMING_ADDRESS")&&(b.addressList=ot("LIVE_STREAMING_ADDRESS")instanceof Array?ot("LIVE_STREAMING_ADDRESS"):[ot("LIVE_STREAMING_ADDRESS")]),function(y){for(var w=1;w<arguments.length;w++){var k,P=arguments[w]!=null?arguments[w]:{};if(w%2)G(k=yy(Object(P),!0)).call(k,function(j){_r(y,j,P[j])});else if(te)He(y,te(P));else{var V;G(V=yy(Object(P))).call(V,function(j){se(y,j,Wt(P,j))})}}return y}({},b,{responseTime:A})},(E,v)=>(gt.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:ht(E.addressList),firstSuccess:v===0,responseTime:A,serverIp:r[v%r.length]}),!1),(E,v)=>(gt.apworkerEvent(n.sid,{success:!1,sc:E.data&&E.data.code||200,serviceName:t,responseTime:A,serverIp:r[v%r.length]}),!!(E.code!==L.OPERATION_ABORTED&&E.code!==L.UNEXPECTED_RESPONSE||E.data&&E.data.retry)&&(m=r[(v+1)%r.length],!0)),c)}let Ug=1;function Ty({url:r,areaCode:t},n,s,c){const d=pt(),[h,p]=Ny(n,t,[ai.CHOOSE_SERVER]);let A=yr.networkState;return Zn(async()=>{A&&yr.networkState===mo.OFFLINE&&yr.onlineWaiter&&await dt.race([yr.onlineWaiter,Ur(c&&c.maxRetryTimeout||Ne.maxRetryTimeout)]),A=yr.networkState;const m=await Bn(r,{data:h,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0);gt.reportResourceTiming(r,n.sid),wy(m,r,n,d,[ai.CHOOSE_SERVER]);const E=cg(m,ai.CHOOSE_SERVER);return by(E),mS(E,r)},m=>(m&&gt.joinChooseServer(n.sid,{lts:d,succ:!0,csAddr:r,opid:p,serverList:m.gatewayAddrs,ec:null,cid:m.cid.toString(),uid:m.uid.toString(),csIp:m.csIp,unilbsServerIds:[ai.CHOOSE_SERVER].toString()}),!1),m=>m.code!==L.OPERATION_ABORTED&&(m.code===L.CAN_NOT_GET_GATEWAY_SERVER?m.data.retry:(gt.joinChooseServer(n.sid,{lts:d,succ:!1,csAddr:r,serverList:null,opid:p,ec:m.code,csIp:m.data&&m.data.csIp,unilbsServerIds:[ai.CHOOSE_SERVER].toString(),extend:ht({networkState:A})}),S.warning("[".concat(n.clientId,"] Choose server network error, retry"),m),!0)),c)}function Ry({url:r,areaCode:t,serviceIds:n},s,c,d){const h=pt(),[p,A]=Ny(s,t,n);let m;return Zn(async()=>{m&&yr.networkState===mo.OFFLINE&&yr.onlineWaiter&&await dt.race([yr.onlineWaiter,Ur(d&&d.maxRetryTimeout||Ne.maxRetryTimeout)]),m=yr.networkState;const E=await Bn(r,{data:p,cancelToken:c,headers:{"Content-Type":"multipart/form-data;"}},!0);gt.reportResourceTiming(r,s.sid),wy(E,r,s,h,n);const v=cg(E,ai.CHOOSE_SERVER),C=cg(E,s.cloudProxyServer==="proxy5"?ai.CLOUD_PROXY_5:ai.CLOUD_PROXY);return by(v),{gatewayInfo:mS(v,r),proxyInfo:C,url:r}},E=>{var v;return E.gatewayInfo&&gt.joinChooseServer(s.sid,{lts:h,succ:!0,csAddr:r,serverList:E.gatewayInfo.gatewayAddrs,ec:null,opid:A,cid:E.gatewayInfo.cid.toString(),uid:E.gatewayInfo.uid.toString(),csIp:E.gatewayInfo.csIp,unilbsServerIds:n.toString()}),E.proxyInfo&&gt.joinWebProxyAP(s.sid,{lts:h,sucess:1,apServerAddr:r,turnServerAddrList:ft(v=E.proxyInfo.addresses).call(v,C=>C.ip).join(","),errorCode:null,eventType:s.cloudProxyServer,unilbsServerIds:n.toString()}),!1},E=>E.code!==L.OPERATION_ABORTED&&(E.code===L.CAN_NOT_GET_GATEWAY_SERVER?E.data.retry:(gt.joinWebProxyAP(s.sid,{lts:h,sucess:0,apServerAddr:r,turnServerAddrList:null,errorCode:E.code,eventType:s.cloudProxyServer,unilbsServerIds:n.toString(),extend:ht({networkState:m})}),S.warning("[".concat(s.clientId,"] multi unilbs network error, retry"),E),!0)),d)}const wy=(r,t,n,s,c)=>{var d,h,p;const A=[];if(G(d=r.response_body).call(d,m=>{const E=m.buffer.code;if(E!==0){const v=ha(E),C={error:new M(L.CAN_NOT_GET_GATEWAY_SERVER,v.desc,{retry:v.retry,csIp:r.detail[502]}),flag:m.buffer.flag};A.push(C),C.flag===4096?gt.joinChooseServer(n.sid,{lts:s,succ:!1,csAddr:t,opid:r.opid,serverList:null,ec:C.error.message,csIp:C.error.data&&C.error.data.csIp,unilbsServerIds:c.toString()}):C.flag!==1048576&&C.flag!==4194304||gt.joinWebProxyAP(n.sid,{lts:s,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:C.error.code,eventType:n.cloudProxyServer,unilbsServerIds:c.toString()})}}),A.length)throw S.warning(O(h=O(p="[".concat(n.clientId,"] multi unilbs ")).call(p,t," failed, ")).call(h,ft(A).call(A,m=>{var E,v;return O(E=O(v="flag: ".concat(m.flag,", message: ")).call(v,m.error.message,", retry: ")).call(E,m.error.data.retry)}).join(" | "))),new M(L.CAN_NOT_GET_GATEWAY_SERVER,ft(A).call(A,m=>{var E;return O(E="flag: ".concat(m.flag,", message: ")).call(E,m.error.message)}).join(" | "),{retry:!!_t(A).call(A,m=>m.error.data.retry),csIp:r.detail[502]})},by=r=>{if(r.addresses&&r.addresses.length===0&&r.code===0)throw new M(L.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:r.detail&&r.detail[502]});if(ot("GATEWAY_ADDRESS")&&ot("GATEWAY_ADDRESS").length>0){var t;S.debug("assign gateway address to",ot("GATEWAY_ADDRESS"));const n=ft(t=ot("GATEWAY_ADDRESS")).call(t,s=>({ip:s.ip,port:s.port,ticket:r.addresses[0]&&r.addresses[0].ticket}));r.addresses=n}},VD=(r,t)=>{if(r.response_body&&r.response_body.length){const s=r.response_body[0];if(s.buffer.code!==0){var n;const c=ha(s.buffer.code);throw new M(L.UPDATE_TICKET_FAILED,O(n="[".concat(s.buffer.code,"]: ")).call(n,c.desc),{retry:c.retry})}return s.buffer.ticket}throw S.debug("update ticket request received ap response without response body:",t),new M(L.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},Ny=(r,t,n)=>{var s;const c=Math.floor(Math.random()*10**12),d={appid:r.appId,client_ts:pt(),opid:c,sid:r.sid,request_bodies:[{uri:22,buffer:{cname:r.cname,detail:{6:r.stringUid,11:t,12:ot("USE_NEW_TOKEN")?"1":void 0},key:r.token,service_ids:n,uid:r.uid||0}}]};G(s=d.request_bodies).call(s,p=>{r.multiIP&&r.multiIP.gateway_ip&&(p.buffer.detail[5]=ht({vocs_ip:[r.multiIP.uni_lbs_ip],vos_ip:[r.multiIP.gateway_ip]}))});const h=new FormData;return h.append("request",ht(d)),[h,c]},GD=(r,t)=>{var n;const s=Math.floor(Math.random()*10**12),c={appid:r.appId,client_ts:pt(),opid:s,sid:r.sid,request_bodies:[{uri:28,buffer:{cname:r.cname,detail:{1:"",12:"1"},token:r.token,service_ids:t,uid:r.uid||0,edges_services:ft(n=r.apResponse.addresses).call(n,h=>({ip:h.ip,port:h.port}))}}]},d=new FormData;return d.append("request",ht(c)),[d,s]},Ms=()=>{const r=ot("AREAS");return r.length===0&&r.push("GLOBAL"),Ih(r).call(r,(t,n,s)=>{const c=jD(n);var d;return c?s===0?c:O(d="".concat(t,",")).call(d,c):t},"")},jD=r=>{var t,n,s,c,d;return r==="OVERSEA"?O(t=O(n=O(s=O(c=O(d="".concat(Rn.ASIA,",")).call(d,Rn.EUROPE,",")).call(c,Rn.AFRICA,",")).call(s,Rn.NORTH_AMERICA,",")).call(n,Rn.SOUTH_AMERICA,",")).call(t,Rn.OCEANIA):Rn[r]},Ap={GLOBAL:{ASIA:["CHINA","JAPAN","INDIA","KOREA"],EUROPE:[],NORTH_AMERICA:[],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},Rl=le(Ap.GLOBAL),gp=["CHINA","NORTH_AMERICA","EUROPE","ASIA","JAPAN","INDIA","OCEANIA","SOUTH_AMERICA","AFRICA","KOREA"],WD=function(r,t){let n=[];if(zt(r).call(r,"GLOBAL")){const c=["GLOBAL","OVERSEA"],d=le(YA);if(t==="GLOBAL")throw new M(L.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t==="CHINA")n=["OVERSEA"];else if(s=t,zt(Rl).call(Rl,s)){const h=Ap.GLOBAL[t]||[],p=[...c,t,...h];n=kt(d).call(d,A=>!zt(p).call(p,A))}else if(function(h){let p=!1;return G(Rl).call(Rl,A=>{var m;zt(m=Ap.GLOBAL[A]).call(m,h)&&(p=!0)}),p}(t)){const h=function(A){let m;return G(Rl).call(Rl,E=>{var v;zt(v=Ap.GLOBAL[E]).call(v,A)&&(m=E)}),m}(t),p=[...c,h,t];n=kt(d).call(d,A=>!zt(p).call(p,A))}else n=r;n=function(h){const p=[];return G(gp).call(gp,A=>{zt(h).call(h,A)&&p.push(A)}),O(p).call(p,kt(h).call(h,A=>!zt(gp).call(gp,A)))}(n)}else n=r;var s;return n};function Oy(r){const t=gt.reportApiInvoke(null,{name:Kt.SET_AREA,options:r,tag:Yt.TRACER});try{var n;let s=[];if(typeof r=="string"&&(s=[r]),$r(r)&&(G(r).call(r,d=>{if(!zt(DC).call(DC,d))throw new M(L.INVALID_PARAMS,"invalid area code")}),s=r),Object.prototype.toString.call(r)==="[object Object]"){const{areaCode:d,excludedArea:h}=r;if(!d)throw new M(L.INVALID_PARAMS,"area code is needed");let p=d;typeof d=="string"&&(p=[d]),s=h?WD(p,h):p}jr("AREAS",s);const c=(d=>{const h={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return ft(d).call(d,p=>{const A=YA[p],m=le(A);m&&ft(m).call(m,E=>{var v;E!=="CODE"&&(h[E]=O(v=h[E]).call(v,A[E]))})}),h})(s);ft(n=le(c)).call(n,d=>{d==="LOG_UPLOAD_SERVER"||d==="EVENT_REPORT_DOMAIN"||d==="EVENT_REPORT_BACKUP_DOMAIN"||d==="PROXY_SERVER_TYPE3"?jr(d,c[d][0]):jr(d,c[d])}),S.debug("set area success:",s.join(","))}catch(s){throw t.onError(s),s}t.onSuccess()}async function zd(r,t,n){return{gatewayInfo:await async function(c,d,h){var p,A;const m=ft(p=en(A=ot("WEBCS_DOMAIN")).call(A,0,ot("AJAX_REQUEST_CONCURRENT"))).call(p,y=>{var w;return{url:c.proxyServer?O(w="https://".concat(c.proxyServer,"/ap/?url=")).call(w,y+"/api/v2/transpond/webrtc?v=2"):"https://".concat(y,"/api/v2/transpond/webrtc?v=2"),areaCode:Ms()}});let E=null;const v=[],C=async()=>await Co({fragementLength:ot("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:y=>(S.debug("[".concat(c.clientId,"] Connect to choose_server:"),y.url),Ty(y,c,d,h)),allFailedhandler:y=>{throw y[0]},promisesCollector:v}),b=async()=>{var y;if(await Ur(1e3),E!==null)return E;const w=ft(y=ot("WEBCS_DOMAIN_BACKUP_LIST")).call(y,k=>{var P;return{url:c.proxyServer?O(P="https://".concat(c.proxyServer,"/ap/?url=")).call(P,k+"/api/v2/transpond/webrtc?v=2"):"https://".concat(k,"/api/v2/transpond/webrtc?v=2"),areaCode:Ms()}});return await Co({fragementLength:ot("FRAGEMENT_LENGTH"),referenceList:w,asyncMapHandler:k=>(S.debug("[".concat(c.clientId,"] Connect to backup choose_server:"),k.url),Ty(k,c,d,h)),allFailedhandler:k=>{throw k[0]},promisesCollector:v})};try{return E=await Os([C(),b()]),v.length&&G(v).call(v,y=>y.cancel&&typeof y.cancel=="function"&&y.cancel()),E}catch(y){throw y[0]}}(r,t,n)}}async function xg(r,t,n,s){var c,d;if(r.cloudProxyServer==="disabled")return s?await zd(r,t,n):void 0;let h;if(r.cloudProxyServer==="443only"||r.cloudProxyServer==="normal"){var p;let A;s?r.cloudProxyServer!=="normal"?[A,h]=await dt.all([mp(r,t,n),zd(r,t,n)]):(A=await mp(r,t,n),r.proxyServer=A.addresses[0],gt.setProxyServer(r.proxyServer),S.setProxyServer(r.proxyServer),h=await zd(r,t,n)):(h=void 0,r.cloudProxyServer!=="normal"?A=await mp(r,t,n):(A=await mp(r,t,n),r.proxyServer=A.addresses[0],gt.setProxyServer(r.proxyServer),S.setProxyServer(r.proxyServer))),r.turnServer={mode:"manual",servers:ft(p=A.addresses).call(p,m=>({turnServerURL:m,tcpport:r.cloudProxyServer==="proxy3"?void 0:A.serverResponse.tcpport?A.serverResponse.tcpport:qe.tcpport,udpport:r.cloudProxyServer==="proxy4"?void 0:A.serverResponse.udpport?A.serverResponse.udpport:qe.udpport,username:A.serverResponse.username||qe.username,password:A.serverResponse.password||qe.password,forceturn:r.cloudProxyServer!=="proxy4"&&r.cloudProxyServer!=="proxy5",security:r.cloudProxyServer==="proxy5"}))}}else{const{proxyInfo:A,gatewayInfo:m}=await async function(E,v,C){var b,y;const w=ot("PROXY_SERVER_TYPE3"),k=(rt,W)=>{var H;let U=w;return $r(U)&&(U=W%2==0?w[1]:w[0]),O(H="https://".concat(U,"/ap/?url=")).call(H,rt)},P=ft(b=en(y=ot("WEBCS_DOMAIN")).call(y,0,ot("AJAX_REQUEST_CONCURRENT"))).call(b,(rt,W)=>({url:k("".concat(rt,"/api/v2/transpond/webrtc?v=2"),W),areaCode:Ms(),serviceIds:[ai.CHOOSE_SERVER,E.cloudProxyServer==="proxy5"?ai.CLOUD_PROXY_5:ai.CLOUD_PROXY]}));let V=null;const j=[],st=async()=>await Co({fragementLength:ot("FRAGEMENT_LENGTH"),referenceList:P,asyncMapHandler:rt=>(S.debug("[".concat(E.clientId,"] Connect to choose_server:"),rt.url),Ry(rt,E,v,C)),allFailedhandler:rt=>{throw rt[0]},promisesCollector:j}),mt=async()=>{var rt;if(await Ur(1e3),V!==null)return V;const W=ft(rt=ot("WEBCS_DOMAIN_BACKUP_LIST")).call(rt,(H,U)=>({url:k("".concat(H,"/api/v2/transpond/webrtc?v=2"),U),areaCode:Ms(),serviceIds:[11,18]}));return await Co({fragementLength:ot("FRAGEMENT_LENGTH"),referenceList:W,asyncMapHandler:H=>(S.debug("[".concat(E.clientId,"] Connect to backup choose_server:"),H.url),Ry(H,E,v,C)),allFailedhandler:H=>{throw H[0]},promisesCollector:j})};let Et,At,$;try{({gatewayInfo:Et,proxyInfo:At,url:$}=await Os([st(),mt()]))}catch(rt){throw rt[0]}if(j.length&&G(j).call(j,rt=>rt.cancel&&typeof rt.cancel=="function"&&rt.cancel()),!Et||!At)throw new M(L.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if($r(w)&&$){const rt=new Sy($).host;zt(w).call(w,rt)&&(E.proxyServer=rt,S.setProxyServer(rt),gt.setProxyServer(rt))}return V={gatewayInfo:Et,proxyInfo:await Dk(At,Et.uid)},V}(r,t,n);h={gatewayInfo:m},r.turnServer={mode:"manual",servers:ft(A).call(A,E=>({turnServerURL:E.address,tcpport:r.cloudProxyServer==="proxy3"?void 0:E.tcpport?E.tcpport:qe.tcpport,udpport:r.cloudProxyServer==="proxy4"?void 0:E.udpport?E.udpport:qe.udpport,username:E.username||qe.username,password:E.password||qe.password,forceturn:r.cloudProxyServer!=="proxy4"&&r.cloudProxyServer!=="proxy5",security:r.cloudProxyServer==="proxy5"}))}}return S.debug(O(c=O(d="[".concat(r.clientId,"] set proxy server: ")).call(d,r.proxyServer,", mode: ")).call(c,r.cloudProxyServer)),h}async function Fg(r,t,n,s){var c;const d=en(c=ot("ACCOUNT_REGISTER")).call(c,0,ot("AJAX_REQUEST_CONCURRENT"));let h=[];return h=t.proxyServer?ft(d).call(d,p=>{var A;return O(A="https://".concat(t.proxyServer,"/ap/?url=")).call(A,p+"/api/v1")}):ft(d).call(d,p=>"https://".concat(p,"/api/v1")),(await async function(p,A,m,E,v){const C=pt(),b={sid:m.sid,opid:10,appid:m.appId,string_uid:A};let y=p[0];const w=await Zn(()=>Bn(y+"".concat(Ft(y).call(y,"?")===-1?"?":"&","action=stringuid"),{data:b,cancelToken:E,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(k,P)=>{if(k.code===0){var V;if(k.uid<=0||k.uid>=Math.pow(2,32))throw S.error(O(V="Invalid Uint Uid ".concat(A," => ")).call(V,k.uid),k),gt.reqUserAccount(b.sid,{lts:C,success:!1,serverAddr:y,stringUid:b.string_uid,uid:k.uid,errorCode:L.INVALID_UINT_UID_FROM_STRING_UID,extend:b}),new M(L.INVALID_UINT_UID_FROM_STRING_UID);return gt.reqUserAccount(b.sid,{lts:C,success:!0,serverAddr:y,stringUid:b.string_uid,uid:k.uid,errorCode:null,extend:b}),!1}const j=ha(k.code);return j.retry&&(y=p[(P+1)%p.length]),gt.reqUserAccount(b.sid,{lts:C,success:!1,serverAddr:y,stringUid:b.string_uid,uid:k.uid,errorCode:j.desc,extend:b}),j.retry},(k,P)=>k.code!==L.OPERATION_ABORTED&&(gt.reqUserAccount(b.sid,{lts:C,success:!1,serverAddr:y,stringUid:b.string_uid,uid:null,errorCode:k.code,extend:b}),y=p[(P+1)%p.length],!0),v);if(w.code!==0){const k=ha(w.code);throw new M(L.UNEXPECTED_RESPONSE,k.desc)}return w}(h,r,t,n,s)).uid}async function mp(r,t,n){var s,c;let d=pt();const h=ft(s=ot(r.cloudProxyServer==="normal"?"PROXY_CS":"WEBCS_DOMAIN")).call(s,C=>{var b;return r.proxyServer?O(b="https://".concat(r.proxyServer,"/ap/?url=")).call(b,C+"/api/v1"):"https://".concat(C,"/api/v1")});if(r.cloudProxyServer==="proxy3"||r.cloudProxyServer==="proxy4"||r.cloudProxyServer==="proxy5"){const C=ft(h).call(h,w=>({url:w,areaCode:Ms()}));let b=null;b=await Co({fragementLength:ot("FRAGEMENT_LENGTH"),referenceList:C,asyncMapHandler:w=>function({url:k,areaCode:P},V,j,st){const mt=pt(),Et={opid:133,flag:V.cloudProxyServer==="proxy5"?4194304:1048576,ts:+new Date,key:V.token,cname:V.cname,sid:V.sid,detail:{6:V.stringUid,11:P},uid:V.uid||0};return Zn(async()=>await Bn(k,{data:Et,cancelToken:j,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":69}}),At=>{var $;if(At.code===0)return gt.joinWebProxyAP(V.sid,{lts:mt,sucess:1,apServerAddr:k,turnServerAddrList:ft($=At.addresses).call($,W=>W.ip).join(","),errorCode:null,eventType:V.cloudProxyServer}),!1;const rt=ha(At.code);throw new M(L.CAN_NOT_GET_GATEWAY_SERVER,rt.desc,{retry:rt.retry})},At=>{return At.code!==L.OPERATION_ABORTED&&(At.code===L.CAN_NOT_GET_GATEWAY_SERVER?(gt.joinWebProxyAP(Et.sid,{lts:mt,sucess:0,apServerAddr:k,turnServerAddrList:null,errorCode:At.code,eventType:V.cloudProxyServer}),S.warning(O($=O(rt=O(W="[".concat(V.clientId,"] proxy ap server ")).call(W,k," failed, message: ")).call(rt,At.message,", retry: ")).call($,At.data.retry)),At.data.retry):(gt.joinWebProxyAP(Et.sid,{lts:mt,sucess:0,apServerAddr:k,turnServerAddrList:null,errorCode:At.code,eventType:V.cloudProxyServer}),!0));var $,rt,W},st)}(w,r,t,n),allFailedhandler:()=>{throw S.error("[".concat(r.clientId,"] can not get proxy server after trying several times")),new M(L.CAN_NOT_GET_PROXY_SERVER)}});const y=b.addresses;if(!y||y.length===0)throw S.error("[".concat(r.clientId,"] can not get proxy server, empty proxy server list")),new M(L.CAN_NOT_GET_PROXY_SERVER,"empty proxy server list");return{addresses:ft(y).call(y,w=>w.ip),serverResponse:{tcpport:y[0].port||443,udpport:y[0].port||qe.udpport,username:qe.username,password:qe.password}}}let p=null;p=await Co({fragementLength:ot("FRAGEMENT_LENGTH"),referenceList:h,asyncMapHandler:C=>function(b,y,w,k){const P=pt(),V={command:"convergeAllocateEdge",sid:y.sid,appId:y.appId,token:y.token,uid:y.uid,cname:y.cname,ts:Math.floor(pt()/1e3),version:Pn,seq:0,requestId:1};return Zn(async()=>({res:await Bn(b,{data:{service_name:"webrtc_proxy",json_body:ht(V)},cancelToken:w,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}}),url:b}),j=>{if(!j.res.json_body)throw S.debug("[".concat(y.clientId,"] Get proxy server failed: no json_body")),new M(L.UNEXPECTED_RESPONSE,ht(j.res));const st=JSON.parse(j.res.json_body);var mt,Et;if(st.code!==200)throw S.debug(O(mt=O(Et="[".concat(y.clientId,"] Get proxy server failed: response code [")).call(Et,st.code,"], reason [")).call(mt,st.reason,"]")),new M(L.UNEXPECTED_RESPONSE,ht(j.res));return S.debug("[".concat(y.clientId,"] App return server length"),st.servers.length),!1},j=>j.code!==L.OPERATION_ABORTED&&(gt.requestProxyAppCenter(V.sid,{lts:P,succ:!1,APAddr:b,workerManagerList:null,ec:j.code,response:j.message}),!0),k)}(C,r,t,n),allFailedhandler:()=>{throw S.error("[".concat(r.clientId,"] can not get proxy server after trying several times")),new M(L.CAN_NOT_GET_PROXY_SERVER)}});const A=JSON.parse(p.res.json_body),m=ft(c=A.servers).call(c,kk);if(r.cloudProxyServer==="443only")return{addresses:m,serverResponse:{tcpport:443,udpport:qe.udpport,username:qe.username,password:qe.password}};gt.requestProxyAppCenter(r.sid,{lts:d,succ:!0,APAddr:p.url,workerManagerList:ht(m),ec:null,response:ht(p.res)}),d=pt();const E=ft(m).call(m,C=>function(b,y,w,k){const P=pt();let V=b;al(b).call(b,"http")||(V="https://".concat(b,":4000/v2/machine"));const j={command:"request",gatewayType:"http",appId:y.appId,cname:y.cname,uid:(y.uid||"").toString(),sdkVersion:"2.3.1",sid:y.sid,seq:1,ts:pt(),requestId:3,clientRequest:{appId:y.appId,cname:y.cname,uid:(y.uid||"").toString(),sid:y.sid}};return Zn(async()=>({res:await Bn(V,{data:j,cancelToken:w}),url:b}),st=>{if(!st.res.serverResponse)throw new M(L.UNEXPECTED_RESPONSE,"requeet worker manager server failed: serverResponse is undefined");return!1},st=>st.code!==L.OPERATION_ABORTED&&(gt.requestProxyWorkerManager(j.sid,{lts:P,succ:!1,workerManagerAddr:b,ec:st.code,response:st.message}),!0),k)}(C,r,t,n));let v=null;try{v=await Os(E)}catch{throw S.error("[".concat(r.clientId,"] can not get worker manager after trying several times")),new M(L.CAN_NOT_GET_PROXY_SERVER)}return G(E).call(E,C=>C.cancel()),gt.requestProxyWorkerManager(r.sid,{lts:d,succ:!0,workerManagerAddr:v.url,ec:null,response:ht(v.res)}),{addresses:[v.url],serverResponse:v.res.serverResponse}}async function KD(r,t,n){var s,c;const d=ft(s=en(c=ot("CDS_AP")).call(c,0,ot("AJAX_REQUEST_CONCURRENT"))).call(s,E=>{var v;return r.proxyServer?O(v="https://".concat(r.proxyServer,"/ap/?url=")).call(v,E+"/api/v1"):"https://".concat(E,"/api/v1?action=config")}),h=ft(d).call(d,E=>function(v,C,b,y){const w=we(),k={flag:64,cipher_method:0,features:{device:w.name,system:w.os,system_general:navigator.userAgent,vendor:C.appId,version:Pn,cname:C.cname,sid:C.sid,session_id:C.sid,detail:"",proxyServer:C.proxyServer}};return Zn(()=>Bn(v,{data:k,timeout:1e3,cancelToken:b,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,P=>P.code!==L.OPERATION_ABORTED,y)}(E,r,t,n));let p=null,A=null,m={};try{p=await Os(h)}catch(E){if(E.code===L.OPERATION_ABORTED)throw E;A=E}if(G(h).call(h,E=>E.cancel()),gt.reportApiInvoke(r.sid,{name:Kt.REQUEST_CONFIG_DISTRIBUTE,options:{error:A,res:p}}).onSuccess(),p&&p.test_tags)try{m=function(E){if(!E.test_tags)return{};const v=E.test_tags,C=le(v),b={};return G(C).call(C,y=>{var w;const k=pc(w=en(y).call(y,4)).call(w),P=JSON.parse(v[y])[1];b[k]=P}),b}(p)}catch{}return m}async function ky(r,t,n,s){var c,d;const h=ft(c=en(d=ot("UAP_AP")).call(d,0,ot("AJAX_REQUEST_CONCURRENT"))).call(c,p=>{var A;return t.proxyServer?O(A="https://".concat(t.proxyServer,"/ap/?url=")).call(A,p+"/api/v1?action=uap"):"https://".concat(p,"/api/v1?action=uap")});return await QD(h,r,t,n,s)}async function HD(r,t,n){var s,c;const d=ft(s=en(c=ot("UAP_AP")).call(c,0,ot("AJAX_REQUEST_CONCURRENT"))).call(s,p=>{var A;return r.proxyServer?O(A="https://".concat(r.proxyServer,"/ap/?url=")).call(A,p+"/api/v1?action=uap"):"https://".concat(p,"/api/v1?action=uap")}),h=ft(d).call(d,p=>function(A,m,E,v){const C={command:"convergeAllocateEdge",sid:m.sid,appId:m.appId,token:m.token,ts:pt(),version:Pn,cname:m.cname,uid:m.uid.toString(),requestId:Ug,seq:Ug};Ug+=1;const b={service_name:"tele_channel",json_body:ht(C)};return Zn(async()=>{var y;const w=await Bn(A,{data:b,cancelToken:E,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(w.code!==0){const V=new M(L.UNEXPECTED_RESPONSE,"cross channel ap error, code"+w.code,{retry:!0});throw S.error(V.toString()),V}const k=JSON.parse(w.json_body);if(k.code!==200){var P;const V=new M(L.UNEXPECTED_RESPONSE,O(P="cross channel app center error, code: ".concat(k.code,", reason: ")).call(P,k.reason));throw S.error(V.toString()),V}if(!k.servers||k.servers.length===0){const V=new M(L.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw S.error(V.toString()),V}return{vid:k.vid,workerToken:k.workerToken,addressList:ft(y=k.servers).call(y,V=>{var j,st;return O(j=O(st="wss://".concat(V.address.replace(/\./g,"-"),".")).call(st,ot("WORKER_DOMAIN"),":")).call(j,V.wss)})}},void 0,y=>!!(y.code!==L.OPERATION_ABORTED&&y.code!==L.UNEXPECTED_RESPONSE||y.data&&y.data.retry),v)}(p,r,t,n));try{const p=await Os(h);return G(h).call(h,A=>A.cancel()),p}catch(p){throw p[0]}}async function YD(r,t,n){let s=null;const c=[],d=async h=>{var p;const A=ft(p=ot(h?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN")).call(p,m=>{var E;return r.proxyServer?O(E="https://".concat(r.proxyServer,"/ap/?url=")).call(E,m+"/api/v2/transpond/webrtc?v=2"):"https://".concat(m,"/api/v2/transpond/webrtc?v=2")});return h&&(await Ur(1e3),s!==null)?s:await Co({fragementLength:ot("FRAGEMENT_LENGTH"),referenceList:A,asyncMapHandler:m=>{var E;return S.debug(O(E="[".concat(r.clientId,"] update ticket, Connect to ")).call(E,h?"backup":""," choose_server:"),m),function(v,C,b,y){const[w]=GD(C,[ai.CHOOSE_SERVER]);let k=yr.networkState;return Zn(async()=>{k&&yr.networkState===mo.OFFLINE&&yr.onlineWaiter&&await dt.race([yr.onlineWaiter,Ur(y&&y.maxRetryTimeout||Ne.maxRetryTimeout)]),k=yr.networkState;const P=await Bn(v,{data:w,cancelToken:b,headers:{"Content-Type":"multipart/form-data;"}},!0);return VD(P,v)},()=>!1,P=>P.code!==L.OPERATION_ABORTED&&(P.code===L.UPDATE_TICKET_FAILED?P.data.retry:(S.warning("[".concat(C.clientId,"] update ticket network error, retry"),P),!0)),y)}(m,r,t,n)},allFailedhandler:m=>{throw m[0]},promisesCollector:c})};try{return s=await Os([d(!1),d(!0)]),c.length&&G(c).call(c,h=>h.cancel&&typeof h.cancel=="function"&&h.cancel()),s}catch(h){throw h[0]}}function Dy(r,t){var n=le(r);if(ee){var s=ee(r);t&&(s=kt(s).call(s,function(c){return Wt(r,c).enumerable})),n.push.apply(n,s)}return n}function Ly(r){for(var t=1;t<arguments.length;t++){var n,s=arguments[t]!=null?arguments[t]:{};if(t%2)G(n=Dy(Object(s),!0)).call(n,function(d){_r(r,d,s[d])});else if(te)He(r,te(s));else{var c;G(c=Dy(Object(s))).call(c,function(d){se(r,d,Wt(s,d))})}}return r}class My extends Hr{constructor(){super(),this.retryConfig={timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4},this.mutex=new Un("config-distribute"),this.mutableParamsRead=!1}startGetConfigDistribute(t,n){this.joinInfo=t,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},ot("CONFIG_DISTRIBUTE_INTERVAL"))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){!this.mutex.isLocked||(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,gt.reportApiInvoke(null,{options:void 0,name:Kt.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Yt.TRACER}).onSuccess(ht(QA))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void S.debug("[config-distribute] get config distribute interrupted have no joininfo");let t;const n=await this.mutex.lock();try{t=await KD(this.joinInfo,this.cancelToken,this.retryConfig),S.debug("[config-distribute] get config distribute",ht(t)),t.limit_bitrate&&this.handleBitrateLimit(t.limit_bitrate),this.cacheGlobalParameterConfig(t),this.configs=t}catch(s){const c=new M(L.NETWORK_RESPONSE_ERROR,s);S.warning("[config-distribute] ".concat(c.toString()))}finally{n()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(t){var n;(n=t)&&n.uplink&&n.id&&n.uplink.max_bitrate!==void 0&&n.uplink.min_bitrate!==void 0&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==t.id&&this.emit(xd.UPDATE_BITRATE_LIMIT,t):this.emit(xd.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&Ly({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(t){var n,s;const c=xa(n=kt(s=le(t)).call(s,h=>/^webrtc_ng_global_parameter/.test(h))).call(n);for(let h=0;h<c.length;h++)for(let p=c.length-1;p>h;p--){const A=c[p];if(typeof t[A].__priority=="number"){const m=t[A].__priority,E=c[p-1];if(typeof t[E].__priority=="number"){if(!(m>t[E].__priority))continue;{const v=A;c[p]=c[p-1],c[p-1]=v}}else{const v=A;c[p]=c[p-1],c[p-1]=v}}}const d={};G(c).call(c,h=>{var p;const A=t[h],m=A.__expires;G(p=le(A)).call(p,E=>{E!=="__priority"&&E!=="__expires"&&!Object.prototype.hasOwnProperty.call(d,E)&&A[E]&&(d[E]=Ly({value:A[E]},m&&{expires:m}))})});try{const h=ht(d),p=window.btoa(h);window.localStorage.setItem("websdk_ng_global_parameter",p),S.debug("Caching global parameters ".concat(h))}catch(h){S.error("Error caching global parameters:",h.message)}}}function Py(r,t){var n=le(r);if(ee){var s=ee(r);t&&(s=kt(s).call(s,function(c){return Wt(r,c).enumerable})),n.push.apply(n,s)}return n}function Qg(r){for(var t=1;t<arguments.length;t++){var n,s=arguments[t]!=null?arguments[t]:{};if(t%2)G(n=Py(Object(s),!0)).call(n,function(d){_r(r,d,s[d])});else if(te)He(r,te(s));else{var c;G(c=Py(Object(s))).call(c,function(d){se(r,d,Wt(s,d))})}}return r}class qD extends Hr{constructor(t,n,s,c){super(),this.reconnectMode="retry",this.reqId=0,this.commandReqId=0,this.handleWebSocketOpen=()=>{this.reconnectMode="retry",this.startPingPong()},this.handleWebSocketMessage=d=>{if(!d.data)return;const h=JSON.parse(d.data);var p;h.requestId?this.emit(O(p="@".concat(h.requestId,"-")).call(p,h.sid),h):this.serviceMode===Wr.INJECT?this.emit(Uo.INJECT_STREAM_STATUS,h):(gt.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===Wr.TRANSCODE?1:2}),this.emit(Uo.PUBLISH_STREAM_STATUS,h))},this.spec=n,this.token=t,this.serviceMode=c,this.websocket=new ap("live-streaming",s),this.websocket.on(Je.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Je.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Je.REQUEST_NEW_URLS,(d,h)=>{xr(this,Uo.REQUEST_NEW_ADDRESS).then(d).catch(h)}),this.websocket.on(Je.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,n,s,c){this.reqId+=1,t==="request"&&(this.commandReqId+=1);const d=this.commandReqId,h=this.reqId;if(!h||!this.websocket)throw new M(L.UNEXPECTED_ERROR);const p=Qg({command:t,sdkVersion:Pn==="4.8.1"?"0.0.1":Pn,seq:h,requestId:h,allocate:s,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(pt()/1e3)},n);if(this.websocket.state==="closed")throw new M(L.WS_DISCONNECT);const A=()=>new dt((C,b)=>{this.websocket.once(Je.CLOSED,()=>b(new M(L.WS_ABORT))),this.websocket.once(Je.CONNECTED,C)});this.websocket.state!=="connected"&&await A(),p.clientRequest&&(p.clientRequest.workerToken=this.token);const m=new dt((C,b)=>{var y;const w=()=>{b(new M(L.WS_ABORT))};this.websocket.once(Je.RECONNECTING,w),this.websocket.once(Je.CLOSED,w),this.once(O(y="@".concat(h,"-")).call(y,this.spec.sid),k=>{C(k)})});c&&gt.workerEvent(this.spec.sid,Qg({},c,{requestId:d,actionType:"request",payload:ht(n.clientRequest),serverCode:0,code:0}));const E=pt();this.websocket.sendMessage(p);let v=null;try{v=await m}catch(C){if(this.websocket.state==="closed")throw C;return await A(),await this.request(t,n,s)}return c&&gt.workerEvent(this.spec.sid,Qg({},c,{requestId:d,actionType:"response",payload:ht(v.serverResponse),serverCode:v.code,success:v.code===200,responseTime:pt()-E})),v.code!==200&&this.handleResponseError(v),v}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t=Pn==="4.8.1"?"0.0.1":Pn;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(pt()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case Or.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void S.warning("live stream response already exists stream");case Or.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Or.LIVE_STREAM_RESPONSE_BAD_STREAM:case Or.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new M(L.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case Or.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;throw new M(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Or.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new M(L.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case Or.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new M(L.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Uo.WARNING,n,t.serverResponse.url)}case Or.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new M(L.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Uo.WARNING,n,t.serverResponse.url)}case Or.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new M(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Or.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new M(L.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case Or.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new M(L.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Uo.WARNING,n,t.serverResponse.url)}case Or.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new M(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case Or.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new M(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Or.LIVE_STREAM_RESPONSE_WORKER_LOST:case Or.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;throw new M(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Or.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new M(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new M(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Or.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Or.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Or.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Or.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new M(L.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(Cl)},6e3)}}function By(r,t){var n=le(r);if(ee){var s=ee(r);t&&(s=kt(s).call(s,function(c){return Wt(r,c).enumerable})),n.push.apply(n,s)}return n}function ja(r){for(var t=1;t<arguments.length;t++){var n,s=arguments[t]!=null?arguments[t]:{};if(t%2)G(n=By(Object(s),!0)).call(n,function(d){_r(r,d,s[d])});else if(te)He(r,te(s));else{var c;G(c=By(Object(s))).call(c,function(d){se(r,d,Wt(s,d))})}}return r}class Uy extends Hr{constructor(t,n=Ne,s=Ne){super(),this.retryTimeout=1e4,this.streamingTasks=new re,this.isStartingStreamingTask=!1,this.taskMutex=new Un("live-streaming"),this.cancelToken=Lo.CancelToken.source(),this.injectConfig=ja({},rk),this.injectLoopTimes=0,this.lastTaskId=1,this.statusError=new re,this.spec=t,this.httpRetryConfig=s,this.wsRetryConfig=n}async setTranscodingConfig(t){var n;const s=ja({},ek,{},t);var c,d;s.videoCodecProfile!==66&&s.videoCodecProfile!==77&&s.videoCodecProfile!==100&&(S.debug(O(c="[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ")).call(c,s.videoCodecProfile," -> 100")),s.videoCodecProfile=100),s.transcodingUsers||(s.transcodingUsers=s.userConfigs),s.transcodingUsers&&(s.transcodingUsers=ft(d=s.transcodingUsers).call(d,w=>ja({},tk,{},w,{zOrder:w.zOrder?w.zOrder+1:1}))),function(w){var k,P;er(w.width)||Ie(w.width,"config.width",0,1e4),er(w.height)||Ie(w.height,"config.height",0,1e4),er(w.videoBitrate)||Ie(w.videoBitrate,"config.videoBitrate",1,1e6),er(w.videoFrameRate)||Ie(w.videoFrameRate,"config.videoFrameRate"),er(w.lowLatency)||Ac(w.lowLatency,"config.lowLatency"),er(w.audioSampleRate)||Pr(w.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),er(w.audioBitrate)||Ie(w.audioBitrate,"config.audioBitrate",1,128),er(w.audioChannels)||Pr(w.audioChannels,"config.audioChannels",[1,2,3,4,5]),er(w.videoGop)||Ie(w.videoGop,"config.videoGop"),er(w.videoCodecProfile)||Pr(w.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),er(w.userCount)||Ie(w.userCount,"config.userCount",0,17),er(w.backgroundColor)||Ie(w.backgroundColor,"config.backgroundColor",0,16777215),er(w.userConfigExtraInfo)||pr(w.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),w.transcodingUsers&&!er(w.transcodingUsers)&&(Uh(w.transcodingUsers,"config.transcodingUsers"),G(k=w.transcodingUsers).call(k,(V,j)=>{Fh(V.uid),er(V.x)||Ie(V.x,"transcodingUser[".concat(j,"].x"),0,1e4),er(V.y)||Ie(V.y,"transcodingUser[".concat(j,"].y"),0,1e4),er(V.width)||Ie(V.width,"transcodingUser[".concat(j,"].width"),0,1e4),er(V.height)||Ie(V.height,"transcodingUser[".concat(j,"].height"),0,1e4),er(V.zOrder)||Ie(V.zOrder-1,"transcodingUser[".concat(j,"].zOrder"),0,100),er(V.alpha)||Ie(V.alpha,"transcodingUser[".concat(j,"].alpha"),0,1,!1)})),er(w.watermark)||HA(w.watermark,"watermark"),er(w.backgroundImage)||HA(w.backgroundImage,"backgroundImage"),w.images&&!er(w.images)&&(Uh(w.images,"config.images"),G(P=w.images).call(P,(V,j)=>{HA(V,"images[".concat(j,"]"))}))}(s);const h=[];var p,A;s.images&&h.push(...ft(p=s.images).call(p,w=>ja({},KA,{},w,{zOrder:255}))),s.backgroundImage&&(h.push(ja({},KA,{},s.backgroundImage,{zOrder:0})),delete s.backgroundImage),s.watermark&&(h.push(ja({},KA,{},s.watermark,{zOrder:255})),delete s.watermark),s.images=h,s.transcodingUsers&&(s.userConfigs=ft(A=s.transcodingUsers).call(A,w=>ja({},w)),s.userCount=s.transcodingUsers.length,delete s.transcodingUsers);const m=ft(n=s.userConfigs||[]).call(n,w=>typeof w.uid=="number"?dt.resolve(w.uid):Fg(w.uid,this.spec,this.cancelToken.token,this.httpRetryConfig)),E=await dt.all(m);if(G(E).call(E,(w,k)=>{s.userConfigs&&s.userConfigs[k]&&(s.userConfigs[k].uid=w)}),this.transcodingConfig=s,this.connection)try{var v,C,b;const w=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:ft(v=Fe(ua(C=this.streamingTasks).call(C))).call(v,k=>k.taskId).join("#")});S.debug(O(b="[".concat(this.spec.clientId,"] update live transcoding config success, code: ")).call(b,w.code,", config:"),ht(this.transcodingConfig))}catch(w){var y;if(!w.data||!w.data.retry)throw w;w.data.changeAddress&&this.connection.tryNextAddress(),G(y=this.streamingTasks).call(y,k=>{S.warning("[".concat(this.spec.clientId,"] live streaming receive error"),w.toString(),"try to republish",k.url),this.startLiveStreamingTask(k.url,k.mode,w).then(()=>{var P;S.debug(O(P="[".concat(this.spec.clientId,"] live streaming republish ")).call(P,k.url," success"))}).catch(P=>{S.error("[".concat(this.spec.clientId,"] live streaming republish failed"),k.url,P.toString()),this.onLiveStreamError&&this.onLiveStreamError(k.url,P)})})}}setInjectStreamConfig(t,n){this.injectConfig=hr({},this.injectConfig,t),this.injectLoopTimes=n}async startLiveStreamingTask(t,n,s){var c,d,h,p;if(_t(c=Fe(ua(d=this.streamingTasks).call(d))).call(c,C=>C.mode===Wr.INJECT)&&n===Wr.INJECT)return new M(L.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!this.transcodingConfig&&n===Wr.TRANSCODE)throw new M(L.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let A={command:"PublishStream",ts:pt(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};S.debug(O(h=O(p="[".concat(this.spec.clientId,"] start live streaming ")).call(p,t,", mode: ")).call(h,n));const m=await this.taskMutex.lock();if(!this.connection&&s)return void m();if(this.streamingTasks.get(t)&&!s)return m(),new M(L.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(C){throw m(),C}switch(n){case Wr.TRANSCODE:A.transcodingConfig=ja({},this.transcodingConfig);break;case Wr.RAW:break;case Wr.INJECT:A={cname:this.spec.cname,command:"InjectStream",sid:this.spec.sid,transcodingConfig:this.injectConfig,ts:pt(),url:t,loopTimes:this.injectLoopTimes}}this.uapResponse&&this.uapResponse.vid&&(A.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const E=this.lastTaskId++;try{var v;const C=new dt((y,w)=>{Ur(this.retryTimeout).then(()=>{if(s)return w(s);const k=this.statusError.get(t);return k?(this.statusError.delete(t),w(k)):void 0})}),b=await dt.race([this.connection.request("request",{clientRequest:A},!0,{url:t,command:"PublishStream",workerType:n===Wr.TRANSCODE?1:2,requestByUser:!s,tid:E.toString()}),C]);this.isStartingStreamingTask=!1,S.debug(O(v="[".concat(this.spec.clientId,"] live streaming started, code: ")).call(v,b.code)),this.streamingTasks.set(t,{clientRequest:A,mode:n,url:t,taskId:E}),m()}catch(C){if(m(),this.isStartingStreamingTask=!1,!C.data||!C.data.retry||s)throw C;return C.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,n,C)):await this.startLiveStreamingTask(t,n,C)}}stopLiveStreamingTask(t){return new dt((n,s)=>{const c=this.streamingTasks.get(t);if(!c||!this.connection)return new M(L.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const d=c.mode;c.abortTask=()=>{S.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),n()},this.connection.request("request",{clientRequest:{command:d===Wr.INJECT?"UninjectStream":"UnpublishStream",url:c.url}},!1,{url:t,command:"UnPublishStream",workerType:d===Wr.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{var p;S.debug(O(p="[".concat(this.spec.clientId,"] stop live streaming success, code: ")).call(p,h.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&d!==Wr.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),n(),d===Wr.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(5,this.spec.uid,t)}).catch(s)})}async controlInjectStream(t,n,s,c){const d=this.streamingTasks.get(t);if(!d||!this.connection||d.mode!==Wr.INJECT)throw new M(L.INVALID_OPERATION,"can not find inject stream task to control");return(await this.connection.request("request",{clientRequest:{command:"ControlStream",url:t,control:n,audioVolume:s,position:c}})).serverResponse}resetAllTask(){var t;const n=Fe(ua(t=this.streamingTasks).call(t));this.terminate();for(const s of n)this.startLiveStreamingTask(s.url,s.mode).catch(c=>{this.onLiveStreamError&&this.onLiveStreamError(s.url,c)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new re,this.isStartingStreamingTask=!1,this.statusError=new re,this.cancelToken=Lo.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new M(L.UNEXPECTED_ERROR,"live streaming connection has already connected");const n=await xr(this,pl.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=n,this.connection=new qD(n.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(Uo.WARNING,(s,c)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(c,s)),this.connection.on(Uo.PUBLISH_STREAM_STATUS,s=>this.handlePublishStreamServer(s)),this.connection.on(Uo.INJECT_STREAM_STATUS,s=>this.handleInjectStreamServerStatus(s)),this.connection.on(Uo.REQUEST_NEW_ADDRESS,(s,c)=>{if(!this.connection)return c(new M(L.UNEXPECTED_ERROR,"can not get new live streaming address list"));xr(this,pl.REQUEST_WORKER_MANAGER_LIST,t).then(d=>{this.uapResponse=d,s(d.addressList)}).catch(c)}),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(t){const n=t.serverStatus&&t.serverStatus.url||"empty_url",s=this.streamingTasks.get(n),c=t.reason;switch(t.code){case Or.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Or.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Or.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Or.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new M(L.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(s)return S.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,h);if(!this.isStartingStreamingTask)return;this.statusError.set(n,h)}case Or.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new M(L.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,h)}case Or.LIVE_STREAM_RESPONSE_WORKER_LOST:case Or.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var d;if(!this.connection)return;this.connection.tryNextAddress();const h=Fe(ua(d=this.streamingTasks).call(d));for(const p of h)p.abortTask?p.abortTask():(S.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",p.url),this.startLiveStreamingTask(p.url,p.mode,new M(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{S.debug("[".concat(this.spec.clientId,"] republish live stream success"),p.url)}).catch(A=>{S.error(A.toString()),this.onLiveStreamError&&this.onLiveStreamError(p.url,A)}));return}}}handleInjectStreamServerStatus(t){const n=Number(t.uid),s=t.serverStatus&&t.serverStatus.url;switch(t.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(0,n,s));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(1,n,s),void this.streamingTasks.delete(s);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(2,n,s),void this.streamingTasks.delete(s);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(10,n,s),void this.streamingTasks.delete(s);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(3,n,s),void this.streamingTasks.delete(s);default:return void S.debug("inject stream server status",t)}}hasUrl(t){return this.streamingTasks.has(t)}}class xy{constructor(){this.destChannelMediaInfos=new re}setSrcChannelInfo(t){OC(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){OC(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){xh(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function Ep(r){if(!(r instanceof xy))return new M(L.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=r.getSrcChannelMediaInfo(),n=r.getDestChannelMediaInfo();if(!t)return new M(L.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new M(L.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class JD extends Hr{constructor(t,n,s){super(),this.requestId=1,this.onOpen=()=>{this.emit("open"),this.startHeartBeatCheck()},this.onClose=c=>{this.emit("close"),this.dispose()},this.onMessage=c=>{const d=JSON.parse(c.data);if(!d||d.command!=="serverResponse"||!d.requestId)return d&&d.command==="serverStatus"&&d.serverStatus&&d.serverStatus.command?(this.emit("status",d.serverStatus),void this.emit(d.serverStatus.command,d.serverStatus)):void 0;this.emit("req_".concat(d.requestId),d)},this.joinInfo=t,this.clientId=n,this.ws=new ap("cross-channel-".concat(this.clientId),s),this.ws.on(Je.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Je.CONNECTED,this.onOpen),this.ws.on(Je.ON_MESSAGE,this.onMessage),this.ws.on(Je.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){const n=this.requestId++;return t.requestId=n,t.seq=n,this.ws.sendMessage(t),n}waitStatus(t){return new dt((n,s)=>{const c=window.setTimeout(()=>{s(new M(L.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,d=>{window.clearTimeout(c),d.state&&d.state!==0?s(new M(L.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(c),s(new M(L.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new M(L.WS_DISCONNECT);const n=()=>new dt((h,p)=>{this.ws.once(Je.CLOSED,()=>p(new M(L.WS_ABORT))),this.ws.once(Je.CONNECTED,h)});this.ws.state!=="connected"&&await n();const s=this.sendMessage(t),c=new dt((h,p)=>{const A=()=>{p(new M(L.WS_ABORT))};this.ws.once(Je.RECONNECTING,A),this.ws.once(Je.CLOSED,A),this.once("req_".concat(s),h),Ur(3e3).then(()=>{this.removeAllListeners("req_".concat(s)),this.ws.off(Je.RECONNECTING,A),this.ws.off(Je.CLOSED,A),p(new M(L.TIMEOUT,"cross channel ws request timeout"))})}),d=await c;if(!d||d.code!==200)throw new M(L.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(ht(d)));return d}async connect(t){this.ws.removeAllListeners(Je.REQUEST_NEW_URLS),this.ws.on(Je.REQUEST_NEW_URLS,n=>{n(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){const n=this.requestId++;return t.requestId=n,this.ws.sendMessage(t),n}startHeartBeatCheck(){this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class Fy extends Hr{constructor(t,n,s,c){super(),this.cancelToken=Lo.CancelToken.source(),this.requestId=0,this._state="RELAY_STATE_IDLE",this.errorCode="RELAY_OK",this.onStatus=d=>{var h;S.debug(O(h="[".concat(this.clientId,"] ChannelMediaStatus: ")).call(h,ht(d))),d&&d.command&&(d.command==="onAudioPacketReceived"&&this.emit("event","PACKET_RECEIVED_AUDIO_FROM_SRC"),d.command==="onVideoPacketReceived"&&this.emit("event","PACKET_RECEIVED_VIDEO_FROM_SRC"),d.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode="SRC_TOKEN_EXPIRED",this.state="RELAY_STATE_FAILURE"),d.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode="DEST_TOKEN_EXPIRED",this.state="RELAY_STATE_FAILURE"))},this.onReconnect=async()=>{S.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event","NETWORK_DISCONNECTED"),this.state="RELAY_STATE_IDLE",this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(d=>{this.state!=="RELAY_STATE_IDLE"&&(S.error("auto restart channel media relay failed",d.toString()),this.errorCode="SERVER_CONNECTION_LOST",this.state="RELAY_STATE_FAILURE")})},this.joinInfo=t,this.clientId=n,this.signal=new JD(this.joinInfo,this.clientId,s),this.httpRetryConfig=c}set state(t){t!==this._state&&(t!=="RELAY_STATE_FAILURE"&&(this.errorCode="RELAY_OK"),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}async startChannelMediaRelay(t){if(this.state!=="RELAY_STATE_IDLE")throw new M(L.INVALID_OPERATION);this.state="RELAY_STATE_CONNECTING",await this.connect(),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new M(L.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new M(L.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new M(L.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!=="RELAY_STATE_RUNNING")throw new M(L.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),S.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state="RELAY_STATE_IDLE",this.dispose()}dispose(){S.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Lo.CancelToken.source(),this.state="RELAY_STATE_IDLE",this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const t=await HD(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event","NETWORK_CONNECTED"),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){const n=this.genMessage(zn.StopPacketTransfer);await this.signal.request(n),await this.signal.waitStatus("Normal Quit"),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const s=this.genMessage(zn.SetSdkProfile,t);await this.signal.request(s),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const c=this.genMessage(zn.SetSourceChannel,t);await this.signal.request(c),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event","PACKET_JOINED_SRC_CHANNEL"),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const d=this.genMessage(zn.SetSourceUserId,t);await this.signal.request(d),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const h=this.genMessage(zn.SetDestChannel,t);await this.signal.request(h),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event","PACKET_JOINED_DEST_CHANNEL"),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const p=this.genMessage(zn.StartPacketTransfer,t);await this.signal.request(p),this.emit("event","PACKET_SENT_TO_DEST_CHANNEL"),this.state="RELAY_STATE_RUNNING",S.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success"))}async sendUpdateMessage(t){const n=this.genMessage(zn.UpdateDestChannel,t);await this.signal.request(n),this.emit("event","PACKET_UPDATE_DEST_CHANNEL"),S.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const t=this.genMessage(zn.StopPacketTransfer);await this.signal.request(t),S.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,n){const s=[],c=[],d=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Pn,sid:this.joinInfo.sid,ts:pt(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};h.sdkVersion==="4.8.1"&&(h.sdkVersion="0.0.1");let p=null,A=null;switch(t){case zn.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case zn.SetSourceChannel:if(A=n&&n.getSrcChannelMediaInfo(),!A)throw new M(L.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:A.channelName,token:A.token||this.joinInfo.appId},h;case zn.SetSourceUserId:if(A=n&&n.getSrcChannelMediaInfo(),!A)throw new M(L.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:A.uid+""},h;case zn.SetDestChannel:if(p=n&&n.getDestChannelMediaInfo(),!p)throw new M(L.UNEXPECTED_ERROR,"can not find dest config");return G(p).call(p,m=>{s.push(m.channelName),c.push(m.uid+""),d.push(m.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:s,uid:c,token:d},h;case zn.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case zn.Reconnect:return h.clientRequest={command:"Reconnect"},h;case zn.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case zn.UpdateDestChannel:if(p=n&&n.getDestChannelMediaInfo(),!p)throw new M(L.UNEXPECTED_ERROR,"can not find dest config");return G(p).call(p,m=>{s.push(m.channelName),c.push(m.uid+""),d.push(m.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:s,uid:c,token:d},h}return h}}class _p{constructor(t){this.freezeTimeCounterList=[],this.timeUpdatedCount=0,this.freezeTime=0,this.playbackTime=0,this.lastTimeUpdatedTime=0,this._videoElementStatus=Gn.NONE,this.isGettingVideoDimensions=!1,this.handleVideoEvents=n=>{switch(n.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=Gn.PLAYING;break;case"loadeddata":this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded();break;case"canplay":this.videoElementStatus=Gn.CANPLAY;break;case"stalled":this.videoElementStatus=Gn.STALLED;break;case"suspend":this.videoElementStatus=Gn.SUSPEND;break;case"pause":this.videoElementStatus=Gn.PAUSED,!vi()&&!as()&&this.videoElement&&this.videoTrack&&this.videoTrack.readyState==="live"&&(S.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Gn.WAITING;break;case"abort":this.videoElementStatus=Gn.ABORT;break;case"ended":this.videoElementStatus=Gn.ENDED;break;case"emptied":this.videoElementStatus=Gn.EMPTIED;break;case"timeupdate":{const s=pt();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=s);const c=s-this.lastTimeUpdatedTime;for(this.lastTimeUpdatedTime=s,c>500&&(this.freezeTime+=c),this.playbackTime+=c;this.playbackTime>=6e3;)this.playbackTime-=6e3,this.freezeTimeCounterList.push(Math.min(6e3,this.freezeTime)),this.freezeTime=Math.max(0,this.freezeTime-6e3);break}}},this.startGetVideoDimensions=()=>{const n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement&&this.videoElement.videoWidth*this.videoElement.videoHeight>4)return S.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);vn(n,500)};!this.isGettingVideoDimensions&&n()},this.autoResumeAfterInterruption=()=>{this.videoElement&&this.videoTrack&&this.videoTrack.readyState==="live"&&ue.curState==="running"&&(JI()?(S.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15.0")),this.videoElement.pause(),this.videoElement.play()):zI()?(S.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15.1")),this.videoElement.load(),this.videoElement.play()):(S.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 14")),this.videoElement.play()))},this.autoResumeAfterInterruptionOnIOS15=()=>{this.videoElement&&this.videoTrack&&this.videoTrack.readyState==="live"&&(JI()?(S.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15.0")),this.videoElement.pause(),this.videoElement.play()):zI()&&(S.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15.1")),this.videoElement.load(),this.videoElement.play()))},this.slot=t.element,this.trackId=t.trackId,this.updateConfig(t),ue.on(Lr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),ue.on(Lr.IOS_15_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15)}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(t){var n,s;t!==this._videoElementStatus&&(S.debug(O(n=O(s="[".concat(this.trackId,"] video-element-status change ")).call(s,this._videoElementStatus," => ")).call(n,t)),this._videoElementStatus=t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const n=t.element;n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){if(this.videoElement){const n=this.videoElement.play();n&&n.catch&&n.catch(c=>{t&&gt.autoplayFailed(t,"video",c.message,this.trackId),c.name==="NotAllowedError"?(S.warning("detected video element autoplay failed",c),this.handleAutoPlayFailed()):S.warning("[".concat(this.trackId,"] play warning: "),c)});const s=we();(s.name==="Safari"&&Number(s.version)===15||ia())&&n&&n.finally&&n.finally(()=>{this.config.mirror&&this.videoElement&&(this.videoElement.style.transform="rotateY(180deg)")})}}getCurrentFrame(){if(!this.videoElement)return new ImageData(2,2);const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const n=t.getContext("2d");if(!n)return S.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,t.width,t.height);const s=n.getImageData(0,0,t.width,t.height);return t.remove(),s}destroy(){if(ue.off(Lr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),ue.off(Lr.IOS_15_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15),this.videoElement&&(this.videoElement.srcObject=null,this.videoElement.remove(),this.videoElement=void 0),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}this.freezeTimeCounterList=[]}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",this.createVideoElement(),this.container.appendChild(this.videoElement)):this.removeVideoElement(),this.slot.appendChild(this.container)}createVideoElement(){this.videoElement||(this.videoElementStatus=Gn.INIT,this.videoElement=document.createElement("video"),this.videoElement.onerror=()=>this.videoElementStatus=Gn.ERROR,this.container&&this.container.appendChild(this.videoElement),G(vp).call(vp,s=>{this.videoElement&&this.videoElement.addEventListener(s,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{!document.getElementById("video_".concat(this.trackId))&&this.videoElement&&(this.videoElementStatus=Gn.DESTROYED)},1e3)),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),this.videoElement.style.left="0",this.videoElement.style.top="0";const t=we();t.name==="Safari"&&Number(t.version)===15||ia()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Gr()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Gr()&&this.videoElement.load());const n=this.videoElement.play();n!==void 0&&n.catch(s=>{S.debug("[".concat(this.trackId,"] playback interrupted"),s.toString())})}removeVideoElement(){if(this.videoElement){G(vp).call(vp,t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0);try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=void 0,this.videoElementStatus=Gn.NONE}}handleAutoPlayFailed(){const t=we();if(this.videoElement){const n=s=>{s.preventDefault(),this.videoElement&&(this.videoElement.play().then(()=>{var c;S.debug(O(c="[".concat(this.trackId,"] Video element for trackId:")).call(c,this.trackId," autoplay resumed."))}).catch(c=>{S.error(c)}),t.os!=="Android"||t.name!=="Chrome"&&t.name!==Re.WECHAT?(document.body.removeEventListener("touchstart",n,!0),document.body.removeEventListener("mousedown",n,!0)):document.body.removeEventListener("click",n,!0))};t.os!=="Android"||t.name!=="Chrome"&&t.name!==Re.WECHAT?(document.body.addEventListener("touchstart",n,!0),document.body.addEventListener("mousedown",n,!0)):document.body.addEventListener("click",n,!0),XC()}}getVideoElement(){return this.videoElement}getContainerElement(){return this.container}}const vp=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate"];function zD(r,t,n){const s=r.createShader(n);if(!s)return new M(L.WEBGL_INTERNAL_ERROR,"can not create shader").throw();if(r.shaderSource(s,t),r.compileShader(s),!r.getShaderParameter(s,r.COMPILE_STATUS)){const c=r.getShaderInfoLog(s);return r.deleteShader(s),new M(L.WEBGL_INTERNAL_ERROR,"error compiling shader:"+c).throw()}return s}function XD(r,t,n,s){const c=[];for(let d=0;d<t.length;++d){const h=d===0?r.VERTEX_SHADER:r.FRAGMENT_SHADER;c.push(zD(r,t[d],h))}return function(d,h,p,A){const m=d.createProgram();if(!m)throw new M(L.WEBGL_INTERNAL_ERROR,"can not create webgl program");if(G(h).call(h,E=>{d.attachShader(m,E)}),p&&G(p).call(p,(E,v)=>{d.bindAttribLocation(m,A?A[v]:v,E)}),d.linkProgram(m),!d.getProgramParameter(m,d.LINK_STATUS)){const E=d.getProgramInfoLog(m);throw d.deleteProgram(m),new M(L.WEBGL_INTERNAL_ERROR,"error in program linking:"+E)}return m}(r,c,n,s)}var Qy;!document.documentMode&&!!window.StyleMedia&&(HTMLCanvasElement.prototype.getContext=(Qy=HTMLCanvasElement.prototype.getContext,function(){let r=arguments;return r[0]==="webgl"&&(r=en([]).call(arguments),r[0]="experimental-webgl"),Qy.apply(null,r)}));const ZD=[31,222,239,159,192,236,164,81,54,227,176,149,2,247,75,141,183,54,213,216,158,92,111,49,228,111,150,6,135,79,35,212,4,155,200,168,37,107,243,110,144,179,51,81,55,78,223,242,191,211,74,119,203,151,142,62,31,41,132,22,35,155,87,123,119,117,216,57,201,53,228,67,201,40,106,24,80,176,187,253,60,63,136,100,20,12,177,99,64,38,101,143,111,176,251,211,145,136,34,23,79,136,202,95,105,199,125,67,180,44,210,179,228,4,85,160,188,64,26,46,6,61,201,103,248,18,97,254,140,36,115,106,48,124,102,216,155,120,36,227,165,217,7,227,191,128,212,157,80,37,117,175,24,214,47,221,183,211,51,174,251,223,159,167,152,53,36,107,199,223,91,62,46,194,11,80,121,188,219,2,99,99,232,229,173,234,21,30,236,177,243,142,97,48,108,56,62,172,56,216,3,42,79,138,23,88,182,39,5,118,68,135,178,56,9,94,189,44,104,9,238,231,174,122,85,247,231,86,74,8,189,147,218,180,58,76,227,17,46,90,194,100,51,178,72,163,151,243,166,130,85,1,223,130,152,242,85,255,28,173,97,252,119,215,177,119,86,104,136,82,40,72,53,11,18,26,240,188,76,110,39,31,189];function Vy(r){const t=new Uint8Array([99,114,121,112,116,105,105]),n=t.length,s=r,c=s.length,d=new Uint8Array(c),h=new Uint8Array(256);for(let v=0;v<256;v++)h[v]=v;let p=0;for(let v=0;v<256;v++)p=(p+h[v]+t[v%n])%256,[h[v],h[p]]=[h[p],h[v]];let A,m=0;p=0;for(let v=0;v<0+c;v++)m=(m+1)%256,p=(p+h[m])%256,[h[m],h[p]]=[h[p],h[m]],A=h[(h[m]+h[p])%256],v>=0&&(d[v-0]=s[v-0]^A);const E=String.fromCharCode.apply(null,Fe(d));return Function("var winSize = 5; return `"+E+"`")()}function $D(r,t){const n=Vy(t),s=XD(r,[Vy(ZD),n]);{const c=r.getAttribLocation(s,"a_position"),d=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,d),r.bufferData(r.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),r.STATIC_DRAW),r.enableVertexAttribArray(c);const h=2,p=r.FLOAT,A=!1,m=0,E=0;r.vertexAttribPointer(c,h,p,A,m,E)}{const c=r.getAttribLocation(s,"a_texCoord"),d=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,d),r.bufferData(r.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),r.STATIC_DRAW),r.enableVertexAttribArray(c);const h=2,p=r.FLOAT,A=!1,m=0,E=0;r.vertexAttribPointer(c,h,p,A,m,E)}return s}const tL=[11,196,242,139,198,252,188,5,59,170,161,152,17,229,24,141,133,54,214,206,133,26,66,126,255,11,245,10,146,92,52,134,108,152,221,191,124,116,248,106,130,251,59,105,43,91,135,199,181,223,10,51,134,194,240,46,9,3,141,22,35,146,76,23,109,117,208,41,201,45,218,76,203,105,51,58,97,154,145,236,49,18,183,127,27,12,210,122,73,42,37,143,36,207,251,211,145,191,56,10,88,222,181,125,22,238,123,71,177,107,218,254,173,28,34,253,249,67,83,97,73,111,219,43,181,82,38,230,136,109,22,67];class Gy{constructor(t,n){this.gl=t,this.kernel=n||tL,this.program=$D(this.gl,this.kernel)}setUniforms(){const t=this.gl.getUniformLocation(this.program,"u_flipY");this.gl.uniform1f(t,1)}}class Aa extends Gy{constructor(t,n,s,c){super(t,n),this.denoiseLevel=5,this.xOffset=1/s,this.yOffset=1/c}setUniforms(){const t=this.gl.getUniformLocation(this.program,"u_flipY"),n=this.gl.getUniformLocation(this.program,"u_singleStepOffset"),s=this.gl.getUniformLocation(this.program,"u_denoiseLevel");this.gl.uniform2f(n,this.xOffset,this.yOffset),this.gl.uniform1f(s,this.denoiseLevel),this.gl.uniform1f(t,1)}setParameters(t){t.denoiseLevel!==void 0&&(this.denoiseLevel=t.denoiseLevel)}setSize(t,n){this.xOffset=1/t,this.yOffset=1/n}}const eL=[11,196,242,139,198,252,188,5,59,170,161,152,17,229,24,141,133,54,214,206,133,26,66,126,255,11,245,10,146,92,52,134,108,155,210,164,99,114,228,96,130,251,59,105,43,91,135,199,181,223,10,51,133,194,247,34,31,39,142,28,2,130,18,109,84,124,223,62,140,52,128,47,208,47,115,39,4,200,220,171,53,36,150,101,10,75,247,121,74,36,35,143,108,176,235,211,135,164,36,11,88,160,148,35,6,221,41,32,166,109,205,171,228,4,26,169,244,82,119,102,86,61,201,103,248,18,97,242,182,34,121,70,28,71,126,197,223,126,14,244,149,192,12,176,187,149,212,156,22,44,36,133,10,216,63,198,213,154,116,230,253,154,154,249,215,55,60,34,196,229,76,50,44,135,22,77,113,247,142,94,60,23,172,145,175,218,81,86,162,239,180,205,63,118,3,110,123,224,127,158,124,15,127,157,27,66,176,33,24,51,53,194,178,56,6,74,191,111,51,78,174,157,229,17,22,178,231,92,25,23,191,157,137,188,54,64,176,13,22,81,207,45,108,203,83,186,130,237,186,153,110,8,196,168,152,161,28,238,46,184,36,185,20,203,183,98,95,41,149,93,105,37,116,91,68,105,164,217,30,42,60,53,173,213,177,216,195,53,204,173,128,243,42,122,205,65,97,129,194,68,218,91,141,11,224,124,132,138,119,36,220,161,39,214,146,183,193,225,23,177,201,243,128,160,33,75,86,126,139,254,232,14,13,85,2,112,17,150,36,180,86,226,225,126,197,17,228,225,142,245,37,170,39,96,187,190,2,35,85,237,11,189,1,79,237,2,1,114,246,109,190,66,54,153,43,218,204,70,6,204,162,247,18,130,123,30,60,165,130,142,210,133,91,127,117,71,38,145,172,7,5,16,220,222,111,98,141,239,208,125,26,238,28,0,216,89,13,7,119,134,194,75,41,67,174,1,217,80,101,40,26,59,28,59,46,108,138,38,157,167,28,234,73,177,42,42,102,108,26,181,27,178,42,43,52,28,110,117,198,173,176,178,101,225,150,36,139,108,105,10,237,222,3,143,126,18,144,115,74,56,114,134,231,159,212,62,126,80,173,216,167,4,81,18,52,17,144,218,32,139,207,104,128,229,99,84,120,31,87,227,154,91,196,63,123,111,125,36,52,57,168,113,150,189,204,24,104,196,237,86,163,68,197,202,170,212,191,81,193,111,255,162,181,202,156,146,196,96,16,118,117,55,71,156,31,163,242,204,239,11,150,27,126,115,154,107,247,134,158,125,255,146,35,183,209,36,116,87,215,172,5,251,133,114,254,141,195,6,145,4,111,182,167,74,154,152,68,18,146,88,106,200,154,15,176,94,86,66,178,101,219,35,188,129,66,28,41,110,174,53,88,174,64,191,206,127,48,126,214,216,93,119,2,166,99,181,222,29,218,28,195,219,125,44,50,16,99,174,225,51,133,120,184,159,168,75,242,162,124,255,81,25,153,109,69,220,176,4,237,196,233,19,8,240,160,39,122,81,29,188,144,249,170,174,137,30,10,93,133,151,199,248,175,38,41,144,229,245,149,25,240,138,179,114,182,84,50,103,95,31,199,31,87,208,203,199,135,49,211,43,52,36,74,59,37,22,136,171,244,126,18,251,39,159,241,66,206,127,149,159,182,143,232,199,136,46,150,32,51,221,74,22,102,93,22,44,132,140,199,43,69,249,77,75,140,70,4,252,98,235,77,190,125,18,56,21,10,244,42,2,246,62,127,241,123,137,22,247,219,177,160,84,18,10,84,97,251,127,102,16,209,181,100,94,56,238,209,207,76,189,95,15,165,139,143,189,96,225,55,112,178,27,218,198,223,251,52,123,94,130,220,142,216,116,237,18,254,49,59,128,41,29,15,179,164,85,76,167,166,151,39,221,2,190,68,167,26,177,114,141,4,67,25,69,182,38,166,160,27,151,148,108,48,227,60,112,48,22,159,76,127,251,63,254,177,113,217,197,95,179,109,128,138,99,27,249,10,174,155,129,80,39,165,252,85,60,131,183,98,107,68,207,19,233,231,55,225,126,77,49,53,145,203,113,29,208,64,237,182,229,165,7,11,169,106,253,116,141,200,62,16,38,121,55,148,91,83,160,140,126,121,12,79,189,72,172,31,243,240,209,229,32,220,91,229,81,94,247,121,153,151,232,182,171,198,50,31,152,245,172,151,130,55,62,125,38,155,229,78,207,148,201,2,78,63,119,107,168,78,139,141,163,177,191,239,141,39,182,174,40,76,226,62,125,209,6,6,34,37,147,85,204,103,51,191,36,248,17,175,20,1,53,16,35,143,237,177,125,86,29,219,235,20,121,205,59,5,250,107,109,32,224,30,152,143,113,151,95,85,19,254,164,135,124,68,136,199,29,31,244,91,10,84,127,101,210,70,226,195,140,70,166,54,217,165,84,42,165,175,100,234,124,121,105,53,101,118,174,101,220,147,68,161,37,0,182,220,142,221,155,230,115,164,10,214,208,120,91,152,66,27,81,184,48,84,70,7,128,153,217,218,249,226,70,130,200,156,61,227,21,164,137,193,221,119,10,134,204,23,20,17,90,94,105,204,39,99,1,64,153,45,213,19,247,97,194,49,35,125,255,195,139,63,209,175,208,147,189,244,204,24,211,99,142,18,92,130,254,182,231,235,93,10,127,175,87,35,62,110,137,184,39,114,200,150,11,190,40,162,168,223,203,110,242,192,234,26,11,54,155,38,48,79,109,101,119,165,187,223,5,20,168,171,241,20,243,108,199,3,155,69,244,149,0,187,110,12,233,42,151,189,139,133,104,3,30,16,200,69,4,123,103,144,12,106,182,1,127,91,125,158,12,144,238,232,209,101,159,56,163,240,179,50,169,120,219,176,87,77,45,247,153,190,82,132,50,137,209,97,19,35,247,161,62,77,16,71,152,72,61,50,99,157,154,56,58,175,27,73,121,229,195,228,132,69,233,169,100,21,123,17,3,164,6,146,106,196,29,3,250,217,164,23,171,203,14,242,239,249,169,116,138,209,98,113,181,122,35,162,216,46,230,4,155,142,118,216,232,229,28,12,158,153,126,149,171,172,231,99,211,57,114,136,183,114,74,35,233,115,127,253,157,38,49,136,141,25,161,255,232,110,101,208,166,186,226,12,185,19,155,53,93,155,39,161,7,124,213,52,223,125,211,242,253,22,13,131,115,167,198,188,90,209,63,224,92,112,118,220,165,31,164,43,58,197,77,17,247,77,164,74,77,218,18,187,41,76,189,127,98,18,226,231,71,115,236,68,183,111,50,168,88,247,9,123,65,180,88,74,44,101,101,173,11];class rL extends Aa{constructor(t,n,s){super(t,eL,n,s)}}const nL=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,165,108,122,254,125,130,229,55,109,113,11,210,238,163,213,86,116,156,248,215,63,20,48,173,31,55,133,18,105,32,16,204,35,128,38,212,87,200,97,114,40,12,210,193,171,59,33,158,108,14,75,228,74,65,32,57,192,112,156,234,250,140,189,40,20,6,230,135,52,17,200,123,68,183,44,215,187,234,2,13,169,234,94,115,60,6,107,224,118,254,88,2,235,134,36,120,5,85,94,126,222,223,101,105,227,147,199,64,185,246,143,183,210,30,37,127,226,79,156,118,147,208,131,51,248,232,217,206,181,218,58,61,112,244,227,68,45,41,206,69,12,45,163,205,75,6,23,167,145,250,237,92,84,164,240,253,216,54,85,7,108,62,255,42,217,3,27,0,196,94,28,241,120,80,92,89,135,228,125,2,3,242,39,116,64,248,216,177,122,66,178,180,9,7,33,186,208,213,188,59,78,243,95,123,28,142,45,99,130,7,167,194,156,238,199,10,71,141,251,221,158,16,255,38,181,36,184,20,136,240,55,27,51,191,82,105,55,97,78,74,121,191,161,91,126,105,103,174,139,223,145,150,120,156,240,252,182,105,104,205,65,97,129,194,68,218,91,141,11,224,124,132,138,119,36,201,211,39,203,146,225,246,252,21,161,250,188,137,190,42,4,90,126,211,171,240,113,67,28,92,57,77,200,125,224,19,178,142,112,202,5,233,229,128,235,105,239,102,52,179,224,87,45,68,211,10,187,9,38,190,86,25,43,175,56,231,11,108,220,36,129,131,19,93,163,239,169,118,205,50,77,121,139,139,141,197,170,20,44,39,19,97,205,228,8,106,67,210,135,111,127,141,185,175,123,26,226,42,29,217,16,99,9,46,157,232,22,3,105,174,73,144,23,110,55,84,46,4,116,39,113,205,58,158,242,7,208,75,162,55,115,35,52,124,235,114,178,55,43,98,17,100,33,134,237,190,230,60,184,192,104,146,52,58,79,174,180,81,155,114,0,153,113,90,51,86,150,254,136,205,104,39,11,190,187,233,80,81,81,56,18,222,148,116,155,156,33,132,226,127,84,34,83,28,249,153,18,197,10,116,102,125,45,47,36,235,46,212,166,209,3,125,132,237,124,163,68,197,202,232,152,234,75,235,103,248,160,241,213,151,144,130,37,23,51,48,55,12,227,31,163,242,251,245,22,129,77,20,35,150,20,181,203,138,69,233,215,109,178,209,52,85,96,221,179,56,249,138,111,250,141,134,95,152,92,109,183,174,104,151,156,31,66,211,10,57,141,167,18,177,27,126,74,252,29,143,121,173,203,8,27,44,123,148,57,88,163,68,228,158,62,98,121,192,228,94,92,72,241,33,230,173,0,197,1,194,144,111,91,60,0,106,181,203,51,133,120,250,158,184,93,216,184,126,253,21,22,155,99,80,205,227,69,231,141,165,71,70,252,223,105,51,93,22,165,135,233,177,164,139,53,5,85,151,134,214,165,249,100,24,186,207,245,149,68,218,204,252,32,190,90,48,76,57,31,201,15,52,130,135,152,206,63,198,100,126,36,2,104,116,0,160,163,186,2,91,165,57,149,163,12,239,121,152,209,224,136,248,135,136,46,150,32,51,154,6,105,0,71,30,44,175,147,139,34,91,184,78,31,145,18,3,250,122,166,47,252,109,19,40,10,123,163,99,76,133,119,37,180,38,207,79,171,185,188];class iL extends Aa{constructor(t,n,s){super(t,nL,n,s)}}const oL=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,160,96,121,255,120,207,227,114,120,38,72,149,145,165,227,75,122,158,250,232,46,34,52,135,9,30,144,17,110,126,110,130,71,156,46,210,67,202,51,119,97,3,211,214,227,45,109,151,97,21,10,229,53,80,26,51,202,119,128,230,197,140,135,40,14,88,128,202,95,21,208,96,83,185,98,216,242,224,15,25,224,233,86,96,46,80,120,220,48,187,86,30,240,140,46,95,81,48,90,117,140,177,51,107,235,158,137,5,241,191,154,149,219,30,126,85,175,10,216,63,139,216,151,122,251,224,202,220,227,221,53,122,34,213,224,94,45,14,200,68,31,61,175,208,17,120,82,244,138,208,165,21,19,236,232,180,217,50,74,70,126,114,227,62,192,124,9,85,148,33,77,255,117,75,102,87,151,255,87,74,74,181,111,108,9,249,220,174,59,80,254,168,29,30,94,171,133,133,195,105,64,254,68,65,18,158,54,73,203,65,175,151,170,236,138,17,119,128,237,214,189,28,250,38,149,97,242,81,212,254,57,18,120,155,64,96,108,75,78,74,121,191,243,30,42,60,103,165,196,160,195,216,99,182,173,214,182,105,53,231,3,45,212,144,101,217,65,141,44,230,125,151,154,123,57,134,223,98,133,156,238,137,181,80,175,230,167,131,180,13,69,77,44,156,165,252,14,27,85,71,1,82,196,64,243,26,167,146,98,201,6,195,247,200,224,44,177,104,109,187,231,83,118,28,159,92,179,28,14,162,81,84,21,168,34,156,21,127,215,88,218,208,11,92,161,239,239,82,221,59,86,83,201,199,216,151,139,23,54,39,52,103,204,247,24,102,94,157,138,42,49,131,183,208,50,95,236,54,6,211,26,68,72,56,212,134,24,91,114,132,1,217,80,38,47,29,47,0,107,102,99,129,33,140,243,74,251,89,247,103,12,114,58,113,240,72,188,39,48,72,89,45,102,206,245,247,231,56,167,129,122,222,47,40,78,227,159,64,206,34,127,203,127,87,40,108,152,238,147,231,46,104,89,182,180,232,86,89,91,57,10,222,202,59,199,135,60,199,189,40,84,125,28,84,162,210,91,143,34,106,117,118,3,125,126,237,60,131,173,153,69,49,212,204,117,163,31,239,202,232,152,234,3,162,32,176,184,184,196,154,131,144,115,6,53,122,55,69,166,19,230,183,175,244,1,156,11,37,121,134,121,152,142,158,125,229,150,44,183,216,109,7,65,222,169,56,222,140,110,233,157,138,66,208,6,111,166,188,76,208,222,4,104,211,10,57,141,243,65,228,86,85,88,169,91,237,56,249,133,77,21,32,37,230,55,0,184,110,228,158,62,98,45,147,177,19,119,89,164,103,132,239,84,139,68,204,157,49,41,50,89,113,159,203,51,133,120,184,210,237,15,249,187,100,253,50,16,154,112,64,193,254,10,235,200,253,84,31,169,171,39,122,70,46,186,139,212,162,173,158,41,23,86,148,172,196,237,242,58,102,180,150,238,191,25,240,204,252,125,148,29,124,51,95,10,196,55,49,159,138,144,255,126,205,43,49,42,17,59,60,77,139,177,239,64,36,224,98,205,234,70,199,103,139,218,206,207,178,217,255,32,134,59,25,221,74,22,102,82,19,20,170,142,134,42,106,249,64,80,222,28,21,169,50,235,4,237,56,81,87,76,32,251,42,6,173,105,54,191,8,136,5,245,206,239,176,9,116,24];class sL extends Aa{constructor(t,n,s){super(t,oL,n,s)}}const aL=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,190,100,112,230,97,199,225,96,74,99,94,248,222,162,213,95,122,158,212,233,42,22,37,217,115,36,152,30,123,116,104,212,109,129,41,220,77,213,97,124,45,4,219,197,171,40,18,149,104,20,4,248,102,64,9,50,217,124,131,180,188,159,170,63,1,84,130,150,117,14,212,118,67,165,97,207,242,251,15,30,187,188,77,79,122,67,101,252,109,244,82,37,191,227,35,114,87,57,71,99,218,155,54,101,239,138,197,13,226,228,176,157,158,87,98,55,251,79,150,64,138,200,135,40,132,135,207,146,252,222,57,58,111,151,225,78,59,36,210,70,29,121,160,210,31,109,67,167,194,177,236,91,108,164,229,130,211,59,66,93,18,107,226,54,210,51,8,77,217,19,73,187,33,30,59,9,135,162,49,5,11,225,111,119,11,247,218,129,115,83,205,170,21,4,69,210,133,134,245,109,15,177,9,81,81,203,105,42,158,12,255,151,165,230,205,5,92,196,251,211,187,27,214,43,186,91,233,85,192,229,15,71,38,220,20,38,101,44,78,7,60,251,186,75,103,108,53,166,220,186,208,194,120,207,230,159,248,22,32,142,124,96,157,222,60,191,65,145,6,239,125,151,147,50,58,130,207,110,131,223,231,137,238,28,182,216,167,198,191,37,67,76,1,144,232,218,79,72,28,65,101,43,216,64,253,16,173,179,123,140,27,233,245,199,230,36,181,102,114,247,162,18,34,20,212,25,171,24,28,143,80,94,40,167,34,209,61,117,130,1,198,196,7,21,252,180,255,92,128,119,9,48,156,138,136,151,143,23,44,52,3,40,197,228,31,123,67,163,140,32,54,204,187,149,80,19,255,82,120,195,12,110,65,56,212,143,22,78,44,234,72,140,29,118,103,18,36,7,122,50,37,139,47,142,243,25,208,88,237,126,50,103,127,19,183,29,169,29,1,55,23,100,32,129,239,243,160,61,178,197,117,199,45,57,26,165,135,92,218,59,0,197,54,13,96,40,141,212,221,131,103,46,22,228,191,167,73,20,86,62,11,147,217,116,205,203,110,134,249,51,6,123,23,86,231,157,8,144,83,126,115,118,35,96,36,229,36,220,228,143,71,45,223,129,48,236,5,145,202,188,208,184,70,241,104,255,188,181,146,210,206,144,53,77,101,120,38,8,245,80,230,165,160,183,83,202,79,127,57,214,126,242,150,208,40,239,148,35,163,201,97,74,70,214,181,63,240,147,33,253,149,140,77,197,82,126,189,231,7,196,212,80,14,151,24,57,144,243,81,234,66,24,19,236,2,137,121,246,129,65,7,99,110,174,54,74,182,81,234,142,37,72,110,220,255,64,119,10,188,111,191,228,1,205,9,204,143,56,62,125,84,106,225,131,97,192,43,240,157,161,75,168,247,44,175,65,81,192,48,21,157,167,80,191,130,161,75,85,186,174,42,117,1,68,252,204,138,254,203,152,21,13,64,144,195,207,238,229,54,103,247,159,245,211,85,191,141,168,32,234,85,46,118,12,5,199,4,19,217,203,202,156,33,143,114,116,60,66,40,58,77,208,237,171,26,72,175,114,205,248,87,137,62,210,143,151,197,167,210,241,122,150,104,122,154,2,70,102,83,19,36,141,136,199,42,79,229,71,86,194,109,31,236,80,166,17,230,109,1,40,28,46,224,56,20,230,47,100,254,116,208,76,169,157,241,175,3,70,85,31,38,245,58,33,80,145,237,8,22,71,224,158,156,31,249,81,87,247,230,199,237,96,167,123,63,243,79,156,206,203,160,54,124,68,253,215,132,235,57,185,92,238,55,59,210,104,71,26,183,180,71,12,255,224,192,65,154,72,244,8,164,10,248,46,207,30,92,1,80,244,31,189,138,88,216,218,63,100,227,116,57,119,94,135,5,126,255,32,191,163,61,209,194,88,248,112,139,173,43,69,134,3,160,151,137,25,98,239,166,19,123,208,180,31,120,30,191,75,183,179,126,180,125,92,107,105,206,138,28,67,139,3,188,230,184,255,121,13,181,45,160,114,202,194,123,87,55,124,97,164,82,95,232,216,117,62,5,90,176,82,167,52,160,153,174,168,105,146,91,248,81,79,249,97,138,133,170,245,229,132,61,5,149,224,246,194,213,61,12,109,44,136,235,95,219,133,220,27,93,36,93,124,180,81,141,152,220,170,163,229,197,124,171,232,48,70,251,106,119,150,20,16,49,119,247,42,132,36,76,254,124,177,66,175,9,1,39,92,127,195,171,198,34,2,64,144,179,72,40,151,110,89,229,42,125,33,238,16,220,228,51,203,8,1,68,145,253,133,118,93,163,129,22,13,248,65,12,4,63,101,210,70,170,138,203,14,246,54,194,195,27,107,241,175,35,171,49,52,106,121,45,36,152,85,215,132,78,167,34,18,167,245,152,133,134,170,120,182,10,146,191,37,2,205,47,125,20,203,44,88,81,32,150,223,220,218,238,254,30,212,167,221,115,156,82,226,137,220,221,97,3,139,202,33,9,27,26,126,40,215,25,126,9,82,208,49,217,14,161,81,196,61,60,87,254,213,194,81,216,161,151,209,166,222,230,24,128,117,140,92,4,203,254,170,253,249,88,90,112,226,18,44,122,39,158,158,56,69,204,159,5,179,51,197,233,139,216,102,226,206,248,15,78,112,214,126,67,28,40,38,98,190,178,206,67,94,245,254,160,101,176,32,157,26,132,83,252,228,87,242,32,127,160,112,210,224,133,149,115,41,30,16,200,69,89,81,77,144,12,106,182,73,54,28,53,195,28,216,179,179,136,35,141,102,234,177,240,34,186,106,145,245,3,84,48,251,157,245,11,217,111,227,138,42,67,114,211,177,37,103,16,71,152,72,117,123,36,213,202,56,124,227,84,8,45,229,149,165,214,69,244,169,55,68,62,94,104,228,74,205,123,222,17,7,172,158,227,74,206,149,67,175,171,251,185,121,151,223,63,35,229,32,49,190,209,120,137,69,213,214,19,150,187,177,28,12,158,153,126,149,171,167,234,120,129,109,32,157,180,75,66,56,233,115,127,230,157,32,34,143,156,31,230,168,174,125,118,195,249,243,165,81,246,10,144,15,103,139,55,173,7,59,136,69,172,54,132,165,140,78,77,230,33,169,129,188,71,209,109,161,8,57,57,199,143,31,164,43,58,130,1,110,145,31,229,13,46,149,94,244,106,76,238,105,107,1,183,177,10,61,225,94,185,116,58,183,95,225,22,119,19,248,28,13,123,125,108,158,64,184,77,245,153,162,217,227,208,41,185,211,235,41,153,181,54,166,165,11,154,55,21,184,209,192,249,44,164,160,29,229,159,82,156,198,241,183,114,83,137,186,151,148,31,21,197,216,145,32,13,50,22,241,137,39,71,28,142,160,215,107,221,45,202,104,227,110,186,12,150,145,240,51,49,44,196,115,224,238,149,189,134,99,67,241,62,157,240,114,247,195,26,200,141,97,147,249,23,150,174,10,13,219,81,73,58,242,96,250,243,15,49,218,58,230,104,252,175,150,123,86,185,84,90,198,6,36,0,99,72,28,166,238,115,231,171,249,179,71,174,68,156,227,17,198,79,73,142,99,144,20,80,62,80,191,142,46,71,9,243,6,8,214,116,72,190,106,161,19,185,100,9,187,64,94,86,203,174,156,245,222,95,54,30,148,19,11,50,112,96,61,237,159,173,7,154,127,175,79,48,97,89,78,126,66,171,204,158,195,27,226,205,222,157,89,251,90,125,37,212,27,97,3,141,247,175,50,121,7,187,68,196,181,202,167,189,57,84,81,222,23,27,84,130,176,98,66,240,207,18,23,28,163,163,194,45,37,129,202,170,97,189,0,81,238,0,39,199,163,35,211,206,247,65,29,116,242,67,102,235,13,136,232,230,114,146,187,7,254,142,26,121,16,237,5,160,201,114,94,178,199,95,212,241,45,112,180,188,72,86,114,189,155,149,149,163,210,112,101,12,69,225,75,202,223,28,242,90,215,156,169,224,245,135,128,92,148,217,131,208,255,25,135,117,136,5,104,185,249,161,228,214,16,105,204,9,182,135,153,220,101,244,160,207,58,182,118,185,240,57,245,123,13,112,182,106,229,220,90,29,86,215,96,147,232,2,55,131,225,137,68,245,89,141,252,97,3,129,155,216,223,98,116,45,78,85,141,161,74,215,7,150,171,225,59,78,221,152,236,14,117,100,208,158,86,13,185,124,87,157,111,40,187,182,124,173,71,173,23,199,52,155,190,134,11,23,64,25,215,39,115,231,173,77,72,114,54,252,116,178,59,221,106,241,119,254,30,226,241,204,233,113,197,96,146,0,41,67,3,231,126,12,218,202,22,171,114,249,176,134,160,19,216,31,229,118,226,62,242,126,126,42,127,130,68,218,218,81,202,106,217,191,25,177,82,97,81,36,232,137,58,90,216,190,117,235,20,194,144,76,178,27,213,13,208,18,29,118,126,49,98,203,179,128,237,100,32,242,189,212,6,210,210,188,161,205,13,124,119,13,215,112,41,183,176,215,168,210,182,111,1,115,2,239,141,8,177,124,112,48,197,2,239,11,99,4,36,77,69,47,244,19,153,61,19,2,96,176,7,112,122,131,169,25,189,116,171,49,12,121,162,79,154,74,251,50,233,182,63,180,224,118,49,253,21,20,16,31,144,184,93,174,231,244,183,13,49,225,189,211,73,185,49,110,142,25,226,45,176,233,204,74,33,16,205,88,131,92,157,170,175,68,170,61,53,116,165,16,27,182,160,181,87,241,15,151,85,107,76,167,129,25,172,127,184,138,153,222,228,125,64,44,45,32,12,227,148,106,152,83,240,166,54,235,32,190,12,242,164,123,189,53,194,141,104,43,202,110,4,168,119,245,232,179,178,198,1,224,87,86,160,31,19,140,233,102,191,204,4,98,138,163,191,106,24,213,47,208,82,137,132,131,16,253,84,25,144,90,159,148,16,196,84,166,61,160,101,229,227,93,118,59,87,66,16,128,59,96,131,250,20,184,150,205,91,227,201,62,35,79,180,172,173,85,197,106,153,238,229,60,204,65,193,230,94,101,177,134,6,165,53,171,142,208,155,2,11,4,202,127,54,17,142,117,227,121,128,204,192,147,147,92,189,5,224,148,72,18,83,101,126,124,228,153,242,123,229,247,92,221,6,73,227,250,87,167,194,129,187,73,38,185,109,217,240,193,88,50,178,180,151,54,197,187,137,190,166,233,1,103,204,88,31,127,185,29,65,1,29,254,223,14,83,167,215,114,248,30,173,89,173,187,69,5,105,117,15,106,94,173,63,227,25,230,190,136,168,177,175,107,91,126,254,34,188,25,118,48,12,226,130,153,162,57,47,181,212,79,160,97,64,157,246,90,53,43,149,76,102,15,195,107,58,242,84,172,29,81,198,113,81,251,138,182,154,111,30,171,129,56,17,45,214,153,112,117,203,174,40,38,234,236,32,4,112,225,26,187,195,246,252,9,218,69,160,223,178,54,148,81,8,134,151,75,248,63,224,240,48,75,250,221,85,46,100,50,3,70,64,102,111,160,155,233,59,147,184,57,61,6,126,79,176,16,185,94,166,33,135,78,42,75,140,208,140,44,153,187,64,103,119,160,236,16,239,74,218,219,212,207,110,53,30,76,248,40,111,98,44,20,113,204,233,109,135,96,107,39,163,203,125,45,157,152,71,239,175,174,159,147,80,111,93,38,253,228,154,225,181,101,12,241,127,65,49,189,5,85,151,237,213,143,14,104,138,54,52,27,4,132,67,35,156,86,157,73,16,229,222,245,110,79,165,179,56,179,53,218,229,100,58,87,149,48,231,64,63,115,67,3,172,6,186,115,154,60,53,214,152,149,89,234,37,143,82,255,64,28,183,93,112,39,70,185,57,0,199,9,61,175,219,41,76,37,176,82,125,65,53,160,214,105,62,153,244,222,96,205,6,178,85,41,240,113,0,96,149,38,3,195,18,152,41,246,3,103,29,110,134,30,101,75,46,103,199,184,20,230,8,55,120,4,229,168,35,43,7,28,161,143,87,27,87,79,255,186,44,195,158,155,181,119,81,172,217,107,95,98,55,243,186,66,105,48,224,123,232,84,156,20,10,156,208,204,52,34,228,136,97,242,200,246,211,67,202,40,241,91,92,253,9,54,72,131,221,106,178,32,44,182,4,225,193,37,20,249,249,231,10,206,18,71,254,221,187,172,88,204,6,127,138,102,7,208,75,147,219,199,177,79,36,170,101,207,177,109,95,143,217,41,199,80,183,201,2,254,12,55,23,198,14,255,69,245,138,155,129,227,167,168,130,156,135,14,96,93,48,99,143,107,126,92,117,143,112,108,193,228,84,13,41,186,27,172,92,201,149,116,19,112,197,116,209,128,102,1,55,152,177,28,37,34,50,83,41,199,74,178,59,111,67,118,35,252,36,33,87,28,170,17,215,47,90,154,124,137,15,14,211,59,75,59,30,77,0,49,37,225,191,87,101,127,214,227,160,99,174,234,82,148,235,16,241,219,147,170,127,221,250,116,39,218,156,72,227,172,55,0,79,188,76,51,222,232,24,36,62,94,154,3,61,230,146,114,253,0,128,58,253,90,72,211,242,38,39,133,153,161,119,105,195,152,225,208,105,140,80,217,186,196,157,21,116,230,116,139,25,159,143,118,128,77,201,238,247,228,15,168,4,133,148,21,148,12,44,241,7,115,17,129,176,202,46,130,122,129,235,141,223,85,21,199,65,181,169,52,174,161,153,62,25,164,115,213,89,138,199,103,79,200,165,135,249,244,27,209,178,240,129,211,61,9,111,157,147,119,36,119,255,110,130,84,49,210,225,247,100,26,121,127,163,160,26,79,99,24,77,65,32,178,109,36,27,253,173,110,183,11,14,211,57,130,254,124,104,165,219,31,70,97,14,194,39,61,26,141,125,228,126,194,184,101,160,204,106,128,144,106,103,171,18,246,129,220,85,172,151,123,5,73,155,192,175,91,157,239,61,237,116,170,65,233,56,19,49,114,168,190,3,214,53,250,90,213,244,88,101,30,229,248,124,15,71,141,27,172,235,21,129,211,72,61,172,112,170,128,135,96,196,221,255,27,176,105,188,183,121,33,37,149,53,131,226,233,29,167,234,218,109,53,185,152,36,248,53,61,235,78,21,201,214,210,163,12,251,187,45,188,137,126,127,237,92,234,91,240,225,38,194,57,213,251,237,171,30,99,52,14,49,84,101,252,237,7,166,122,114,32,107,32,207,239,136,168,178,12,11,241,233,230,146,132,18,83,233,41,172,17,6,161,42,113,87,40,255,185,1,146,128,5,240,126,131,71,42,54,124,205,2,122,71,30,222,229,40,134,142,102,97,239,151,177,1,230,231,49,123,219,28,129,91,152,112,13,154,81,197,226,255,112,158,178,177,55,181,108,138,185,245,29,186,21,73,188,209,154,200,89,116,235,198,144,36,87,248,22,7,200,122,7,148,44,42,87,140,238,204,95,231,252,0,136,0,22,39,70,123,125,165,113,227,172,146,163,128,158,36,52,91,19,36,245,27,150,138,141,11,67,239,224,65,24,116,101,7,39,46,142,172,164,243,148,0,33,226,59,47,203,137,156,241,66,250,157,30,204,101,143,134,98,238,155,226,25,184,136,219,89,100,193,11,143,71,139,243,230,151,0,249,1,78,26,32,93,104,157,67,97,164,248,86,124,146,93,74,222,228,167,55,53,100,135,216,109,13,64,37,106,177,200,200,182,92,251,69,31,243,89,80,198,14,132,203,72,103,28,104,217,24,97,223,113,11,29,178,191,210,46,162,255,68,99,8,237,213,162,152,193,183,121,203,19,108,182,29,86,26,192,103,220,103,205,154,179,197,9,22,73,127,175,146,38,119,210,0,24,180,21,245,215,204,91,186,119,138,183,239,15,155,231,248,133,39,24,101,144,236,10,230,54,174,227,73,21,110,10,160,241,232,131,14,212,127,232,59,122,65,146,54,163,9,189,190,121,88,170,62,194,14,204,152,245,38,131,37,91,81,72,114,29,115,239,182,56,44,156,159,177,180,82,160,93,97,86,183,236,50,95,85,39,71,181,225,152,143,63,123,117,34,44,109,160,166,229,240,91,138,102,54,180,173,44,50,80,42,124,7,50,124,211,239,21,94,197,185,239,213,107,142,64,95,124,125,17,180,97,189,101,52,48,19,112,12,70,9,212,177,54,118,66,84,147,236,248,26,124,95,103,135,254,124,49,112,186,99,120,90,8,194,191,88,57,242,65,61,10,104,246,197,252,19,159,58,194,75,173,242,103,8,115,84,69,238,149,26,15,159,182,141,132,119,70,29,53,20,143,46,163,204,6,236,59,45,185,172,89,119,83,38,144,36,222,96,151,26,99,195,163,170,133,92,159,214,53,150,116,90,176,69,145,130,15,172,140,217,215,101,163,115,161,65,101,8,7,183,113,213,134,58,175,130,251,143,173,248,168,135,60,159,30,194,68,208,119,120,2,40,178,227,247,161,77,47,136,46,244,163,72,65,158,25,225,195,61,132,182,204,177,186,200,81,2,65,105,212,72,94,203,232,217,182,123,251,228,160,1,161,204,123,20,37,1,77,208,179,45,149,181,122,102,190,123,213,164,231,41,216,130,234,248,208,251,252,220,84,209,67,47,61,220,5,142,162,26,236,121,142,248,132,255,65,122,203,196,102,191,187,2,195,127,255,193,92,49,91,186,154,39,156,29,211,172,49,104,245,114,153,223,211,199,249,35,130,160,128,0,152,176,183,20,236,113,193,108,26,255,11,237,102,133,245,94,115,114,10,89,229,214,221,99,149,30,99,37,246,10,26,26,39,92,123,170,73,211,127,227,54,30,86,133,159,112,225,91,148,100,174,149,75,143,14,140,20,44,64,212,5,243,8,116,63,30,97,42,123,20,73,212,85,207,83,122,27,251,233,84,10,17,236,232,83,200,127,119,143,163,204,220,167,59,231,20,106,186,222,191,8,40,234,21,25,180,13,116,250,152,224,174,75,3,205,38,173,215,236,151,185,121,254,244,154,239,17,53,106,164,61,49,116,216,118,94,150,35,181,26,238,66,49,211,221,132,146,166,115,39,136,36,205,230,179,31,197,51,148,165,109,38,70,37,148,52,44,209,250,98,58,246,225,103,198,101,26,25,196,207,8,166,21,88,252,175,253,10,88,107,157,19,225,61,12,246,221,37,239,186,167,137,142,135,222,128,174,62,95,216,38,141,157,45,232,97,217,173,203,234,116,129,69,206,189,94,221,12,54,139,186,247,184,16,200,121,244,104,8,7,35,111,47,188,10,140,92,73,143,206,203,72,122,184,20,102,197,130,64,150,63,96,239,8,132,111,217,84,91,198,32,43,100,138,241,15,160,42,190,253,193,184,164,124,29,210,96,67,224,221,182,29,218,129,149,29,128,174,98,88,88,125,56,40,255,120,5,0,87,174,42,150,90,112,201,183,169,19,57,195,191,12,58,244,235,132,25,145,72,146,214,8,125,100,135,12,5,102,97,248,174,24,159,90,33,43,187,6,61,212,241,225,190,219,252,197,123,129,164,108,123,55,230,4,153,166,105,234,15,85,216,23,56,32,3,41,110,68,146,172,133,202,98,41,7,47,152,35,255,168,106,241,226,222,77,244,52,185,65,252,227,32,66,38,11,172,60,28,28,103,84,1,1,205,182,190,28,189,102,253,43,1,191,148,116,10,227,18,81,93,80,239,157,232,215,180,163,165,161,109,177,71,150,244,144,208,160,110,22,174,60,206,43,103,121,55,103,114,115,173,238,13,10,227,251,41,176,216,158,229,216,55,234,128,128,20,167,106,181,86,163,130,215,110,149,191,10,227,215,8,214,154,178,181,15,19,0,247,250,97,74,43,157,55,94,174,41,41,9,199,97,20,91,32,18,10,43,98,240,247,203,20,250,117,160,44,229,202,187,64,54,124,15,184,169,129,27,160,240,26,61,255,60,166,60,144,209,84,55,187,186,168,13,124,125,29,17,100,249,227,62,205,78,179,163,168,139,168,21,38,83,239,151,74,43,66,2,92,72,71,94,216,134,238,20,45,158,213,164,73,57,80,47,198,184,130,223,227,71,132,133,235,177,85,174,142,124,172,200,54,229,40,126,60,76,92,216,153,56,241,174,66,141,90,226,3,30,68,234,71,187,163,112,146,255,22,143,170,204,3,127,179,81,139,160,37,77,246,128,220,196,158,153,73,177,65,199,119,29,197,144,130,248,206,155,253,108,213,124,7,223,221,162,146,134,242,65,99,162,107,120,247,214,207,96,150,169,131,208,218,221,28,24,112,208,23,1,130,142,232,56,104,45,33,158,95,255,123,31,74,76,120,178,155,213,6,195,164,8,8,69,241,197,127,83,169,21,167,19,94,143,252,33,159,248,241,170,153,147,1,149,199,201,131,170,79,236,212,209,143,107,98,24,123,56,33,193,85,247,64,225,135,210,78,145,57,16,145,71,170,20,133,87,235,4,166,239,100,82,235,81,50,223,9,193,52,49,86,129,190,196,82,165,107,63,115,161,98,33,20,193,29,42,151,205,252,124,72,245,48,181,67,7,13,21,127,59,226,188,144,129,112,244,192,121,213,80,42,196,1,13,107,108,78,0,40,121,225,148,237,234,209,216,238,9,147,226,254,96,89,212,72,193,106,75,135,74,227,67,255,92,191,81,188,124,226,149,152,142,15,159,195,238,114,55,255,166,157,230,59,148,170,166,151,65,213,104,253,253,112,150,82,147,137,27,214,100,247,65,81,92,47,86,217,7,45,120,81,130,31,236,243,76,78,3,45,105,172,220,71,48,220,94,196,249,163,193,133,50,236,205,20,55,2,63,14,127,69,113,212,204,12,58,79,89,86,29,61,199,201,64,149,6,144,182,150,129,31,18,167,120,248,82,107,25,143,128,27,161,28,25,153,183,217,238,78,186,106,92,27,202,219,165,96,0,216,234,169,73,101,39,182,113,217,240,170,116,172,221,250,233,48,49,242,83,227,92,181,184,72,230,180,21,15,108,135,25,38,153,25,124,227,26,149,73,236,39,211,244,149,58,183,132,26,223,219,174,144,117,233,219,165,205,157,159,222,184,52,47,241,201,123,65,24,44,55,215,177,168,250,179,115,190,227,123,158,163,179,224,69,196,66,207,254,243,101,221,193,140,250,4,28,222,52,96,138,160,33,218,64,118,214,234,201,152,148,91,178,111,107,144,142,6,182,102,72,188,34,213,181,26,223,58,255,103,81,17,47,169,11,245,224,123,148,215,237,186,107,75,152,90,202,166,22,149,197,5,246,238,78,76,229,106,199,94,127,195,0,45,82,6,159,103,96,138,231,71,46,107,59,216,39,43,12,221,27,214,56,155,145,66,187,169,250,235,78,211,179,239,183,198,163,93,5,196,24,174,143,225,106,139,89,98,13,127,207,184,194,30,1,165,198,169,8,197,118,86,163,221,138,23,209,61,116,79,99,233,43,130,60,244,85,229,243,172,123,148,200,120,192,127,211,52,11,159,41,95,212,230,188,169,156,137,29,212,12,148,168,148,133,243,44,241,139,127,24,246,220,227,125,209,97,60,52,162,192,146,49,161,92,138,112,189,128,59,126,125,46,207,60,79,231,174,152,209,68,223,205,2,38,14,91,116,159,255,28,27,178,248,164,104,158,79,69,214,234,157,12,75,163,83,253,245,202,61,213,176,6,197,230,29,208,166,253,194,254,235,29,141,241,70,249,15,62,0,148,163,135,52,122,40,96,87,31,179,152,51,216,133,184,122,198,203,60,115,218,191,193,16,178,25,148,252,112,104,103,252,36,92,221,28,179,43,199,198,151,128,100,252,217,161,249,34,201,172,118,52,180,252,104,7,223,44,116,102,212,21,40,224,184,55,163,210,21,207,161,239,51,54,155,41,133,18,67,48,3,165,130,251,4,79,214,57,72,130,157,212,144],cL=[0,1,3,4,6,7,9,10,12,13,15,16,18,19,21,22,24,26,29,31,34,36,39,41,44,46,49,51,54,56,59,61,64,65,66,67,68,69,70,72,73,74,75,76,77,79,80,81,82,83,84,85,87,88,89,90,91,92,94,95,96,97,98,99,101,102,103,104,105,106,107,109,110,111,112,113,114,116,117,118,119,120,121,123,124,125,126,127,128,129,131,132,133,134,135,136,138,139,140,141,142,143,145,146,147,148,149,150,151,153,154,155,156,157,158,160,161,162,163,164,165,166,168,169,170,171,172,173,175,176,177,178,179,180,182,183,184,185,186,187,188,190,191,192,193,194,195,197,198,199,200,201,202,204,205,206,207,208,209,210,212,213,214,215,216,217,219,220,221,222,223,224,226,226,226,227,227,227,228,228,228,229,229,229,230,230,231,231,231,232,232,232,233,233,233,234,234,235,235,235,236,236,236,237,237,237,238,238,239,239,239,240,240,240,241,241,241,242,242,243,243,243,244,244,244,245,245,245,246,246,246,247,247,247,248,248,248,249,249,249,250,250,250,251,251,251,252,252,252,253,253,253,254,254,254,255],jy=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,32,33,35,36,37,39,40,42,43,44,46,47,49,50,51,53,54,56,57,58,59,61,62,63,64,66,67,68,69,71,72,73,74,76,77,78,79,81,82,83,84,86,87,88,90,91,92,93,95,96,97,98,100,101,102,103,105,106,107,108,110,111,112,113,115,116,117,118,120,121,122,124,125,126,127,129,130,131,132,134,135,136,137,139,140,141,142,144,145,146,147,149,150,151,152,154,155,156,158,159,160,161,163,164,165,166,168,169,170,171,173,174,175,176,178,179,180,181,183,184,185,186,188,189,190,192,193,194,195,197,198,199,200,202,203,204,205,207,208,209,210,212,213,214,215,217,218,219,220,222,223,224,226,226,226,227,227,228,228,229,229,230,230,231,231,232,232,233,233,234,234,234,235,235,236,236,237,237,238,238,239,239,240,240,241,241,242,242,243,243,243,244,244,244,245,245,245,246,246,246,247,247,247,248,248,248,249,249,249,250,250,250,251,251,251,252,252,252,253,253,253,254,254,254,255],lL=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,35,36,37,38,39,40,41,43,44,45,46,47,48,50,51,52,53,54,55,56,58,59,60,61,62,63,65,66,67,68,69,70,72,73,74,76,77,78,80,81,83,84,85,87,88,89,91,92,94,95,96,98,99,100,102,103,105,106,107,109,110,111,113,114,116,117,118,120,121,122,124,125,127,128,129,131,132,133,135,136,138,139,140,142,143,144,146,147,149,150,151,153,154,155,157,158,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,192,193,193,194,195,195,196,197,197,198,199,199,200,201,201,202,203,203,204,205,205,206,207,207,208,209,209,210,211,211,212,213,213,214,215,215,216,217,217,218,219,219,220,221,221,222,223,223,224,225,225,226,227,227,228,229,229,230,231,231,232,233,233,234,235,235,236,237,237,238,239,239,240,241,241,242,243,243,244,245,245,246,247,247,248,249,249,250,251,251,252,253,253,254,255];class dL extends Aa{constructor(t,n,s,c){super(t,aL,s,c),this.lightLevel=.1,this.rednessLevel=.5,this.mskin_he_max=175/180*3.141593,this.mskin_he_min=115/180*3.141593,this.mskin_hc_max=173/180*3.141593,this.mskin_hc_min=116/180*3.141593,this.mskin_hc_axis=2.04203545,this.mfacts_rotate_c=0,this.mfacts_rotate_le=0,this.mfacts_rotate_ge=0,this.tab_addr=null,this.lutTextures=[],this.inputTexture=n,this.init()}setUniforms(){const t=this.gl.getUniformLocation(this.program,"u_flipY"),n=this.gl.getUniformLocation(this.program,"u_denoiseLevel");this.gl.uniform1f(n,this.denoiseLevel),this.gl.uniform1f(t,1);const s=this.gl.getUniformLocation(this.program,"light");this.gl.uniform1f(s,this.lightLevel);const c=this.gl.getUniformLocation(this.program,"redness");this.gl.uniform1f(c,this.rednessLevel);const d=this.gl.getUniformLocation(this.program,"skin_he_max"),h=this.gl.getUniformLocation(this.program,"skin_he_min"),p=this.gl.getUniformLocation(this.program,"skin_hc_max"),A=this.gl.getUniformLocation(this.program,"skin_hc_min"),m=this.gl.getUniformLocation(this.program,"skin_hc_axis"),E=this.gl.getUniformLocation(this.program,"facts_rotate_c"),v=this.gl.getUniformLocation(this.program,"facts_rotate_le"),C=this.gl.getUniformLocation(this.program,"facts_rotate_ge");this.gl.uniform1f(d,this.mskin_he_max),this.gl.uniform1f(h,this.mskin_he_min),this.gl.uniform1f(p,this.mskin_hc_max),this.gl.uniform1f(A,this.mskin_hc_min),this.gl.uniform1f(m,this.mskin_hc_axis),this.gl.uniform1f(E,this.mfacts_rotate_c),this.gl.uniform1f(v,this.mfacts_rotate_le),this.gl.uniform1f(C,this.mfacts_rotate_ge);const b=this.gl.getUniformLocation(this.program,"u_originImage");this.gl.activeTexture(this.gl.TEXTURE2),this.gl.bindTexture(this.gl.TEXTURE_2D,this.inputTexture),this.gl.uniform1i(b,2);const y=["lighten_lut"],w=[this.gl.TEXTURE3];for(let k=0;k<y.length;k++){const P=this.gl.getUniformLocation(this.program,y[k]);this.gl.activeTexture(w[k]),this.gl.bindTexture(this.gl.TEXTURE_2D,this.lutTextures[k]),this.gl.uniform1i(P,k+3)}}setParameters(t){t.denoiseLevel!==void 0&&(this.denoiseLevel=t.denoiseLevel),t.lightLevel!==void 0&&(this.lightLevel=t.lightLevel),t.rednessLevel!==void 0&&(this.rednessLevel=t.rednessLevel,this.updateRedness(this.rednessLevel)),t.lighteningContrastLevel&&this.updateLut(t.lighteningContrastLevel)}init(){this.tab_addr=new Uint8Array(jy);const t=[this.tab_addr],n=[256],s=[1];for(let c=0;c<t.length;c++){const d=this.gl.createTexture();if(!d)throw new M(L.WEBGL_INTERNAL_ERROR,"create lut texture failed");this.gl.bindTexture(this.gl.TEXTURE_2D,d),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.LUMINANCE,n[c],s[c],0,this.gl.LUMINANCE,this.gl.UNSIGNED_BYTE,t[c]),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.lutTextures.push(d)}}updateRedness(t){const n=3.141593;let s,c,d=t,h=d;d>1&&(d=1),d<0&&(d=0),h>1&&(h=1),h<0&&(h=0),this.mfacts_rotate_c=.8*d,h<.8&&(h=0),this.mskin_he_max=175/180*n,this.mskin_hc_max=173/180*n,this.mskin_he_min=(115-4*h)/180*n,this.mskin_hc_min=(116-4*h)/180*n,this.mskin_hc_axis=(117-4*h)/180*n,this.mskin_hc_axis<this.mskin_hc_min&&(this.mskin_hc_axis=this.mskin_hc_min),this.mskin_hc_min<n/2&&(this.mskin_hc_min=n/2),this.mskin_hc_axis<n/2&&(this.mskin_hc_axis=n/2),this.mskin_he_min<n/2&&(this.mskin_he_min=n/2),this.mskin_hc_max>n&&(this.mskin_hc_max=n),this.mskin_hc_axis>n&&(this.mskin_hc_axis=n),this.mskin_he_max>n&&(this.mskin_he_max=n),s=this.mskin_he_max-this.mskin_hc_max,c=this.mskin_hc_max-this.mskin_hc_axis,this.mfacts_rotate_ge=s>.01?this.mfacts_rotate_c*c/s:this.mfacts_rotate_c,s=this.mskin_hc_min-this.mskin_he_min,c=this.mskin_hc_axis-this.mskin_hc_min,this.mfacts_rotate_le=s>.01?this.mfacts_rotate_c*c/s:this.mfacts_rotate_c}updateLut(t){let n=null;if(t===0&&(n=jy),t===1&&(n=lL),t===2&&(n=cL),!n)throw new M(L.WEBGL_INTERNAL_ERROR,"invalid ylut_table value:"+t);this.tab_addr=new Uint8Array(n);const s=[this.tab_addr],c=[256],d=[1];for(let h=0;h<s.length;h++)this.gl.bindTexture(this.gl.TEXTURE_2D,this.lutTextures[h]),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.LUMINANCE,c[h],d[h],0,this.gl.LUMINANCE,this.gl.UNSIGNED_BYTE,s[h])}}class uL{constructor(){this.gl=null,this.canvas=null,this.programs=[],this.commonProgram=null,this.inputTexture=null,this.outputTextures=[],this.fbos=[],this.originalFrameWidth=0,this.originalFrameHeight=0,this.enableBeauty=!1,this.denoiseLevel=5,this.lightLevel=.35,this.rednessLevel=.5,this.lighteningContrastLevel=1}setEnableBeauty(t){this.enableBeauty=!!t}init(t,n,s){if(!Dr().supportWebGL)throw new M(L.NOT_SUPPORTED,"your browser is not support webGL");if(this.gl=s.getContext("webgl"),!this.gl)throw new M(L.WEBGL_INTERNAL_ERROR,"can not get webgl context");if(this.initGL(t,n),!this.inputTexture)throw new M(L.WEBGL_INTERNAL_ERROR,"can not find input texture");this.canvas=s,this.programs.push(new Gy(this.gl)),this.programs.push(new rL(this.gl,t,n)),this.programs.push(new iL(this.gl,t,n)),this.programs.push(new sL(this.gl,t,n)),this.programs.push(new dL(this.gl,this.inputTexture,t,n)),this.commonProgram=this.programs[0].program,this.setDenoiseLevel(this.denoiseLevel),this.setLightLevel(this.lightLevel),this.setRednessLevel(this.rednessLevel),this.setContrastLevel(this.lighteningContrastLevel)}render(t){if(!this.gl||!this.commonProgram||!this.canvas)return void S.warning("video effect manager is not init!");let n=0;if(this.originalFrameHeight===t.videoWidth&&this.originalFrameWidth===t.videoHeight)n=2;else if(this.originalFrameHeight!==t.videoHeight||this.originalFrameWidth!==t.videoWidth){var s,c,d;if(S.debug(O(s=O(c=O(d="beauty effect: resolution changed ".concat(this.originalFrameWidth,"x")).call(d,this.originalFrameHeight," -> ")).call(c,t.videoWidth,"x")).call(s,t.videoHeight)),t.videoHeight===0||t.videoWidth===0)return void S.debug("beauty effect: skip 0 resolution frame");this.canvas.width=t.videoWidth,this.canvas.height=t.videoHeight,t.setAttribute("width",t.videoWidth.toString()),t.setAttribute("height",t.videoHeight.toString()),this.release(),this.init(t.videoWidth,t.videoHeight,this.canvas)}this.gl.viewport(0,0,t.videoWidth,t.videoHeight),this.gl.bindTexture(this.gl.TEXTURE_2D,this.inputTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,t);const h=this.enableBeauty?this.programs.length-1:0;for(let A=0;A<=h;A++){const m=this.programs[A].program;this.gl.useProgram(m);const E=this.gl.getUniformLocation(m,"u_image");this.programs[A].setUniforms(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.fbos[n+A%2]),this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.drawArrays(this.gl.TRIANGLES,0,6),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.outputTextures[n+A%2]),this.gl.uniform1i(E,0)}this.gl.useProgram(this.commonProgram);const p=this.gl.getUniformLocation(this.commonProgram,"u_flipY");this.gl.uniform1f(p,-1),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.drawArrays(this.gl.TRIANGLES,0,6)}setDenoiseLevel(t){var n;G(n=this.programs).call(n,s=>{s instanceof Aa&&s.setParameters({denoiseLevel:t})}),this.denoiseLevel=t}setLightLevel(t){var n;G(n=this.programs).call(n,s=>{s instanceof Aa&&s.setParameters({lightLevel:t})}),this.lightLevel=t}setRednessLevel(t){var n;G(n=this.programs).call(n,s=>{s instanceof Aa&&s.setParameters({rednessLevel:t})}),this.rednessLevel=t}setContrastLevel(t){var n;G(n=this.programs).call(n,s=>{s instanceof Aa&&s.setParameters({lighteningContrastLevel:t})}),this.lighteningContrastLevel=t}setSize(t,n){var s;G(s=this.programs).call(s,c=>{c instanceof Aa&&c.setSize(t,n)})}release(){this.gl=null,this.commonProgram=null,this.inputTexture=null,this.programs=[],this.outputTextures=[],this.fbos=[]}initGL(t,n){if(!this.gl)throw new M(L.WEBGL_INTERNAL_ERROR,"can not find webgl context");this.inputTexture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.inputTexture),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR);for(let s=0;s<4;s++){const c=this.gl.createTexture();if(!c)throw new M(L.WEBGL_INTERNAL_ERROR,"create texture failed");this.gl.bindTexture(this.gl.TEXTURE_2D,c),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),s<2?this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,t,n,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null):this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,n,t,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null);const d=this.gl.createFramebuffer();if(!d)throw new M(L.WEBGL_INTERNAL_ERROR,"create frame buffer failed");this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,d),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,c,0),this.outputTextures.push(c),this.fbos.push(d)}this.gl.viewport(0,0,t,n),this.originalFrameWidth=t,this.originalFrameHeight=n}}class hL{constructor(){this.targetFrameRate=0,this.recordedFrameCount=0,this.recordingTime=2}async startRecordBeautyEffectOutput(t,n=4){if(this.recordID)throw new M(L.UNEXPECTED_ERROR,"another beauty effect recording is in progress");const s=Le(6,"");return this.recordID=s,this.targetFrameRate=t,this.recordedFrameCount=0,this.recordingTime=n,await Ur(1e3*this.recordingTime),this.recordID!==s?(this.recordID=void 0,!0):(this.recordID=void 0,this.recordedFrameCount<this.targetFrameRate*this.recordingTime/2?(S.warning("detect beauty effect overload, current framerate",this.recordedFrameCount/2),!1):(S.debug("beauty effect current framerate",this.recordedFrameCount/2),!0))}stopRecordBeautyEffectOutput(){this.targetFrameRate=0,this.recordedFrameCount=0,this.recordID=void 0}addFrame(){this.recordID&&(this.recordedFrameCount+=1)}}class Wy extends class{get output(){return this._output}async setInput(t){if(t!==this.input){if(t.kind!==this.kind)throw new M(L.UNEXPECTED_ERROR);this.input&&this.removeInput(),this.input=t,await this._setInput(t)}}removeInput(){this.input=void 0,this._removeInput()}async updateOutput(t){this.output!==t&&(this._output=t,this.onOutputChange&&await this.onOutputChange())}replaceOriginMediaStream(t,n){var s,c;const d=_t(s=t.getTracks()).call(s,p=>p.kind===this.kind);d&&t.removeTrack(d);const h=_t(c=n.getTracks()).call(c,p=>p.kind===this.kind);this.output===void 0&&h&&t.addTrack(h),this.output&&(S.debug("replace ".concat(this.output.kind," track to origin media stream")),t.addTrack(this.output))}}{constructor(){super(),this.kind="video",this.fps=15,this.overloadDetector=new hL,this.enabled=!1,this.stopChromeBackgroundLoop=null,this.lastRenderTime=0,this.fps=30,this.manager=new uL}async setBeautyEffectOptions(t,n){if(function(s){s.smoothnessLevel!==void 0&&Ie(s.smoothnessLevel,"options.smoothnessLevel",0,1,!1),s.lighteningLevel!==void 0&&Ie(s.lighteningLevel,"options.lighteningLevel",0,1,!1),s.rednessLevel!==void 0&&Ie(s.rednessLevel,"options.rednessLevel",0,1,!1),s.lighteningContrastLevel!==void 0&&Pr(s.lighteningContrastLevel,"options.lighteningContrastLevel",[0,1,2])}(n),n.smoothnessLevel!==void 0){const s=Math.max(.1,10*n.smoothnessLevel);this.manager.setDenoiseLevel(s)}if(n.lighteningLevel!==void 0){const s=Math.max(.1,n.lighteningLevel/2);this.manager.setLightLevel(s)}if(n.rednessLevel!==void 0){const s=Math.max(.01,n.rednessLevel);this.manager.setRednessLevel(s)}if(n.lighteningContrastLevel!==void 0){const s=n.lighteningContrastLevel;this.manager.setContrastLevel(s)}this.enabled!==t&&(this.manager.setEnableBeauty(t),this.enabled=t,t?this.input&&await this.startEffect():await this.stopEffect())}destroy(){this.onOutputChange=void 0,this.stopEffect(),this.enabled=!1}async startEffect(){const t=we();if(!this.input)return void S.warning("video track is null, fail to start video effect!");if(this.input&&this.output&&this.input!==this.output)return void S.warning("video effect is already enabled");const n=await this.renderWithWebGL();await this.updateOutput(n),S.info("start video effect, output:",this.output),this.overloadDetector.startRecordBeautyEffectOutput(this.fps).then(c=>{c||this.onOverload&&this.onOverload()});const s=()=>{this.enabled&&requestAnimationFrame(s);const c=pt(),d=1e3/this.fps,h=this.lastRenderTime?c-this.lastRenderTime:d;h<d||(this.lastRenderTime=c-(h-d),this.video&&this.video.paused&&this.video.play(),this.enabled&&this.video&&(this.manager.render(this.video),this.output&&this.output.requestFrame&&this.output.requestFrame(),this.overloadDetector.addFrame()))};requestAnimationFrame(s),t.name===Re.CHROME&&document.addEventListener("visibilitychange",()=>{document.hidden?this.stopChromeBackgroundLoop=Jh(()=>{this.enabled&&this.video&&this.manager.render(this.video),this.output&&this.output.requestFrame&&this.output.requestFrame(),this.overloadDetector.addFrame()},this.fps):this.stopChromeBackgroundLoop&&(this.stopChromeBackgroundLoop(),this.stopChromeBackgroundLoop=null)},!1)}async stopEffect(){S.info("stop video effect"),this.overloadDetector.stopRecordBeautyEffectOutput(),this.manager.release(),this.canvas&&this.canvas.remove(),this.video&&this.video.remove(),this.canvas=void 0,this.video=void 0,await this.updateOutput(this.input)}async _setInput(t){this.enabled&&!this.video&&await this.startEffect()}_removeInput(){this.stopEffect()}async renderWithWebGL(){var t;if(!this.input)throw new M(L.BEAUTY_PROCESSOR_INTERNAL_ERROR,"can not renderWithWebGL, no input");this.canvas&&(this.canvas.remove(),this.canvas=void 0),this.video&&(this.video.remove(),this.video=void 0),this.canvas=document.createElement("canvas"),this.video=document.createElement("video"),this.video.setAttribute("autoplay",""),this.video.setAttribute("muted",""),this.video.muted=!0,this.video.setAttribute("playsinline",""),this.video.setAttribute("style","display:none"),this.video.srcObject=new MediaStream([this.input]);const n=new dt(p=>{const A=()=>{this.video&&this.video.removeEventListener("playing",A),p(void 0)};this.video&&this.video.addEventListener("playing",A)});this.video.play(),await n;const s=this.input.getSettings(),c=s.width||this.video.videoWidth,d=s.height||this.video.videoHeight;if(s.frameRate&&this.fps!==s.frameRate&&(this.fps=s.frameRate,S.debug("beauty video processor: set fps to",this.fps)),S.debug(O(t="beauty video processor: width ".concat(c," height ")).call(t,d)),!c||!d)throw new M(L.BEAUTY_PROCESSOR_INTERNAL_ERROR,"can not get track resolution");this.canvas.width=c,this.canvas.height=d,this.video.setAttribute("width",c.toString()),this.video.setAttribute("height",d.toString()),this.manager.init(c,d,this.canvas);const h=Dr();return this.canvas.captureStream(h.supportRequestFrame?0:this.fps).getVideoTracks()[0]}}function wl(r){const t={};if(r.facingMode&&(t.facingMode=r.facingMode),r.cameraId&&(t.deviceId={exact:r.cameraId}),!r.encoderConfig)return t;const n=cs(r.encoderConfig);return t.width=n.width,t.height=n.height,!XI()&&n.frameRate&&(t.frameRate=n.frameRate),we().name===Re.EDGE&&typeof t.frameRate=="object"&&(t.frameRate.max=60),Gr()&&(t.frameRate={ideal:30,max:30}),t}function Ky(r){const t={};r.screenSourceType&&(t.mediaSource=r.screenSourceType),r.extensionId&&kd()&&(t.extensionId=r.extensionId),r.electronScreenSourceId&&(t.sourceId=r.electronScreenSourceId);const n=r.encoderConfig?Md(r.encoderConfig):null;return t.mandatory={chromeMediaSource:"desktop",maxWidth:n?n.width:void 0,maxHeight:n?n.height:void 0},n&&n.frameRate&&(typeof n.frameRate=="number"?(t.mandatory.maxFrameRate=n.frameRate,t.mandatory.minFrameRate=n.frameRate):(t.mandatory.maxFrameRate=n.frameRate.max||n.frameRate.ideal||n.frameRate.exact||void 0,t.mandatory.minFrameRate=n.frameRate.min||n.frameRate.ideal||n.frameRate.exact||void 0),t.frameRate=n.frameRate),n&&n.width&&(t.width=n.width),n&&n.height&&(t.height=n.height),t}function Ip(r){const t={};if(XI()||(r.AGC!==void 0&&(t.autoGainControl=r.AGC,kd()&&(t.googAutoGainControl=r.AGC,t.googAutoGainControl2=r.AGC)),r.AEC!==void 0&&(t.echoCancellation=r.AEC),r.ANS!==void 0&&(t.noiseSuppression=r.ANS,kd()&&(t.googNoiseSuppression=r.ANS))),r.encoderConfig){const n=fc(r.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return r.microphoneId&&(t.deviceId={exact:r.microphoneId}),kd()&&t.channelCount===2&&(t.googAutoGainControl=!1,t.googAutoGainControl2=!1,t.echoCancellation=!1,t.googNoiseSuppression=!1),we().os===Mn.ANDROID&&(t.sampleRate=void 0),t}var bl,Cp;(function(r){r.COVERED="COVERED",r.POSITION="POSITION",r.SIZE="SIZE",r.STYLE="STYLE"})(bl||(bl={})),function(r){r.UNMOUNTED="UNMOUNTED",r.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT"}(Cp||(Cp={}));var Vg=new class{constructor(){this._clientSize=null,this.getClientWidth=()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth,this.getClientHeight=()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight,this.getStyle=r=>window.getComputedStyle(r,null),this.checkCssVisibleProperty=r=>{var t;let n=!0;const s=this.getStyle(r),{display:c,visibility:d,opacity:h,filter:p}=s;if((c==="none"||zt(t=["hidden","collapse"]).call(t,d)||Number(h)<.1)&&(n=!1),!n)return!1;if(p){var A;const m=kt(A=p.split(" ")).call(A,v=>{var C;const b=v.split("(")[0];return zt(C=["brightness","blur","opacity"]).call(C,b)}),E=ft(m).call(m,v=>{const[C,b]=v.split(/\(|\)/);return[C,Number(b.match(/^[0-9\.]+/))]});G(E).call(E,v=>{const[C,b]=v;switch(C){case"brightness":(b<.1||b>3)&&(n=!1);break;case"blur":b>3&&(n=!1);break;case"opacity":b<.1&&(n=!1)}})}return n},this.checkPropertyUpToAllParentNodes=(r,t)=>{let n=!0,s=!0;const c=h=>t(h);let d=r;for(;d&&s;)c(d)||(n=!1,s=!1),d=d.parentElement,d||(s=!1);return n},this.checkActualCssVisibleIncludeInherit=r=>this.checkPropertyUpToAllParentNodes(r,this.checkCssVisibleProperty),this.getSizeAboutClient=r=>{const{width:t,height:n,left:s,right:c,top:d,bottom:h}=r.getBoundingClientRect(),p=this.getClientWidth(),A=this.getClientHeight();return{width:t,height:n,left:s,right:c,top:d,bottom:h,clientWidth:p,clientHeight:A,clientMin:Math.min(p,A)}},this.checkActualSize=()=>{const{width:r,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(r,t,n)},this.elementFromPoint=(r,t)=>document.elementFromPoint?document.elementFromPoint(r,t):null,this.checkCoverForAPoint=(r,t,n)=>{const s=this.elementFromPoint(r,t);return s!==null&&s!==n},this.getPointPositionList=()=>{const{width:r,height:t,left:n,top:s}=this._clientSize,c=r/6,d=t/6,h=[],p=10**6;for(let A=0;A<5;A++)for(let m=0;m<5;m++){const E=(n*p+(A===0?.1:A===4?(c*A*p-1e5)/p:c*A)*p)/p,v=(s*p+(m===0?.1:m===4?(d*m*p-1e5)/p:d*m)*p)/p;h.push({x:E,y:v})}return[...h]},this.checkElementCover=r=>{var t;const n=this.getPointPositionList();return kt(t=ft(n).call(n,s=>this.checkCoverForAPoint(s.x,s.y,r))).call(t,s=>!!s).length>6},this.checkSizeIsVisible=(r,t,n)=>(r>50||n/r<=10)&&(t>50||n/t<=10),this.checkSizeOfPartInClient=()=>{const{left:r,right:t,top:n,bottom:s,clientHeight:c,clientWidth:d,clientMin:h}=this._clientSize;let p,A,m,E;if(r<0)p=0;else{if(!(r<d))return!1;p=r}if(t<0)return!1;if(A=t<d?t:d,n<0)m=0;else{if(!(n<c))return!1;m=n}if(s<0)return!1;E=s<c?s:c;const v=A-p,C=E-m;return this.checkSizeIsVisible(v,C,h)},this.returnHiddenResult=r=>(this._clientSize=null,{visible:!1,reason:r}),this.checkOneElementVisible=r=>{if(r instanceof HTMLElement){if(this.checkElementIsMountedOnDom(r)){if(this.checkActualCssVisibleIncludeInherit(r)){if(this._clientSize=this.getSizeAboutClient(r),this.checkElementCover(r))return this.returnHiddenResult(bl.COVERED);{const t=this.checkActualSize(),n=this.checkSizeOfPartInClient();return t&&!n?this.returnHiddenResult(bl.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(bl.SIZE)}}return this.returnHiddenResult(bl.STYLE)}return this.returnHiddenResult(Cp.UNMOUNTED)}return this.returnHiddenResult(Cp.INVALID_HTML_ELEMENT)},this.checkElementIsMountedOnDom=r=>this.checkPropertyUpToAllParentNodes(r,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement)}};function Hy(r,t){var n=le(r);if(ee){var s=ee(r);t&&(s=kt(s).call(s,function(c){return Wt(r,c).enumerable})),n.push.apply(n,s)}return n}function Xd(r){for(var t=1;t<arguments.length;t++){var n,s=arguments[t]!=null?arguments[t]:{};if(t%2)G(n=Hy(Object(s),!0)).call(n,function(d){_r(r,d,s[d])});else if(te)He(r,te(s));else{var c;G(c=Hy(Object(s))).call(c,function(d){se(r,d,Wt(s,d))})}}return r}var So=function(r,t,n,s){var c,d=arguments.length,h=d<3?t:s===null?s=Wt(t,n):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(r,t,n,s);else for(var p=r.length-1;p>=0;p--)(c=r[p])&&(h=(d<3?c(h):d>3?c(t,n,h):c(t,n))||h);return d>3&&h&&se(t,n,h),h},Ge=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)};class dr extends la{constructor(t,n,s,c,d){super(t,d),this.trackMediaType="video",this._videoVisibleTimer=null,this._scalabiltyMode={numSpatialLayers:1,numTemporalLayers:1},this._enabled=!0,this.updateMediaStreamTrackResolution(),this._encoderConfig=n,this._scalabiltyMode=s,this._optimizationMode=c}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Gn.PLAYING)}play(t,n={}){const s=gt.reportApiInvoke(null,{tag:Yt.TRACER,name:Kt.LOCAL_VIDEO_TRACK_PLAY,options:[this.getTrackId(),typeof t=="string"?t:"HTMLElement",n]});if(!(t instanceof HTMLElement)){const h=document.getElementById(t.toString());var c;h?t=h:(S.warning(O(c="[".concat(this.getTrackId(),'] can not find "#')).call(c,t,'" element, use document.body')),t=document.body)}S.debug("[".concat(this.getTrackId(),"] start video playback"),ht(n));const d=Xd({},this._getDefaultPlayerConfig(),{},n,{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(d):(this._player=new _p(d),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=window.setInterval(()=>{try{const h=this.getVideoElementVisibleStatus();this.emit(aa.VIDEO_ELEMENT_VISIBLE_STATUS,h)}catch{}},ot("CHECK_VIDEO_VISIBLE_INTERVAL")),s.onSuccess()}stop(){const t=gt.reportApiInvoke(null,{tag:Yt.TRACER,name:Kt.LOCAL_VIDEO_TRACK_STOP,options:[this.getTrackId()]});if(!this._player)return t.onSuccess();this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._player.destroy(),this._player=void 0,S.debug("[".concat(this.getTrackId(),"] stop video playback")),t.onSuccess()}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(S.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await Xe(this,Jt.NEED_DISABLE_TRACK,this)}catch(s){throw S.error("[".concat(this.getTrackId(),"] setEnabled to false error"),s.toString()),s}return n||(this._enabled=!1),void S.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await Xe(this,Jt.NEED_ENABLE_TRACK,this)}catch(s){throw S.error("[".concat(this.getTrackId(),"] setEnabled to true error"),s.toString()),s}S.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setMuted(t){var n;t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._mediaStreamTrack.enabled=!t,S.debug(O(n="[".concat(this.getTrackId(),"] start set muted: ")).call(n,t)),t?await Xe(this,Jt.NEED_MUTE_TRACK,this):await Xe(this,Jt.NEED_UNMUTE_TRACK,this))}getStats(){return ks(()=>{S.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Io(this,Jt.GET_STATS)||Xd({},Ud)}async setBeautyEffect(t,n={}){const s=gt.reportApiInvoke(null,{tag:Yt.TRACER,name:Kt.LOCAL_VIDEO_TRACK_BEAUTY,options:[this.getTrackId(),t,n]});if(t||this._videoBeautyProcessor){if(Nh()===Mn.IOS||Nh()===Mn.ANDROID){const c=new M(L.INVALID_OPERATION,"can not enable beauty effect on mobile device");throw s.onError(c),c}if(!this._enabled&&t){const c=new M(L.TRACK_IS_DISABLED,"can not enable beauty effect when track is disabled");throw s.onError(c),c}S.info("[".concat(this.getTrackId(),"] start setBeautyEffect"),t,ht(n));try{this._videoBeautyProcessor?await this._videoBeautyProcessor.setBeautyEffectOptions(t,n):(this._videoBeautyProcessor=new Wy,this._videoBeautyProcessor.onOverload=()=>{on(()=>this.emit(aa.BEAUTY_EFFECT_OVERLOAD))},await this._videoBeautyProcessor.setBeautyEffectOptions(t,n),await this._registerTrackProcessor(this._videoBeautyProcessor))}catch(c){throw S.error("[".concat(this.getTrackId(),"] setBeautyEffect error"),c.toString()),s.onError(c),c}S.info("[".concat(this.getTrackId(),"] setBeautyEffect success")),s.onSuccess()}}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}clone(t,n,s,c){const d=this._mediaStreamTrack.clone();return new dr(d,t,n,s,c)}async setBitrateLimit(t){var n;if(S.debug(O(n="[".concat(this.getTrackId(),"] set bitrate limit, ")).call(n,ht(t))),t){this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate);try{await Xe(this,Jt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw()}}}async setOptimizationMode(t){var n;if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void S.error(L.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const s=this._optimizationMode;try{this._optimizationMode=t,await Xe(this,Jt.SET_OPTIMIZATION_MODE,this)}catch(c){throw this._optimizationMode=s,S.error("[".concat(this.getTrackId(),"] set optimization mode failed"),c.toString()),c}S.info(O(n="[".concat(this.getTrackId(),"] set optimization mode success (")).call(n,t,")"))}setScalabiltyMode(t){var n;if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return S.error(L.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabiltyMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabiltyMode=t,S.info(O(n="[".concat(this.getTrackId(),"] set scalability mode success (")).call(n,t,")"))}updateMediaStreamTrackResolution(){ep(this._originMediaStreamTrack).then(([t,n])=>{this._videoHeight=n,this._videoWidth=t}).catch(Cl)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}getVideoElementVisibleStatus(){try{var t,n;const s=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),c={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:s==null?void 0:s.parentElement},{element:d,slot:h}=c;if(this.isPlaying&&d instanceof HTMLVideoElement&&h instanceof HTMLElement){const p=Vg.checkOneElementVisible(d),A=hr({},p);return A.visible||gt.reportApiInvoke(null,{tag:Yt.TRACER,name:Kt.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]}).onSuccess("Not visible because of ".concat(A.reason)),A}return}catch(s){throw new M(L.GET_VIDEO_ELEMENT_VISIBLE_ERROR,s.message)}}async renewMediaStreamTrack(){}}So([Br(),Ge("design:type",Function),Ge("design:paramtypes",[Object,Object]),Ge("design:returntype",void 0)],dr.prototype,"play",null),So([gl("LocalVideoTrack","_enabledMutex"),Br(),Ge("design:type",Function),Ge("design:paramtypes",[Boolean,Boolean]),Ge("design:returntype",dt)],dr.prototype,"setEnabled",null),So([gl("LocalVideoTrack","_enabledMutex"),Br(),qh({report:gt}),Ge("design:type",Function),Ge("design:paramtypes",[Boolean]),Ge("design:returntype",dt)],dr.prototype,"setMuted",null),So([Br(),Ge("design:type",Function),Ge("design:paramtypes",[]),Ge("design:returntype",Object)],dr.prototype,"getStats",null),So([Br(),Ge("design:type",Function),Ge("design:paramtypes",[Boolean,Object]),Ge("design:returntype",dt)],dr.prototype,"setBeautyEffect",null),So([Br(),Ge("design:type",Function),Ge("design:paramtypes",[]),Ge("design:returntype",ImageData)],dr.prototype,"getCurrentFrameData",null),So([Br(),Ge("design:type",Function),Ge("design:paramtypes",[Object]),Ge("design:returntype",dt)],dr.prototype,"setBitrateLimit",null),So([Br(),Ge("design:type",Function),Ge("design:paramtypes",[String]),Ge("design:returntype",dt)],dr.prototype,"setOptimizationMode",null),So([Br(),Ge("design:type",Function),Ge("design:paramtypes",[Object]),Ge("design:returntype",void 0)],dr.prototype,"setScalabiltyMode",null),So([Br(),Ge("design:type",Function),Ge("design:paramtypes",[]),Ge("design:returntype",void 0)],dr.prototype,"updateMediaStreamTrackResolution",null);class Zd extends dr{constructor(t,n,s,c,d,h){super(t,n.encoderConfig?cs(n.encoderConfig):{},c,d,h),this._enabled=!0,this._deviceName="default",this.tryResumeVideoForIOS15WeChat=async()=>{ia()&&Oh()&&this._enabled&&!this._isClosed&&(S.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.setEnabled(!1),await this.setEnabled(!0))},this._config=n,this._constraints=s,this._deviceName=t.label,this._config.encoderConfig&&(this._encoderConfig=cs(this._config.encoderConfig)),ue.on(Lr.IOS_15_INTERRUPTION_END,this.tryResumeVideoForIOS15WeChat),ue.on(Lr.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15WeChat)}async setDevice(t){var n;const s=gt.reportApiInvoke(null,{tag:Yt.TRACER,name:Kt.CAM_VIDEO_TRACK_SET_DEVICE,options:[this.getTrackId(),t]});if(S.info(O(n="[".concat(this.getTrackId(),"] set device to ")).call(n,t)),this._enabled)try{const c=await gn.getDeviceById(t),d={};d.video=Xd({},this._constraints),d.video.deviceId={exact:t},d.video.facingMode=void 0,this._originMediaStreamTrack.stop();let h=null;try{h=await nn(d,this.getTrackId())}catch(p){throw S.error("[".concat(this.getTrackId(),"] setDevice failed"),p.toString()),h=await nn({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(h.getVideoTracks()[0],!1),p}await this._updateOriginMediaStreamTrack(h.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=c.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(c){throw s.onError(c),S.error("[".concat(this.getTrackId(),"] setDevice error"),c.toString()),c}else try{const c=await gn.getDeviceById(t);this._deviceName=c.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(c){throw s.onError(c),S.error("[".concat(this.getTrackId(),"] setDevice error"),c.toString()),c}S.info("[".concat(this.getTrackId(),"] setDevice success")),s.onSuccess()}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(S.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),n||(this._enabled=!1);try{await Xe(this,Jt.NEED_DISABLE_TRACK,this)}catch(d){throw S.error("[".concat(this.getTrackId(),"] setEnabled to false error"),d.toString()),d}return void S.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}const s=Xd({},this._constraints),c=gn.searchDeviceIdByName(this._deviceName);c&&!s.deviceId&&(s.deviceId={exact:c});try{const d=await nn({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(d.getVideoTracks()[0],!1),await Xe(this,Jt.NEED_ENABLE_TRACK,this)}catch(d){throw S.error("[".concat(this.getTrackId(),"] setEnabled true error"),d.toString()),d}this.updateMediaStreamTrackResolution(),S.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setEncoderConfiguration(t,n){const s=gt.reportApiInvoke(null,{tag:Yt.TRACER,name:Kt.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG,options:[this.getTrackId(),t]});if(!this._enabled){const h=new M(L.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");throw s.onError(h),h}t=cs(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin);const c=wn(this._config);c.encoderConfig=t;const d=wl(c);(Pi()||vi()||as())&&(d.deviceId=void 0),S.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),ht(t),ht(d));try{await this._originMediaStreamTrack.applyConstraints(d),this.updateMediaStreamTrackResolution()}catch(h){const p=new M(L.UNEXPECTED_ERROR,h.toString());throw S.error("[".concat(this.getTrackId(),"] applyConstraints error"),p.toString()),s.onError(p),p}this._config=c,this._constraints=d,this._encoderConfig=t;try{await Xe(this,Jt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(h){return s.onError(h),h.throw()}s.onSuccess()}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((vi()||as())&&this._enabled&&!this._isClosed&&ue.duringInterruption){const t=async()=>{ue.off(Lr.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(S.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};ue.on(Lr.IOS_INTERRUPTION_END,t)}else S.debug("[".concat(this.getTrackId(),"] track ended")),this.emit(aa.TRACK_ENDED)}async renewMediaStreamTrack(){const t=Xd({},this._constraints),n=gn.searchDeviceIdByName(this._deviceName);n&&!t.deviceId&&(t.deviceId={exact:n});const s=await nn({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}close(){super.close(),ue.off(Lr.IOS_15_INTERRUPTION_END,this.tryResumeVideoForIOS15WeChat),ue.off(Lr.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15WeChat)}}So([Br(),Ge("design:type",Function),Ge("design:paramtypes",[String]),Ge("design:returntype",dt)],Zd.prototype,"setDevice",null),So([gl("CameraVideoTrack","_enabledMutex"),Br(),Ge("design:type",Function),Ge("design:paramtypes",[Boolean,Boolean]),Ge("design:returntype",dt)],Zd.prototype,"setEnabled",null),So([Br(),Ge("design:type",Function),Ge("design:paramtypes",[Object,Boolean]),Ge("design:returntype",dt)],Zd.prototype,"setEncoderConfiguration",null);class Nl{constructor(t,n){this._trust_in_room_=!0,this._trust_audio_enabled_state_=!0,this._trust_video_enabled_state_=!0,this._trust_audio_mute_state_=!0,this._trust_video_mute_state_=!0,this._trust_stream_added_state_=!0,this._audio_muted_=!1,this._video_muted_=!1,this._audio_enabled_=!0,this._video_enabled_=!0,this._audio_added_=!1,this._video_added_=!1,this.uid=t,this._uintid=n}get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio)return this._audioTrack}get videoTrack(){if(this.hasVideo)return this._videoTrack}}var pL=ss.findIndex,fL="findIndex",Yy=!0;fL in[]&&Array(1).findIndex(function(){Yy=!1}),qt({target:"Array",proto:!0,forced:Yy},{findIndex:function(r){return pL(this,r,arguments.length>1?arguments[1]:void 0)}});var AL=Zr("Array").findIndex,qy=Array.prototype,ti=function(r){var t=r.findIndex;return r===qy||r instanceof Array&&t===qy.findIndex?AL:t};Wn("asyncIterator");var Sp=jh.f("asyncIterator");Wn("hasInstance"),Wn("isConcatSpreadable"),Wn("iterator"),Wn("match"),Wn("matchAll"),Wn("replace"),Wn("search"),Wn("species"),Wn("split"),Wn("toPrimitive"),Wn("toStringTag"),Wn("unscopables"),ta(Math,"Math",!0),ta(u.JSON,"JSON",!0);var Jy=_e.Symbol;Wn("asyncDispose"),Wn("dispose"),Wn("observable"),Wn("patternMatch"),Wn("replaceAll");var Gg=Jy,gL=fn.set,mL=fn.getterFor("AggregateError"),Ol=function(r,t){var n=this;if(!(n instanceof Ol))return new Ol(r,t);Xf&&(n=Xf(new Error(t),Zc(n)));var s=[];return Ba(r,s.push,s),g?gL(n,{errors:s,type:"AggregateError"}):n.errors=s,t!==void 0&&tn(n,"message",String(t)),n};Ol.prototype=Rs(Error.prototype,{constructor:N(5,Ol),message:N(5,""),name:N(5,"AggregateError")}),g&&un.f(Ol.prototype,"errors",{get:function(){return mL(this).errors},configurable:!0}),qt({global:!0},{AggregateError:Ol}),qt({target:"Promise",stat:!0},{try:function(r){var t=rl.f(this),n=nl(r);return(n.error?t.reject:t.resolve)(n.value),t.promise}});var zy="No one promise resolved";qt({target:"Promise",stat:!0},{any:function(r){var t=this,n=rl.f(t),s=n.resolve,c=n.reject,d=nl(function(){var h=dn(t.resolve),p=[],A=0,m=1,E=!1;Ba(r,function(v){var C=A++,b=!1;p.push(void 0),m++,h.call(t,v).then(function(y){b||E||(E=!0,s(y))},function(y){b||E||(b=!0,p[C]=y,--m||c(new(qn("AggregateError"))(p,zy)))})}),--m||c(new(qn("AggregateError"))(p,zy))});return d.error&&c(d.value),n.promise}});var jg=$v,Xy=function(r){this.wrapped=r};function $d(r){var t,n;function s(d,h){try{var p=r[d](h),A=p.value,m=A instanceof Xy;jg.resolve(m?A.wrapped:A).then(function(E){m?s(d==="return"?"return":"next",E):c(p.done?"return":"normal",E)},function(E){s("throw",E)})}catch(E){c("throw",E)}}function c(d,h){switch(d){case"return":t.resolve({value:h,done:!0});break;case"throw":t.reject(h);break;default:t.resolve({value:h,done:!1})}(t=t.next)?s(t.key,t.arg):n=null}this._invoke=function(d,h){return new jg(function(p,A){var m={key:d,arg:h,resolve:p,reject:A,next:null};n?n=n.next=m:(t=n=m,s(d,h))})},typeof r.return!="function"&&(this.return=void 0)}typeof Gg=="function"&&Sp&&($d.prototype[Sp]=function(){return this}),$d.prototype.next=function(r){return this._invoke("next",r)},$d.prototype.throw=function(r){return this._invoke("throw",r)},$d.prototype.return=function(r){return this._invoke("return",r)};var EL=$d,tu=function(r){return function(){return new EL(r.apply(this,arguments))}},Cn=function(r){return new Xy(r)},_L=md,Zy=jh.f("iterator"),Wg=Zy,$y=function(r){var t;if(Gg!==void 0&&(Sp&&(t=r[Sp])!=null||Wg&&(t=_L(r))!=null))return t.call(r);throw new TypeError("Object is not async iterable")},tT=function(r,t){var n={},s=!1;function c(d,h){return s=!0,h=new jg(function(p){p(r[d](h))}),{done:!1,value:t(h)}}return typeof Gg=="function"&&Wg&&(n[Wg]=function(){return this}),n.next=function(d){return s?(s=!1,d):c("next",d)},typeof r.throw=="function"&&(n.throw=function(d){if(s)throw s=!1,d;return c("throw",d)}),typeof r.return=="function"&&(n.return=function(d){return s?(s=!1,d):c("return",d)}),n},Vo=a(function(r,t){r.exports=(()=>{var n={8:(d,h,p)=>{p.r(h),p.d(h,{Parser:()=>H,Printer:()=>Ut,parse:()=>at,print:()=>Lt});const A=`
`,m="".concat("\r").concat(A),E=" ";let v;function C(lt){return lt>="0"&&lt<="9"}function b(lt){return lt>="!"&&lt<="~"}function y(lt){return b(lt)||lt>="\x80"&&lt<="\xFF"}function w(lt){return lt==="!"||lt>="#"&&lt<="'"||lt>="*"&&lt<="+"||lt>="-"&&lt<="."||lt>="0"&&lt<="9"||lt>="A"&&lt<="Z"||lt>="^"&&lt<="~"}function k(lt){return lt>="1"&&lt<="9"}function P(lt){return lt>="A"&&lt<="Z"||lt>="a"&&lt<="z"}function V(lt){return lt==="d"||lt==="h"||lt==="m"||lt==="s"}function j(lt){return lt>""&&lt<"	"||lt>"\v"&&lt<"\f"||lt>""&&lt<"\xFF"}function st(lt){return P(lt)||C(lt)||lt==="+"||lt==="/"}function mt(lt){return C(lt)||P(lt)||lt==="+"||lt==="/"||lt==="-"||lt==="_"}function Et(lt){return P(lt)||C(lt)||lt==="+"||lt==="/"}function At(lt,R){var B=Object.keys(lt);if(Object.getOwnPropertySymbols){var Q=Object.getOwnPropertySymbols(lt);R&&(Q=Q.filter(function(ut){return Object.getOwnPropertyDescriptor(lt,ut).enumerable})),B.push.apply(B,Q)}return B}function $(lt){for(var R=1;R<arguments.length;R++){var B=arguments[R]!=null?arguments[R]:{};R%2?At(Object(B),!0).forEach(function(Q){rt(lt,Q,B[Q])}):Object.getOwnPropertyDescriptors?Object.defineProperties(lt,Object.getOwnPropertyDescriptors(B)):At(Object(B)).forEach(function(Q){Object.defineProperty(lt,Q,Object.getOwnPropertyDescriptor(B,Q))})}return lt}function rt(lt,R,B){return R in lt?Object.defineProperty(lt,R,{value:B,enumerable:!0,configurable:!0,writable:!0}):lt[R]=B,lt}(function(lt){lt.VERSION="v",lt.ORIGIN="o",lt.SESSION_NAME="s",lt.INFORMATION="i",lt.URI="u",lt.EMAIL="e",lt.PHONE="p",lt.CONNECTION="c",lt.BANDWIDTH="b",lt.TIME="t",lt.REPEAT="r",lt.ZONE_ADJUSTMENTS="z",lt.KEY="k",lt.ATTRIBUTE="a",lt.MEDIA="m"})(v||(v={}));class W{consumeText(R,B){let Q=B;for(;Q<R.length;){const ut=R[Q];if(ut==="\0"||ut==="\r"||ut===A)break;Q+=1}if(Q-B==0)throw new Error("Invalid text, at ".concat(R));return Q}consumeUnicastAddress(R,B,Q){return this.consumeTill(R,B,E)}consumeOneOrMore(R,B,Q){let ut=B;for(;Q(R[ut]);)ut++;if(ut-B==0)throw new Error("Invalid rule at ".concat(B,"."));return ut}consumeSpace(R,B){if(R[B]===E)return B+1;throw new Error("Invalid space at ".concat(B,"."))}consumeIP4Address(R,B){let Q=B;for(let ut=0;ut<4;ut++)if(Q=this.consumeDecimalUChar(R,Q),ut!==3){if(R[Q]!==".")throw new Error("Invalid IP4 address.");Q++}return Q}consumeDecimalUChar(R,B){let Q=B;for(let Vt=0;Vt<3&&C(R[Q]);Vt++,Q++);if(Q-B==0)throw new Error("Invalid decimal uchar.");const ut=parseInt(R.slice(B,Q));if(ut>=0&&ut<=255)return Q;throw new Error("Invalid decimal uchar")}consumeIP6Address(R,B){let Q=this.consumeHexpart(R,B);return R[Q]===":"&&(Q+=1,Q=this.consumeIP4Address(R,Q)),Q}consumeHexpart(R,B){let Q=B;if(R[Q]===":"&&R[Q+1]===":"){Q+=2;try{Q=this.consumeHexseq(R,Q)}catch{}return Q}if(Q=this.consumeHexseq(R,Q),R[Q]===":"&&R[Q+1]===":"){Q+=2;try{Q=this.consumeHexseq(R,Q)}catch{}return Q}return Q}consumeHexseq(R,B){let Q=B;for(;Q=this.consumeHex4(R,Q),R[Q]===":"&&R[Q+1]!==":";)Q+=1;return Q}consumeHex4(R,B){let Q=0;for(;Q<4;Q++)if(!((ut=R[B+Q])>="0"&&ut<="9"||ut>="a"&&ut<="f"||ut>="A"&&ut<="F")){if(Q===0)throw new Error("Invalid hex 4");break}var ut;return B+Q}consumeFQDN(R,B){let Q=B;for(;C(R[Q])||P(R[Q])||R[Q]==="-"||R[Q]===".";)Q+=1;if(Q-B<4)throw new Error("Invalid FQDN");return Q}consumeExtnAddr(R,B){return this.consumeOneOrMore(R,B,y)}consumeMulticastAddress(R,B,Q){switch(Q){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(R,B);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(R,B);default:try{return this.consumeFQDN(R,B)}catch{return this.consumeExtnAddr(R,B)}}}consumeIP6MulticastAddress(R,B){const Q=this.consumeHexpart(R,B);return R[Q]==="/"?this.consumeInteger(R,Q+1):Q}consumeIP4MulticastAddress(R,B){let Q=B+3;const ut=R.slice(B,Q),Vt=parseInt(ut);if(Vt<224||Vt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let Ue=0;Ue<3;Ue++){if(R[Q]!==".")throw new Error("Invalid IP4 multicast address.");Q+=1,Q=this.consumeDecimalUChar(R,Q)}return R[Q]==="/"&&(Q+=1),Q=this.consumeTTL(R,Q),R[Q]==="/"&&(Q=this.consumeInteger(R,Q)),Q}consumeInteger(R,B){if(!k(R[B]))throw new Error("Invalid integer.");for(B+=1;C(R[B]);)B+=1;return B}consumeTTL(R,B){if(R[B]==="0")return B+1;if(!k(R[B]))throw new Error("Invalid TTL.");B+=1;for(let Q=0;Q<2&&C(R[B]);Q++)B+=1;return B}consumeToken(R,B){return this.consumeOneOrMore(R,B,w)}consumeTime(R,B){let Q=B;if(R[Q]==="0")return Q+1;for(k(R[Q])&&(Q+=1);C(R[Q]);)Q++;if(Q-B<10)throw new Error("Invalid time");return Q}consumeAddress(R,B){return this.consumeTill(R,B,E)}consumeTypedTime(R,B){let Q=B;return Q=this.consumeOneOrMore(R,Q,C),V(R[Q])?Q+1:Q}consumeRepeatInterval(R,B){if(!k(R[B]))throw new Error("Invalid repeat interval");for(B+=1;C(R[B]);)B+=1;return V(R[B])&&(B+=1),B}consumePort(R,B){return this.consumeOneOrMore(R,B,C)}consume(R,B,Q){for(let ut=0;ut<Q.length;ut++){if(B+ut>=R.length)throw new Error("consume exceeding value length");if(R[B+ut]!==Q[ut])throw new Error("consume ".concat(Q," failed at ").concat(ut))}return B+Q.length}consumeTill(R,B,Q){let ut=B;for(;ut<R.length&&(typeof Q!="string"||R[ut]!==Q)&&(typeof Q!="function"||!Q(R[ut]));)ut++;return ut}}class H extends W{constructor(){super(),rt(this,"records",[]),rt(this,"currentLine",0)}parse(R){const B=this.probeEOL(R);this.records=R.split(B).filter(zr=>!!zr.trim()).map(this.parseLine),this.currentLine=0;const Q=this.parseVersion(),ut=this.parseOrigin(),Vt=this.parseSessionName(),Ue=this.parseInformation(),Tr=this.parseUri(),We=this.parseEmail(),ri=this.parsePhone(),fs=this.parseConnection(),Ti=this.parseBandWidth(),Fn=this.parseTimeFields(),yc=this.parseKey(),Ea=this.parseSessionAttribute(),sn=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:Q,origin:ut,sessionName:Vt,information:Ue,uri:Tr,emails:We,phones:ri,connection:fs,bandwidths:Ti,timeFields:Fn,key:yc,attributes:Ea,mediaDescriptions:sn}}getCurrentRecord(){const R=this.records[this.currentLine];if(!R)throw new Error("Record doesn't exit.");return R}probeEOL(R){for(let B=0;B<R.length;B++)if(R[B]===A)return R[B-1]==="\r"?m:A;throw new Error("Invalid newline character.")}parseLine(R,B){if(R.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const Q=R[0];if(R[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:Q,value:R.slice(2),line:B,cur:0}}parseSessionAttribute(){const R=new Tt;for(;this.currentLine<this.records.length;){const B=this.getCurrentRecord();if(B.type!==v.ATTRIBUTE)break;const Q={attField:this.extractOneOrMore(B,ut=>w(ut)&&ut!==":"),_cur:0};B.value[B.cur]===":"&&(B.cur+=1,Q.attValue=this.extractOneOrMore(B,j)),R.parse(Q),this.currentLine++}return R.digest()}parseMediaAttributes(R){const B=new It(R);for(;this.currentLine<this.records.length;){const Q=this.getCurrentRecord();if(Q.type!==v.ATTRIBUTE)break;const ut={attField:this.extractOneOrMore(Q,Vt=>w(Vt)&&Vt!==":"),_cur:0};Q.value[Q.cur]===":"&&(Q.cur+=1,ut.attValue=this.extractOneOrMore(Q,j)),B.parse(ut),this.currentLine++}return B.digest()}parseKey(){const R=this.getCurrentRecord();if(R.type===v.KEY){if(R.value==="prompt"||R.value==="clear:"||R.value==="base64:"||R.value==="uri:")return R.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const R=this.getCurrentRecord();if(R.type===v.ZONE_ADJUSTMENTS){const B=[];for(;;)try{const Q=this.extract(R,this.consumeTime);this.consumeSpaceForRecord(R);let ut=!1;R.value[R.cur]==="-"&&(ut=!0,R.cur+=1);const Vt=this.extract(R,this.consumeTypedTime);B.push({time:Q,typedTime:Vt,back:ut})}catch{break}if(B.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,B}return[]}parseRepeat(){const R=[];for(;;){const B=this.getCurrentRecord();if(B.type!==v.REPEAT)break;{const Q=this.extract(B,this.consumeRepeatInterval),ut=this.parseTypedTime(B);R.push({repeatInterval:Q,typedTimes:ut}),this.currentLine++}}return R}parseTypedTime(R){const B=[];for(;;)try{this.consumeSpaceForRecord(R),B.push(this.extract(R,this.consumeTypedTime))}catch{break}if(B.length===0)throw new Error("Invalid typed time.");return B}parseTime(){const R=this.getCurrentRecord(),B=this.extract(R,this.consumeTime);this.consumeSpaceForRecord(R);const Q=this.extract(R,this.consumeTime);return this.currentLine++,{startTime:B,stopTime:Q}}parseBandWidth(){const R=[];for(;this.currentLine<this.records.length;){const B=this.getCurrentRecord();if(B.type!==v.BANDWIDTH)break;{const Q=this.extractOneOrMore(B,w);if(B.value[B.cur]!==":")throw new Error("Invalid bandwidth field.");B.cur++;const ut=this.extractOneOrMore(B,C);R.push({bwtype:Q,bandwidth:ut}),this.currentLine++}}return R}parseVersion(){const R=this.getCurrentRecord();if(R.type!==v.VERSION)throw new Error("first sdp record must be version");const B=R.value.slice(0,this.consumeOneOrMore(R.value,0,C));if(B.length!==R.value.length)throw new Error('invalid proto version, "v='.concat(R.value,'"'));return this.currentLine++,B}parseOrigin(){const R=this.getCurrentRecord();if(R.type!==v.ORIGIN)throw new Error("second line of sdp must be origin");const B=this.extractOneOrMore(R,y);this.consumeSpaceForRecord(R);const Q=this.extractOneOrMore(R,C);this.consumeSpaceForRecord(R);const ut=this.extractOneOrMore(R,C);this.consumeSpaceForRecord(R);const Vt=this.extractOneOrMore(R,w);this.consumeSpaceForRecord(R);const Ue=this.extractOneOrMore(R,w);this.consumeSpaceForRecord(R);const Tr=this.extract(R,this.consumeUnicastAddress);return this.currentLine++,{username:B,sessId:Q,sessVersion:ut,nettype:Vt,addrtype:Ue,unicastAddress:Tr}}parseSessionName(){const R=this.getCurrentRecord();if(R.type===v.SESSION_NAME){const B=this.extract(R,this.consumeText);return this.currentLine++,B}}parseInformation(){const R=this.getCurrentRecord();if(R.type!==v.INFORMATION)return;const B=this.extract(R,this.consumeText);return this.currentLine++,B}parseUri(){const R=this.getCurrentRecord();if(R.type===v.URI)return this.currentLine++,R.value}parseEmail(){const R=[];for(;;){const B=this.getCurrentRecord();if(B.type!==v.EMAIL)break;R.push(B.value),this.currentLine++}return R}parsePhone(){const R=[];for(;;){const B=this.getCurrentRecord();if(B.type!==v.PHONE)break;R.push(B.value),this.currentLine++}return R}parseConnection(){const R=this.getCurrentRecord();if(R.type===v.CONNECTION){const B=this.extractOneOrMore(R,w);this.consumeSpaceForRecord(R);const Q=this.extractOneOrMore(R,w);this.consumeSpaceForRecord(R);const ut=this.extract(R,this.consumeAddress);return this.currentLine++,{nettype:B,addrtype:Q,address:ut}}}parseMedia(){const R=this.getCurrentRecord(),B=this.extract(R,this.consumeToken);this.consumeSpaceForRecord(R);let Q=this.extract(R,this.consumePort);R.value[R.cur]==="/"&&(R.cur+=1,Q+=this.extract(R,this.consumeInteger)),this.consumeSpaceForRecord(R);const ut=[];for(ut.push(this.extract(R,this.consumeToken));R.value[R.cur]==="/";)R.cur+=1,ut.push(this.extract(R,this.consumeToken));if(ut.length===0)throw new Error("Invalid proto");const Vt=this.parseFmt(R);return this.currentLine++,{mediaType:B,port:Q,protos:ut,fmts:Vt}}parseTimeFields(){const R=[];for(;this.getCurrentRecord().type===v.TIME;){const B=this.parseTime(),Q=this.parseRepeat(),ut=this.parseZone();R.push({time:B,repeats:Q,zones:ut})}return R}parseMediaDescription(){const R=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.MEDIA;){const B=this.parseMedia(),Q=this.parseInformation(),ut=this.parseConnections(),Vt=this.parseBandWidth(),Ue=this.parseKey(),Tr=this.parseMediaAttributes(B);R.push({media:B,information:Q,connections:ut,bandwidths:Vt,key:Ue,attributes:Tr})}return R}parseConnections(){const R=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.CONNECTION;)R.push(this.parseConnection());return R}parseFmt(R){const B=[];for(;;)try{this.consumeSpaceForRecord(R),B.push(this.extract(R,this.consumeToken))}catch{break}if(B.length===0)throw new Error("Invalid fmts");return B}extract(R,B,...Q){const ut=B.call(this,R.value,R.cur,...Q),Vt=R.value.slice(R.cur,ut);return R.cur=ut,Vt}extractOneOrMore(R,B){const Q=this.consumeOneOrMore(R.value,R.cur,B),ut=R.value.slice(R.cur,Q);return R.cur=Q,ut}consumeSpaceForRecord(R){if(R.value[R.cur]!==E)throw new Error("Invalid space at ".concat(R.cur,"."));R.cur+=1}}class U extends W{constructor(...R){super(...R),rt(this,"attributes",void 0),rt(this,"digested",!1)}extractOneOrMore(R,B,Q){const ut=this.consumeOneOrMore(R.attValue,R._cur,B),Vt=R.attValue.slice(R._cur,ut),[Ue,Tr]=Q||[];if(typeof Ue=="number"&&Vt.length<Ue)throw new Error("error in length, should be more or equal than ".concat(Ue," characters."));if(typeof Tr=="number"&&Vt.length>Tr)throw new Error("error in length, should be less or equal than ".concat(Tr," characters."));return R._cur=ut,Vt}consumeAttributeSpace(R){if(R.attValue[R._cur]!==E)throw new Error("Invalid space at ".concat(R._cur,"."));R._cur+=1}extract(R,B,...Q){if(!R.attValue)throw new Error("Nothing to extract from attValue.");const ut=B.call(this,R.attValue,R._cur,...Q),Vt=R.attValue.slice(R._cur,ut);return R._cur=ut,Vt}atEnd(R){if(!R.attValue)throw new Error;return R._cur>=R.attValue.length}peekChar(R){if(!R.attValue)throw new Error;return R.attValue[R._cur]}peek(R,B){if(!R.attValue)throw new Error;for(let Q=0;Q<B.length;Q++)if(B[Q]!==R.attValue[R._cur+Q])return!1;return!0}parseIceUfrag(R){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(R,st,[4,256])}parseIcePwd(R){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(R,st,[22,256])}parseIceOptions(R){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const B=[];for(;!this.atEnd(R);){B.push(this.extractOneOrMore(R,st));try{this.consumeAttributeSpace(R)}catch(Q){if(this.atEnd(R))break;throw Q}}this.attributes.iceOptions=B}parseFingerprint(R){const B=this.extract(R,this.consumeToken);this.consumeAttributeSpace(R);const Q=this.extract(R,this.consumeTill);this.attributes.fingerprints.push({hashFunction:B,fingerprint:Q})}parseExtmap(R){const B=this.extractOneOrMore(R,C);let Q;this.peekChar(R)==="/"&&(this.extract(R,this.consume,"/"),Q=this.extract(R,this.consumeToken)),this.consumeAttributeSpace(R);const ut=this.extract(R,this.consumeTill,E),Vt=$($({entry:parseInt(B,10)},Q&&{direction:Q}),{},{extensionName:ut});this.peekChar(R)===E&&(this.consumeAttributeSpace(R),Vt.extensionAttributes=this.extract(R,this.consumeTill)),this.attributes.extmaps.push(Vt)}parseSetup(R){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const B=this.extract(R,this.consumeTill);if(B!=="active"&&B!=="passive"&&B!=="actpass"&&B!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=B}}class Tt extends U{constructor(...R){super(...R),rt(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(R){if(this.digested)throw new Error("already digested");try{switch(R.attField){case"group":this.parseGroup(R);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(R);break;case"ice-pwd":this.parseIcePwd(R);break;case"ice-options":this.parseIceOptions(R);break;case"fingerprint":this.parseFingerprint(R);break;case"setup":this.parseSetup(R);break;case"tls-id":this.parseTlsId(R);break;case"identity":this.parseIdentity(R);break;case"extmap":this.parseExtmap(R);break;case"msid-semantic":this.parseMsidSemantic(R);break;default:R.ignored=!0,this.attributes.unrecognized.push(R)}}catch(B){throw console.error("parsing session attribute ".concat(R.attField,' error, "a=').concat(R.attField,":").concat(R.attValue,'"')),B}if(!R.ignored&&R.attValue&&!this.atEnd(R))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(R){const B=this.extract(R,this.consumeToken),Q=[];for(;!this.atEnd(R)&&this.peekChar(R)===E;)this.consumeAttributeSpace(R),Q.push(this.extract(R,this.consumeToken));this.attributes.groups.push({semantic:B,identificationTag:Q})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(R){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(R,mt)}parseIdentity(R){const B=this.extractOneOrMore(R,Et),Q=[];for(;!this.atEnd(R)&&this.peekChar(R)===E;){this.consumeAttributeSpace(R);const ut=this.extract(R,this.consumeToken);this.extract(R,this.consume,"=");const Vt=this.extractOneOrMore(R,Ue=>Ue!==E&&j(Ue));Q.push({name:ut,value:Vt})}this.attributes.identities.push({assertionValue:B,extensions:Q})}parseMsidSemantic(R){this.peekChar(R)===E&&this.consumeAttributeSpace(R);const B={semantic:this.extract(R,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(R)}catch{break}if(this.peekChar(R)==="*"){this.extract(R,this.consume,"*"),B.applyForAll=!0;break}{const Q=this.extract(R,this.consumeTill,E);B.identifierList.push(Q)}}this.attributes.msidSemantic=B}}class It extends U{constructor(R){super(),rt(this,"attributes",void 0),R.protos.indexOf("RTP")!==-1||R.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(R){if(this.digested)throw new Error("already digested");try{switch(R.attField){case"extmap":this.parseExtmap(R);break;case"setup":this.parseSetup(R);break;case"ice-ufrag":this.parseIceUfrag(R);break;case"ice-pwd":this.parseIcePwd(R);break;case"ice-options":this.parseIceOptions(R);break;case"candidate":this.parseCandidate(R);break;case"remote-candidate":this.parseRemoteCandidate(R);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(R);break;case"rtpmap":this.parseRtpmap(R);break;case"ptime":this.parsePtime(R);break;case"maxptime":this.parseMaxPtime(R);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(R);break;case"ssrc":this.parseSSRC(R);break;case"fmtp":this.parseFmtp(R);break;case"rtcp-fb":this.parseRtcpFb(R);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(R);break;case"mid":this.parseMid(R);break;case"msid":this.parseMsid(R);break;case"imageattr":this.parseImageAttr(R);break;case"rid":this.parseRid(R);break;case"simulcast":this.parseSimulcast(R);break;case"sctp-port":this.parseSctpPort(R);break;case"max-message-size":this.parseMaxMessageSize(R);break;case"ssrc-group":this.parseSSRCGroup(R);break;default:R.ignored=!0,this.attributes.unrecognized.push(R)}}catch(B){throw console.error("parsing media attribute ".concat(R.attField,' error, "a=').concat(R.attField,":").concat(R.attValue,'"')),B}if(!R.ignored&&R.attValue&&!this.atEnd(R))throw new Error("attribute parsing error")}parseCandidate(R){const B=this.extractOneOrMore(R,st,[1,32]);this.consumeAttributeSpace(R);const Q=this.extractOneOrMore(R,C,[1,5]);this.consumeAttributeSpace(R);const ut=this.extract(R,this.consumeToken);this.consumeAttributeSpace(R);const Vt=this.extractOneOrMore(R,C,[1,10]);this.consumeAttributeSpace(R);const Ue=this.extract(R,this.consumeAddress);this.consumeAttributeSpace(R);const Tr=this.extract(R,this.consumePort);this.consumeAttributeSpace(R),this.extract(R,this.consume,"typ"),this.consumeAttributeSpace(R);const We={foundation:B,componentId:Q,transport:ut,priority:Vt,connectionAddress:Ue,port:Tr,type:this.extract(R,this.consumeToken),extension:{}};for(this.peek(R," raddr")&&(this.extract(R,this.consume," raddr"),this.consumeAttributeSpace(R),We.relAddr=this.extract(R,this.consumeAddress)),this.peek(R," rport")&&(this.extract(R,this.consume," rport"),this.consumeAttributeSpace(R),We.relPort=this.extract(R,this.consumePort));this.peekChar(R)===E;){this.consumeAttributeSpace(R);const ri=this.extract(R,this.consumeToken);this.consumeAttributeSpace(R),We.extension[ri]=this.extractOneOrMore(R,b)}this.attributes.candidates.push(We)}parseRemoteCandidate(R){const B=[];for(;;){const Q=this.extractOneOrMore(R,C,[1,5]);this.consumeAttributeSpace(R);const ut=this.extract(R,this.consumeAddress);this.consumeAttributeSpace(R);const Vt=this.extract(R,this.consumePort);B.push({componentId:Q,connectionAddress:ut,port:Vt});try{this.consumeAttributeSpace(R)}catch{break}}this.attributes.remoteCandidatesList.push(B)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(R){const B=this.extract(R,this.consumeToken);this.consumeAttributeSpace(R);const Q=this.extract(R,this.consumeTill,"/");this.extract(R,this.consume,"/");const ut={encodingName:Q,clockRate:this.extractOneOrMore(R,C)};this.atEnd(R)||this.peekChar(R)!=="/"||(this.extract(R,this.consume,"/"),ut.encodingParameters=parseInt(this.extract(R,this.consumeTill),10));const Vt=this.attributes.payloads.find(Ue=>Ue.payloadType===parseInt(B,10));Vt?Vt.rtpMap=ut:this.attributes.payloads.push({payloadType:parseInt(B,10),rtpMap:ut,rtcpFeedbacks:[]})}parsePtime(R){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(R,this.consumeTill)}parseMaxPtime(R){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(R,this.consumeTill)}parseDirection(R){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=R.attField}parseSSRC(R){const B=this.extractOneOrMore(R,C);this.consumeAttributeSpace(R);const Q=this.extract(R,this.consumeTill,":");let ut;this.peekChar(R)===":"&&(this.extract(R,this.consume,":"),ut=this.extract(R,this.consumeTill));const Vt=this.attributes.ssrcs.find(Ue=>Ue.ssrcId===parseInt(B,10));Vt?Vt.attributes[Q]=ut:this.attributes.ssrcs.push({ssrcId:parseInt(B,10),attributes:{[Q]:ut}})}parseFmtp(R){const B=this.extract(R,this.consumeTill,E);this.consumeAttributeSpace(R);const Q=this.extract(R,this.consumeTill),ut={};Q.split(";").forEach(Ue=>{let[Tr,We]=Ue.split("=");Tr=Tr.trim(),We=typeof We=="string"?We.trim():We,typeof Tr=="string"&&Tr.length>0&&(ut[Tr]=We)});const Vt=this.attributes.payloads.find(Ue=>Ue.payloadType===parseInt(B,10));Vt?Vt.fmtp={parameters:ut}:this.attributes.payloads.push({payloadType:parseInt(B,10),rtcpFeedbacks:[],fmtp:{parameters:ut}})}parseFmtParameters(R){const B={},Q=this.extract(R,this.consumeTill,"=");R._cur++;const ut=this.extract(R,this.consumeTill,";");for(B[Q]=ut;R.attValue[R._cur]===";";){const Vt=this.extract(R,this.consumeTill,"=");R._cur++;const Ue=this.extract(R,this.consumeTill,";");B[Vt]=Ue}return B}parseRtcpFb(R){let B="";B=this.peekChar(R)==="*"?this.extract(R,this.consume,"*"):this.extract(R,this.consumeTill,E),this.consumeAttributeSpace(R);const Q=this.extract(R,this.consumeTill,E);let ut;switch(Q){case"trr-int":ut={type:Q,interval:this.extract(R,this.consumeTill)};break;case"ack":case"nack":default:{const Vt={type:Q};this.peekChar(R)===E&&(this.consumeAttributeSpace(R),Vt.parameter=this.extract(R,this.consumeToken),this.peekChar(R)===E&&(Vt.additional=this.extract(R,this.consumeTill))),ut=Vt}}if(B==="*")this.attributes.rtcpFeedbackWildcards.push(ut);else{const Vt=this.attributes.payloads.find(Ue=>Ue.payloadType===parseInt(B,10));Vt?Vt.rtcpFeedbacks.push(ut):this.attributes.payloads.push({payloadType:parseInt(B,10),rtcpFeedbacks:[ut]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(R){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const B={port:this.extract(R,this.consumePort)};this.peekChar(R)===E&&(this.consumeAttributeSpace(R),B.netType=this.extractOneOrMore(R,w),this.consumeAttributeSpace(R),B.addressType=this.extractOneOrMore(R,w),this.consumeAttributeSpace(R),B.address=this.extract(R,this.consumeAddress)),this.attributes.rtcp=B}parseMsid(R){const B={id:this.extractOneOrMore(R,w,[1,64])};this.peekChar(R)===E&&(this.consumeAttributeSpace(R),B.appdata=this.extractOneOrMore(R,w,[1,64])),this.attributes.msids.push(B)}parseImageAttr(R){this.attributes.imageattr.push(R.attValue)}parseRid(R){const B=this.extractOneOrMore(R,ut=>P(ut)||C(ut)||ut==="_"||ut==="-");this.consumeAttributeSpace(R);const Q={id:B,direction:this.extract(R,this.consumeToken),params:[]};if(this.peekChar(R)===E){if(this.consumeAttributeSpace(R),this.peek(R,"pt=")){this.extract(R,this.consume,"pt=");const ut=[];for(;;){const Vt=this.extract(R,this.consumeToken);ut.push(Vt);try{this.extract(R,this.consume,",")}catch{break}}Q.payloads=ut,this.peekChar(R)===E&&this.extract(R,this.consume,E)}for(;;){const ut=this.extract(R,this.consumeToken);switch(ut){case"depend":{const Vt={type:ut,rids:this.extract(R,this.consume,"=").split(",")};Q.params.push(Vt);break}case"max-width":case"height-width":case"max-fps":case"max-fs":case"max-br":case"max-pps":case"max-bpp":default:{const Vt={type:ut};this.peekChar(R)==="="&&(this.extract(R,this.consume,"="),Vt.val=this.extract(R,this.consumeTill,";")),Q.params.push(Vt)}}try{this.extract(R,this.consume,";")}catch{break}}}this.attributes.rids.push(Q)}parseSimulcast(R){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=R.attValue,this.extract(R,this.consumeTill)}parseSctpPort(R){this.attributes.sctpPort=this.extractOneOrMore(R,C,[1,5])}parseMaxMessageSize(R){this.attributes.maxMessageSize=this.extractOneOrMore(R,C,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(R){this.attributes.mid=this.extract(R,this.consumeToken)}parseSSRCGroup(R){const B=this.extract(R,this.consumeToken),Q=[];for(;;)try{this.consumeAttributeSpace(R);const ut=this.extract(R,this.consumeInteger);Q.push(parseInt(ut,10))}catch{break}this.attributes.ssrcGroups.push({semantic:B,ssrcIds:Q})}}function Ct(lt,R,B){return R in lt?Object.defineProperty(lt,R,{value:B,enumerable:!0,configurable:!0,writable:!0}):lt[R]=B,lt}class Ut{constructor(){Ct(this,"eol",m)}print(R,B){let Q="";return B&&(this.eol=B),Q+=this.printVersion(R.version),Q+=this.printOrigin(R.origin),Q+=this.printSessionName(R.sessionName),Q+=this.printInformation(R.information),Q+=this.printUri(R.uri),Q+=this.printEmail(R.emails),Q+=this.printPhone(R.phones),Q+=this.printConnection(R.connection),Q+=this.printBandwidth(R.bandwidths),Q+=this.printTimeFields(R.timeFields),Q+=this.printKey(R.key),Q+=this.printSessionAttributes(R.attributes),Q+=this.printMediaDescription(R.mediaDescriptions),Q}printVersion(R){return"v=".concat(R).concat(this.eol)}printOrigin(R){return"o=".concat(R.username," ").concat(R.sessId," ").concat(R.sessVersion," ").concat(R.nettype," ").concat(R.addrtype," ").concat(R.unicastAddress).concat(this.eol)}printSessionName(R){return R?"s=".concat(R).concat(this.eol):""}printInformation(R){return R?"i=".concat(R).concat(this.eol):""}printUri(R){return R?"u=".concat(R).concat(this.eol):""}printEmail(R){let B="";for(const Q of R)B+="e=".concat(Q).concat(this.eol);return B}printPhone(R){let B="";for(const Q of R)B+="e=".concat(Q).concat(this.eol);return B}printConnection(R){return R?"c=".concat(R.nettype," ").concat(R.addrtype," ").concat(R.address).concat(this.eol):""}printBandwidth(R){let B="";for(const Q of R)B+="b=".concat(Q.bwtype,":").concat(Q.bandwidth).concat(this.eol);return B}printTimeFields(R){let B="";for(const Q of R){B+="t=".concat(Q.time.startTime," ").concat(Q.time.startTime).concat(this.eol);for(const ut of Q.repeats)B+="r=".concat(ut.repeatInterval," ").concat(ut.typedTimes.join(" ")).concat(this.eol);Q.zoneAdjustments&&(B+="z=",B+="z=".concat(Q.zoneAdjustments.map(ut=>"".concat(ut.time," ").concat(ut.back?"-":""," ").concat(ut.typedTime)).join(" ")).concat(this.eol),B+=this.eol)}return B}printKey(R){return R?"k=".concat(R).concat(this.eol):""}printAttributes(R){let B="";for(const Q of R)B+="a=".concat(Q.attField).concat(Q.attValue?":".concat(Q.attValue):"").concat(this.eol);return B}printMediaDescription(R){let B="";for(const Q of R)B+=this.printMedia(Q.media),B+=this.printInformation(Q.information),B+=this.printConnections(Q.connections),B+=this.printBandwidth(Q.bandwidths),B+=this.printKey(Q.key),B+=this.printMediaAttributes(Q);return B}printConnections(R){let B="";for(const Q of R)B+=this.printConnection(Q);return B}printMedia(R){return"m=".concat(R.mediaType," ").concat(R.port," ").concat(R.protos.join("/")," ").concat(R.fmts.join(" ")).concat(this.eol)}printSessionAttributes(R){return new tt(this.eol).print(R)}printMediaAttributes(R){return new vt(this.eol).print(R)}}class Y{constructor(R){Ct(this,"eol",void 0),this.eol=R}printIceUfrag(R){return R===void 0?"":"a=ice-ufrag:".concat(R).concat(this.eol)}printIcePwd(R){return R===void 0?"":"a=ice-pwd:".concat(R).concat(this.eol)}printIceOptions(R){return R===void 0?"":"a=ice-options:".concat(R.join(E)).concat(this.eol)}printFingerprints(R){return R.length>0?R.map(B=>"a=fingerprint:".concat(B.hashFunction).concat(E).concat(B.fingerprint)).join(this.eol)+this.eol:""}printExtmap(R){return R.map(B=>"a=extmap:".concat(B.entry).concat(B.direction?"/".concat(B.direction):"").concat(E).concat(B.extensionName).concat(B.extensionAttributes?"".concat(E).concat(B.extensionAttributes):"").concat(this.eol)).join("")}printSetup(R){return R===void 0?"":"a=setup:".concat(R).concat(this.eol)}printUnrecognized(R){return R.map(B=>"a=".concat(B.attField).concat(B.attValue?":".concat(B.attValue):"").concat(this.eol)).join("")}}class tt extends Y{print(R){let B="";return B+=this.printGroups(R.groups),B+=this.printMsidSemantic(R.msidSemantic),B+=this.printIceLite(R.iceLite),B+=this.printIceUfrag(R.iceUfrag),B+=this.printIcePwd(R.icePwd),B+=this.printIceOptions(R.iceOptions),B+=this.printFingerprints(R.fingerprints),B+=this.printSetup(R.setup),B+=this.printTlsId(R.tlsId),B+=this.printIdentity(R.identities),B+=this.printExtmap(R.extmaps),B+=this.printUnrecognized(R.unrecognized),B}printGroups(R){let B="";return R.length>0&&(B+=R.map(Q=>"a=group:".concat(Q.semantic).concat(Q.identificationTag.map(ut=>"".concat(E).concat(ut)).join("")).concat(this.eol)).join("")),B}printIceLite(R){return R===void 0?"":"a=ice-lite"+this.eol}printTlsId(R){return R?"a=tls-id:".concat(R).concat(this.eol):""}printIdentity(R){return R.length===0?"":R.map(B=>"a=identity:".concat(B.assertionValue).concat(B.extensions.map(Q=>"".concat(E).concat(Q.name).concat(Q.value?"=".concat(Q.value):"")))).join(this.eol)+this.eol}printMsidSemantic(R){if(!R)return"";let B="a=msid-semantic:".concat(R.semantic);return R.applyForAll?B+="".concat(E,"*"):R.identifierList.length>0&&(B+=R.identifierList.map(Q=>"".concat(E).concat(Q))),B+this.eol}}class vt extends Y{print(R){const B=R.attributes;let Q="";return Q+=this.printRTCP(B.rtcp),Q+=this.printIceUfrag(B.iceUfrag),Q+=this.printIcePwd(B.icePwd),Q+=this.printIceOptions(B.iceOptions),Q+=this.printCandidates(B.candidates),Q+=this.printRemoteCandidatesList(B.remoteCandidatesList),Q+=this.printEndOfCandidates(B.endOfCandidates),Q+=this.printFingerprints(B.fingerprints),Q+=this.printSetup(B.setup),Q+=this.printMid(B.mid),Q+=this.printExtmap(B.extmaps),Q+=this.printRTPRelated(B),Q+=this.printPtime(B.ptime),Q+=this.printMaxPtime(B.maxPtime),Q+=this.printDirection(B.direction),Q+=this.printSSRCGroups(B.ssrcGroups),Q+=this.printSSRC(B.ssrcs),Q+=this.printRTCPMux(B.rtcpMux),Q+=this.printRTCPMuxOnly(B.rtcpMuxOnly),Q+=this.printRTCPRsize(B.rtcpRsize),Q+=this.printMSId(B.msids),Q+=this.printImageattr(B.imageattr),Q+=this.printRid(B.rids),Q+=this.printSimulcast(B.simulcast),Q+=this.printSCRPPort(B.sctpPort),Q+=this.printMaxMessageSize(B.maxMessageSize),Q+=this.printUnrecognized(B.unrecognized),Q}printCandidates(R){return R.map(B=>"a=candidate:".concat(B.foundation).concat(E).concat(B.componentId).concat(E).concat(B.transport).concat(E).concat(B.priority).concat(E).concat(B.connectionAddress).concat(E).concat(B.port).concat(E,"typ").concat(E).concat(B.type).concat(B.relAddr?"".concat(E,"raddr").concat(E).concat(B.relAddr):"").concat(B.relPort?"".concat(E,"rport").concat(E).concat(B.relPort):"").concat(Object.keys(B.extension).map(Q=>"".concat(E).concat(Q).concat(E).concat(B.extension[Q])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(R){return R.map(B=>"a=remote-candidates:".concat(B.join(E)).concat(this.eol)).join("")}printEndOfCandidates(R){return R===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(R){if(!R.payloads)return"";const B=R.payloads;let Q="";Q+=R.rtcpFeedbackWildcards.map(ut=>this.printRTCPFeedback("*",ut)).join("");for(const ut of B)Q+=this.printRtpMap(ut.payloadType,ut.rtpMap),Q+=this.printFmtp(ut.payloadType,ut.fmtp),Q+=ut.rtcpFeedbacks.map(Vt=>this.printRTCPFeedback(ut.payloadType,Vt)).join("");return Q}printFmtp(R,B){if(!B)return"";const Q=Object.keys(B.parameters);return Q.length===1&&B.parameters[Q[0]]===void 0?"a=fmtp:".concat(R).concat(E).concat(Q[0]).concat(this.eol):"a=fmtp:".concat(R).concat(E).concat(Object.keys(B.parameters).map(ut=>"".concat(ut,"=").concat(B.parameters[ut])).join(";")).concat(this.eol)}printRtpMap(R,B){return B?"a=rtpmap:".concat(R).concat(E).concat(B.encodingName,"/").concat(B.clockRate).concat(B.encodingParameters?"/".concat(B.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(R,B){let Q="a=rtcp-fb:".concat(R).concat(E),ut=B;switch(ut.type){case"trr-int":Q+="ttr-int".concat(E).concat(ut.interval);break;case"ack":case"nack":default:ut=ut,Q+="".concat(ut.type),ut.parameter&&(Q+="".concat(E).concat(ut.parameter),ut.additional&&(Q+="".concat(E).concat(ut.additional)))}return Q+this.eol}printPtime(R){return R===void 0?"":"a=ptime:".concat(R).concat(this.eol)}printMaxPtime(R){return R===void 0?"":"a=maxptime:".concat(R).concat(this.eol)}printDirection(R){return R===void 0?"":"a=".concat(R).concat(this.eol)}printSSRC(R){return R.map(B=>Object.keys(B.attributes).map(Q=>"a=ssrc:".concat(B.ssrcId.toString(10)).concat(E).concat(Q).concat(B.attributes[Q]?":".concat(B.attributes[Q]):"").concat(this.eol)).join("")).join("")}printRTCPMux(R){return R===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(R){return R===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(R){return R===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(R){if(R===void 0)return"";let B="a=rtcp:".concat(R.port);return R.netType&&(B+="".concat(E).concat(R.netType)),R.addressType&&(B+="".concat(E).concat(R.addressType)),R.address&&(B+="".concat(E).concat(R.address)),B+this.eol}printMSId(R){return R.map(B=>"a=msid:".concat(B.id).concat(B.appdata?"".concat(E).concat(B.appdata):"").concat(this.eol)).join("")}printImageattr(R){return R.map(B=>"a=imageattr:".concat(B).concat(this.eol)).join("")}printRid(R){return R.map(B=>{let Q="a=rid:".concat(B.id).concat(E).concat(B.direction);return B.payloads&&(Q+="".concat(E,"pt=").concat(B.payloads.join(","))),B.params.length>0&&(Q+="".concat(E).concat(B.params.map(ut=>ut.type==="depend"?"depend=".concat(ut.rids.join(",")):"".concat(ut.type,"=").concat(ut.val)).join(";"))),Q+this.eol}).join("")}printSimulcast(R){return R===void 0?"":"a=simulcast:".concat(R).concat(this.eol)}printSCRPPort(R){return R===void 0?"":"a=sctp-port:".concat(R).concat(this.eol)}printMaxMessageSize(R){return R===void 0?"":"a=max-message-size:".concat(R)}printMid(R){return R===void 0?"":"a=mid:".concat(R).concat(this.eol)}printSSRCGroups(R){return R.map(B=>"a=ssrc-group:".concat(B.semantic).concat(B.ssrcIds.map(Q=>"".concat(E).concat(Q.toString(10))).join("")).concat(this.eol)).join("")}}function at(lt){return new H().parse(lt)}function Lt(lt,R){return new Ut().print(lt,R)}}},s={};function c(d){if(s[d])return s[d].exports;var h=s[d]={exports:{}};return n[d](h,h.exports,c),h.exports}return c.d=(d,h)=>{for(var p in h)c.o(h,p)&&!c.o(d,p)&&Object.defineProperty(d,p,{enumerable:!0,get:h[p]})},c.o=(d,h)=>Object.prototype.hasOwnProperty.call(d,h),c.r=d=>{typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(d,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(d,"__esModule",{value:!0})},c(8)})()});function eT(r,t){var n=le(r);if(ee){var s=ee(r);t&&(s=kt(s).call(s,function(c){return Wt(r,c).enumerable})),n.push.apply(n,s)}return n}function Kg(r){for(var t=1;t<arguments.length;t++){var n,s=arguments[t]!=null?arguments[t]:{};if(t%2)G(n=eT(Object(s),!0)).call(n,function(d){_r(r,d,s[d])});else if(te)He(r,te(s));else{var c;G(c=eT(Object(s))).call(c,function(d){se(r,d,Wt(s,d))})}}return r}function rT(r,t,n,s,c){var d;let h=[],p=[],A=[],m=[],E=!1,v=!1;const C=Vo.parse(r);if(G(d=C.mediaDescriptions).call(d,b=>{b.media.mediaType!=="video"||E||(p=b.attributes.payloads,m=b.attributes.extmaps,E=!0),b.media.mediaType!=="audio"||v||(h=b.attributes.payloads,A=b.attributes.extmaps,v=!0)}),!m||p.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!A||h.length===0)throw new Error("Cannot get audio capabilities from SDP.");return G(p).call(p,b=>{var y;(y=b.rtpMap)!==null&&y!==void 0&&y.clockRate&&(b.rtpMap.clockRate=Sr(b.rtpMap.clockRate))}),G(h).call(h,b=>{var y;(y=b.rtpMap)!==null&&y!==void 0&&y.clockRate&&(b.rtpMap.clockRate=Sr(b.rtpMap.clockRate))}),t&&(h=kt(h).call(h,b=>{var y;return((y=b.rtpMap)===null||y===void 0?void 0:y.encodingName.toLowerCase())!=="rtx"}),p=kt(p).call(p,b=>{var y;return((y=b.rtpMap)===null||y===void 0?void 0:y.encodingName.toLowerCase())!=="rtx"})),n&&(p=kt(p).call(p,b=>{var y;return!/(red)|(ulpfec)|(flexfec)/i.test(((y=b.rtpMap)===null||y===void 0?void 0:y.encodingName)||"")})),s&&(s==null?void 0:s.length)>0&&(h=kt(h).call(h,b=>{var y;return zt(s).call(s,((y=b.rtpMap)===null||y===void 0?void 0:y.encodingName.toLowerCase())||"")})),c&&(c==null?void 0:c.length)>0&&(p=kt(p).call(p,b=>{var y;return zt(c).call(c,((y=b.rtpMap)===null||y===void 0?void 0:y.encodingName.toLowerCase())||"")})),{audioCodecs:h,videoCodecs:p,audioExtensions:A,videoExtensions:m}}function yp(r){const t=Vo.parse(r);let n,s;for(const c of t.mediaDescriptions){if(!n){const d=c.attributes.iceUfrag,h=c.attributes.icePwd;if(!d||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:d,icePwd:h}}if(!s){const d=c.attributes.fingerprints;d.length>0&&(s={fingerprints:d})}}if(!s&&t.attributes.fingerprints.length>0&&(s={fingerprints:t.attributes.fingerprints}),!s||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:s}}function nT(r){var t,n,s;const{dtls:c,ice:d,rtpCapabilities:h,cname:p}=r,{candidates:A,defaultIp:m,defaultPort:E}=aT(d.candidates),v={fingerprints:ft(t=c.fingerprints).call(t,y=>({hashFunction:y.algorithm,fingerprint:y.fingerprint}))},C={iceUfrag:d.iceUfrag,icePwd:d.icePwd};let b;switch(c.role){case"server":b="passive";break;case"client":b="active";break;case"auto":b="actpass"}return G(n=h.audioCodecs).call(n,y=>{$r(y.rtcpFeedbacks)||(y.rtcpFeedbacks=[])}),G(s=h.videoCodecs).call(s,y=>{$r(y.rtcpFeedbacks)||(y.rtcpFeedbacks=[])}),h.audioExtensions||(h.audioExtensions=[]),h.videoExtensions||(h.videoExtensions=[]),{dtlsParameters:v,iceParameters:C,candidates:A,rtpCapabilities:h,setup:b,cname:p,defaultIp:m,defaultPort:E}}function kl(r,t,n){const s=[],c=[];return G(r).call(r,({ssrcId:d,rtx:h})=>{var p;const A=Le(8,"track-"),m={ssrcId:d,attributes:Kg({label:A,mslabel:n=n||Le(10,""),msid:O(p="".concat(n," ")).call(p,A)},t&&{cname:t})};if(s.push(m),h!==void 0){var E;const v={ssrcId:h,attributes:Kg({label:A,mslabel:n,msid:O(E="".concat(n," ")).call(E,A)},t&&{cname:t})};s.push(v),c.push({semantic:"FID",ssrcIds:[d,h]})}}),r.length>1&&c.push({semantic:"SIM",ssrcIds:ft(r).call(r,({ssrcId:d})=>d)}),{ssrcs:s,ssrcGroups:c}}function Tp(r,t){var n;t instanceof qr&&G(n=r.attributes.payloads).call(n,s=>{var c;if(((c=s.rtpMap)===null||c===void 0?void 0:c.encodingName.toLowerCase())!=="opus")return;s.fmtp||(s.fmtp={parameters:{}}),s.fmtp.parameters.minptime="10",s.fmtp.parameters.useinbandfec="1";const d=t._encoderConfig;d&&(d.bitrate&&!Gr()&&(s.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*d.bitrate))),d.sampleRate&&(s.fmtp.parameters.maxplaybackrate="".concat(d.sampleRate),s.fmtp.parameters["sprop-maxcapturerate"]="".concat(d.sampleRate)),d.stereo&&(s.fmtp.parameters.stereo="1",s.fmtp.parameters["sprop-stereo"]="1"))})}function iT(r){var t;const n=ti(t=r.attributes.unrecognized).call(t,c=>c.attField==="x-google-flag"&&c.attValue==="conference");var s;n!==-1&&Ye(s=r.attributes.unrecognized).call(s,n,1)}function oT(r,t){var n,s;if(!(t instanceof dr&&t._encoderConfig&&Ft(n=t._hints).call(n,Xn.SCREEN_TRACK)===-1))return;const c=t._encoderConfig;var d,h;Dr().supportMinBitrate&&c.bitrateMin&&G(d=r.attributes.payloads).call(d,p=>{var A,m;zt(A=["h264","vp8","vp9","av1"]).call(A,((m=p.rtpMap)===null||m===void 0?void 0:m.encodingName.toLowerCase())||"")&&(p.fmtp||(p.fmtp={parameters:{}}),p.fmtp.parameters["x-google-min-bitrate"]="".concat(c.bitrateMin))}),Dr().supportMinBitrate&&!zt(s=t._hints).call(s,Xn.LOW_STREAM)&&c.bitrateMax&&G(h=r.attributes.payloads).call(h,p=>{var A,m;zt(A=["h264","vp8","vp9","av1"]).call(A,((m=p.rtpMap)===null||m===void 0?void 0:m.encodingName.toLowerCase())||"")&&(p.fmtp||(p.fmtp={parameters:{}}),p.fmtp.parameters["x-google-start-bitrate"]="".concat(Math.floor(c.bitrateMax)))})}function sT(r,t,n){if(!t)return;let s,c;if(r.media.mediaType==="video"?(s=n.videoExtensions,c=n.videoCodecs):(s=n.audioExtensions,c=n.audioCodecs),t.tcc===!0){const b=_t(s).call(s,y=>y.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");if(b){var d;_t(d=r.attributes.extmaps).call(d,w=>w.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")||r.attributes.extmaps.push({entry:b.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"});const y=function(w,k){return kt(k).call(k,P=>!!_t(w).call(w,V=>{var j;return V.payloadType===P.payloadType&&!!_t(j=V.rtcpFeedbacks).call(j,st=>st.type==="transport-cc")}))}(c,r.attributes.payloads);G(y).call(y,w=>{var k;_t(k=w.rtcpFeedbacks).call(k,P=>P.type==="transport-cc")||w.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(t.tcc===!1){var h,p;const b=ti(h=r.attributes.extmaps).call(h,y=>y.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");var A;b!==-1&&Ye(A=r.attributes.extmaps).call(A,b,1),G(p=r.attributes.payloads).call(p,y=>{var w;const k=ti(w=y.rtcpFeedbacks).call(w,V=>V.type==="transport-cc");var P;k!==-1&&Ye(P=y.rtcpFeedbacks).call(P,k,1)})}if(t.remb===!0){const b=_t(s).call(s,y=>y.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");if(b){var m;_t(m=r.attributes.extmaps).call(m,w=>w.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time")||r.attributes.extmaps.push({entry:b.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"});const y=function(w,k){return kt(k).call(k,P=>!!_t(w).call(w,V=>{var j;return V.payloadType===P.payloadType&&!!_t(j=V.rtcpFeedbacks).call(j,st=>st.type==="goog-remb")}))}(c,r.attributes.payloads);G(y).call(y,w=>{var k;_t(k=w.rtcpFeedbacks).call(k,P=>P.type==="goog-remb")||w.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(t.remb===!1){var E,v;const b=ti(E=r.attributes.extmaps).call(E,y=>y.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");var C;b!==-1&&Ye(C=r.attributes.extmaps).call(C,b,1),G(v=r.attributes.payloads).call(v,y=>{var w;const k=ti(w=y.rtcpFeedbacks).call(w,V=>V.type==="goog-remb");var P;k!==-1&&Ye(P=y.rtcpFeedbacks).call(P,k,1)})}}function aT(r){var t;const n=[];G(r).call(r,d=>{const h={foundation:d.foundation,componentId:"1",transport:d.protocol,priority:d.priority.toString(),connectionAddress:d.ip,port:d.port.toString(),type:d.type,extension:{}};n.push(h),n.push(Kg({},h,{componentId:"2"}))});const s=n[0].connectionAddress||"0.0.0.0",c=n[0].port||"9";return S.debug(O(t="choose highest priority candidate IP:port ".concat(s,":")).call(t,c," as default ICE connection address")),{candidates:n,defaultIp:s,defaultPort:c}}class vL{constructor(t){t=wn(t);const{remoteIceParameters:n,remoteDtlsParameters:s,candidates:c,remoteRTPCapabilities:d,remoteSetup:h,localCapabilities:p,sdkCodec:A,cname:m,ip:E,port:v}=t,C=Vo.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=d,this.candidates=c,this.iceParameters=n,this.dtlsParameters=s,this.setup=h,this.localCapabilities=p,this.cname=m,this.ip=E,this.port=v,this.addressType=Ft(E).call(E,":")===-1?"IP4":"IP6";for(let P=0;P<C.mediaDescriptions.length;P++){var b;const V=C.mediaDescriptions[P];if(V.media.port=this.port,G(b=V.connections).call(b,j=>{j.address=this.ip,j.addrtype=this.addressType}),V.attributes.rtcp?(V.attributes.rtcp.address=this.ip,V.attributes.rtcp.port=this.port,V.attributes.rtcp.addressType=this.addressType):V.attributes.rtcp={port:v,address:E,netType:"IN",addressType:this.addressType},V.attributes.iceUfrag=n.iceUfrag,V.attributes.icePwd=n.icePwd,V.attributes.fingerprints=s.fingerprints,V.attributes.candidates=c,V.attributes.setup=h,V.media.mediaType==="video"){var y,w;V.media.fmts=ft(y=d.videoCodecs).call(y,st=>st.payloadType.toString(10));const j=kt(w=d.videoCodecs).call(w,st=>{var mt,Et;return(mt=st.rtpMap)===null||mt===void 0?void 0:zt(Et=mt.encodingName.toLowerCase()).call(Et,A)});if(j.length===0)throw new Error("Codec ".concat(A," not supported by remote SDP."));V.attributes.payloads=j,V.attributes.extmaps=d.videoExtensions}var k;V.media.mediaType==="audio"&&(V.media.fmts=ft(k=d.audioCodecs).call(k,j=>j.payloadType.toString(10)),V.attributes.payloads=d.audioCodecs,V.attributes.extmaps=d.audioExtensions),C.mediaDescriptions[P]=this.mungMediaDesc(V)}this.sessionDesc=C,this.currentMidIndex=C.mediaDescriptions.length-1}toString(){return Vo.print(this.sessionDesc)}send(t,n,s){var c,d,h;const{ssrcs:p,ssrcGroups:A}=kl(n,this.cname),m=_t(c=this.sessionDesc.mediaDescriptions).call(c,C=>t===nr.VIDEO?C.media.mediaType==="video":C.media.mediaType==="audio"),E=p[0].attributes.label,v=p[0].attributes.mslabel;return m.attributes.ssrcs=O(d=m.attributes.ssrcs).call(d,p),m.attributes.ssrcGroups=O(h=m.attributes.ssrcGroups).call(h,A),{id:E,mslabel:v}}stopSending(t){var n;G(n=this.sessionDesc.mediaDescriptions).call(n,s=>{var c,d;const h=[],p=[],A=[];G(c=s.attributes.ssrcs).call(c,m=>{zt(t).call(t,m.attributes.label||"")?A.push(m):h.push(m)}),G(d=s.attributes.ssrcGroups).call(d,m=>{var E;zt(E=ft(A).call(A,v=>v.ssrcId)).call(E,m.ssrcIds[0])||p.push(m)}),s.attributes.ssrcs=h,s.attributes.ssrcGroups=p})}mute(t){var n;const s=_t(n=this.sessionDesc.mediaDescriptions).call(n,c=>c.attributes.mid===t);if(!s)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));s.attributes.direction="inactive"}unmute(t){var n;const s=_t(n=this.sessionDesc.mediaDescriptions).call(n,c=>c.attributes.mid===t);if(!s)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));s.attributes.direction="sendonly"}receive(t,n,s){G(t).call(t,(c,d)=>{var h;const p=c._mediaStreamTrack,A=ti(h=this.sessionDesc.mediaDescriptions).call(h,E=>E.attributes.mid===p.kind),m=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[A],c);this.sessionDesc.mediaDescriptions[A]=m})}stopReceiving(t){}restartICE(t,n,s,c){var d;t=wn(t),n=wn(n),this.iceParameters=t,this.candidates=n,this.ip=s,this.port=c,this.addressType=Ft(s).call(s,":")===-1?"IP4":"IP6",G(d=this.sessionDesc.mediaDescriptions).call(d,h=>{var p;h.media.port=this.port,G(p=h.connections).call(p,A=>{A.address=s,A.addrtype=this.addressType}),h.attributes.rtcp?(h.attributes.rtcp.address=this.ip,h.attributes.rtcp.port=this.port,h.attributes.rtcp.addressType=this.addressType):h.attributes.rtcp={port:c,address:s,netType:"IN",addressType:this.addressType},h.attributes.iceUfrag=t.iceUfrag,h.attributes.icePwd=t.icePwd,h.attributes.candidates=this.candidates})}predictReceivingMids(t){const n=[];for(let s=0;s<t;s++)n.push((this.currentMidIndex+s+1).toString(10));return n}mungRecvMediaDsec(t,n){const s=wn(t);return Tp(s,n),oT(s,n),s}updateRecvMedia(t,n){var s;const c=ti(s=this.sessionDesc.mediaDescriptions).call(s,d=>d.attributes.mid===t);if(c!==-1){const d=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[c],n);this.sessionDesc.mediaDescriptions[c]=d}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,n,s){var c;const d=_t(c=this.sessionDesc.mediaDescriptions).call(c,A=>t===nr.VIDEO?A.attributes.mid==="video":A.attributes.mid==="audio");if(d){var h;const A=_t(h=d.attributes.ssrcs).call(h,m=>m.attributes.label===n);var p;A&&(A.attributes.label=s,(p=A.attributes.msid)===null||p===void 0||p.replace(n,s))}}mungMediaDesc(t){const n=wn(t);return iT(n),function(s){var c,d;const h=_t(c=s.attributes.extmaps).call(c,m=>m.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");var p,A;h&&Ye(p=s.attributes.extmaps).call(p,Ft(A=s.attributes.extmaps).call(A,h),1),G(d=s.attributes.payloads).call(d,m=>{var E;const v=ti(E=m.rtcpFeedbacks).call(E,b=>b.type==="transport-cc");var C;v!==-1&&Ye(C=m.rtcpFeedbacks).call(C,v,1)})}(n),n}}function Go(r){if(Array.isArray(r))return r.map(function(s){return s});if(!cT(r))return r;var t={};for(var n in r)cT(r[n])||Array.isArray(r[n])?t[n]=Go(r[n]):t[n]=r[n];return t}function cT(r){return!(typeof r!="object"||Array.isArray(r)||!r)}var Hg=function(){function r(t){this.input=[],this.size=t}return r.prototype.add=function(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)},r.prototype.diffMean=function(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length},r}(),lT=function(r,t){return(lT=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var c in s)s.hasOwnProperty(c)&&(n[c]=s[c])})(r,t)};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation. All rights reserved.
	Licensed under the Apache License, Version 2.0 (the "License"); you may not use
	this file except in compliance with the License. You may obtain a copy of the
	License at http://www.apache.org/licenses/LICENSE-2.0

	THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
	KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
	WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
	MERCHANTABLITY OR NON-INFRINGEMENT.

	See the Apache Version 2.0 License for specific language governing permissions
	and limitations under the License.
	***************************************************************************** */function Yg(r,t){function n(){this.constructor=r}lT(r,t),r.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}var qg=function(){return(qg=Object.assign||function(r){for(var t,n=1,s=arguments.length;n<s;n++)for(var c in t=arguments[n])Object.prototype.hasOwnProperty.call(t,c)&&(r[c]=t[c]);return r}).apply(this,arguments)};function Jg(r,t,n,s){return new(n||(n=Promise))(function(c,d){function h(m){try{A(s.next(m))}catch(E){d(E)}}function p(m){try{A(s.throw(m))}catch(E){d(E)}}function A(m){m.done?c(m.value):new n(function(E){E(m.value)}).then(h,p)}A((s=s.apply(r,t||[])).next())})}function zg(r,t){var n,s,c,d,h={label:0,sent:function(){if(1&c[0])throw c[1];return c[1]},trys:[],ops:[]};return d={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(d[Symbol.iterator]=function(){return this}),d;function p(A){return function(m){return function(E){if(n)throw new TypeError("Generator is already executing.");for(;h;)try{if(n=1,s&&(c=2&E[0]?s.return:E[0]?s.throw||((c=s.return)&&c.call(s),0):s.next)&&!(c=c.call(s,E[1])).done)return c;switch(s=0,c&&(E=[2&E[0],c.value]),E[0]){case 0:case 1:c=E;break;case 4:return h.label++,{value:E[1],done:!1};case 5:h.label++,s=E[1],E=[0];continue;case 7:E=h.ops.pop(),h.trys.pop();continue;default:if(c=h.trys,!((c=c.length>0&&c[c.length-1])||E[0]!==6&&E[0]!==2)){h=0;continue}if(E[0]===3&&(!c||E[1]>c[0]&&E[1]<c[3])){h.label=E[1];break}if(E[0]===6&&h.label<c[1]){h.label=c[1],c=E;break}if(c&&h.label<c[2]){h.label=c[2],h.ops.push(E);break}c[2]&&h.ops.pop(),h.trys.pop();continue}E=t.call(r,h)}catch(v){E=[6,v],s=0}finally{n=c=0}if(5&E[0])throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}([A,m])}}}var Wa,eu={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[]},dT={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0},uT={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0},hT={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0},pT={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0},Xg=function(){function r(t,n){var s=this;this.videoIsReady=!1,this.videoIsReady2={},this.stats=Go(eu),this.isFirstVideoReceived={},this.isFirstVideoDecoded={},this.isFirstAudioReceived={},this.isFirstAudioDecoded={},this.lossRateWindowStats=[],this.pc=t,this.options=n,this.intervalTimer=window.setInterval(function(){return Jg(s,void 0,void 0,function(){return zg(this,function(c){return this.updateStats(),[2]})})},this.options.updateInterval)}return r.prototype.getStats=function(){return this.stats},r.prototype.setVideoIsReady=function(t){this.videoIsReady=t},r.prototype.setVideoIsReady2=function(t,n){this.videoIsReady2[t]=n},r.prototype.getVideoIsReady=function(t){return this.videoIsReady2[t]||!1},r.prototype.setIsFirstAudioDecoded=function(t){},r.prototype.destroy=function(){window.clearInterval(this.intervalTimer),this.pc=void 0},r.prototype.calcLossRate=function(t){var n=this;this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);for(var s=this.lossRateWindowStats.length,c=0,d=0,h=0,p=0,A=function(v){t[v].forEach(function(C,b){if(n.lossRateWindowStats[s-1][v][b]&&n.lossRateWindowStats[0][v][b]){var y=n.lossRateWindowStats[s-1][v][b].packets-n.lossRateWindowStats[0][v][b].packets,w=n.lossRateWindowStats[s-1][v][b].packetsLost-n.lossRateWindowStats[0][v][b].packetsLost;v==="videoSend"||v==="audioSend"?(c+=y,h+=w):(d+=y,p+=w),Number.isNaN(y)||Number.isNaN(y)?C.packetLostRate=0:C.packetLostRate=y<=0||w<=0?0:w/(y+w)}})},m=0,E=["videoSend","audioSend","videoRecv","audioRecv"];m<E.length;m++)A(E[m]);t.sendPacketLossRate=c<=0||h<=0?0:h/(c+h),t.recvPacketLossRate=d<=0||p<=0?0:p/(d+p)},r}(),IL=function(r){function t(){var n=r!==null&&r.apply(this,arguments)||this;return n._stats=eu,n.lastDecodeVideoReceiverStats=new Map,n}return Yg(t,r),t.prototype.updateStats=function(){return Jg(this,void 0,void 0,function(){var n,s,c,d;return zg(this,function(h){switch(h.label){case 0:return[4,this._getStats()];case 1:return n=h.sent(),s=this.statsResponsesToObjects(n),this._stats=Go(eu),c=s.filter(function(p){return p.type==="ssrc"}),this.processSSRCStats(c),(d=s.find(function(p){return p.type==="VideoBwe"}))&&this.processBandwidthStats(d),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats,[2]}})})},t.prototype.processBandwidthStats=function(n){this._stats.bitrate={actualEncoded:Number(n.googActualEncBitrate),targetEncoded:Number(n.googTargetEncBitrate),retransmit:Number(n.googRetransmitBitrate),transmit:Number(n.googTransmitBitrate)},this._stats.sendBandwidth=Number(n.googAvailableSendBandwidth)},t.prototype.processSSRCStats=function(n){var s=this;n.forEach(function(c){var d=c.id.includes("send");switch(c.mediaType+"_"+(d?"send":"recv")){case"video_send":var h=Go(uT);h.codec=c.googCodecName,h.adaptionChangeReason="none",c.googCpuLimitedResolution&&(h.adaptionChangeReason="cpu"),c.googBandwidthLimitedResolution&&(h.adaptionChangeReason="bandwidth"),h.avgEncodeMs=Number(c.googAvgEncodeMs),h.inputFrame={width:Number(c.googFrameWidthInput)||Number(c.googFrameWidthSent),height:Number(c.googFrameHeightInput)||Number(c.googFrameHeightSent),frameRate:Number(c.googFrameRateInput)},h.sentFrame={width:Number(c.googFrameWidthSent),height:Number(c.googFrameHeightSent),frameRate:Number(c.googFrameRateInput)},h.firsCount=Number(c.googFirReceived),h.nacksCount=Number(c.googNacksReceived),h.plisCount=Number(c.googPlisReceived),h.frameCount=Number(c.framesEncoded),h.bytes=Number(c.bytesSent),h.packets=Number(c.packetsSent),h.packetsLost=Number(c.packetsLost),h.ssrc=Number(c.ssrc),h.rttMs=Number(c.googRtt||0),s._stats.videoSend.push(h),s._stats.rtt=h.rttMs;break;case"video_recv":var p=Go(dT),A=s.lastDecodeVideoReceiverStats.get(Number(c.ssrc));if(p.codec=c.googCodecName,p.targetDelayMs=Number(c.googTargetDelayMs),p.renderDelayMs=Number(c.googRenderDelayMs),p.currentDelayMs=Number(c.googCurrentDelayMs),p.minPlayoutDelayMs=Number(c.googMinPlayoutDelayMs),p.decodeMs=Number(c.googDecodeMs),p.maxDecodeMs=Number(c.googMaxDecodeMs),p.receivedFrame={width:Number(c.googFrameWidthReceived),height:Number(c.googFrameHeightReceived),frameRate:Number(c.googFrameRateReceived)},p.decodedFrame={width:Number(c.googFrameWidthReceived),height:Number(c.googFrameHeightReceived),frameRate:Number(c.googFrameRateDecoded)},p.outputFrame={width:Number(c.googFrameWidthReceived),height:Number(c.googFrameHeightReceived),frameRate:Number(c.googFrameRateOutput)},p.jitterBufferMs=Number(c.googJitterBufferMs),p.firsCount=Number(c.googFirsSent),p.nacksCount=Number(c.googNacksSent),p.plisCount=Number(c.googPlisSent),p.framesDecodeCount=Number(c.framesDecoded),p.bytes=Number(c.bytesReceived),p.packets=Number(c.packetsReceived),p.packetsLost=Number(c.packetsLost),p.ssrc=Number(c.ssrc),p.packets>0&&!s.isFirstVideoReceived[p.ssrc]&&(s.onFirstVideoReceived&&s.onFirstVideoReceived(p.ssrc),s.isFirstVideoReceived[p.ssrc]=!0),p.framesDecodeCount>0&&!s.isFirstVideoDecoded[p.ssrc]&&(s.onFirstVideoDecoded&&s.onFirstVideoDecoded(p.ssrc,p.decodedFrame.width,p.decodedFrame.height),s.isFirstVideoDecoded[p.ssrc]=!0),A){var m=A.stats,E=Date.now()-A.lts;p.framesDecodeFreezeTime=m.framesDecodeFreezeTime,p.framesDecodeInterval=m.framesDecodeInterval,p.framesDecodeCount>m.framesDecodeCount&&s.isFirstVideoDecoded?(A.lts=Date.now(),p.framesDecodeInterval=E,p.framesDecodeInterval>=s.options.freezeRateLimit&&(s.getVideoIsReady(parseInt(c.ssrc,10))?p.framesDecodeFreezeTime+=p.framesDecodeInterval:s.setVideoIsReady2(parseInt(c.ssrc,10),!0))):p.framesDecodeCount<A.stats.framesDecodeCount&&(p.framesDecodeInterval=0)}s.lastDecodeVideoReceiverStats.set(p.ssrc,{stats:qg({},p),lts:Date.now()}),s._stats.videoRecv.push(p);break;case"audio_recv":var v=Go(pT);v.codec=c.googCodecName,v.outputLevel=Math.abs(Number(c.audioOutputLevel))/32767,v.decodingCNG=Number(c.googDecodingCNG),v.decodingCTN=Number(c.googDecodingCTN),v.decodingCTSG=Number(c.googDecodingCTSG),v.decodingNormal=Number(c.googDecodingNormal),v.decodingPLC=Number(c.googDecodingPLC),v.decodingPLCCNG=Number(c.googDecodingPLCCNG),v.expandRate=Number(c.googExpandRate),v.accelerateRate=Number(c.googAccelerateRate),v.preemptiveExpandRate=Number(c.googPreemptiveExpandRate),v.secondaryDecodedRate=Number(c.googSecondaryDecodedRate),v.speechExpandRate=Number(c.googSpeechExpandRate),v.preferredJitterBufferMs=Number(c.googPreferredJitterBufferMs),v.jitterBufferMs=Number(c.googJitterBufferMs),v.jitterMs=Number(c.googJitterReceived),v.bytes=Number(c.bytesReceived),v.packets=Number(c.packetsReceived),v.packetsLost=Number(c.packetsLost),v.ssrc=Number(c.ssrc),v.receivedFrames=Number(c.googDecodingCTN)||Number(c.packetsReceived),v.droppedFrames=Number(c.googDecodingPLC)+Number(c.googDecodingPLCCNG)||Number(c.packetsLost),v.receivedFrames>0&&!s.isFirstAudioReceived[v.ssrc]&&(s.onFirstAudioReceived&&s.onFirstAudioReceived(v.ssrc),s.isFirstAudioReceived[v.ssrc]=!0),v.decodingNormal>0&&!s.isFirstAudioDecoded[v.ssrc]&&(s.onFirstAudioDecoded&&s.onFirstAudioDecoded(v.ssrc),s.isFirstAudioDecoded[v.ssrc]=!0),s._stats.audioRecv.push(v);break;case"audio_send":var C=Go(hT);C.codec=c.googCodecName,C.inputLevel=Math.abs(Number(c.audioInputLevel))/32767,C.aecReturnLoss=Number(c.googEchoCancellationReturnLoss||0),C.aecReturnLossEnhancement=Number(c.googEchoCancellationReturnLossEnhancement||0),C.residualEchoLikelihood=Number(c.googResidualEchoLikelihood||0),C.residualEchoLikelihoodRecentMax=Number(c.googResidualEchoLikelihoodRecentMax||0),C.bytes=Number(c.bytesSent),C.packets=Number(c.packetsSent),C.packetsLost=Number(c.packetsLost),C.ssrc=Number(c.ssrc),C.rttMs=Number(c.googRtt||0),s._stats.rtt=C.rttMs,s._stats.audioSend.push(C)}})},t.prototype._getStats=function(){var n=this;return new Promise(function(s,c){n.pc.getStats(s,c)})},t.prototype.statsResponsesToObjects=function(n){var s=[];return n.result().forEach(function(c){var d={id:c.id,timestamp:c.timestamp.valueOf().toString(),type:c.type};c.names().forEach(function(h){d[h]=c.stat(h)}),s.push(d)}),s},t}(Xg);(function(r){r.CERTIFICATE="certificate",r.CODEC="codec",r.CANDIDATE_PAIR="candidate-pair",r.LOCAL_CANDIDATE="local-candidate",r.REMOTE_CANDIDATE="remote-candidate",r.INBOUND="inbound-rtp",r.TRACK="track",r.OUTBOUND="outbound-rtp",r.PC="peer-connection",r.REMOTE_INBOUND="remote-inbound-rtp",r.REMOTE_OUTBOUND="remote-outbound-rtp",r.TRANSPORT="transport",r.CSRC="csrc",r.DATA_CHANNEL="data-channel",r.STREAM="stream",r.SENDER="sender",r.RECEIVER="receiver"})(Wa||(Wa={}));var fT=function(r){function t(){var n=r!==null&&r.apply(this,arguments)||this;return n._stats=eu,n.lastDecodeVideoReceiverStats=new Map,n.lastVideoFramesRecv=new Map,n.lastVideoFramesSent=new Map,n.lastVideoFramesDecode=new Map,n.lastVideoJBDelay=new Map,n.lastAudioJBDelay=new Map,n.mediaBytesSent=new Map,n.mediaBytesRetransmit=new Map,n.mediaBytesTargetEncode=new Map,n.lastEncoderMs=new Map,n}return Yg(t,r),t.prototype.updateStats=function(){return Jg(this,void 0,void 0,function(){var n,s=this;return zg(this,function(c){switch(c.label){case 0:return n=this,[4,this.pc.getStats()];case 1:return n.report=c.sent(),this._stats=Go(eu),this.report.forEach(function(d){switch(d.type){case Wa.OUTBOUND:d.mediaType==="audio"?s.processAudioOutboundStats(d):d.mediaType==="video"&&s.processVideoOutboundStats(d);break;case Wa.INBOUND:d.mediaType==="audio"?s.processAudioInboundStats(d):d.mediaType==="video"&&s.processVideoInboundStats(d);break;case Wa.TRANSPORT:var h=s.report.get(d.selectedCandidatePairId);h&&s.processCandidatePairStats(h);break;case Wa.CANDIDATE_PAIR:d.selected&&s.processCandidatePairStats(d)}}),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats,[2]}})})},t.prototype.processCandidatePairStats=function(n){this._stats.sendBandwidth=n.availableOutgoingBitrate||0,n.currentRoundTripTime&&(this._stats.rtt=1e3*n.currentRoundTripTime),this._stats.videoSend.forEach(function(s){!s.rttMs&&n.currentRoundTripTime&&(s.rttMs=1e3*n.currentRoundTripTime)}),this._stats.audioSend.forEach(function(s){!s.rttMs&&n.currentRoundTripTime&&(s.rttMs=1e3*n.currentRoundTripTime)})},t.prototype.processAudioInboundStats=function(n){var s=this._stats.audioRecv.find(function(c){return c.ssrc===n.ssrc});s||(s=Go(pT),this._stats.audioRecv.push(s)),s.ssrc=n.ssrc,s.packets=n.packetsReceived,s.packetsLost=n.packetsLost,s.bytes=n.bytesReceived,s.jitterMs=1e3*n.jitter,n.trackId&&this.processAudioTrackReceiverStats(n.trackId,s),n.codecId&&(s.codec=this.getCodecFromCodecStats(n.codecId)),s.receivedFrames||(s.receivedFrames=n.packetsReceived),s.droppedFrames||(s.droppedFrames=n.packetsLost),s.receivedFrames>0&&!this.isFirstAudioReceived[s.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(s.ssrc),this.isFirstAudioReceived[s.ssrc]=!0),s.outputLevel&&s.outputLevel>0&&!this.isFirstAudioDecoded[s.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(s.ssrc),this.isFirstAudioDecoded[s.ssrc]=!0)},t.prototype.processVideoInboundStats=function(n){var s=this._stats.videoRecv.find(function(v){return v.ssrc===n.ssrc});s||(s=Go(dT),this._stats.videoRecv.push(s)),s.ssrc=n.ssrc,s.packets=n.packetsReceived,s.packetsLost=n.packetsLost,s.bytes=n.bytesReceived,s.firsCount=n.firCount,s.nacksCount=n.nackCount,s.plisCount=n.pliCount,s.framesDecodeCount=n.framesDecoded;var c=this.lastDecodeVideoReceiverStats.get(s.ssrc),d=this.lastVideoFramesDecode.get(s.ssrc),h=Date.now();if(s.framesDecodeCount>0&&!this.isFirstVideoDecoded[s.ssrc]){var p=s.decodedFrame?s.decodedFrame.width:0,A=s.decodedFrame?s.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(s.ssrc,p,A),this.isFirstVideoDecoded[s.ssrc]=!0}if(c){var m=c.stats,E=h-c.lts;s.framesDecodeFreezeTime=m.framesDecodeFreezeTime,s.framesDecodeInterval=m.framesDecodeInterval,s.framesDecodeCount>m.framesDecodeCount&&this.isFirstVideoDecoded?(c.lts=Date.now(),s.framesDecodeInterval=E,s.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(n.ssrc))?s.framesDecodeFreezeTime+=s.framesDecodeInterval:this.setVideoIsReady2(parseInt(n.ssrc,10),!0))):s.framesDecodeCount<m.framesDecodeCount&&(s.framesDecodeInterval=0)}d&&h-d.lts>=800?(s.decodeFrameRate=Math.round((s.framesDecodeCount-d.count)/((h-d.lts)/1e3)),this.lastVideoFramesDecode.set(s.ssrc,{count:s.framesDecodeCount,lts:h,rate:s.decodeFrameRate})):d?s.decodeFrameRate=d.rate:this.lastVideoFramesDecode.set(s.ssrc,{count:s.framesDecodeCount,lts:h,rate:0}),n.totalDecodeTime&&(s.decodeMs=1e3*n.totalDecodeTime),n.trackId&&this.processVideoTrackReceiverStats(n.trackId,s),n.codecId&&(s.codec=this.getCodecFromCodecStats(n.codecId)),n.framerateMean&&(s.framesRateFirefox=n.framerateMean),s.packets>0&&!this.isFirstVideoReceived[s.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(s.ssrc),this.isFirstVideoReceived[s.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(s.ssrc,{stats:qg({},s),lts:c?c.lts:Date.now()})},t.prototype.processVideoOutboundStats=function(n){var s=this._stats.videoSend.find(function(C){return C.ssrc===n.ssrc});s||(s=Go(uT),this._stats.videoSend.push(s));var c=this.mediaBytesSent.get(n.ssrc);if(c?c.add(n.bytesSent):((h=new Hg(10)).add(n.bytesSent),this.mediaBytesSent.set(n.ssrc,h)),n.retransmittedBytesSent!==void 0){var d=this.mediaBytesRetransmit.get(n.ssrc);d?d.add(n.retransmittedBytesSent):((h=new Hg(10)).add(n.retransmittedBytesSent),this.mediaBytesRetransmit.set(n.ssrc,h))}if(n.totalEncodedBytesTarget){var h,p=this.mediaBytesTargetEncode.get(n.ssrc);p?p.add(n.totalEncodedBytesTarget):((h=new Hg(10)).add(n.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(n.ssrc,h))}if(s.ssrc=n.ssrc,s.bytes=n.bytesSent,s.packets=n.packetsSent,s.firsCount=n.firCount,s.nacksCount=n.nackCount,s.plisCount=n.pliCount,s.frameCount=n.framesEncoded,s.adaptionChangeReason=n.qualityLimitationReason,n.totalEncodeTime&&n.framesEncoded){var A=this.lastEncoderMs.get(n.ssrc);if(!A||A.lastFrameCount>n.framesEncoded)s.avgEncodeMs=1e3*n.totalEncodeTime/n.framesEncoded;else{var m=n.framesEncoded-A.lastFrameCount,E=n.totalEncodeTime-A.lastEncoderTime;s.avgEncodeMs=1e3*E/m}this.lastEncoderMs.set(n.ssrc,{lastFrameCount:n.framesEncoded,lastEncoderTime:n.totalEncodeTime,lts:Date.now()})}if(n.codecId&&(s.codec=this.getCodecFromCodecStats(n.codecId)),n.mediaSourceId&&this.processVideoMediaSource(n.mediaSourceId,s),n.trackId&&this.processVideoTrackSenderStats(n.trackId,s),n.remoteId)this.processRemoteInboundStats(n.remoteId,s);else{var v=this.findRemoteStatsId(n.ssrc,Wa.REMOTE_INBOUND);v&&this.processRemoteInboundStats(v,s)}},t.prototype.processAudioOutboundStats=function(n){var s=this._stats.audioSend.find(function(d){return d.ssrc===n.ssrc});if(s||(s=Go(hT),this._stats.audioSend.push(s)),s.ssrc=n.ssrc,s.packets=n.packetsSent,s.bytes=n.bytesSent,n.mediaSourceId&&this.processAudioMediaSource(n.mediaSourceId,s),n.codecId&&(s.codec=this.getCodecFromCodecStats(n.codecId)),n.trackId&&this.processAudioTrackSenderStats(n.trackId,s),n.remoteId)this.processRemoteInboundStats(n.remoteId,s);else{var c=this.findRemoteStatsId(n.ssrc,Wa.REMOTE_INBOUND);c&&this.processRemoteInboundStats(c,s)}},t.prototype.findRemoteStatsId=function(n,s){var c=Array.from(this.report.values()).find(function(d){return d.type===s&&d.ssrc===n});return c?c.id:null},t.prototype.processVideoMediaSource=function(n,s){var c=this.report.get(n);c&&c.width&&c.height&&c.framesPerSecond&&(s.inputFrame={width:c.width,height:c.height,frameRate:c.framesPerSecond})},t.prototype.processAudioMediaSource=function(n,s){var c=this.report.get(n);c&&(s.inputLevel=c.audioLevel)},t.prototype.processVideoTrackSenderStats=function(n,s){var c=this.report.get(n);if(c){var d=0,h=Date.now(),p=this.lastVideoFramesSent.get(s.ssrc);p&&h-p.lts>=800?(d=Math.round((c.framesSent-p.count)/((h-p.lts)/1e3)),this.lastVideoFramesSent.set(s.ssrc,{count:c.framesSent,lts:h,rate:d})):p?d=p.rate:this.lastVideoFramesSent.set(s.ssrc,{count:c.framesSent,lts:h,rate:0}),s.sentFrame={width:c.frameWidth,height:c.frameHeight,frameRate:d}}},t.prototype.processVideoTrackReceiverStats=function(n,s){var c=this.report.get(n);if(c){var d=this.lastVideoFramesRecv.get(s.ssrc),h=Date.now();s.framesReceivedCount=c.framesReceived;var p=0;if(d&&h-d.lts>=800?(p=Math.round((c.framesReceived-d.count)/((h-d.lts)/1e3)),this.lastVideoFramesRecv.set(s.ssrc,{count:c.framesReceived,lts:h,rate:p})):d?p=d.rate:this.lastVideoFramesRecv.set(s.ssrc,{count:c.framesReceived,lts:h,rate:0}),s.receivedFrame={width:c.frameWidth||0,height:c.frameHeight||0,frameRate:p||0},s.decodedFrame={width:c.frameWidth||0,height:c.frameHeight||0,frameRate:s.decodeFrameRate||0},s.outputFrame={width:c.frameWidth||0,height:c.frameHeight||0,frameRate:s.decodeFrameRate||0},c.jitterBufferDelay&&c.jitterBufferEmittedCount){var A=this.lastVideoJBDelay.get(s.ssrc);this.lastVideoJBDelay.set(s.ssrc,{jitterBufferDelay:c.jitterBufferDelay,jitterBufferEmittedCount:c.jitterBufferEmittedCount}),A||(A={jitterBufferDelay:0,jitterBufferEmittedCount:0});var m=1e3*(c.jitterBufferDelay-A.jitterBufferDelay)/(c.jitterBufferEmittedCount-A.jitterBufferEmittedCount);s.jitterBufferMs=m,s.currentDelayMs=Math.round(m)}}},t.prototype.processAudioTrackSenderStats=function(n,s){var c=this.report.get(n);c&&(s.aecReturnLoss=c.echoReturnLoss||0,s.aecReturnLossEnhancement=c.echoReturnLossEnhancement||0)},t.prototype.processAudioTrackReceiverStats=function(n,s){var c=this.report.get(n);if(c){if(c.removedSamplesForAcceleration&&c.totalSamplesReceived&&(s.accelerateRate=c.removedSamplesForAcceleration/c.totalSamplesReceived),c.jitterBufferDelay&&c.jitterBufferEmittedCount){var d=this.lastAudioJBDelay.get(s.ssrc);this.lastAudioJBDelay.set(s.ssrc,{jitterBufferDelay:c.jitterBufferDelay,jitterBufferEmittedCount:c.jitterBufferEmittedCount}),d||(d={jitterBufferDelay:0,jitterBufferEmittedCount:0});var h=1e3*(c.jitterBufferDelay-d.jitterBufferDelay)/(c.jitterBufferEmittedCount-d.jitterBufferEmittedCount);s.jitterBufferMs=Math.round(h)}s.outputLevel=c.audioLevel;var p=1920;c.totalSamplesDuration&&c.totalSamplesReceived&&(p=c.totalSamplesReceived/c.totalSamplesDuration/50,s.receivedFrames=Math.round(c.totalSamplesReceived/p)),c.concealedSamples&&(s.droppedFrames=Math.round(c.concealedSamples/p))}},t.prototype.processRemoteInboundStats=function(n,s){var c=this.report.get(n);c&&(s.packetsLost=c.packetsLost,c.roundTripTime&&(s.rttMs=1e3*c.roundTripTime))},t.prototype.getCodecFromCodecStats=function(n){var s=this.report.get(n);if(!s)return"";var c=s.mimeType.match(/\/(.*)$/);return c&&c[1]?c[1]:""},t.prototype.updateSendBitrate=function(){var n=0,s=null,c=null;this.mediaBytesSent.forEach(function(h){n+=h.diffMean()}),this.mediaBytesRetransmit.forEach(function(h){s=s===null?h.diffMean():s+h.diffMean()}),this.mediaBytesTargetEncode.forEach(function(h){c=c===null?h.diffMean():c+h.diffMean()});var d=s!==null?n-s:n;this._stats.bitrate={actualEncoded:8*d/(this.options.updateInterval/1e3),transmit:8*n/(this.options.updateInterval/1e3)},s!==null&&(this._stats.bitrate.retransmit=8*s/(this.options.updateInterval/1e3)),c!==null&&(this._stats.bitrate.targetEncoded=8*c/(this.options.updateInterval/1e3))},t}(Xg),CL=function(r){function t(){return r!==null&&r.apply(this,arguments)||this}return Yg(t,r),t.prototype.updateStats=function(){return Promise.resolve()},t}(Xg);function AT(r,t,n,s){t===void 0&&(t=250),n===void 0&&(n=8),s===void 0&&(s=500);var c,d=(c=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i))&&c[0]?Number(c[0].split("/")[1]):null;return d?d<76?new IL(r,{updateInterval:t,lossRateInterval:n,freezeRateLimit:s}):new fT(r,{updateInterval:t,lossRateInterval:n,freezeRateLimit:s}):function(h){return!!window.RTCStatsReport&&h.getStats()instanceof Promise}(r)?new fT(r,{updateInterval:t,lossRateInterval:n,freezeRateLimit:s}):new CL(r,{updateInterval:t,lossRateInterval:n,freezeRateLimit:s})}function gT(r,t){var n=le(r);if(ee){var s=ee(r);t&&(s=kt(s).call(s,function(c){return Wt(r,c).enumerable})),n.push.apply(n,s)}return n}var no=function(r,t,n,s){var c,d=arguments.length,h=d<3?t:s===null?s=Wt(t,n):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(r,t,n,s);else for(var p=r.length-1;p>=0;p--)(c=r[p])&&(h=(d<3?c(h):d>3?c(t,n,h):c(t,n))||h);return d>3&&h&&se(t,n,h),h},Me=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)};class Kn extends MC{constructor(t,n){super(t,n),this.useRTX=!1,this.localCandidateCount=0,this.allCandidatesReceived=!1,this.mutex=new Un("P2PConnection-mutex"),this.store=n,this.peerConnection=new RTCPeerConnection(Kn.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=AT(this.peerConnection,void 0,void 0,Gr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}async establish(){try{const t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=yp(t.sdp),s=rT(t.sdp,!this.useRTX,!1,["opus"]);return this.localCapabilities=s,this.initialOffer=t,function(c){for(var d=1;d<arguments.length;d++){var h,p=arguments[d]!=null?arguments[d]:{};if(d%2)G(h=gT(Object(p),!0)).call(h,function(m){_r(c,m,p[m])});else if(te)He(c,te(p));else{var A;G(A=gT(Object(p))).call(A,function(m){se(c,m,Wt(p,m))})}}return c}({},n,{rtpCapabilities:s,offerSDP:t.sdp})}catch(t){throw new M(L.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(t,n,s,c,d,h,p,A){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new vL({remoteIceParameters:t,remoteDtlsParameters:n,candidates:s,remoteRTPCapabilities:c,remoteSetup:d,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec,cname:h,ip:p,port:A});const m=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(m){throw new M(L.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(m.toString()))}}send(t,n){var s=this;return tu(function*(){const c=yield Cn(s.mutex.lock());try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const d=ft(t).call(t,C=>s.peerConnection.addTrack(C._mediaStreamTrack)),h=yield Cn(s.peerConnection.createOffer()),p=Vo.parse(h.sdp),A=ft(t).call(t,C=>{var b;const y=C._mediaStreamTrack,w=_t(b=p.mediaDescriptions).call(b,k=>k.attributes.mid===y.kind);if(!w)throw new Error("Cannot extract ssrc from mediaDescription.");return function(k,P,V){var j;const st=kt(j=k.attributes.ssrcs).call(j,Et=>Et.attributes.label===P),mt=k.attributes.ssrcGroups;if(st.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(mt&&st.length>1){const Et=_t(mt).call(mt,At=>{var $;return Ft($=At.ssrcIds).call($,st[0].ssrcId)!==-1});return Et?[{ssrcId:Et.ssrcIds[0],rtx:V?Et.ssrcIds[1]:void 0}]:[{ssrcId:st[0].ssrcId}]}return[{ssrcId:st[0].ssrcId}]}(w,y.id,s.useRTX)});let m;try{m=yield A}catch(C){throw G(d).call(d,b=>{Pi()&&b.replaceTrack(null),s.peerConnection.removeTrack(b)}),C}const E=s.mungSendOfferSDP(h.sdp,t);s.remoteSDP.receive(t,n,m);const v=s.remoteSDP.toString();return yield Cn(s.peerConnection.setLocalDescription({type:"offer",sdp:E})),yield Cn(s.applySendEncodings(d,t)),yield Cn(s.peerConnection.setRemoteDescription({type:"answer",sdp:v})),ft(t).call(t,(C,b)=>{const y=C._mediaStreamTrack.id;return{localSSRC:A[b],id:y}})}catch(d){throw new M(L.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{c()}})()}async stopSending(t){try{var n;if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const s=kt(n=this.peerConnection.getSenders()).call(n,h=>{var p;return Ft(t).call(t,((p=h.track)===null||p===void 0?void 0:p.id)||"")!==-1});if(s.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");ft(s).call(s,h=>{Pi()&&h.replaceTrack(null),this.peerConnection.removeTrack(h)});const c=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(c),this.remoteSDP.stopReceiving(t);const d=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new M(L.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}}async receive(t,n,s,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{id:d,mslabel:h}=this.remoteSDP.send(t,n,c),p=new dt((E,v)=>{const C=vn(()=>{v(new Error("Cannot receive track, id: ".concat(d)))},1e4),b=y=>{const w=we();if(w.name==="Safari"&&Number(w.version)===11&&y.track.id!==d&&y.streams[0].id===h){var k;const P=y.streams[0].getTracks()[0];return(k=this.remoteSDP)===null||k===void 0||k.updateTrackLabel(t,d,y.track.id),this.peerConnection.removeEventListener("track",b),clearTimeout(C),void E(P)}if(y.track.id===d)return this.peerConnection.removeEventListener("track",b),clearTimeout(C),void E(y.track)};this.peerConnection.addEventListener("track",b)}),A=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:A});const m=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(m),{track:await p,id:d}}catch(d){throw new M(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const s=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(s)}catch(n){throw new M(L.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{var n;if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=kt(n=this.peerConnection.getSenders()).call(n,c=>{var d;return Ft(t).call(t,((d=c.track)===null||d===void 0?void 0:d.id)||"")!==-1});if(s.length!==t.length)throw new Error("sender' length doesn't match mids' length.");ft(s).call(s,c=>{if(Pi()&&c.track)c.track.enabled=!1;else{var d;const h=c.getParameters();G(d=h.encodings).call(d,p=>p.active=!1),c.setParameters(h)}})}catch(s){throw new M(L.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(t){try{var n;if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=kt(n=this.peerConnection.getSenders()).call(n,h=>{var p;return Ft(t).call(t,((p=h.track)===null||p===void 0?void 0:p.id)||"")!==-1});if(s.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");ft(s).call(s,async h=>{if(Pi()&&h.track)h.track.enabled=!0;else{var p;const A=h.getParameters();G(p=A.encodings).call(p,m=>m.active=!0),await h.setParameters(A)}});const c=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(c);const d=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new M(L.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}async reEstablish(){const t=await this.peerConnection.createOffer({iceRestart:!0});if(!t.sdp)throw new Error("Cannot get SDP from restart offer.");return{iceParameters:yp(t.sdp).iceParameters,restartICE:async(n,s,c,d)=>this.restartICE(t,n,s,c,d),restartOfferSDP:t.sdp}}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const s=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(s.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const d=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new M(L.EXCHANGE_SDP_FAILED,s.toString())}}async updateSendParameters(t,n){var s;const c=kt(s=this.peerConnection.getSenders()).call(s,d=>{var h;return((h=d.track)===null||h===void 0?void 0:h.id)===t});c.length===1&&await this.applySendEncodings(c,[n])}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){var s;const c=_t(s=this.peerConnection.getSenders()).call(s,d=>{var h;return((h=d.track)===null||h===void 0?void 0:h.id)===n});c&&await c.replaceTrack(t._mediaStreamTrack)}async restartICE(t,n,s,c,d){try{if(!this.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");this.remoteSDP.restartICE(n,s,c,d);const h=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(t),await this.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(h){throw new M(L.EXCHANGE_SDP_FAILED,"P2PConnection.restartICE failed; ".concat(h.toString()))}}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,S.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},vn(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,S.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},ot("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[],sdpSemantics:"plan-b"};var s,c;return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Qh(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...Kn.turnServerConfigToIceServers(t.turnServer.servers)),n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...Kn.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),G(s=O(c=t.turnServer.servers).call(c,t.turnServer.serversFromGateway||[])).call(s,d=>{d.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){const n=[];return G(t).call(t,s=>{if(s.security){var c;s.tcpport&&n.push({username:s.username,credential:s.password,credentialType:"password",urls:O(c="turns:".concat(gS(s.turnServerURL),":")).call(c,s.tcpport,"?transport=tcp")})}else{var d,h;s.udpport&&n.push({username:s.username,credential:s.password,credentialType:"password",urls:O(d="turn:".concat(s.turnServerURL,":")).call(d,s.udpport,"?transport=udp")}),s.tcpport&&n.push({username:s.username,credential:s.password,credentialType:"password",urls:O(h="turn:".concat(s.turnServerURL,":")).call(h,s.tcpport,"?transport=tcp")})}}),n}async applySendEncodings(t,n){try{if(!Dr().supportSetRtpSenderParameters||t.length!==n.length)return;for(let d=0;d<t.length;d++){var s;const h=t[d],p=n[d];if(!p)continue;const A={},m={};if(p instanceof dr)switch(p._optimizationMode){case"motion":A.degradationPreference="maintain-framerate";break;case"detail":A.degradationPreference="maintain-resolution";break;default:A.degradationPreference="balanced"}if(ot("DSCP_TYPE")&&cl()){var c;const C=ot("DSCP_TYPE");zt(c=["very-low","low","medium","high"]).call(c,C)&&(m.networkPriority=C)}const E=h.getParameters(),v=(s=E.encodings)===null||s===void 0?void 0:s[0];v&&hr(v,m),hr(E,A),await h.setParameters(E)}}catch{S.debug("Apply RTPSendEncodings failed.")}}mungSendOfferSDP(t,n){const s=Vo.parse(t);return G(n).call(n,(c,d)=>{var h;const p=c._mediaStreamTrack,A=_t(h=s.mediaDescriptions).call(h,m=>m.attributes.mid===p.kind);A&&Tp(A,c)}),Vo.print(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,s)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,t,n,s)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0}}function io(r,t,n){const s=r[t];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(...c){const d=this.mutex,h=await d.lock("Locking from P2PConnection.".concat(t));try{return await s.apply(this,c)}finally{h()}},n}no([io,Me("design:type",Function),Me("design:paramtypes",[Object,Object,Array,Object,String,String,String,String]),Me("design:returntype",dt)],Kn.prototype,"connect",null),no([io,Me("design:type",Function),Me("design:paramtypes",[Array]),Me("design:returntype",dt)],Kn.prototype,"stopSending",null),no([io,Me("design:type",Function),Me("design:paramtypes",[String,Array,String,Object]),Me("design:returntype",dt)],Kn.prototype,"receive",null),no([io,Me("design:type",Function),Me("design:paramtypes",[Array]),Me("design:returntype",dt)],Kn.prototype,"stopReceiving",null),no([io,Me("design:type",Function),Me("design:paramtypes",[String]),Me("design:returntype",dt)],Kn.prototype,"muteRemote",null),no([io,Me("design:type",Function),Me("design:paramtypes",[String]),Me("design:returntype",dt)],Kn.prototype,"unmuteRemote",null),no([io,Me("design:type",Function),Me("design:paramtypes",[Array]),Me("design:returntype",dt)],Kn.prototype,"muteLocal",null),no([io,Me("design:type",Function),Me("design:paramtypes",[Array]),Me("design:returntype",dt)],Kn.prototype,"unmuteLocal",null),no([io,Me("design:type",Function),Me("design:paramtypes",[]),Me("design:returntype",dt)],Kn.prototype,"reEstablish",null),no([io,Me("design:type",Function),Me("design:paramtypes",[]),Me("design:returntype",void 0)],Kn.prototype,"close",null),no([io,Me("design:type",Function),Me("design:paramtypes",[String,la]),Me("design:returntype",dt)],Kn.prototype,"updateEncoderConfig",null),no([io,Me("design:type",Function),Me("design:paramtypes",[String,la]),Me("design:returntype",dt)],Kn.prototype,"updateSendParameters",null),no([io,Me("design:type",Function),Me("design:paramtypes",[la,String]),Me("design:returntype",dt)],Kn.prototype,"replaceTrack",null),no([io,Me("design:type",Function),Me("design:paramtypes",[Object,Object,Array,String,String]),Me("design:returntype",dt)],Kn.prototype,"restartICE",null);const mT=4e4;class SL{constructor(t){t=wn(t);const{remoteIceParameters:n,remoteDtlsParameters:s,candidates:c,remoteRTPCapabilities:d,remoteSetup:h,localCapabilities:p,cname:A,ip:m,port:E}=t,v=Vo.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`);this._rtpCapabilities=d,this._candidates=c,this._iceParameters=n,this._dtlsParameters=s,this._localCapabilities=p,this.setup=h,this.cname=A,this.ip=m,this.port=E,this.addressType=Ft(m).call(m,":")===-1?"IP4":"IP6";for(const w of v.mediaDescriptions){var C,b,y;if(w.media.port=this.port,G(C=w.connections).call(C,k=>{k.address=this.ip,k.addrtype=this.addressType}),w.attributes.rtcp?(w.attributes.rtcp.address=this.ip,w.attributes.rtcp.port=this.port,w.attributes.rtcp.addressType=this.addressType):w.attributes.rtcp={port:E,address:m,netType:"IN",addressType:this.addressType},w.attributes.iceUfrag=n.iceUfrag,w.attributes.icePwd=n.icePwd,w.attributes.fingerprints=s.fingerprints,w.attributes.candidates=c,w.attributes.setup=h,w.media.mediaType==="video"&&(w.media.fmts=ft(b=d.videoCodecs).call(b,k=>k.payloadType.toString(10)),w.attributes.payloads=d.videoCodecs,w.attributes.extmaps=d.videoExtensions,ot("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:k,ssrcGroups:P}=kl([{ssrcId:mT,rtx:ot("USE_RTX")?40001:void 0}],this.cname);w.attributes.ssrcs=k,w.attributes.ssrcGroups=P}if(w.media.mediaType==="audio"&&(w.media.fmts=ft(y=d.audioCodecs).call(y,k=>k.payloadType.toString(10)),w.attributes.payloads=d.audioCodecs,w.attributes.extmaps=d.audioExtensions,ot("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:k,ssrcGroups:P}=kl([{ssrcId:2e4}],this.cname);w.attributes.ssrcs=k,w.attributes.ssrcGroups=P}}this.sessionDesc=v,this.currentMidIndex=v.mediaDescriptions.length-1}get localCapabilities(){return wn(this._localCapabilities)}get rtpCapabilities(){return wn(this._rtpCapabilities)}get candidates(){return wn(this._candidates)}get iceParameters(){return wn(this._iceParameters)}get dtlsParameters(){return wn(this._dtlsParameters)}preloadRemoteMedia(){const t=ot("PRELOAD_MEDIA_COUNT"),n=this.rtpCapabilities,s=this.candidates,c=this.dtlsParameters,d=this.iceParameters;for(let A=1;A<t;A++){var h,p;const m=2*A+2e4,E=2*A+mT,{ssrcs:v,ssrcGroups:C}=kl([{ssrcId:m}],this.cname),{ssrcs:b,ssrcGroups:y}=kl([{ssrcId:E,rtx:ot("USE_RTX")?E+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:this.port,protos:["UDP","TLS","RTP","SAVPF"],fmts:ft(h=n.videoCodecs).call(h,w=>w.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:this.addressType,address:this.ip}],bandwidths:[],attributes:{iceUfrag:d.iceUfrag,icePwd:d.icePwd,unrecognized:[],candidates:s,extmaps:n.videoExtensions,fingerprints:c.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:b,ssrcGroups:y,rtcpFeedbackWildcards:[],payloads:n.videoCodecs,rtcp:{port:this.port,netType:"IN",addressType:this.addressType,address:this.ip},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*A)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:this.port,protos:["UDP","TLS","RTP","SAVPF"],fmts:ft(p=n.audioCodecs).call(p,w=>w.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:this.addressType,address:this.ip}],bandwidths:[],attributes:{iceUfrag:d.iceUfrag,icePwd:d.icePwd,unrecognized:[],candidates:s,extmaps:n.audioExtensions,fingerprints:c.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:v,ssrcGroups:C,rtcpFeedbackWildcards:[],payloads:n.audioCodecs,rtcp:{port:this.port,netType:"IN",addressType:this.addressType,address:this.ip},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*A+1)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return Vo.print(this.sessionDesc)}send(t,n,s,c){const{ssrcs:d,ssrcGroups:h}=kl(n,this.cname,s),p=this.findPreloadMediaDesc(d);if(p){if(c&&(c.tcc||c.remb)){var A;const m=Ft(A=this.sessionDesc.mediaDescriptions).call(A,p);return this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(p,c),{mid:p.attributes.mid,needExchangeSDP:!0}}return{mid:p.attributes.mid,needExchangeSDP:!1}}{const m=this.findAvailableMediaIndex(t);if(Pi()){if(m!==-1&&m!==1){const E=wn(this.sessionDesc.mediaDescriptions[m]);return E.attributes.direction="sendonly",E.attributes.ssrcs=d,E.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(E,c),{mid:E.attributes.mid,needExchangeSDP:!0}}{const E=this.createOrRecycleSendMedia(t,d,h,"sendonly",c);return this.updateBundleMids(),{mid:E.attributes.mid,needExchangeSDP:!0}}}if(m!==-1){const E=wn(this.sessionDesc.mediaDescriptions[m]);return E.attributes.direction="sendonly",E.attributes.ssrcs=d,E.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(E,c),{mid:E.attributes.mid,needExchangeSDP:!0}}{const E=this.createOrRecycleSendMedia(t,d,h,"sendonly",c);return this.updateBundleMids(),{mid:E.attributes.mid,needExchangeSDP:!0}}}}stopSending(t){var n;const s=kt(n=this.sessionDesc.mediaDescriptions).call(n,c=>c.attributes.mid&&Ft(t).call(t,c.attributes.mid)!==-1);if(s.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");G(s).call(s,c=>{c.attributes.mid==="0"||Gr()||Pi()?c.attributes.ssrcs=[]:(c.attributes.ssrcs=[],c.attributes.direction="inactive",c.media.port="0")}),this.updateBundleMids()}mute(t){var n;const s=_t(n=this.sessionDesc.mediaDescriptions).call(n,c=>c.attributes.mid===t);if(!s)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));s.attributes.direction="inactive"}unmute(t){var n;const s=_t(n=this.sessionDesc.mediaDescriptions).call(n,c=>c.attributes.mid===t);if(!s)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));s.attributes.direction="sendonly"}muteRemote(t){var n;const s=kt(n=this.sessionDesc.mediaDescriptions).call(n,c=>zt(t).call(t,c.attributes.mid||""));if(s.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");G(s).call(s,c=>{c.attributes.direction="inactive"})}unmuteRemote(t){var n;const s=kt(n=this.sessionDesc.mediaDescriptions).call(n,c=>zt(t).call(t,c.attributes.mid||""));if(s.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");G(s).call(s,c=>{c.attributes.direction="recvonly"})}receive(t,n,s){G(t).call(t,(c,d)=>{this.createOrRecycleRecvMedia(c,[],"recvonly",n,s[d])}),this.updateBundleMids()}stopReceiving(t){var n;const s=kt(n=this.sessionDesc.mediaDescriptions).call(n,c=>Ft(t).call(t,c.attributes.mid)!==-1);if(s.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");G(s).call(s,c=>{c.media.port="0",c.attributes.direction="inactive"}),this.updateBundleMids()}restartICE(t,n,s,c){var d,h;t=wn(t),n=wn(n),this._iceParameters=t,this._candidates=n,this.ip=s,this.port=c,this.addressType=Ft(d=this.ip).call(d,":")===-1?"IP4":"IP6",G(h=this.sessionDesc.mediaDescriptions).call(h,p=>{var A;p.media.port!=="0"&&(p.media.port=this.port),G(A=p.connections).call(A,m=>{m.address=this.ip,m.addrtype=this.addressType}),p.attributes.rtcp?(p.attributes.rtcp.address=this.ip,p.attributes.rtcp.port=this.port,p.attributes.rtcp.addressType=this.addressType):p.attributes.rtcp={port:c,address:s,netType:"IN",addressType:this.addressType},p.attributes.iceUfrag=t.iceUfrag,p.attributes.icePwd=t.icePwd,p.attributes.candidates=this.candidates})}predictReceivingMids(t){const n=[];for(let s=0;s<t;s++)n.push((this.currentMidIndex+s+1).toString(10));return n}findAvailableMediaIndex(t){var n;return ti(n=this.sessionDesc.mediaDescriptions).call(n,s=>s.media.mediaType===t&&s.media.port!=="0"&&(s.attributes.direction==="sendonly"||s.attributes.direction==="sendrecv")&&s.attributes.ssrcs.length===0)}createOrRecycleRecvMedia(t,n,s,c,d){const h=t._mediaStreamTrack.kind;let p;if(h===nr.VIDEO){var A,m,E,v,C;ot("H264_PROFILE_LEVEL_ID")&&c==="h264"&&(p=kt(m=this.rtpCapabilities.videoCodecs).call(m,V=>{var j,st,mt;return zt(j=((st=V.rtpMap)===null||st===void 0?void 0:st.encodingName.toLowerCase())||"").call(j,c)&&(V==null||(mt=V.fmtp)===null||mt===void 0?void 0:mt.parameters["profile-level-id"])===ot("H264_PROFILE_LEVEL_ID")})),(!p||((A=p)===null||A===void 0?void 0:A.length)===0)&&(p=kt(E=this.rtpCapabilities.videoCodecs).call(E,V=>{var j,st;return zt(j=((st=V.rtpMap)===null||st===void 0?void 0:st.encodingName.toLowerCase())||"").call(j,c)})),p.length===0&&(S.warning(O(v="codec ".concat(c," not included in rtpCapabilities, fallback to default payloads: ")).call(v,(C=this.rtpCapabilities.videoCodecs[0].rtpMap)===null||C===void 0?void 0:C.encodingName)),p=this.rtpCapabilities.videoCodecs)}else p=this.rtpCapabilities.audioCodecs;const b=h===nr.VIDEO?this.rtpCapabilities.videoExtensions:this.rtpCapabilities.audioExtensions;this.currentMidIndex+=1;const y="".concat(this.currentMidIndex);let w={media:{mediaType:h,port:this.port,protos:["UDP","TLS","RTP","SAVPF"],fmts:ft(p).call(p,V=>V.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:this.addressType,address:this.ip}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:b,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:p,rtcp:{port:this.port,netType:"IN",addressType:this.addressType,address:this.ip},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(y)}};w=this.mungRecvMediaDsec(w,t,d);const k=this.findFirstClosedMedia(h);if(k){var P;const V=Ft(P=this.sessionDesc.mediaDescriptions).call(P,k);this.sessionDesc.mediaDescriptions[V]=w}else this.sessionDesc.mediaDescriptions.push(w);return w}createOrRecycleSendMedia(t,n,s,c,d){const h=t===nr.VIDEO?this.rtpCapabilities.videoCodecs:this.rtpCapabilities.audioCodecs,p=t===nr.VIDEO?this.rtpCapabilities.videoExtensions:this.rtpCapabilities.audioExtensions;this.currentMidIndex+=1;const A="".concat(this.currentMidIndex);let m={media:{mediaType:t,port:this.port,protos:["UDP","TLS","RTP","SAVPF"],fmts:ft(h).call(h,C=>C.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:this.addressType,address:this.ip}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:p,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:s,rtcpFeedbackWildcards:[],payloads:h,rtcp:{port:this.port,netType:"IN",addressType:this.addressType,address:this.ip},setup:this.setup,direction:c,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(A)}};m=this.mungSendMediaDesc(m,d);const E=this.findFirstClosedMedia(t);if(E){var v;const C=Ft(v=this.sessionDesc.mediaDescriptions).call(v,E);this.sessionDesc.mediaDescriptions[C]=m}else this.sessionDesc.mediaDescriptions.push(m);return m}updateBundleMids(){var t,n;this.sessionDesc.attributes.groups[0].identificationTag=ft(t=kt(n=this.sessionDesc.mediaDescriptions).call(n,s=>s.media.port!=="0")).call(t,s=>s.attributes.mid)}mungRecvMediaDsec(t,n,s){const c=wn(t);return iT(c),Tp(c,n),oT(c,n),function(d){var h;if(d.media.mediaType!=="video")return;const p=we();if(p.name!==Re.SAFARI&&p.os!==Mn.IOS)return;const A=ti(h=d.attributes.extmaps).call(h,E=>/video-orientation/g.test(E.extensionName));var m;A!==-1&&Ye(m=d.attributes.extmaps).call(m,A,1)}(c),sT(c,s,this.localCapabilities),c}mungSendMediaDesc(t,n){const s=wn(t);return sT(s,n,this.localCapabilities),s}updateRecvMedia(t,n){var s;const c=ti(s=this.sessionDesc.mediaDescriptions).call(s,d=>d.attributes.mid===t);if(c!==-1){const d=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[c],n);this.sessionDesc.mediaDescriptions[c]=d}}bumpMid(t){this.currentMidIndex+=t}findFirstClosedMedia(t){var n;return _t(n=this.sessionDesc.mediaDescriptions).call(n,s=>Gr()?s.media.port==="0"&&s.media.mediaType===t:s.media.port==="0")}findPreloadMediaDesc(t){var n;return _t(n=this.sessionDesc.mediaDescriptions).call(n,s=>{var c,d;return((c=s.attributes)===null||c===void 0||(d=c.ssrcs[0])===null||d===void 0?void 0:d.ssrcId)===t[0].ssrcId})}}function ET(r,t){var n=le(r);if(ee){var s=ee(r);t&&(s=kt(s).call(s,function(c){return Wt(r,c).enumerable})),n.push.apply(n,s)}return n}var oo=function(r,t,n,s){var c,d=arguments.length,h=d<3?t:s===null?s=Wt(t,n):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(r,t,n,s);else for(var p=r.length-1;p>=0;p--)(c=r[p])&&(h=(d<3?c(h):d>3?c(t,n,h):c(t,n))||h);return d>3&&h&&se(t,n,h),h},Pe=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)};class Hn extends MC{constructor(t,n){super(t,n),this.useRTX=ot("USE_RTX"),this.localCandidateCount=0,this.allCandidatesReceived=!1,this.mutex=new Un("P2PConnection-mutex"),this.store=n,this.peerConnection=new RTCPeerConnection(Hn.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=AT(this.peerConnection,void 0,void 0,Gr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const t=await this.peerConnection.createOffer();if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=yp(t.sdp),s=await async function(c,d,h,p){const A=new RTCPeerConnection;A.addTransceiver("video",{direction:"sendrecv"}),A.addTransceiver("audio",{direction:"sendrecv"});const m=await A.createOffer();if(!m.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const E=rT(m.sdp,c,d,h,p);try{A.close()}catch{}return E}(!this.useRTX,!1,["opus"]);return this.localCapabilities=s,this.initialOffer=t,function(c){for(var d=1;d<arguments.length;d++){var h,p=arguments[d]!=null?arguments[d]:{};if(d%2)G(h=ET(Object(p),!0)).call(h,function(m){_r(c,m,p[m])});else if(te)He(c,te(p));else{var A;G(A=ET(Object(p))).call(A,function(m){se(c,m,Wt(p,m))})}}return c}({},n,{rtpCapabilities:s,offerSDP:t.sdp})}catch(t){throw new M(L.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(t,n,s,c,d,h,p,A){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new SL({remoteIceParameters:t,remoteDtlsParameters:n,candidates:s,remoteRTPCapabilities:c,remoteSetup:d,localCapabilities:this.localCapabilities,cname:h,ip:p,port:A});const m=this.remoteSDP.toString(),E=this.logSDPExchange(this.initialOffer.sdp||"","offer","local","connect");await this.peerConnection.setLocalDescription(this.initialOffer),E==null||E(m),await this.peerConnection.setRemoteDescription({type:"answer",sdp:m});const v=this.peerConnection.getTransceivers()[0];if(v!=null&&v.receiver&&this.tryBindTransportEvents(v.receiver),ot("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia();const C=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:C});const b=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(b)}}catch(m){throw new M(L.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(m.toString()))}}send(t,n){var s=this;return tu(function*(){const c=yield Cn(s.mutex.lock());try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const d=[];G(t).call(t,y=>{const w=s.peerConnection.addTransceiver(y._mediaStreamTrack,{direction:"sendonly"});d.push(w)}),Gr()&&ot("SIMULCAST")===!0&&(yield Cn(s.applySimulcastForFirefox(d,t)));const h=yield Cn(s.peerConnection.createOffer()),p=s.remoteSDP.predictReceivingMids(t.length),A=s.mungSendOfferSDP(h.sdp,t,p),m=Vo.parse(A),E=ft(p).call(p,y=>{var w;const k=_t(w=m.mediaDescriptions).call(w,P=>P.attributes.mid===y);if(!k)throw new Error("Cannot extract ssrc from mediaDescription.");return function(P,V){var j,st;const mt=[],Et=kt(j=P.attributes.ssrcGroups).call(j,W=>W.semantic==="FID"),At=_t(st=P.attributes.ssrcGroups).call(st,W=>W.semantic==="SIM"),$=P.attributes.ssrcs;var rt;if(At)G(rt=At.ssrcIds).call(rt,W=>{var H;const U=(H=_t(Et).call(Et,Tt=>Tt.ssrcIds[0]===W))===null||H===void 0?void 0:H.ssrcIds[1];mt.push({ssrcId:W,rtx:V?U:void 0})});else if(Et.length>0){const W=Et[0].ssrcIds[0],H=Et[0].ssrcIds[1];mt.push({ssrcId:W,rtx:V?H:void 0})}else{if($.length===0)throw new Error("No ssrcs found on local media description.");mt.push({ssrcId:$[0].ssrcId})}return mt}(k,s.useRTX)});let v;try{v=yield E}catch(y){throw G(d).call(d,w=>{var k;return(k=w.stop)===null||k===void 0?void 0:k.call(w)}),s.remoteSDP.bumpMid(d.length),y}s.remoteSDP.receive(t,n,v);const C=s.remoteSDP.toString(),b=s.logSDPExchange(A,"offer","local","send");return yield Cn(s.peerConnection.setLocalDescription({type:"offer",sdp:A})),yield Cn(s.applySimulcastEncodings(d,t)),yield Cn(s.applySendEncodings(d,t)),b==null||b(C),yield Cn(s.peerConnection.setRemoteDescription({type:"answer",sdp:C})),ft(d).call(d,(y,w)=>{const k=p[w];return{localSSRC:E[w],id:k,transceiver:y}})}catch(d){throw new M(L.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{c()}})()}async stopSending(t){try{var n;if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const s=kt(n=this.peerConnection.getTransceivers()).call(n,p=>Ft(t).call(t,p.mid)!==-1);if(s.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");ft(s).call(s,p=>{var A;p.direction="inactive",(A=p.stop)===null||A===void 0||A.call(p)});const c=await this.peerConnection.createOffer(),d=this.logSDPExchange(c.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(c),this.remoteSDP.stopReceiving(t);const h=this.remoteSDP.toString();d==null||d(h),await this.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(s){throw new M(L.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}}async receive(t,n,s,c){try{var d;if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:h,needExchangeSDP:p}=this.remoteSDP.send(t,n,s,c);if(p){const m=this.remoteSDP.toString(),E=this.logSDPExchange(m,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:m});const v=await this.peerConnection.createAnswer();E==null||E(v.sdp||""),await this.peerConnection.setLocalDescription(v),S.debug("[P2PConnection] receive ".concat(t," by exchanging SDP."))}else S.debug("[P2PConnection] receive ".concat(t," no need to exchange SDP."));const A=_t(d=this.peerConnection.getTransceivers()).call(d,m=>m.mid===h);if(!A)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:A.receiver.track,id:h}}catch(h){throw new M(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(h.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),s=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const c=await this.peerConnection.createAnswer();s==null||s(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(n){throw new M(L.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const n=this.remoteSDP.toString(),s=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const c=await this.peerConnection.createAnswer();s==null||s(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(n){throw new M(L.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const n=this.remoteSDP.toString(),s=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const c=await this.peerConnection.createAnswer();s==null||s(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(n){throw new M(L.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(t){try{var n;if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=kt(n=this.peerConnection.getTransceivers()).call(n,p=>p.mid&&Ft(t).call(t,p.mid)!==-1);if(s.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");ft(s).call(s,p=>{p.direction="inactive"});const c=await this.peerConnection.createOffer(),d=this.logSDPExchange(c.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(c),this.remoteSDP.muteRemote(t);const h=this.remoteSDP.toString();d==null||d(h),await this.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(s){throw new M(L.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(t){try{var n;if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=kt(n=this.peerConnection.getTransceivers()).call(n,p=>p.mid&&Ft(t).call(t,p.mid)!==-1);if(s.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");ft(s).call(s,async(p,A)=>{p.direction="sendonly"});const c=await this.peerConnection.createOffer(),d=this.logSDPExchange(c.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(c),this.remoteSDP.unmuteRemote(t);const h=this.remoteSDP.toString();d==null||d(h),await this.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(s){throw new M(L.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}async reEstablish(){const t=await this.peerConnection.createOffer({iceRestart:!0});if(!t.sdp)throw new Error("Cannot get SDP from restart offer.");return{iceParameters:yp(t.sdp).iceParameters,restartICE:async(n,s,c,d)=>this.restartICE(t,n,s,c,d),restartOfferSDP:t.sdp}}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const s=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(s.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const d=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new M(L.EXCHANGE_SDP_FAILED,s.toString())}}async updateSendParameters(t,n){var s;const c=kt(s=this.peerConnection.getTransceivers()).call(s,d=>d.mid===t);c.length===1&&(this.isVP8Simulcast(n)?Gr()||await this.applySimulcastEncodings(c,[n]):await this.applySendEncodings(c,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){var s;const c=_t(s=this.peerConnection.getTransceivers()).call(s,d=>d.mid===n);c&&await c.sender.replaceTrack(t._mediaStreamTrack)}async restartICE(t,n,s,c,d){try{if(!this.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");this.remoteSDP.restartICE(n,s,c,d);const h=this.remoteSDP.toString(),p=this.logSDPExchange(t.sdp||"","offer","local","restartICE");await this.peerConnection.setLocalDescription(t),p==null||p(h),await this.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(h){throw new M(L.EXCHANGE_SDP_FAILED,"P2PConnection.restartICE failed; ".concat(h.toString()))}}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,S.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},vn(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,S.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},ot("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]};var s,c;return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Qh(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...Hn.turnServerConfigToIceServers(t.turnServer.servers)),n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...Hn.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),G(s=O(c=t.turnServer.servers).call(c,t.turnServer.serversFromGateway||[])).call(s,d=>{d.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){const n=[];return G(t).call(t,s=>{if(s.security){var c;s.tcpport&&n.push({username:s.username,credential:s.password,credentialType:"password",urls:O(c="turns:".concat(gS(s.turnServerURL),":")).call(c,s.tcpport,"?transport=tcp")})}else{var d,h;s.udpport&&n.push({username:s.username,credential:s.password,credentialType:"password",urls:O(d="turn:".concat(s.turnServerURL,":")).call(d,s.udpport,"?transport=udp")}),s.tcpport&&n.push({username:s.username,credential:s.password,credentialType:"password",urls:O(h="turn:".concat(s.turnServerURL,":")).call(h,s.tcpport,"?transport=tcp")})}}),n}tryBindTransportEvents(t){t.transport&&(this.transportEventReceiver=t,t.transport.onstatechange=()=>{var n,s;(n=t.transport)!==null&&n!==void 0&&n.state&&((s=this.onDTLSTransportStateChange)===null||s===void 0||s.call(this,t.transport.state))},t.transport.onerror=n=>{var s;(s=this.onDTLSTransportError)===null||s===void 0||s.call(this,n.error)},t.transport.iceTransport&&(t.transport.iceTransport.onstatechange=()=>{var n,s,c;(n=t.transport)!==null&&n!==void 0&&n.iceTransport.state&&((s=this.onICETransportStateChange)===null||s===void 0||s.call(this,(c=t.transport)===null||c===void 0?void 0:c.iceTransport.state))}))}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async applySendEncodings(t,n){try{if(!Dr().supportSetRtpSenderParameters||t.length!==n.length)return;for(let v=0;v<t.length;v++){const C=t[v],b=n[v];if(b&&b instanceof dr){var s,c,d;if(this.isVP8Simulcast(b))continue;const y={},w={};switch(b._optimizationMode){case"motion":y.degradationPreference="maintain-framerate";break;case"detail":y.degradationPreference="maintain-resolution";break;default:y.degradationPreference="balanced"}var h,p,A,m;if((s=b._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&(w.maxBitrate=1e3*((h=b._encoderConfig)===null||h===void 0?void 0:h.bitrateMax)),zt(c=b._hints).call(c,Xn.LOW_STREAM)&&((p=b._encoderConfig)!==null&&p!==void 0&&p.frameRate&&(w.maxFramerate=Qa(b._encoderConfig.frameRate)),(A=b._encoderConfig)!==null&&A!==void 0&&A.scaleResolutionDownBy&&((m=b._encoderConfig)===null||m===void 0?void 0:m.scaleResolutionDownBy)>1&&(w.scaleResolutionDownBy=b._encoderConfig.scaleResolutionDownBy)),ot("DSCP_TYPE")&&cl()){var E;const V=ot("DSCP_TYPE");zt(E=["very-low","low","medium","high"]).call(E,V)&&(w.networkPriority=V)}const k=C.sender.getParameters(),P=(d=k.encodings)===null||d===void 0?void 0:d[0];Gr()&&!P&&(y.encodings=[w]),P&&hr(P,w),hr(k,y),await C.sender.setParameters(k)}}}catch{S.debug("Apply RTPSendEncodings failed.")}}mungSendOfferSDP(t,n,s){const c=Vo.parse(t);return G(n).call(n,(d,h)=>{var p;const A=s[h],m=_t(p=c.mediaDescriptions).call(p,E=>E.attributes.mid===A);m&&(Tp(m,d),function(E,v,C){var b;if(Gr()||E.media.mediaType!=="video"||!(v instanceof dr)||C!=="vp9"&&C!=="vp8"||C==="vp8"&&!ot("SIMULCAST")||v._scalabiltyMode===void 0||v._scalabiltyMode.numSpatialLayers<=1)return;const y=C==="vp8"?2:v._scalabiltyMode.numSpatialLayers,w=E.attributes.ssrcs[0],k=_t(b=E.attributes.ssrcGroups).call(b,V=>V.semantic==="FID"&&V.ssrcIds[0]===w.ssrcId),P={semantic:"SIM",ssrcIds:[w.ssrcId]};for(let V=1;V<y;V++)E.attributes.ssrcs.push({ssrcId:w.ssrcId+V,attributes:wn(w.attributes)}),P.ssrcIds.push(w.ssrcId+V),k&&(E.attributes.ssrcs.push({ssrcId:k.ssrcIds[1]+V,attributes:wn(w.attributes)}),E.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[w.ssrcId+V,k.ssrcIds[1]+V]}));E.attributes.ssrcGroups.unshift(P)}(m,d,this.store.codec))}),Vo.print(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,s)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,t,n,s)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let A=0;A<t.length;A++){var s,c,d,h,p;const m=t[A],E=n[A];if(E instanceof dr&&!zt(s=E._hints).call(s,Xn.LOW_STREAM)&&(c=E._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((d=E._encoderConfig)===null||d===void 0?void 0:d.bitrateMax)>200&&(h=E._scalabiltyMode)!==null&&h!==void 0&&h.numSpatialLayers&&((p=E._scalabiltyMode)===null||p===void 0?void 0:p.numSpatialLayers)>1&&this.store.codec==="vp8"){const v={},C={high:1e3*(E._encoderConfig.bitrateMax-50),medium:5e4};v.encodings=[{rid:"m",active:!0,maxBitrate:C.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:C.high}];const b=m.sender.getParameters();await m.sender.setParameters(hr(b,v))}}}async applySimulcastEncodings(t,n){if(!Gr()&&t.length===n.length)for(let s=0;s<t.length;s++){const c=n[s];if(c instanceof dr&&this.isVP8Simulcast(c)){const d=t[s],h={},p={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:p.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:p.medium,scaleResolutionDownBy:4}];const A=d.sender.getParameters();await d.sender.setParameters(hr(A,h))}}}isVP8Simulcast(t){var n,s,c,d,h;return t instanceof dr&&ot("SIMULCAST")&&this.store.codec==="vp8"&&!zt(n=t._hints).call(n,Xn.LOW_STREAM)&&((s=t._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)&&((c=t._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&((d=t._scalabiltyMode)===null||d===void 0?void 0:d.numSpatialLayers)&&((h=t._scalabiltyMode)===null||h===void 0?void 0:h.numSpatialLayers)>1}logSDPExchange(t,n,s,c){var d,h;if((ot("UPLOAD_LOG")||ot("SDP_LOGGING"))&&(S.upload(O(d=O(h="exchanging ".concat(s," ")).call(h,n," SDP during P2PConnection.")).call(d,c,`
`),t),n==="offer"))return p=>{this.logSDPExchange(p,"answer",s==="local"?"remote":"local",c)}}}function so(r,t,n){const s=r[t];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(...c){const d=this.mutex,h=await d.lock("Locking from P2PConnection.".concat(t));try{return await s.apply(this,c)}finally{h()}},n}function _T(r,t){let n=document.createElement("video"),s=document.createElement("canvas");n.setAttribute("style","display:none"),s.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),s.width=Qa(t.width),s.height=Qa(t.height);const c=Qa(t.framerate||15);document.body.append(n),document.body.append(s);let d=r._mediaStreamTrack;n.srcObject=new MediaStream([d]),n.play();const h=s.getContext("2d");if(!h)throw new M(L.UNEXPECTED_ERROR,"can not get canvas context");const p=Dr(),A=s.captureStream(p.supportRequestFrame?0:c).getVideoTracks()[0],m=Jh(()=>(()=>{if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const y=n.videoWidth,w=n.videoHeight/y,k=s.width*w;var v,C,b;Math.abs(k-s.height)>=2&&(S.debug("adjust low stream resolution",O(v=O(C=O(b="".concat(s.width,"x")).call(b,s.height," -> ")).call(C,s.width,"x")).call(v,k)),s.height=k)}h.drawImage(n,0,0,s.width,s.height),A.requestFrame&&A.requestFrame(),d!==r._mediaStreamTrack&&(d=r._mediaStreamTrack,n.srcObject=new MediaStream([d]))})(),c),E=A.stop;return A.stop=()=>{E.call(A),m(),n.remove(),s.width=0,s.remove(),s=null,n=null,S.debug("clean low stream renderer")},A}function vT(r,t){var n=le(r);if(ee){var s=ee(r);t&&(s=kt(s).call(s,function(c){return Wt(r,c).enumerable})),n.push.apply(n,s)}return n}function Zg(r){for(var t=1;t<arguments.length;t++){var n,s=arguments[t]!=null?arguments[t]:{};if(t%2)G(n=vT(Object(s),!0)).call(n,function(d){_r(r,d,s[d])});else if(te)He(r,te(s));else{var c;G(c=vT(Object(s))).call(c,function(d){se(r,d,Wt(s,d))})}}return r}oo([so,Pe("design:type",Function),Pe("design:paramtypes",[Object,Object,Array,Object,String,String,String,String]),Pe("design:returntype",dt)],Hn.prototype,"connect",null),oo([so,Pe("design:type",Function),Pe("design:paramtypes",[Array]),Pe("design:returntype",dt)],Hn.prototype,"stopSending",null),oo([so,Pe("design:type",Function),Pe("design:paramtypes",[String,Array,String,Object]),Pe("design:returntype",dt)],Hn.prototype,"receive",null),oo([so,Pe("design:type",Function),Pe("design:paramtypes",[Array]),Pe("design:returntype",dt)],Hn.prototype,"stopReceiving",null),oo([so,Pe("design:type",Function),Pe("design:paramtypes",[String]),Pe("design:returntype",dt)],Hn.prototype,"muteRemote",null),oo([so,Pe("design:type",Function),Pe("design:paramtypes",[String]),Pe("design:returntype",dt)],Hn.prototype,"unmuteRemote",null),oo([so,Pe("design:type",Function),Pe("design:paramtypes",[Array]),Pe("design:returntype",dt)],Hn.prototype,"muteLocal",null),oo([so,Pe("design:type",Function),Pe("design:paramtypes",[Array]),Pe("design:returntype",dt)],Hn.prototype,"unmuteLocal",null),oo([so,Pe("design:type",Function),Pe("design:paramtypes",[]),Pe("design:returntype",dt)],Hn.prototype,"reEstablish",null),oo([so,Pe("design:type",Function),Pe("design:paramtypes",[]),Pe("design:returntype",void 0)],Hn.prototype,"close",null),oo([so,Pe("design:type",Function),Pe("design:paramtypes",[String,la]),Pe("design:returntype",dt)],Hn.prototype,"updateEncoderConfig",null),oo([so,Pe("design:type",Function),Pe("design:paramtypes",[String,la]),Pe("design:returntype",dt)],Hn.prototype,"updateSendParameters",null),oo([so,Pe("design:type",Function),Pe("design:paramtypes",[la,String]),Pe("design:returntype",dt)],Hn.prototype,"replaceTrack",null),oo([so,Pe("design:type",Function),Pe("design:paramtypes",[Object,Object,Array,String,String]),Pe("design:returntype",dt)],Hn.prototype,"restartICE",null);class IT extends $C{constructor(t,n,s,c){var d,h,p;super(t,O(d=O(h=O(p="track-".concat(t.kind,"-")).call(p,n,"-")).call(h,c.clientId,"_")).call(d,Le(5,""))),this._isDestroyed=!1,this._userId=n,this._uintId=s,this.store=c}getUserId(){return this._userId}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource()}_destroy(){this._isDestroyed=!0,S.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}}class $g extends IT{constructor(t,n,s,c){super(t,n,s,c),this._videoVisibleTimer=null,this.trackMediaType="video",this.updateMediaStreamTrackResolution()}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Gn.PLAYING)}getStats(){return ks(()=>{S.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Io(this,Jt.GET_STATS)||Zg({},Gh)}play(t,n={}){const s=gt.reportApiInvoke(null,{tag:Yt.TRACER,name:Kt.REMOTE_VIDEO_TRACK_PLAY,options:[this.getTrackId(),typeof t=="string"?t:"HTMLElement",n]});if(typeof t=="string"){const h=document.getElementById(t);var c;h?t=h:(S.warning(O(c="[".concat(this.getTrackId(),'] can not find "#')).call(c,t,'" element, use document.body')),t=document.body)}S.debug("[".concat(this.getTrackId(),"] start video playback"),ht(n));const d=Zg({fit:"cover"},n,{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(d):(this._player=new _p(d),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,performance.now()),this.emit(fl.FIRST_FRAME_DECODED)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=window.setInterval(()=>{try{const h=this.getVideoElementVisibleStatus();this.emit(fl.VIDEO_ELEMENT_VISIBLE_STATUS,h)}catch{}},ot("CHECK_VIDEO_VISIBLE_INTERVAL")),s.onSuccess()}stop(){const t=gt.reportApiInvoke(null,{tag:Yt.TRACER,name:Kt.REMOTE_VIDEO_TRACK_STOP,options:[this.getTrackId()]});if(!this._player)return t.onSuccess();this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._player.destroy(),this._player=void 0,S.debug("[".concat(this.getTrackId(),"] stop video playback")),t.onSuccess()}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){ep(this._originMediaStreamTrack).then(([t,n])=>{this._videoHeight=n,this._videoWidth=t}).catch(Cl)}_updatePlayerSource(){S.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var t,n;const s=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),c={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:s==null?void 0:s.parentElement},{element:d,slot:h}=c;if(this.isPlaying&&d instanceof HTMLVideoElement&&h instanceof HTMLElement){const p=Vg.checkOneElementVisible(d),A=hr({},p);return A.visible||gt.reportApiInvoke(null,{tag:Yt.TRACER,name:Kt.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]}).onSuccess("Not visible because of ".concat(A.reason)),A}return}catch(s){throw new M(L.GET_VIDEO_ELEMENT_VISIBLE_ERROR,s.message)}}}class tm extends IT{constructor(t,n,s,c){super(t,n,s,c),this.trackMediaType="audio",this._useAudioElement=!0,this._volume=100,this._source=new zh(t,!0),this._source.once(Bo.RECEIVE_TRACK_BUFFER,()=>{this.emit(fl.FIRST_FRAME_DECODED)})}get isPlaying(){return this._useAudioElement?Yr.isPlaying(this.getTrackId()):this._source.isPlayed}setAudioFrameCallback(t,n=4096){if(!t)return this._source.removeAllListeners(Bo.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(n),this._source.removeAllListeners(Bo.ON_AUDIO_BUFFER),this._source.on(Bo.ON_AUDIO_BUFFER,s=>t(s))}setVolume(t){const n=gt.reportApiInvoke(null,{tag:Yt.TRACER,name:Kt.REMOTE_AUDIO_SET_VOLUME,options:[this.getTrackId(),t]},300);this._volume=t,this._useAudioElement?Yr.setVolume(this.getTrackId(),t):this._source.setVolume(t/100),n.onSuccess()}async setPlaybackDevice(t){const n=gt.reportApiInvoke(null,{tag:Yt.TRACER,name:Kt.REMOTE_AUDIO_SET_OUTPUT_DEVICE,options:[this.getTrackId(),t]});if(!this._useAudioElement)throw new M(L.NOT_SUPPORTED,"your browser does not support setting the audio output device");try{await Yr.setSinkID(this.getTrackId(),t)}catch(s){throw n.onError(s),s}n.onSuccess()}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return ks(()=>{S.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Io(this,Jt.GET_STATS)||Zg({},Vh)}play(){const t=gt.reportApiInvoke(null,{tag:Yt.TRACER,name:Kt.REMOTE_AUDIO_TRACK_PLAY,options:[this.getTrackId()]});S.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(S.debug("[".concat(this.getTrackId(),"] use audio element to play")),Yr.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play(),t.onSuccess()}stop(){const t=gt.reportApiInvoke(null,{tag:Yt.TRACER,name:Kt.REMOTE_AUDIO_TRACK_STOP,options:[this.getTrackId()]});S.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Yr.stop(this.getTrackId()):this._source.stop(),t.onSuccess()}_destroy(){super._destroy(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){S.debug("[".concat(this.getTrackId(),"] update player source track")),this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Yr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}}function CT(r,t){var n=le(r);if(ee){var s=ee(r);t&&(s=kt(s).call(s,function(c){return Wt(r,c).enumerable})),n.push.apply(n,s)}return n}function yL(r){for(var t=1;t<arguments.length;t++){var n,s=arguments[t]!=null?arguments[t]:{};if(t%2)G(n=CT(Object(s),!0)).call(n,function(d){_r(r,d,s[d])});else if(te)He(r,te(s));else{var c;G(c=CT(Object(s))).call(c,function(d){se(r,d,Wt(s,d))})}}return r}class TL extends Hr{constructor(){super(),this.uploadUnplinkStarted=!1,this.uploadDownlinkStarted=!1}startUploadUplinkStats(){this.uploadUnplinkStarted||(this.uploadUnplinkStarted=!0,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkStatsUploadInterval=window.setInterval(()=>{var t;const n=(t=this.requestStats)===null||t===void 0?void 0:t.call(this);n&&(this.uploadUplinkStats(n,this.lastStats),this.lastStats=n)},3e3),this.uplinkStatsUploadSlowInterval&&window.clearInterval(this.uplinkStatsUploadSlowInterval),this.uplinkStatsUploadSlowInterval=window.setInterval(()=>{var t;const n=(t=this.requestStats)===null||t===void 0?void 0:t.call(this);n&&this.uploadSlowUplinkStats(n)},6e4),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkRelatedStatsUploadInterval=window.setInterval(()=>{var t;const n=(t=this.requestStats)===null||t===void 0?void 0:t.call(this);n&&this.uploadRelatedUplinkStats(n,this.lastStats),this.lastStats=n},1e3))}uploadUplinkStats(t,n){var s;const c=((s=this.requestLocalMedia)===null||s===void 0?void 0:s.call(this))||[];G(c).call(c,([d,{track:h,ssrcs:p}])=>{switch(d){case xt.LocalVideoLowTrack:case xt.LocalVideoTrack:{const m=function(v,C,b){var y,w;const k=_t(y=C.videoSend).call(y,V=>V.ssrc===v);if(!k)return null;const P={id:Le(10,""),timestamp:new Date(C.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:k.ssrc.toString()};switch(P.A_vstd=b._originMediaStreamTrack&&!b._originMediaStreamTrack.enabled||!b._mediaStreamTrack.enabled?"1":"0",k.sentFrame&&(P.A_fhs=k.sentFrame.height.toString(),P.A_frs=k.sentFrame.frameRate.toString(),P.A_fws=k.sentFrame.width.toString()),k.adaptionChangeReason){case"none":P.A_ac="0";break;case"cpu":P.A_ac="1";break;case"bandwidth":P.A_ac="2";break;case"other":P.A_ac="3"}return P.A_lvps=jA[b._player?b._player.videoElementStatus:"uninit"].toString(),P.A_nr=(w=k.nacksCount)===null||w===void 0?void 0:w.toString(),k.avgEncodeMs&&(P.A_aem=k.avgEncodeMs.toFixed(0).toString()),P}(p[0].ssrcId,t,h),E=_S(p[0].ssrcId,t,n);m&&on(()=>{var v;return(v=this.requestUpload)===null||v===void 0?void 0:v.call(this,Po.PUBLISH_STATS,{stream_type:d===xt.LocalVideoLowTrack?"low":"high",stats:yL({},m,{},E)})});break}case xt.LocalAudioTrack:{const m=function(E,v,C){var b;const y=_t(b=v.audioSend).call(b,k=>k.ssrc===E);if(!y)return null;const w={id:Le(10,""),timestamp:new Date(v.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:y.ssrc.toString()};return w.A_astd=C._originMediaStreamTrack.enabled&&C._mediaStreamTrack.enabled?"0":"1",y.inputLevel?w.A_ail=Math.round(100*y.inputLevel).toString():w.A_ail=Math.round(100*C._source.getAccurateVolumeLevel()).toString(),w.A_apil=Math.round(100*C._source.getAccurateVolumeLevel()).toString(),w}(p[0].ssrcId,t,h);m&&on(()=>{var E;return(E=this.requestUpload)===null||E===void 0?void 0:E.call(this,Po.PUBLISH_STATS,{stream_type:"high",stats:m})});break}}const A=function(m){const E={id:"bweforvideo",timestamp:new Date(m.timestamp).toISOString(),type:"VideoBwe"};return m.bitrate.retransmit&&(E.A_rb=m.bitrate.retransmit.toString()),m.bitrate.targetEncoded&&(E.A_teb=m.bitrate.targetEncoded.toString()),E.A_aeb=m.bitrate.actualEncoded.toString(),E.A_tb=m.bitrate.transmit.toString(),m.sendBandwidth!==void 0&&(E.A_asb=m.sendBandwidth.toString()),E}(t);A&&on(()=>{var m;return(m=this.requestUpload)===null||m===void 0?void 0:m.call(this,Po.PUBLISH_STATS,{stream_type:d===xt.LocalVideoLowTrack?"low":"high",stats:A})})})}uploadSlowUplinkStats(t){var n,s;const c=kt(n=((s=this.requestLocalMedia)===null||s===void 0?void 0:s.call(this))||[]).call(n,([d])=>d===xt.LocalVideoLowTrack||d===xt.LocalVideoTrack);G(c).call(c,([d,{ssrcs:h}])=>{const p=_S(h[0].ssrcId,t);p&&on(()=>{var A;return(A=this.requestUpload)===null||A===void 0?void 0:A.call(this,Po.PUBLISH_STATS,{stream_type:d===xt.LocalVideoLowTrack?"low":"high",stats:p})})})}uploadRelatedUplinkStats(t,n){var s,c;const d=kt(s=((c=this.requestLocalMedia)===null||c===void 0?void 0:c.call(this))||[]).call(s,([h])=>h===xt.LocalVideoLowTrack||h===xt.LocalVideoTrack);G(d).call(d,([h,{ssrcs:p}])=>{const A=function(m,E){var v;const C=_t(v=E.videoSend).call(v,b=>b.ssrc===m);return C?{mediaType:"video",isVideoMute:!1,frameRateInput:C.inputFrame&&C.inputFrame.frameRate.toString(),frameRateSent:C.sentFrame&&C.sentFrame.frameRate.toString(),googRtt:C.rttMs.toString()}:null}(p[0].ssrcId,t);A&&on(()=>{var m;(m=this.requestUpload)===null||m===void 0||m.call(this,Po.PUBLISH_RELATED_STATS,{stream_type:h===xt.LocalVideoLowTrack?"low":"high",stats:A})})})}stopUploadUplinkStats(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkStatsUploadInterval=void 0,this.uplinkRelatedStatsUploadInterval=void 0)}startUploadDownlinkStats(){this.uploadDownlinkStarted||(this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval),this.downlinkStatsUploadInterval=window.setInterval(()=>{var t;const n=(t=this.requestStats)===null||t===void 0?void 0:t.call(this);n&&(this.uploadDownlinkStats(n,this.lastStats),this.lastStats=n)},3e3),this.downlinkStatsUploadSlowInterval&&window.clearInterval(this.downlinkStatsUploadSlowInterval),this.downlinkStatsUploadSlowInterval=window.setInterval(()=>{var t;const n=(t=this.requestStats)===null||t===void 0?void 0:t.call(this);n&&this.uploadSlowDownlinkStats(n)},6e4),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkRelatedStatsUploadInterval=window.setInterval(()=>{var t;const n=(t=this.requestStats)===null||t===void 0?void 0:t.call(this);n&&(this.uploadRelatedDownlinkStats(n,this.lastStats),this.lastStats=n)},1e3))}uploadDownlinkStats(t,n){var s;const c=((s=this.requestRemoteMedia)===null||s===void 0?void 0:s.call(this))||[];G(c).call(c,([d,h])=>{if(h.has(nr.VIDEO)&&d.videoTrack){const p=d.videoTrack?function(A,m,E){var v;const C=_t(v=m.videoRecv).call(v,w=>w.ssrc===A);if(!C)return null;const b={id:Le(10,""),timestamp:new Date(m.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:C.ssrc.toString()};var y;return b.bytesReceived=C.bytes.toString(),b.packetsLost=C.packetsLost.toString(),b.packetsReceived=C.packets.toString(),C.framesRateFirefox&&(b.A_frr=C.framesRateFirefox.toString()),C.receivedFrame&&(b.A_frr=C.receivedFrame.frameRate.toString()),b.A_frd=C.decodeFrameRate.toString(),C.outputFrame&&(b.A_fro=C.outputFrame.frameRate.toString()),C.jitterBufferMs!==void 0&&(b.A_jbm=Math.floor(C.jitterBufferMs).toString()),C.currentDelayMs!==void 0&&(b.A_cdm=Math.floor(C.currentDelayMs).toString()),b.A_fs=C.firsCount.toString(),b.A_ns=C.nacksCount.toString(),b.A_ps=C.plisCount.toString(),E&&(b.A_vrtd=E._originMediaStreamTrack.enabled&&E._mediaStreamTrack.enabled?"0":"1"),E._player&&E._player.freezeTimeCounterList.length>0&&(b.A_vrft=Ye(y=E._player.freezeTimeCounterList).call(y,0,1)[0].toString()),b.A_rvps=jA[E._player?E._player.videoElementStatus:"uninit"].toString(),b}(d._videoSSRC,t,d.videoTrack):void 0;p&&on(()=>{var A;return(A=this.requestUpload)===null||A===void 0?void 0:A.call(this,Po.SUBSCRIBE_STATS,{stream_id:d.uid,stats:p})})}if(h.has(nr.AUDIO)&&d.audioTrack){const p=d.audioTrack?function(A,m,E){var v;const C=_t(v=m.audioRecv).call(v,y=>y.ssrc===A);if(!C)return null;const b={id:Le(10,""),timestamp:new Date(m.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:C.ssrc.toString()};return b.bytesReceived=C.bytes.toString(),b.packetsLost=C.packetsLost.toString(),b.packetsReceived=C.packets.toString(),C.outputLevel?b.A_aol=Math.round(100*C.outputLevel).toString():b.A_aol=Math.round(100*E._source.getAccurateVolumeLevel()).toString(),b.A_apol=Math.round(100*E._source.getAccurateVolumeLevel()).toString(),E&&(b.A_artd=E._originMediaStreamTrack.enabled&&E._mediaStreamTrack.enabled?"0":"1"),b.A_jr=C.jitterMs.toString(),b.A_jbm=Math.floor(C.jitterBufferMs).toString(),b.A_cdm=Math.floor(C.jitterBufferMs).toString(),b.A_raps=jA[Yr.getPlayerState(E.getTrackId())].toString(),b}(d._audioSSRC,t,d.audioTrack):void 0;p&&on(()=>{var A;return(A=this.requestUpload)===null||A===void 0?void 0:A.call(this,Po.SUBSCRIBE_STATS,{stream_id:d.uid,stats:p})})}})}uploadSlowDownlinkStats(t){}uploadRelatedDownlinkStats(t,n){var s;const c=((s=this.requestRemoteMedia)===null||s===void 0?void 0:s.call(this))||[];G(c).call(c,([d,h])=>{if(h.has(nr.VIDEO)&&d.videoTrack){var p;const A=(d._videoSSRC&&((p=this.requestVideoIsReady)===null||p===void 0?void 0:p.call(this,d._videoSSRC))||!1)===!0,m=function(E,v,C,b,y,w){var k,P;const V=_t(k=C.videoRecv).call(k,Et=>Et.ssrc===E),j=y?_t(P=y.videoRecv).call(P,Et=>Et.ssrc===E):void 0;if(!V)return null;const st=vl.isRemoteVideoFreeze(w,V,j)&&v,mt={mediaType:"video",isVideoMute:!1,peerId:b,frameRateReceived:V.receivedFrame&&V.receivedFrame.frameRate.toString(),frameRateDecoded:V.decodedFrame&&V.decodedFrame.frameRate.toString(),isFreeze:st,bytesReceived:V.bytes.toString(),packetsReceived:V.packets.toString(),packetsLost:V.packetsLost.toString()};return V.framesRateFirefox&&(mt.frameRateDecoded=V.framesRateFirefox.toString(),mt.frameRateReceived=V.framesRateFirefox.toString()),mt}(d._videoSSRC,A,t,d.uid,n,d.videoTrack);m&&on(()=>{var E;(E=this.requestUpload)===null||E===void 0||E.call(this,Po.SUBSCRIBE_RELATED_STATS,{stream_id:d.uid,stats:m})})}if(h.has(nr.AUDIO)&&d.audioTrack){const A=function(m,E,v,C){var b;const y=_t(b=E.audioRecv).call(b,k=>k.ssrc===m);if(!y)return null;const w=vl.isRemoteAudioFreeze(C);return{mediaType:"audio",isAudioMute:!1,peerId:v,googJitterReceived:y.jitterMs.toString(),isFreeze:w,bytesReceived:y.bytes.toString(),packetsReceived:y.packets.toString(),packetsLost:y.packetsLost.toString(),frameReceived:y.receivedFrames.toString(),frameDropped:y.droppedFrames.toString()}}(d._audioSSRC,t,d.uid,d.audioTrack);A&&on(()=>{var m;(m=this.requestUpload)===null||m===void 0||m.call(this,Po.SUBSCRIBE_RELATED_STATS,{stream_id:d.uid,stats:A})})}})}stopUploadDownlinkStats(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkStatsUploadInterval=void 0,this.downlinkRelatedStatsUploadInterval=void 0)}}function ST(r,t){var n=le(r);if(ee){var s=ee(r);t&&(s=kt(s).call(s,function(c){return Wt(r,c).enumerable})),n.push.apply(n,s)}return n}function Rp(r){for(var t=1;t<arguments.length;t++){var n,s=arguments[t]!=null?arguments[t]:{};if(t%2)G(n=ST(Object(s),!0)).call(n,function(d){_r(r,d,s[d])});else if(te)He(r,te(s));else{var c;G(c=ST(Object(s))).call(c,function(d){se(r,d,Wt(s,d))})}}return r}var hs=function(r,t,n,s){var c,d=arguments.length,h=d<3?t:s===null?s=Wt(t,n):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(r,t,n,s);else for(var p=r.length-1;p>=0;p--)(c=r[p])&&(h=(d<3?c(h):d>3?c(t,n,h):c(t,n))||h);return d>3&&h&&se(t,n,h),h},fr=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)};class jo extends Hr{constructor(t,n){super(),this.localTrackMap=new re,this.remoteUserMap=new re,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.isPlanB=!1,this.iceFailedCount=0,this.dtlsFailedCount=0,this.mutex=new Un("P2PChannel-mutex"),this._state=$i.Disconnected,this.handleMuteLocalTrack=async(s,c,d)=>{const h=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection)return void d(new M(L.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));await this.waitTillConnected();const p=this.filterTobeMutedTracks(s);if(p.length===0)return void c();await this.connection.muteLocal(ft(p).call(p,([,{id:m}])=>m));const A=this.createMuteMessage(p);await Xe(this,ze.RequestMuteLocal,A),c()}catch(p){d(p)}finally{h()}},this.handleUnmuteLocalTrack=async(s,c,d)=>{const h=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection)return void d(new M(L.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));await this.waitTillConnected();const p=this.filterTobeUnmutedTracks(s);if(p.length===0)return void c();await this.connection.unmuteLocal(ft(p).call(p,([,{id:m}])=>m));const A=this.createUnmuteMessage(p);await Xe(this,ze.RequestUnmuteLocal,A),c()}catch(p){d(p)}finally{h()}},this.handleUpdateVideoEncoder=async(s,c,d)=>{const h=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const p=this.localTrackMap.get(xt.LocalVideoTrack);if(!this.connection||!p||p.track!==s)return void c();await this.waitTillConnected();const{id:A,track:m}=p;await this.connection.updateSendParameters(A,m),await this.connection.updateEncoderConfig(A,m),c()}catch(p){d(p)}finally{h()}},this.handleSetOptimizationMode=async(s,c,d)=>{const h=await this.mutex.lock("Locking from P2PChannel.handleSetOptimizationMode");try{const p=this.localTrackMap.get(xt.LocalVideoTrack);if(!this.connection||!p||p.track!==s)return;await this.waitTillConnected();const{id:A,track:m}=p;await this.connection.updateSendParameters(A,m),c()}catch(p){d(p)}finally{h()}},this.handleReplaceTrack=async(s,c,d)=>{try{var h,p;const A=_t(h=Fe(rn(p=this.localTrackMap).call(p))).call(h,([,{track:m}])=>s===m);if(!this.connection||!A)return void c();if(await this.waitTillConnected(),await this.connection.replaceTrack(s,A[1].id),this.isPlanB){const m=A[1];m.id=s._mediaStreamTrack.id,this.localTrackMap.set(A[0],m)}c()}catch(A){d(A)}},this.handleGetLocalVideoStats=s=>{s(this.statsCollector.getLocalVideoTrackStats())},this.handleGetLocalAudioStats=s=>{s(this.statsCollector.getLocalAudioTrackStats())},this.handleGetRemoteVideoStats=s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid],this.handleGetRemoteAudioStats=s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid],this.store=t,this.statsCollector=n,this.statsCollector.addP2PChannel(this),this.statsUploader=new TL,this.bindStatsUploaderEvents(),this.isPlanB=!Dr().supportUnifiedPlan||ot("CHROME_FORCE_PLAN_B")&&cl()}get state(){return this._state}set state(t){const n=this._state;this._state=t,this.emit(ze.StateChange,n,this._state)}async startP2PConnection(t){return this.state=$i.New,this.connection=this.isPlanB?new Kn(t,this.store):new Hn(t,this.store),this.bindConnectionEvents(this.connection),this.store.peerConnectionStart(),this.connection.establish()}async connect(t,n,s,c,d,h,p,A){if(!this.connection)throw new M(L.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");await this.connection.connect(t,n,s,c,d,h,p,A),this.state=$i.Connected}publish(t,n,s){var c=this;return tu(function*(){const d=yield Cn(c.mutex.lock("From P2PChannel.publish"));if(c.connection){c.store.pubId=c.store.pubId+1,vo.markPublishStart(c.store.clientId,c.store.pubId);try{yield Cn(c.waitTillConnected());const p=c.filterTobePublishedTracks(t,n,s);if(p.length===0)return;yield*tT($y(c.doPublish(c.connection,p)),Cn)}finally{d()}}else{var h;if(c.state===$i.Disconnected)throw new M(L.UNEXPECTED_ERROR,"PeerConnection already disconnected.");c.throwIfTrackTypeNotMatch(t);const p=kt(t).call(t,A=>{var m;return Ft(m=c.pendingLocalTracks).call(m,A)===-1});c.pendingLocalTracks=O(h=c.pendingLocalTracks).call(h,p)}})()}doPublish(t,n){var s=this;return tu(function*(){G(n).call(n,({track:E,type:v})=>{const C=performance.now();s.store.publish(E.getTrackId(),v===xt.LocalAudioTrack?"audio":"video",C)});const c=yield Cn(t.send(ft(n).call(n,({track:E})=>E),s.store.codec)),d=(yield Cn(c.next())).value,h=s.createGatewayPublishMessage(n,d);let p;try{p=yield h}catch(E){throw c.throw(E),(E==null?void 0:E.code)===L.WS_ABORT&&G(n).call(n,({track:v})=>{var C;Ft(C=s.pendingLocalTracks).call(C,v)===-1&&s.pendingLocalTracks.push(v)}),E}const A=s.mapPubResToRemoteConfig(h,p),m=(yield Cn(c.next(A))).value;G(n).call(n,({type:E})=>{s.statsCollector.addLocalStats(E)}),s.bindLocalTrackEvents(n),s.assignLocalTracks(n,m),s.statsUploader.startUploadUplinkStats(),G(n).call(n,({track:E,type:v})=>{const C=performance.now();s.store.publish(E.getTrackId(),v===xt.LocalAudioTrack?"audio":"video",void 0,C)})})()}publishLowStream(t){var n=this;return tu(function*(){if(!n.connection)return;const s=yield Cn(n.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const d=n.localTrackMap.get(xt.LocalVideoTrack);if(!d)throw new M(L.UNEXPECTED_ERROR,"Could not find high stream");if(n.localTrackMap.has(xt.LocalVideoLowTrack))throw new M(L.UNEXPECTED_ERROR,"[".concat(n.store.clientId,"] Can't publish low stream when stream already publish"));yield Cn(n.waitTillConnected());const h=[{track:n.getLowVideoTrack(d.track,t),type:xt.LocalVideoLowTrack}];if(yield*tT($y(n.doPublish(n.connection,h)),Cn),d.track.muted||!d.track.enabled){var c;const p=(c=n.localTrackMap.get(xt.LocalVideoLowTrack))===null||c===void 0?void 0:c.id;p!==void 0&&(yield Cn(n.connection.muteLocal([p])))}}finally{s()}})()}async republish(){this.pendingLocalTracks.length>0&&(S.debug("Emit P2PChannelEvents.RequestRePublish to republish tracks."),await xr(this,ze.RequestRePublish,this.pendingLocalTracks),this.emit(ze.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async reSubscribe(t){var n;for(let c=this.pendingRemoteTracks.length-1;c>=0;c--){const{user:d,kind:h}=this.pendingRemoteTracks[c];var s;(h!==nr.AUDIO||d._audio_added_&&d._audioSSRC)&&(h!==nr.VIDEO||d._video_added_&&d._videoSSRC)||Ye(s=this.pendingRemoteTracks).call(s,c,1)}if(t)await xr(this,ze.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:c,kind:d}of this.pendingRemoteTracks)await this.subscribe(c,d,d===nr.VIDEO?c._videoSSRC:c._audioSSRC);G(n=this.pendingRemoteTracks).call(n,({user:c})=>{this.emit(ze.MediaReconnectEnd,c.uid)}),this.pendingRemoteTracks=[]}async unpublish(t){if(!this.connection)return void G(t).call(t,s=>{var c;const d=Ft(c=this.pendingLocalTracks).call(c,s);var h;d!==-1&&Ye(h=this.pendingLocalTracks).call(h,d,1)});await this.waitTillConnected();const n=this.filterTobeUnpublishedTracks(t);return n.length!==0?this.doUnpublish(this.connection,n):void 0}async unpublishLowStream(){if(!this.connection)return;const t=this.localTrackMap.get(xt.LocalVideoLowTrack);if(!t)return;await this.waitTillConnected();const n=[[xt.LocalVideoLowTrack,t]];return this.doUnpublish(this.connection,n)}async doUnpublish(t,n){const s=this.createGatewayUnpublishMessage(n);return await t.stopSending(ft(n).call(n,([,{id:c}])=>c)),this.withdrawLocalTracks(n),this.unbindLocalTrackEvents(n),G(n).call(n,([c])=>{this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadUplinkStats(),s}async subscribe(t,n,s,c){var d,h;if(!this.connection)throw new M(L.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((d=this.remoteUserMap.get(t))!==null&&d!==void 0&&d.has(n))return;let p,A;if(await this.waitTillConnected(),c){const k=_t(c).call(c,({stream_type:V})=>V===n);var m,E;if(!k)throw new M(L.UNEXPECTED_ERROR,O(m=O(E="Cannot subscribe to remote ".concat(n," for user: ")).call(E,t.uid," because subscribe answer from gateway does not contain stream_type: ")).call(m,n,"."));const P=await this.connection.receive(n,k.ssrcs,String(t.uid),k.attributes);p=P.track,A=P.id}else{const k=await this.connection.receive(n,[{ssrcId:s}],String(t.uid),void 0);p=k.track,A=k.id}var v,C;n===nr.AUDIO?t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(p):(t._audioTrack=new tm(p,t.uid,t._uintid,this.store),S.info(O(v="[".concat(this.store.p2pId,"] create remote audio track: ")).call(v,t._audioTrack.getTrackId())),this.bindRemoteTrackEvents(t,t._audioTrack)):t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(p):(t._videoTrack=new $g(p,t.uid,t._uintid,this.store),S.info(O(C="[".concat(this.store.p2pId,"] create remote video track: ")).call(C,t._videoTrack.getTrackId())),this.bindRemoteTrackEvents(t,t._videoTrack));const b=this.remoteUserMap.get(t);b?b.set(n,A):this.remoteUserMap.set(t,new re([[n,A]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadDownlinkStats();const y=ti(h=this.pendingRemoteTracks).call(h,({user:k,kind:P})=>k.uid===t.uid&&n===P);var w;y!==-1&&(Ye(w=this.pendingRemoteTracks).call(w,y,1),this.emit(ze.MediaReconnectEnd,t.uid))}async unsubscribe(t,n){var s;const c=kt(s=this.pendingRemoteTracks).call(s,({user:p,kind:A})=>n!==void 0?p.uid===t.uid&&n===A:p.uid===t.uid);if(G(c).call(c,p=>{var A,m;const E=Ft(A=this.pendingRemoteTracks).call(A,p);Ye(m=this.pendingRemoteTracks).call(m,E,1)}),!this.connection)return void G(c).call(c,({kind:p})=>{var A;if(p===nr.AUDIO)(A=t._audioTrack)===null||A===void 0||A._destroy(),t._audioTrack=void 0;else if(p===nr.VIDEO){var m;(m=t._videoTrack)===null||m===void 0||m._destroy(),t._videoTrack=void 0}});const d=this.filterTobeUnSubscribedTracks(t,n);if(d.length===0)return;await this.connection.stopReceiving(ft(d).call(d,([,{id:p}])=>p));const h=this.createUnsubscribeMessage(d);return this.withdrawRemoteTracks(d),this.remoteUserMap.size===0&&this.statsUploader.stopUploadDownlinkStats(),G(d).call(d,([p,{kind:A}])=>{var m,E;if(A===nr.VIDEO&&p._videoSSRC&&((m=this.connection)===null||m===void 0||m.setStatsRemoteVideoIsReady(p._videoSSRC,!1)),A===nr.VIDEO)this.unbindRemoteTrackEvents(p._videoTrack),(E=p._videoTrack)===null||E===void 0||E._destroy(),p._videoTrack=void 0;else if(A===nr.AUDIO){var v;this.unbindRemoteTrackEvents(p._audioTrack),(v=p._audioTrack)===null||v===void 0||v._destroy(),p._audioTrack=void 0}}),h}async muteRemote(t,n){if(!this.connection)return;const s=this.remoteUserMap.get(t);if(!s)return void S.warning("P2PChannel.unmuteRemote has no remote user ".concat(t.uid,"."));const c=s.get(n);var d;if(!c)return void S.warning(O(d="P2PChannel.unmuteRemote has no remote user ".concat(t.uid," media type ")).call(d,n,"."));const h=n===nr.VIDEO?t._videoSSRC:t._audioSSRC;h!==void 0&&this.connection.setStatsRemoteVideoIsReady(h,!1),await this.connection.muteRemote(c)}async unmuteRemote(t,n){if(!this.connection)return;const s=this.remoteUserMap.get(t);if(!s)return void S.warning("P2PChannel.unmuteRemote has no remote user ".concat(t.uid,"."));const c=s.get(n);var d;c?await this.connection.unmuteRemote(c):S.warning(O(d="P2PChannel.unmuteRemote has no remote user ".concat(t.uid," media type ")).call(d,n,"."))}getAllTracks(t){const n=this.localTrackMap.get(xt.LocalAudioTrack);if((n==null?void 0:n.track)instanceof _o){var s,c,d,h,p;const v=n.track;return O(s=ft(c=kt(d=kt(h=Fe(rn(p=this.localTrackMap).call(p))).call(h,([C])=>C!==xt.LocalAudioTrack)).call(d,([C])=>!(t&&C===xt.LocalVideoLowTrack))).call(c,([,{track:C}])=>C)).call(s,v.trackList)}var A,m,E;return ft(A=kt(m=Fe(rn(E=this.localTrackMap).call(E))).call(m,([v])=>!(t&&v===xt.LocalVideoLowTrack))).call(A,([,{track:v}])=>v)}reportPublishEvent(t,n,s,c,d){if(t){var h;const m=this.localTrackMap.get(xt.LocalAudioTrack),E=c?this.localTrackMap.get(xt.LocalVideoLowTrack):this.localTrackMap.get(xt.LocalVideoTrack);gt.publish(this.store.sessionId,{eventElapse:vo.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:n,audioName:m==null?void 0:m.track.getTrackLabel(),videoName:E==null?void 0:E.track.getTrackLabel(),screenshare:(E==null?void 0:Ft(h=E.track._hints).call(h,Xn.SCREEN_TRACK))!==-1,audio:!!m,video:!!E,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:d})}else{var p,A;s||(s=[]);const m=_t(s).call(s,v=>v instanceof qr),E=c?(p=this.localTrackMap.get(xt.LocalVideoTrack))===null||p===void 0?void 0:p.track:_t(s).call(s,v=>v instanceof dr);gt.publish(this.store.sessionId,{eventElapse:vo.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:n,audioName:m==null?void 0:m.getTrackLabel(),videoName:E==null?void 0:E.getTrackLabel(),screenshare:(E==null?void 0:Ft(A=E._hints).call(A,Xn.SCREEN_TRACK))!==-1,audio:!!m,video:!!E,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:d})}}reportSubscribeEvent(t,n,s,c){const d=c===nr.VIDEO?s._videoSSRC:s._audioSSRC;d&&gt.subscribe(this.store.sessionId,{succ:t,ec:n,video:c===nr.VIDEO,audio:c===nr.AUDIO,peerid:s.uid,subscribeRequestid:c===nr.VIDEO?s._videoSSRC:s._audioSSRC,p2pid:this.store.p2pId,eventElapse:vo.measureFromSubscribeStart(this.store.clientId,d)})}reset(){S.debug("P2PChannel.reset"),this.mutex=new Un("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.state=$i.Disconnected}getStats(){var t;return(t=this.connection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(t){var n;return((n=this.connection)===null||n===void 0?void 0:n.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(xt.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(xt.LocalVideoTrack);if(t)return{width:t.track._videoWidth||0,height:t.track._videoHeight||0}}getEncoderConfig(t){const n=this.localTrackMap.get(t);return n&&n.track instanceof dr||n&&n.track instanceof qr?n.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,n){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!n||s.has(n))}getRemoteMedia(t){var n,s;const c=_t(n=Fe(Ec(s=this.remoteUserMap).call(s))).call(n,d=>d.uid===t);return c?{audioTrack:c.audioTrack,audioSSRC:c._audioSSRC,videoTrack:c.videoTrack,videoSSRC:c._videoSSRC}:{}}getAudioLevels(){var t,n;let s=ft(t=Fe(rn(n=this.remoteUserMap).call(n))).call(t,([d])=>({uid:d.uid,level:d.audioTrack?100*d.audioTrack._source.getAccurateVolumeLevel():0}));const c=this.localTrackMap.get(xt.LocalAudioTrack);return c&&s.push({level:100*c.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),s=xa(s).call(s,(d,h)=>d.level-h.level),s}async disconnectForReconnect(){if(this.connection){var t,n,s,c;S.debug("P2PChannel.disconnectForReconnect closing P2PConnection"),this.state=$i.Reconnecting,this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.localTrackMap.size!==0&&(G(t=Fe(rn(n=this.localTrackMap).call(n))).call(t,([d,{track:h}])=>{var p;switch(d){case xt.LocalVideoTrack:zt(p=h._hints).call(p,Xn.LOW_STREAM)?h.close():this.pendingLocalTracks.push(h);break;case xt.LocalAudioTrack:var A;h instanceof _o?this.pendingLocalTracks=O(A=this.pendingLocalTracks).call(A,h.trackList):this.pendingLocalTracks.push(h);break;case xt.LocalVideoLowTrack:}}),this.emit(ze.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&G(s=Fe(rn(c=this.remoteUserMap).call(c))).call(s,([d,h])=>{var p;G(p=Fe(Ec(h).call(h))).call(p,A=>{this.setPendingRemoteMedia(d,A)}),this.emit(ze.MediaReconnectStart,d.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),S.debug("P2PChannel disconnected, waiting to reconnect.")}}hasPendingRemoteMedia(t,n){for(const s of this.pendingRemoteTracks){const{user:c,kind:d}=s;if((t instanceof Nl?t.uid:t)===c.uid&&n===d)return!0}return!1}setPendingRemoteMedia(t,n){this.hasPendingRemoteMedia(t,n)||this.pendingRemoteTracks.push({user:t,kind:n})}async reEstablish(){if(this.connection)return this.connection.reEstablish()}getUplinkNetworkQuality(){var t,n,s;if(!this.connection)return 0;const c=this.connection.getStats(),d=this.localTrackMap.get(xt.LocalVideoTrack),h=this.localTrackMap.get(xt.LocalAudioTrack),p=_t(t=c.videoSend).call(t,P=>P.ssrc===(d==null?void 0:d.ssrcs[0].ssrcId)),A=_t(n=c.audioSend).call(n,P=>P.ssrc===(h==null?void 0:h.ssrcs[0].ssrcId));if(!p||!A)return 1;const m=Io(this,ze.NeedSignalRTT),E=p?p.rttMs:void 0,v=A?A.rttMs:void 0,C=E&&v?(E+v)/2:E||v,b=(C&&m?(C+m)/2:C||m)||0,y=100*c.sendPacketLossRate*.7/50+.3*b/1500,w=y<.17?1:y<.36?2:y<.59?3:y<.1?4:5,k=d==null?void 0:d.track;if(k&&k._encoderConfig&&Ft(s=k._hints).call(s,Xn.SCREEN_TRACK)===-1){const P=k._encoderConfig.bitrateMax,V=c.bitrate.actualEncoded;if(P&&V){const j=(1e3*P-V)/(1e3*P);return pC[j<.15?0:j<.3?1:j<.45?2:j<.6?3:4][w]}}return w}getDownlinkNetworkQuality(){var t,n;if(!this.connection)return 0;const s=this.connection.getStats();let c=0;return G(t=Fe(rn(n=this.remoteUserMap).call(n))).call(t,([d])=>{var h,p;const A=d._audioSSRC,m=d._videoSSRC,E=_t(h=s.audioRecv).call(h,V=>V.ssrc===A),v=_t(p=s.videoRecv).call(p,V=>V.ssrc===m);if(!E&&!v)return void(c+=1);const C=Io(this,ze.NeedSignalRTT),b=s.rtt,y=(b&&C?(b+C)/2:b||C)||0,w=E?E.jitterMs:void 0,k=s.recvPacketLossRate;let P=.7*k*100/50+.3*y/1500;w&&(P=.6*k*100/50+.2*y/1500+.2*w/400),c+=P<.1?1:P<.17?2:P<.36?3:P<.59?4:5}),this.remoteUserMap.size>0?Math.round(c/this.remoteUserMap.size):c}async muteLocalTrack(t){return new dt((n,s)=>{this.handleMuteLocalTrack(t,n,s)})}filterTobePublishedTracks(t,n,s){const c=[],d=Dr(),h=this.getAllTracks();t=rp(t=kt(t).call(t,m=>Ft(h).call(h,m)===-1));let p=!1,A=!1;for(const m of t){if(m instanceof dr&&(this.localTrackMap.has(xt.LocalVideoTrack)||p?new M(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(c.push({track:m,type:xt.LocalVideoTrack}),p=!0),n)){const E=this.getLowVideoTrack(m,s);c.push({track:E,type:xt.LocalVideoLowTrack})}if(m instanceof qr){const E=this.localTrackMap.get(xt.LocalAudioTrack);if(E){if(!(E.track instanceof _o))throw new M(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(m._bypassWebAudio)throw new M(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");E.track.addAudioTrack(m),this.bindLocalAudioTrackEvents(m,!0)}else if(A){const v=_t(c).call(c,({type:C})=>C===xt.LocalAudioTrack);if(!(v.track instanceof _o))throw new M(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(m._bypassWebAudio)throw new M(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");v.track.addAudioTrack(m)}else{if(!d.webAudioMediaStreamDest||m instanceof _o||m._bypassWebAudio)c.push({track:m,type:xt.LocalAudioTrack});else{const v=new _o;v.addAudioTrack(m),c.push({track:v,type:xt.LocalAudioTrack})}A=!0}}}return c}filterTobeUnpublishedTracks(t){const n=[],s=this.getAllTracks();t=rp(t=kt(t).call(t,c=>Ft(s).call(s,c)!==-1));for(const c of t){if(c instanceof qr){const d=this.localTrackMap.get(xt.LocalAudioTrack);if(!d)continue;d.track instanceof _o?(d.track.removeAudioTrack(c),this.unbindLocalAudioTrackEvents(c),d.track.trackList.length===0&&(n.push([xt.LocalAudioTrack,d]),d.track.close())):n.push([xt.LocalAudioTrack,d])}if(c instanceof dr){const d=this.localTrackMap.get(xt.LocalVideoTrack);if(!d)continue;n.push([xt.LocalVideoTrack,d]);const h=this.localTrackMap.get(xt.LocalVideoLowTrack);h&&n.push([xt.LocalVideoLowTrack,h])}}return n}bindLocalTrackEvents(t){G(t).call(t,({track:n,type:s})=>{switch(s){case xt.LocalVideoTrack:n.addListener(Jt.GET_STATS,this.handleGetLocalVideoStats),n.addListener(Jt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Jt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Jt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(Jt.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),n.addListener(Jt.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Jt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Jt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case xt.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);break;case xt.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,n){var s;t instanceof _o?G(s=t.trackList).call(s,c=>{c.addListener(Jt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),c.addListener(Jt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),c.addListener(Jt.GET_STATS,this.handleGetLocalAudioStats),c.addListener(Jt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),c.addListener(Jt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(Jt.GET_STATS,this.handleGetLocalAudioStats),t.addListener(Jt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(Jt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(Jt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(Jt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),n||t.addListener(Jt.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t){var n;t||(t=Fe(rn(n=this.localTrackMap).call(n))),G(t).call(t,([s,{track:c}])=>{switch(s){case xt.LocalVideoTrack:c.off(Jt.GET_STATS,this.handleGetLocalVideoStats),c.off(Jt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),c.off(Jt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),c.off(Jt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),c.off(Jt.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),c.off(Jt.NEED_REPLACE_TRACK,this.handleReplaceTrack),c.off(Jt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),c.off(Jt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case xt.LocalAudioTrack:this.unbindLocalAudioTrackEvents(c);break;case xt.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){var n;t instanceof _o?G(n=t.trackList).call(n,s=>{s.off(Jt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(Jt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(Jt.GET_STATS,this.handleGetLocalAudioStats),s.off(Jt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(Jt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(Jt.GET_STATS,this.handleGetLocalAudioStats),t.off(Jt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Jt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Jt.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(Jt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Jt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,n){n instanceof $g&&n.addListener(Jt.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(t))}),n instanceof tm&&n.addListener(Jt.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(Jt.GET_STATS)}unbindAllRemoteTrackEvents(){var t,n;G(t=Fe(rn(n=this.remoteUserMap).call(n))).call(t,([s,c])=>{c.has(nr.AUDIO)&&this.unbindRemoteTrackEvents(s._audioTrack),c.has(nr.VIDEO)&&this.unbindRemoteTrackEvents(s._videoTrack)})}createGatewayPublishMessage(t,n){return ft(t).call(t,({track:s,type:c},d)=>{var h;let p,A;switch(c){case xt.LocalAudioTrack:p=Kr.Audio,A={dtx:s instanceof jd&&s._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case xt.LocalVideoTrack:p=zt(h=s._hints).call(h,Xn.SCREEN_TRACK)?Kr.Screen:Kr.High,A=Rp({},ES(s),{codec:this.store.codec});break;case xt.LocalVideoLowTrack:p=Kr.Low,A=Rp({},ES(s),{codec:this.store.codec})}return{stream_type:p,attributes:A,ssrcs:n[d]}})}createGatewayUnpublishMessage(t){return ft(t).call(t,([n,{track:s,ssrcs:c,id:d}])=>{var h;let p;switch(n){case xt.LocalVideoTrack:p=zt(h=s._hints).call(h,Xn.SCREEN_TRACK)?Kr.Screen:Kr.High;break;case xt.LocalAudioTrack:p=Kr.Audio;break;case xt.LocalVideoLowTrack:p=Kr.Low}return{stream_type:p,ssrcs:c,mid:d}})}assignLocalTracks(t,n){G(t).call(t,({track:s,type:c},d)=>{this.localTrackMap.set(c,{track:s,id:n[d].id,ssrcs:n[d].localSSRC})})}withdrawLocalTracks(t){G(t).call(t,([n])=>{this.localTrackMap.delete(n)})}async waitTillConnected(){return new dt((t,n)=>{switch(this.state){case $i.New:case $i.Reconnecting:{const s=(c,d)=>d===$i.Disconnected?(this.off(ze.StateChange,s),void n(new M(L.UNEXPECTED_ERROR,"PeerConnection already disconnected."))):d===$i.Connected?(this.off(ze.StateChange,s),void t(void 0)):void 0;this.on(ze.StateChange,s);break}case $i.Connected:t(void 0);break;case $i.Disconnected:n(new M(L.UNEXPECTED_ERROR,"PeerConnection already disconnected."))}})}bindConnectionEvents(t){t.onConnectionStateChange=async n=>{var s;S.info(O(s="[p2pId: ".concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(")).call(s,n,")")),this.emit(ze.PeerConnectionStateChange,n),n!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),n==="failed"&&(t.iceConnectionState==="failed"?(vn(()=>this.emit(ze.P2PLost),0),this.iceFailedCount+=1,await Ur(ng(this.iceFailedCount,Ne)),this.emit(ze.RequestRestartICE)):await this.requestReconnect())},t.onICEConnectionStateChange=n=>{var s;S.info(O(s="[p2pId: ".concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(")).call(s,n,")")),this.emit(ze.IceConnectionStateChange,n)},t.onICETransportStateChange=n=>{var s;S.info(O(s="[p2pId: ".concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(")).call(s,n,")"))},t.onDTLSTransportStateChange=n=>{var s;S.info(O(s="[p2pId: ".concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(")).call(s,n,")"))},t.onDTLSTransportError=n=>{var s;S.info(O(s="[p2pId: ".concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(")).call(s,n,")"))},t.onFirstAudioDecoded=n=>{var s,c;const d=_t(s=Fe(Ec(c=this.remoteUserMap).call(c))).call(s,p=>p._audioSSRC===n);var h;d&&((h=d.audioTrack)===null||h===void 0||h.emit(fl.FIRST_FRAME_DECODED),gt.firstRemoteFrame(this.store.sessionId,jn.FIRST_AUDIO_DECODE,kr.FIRST_AUDIO_DECODE,{peer:d._uintid,subscribeElapse:vo.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=n=>{var s,c;const d=_t(s=Fe(Ec(c=this.remoteUserMap).call(c))).call(s,h=>h._audioSSRC===n);d&&gt.firstRemoteFrame(this.store.sessionId,jn.FIRST_AUDIO_RECEIVED,kr.FIRST_AUDIO_RECEIVED,{peer:d._uintid,subscribeElapse:vo.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(n,s,c)=>{var d,h;const p=_t(d=Fe(Ec(h=this.remoteUserMap).call(h))).call(d,A=>A._videoSSRC===n);p&&gt.firstRemoteFrame(this.store.sessionId,jn.FIRST_VIDEO_DECODE,kr.FIRST_VIDEO_DECODE,{peer:p._uintid,videowidth:s,videoheight:c,subscribeElapse:vo.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId})},t.onFirstVideoReceived=n=>{var s,c;const d=_t(s=Fe(Ec(c=this.remoteUserMap).call(c))).call(s,h=>h._videoSSRC===n);d&&gt.firstRemoteFrame(this.store.sessionId,jn.FIRST_VIDEO_RECEIVED,kr.FIRST_VIDEO_RECEIVED,{peer:d._uintid,subscribeElapse:vo.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId})}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0}filterTobeMutedTracks(t){var n,s;const c=[],d=this.getAllTracks();if(Ft(d).call(d,t)===-1)return c;const h=this.localTrackMap.get(xt.LocalAudioTrack);if(t instanceof qr&&(h==null?void 0:h.track)instanceof _o)return h.track.isActive||c.push([xt.LocalAudioTrack,h]),c;const p=_t(n=Fe(rn(s=this.localTrackMap).call(s))).call(n,([,{track:A}])=>t===A);if(p&&(c.push(p),p[0]===xt.LocalVideoTrack)){const A=this.localTrackMap.get(xt.LocalVideoLowTrack);A&&c.push([xt.LocalVideoLowTrack,A])}return c}filterTobeUnmutedTracks(t){var n,s;const c=[],d=this.localTrackMap.get(xt.LocalAudioTrack);if(t instanceof qr&&(d==null?void 0:d.track)instanceof _o)return d.track.isActive&&c.push([xt.LocalAudioTrack,d]),c;const h=_t(n=Fe(rn(s=this.localTrackMap).call(s))).call(n,([,{track:p}])=>t===p);if(h)if(h[0]===xt.LocalVideoTrack){c.push(h);const p=this.localTrackMap.get(xt.LocalVideoLowTrack);p&&c.push([xt.LocalVideoLowTrack,p])}else c.push(h);return c}createMuteMessage(t){return ft(t).call(t,([n,{track:s,ssrcs:c,id:d}])=>{var h;let p;switch(n){case xt.LocalAudioTrack:p=Kr.Audio;break;case xt.LocalVideoTrack:p=zt(h=s._hints).call(h,Xn.SCREEN_TRACK)?Kr.Screen:Kr.High;break;case xt.LocalVideoLowTrack:p=Kr.Low}return{stream_type:p,ssrcs:c,mid:d}})}createUnmuteMessage(t){return ft(t).call(t,([n,{track:s,ssrcs:c,id:d}])=>{var h;let p;switch(n){case xt.LocalAudioTrack:p=Kr.Audio;break;case xt.LocalVideoTrack:p=zt(h=s._hints).call(h,Xn.SCREEN_TRACK)?Kr.Screen:Kr.High;break;case xt.LocalVideoLowTrack:p=Kr.Low}return{stream_type:p,ssrcs:c,mid:d}})}filterTobeUnSubscribedTracks(t,n){const s=[],c=this.remoteUserMap.get(t);if(!c)return s;if(n){const h=c.get(n);if(!h)return s;s.push([t,{kind:n,id:h}])}else{var d;G(d=Fe(rn(c).call(c))).call(d,([h,p])=>{s.push([t,{kind:h,id:p}])})}return s}createUnsubscribeMessage(t){const n=[];return G(t).call(t,([s,{kind:c,id:d}])=>{switch(c){case nr.VIDEO:return void(s._videoSSRC&&n.push({stream_type:nr.VIDEO,ssrcId:s._videoSSRC}));case nr.AUDIO:return void(s._audioSSRC&&n.push({stream_type:nr.AUDIO,ssrcId:s._audioSSRC}))}}),n}withdrawRemoteTracks(t){G(t).call(t,([n,{kind:s}])=>{const c=this.remoteUserMap.get(n);c&&(c.delete(s),Fe(rn(c).call(c)).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(t){const n=this.localTrackMap.get(xt.LocalVideoTrack),s=this.localTrackMap.get(xt.LocalVideoLowTrack);n&&await n.track.setBitrateLimit(t.uplink),s&&t.low_stream_uplink&&await s.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(t,n){return ft(t).call(t,({stream_type:s},c)=>{var d;return(d=_t(n).call(n,({stream_type:h})=>s===h))===null||d===void 0?void 0:d.attributes})}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>{var t;return Fe(rn(t=this.localTrackMap).call(t))},this.statsUploader.requestRemoteMedia=()=>{var t;return Fe(rn(t=this.remoteUserMap).call(t))},this.statsUploader.requestVideoIsReady=t=>{var n;return!((n=this.connection)===null||n===void 0||!n.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,n)=>this.emit(ze.RequestUploadStats,t,n)}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Ur(ng(this.dtlsFailedCount,Ne)),this.emit(ze.RequestReconnect)}async reconnectP2P(){var t,n;const s=Fe(rn(t=this.localTrackMap).call(t)),c=this.createGatewayUnpublishMessage(s);Fe(rn(n=this.remoteUserMap).call(n)),c.length>0&&await xr(this,ze.RequestUnpublishForReconnectPC,c),this.disconnectForReconnect(),this.emit(ze.RequestReconnectPC)}canPublishLowStream(){var t;return this.localTrackMap.has(xt.LocalVideoTrack)||bs(t=this.pendingLocalTracks).call(t,n=>n instanceof dr)}throwIfTrackTypeNotMatch(t){if(kt(t).call(t,d=>d instanceof dr).length>1)throw new M(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(kt(t).call(t,d=>d instanceof qr).length>1&&(bs(t).call(t,d=>d instanceof qr&&d._bypassWebAudio)||!Dr().webAudioMediaStreamDest))throw new M(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const d of t){var n,s,c;if(d instanceof dr&&bs(n=this.pendingLocalTracks).call(n,h=>h instanceof dr))throw new M(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(d instanceof qr&&bs(s=this.pendingLocalTracks).call(s,h=>h instanceof qr)&&(!Dr().webAudioMediaStreamDest||d._bypassWebAudio||bs(c=this.pendingLocalTracks).call(c,h=>h instanceof qr&&h._bypassWebAudio)))throw new M(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,n){const s=Dr().supportDualStreamEncoding,c=Rp({},{width:160,height:120,framerate:15,bitrate:50},{},n);let d;d=s?t._mediaStreamTrack.clone():_T(t,c);const h=new dr(d,Rp({},s&&{scaleResolutionDownBy:Lk(c,t)},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}));return h._hints.push(Xn.LOW_STREAM),h}}function ps(r,t,n){const s=r[t];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(...c){const d=this.mutex,h=await d.lock("From P2PChannel.".concat(t));try{return await s.apply(this,c)}finally{h()}},n}hs([ps,fr("design:type",Function),fr("design:paramtypes",[Object]),fr("design:returntype",dt)],jo.prototype,"startP2PConnection",null),hs([ps,fr("design:type",Function),fr("design:paramtypes",[Object,Object,Array,Object,String,String,String,String]),fr("design:returntype",dt)],jo.prototype,"connect",null),hs([ps,fr("design:type",Function),fr("design:paramtypes",[Array]),fr("design:returntype",dt)],jo.prototype,"unpublish",null),hs([ps,fr("design:type",Function),fr("design:paramtypes",[]),fr("design:returntype",dt)],jo.prototype,"unpublishLowStream",null),hs([ps,fr("design:type",Function),fr("design:paramtypes",[Nl,String,Number,Array]),fr("design:returntype",dt)],jo.prototype,"subscribe",null),hs([ps,fr("design:type",Function),fr("design:paramtypes",[Nl,String]),fr("design:returntype",dt)],jo.prototype,"unsubscribe",null),hs([ps,fr("design:type",Function),fr("design:paramtypes",[Nl,String]),fr("design:returntype",dt)],jo.prototype,"muteRemote",null),hs([ps,fr("design:type",Function),fr("design:paramtypes",[Nl,String]),fr("design:returntype",dt)],jo.prototype,"unmuteRemote",null),hs([ps,fr("design:type",Function),fr("design:paramtypes",[]),fr("design:returntype",dt)],jo.prototype,"disconnectForReconnect",null),hs([ps,fr("design:type",Function),fr("design:paramtypes",[]),fr("design:returntype",dt)],jo.prototype,"reEstablish",null),hs([ps,fr("design:type",Function),fr("design:paramtypes",[Object]),fr("design:returntype",dt)],jo.prototype,"updateBitrateLimit",null);var RL=f(function(){Zc(1)});qt({target:"Object",stat:!0,forced:RL,sham:!Y_},{getPrototypeOf:function(r){return Zc(ve(r))}});var em=_e.Object.getPrototypeOf,rm=Jy;function Wo(r){return"Minified Redux error #"+r+"; visit https://redux.js.org/Errors?code="+r+" for the full message or use the non-minified dev environment for full errors. "}var vr,yT=typeof rm=="function"&&rm.observable||"@@observable",nm=function(){return Math.random().toString(36).substring(7).split("").join(".")},TT={INIT:"@@redux/INIT"+nm(),REPLACE:"@@redux/REPLACE"+nm(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+nm()}};function wL(r){if(typeof r!="object"||r===null)return!1;for(var t=r;em(t)!==null;)t=em(t);return em(r)===t}function RT(r,t,n){var s;if(typeof t=="function"&&typeof n=="function"||typeof n=="function"&&typeof arguments[3]=="function")throw new Error(Wo(0));if(typeof t=="function"&&n===void 0&&(n=t,t=void 0),n!==void 0){if(typeof n!="function")throw new Error(Wo(1));return n(RT)(r,t)}if(typeof r!="function")throw new Error(Wo(2));var c=r,d=t,h=[],p=h,A=!1;function m(){p===h&&(p=en(h).call(h))}function E(){if(A)throw new Error(Wo(3));return d}function v(w){if(typeof w!="function")throw new Error(Wo(4));if(A)throw new Error(Wo(5));var k=!0;return m(),p.push(w),function(){if(k){if(A)throw new Error(Wo(6));k=!1,m();var P=Ft(p).call(p,w);Ye(p).call(p,P,1),h=null}}}function C(w){if(!wL(w))throw new Error(Wo(7));if(w.type===void 0)throw new Error(Wo(8));if(A)throw new Error(Wo(9));try{A=!0,d=c(d,w)}finally{A=!1}for(var k=h=p,P=0;P<k.length;P++)(0,k[P])();return w}function b(w){if(typeof w!="function")throw new Error(Wo(10));c=w,C({type:TT.REPLACE})}function y(){var w,k=v;return(w={subscribe:function(P){if(typeof P!="object"||P===null)throw new Error(Wo(11));function V(){P.next&&P.next(E())}return V(),{unsubscribe:k(V)}}})[yT]=function(){return this},w}return C({type:TT.INIT}),(s={dispatch:C,subscribe:v,getState:E,replaceReducer:b})[yT]=y,s}function wT(r,t){var n=le(r);if(ee){var s=ee(r);t&&(s=kt(s).call(s,function(c){return Wt(r,c).enumerable})),n.push.apply(n,s)}return n}function ur(r){for(var t=1;t<arguments.length;t++){var n,s=arguments[t]!=null?arguments[t]:{};if(t%2)G(n=wT(Object(s),!0)).call(n,function(d){_r(r,d,s[d])});else if(te)He(r,te(s));else{var c;G(c=wT(Object(s))).call(c,function(d){se(r,d,Wt(s,d))})}}return r}(function(r){r.SET_SESSION_ID="SET_SESSION_ID",r.SET_P2P_ID="SET_P2P_id",r.SET_UID="SET_UID",r.SET_PUB_ID="SET_PUB_ID",r.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",r.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",r.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",r.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",r.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",r.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",r.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",r.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",r.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_START",r.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",r.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE"})(vr||(vr={}));class bL{constructor(t,n,s){const c={codec:t,mode:n,clientId:s,sessionId:null,p2pId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[]}};this.reducer=function(d=c,h){switch(h.type){case vr.SET_SESSION_ID:return ur({},d,{sessionId:h.sessionId});case vr.SET_P2P_ID:return ur({},d,{p2pId:h.p2pId});case vr.SET_UID:return ur({},d,{uid:h.uid});case vr.SET_PUB_ID:return ur({},d,{pubId:h.pubId});case vr.KEY_METRIC_CLIENT_CREATED:return ur({},d,{keyMetrics:ur({},d.keyMetrics,{clientCreated:h.metric})});case vr.KEY_METRIC_JOIN_START:return ur({},d,{keyMetrics:ur({},d.keyMetrics,{joinStart:h.metric})});case vr.KEY_METRIC_JOIN_END:return ur({},d,{keyMetrics:ur({},d.keyMetrics,{joinEnd:h.metric})});case vr.KEY_METRIC_REQUEST_AP_START:return ur({},d,{keyMetrics:ur({},d.keyMetrics,{requestAPStart:h.metric})});case vr.KEY_METRIC_REQUEST_AP_END:return ur({},d,{keyMetrics:ur({},d.keyMetrics,{requestAPEnd:h.metric})});case vr.KEY_METRIC_JOIN_GATEWAY_START:return ur({},d,{keyMetrics:ur({},d.keyMetrics,{joinGatewayStart:h.metric})});case vr.KEY_METRIC_JOIN_GATEWAY_END:return ur({},d,{keyMetrics:ur({},d.keyMetrics,{joinGatewayEnd:h.metric})});case vr.KEY_METRIC_PEER_CONNECTION_START:return ur({},d,{keyMetrics:ur({},d.keyMetrics,{peerConnectionStart:h.metric})});case vr.KEY_METRIC_PEER_CONNECTION_END:return ur({},d,{keyMetrics:ur({},d.keyMetrics,{peerConnectionEnd:h.metric})});case vr.KEY_METRIC_PUBLISH:{const p=d.keyMetrics.publish,A=ti(p).call(p,m=>m.trackId===h.metric.trackId);return A!==-1?(p[A]=ur({},p[A],{},h.metric),ur({},d,{keyMetrics:ur({},d.keyMetrics,{publish:[...p]})})):ur({},d,{keyMetrics:ur({},d.keyMetrics,{publish:[...d.keyMetrics.publish,h.metric]})})}case vr.KEY_METRIC_SUBSCRIBE:{const p=d.keyMetrics.subscribe,A=ti(p).call(p,m=>m.userId===h.metric.userId&&m.type===h.metric.type);return A!==-1?(p[A]=ur({},p[A],{},h.metric),ur({},d,{keyMetrics:ur({},d.keyMetrics,{subscribe:[...p]})})):ur({},d,{keyMetrics:ur({},d.keyMetrics,{subscribe:[...d.keyMetrics.subscribe,h.metric]})})}default:return d}},this.store=RT(this.reducer)}set sessionId(t){this.store.dispatch({type:vr.SET_SESSION_ID,sessionId:t})}get sessionId(){return this.store.getState().sessionId}get codec(){return this.store.getState().codec}get clientId(){return this.store.getState().clientId}set p2pId(t){this.store.dispatch({type:vr.SET_P2P_ID,p2pId:t})}get p2pId(){return this.store.getState().p2pId}set uid(t){this.store.dispatch({type:vr.SET_UID,uid:t})}get uid(){return this.store.getState().uid}set pubId(t){this.store.dispatch({type:vr.SET_PUB_ID,pubId:t})}get pubId(){return this.store.getState().pubId}clientCreated(){this.store.dispatch({type:vr.KEY_METRIC_CLIENT_CREATED,metric:performance.now()})}joinStart(){this.store.dispatch({type:vr.KEY_METRIC_JOIN_START,metric:performance.now()})}joinEnd(){this.store.dispatch({type:vr.KEY_METRIC_JOIN_END,metric:performance.now()})}requestAPStart(){this.store.dispatch({type:vr.KEY_METRIC_REQUEST_AP_START,metric:performance.now()})}requestAPEnd(){this.store.dispatch({type:vr.KEY_METRIC_REQUEST_AP_END,metric:performance.now()})}joinGatewayStart(){this.store.dispatch({type:vr.KEY_METRIC_JOIN_GATEWAY_START,metric:performance.now()})}joinGatewayEnd(){this.store.dispatch({type:vr.KEY_METRIC_JOIN_GATEWAY_END,metric:performance.now()})}peerConnectionStart(){this.store.dispatch({type:vr.KEY_METRIC_PEER_CONNECTION_START,metric:performance.now()})}peerConnectionEnd(){this.store.dispatch({type:vr.KEY_METRIC_PEER_CONNECTION_END,metric:performance.now()})}publish(t,n,s,c){this.store.dispatch({type:vr.KEY_METRIC_PUBLISH,metric:ur({trackId:t,type:n},s&&{publishStart:s},{},c&&{publishEnd:c})})}subscribe(t,n,s,c,d){this.store.dispatch({type:vr.KEY_METRIC_SUBSCRIBE,metric:ur({userId:t,type:n},s&&{subscribeStart:s},{},c&&{subscribeEnd:c},{},d&&{firstFrame:d})})}get keyMetrics(){return this.store.getState().keyMetrics}}let wp;const bT=()=>(wp||wp||(wp=(window.location.protocol.split(":")[0]||"").toUpperCase(),wp))==="HTTPS",bp=()=>window.isSecureContext!==void 0;class NL{constructor(t,n){var s;this.name=t,this.time=performance.now(),this.sequence=Ft(s=nk[n]).call(s,t)}setElapse(t){this.elapse=t}}const OL=new re;function NT(r,t){const n=new kL(r,t);return OL.set(r,n),n}class kL{constructor(t,n){this.records=[],this._id=t,this._group=n,this._localTimeStamp=pt(),this._performanceTimeStamp=performance.now()}checkPoint(t){var n;const s=new NL(t,this._group);s.sequence===-1&&S.warning("[".concat(this._id,"] check point record failed, cannot get the sequence")),this.records.push(s);const c=_t(n=this.records).call(n,d=>d.sequence===s.sequence-1);c&&s.setElapse(s.time-c.time)}getRecord(t){var n;return _t(n=this.records).call(n,s=>s&&s.name===t)}resetRecords(){this.records.length=0}}function OT(r,t){var n=le(r);if(ee){var s=ee(r);t&&(s=kt(s).call(s,function(c){return Wt(r,c).enumerable})),n.push.apply(n,s)}return n}function im(r){for(var t=1;t<arguments.length;t++){var n,s=arguments[t]!=null?arguments[t]:{};if(t%2)G(n=OT(Object(s),!0)).call(n,function(d){_r(r,d,s[d])});else if(te)He(r,te(s));else{var c;G(c=OT(Object(s))).call(c,function(d){se(r,d,Wt(s,d))})}}return r}var be,Bi,Np,Dl,kT,Op,ru=function(r,t,n,s){var c,d=arguments.length,h=d<3?t:s===null?s=Wt(t,n):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(r,t,n,s);else for(var p=r.length-1;p>=0;p--)(c=r[p])&&(h=(d<3?c(h):d>3?c(t,n,h):c(t,n))||h);return d>3&&h&&se(t,n,h),h},Ui=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)};class Ll extends Hr{constructor(t){var n,s,c,d;let h;if(super(),this._users=[],this._sessionId=null,this._leaveMutex=new Un("client-leave"),this._publishMutex=new Un("client-publish"),this._renewTokenMutex=new Un("client-renewtoken"),this._subscribeMutex=new re,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._turnServer={servers:[],mode:"auto"},this._cloudProxyServerMode="disabled",this._isDualStreamEnabled=!1,this._streamFallbackTypeCacheMap=new re,this._remoteStreamTypeCacheMap=new re,this._axiosCancelSource=Lo.CancelToken.source(),this._networkQualitySensitivity="normal",this._useLocalAccessPoint=!1,this._joinAndNotLeaveYet=!1,this._handleLocalTrackEnable=(A,m,E)=>{this.publish(A,!1).then(m).catch(E)},this._handleLocalTrackDisable=(A,m,E)=>{this.unpublish(A,!1).then(m).catch(E)},this._handleUserOnline=A=>{var m;this.isStringUID&&typeof A.uid!="string"&&S.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const E=_t(m=this._users).call(m,v=>v.uid===A.uid);if(E)E._trust_in_room_=!0;else{const v=new Nl(A.uid,A.uint_id||A.uid);this._users.push(v),S.debug("[".concat(this._clientId,"] user online"),A.uid),this.emit(Qe.USER_JOINED,v)}},this._handleUserOffline=A=>{var m;const E=_t(m=this._users).call(m,v=>v.uid===A.uid);E&&(this._handleRemoveStream(A),da(this._users,E),this._remoteStreamTypeCacheMap.delete(E.uid),this._streamFallbackTypeCacheMap.delete(E.uid),S.debug("[".concat(this._clientId,"] user offline"),A.uid,"reason:",A.reason),this.emit(Qe.USER_LEAVED,E,A.reason))},this._handleAddAudioOrVideoStream=(A,m,E,v,C,b)=>{var y,w,k;const P=_t(y=this._users).call(y,mt=>mt.uid===m);if(!P)return void S.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));S.debug(O(w=O(k="[".concat(this._clientId,"] stream added with uid ")).call(k,m,", type ")).call(w,A));const V=A==="audio"?P.hasAudio:P.hasVideo;var j,st;P._uintid||(P._uintid=C||m),P._trust_stream_added_state_=!0,A==="audio"?(P._audio_added_=!0,E!==void 0&&(P._audioSSRC=E),v!==void 0&&(P._cname=v),b&&(P._audioOrtc=b)):(P._video_added_=!0,E!==void 0&&(P._videoSSRC=E),v!==void 0&&(P._cname=v),b&&(P._videoOrtc=b)),(A==="audio"?P.hasAudio:P.hasVideo)&&!V&&(S.info(O(j=O(st="[".concat(this._clientId,"] remote user ")).call(st,P.uid," published ")).call(j,A)),this.emit(Qe.USER_PUBLISHED,P,A)),A==="video"?gt.onGatewayStream(this._sessionId,jn.ON_ADD_VIDEO_STREAM,kr.ON_ADD_VIDEO_STREAM,{peer:C||m}):gt.onGatewayStream(this._sessionId,jn.ON_ADD_AUDIO_STREAM,kr.ON_ADD_AUDIO_STREAM,{peer:C||m}),this._p2pChannel.hasPendingRemoteMedia(P,A)&&this.subscribe(P,A).catch(mt=>{S.error("[".concat(this._clientId,"] resubscribe error"),mt.toString())})},this._handleRemoveStream=async A=>{var m,E;const v=_t(m=this._users).call(m,y=>y.uid===A.uid);if(!v)return void S.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));S.debug(O(E="[".concat(this._clientId,"] stream removed with uid ")).call(E,A.uid));let C=()=>{};v.hasAudio&&v.hasVideo?C=()=>{var y,w;S.info(O(y="[".concat(this._clientId,"] remote user ")).call(y,v.uid," unpublished audio track")),this.emit(Qe.USER_UNPUBLISHED,v,"audio"),S.info(O(w="[".concat(this._clientId,"] remote user ")).call(w,v.uid," unpublished video track")),this.emit(Qe.USER_UNPUBLISHED,v,"video")}:v.hasVideo?C=()=>{var y;S.info(O(y="[".concat(this._clientId,"] remote user ")).call(y,v.uid," unpublished video track")),this.emit(Qe.USER_UNPUBLISHED,v,"video")}:v.hasAudio&&(C=()=>{var y;S.info(O(y="[".concat(this._clientId,"] remote user ")).call(y,v.uid," unpublished audio track")),this.emit(Qe.USER_UNPUBLISHED,v,"audio")}),v._trust_stream_added_state_=!0,v._audio_added_=!1,v._video_added_=!1;const b=await this._p2pChannel.unsubscribe(v);b&&await this._gateway.unsubscribe(b,v.uid),v._audioSSRC=void 0,v._videoSSRC=void 0,v._audioOrtc=void 0,v._videoOrtc=void 0,gt.onGatewayStream(this._sessionId,jn.ON_REMOVE_STREAM,kr.ON_REMOVE_STREAM,{peer:A.uint_id||A.uid}),C()},this._handleSetStreamLocalEnable=async(A,m,E)=>{var v,C,b,y;const w=_t(v=this._users).call(v,W=>W.uid===m);if(!w)return void S.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));S.debug(O(C=O(b=O(y="[".concat(this._clientId,"] local ")).call(y,A," ")).call(b,E?"enabled":"disabled"," with uid ")).call(C,m));const k=A==="audio"?w.hasAudio:w.hasVideo;if(A==="audio"){w._trust_audio_enabled_state_=!0;const W=w._audio_enabled_;if(w._audio_enabled_=E,w._audio_enabled_===W)return;{var P,V;const H=w._audio_enabled_?"enable-local-audio":"disable-local-audio";S.debug(O(P=O(V="[".concat(this._clientId,"] user-info-updated, uid: ")).call(V,m,", msg: ")).call(P,H)),this.emit(Qe.USER_INFO_UPDATED,m,H)}}else{w._trust_video_enabled_state_=!0;const W=w._video_enabled_;if(w._video_enabled_=E,w._video_enabled_===W)return;{var j,st;const H=w._video_enabled_?"enable-local-video":"disable-local-video";S.debug(O(j=O(st="[".concat(this._clientId,"] user-info-update, uid: ")).call(st,m,", msg: ")).call(j,H)),this.emit(Qe.USER_INFO_UPDATED,m,H)}}const mt=A==="audio"?w.hasAudio:w.hasVideo;var Et,At,$,rt;return k!==mt?!k&&mt?(S.info(O(Et=O(At="[".concat(this._clientId,"] remote user ")).call(At,m," published ")).call(Et,A)),void this.emit(Qe.USER_PUBLISHED,w,A)):(A==="video"&&w._videoTrack&&w._videoTrack._destroy(),A==="audio"&&w._audioTrack,await this._p2pChannel.muteRemote(w,A),S.info(O($=O(rt="[".concat(this._clientId,"] remote user ")).call(rt,m," unpublished ")).call($,A)),void this.emit(Qe.USER_UNPUBLISHED,w,A)):void 0},this._handleMuteStream=async(A,m,E)=>{var v;S.debug("[".concat(this._clientId,"] receive mute message"),A,m,E);const C=_t(v=this._users).call(v,$=>$.uid===A);var b;if(!C)return void S.warning(O(b="[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ")).call(b,A));const y=m==="audio"?C.hasAudio:C.hasVideo;if(m==="audio"){C._trust_audio_mute_state_=!0;const $=C._audio_muted_;if(C._audio_muted_=E,C._audio_muted_===$)return;{var w,k;const rt=C._audio_muted_?"mute-audio":"unmute-audio";S.debug(O(w=O(k="[".concat(this._clientId,"] user-info-update, uid: ")).call(k,A,", msg: ")).call(w,rt)),this.emit(Qe.USER_INFO_UPDATED,A,rt)}}else{C._trust_video_mute_state_=!0;const $=C._video_muted_;if(C._video_muted_=E,C._video_muted_===$)return;{var P,V;const rt=C._video_muted_?"mute-video":"unmute-video";S.debug(O(P=O(V="[".concat(this._clientId,"] user-info-update, uid: ")).call(V,A,", msg: ")).call(P,rt)),this.emit(Qe.USER_INFO_UPDATED,A,rt)}}const j=m==="audio"?C.hasAudio:C.hasVideo;var st,mt,Et,At;return y!==j?!y&&j?(S.info(O(st=O(mt="[".concat(this._clientId,"] remote user ")).call(mt,A," published ")).call(st,m)),void this.emit(Qe.USER_PUBLISHED,C,m)):(m==="video"&&C._videoTrack&&C._videoTrack._destroy(),m==="audio"&&C._audioTrack,await this._p2pChannel.muteRemote(C,m),S.info(O(Et=O(At="[".concat(this._clientId,"] remote user ")).call(At,A," unpublished ")).call(Et,m)),void this.emit(Qe.USER_UNPUBLISHED,C,m)):void 0},this._handleP2PLost=async A=>{S.debug("[".concat(this._clientId,"] receive p2p lost"),A),Sr(A.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():S.warning("P2PLost stream not found",A)},this._handleTokenWillExpire=()=>{S.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.emit(Qe.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)},this._handleBeforeUnload=A=>{A.type==="beforeunload"&&A.returnValue!==void 0&&A.returnValue!==""||(this.leave(),S.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))},this._handleUpdateNetworkQuality=()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.emit(Qe.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const A={downlinkNetworkQuality:0,uplinkNetworkQuality:0};A.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),A.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.emit(Qe.NETWORK_QUALITY,A)},this._codec=t.codec,this._mode=t.mode,t.proxyServer&&(this._proxyServer=t.proxyServer,gt.setProxyServer(this._proxyServer),S.setProxyServer(this._proxyServer)),t.turnServer&&(this._turnServer=im({},this._turnServer,{mode:"manual"},t.turnServer)),this._clientId=Le(5,"client-"),this.store=new bL(t.codec,t.mode,this._clientId),this.store.clientCreated(),S.info(O(n=O(s=O(c=O(d="[".concat(this._clientId,"] Initializing AgoraRTC client v")).call(d,Pn," build: ")).call(c,dl,", mode: ")).call(s,this._mode,", codec: ")).call(n,this._codec)),this._performanceRecorder=NT(this._clientId,"join"),t.clientRoleOptions)try{bC(t.clientRoleOptions),h=hr({},t.clientRoleOptions)}catch(A){var p;S.warning(O(p="[".concat(this._clientId,"] ")).call(p,A.toString()))}this._statsCollector=new vl(this.store),this._statsCollector.onStatsException=(A,m,E)=>{var v,C,b;S.debug(O(v=O(C=O(b="[".concat(this._clientId,"] receive exception msg, code: ")).call(b,A,", msg: ")).call(C,m,", uid: ")).call(v,E)),this.emit(Qe.EXCEPTION,{code:A,msg:m,uid:E})},this._statsCollector.onUploadPublishDuration=(A,m,E,v)=>{var C;const b=_t(C=this._users).call(C,y=>y.uid===A);b&&gt.peerPublishStatus(this._sessionId,{subscribeElapse:v,audioPublishDuration:m,videoPublishDuration:E,peer:b._uintid})},this._gateway=new dD(this.store,{clientId:this._clientId,mode:this._mode,codec:this._codec,websocketRetryConfig:t.websocketRetryConfig||Ne,httpRetryConfig:t.httpRetryConfig||Ne,forceWaitGatewayResponse:t.forceWaitGatewayResponse===void 0||t.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:t.role,clientRoleOptions:h}),this._config=t,this._configDistribute=new My,this._p2pChannel=new jo(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents()}get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}async join(t,n,s,c,d){var h;this._performanceRecorder.checkPoint("startJoin"),this.store.joinStart();const p=bT(),A=bp()?window.isSecureContext:"Browser Not Support",m=()=>{S.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser")};bp()?window.isSecureContext||m():p||m();const E=gt.reportApiInvoke(this._sessionId,{name:Kt.JOIN,options:[t,n,s,c],states:{isHttps:p,isSecureContext:A},tag:Yt.TRACER});try{if(!s&&s!==null)throw new M(L.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));s&&pr(s,"token",1,2047),pr(t,"appid",1,2047),xh(n),c&&Fh(c),d&&pr(d,"optionalInfo",1,2047)}catch(w){throw E.onError(w),w}if(S.info(O(h="[".concat(this._clientId,"] start join channel ")).call(h,n)),this._leaveMutex.isLocked&&(S.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),S.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const w=new M(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw E.onError(w),w}this._sessionId||(this._sessionId=tp(),this.store.sessionId=this._sessionId),this._gateway.state="CONNECTING";const v={clientId:this._clientId,appId:t,sid:this._sessionId,cname:n,uid:typeof c!="string"?c:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:s||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:d,useLocalAccessPoint:this._useLocalAccessPoint};if(typeof c=="string"&&(v.stringUid=c,this._uintUid?(v.uid=this._uintUid,this._uintUid=void 0):v.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(v.aesmode=this._encryptionMode,v.aespassword=await pS(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new M(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(v.aessalt=this._encryptionSalt)}this._startSession(this._sessionId,{channel:n,appId:t}),vn(()=>{this.connectionState==="CONNECTING"&&gt.joinChannelTimeout(this._sessionId,5)},5e3);try{var C;let w;if(v.cloudProxyServer==="443only")v.proxyServer=ot("PROXY_SERVER_TYPE2");else if(v.cloudProxyServer==="proxy3"||v.cloudProxyServer==="proxy4"||v.cloudProxyServer==="proxy5"){const P=ot("PROXY_SERVER_TYPE3");$r(P)?v.proxyServer=P[0]:v.proxyServer=P}if(gt.setProxyServer(v.proxyServer),S.setProxyServer(v.proxyServer),this._performanceRecorder.checkPoint("startRequestAp"),this.store.requestAPStart(),v.stringUid&&!v.uid&&v.cloudProxyServer==="normal"){var b;await xg(v,this._axiosCancelSource.token,this._config.httpRetryConfig||Ne,!1);const P=await Fg(v.stringUid,v,this._axiosCancelSource.token,this._config.httpRetryConfig||Ne);S.debug(O(b="getUserAccount Success ".concat(v.stringUid," => ")).call(b,P)),v.uid=P,w=await zd(v,this._axiosCancelSource.token,this._config.httpRetryConfig||Ne)}else if(v.stringUid&&!v.uid){var y;const P=await Fg(v.stringUid,v,this._axiosCancelSource.token,this._config.httpRetryConfig||Ne);S.debug(O(y="getUserAccount Success ".concat(v.stringUid," => ")).call(y,P)),v.uid=P,w=await xg(v,this._axiosCancelSource.token,this._config.httpRetryConfig||Ne,!0)}else w=await xg(v,this._axiosCancelSource.token,this._config.httpRetryConfig||Ne,!0);if(!this._joinAndNotLeaveYet)throw new M(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this.store.requestAPEnd(),this._performanceRecorder.checkPoint("startJoinGateway"),this._configDistribute.startGetConfigDistribute(v,this._axiosCancelSource.token),this._configDistribute.on(xd.UPDATE_BITRATE_LIMIT,P=>{this._p2pChannel.updateBitrateLimit(P)}),this._key=s||t,this._joinInfo=im({},v,{cid:w.gatewayInfo.cid,uid:v.uid?v.uid:w.gatewayInfo.uid,vid:w.gatewayInfo.vid,apResponse:w.gatewayInfo.res,uni_lbs_ip:w.gatewayInfo.uni_lbs_ip,gatewayAddrs:w.gatewayInfo.gatewayAddrs});const k=await this._gateway.join(this._joinInfo,this._key);if(!this._joinAndNotLeaveYet)throw new M(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));return E.onSuccess(k),this._appId=t,this._channelName=v.cname,this._uid=k,this.store.uid=k,this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Pi()?"beforeunload":"pagehide",this._handleBeforeUnload),S.info(O(C="[".concat(this._clientId,"] Joining channel success: ")).call(C,n)),vn(()=>{S.startUpload()},5e3),this._performanceRecorder.checkPoint("finishJoin"),this.store.joinEnd(),fC(this),k}catch(w){const k=$r(w)?w[0]:w;throw S.error("[".concat(this._clientId,"] Joining channel failed, rollback"),k),k.code!==L.OPERATION_ABORTED&&(this._gateway.state="DISCONNECTED",this._reset()),E.onError(k),k}}async leave(){const t=gt.reportApiInvoke(this._sessionId,{name:Kt.LEAVE,options:[],tag:Yt.TRACER});S.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Pi()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),AC(this);const n=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return S.info("[".concat(this._clientId,"] Leaving channel repeated, success")),n(),t.onSuccess();await this._gateway.leave(this.connectionState!=="CONNECTED"),S.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,n(),t.onSuccess()}async publish(t,n=!0){var s;$r(t)||(t=[t]);const c=gt.reportApiInvoke(this._sessionId,{name:Kt.PUBLISH,options:ft(t).call(t,p=>p?Object(p).toString():"null"),tag:Yt.TRACER});if(t.length===0){const p=new M(L.INVALID_PARAMS,"track list is empty");return c.onError(p),p.throw()}if(this._gateway.role==="audience"){const p=new M(L.INVALID_OPERATION,"audience can not publish stream");return c.onError(p),p.throw()}for(const p of t){if(!(p instanceof la)){const A=new M(L.INVALID_PARAMS,"parameter is not local track");return c.onError(A),A.throw()}if(!p._enabled&&n){const A=new M(L.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(p.getTrackId()));return c.onError(A),A.throw()}}S.info(O(s="[".concat(this._clientId,"] Publishing tracks, id ")).call(s,ft(t).call(t,p=>"".concat(p.getTrackId()," ")))),await this._configDistribute.awaitConfigDistributeComplete(),n&&G(t).call(t,p=>{const A=this._configDistribute.getBitrateLimit();p instanceof dr&&A&&p.setBitrateLimit(A.uplink)});const d=await this._publishMutex.lock();try{var h;await this._publishHighStream(t),c.onSuccess(ft(t).call(t,p=>p.trackMediaType+":"+p.getTrackLabel()).toString()),S.info(O(h="[".concat(this._clientId,"] Publish success, id ")).call(h,ft(t).call(t,p=>"".concat(p.getTrackId()," "))))}catch(p){throw c.onError(p),S.error("[".concat(this._clientId,"] publish error"),p.toString()),p}finally{d()}}async unpublish(t,n=!0){var s;if(!this._joinInfo||this._uid===void 0)throw new M(L.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");t?$r(t)||(t=[t]):t=this._p2pChannel.getAllTracks();const c=gt.reportApiInvoke(this._sessionId,{name:Kt.UNPUBLISH,options:ft(t).call(t,p=>p.getTrackId()),tag:Yt.TRACER});S.info(O(s="[".concat(this._clientId,"] Unpublish tracks, tracks ")).call(s,ft(t).call(t,p=>"".concat(p.getTrackId()," "))," "));const d=await this._publishMutex.lock();try{var h;const p=await this._p2pChannel.unpublish(t);p&&await this._gateway.unpublish(p,this._uid),S.info(O(h="[".concat(this._clientId,"] Unpublish success,tracks ")).call(h,ft(t).call(t,A=>"".concat(A.getTrackId())))),c.onSuccess()}catch(p){throw c.onError(p),S.error("[".concat(this._clientId,"] unpublish error"),p.toString()),p}finally{d&&d()}}async subscribe(t,n){var s,c,d;Pr(n,"mediaType",["audio","video"]);const h=gt.reportApiInvoke(this._sessionId,{name:Kt.SUBSCRIBE,options:[t.uid,n],tag:Yt.TRACER});if(!this._joinInfo){const j=new M(L.INVALID_OPERATION,"Can't subscribe stream, not joined");throw h.onError(j),j}if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING"){const j=new M(L.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));throw h.onError(j),j}if(!_t(s=this._users).call(s,j=>j===t)){var p;const j=new M(L.INVALID_REMOTE_USER,"user is not in the channel");throw S.error(O(p="[".concat(this._clientId,"] can not subscribe ")).call(p,t.uid,", this user is not in the channel")),h.onError(j),j}if(!t.hasAudio&&!t.hasVideo){var A;const j=new M(L.INVALID_REMOTE_USER,"user is not published");throw S.error(O(A="[".concat(this._clientId,"] can not subscribe ")).call(A,t.uid,", user is not published")),h.onError(j),j}if(n==="audio"&&(!t.hasAudio||t._audioSSRC===void 0)||n==="video"&&(!t.hasVideo||t._videoSSRC===void 0)){var m,E;const j=new M(L.REMOTE_USER_IS_NOT_PUBLISHED);throw S.error(O(m=O(E="[".concat(this._clientId,"] can not subscribe ")).call(E,t.uid," with mediaType ")).call(m,n,", remote track is not published")),h.onError(j),j}const v=n==="audio"?t._audioSSRC:t._videoSSRC,C=n==="audio"?t._audioOrtc:t._videoOrtc,b={stream_type:n==="audio"?nr.AUDIO:nr.VIDEO,ssrcId:v};let y=this._subscribeMutex.get(t.uid);y||(y=new Un("sub-".concat(t.uid)),this._subscribeMutex.set(t.uid,y)),S.info(O(c=O(d="[".concat(this._clientId,"] subscribe user ")).call(d,t.uid,", mediaType: ")).call(c,n));const w=await y.lock();try{var k,P;if(this._p2pChannel.hasRemoteMedia(t,n))await this._p2pChannel.unmuteRemote(t,n);else try{vo.markSubscribeStart(this.store.clientId,v),this.store.subscribe(t.uid,n,performance.now()),await this._p2pChannel.subscribe(t,n,v,C),await this._gateway.subscribe(t.uid,b,!0),this.store.subscribe(t.uid,n,void 0,performance.now()),this._p2pChannel.reportSubscribeEvent(!0,null,t,n)}catch(st){if(this._p2pChannel.reportSubscribeEvent(!1,st==null?void 0:st.code,t,n),(st==null?void 0:st.code)!==L.WS_ABORT)throw st;this._p2pChannel.setPendingRemoteMedia(t,n)}S.info(O(k=O(P="[".concat(this._clientId,"] subscribe success user ")).call(P,t.uid,", mediaType: ")).call(k,n)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(st=>{S.warning("[".concat(this._clientId,"] auto set fallback failed"),st)});const j=n==="audio"?t._audioTrack:t._videoTrack;if(!j){const st=new M(L.UNEXPECTED_ERROR,"can not find remote track in user object");return h.onError(st),st.throw()}return h.onSuccess(j.getTrackId()),j}catch(j){var V;throw h.onError(j),S.error(O(V="[".concat(this._clientId,"] subscribe user ")).call(V,t.uid," error"),j),j}finally{w()}}async unsubscribe(t,n){var s,c,d;if(n&&Pr(n,"mediaType",["audio","video"]),!this._joinInfo)throw new M(L.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");const h=gt.reportApiInvoke(this._sessionId,{name:Kt.UNSUBSCRIBE,options:[t.uid,n],tag:Yt.TRACER});if(!_t(s=this._users).call(s,b=>b===t)){var p;const b=new M(L.INVALID_REMOTE_USER,"user is not in the channel");throw S.error(O(p="[".concat(this._clientId,"] can not subscribe ")).call(p,t.uid,", user is not in the channel")),h.onError(b),b}S.info(O(c=O(d="[".concat(this._clientId,"] unsubscribe uid: ")).call(d,t.uid,", mediaType: ")).call(c,n));let A=this._subscribeMutex.get(t.uid);A||(A=new Un("sub-".concat(t.uid)),this._subscribeMutex.set(t.uid,A));const m=await A.lock();try{var E,v;const b=await this._p2pChannel.unsubscribe(t,n);b&&await this._gateway.unsubscribe(b,t.uid),S.info(O(E=O(v="[".concat(this._clientId,"] unsubscribe success uid: ")).call(v,t.uid,", mediaType: ")).call(E,n)),h.onSuccess()}catch(b){if(b.code===L.DISCONNECT_P2P)return void S.warning("disconnecting p2p, abort unsubscribe request.");var C;throw S.error(O(C="[".concat(this._clientId,"] unsubscribe user ")).call(C,t.uid," error"),b.toString()),b}finally{m()}}setLowStreamParameter(t){(function(c){if(!c)throw new M(L.INVALID_PARAMS);er(c.width)||Ie(c.width,"streamParameter.width"),er(c.height)||Ie(c.height,"streamParameter.height"),er(c.framerate)||Ie(c.framerate,"streamParameter.framerate"),er(c.bitrate)||Ie(c.bitrate,"streamParameter.bitrate")})(t);const n=gt.reportApiInvoke(this._sessionId,{name:Kt.SET_LOW_STREAM_PARAMETER,options:[t],tag:Yt.TRACER});(!t.width&&t.height||t.width&&!t.height)&&S.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),S.info("[".concat(this._clientId,"] set low stream parameter to"),ht(t));const s=this._configDistribute.getLowStreamConfigDistribute();s&&s.bitrate&&t.bitrate&&s.bitrate<t.bitrate&&(t.bitrate=s.bitrate),this._lowStreamParameter=t,n.onSuccess()}async enableDualStream(){const t=gt.reportApiInvoke(this._sessionId,{name:Kt.ENABLE_DUAL_STREAM,options:[],tag:Yt.TRACER});if(!Dr().supportDualStream){gt.streamSwitch(this._sessionId,{lts:pt(),isdual:!0,succ:!1});const n=new M(L.NOT_SUPPORTED,"Your browser is not support dual stream");throw t.onError(n),n}if(this._isDualStreamEnabled){const n=new M(L.INVALID_OPERATION,"Dual stream is already enabled");throw t.onError(n),n}if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(n){throw gt.streamSwitch(this._sessionId,{lts:pt(),isdual:!0,succ:!1}),t.onError(n),n}this._isDualStreamEnabled=!0,gt.streamSwitch(this._sessionId,{lts:pt(),isdual:!0,succ:!0}),S.info("[".concat(this._clientId,"] enable dual stream")),t.onSuccess()}async disableDualStream(){if(!this._isDualStreamEnabled)return;if(!this._joinInfo)throw new M(L.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");const t=gt.reportApiInvoke(this._sessionId,{name:Kt.DISABLE_DUAL_STREAM,options:[],tag:Yt.TRACER});if(this._p2pChannel.getLocalMedia(xt.LocalVideoLowTrack))try{const n=await this._p2pChannel.unpublishLowStream();n&&await this._gateway.unpublish(n,this._joinInfo.stringUid||this._joinInfo.uid)}catch(n){throw gt.streamSwitch(this._sessionId,{lts:pt(),isdual:!1,succ:!1}),t.onError(n),n}this._isDualStreamEnabled=!1,gt.streamSwitch(this._sessionId,{lts:pt(),isdual:!1,succ:!0}),S.info("[".concat(this._clientId,"] disable dual stream")),t.onSuccess()}async setClientRole(t,n){(function(h){Pr(h,"role",["audience","host"])})(t),n&&bC(n);const s=gt.reportApiInvoke(this._sessionId,{name:Kt.SET_CLIENT_ROLE,options:[t,n],tag:Yt.TRACER});if(this._mode==="rtc"){S.warning("[".concat(this._clientId,"]rtc mode can not use setClientRole"));const h=new M(L.INVALID_OPERATION,"rtc mode can not use setClientRole");return s.onError(h),h.throw()}if(n&&n.level&&t==="host"){const h=new M(L.INVALID_OPERATION,"host mode can not set audience latency level");return s.onError(h),h.throw()}try{var c,d;if(t==="audience"&&this._p2pChannel.hasLocalMedia()){const h=new M(L.INVALID_OPERATION,"can not set client role to audience when publishing stream");return s.onError(h),h.throw()}await this._gateway.setClientRole(t,n),S.info(O(c=O(d="[".concat(this._clientId,"] set client role to ")).call(d,t,", level: ")).call(c,n&&n.level)),s.onSuccess()}catch(h){throw s.onError(h),h}}setProxyServer(t){if(pr(t,"proxyServer"),this.connectionState!=="DISCONNECTED")throw new M(L.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new M(L.INVALID_OPERATION,"You have already set the proxy");this._proxyServer=t,gt.setProxyServer(this._proxyServer),S.setProxyServer(this._proxyServer)}setTurnServer(t){if($r(t)||(t=[t]),this.connectionState!=="DISCONNECTED")throw new M(L.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new M(L.INVALID_OPERATION,"You have already set the proxy");var n;if(Qh(t))return this._turnServer={servers:t,mode:"original-manual"},void S.info(O(n="[".concat(this._clientId,"] Set original turnserver success: ")).call(n,ft(t).call(t,s=>s.urls).join(","),"."));G(t).call(t,s=>wC(s)),this._turnServer={servers:t,mode:"manual"},S.info("[".concat(this._clientId,"] Set turnserver success."))}startProxyServer(t){const n=gt.reportApiInvoke(this._sessionId,{name:Kt.START_PROXY_SERVER,options:[],tag:Yt.TRACER});if(this.connectionState!=="DISCONNECTED"){const c=new M(L.INVALID_OPERATION,"Start proxy server before join channel");throw n.onError(c),c}if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint){const c=new M(L.INVALID_OPERATION,"You have already set the proxy");throw n.onError(c),c}const s=[1,2,3,4,5];switch(t===void 0&&(t=1),t){case 1:this._cloudProxyServerMode="normal";break;case 2:this._cloudProxyServerMode="443only";break;case 3:this._cloudProxyServerMode="proxy3";break;case 4:this._cloudProxyServerMode="proxy4";break;case 5:this._cloudProxyServerMode="proxy5";break;default:{const c=new M(L.INVALID_PARAMS,"proxy server mode must be ".concat(s.join("|")));throw n.onError(c),c}}S.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),n.onSuccess()}stopProxyServer(){const t=gt.reportApiInvoke(this._sessionId,{name:Kt.STOP_PROXY_SERVER,options:[],tag:Yt.TRACER});if(this.connectionState!=="DISCONNECTED")throw new M(L.INVALID_OPERATION,"Stop proxy server after leave channel");gt.setProxyServer(),S.setProxyServer(),this._cloudProxyServerMode="disabled",S.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]},t.onSuccess()}setLocalAccessPoints(t,n){if(Uh(t,"serverList"),pr(n,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new M(L.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const s=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;t=ft(t).call(t,c=>{var d;return s.test(c)?O(d="".concat(c.replace(/\./g,"-"),".")).call(d,n):c}),this._useLocalAccessPoint=!0,jr("WEBCS_DOMAIN",t),jr("WEBCS_DOMAIN_BACKUP_LIST",t),jr("GATEWAY_DOMAINS",[n]),jr("EVENT_REPORT_DOMAIN",t[0]),jr("EVENT_REPORT_BACKUP_DOMAIN",t[1]||t[0]),jr("LOG_UPLOAD_SERVER","".concat(t[0],":6444")),S.info("set local access point success")}async setRemoteVideoStreamType(t,n){var s,c;Pr(n,"streamType",[0,1]);const d=gt.reportApiInvoke(this._sessionId,{name:Kt.SET_REMOTE_VIDEO_STREAM_TYPE,options:[t,n],tag:Yt.TRACER});try{await this._gateway.setRemoteVideoStreamType(t,n),vn(()=>{var h;const p=_t(h=this._users).call(h,A=>A.uid===t);p&&p.videoTrack&&p.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(h){throw d.onError(h),S.error("[".concat(this._clientId,"] set remote video stream type error"),h.toString()),h}S.info(O(s=O(c="[".concat(this._clientId,"] set remote ")).call(c,t," video stream type to ")).call(s,n)),this._remoteStreamTypeCacheMap.set(t,n),d.onSuccess()}async setStreamFallbackOption(t,n){var s,c;Pr(n,"fallbackType",[0,1,2]);const d=gt.reportApiInvoke(this._sessionId,{name:Kt.SET_STREAM_FALLBACK_OPTION,options:["too long to show",n],tag:Yt.TRACER});try{await this._gateway.setStreamFallbackOption(t,n)}catch(h){throw d.onError(h),S.error("[".concat(this._clientId,"] set stream fallback option"),h.toString()),h}S.info(O(s=O(c="[".concat(this._clientId,"] set remote ")).call(c,t," stream fallback type to ")).call(s,n)),this._streamFallbackTypeCacheMap.set(t,n),d.onSuccess()}setEncryptionConfig(t,n,s){(function(d){Pr(d,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(t),pr(n,"secret");const c=["aes-128-gcm2","aes-256-gcm2"];if(zt(c).call(c,t)){if(!s||!(s instanceof Uint8Array&&s.length===32))throw new M(L.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(s)throw new M(L.INVALID_PARAMS,"current encrypt mode does not need salt");new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(n)||S.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=t,this._encryptionSecret=n,s&&(this._encryptionSalt=vc(s))}async renewToken(t){pr(t,"token",1,2047);const n=gt.reportApiInvoke(this._sessionId,{name:Kt.RENEW_TOKEN,options:[t],tag:Yt.TRACER});if(!this._key||!this._joinInfo){const d=new M(L.INVALID_OPERATION,"renewToken should not be called before user join");return n.onError(d),d.throw()}const s=this._key;this._key=t,this._joinInfo&&(this._joinInfo.token=t);const c=await this._renewTokenMutex.lock();try{if(ot("USE_NEW_TOKEN")){S.debug("start renew token with ticket from unilbs");const d=await YD(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Ne);S.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:t,ticket:d})}else S.debug("start renew token without ticket"),await this._gateway.renewToken({token:t});S.debug("[".concat(this._clientId,"] renewToken success")),n.onSuccess()}catch(d){throw this._key=s,this._joinInfo.token=s,n.onError(d),S.error("[".concat(this._clientId,"] renewToken failed"),d.toString()),d}finally{c()}}enableAudioVolumeIndicator(){const t=gt.reportApiInvoke(this._sessionId,{name:Kt.ENABLE_AUDIO_VOLUME_INDICATOR,options:[],tag:Yt.TRACER});if(this._audioVolumeIndicationInterval)return S.warning("you have already enabled audio volume indicator!"),t.onSuccess();this._audioVolumeIndicationInterval=window.setInterval(()=>{const n=this._p2pChannel.getAudioLevels();this.emit(Qe.VOLUME_INDICATOR,n)},ot("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3),t.onSuccess()}getRTCStats(){const t=this._statsCollector.getRTCStats(),n=this._gateway.getInChannelInfo();return t.Duration=Math.round(n.duration/1e3),t}startLiveStreaming(t,n){const s=gt.reportApiInvoke(this._sessionId,{name:Kt.START_LIVE_STREAMING,options:[t,n],tag:Yt.TRACER});if(!n){if(this._codec!=="h264"){const d=new M(L.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");return s.onError(d),dt.reject(d)}if(!this._p2pChannel.hasLocalMedia()){const d=new M(L.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming");return s.onError(d),dt.reject(d)}}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t)){const d=new M(L.LIVE_STREAMING_TASK_CONFLICT);return s.onError(d),dt.reject(d)}const c=n?Wr.TRANSCODE:Wr.RAW;return this._createLiveStreamingClient(c).startLiveStreamingTask(t,c).then(()=>s.onSuccess()).catch(d=>{throw s.onError(d),d})}setLiveTranscoding(t){const n=gt.reportApiInvoke(this._sessionId,{name:Kt.SET_LIVE_TRANSCODING,options:[t],tag:Yt.TRACER});return this._createLiveStreamingClient(Wr.TRANSCODE).setTranscodingConfig(t).then(()=>n.onSuccess()).catch(s=>{throw n.onError(s),s})}stopLiveStreaming(t){var n;const s=gt.reportApiInvoke(this._sessionId,{name:Kt.STOP_LIVE_STREAMING,options:[t],tag:Yt.TRACER}),c=kt(n=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient]).call(n,d=>d&&d.hasUrl(t));if(!c.length){const d=new M(L.INVALID_PARAMS,"can not find live streaming url to stop");return s.onError(d),dt.reject(d)}return dt.all(ft(c).call(c,d=>d&&d.stopLiveStreamingTask(t))).then(()=>s.onSuccess()).catch(d=>{throw s.onError(d),d})}async addInjectStreamUrl(t,n){const s=gt.reportApiInvoke(this._sessionId,{name:Kt.ADD_INJECT_STREAM_URL,options:[t,n],tag:Yt.TRACER});try{if(!this._joinInfo)throw new M(L.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");const c=this._createLiveStreamingClient(Wr.INJECT);c.setInjectStreamConfig(n,0),await c.startLiveStreamingTask(t,Wr.INJECT)}catch(c){throw s.onError(c),c}s.onSuccess()}async removeInjectStreamUrl(){const t=gt.reportApiInvoke(this._sessionId,{name:Kt.REMOVE_INJECT_STREAM_URL,options:[],tag:Yt.TRACER});try{var n,s;const c=this._createLiveStreamingClient(Wr.INJECT),d=_t(n=Fe(ua(s=c.streamingTasks).call(s))).call(n,h=>h.mode===Wr.INJECT);if(!this._joinInfo||!d)throw new M(L.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");await c.stopLiveStreamingTask(d.url)}catch(c){throw t.onError(c),c}t.onSuccess()}async startChannelMediaRelay(t){const n=gt.reportApiInvoke(this._sessionId,{name:Kt.START_CHANNEL_MEDIA_RELAY,options:[t],tag:Yt.TRACER});try{Ep(t),await this._createChannelMediaRelayClient().startChannelMediaRelay(t)}catch(s){return n.onError(s),s.throw()}n.onSuccess()}async updateChannelMediaRelay(t){const n=gt.reportApiInvoke(this._sessionId,{name:Kt.UPDATE_CHANNEL_MEDIA_RELAY,options:[t],tag:Yt.TRACER});try{Ep(t),await this._createChannelMediaRelayClient().updateChannelMediaRelay(t)}catch(s){return n.onError(s),s.throw()}n.onSuccess()}async stopChannelMediaRelay(){const t=gt.reportApiInvoke(this._sessionId,{name:Kt.STOP_CHANNEL_MEDIA_RELAY,options:[],tag:Yt.TRACER});try{await this._createChannelMediaRelayClient().stopChannelMediaRelay()}catch(n){return t.onError(n),n.throw()}t.onSuccess()}sendStreamMessage(t,n=!0){if(!this._joinInfo)throw new M(L.INVALID_OPERATION,"can not send data stream, not joined");if(typeof t=="string"&&(t=new TextEncoder().encode(t)),new Blob([t]).size>1024)throw new M(L.INVALID_PARAMS,"stream message out of range.");return this._gateway.signal.request(xe.DATA_STREAM,{payload:vc(t)},!n)}sendMetadata(t){if(!this._joinInfo)throw new M(L.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([t]).size>1024)throw new M(L.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(xe.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:vc(t)})}async sendCustomReportMessage(t){$r(t)||(t=[t]),G(t).call(t,Z2);const n=gt.reportApiInvoke(this._sessionId,{name:Kt.SEND_CUSTOM_REPORT_MESSAGE,options:[ht(t)],tag:Yt.TRACER});if(!this._joinInfo){const s=new M(L.INVALID_OPERATION,"can not send custom report, not joined");return n.onError(s),s.throw()}await gt.sendCustomReportMessage(this._joinInfo.sid,t),n.onSuccess()}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(t,n){Pr(n.spatialLayer,"spatialLayer",[0,1,2,3]),Pr(n.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(t,n)}catch(s){throw S.error("[".concat(this._clientId,"] pick SVC layer failed"),s.toString()),s}}_reset(){var t;S.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=Lo.CancelToken.source(),this._streamFallbackTypeCacheMap=new re,this._remoteStreamTypeCacheMap=new re,this._configDistribute.stopGetConfigDistribute(),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,G(t=this._users).call(t,n=>{n._audioTrack&&n._audioTrack._destroy(),n._videoTrack&&n._videoTrack._destroy()}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._p2pChannel.reset(),this._publishMutex=new Un("client-publish"),this._subscribeMutex=new re,this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0)}_startSession(t,n){var s,c,d;const h=t||tp();t?S.debug(O(s="[".concat(this._clientId,"] new Session ")).call(s,h)):S.debug(O(c=O(d="[".concat(this._clientId,"] renewSession ")).call(d,this._sessionId," => ")).call(c,h)),this._sessionId=h,this.store.sessionId=h,n?gt.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:n.channel,appid:n.appId,mode:this._mode}):this._joinInfo?gt.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:this._joinInfo.cname,appid:this._joinInfo.appId,mode:this._mode}):this._gateway.joinInfo&&gt.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId,mode:this._mode}),this._joinInfo&&(this._joinInfo.sid=h),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=h)}async _publishHighStream(t){if(!this._joinInfo||this._uid===void 0)throw new M(L.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new M(L.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&ot("FORCE_TURN")&&!ot("TURN_ENABLE_TCP")&&!ot("TURN_ENABLE_UDP"))throw new M(L.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");S.debug("[".concat(this._clientId,"] publish high stream"));try{const s=await this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter),c=(await s.next()).value;if(c){var n;let d;try{d=await this._gateway.publish(this._uid,c,!0)}catch(h){if(h.code!==L.DISCONNECT_P2P)throw s.throw(h),h}await s.next(((n=d)===null||n===void 0?void 0:n.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const d of t)d.muted&&await this._p2pChannel.muteLocalTrack(d)}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,t),(s==null?void 0:s.code)===L.WS_ABORT)return;throw s}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new M(L.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new M(L.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));S.debug("[".concat(this._clientId,"] publish low stream"));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t.bitrate));try{const s=await this._p2pChannel.publishLowStream(this._lowStreamParameter),c=(await s.next()).value;if(c){var n;let d;try{d=await this._gateway.publish(this._uid,c,!0)}catch(h){if(h.code!==L.DISCONNECT_P2P)throw s.throw(h),h}s.next(((n=d)===null||n===void 0?void 0:n.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,void 0,!0),(s==null?void 0:s.code)===L.WS_ABORT)return;throw s}}_createLiveStreamingClient(t){if(!this._joinInfo||!this._appId)return new M(L.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const n=()=>new Uy(this._joinInfo,this._config.websocketRetryConfig||Ne,this._config.httpRetryConfig||Ne),s=c=>{c.onLiveStreamError=(d,h)=>{gt.reportApiInvoke(this._sessionId,{name:Kt.ON_LIVE_STREAM_ERROR,options:[d,h],tag:Yt.TRACER}).onSuccess(),this.emit(Qe.LIVE_STREAMING_ERROR,d,h)},c.onLiveStreamWarning=(d,h)=>{gt.reportApiInvoke(this._sessionId,{name:Kt.ON_LIVE_STREAM_WARNING,options:[d,h],tag:Yt.TRACER}).onSuccess(),this.emit(Qe.LIVE_STREAMING_WARNING,d,h)},c.on(pl.REQUEST_WORKER_MANAGER_LIST,(d,h,p)=>{if(!this._joinInfo)return p(new M(L.INVALID_OPERATION,"can not find join info to get worker manager"));ky(d,this._joinInfo,this._axiosCancelSource.token,Ne).then(h).catch(p)})};switch(t){case Wr.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=n(),s(this._liveRawStreamingClient)),this._liveRawStreamingClient;case Wr.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=n(),s(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case Wr.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=n(),this._injectStreamingClient.on(pl.REQUEST_WORKER_MANAGER_LIST,(c,d,h)=>{if(!this._joinInfo)return h(new M(L.INVALID_OPERATION,"can not find join info to get worker manager"));ky(c,this._joinInfo,this._axiosCancelSource.token,Ne).then(d).catch(h)}),this._injectStreamingClient.onInjectStatusChange=(c,d,h)=>{this.emit(Qe.INJECT_STREAM_STATUS,c,d,h)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){return this._joinInfo?(this._channelMediaRelayClient||(this._channelMediaRelayClient=new Fy(this._joinInfo,this._clientId,this._config.websocketRetryConfig||Ne,this._config.httpRetryConfig||Ne),this._channelMediaRelayClient.on("state",t=>{t==="RELAY_STATE_FAILURE"&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.emit(Qe.CHANNEL_MEDIA_RELAY_STATE,t)}),this._channelMediaRelayClient.on("event",t=>{this.emit(Qe.CHANNEL_MEDIA_RELAY_EVENT,t)})),this._channelMediaRelayClient):new M(L.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw()}_handleGatewayEvents(){this._gateway.on(Ir.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(Ir.CONNECTION_STATE_CHANGE,(t,n,s)=>{var c,d;const h=()=>{this.emit(Qe.CONNECTION_STATE_CHANGE,t,n,s)};if(gt.reportApiInvoke(this._sessionId,{name:Kt.CONNECTION_STATE_CHANGE,options:[t,n,s],tag:Yt.TRACER}).onSuccess(ht({cur:t,prev:n,reason:s})),S.info(O(c=O(d="[".concat(this._clientId,"] connection state change: ")).call(d,n," -> ")).call(c,t)),t==="DISCONNECTED")return this._reset(),void h();var p;if(t==="RECONNECTING")G(p=this._users).call(p,E=>{E._trust_in_room_=!1,E._trust_audio_enabled_state_=!1,E._trust_video_enabled_state_=!1,E._trust_audio_mute_state_=!1,E._trust_video_mute_state_=!1,E._trust_stream_added_state_=!1}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(t==="CONNECTED"){var A,m;G(A=this._streamFallbackTypeCacheMap).call(A,(E,v)=>{this._gateway.setStreamFallbackOption(v,E).catch(C=>S.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),C))}),G(m=this._remoteStreamTypeCacheMap).call(m,(E,v)=>{this._gateway.setRemoteVideoStreamType(v,E).catch(C=>S.warning("[".concat(this._clientId,"] auto set remote stream type failed"),C))}),this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{var E;if(this.connectionState!=="CONNECTED")return;this._userOfflineTimeout=void 0;const v=kt(E=this._users).call(E,C=>!C._trust_in_room_);G(v).call(v,C=>{var b;S.debug(O(b="[".concat(this._clientId,"] user offline timeout, emit user offline ")).call(b,C.uid)),this._handleUserOffline({uid:C.uid})})},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{var E;this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,G(E=this._users).call(E,v=>{var C,b,y,w,k;v._trust_audio_mute_state_||(S.debug(O(C="[".concat(this._clientId,"] auto dispatch audio unmute event ")).call(C,v.uid)),this._handleMuteStream(v.uid,"audio",!1)),v._trust_video_mute_state_||(S.debug(O(b="[".concat(this._clientId,"] auto dispatch video unmute event ")).call(b,v.uid)),this._handleMuteStream(v.uid,"video",!1)),v._trust_audio_enabled_state_||(S.debug(O(y="[".concat(this._clientId,"] auto dispatch enable local audio ")).call(y,v.uid)),this._handleSetStreamLocalEnable("audio",v.uid,!0)),!v._trust_video_enabled_state_&&v._video_enabled_&&(S.debug(O(w="[".concat(this._clientId,"] auto dispatch enable local video ")).call(w,v.uid)),this._handleSetStreamLocalEnable("video",v.uid,!0)),v._trust_stream_added_state_||(S.debug(O(k="[".concat(this._clientId,"] auto dispatch stream remove ")).call(k,v.uid)),this._handleRemoveStream({uid:v.uid,uint_id:v._uintid}))}))},1e3)}h()}),this._gateway.on(Ir.REQUEST_NEW_GATEWAY_LIST,(t,n)=>{if(!this._joinInfo)return n(new M(L.UNEXPECTED_ERROR,"can not recover, no join info"));zd(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Ne).then(s=>{var c;this._joinInfo&&(this._joinInfo.apResponse=s.gatewayInfo.res),t(ft(c=s.gatewayInfo.gatewayAddrs).call(c,d=>{if(this._joinInfo&&this._joinInfo.proxyServer){var h,p;const A=d.split(":");return O(h=O(p="wss://".concat(this._joinInfo.proxyServer,"/ws/?h=")).call(p,A[0],"&p=")).call(h,A[1])}return"wss://".concat(d)}))}).catch(n)}),this._gateway.on(Ir.NETWORK_QUALITY,t=>{this._networkQualitySensitivity==="normal"&&this.emit(Qe.NETWORK_QUALITY,t)}),this._gateway.on(Ir.STREAM_TYPE_CHANGE,(t,n)=>{this.emit(Qe.STREAM_TYPE_CHANGED,t,n),gt.reportApiInvoke(this._sessionId,{name:Kt.STREAM_TYPE_CHANGE,options:[t,n],tag:Yt.TRACER}).onSuccess(ht({uid:t,streamType:n}))}),this._gateway.on(Ir.IS_P2P_DISCONNECTED,t=>{this._p2pChannel.isP2PDisconnected()?t(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?t(!1):t(!0)}),this._gateway.on(Ir.NEED_RENEW_SESSION,()=>{this._startSession()}),this._gateway.on(Ir.REQUEST_P2P_CONNECTION_PARAMS,async(t,n,s)=>{try{n(await this._p2pChannel.startP2PConnection(t))}catch(c){s(c)}}),this._gateway.on(Ir.JOIN_RESPONSE,t=>{const{dtlsParameters:n,iceParameters:s,candidates:c,rtpCapabilities:d,setup:h,cname:p,defaultIp:A,defaultPort:m}=nT(t.ortc);this._p2pChannel.connect(s,n,c,d,h,p,A,m)}),this._gateway.signal.on(rr.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(rr.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(rr.ON_ADD_AUDIO_STREAM,t=>this._handleAddAudioOrVideoStream("audio",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc)),this._gateway.signal.on(rr.ON_ADD_VIDEO_STREAM,t=>this._handleAddAudioOrVideoStream("video",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc)),this._gateway.signal.on(rr.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(rr.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(rr.MUTE_AUDIO,t=>this._handleMuteStream(t.uid,"audio",!0)),this._gateway.signal.on(rr.UNMUTE_AUDIO,t=>this._handleMuteStream(t.uid,"audio",!1)),this._gateway.signal.on(rr.MUTE_VIDEO,t=>this._handleMuteStream(t.uid,"video",!0)),this._gateway.signal.on(rr.UNMUTE_VIDEO,t=>this._handleMuteStream(t.uid,"video",!1)),this._gateway.signal.on(rr.RECEIVE_METADATA,t=>{const n=Wd(t.metadata);this.emit(Qe.RECEIVE_METADATA,t.uid,n)}),this._gateway.signal.on(rr.ON_DATA_STREAM,t=>{t.seq&&delete t.seq,t.payload=Wd(t.payload),this.emit(Qe.STREAM_MESSAGE,t.uid,t.payload),this.onStreamMessage&&this.onStreamMessage(t)}),this._gateway.signal.on(rr.ON_CRYPT_ERROR,()=>{ks(()=>{S.warning("[".concat(this._clientId,"] on crypt error")),this.emit(Qe.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(rr.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(rr.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{S.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0),this.emit(Qe.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(rr.ON_STREAM_FALLBACK_UPDATE,t=>{var n,s;S.debug(O(n=O(s="[".concat(this._clientId,"] stream fallback peerId: ")).call(s,t.stream_id,", attr: ")).call(n,t.stream_type)),this.emit(Qe.STREAM_FALLBACK,t.stream_id,t.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(rr.ON_PUBLISH_STREAM,t=>{var n;this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,ht({proxy:t.proxy})),S.info(O(n="[".concat(this._clientId,"] on publish stream, ")).call(n,ht(t))),t.proxy!==void 0&&this.emit(Qe.IS_USING_CLOUD_PROXY,!!t.proxy))}),this._gateway.signal.on(rr.ENABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!0)}),this._gateway.signal.on(rr.DISABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!1)}),this._gateway.signal.on(ye.REQUEST_TIMEOUT,(t,n)=>{if(this._joinInfo)switch(t){case xe.PUBLISH:{if(!n)return;const p=(n=n).ortc;if(p){var s,c,d,h;const A=bs(p).call(p,({stream_type:v})=>v===Kr.Audio),m=bs(p).call(p,({stream_type:v})=>v!==Kr.Audio),E=bs(p).call(p,({stream_type:v})=>v===Kr.Screen||v===Kr.ScreenLow);n.state==="offer"&&gt.publish(this._joinInfo.sid,{eventElapse:vo.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:L.TIMEOUT,audio:A,video:m,p2pid:n.p2p_id,publishRequestid:this.store.pubId,screenshare:E,audioName:A?(s=_t(p).call(p,({stream_type:v})=>v===Kr.Audio))===null||s===void 0||(c=s.ssrcs[0])===null||c===void 0?void 0:c.ssrcId.toString():void 0,videoName:m?(d=_t(p).call(p,({stream_type:v})=>v!==Kr.Audio))===null||d===void 0||(h=d.ssrcs[0])===null||h===void 0?void 0:h.ssrcId.toString():void 0})}break}case xe.SUBSCRIBE:(n=n)&&gt.subscribe(this._joinInfo.sid,{succ:!1,ec:L.TIMEOUT,audio:n.stream_type===nr.AUDIO,video:n.stream_type===nr.VIDEO,peerid:n.stream_id,subscribeRequestid:n.ssrcId,p2pid:this.store.p2pId,eventElapse:vo.measureFromSubscribeStart(this.store.clientId,n.ssrcId)})}}),this._gateway.signal.on(rr.ON_P2P_OK,t=>{this.uid===this._uid&&t.proxy!==void 0&&this.emit(Qe.IS_USING_CLOUD_PROXY,!!t.proxy)})}_handleP2PChannelEvents(){this._p2pChannel.on(ze.RequestMuteLocal,async(t,n,s)=>{if(this._joinInfo)try{await this._gateway.muteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),n()}catch(c){c.code===L.DISCONNECT_P2P?n():s(c)}else n()}),this._p2pChannel.on(ze.RequestUnmuteLocal,async(t,n,s)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),n()}catch(c){c.code===L.DISCONNECT_P2P?n():s(c)}else n()}),this._p2pChannel.on(ze.RequestRePublish,(t,n,s)=>{this.publish(t,!1).then(n).catch(s)}),this._p2pChannel.on(ze.RequestReSubscribe,async(t,n,s)=>{try{for(const{user:c,kind:d}of t)d===nr.VIDEO?await this.subscribe(c,"video"):await this.subscribe(c,"audio");n()}catch(c){s(c)}}),this._p2pChannel.on(ze.RequestUploadStats,(t,n)=>{this._gateway.uploadStats(t,n)}),this._p2pChannel.on(ze.MediaReconnectStart,t=>{this.emit(Qe.MEDIA_RECONNECT_START,t)}),this._p2pChannel.on(ze.MediaReconnectEnd,t=>{this.emit(Qe.MEDIA_RECONNECT_END,t)}),this._p2pChannel.on(ze.NeedSignalRTT,t=>{t(this._gateway.getSignalRTT())}),this._p2pChannel.on(ze.RequestRestartICE,async()=>{const t=await this._p2pChannel.reEstablish();if(t){const{response:n}=await this._gateway.restartICE({iceParameters:t.iceParameters}),{candidates:s,iceParameters:c,defaultIp:d,defaultPort:h}=function(p){const A=p.ice,{candidates:m,defaultIp:E,defaultPort:v}=aT(A.candidates);return{candidates:m,iceParameters:{iceUfrag:A.iceUfrag,icePwd:A.icePwd},defaultIp:E,defaultPort:v}}(n);await t.restartICE(c,s,d,h)}}),this._p2pChannel.on(ze.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(ze.RequestReconnectPC,async()=>{var t;const{iceParameters:n,dtlsParameters:s,rtpCapabilities:c}=await this._p2pChannel.startP2PConnection({turnServer:(t=this._joinInfo)===null||t===void 0?void 0:t.turnServer}),{gatewayEstablishParams:d}=await this._gateway.reconnectPC({iceParameters:n,dtlsParameters:s,rtpCapabilities:c}),{dtlsParameters:h,iceParameters:p,candidates:A,rtpCapabilities:m,setup:E,cname:v,defaultIp:C,defaultPort:b}=nT(d);await this._p2pChannel.connect(p,h,A,m,E,v,C,b),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(ze.RequestUnpublishForReconnectPC,async(t,n,s)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(t,this._uid),n()):s()}),this._p2pChannel.on(ze.P2PLost,()=>{this.emit(Qe.P2P_LOST,this.store.uid)})}getKeyMetrics(){return this.store.keyMetrics}}function DT(r){return Ie(r.timeout,"config.timeout",0,1e5),Ie(r.timeoutFactor,"config.timeoutFactor",0,100,!1),Ie(r.maxRetryCount,"config.maxRetryConfig",0,1/0),Ie(r.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}function LT(r){return pr(r.turnServerURL,"turnServerURL"),pr(r.username,"username"),pr(r.password,"password"),r.udpport&&Ie(r.udpport,"udpport",1,99999,!0),r.forceturn&&Ac(r.forceturn,"forceturn"),r.security&&Ac(r.security,"security"),r.tcpport&&Ie(r.tcpport,"tcpport",1,99999,!0),!0}function MT(r){return r.level!==void 0&&Pr(r.level,"level",[1,2,3]),!0}function DL(r){return pr(r.reportId,"params.reportId",0,100,!1),pr(r.category,"params.category",0,100,!1),pr(r.event,"params.event",0,100,!1),pr(r.label,"params.label",0,100,!1),Ie(r.value,"params.value",SC,CC,!1),!0}ru([Vd({report:gt}),Ui("design:type",Function),Ui("design:paramtypes",[String]),Ui("design:returntype",void 0)],Ll.prototype,"setProxyServer",null),ru([Vd(),Ui("design:type",Function),Ui("design:paramtypes",[Object]),Ui("design:returntype",void 0)],Ll.prototype,"setTurnServer",null),ru([Vd({report:gt}),Ui("design:type",Function),Ui("design:paramtypes",[Array,String]),Ui("design:returntype",void 0)],Ll.prototype,"setLocalAccessPoints",null),ru([Vd({report:gt}),Ui("design:type",Function),Ui("design:paramtypes",[String,String,Uint8Array]),Ui("design:returntype",void 0)],Ll.prototype,"setEncryptionConfig",null),ru([qh({report:gt}),Ui("design:type",Function),Ui("design:paramtypes",[Object,Object]),Ui("design:returntype",dt)],Ll.prototype,"pickSVCLayer",null),function(r){r.CONNECTION_STATE_CHANGE="connection-state-change",r.MEDIA_RECONNECT_START="media-reconnect-start",r.MEDIA_RECONNECT_END="media-reconnect-end",r.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",r.USER_JOINED="user-joined",r.USER_LEAVED="user-left",r.USER_PUBLISHED="user-published",r.USER_UNPUBLISHED="user-unpublished",r.USER_INFO_UPDATED="user-info-updated",r.CLIENT_BANNED="client-banned",r.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",r.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",r.VOLUME_INDICATOR="volume-indicator",r.CRYPT_ERROR="crypt-error",r.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",r.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",r.NETWORK_QUALITY="network-quality",r.STREAM_TYPE_CHANGED="stream-type-changed",r.STREAM_FALLBACK="stream-fallback",r.RECEIVE_METADATA="receive-metadata",r.STREAM_MESSAGE="stream-message",r.LIVE_STREAMING_ERROR="live-streaming-error",r.LIVE_STREAMING_WARNING="live-streaming-warning",r.INJECT_STREAM_STATUS="stream-inject-status",r.EXCEPTION="exception",r.ERROR="error",r.P2P_LOST="p2p_lost"}(be||(be={})),function(r){r.NETWORK_ERROR="NETWORK_ERROR",r.SERVER_ERROR="SERVER_ERROR",r.MULTI_IP="MULTI_IP",r.TIMEOUT="TIMEOUT",r.OFFLINE="OFFLINE",r.LEAVE="LEAVE"}(Bi||(Bi={})),function(r){r.WIN_10="Windows 10",r.WIN_81="Windows 8.1",r.WIN_8="Windows 8",r.WIN_7="Windows 7",r.WIN_VISTA="Windows Vista",r.WIN_SERVER_2003="Windows Server 2003",r.WIN_XP="Windows XP",r.WIN_2000="Windows 2000",r.ANDROID="Android",r.OPEN_BSD="Open BSD",r.SUN_OS="Sun OS",r.LINUX="Linux",r.IOS="iOS",r.MAC_OS="Mac OS",r.QNX="QNX",r.UNIX="UNIX",r.BEOS="BeOS",r.OS_2="OS/2",r.SEARCH_BOT="Search Bot"}(Np||(Np={})),function(r){r.CHROME="Chrome",r.SAFARI="Safari",r.EDGE="Edge",r.FIREFOX="Firefox",r.OPERA="OPR",r.QQ="QQBrowser",r.WECHAT="MicroMessenger"}(Dl||(Dl={})),function(r){r.FREE="free",r.UPLOADING="uploading"}(kT||(kT={})),function(r){r.NONE="none",r.INIT="init",r.CANPLAY="canplay",r.PLAYING="playing",r.PAUSED="paused",r.SUSPEND="suspend",r.STALLED="stalled",r.WAITING="waiting",r.ERROR="error",r.DESTROYED="destroyed",r.ABORT="abort",r.ENDED="ended",r.EMPTIED="emptied"}(Op||(Op={}));const LL={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};var ei,Jr,PT,de,Zt,BT,UT,xT,FT,QT,VT,Ml,Sn,Oe,Ar,Ko,ir,ae,Ps;(function(r){r.PUBLISH="publish",r.SUBSCRIBE="subscribe",r.SESSION_INIT="session_init",r.JOIN_CHOOSE_SERVER="join_choose_server",r.REQ_USER_ACCOUNT="req_user_account",r.JOIN_GATEWAY="join_gateway",r.STREAM_SWITCH="stream_switch",r.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",r.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",r.FIRST_VIDEO_RECEIVED="first_video_received",r.FIRST_AUDIO_RECEIVED="first_audio_received",r.FIRST_VIDEO_DECODE="first_video_decode",r.FIRST_AUDIO_DECODE="first_audio_decode",r.ON_ADD_AUDIO_STREAM="on_add_audio_stream",r.ON_ADD_VIDEO_STREAM="on_add_video_stream",r.ON_UPDATE_STREAM="on_update_stream",r.ON_REMOVE_STREAM="on_remove_stream",r.USER_ANALYTICS="req_user_analytics"})(ei||(ei={})),function(r){r.SESSION="io.agora.pb.Wrtc.Session",r.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",r.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",r.JOIN_GATEWAT="io.agora.pb.Wrtc.JoinGateway",r.PUBLISH="io.agora.pb.Wrtc.Publish",r.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",r.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",r.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",r.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",r.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",r.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",r.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",r.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",r.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",r.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",r.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",r.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",r.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",r.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",r.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",r.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",r.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",r.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",r.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",r.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",r.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",r.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics"}(Jr||(Jr={})),function(r){r[r.WORKER_EVENT=156]="WORKER_EVENT",r[r.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}(PT||(PT={})),function(r){r.CREATE_CLIENT="createClient",r.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",r.SET_AREA="setArea",r.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",r.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",r.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",r.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",r.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",r.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",r.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",r.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",r.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",r.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",r.START_PROXY_SERVER="Client.startProxyServer",r.STOP_PROXY_SERVER="Client.stopProxyServer",r.SET_PROXY_SERVER="Client.setProxyServer",r.SET_TURN_SERVER="Client.setTurnServer",r.SET_CLIENT_ROLE="Client.setClientRole",r.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",r.ENABLE_DUAL_STREAM="Client.enableDualStream",r.DISABLE_DUAL_STREAM="Client.disableDualStream",r.JOIN="Client.join",r.LEAVE="Client.leave",r.PUBLISH="Client.publish",r.UNPUBLISH="Client.unpublish",r.SUBSCRIBE="Client.subscribe",r.UNSUBSCRIBE="Client.unsubscribe",r.RENEW_TOKEN="Client.renewToken",r.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",r.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",r.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",r.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",r.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",r.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",r.START_LIVE_STREAMING="Client.startLiveStreaming",r.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",r.STOP_LIVE_STREAMING="Client.stopLiveStreaming",r.ADD_INJECT_STREAM_URL="Client.addInjectStreamUrl",r.REMOVE_INJECT_STREAM_URL="Client.removeInjectStreamUrl",r.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",r.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",r.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",r.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",r.SET_CONFIG_DISTRIBUTE="_configDistribute",r.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",r.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",r.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",r.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",r.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",r.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",r.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",r.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",r.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",r.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",r.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",r.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",r.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",r.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",r.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",r.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",r.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",r.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",r.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",r.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",r.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",r.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",r.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",r.STREAM_TYPE_CHANGE="streamTypeChange"}(de||(de={})),function(r){r.TRACER="tracer"}(Zt||(Zt={})),function(r){r.IDLE="IDLE",r.INITING="INITING",r.INITEND="INITEND"}(BT||(BT={})),function(r){r.STATE_CHANGE="state_change",r.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",r.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",r.CAMERA_DEVICE_CHANGED="cameraDeviceChanged"}(UT||(UT={})),function(r){r[r.ACCESS_POINT=101]="ACCESS_POINT",r[r.UNILBS=201]="UNILBS",r[r.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR"}(xT||(xT={})),function(r){r[r.IIIEGAL_APPID=1]="IIIEGAL_APPID",r[r.IIIEGAL_UID=2]="IIIEGAL_UID",r[r.INTERNAL_ERROR=3]="INTERNAL_ERROR"}(FT||(FT={})),function(r){r[r.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",r[r.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",r[r.INTERNAL_ERROR=8]="INTERNAL_ERROR",r[r.NO_AUTHORIZED=9]="NO_AUTHORIZED",r[r.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",r[r.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",r[r.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",r[r.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",r[r.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",r[r.USER_OVERLOAD=16]="USER_OVERLOAD",r[r.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",r[r.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND"}(QT||(QT={})),function(r){r[r.NO_FLAG_SET=100]="NO_FLAG_SET",r[r.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",r[r.INVALID_FALG_SET=102]="INVALID_FALG_SET",r[r.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",r[r.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",r[r.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",r[r.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",r[r.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",r[r.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",r[r.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",r[r.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",r[r.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",r[r.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",r[r.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",r[r.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",r[r.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",r[r.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV"}(VT||(VT={})),function(r){r[r.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",r[r.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",r[r.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",r[r.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",r[r.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",r[r.K_TICKET_INVALID=7]="K_TICKET_INVALID",r[r.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",r[r.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",r[r.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",r[r.K_UID_BANNED=14]="K_UID_BANNED",r[r.K_IP_BANNED=15]="K_IP_BANNED",r[r.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",r[r.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",r[r.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",r[r.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",r[r.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",r[r.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",r[r.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",r[r.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",r[r.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",r[r.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",r[r.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",r[r.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",r[r.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",r[r.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",r[r.ERR_INVALID_UID=117]="ERR_INVALID_UID",r[r.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",r[r.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",r[r.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",r[r.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",r[r.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",r[r.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",r[r.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",r[r.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",r[r.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",r[r.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",r[r.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",r[r.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",r[r.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",r[r.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",r[r.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",r[r.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",r[r.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",r[r.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",r[r.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",r[r.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",r[r.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",r[r.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",r[r.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",r[r.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",r[r.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",r[r.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",r[r.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",r[r.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",r[r.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY"}(Ml||(Ml={})),function(r){r.CONNECTING="connecting",r.CONNECTED="connected",r.RECONNECTING="reconnecting",r.CLOSED="closed"}(Sn||(Sn={})),function(r){r.WS_CONNECTED="ws_connected",r.WS_RECONNECTING="ws_reconnecting",r.WS_CLOSED="ws_closed",r.ON_BINARY_DATA="on_binary_data",r.REQUEST_RECOVER="request_recover",r.REQUEST_JOIN_INFO="request_join_info",r.REQUEST_REJOIN_INFO="req_rejoin_info",r.IS_P2P_DISCONNECTED="is_p2p_dis",r.DISCONNECT_P2P="dis_p2p",r.NEED_RENEW_SESSION="need-sid",r.REPORT_JOIN_GATEWAY="report_join_gateway",r.REQUEST_TIMEOUT="request_timeout",r.REQUEST_SUCCESS="request_success"}(Oe||(Oe={})),function(r){r.PING="ping",r.PING_BACK="ping_back",r.JOIN="join_v2",r.REJOIN="rejoin",r.LEAVE="leave",r.SET_CLIENT_ROLE="set_client_role",r.PUBLISH="publish",r.UNPUBLISH="unpublish",r.SUBSCRIBE="subscribe",r.UNSUBSCRIBE="unsubscribe",r.SUBSCRIBE_CHANGE="subscribe_change",r.TRAFFIC_STATS="traffic_stats",r.RENEW_TOKEN="renew_token",r.SWITCH_VIDEO_STREAM="switch_video_stream",r.SET_FALLBACK_OPTION="set_fallback_option",r.GATEWAY_INFO="gateway_info",r.CONTROL="control",r.SEND_METADATA="send_metadata",r.DATA_STREAM="data_stream",r.PICK_SVC_LAYER="pick_svc_layer"}(Ar||(Ar={})),function(r){r.PUBLISH_STATS="publish_stats",r.PUBLISH_RELATED_STATS="publish_related_stats",r.SUBSCRIBE_STATS="subscribe_stats",r.SUBSCRIBE_RELATED_STATS="subscribe_related_stats",r.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length"}(Ko||(Ko={})),function(r){r.ON_USER_ONLINE="on_user_online",r.ON_USER_OFFLINE="on_user_offline",r.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",r.ON_PUBLISH_STREAM="on_publish_stream",r.ON_UPLINK_STATS="on_uplink_stats",r.ON_P2P_LOST="on_p2p_lost",r.ON_REMOVE_STREAM="on_remove_stream",r.ON_ADD_AUDIO_STREAM="on_add_audio_stream",r.ON_ADD_VIDEO_STREAM="on_add_video_stream",r.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",r.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",r.ON_USER_BANNED="on_user_banned",r.ON_NOTIFICATION="on_notification",r.ON_CRYPT_ERROR="on_crypt_error",r.MUTE_AUDIO="mute_audio",r.MUTE_VIDEO="mute_video",r.UNMUTE_AUDIO="unmute_audio",r.UNMUTE_VIDEO="unmute_video",r.RECEIVE_METADATA="receive_metadata",r.ON_DATA_STREAM="on_data_stream",r.ENABLE_LOCAL_VIDEO="enable_local_video",r.DISABLE_LOCAL_VIDEO="disable_local_video",r.ENABLE_LOCAL_AUDIO="enable_local_audio",r.DISABLE_LOCAL_AUDIO="disable_local_audio"}(ir||(ir={})),function(r){r.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",r.NEED_ANSWER="NEED_ANSWER",r.NEED_RENEGOTIATE="NEED_RENEGOTIATE",r.P2P_LOST="P2P_LOST",r.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",r.NEED_UNPUB="NEED_UNPUB",r.NEED_UNSUB="NEED_UNSUB",r.NEED_UPLOAD="NEED_UPLOAD",r.NEED_CONTROL="NEED_CONTROL",r.START_RECONNECT="START_RECONNECT",r.END_RECONNECT="END_RECONNECT",r.NEED_SIGNAL_RTT="NEED_SIGNAL_RTT"}(ae||(ae={})),function(r){r.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",r.RECEIVE_TRACK_BUFFER="receive_track_buffer",r.ON_AUDIO_BUFFER="on_audio_buffer"}(Ps||(Ps={}));const GT={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,currentPacketLossRate:0},jT={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},ML={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},PL={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};var ga,Ho,WT,kp,KT,Ze,HT,YT,yo,he,Bs,Pl,nu,ao;(function(r){r.CONNECTED="websocket:connected",r.RECONNECTING="websocket:reconnecting",r.WILL_RECONNECT="websocket:will_reconnect",r.CLOSED="websocket:closed",r.FAILED="websocket:failed",r.ON_MESSAGE="websocket:on_message",r.REQUEST_NEW_URLS="websocket:request_new_urls"})(ga||(ga={})),function(r){r.TRANSCODE="mix_streaming",r.RAW="raw_streaming",r.INJECT="inject_streaming"}(Ho||(Ho={})),function(r){r.WARNING="@live_uap-warning",r.ERROR="@line_uap-error",r.PUBLISH_STREAM_STATUS="@live_uap-publish-status",r.INJECT_STREAM_STATUS="@live_uap-inject-status",r.WORKER_STATUS="@live_uap-worker-status",r.REQUEST_NEW_ADDRESS="@live_uap-request-address"}(WT||(WT={})),function(r){r.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager"}(kp||(kp={})),function(r){r[r.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",r[r.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",r[r.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",r[r.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",r[r.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",r[r.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",r[r.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",r[r.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",r[r.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",r[r.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",r[r.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",r[r.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",r[r.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",r[r.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",r[r.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",r[r.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",r[r.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",r[r.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",r[r.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",r[r.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",r[r.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(KT||(KT={})),function(r){r.UNEXPECTED_ERROR="UNEXPECTED_ERROR",r.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",r.TIMEOUT="TIMEOUT",r.INVALID_PARAMS="INVALID_PARAMS",r.NOT_READABLE="NOT_READABLE",r.NOT_SUPPORTED="NOT_SUPPORTED",r.INVALID_OPERATION="INVALID_OPERATION",r.OPERATION_ABORTED="OPERATION_ABORTED",r.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",r.NETWORK_ERROR="NETWORK_ERROR",r.NETWORK_TIMEOUT="NETWORK_TIMEOUT",r.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",r.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",r.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",r.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",r.ELECTRON_IS_NULL="ELECTRON_IS_NULL",r.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",r.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",r.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",r.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",r.PERMISSION_DENIED="PERMISSION_DENIED",r.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",r.TRACK_IS_DISABLED="TRACK_IS_DISABLED",r.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",r.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",r.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",r.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",r.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",r.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",r.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",r.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",r.UID_CONFLICT="UID_CONFLICT",r.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",r.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",r.INVALID_TRACK="INVALID_TRACK",r.SENDER_NOT_FOUND="SENDER_NOT_FOUND",r.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",r.SET_ANSWER_FAILED="SET_ANSWER_FAILED",r.ICE_FAILED="ICE_FAILED",r.PC_CLOSED="PC_CLOSED",r.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",r.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",r.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",r.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",r.CAN_NOT_PUBLISH_MULTIPLE_AUDIO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_AUDIO_TRACKS",r.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",r.INVALID_REMOTE_USER="INVALID_REMOTE_USER",r.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",r.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",r.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",r.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",r.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",r.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",r.WS_ABORT="WS_ABORT",r.WS_DISCONNECT="WS_DISCONNECT",r.WS_ERR="WS_ERR",r.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",r.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",r.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",r.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",r.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",r.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",r.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",r.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",r.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",r.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",r.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",r.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",r.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",r.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",r.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",r.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",r.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",r.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",r.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",r.INVALID_PLUGIN="INVALID_PLUGIN"}(Ze||(Ze={})),function(r){r.CONNECT_FAILED="connect failed",r.CONNECT_TIMEOUT="connect timeout",r.WS_DISCONNECTED="websocket disconnected",r.REQUEST_TIMEOUT="request timeout",r.REQUEST_FAILED="request failed",r.WAIT_STATUS_TIMEOUT="wait status timeout",r.WAIT_STATUS_ERROR="wait status error",r.BAD_STATE="bad state",r.WS_ABORT="ws abort",r.AP_REQUEST_TIMEOUT="AP request timeout",r.AP_JSON_PARSE_ERROR="AP json parse error",r.AP_REQUEST_ERROR="AP request error",r.AP_REQUEST_ABORT="AP request abort"}(HT||(HT={})),function(r){r[r.SetSdkProfile=0]="SetSdkProfile",r[r.SetSourceChannel=1]="SetSourceChannel",r[r.SetSourceUserId=2]="SetSourceUserId",r[r.SetDestChannel=3]="SetDestChannel",r[r.StartPacketTransfer=4]="StartPacketTransfer",r[r.StopPacketTransfer=5]="StopPacketTransfer",r[r.UpdateDestChannel=6]="UpdateDestChannel",r[r.Reconnect=7]="Reconnect",r[r.SetVideoProfile=8]="SetVideoProfile"}(YT||(YT={})),function(r){r.DISCONNECT="disconnect",r.CONNECTION_STATE_CHANGE="connection-state-change",r.NETWORK_QUALITY="network-quality",r.STREAM_TYPE_CHANGE="stream-type-change",r.IS_P2P_DISCONNECTED="is-p2p-dis",r.DISCONNECT_P2P="dis-p2p",r.REQUEST_NEW_GATEWAY_LIST="req-gate-url",r.NEED_RENEW_SESSION="need-sid"}(yo||(yo={})),function(r){r.NEED_RENEGOTIATE="@need_renegotiate",r.NEED_REPLACE_TRACK="@need_replace_track",r.NEED_CLOSE="@need_close",r.NEED_ADD_TRACK="@need_add_track",r.NEED_REMOVE_TRACK="@need_remove_track",r.NEED_SESSION_ID="@need_sid",r.SET_OPTIMIZATION_MODE="@set_optimization_mode",r.GET_STATS="@get_stats",r.GET_LOW_VIDEO_TRACK="@get_low_video_track",r.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",r.SET_VIDEO_TRACK_MUTED="@set_video_track_muted",r.SET_AUDIO_TRACK_MUTED="@set_audio_track_muted"}(he||(he={})),function(r){r.SCREEN_TRACK="screen_track",r.LOW_STREAM="low_stream"}(Bs||(Bs={})),function(r){r.SOURCE_STATE_CHANGE="source-state-change",r.TRACK_ENDED="track-ended",r.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload"}(Pl||(Pl={})),function(r){r.FIRST_FRAME_DECODED="first-frame-decoded"}(nu||(nu={})),function(r){r.CHINA="CN",r.ASIA="AS",r.NORTH_AMERICA="NA",r.EUROPE="EU",r.JAPAN="JP",r.INDIA="IN",r.KOREA="KR",r.OCEANIA="OC",r.SOUTH_AMERICA="SA",r.AFRICA="AF",r.OVERSEA="OVERSEA",r.GLOBAL="GLOBAL"}(ao||(ao={})),ao.ASIA,ao.NORTH_AMERICA,ao.EUROPE,ao.JAPAN,ao.INDIA,ao.KOREA,ao.OVERSEA,ao.GLOBAL,ao.OCEANIA,ao.SOUTH_AMERICA,ao.AFRICA;var om,iu,qT;function JT(r,t){var n=le(r);if(ee){var s=ee(r);t&&(s=kt(s).call(s,function(c){return Wt(r,c).enumerable})),n.push.apply(n,s)}return n}function bn(r){for(var t=1;t<arguments.length;t++){var n,s=arguments[t]!=null?arguments[t]:{};if(t%2)G(n=JT(Object(s),!0)).call(n,function(d){_r(r,d,s[d])});else if(te)He(r,te(s));else{var c;G(c=JT(Object(s))).call(c,function(d){se(r,d,Wt(s,d))})}}return r}Ld&&ao.CHINA,function(r){r.UPDATE_BITRATE_LIMIT="update_bitrate_limit"}(om||(om={})),function(r){r.ONLINE="ONLINE",r.OFFLINE="OFFLINE"}(iu||(iu={})),function(r){r.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",r.ONLINE="ONLINE",r.OFFLINE="OFFLINE"}(qT||(qT={}));function Dp(r={report:bt}){return function(t,n,s){const c=t[n];if(typeof c=="function"){const d=t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name;s.value=function(...h){var p;const A=r.report.reportApiInvoke(this._sessionId||null,{name:O(p="".concat(d,".")).call(p,n),options:h,tag:Zt.TRACER});try{const m=c.apply(this,h);return A.onSuccess(),m}catch(m){throw A.onError(m),m}}}return s}}function zT(r={report:bt}){return function(t,n,s){const c=t[n];if(typeof c=="function"){const d=t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name;s.value=async function(...h){var p;const A=r.report.reportApiInvoke(this._sessionId||null,{name:O(p="".concat(d,".")).call(p,n),options:h,tag:Zt.TRACER});try{const m=await c.apply(this,h);return A.onSuccess(),m}catch(m){throw A.onError(m),m}}}return s}}const bt=new class{constructor(){var r,t;this.baseInfoMap=new re,this.clientList=ls,this.keyEventUploadPendingItems=[],this.normalEventUploadPendingItems=[],this.apiInvokeUploadPendingItems=[],this.apiInvokeCount=0,this.ltsList=[],this.lastSendNormalEventTime=pt(),this.customReportCount=0,this.eventUploadTimer=window.setInterval(Mr(r=this.doSend).call(r,this),ot("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(Mr(t=this.appendSessionId).call(t,this),ot("EVENT_REPORT_SEND_INTERVAL"))}reportApiInvoke(r,t,n){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;const s=pt();this.apiInvokeCount+=1;const c=this.apiInvokeCount,d=()=>({tag:t.tag,invokeId:c,sid:r,name:t.name,apiInvokeTime:s,options:t.options,states:t.states||null}),h=!!ot("SHOW_REPORT_INVOKER_LOG");h&&S.info("".concat(t.name," start"),t.options);let p=!1;Ur(t.timeout).then(()=>{p||(this.sendApiInvoke(bn({},d(),{error:L.API_INVOKE_TIMEOUT,success:!1})),S.debug("".concat(t.name," timeout")))});const A=new M(L.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:m=>{const E=()=>{if(p)throw A;return p=!0,this.sendApiInvoke(bn({},d(),{success:!0},t.reportResult&&{result:m})),h&&S.info("".concat(t.name," onSuccess")),m};return n?np(E,t.name+"Success",n,()=>p=!0):E()},onError:m=>{const E=()=>{if(p)throw m;p=!0,this.sendApiInvoke(bn({},d(),{success:!1,error:m.toString()})),h&&S.info("".concat(t.name," onFailure"),m.toString())};return n?np(E,t.name+"Error",n,()=>p=!0):E()}}}sessionInit(r,t){if(this.baseInfoMap.has(r))return;const n=pt(),s=this.createBaseInfo(r,n);s.cname=t.cname;const c=hr({},{willUploadConsoleLog:ot("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:Ld?"global":"oversea",areas:ot("AREAS")&&ot("AREAS").join(",")},t.extend),d=pt(),h=bn({},s,{eventType:ei.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,build:dl,lts:d,elapse:d-n,extend:ht(c),mode:t.mode,process:ot("PROCESS_ID"),success:!0,version:Pn});this.send({type:Jr.SESSION,data:h},!0)}joinChooseServer(r,t){const n=this.baseInfoMap.get(r);if(!n)return;const s=n.info,c=pt(),d=bn({},s,{eventType:ei.JOIN_CHOOSE_SERVER,lts:c,eventElapse:c-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:c-n.startTime,success:t.succ,chooseServerAddrList:ht(t.serverList),uid:t.uid?Sr(t.uid):null,cid:t.cid?Sr(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0});this.send({type:Jr.JOIN_CHOOSE_SERVER,data:d},!0)}reqUserAccount(r,t){const n=this.baseInfoMap.get(r);if(!n)return;const s=n.info,c=pt(),d=bn({},s,{eventType:ei.REQ_USER_ACCOUNT,lts:c,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:c-n.startTime,eventElapse:c-t.lts,extend:ht(t.extend)});this.send({type:Jr.REQ_USER_ACCOUNT,data:d},!0)}joinGateway(r,t){const n=this.baseInfoMap.get(r);if(!n)return;const s=n.info;t.vid&&(s.vid=t.vid),s.uid=t.uid,s.cid=t.cid;const c=pt(),d=bn({},s,{eventType:ei.JOIN_GATEWAY,lts:c,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,elapse:c-n.startTime,eventElapse:c-t.lts});t.succ&&(n.lastJoinSuccessTime=c),this.send({type:Jr.JOIN_GATEWAT,data:d},!0)}joinChannelTimeout(r,t){const n=this.baseInfoMap.get(r);if(!n)return;const s=pt(),c=bn({},n.info,{lts:s,timeout:t,elapse:s-n.startTime});this.send({type:Jr.JOIN_CHANNEL_TIMEOUT,data:c},!0)}publish(r,t){const n=this.baseInfoMap.get(r);if(!n)return;const s=n.info,c=pt(),d=bn({},s,{eventType:ei.PUBLISH,lts:c,eventElapse:c-t.lts,elapse:c-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:Jr.PUBLISH,data:d},!0)}subscribe(r,t){const n=this.baseInfoMap.get(r);if(!n)return;const s=n.info,c=pt(),d=bn({},s,{eventType:ei.SUBSCRIBE,lts:c,eventElapse:c-t.lts,elapse:c-n.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid});typeof t.peerid=="string"?d.peerSuid=t.peerid:d.peer=t.peerid,this.send({type:Jr.SUBSCRIBE,data:d},!0)}firstRemoteFrame(r,t,n,s){const c=this.baseInfoMap.get(r);if(!c)return;const d=c.info,h=pt(),p=bn({},d,{},s,{elapse:h-c.startTime,eventType:t,lts:h});this.send({type:n,data:p},!0)}onGatewayStream(r,t,n,s){const c=this.baseInfoMap.get(r);if(!c)return;const d=bn({},c.info,{},s,{eventType:t,lts:pt()});this.send({type:n,data:d},!0)}streamSwitch(r,t){const n=this.baseInfoMap.get(r);if(!n)return;const s=n.info,c=pt(),d=bn({},s,{eventType:ei.STREAM_SWITCH,lts:c,isDual:t.isdual,elapse:c-n.startTime,success:t.succ});this.send({type:Jr.STREAM_SWITCH,data:d},!0)}requestProxyAppCenter(r,t){const n=this.baseInfoMap.get(r);if(!n)return;const s=n.info,c=pt(),d=bn({},s,{eventType:ei.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-t.lts,elapse:c-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Jr.REQUEST_PROXY_APPCENTER,data:d},!0)}requestProxyWorkerManager(r,t){const n=this.baseInfoMap.get(r);if(!n)return;const s=n.info,c=pt(),d=bn({},s,{eventType:ei.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-t.lts,elapse:c-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Jr.REQUEST_PROXY_WORKER_MANAGER,data:d},!0)}setProxyServer(r){this.proxyServer=r,r?S.debug("reportProxyServerurl: ".concat(r)):S.debug("disable reportProxyServerurl: ".concat(r))}peerPublishStatus(r,t){const n=this.baseInfoMap.get(r);if(!n)return;const s=n.info,c=pt(),d=bn({},s,{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:c,elapse:c-n.startTime,joinChannelSuccessElapse:c-(n.lastJoinSuccessTime||c)});this.send({type:Jr.PEER_PUBLISH_STATUS,data:d},!0)}workerEvent(r,t){const n=this.baseInfoMap.get(r);if(!n)return;const s=n.info,c=pt(),d=SS(bn({},s,{},t,{elapse:c-n.startTime,lts:c,productType:"WebRTC"}),"payload",1300);G(d).call(d,h=>this.send({type:Jr.WORKER_EVENT,data:h},!0))}apworkerEvent(r,t){const n=this.baseInfoMap.get(r);if(!n)return;const s=n.info,c=pt(),d=bn({},s,{},t,{elapse:c-n.startTime,lts:c});this.send({type:Jr.AP_WORKER_EVENT,data:d},!0)}joinWebProxyAP(r,t){const n=this.baseInfoMap.get(r);if(!n)return;const s=n.info,c=pt(),d=bn({},s,{},t,{elapse:c-n.startTime,lts:c,extend:t.extend||void 0});this.send({type:Jr.JOIN_WEB_PROXY_AP,data:d},!0)}WebSocketQuit(r,t){const n=this.baseInfoMap.get(r);if(!n)return;const s=n.info,c=pt(),d=bn({},s,{},t,{elapse:c-n.startTime,lts:c});this.send({type:Jr.WEBSOCKET_QUIT,data:d},!0)}async sendCustomReportMessage(r,t){if(this.customReportCount+=t.length,this.customReportCount>ot("CUSTOM_REPORT_LIMIT"))throw new M(L.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const n=ft(t).call(t,c=>({type:Jr.USER_ANALYTICS,data:bn({sid:r},c)})),s={msgType:"EventMessages",sentTs:Math.round(pt()/1e3),payloads:ft(n).call(n,c=>ht(c))};try{await this.postDataToStatsCollector(s)}catch(c){throw S.error("send custom report message failed",c.toString()),new M(L.CUSTOM_REPORT_SEND_FAILED,c.message)}}sendApiInvoke(r){const t=ot("NOT_REPORT_EVENT");if(r.tag&&zt(t)&&zt(t).call(t,r.tag))return!1;if(r.sid===null)return this.apiInvokeUploadPendingItems.push(r),!1;const n=this.baseInfoMap.get(r.sid);if(!n)return this.apiInvokeUploadPendingItems.push(r),!1;const{cname:s,uid:c,cid:d}=n.info;r.lts=r.lts||pt();const h={invokeId:r.invokeId,sid:r.sid,cname:s,cid:d,uid:c,lts:r.lts,success:r.success,elapse:r.lts-n.startTime,execElapse:r.lts-r.apiInvokeTime,apiName:r.name,options:r.options?ht(r.options):void 0,execStates:r.states?ht(r.states):void 0,execResult:r.result?ht(r.result):void 0,errorCode:r.error?ht(r.error):void 0};return this.send({type:Jr.API_INVOKE,data:h},!1),!0}appendSessionId(){var r;G(r=this.clientList).call(r,t=>{if(t._sessionId){const n=this.apiInvokeUploadPendingItems.length;for(let s=0;s<n;s++){const c=this.apiInvokeUploadPendingItems.shift();c&&(c.sid=t._sessionId,this.sendApiInvoke(hr({},c)))}}})}send(r,t){if(t)return this.keyEventUploadPendingItems.push(r),void this.sendItems(this.keyEventUploadPendingItems,!0);var n;this.normalEventUploadPendingItems.push(r),this.normalEventUploadPendingItems.length>ot("NORMAL_EVENT_QUEUE_CAPACITY")&&Ye(n=this.normalEventUploadPendingItems).call(n,0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&pt()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(r,t){const n=[],s=[];for(;r.length;){const p=r.shift();n.length<20?n.push(p):s.push(p)}r.push(...s);for(const p of[...n]){var c,d;Ft(c=this.ltsList).call(c,p.data.lts)!==-1?(p.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(p.data.lts)):(this.ltsList.push(p.data.lts),xa(d=this.ltsList).call(d,(A,m)=>A-m))}t||(this.lastSendNormalEventTime=pt());const h={msgType:"EventMessages",sentTs:Math.round(pt()/1e3),payloads:ft(n).call(n,p=>ht(p)),vid:(p=>{const A=p&&p.data.sid&&this.baseInfoMap.get(p.data.sid);return A&&A.info.vid&&+A.info.vid||0})(n[0])};return n.length&&this.postDataToStatsCollector(h).catch((p=>A=>{var m,E,v;ot("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=O(m=this.keyEventUploadPendingItems).call(m,p):(this.normalEventUploadPendingItems=O(E=this.normalEventUploadPendingItems).call(E,p),this.normalEventUploadPendingItems.length>ot("NORMAL_EVENT_QUEUE_CAPACITY")&&(Ye(v=this.normalEventUploadPendingItems).call(v,0,this.normalEventUploadPendingItems.length-ot("NORMAL_EVENT_QUEUE_CAPACITY")),S.warning("report: drop normal events"))))})(n)),r}async postDataToStatsCollector(r,t=!1){var n,s,c;yr.networkState===iu.OFFLINE&&await dt.race([yr.onlineWaiter,Ur(2*Ne.maxRetryTimeout)]);const d=t?"/events/proto-raws":"/events/messages";let h=this.url||(this.proxyServer?O(n=O(s="https://".concat(this.proxyServer,"/rs/?h=")).call(s,ot("EVENT_REPORT_DOMAIN"),"&p=6443&d=")).call(n,d):O(c="https://".concat(ot("EVENT_REPORT_DOMAIN"),":6443")).call(c,d));for(let E=0;E<2;E+=1){var p,A,m;E===1&&(h=this.backupUrl||(this.proxyServer?O(p=O(A="https://".concat(this.proxyServer,"/rs/?h=")).call(A,ot("EVENT_REPORT_BACKUP_DOMAIN"),"&p=6443&d=")).call(p,d):O(m="https://".concat(ot("EVENT_REPORT_BACKUP_DOMAIN"),":6443")).call(m,d)));try{t?await zC(h,{timeout:1e4,data:r}):await Bn(h,{timeout:1e4,data:r})}catch(v){if(E===1)throw v;continue}return}}createBaseInfo(r,t){const n=hr({},LL);return n.sid=r,this.baseInfoMap.set(r,{info:n,startTime:t}),n}};class BL extends Hr{constructor(t){super(),this._connectionState=Sn.CLOSED,this.openConnectionTime=pt(),this.lastMsgTime=pt(),this.uploadCache=[],this.rttRolling=new BS(5),this.pingpongTimeoutCount=0,this.onWebsocketMessage=n=>{if(n.data instanceof ArrayBuffer)return void this.emit(Oe.ON_BINARY_DATA,n.data);const s=JSON.parse(n.data);if(this.lastMsgTime=pt(),Object.prototype.hasOwnProperty.call(s,"_id")){const c="res-@".concat(s._id);this.emit(c,s._result,s._message)}else if(Object.prototype.hasOwnProperty.call(s,"_type")&&(this.emit(s._type,s._message),s._type===ir.ON_NOTIFICATION&&this.handleNotification(s._message),s._type===ir.ON_USER_BANNED))switch(s._message.error_code){case 14:this.close("UID_BANNED");break;case 15:this.close("IP_BANNED");break;case 16:this.close("CHANNEL_BANNED")}},this.clientId=t.clientId,this.spec=t,this.websocket=new ap("gateway-".concat(this.clientId),this.spec.retryConfig,!0),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Sn.CONNECTED&&this.reconnect("retry",Bi.OFFLINE)})}get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Sn.CONNECTED?this.emit(Oe.WS_CONNECTED):t===Sn.RECONNECTING?this.emit(Oe.WS_RECONNECTING,this._websocketReconnectReason):t===Sn.CLOSED&&this.emit(Oe.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}async request(t,n,s,c){var d,h,p,A,m;const E=Le(6,""),v={_id:E,_type:t,_message:n},C=this.websocket.connectionID,b=()=>new dt((j,st)=>{if(this.connectionState===Sn.CONNECTED)return j();const mt=()=>{this.off(Oe.WS_CLOSED,Et),j()},Et=()=>{this.off(Oe.WS_CONNECTED,mt),st(new M(Ze.WS_ABORT))};this.once(Oe.WS_CONNECTED,mt),this.once(Oe.WS_CLOSED,Et)});if(this.connectionState!==Sn.CONNECTING&&this.connectionState!==Sn.RECONNECTING||t===Ar.JOIN||t===Ar.REJOIN||await b(),this.websocket.sendMessage(v,!0),c)return;const y=new dt((j,st)=>{let mt=!1;const Et=($,rt)=>{mt=!0,j({isSuccess:$==="success",message:rt||{}}),this.off(Oe.WS_CLOSED,At),this.off(Oe.WS_RECONNECTING,At),this.emit(Oe.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(E),Et);const At=()=>{st(new M(Ze.WS_ABORT,"type: ".concat(t))),this.off(Oe.WS_CLOSED,At),this.off(Oe.WS_RECONNECTING,At),this.off("res-@".concat(E),Et)};this.once(Oe.WS_CLOSED,At),this.once(Oe.WS_RECONNECTING,At),Ur(ot("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==C||mt||(S.warning("ws request timeout, type: ".concat(t)),this.emit(Oe.REQUEST_TIMEOUT,t,n))})});let w=null;try{w=await y}catch(j){if(this.connectionState===Sn.CLOSED||t===Ar.LEAVE)throw new M(Ze.WS_ABORT);return!this.spec.forceWaitGatewayResponse||s?j.throw():t===Ar.JOIN||t===Ar.REJOIN?null:(await b(),await this.request(t,n))}if(w.isSuccess)return w.message;const k=Number(w.message.error_code||w.message.code),P=ip(k),V=new M(Ze.UNEXPECTED_RESPONSE,O(d="".concat(P.desc,": ")).call(d,w.message.error_str),{code:k,data:w.message});return P.action==="success"?w.message:(S.warning(O(h=O(p=O(A=O(m="[".concat(this.websocket.connectionID,"] unexpected response from type ")).call(m,t,", error_code: ")).call(A,k,", message: ")).call(p,P.desc,", action: ")).call(h,P.action)),P.action==="failed"?V.throw():P.action==="quit"?(this.initError=V,this.close(),V.throw()):(k===Ml.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=w.message.option,S.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Bi.MULTI_IP)):this.reconnect(P.action,Bi.SERVER_ERROR),t===Ar.JOIN||t===Ar.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new dt(s=>{const c=d=>{(!n||n(d))&&(this.off(t,c),s(d))};this.on(t,c)})}upload(t,n){const s={_type:t,_message:n};try{this.websocket.sendMessage(s)}catch{const h=ot("MAX_UPLOAD_CACHE")||50;var c;this.uploadCache.push(s),this.uploadCache.length>h&&Ye(c=this.uploadCache).call(c,0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{var p;if(this.connectionState!==Sn.CONNECTED)return;const A=Ye(p=this.uploadCache).call(p,0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(A._type,A._message)},ot("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const s={_type:t,_message:n};this.websocket.sendMessage(s)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,new dt((n,s)=>{this.once(Oe.WS_CONNECTED,()=>n(this.joinResponse)),this.once(Oe.WS_CLOSED,()=>s(this.initError||new M(Ze.WS_ABORT))),this.connectionState=Sn.CONNECTING,this.websocket.init(t).catch(s),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||"LEAVE",this.connectionState=Sn.CLOSED,this.websocket.close()}async join(){var t;if(!this.joinResponse){const n=Va(this,Oe.REQUEST_JOIN_INFO),s=await this.request(Ar.JOIN,n);if(!s)return this.emit(Oe.REPORT_JOIN_GATEWAY,Ze.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Sn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(Mr(t=this.handlePingPong).call(t,this),3e3),!0}async rejoin(){var t,n;if(!this.reconnectToken)throw new M(Ze.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const s=Va(this,Oe.REQUEST_REJOIN_INFO);s.token=this.reconnectToken;const c=await this.request(Ar.REJOIN,s);return!!c&&(this.connectionState=Sn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(Mr(t=this.handlePingPong).call(t,this),3e3),c.peers&&G(n=c.peers).call(n,d=>{this.emit(ir.ON_USER_ONLINE,{uid:d.uid}),d.audio_mute?this.emit(ir.MUTE_AUDIO,{uid:d.uid}):this.emit(ir.UNMUTE_AUDIO,{uid:d.uid}),d.video_mute?this.emit(ir.MUTE_VIDEO,{uid:d.uid}):this.emit(ir.UNMUTE_VIDEO,{uid:d.uid}),d.audio_enable_local?this.emit(ir.ENABLE_LOCAL_AUDIO,{uid:d.uid}):this.emit(ir.DISABLE_LOCAL_AUDIO,{uid:d.uid}),d.video_enable_local?this.emit(ir.ENABLE_LOCAL_VIDEO,{uid:d.uid}):this.emit(ir.DISABLE_LOCAL_VIDEO,{uid:d.uid}),d.audio||d.video||this.emit(ir.ON_REMOVE_STREAM,{uid:d.uid,uint_id:d.uint_id}),d.audio&&this.emit(ir.ON_ADD_AUDIO_STREAM,{uid:d.uid,uint_id:d.uint_id,audio:!0}),d.video&&this.emit(ir.ON_ADD_VIDEO_STREAM,{uid:d.uid,uint_id:d.uint_id,video:!0})}),!0)}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}handleNotification(t){S.debug("[".concat(this.clientId,"] receive notification: "),t);const n=ip(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close("UID_BANNED"),void this.close()):void this.reconnect(n.action,Bi.SERVER_ERROR);S.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=ot("PING_PONG_TIME_OUT"),n=pt();this.pingpongTimeoutCount>=t&&(S.warning("PINGPONG Timeout. Last Socket Message: ".concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>ot("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Bi.TIMEOUT):this.request(Ar.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const s=pt()-n;this.rttRolling.add(s),ot("REPORT_STATS")&&this.send(Ar.PING_BACK,{pingpongElapse:s})}).catch(s=>{})}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:n}=this.websocket.getWsInflateData();t!==0&&n!==0&&this.upload(Ko.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(ga.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(ga.CLOSED,()=>{this.connectionState=Sn.CLOSED}),this.websocket.on(ga.FAILED,()=>{this._disconnectedReason="NETWORK_ERROR",this.connectionState=Sn.CLOSED}),this.websocket.on(ga.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Sn.CONNECTED?this.connectionState=Sn.RECONNECTING:this.connectionState=Sn.CONNECTING}),this.websocket.on(ga.WILL_RECONNECT,(t,n)=>{if(Va(this,Oe.IS_P2P_DISCONNECTED)&&t==="retry")return this.reconnectToken=void 0,this.emit(Oe.NEED_RENEW_SESSION),this.emit(Oe.DISCONNECT_P2P),n("tryNext");t!=="retry"&&(this.reconnectToken=void 0,this.emit(Oe.NEED_RENEW_SESSION),this.emit(Oe.DISCONNECT_P2P)),n(t)}),this.websocket.on(ga.CONNECTED,()=>{this.openConnectionTime=pt(),this.reconnectToken?this.rejoin().catch(t=>{var n;S.warning(O(n="[".concat(this.clientId,"] rejoin failed ")).call(n,t)),this.reconnect("tryNext",Bi.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(Oe.REPORT_JOIN_GATEWAY,t.message||t.code,this.url||""),t instanceof M&&t.code===Ze.UNEXPECTED_RESPONSE&&t.data.code===Ml.ERR_NO_AUTHORIZED)return S.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Bi.SERVER_ERROR);S.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Bi.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(ga.REQUEST_NEW_URLS,(t,n)=>{xr(this,Oe.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)})}}var yi,Lp;(function(r){r[r.CHOOSE_SERVER=11]="CHOOSE_SERVER",r[r.CLOUD_PROXY=18]="CLOUD_PROXY",r[r.CLOUD_PROXY_5=20]="CLOUD_PROXY_5"})(yi||(yi={}));class XT extends Hr{constructor(t,n){super(),this._hints=[],this._isClosed=!1,this._ID=n||Le(8,"track-"),this._originMediaStreamTrack=t,this._mediaStreamTrack=t,gC(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){if(!t){const n=bt.reportApiInvoke(null,{name:de.GET_MEDIA_STREAM_TRACK,options:[],tag:Zt.TRACER});this._mediaStreamTrack&&typeof this._mediaStreamTrack.label=="string"?n.onSuccess(this._mediaStreamTrack.label):n.onSuccess("")}return this._mediaStreamTrack}close(){this._isClosed=!0,mC(this)}}class Mp extends XT{constructor(t,n){super(t,n),this._enabled=!0,this._muted=!1,this._isClosed=!1,this._trackProcessors=[],this._handleTrackEnded=()=>{this.onTrackEnded()},this._enabledMutex=new Un("".concat(n)),t.addEventListener("ended",this._handleTrackEnded)}get muted(){return this._muted}get enabled(){return this._enabled}getTrackLabel(){return this._originMediaStreamTrack.label}close(){var t;this._isClosed||(this.stop(),G(t=this._trackProcessors).call(t,n=>n.destroy()),this._trackProcessors=[],this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,S.debug("[".concat(this.getTrackId(),"] close")),this.emit(Jt.NEED_CLOSE),super.close())}async _registerTrackProcessor(t){var n;if(Ft(n=this._trackProcessors).call(n,t)!==-1)return;const s=this._trackProcessors[this._trackProcessors.length-1];this._trackProcessors.push(t),t.onOutputChange=async()=>{const c=t.output||this._originMediaStreamTrack;this._mediaStreamTrack=c,this._updatePlayerSource(),await Xe(this,Jt.NEED_REPLACE_TRACK,this._mediaStreamTrack)},s?(s.onOutputChange=async()=>{s.output&&await t.setInput(s.output)},await t.setInput(s.output||s.input||this._originMediaStreamTrack)):await t.setInput(this._originMediaStreamTrack)}_getOutputFromProcessors(){if(this._trackProcessors.length===0)return this._originMediaStreamTrack;const t=this._trackProcessors[this._trackProcessors.length-1];return t.output||t.input||this._originMediaStreamTrack}async _updateOriginMediaStreamTrack(t,n){if(t!==this._originMediaStreamTrack){if(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop(),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._trackProcessors.length>0){await this._trackProcessors[0].setInput(t);const s=this._getOutputFromProcessors();this._mediaStreamTrack=s}else this._mediaStreamTrack=this._originMediaStreamTrack;this._updatePlayerSource(),await Xe(this,Jt.NEED_REPLACE_TRACK,this._mediaStreamTrack)}}_getDefaultPlayerConfig(){return{}}onTrackEnded(){S.debug("[".concat(this.getTrackId(),"] track ended")),this.emit(aa.TRACK_ENDED)}stateCheck(t,n){var s,c,d;if(S.debug(O(s=O(c=O(d="check track state, [muted: ".concat(this._muted,", enabled: ")).call(d,this._enabled,"] to [")).call(c,t,": ")).call(s,n,"]")),t==="muted"&&!Dr().webAudioMediaStreamDest)throw new M(L.NOT_SUPPORTED,"current environment does not support set mute").print();if(Ac(n,t),this._enabled&&this._muted&&t==="enabled"&&n===!1)throw new M(L.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print();if(!this._enabled&&!this._muted&&t==="muted"&&n===!0)throw new M(L.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print()}}function Fr(){return function(r,t,n){const s=r[t];typeof s=="function"&&(n.value=function(...c){this._isClosed&&new M(L.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning");const d=s.apply(this,c);return d instanceof dt?new dt((h,p)=>{d.then(h).catch(p)}):d})}}function ZT(r,t){var n=le(r);if(ee){var s=ee(r);t&&(s=kt(s).call(s,function(c){return Wt(r,c).enumerable})),n.push.apply(n,s)}return n}function Pp(r){for(var t=1;t<arguments.length;t++){var n,s=arguments[t]!=null?arguments[t]:{};if(t%2)G(n=ZT(Object(s),!0)).call(n,function(d){_r(r,d,s[d])});else if(te)He(r,te(s));else{var c;G(c=ZT(Object(s))).call(c,function(d){se(r,d,Wt(s,d))})}}return r}(function(r){r.IOS_15_INTERRUPTION_START="ios15-interruption-start",r.IOS_15_INTERRUPTION_END="ios15-interruption-end",r.IOS_INTERRUPTION_START="ios-interruption-start",r.IOS_INTERRUPTION_END="ios-interruption-end"})(Lp||(Lp={}));var co=function(r,t,n,s){var c,d=arguments.length,h=d<3?t:s===null?s=Wt(t,n):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(r,t,n,s);else for(var p=r.length-1;p>=0;p--)(c=r[p])&&(h=(d<3?c(h):d>3?c(t,n,h):c(t,n))||h);return d>3&&h&&se(t,n,h),h},Be=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)};class xn extends Mp{constructor(t,n,s){super(t,s),this.trackMediaType="audio",this._enabled=!0,this._volume=100,this._useAudioElement=!1,this._bypassWebAudio=!1,this._encoderConfig=n,this._source=new zh(t)}get isPlaying(){return this._useAudioElement?Yr.isPlaying(this.getTrackId()):this._source.isPlayed}setVolume(t){Ie(t,"volume",0,1e3);const n=gt.reportApiInvoke(null,{tag:Zt.TRACER,name:de.LOCAL_AUDIO_TRACK_SET_VOLUME,options:[this.getTrackId(),t]},300);this._volume=t,this._source.setVolume(t/100),this._useAudioElement&&Yr.setVolume(this.getTrackId(),t);try{if(this._bypassWebAudio)return void S.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const s=this._source.createOutputTrack();this._mediaStreamTrack!==s&&(this._mediaStreamTrack=s,Xe(this,he.NEED_REPLACE_TRACK,this._mediaStreamTrack).then(()=>{S.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(c=>{S.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),c)}))}catch{}n.onSuccess()}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}async setPlaybackDevice(t){const n=gt.reportApiInvoke(null,{tag:Zt.TRACER,name:de.REMOTE_AUDIO_SET_OUTPUT_DEVICE,options:[this.getTrackId(),t]});if(!this._useAudioElement)throw new M(L.NOT_SUPPORTED,"your browser does not support setting the audio output device");try{await Yr.setSinkID(this.getTrackId(),t)}catch(s){throw n.onError(s),s}n.onSuccess()}async setEnabled(t,n,s){var c;if(!s){if(t===this._enabled)return;this.stateCheck("enabled",t)}S.info("[".concat(this.getTrackId(),"] start setEnabled"),t);const d=await this._enabledMutex.lock();if(!t){this._originMediaStreamTrack.enabled=!1;try{await Xe(this,he.NEED_REMOVE_TRACK,this)}catch(h){throw S.error("[".concat(this.getTrackId(),"] setEnabled to false error"),h.toString()),d(),h}return s||(this._enabled=!1),d()}this._originMediaStreamTrack.enabled=!0;try{await Xe(this,he.NEED_ADD_TRACK,this)}catch(h){throw S.error("[".concat(this.getTrackId(),"] setEnabled to true error"),h.toString()),d(),h}S.info(O(c="[".concat(this.getTrackId(),"] setEnabled to ")).call(c,t," success")),s||(this._enabled=!0),d()}async setMuted(t){var n,s;if(this._bypassWebAudio)return S.debug(O(s="[".concat(this.getTrackId(),"] setMuted:")).call(s,t," fallback to setEnabled because no pass through.")),void await this.setEnabled(!t);if(t!==this._muted){if(this.stateCheck("muted",t),this._muted=t,we().name===Dl.FIREFOX)return S.debug("[".concat(this.getTrackId(),"] firefox set mute fallback to set enabled")),void await this.setEnabled(!t,void 0,!0);this._mediaStreamTrack.enabled=!t,S.debug(O(n="[".concat(this.getTrackId(),"] start set muted: ")).call(n,t)),await Xe(this,he.SET_AUDIO_TRACK_MUTED,{track:this,muted:t})}}getStats(){return ks(()=>{S.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Io(this,he.GET_STATS)||Pp({},GT)}setAudioFrameCallback(t,n=4096){if(!t)return this._source.removeAllListeners(Ps.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(n),this._source.removeAllListeners(Ps.ON_AUDIO_BUFFER),this._source.on(Ps.ON_AUDIO_BUFFER,s=>t(s))}play(){const t=gt.reportApiInvoke(null,{tag:Zt.TRACER,name:de.LOCAL_AUDIO_TRACK_PLAY,options:[this.getTrackId()]});S.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(S.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Yr.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play(),t.onSuccess()}stop(){const t=gt.reportApiInvoke(null,{tag:Zt.TRACER,name:de.LOCAL_AUDIO_TRACK_STOP,options:[this.getTrackId()]});S.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Yr.stop(this.getTrackId()):this._source.stop(),t.onSuccess()}close(){super.close(),this._source.destroy()}_updatePlayerSource(){S.debug("[".concat(this.getTrackId(),"] update player source track")),this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Yr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(t,n){this._originMediaStreamTrack!==t&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t.addEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop(),this._originMediaStreamTrack=t,this._source.updateTrack(this._originMediaStreamTrack),this._mediaStreamTrack!==this._source.outputTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Xe(this,he.NEED_REPLACE_TRACK,this._mediaStreamTrack)))}renewMediaStreamTrack(){return dt.resolve(void 0)}}co([Fr(),Be("design:type",Function),Be("design:paramtypes",[String]),Be("design:returntype",dt)],xn.prototype,"setPlaybackDevice",null),co([Fr(),Be("design:type",Function),Be("design:paramtypes",[Boolean,Object,Boolean]),Be("design:returntype",dt)],xn.prototype,"setEnabled",null),co([Fr(),qh({report:gt}),Be("design:type",Function),Be("design:paramtypes",[Boolean]),Be("design:returntype",dt)],xn.prototype,"setMuted",null),co([Fr(),Be("design:type",Function),Be("design:paramtypes",[]),Be("design:returntype",Object)],xn.prototype,"getStats",null),co([Fr(),Be("design:type",Function),Be("design:paramtypes",[Object,Number]),Be("design:returntype",void 0)],xn.prototype,"setAudioFrameCallback",null),co([Fr(),Be("design:type",Function),Be("design:paramtypes",[]),Be("design:returntype",void 0)],xn.prototype,"play",null),co([Fr(),Be("design:type",Function),Be("design:paramtypes",[]),Be("design:returntype",void 0)],xn.prototype,"stop",null);class ou extends xn{constructor(t,n,s,c){super(t,n.encoderConfig?fc(n.encoderConfig):{},c),this._deviceName="default",this._enabled=!0,this._config=n,this._constraints=s,this._deviceName=t.label,typeof n.bypassWebAudio=="boolean"&&(this._bypassWebAudio=n.bypassWebAudio),ia()&&ue.bindInterruptDetectorTrack(this)}async setDevice(t){var n,s;const c=gt.reportApiInvoke(null,{tag:Zt.TRACER,name:de.MIC_AUDIO_TRACK_SET_DEVICE,options:[this.getTrackId(),t]});if(S.info(O(n="[".concat(this.getTrackId(),"] start set device to ")).call(n,t)),this._enabled)try{const d=await gn.getDeviceById(t),h={};h.audio=Pp({},this._constraints),h.audio.deviceId={exact:t},this._originMediaStreamTrack.stop();let p=null;try{p=await nn(h,this.getTrackId())}catch(A){throw S.error("[".concat(this.getTrackId(),"] setDevice failed"),A.toString()),p=await nn({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(p.getAudioTracks()[0],!1),A}await this._updateOriginMediaStreamTrack(p.getAudioTracks()[0],!1),this._deviceName=d.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(d){throw c.onError(d),S.error("[".concat(this.getTrackId(),"] setDevice error"),d.toString()),d}else try{const d=await gn.getDeviceById(t);this._deviceName=d.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(d){throw c.onError(d),S.error("[".concat(this.getTrackId(),"] setDevice error"),d.toString()),d}c.onSuccess(),S.info(O(s="[".concat(this.getTrackId(),"] set device to ")).call(s,t," success"))}async setEnabled(t,n,s){if(n)return S.debug("[".concat(this.getTrackId,"] setEnabled false (do not close microphone)")),await super.setEnabled(t);if(!s){if(t===this._enabled)return;this.stateCheck("enabled",t)}S.info("[".concat(this.getTrackId(),"] start setEnabled"),t);const c=await this._enabledMutex.lock();if(!t){this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),s||(this._enabled=!1);try{await Xe(this,he.NEED_REMOVE_TRACK,this)}catch(p){throw S.error("[".concat(this.getTrackId(),"] setEnabled false failed"),p.toString()),c(),p}return void c()}const d=Pp({},this._constraints),h=gn.searchDeviceIdByName(this._deviceName);h&&!d.deviceId&&(d.deviceId=h);try{const p=await nn({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(p.getAudioTracks()[0],!1),await Xe(this,he.NEED_ADD_TRACK,this)}catch(p){throw c(),S.error("[".concat(this.getTrackId(),"] setEnabled true failed"),p.toString()),p}s||(this._enabled=!0),S.info("[".concat(this.getTrackId(),"] setEnabled success")),c()}close(){super.close(),ia()&&ue.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((vi()||as())&&this._enabled&&!this._isClosed&&ue.duringInterruption){const t=async()=>{ue.off(Lp.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(S.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};ue.on(Lp.IOS_INTERRUPTION_END,t)}else S.debug("[".concat(this.getTrackId(),"] track ended")),this.emit(Pl.TRACK_ENDED)}async renewMediaStreamTrack(){const t=Pp({},this._constraints),n=gn.searchDeviceIdByName(this._deviceName);n&&!t.deviceId&&(t.deviceId=n);const s=await nn({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!0)}}co([Fr(),Be("design:type",Function),Be("design:paramtypes",[String]),Be("design:returntype",dt)],ou.prototype,"setDevice",null),co([Fr(),Be("design:type",Function),Be("design:paramtypes",[Boolean,Boolean,Boolean]),Be("design:returntype",dt)],ou.prototype,"setEnabled",null);class Bl extends xn{constructor(t,n,s,c){super(n.createOutputTrack(),s,c),this.source=t,this._bufferSource=n,this._bufferSource.on(Ps.AUDIO_SOURCE_STATE_CHANGE,d=>{this.emit(Pl.SOURCE_STATE_CHANGE,d)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(t){const n=gt.reportApiInvoke(null,{tag:Zt.TRACER,name:de.BUFFER_AUDIO_TRACK_START,options:[this.getTrackId(),t,this.duration]});t&&this._bufferSource.updateOptions(t),this._bufferSource.startProcessAudioBuffer(),n.onSuccess()}pauseProcessAudioBuffer(){const t=gt.reportApiInvoke(null,{tag:Zt.TRACER,name:de.BUFFER_AUDIO_TRACK_PAUSE,options:[this.getTrackId()]});this._bufferSource.pauseProcessAudioBuffer(),t.onSuccess()}seekAudioBuffer(t){const n=gt.reportApiInvoke(null,{tag:Zt.TRACER,name:de.BUFFER_AUDIO_TRACK_SEEK,options:[this.getTrackId()]});this._bufferSource.seekAudioBuffer(t),n.onSuccess()}resumeProcessAudioBuffer(){const t=gt.reportApiInvoke(null,{tag:Zt.TRACER,name:de.BUFFER_AUDIO_TRACK_RESUME,options:[this.getTrackId()]});this._bufferSource.resumeProcessAudioBuffer(),t.onSuccess()}stopProcessAudioBuffer(){const t=gt.reportApiInvoke(null,{tag:Zt.TRACER,name:de.BUFFER_AUDIO_TRACK_STOP,options:[this.getTrackId()]});this._bufferSource.stopProcessAudioBuffer(),t.onSuccess()}}co([Fr(),Be("design:type",Function),Be("design:paramtypes",[Object]),Be("design:returntype",void 0)],Bl.prototype,"startProcessAudioBuffer",null),co([Fr(),Be("design:type",Function),Be("design:paramtypes",[]),Be("design:returntype",void 0)],Bl.prototype,"pauseProcessAudioBuffer",null),co([Fr(),Be("design:type",Function),Be("design:paramtypes",[Number]),Be("design:returntype",void 0)],Bl.prototype,"seekAudioBuffer",null),co([Fr(),Be("design:type",Function),Be("design:paramtypes",[]),Be("design:returntype",void 0)],Bl.prototype,"resumeProcessAudioBuffer",null),co([Fr(),Be("design:type",Function),Be("design:paramtypes",[]),Be("design:returntype",void 0)],Bl.prototype,"stopProcessAudioBuffer",null);class ci extends xn{constructor(){const t=ml().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,Le(8,"track-mix-"));try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}get isActive(){var t;return!(!this.trackList.length||!_t(t=this.trackList).call(t,n=>!n.muted))}getSubTrackLabels(){var t;return ft(t=this.trackList).call(t,n=>n.getTrackLabel())}hasAudioTrack(t){var n;return Ft(n=this.trackList).call(n,t)!==-1}addAudioTrack(t){var n;Ft(n=this.trackList).call(n,t)===-1?(S.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):S.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){var n;if(Ft(n=this.trackList).call(n,t)!==-1){S.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}da(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){var t;const n={};G(t=this.trackList).call(t,s=>{s._encoderConfig&&((s._encoderConfig.bitrate||0)>(n.bitrate||0)&&(n.bitrate=s._encoderConfig.bitrate),(s._encoderConfig.sampleRate||0)>(n.sampleRate||0)&&(n.sampleRate=s._encoderConfig.sampleRate),(s._encoderConfig.sampleSize||0)>(n.sampleSize||0)&&(n.sampleSize=s._encoderConfig.sampleSize),s._encoderConfig.stereo&&(n.stereo=!0))}),this._encoderConfig=n}}class UL extends Hr{constructor(){super(...arguments),this.resultStorage=new re}setLocalAudioStats(t,n,s){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(s,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(s,n))}setLocalVideoStats(t,n,s){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(s,n)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(s,n)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(s))}setRemoteAudioStats(t,n){const s=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",s,this.checkAudioOutputLevel(n))}setRemoteVideoStats(t,n){const s=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",s,this.checkVideoDecode(n))}record(t,n,s){this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const c=this.resultStorage.get(t);if(c&&(c.result.push(s),c.result.length>=5)){var d;const h=zt(d=c.result).call(d,!0);c.isPrevNormal&&!h&&this.emit("exception",$T[t],t,n),!c.isPrevNormal&&h&&this.emit("exception",$T[t]+2e3,t+"_RECOVER",n),c.isPrevNormal=h,c.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,n){return n instanceof ci&&!n.isActive||!!n.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,n){let s=null;n._encoderConfig&&n._encoderConfig.frameRate&&(s=su(n._encoderConfig.frameRate));const c=t.captureFrameRate;return!s||!c||!(s>10&&c<5||s<10&&s>=5&&c<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checkSendVideoBitrate(t,n){return!!n.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,n){return n instanceof ci&&!n.isActive||!!n.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}const $T={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003};function t1(r,t){var n=le(r);if(ee){var s=ee(r);t&&(s=kt(s).call(s,function(c){return Wt(r,c).enumerable})),n.push.apply(n,s)}return n}function Us(r){for(var t=1;t<arguments.length;t++){var n,s=arguments[t]!=null?arguments[t]:{};if(t%2)G(n=t1(Object(s),!0)).call(n,function(d){_r(r,d,s[d])});else if(te)He(r,te(s));else{var c;G(c=t1(Object(s))).call(c,function(d){se(r,d,Wt(s,d))})}}return r}class Ul{constructor(t){this.localConnectionsMap=new re,this.remoteConnectionsMap=new re,this.trafficStatsPeerList=[],this.updateStats=()=>{var n,s;G(n=this.remoteConnectionsMap).call(n,c=>{var d;const h=c.audioStats,p=c.videoStats,A=c.pcStats,m=Us({},Vh),E=Us({},Gh),v=Us({},WA),C=c.connection.pc.getStats(),b=C.audioRecv[0],y=C.videoRecv[0],w=A?A.videoRecv[0]:void 0,k=c.connection.pc._statsFilter.videoIsReady===!0,P=this.trafficStats&&_t(d=this.trafficStats.peer_delay).call(d,V=>V.peer_uid===c.connection.getUserId());if(b){b.codec!=="opus"&&b.codec!=="aac"||(m.codecType=b.codec),b.outputLevel?m.receiveLevel=Math.round(32767*b.outputLevel):c.connection.user.audioTrack&&(m.receiveLevel=Math.round(32767*c.connection.user.audioTrack.getVolumeLevel())),m.receiveBytes=b.bytes,m.receivePackets=b.packets,m.receivePacketsLost=b.packetsLost,m.packetLossRate=m.receivePacketsLost/(m.receivePackets+m.receivePacketsLost),m.receiveBitrate=h?8*Math.max(0,m.receiveBytes-h.receiveBytes):0,m.totalDuration=h?h.totalDuration+1:1,m.totalFreezeTime=h?h.totalFreezeTime:0,m.freezeRate=m.totalFreezeTime/m.totalDuration,m.receiveDelay=b.jitterBufferMs;const V=c.connection.user.audioTrack;m.totalDuration>10&&Ul.isRemoteAudioFreeze(V)&&(m.totalFreezeTime+=1)}if(y){y.codec!=="H264"&&y.codec!=="VP8"&&y.codec!=="VP9"&&y.codec!=="AV1X"||(E.codecType=y.codec),E.receiveBytes=y.bytes,E.receiveBitrate=p?8*Math.max(0,E.receiveBytes-p.receiveBytes):0,E.decodeFrameRate=y.decodeFrameRate,E.renderFrameRate=y.decodeFrameRate,y.outputFrame&&(E.renderFrameRate=y.outputFrame.frameRate),y.receivedFrame?(E.receiveFrameRate=y.receivedFrame.frameRate,E.receiveResolutionHeight=y.receivedFrame.height,E.receiveResolutionWidth=y.receivedFrame.width):c.connection.user.videoTrack&&(E.receiveResolutionHeight=c.connection.user.videoTrack._videoHeight||0,E.receiveResolutionWidth=c.connection.user.videoTrack._videoWidth||0),y.framesRateFirefox!==void 0&&(E.receiveFrameRate=Math.round(y.framesRateFirefox)),E.receivePackets=y.packets,E.receivePacketsLost=y.packetsLost,E.packetLossRate=E.receivePacketsLost/(E.receivePackets+E.receivePacketsLost),E.totalDuration=p?p.totalDuration+1:1,E.totalFreezeTime=p?p.totalFreezeTime:0,E.receiveDelay=y.jitterBufferMs||0;const V=c.connection.user.videoTrack;c.connection.subscribeOptions.video&&k&&Ul.isRemoteVideoFreeze(V,y,w)&&(E.totalFreezeTime+=1),E.freezeRate=E.totalFreezeTime/E.totalDuration}P&&(m.end2EndDelay=P.B_ad,E.end2EndDelay=P.B_vd,m.transportDelay=P.B_ed,E.transportDelay=P.B_ed,m.currentPacketLossRate=P.B_ealr4/100,E.currentPacketLossRate=P.B_evlr4/100,v.uplinkNetworkQuality=P.B_punq?P.B_punq:0,v.downlinkNetworkQuality=P.B_pdnq?P.B_punq:0),c.audioStats=m,c.videoStats=E,c.pcStats=C,c.networkStats=v,c.connection.user.audioTrack&&this.exceptionMonitor.setRemoteAudioStats(c.connection.user.audioTrack,m),c.connection.user.videoTrack&&this.exceptionMonitor.setRemoteVideoStats(c.connection.user.videoTrack,E)}),G(s=this.localConnectionsMap).call(s,c=>{const d=c.audioStats,h=c.videoStats,p=Us({},Bd),A=Us({},Ud),m=c.connection.pc.getStats(),E=m.audioSend[0],v=m.videoSend[0],C=c.connection.getUserId();E&&(E.codec!=="opus"&&E.codec!=="aac"||(p.codecType=E.codec),E.inputLevel?p.sendVolumeLevel=Math.round(32767*E.inputLevel):c.connection.audioTrack&&(p.sendVolumeLevel=Math.round(32767*c.connection.audioTrack.getVolumeLevel())),p.sendBytes=E.bytes,p.sendPackets=E.packets,p.sendPacketsLost=E.packetsLost,p.sendBitrate=d?8*Math.max(0,p.sendBytes-d.sendBytes):0),v&&(v.codec!=="H264"&&v.codec!=="VP8"&&v.codec!=="VP9"&&v.codec!=="AV1X"||(A.codecType=v.codec),A.sendBytes=v.bytes,A.sendBitrate=h?8*Math.max(0,A.sendBytes-h.sendBytes):0,v.inputFrame?(A.captureFrameRate=v.inputFrame.frameRate,A.captureResolutionHeight=v.inputFrame.height,A.captureResolutionWidth=v.inputFrame.width):c.connection.videoTrack&&(A.captureResolutionWidth=c.connection.videoTrack._videoWidth||0,A.captureResolutionHeight=c.connection.videoTrack._videoHeight||0),v.sentFrame?(A.sendFrameRate=v.sentFrame.frameRate,A.sendResolutionHeight=v.sentFrame.height,A.sendResolutionWidth=v.sentFrame.width):c.connection.videoTrack&&(A.sendResolutionWidth=c.connection.videoTrack._videoWidth||0,A.sendResolutionHeight=c.connection.videoTrack._videoHeight||0),v.avgEncodeMs&&(A.encodeDelay=v.avgEncodeMs),c.connection.videoTrack&&c.connection.videoTrack._encoderConfig&&c.connection.videoTrack._encoderConfig.bitrateMax&&(A.targetSendBitrate=1e3*c.connection.videoTrack._encoderConfig.bitrateMax),A.sendPackets=v.packets,A.sendPacketsLost=v.packetsLost,A.totalDuration=h?h.totalDuration+1:1,A.totalFreezeTime=h?h.totalFreezeTime:0,this.isLocalVideoFreeze(v)&&(A.totalFreezeTime+=1)),this.trafficStats&&(p.sendPacketsLost=this.trafficStats.B_palr4/100,A.sendPacketsLost=this.trafficStats.B_pvlr4/100),c.audioStats=p,c.videoStats=A,c.audioStats&&c.connection.audioTrack&&this.exceptionMonitor.setLocalAudioStats(C,c.connection.audioTrack,c.audioStats),c.videoStats&&c.connection.videoTrack&&this.exceptionMonitor.setLocalVideoStats(C,c.connection.videoTrack,c.videoStats)})},this.clientId=t,this.updateStatsInterval=window.setInterval(this.updateStats,1e3),this.exceptionMonitor=new UL,this.exceptionMonitor.on("exception",(n,s,c)=>{this.onStatsException&&this.onStatsException(n,s,c)})}reset(){this.localConnectionsMap=new re,this.remoteConnectionsMap=new re,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(t){const n=this.localConnectionsMap.get(t);return n&&n.audioStats?n.audioStats:Us({},Bd)}getLocalVideoTrackStats(t){const n=this.localConnectionsMap.get(t);return n&&n.videoStats?n.videoStats:Us({},Ud)}getRemoteAudioTrackStats(t){var n;const s=this.remoteConnectionsMap.get(t);if(!s||!s.audioStats)return Us({},Vh);if(!this.trafficStats)return s.audioStats;const c=_t(n=this.trafficStats.peer_delay).call(n,d=>d.peer_uid===s.connection.user.uid);return c&&(s.audioStats.publishDuration=c.B_ppad+(pt()-this.trafficStats.timestamp)),s.audioStats}getRemoteNetworkQualityStats(t){const n=this.remoteConnectionsMap.get(t);return n&&n.networkStats?n.networkStats:Us({},WA)}getRemoteVideoTrackStats(t){var n;const s=this.remoteConnectionsMap.get(t);if(!s||!s.videoStats)return Us({},Gh);if(!this.trafficStats)return s.videoStats;const c=_t(n=this.trafficStats.peer_delay).call(n,d=>d.peer_uid===s.connection.user.uid);return c&&(s.videoStats.publishDuration=c.B_ppvd+(pt()-this.trafficStats.timestamp)),s.videoStats}getRTCStats(){var t,n;let s=0,c=0,d=0,h=0;G(t=this.localConnectionsMap).call(t,A=>{A.audioStats&&(s+=A.audioStats.sendBytes,c+=A.audioStats.sendBitrate),A.videoStats&&(s+=A.videoStats.sendBytes,c+=A.videoStats.sendBitrate)}),G(n=this.remoteConnectionsMap).call(n,A=>{A.audioStats&&(d+=A.audioStats.receiveBytes,h+=A.audioStats.receiveBitrate),A.videoStats&&(d+=A.videoStats.receiveBytes,h+=A.videoStats.receiveBitrate)});let p=1;return this.trafficStats&&(p+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:p,SendBitrate:c,SendBytes:s,RecvBytes:d,RecvBitrate:h,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}removeConnection(t){this.localConnectionsMap.delete(t),this.remoteConnectionsMap.delete(t)}addLocalConnection(t){const n=t.connectionId;this.localConnectionsMap.has(n)||this.localConnectionsMap.set(n,{connection:t})}addRemoteConnection(t){const n=t.connectionId;this.remoteConnectionsMap.has(n)||this.remoteConnectionsMap.set(n,{connection:t})}updateTrafficStats(t){var n;const s=kt(n=t.peer_delay).call(n,c=>{var d;return Ft(d=this.trafficStatsPeerList).call(d,c.peer_uid)===-1});G(s).call(s,c=>{var d,h;const p=_t(d=Fe(ua(h=this.remoteConnectionsMap).call(h))).call(d,A=>A.connection._userId===c.peer_uid);c.B_ppad!==void 0&&c.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(c.peer_uid,c.B_ppad,c.B_ppvd,p?pt()-p.connection.startTime:0),this.trafficStatsPeerList.push(c.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){var n;this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&S.debug(O(n="[".concat(this.clientId,"]: Period fir changes to ")).call(n,t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,n,s){if(!t)return!1;const c=!!s&&n.framesDecodeFreezeTime>s.framesDecodeFreezeTime,d=!s||n.framesDecodeCount>s.framesDecodeCount;return c||!d}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}}function e1(r,t){var n=le(r);if(ee){var s=ee(r);t&&(s=kt(s).call(s,function(c){return Wt(r,c).enumerable})),n.push.apply(n,s)}return n}function r1(r){for(var t=1;t<arguments.length;t++){var n,s=arguments[t]!=null?arguments[t]:{};if(t%2)G(n=e1(Object(s),!0)).call(n,function(d){_r(r,d,s[d])});else if(te)He(r,te(s));else{var c;G(c=e1(Object(s))).call(c,function(d){se(r,d,Wt(s,d))})}}return r}function xL(r){if(!r.address||!r.tcp)throw new M(L.UNEXPECTED_RESPONSE,"Invalid address format ".concat(r));return r.address.match(/^[\.\:\d]+$/)?"".concat(r.address.replace(/[^\d]/g,"-"),".edge.agora.io"):(S.info("Cannot recognized as IP address ".concat(r.address,". Used As Host instead")),O(t="".concat(r.address,":")).call(t,r.tcp));var t}function n1(r,t){var n;const s=ot("GATEWAY_DOMAINS");let c=s[1]&&Ft(t).call(t,s[1])!==-1?1:0;return r.addresses=r.addresses||[],{gatewayAddrs:ft(n=r.addresses).call(n,d=>{var h,p,A;return d.ip.match(/^[\.\:\d]+$/)?O(h=O(p="".concat(d.ip.replace(/[^\d]/g,"-"),".")).call(p,s[c++%s.length],":")).call(h,d.port):(S.info("Cannot recognized as IP address ".concat(d.ip,". Used As Host instead")),O(A="".concat(d.ip,":")).call(A,d.port))}),uid:r.uid,cid:r.cid,vid:r.detail&&r.detail[8],uni_lbs_ip:r.detail&&r.detail[1],res:r,csIp:r.detail&&r.detail[502]}}function su(r){return typeof r=="number"?r:r.exact||r.ideal||r.max||r.min||0}function i1(r,t){const n=r.videoSend[0];if(!n)return null;const s=t&&t.videoSend[0]?t.videoSend[0].inputFrame:void 0,c={id:Le(10,""),timestamp:new Date(r.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:n.ssrc.toString()};return n.inputFrame&&(s&&n.inputFrame.height===s.height||(c.A_fhi=n.inputFrame.height?n.inputFrame.height.toString():"0"),s&&n.inputFrame.width===s.width||(c.A_fwi=n.inputFrame.width?n.inputFrame.width.toString():"0"),s&&n.inputFrame.frameRate===s.frameRate||(c.A_fri=n.inputFrame.frameRate?n.inputFrame.frameRate.toString():"0")),c}function o1(r){return r>=0&&r<.17?1:r>=.17&&r<.36?2:r>=.36&&r<.59?3:r>=.59&&r<=1?4:r>1?5:0}function FL(r,t){const n={};if(r.height&&r.width){const s=t._videoHeight||t.getMediaStreamTrack(!0).getSettings().height;n.scaleResolutionDownBy=s?s/su(r.height):4}return n.maxFramerate=r.framerate?su(r.framerate):void 0,n.maxBitrate=r.bitrate?1e3*r.bitrate:void 0,n}function sm(r,t){var n;let s,c,d;switch(t){case yi.CHOOSE_SERVER:s=4096,c="choose server";break;case yi.CLOUD_PROXY:s=1048576,c="proxy";break;case yi.CLOUD_PROXY_5:s=4194304,c="proxy5";break;default:throw new M(L.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:r.detail&&r.detail[502],retry:!1})}if(G(n=r.response_body).call(n,h=>{var p;h.buffer&&h.buffer.flag===s&&(d={code:h.buffer.code,addresses:ft(p=h.buffer.edges_services).call(p,A=>r1({},A,{ticket:h.buffer.cert})),server_ts:r.enter_ts,uid:h.buffer.uid,cid:h.buffer.cid,cname:h.buffer.cname,detail:r1({},h.buffer.detail,{},r.detail),flag:h.buffer.flag,opid:r.opid})}),!d)throw new M(L.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:r.detail&&r.detail[502]});return d}function QL(r){var t;return ft(t=r.addresses).call(t,n=>({address:n.ip,tcpport:n.port,udpport:n.port,username:qe.username,password:qe.password}))}function s1(r,t){var n=le(r);if(ee){var s=ee(r);t&&(s=kt(s).call(s,function(c){return Wt(r,c).enumerable})),n.push.apply(n,s)}return n}function am(r){for(var t=1;t<arguments.length;t++){var n,s=arguments[t]!=null?arguments[t]:{};if(t%2)G(n=s1(Object(s),!0)).call(n,function(d){_r(r,d,s[d])});else if(te)He(r,te(s));else{var c;G(c=s1(Object(s))).call(c,function(d){se(r,d,Wt(s,d))})}}return r}const cm=new re;class VL extends Hr{constructor(t){super(),this.inChannelInfo={joinAt:null,duration:0},this._state="DISCONNECTED",this.needToSendUnpubUnsub=new re,this.isSignalRecover=!1,this.hasChangeBGPAddress=!1,this.joinGatewayStartTime=0,this._signalTimeout=!1,this.clientId=t.clientId,this.spec=t,this.signal=new BL(am({},t,{retryConfig:t.websocketRetryConfig})),this._statsCollector=t.statsCollector,this.role=t.role||"audience",this._clientRoleOptions=t.clientRoleOptions,this.handleSignalEvents()}get state(){return this._state}set state(t){if(t===this._state)return;const n=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(yo.CONNECTION_STATE_CHANGE,t,n,this._disconnectedReason):this.emit(yo.CONNECTION_STATE_CHANGE,t,n)}async join(t,n){var s,c;t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const d=pt();let h=cm.get(t.cname);if(h||(h=new re,cm.set(t.cname,h)),h.has(t.uid)){const m=new M(L.UID_CONFLICT);throw bt.joinGateway(t.sid,{lts:d,succ:!1,ec:m.message,addr:null,uid:t.uid,cid:t.cid}),m}h.set(t.uid,!0),this.joinInfo=t,this.key=n;const p=t.proxyServer?ft(s=t.gatewayAddrs).call(s,m=>{var E,v;const C=m.split(":");return O(E=O(v="wss://".concat(t.proxyServer,"/ws/?h=")).call(v,C[0],"&p=")).call(E,C[1])}):ft(c=t.gatewayAddrs).call(c,m=>"wss://".concat(m));let A=0;this.joinGatewayStartTime=d;try{A=(await this.signal.init(p)).uid}catch(m){throw S.error("[".concat(this.clientId,"] User join failed"),m.toString()),bt.joinGateway(t.sid,{lts:d,succ:!1,ec:m.message,addr:this.signal.url,uid:t.uid,cid:t.cid}),h.delete(t.uid),this.signal.close(),m}return this.state="CONNECTED",this.inChannelInfo.joinAt=pt(),S.debug("[".concat(this.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(m=>{S.warning("[".concat(this.clientId,"] get traffic stats error"),m.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(yo.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(yo.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(yo.NETWORK_QUALITY,{uplinkNetworkQuality:o1(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:o1(this._statsCollector.trafficStats.B_dnq)}):this.emit(yo.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),A}async leave(t=!1){if(this.state!=="DISCONNECTED"){this.state="DISCONNECTING";try{t||this.signal.connectionState!==Sn.CONNECTED||await yS(this.signal.request(Ar.LEAVE,void 0,!0),3e3)}catch(n){S.warning("[".concat(this.clientId,"] leave request failed, ignore"),n)}this.signal.close(),this.reset(),this.state="DISCONNECTED"}}async publish(t,n){if(!this.joinInfo)throw new M(L.UNEXPECTED_ERROR,"publish no joinInfo");const s=t.getUserId(),c=t.videoTrack?function(d){var h;const p=d._encoderConfig;if(!p)return{};const A={resolution:p.width&&p.height?O(h="".concat(su(p.width),"x")).call(h,su(p.height)):void 0,maxVideoBW:p.bitrateMax,minVideoBW:p.bitrateMin};return typeof p.frameRate=="number"?(A.maxFrameRate=p.frameRate,A.minFrameRate=p.frameRate):p.frameRate&&(A.maxFrameRate=p.frameRate.max||p.frameRate.ideal||p.frameRate.exact||p.frameRate.min,A.minFrameRate=p.frameRate.min||p.frameRate.ideal||p.frameRate.exact||p.frameRate.max),A}(t.videoTrack):{};if(t.on(ae.NEED_ANSWER,(d,h,p)=>{var A;const m={state:"offer",stream_type:n,p2p_id:t.pc.ID,sdp:ht(d),audio:!!t.audioTrack,video:!!t.videoTrack,screen:t.videoTrack&&Ft(A=t.videoTrack._hints).call(A,Xn.SCREEN_TRACK)!==-1,attributes:c,dtx:t.audioTrack instanceof ou&&t.audioTrack._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1,mode:this.spec.mode,codec:this.spec.codec,extend:ot("PUB_EXTEND")};if(t.audioTrack&&t.audioTrack instanceof ci&&t.audioTrack){const E={stream_id:this.joinInfo&&(this.joinInfo.stringUid||this.joinInfo.uid),action:""};t.audioTrack.isActive?E.action="unmute_local_audio":E.action="mute_local_audio",this.sendControl(E)}if(t.videoTrack){const E={stream_id:this.joinInfo&&(this.joinInfo.stringUid||this.joinInfo.uid),action:""};t.videoTrack.muted?E.action="mute_local_video":E.action="unmute_local_video",this.sendControl(E)}this.signal.request(Ar.PUBLISH,m,!0).then(E=>{s&&this.needToSendUnpubUnsub.set(s,!0),h(JSON.parse(E.sdp))}).catch(E=>{if(d.retry&&E.data&&E.data.code===Ml.ERR_PUBLISH_REQUEST_INVALID)return S.warning("[".concat(this.clientId,"] receiver publish error code, retry"),E.toString()),xr(t,ae.NEED_UNPUB).then(()=>{d.retry=!1,xr(t,ae.NEED_ANSWER,d).then(h).catch(p)});E.code!==L.WS_ABORT&&p(E)})}),t.on(ae.NEED_RENEGOTIATE,(d,h,p)=>{const A={state:"negotiation",stream_type:n,p2p_id:t.pc.ID,sdp:d};this.signal.request(Ar.PUBLISH,A,!0).then(m=>{h(JSON.parse(m.sdp))}).catch(m=>{m.code!==L.WS_ABORT&&p(m)})}),t.on(ae.NEED_UNPUB,d=>s&&!this.needToSendUnpubUnsub.has(s)?d(!1):this.state==="RECONNECTING"?d(!0):void this.signal.request(Ar.UNPUBLISH,{stream_id:t.getUserId(),stream_type:n},!0).then(()=>d(!1)).catch(h=>{S.warning("unpublish warning: ",h),d(!0)})),t.on(ae.NEED_UPLOAD,(d,h)=>{this.signal.upload(d,{stream_type:n,stats:h})}),t.on(ae.NEED_SIGNAL_RTT,d=>{d(this.signal.rtt)}),t.on(ae.NEED_CONTROL,(d,h,p)=>{let A;if(d.type==="video"&&d.muted)A="mute_local_video";else if(d.type!=="video"||d.muted)if(d.type==="audio"&&d.muted)A="mute_local_audio";else{if(d.type!=="audio"||d.muted)return;A="unmute_local_audio"}else A="unmute_local_video";const m={stream_id:this.joinInfo&&(this.joinInfo.stringUid||this.joinInfo.uid),action:A};this.sendControl(m).then(h).catch(p)}),this.state!=="RECONNECTING"){if(this.state!=="CONNECTED")return new M(L.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state)).throw();await t.startP2PConnection()}else t.readyToReconnectPC()}async subscribe(t){if(!this.joinInfo)throw new M(L.UNEXPECTED_ERROR,"subscribe no joinInfo");const n=t.getUserId();if(t.on(ae.NEED_ANSWER,(s,c,d)=>{const h=t.subscribeOptions,p={stream_id:t.getUserId(),audio:!!h.audio,video:!!h.video,mode:this.spec.mode,codec:this.spec.codec,p2p_id:t.pc.ID,sdp:ht(s),tcc:!!ot("SUBSCRIBE_TCC"),extend:ot("SUB_EXTEND")};this.signal.request(Ar.SUBSCRIBE,p,!0).then(A=>{this.needToSendUnpubUnsub.set(n,!0),c(JSON.parse(A.sdp))}).catch(A=>{if(s.retry&&A.data&&A.data.code===Ml.ERR_SUBSCRIBE_REQUEST_INVALID)return S.warning("[".concat(this.clientId,"] receiver subscribe error code, retry"),A.toString()),xr(t,ae.NEED_UNSUB).then(()=>{s.retry=!1,xr(t,ae.NEED_ANSWER,s).then(c).catch(d)});A.code!==L.WS_ABORT&&d(A)})}),t.on(ae.NEED_UNSUB,s=>this.needToSendUnpubUnsub.has(n)?this.state==="RECONNECTING"?s(!0):void this.signal.request(Ar.UNSUBSCRIBE,{stream_id:t.getUserId()},!0).then(()=>s(!1)).catch(c=>{S.warning("unsubscribe warning",c),s(!0)}):s(!1)),t.on(ae.NEED_UPLOAD,(s,c)=>{this.signal.upload(s,{stream_id:t.getUserId(),stats:c})}),t.on(ae.NEED_SIGNAL_RTT,s=>{s(this.signal.rtt)}),this.state!=="RECONNECTING"){if(this.state!=="CONNECTED")return new M(L.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state)).throw();await t.startP2PConnection()}else t.readyToReconnectPC()}async subscribeChange(t,n){var s,c;if(!this.joinInfo)throw new M(L.UNEXPECTED_ERROR,"subscribe no joinInfo");if(await t.setSubscribeOptions(n),this.state!=="RECONNECTING"){if(this.state!=="CONNECTED")return new M(L.INVALID_OPERATION,"can not subscribe change when connection state is ".concat(this.state)).throw();S.debug(O(s=O(c="[".concat(this.clientId,"] send subscribe change, audio: ")).call(c,n.audio,", video: ")).call(s,n.video)),await this.signal.request(Ar.SUBSCRIBE_CHANGE,{stream_id:t.getUserId(),audio:!!n.audio,video:!!n.video},!0)}}async sendControl(t){this.signal.request(Ar.CONTROL,t,!0,!0)}async unsubscribe(t){await t.closeP2PConnection()}getGatewayInfo(){return this.signal.request(Ar.GATEWAY_INFO)}renewToken(t){return this.signal.request(Ar.RENEW_TOKEN,{token:t})}async setClientRole(t,n){if(n&&(this._clientRoleOptions=hr({},n)),this.state!=="CONNECTED")return void(this.role=t);let s;s=t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:0,await this.signal.request(Ar.SET_CLIENT_ROLE,{role:t,level:s}),this.role=t}async setRemoteVideoStreamType(t,n){await this.signal.request(Ar.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:n})}async setStreamFallbackOption(t,n){await this.signal.request(Ar.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:n})}async pickSVCLayer(t,n){await this.signal.request(Ar.PICK_SVC_LAYER,{stream_id:t,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=pt()-this.inChannelInfo.joinAt),am({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Ar.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=pt()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=cm.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.needToSendUnpubUnsub=new re,this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=function(n){const s=n.match(/(wss\:\/\/)?([^:]+):(\d+)/);return s?{username:qe.username,password:qe.password,turnServerURL:s[2],tcpport:Sr(s[3])+30,udpport:Sr(s[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex])||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(am({},qe,{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){var t;if(this.state!=="CONNECTED")return;const n=await this.signal.request(Ar.TRAFFIC_STATS,void 0,!0);n.timestamp=pt(),G(t=n.peer_delay).call(t,s=>{var c;const d=this._statsCollector.trafficStats&&_t(c=this._statsCollector.trafficStats.peer_delay).call(c,h=>h.peer_uid===s.peer_uid);d&&d.B_st!==s.B_st&&on(()=>{this.emit(yo.STREAM_TYPE_CHANGE,s.peer_uid,s.B_st)})}),this._statsCollector.updateTrafficStats(n)}getJoinMessage(){if(!this.joinInfo||!this.key)throw new M(L.UNEXPECTED_ERROR,"can not generate join message, no join info");const t=hr({},this.joinInfo.apResponse);let n=ot("REPORT_APP_SCENARIO");if(typeof n!="string")try{n=ht(n)}catch{n=void 0}n&&n.length>128&&(n=void 0);const s={session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Pn,browser:navigator.userAgent,process_id:ot("PROCESS_ID"),mode:this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:t,extend:ot("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:n};return this.joinInfo.stringUid&&(s.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(s.aes_mode=this.joinInfo.aesmode,ot("ENCRYPT_AES")?(s.aes_secret=this.joinInfo.aespassword,s.aes_encrypt=!0):s.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(s.aes_salt=this.joinInfo.aessalt)),t.addresses[this.signal.websocket.currentURLIndex]&&(s.ap_response.ticket=t.addresses[this.signal.websocket.currentURLIndex].ticket,delete t.addresses),s}getRejoinMessage(){if(!this.joinInfo)throw new M(L.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Oe.WS_RECONNECTING,t=>{this.joinInfo&&bt.WebSocketQuit(this.joinInfo.sid,{lts:pt(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||Bi.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",bt.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode}),this.isSignalRecover=!1,this.joinGatewayStartTime=pt())}),this.signal.on(Oe.WS_CLOSED,t=>{let n;switch(t){case"LEAVE":n=Bi.LEAVE;break;case"UID_BANNED":case"IP_BANNED":case"CHANNEL_BANNED":case"SERVER_ERROR":n=Bi.SERVER_ERROR;break;default:n=Bi.NETWORK_ERROR}S.debug("[signal] websocket closed, reason: ".concat(n||"undefined -> "+Bi.NETWORK_ERROR)),this.joinInfo&&bt.WebSocketQuit(this.joinInfo.sid,{lts:pt(),succ:t==="LEAVE"?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this.reset(),this._disconnectedReason=t,this.state="DISCONNECTED"}),this.signal.on(Oe.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){var t,n,s;if(this.role==="audience"&&this._clientRoleOptions&&this._clientRoleOptions.level&&(S.debug(O(t=O(n=O(s="[".concat(this.clientId,"] patch to send set client role, role: ")).call(s,this.role,", mode: ")).call(n,this.spec.mode,", level: ")).call(t,this._clientRoleOptions&&this._clientRoleOptions.level)),this.setClientRole(this.role,this._clientRoleOptions)),bt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid}),this.joinInfo.useLocalAccessPoint){const d=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);var c;if(!d)return void S.error(O(c="[".concat(this.clientId,"] set local access point after joined failed: ")).call(c,d));jr("EVENT_REPORT_DOMAIN",d[1]),jr("EVENT_REPORT_BACKUP_DOMAIN",d[1]),jr("LOG_UPLOAD_SERVER","".concat(d[1],":6444"))}}}),this.signal.on(ir.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(Oe.REQUEST_RECOVER,(t,n,s)=>{if(!this.joinInfo)return s(new M(L.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,xr(this,yo.REQUEST_NEW_GATEWAY_LIST).then(n).catch(s)}),this.signal.on(Oe.REQUEST_JOIN_INFO,t=>{t(this.getJoinMessage())}),this.signal.on(Oe.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(Oe.REPORT_JOIN_GATEWAY,(t,n)=>{this.joinInfo&&bt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:t,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid})}),this.signal.on(Oe.IS_P2P_DISCONNECTED,t=>{t(Va(this,yo.IS_P2P_DISCONNECTED))}),this.signal.on(Oe.DISCONNECT_P2P,()=>{this.needToSendUnpubUnsub=new re,this.emit(yo.DISCONNECT_P2P)}),this.signal.on(Oe.NEED_RENEW_SESSION,()=>{this.emit(yo.NEED_RENEW_SESSION)}),this.signal.on(Oe.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Oe.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0})}}function a1(r,t){var n=le(r);if(ee){var s=ee(r);t&&(s=kt(s).call(s,function(c){return Wt(r,c).enumerable})),n.push.apply(n,s)}return n}let lm=1;function GL(r,t,n,s,c){lm+=1;const d={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(pt()/1e3),seq:lm,requestId:lm,version:Pn,cname:n.cname},h={service_name:t,json_body:ht(d)};let p,A,m=r[0];return Zn(async()=>{p=pt();const E=await Bn(m,{data:h,cancelToken:s,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(A=pt()-p,E.code!==0){const y=new M(L.UNEXPECTED_RESPONSE,"live streaming ap error, code"+E.code,{retry:!0,responseTime:A});throw S.error(y.toString()),y}const v=JSON.parse(E.json_body);if(v.code!==200){var C;const y=new M(L.UNEXPECTED_RESPONSE,O(C="live streaming app center error, code: ".concat(v.code,", reason: ")).call(C,v.reason),{code:v.code,responseTime:A});throw S.error(y.toString()),y}if(!v.servers||v.servers.length===0){const y=new M(L.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:v.code,responseTime:A});throw S.error(y.toString()),y}const b=function(y,w){var k;return{addressList:ft(k=y.servers).call(k,P=>{var V,j;return O(V=O(j="wss://".concat(P.address.replace(/\./g,"-"),".edge.agora.io:")).call(j,P.wss,"?serviceName=")).call(V,encodeURIComponent(w))}),workerToken:y.workerToken,vid:y.vid}}(v,t);return ot("LIVE_STREAMING_ADDRESS")&&(b.addressList=ot("LIVE_STREAMING_ADDRESS")instanceof Array?ot("LIVE_STREAMING_ADDRESS"):[ot("LIVE_STREAMING_ADDRESS")]),function(y){for(var w=1;w<arguments.length;w++){var k,P=arguments[w]!=null?arguments[w]:{};if(w%2)G(k=a1(Object(P),!0)).call(k,function(j){_r(y,j,P[j])});else if(te)He(y,te(P));else{var V;G(V=a1(Object(P))).call(V,function(j){se(y,j,Wt(P,j))})}}return y}({},b,{responseTime:A})},(E,v)=>(bt.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:ht(E.addressList),firstSuccess:v===0,responseTime:A,serverIp:r[v%r.length]}),!1),(E,v)=>(bt.apworkerEvent(n.sid,{success:!1,sc:E.data&&E.data.code||200,serviceName:t,responseTime:A,serverIp:r[v%r.length]}),!!(E.code!==L.OPERATION_ABORTED&&E.code!==L.UNEXPECTED_RESPONSE||E.data&&E.data.retry)&&(m=r[(v+1)%r.length],!0)),c)}function c1({url:r,areaCode:t},n,s,c){const d=pt(),[h,p]=h1(n,t,[yi.CHOOSE_SERVER]);let A=yr.networkState;return Zn(async()=>{A&&yr.networkState===iu.OFFLINE&&yr.onlineWaiter&&await dt.race([yr.onlineWaiter,Ur(c&&c.maxRetryTimeout||Ne.maxRetryTimeout)]),A=yr.networkState;const m=await Bn(r,{data:h,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0);d1(m,r,n,d,[yi.CHOOSE_SERVER]);const E=sm(m,yi.CHOOSE_SERVER);return u1(E),n1(E,r)},m=>(m&&bt.joinChooseServer(n.sid,{lts:d,succ:!0,csAddr:r,opid:p,serverList:m.gatewayAddrs,ec:null,cid:m.cid.toString(),uid:m.uid.toString(),csIp:m.csIp,unilbsServerIds:[yi.CHOOSE_SERVER].toString()}),!1),m=>m.code!==L.OPERATION_ABORTED&&(m.code===L.CAN_NOT_GET_GATEWAY_SERVER?m.data.retry:(bt.joinChooseServer(n.sid,{lts:d,succ:!1,csAddr:r,serverList:null,opid:p,ec:m.code,csIp:m.data&&m.data.csIp,unilbsServerIds:[yi.CHOOSE_SERVER].toString(),extend:ht({networkState:A})}),S.warning("[".concat(n.clientId,"] Choose server network error, retry"),m),!0)),c)}function l1({url:r,areaCode:t,serviceIds:n},s,c,d){const h=pt(),[p,A]=h1(s,t,n);let m;return Zn(async()=>{m&&yr.networkState===iu.OFFLINE&&yr.onlineWaiter&&await dt.race([yr.onlineWaiter,Ur(d&&d.maxRetryTimeout||Ne.maxRetryTimeout)]),m=yr.networkState;const E=await Bn(r,{data:p,cancelToken:c,headers:{"Content-Type":"multipart/form-data;"}},!0);d1(E,r,s,h,n);const v=sm(E,yi.CHOOSE_SERVER),C=sm(E,s.cloudProxyServer==="proxy5"?yi.CLOUD_PROXY_5:yi.CLOUD_PROXY);return u1(v),{gatewayInfo:n1(v,r),proxyInfo:C,url:r}},E=>{var v;return E.gatewayInfo&&bt.joinChooseServer(s.sid,{lts:h,succ:!0,csAddr:r,serverList:E.gatewayInfo.gatewayAddrs,ec:null,opid:A,cid:E.gatewayInfo.cid.toString(),uid:E.gatewayInfo.uid.toString(),csIp:E.gatewayInfo.csIp,unilbsServerIds:n.toString()}),E.proxyInfo&&bt.joinWebProxyAP(s.sid,{lts:h,sucess:1,apServerAddr:r,turnServerAddrList:ft(v=E.proxyInfo.addresses).call(v,C=>C.ip).join(","),errorCode:null,eventType:s.cloudProxyServer,unilbsServerIds:n.toString()}),!1},E=>E.code!==L.OPERATION_ABORTED&&(E.code===L.CAN_NOT_GET_GATEWAY_SERVER?E.data.retry:(bt.joinWebProxyAP(s.sid,{lts:h,sucess:0,apServerAddr:r,turnServerAddrList:null,errorCode:E.code,eventType:s.cloudProxyServer,unilbsServerIds:n.toString(),extend:ht({networkState:m})}),S.warning("[".concat(s.clientId,"] multi unilbs network error, retry"),E),!0)),d)}const d1=(r,t,n,s,c)=>{var d,h,p;const A=[];if(G(d=r.response_body).call(d,m=>{const E=m.buffer.code;if(E!==0){const v=ha(E),C={error:new M(L.CAN_NOT_GET_GATEWAY_SERVER,v.desc,{retry:v.retry,csIp:r.detail[502]}),flag:m.buffer.flag};A.push(C),C.flag===4096?bt.joinChooseServer(n.sid,{lts:s,succ:!1,csAddr:t,opid:r.opid,serverList:null,ec:C.error.message,csIp:C.error.data&&C.error.data.csIp,unilbsServerIds:c.toString()}):C.flag!==1048576&&C.flag!==4194304||bt.joinWebProxyAP(n.sid,{lts:s,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:C.error.code,eventType:n.cloudProxyServer,unilbsServerIds:c.toString()})}}),A.length)throw S.warning(O(h=O(p="[".concat(n.clientId,"] multi unilbs ")).call(p,t," failed, ")).call(h,ft(A).call(A,m=>{var E,v;return O(E=O(v="flag: ".concat(m.flag,", message: ")).call(v,m.error.message,", retry: ")).call(E,m.error.data.retry)}).join(" | "))),new M(L.CAN_NOT_GET_GATEWAY_SERVER,ft(A).call(A,m=>{var E;return O(E="flag: ".concat(m.flag,", message: ")).call(E,m.error.message)}).join(" | "),{retry:!!_t(A).call(A,m=>m.error.data.retry),csIp:r.detail[502]})},u1=r=>{if(r.addresses&&r.addresses.length===0&&r.code===0)throw new M(L.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:r.detail&&r.detail[502]});if(ot("GATEWAY_ADDRESS")&&ot("GATEWAY_ADDRESS").length>0){var t;S.debug("assign gateway address to",ot("GATEWAY_ADDRESS"));const n=ft(t=ot("GATEWAY_ADDRESS")).call(t,s=>({ip:s.ip,port:s.port,ticket:r.addresses[0]&&r.addresses[0].ticket}));r.addresses=n}},h1=(r,t,n)=>{var s;const c=Math.floor(Math.random()*10**12),d={appid:r.appId,client_ts:pt(),opid:c,sid:r.sid,request_bodies:[{uri:22,buffer:{cname:r.cname,detail:{6:r.stringUid,11:t},key:r.token,service_ids:n,uid:r.uid||0}}]};G(s=d.request_bodies).call(s,p=>{r.multiIP&&r.multiIP.gateway_ip&&(p.buffer.detail[5]=ht({vocs_ip:[r.multiIP.uni_lbs_ip],vos_ip:[r.multiIP.gateway_ip]}))});const h=new FormData;return h.append("request",ht(d)),[h,c]};async function au(r,t,n){return{gatewayInfo:await async function(c,d,h){var p,A;const m=ft(p=en(A=ot("WEBCS_DOMAIN")).call(A,0,ot("AJAX_REQUEST_CONCURRENT"))).call(p,y=>{var w;return{url:c.proxyServer?O(w="https://".concat(c.proxyServer,"/ap/?url=")).call(w,y+"/api/v2/transpond/webrtc?v=2"):"https://".concat(y,"/api/v2/transpond/webrtc?v=2"),areaCode:Ms()}});let E=null;const v=[],C=async()=>await Co({fragementLength:ot("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:y=>(S.debug("[".concat(c.clientId,"] Connect to choose_server:"),y.url),c1(y,c,d,h)),allFailedhandler:y=>{throw y[0]},promisesCollector:v}),b=async()=>{var y;if(await Ur(1e3),E!==null)return E;const w=ft(y=ot("WEBCS_DOMAIN_BACKUP_LIST")).call(y,k=>{var P;return{url:c.proxyServer?O(P="https://".concat(c.proxyServer,"/ap/?url=")).call(P,k+"/api/v2/transpond/webrtc?v=2"):"https://".concat(k,"/api/v2/transpond/webrtc?v=2"),areaCode:Ms()}});return await Co({fragementLength:ot("FRAGEMENT_LENGTH"),referenceList:w,asyncMapHandler:k=>(S.debug("[".concat(c.clientId,"] Connect to backup choose_server:"),k.url),c1(k,c,d,h)),allFailedhandler:k=>{throw k[0]},promisesCollector:v})};return E=await Os([C(),b()]),v.length&&G(v).call(v,y=>y.cancel&&typeof y.cancel=="function"&&y.cancel()),E}(r,t,n)}}async function dm(r,t,n,s){var c,d;if(r.cloudProxyServer==="disabled")return s?await au(r,t,n):void 0;let h;if(r.cloudProxyServer==="443only"||r.cloudProxyServer==="normal"){var p;let A;s?r.cloudProxyServer!=="normal"?[A,h]=await dt.all([Bp(r,t,n),au(r,t,n)]):(A=await Bp(r,t,n),r.proxyServer=A.addresses[0],bt.setProxyServer(r.proxyServer),S.setProxyServer(r.proxyServer),h=await au(r,t,n)):(h=void 0,r.cloudProxyServer!=="normal"?A=await Bp(r,t,n):(A=await Bp(r,t,n),r.proxyServer=A.addresses[0],bt.setProxyServer(r.proxyServer),S.setProxyServer(r.proxyServer))),r.turnServer={mode:"manual",servers:ft(p=A.addresses).call(p,m=>({turnServerURL:m,tcpport:r.cloudProxyServer==="proxy3"?void 0:A.serverResponse.tcpport?A.serverResponse.tcpport:qe.tcpport,udpport:r.cloudProxyServer==="proxy4"?void 0:A.serverResponse.udpport?A.serverResponse.udpport:qe.udpport,username:A.serverResponse.username||qe.username,password:A.serverResponse.password||qe.password,forceturn:r.cloudProxyServer!=="proxy4"&&r.cloudProxyServer!=="proxy5",security:r.cloudProxyServer==="proxy5"}))}}else{const{proxyInfo:A,gatewayInfo:m}=await async function(E,v,C){var b,y;const w=ot("PROXY_SERVER_TYPE3"),k=(rt,W)=>{var H;let U=w;return $r(U)&&(U=W%2==0?w[1]:w[0]),O(H="https://".concat(U,"/ap/?url=")).call(H,rt)},P=ft(b=en(y=ot("WEBCS_DOMAIN")).call(y,0,ot("AJAX_REQUEST_CONCURRENT"))).call(b,(rt,W)=>({url:k("".concat(rt,"/api/v2/transpond/webrtc?v=2"),W),areaCode:Ms(),serviceIds:[yi.CHOOSE_SERVER,E.cloudProxyServer==="proxy5"?yi.CLOUD_PROXY_5:yi.CLOUD_PROXY]}));let V=null;const j=[],st=async()=>await Co({fragementLength:ot("FRAGEMENT_LENGTH"),referenceList:P,asyncMapHandler:rt=>(S.debug("[".concat(E.clientId,"] Connect to choose_server:"),rt.url),l1(rt,E,v,C)),allFailedhandler:rt=>{throw rt[0]},promisesCollector:j}),mt=async()=>{var rt;if(await Ur(1e3),V!==null)return V;const W=ft(rt=ot("WEBCS_DOMAIN_BACKUP_LIST")).call(rt,(H,U)=>({url:k("".concat(H,"/api/v2/transpond/webrtc?v=2"),U),areaCode:Ms(),serviceIds:[11,18]}));return await Co({fragementLength:ot("FRAGEMENT_LENGTH"),referenceList:W,asyncMapHandler:H=>(S.debug("[".concat(E.clientId,"] Connect to backup choose_server:"),H.url),l1(H,E,v,C)),allFailedhandler:H=>{throw H[0]},promisesCollector:j})},{gatewayInfo:Et,proxyInfo:At,url:$}=await Os([st(),mt()]);if(j.length&&G(j).call(j,rt=>rt.cancel&&typeof rt.cancel=="function"&&rt.cancel()),!Et||!At)throw new M(L.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if($r(w)&&$){const rt=new Sy($).host;zt(w).call(w,rt)&&(E.proxyServer=rt,S.setProxyServer(rt),bt.setProxyServer(rt))}return V={gatewayInfo:Et,proxyInfo:QL(At)},V}(r,t,n);h={gatewayInfo:m},r.turnServer={mode:"manual",servers:ft(A).call(A,E=>({turnServerURL:E.address,tcpport:r.cloudProxyServer==="proxy3"?void 0:E.tcpport?E.tcpport:qe.tcpport,udpport:r.cloudProxyServer==="proxy4"?void 0:E.udpport?E.udpport:qe.udpport,username:E.username||qe.username,password:E.password||qe.password,forceturn:r.cloudProxyServer!=="proxy4"&&r.cloudProxyServer!=="proxy5",security:r.cloudProxyServer==="proxy5"}))}}return S.debug(O(c=O(d="[".concat(r.clientId,"] set proxy server: ")).call(d,r.proxyServer,", mode: ")).call(c,r.cloudProxyServer)),h}async function p1(r,t,n,s){var c;const d=en(c=ot("ACCOUNT_REGISTER")).call(c,0,ot("AJAX_REQUEST_CONCURRENT"));let h=[];return h=t.proxyServer?ft(d).call(d,p=>{var A;return O(A="https://".concat(t.proxyServer,"/ap/?url=")).call(A,p+"/api/v1")}):ft(d).call(d,p=>"https://".concat(p,"/api/v1")),(await async function(p,A,m,E,v){const C=pt(),b={sid:m.sid,opid:10,appid:m.appId,string_uid:A};let y=p[0];const w=await Zn(()=>Bn(y+"".concat(Ft(y).call(y,"?")===-1?"?":"&","action=stringuid"),{data:b,cancelToken:E,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(k,P)=>{if(k.code===0){var V;if(k.uid<=0||k.uid>=Math.pow(2,32))throw S.error(O(V="Invalid Uint Uid ".concat(A," => ")).call(V,k.uid),k),bt.reqUserAccount(b.sid,{lts:C,success:!1,serverAddr:y,stringUid:b.string_uid,uid:k.uid,errorCode:L.INVALID_UINT_UID_FROM_STRING_UID,extend:b}),new M(L.INVALID_UINT_UID_FROM_STRING_UID);return bt.reqUserAccount(b.sid,{lts:C,success:!0,serverAddr:y,stringUid:b.string_uid,uid:k.uid,errorCode:null,extend:b}),!1}const j=ha(k.code);return j.retry&&(y=p[(P+1)%p.length]),bt.reqUserAccount(b.sid,{lts:C,success:!1,serverAddr:y,stringUid:b.string_uid,uid:k.uid,errorCode:j.desc,extend:b}),j.retry},(k,P)=>k.code!==L.OPERATION_ABORTED&&(bt.reqUserAccount(b.sid,{lts:C,success:!1,serverAddr:y,stringUid:b.string_uid,uid:null,errorCode:k.code,extend:b}),y=p[(P+1)%p.length],!0),v);if(w.code!==0){const k=ha(w.code);throw new M(L.UNEXPECTED_RESPONSE,k.desc)}return w}(h,r,t,n,s)).uid}async function Bp(r,t,n){var s,c;let d=pt();const h=ft(s=ot(r.cloudProxyServer==="normal"?"PROXY_CS":"WEBCS_DOMAIN")).call(s,C=>{var b;return r.proxyServer?O(b="https://".concat(r.proxyServer,"/ap/?url=")).call(b,C+"/api/v1"):"https://".concat(C,"/api/v1")});if(r.cloudProxyServer==="proxy3"||r.cloudProxyServer==="proxy4"||r.cloudProxyServer==="proxy5"){const C=ft(h).call(h,w=>({url:w,areaCode:Ms()}));let b=null;b=await Co({fragementLength:ot("FRAGEMENT_LENGTH"),referenceList:C,asyncMapHandler:w=>function({url:k,areaCode:P},V,j,st){const mt=pt(),Et={opid:133,flag:V.cloudProxyServer==="proxy5"?4194304:1048576,ts:+new Date,key:V.token,cname:V.cname,sid:V.sid,detail:{6:V.stringUid,11:P},uid:V.uid||0};return Zn(async()=>await Bn(k,{data:Et,cancelToken:j,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":69}}),At=>{var $;if(At.code===0)return bt.joinWebProxyAP(V.sid,{lts:mt,sucess:1,apServerAddr:k,turnServerAddrList:ft($=At.addresses).call($,W=>W.ip).join(","),errorCode:null,eventType:V.cloudProxyServer}),!1;const rt=ha(At.code);throw new M(L.CAN_NOT_GET_GATEWAY_SERVER,rt.desc,{retry:rt.retry})},At=>{return At.code!==L.OPERATION_ABORTED&&(At.code===L.CAN_NOT_GET_GATEWAY_SERVER?(bt.joinWebProxyAP(Et.sid,{lts:mt,sucess:0,apServerAddr:k,turnServerAddrList:null,errorCode:At.code,eventType:V.cloudProxyServer}),S.warning(O($=O(rt=O(W="[".concat(V.clientId,"] proxy ap server ")).call(W,k," failed, message: ")).call(rt,At.message,", retry: ")).call($,At.data.retry)),At.data.retry):(bt.joinWebProxyAP(Et.sid,{lts:mt,sucess:0,apServerAddr:k,turnServerAddrList:null,errorCode:At.code,eventType:V.cloudProxyServer}),!0));var $,rt,W},st)}(w,r,t,n),allFailedhandler:()=>{throw S.error("[".concat(r.clientId,"] can not get proxy server after trying several times")),new M(L.CAN_NOT_GET_PROXY_SERVER)}});const y=b.addresses;if(!y||y.length===0)throw S.error("[".concat(r.clientId,"] can not get proxy server, empty proxy server list")),new M(L.CAN_NOT_GET_PROXY_SERVER,"empty proxy server list");return{addresses:ft(y).call(y,w=>w.ip),serverResponse:{tcpport:y[0].port||443,udpport:y[0].port||qe.udpport,username:qe.username,password:qe.password}}}let p=null;p=await Co({fragementLength:ot("FRAGEMENT_LENGTH"),referenceList:h,asyncMapHandler:C=>function(b,y,w,k){const P=pt(),V={command:"convergeAllocateEdge",sid:y.sid,appId:y.appId,token:y.token,uid:y.uid,cname:y.cname,ts:Math.floor(pt()/1e3),version:Pn,seq:0,requestId:1};return Zn(async()=>({res:await Bn(b,{data:{service_name:"webrtc_proxy",json_body:ht(V)},cancelToken:w,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}}),url:b}),j=>{if(!j.res.json_body)throw S.debug("[".concat(y.clientId,"] Get proxy server failed: no json_body")),new M(L.UNEXPECTED_RESPONSE,ht(j.res));const st=JSON.parse(j.res.json_body);var mt,Et;if(st.code!==200)throw S.debug(O(mt=O(Et="[".concat(y.clientId,"] Get proxy server failed: response code [")).call(Et,st.code,"], reason [")).call(mt,st.reason,"]")),new M(L.UNEXPECTED_RESPONSE,ht(j.res));return S.debug("[".concat(y.clientId,"] App return server length"),st.servers.length),!1},j=>j.code!==L.OPERATION_ABORTED&&(bt.requestProxyAppCenter(V.sid,{lts:P,succ:!1,APAddr:b,workerManagerList:null,ec:j.code,response:j.message}),!0),k)}(C,r,t,n),allFailedhandler:()=>{throw S.error("[".concat(r.clientId,"] can not get proxy server after trying several times")),new M(L.CAN_NOT_GET_PROXY_SERVER)}});const A=JSON.parse(p.res.json_body),m=ft(c=A.servers).call(c,xL);if(r.cloudProxyServer==="443only")return{addresses:m,serverResponse:{tcpport:443,udpport:qe.udpport,username:qe.username,password:qe.password}};bt.requestProxyAppCenter(r.sid,{lts:d,succ:!0,APAddr:p.url,workerManagerList:ht(m),ec:null,response:ht(p.res)}),d=pt();const E=ft(m).call(m,C=>function(b,y,w,k){const P=pt();let V=b;al(b).call(b,"http")||(V="https://".concat(b,":4000/v2/machine"));const j={command:"request",gatewayType:"http",appId:y.appId,cname:y.cname,uid:(y.uid||"").toString(),sdkVersion:"2.3.1",sid:y.sid,seq:1,ts:pt(),requestId:3,clientRequest:{appId:y.appId,cname:y.cname,uid:(y.uid||"").toString(),sid:y.sid}};return Zn(async()=>({res:await Bn(V,{data:j,cancelToken:w}),url:b}),st=>{if(!st.res.serverResponse)throw new M(L.UNEXPECTED_RESPONSE,"requeet worker manager server failed: serverResponse is undefined");return!1},st=>st.code!==L.OPERATION_ABORTED&&(bt.requestProxyWorkerManager(j.sid,{lts:P,succ:!1,workerManagerAddr:b,ec:st.code,response:st.message}),!0),k)}(C,r,t,n));let v=null;try{v=await Os(E)}catch{throw S.error("[".concat(r.clientId,"] can not get worker manager after trying several times")),new M(L.CAN_NOT_GET_PROXY_SERVER)}return G(E).call(E,C=>C.cancel()),bt.requestProxyWorkerManager(r.sid,{lts:d,succ:!0,workerManagerAddr:v.url,ec:null,response:ht(v.res)}),{addresses:[v.url],serverResponse:v.res.serverResponse}}async function f1(r,t,n,s){var c,d;const h=ft(c=en(d=ot("UAP_AP")).call(d,0,ot("AJAX_REQUEST_CONCURRENT"))).call(c,p=>{var A;return t.proxyServer?O(A="https://".concat(t.proxyServer,"/ap/?url=")).call(A,p+"/api/v1?action=uap"):"https://".concat(p,"/api/v1?action=uap")});return await GL(h,r,t,n,s)}qt({target:"Number",stat:!0},{isNaN:function(r){return r!=r}});var A1=_e.Number.isNaN,jL=Zy;qt({target:"Object",stat:!0,sham:!g},{create:Rs});var WL=_e.Object,KL=function(r,t){return WL.create(r,t)};qt({target:"Object",stat:!0},{setPrototypeOf:Xf});var HL=_e.Object.setPrototypeOf,YL=a(function(r,t){(function(n){function s($){if($r($))return ft($).call($,function(H){return H});if(!c($))return $;var rt={};for(var W in $)c($[W])||$r($[W])?rt[W]=s($[W]):rt[W]=$[W];return rt}function c($){return!(typeof $!="object"||$r($)||!$)}function d(){var $=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i);return $&&$[0]?Number($[0].split("/")[1]):null}function h($){return!!window.RTCStatsReport&&$.getStats()instanceof dt}var p=function(){function $(rt){this.input=[],this.size=rt}return $.prototype.add=function(rt){var W;this.input.push(rt),this.input.length>this.size&&Ye(W=this.input).call(W,0,1)},$.prototype.diffMean=function(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length},$}(),A=function($,rt){return(A=HL||{__proto__:[]}instanceof Array&&function(W,H){W.__proto__=H}||function(W,H){for(var U in H)H.hasOwnProperty(U)&&(W[U]=H[U])})($,rt)};/*! *****************************************************************************
	    Copyright (c) Microsoft Corporation. All rights reserved.
	    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
	    this file except in compliance with the License. You may obtain a copy of the
	    License at http://www.apache.org/licenses/LICENSE-2.0
	       THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
	    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
	    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
	    MERCHANTABLITY OR NON-INFRINGEMENT.
	       See the Apache Version 2.0 License for specific language governing permissions
	    and limitations under the License.
	    ***************************************************************************** */function m($,rt){function W(){this.constructor=$}A($,rt),$.prototype=rt===null?KL(rt):(W.prototype=rt.prototype,new W)}var E=function(){return(E=hr||function($){for(var rt,W=1,H=arguments.length;W<H;W++)for(var U in rt=arguments[W])Object.prototype.hasOwnProperty.call(rt,U)&&($[U]=rt[U]);return $}).apply(this,arguments)};function v($,rt,W,H){return new(W||(W=dt))(function(U,Tt){function It(Y){try{Ut(H.next(Y))}catch(tt){Tt(tt)}}function Ct(Y){try{Ut(H.throw(Y))}catch(tt){Tt(tt)}}function Ut(Y){Y.done?U(Y.value):new W(function(tt){tt(Y.value)}).then(It,Ct)}Ut((H=H.apply($,rt||[])).next())})}function C($,rt){var W,H,U,Tt,It={label:0,sent:function(){if(1&U[0])throw U[1];return U[1]},trys:[],ops:[]};return Tt={next:Ct(0),throw:Ct(1),return:Ct(2)},typeof rm=="function"&&(Tt[jL]=function(){return this}),Tt;function Ct(Y){return function(tt){return Ut([Y,tt])}}function Ut(Y){if(W)throw new TypeError("Generator is already executing.");for(;It;)try{if(W=1,H&&(U=2&Y[0]?H.return:Y[0]?H.throw||((U=H.return)&&U.call(H),0):H.next)&&!(U=U.call(H,Y[1])).done)return U;switch(H=0,U&&(Y=[2&Y[0],U.value]),Y[0]){case 0:case 1:U=Y;break;case 4:return It.label++,{value:Y[1],done:!1};case 5:It.label++,H=Y[1],Y=[0];continue;case 7:Y=It.ops.pop(),It.trys.pop();continue;default:if(!((U=(U=It.trys).length>0&&U[U.length-1])||Y[0]!==6&&Y[0]!==2)){It=0;continue}if(Y[0]===3&&(!U||Y[1]>U[0]&&Y[1]<U[3])){It.label=Y[1];break}if(Y[0]===6&&It.label<U[1]){It.label=U[1],U=Y;break}if(U&&It.label<U[2]){It.label=U[2],It.ops.push(Y);break}U[2]&&It.ops.pop(),It.trys.pop();continue}Y=rt.call($,It)}catch(tt){Y=[6,tt],H=0}finally{W=U=0}if(5&Y[0])throw Y[1];return{value:Y[0]?Y[1]:void 0,done:!0}}}var b,y={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[]},w={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0},k={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0},P={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0},V={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0},j=function(){function $(rt,W){var H=this;this.videoIsReady=!1,this.stats=s(y),this.isFirstVideoReceived=!1,this.isFirstVideoDecoded=!1,this.isFirstAudioReceived=!1,this.isFirstAudioDecoded=!1,this.lossRateWindowStats=[],this.pc=rt,this.options=W,this.intervalTimer=window.setInterval(function(){return v(H,void 0,void 0,function(){return C(this,function(U){return this.updateStats(),[2]})})},this.options.updateInterval)}return $.prototype.getStats=function(){return this.stats},$.prototype.setVideoIsReady=function(rt){this.videoIsReady=rt},$.prototype.setIsFirstAudioDecoded=function(rt){this.isFirstAudioDecoded=rt},$.prototype.destroy=function(){window.clearInterval(this.intervalTimer),this.pc=void 0},$.prototype.calcLossRate=function(rt){var W,H=this;this.lossRateWindowStats.push(rt),this.lossRateWindowStats.length>this.options.lossRateInterval&&Ye(W=this.lossRateWindowStats).call(W,0,1);for(var U=this.lossRateWindowStats.length,Tt=0,It=0,Ct=0,Ut=0,Y=function(at){var Lt;G(Lt=rt[at]).call(Lt,function(lt,R){if(H.lossRateWindowStats[U-1][at][R]&&H.lossRateWindowStats[0][at][R]){var B=H.lossRateWindowStats[U-1][at][R].packets-H.lossRateWindowStats[0][at][R].packets,Q=H.lossRateWindowStats[U-1][at][R].packetsLost-H.lossRateWindowStats[0][at][R].packetsLost;at==="videoSend"||at==="audioSend"?(Tt+=B,Ct+=Q):(It+=B,Ut+=Q),A1(B)||A1(B)?lt.packetLostRate=0:lt.packetLostRate=B<=0||Q<=0?0:Q/(B+Q)}})},tt=0,vt=["videoSend","audioSend","videoRecv","audioRecv"];tt<vt.length;tt++)Y(vt[tt]);rt.sendPacketLossRate=Tt<=0||Ct<=0?0:Ct/(Tt+Ct),rt.recvPacketLossRate=It<=0||Ut<=0?0:Ut/(It+Ut)},$}(),st=function($){function rt(){var W=$!==null&&$.apply(this,arguments)||this;return W._stats=y,W.lastDecodeVideoReceiverStats=new re,W}return m(rt,$),rt.prototype.updateStats=function(){return v(this,void 0,void 0,function(){var W,H,U,Tt;return C(this,function(It){switch(It.label){case 0:return[4,this._getStats()];case 1:return W=It.sent(),H=this.statsResponsesToObjects(W),this._stats=s(y),U=kt(H).call(H,function(Ct){return Ct.type==="ssrc"}),this.processSSRCStats(U),(Tt=_t(H).call(H,function(Ct){return Ct.type==="VideoBwe"}))&&this.processBandwidthStats(Tt),this._stats.timestamp=pt(),this.calcLossRate(this._stats),this.stats=this._stats,[2]}})})},rt.prototype.processBandwidthStats=function(W){this._stats.bitrate={actualEncoded:Number(W.googActualEncBitrate),targetEncoded:Number(W.googTargetEncBitrate),retransmit:Number(W.googRetransmitBitrate),transmit:Number(W.googTransmitBitrate)},this._stats.sendBandwidth=Number(W.googAvailableSendBandwidth)},rt.prototype.processSSRCStats=function(W){var H=this;G(W).call(W,function(U){var Tt,It=zt(Tt=U.id).call(Tt,"send");switch(U.mediaType+"_"+(It?"send":"recv")){case"video_send":var Ct=s(k);Ct.codec=U.googCodecName,Ct.adaptionChangeReason="none",U.googCpuLimitedResolution&&(Ct.adaptionChangeReason="cpu"),U.googBandwidthLimitedResolution&&(Ct.adaptionChangeReason="bandwidth"),Ct.avgEncodeMs=Number(U.googAvgEncodeMs),Ct.inputFrame={width:Number(U.googFrameWidthInput)||Number(U.googFrameWidthSent),height:Number(U.googFrameHeightInput)||Number(U.googFrameHeightSent),frameRate:Number(U.googFrameRateInput)},Ct.sentFrame={width:Number(U.googFrameWidthSent),height:Number(U.googFrameHeightSent),frameRate:Number(U.googFrameRateInput)},Ct.firsCount=Number(U.googFirReceived),Ct.nacksCount=Number(U.googNacksReceived),Ct.plisCount=Number(U.googPlisReceived),Ct.frameCount=Number(U.framesEncoded),Ct.bytes=Number(U.bytesSent),Ct.packets=Number(U.packetsSent),Ct.packetsLost=Number(U.packetsLost),Ct.ssrc=Number(U.ssrc),Ct.rttMs=Number(U.googRtt||0),H._stats.videoSend.push(Ct),H._stats.rtt=Ct.rttMs;break;case"video_recv":var Ut=s(w),Y=H.lastDecodeVideoReceiverStats.get(Number(U.ssrc));if(Ut.codec=U.googCodecName,Ut.targetDelayMs=Number(U.googTargetDelayMs),Ut.renderDelayMs=Number(U.googRenderDelayMs),Ut.currentDelayMs=Number(U.googCurrentDelayMs),Ut.minPlayoutDelayMs=Number(U.googMinPlayoutDelayMs),Ut.decodeMs=Number(U.googDecodeMs),Ut.maxDecodeMs=Number(U.googMaxDecodeMs),Ut.receivedFrame={width:Number(U.googFrameWidthReceived),height:Number(U.googFrameHeightReceived),frameRate:Number(U.googFrameRateReceived)},Ut.decodedFrame={width:Number(U.googFrameWidthReceived),height:Number(U.googFrameHeightReceived),frameRate:Number(U.googFrameRateDecoded)},Ut.outputFrame={width:Number(U.googFrameWidthReceived),height:Number(U.googFrameHeightReceived),frameRate:Number(U.googFrameRateOutput)},Ut.jitterBufferMs=Number(U.googJitterBufferMs),Ut.firsCount=Number(U.googFirsSent),Ut.nacksCount=Number(U.googNacksSent),Ut.plisCount=Number(U.googPlisSent),Ut.framesDecodeCount=Number(U.framesDecoded),Ut.bytes=Number(U.bytesReceived),Ut.packets=Number(U.packetsReceived),Ut.packetsLost=Number(U.packetsLost),Ut.ssrc=Number(U.ssrc),Ut.packets>0&&!H.isFirstVideoReceived&&(H.onFirstVideoReceived&&H.onFirstVideoReceived(),H.isFirstVideoReceived=!0),Ut.framesDecodeCount>0&&!H.isFirstVideoDecoded&&(H.onFirstVideoDecoded&&H.onFirstVideoDecoded(Ut.decodedFrame.width,Ut.decodedFrame.height),H.isFirstVideoDecoded=!0),Y){var tt=Y.stats,vt=pt()-Y.lts;Ut.framesDecodeFreezeTime=tt.framesDecodeFreezeTime,Ut.framesDecodeInterval=tt.framesDecodeInterval,Ut.framesDecodeCount>tt.framesDecodeCount&&H.isFirstVideoDecoded?(Y.lts=pt(),Ut.framesDecodeInterval=vt,Ut.framesDecodeInterval>=H.options.freezeRateLimit&&(H.videoIsReady?Ut.framesDecodeFreezeTime+=Ut.framesDecodeInterval:H.setVideoIsReady(!0))):Ut.framesDecodeCount<Y.stats.framesDecodeCount&&(Ut.framesDecodeInterval=0)}H.lastDecodeVideoReceiverStats.set(Ut.ssrc,{stats:E({},Ut),lts:pt()}),H._stats.videoRecv.push(Ut);break;case"audio_recv":var at=s(V);at.codec=U.googCodecName,at.outputLevel=Math.abs(Number(U.audioOutputLevel))/32767,at.decodingCNG=Number(U.googDecodingCNG),at.decodingCTN=Number(U.googDecodingCTN),at.decodingCTSG=Number(U.googDecodingCTSG),at.decodingNormal=Number(U.googDecodingNormal),at.decodingPLC=Number(U.googDecodingPLC),at.decodingPLCCNG=Number(U.googDecodingPLCCNG),at.expandRate=Number(U.googExpandRate),at.accelerateRate=Number(U.googAccelerateRate),at.preemptiveExpandRate=Number(U.googPreemptiveExpandRate),at.secondaryDecodedRate=Number(U.googSecondaryDecodedRate),at.speechExpandRate=Number(U.googSpeechExpandRate),at.preferredJitterBufferMs=Number(U.googPreferredJitterBufferMs),at.jitterBufferMs=Number(U.googJitterBufferMs),at.jitterMs=Number(U.googJitterReceived),at.bytes=Number(U.bytesReceived),at.packets=Number(U.packetsReceived),at.packetsLost=Number(U.packetsLost),at.ssrc=Number(U.ssrc),at.receivedFrames=Number(U.googDecodingCTN)||Number(U.packetsReceived),at.droppedFrames=Number(U.googDecodingPLC)+Number(U.googDecodingPLCCNG)||Number(U.packetsLost),at.receivedFrames>0&&!H.isFirstAudioReceived&&(H.onFirstAudioReceived&&H.onFirstAudioReceived(),H.isFirstAudioReceived=!0),at.decodingNormal>0&&!H.isFirstAudioDecoded&&(H.onFirstAudioDecoded&&H.onFirstAudioDecoded(),H.isFirstAudioDecoded=!0),H._stats.audioRecv.push(at);break;case"audio_send":var Lt=s(P);Lt.codec=U.googCodecName,Lt.inputLevel=Math.abs(Number(U.audioInputLevel))/32767,Lt.aecReturnLoss=Number(U.googEchoCancellationReturnLoss||0),Lt.aecReturnLossEnhancement=Number(U.googEchoCancellationReturnLossEnhancement||0),Lt.residualEchoLikelihood=Number(U.googResidualEchoLikelihood||0),Lt.residualEchoLikelihoodRecentMax=Number(U.googResidualEchoLikelihoodRecentMax||0),Lt.bytes=Number(U.bytesSent),Lt.packets=Number(U.packetsSent),Lt.packetsLost=Number(U.packetsLost),Lt.ssrc=Number(U.ssrc),Lt.rttMs=Number(U.googRtt||0),H._stats.rtt=Lt.rttMs,H._stats.audioSend.push(Lt)}})},rt.prototype._getStats=function(){var W=this;return new dt(function(H,U){W.pc.getStats(H,U)})},rt.prototype.statsResponsesToObjects=function(W){var H=[],U=W.result();return G(U).call(U,function(Tt){var It,Ct={id:Tt.id,timestamp:Tt.timestamp.valueOf().toString(),type:Tt.type};G(It=Tt.names()).call(It,function(Ut){Ct[Ut]=Tt.stat(Ut)}),H.push(Ct)}),H},rt}(j);(function($){$.CERTIFICATE="certificate",$.CODEC="codec",$.CANDIDATE_PAIR="candidate-pair",$.LOCAL_CANDIDATE="local-candidate",$.REMOTE_CANDIDATE="remote-candidate",$.INBOUND="inbound-rtp",$.TRACK="track",$.OUTBOUND="outbound-rtp",$.PC="peer-connection",$.REMOTE_INBOUND="remote-inbound-rtp",$.REMOTE_OUTBOUND="remote-outbound-rtp",$.TRANSPORT="transport",$.CSRC="csrc",$.DATA_CHANNEL="data-channel",$.STREAM="stream",$.SENDER="sender",$.RECEIVER="receiver"})(b||(b={}));var mt=function($){function rt(){var W=$!==null&&$.apply(this,arguments)||this;return W._stats=y,W.lastDecodeVideoReceiverStats=new re,W.lastVideoFramesRecv=new re,W.lastVideoFramesSent=new re,W.lastVideoFramesDecode=new re,W.lastVideoJBDelay=new re,W.lastAudioJBDelay=new re,W.mediaBytesSent=new re,W.mediaBytesRetransmit=new re,W.mediaBytesTargetEncode=new re,W.lastEncoderMs=new re,W}return m(rt,$),rt.prototype.updateStats=function(){return v(this,void 0,void 0,function(){var W,H=this;return C(this,function(U){var Tt;switch(U.label){case 0:return W=this,[4,this.pc.getStats()];case 1:return W.report=U.sent(),this._stats=s(y),G(Tt=this.report).call(Tt,function(It){switch(It.type){case b.OUTBOUND:It.mediaType==="audio"?H.processAudioOutboundStats(It):It.mediaType==="video"&&H.processVideoOutboundStats(It);break;case b.INBOUND:It.mediaType==="audio"?H.processAudioInboundStats(It):It.mediaType==="video"&&H.processVideoInboundStats(It);break;case b.TRANSPORT:var Ct=H.report.get(It.selectedCandidatePairId);Ct&&H.processCandidatePairStats(Ct);break;case b.CANDIDATE_PAIR:It.selected&&H.processCandidatePairStats(It)}}),this.updateSendBitrate(),this._stats.timestamp=pt(),this.calcLossRate(this._stats),this.stats=this._stats,[2]}})})},rt.prototype.processCandidatePairStats=function(W){var H,U;this._stats.sendBandwidth=W.availableOutgoingBitrate||0,W.currentRoundTripTime&&(this._stats.rtt=1e3*W.currentRoundTripTime),G(H=this._stats.videoSend).call(H,function(Tt){!Tt.rttMs&&W.currentRoundTripTime&&(Tt.rttMs=1e3*W.currentRoundTripTime)}),G(U=this._stats.audioSend).call(U,function(Tt){!Tt.rttMs&&W.currentRoundTripTime&&(Tt.rttMs=1e3*W.currentRoundTripTime)})},rt.prototype.processAudioInboundStats=function(W){var H,U=_t(H=this._stats.audioRecv).call(H,function(Tt){return Tt.ssrc===W.ssrc});U||(U=s(V),this._stats.audioRecv.push(U)),U.ssrc=W.ssrc,U.packets=W.packetsReceived,U.packetsLost=W.packetsLost,U.bytes=W.bytesReceived,U.jitterMs=1e3*W.jitter,W.trackId&&this.processAudioTrackReceiverStats(W.trackId,U),W.codecId&&(U.codec=this.getCodecFromCodecStats(W.codecId)),U.receivedFrames||(U.receivedFrames=W.packetsReceived),U.droppedFrames||(U.droppedFrames=W.packetsLost),U.receivedFrames>0&&!this.isFirstAudioReceived&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(),this.isFirstAudioReceived=!0),U.outputLevel&&U.outputLevel>0&&!this.isFirstAudioDecoded&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(),this.isFirstAudioDecoded=!0)},rt.prototype.processVideoInboundStats=function(W){var H,U=_t(H=this._stats.videoRecv).call(H,function(at){return at.ssrc===W.ssrc});U||(U=s(w),this._stats.videoRecv.push(U)),U.ssrc=W.ssrc,U.packets=W.packetsReceived,U.packetsLost=W.packetsLost,U.bytes=W.bytesReceived,U.firsCount=W.firCount,U.nacksCount=W.nackCount,U.plisCount=W.pliCount,U.framesDecodeCount=W.framesDecoded;var Tt=this.lastDecodeVideoReceiverStats.get(U.ssrc),It=this.lastVideoFramesDecode.get(U.ssrc),Ct=pt();if(U.framesDecodeCount>0&&!this.isFirstVideoDecoded){var Ut=U.decodedFrame?U.decodedFrame.width:0,Y=U.decodedFrame?U.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(Ut,Y),this.isFirstVideoDecoded=!0}if(Tt){var tt=Tt.stats,vt=Ct-Tt.lts;U.framesDecodeFreezeTime=tt.framesDecodeFreezeTime,U.framesDecodeInterval=tt.framesDecodeInterval,U.framesDecodeCount>tt.framesDecodeCount&&this.isFirstVideoDecoded?(Tt.lts=pt(),U.framesDecodeInterval=vt,U.framesDecodeInterval>=this.options.freezeRateLimit&&(this.videoIsReady?U.framesDecodeFreezeTime+=U.framesDecodeInterval:this.setVideoIsReady(!0))):U.framesDecodeCount<tt.framesDecodeCount&&(U.framesDecodeInterval=0)}It&&Ct-It.lts>=800?(U.decodeFrameRate=Math.round((U.framesDecodeCount-It.count)/((Ct-It.lts)/1e3)),this.lastVideoFramesDecode.set(U.ssrc,{count:U.framesDecodeCount,lts:Ct,rate:U.decodeFrameRate})):It?U.decodeFrameRate=It.rate:this.lastVideoFramesDecode.set(U.ssrc,{count:U.framesDecodeCount,lts:Ct,rate:0}),W.totalDecodeTime&&(U.decodeMs=1e3*W.totalDecodeTime),W.trackId&&this.processVideoTrackReceiverStats(W.trackId,U),W.codecId&&(U.codec=this.getCodecFromCodecStats(W.codecId)),W.framerateMean&&(U.framesRateFirefox=W.framerateMean),U.packets>0&&!this.isFirstVideoReceived&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(),this.isFirstVideoReceived=!0),this.lastDecodeVideoReceiverStats.set(U.ssrc,{stats:E({},U),lts:Tt?Tt.lts:pt()})},rt.prototype.processVideoOutboundStats=function(W){var H,U=_t(H=this._stats.videoSend).call(H,function(Lt){return Lt.ssrc===W.ssrc});U||(U=s(k),this._stats.videoSend.push(U));var Tt=this.mediaBytesSent.get(W.ssrc);if(Tt?Tt.add(W.bytesSent):((Ct=new p(10)).add(W.bytesSent),this.mediaBytesSent.set(W.ssrc,Ct)),W.retransmittedBytesSent!==void 0){var It=this.mediaBytesRetransmit.get(W.ssrc);It?It.add(W.retransmittedBytesSent):((Ct=new p(10)).add(W.retransmittedBytesSent),this.mediaBytesRetransmit.set(W.ssrc,Ct))}if(W.totalEncodedBytesTarget){var Ct,Ut=this.mediaBytesTargetEncode.get(W.ssrc);Ut?Ut.add(W.totalEncodedBytesTarget):((Ct=new p(10)).add(W.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(W.ssrc,Ct))}if(U.ssrc=W.ssrc,U.bytes=W.bytesSent,U.packets=W.packetsSent,U.firsCount=W.firCount,U.nacksCount=W.nackCount,U.plisCount=W.pliCount,U.frameCount=W.framesEncoded,U.adaptionChangeReason=W.qualityLimitationReason,W.totalEncodeTime&&W.framesEncoded){var Y=this.lastEncoderMs.get(W.ssrc);if(!Y||Y.lastFrameCount>W.framesEncoded)U.avgEncodeMs=1e3*W.totalEncodeTime/W.framesEncoded;else{var tt=W.framesEncoded-Y.lastFrameCount,vt=W.totalEncodeTime-Y.lastEncoderTime;U.avgEncodeMs=1e3*vt/tt}this.lastEncoderMs.set(W.ssrc,{lastFrameCount:W.framesEncoded,lastEncoderTime:W.totalEncodeTime,lts:pt()})}if(W.codecId&&(U.codec=this.getCodecFromCodecStats(W.codecId)),W.mediaSourceId&&this.processVideoMediaSource(W.mediaSourceId,U),W.trackId&&this.processVideoTrackSenderStats(W.trackId,U),W.remoteId)this.processRemoteInboundStats(W.remoteId,U);else{var at=this.findRemoteStatsId(W.ssrc,b.REMOTE_INBOUND);at&&this.processRemoteInboundStats(at,U)}},rt.prototype.processAudioOutboundStats=function(W){var H,U=_t(H=this._stats.audioSend).call(H,function(It){return It.ssrc===W.ssrc});if(U||(U=s(P),this._stats.audioSend.push(U)),U.ssrc=W.ssrc,U.packets=W.packetsSent,U.bytes=W.bytesSent,W.mediaSourceId&&this.processAudioMediaSource(W.mediaSourceId,U),W.codecId&&(U.codec=this.getCodecFromCodecStats(W.codecId)),W.trackId&&this.processAudioTrackSenderStats(W.trackId,U),W.remoteId)this.processRemoteInboundStats(W.remoteId,U);else{var Tt=this.findRemoteStatsId(W.ssrc,b.REMOTE_INBOUND);Tt&&this.processRemoteInboundStats(Tt,U)}},rt.prototype.findRemoteStatsId=function(W,H){var U,Tt,It=_t(U=Fe(ua(Tt=this.report).call(Tt))).call(U,function(Ct){return Ct.type===H&&Ct.ssrc===W});return It?It.id:null},rt.prototype.processVideoMediaSource=function(W,H){var U=this.report.get(W);U&&U.width&&U.height&&U.framesPerSecond&&(H.inputFrame={width:U.width,height:U.height,frameRate:U.framesPerSecond})},rt.prototype.processAudioMediaSource=function(W,H){var U=this.report.get(W);U&&(H.inputLevel=U.audioLevel)},rt.prototype.processVideoTrackSenderStats=function(W,H){var U=this.report.get(W);if(U){var Tt=0,It=pt(),Ct=this.lastVideoFramesSent.get(H.ssrc);Ct&&It-Ct.lts>=800?(Tt=Math.round((U.framesSent-Ct.count)/((It-Ct.lts)/1e3)),this.lastVideoFramesSent.set(H.ssrc,{count:U.framesSent,lts:It,rate:Tt})):Ct?Tt=Ct.rate:this.lastVideoFramesSent.set(H.ssrc,{count:U.framesSent,lts:It,rate:0}),H.sentFrame={width:U.frameWidth,height:U.frameHeight,frameRate:Tt}}},rt.prototype.processVideoTrackReceiverStats=function(W,H){var U=this.report.get(W);if(U){var Tt=this.lastVideoFramesRecv.get(H.ssrc),It=pt();H.framesReceivedCount=U.framesReceived;var Ct=0;if(Tt&&It-Tt.lts>=800?(Ct=Math.round((U.framesReceived-Tt.count)/((It-Tt.lts)/1e3)),this.lastVideoFramesRecv.set(H.ssrc,{count:U.framesReceived,lts:It,rate:Ct})):Tt?Ct=Tt.rate:this.lastVideoFramesRecv.set(H.ssrc,{count:U.framesReceived,lts:It,rate:0}),H.receivedFrame={width:U.frameWidth||0,height:U.frameHeight||0,frameRate:Ct||0},H.decodedFrame={width:U.frameWidth||0,height:U.frameHeight||0,frameRate:H.decodeFrameRate||0},H.outputFrame={width:U.frameWidth||0,height:U.frameHeight||0,frameRate:H.decodeFrameRate||0},U.jitterBufferDelay&&U.jitterBufferEmittedCount){var Ut=this.lastVideoJBDelay.get(H.ssrc);this.lastVideoJBDelay.set(H.ssrc,{jitterBufferDelay:U.jitterBufferDelay,jitterBufferEmittedCount:U.jitterBufferEmittedCount}),Ut||(Ut={jitterBufferDelay:0,jitterBufferEmittedCount:0});var Y=1e3*(U.jitterBufferDelay-Ut.jitterBufferDelay)/(U.jitterBufferEmittedCount-Ut.jitterBufferEmittedCount);H.jitterBufferMs=Y,H.currentDelayMs=Math.round(Y)}}},rt.prototype.processAudioTrackSenderStats=function(W,H){var U=this.report.get(W);U&&(H.aecReturnLoss=U.echoReturnLoss||0,H.aecReturnLossEnhancement=U.echoReturnLossEnhancement||0)},rt.prototype.processAudioTrackReceiverStats=function(W,H){var U=this.report.get(W);if(U){if(U.removedSamplesForAcceleration&&U.totalSamplesReceived&&(H.accelerateRate=U.removedSamplesForAcceleration/U.totalSamplesReceived),U.jitterBufferDelay&&U.jitterBufferEmittedCount){var Tt=this.lastAudioJBDelay.get(H.ssrc);this.lastAudioJBDelay.set(H.ssrc,{jitterBufferDelay:U.jitterBufferDelay,jitterBufferEmittedCount:U.jitterBufferEmittedCount}),Tt||(Tt={jitterBufferDelay:0,jitterBufferEmittedCount:0});var It=1e3*(U.jitterBufferDelay-Tt.jitterBufferDelay)/(U.jitterBufferEmittedCount-Tt.jitterBufferEmittedCount);H.jitterBufferMs=Math.round(It)}H.outputLevel=U.audioLevel;var Ct=1920;U.totalSamplesDuration&&U.totalSamplesReceived&&(Ct=U.totalSamplesReceived/U.totalSamplesDuration/50,H.receivedFrames=Math.round(U.totalSamplesReceived/Ct)),U.concealedSamples&&(H.droppedFrames=Math.round(U.concealedSamples/Ct))}},rt.prototype.processRemoteInboundStats=function(W,H){var U=this.report.get(W);U&&(H.packetsLost=U.packetsLost,U.roundTripTime&&(H.rttMs=1e3*U.roundTripTime))},rt.prototype.getCodecFromCodecStats=function(W){var H=this.report.get(W);if(!H)return"";var U=H.mimeType.match(/\/(.*)$/);return U&&U[1]?U[1]:""},rt.prototype.updateSendBitrate=function(){var W,H,U,Tt=0,It=null,Ct=null;G(W=this.mediaBytesSent).call(W,function(Y){Tt+=Y.diffMean()}),G(H=this.mediaBytesRetransmit).call(H,function(Y){It=It===null?Y.diffMean():It+Y.diffMean()}),G(U=this.mediaBytesTargetEncode).call(U,function(Y){Ct=Ct===null?Y.diffMean():Ct+Y.diffMean()});var Ut=It!==null?Tt-It:Tt;this._stats.bitrate={actualEncoded:8*Ut/(this.options.updateInterval/1e3),transmit:8*Tt/(this.options.updateInterval/1e3)},It!==null&&(this._stats.bitrate.retransmit=8*It/(this.options.updateInterval/1e3)),Ct!==null&&(this._stats.bitrate.targetEncoded=8*Ct/(this.options.updateInterval/1e3))},rt}(j),Et=function($){function rt(){return $!==null&&$.apply(this,arguments)||this}return m(rt,$),rt.prototype.updateStats=function(){return dt.resolve()},rt}(j);function At($,rt,W,H){rt===void 0&&(rt=250),W===void 0&&(W=8),H===void 0&&(H=500);var U=d();return U?U<76?new st($,{updateInterval:rt,lossRateInterval:W,freezeRateLimit:H}):new mt($,{updateInterval:rt,lossRateInterval:W,freezeRateLimit:H}):h($)?new mt($,{updateInterval:rt,lossRateInterval:W,freezeRateLimit:H}):new Et($,{updateInterval:rt,lossRateInterval:W,freezeRateLimit:H})}n.createWebRTCStatsFilter=At,n.AgoraWebRTCStatsFilter=j,se(n,"__esModule",{value:!0})})(t)});class g1{constructor(t){this.localCandidateCount=0,this.allCandidateReceived=!1,this.audioTrack=null,this.videoTrack=null,this.mediaStream=new MediaStream,this.ID=m1,m1+=1,this.spec=t,this.createPeerConnection(),this.statsFilter=YL.createWebRTCStatsFilter(this.pc,void 0,void 0,Gr()?1200:void 0)}get _statsFilter(){return this.statsFilter}getStats(){return this.statsFilter.getStats()}async createOfferSDP(){try{const t=await this.pc.createOffer(this.offerOptions);if(!t.sdp)throw new Error("offer sdp is empty");return t.sdp}catch(t){throw S.error("create offer error:",t.toString()),new M(L.CREATE_OFFER_FAILED,t.toString())}}async setOfferSDP(t){try{await this.pc.setLocalDescription({type:"offer",sdp:t})}catch(n){throw S.error("set local offer error",n.toString()),new M(L.CREATE_OFFER_FAILED,n.toString())}}async setAnswerSDP(t){try{await this.pc.setRemoteDescription({type:"answer",sdp:t})}catch(n){if(n.name!=="InvalidStateError"||this.pc.signalingState!=="stable")throw S.error("set remote answer error",n.toString()),new M(L.SET_ANSWER_FAILED,n.toString());S.debug("[pc-".concat(this.ID,"] ignore invalidstate error"))}}close(){this.onICEConnectionStateChange=void 0,this.onConnectionStateChange=void 0;try{this.pc.oniceconnectionstatechange=null,this.pc.onconnectionstatechange=null,this.pc.onsignalingstatechange=null,this.pc.onicecandidateerror=null,this.pc.onicecandidate=null,this.pc.close(),this.pc=null,this.audioTransceiver=void 0,this.videoTransceiver=void 0}catch{}this.statsFilter.destroy()}createPeerConnection(){const t={iceServers:[]},n=d=>{const h=[];return G(d).call(d,p=>{if(p.security){var A;p.tcpport&&h.push({username:p.username,credential:p.password,credentialType:"password",urls:O(A="turns:".concat((v=p.turnServerURL,v.match(/^[\.\:\d]+$/)?"".concat(v.replace(/[^\d]/g,"-"),".edge.agora.io"):(S.info("Cannot recognized as IP address ".concat(v,". Used As Host instead")),v)),":")).call(A,p.tcpport,"?transport=tcp")})}else{var m,E;p.udpport&&h.push({username:p.username,credential:p.password,credentialType:"password",urls:O(m="turn:".concat(p.turnServerURL,":")).call(m,p.udpport,"?transport=udp")}),p.tcpport&&h.push({username:p.username,credential:p.password,credentialType:"password",urls:O(E="turn:".concat(p.turnServerURL,":")).call(E,p.tcpport,"?transport=tcp")})}var v}),h};var s,c;this.spec.iceServers?t.iceServers=this.spec.iceServers:this.spec.turnServer&&this.spec.turnServer.mode!=="off"&&(Qh(this.spec.turnServer.servers)?t.iceServers=this.spec.turnServer.servers:(t.iceServers&&t.iceServers.push(...n(this.spec.turnServer.servers)),t.iceServers&&this.spec.turnServer.serversFromGateway&&t.iceServers.push(...n(this.spec.turnServer.serversFromGateway)),G(s=O(c=this.spec.turnServer.servers).call(c,this.spec.turnServer.serversFromGateway||[])).call(s,d=>{d.forceturn&&(t.iceTransportPolicy="relay")}))),ot("CHROME_FORCE_PLAN_B")&&cl()&&(t.sdpSemantics="plan-b",Dr().supportUnifiedPlan=!1),this.pc=new RTCPeerConnection(t,{optional:[{googDscp:!0}]}),this.pc.oniceconnectionstatechange=()=>{this.onICEConnectionStateChange&&this.onICEConnectionStateChange(this.pc.iceConnectionState)},this.pc.onconnectionstatechange=()=>{this.onConnectionStateChange&&this.onConnectionStateChange(this.pc.connectionState)},this.pc.onsignalingstatechange=()=>{this.pc&&this.pc.connectionState==="closed"&&this.onConnectionStateChange&&this.onConnectionStateChange(this.pc.connectionState)},this.pc.onicecandidate=d=>{if(!d.candidate)return this.pc.onicecandidate=null,this.allCandidateReceived=!0,void S.debug("[pc-".concat(this.ID,"] local candidate count"),this.localCandidateCount);this.localCandidateCount+=1},vn(()=>{this.allCandidateReceived||(this.allCandidateReceived=!0,S.debug("[pc-".concat(this.ID,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},ot("CANDIDATE_TIMEOUT"))}}class qL extends g1{constructor(t){super(t)}async setOfferSDP(t){const n=ot("CUSTOM_PUB_OFFER_MODIFIER");return n&&(t=n(t)),await super.setOfferSDP(t)}async setAnswerSDP(t){const n=ot("CUSTOM_PUB_ANSWER_MODIFIER");return n&&(t=n(t)),await super.setAnswerSDP(t)}getAnswerSDP(){return this.pc.remoteDescription}getOfferSDP(){return this.pc.localDescription}async addStream(t){const n=t.getTracks();for(const s of n)await this.addTrack(s)}async replaceTrack(t){var n;if(!Dr().supportReplaceTrack){const d=t.kind==="audio"?this.audioTrack:this.videoTrack;if(!d)throw new M(L.UNEXPECTED_ERROR,"can not find replaced track");return await this.removeTrack(d),await this.addTrack(t),!0}const s=this.getSender(t.kind),c=_t(n=this.mediaStream.getTracks()).call(n,d=>d.kind===t.kind);c&&this.mediaStream.removeTrack(c),this.mediaStream.addTrack(t);try{await s.replaceTrack(t),t.kind==="audio"?this.audioTrack=t:this.videoTrack=t}catch(d){throw new M(L.SENDER_REPLACE_FAILED,d.toString())}return!1}async removeTrack(t){const n=this.getSender(t.kind);this.mediaStream.removeTrack(t);try{const s=we();s.name==="Safari"&&s.version==="11"&&await n.replaceTrack(null),this.pc.removeTrack(n)}catch(s){S.warning("[pc-".concat(this.ID,"] remove track error, ignore"),s)}t.kind==="audio"?(this.audioTrack=null,this.audioSender=void 0,this.audioTransceiver&&(this.audioTransceiver.direction="inactive"),this.audioTransceiver=void 0):(this.videoTrack=null,this.videoSender=void 0,this.videoTransceiver&&(this.videoTransceiver.direction="inactive"),this.videoTransceiver=void 0)}onOfferSettled({videoActive:t,audioActive:n}){if(Gr())S.debug("firefox do not set sender parameter");else{if(this.audioSender){const s={networkQuality:void 0,active:!0};ot("DSCP_TYPE")&&(s.networkQuality=ot("DSCP_TYPE")),this.audioTrack&&(s.active=!!n),this.setAudioRtpEncodingParameters(s).catch(c=>{S.debug("set audio sender`s network priority failed")})}if(this.videoSender){const s={networkQuality:void 0,active:!0};ot("DSCP_TYPE")&&(s.networkQuality=ot("DSCP_TYPE")),this.videoTrack&&(s.active=!!t),this.setVideoRtpEncodingParameters(s).catch(c=>{S.debug("set video sender`s network priority failed")})}}}async addTrack(t){const n=Dr();if(t.kind==="audio"&&this.audioTrack||t.kind==="video"&&this.videoTrack)throw new M(L.UNEXPECTED_ERROR,"Can't add multiple stream");let s,c;this.mediaStream.addTrack(t),n.supportUnifiedPlan?(s=await async function(d,h,p){var A;const m=_t(A=d.getTransceivers()).call(A,E=>E.direction==="inactive"&&E.receiver.track.kind===h.kind);return m?(m.direction="sendrecv",await m.sender.replaceTrack(h),m):d.addTransceiver(h,{direction:"sendrecv",streams:[p]})}(this.pc,t,this.mediaStream),c=s.sender):c=this.pc.addTrack(t,this.mediaStream),t.kind==="audio"?(this.audioTrack=t,this.audioSender=c,this.audioTransceiver=s):(this.videoTrack=t,this.videoSender=c,this.videoTransceiver=s)}async setRtpSenderParameters(t,n){const s=this.videoSender||(this.videoTransceiver?this.videoTransceiver.sender:void 0);if(!s)return;const c=s.getParameters();c.degradationPreference=n;try{await s.setParameters(c)}catch(d){S.debug("[".concat(this.ID,"] ignore RtpSender.setParameters"),d.toString())}}async setVideoRtpEncodingParameters(t){const n=this.videoSender||(this.videoTransceiver?this.videoTransceiver.sender:void 0);if(!n)throw new M(L.LOW_STREAM_ENCODING_ERROR,"Low stream has no video sender.");const s=n.getParameters();if(!s.encodings||!s.encodings[0])throw new M(L.LOW_STREAM_ENCODING_ERROR,"Low stream RtpEncodingParameters is empty.");t.scaleResolutionDownBy&&(s.encodings[0].scaleResolutionDownBy=t.scaleResolutionDownBy),t.maxBitrate&&(s.encodings[0].maxBitrate=t.maxBitrate),t.maxFramerate&&(s.encodings[0].maxFramerate=t.maxFramerate),t.active!==void 0&&(S.debug("set video sender encoding active:",t.active),s.encodings[0].active=t.active);const c=["very-low","low","medium","high"];return t.networkPriority&&zt(c).call(c,t.networkPriority)&&(S.debug("set video sender network quality:",t.networkPriority),s.encodings[0].networkPriority=t.networkPriority),await n.setParameters(s),n.getParameters()}async setAudioRtpEncodingParameters(t){const n=this.audioSender||(this.audioTransceiver?this.audioTransceiver.sender:void 0);if(!n)throw new M(L.SET_ENCODING_PARAMETER_ERROR,"pc has no audio sender.");const s=n.getParameters();if(!s.encodings||!s.encodings[0])throw new M(L.SET_ENCODING_PARAMETER_ERROR,"pc RtpEncodingParameters is empty.");t.active!==void 0&&(S.debug("set audio sender encoding active:",t.active),s.encodings[0].active=t.active);const c=["very-low","low","medium","high"];return t.networkPriority&&zt(c).call(c,t.networkPriority)&&(S.debug("set audio sender network quality:",t.networkPriority),s.encodings[0].networkPriority=t.networkPriority),await n.setParameters(s),n.getParameters()}getSender(t){let n=null;if(Dr().supportUnifiedPlan){var s;const d=_t(s=this.pc.getTransceivers()).call(s,h=>h.sender.track&&h.sender.track.kind===t);n=d?d.sender:null}else{var c;n=_t(c=this.pc.getSenders()).call(c,d=>d.track&&d.track.kind===t)||null}if(!n)throw new M(L.SENDER_NOT_FOUND);return n}close(){this.audioSender=void 0,this.videoSender=void 0,super.close()}}class JL extends g1{constructor(t){super(t),this.statsFilter.onFirstAudioDecoded=()=>this.onFirstAudioDecoded&&this.onFirstAudioDecoded(),this.statsFilter.onFirstVideoDecoded=(n,s)=>this.onFirstVideoDecoded&&this.onFirstVideoDecoded(n,s),this.statsFilter.onFirstAudioReceived=()=>this.onFirstAudioReceived&&this.onFirstAudioReceived(),this.statsFilter.onFirstVideoReceived=()=>this.onFirstVideoReceived&&this.onFirstVideoReceived(),Dr().supportUnifiedPlan?(this.audioTransceiver=this.pc.addTransceiver("audio",{direction:"recvonly"}),this.videoTransceiver=this.pc.addTransceiver("video",{direction:"recvonly"})):this.offerOptions={offerToReceiveAudio:!0,offerToReceiveVideo:!0},this.pc.ontrack=n=>{n.track.kind==="audio"?this.audioTrack=n.track:this.videoTrack=n.track,this.onTrack&&this.onTrack(n.track,n.streams[0])}}async setOfferSDP(t){const n=ot("CUSTOM_SUB_OFFER_MODIFIER");return n&&(t=n(t)),await super.setOfferSDP(t)}async setAnswerSDP(t){const n=ot("CUSTOM_SUB_ANSWER_MODIFIER");return n&&(t=n(t)),await super.setAnswerSDP(t)}}let m1=1,E1=1;class _1 extends Hr{constructor(t,n){super(),this.startTime=pt(),this.createTime=pt(),this.readyToReconnect=!1,this._connectionState="disconnected",this.currentReconnectCount=0,this.ID=E1,E1+=1,this.joinInfo=t,this._userId=n,this.createPC()}get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this.emit(ae.CONNECTION_STATE_CHANGE,t,this._connectionState),this._connectionState=t)}get connectionId(){var t,n;return O(t=O(n="".concat(this.joinInfo.clientId,"-")).call(n,this.type?this.type:"sub(".concat(this._userId,")"),"-")).call(t,this.ID)}getUserId(){return this._userId}startUploadStats(){this.statsUploadInterval=window.setInterval(()=>{const t=this.pc.getStats();this.uploadStats(t,this.lastUploadPCStats),this.lastUploadPCStats=t},3e3),this.statsUploadSlowInterval=window.setInterval(()=>{const t=this.pc.getStats();this.uploadSlowStats(t)},6e4),this.relatedStatsUploadInterval=window.setInterval(()=>{const t=this.pc.getStats();this.uploadRelatedStats(t,this.lastRelatedPcStats),this.lastRelatedPcStats=t},1e3)}stopUploadStats(){this.statsUploadInterval&&window.clearInterval(this.statsUploadInterval),this.relatedStatsUploadInterval&&window.clearInterval(this.relatedStatsUploadInterval),this.statsUploadInterval=void 0,this.relatedStatsUploadInterval=void 0}createWaitConnectionConnectedPromise(){return new dt((t,n)=>{this.connectionState==="disconnected"?n():this.connectionState==="connected"?t():this.once(ae.CONNECTION_STATE_CHANGE,s=>{s==="connected"?t():n()})})}async reconnectPC(t){if(this.readyToReconnect=!1,t&&this.onPCDisconnected(t),this.currentReconnectCount>1/0)throw S.debug("[".concat(this.connectionId,"] cannot reconnect pc")),t||new M(Ze.UNEXPECTED_ERROR);if(this.stopUploadStats(),S.debug("[".concat(this.connectionId,"] start reconnect pc")),this.connectionState="connecting",this.currentReconnectCount+=1,await this.closePC())return S.debug("[".concat(this.connectionId,"] abort reconnect pc, wait ws")),void this.readyToReconnectPC();this.createPC(),await this.startP2PConnection(),this.currentReconnectCount=0}readyToReconnectPC(){this.stopUploadStats(),this.readyToReconnect=!0,this.pc.onICEConnectionStateChange=void 0,this.connectionState="connecting"}updateICEPromise(){this.removeAllListeners(ae.GATEWAY_P2P_LOST),this.icePromise=new dt((t,n)=>{let s=!0;this.pc.onICEConnectionStateChange=c=>{var d,h;S.info(O(d=O(h="[".concat(this.connectionId,"] ice-state: ")).call(h,this.type," p2p ")).call(d,c)),c==="connected"&&t(),c!=="failed"&&c!=="closed"||(s&&this.emit(ae.P2P_LOST),s=!1,this.reconnectPC(new M(Ze.ICE_FAILED)).catch(p=>{n(p)}))},this.pc.onConnectionStateChange=c=>{var d,h;S.info(O(d=O(h="[".concat(this.connectionId,"] connection-state: ")).call(h,this.type," p2p ")).call(d,c)),c!=="failed"&&c!=="closed"||(s&&this.emit(ae.P2P_LOST),s=!1,this.reconnectPC(new M(Ze.PC_CLOSED)).catch(p=>{n(p)}))},this.removeAllListeners(ae.GATEWAY_P2P_LOST),this.once(ae.GATEWAY_P2P_LOST,c=>{var d;if(this.pc.ID.toString()===c.toString()){if(S.info(O(d="[".concat(this.connectionId,"] ")).call(d,this.type," p2p gateway lost")),s&&this.emit(ae.P2P_LOST),s=!1,this.pc.allCandidateReceived&&this.pc.localCandidateCount===0)return this.disconnectedReason=new M(Ze.NO_ICE_CANDIDATE,"can not get candidate in this pc"),void this.closeP2PConnection(!0);this.reconnectPC(new M(Ze.GATEWAY_P2P_LOST)).catch(h=>{n(h)})}})})}}function v1(r,t){var n=le(r);if(ee){var s=ee(r);t&&(s=kt(s).call(s,function(c){return Wt(r,c).enumerable})),n.push.apply(n,s)}return n}function cu(r){for(var t=1;t<arguments.length;t++){var n,s=arguments[t]!=null?arguments[t]:{};if(t%2)G(n=v1(Object(s),!0)).call(n,function(d){_r(r,d,s[d])});else if(te)He(r,te(s));else{var c;G(c=v1(Object(s))).call(c,function(d){se(r,d,Wt(s,d))})}}return r}var To=function(r,t,n,s){var c,d=arguments.length,h=d<3?t:s===null?s=Wt(t,n):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(r,t,n,s);else for(var p=r.length-1;p>=0;p--)(c=r[p])&&(h=(d<3?c(h):d>3?c(t,n,h):c(t,n))||h);return d>3&&h&&se(t,n,h),h},je=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)};class Qr extends Mp{constructor(t,n,s,c,d){super(t,d),this.trackMediaType="video",this._scalabiltyMode={numSpatialLayers:1,numTemporalLayers:1},this._enabled=!0,this.updateMediaStreamTrackResolution(),this._encoderConfig=n,this._scalabiltyMode=s,this._optimizationMode=c}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Op.PLAYING)}play(t,n={}){const s=bt.reportApiInvoke(null,{tag:Zt.TRACER,name:de.LOCAL_VIDEO_TRACK_PLAY,options:[this.getTrackId(),typeof t=="string"?t:"HTMLElement",n]});if(!(t instanceof HTMLElement)){const h=document.getElementById(t.toString());var c;h?t=h:(S.warning(O(c="[".concat(this.getTrackId(),'] can not find "#')).call(c,t,'" element, use document.body')),t=document.body)}S.debug("[".concat(this.getTrackId(),"] start video playback"),ht(n));const d=cu({},this._getDefaultPlayerConfig(),{},n,{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(d):(this._player=new _p(d),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),s.onSuccess()}stop(){const t=bt.reportApiInvoke(null,{tag:Zt.TRACER,name:de.LOCAL_VIDEO_TRACK_STOP,options:[this.getTrackId()]});if(!this._player)return t.onSuccess();this._player.destroy(),this._player=void 0,S.debug("[".concat(this.getTrackId(),"] stop video playback")),t.onSuccess()}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}S.info("[".concat(this.getTrackId(),"] start setEnabled"),t);const s=await this._enabledMutex.lock();if(!t){this._originMediaStreamTrack.enabled=!1;try{await Xe(this,he.NEED_REMOVE_TRACK,this)}catch(c){throw S.error("[".concat(this.getTrackId(),"] setEnabled to false error"),c.toString()),s(),c}return n||(this._enabled=!1),S.info("[".concat(this.getTrackId(),"] setEnabled to false success")),s()}this._originMediaStreamTrack.enabled=!0;try{await Xe(this,he.NEED_ADD_TRACK,this)}catch(c){throw S.error("[".concat(this.getTrackId(),"] setEnabled to true error"),c.toString()),s(),c}S.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0),s()}async setMuted(t){var n;if(t!==this._muted){if(this.stateCheck("muted",t),this._muted=t,we().name===Dl.FIREFOX)return S.debug("[".concat(this.getTrackId(),"] firefox set mute fallback to set enabled")),void await this.setEnabled(!t,!0);this._mediaStreamTrack.enabled=!t,S.debug(O(n="[".concat(this.getTrackId(),"] start set muted: ")).call(n,t)),await Xe(this,he.SET_VIDEO_TRACK_MUTED,{track:this,muted:t})}}getStats(){return ks(()=>{S.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Io(this,he.GET_STATS)||cu({},jT)}async setBeautyEffect(t,n={}){const s=bt.reportApiInvoke(null,{tag:Zt.TRACER,name:de.LOCAL_VIDEO_TRACK_BEAUTY,options:[this.getTrackId(),t,n]});if(t||this._videoBeautyProcessor){if(Nh()===Np.IOS||Nh()===Np.ANDROID){const c=new M(L.INVALID_OPERATION,"can not enable beauty effect on mobile device");throw s.onError(c),c}if(!this._enabled&&t){const c=new M(L.TRACK_IS_DISABLED,"can not enable beauty effect when track is disabled");throw s.onError(c),c}S.info("[".concat(this.getTrackId(),"] start setBeautyEffect"),t,ht(n));try{this._videoBeautyProcessor?await this._videoBeautyProcessor.setBeautyEffectOptions(t,n):(this._videoBeautyProcessor=new Wy,this._videoBeautyProcessor.onOverload=()=>{on(()=>this.emit(Pl.BEAUTY_EFFECT_OVERLOAD))},await this._videoBeautyProcessor.setBeautyEffectOptions(t,n),await this._registerTrackProcessor(this._videoBeautyProcessor))}catch(c){throw S.error("[".concat(this.getTrackId(),"] setBeautyEffect error"),c.toString()),s.onError(c),c}S.info("[".concat(this.getTrackId(),"] setBeautyEffect success")),s.onSuccess()}}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}clone(t,n,s,c){const d=this._mediaStreamTrack.clone();return new Qr(d,t,n,s,c)}async setBitrateLimit(t){var n;if(S.debug(O(n="[".concat(this.getTrackId(),"] set bitrate limit, ")).call(n,ht(t))),t){this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate);try{await Xe(this,he.NEED_RESET_REMOTE_SDP)}catch(s){return s.throw()}}}async setOptimizationMode(t){var n;if(t==="motion"||t==="detail"||t==="balanced"){try{this._optimizationMode=t,await Xe(this,he.SET_OPTIMIZATION_MODE,t)}catch(s){throw S.error("[".concat(this.getTrackId(),"] set optimization mode failed"),s.toString()),s}S.info(O(n="[".concat(this.getTrackId(),"] set optimization mode success (")).call(n,t,")"))}else S.error(L.INVALID_PARAMS,"optimization mode must be motion, detail or balanced")}setScalabiltyMode(t){var n;if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return S.error(L.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabiltyMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabiltyMode=t,S.info(O(n="[".concat(this.getTrackId(),"] set scalability mode success (")).call(n,t,")"))}updateMediaStreamTrackResolution(){ep(this._originMediaStreamTrack).then(([t,n])=>{this._videoHeight=n,this._videoWidth=t}).catch(Cl)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async renewMediaStreamTrack(){}}To([Fr(),je("design:type",Function),je("design:paramtypes",[Object,Object]),je("design:returntype",void 0)],Qr.prototype,"play",null),To([Fr(),je("design:type",Function),je("design:paramtypes",[Boolean,Boolean]),je("design:returntype",dt)],Qr.prototype,"setEnabled",null),To([Fr(),zT({report:bt}),je("design:type",Function),je("design:paramtypes",[Boolean]),je("design:returntype",dt)],Qr.prototype,"setMuted",null),To([Fr(),je("design:type",Function),je("design:paramtypes",[]),je("design:returntype",Object)],Qr.prototype,"getStats",null),To([Fr(),je("design:type",Function),je("design:paramtypes",[Boolean,Object]),je("design:returntype",dt)],Qr.prototype,"setBeautyEffect",null),To([Fr(),je("design:type",Function),je("design:paramtypes",[]),je("design:returntype",ImageData)],Qr.prototype,"getCurrentFrameData",null),To([Fr(),je("design:type",Function),je("design:paramtypes",[Object]),je("design:returntype",dt)],Qr.prototype,"setBitrateLimit",null),To([Fr(),je("design:type",Function),je("design:paramtypes",[String]),je("design:returntype",dt)],Qr.prototype,"setOptimizationMode",null),To([Fr(),je("design:type",Function),je("design:paramtypes",[Object]),je("design:returntype",void 0)],Qr.prototype,"setScalabiltyMode",null),To([Fr(),je("design:type",Function),je("design:paramtypes",[]),je("design:returntype",void 0)],Qr.prototype,"updateMediaStreamTrackResolution",null);class lu extends Qr{constructor(t,n,s,c,d,h){super(t,n.encoderConfig?cs(n.encoderConfig):{},c,d,h),this._enabled=!0,this._deviceName="default",this.tryResumeVideoForIOS15WeChat=async()=>{ia()&&Oh()&&this._mediaStreamTrack.muted&&this._enabled&&!this._isClosed&&(S.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.setEnabled(!1),await this.setEnabled(!0))},this._config=n,this._constraints=s,this._deviceName=t.label,this._config.encoderConfig&&(this._encoderConfig=cs(this._config.encoderConfig)),ue.on(Lr.IOS_15_INTERRUPTION_END,this.tryResumeVideoForIOS15WeChat)}async setDevice(t){var n;const s=bt.reportApiInvoke(null,{tag:Zt.TRACER,name:de.CAM_VIDEO_TRACK_SET_DEVICE,options:[this.getTrackId(),t]});if(S.info(O(n="[".concat(this.getTrackId(),"] set device to ")).call(n,t)),this._enabled)try{const c=await gn.getDeviceById(t),d={};d.video=cu({},this._constraints),d.video.deviceId={exact:t},d.video.facingMode=void 0,this._originMediaStreamTrack.stop();let h=null;try{h=await nn(d,this.getTrackId())}catch(p){throw S.error("[".concat(this.getTrackId(),"] setDevice failed"),p.toString()),h=await nn({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(h.getVideoTracks()[0],!1),p}await this._updateOriginMediaStreamTrack(h.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=c.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(c){throw s.onError(c),S.error("[".concat(this.getTrackId(),"] setDevice error"),c.toString()),c}else try{const c=await gn.getDeviceById(t);this._deviceName=c.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(c){throw s.onError(c),S.error("[".concat(this.getTrackId(),"] setDevice error"),c.toString()),c}S.info("[".concat(this.getTrackId(),"] setDevice success")),s.onSuccess()}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}S.info("[".concat(this.getTrackId(),"] start setEnabled"),t);const s=await this._enabledMutex.lock();if(!t){this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),n||(this._enabled=!1);try{await Xe(this,he.NEED_REMOVE_TRACK,this)}catch(h){throw S.error("[".concat(this.getTrackId(),"] setEnabled to false error"),h.toString()),s(),h}return S.info("[".concat(this.getTrackId(),"] setEnabled to false success")),s()}const c=cu({},this._constraints),d=gn.searchDeviceIdByName(this._deviceName);d&&!c.deviceId&&(c.deviceId={exact:d});try{const h=await nn({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getVideoTracks()[0],!1),await Xe(this,he.NEED_ADD_TRACK,this)}catch(h){throw S.error("[".concat(this.getTrackId(),"] setEnabled true error"),h.toString()),s(),h}this.updateMediaStreamTrackResolution(),S.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0),s()}async setEncoderConfiguration(t,n){const s=bt.reportApiInvoke(null,{tag:Zt.TRACER,name:de.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG,options:[this.getTrackId(),t]});if(!this._enabled){const h=new M(L.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");throw s.onError(h),h}t=cs(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin);const c=wn(this._config);c.encoderConfig=t;const d=wl(c);S.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),ht(t),ht(d));try{await this._originMediaStreamTrack.applyConstraints(d),this.updateMediaStreamTrackResolution()}catch(h){const p=new M(L.UNEXPECTED_ERROR,h.toString());throw S.error("[".concat(this.getTrackId(),"] applyConstraints error"),p.toString()),s.onError(p),p}this._config=c,this._constraints=d,this._encoderConfig=t;try{await Xe(this,he.NEED_RENEGOTIATE)}catch(h){return s.onError(h),h.throw()}s.onSuccess()}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((vi()||as())&&this._enabled&&!this._isClosed&&ue.duringInterruption){const t=async()=>{ue.off(Lr.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(S.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};ue.on(Lr.IOS_INTERRUPTION_END,t)}else S.debug("[".concat(this.getTrackId(),"] track ended")),this.emit(Pl.TRACK_ENDED)}async renewMediaStreamTrack(){const t=cu({},this._constraints),n=gn.searchDeviceIdByName(this._deviceName);n&&!t.deviceId&&(t.deviceId={exact:n});const s=await nn({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}close(){super.close(),ue.off(Lr.IOS_15_INTERRUPTION_END,this.tryResumeVideoForIOS15WeChat)}}function um(r,t){const n=r.match(/a=rtpmap:(\d+) opus/);if(!n||!n[0]||!n[1])return r;const s=n[1],c=r.match("a=fmtp:".concat(s,`.*\r
`));if(!c||!c[0])return r;let d="a=fmtp:".concat(s," minptime=10;useinbandfec=1;");var h;return t.bitrate&&!Gr()&&(d+="maxaveragebitrate=".concat(Math.floor(1e3*t.bitrate),";")),t.sampleRate&&(d+=O(h="maxplaybackrate=".concat(t.sampleRate,";sprop-maxcapturerate=")).call(h,t.sampleRate,";")),t.stereo&&(d+="stereo=1;sprop-stereo-1;"),d+=`\r
`,r=r.replace(c[0],d)}function I1(r){return r.replace("minptime=10","minptime=10;stereo=1;sprop-stereo=1")}function C1(r,t,n){let s=!1;switch(t){case"h264":return r;case"vp8":if(!ot("SIMULCAST"))return r;s=!0,n&&(n.numSpatialLayers=2);case"vp9":s=!0;case"av1":s=!0}if(s){var c;const V=Mr(c=RegExp.prototype.test).call(c,/^([a-z])=(.*)/),j=r.split("m=");let st,mt,Et=null,At=null,$=null,rt=[],W=[],H=[],U=[],Tt=null,It=null,Ct=0;const Ut=[],Y=[];for(let tt=0;tt<j.length;++tt)if(Et=j[tt].match(/a=msid-semantic:/),Et){Et=j[tt];break}for(let tt=0;tt<j.length;++tt)if(At=j[tt].match(/audio /),At){st=tt,At="m="+j[tt];break}for(let tt=0;tt<j.length;++tt)if($=j[tt].match(/video /),$){mt=tt,$="m="+j[tt];break}var d,h;if(Et&&(rt=kt(d=Et.split(/(\r\n|\r|\n)/)).call(d,V)),rt.length>0&&(U=O(U).call(U,rt)),At&&(W=kt(h=At.split(/(\r\n|\r|\n)/)).call(h,V)),!$)return r;{var p;H=kt(p=$.split(/(\r\n|\r|\n)/)).call(p,V);for(let at=0;at<H.length;++at)if(Tt===null&&(Tt=H[at].match(/cname:/),Tt!==null)){Tt="cname:"+H[at].split("cname:")[1];break}for(let at=0;at<H.length;++at)if(It===null&&(It=H[at].match(/a=msid:/),It!==null&&(It="msid:"+H[at].split(":")[1])),H[at].match(/a=ssrc-group:FID/)){const Lt=H[at].split(" ");Ct=at,Ut.push(Number(Lt[1])),Lt[2]&&Y.push(Number(Lt[2])),H.length=Ct;break}for(let at=1;at<n.numSpatialLayers;++at)Ut.push(Ut[0]+at),Y.length>0&&Y.push(Y[0]+at);let tt="a=ssrc-group:SIM ";const vt="a=ssrc-group:FID ";for(let at=0;at<Ut.length;++at)tt=O(tt).call(tt,String(Ut[at])),at<Ut.length-1&&(tt=O(tt).call(tt," "));H.push(tt);for(let at=0;at<n.numSpatialLayers;++at){var A,m;const Lt=O(A=O(m=O(vt).call(vt,String(Ut[at]))).call(m," ")).call(A,String(Y[at]));H.push(Lt)}for(let at=0;at<n.numSpatialLayers;++at){var E,v,C,b;if(Tt===null||It===null)return r;const Lt=O(E=O(v="a=ssrc:".concat(String(Ut[at]))).call(v," ")).call(E,Tt),lt=O(C=O(b="a=ssrc:".concat(String(Ut[at]))).call(b," ")).call(C,It);H.push(Lt),H.push(lt)}for(let at=0;at<n.numSpatialLayers;++at){var y,w,k,P;if(Tt===null||It===null)return r;const Lt=O(y=O(w="a=ssrc:".concat(String(Y[at]))).call(w," ")).call(y,Tt),lt=O(k=O(P="a=ssrc:".concat(String(Y[at]))).call(P," ")).call(k,It);H.push(Lt),H.push(lt)}}st&&mt&&st>mt?(U=O(U).call(U,H),U=O(U).call(U,W)):(U=O(U).call(U,W),U=O(U).call(U,H)),r=U.join(`\r
`)+`\r
`}return r}To([Fr(),je("design:type",Function),je("design:paramtypes",[String]),je("design:returntype",dt)],lu.prototype,"setDevice",null),To([Fr(),je("design:type",Function),je("design:paramtypes",[Boolean,Boolean]),je("design:returntype",dt)],lu.prototype,"setEnabled",null),To([Fr(),je("design:type",Function),je("design:paramtypes",[Object,Boolean]),je("design:returntype",dt)],lu.prototype,"setEncoderConfiguration",null);const S1=(r,t)=>{let n=null;if(t==="h264"?n=r.match(/a=rtpmap:(\d+) H264.*\r\n/)||r.match(/a=rtpmap:(\d+) H264.*\n/):t==="vp8"?n=r.match(/a=rtpmap:(\d+) VP8.*\r\n/)||r.match(/a=rtpmap:(\d+) VP8.*\n/):t==="vp9"?n=r.match(/a=rtpmap:(\d+) VP9.*\r\n/)||r.match(/a=rtpmap:(\d+) VP9.*\n/):t==="av1"&&(n=r.match(/a=rtpmap:(\d+) AV1.*\r\n/)||r.match(/a=rtpmap:(\d+) AV1.*\n/)),n&&n[1])return n[1]};function hm(r,t){const n=(c,d)=>{const h=S1(c,d);return h?n(s(c,h),d):c},s=(c,d)=>{var h,p;const A=Mr(h=RegExp.prototype.test).call(h,/^([a-z])=(.*)/),m=["a=rtpmap:".concat(d),"a=rtcp-fb:".concat(d),"a=fmtp:".concat(d)],E=kt(p=c.split(/(\r\n|\r|\n)/)).call(p,A),v=[];G(E).call(E,(w,k)=>{G(m).call(m,P=>{zt(w).call(w,P)&&v.push(k)})});const C=ti(E).call(E,w=>zt(w).call(w,"apt=".concat(d)));let b;if(C){v.push(C,C-1);const w=E[C-1].match(/a=rtpmap:(\d+) rtx.*/);b=w&&w[1]}G(v).call(v,w=>{E[w]=""});const y=ti(E).call(E,w=>zt(w).call(w,"m=video"));return E[y]=E[y].replace(" ".concat(d),""),b&&(E[y]=E[y].replace(" ".concat(b),"")),kt(E).call(E,w=>!!w).join(`\r
`)+`\r
`};return G(t).call(t,c=>{r=n(r,c)}),r}function y1(r,t){var n=le(r);if(ee){var s=ee(r);t&&(s=kt(s).call(s,function(c){return Wt(r,c).enumerable})),n.push.apply(n,s)}return n}function T1(r){for(var t=1;t<arguments.length;t++){var n,s=arguments[t]!=null?arguments[t]:{};if(t%2)G(n=y1(Object(s),!0)).call(n,function(d){_r(r,d,s[d])});else if(te)He(r,te(s));else{var c;G(c=y1(Object(s))).call(c,function(d){se(r,d,Wt(s,d))})}}return r}class R1 extends _1{constructor(t,n,s,c){super(n,n.stringUid||n.uid),this.suspendTracks=[],this.type="pub",this.detecting=!1,this._waitingSuccessResponse=!1,this.handleMuteVideoTrack=({track:d,muted:h},p,A)=>{this.setVideoTrackMuteState(h).then(p).catch(A)},this.handleMuteAudioTrack=({track:d,muted:h},p,A)=>{this.setAudioTrackMuteState(h,d).then(p).catch(A)},this.renegotiateWithGateway=async()=>(S.debug("[pc-".concat(this.pc.ID,"] renegotiate start")),new dt(async(d,h)=>{this.connectionState="connecting";const p=v=>{v==="connected"&&(this.off(ae.CONNECTION_STATE_CHANGE,p),d()),v==="disconnected"&&(this.off(ae.CONNECTION_STATE_CHANGE,p),h(new M(Ze.OPERATION_ABORTED,"renegotiate abort")))};this.on(ae.CONNECTION_STATE_CHANGE,p),Gr()&&ot("SIMULCAST")&&this.videoTrack&&this.videoTrack._scalabiltyMode&&await this.addSimulcast4Firefox(this.videoTrack._scalabiltyMode);let A=await this.pc.createOfferSDP();if(this.audioTrack&&this.audioTrack._encoderConfig&&(A=um(A,this.audioTrack._encoderConfig)),this.videoTrack&&this.videoTrack._scalabiltyMode&&(this.codec!=="vp9"&&this.codec!=="vp8"?(this.videoTrack._scalabiltyMode.numSpatialLayers=1,this.videoTrack._scalabiltyMode.numTemporalLayers=1):(this.videoTrack._scalabiltyMode.numSpatialLayers>1||this.videoTrack._scalabiltyMode.numTemporalLayers>1)&&(A=C1(A,this.codec,this.videoTrack._scalabiltyMode)),S.debug("renegoation spatial layers: ",this.videoTrack._scalabiltyMode.numSpatialLayers)),await this.pc.setOfferSDP(A),this.audioTrack instanceof ci){const v={videoActive:this.videoTrack&&!this.videoTrack.muted,audioActive:this.audioTrack&&this.audioTrack.isActive};this.pc.onOfferSettled(v)}const m=await xr(this,ae.NEED_RENEGOTIATE,A);this.videoTrack&&!Gr()&&ot("SIMULCAST")&&this.videoTrack._scalabiltyMode&&this.setSimulcastVideoRtpEncodingParameters(this.videoTrack._scalabiltyMode);const E=function(v,C){var b,y,w;const k=Mr(b=RegExp.prototype.test).call(b,/^([a-z])=(.*)/),P=kt(y=v.split(/(\r\n|\r|\n)/)).call(y,k),V=kt(w=C.split(/(\r\n|\r|\n)/)).call(w,k);let j=null;const st=new re;return G(P).call(P,mt=>{const Et=mt.match(/m=(audio|video)/);if(Et&&Et[1])return void(j=Et[1]);if(!j)return;const At=mt.match(/\=(sendrecv|recvonly|sendonly|inactive)/);At&&At[1]&&st.set(j,At[1])}),j=null,ft(V).call(V,mt=>{const Et=mt.match(/m=(audio|video)/);if(Et&&Et[1])return j=Et[1],mt;if(!j)return mt;const At=mt.match(/\=(sendrecv|recvonly|sendonly|inactive)/);if(At&&At[1]){const $=st.get(j);if($&&$!==At[1])return mt.replace(At[1],$)}return mt}).join(`\r
`)+`\r
`}(A,this.updateAnswerSDP(m.sdp));await this.pc.setAnswerSDP(E),S.debug("[pc-".concat(this.pc.ID,"] renegotiate success")),this.connectionState="connected"})),this.handleStreamRenegotiate=(d,h)=>{this.connectionState==="connected"?this.renegotiateWithGateway().then(d).catch(h):d()},this.handleReplaceTrack=(d,h,p)=>{if(this.audioTrack instanceof ci&&d.kind==="audio")return h();this.pc.replaceTrack(d).then(A=>A?this.renegotiateWithGateway():dt.resolve()).then(h).catch(p)},this.handleCloseAudioTrack=d=>{},this.handleCloseVideoTrack=()=>{this.lowStreamConnection&&this.lowStreamConnection.videoTrack&&this.lowStreamConnection.videoTrack.close()},this.handleGetSessionID=d=>{d(this.joinInfo.sid)},this.handleGetLocalVideoStats=d=>{d(this.statsCollector.getLocalVideoTrackStats(this.connectionId))},this.handleGetLocalAudioStats=d=>{d(this.statsCollector.getLocalAudioTrackStats(this.connectionId))},this.handleSetOptimizationMode=(d,h,p)=>{this.videoTrack&&this.setRtpSenderParametersByTrackConfig(this.videoTrack).then(h).catch(p)},this.isLowStreamConnection=!!c,this.codec=s,this.statsCollector=t,this.statsCollector.addLocalConnection(this)}getAllTracks(){let t=[];return this.videoTrack&&t.push(this.videoTrack),this.audioTrack&&this.audioTrack instanceof ci?t=O(t).call(t,this.audioTrack.trackList):this.audioTrack&&t.push(this.audioTrack),t.push(...this.suspendTracks),t}async addTracks(t){const n=Dr();if(this.connectionState==="connecting")try{return await this.createWaitConnectionConnectedPromise(),await this.addTracks(t)}catch{throw new M(Ze.OPERATION_ABORTED,"publish abort")}let s=!1;const c=this.getAllTracks();t=rp(t=kt(t).call(t,d=>Ft(c).call(c,d)===-1));for(let d=0;d<t.length;d+=1){const h=t[d];if(!(h instanceof Mp))return new M(Ze.INVALID_LOCAL_TRACK).throw();if(h instanceof Qr&&this.disabledVideoTrack){if(this.disabledVideoTrack!==h)return new M(Ze.EXIST_DISABLED_VIDEO_TRACK).throw();this.disabledVideoTrack=void 0}if(h instanceof Qr&&this.videoTrack)return new M(Ze.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw();if(h instanceof xn){if(this.audioTrack&&this.audioTrack._bypassWebAudio)throw S.error("One of the audio track was created with config bypassWebAudio set to true, there is no way to publish multiple audio tracks."),new M(Ze.CAN_NOT_PUBLISH_MULTIPLE_AUDIO_TRACKS);if(this.audioTrack instanceof ci)this.audioTrack.trackList.length===0&&await this.pc.setAudioRtpEncodingParameters({active:!0}),this.audioTrack.addAudioTrack(h);else if(n.webAudioMediaStreamDest)if(h._bypassWebAudio){if(this.audioTrack)throw S.error("Can not publish another audio track with bypassWebAudio set to true."),new M(Ze.CAN_NOT_PUBLISH_MULTIPLE_AUDIO_TRACKS);S.debug("[".concat(this.connectionId,"] audio track doesn't not pass through WebAudio, use original audio track to publish")),s=await this.addTrackWithPC(h)}else{const p=new ci;h.muted?this.suspendTracks.push(h):p.addAudioTrack(h),s=await this.addTrackWithPC(p)}else S.debug("[".concat(this.connectionId,"] your browser does not support mixing track, use original audio track to publish")),s=await this.addTrackWithPC(h)}else if(h instanceof Qr&&this.isLowStreamConnection){const p=T1({},{width:160,height:120,framerate:15,bitrate:50},{},this.lowStreamParameter);let A;if(n.supportDualStreamEncoding)S.debug("[".concat(this.connectionId,"] creating low stream using rtp encoding.")),this.lowStreamEncoding=FL(p,h),A=h.clone({bitrateMax:p.bitrate,bitrateMin:p.bitrate});else{S.debug("[".concat(this.connectionId,"] creating low stream using canvas."));const m=_T(h,p);A=new Qr(m,{bitrateMax:p.bitrate,bitrateMin:p.bitrate})}A._hints.push(Bs.LOW_STREAM),s=await this.addTrackWithPC(A),this.bindTrackEvents(A)}else this.detecting=!0,vn(()=>{this.detecting=!1},8e3),s=await this.addTrackWithPC(h)}await this.updateControlMessage(),s&&await this.renegotiateWithGateway(),G(t).call(t,d=>this.bindTrackEvents(d))}async removeTracks(t,n){const s=this.getAllTracks();t=rp(t=kt(t).call(t,h=>Ft(s).call(s,h)!==-1||h===this.disabledVideoTrack));const c=[];for(let h=0;h<t.length;h+=1){const p=t[h];if(this.unbindTrackEvents(p),this.audioTrack instanceof ci&&p instanceof xn)this.audioTrack.removeAudioTrack(p),da(this.suspendTracks,p),this.audioTrack.trackList.length===0&&(c.push(this.audioTrack),this.audioTrack=void 0);else if(p instanceof xn)c.push(p),this.audioTrack=void 0;else if(p instanceof Qr){if(n){if(this.disabledVideoTrack===p)return void(this.disabledVideoTrack=void 0)}else this.disabledVideoTrack=this.videoTrack;c.push(p),this.isLowStreamConnection&&p.close(),this.videoTrack=void 0}}if(this.videoTrack||this.audioTrack){if(c.length===0)return;if(this.connectionState==="connecting")try{await this.createWaitConnectionConnectedPromise()}catch{return}for(const h of c){var d;S.debug(O(d="[".concat(this.connectionId,"] remove ")).call(d,h.trackMediaType," from pc")),await this.pc.removeTrack(h._mediaStreamTrack);const p=we();p.name==="Safari"&&p.version==="11"&&await h.renewMediaStreamTrack()}await this.renegotiateWithGateway()}else await this.closeP2PConnection()}async updateControlMessage(){this.audioTrack instanceof ci&&this.connectionState==="connected"&&(this.audioTrack&&await xr(this,ae.NEED_CONTROL,{type:"audio",muted:!this.audioTrack.isActive}),this.videoTrack&&await xr(this,ae.NEED_CONTROL,{type:"video",muted:this.videoTrack.muted}))}async setSimulcastVideoRtpEncodingParameters(t){const n=this.pc.getSender("video");if(!n)throw new M(Ze.LOW_STREAM_ENCODING_ERROR,"Low stream has no video sender.");const s=n.getParameters();if(!s.encodings||!s.encodings[0])throw new M(Ze.LOW_STREAM_ENCODING_ERROR,"Low stream RtpEncodingParameters is empty.");if(this.videoTrack&&this.videoTrack._encoderConfig&&this.videoTrack._encoderConfig.bitrateMax&&this.videoTrack._encoderConfig.bitrateMax>200&&t.numSpatialLayers>1){const c={high:1e3*(this.videoTrack._encoderConfig.bitrateMax-50),medium:5e4};s.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:c.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:c.medium,scaleResolutionDownBy:4}]}await n.setParameters(s)}startP2PConnection(){return new dt(async(t,n)=>{if(!this.audioTrack&&!this.videoTrack)return n(new M(Ze.UNEXPECTED_ERROR,"no track to publish"));const s=d=>{if(d==="connected"&&(this.off(ae.CONNECTION_STATE_CHANGE,s),t()),d==="disconnected"){if(this.off(ae.CONNECTION_STATE_CHANGE,s),this.disconnectedReason)return n(this.disconnectedReason);n(new M(Ze.OPERATION_ABORTED,"publish abort"))}};this.on(ae.CONNECTION_STATE_CHANGE,s),this.disconnectedReason=void 0,this.connectionState="connecting",this._waitingSuccessResponse=!0,this.startTime=pt();try{var c;!this.pc.audioTrack&&this.audioTrack&&await this.pc.addTrack(this.audioTrack._mediaStreamTrack),!this.pc.videoTrack&&this.videoTrack&&await this.pc.addTrack(this.videoTrack._mediaStreamTrack),Gr()&&ot("SIMULCAST")&&this.videoTrack&&this.videoTrack._scalabiltyMode&&await this.addSimulcast4Firefox(this.videoTrack._scalabiltyMode);let d=await this.pc.createOfferSDP();ot("REMOVE_NEW_CODECS")&&(d=this.codec==="vp9"?hm(d,["av1"]):this.codec==="av1"?hm(d,["vp9"]):hm(d,["vp9","av1"]));const h=function(E){const v={video:[],audio:[]};return E.match(/ VP8/i)&&v.video.push("VP8"),E.match(/ VP9/i)&&v.video.push("VP9"),E.match(/ AV1X/i)&&v.video.push("AV1"),E.match(/ H264/i)&&v.video.push("H264"),E.match(/ opus/i)&&v.audio.push("OPUS"),v}(d);if(this.videoTrack&&!zt(c=h.video).call(c,this.codec.toUpperCase())&&S.warning("current codec is not supported, support list: ".concat(h.video.join(","))),this.audioTrack&&this.audioTrack._encoderConfig&&(d=um(d,this.audioTrack._encoderConfig)),this.videoTrack&&!Gr()&&this.videoTrack._scalabiltyMode&&(this.codec!=="vp9"&&this.codec!=="vp8"?(this.videoTrack._scalabiltyMode.numSpatialLayers=1,this.videoTrack._scalabiltyMode.numTemporalLayers=1):(this.videoTrack._scalabiltyMode.numSpatialLayers>1||this.videoTrack._scalabiltyMode.numTemporalLayers>1)&&(d=C1(d,this.codec,this.videoTrack._scalabiltyMode)),S.debug("spatial layers: ",this.videoTrack._scalabiltyMode.numSpatialLayers)),await this.pc.setOfferSDP(d),this.audioTrack instanceof ci){const E={videoActive:this.videoTrack&&!this.videoTrack.muted,audioActive:this.audioTrack&&this.audioTrack.isActive};this.pc.onOfferSettled(E)}this.videoTrack&&this.setRtpSenderParametersByTrackConfig(this.videoTrack),S.debug("[".concat(this.connectionId,"] create and set offer success"));const p={messageType:"OFFER",sdp:d,offererSessionId:104,retry:!0};Dr().supportDualStreamEncoding&&this.isLowStreamConnection&&this.lowStreamEncoding&&this.videoTrack&&await this.setLowStreamEncoding(this.lowStreamEncoding,this.videoTrack),this.videoTrack&&!Gr()&&ot("SIMULCAST")&&this.videoTrack._scalabiltyMode&&this.setSimulcastVideoRtpEncodingParameters(this.videoTrack._scalabiltyMode);const A=await xr(this,ae.NEED_ANSWER,p),m=this.updateAnswerSDP(A.sdp);await this.pc.setAnswerSDP(m),S.debug("[".concat(this.connectionId,"] set answer success")),await this.icePromise,this.connectionState="connected",this.startUploadStats()}catch(d){this.off(ae.CONNECTION_STATE_CHANGE,s),this.connectionState="disconnected",this.reportPublishEvent(!1,d.code),S.error("[".concat(this.connectionId,"] connection error"),d.toString()),n(d)}})}reportPublishEvent(t,n,s){var c;this._waitingSuccessResponse=!1,bt.publish(this.joinInfo.sid,{lts:this.startTime,succ:t,ec:n,audioName:this.audioTrack&&(this.audioTrack instanceof ci?this.audioTrack.getSubTrackLabels().join(","):this.audioTrack.getTrackLabel()),videoName:this.videoTrack&&this.videoTrack.getTrackLabel(),screenshare:!(!this.videoTrack||Ft(c=this.videoTrack._hints).call(c,Bs.SCREEN_TRACK)===-1),audio:!!this.audioTrack,video:!!this.videoTrack,p2pid:this.pc.ID,publishRequestid:this.ID,extend:s})}async closeP2PConnection(t){const n=this.getAllTracks();var s;G(n).call(n,c=>{this.unbindTrackEvents(c)}),this.isLowStreamConnection&&this.videoTrack&&this.videoTrack.close(),this.videoTrack=void 0,this.audioTrack instanceof ci&&(G(s=this.audioTrack.trackList).call(s,c=>{this.audioTrack.removeAudioTrack(c)}),this.audioTrack.close()),this.audioTrack=void 0,this.stopUploadStats(),this.statsCollector.removeConnection(this.connectionId),await this.closePC(t),this.connectionState="disconnected",this.removeAllListeners()}getNetworkQuality(){var t;const n=this.pc.getStats();if(!n.videoSend[0]&&!n.audioSend[0])return 1;const s=Io(this,ae.NEED_SIGNAL_RTT),c=n.videoSend[0]?n.videoSend[0].rttMs:void 0,d=n.audioSend[0]?n.audioSend[0].rttMs:void 0,h=c&&d?(c+d)/2:c||d,p=(h&&s?(h+s)/2:h||s)||0,A=100*n.sendPacketLossRate*.7/50+.3*p/1500,m=A<.17?1:A<.36?2:A<.59?3:A<.1?4:5;if(this.videoTrack&&this.videoTrack._encoderConfig&&Ft(t=this.videoTrack._hints).call(t,Bs.SCREEN_TRACK)===-1){const E=this.videoTrack._encoderConfig.bitrateMax,v=n.bitrate.actualEncoded;if(E&&v){const C=(1e3*E-v)/(1e3*E);return pC[C<.15?0:C<.3?1:C<.45?2:C<.6?3:4][m]}}return m}handleUpdateBitrateLimit(t){this.videoTrack&&this.videoTrack.setBitrateLimit(t)}async setAudioTrackMuteState(t,n){if(!(this.audioTrack instanceof ci))return void S.debug("[".concat(this.connectionId,"] set audio mute in unsupported environment"));const s=this.audioTrack;try{if(t){var c;s.removeAudioTrack(n),s.trackList.length===0&&(S.debug(O(c="[".concat(this.connectionId,"] set audio encoding active, id: ")).call(c,n.getTrackId(),", state: ",!1)),await this.pc.setAudioRtpEncodingParameters({active:!1})),this.suspendTracks.push(n)}else await this.pc.setAudioRtpEncodingParameters({active:!0}),s.addAudioTrack(n),da(this.suspendTracks,n)}catch(h){var d;S.warning(O(d="[".concat(this.connectionId,"] set audio muted error ")).call(d,h,", fallback to set enabled"))}await xr(this,ae.NEED_CONTROL,{type:"audio",muted:!(!this.audioTrack||this.audioTrack.isActive)})}async setVideoTrackMuteState(t){const n=!t;let s=!1;if(we().name===Dl.FIREFOX)s=!0;else try{var c,d;S.debug(O(c=O(d="[".concat(this.connectionId,"] set video encoding active, id: ")).call(d,this.videoTrack&&this.videoTrack.getTrackId(),", state: ")).call(c,n)),await this.pc.setVideoRtpEncodingParameters({active:n})}catch(m){var h;S.warning(O(h="[".concat(this.connectionId,"] set video encoding active error ")).call(h,m,", fallback to set enabled")),s=!0}var p,A;s&&this.videoTrack&&(S.debug(O(p=O(A="[".concat(this.connectionId,"] set video encoding active fallback to enabled on firefox, type: ")).call(A,this.videoTrack&&this.videoTrack.getTrackId(),", state: ")).call(p,n)),this.videoTrack.getMediaStreamTrack().enabled=n),this.lowStreamConnection&&this.lowStreamConnection.setVideoTrackMuteState(t),!this.isLowStreamConnection&&await xr(this,ae.NEED_CONTROL,{type:"video",muted:t})}uploadStats(t,n){const s=this.audioTrack?function(p,A){const m=p.audioSend[0];if(!m)return null;const E={id:Le(10,""),timestamp:new Date(p.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:m.ssrc.toString()};return E.A_astd=A._originMediaStreamTrack.enabled&&A._mediaStreamTrack.enabled?"0":"1",m.inputLevel?E.A_ail=Math.round(100*m.inputLevel).toString():E.A_ail=Math.round(100*A._source.getAccurateVolumeLevel()).toString(),E.A_apil=Math.round(100*A._source.getAccurateVolumeLevel()).toString(),E}(t,this.audioTrack):void 0,c=this.videoTrack?function(p,A){const m=p.videoSend[0];if(!m)return null;const E={id:Le(10,""),timestamp:new Date(p.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:m.ssrc.toString()};switch(E.A_vstd=A._originMediaStreamTrack&&!A._originMediaStreamTrack.enabled||!A._mediaStreamTrack.enabled?"1":"0",m.sentFrame&&(E.A_fhs=m.sentFrame.height.toString(),E.A_frs=m.sentFrame.frameRate.toString(),E.A_fws=m.sentFrame.width.toString()),m.adaptionChangeReason){case"none":E.A_ac="0";break;case"cpu":E.A_ac="1";break;case"bandwidth":E.A_ac="2";break;case"other":E.A_ac="3"}return E.A_nr=m.nacksCount.toString(),m.avgEncodeMs&&(E.A_aem=m.avgEncodeMs.toFixed(0).toString()),E}(t,this.videoTrack):void 0,d=i1(t,n),h=function(p){const A={id:"bweforvideo",timestamp:new Date(p.timestamp).toISOString(),type:"VideoBwe"};return p.bitrate.retransmit&&(A.A_rb=p.bitrate.retransmit.toString()),p.bitrate.targetEncoded&&(A.A_teb=p.bitrate.targetEncoded.toString()),A.A_aeb=p.bitrate.actualEncoded.toString(),A.A_tb=p.bitrate.transmit.toString(),p.sendBandwidth!==void 0&&(A.A_asb=p.sendBandwidth.toString()),A}(t);s&&on(()=>this.emit(ae.NEED_UPLOAD,Ko.PUBLISH_STATS,s)),c&&on(()=>this.emit(ae.NEED_UPLOAD,Ko.PUBLISH_STATS,T1({},c,{},d))),h&&on(()=>this.emit(ae.NEED_UPLOAD,Ko.PUBLISH_STATS,h))}uploadSlowStats(t){const n=i1(t);n&&on(()=>this.emit(ae.NEED_UPLOAD,Ko.PUBLISH_STATS,n))}uploadRelatedStats(t){const n=function(s){const c=s.videoSend[0];return c?{mediaType:"video",isVideoMute:!1,frameRateInput:c.inputFrame&&c.inputFrame.frameRate.toString(),frameRateSent:c.sentFrame&&c.sentFrame.frameRate.toString(),googRtt:c.rttMs.toString()}:null}(t);n&&(n.isVideoMute=!(!this.videoTrack||!this.videoTrack.muted),on(()=>{this.emit(ae.NEED_UPLOAD,Ko.PUBLISH_RELATED_STATS,n)}))}async addSimulcast4Firefox(t){if(Gr()&&this.videoTrack&&this.videoTrack._encoderConfig&&this.videoTrack._encoderConfig.bitrateMax&&this.videoTrack._encoderConfig.bitrateMax>200&&t.numSpatialLayers>1&&this.codec==="vp8"){const n=this.pc.getSender("video");if(n){const s=n.getParameters();S.debug("getParameters : ",s),s||S.error("[".concat(this.connectionId,"] get sender parameter error."));const c={high:1e3*(this.videoTrack._encoderConfig.bitrateMax-50),medium:5e4};s.encodings=[{rid:"m",active:!0,maxBitrate:c.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:c.high}],await n.setParameters(s),S.debug("setParameters : ",s)}}}bindTrackEvents(t){var n;t.addListener(he.NEED_RESET_REMOTE_SDP,Mr(n=this.handleResetRemoteSdp).call(n,this)),this.isLowStreamConnection||(t instanceof xn?(t.addListener(he.GET_STATS,this.handleGetLocalAudioStats),t.addListener(he.NEED_CLOSE,this.handleCloseAudioTrack),t.addListener(he.SET_AUDIO_TRACK_MUTED,this.handleMuteAudioTrack)):t instanceof Qr&&(t.addListener(he.GET_STATS,this.handleGetLocalVideoStats),t.addListener(he.NEED_CLOSE,this.handleCloseVideoTrack),t.addListener(he.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),t.addListener(he.SET_VIDEO_TRACK_MUTED,this.handleMuteVideoTrack)),t.addListener(he.NEED_RENEGOTIATE,this.handleStreamRenegotiate),t.addListener(he.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(he.NEED_SESSION_ID,this.handleGetSessionID))}unbindTrackEvents(t){this.isLowStreamConnection||(t instanceof xn?(t.off(he.GET_STATS,this.handleGetLocalAudioStats),t.off(he.NEED_CLOSE,this.handleCloseAudioTrack),t.off(he.SET_AUDIO_TRACK_MUTED,this.handleMuteAudioTrack)):t instanceof Qr&&(t.off(he.GET_STATS,this.handleGetLocalVideoStats),t.off(he.NEED_CLOSE,this.handleCloseVideoTrack),t.off(he.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),t.off(he.SET_VIDEO_TRACK_MUTED,this.handleMuteVideoTrack)),t.off(he.NEED_RENEGOTIATE,this.handleStreamRenegotiate),t.off(he.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(he.NEED_SESSION_ID,this.handleGetSessionID))}async addTrackWithPC(t){if(this.connectionState==="connecting")return new M(Ze.INVALID_OPERATION,"last publish operation has not finished").throw();const n=this.videoTrack;let s=!1;return this.audioTrack&&t instanceof ci?(this.audioTrack=t,S.debug("[".concat(this.connectionId,"] replace pc audio track")),s=await this.pc.replaceTrack(t._mediaStreamTrack)):this.videoTrack&&t instanceof Qr?(this.videoTrack=t,S.debug("[".concat(this.connectionId,"] replace pc video track")),s=await this.pc.replaceTrack(t._mediaStreamTrack)):t instanceof xn?(this.audioTrack=t,S.debug("[".concat(this.connectionId,"] add audio track to pc")),await this.pc.addTrack(t._mediaStreamTrack),s=!0):t instanceof Qr&&(this.videoTrack=t,S.debug("[".concat(this.connectionId,"] add video track to pc")),await this.pc.addTrack(t._mediaStreamTrack),s=!0),this.connectionState==="connected"&&this.videoTrack!==n&&this.videoTrack&&await this.setRtpSenderParametersByTrackConfig(this.videoTrack),this.connectionState!=="disconnected"&&s}handleResetRemoteSdp(){return new dt((t,n)=>{var s;S.info("[pc-".concat(this.pc.ID,"] start reset remote sdp"));const c=this.pc.getOfferSDP(),d=this.pc.getAnswerSDP();if(!d||!c)return t();const h=d.sdp;let p;this.videoTrack&&this.videoTrack._encoderConfig&&Ft(s=this.videoTrack._hints).call(s,Bs.SCREEN_TRACK)===-1&&(p=function(A,m){var E,v;const C=m.bitrateMin;let b=m.bitrateMax;const y=Mr(E=RegExp.prototype.test).call(E,/^([a-z])=(.*)/),w=kt(v=A.split(/(\r\n|\r|\n)/)).call(v,y);if(b){let P="AS";we().name===Re.FIREFOX&&(b=1e3*(b>>>0),P="TIAS");const V=ti(w).call(w,j=>zt(j).call(j,P));var k;V>0&&(w[V]=O(k="b=".concat(P,":")).call(k,b))}if(C){const P=ti(w).call(w,V=>zt(V).call(V,"x-google-min-bitrate"));P>0&&(w[P]=w[P].replace(/x-google-min-bitrate=(.*)/,"x-google-min-bitrate=".concat(C)))}return w.join(`\r
`)+`\r
`}(h,this.videoTrack._encoderConfig)),h!==p?this.pc.setOfferSDP(c.sdp).then(()=>{if(p)return this.pc.setAnswerSDP(p)}).then(t).catch(A=>{var m;S.error(O(m="[pc-".concat(this.pc.ID,"] reset remote sdp error, ")).call(m,A)),n(A)}):S.debug("[pc-".concat(this.pc.ID,"] remote sdp have no not changed"))})}async setRtpSenderParametersByTrackConfig(t){if(!Dr().supportSetRtpSenderParameters)return void S.debug("[".concat(this.connectionId,"] do not support set pc rtp sender, skip"));const n={};let s="balanced";t._optimizationMode==="motion"?s="maintain-framerate":t._optimizationMode==="detail"&&(s="maintain-resolution"),S.debug("[".concat(this.connectionId,"] set pc rtp sender"),n,s),await this.pc.setRtpSenderParameters(n,s)}updateAnswerSDP(t){var n,s;return t=t.replace(/a=x-google-flag:conference\r\n/g,""),this.videoTrack&&Ft(n=this.videoTrack._hints).call(n,Bs.SCREEN_TRACK),this.videoTrack&&this.videoTrack._encoderConfig&&Ft(s=this.videoTrack._hints).call(s,Bs.SCREEN_TRACK)===-1&&(t=function(c,d,h){const p=Dr(),A=h.bitrateMin;let m=h.bitrateMax;const E=c.match(/m=video.*\r\n/)||c.match(/m=video.*\n/);if(E&&E.length>0&&p.supportMinBitrate&&A){const P=S1(c,d);if(P)if(ot("SIMULCAST")){var v,C;const V=m?.7*m:300;c=c.replace(E[0],O(v=O(C="".concat(E[0],"a=fmtp:")).call(C,P," x-google-start-bitrate=")).call(v,V,`\r
`))}else{var b,y;c=c.replace(E[0],O(b=O(y="".concat(E[0],"a=fmtp:")).call(y,P," x-google-min-bitrate=")).call(b,A,`\r
`))}}if(E&&E.length>0&&m){var w,k;let P="AS";we().name===Re.FIREFOX&&(m=1e3*(m>>>0),P="TIAS"),c=c.replace(E[0],O(w=O(k="".concat(E[0],"b=")).call(k,P,":")).call(w,m,`\r
`))}return c}(t,this.codec,this.videoTrack._encoderConfig)),this.audioTrack&&this.audioTrack._encoderConfig&&(t=um(t,this.audioTrack._encoderConfig)),t=function(c){const d=we();return d.name!==Re.SAFARI&&d.os!==Mn.IOS?c:c.replace(/a=.*video-orientation\r\n/g,"")}(t)}createPC(){this.pc=new qL({turnServer:this.joinInfo.turnServer}),this.updateICEPromise()}async closePC(t){return this.pc.onICEConnectionStateChange=void 0,this.pc.close(),!t&&await xr(this,ae.NEED_UNPUB)}onPCDisconnected(t){this.reportPublishEvent(!1,t.code)}async setLowStreamEncoding(t,n){try{const s=await this.pc.setVideoRtpEncodingParameters(t),c=n.getMediaStreamTrack();if(t.scaleResolutionDownBy&&s.encodings[0].scaleResolutionDownBy!==t.scaleResolutionDownBy){const d=n._videoHeight||c.getSettings().height,h=n._videoWidth||c.getSettings().width;d&&h&&await c.applyConstraints({height:d/t.scaleResolutionDownBy,width:h/t.scaleResolutionDownBy})}t.maxFramerate&&s.encodings[0].maxFramerate!==t.maxFramerate&&await c.applyConstraints({frameRate:t.maxFramerate})}catch(s){throw s instanceof M?s:new M(Ze.LOW_STREAM_ENCODING_ERROR,s.message)}}}function w1(r,t){var n=le(r);if(ee){var s=ee(r);t&&(s=kt(s).call(s,function(c){return Wt(r,c).enumerable})),n.push.apply(n,s)}return n}function pm(r){for(var t=1;t<arguments.length;t++){var n,s=arguments[t]!=null?arguments[t]:{};if(t%2)G(n=w1(Object(s),!0)).call(n,function(d){_r(r,d,s[d])});else if(te)He(r,te(s));else{var c;G(c=w1(Object(s))).call(c,function(d){se(r,d,Wt(s,d))})}}return r}class b1 extends XT{constructor(t,n,s,c){var d,h,p;super(t,O(d=O(h=O(p="track-".concat(t.kind,"-")).call(p,n,"-")).call(h,c,"_")).call(d,Le(5,""))),this._isDestroyed=!1,this._userId=n,this._uintId=s}getUserId(){return this._userId}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource()}_destroy(){this._isDestroyed=!0,S.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}}class du extends b1{constructor(t,n,s,c){super(t,n,s,c),this.trackMediaType="video",this.updateMediaStreamTrackResolution()}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Op.PLAYING)}getStats(){return ks(()=>{S.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Io(this,he.GET_STATS)||pm({},PL)}play(t,n={}){const s=bt.reportApiInvoke(null,{tag:Zt.TRACER,name:Kt.REMOTE_VIDEO_TRACK_PLAY,options:[this.getTrackId(),typeof t=="string"?t:"HTMLElement",n]});if(typeof t=="string"){const h=document.getElementById(t);var c;h?t=h:(S.warning(O(c="[".concat(this.getTrackId(),'] can not find "#')).call(c,t,'" element, use document.body')),t=document.body)}S.debug("[".concat(this.getTrackId(),"] start video playback"),ht(n));const d=pm({fit:"cover"},n,{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(d):(this._player=new _p(d),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.emit(nu.FIRST_FRAME_DECODED)}),this._player.play(),s.onSuccess()}stop(){const t=bt.reportApiInvoke(null,{tag:Zt.TRACER,name:Kt.REMOTE_VIDEO_TRACK_STOP,options:[this.getTrackId()]});if(!this._player)return t.onSuccess();this._player.destroy(),this._player=void 0,S.debug("[".concat(this.getTrackId(),"] stop video playback")),t.onSuccess()}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){ep(this._originMediaStreamTrack).then(([t,n])=>{this._videoHeight=n,this._videoWidth=t}).catch(Cl)}_updatePlayerSource(){S.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var t,n;const s=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),c={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:s==null?void 0:s.parentElement},{element:d,slot:h}=c;if(this.isPlaying&&d instanceof HTMLVideoElement&&h instanceof HTMLElement){const p=Vg.checkOneElementVisible(d),A=hr({},p);return A.visible||bt.reportApiInvoke(null,{tag:Zt.TRACER,name:Kt.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]}).onSuccess("Not visible because of ".concat(A.reason)),A}return}catch(s){throw new M(L.GET_VIDEO_ELEMENT_VISIBLE_ERROR,s.message)}}}class uu extends b1{constructor(t,n,s,c){super(t,n,s,c),this.trackMediaType="audio",this._useAudioElement=!0,this._volume=100,this._source=new zh(t,!0),this._source.once(Ps.RECEIVE_TRACK_BUFFER,()=>{this.emit(nu.FIRST_FRAME_DECODED)})}get isPlaying(){return this._useAudioElement?Yr.isPlaying(this.getTrackId()):this._source.isPlayed}setAudioFrameCallback(t,n=4096){if(!t)return this._source.removeAllListeners(Ps.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(n),this._source.removeAllListeners(Ps.ON_AUDIO_BUFFER),this._source.on(Ps.ON_AUDIO_BUFFER,s=>t(s))}setVolume(t){const n=bt.reportApiInvoke(null,{tag:Zt.TRACER,name:Kt.REMOTE_AUDIO_SET_VOLUME,options:[this.getTrackId(),t]},300);this._volume=t,this._useAudioElement?Yr.setVolume(this.getTrackId(),t):this._source.setVolume(t/100),n.onSuccess()}async setPlaybackDevice(t){const n=bt.reportApiInvoke(null,{tag:Zt.TRACER,name:Kt.REMOTE_AUDIO_SET_OUTPUT_DEVICE,options:[this.getTrackId(),t]});if(!this._useAudioElement)throw new M(L.NOT_SUPPORTED,"your browser does not support setting the audio output device");try{await Yr.setSinkID(this.getTrackId(),t)}catch(s){throw n.onError(s),s}n.onSuccess()}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return ks(()=>{S.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Io(this,he.GET_STATS)||pm({},ML)}play(){const t=bt.reportApiInvoke(null,{tag:Zt.TRACER,name:Kt.REMOTE_AUDIO_TRACK_PLAY,options:[this.getTrackId()]});S.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(S.debug("[".concat(this.getTrackId(),"] use audio element to play")),Yr.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play(),t.onSuccess()}stop(){const t=bt.reportApiInvoke(null,{tag:Zt.TRACER,name:Kt.REMOTE_AUDIO_TRACK_STOP,options:[this.getTrackId()]});S.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Yr.stop(this.getTrackId()):this._source.stop(),t.onSuccess()}_destroy(){super._destroy(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){S.debug("[".concat(this.getTrackId(),"] update player source track")),this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Yr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}}class zL extends _1{constructor(t,n,s,c){super(s,t.uid),this.type="sub",this.unusedTracks=[],this.onTrack=d=>{var h,p;if(d.kind==="audio"&&!this.subscribeOptions.audio||d.kind==="video"&&!this.subscribeOptions.video)return this.unusedTracks.push(d),void S.debug(O(p="[".concat(this.connectionId,"] unused ontrack event, kind: ")).call(p,d.kind));S.debug(O(h="[".concat(this.connectionId,"] emit pc ontrack after subscribe ")).call(h,d.kind),d);const A=d.kind==="audio"?this.user._audioTrack:this.user._videoTrack;var m,E;A?A._updateOriginMediaStreamTrack(d):d.kind==="audio"?(this.pc._statsFilter.setIsFirstAudioDecoded(!1),this.user._audioTrack=new uu(d,this.getUserId(),this.user._uintid,this.joinInfo.clientId),S.info(O(m="[".concat(this.connectionId,"] create remote audio track: ")).call(m,this.user._audioTrack.getTrackId())),this.bindTrackEvents(this.user._audioTrack)):(this.user._videoTrack=new du(d,this.getUserId(),this.user._uintid,this.joinInfo.clientId),S.info(O(E="[".concat(this.connectionId,"] create remote video track: ")).call(E,this.user._videoTrack.getTrackId())),this.bindTrackEvents(this.user._videoTrack))},this.handleGetRemoteAudioStats=d=>{d(this.statsCollector.getRemoteAudioTrackStats(this.connectionId))},this.handleGetRemoteVideoStats=d=>{d(this.statsCollector.getRemoteVideoTrackStats(this.connectionId))},this.handleGetSessionID=d=>{d(this.joinInfo.sid)},this.user=t,this.statsCollector=n,this.statsCollector.addRemoteConnection(this),this.subscribeOptions=c}async startP2PConnection(){return new dt(async(t,n)=>{const s=A=>{if(A==="connected"&&(bt.subscribe(this.joinInfo.sid,{lts:this.startTime,succ:!0,video:this.subscribeOptions.video,audio:this.subscribeOptions.audio,peerid:this.user.uid,ec:null,subscribeRequestid:this.ID,p2pid:this.pc.ID}),this.off(ae.CONNECTION_STATE_CHANGE,s),t()),A==="disconnected"){if(this.off(ae.CONNECTION_STATE_CHANGE,s),this.disconnectedReason)return n(this.disconnectedReason);n(new M(L.OPERATION_ABORTED,"subscribe abort"))}};if(this.on(ae.CONNECTION_STATE_CHANGE,s),this.disconnectedReason=void 0,this.connectionState="connecting",this.startTime=pt(),!this.subscribeOptions)return void n(new M(L.UNEXPECTED_ERROR,"no subscribe options"));const c=new MediaStream,d=new dt(A=>{this.pc.onTrack=(m,E)=>{var v,C;if(m.kind==="audio"&&!this.subscribeOptions.audio||m.kind==="video"&&!this.subscribeOptions.video)return this.unusedTracks.push(m),void S.debug(O(C="[".concat(this.connectionId,"] unused ontrack event ")).call(C,m.kind));c.addTrack(m);const b={audio:c.getAudioTracks().length>0,video:c.getVideoTracks().length>0};S.debug(O(v="[".concat(this.connectionId,"] subscribe ontrack: ")).call(v,m.kind),E,m),function(y,w){var k,P;const V=xa(k=le(y)).call(k),j=xa(P=le(w)).call(P);for(let st=0;st<V.length;st+=1)if(V[st]!==j[st]||y[V[st]]!==w[V[st]])return!1;return!0}(b,this.subscribeOptions)&&(this.pc.onTrack=this.onTrack,S.debug("[".concat(this.connectionId,"] get all subscribed tracks")),A(c))}});try{const A=function(y){return we().name!==Re.FIREFOX?y:y.replace("/recvonly http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"," http://www.webrtc.org/experiments/rtp-hdrext/playout-delay")}(I1(await this.pc.createOfferSDP()));await this.pc.setOfferSDP(A),S.debug("[".concat(this.connectionId,"] create and set offer success"));const m={messageType:"OFFER",sdp:A,offererSessionId:104,retry:!0},E=await xr(this,ae.NEED_ANSWER,m);await this.pc.setAnswerSDP(I1(E.sdp)),S.debug("[".concat(this.connectionId,"] set answer success"));const v=await dt.all([d,this.icePromise]),C=v[0].getAudioTracks()[0],b=v[0].getVideoTracks()[0];var h,p;C&&(this.user._audioTrack?this.user._audioTrack._updateOriginMediaStreamTrack(C):(this.user._audioTrack=new uu(C,this.getUserId(),this.user._uintid,this.joinInfo.clientId),S.info(O(h="[".concat(this.connectionId,"] create remote audio track: ")).call(h,this.user._audioTrack.getTrackId())),this.bindTrackEvents(this.user._audioTrack))),b&&(this.user._videoTrack?this.user._videoTrack._updateOriginMediaStreamTrack(b):(this.user._videoTrack=new du(b,this.getUserId(),this.user._uintid,this.joinInfo.clientId),S.info(O(p="[".concat(this.connectionId,"] create remote video track: ")).call(p,this.user._videoTrack.getTrackId())),this.bindTrackEvents(this.user._videoTrack))),this.connectionState="connected",this.startUploadStats()}catch(A){this.off(ae.CONNECTION_STATE_CHANGE,s),this.connectionState="disconnected",bt.subscribe(this.joinInfo.sid,{lts:this.startTime,succ:!1,video:this.subscribeOptions.video,audio:this.subscribeOptions.audio,peerid:this.user.uid,ec:A.code,subscribeRequestid:this.ID,p2pid:this.pc.ID}),n(A)}})}async closeP2PConnection(t){this.connectionState!=="disconnected"&&(this.stopUploadStats(),this.statsCollector.removeConnection(this.connectionId),this.connectionState="disconnected",await this.setSubscribeOptions({audio:!1,video:!1}),await this.closePC(t),this.removeAllListeners())}getNetworkQuality(){const t=this.pc.getStats();if(!t.audioRecv[0]&&!t.videoRecv[0])return 1;const n=Io(this,ae.NEED_SIGNAL_RTT),s=t.rtt,c=(s&&n?(s+n)/2:s||n)||0,d=t.audioRecv[0]?t.audioRecv[0].jitterMs:void 0,h=t.recvPacketLossRate;let p=.7*h*100/50+.3*c/1500;return d&&(p=.6*h*100/50+.2*c/1500+.2*d/400),p<.1?1:p<.17?2:p<.36?3:p<.59?4:5}uploadStats(t){const n=this.user.audioTrack?function(c,d){const h=c.audioRecv[0];if(!h)return null;const p={id:Le(10,""),timestamp:new Date(c.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:h.ssrc.toString()};return p.bytesReceived=h.bytes.toString(),p.packetsLost=h.packetsLost.toString(),p.packetsReceived=h.packets.toString(),h.outputLevel?p.A_aol=Math.round(100*h.outputLevel).toString():p.A_aol=Math.round(100*d._source.getAccurateVolumeLevel()).toString(),p.A_apol=Math.round(100*d._source.getAccurateVolumeLevel()).toString(),d&&(p.A_artd=d._originMediaStreamTrack.enabled&&d._mediaStreamTrack.enabled?"0":"1"),p.A_jr=h.jitterMs.toString(),p.A_jbm=Math.floor(h.jitterBufferMs).toString(),p.A_cdm=Math.floor(h.jitterBufferMs).toString(),p}(t,this.user.audioTrack):void 0,s=this.user.videoTrack?function(c,d){const h=c.videoRecv[0];if(!h)return null;const p={id:Le(10,""),timestamp:new Date(c.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:h.ssrc.toString()};var A;return p.bytesReceived=h.bytes.toString(),p.packetsLost=h.packetsLost.toString(),p.packetsReceived=h.packets.toString(),h.framesRateFirefox&&(p.A_frr=h.framesRateFirefox.toString()),h.receivedFrame&&(p.A_frr=h.receivedFrame.frameRate.toString()),p.A_frd=h.decodeFrameRate.toString(),h.outputFrame&&(p.A_fro=h.outputFrame.frameRate.toString()),h.jitterBufferMs!==void 0&&(p.A_jbm=Math.floor(h.jitterBufferMs).toString()),h.currentDelayMs!==void 0&&(p.A_cdm=Math.floor(h.currentDelayMs).toString()),p.A_fs=h.firsCount.toString(),p.A_ns=h.nacksCount.toString(),p.A_ps=h.plisCount.toString(),d&&(p.A_vrtd=d._originMediaStreamTrack.enabled&&d._mediaStreamTrack.enabled?"0":"1"),d._player&&d._player.freezeTimeCounterList.length>0&&(p.A_vrft=Ye(A=d._player.freezeTimeCounterList).call(A,0,1)[0].toString()),p}(t,this.user.videoTrack):void 0;n&&on(()=>this.emit(ae.NEED_UPLOAD,Ko.SUBSCRIBE_STATS,n)),s&&on(()=>this.emit(ae.NEED_UPLOAD,Ko.SUBSCRIBE_STATS,s))}uploadSlowStats(t){}uploadRelatedStats(t,n){const s=this.pc._statsFilter.videoIsReady===!0,c=function(h,p,A){const m=h.audioRecv[0];if(!m)return null;const E=Ul.isRemoteAudioFreeze(A);return{mediaType:"audio",isAudioMute:!1,peerId:p,googJitterReceived:m.jitterMs.toString(),isFreeze:E,bytesReceived:m.bytes.toString(),packetsReceived:m.packets.toString(),packetsLost:m.packetsLost.toString(),frameReceived:m.receivedFrames.toString(),frameDropped:m.droppedFrames.toString()}}(t,this.getUserId(),this.user.audioTrack),d=function(h,p,A,m,E){const v=p.videoRecv[0],C=m?m.videoRecv[0]:void 0;if(!v)return null;const b=Ul.isRemoteVideoFreeze(E,v,C)&&h,y={mediaType:"video",isVideoMute:!1,peerId:A,frameRateReceived:v.receivedFrame&&v.receivedFrame.frameRate.toString(),frameRateDecoded:v.decodedFrame&&v.decodedFrame.frameRate.toString(),isFreeze:b,bytesReceived:v.bytes.toString(),packetsReceived:v.packets.toString(),packetsLost:v.packetsLost.toString()};return v.framesRateFirefox&&(y.frameRateDecoded=v.framesRateFirefox.toString(),y.frameRateReceived=v.framesRateFirefox.toString()),y}(s,t,this.getUserId(),n,this.user.videoTrack);c&&on(()=>{this.emit(ae.NEED_UPLOAD,Ko.SUBSCRIBE_RELATED_STATS,c)}),d&&on(()=>{this.emit(ae.NEED_UPLOAD,Ko.SUBSCRIBE_RELATED_STATS,d)})}emitOnTrackFromUnusedTracks(){if(!this.subscribeOptions)return;const t=this.subscribeOptions.video;if(this.subscribeOptions.audio){var n;const c=_t(n=this.unusedTracks).call(n,d=>d.kind==="audio"&&d.readyState==="live");da(this.unusedTracks,c),c&&this.onTrack(c)}if(t){var s;const c=_t(s=this.unusedTracks).call(s,d=>d.kind==="video"&&d.readyState==="live");da(this.unusedTracks,c),c&&this.onTrack(c)}}async setSubscribeOptions(t){var n,s,c,d;if(t.audio!==this.subscribeOptions.audio||t.video!==this.subscribeOptions.video){if(this.connectionState==="connecting")try{await this.createWaitConnectionConnectedPromise()}catch{throw new M(L.OPERATION_ABORTED,"can not update subscribe options, operation abort")}t.audio===this.subscribeOptions.audio&&t.video===this.subscribeOptions.video||(S.debug(O(n=O(s=O(c=O(d="[".concat(this.connectionId,"] update subscribe options [a: ")).call(d,this.subscribeOptions.audio,", v: ")).call(c,this.subscribeOptions.video,"] -> [a: ")).call(s,t.audio,", v: ")).call(n,t.video,"]")),this.subscribeOptions=t,!t.audio&&this.user._audioTrack&&(this.unusedTracks.push(this.user._audioTrack._originMediaStreamTrack),this.user._audioTrack._destroy(),this.unbindTrackEvents(this.user._audioTrack),this.user._audioTrack=void 0),!t.video&&this.user._videoTrack&&(this.unusedTracks.push(this.user._videoTrack._originMediaStreamTrack),this.user._videoTrack._destroy(),this.unbindTrackEvents(this.user._videoTrack),this.user._videoTrack=void 0),this.emitOnTrackFromUnusedTracks())}}createPC(){this.pc=new JL({turnServer:this.joinInfo.turnServer}),this.pc.onFirstAudioDecoded=()=>{this.user.audioTrack&&this.user.audioTrack.emit(nu.FIRST_FRAME_DECODED),bt.firstRemoteFrame(this.joinInfo.sid,ei.FIRST_AUDIO_DECODE,Jr.FIRST_AUDIO_DECODE,{peer:this.user._uintid,subscribeElapse:pt()-this.startTime,subscribeRequestid:this.ID,p2pid:this.pc.ID})},this.pc.onFirstAudioReceived=()=>{bt.firstRemoteFrame(this.joinInfo.sid,ei.FIRST_AUDIO_RECEIVED,Jr.FIRST_AUDIO_RECEIVED,{peer:this.user._uintid,subscribeElapse:pt()-this.startTime,subscribeRequestid:this.ID,p2pid:this.pc.ID})},this.pc.onFirstVideoDecoded=(t,n)=>{bt.firstRemoteFrame(this.joinInfo.sid,ei.FIRST_VIDEO_DECODE,Jr.FIRST_VIDEO_DECODE,{peer:this.user._uintid,videowidth:t,videoheight:n,subscribeElapse:pt()-this.startTime,subscribeRequestid:this.ID,p2pid:this.pc.ID})},this.pc.onFirstVideoReceived=()=>{bt.firstRemoteFrame(this.joinInfo.sid,ei.FIRST_VIDEO_RECEIVED,Jr.FIRST_VIDEO_RECEIVED,{peer:this.user._uintid,subscribeElapse:pt()-this.startTime,subscribeRequestid:this.ID,p2pid:this.pc.ID})},this.updateICEPromise()}async closePC(t){return this.pc.audioTrack&&this.pc.audioTrack.stop(),this.pc.videoTrack&&this.pc.videoTrack.stop(),this.pc.onTrack=void 0,this.pc.onICEConnectionStateChange=void 0,this.pc.close(),t?!1:await xr(this,ae.NEED_UNSUB)}onPCDisconnected(t){bt.subscribe(this.joinInfo.sid,{lts:this.startTime,succ:!1,video:this.subscribeOptions.video,audio:this.subscribeOptions.audio,peerid:this.user.uid,ec:t.code,subscribeRequestid:this.ID,p2pid:this.pc.ID})}bindTrackEvents(t){t instanceof uu?t.addListener(he.GET_STATS,this.handleGetRemoteAudioStats):t instanceof du&&t.addListener(he.GET_STATS,this.handleGetRemoteVideoStats)}unbindTrackEvents(t){t instanceof uu?t.off(he.GET_STATS,this.handleGetRemoteAudioStats):t instanceof du&&t.off(he.GET_STATS,this.handleGetRemoteVideoStats)}}class XL{constructor(t,n){this._trust_in_room_=!0,this._trust_audio_enabled_state_=!0,this._trust_video_enabled_state_=!0,this._trust_audio_mute_state_=!0,this._trust_video_mute_state_=!0,this._trust_stream_added_state_=!0,this._audio_muted_=!1,this._video_muted_=!1,this._audio_enabled_=!0,this._video_enabled_=!0,this._audio_added_=!1,this._video_added_=!1,this.uid=t,this._uintid=n}get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio)return this._audioTrack}get videoTrack(){if(this.hasVideo)return this._videoTrack}}function N1(r,t){var n=le(r);if(ee){var s=ee(r);t&&(s=kt(s).call(s,function(c){return Wt(r,c).enumerable})),n.push.apply(n,s)}return n}function xl(r){for(var t=1;t<arguments.length;t++){var n,s=arguments[t]!=null?arguments[t]:{};if(t%2)G(n=N1(Object(s),!0)).call(n,function(d){_r(r,d,s[d])});else if(te)He(r,te(s));else{var c;G(c=N1(Object(s))).call(c,function(d){se(r,d,Wt(s,d))})}}return r}var hu=function(r,t,n,s){var c,d=arguments.length,h=d<3?t:s===null?s=Wt(t,n):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(r,t,n,s);else for(var p=r.length-1;p>=0;p--)(c=r[p])&&(h=(d<3?c(h):d>3?c(t,n,h):c(t,n))||h);return d>3&&h&&se(t,n,h),h},xi=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)};class Fl extends Hr{constructor(t){var n,s,c,d;let h;if(super(),this._users=[],this._sessionId=null,this._bindEnabledTracks=[],this._leaveMutex=new Un("client-leave"),this._publishMutex=new Un("client-publish"),this._subscribeMutex=new re,this._remoteStream=new re,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._turnServer={servers:[],mode:"auto"},this._cloudProxyServerMode="disabled",this._isDualStreamEnabled=!1,this._streamFallbackTypeCacheMap=new re,this._remoteStreamTypeCacheMap=new re,this._axiosCancelSource=Lo.CancelToken.source(),this._networkQualitySensitivity="normal",this._useLocalAccessPoint=!1,this._handleLocalTrackEnable=(A,m,E)=>{this.publish(A,!1).then(m).catch(E)},this._handleLocalTrackDisable=(A,m,E)=>{this.unpublish(A,!1).then(m).catch(E)},this._handleUserOnline=A=>{var m;this.isStringUID&&typeof A.uid!="string"&&S.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const E=_t(m=this._users).call(m,v=>v.uid===A.uid);if(E)E._trust_in_room_=!0;else{const v=new XL(A.uid,A.uint_id||A.uid);this._users.push(v),S.debug("[".concat(this._clientId,"] user online"),A.uid),this.emit(be.USER_JOINED,v)}},this._handleUserOffline=A=>{var m;const E=_t(m=this._users).call(m,v=>v.uid===A.uid);E&&(this._handleRemoveStream(A),da(this._users,E),this._remoteStreamTypeCacheMap.delete(E.uid),this._streamFallbackTypeCacheMap.delete(E.uid),S.debug("[".concat(this._clientId,"] user offline"),A.uid,"reason:",A.reason),this.emit(be.USER_LEAVED,E,A.reason))},this._handleAddAudioOrVideoStream=(A,m,E)=>{var v,C,b;const y=_t(v=this._users).call(v,j=>j.uid===m);if(!y)return void S.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));S.debug(O(C=O(b="[".concat(this._clientId,"] stream added with uid ")).call(b,m,", type ")).call(C,A));const w=A==="audio"?y.hasAudio:y.hasVideo;var k,P;y._uintid||(y._uintid=E||m),y._trust_stream_added_state_=!0,A==="audio"?y._audio_added_=!0:y._video_added_=!0,(A==="audio"?y.hasAudio:y.hasVideo)&&!w&&(S.info(O(k=O(P="[".concat(this._clientId,"] remote user ")).call(P,y.uid," published ")).call(k,A)),this.emit(be.USER_PUBLISHED,y,A)),A==="video"?bt.onGatewayStream(this._sessionId,ei.ON_ADD_VIDEO_STREAM,Jr.ON_ADD_VIDEO_STREAM,{peer:E||m}):bt.onGatewayStream(this._sessionId,ei.ON_ADD_AUDIO_STREAM,Jr.ON_ADD_AUDIO_STREAM,{peer:E||m});const V=this._remoteStream.get(m);V&&V.readyToReconnect&&V.connectionState==="connecting"&&V.reconnectPC().catch(j=>{S.error("[".concat(this._clientId,"] resubscribe error"),j.toString())})},this._handleRemoveStream=A=>{var m,E;const v=_t(m=this._users).call(m,y=>y.uid===A.uid);if(!v)return void S.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));S.debug(O(E="[".concat(this._clientId,"] stream removed with uid ")).call(E,A.uid));let C=()=>{};v.hasAudio&&v.hasVideo?C=()=>{var y,w;S.info(O(y="[".concat(this._clientId,"] remote user ")).call(y,v.uid," unpublished audio track")),this.emit(be.USER_UNPUBLISHED,v,"audio"),S.info(O(w="[".concat(this._clientId,"] remote user ")).call(w,v.uid," unpublished video track")),this.emit(be.USER_UNPUBLISHED,v,"video")}:v.hasVideo?C=()=>{var y;S.info(O(y="[".concat(this._clientId,"] remote user ")).call(y,v.uid," unpublished video track")),this.emit(be.USER_UNPUBLISHED,v,"video")}:v.hasAudio&&(C=()=>{var y;S.info(O(y="[".concat(this._clientId,"] remote user ")).call(y,v.uid," unpublished audio track")),this.emit(be.USER_UNPUBLISHED,v,"audio")}),v._trust_stream_added_state_=!0,v._audio_added_=!1,v._video_added_=!1;const b=this._remoteStream.get(v.uid);b&&(b.closeP2PConnection(),this._remoteStream.delete(v.uid)),bt.onGatewayStream(this._sessionId,ei.ON_REMOVE_STREAM,Jr.ON_REMOVE_STREAM,{peer:A.uint_id||A.uid}),C()},this._handleSetStreamLocalEnable=(A,m,E)=>{var v,C,b,y,w,k;const P=_t(v=this._users).call(v,H=>H.uid===m);if(!P)return void S.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));S.debug(O(C=O(b=O(y="[".concat(this._clientId,"] local ")).call(y,A," ")).call(b,E?"enabled":"disabled"," with uid ")).call(C,m));const V=A==="audio"?P.hasAudio:P.hasVideo;if(A==="audio"){P._trust_audio_enabled_state_=!0;const H=P._audio_enabled_;if(P._audio_enabled_=E,P._audio_enabled_===H)return;{var j,st;const U=P._audio_enabled_?"enable-local-audio":"disable-local-audio";S.debug(O(j=O(st="[".concat(this._clientId,"] user-info-updated, uid: ")).call(st,m,", msg: ")).call(j,U)),this.emit(be.USER_INFO_UPDATED,m,U)}}else{P._trust_video_enabled_state_=!0;const H=P._video_enabled_;if(P._video_enabled_=E,P._video_enabled_===H)return;{var mt,Et;const U=P._video_enabled_?"enable-local-video":"disable-local-video";S.debug(O(mt=O(Et="[".concat(this._clientId,"] user-info-update, uid: ")).call(Et,m,", msg: ")).call(mt,U)),this.emit(be.USER_INFO_UPDATED,m,U)}}const At=A==="audio"?P.hasAudio:P.hasVideo;if(V===At)return;var $,rt;if(!V&&At)return S.info(O($=O(rt="[".concat(this._clientId,"] remote user ")).call(rt,m," published ")).call($,A)),void this.emit(be.USER_PUBLISHED,P,A);const W=this._remoteStream.get(m);if(W){const H=xl({},W.subscribeOptions);H.audio=!!P.hasAudio&&H.audio,H.video=!!P.hasVideo&&H.video,H.audio||H.video?W.setSubscribeOptions(H):(W.closeP2PConnection().catch(U=>{S.warning("close sub pc error",U)}),this._remoteStream.delete(P.uid))}S.info(O(w=O(k="[".concat(this._clientId,"] remote user ")).call(k,P.uid," unpublished ")).call(w,A)),this.emit(be.USER_UNPUBLISHED,P,A)},this._handleMuteStream=(A,m,E)=>{var v,C,b;S.debug("[".concat(this._clientId,"] receive mute message"),A,m,E);const y=_t(v=this._users).call(v,rt=>rt.uid===A);var w;if(!y)return void S.warning(O(w="[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ")).call(w,A));const k=m==="audio"?y.hasAudio:y.hasVideo;if(m==="audio"){y._trust_audio_mute_state_=!0;const rt=y._audio_muted_;if(y._audio_muted_=E,y._audio_muted_===rt)return;{var P,V;const W=y._audio_muted_?"mute-audio":"unmute-audio";S.debug(O(P=O(V="[".concat(this._clientId,"] user-info-update, uid: ")).call(V,A,", msg: ")).call(P,W)),this.emit(be.USER_INFO_UPDATED,A,W)}}else{y._trust_video_mute_state_=!0;const rt=y._video_muted_;if(y._video_muted_=E,y._video_muted_===rt)return;{var j,st;const W=y._video_muted_?"mute-video":"unmute-video";S.debug(O(j=O(st="[".concat(this._clientId,"] user-info-update, uid: ")).call(st,A,", msg: ")).call(j,W)),this.emit(be.USER_INFO_UPDATED,A,W)}}const mt=m==="audio"?y.hasAudio:y.hasVideo;if(k===mt)return;var Et,At;if(!k&&mt)return S.info(O(Et=O(At="[".concat(this._clientId,"] remote user ")).call(At,A," published ")).call(Et,m)),void this.emit(be.USER_PUBLISHED,y,m);const $=this._remoteStream.get(A);if($){const rt=xl({},$.subscribeOptions);rt.audio=!!y.hasAudio&&rt.audio,rt.video=!!y.hasVideo&&rt.video,m==="video"&&$.pc._statsFilter.setVideoIsReady(!1),rt.audio||rt.video?$.setSubscribeOptions(rt):($.closeP2PConnection().catch(W=>{S.warning("close sub pc error",W)}),this._remoteStream.delete(y.uid))}S.info(O(C=O(b="[".concat(this._clientId,"] remote user ")).call(b,A," unpublished ")).call(C,m)),this.emit(be.USER_UNPUBLISHED,y,m)},this._handleP2PLost=A=>{S.debug("[".concat(this._clientId,"] receive p2p lost"),A);let m=null;if(this._highStream&&this._highStream.pc.ID===A.p2pid)m=this._highStream;else if(this._lowStream&&this._lowStream.pc.ID===A.p2pid)m=this._lowStream;else{var E;G(E=this._remoteStream).call(E,v=>{v.pc.ID===A.p2pid&&(m=v)})}m?m.emit(ae.GATEWAY_P2P_LOST,A.p2pid):S.warning("P2PLost stream not found",A)},this._handleTokenWillExpire=()=>{S.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.emit(be.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)},this._handleBeforeUnload=A=>{A.returnValue!==void 0&&A.returnValue!==""||(this.leave(),S.info("[".concat(this._clientId,"] auto leave onbeforeunload")))},this._handleUpdateNetworkQuality=()=>{var A;if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.emit(be.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const m={downlinkNetworkQuality:0,uplinkNetworkQuality:0};this._highStream&&!this._highStream.detecting&&(m.uplinkNetworkQuality=this._highStream.getNetworkQuality());let E=0;G(A=this._remoteStream).call(A,v=>E+=v.getNetworkQuality()),this._remoteStream.size>0&&(m.downlinkNetworkQuality=Math.round(E/this._remoteStream.size)),this.emit(be.NETWORK_QUALITY,m)},this._codec=t.codec,this._mode=t.mode,t.proxyServer&&(this._proxyServer=t.proxyServer,bt.setProxyServer(this._proxyServer),S.setProxyServer(this._proxyServer)),t.turnServer&&(this._turnServer=xl({},this._turnServer,{mode:"manual"},t.turnServer)),this._clientId=Le(5,"client-"),S.info(O(n=O(s=O(c=O(d="[".concat(this._clientId,"] Initializing AgoraRTC client v")).call(d,Pn," build: ")).call(c,dl,", mode: ")).call(s,this._mode,", codec: ")).call(n,this._codec)),this._performanceRecorder=NT(this._clientId,"join"),t.clientRoleOptions)try{MT(t.clientRoleOptions),h=hr({},t.clientRoleOptions)}catch(A){var p;S.warning(O(p="[".concat(this._clientId,"] ")).call(p,A.toString()))}this._statsCollector=new Ul(this._clientId),this._statsCollector.onStatsException=(A,m,E)=>{var v,C,b;S.debug(O(v=O(C=O(b="[".concat(this._clientId,"] receive exception msg, code: ")).call(b,A,", msg: ")).call(C,m,", uid: ")).call(v,E)),this.emit(be.EXCEPTION,{code:A,msg:m,uid:E})},this._statsCollector.onUploadPublishDuration=(A,m,E,v)=>{var C;const b=_t(C=this._users).call(C,y=>y.uid===A);b&&bt.peerPublishStatus(this._sessionId,{subscribeElapse:v,audioPublishDuration:m,videoPublishDuration:E,peer:b._uintid})},this._gateway=new VL({clientId:this._clientId,mode:this._mode,codec:this._codec,websocketRetryConfig:t.websocketRetryConfig||Ne,httpRetryConfig:t.httpRetryConfig||Ne,forceWaitGatewayResponse:t.forceWaitGatewayResponse===void 0||t.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:t.role,clientRoleOptions:h}),this._config=t,this._configDistribute=new My,this._handleGatewayEvents()}get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._highStream?this._highStream.getAllTracks():[]}get uid(){return this._uid}get channelName(){return this._channelName}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}async join(t,n,s,c,d){var h;this._performanceRecorder.checkPoint("startJoin");const p=bT(),A=bp()?window.isSecureContext:"Browser Not Support",m=()=>{S.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser")};bp()?window.isSecureContext||m():p||m();const E=bt.reportApiInvoke(this._sessionId,{name:de.JOIN,options:[t,n,s,c],states:{isHttps:p,isSecureContext:A},tag:Zt.TRACER});try{if(!s&&s!==null)throw new M(L.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));s&&pr(s,"token",1,2047),pr(t,"appid",1,2047),xh(n),c&&Fh(c),d&&pr(d,"optionalInfo",1,2047)}catch(w){throw E.onError(w),w}if(S.info(O(h="[".concat(this._clientId,"] start join channel ")).call(h,n)),this._leaveMutex.isLocked&&(S.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),S.debug("[".concat(this._clientId,"] join: continue"))),this.connectionState!=="DISCONNECTED"){const w=new M(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw E.onError(w),w}this._sessionId||(this._sessionId=tp()),this._gateway.state="CONNECTING";const v={clientId:this._clientId,appId:t,sid:this._sessionId,cname:n,uid:typeof c!="string"?c:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:s||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:d,useLocalAccessPoint:this._useLocalAccessPoint};typeof c=="string"&&(v.stringUid=c,this._uintUid?(v.uid=this._uintUid,this._uintUid=void 0):v.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret&&(v.aesmode=this._encryptionMode,v.aespassword=await pS(this._encryptionSecret),this._encryptionSalt&&(v.aessalt=this._encryptionSalt)),this._startSession(this._sessionId,{channel:n,appId:t}),vn(()=>{this.connectionState==="CONNECTING"&&bt.joinChannelTimeout(this._sessionId,5)},5e3);try{var C;let w;if(v.cloudProxyServer==="443only")v.proxyServer=ot("PROXY_SERVER_TYPE2");else if(v.cloudProxyServer==="proxy3"||v.cloudProxyServer==="proxy4"||v.cloudProxyServer==="proxy5"){const P=ot("PROXY_SERVER_TYPE3");$r(P)?v.proxyServer=P[0]:v.proxyServer=P}if(bt.setProxyServer(v.proxyServer),S.setProxyServer(v.proxyServer),this._performanceRecorder.checkPoint("startRequestAp"),v.stringUid&&!v.uid&&v.cloudProxyServer==="normal"){var b;await dm(v,this._axiosCancelSource.token,this._config.httpRetryConfig||Ne,!1);const P=await p1(v.stringUid,v,this._axiosCancelSource.token,this._config.httpRetryConfig||Ne);S.debug(O(b="getUserAccount Success ".concat(v.stringUid," => ")).call(b,P)),v.uid=P,w=await au(v,this._axiosCancelSource.token,this._config.httpRetryConfig||Ne)}else if(v.stringUid&&!v.uid){var y;const P=await p1(v.stringUid,v,this._axiosCancelSource.token,this._config.httpRetryConfig||Ne);S.debug(O(y="getUserAccount Success ".concat(v.stringUid," => ")).call(y,P)),v.uid=P,w=await dm(v,this._axiosCancelSource.token,this._config.httpRetryConfig||Ne,!0)}else w=await dm(v,this._axiosCancelSource.token,this._config.httpRetryConfig||Ne,!0);this._performanceRecorder.checkPoint("startJoinGateway"),this._configDistribute.startGetConfigDistribute(v,this._axiosCancelSource.token),this._configDistribute.on(om.UPDATE_BITRATE_LIMIT,P=>{this._highStream&&this._highStream.handleUpdateBitrateLimit(P.uplink),P.low_stream_uplink&&this._lowStream&&this._lowStream.handleUpdateBitrateLimit({max_bitrate:P.low_stream_uplink.bitrate,min_bitrate:P.low_stream_uplink.bitrate||0})}),this._key=s||t,this._joinInfo=xl({},v,{cid:w.gatewayInfo.cid,uid:v.uid?v.uid:w.gatewayInfo.uid,vid:w.gatewayInfo.vid,apResponse:w.gatewayInfo.res,uni_lbs_ip:w.gatewayInfo.uni_lbs_ip,gatewayAddrs:w.gatewayInfo.gatewayAddrs});const k=await this._gateway.join(this._joinInfo,this._key);return E.onSuccess(k),this._appId=t,this._channelName=v.cname,this._uid=k,this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener("beforeunload",this._handleBeforeUnload),S.info(O(C="[".concat(this._clientId,"] Joining channel success: ")).call(C,n)),vn(()=>{S.startUpload()},5e3),this._performanceRecorder.checkPoint("finishJoin"),fC(this),k}catch(w){const k=$r(w)?w[0]:w;throw S.error("[".concat(this._clientId,"] Joining channel failed, rollback"),k),k.code!==L.OPERATION_ABORTED&&(this._gateway.state="DISCONNECTED",this._reset()),E.onError(k),k}}async leave(){const t=bt.reportApiInvoke(this._sessionId,{name:de.LEAVE,options:[],tag:Zt.TRACER});S.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener("beforeunload",this._handleBeforeUnload),this._reset(),AC(this);const n=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return S.info("[".concat(this._clientId,"] Leaving channel repeated, success")),n(),t.onSuccess();await this._gateway.leave(this.connectionState!=="CONNECTED"),S.info("[".concat(this._clientId,"] Leaving channel success")),n(),t.onSuccess()}async publish(t,n=!0){var s,c;$r(t)||(t=[t]);const d=bt.reportApiInvoke(this._sessionId,{name:de.PUBLISH,options:ft(t).call(t,p=>p?Object(p).toString():"null"),tag:Zt.TRACER});if(t.length===0){const p=new M(L.INVALID_PARAMS,"track list is empty");return d.onError(p),p.throw()}if(this._gateway.role==="audience"){const p=new M(L.INVALID_OPERATION,"audience can not publish stream");return d.onError(p),p.throw()}for(const p of t){if(!(p instanceof Mp)){const A=new M(L.INVALID_PARAMS,"pamameter is not local track");return d.onError(A),A.throw()}if(!p._enabled&&n){const A=new M(L.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(p.getTrackId()));return d.onError(A),A.throw()}}if(S.info(O(s="[".concat(this._clientId,"] Publishing tracks, id ")).call(s,ft(t).call(t,p=>"".concat(p.getTrackId()," ")))),await this._configDistribute.awaitConfigDistributeComplete(),n&&G(t).call(t,p=>{var A;const m=this._configDistribute.getBitrateLimit();var E;p instanceof Qr&&m&&p.setBitrateLimit(m.uplink),Ft(A=this._bindEnabledTracks).call(A,p)===-1&&(p.addListener(he.NEED_ADD_TRACK,this._handleLocalTrackEnable),p.addListener(he.NEED_REMOVE_TRACK,this._handleLocalTrackDisable),this._bindEnabledTracks.push(p),Gr()&&p.muted&&S.debug(O(E="[".concat(this._clientId,"] on firefox publish a muted track ")).call(E,p.getTrackId(),", skip the pub operation and wait unmute")))}),Gr()&&(t=kt(t).call(t,p=>!p.muted)).length===0)return void d.onSuccess(ft(t).call(t,p=>p.trackMediaType+":"+p.getTrackLabel()).toString());const h=await this._publishMutex.lock();try{const p=await this._publishHighStream(t),A=(p.audioTrack,p.videoTrack);this._isDualStreamEnabled&&A&&!this._lowStream&&await this._publishLowStream(A),h(),d.onSuccess(ft(t).call(t,m=>m.trackMediaType+":"+m.getTrackLabel()).toString())}catch(p){throw h(),n&&G(t).call(t,A=>{var m,E;const v=Ft(m=this._bindEnabledTracks).call(m,A);v!==-1&&(A.off(he.NEED_ADD_TRACK,this._handleLocalTrackEnable),A.off(he.NEED_REMOVE_TRACK,this._handleLocalTrackDisable),Ye(E=this._bindEnabledTracks).call(E,v,1))}),d.onError(p),S.error("[".concat(this._clientId,"] publish error"),p.toString()),p}S.info(O(c="[".concat(this._clientId,"] Publish success, id ")).call(c,ft(t).call(t,p=>"".concat(p.getTrackId()," "))))}async unpublish(t,n=!0){var s;const c=await this._publishMutex.lock();let d,h,p;try{var A,m;if(!this._highStream)return S.warning("[".concat(this._clientId,"] Could not find tracks to unpublish")),void(c&&c());if(d=this._highStream.getAllTracks(),t?$r(t)||(t=[t]):t=this._highStream.getAllTracks(),h=function(E,v){if(E.length!==v.length)return!1;for(let C=0;C<E.length;C+=1){const b=E[C];if(kt(E).call(E,y=>y===b).length!==kt(v).call(v,y=>y===b).length)return!1}return!0}(d,t),p=bt.reportApiInvoke(this._sessionId,{name:de.UNPUBLISH,options:ft(t).call(t,E=>E.getTrackId()),tag:Zt.TRACER}),S.info(O(A=O(m="[".concat(this._clientId,"] Unpublish tracks, tracks ")).call(m,ft(t).call(t,E=>"".concat(E.getTrackId()," ")),", isClosePC: ")).call(A,h)),!this._highStream)return S.warning("[".concat(this._clientId,"] Could not find tracks to unpublish")),void(c&&c())}catch(E){throw c&&c(),E}try{this._lowStream&&kt(t).call(t,E=>E.trackMediaType==="video").length>0&&(await this._lowStream.closeP2PConnection(),this._lowStream=void 0),h?await this._highStream.closeP2PConnection():await this._highStream.removeTracks(t,n),c&&c()}catch(E){if(E.code!==L.OPERATION_ABORTED)throw p.onError(E),S.error("[".concat(this._clientId,"] unpublish error"),E.toString()),c&&c(),E;S.debug("[".concat(this._clientId,"] ignore unpub operation abort")),c&&c()}this._highStream&&this._highStream.connectionState==="disconnected"&&(this._highStream=void 0,this._lowStream=void 0),n&&G(t).call(t,E=>{var v,C;const b=Ft(v=this._bindEnabledTracks).call(v,E);b!==-1&&(E.off(he.NEED_ADD_TRACK,this._handleLocalTrackEnable),E.off(he.NEED_REMOVE_TRACK,this._handleLocalTrackDisable),Ye(C=this._bindEnabledTracks).call(C,b,1))}),S.info(O(s="[".concat(this._clientId,"] Unpublish success,tracks ")).call(s,ft(t).call(t,E=>"".concat(E.getTrackId())))),p.onSuccess()}async subscribe(t,n){var s,c,d,h,p;Pr(n,"mediaType",["audio","video"]);const A=bt.reportApiInvoke(this._sessionId,{name:de.SUBSCRIBE,options:[t.uid,n],tag:Zt.TRACER});if(!this._joinInfo){const j=new M(L.INVALID_OPERATION,"Can't subscribe stream, not joined");throw A.onError(j),j}if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING"){const j=new M(L.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));throw A.onError(j),j}if(!_t(s=this._users).call(s,j=>j===t)){var m;const j=new M(L.INVALID_REMOTE_USER,"user is not in the channel");throw S.error(O(m="[".concat(this._clientId,"] can not subscribe ")).call(m,t.uid,", this user is not in the channel")),A.onError(j),j}if(!t.hasAudio&&!t.hasVideo){var E;const j=new M(L.INVALID_REMOTE_USER,"user is not published");throw S.error(O(E="[".concat(this._clientId,"] can not subscribe ")).call(E,t.uid,", user is not published")),A.onError(j),j}const v={audio:n==="audio",video:n==="video"};if(!t.hasAudio&&v.audio||!t.hasVideo&&v.video){var C,b;const j=new M(L.REMOTE_USER_IS_NOT_PUBLISHED);throw S.error(O(C=O(b="[".concat(this._clientId,"] can not subscribe ")).call(b,t.uid," with mediaType ")).call(C,n,", remote track is not published")),A.onError(j),j}let y=this._subscribeMutex.get(t.uid);y||(y=new Un("sub-".concat(t.uid)),this._subscribeMutex.set(t.uid,y)),S.info(O(c=O(d="[".concat(this._clientId,"] subscribe user ")).call(d,t.uid,", mediaType: ")).call(c,n));const w=await y.lock();let k=this._remoteStream.get(t.uid);try{if(k)v.audio=v.audio||k.subscribeOptions.audio,v.video=v.video||k.subscribeOptions.video,await this._gateway.subscribeChange(k,v);else{k=new zL(t,this._statsCollector,this._joinInfo,v),this._remoteStream.set(t.uid,k);try{await this._gateway.subscribe(k)}catch(j){throw this._remoteStream.delete(t.uid),j}k.on(ae.CONNECTION_STATE_CHANGE,(j,st)=>{j==="connecting"?this.emit(be.MEDIA_RECONNECT_START,t.uid):j==="connected"&&this.emit(be.MEDIA_RECONNECT_END,t.uid)})}w()}catch(j){var P;throw A.onError(j),w(),S.error(O(P="[".concat(this._clientId,"] subscribe user ")).call(P,t.uid," error"),j),j}S.info(O(h=O(p="[".concat(this._clientId,"] subscribe success user ")).call(p,t.uid,", mediaType: ")).call(h,n)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(j=>{S.warning("[".concat(this._clientId,"] auto set fallback failed"),j)});const V=n==="audio"?t.audioTrack:t.videoTrack;if(!V){const j=new M(L.UNEXPECTED_ERROR,"can not find remote track in user object");return A.onError(j),j.throw()}return A.onSuccess(V.getTrackId()),V}async unsubscribe(t,n){var s,c,d,h,p;n&&Pr(n,"mediaType",["audio","video"]);const A=bt.reportApiInvoke(this._sessionId,{name:de.UNSUBSCRIBE,options:[t.uid,n],tag:Zt.TRACER});if(!_t(s=this._users).call(s,k=>k===t)){var m;const k=new M(L.INVALID_REMOTE_USER,"user is not in the channel");throw S.error(O(m="[".concat(this._clientId,"] can not subscribe ")).call(m,t.uid,", user is not in the channel")),A.onError(k),k}S.info(O(c=O(d="[".concat(this._clientId,"] unsubscribe uid: ")).call(d,t.uid,", mediaType: ")).call(c,n));let E=this._subscribeMutex.get(t.uid);E||(E=new Un("sub-".concat(t.uid)),this._subscribeMutex.set(t.uid,E));const v=await E.lock(),C=this._remoteStream.get(t.uid);var b;if(!C)return S.warning(O(b="[".concat(this._clientId,"]: you have not subscribe the remote user ")).call(b,t.uid)),A.onSuccess(),void v();const y=xl({},C.subscribeOptions);n==="audio"?y.audio=!1:n==="video"?(y.video=!1,C.pc._statsFilter.setVideoIsReady(!1)):(y.audio=!1,y.video=!1);try{y.audio||y.video?await this._gateway.subscribeChange(C,y):(await C.closeP2PConnection(),this._remoteStream.delete(t.uid)),v()}catch(k){var w;if(k.code!==L.OPERATION_ABORTED)throw A.onError(k),v(),S.error(O(w="[".concat(this._clientId,"] unsubscribe user ")).call(w,t.uid," error"),k.toString()),k;v(),S.debug("[".concat(this._clientId,"] ignore unsub operation abort"))}S.info(O(h=O(p="[".concat(this._clientId,"] unsubscribe success uid: ")).call(p,t.uid,", mediaType: ")).call(h,n)),A.onSuccess()}setLowStreamParameter(t){(function(c){if(!c)throw new M(Ze.INVALID_PARAMS);er(c.width)||Ie(c.width,"streamParameter.width"),er(c.height)||Ie(c.height,"streamParameter.height"),er(c.framerate)||Ie(c.framerate,"streamParameter.framerate"),er(c.bitrate)||Ie(c.bitrate,"streamParameter.bitrate")})(t);const n=bt.reportApiInvoke(this._sessionId,{name:de.SET_LOW_STREAM_PARAMETER,options:[t],tag:Zt.TRACER});(!t.width&&t.height||t.width&&!t.height)&&S.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),S.info("[".concat(this._clientId,"] set low stream parameter to"),ht(t));const s=this._configDistribute.getLowStreamConfigDistribute();s&&s.bitrate&&t.bitrate&&s.bitrate<t.bitrate&&(t.bitrate=s.bitrate),this._lowStreamParameter=t,n.onSuccess()}async enableDualStream(){const t=bt.reportApiInvoke(this._sessionId,{name:de.ENABLE_DUAL_STREAM,options:[],tag:Zt.TRACER});if(!Dr().supportDualStream){bt.streamSwitch(this._sessionId,{lts:pt(),isdual:!0,succ:!1});const n=new M(L.NOT_SUPPORTED,"Your browser is not support dual stream");throw t.onError(n),n}if(this._isDualStreamEnabled){const n=new M(L.INVALID_OPERATION,"Dual stream is already enabled");throw t.onError(n),n}if(this._highStream&&this._highStream.connectionState==="connected"&&this._highStream.videoTrack)try{await this._publishLowStream(this._highStream.videoTrack)}catch(n){throw bt.streamSwitch(this._sessionId,{lts:pt(),isdual:!0,succ:!1}),t.onError(n),n}this._isDualStreamEnabled=!0,bt.streamSwitch(this._sessionId,{lts:pt(),isdual:!0,succ:!0}),S.info("[".concat(this._clientId,"] enable dual stream")),t.onSuccess()}async disableDualStream(){const t=bt.reportApiInvoke(this._sessionId,{name:de.DISABLE_DUAL_STREAM,options:[],tag:Zt.TRACER});if(this._lowStream)try{await this._lowStream.closeP2PConnection()}catch(n){throw bt.streamSwitch(this._sessionId,{lts:pt(),isdual:!1,succ:!1}),t.onError(n),n}this._lowStream=void 0,this._isDualStreamEnabled=!1,this._highStream&&(this._highStream.lowStreamConnection=void 0),bt.streamSwitch(this._sessionId,{lts:pt(),isdual:!1,succ:!0}),S.info("[".concat(this._clientId,"] disable dual stream")),t.onSuccess()}async setClientRole(t,n){(function(h){Pr(h,"role",["audience","host"])})(t),n&&MT(n);const s=bt.reportApiInvoke(this._sessionId,{name:de.SET_CLIENT_ROLE,options:[t,n],tag:Zt.TRACER});if(this._mode==="rtc"){S.warning("[".concat(this._clientId,"]rtc mode can not use setClientRole"));const h=new M(L.INVALID_OPERATION,"rtc mode can not use setClientRole");return s.onError(h),h.throw()}if(n&&n.level&&t==="host"){const h=new M(L.INVALID_OPERATION,"host mode can not set audience latency level");return s.onError(h),h.throw()}try{var c,d;if(t==="audience"&&this._highStream){const h=new M(L.INVALID_OPERATION,"can not set client role to audience when publishing stream");return s.onError(h),h.throw()}await this._gateway.setClientRole(t,n),S.info(O(c=O(d="[".concat(this._clientId,"] set client role to ")).call(d,t,", level: ")).call(c,n&&n.level)),s.onSuccess()}catch(h){throw s.onError(h),h}}setProxyServer(t){if(pr(t,"proxyServer"),this.connectionState!=="DISCONNECTED")throw new M(L.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new M(L.INVALID_OPERATION,"You have already set the proxy");this._proxyServer=t,bt.setProxyServer(this._proxyServer),S.setProxyServer(this._proxyServer)}setTurnServer(t){if($r(t)||(t=[t]),this.connectionState!=="DISCONNECTED")throw new M(L.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new M(L.INVALID_OPERATION,"You have already set the proxy");var n;if(function(s){if(!$r(s)||s.length<1)return!1;try{G(s).call(s,c=>{if(!c.urls)throw Error()})}catch{return!1}return!0}(t))return this._turnServer={servers:t,mode:"original-manual"},void S.info(O(n="[".concat(this._clientId,"] Set original turnserver success: ")).call(n,ft(t).call(t,s=>s.urls).join(","),"."));G(t).call(t,s=>LT(s)),this._turnServer={servers:t,mode:"manual"},S.info("[".concat(this._clientId,"] Set turnserver success."))}startProxyServer(t){const n=bt.reportApiInvoke(this._sessionId,{name:de.START_PROXY_SERVER,options:[],tag:Zt.TRACER});if(this.connectionState!=="DISCONNECTED"){const c=new M(L.INVALID_OPERATION,"Start proxy server before join channel");throw n.onError(c),c}if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint){const c=new M(L.INVALID_OPERATION,"You have already set the proxy");throw n.onError(c),c}const s=[1,2,3,4,5];switch(t===void 0&&(t=1),t){case 1:this._cloudProxyServerMode="normal";break;case 2:this._cloudProxyServerMode="443only";break;case 3:this._cloudProxyServerMode="proxy3";break;case 4:this._cloudProxyServerMode="proxy4";break;case 5:this._cloudProxyServerMode="proxy5";break;default:{const c=new M(L.INVALID_PARAMS,"proxy server mode must be ".concat(s.join("|")));throw n.onError(c),c}}S.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),n.onSuccess()}stopProxyServer(){const t=bt.reportApiInvoke(this._sessionId,{name:de.STOP_PROXY_SERVER,options:[],tag:Zt.TRACER});if(this.connectionState!=="DISCONNECTED")throw new M(L.INVALID_OPERATION,"Stop proxy server after leave channel");bt.setProxyServer(),S.setProxyServer(),this._cloudProxyServerMode="disabled",S.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]},t.onSuccess()}setLocalAccessPoints(t,n){if(Uh(t,"serverList"),pr(n,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new M(L.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const s=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;t=ft(t).call(t,c=>{var d;return s.test(c)?O(d="".concat(c.replace(/\./g,"-"),".")).call(d,n):c}),this._useLocalAccessPoint=!0,jr("WEBCS_DOMAIN",t),jr("WEBCS_DOMAIN_BACKUP_LIST",t),jr("GATEWAY_DOMAINS",[n]),jr("EVENT_REPORT_DOMAIN",t[0]),jr("EVENT_REPORT_BACKUP_DOMAIN",t[1]||t[0]),jr("LOG_UPLOAD_SERVER","".concat(t[0],":6444")),S.info("set local access point success")}async setRemoteVideoStreamType(t,n){var s,c;Pr(n,"streamType",[0,1]);const d=bt.reportApiInvoke(this._sessionId,{name:de.SET_REMOTE_VIDEO_STREAM_TYPE,options:[t,n],tag:Zt.TRACER});try{await this._gateway.setRemoteVideoStreamType(t,n),vn(()=>{var h;const p=_t(h=this._users).call(h,A=>A.uid===t);p&&p.videoTrack&&p.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(h){throw d.onError(h),S.error("[".concat(this._clientId,"] set remote video stream type error"),h.toString()),h}S.info(O(s=O(c="[".concat(this._clientId,"] set remote ")).call(c,t," video stream type to ")).call(s,n)),this._remoteStreamTypeCacheMap.set(t,n),d.onSuccess()}async setStreamFallbackOption(t,n){var s,c;Pr(n,"fallbackType",[0,1,2]);const d=bt.reportApiInvoke(this._sessionId,{name:de.SET_STREAM_FALLBACK_OPTION,options:["too long to show",n],tag:Zt.TRACER});try{await this._gateway.setStreamFallbackOption(t,n)}catch(h){throw d.onError(h),S.error("[".concat(this._clientId,"] set stream fallback option"),h.toString()),h}S.info(O(s=O(c="[".concat(this._clientId,"] set remote ")).call(c,t," stream fallback type to ")).call(s,n)),this._streamFallbackTypeCacheMap.set(t,n),d.onSuccess()}setEncryptionConfig(t,n,s){(function(d){Pr(d,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(t),pr(n,"secret");const c=["aes-128-gcm2","aes-256-gcm2"];if(zt(c).call(c,t)){if(!s||!(s instanceof Uint8Array&&s.length===32))throw new M(L.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(s)throw new M(L.INVALID_PARAMS,"current encrypt mode does not need salt");new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(n)||S.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=t,this._encryptionSecret=n,s&&(this._encryptionSalt=vc(s))}async renewToken(t){pr(t,"token",1,2047);const n=bt.reportApiInvoke(this._sessionId,{name:de.RENEW_TOKEN,options:[t],tag:Zt.TRACER});if(!this._key){const s=new M(L.INVALID_OPERATION,"renewToken should not be called before user join");return n.onError(s),s.throw()}this._key=t;try{await this._gateway.renewToken(t)}catch(s){throw n.onError(s),S.error("[".concat(this._clientId,"] renewToken failed"),s.toString()),s}S.debug("[".concat(this._clientId,"] renewToken success")),n.onSuccess()}enableAudioVolumeIndicator(){const t=bt.reportApiInvoke(this._sessionId,{name:de.ENABLE_AUDIO_VOLUME_INDICATOR,options:[],tag:Zt.TRACER});if(this._audioVolumeIndicationInterval)return S.warning("you have already enabled audio volume indicator!"),t.onSuccess();this._audioVolumeIndicationInterval=window.setInterval(()=>{var n,s,c;let d=xa(n=ft(s=Fe(ua(c=this._remoteStream).call(c))).call(s,h=>({level:h.user.audioTrack?100*h.user.audioTrack._source.getAccurateVolumeLevel():0,uid:h.getUserId()}))).call(n,(h,p)=>h.level-p.level);this._highStream&&this._highStream.audioTrack&&(d.push({level:100*this._highStream.audioTrack._source.getAccurateVolumeLevel(),uid:this._highStream._userId}),d=xa(d).call(d,(h,p)=>h.level-p.level)),this.emit(be.VOLUME_INDICATOR,d)},ot("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3),t.onSuccess()}getRTCStats(){const t=this._statsCollector.getRTCStats(),n=this._gateway.getInChannelInfo();return t.Duration=Math.round(n.duration/1e3),t}startLiveStreaming(t,n){const s=bt.reportApiInvoke(this._sessionId,{name:de.START_LIVE_STREAMING,options:[t,n],tag:Zt.TRACER});if(!n){if(this._codec!=="h264"){const d=new M(L.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");return s.onError(d),dt.reject(d)}if(!this._highStream){const d=new M(L.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming");return s.onError(d),dt.reject(d)}}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t)){const d=new M(L.LIVE_STREAMING_TASK_CONFLICT);return s.onError(d),dt.reject(d)}const c=n?Ho.TRANSCODE:Ho.RAW;return this._createLiveStreamingClient(c).startLiveStreamingTask(t,c).then(()=>s.onSuccess()).catch(d=>{throw s.onError(d),d})}setLiveTranscoding(t){const n=bt.reportApiInvoke(this._sessionId,{name:de.SET_LIVE_TRANSCODING,options:[t],tag:Zt.TRACER});return this._createLiveStreamingClient(Ho.TRANSCODE).setTranscodingConfig(t).then(()=>n.onSuccess()).catch(s=>{throw n.onError(s),s})}stopLiveStreaming(t){var n;const s=bt.reportApiInvoke(this._sessionId,{name:de.STOP_LIVE_STREAMING,options:[t],tag:Zt.TRACER}),c=kt(n=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient]).call(n,d=>d&&d.hasUrl(t));if(!c.length){const d=new M(L.INVALID_PARAMS,"can not find live streaming url to stop");return s.onError(d),dt.reject(d)}return dt.all(ft(c).call(c,d=>d&&d.stopLiveStreamingTask(t))).then(()=>s.onSuccess()).catch(d=>{throw s.onError(d),d})}async addInjectStreamUrl(t,n){const s=bt.reportApiInvoke(this._sessionId,{name:de.ADD_INJECT_STREAM_URL,options:[t,n],tag:Zt.TRACER});try{if(!this._joinInfo)throw new M(L.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");const c=this._createLiveStreamingClient(Ho.INJECT);c.setInjectStreamConfig(n,0),await c.startLiveStreamingTask(t,Ho.INJECT)}catch(c){throw s.onError(c),c}s.onSuccess()}async removeInjectStreamUrl(){const t=bt.reportApiInvoke(this._sessionId,{name:de.REMOVE_INJECT_STREAM_URL,options:[],tag:Zt.TRACER});try{var n,s;const c=this._createLiveStreamingClient(Ho.INJECT),d=_t(n=Fe(ua(s=c.streamingTasks).call(s))).call(n,h=>h.mode===Ho.INJECT);if(!this._joinInfo||!d)throw new M(L.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");await c.stopLiveStreamingTask(d.url)}catch(c){throw t.onError(c),c}t.onSuccess()}async startChannelMediaRelay(t){const n=bt.reportApiInvoke(this._sessionId,{name:de.START_CHANNEL_MEDIA_RELAY,options:[t],tag:Zt.TRACER});try{Ep(t),await this._createChannelMediaRelayClient().startChannelMediaRelay(t)}catch(s){return n.onError(s),s.throw()}n.onSuccess()}async updateChannelMediaRelay(t){const n=bt.reportApiInvoke(this._sessionId,{name:de.UPDATE_CHANNEL_MEDIA_RELAY,options:[t],tag:Zt.TRACER});try{Ep(t),await this._createChannelMediaRelayClient().updateChannelMediaRelay(t)}catch(s){return n.onError(s),s.throw()}n.onSuccess()}async stopChannelMediaRelay(){const t=bt.reportApiInvoke(this._sessionId,{name:de.STOP_CHANNEL_MEDIA_RELAY,options:[],tag:Zt.TRACER});try{await this._createChannelMediaRelayClient().stopChannelMediaRelay()}catch(n){return t.onError(n),n.throw()}t.onSuccess()}sendStreamMessage(t,n=!0){if(!this._joinInfo)throw new M(L.INVALID_OPERATION,"can not send data stream, not joined");if(typeof t=="string"&&(t=new TextEncoder().encode(t)),new Blob([t]).size>1024)throw new M(L.INVALID_PARAMS,"stream message out of range.");return this._gateway.signal.request(Ar.DATA_STREAM,{payload:vc(t)},!n)}sendMetadata(t){if(!this._joinInfo)throw new M(L.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([t]).size>1024)throw new M(L.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Ar.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:vc(t)})}async sendCustomReportMessage(t){$r(t)||(t=[t]),G(t).call(t,DL);const n=bt.reportApiInvoke(this._sessionId,{name:de.SEND_CUSTOM_REPORT_MESSAGE,options:[ht(t)],tag:Zt.TRACER});if(!this._joinInfo){const s=new M(L.INVALID_OPERATION,"can not send custom report, not joined");return n.onError(s),s.throw()}await bt.sendCustomReportMessage(this._joinInfo.sid,t),n.onSuccess()}getLocalAudioStats(){if(!this._highStream)return GT;const t=this._statsCollector.getLocalAudioTrackStats(this._highStream.connectionId);return Pi()&&this._highStream&&this._highStream.audioTrack&&(this._highStream.audioTrack instanceof ci?!this._highStream.audioTrack.isActive:!this._highStream.audioTrack.enabled)&&(t.sendVolumeLevel=0),t}getRemoteAudioStats(){var t;const n={};return G(t=this._remoteStream).call(t,(s,c)=>{n[c]=this._statsCollector.getRemoteAudioTrackStats(s.connectionId)}),n}getLocalVideoStats(){return this._highStream?this._statsCollector.getLocalVideoTrackStats(this._highStream.connectionId):jT}getRemoteVideoStats(){var t;const n={};return G(t=this._remoteStream).call(t,(s,c)=>{n[c]=this._statsCollector.getRemoteVideoTrackStats(s.connectionId)}),n}getRemoteNetworkQuality(){var t;const n={};return G(t=this._remoteStream).call(t,(s,c)=>{n[c]=this._statsCollector.getRemoteNetworkQualityStats(s.connectionId)}),n}async pickSVCLayer(t,n){Pr(n.spatialLayer,"spatialLayer",[0,1,2,3]),Pr(n.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(t,n)}catch(s){throw S.error("[".concat(this._clientId,"] pick SVC layer failed"),s.toString()),s}}_reset(){var t,n,s;S.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=Lo.CancelToken.source(),this._streamFallbackTypeCacheMap=new re,this._remoteStreamTypeCacheMap=new re,this._configDistribute.stopGetConfigDistribute(),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,G(t=this._users).call(t,c=>{c.audioTrack&&(c.audioTrack.stop(),c.audioTrack._isDestroyed=!0),c.videoTrack&&(c.videoTrack.stop(),c.videoTrack._isDestroyed=!0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._highStream&&(this._highStream.closeP2PConnection(!0),this._highStream=void 0),G(n=this._bindEnabledTracks).call(n,c=>{c.off(he.NEED_ADD_TRACK,this._handleLocalTrackEnable),c.off(he.NEED_REMOVE_TRACK,this._handleLocalTrackDisable)}),this._bindEnabledTracks=[],this._lowStream&&(this._lowStream.closeP2PConnection(!0),this._lowStream=void 0),G(s=this._remoteStream).call(s,c=>{c.closeP2PConnection(!0)}),this._remoteStream=new re,this._publishMutex=new Un("client-publish"),this._subscribeMutex=new re,this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0)}_startSession(t,n){var s,c,d;const h=t||tp();t?S.debug(O(s="[".concat(this._clientId,"] new Session ")).call(s,h)):S.debug(O(c=O(d="[".concat(this._clientId,"] renewSession ")).call(d,this._sessionId," => ")).call(c,h)),this._sessionId=h,n?bt.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:n.channel,appid:n.appId,mode:this._mode}):this._joinInfo?bt.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:this._joinInfo.cname,appid:this._joinInfo.appId,mode:this._mode}):this._gateway.joinInfo&&bt.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId,mode:this._mode}),this._joinInfo&&(this._joinInfo.sid=h),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=h)}async _publishHighStream(t){if(!this._joinInfo)throw new M(L.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new M(L.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&ot("FORCE_TURN")&&!ot("TURN_ENABLE_TCP")&&!ot("TURN_ENABLE_UDP"))throw new M(L.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");if(S.debug("[".concat(this._clientId,"] publish high stream")),this._highStream)return await this._highStream.addTracks(t),this._highStream;this._highStream=new R1(this._statsCollector,this._joinInfo,this._codec),this._highStream.on(ae.P2P_LOST,()=>{this._highStream&&this.emit(be.P2P_LOST,this._highStream.getUserId())}),await this._highStream.addTracks(t);try{await this._gateway.publish(this._highStream,"high")}catch(n){throw this._highStream=void 0,n}return this._highStream.on(ae.CONNECTION_STATE_CHANGE,(n,s)=>{this._highStream&&(n==="connected"?this.emit(be.MEDIA_RECONNECT_END,this._highStream.getUserId()):n==="connecting"&&this.emit(be.MEDIA_RECONNECT_START,this._highStream.getUserId()))}),this._highStream}async _publishLowStream(t){if(!this._joinInfo)throw new M(L.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new M(L.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(!this._highStream||this._highStream.connectionState!=="connected")throw new M(L.UNEXPECTED_ERROR,"Could not find high stream");if(this._lowStream)return new M(L.UNEXPECTED_ERROR,"[".concat(this._clientId,"] Can't publish low stream when stream already publish")).throw();S.debug("[".concat(this._clientId,"] publish low stream")),this._lowStream=new R1(this._statsCollector,this._joinInfo,this._codec,!0);const n=this._configDistribute.getLowStreamConfigDistribute();n&&n.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&n.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=n.bitrate)),this._lowStream.lowStreamParameter=this._lowStreamParameter,await this._lowStream.addTracks([t]);try{await this._gateway.publish(this._lowStream,"low")}catch(s){throw this._lowStream=void 0,s}this._highStream.lowStreamConnection=this._lowStream}_createLiveStreamingClient(t){if(!this._joinInfo||!this._appId)return new M(L.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const n=()=>new Uy(this._joinInfo,this._config.websocketRetryConfig||Ne,this._config.httpRetryConfig||Ne),s=c=>{c.onLiveStreamError=(d,h)=>{bt.reportApiInvoke(this._sessionId,{name:de.ON_LIVE_STREAM_ERROR,options:[d,h],tag:Zt.TRACER}).onSuccess(),this.emit(be.LIVE_STREAMING_ERROR,d,h)},c.onLiveStreamWarning=(d,h)=>{bt.reportApiInvoke(this._sessionId,{name:de.ON_LIVE_STREAM_WARNING,options:[d,h],tag:Zt.TRACER}).onSuccess(),this.emit(be.LIVE_STREAMING_WARNING,d,h)},c.on(kp.REQUEST_WORKER_MANAGER_LIST,(d,h,p)=>{if(!this._joinInfo)return p(new M(L.INVALID_OPERATION,"can not find join info to get worker manager"));f1(d,this._joinInfo,this._axiosCancelSource.token,Ne).then(h).catch(p)})};switch(t){case Ho.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=n(),s(this._liveRawStreamingClient)),this._liveRawStreamingClient;case Ho.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=n(),s(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case Ho.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=n(),this._injectStreamingClient.on(kp.REQUEST_WORKER_MANAGER_LIST,(c,d,h)=>{if(!this._joinInfo)return h(new M(L.INVALID_OPERATION,"can not find join info to get worker manager"));f1(c,this._joinInfo,this._axiosCancelSource.token,Ne).then(d).catch(h)}),this._injectStreamingClient.onInjectStatusChange=(c,d,h)=>{this.emit(be.INJECT_STREAM_STATUS,c,d,h)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){return this._joinInfo?(this._channelMediaRelayClient||(this._channelMediaRelayClient=new Fy(this._joinInfo,this._clientId,this._config.websocketRetryConfig||Ne,this._config.httpRetryConfig||Ne),this._channelMediaRelayClient.on("state",t=>{t==="RELAY_STATE_FAILURE"&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.emit(be.CHANNEL_MEDIA_RELAY_STATE,t)}),this._channelMediaRelayClient.on("event",t=>{this.emit(be.CHANNEL_MEDIA_RELAY_EVENT,t)})),this._channelMediaRelayClient):new M(L.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw()}_handleGatewayEvents(){this._gateway.on(Ir.DISCONNECT_P2P,()=>{var t;S.debug("[".concat(this._clientId,"] start full reconnect")),this._highStream&&this._highStream.connectionState!=="disconnected"&&(S.debug("[".concat(this._clientId,"] ready to reconnect high stream")),this._highStream.readyToReconnectPC()),this._lowStream&&this._lowStream.connectionState!=="disconnected"&&(S.debug("[".concat(this._clientId,"] ready to reconnect low stream")),this._lowStream.readyToReconnectPC()),G(t=this._remoteStream).call(t,(n,s)=>{var c;S.debug(O(c="[".concat(this._clientId,"] ready to reconnect remote stream ")).call(c,s)),n.readyToReconnectPC()})}),this._gateway.on(Ir.CONNECTION_STATE_CHANGE,(t,n,s)=>{var c,d;const h=()=>{this.emit(be.CONNECTION_STATE_CHANGE,t,n,s)};if(S.info(O(c=O(d="[".concat(this._clientId,"] connection state change: ")).call(d,n," -> ")).call(c,t)),t==="DISCONNECTED")return this._reset(),void h();var p,A;if(t==="RECONNECTING")this._highStream&&this._highStream.connectionState==="connecting"&&(S.debug("[".concat(this._clientId,"] ready to reconnect high stream")),this._highStream.readyToReconnectPC()),this._lowStream&&this._lowStream.connectionState==="connecting"&&(S.debug("[".concat(this._clientId,"] ready to reconnect low stream")),this._lowStream.readyToReconnectPC()),G(p=this._remoteStream).call(p,(v,C)=>{var b;v.connectionState==="connecting"&&(S.debug(O(b="[".concat(this._clientId,"] ready to reconnect remote stream ")).call(b,C)),v.readyToReconnectPC())}),G(A=this._users).call(A,v=>{v._trust_in_room_=!1,v._trust_audio_enabled_state_=!1,v._trust_video_enabled_state_=!1,v._trust_audio_mute_state_=!1,v._trust_video_mute_state_=!1,v._trust_stream_added_state_=!1}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(t==="CONNECTED"){var m,E;G(m=this._streamFallbackTypeCacheMap).call(m,(v,C)=>{this._gateway.setStreamFallbackOption(C,v).catch(b=>S.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),b))}),G(E=this._remoteStreamTypeCacheMap).call(E,(v,C)=>{this._gateway.setRemoteVideoStreamType(C,v).catch(b=>S.warning("[".concat(this._clientId,"] auto set remote stream type failed"),b))}),this._highStream&&this._highStream.connectionState==="connecting"?this._highStream.reconnectPC().then(()=>{this._lowStream&&this._lowStream.connectionState==="connecting"&&this._lowStream.reconnectPC().catch(v=>{S.error("[".concat(this._clientId,"] republish low stream error"),v.toString()),this.emit(be.ERROR,{reason:v})})}).catch(v=>{S.error("[".concat(this._clientId,"] republish high stream error"),v.toString()),this.emit(be.ERROR,{reason:v})}):this._lowStream&&this._lowStream.connectionState==="connecting"&&this._lowStream.reconnectPC().catch(v=>{S.error("[".concat(this._clientId,"] republish low stream error"),v.toString()),this.emit(be.ERROR,{reason:v})}),this._userOfflineTimeout=window.setTimeout(()=>{var v;if(this.connectionState!=="CONNECTED")return;this._userOfflineTimeout=void 0;const C=kt(v=this._users).call(v,b=>!b._trust_in_room_);G(C).call(C,b=>{var y;S.debug(O(y="[".concat(this._clientId,"] user offline timeout, emit user offline ")).call(y,b.uid)),this._handleUserOffline({uid:b.uid})})},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{var v;this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,G(v=this._users).call(v,C=>{var b,y,w,k,P;C._trust_audio_mute_state_||(S.debug(O(b="[".concat(this._clientId,"] auto dispatch audio unmute event ")).call(b,C.uid)),this._handleMuteStream(C.uid,"audio",!1)),C._trust_video_mute_state_||(S.debug(O(y="[".concat(this._clientId,"] auto dispatch video unmute event ")).call(y,C.uid)),this._handleMuteStream(C.uid,"video",!1)),C._trust_audio_enabled_state_||(S.debug(O(w="[".concat(this._clientId,"] auto dispatch enable local audio ")).call(w,C.uid)),this._handleSetStreamLocalEnable("audio",C.uid,!0)),!C._trust_video_enabled_state_&&C._video_enabled_&&(S.debug(O(k="[".concat(this._clientId,"] auto dispatch enable local video ")).call(k,C.uid)),this._handleSetStreamLocalEnable("video",C.uid,!0)),C._trust_stream_added_state_||(S.debug(O(P="[".concat(this._clientId,"] auto dispatch stream remove ")).call(P,C.uid)),this._handleRemoveStream({uid:C.uid,uint_id:C._uintid}))}))},1e3)}h()}),this._gateway.on(Ir.REQUEST_NEW_GATEWAY_LIST,(t,n)=>{if(!this._joinInfo)return n(new M(L.UNEXPECTED_ERROR,"can not recover, no join info"));au(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Ne).then(s=>{var c;this._joinInfo&&(this._joinInfo.apResponse=s.gatewayInfo.res),t(ft(c=s.gatewayInfo.gatewayAddrs).call(c,d=>{if(this._joinInfo&&this._joinInfo.proxyServer){var h,p;const A=d.split(":");return O(h=O(p="wss://".concat(this._joinInfo.proxyServer,"/ws/?h=")).call(p,A[0],"&p=")).call(h,A[1])}return"wss://".concat(d)}))}).catch(n)}),this._gateway.on(Ir.NETWORK_QUALITY,t=>{this._networkQualitySensitivity==="normal"&&this.emit(be.NETWORK_QUALITY,t)}),this._gateway.on(Ir.STREAM_TYPE_CHANGE,(t,n)=>{this.emit(be.STREAM_TYPE_CHANGED,t,n),bt.reportApiInvoke(this._sessionId,{name:de.STREAM_TYPE_CHANGE,options:[t,n],tag:Zt.TRACER}).onSuccess(ht({uid:t,streamType:n}))}),this._gateway.on(Ir.IS_P2P_DISCONNECTED,t=>{var n,s,c;const d=[];return this._highStream&&d.push(this._highStream),G(n=this._remoteStream).call(n,h=>d.push(h)),d.length===0||kt(d).call(d,h=>h.connectionState==="connected").length===0?t(!0):(S.debug(O(s="[".concat(this._clientId,"] ")).call(s,ft(c=kt(d).call(d,h=>h.connectionState==="connected")).call(c,h=>h.connectionId)," is connected")),void t(!1))}),this._gateway.on(Ir.NEED_RENEW_SESSION,()=>{this._startSession()}),this._gateway.signal.on(ir.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(ir.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(ir.ON_ADD_AUDIO_STREAM,t=>this._handleAddAudioOrVideoStream("audio",t.uid,t.uint_id)),this._gateway.signal.on(ir.ON_ADD_VIDEO_STREAM,t=>this._handleAddAudioOrVideoStream("video",t.uid,t.uint_id)),this._gateway.signal.on(ir.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(ir.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(ir.MUTE_AUDIO,t=>this._handleMuteStream(t.uid,"audio",!0)),this._gateway.signal.on(ir.UNMUTE_AUDIO,t=>this._handleMuteStream(t.uid,"audio",!1)),this._gateway.signal.on(ir.MUTE_VIDEO,t=>this._handleMuteStream(t.uid,"video",!0)),this._gateway.signal.on(ir.UNMUTE_VIDEO,t=>this._handleMuteStream(t.uid,"video",!1)),this._gateway.signal.on(ir.RECEIVE_METADATA,t=>{const n=Wd(t.metadata);this.emit(be.RECEIVE_METADATA,t.uid,n)}),this._gateway.signal.on(ir.ON_DATA_STREAM,t=>{t.seq&&delete t.seq,t.payload=Wd(t.payload),this.emit(be.STREAM_MESSAGE,t.uid,t.payload),this.onStreamMessage&&this.onStreamMessage(t)}),this._gateway.signal.on(ir.ON_CRYPT_ERROR,()=>{ks(()=>{S.warning("[".concat(this._clientId,"] on crypt error")),this.emit(be.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(ir.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(ir.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{S.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._reset(),this._gateway.leave(!0),this.emit(be.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this._gateway.signal.on(ir.ON_STREAM_FALLBACK_UPDATE,t=>{var n,s;S.debug(O(n=O(s="[".concat(this._clientId,"] stream fallback peerId: ")).call(s,t.stream_id,", attr: ")).call(n,t.stream_type)),this.emit(be.STREAM_FALLBACK,t.stream_id,t.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(ir.ON_PUBLISH_STREAM,t=>{var n;this.uid===this._uid&&(this._highStream&&this._highStream._waitingSuccessResponse&&this._highStream.connectionState==="connected"?(this._highStream.reportPublishEvent(!0,null,ht({proxy:t.proxy})),S.info(O(n="[".concat(this._clientId,"] on publish stream, ")).call(n,ht(t))),t.proxy!==void 0&&this.emit(be.IS_USING_CLOUD_PROXY,!!t.proxy)):this._lowStream?this._lowStream.reportPublishEvent(!0,null,ht({proxy:t.proxy})):S.warning("get on_publish_stream message but cannot handle"))}),this._gateway.signal.on(ir.ENABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!0)}),this._gateway.signal.on(ir.DISABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!1)}),this._gateway.signal.on(Oe.REQUEST_TIMEOUT,(t,n)=>{if(this._joinInfo)switch(t){case Ar.PUBLISH:{var s;if(!n)return;const c=n.stream_type==="high"?this._highStream:this._lowStream;if(!c)return;n.state==="offer"&&bt.publish(this._joinInfo.sid,{lts:c.startTime,succ:!1,ec:L.TIMEOUT,audio:n.audio,video:n.video,p2pid:n.p2p_id,publishRequestid:c.ID,screenshare:!(!c.videoTrack||Ft(s=c.videoTrack._hints).call(s,Bs.SCREEN_TRACK)===-1),audioName:c.audioTrack&&(c.audioTrack instanceof ci?c.audioTrack.getSubTrackLabels().join(","):c.audioTrack.getTrackLabel()),videoName:c.videoTrack&&c.videoTrack.getTrackLabel()});break}case Ar.SUBSCRIBE:{const c=n.stream_id,d=this._remoteStream.get(c);if(!d)return;n&&bt.subscribe(this._joinInfo.sid,{lts:d.startTime,succ:!1,ec:L.TIMEOUT,audio:!!n.audio,video:!!n.video,peerid:n.stream_id,subscribeRequestid:d.ID,p2pid:d.pc.ID});break}}})}}async function O1(){let r={audio:[],video:[]};try{let t=new RTCPeerConnection;t.addTransceiver("video",{direction:"recvonly"}),t.addTransceiver("audio",{direction:"recvonly"});const n=(await t.createOffer()).sdp;if(!n)return r;t.close(),t=null,r=function(s){const c={video:[],audio:[]};return s.match(/ VP8/i)&&c.video.push("VP8"),s.match(/ VP9/i)&&c.video.push("VP9"),s.match(/ AV1X/i)&&c.video.push("AV1"),s.match(/ H264/i)&&c.video.push("H264"),s.match(/ opus/i)&&c.audio.push("OPUS"),c}(n)}catch(t){throw new M(L.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return r}function k1(){const r=gt.reportApiInvoke(null,{name:Kt.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Yt.TRACER});let t=!1;try{const d=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,p=window.WebSocket;t=!!(d&&h&&p)}catch(d){return S.error("check system requirement failed: ",d),!1}let n=!1;const s=we();s.name===Re.CHROME&&Number(s.version)>=58&&(!L2()||D2())&&(n=!0),s.name===Re.FIREFOX&&Number(s.version)>=56&&(n=!0),s.name===Re.OPERA&&Number(s.version)>=45&&(n=!0),s.name===Re.SAFARI&&Number(s.version)>=11&&(n=!0),(Oh()||we().name===Re.QQ)&&(n=!0),S.debug("checkSystemRequirements, api:",t,"browser",n);const c=t&&n;return r.onSuccess(c),c}hu([Dp({report:bt}),xi("design:type",Function),xi("design:paramtypes",[String]),xi("design:returntype",void 0)],Fl.prototype,"setProxyServer",null),hu([Dp(),xi("design:type",Function),xi("design:paramtypes",[Object]),xi("design:returntype",void 0)],Fl.prototype,"setTurnServer",null),hu([Dp({report:bt}),xi("design:type",Function),xi("design:paramtypes",[Array,String]),xi("design:returntype",void 0)],Fl.prototype,"setLocalAccessPoints",null),hu([Dp({report:bt}),xi("design:type",Function),xi("design:paramtypes",[String,String,Uint8Array]),xi("design:returntype",void 0)],Fl.prototype,"setEncryptionConfig",null),hu([zT({report:bt}),xi("design:type",Function),xi("design:paramtypes",[Object,Object]),xi("design:returntype",dt)],Fl.prototype,"pickSVCLayer",null);class D1 extends eS{constructor(t,n={}){super(),this.startPlayTime=0,this.startPlayOffset=0,this.pausePlayTime=0,this.currentLoopCount=0,this._currentState="stopped",this.audioBuffer=t,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}set currentState(t){t!==this._currentState&&(this._currentState=t,this.emit(Bo.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer.duration}get currentTime(){return this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:(this.context.currentTime-this.startPlayTime+this.startPlayOffset)%this.audioBuffer.duration}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):S.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}startSourceNode(){var t;this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=Mr(t=this.handleSourceNodeEnded).call(t,this))}createSourceNode(){const t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const L1=new re;async function M1(r,t){let n=null;if(typeof r=="string"){const c=L1.get(r);if(c)return S.debug("use cached audio resource: ",r),c;try{n=(await Zn(()=>Lo.get(r,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(d){throw new M(L.FETCH_AUDIO_FILE_FAILED,d.toString())}}else n=await new dt((d,h)=>{const p=new FileReader;p.onload=A=>{A.target?d(A.target.result):h(new M(L.READ_LOCAL_AUDIO_FILE_ERROR))},p.onerror=()=>{h(new M(L.READ_LOCAL_AUDIO_FILE_ERROR))},p.readAsArrayBuffer(r)});const s=await function(c){const d=ml();return new dt((h,p)=>{d.decodeAudioData(c,A=>{h(A)},A=>{p(new M(L.DECODE_AUDIO_FILE_FAILED,A.toString()))})})}(n);return typeof r=="string"&&t&&L1.set(r,s),s}function P1(r,t){var n=le(r);if(ee){var s=ee(r);t&&(s=kt(s).call(s,function(c){return Wt(r,c).enumerable})),n.push.apply(n,s)}return n}function fm(r){for(var t=1;t<arguments.length;t++){var n,s=arguments[t]!=null?arguments[t]:{};if(t%2)G(n=P1(Object(s),!0)).call(n,function(d){_r(r,d,s[d])});else if(te)He(r,te(s));else{var c;G(c=P1(Object(s))).call(c,function(d){se(r,d,Wt(s,d))})}}return r}function Am(r,t,n,s){n.optimizationMode&&(s&&s.width&&s.height?(n.encoderConfig=fm({},s,{bitrateMin:s.bitrateMin,bitrateMax:s.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?S.debug("[".concat(r,"] set content hint to"),n.optimizationMode):S.debug("[".concat(r,"] set content hint failed")))):S.warning("[".concat(r,"] can not apply optimization mode bitrate config, no encoderConfig")))}function B1(r,t){var n=le(r);if(ee){var s=ee(r);t&&(s=kt(s).call(s,function(c){return Wt(r,c).enumerable})),n.push.apply(n,s)}return n}function gm(r){for(var t=1;t<arguments.length;t++){var n,s=arguments[t]!=null?arguments[t]:{};if(t%2)G(n=B1(Object(s),!0)).call(n,function(d){_r(r,d,s[d])});else if(te)He(r,te(s));else{var c;G(c=B1(Object(s))).call(c,function(d){se(r,d,Wt(s,d))})}}return r}function mm(r,t,n,s){n.optimizationMode&&(s&&s.width&&s.height?(n.encoderConfig=gm({},s,{bitrateMin:s.bitrateMin,bitrateMax:s.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?S.debug("[".concat(r,"] set content hint to"),n.optimizationMode):S.debug("[".concat(r,"] set content hint failed")))):S.warning("[".concat(r,"] can not apply optimization mode bitrate config, no encoderConfig")))}var U1=_e.setInterval;const ZL=we().name,$L=we().name;class pu{constructor(t,n){this.id=0,pu.count+=1,this.id=pu.count,this.element=t,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{const n=document.createElement("audio");n.srcObject=new MediaStream([t.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;const t=async(s,c)=>{const d=c==="offer"?await s.createOffer():await s.createAnswer();return await s.setLocalDescription(d),s.iceGatheringState==="complete"?s.localDescription:new dt(h=>{s.onicegatheringstatechange=()=>{s.iceGatheringState==="complete"&&h(s.localDescription)}})},n=async(s,c)=>await s.setRemoteDescription(c);try{const s=await t(this.peerPair[0],"offer");await n(this.peerPair[1],s);const c=await t(this.peerPair[1],"answer");await n(this.peerPair[0],c)}catch(s){throw new M(L.LOCAL_AEC_ERROR,s.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let n;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(n)}catch(c){throw new M(L.LOCAL_AEC_ERROR,c.toString()).print()}if(!n)throw new M(L.LOCAL_AEC_ERROR,"no dest node when local aec").print();const s=n.stream.getAudioTracks()[0];return this.audioTrack=s,s}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const t=this.element,n=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){var t;S.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&G(t=this.peerPair).call(t,n=>{n.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}pu.count=0;var tM=function(r,t,n,s){var c,d=arguments.length,h=d<3?t:s===null?s=Wt(t,n):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(r,t,n,s);else for(var p=r.length-1;p>=0;p--)(c=r[p])&&(h=(d<3?c(h):d>3?c(t,n,h):c(t,n))||h);return d>3&&h&&se(t,n,h),h},Em=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)};const eM=window.AudioContext||window.webkitAudioContext;class x1{constructor(){this.units=[]}processExternalMediaAEC(t){var n;if(!this._doesEnvironmentNeedAEC())return S.debug("the system does not need to process local aec"),-1;this.context||(this.context=new eM);let s=_t(n=this.units).call(n,c=>c&&c.getElement()===t);return s||(s=new pu(t,this.context),this.units.push(s)),s.startEchoCancellation(),S.debug("start processing local audio echo cancellation, id is",s.id),s.id}_doesEnvironmentNeedAEC(){return we().name!==Re.SAFARI}}tM([Vd({report:gt}),Em("design:type",Function),Em("design:paramtypes",[HTMLAudioElement]),Em("design:returntype",Number)],x1.prototype,"processExternalMediaAEC",null);const rM=new x1;var F1,Q1,V1,G1;function j1(r){return gn.enumerateDevices(!0,!0,r)}function W1(r){return gn.getRecordingDevices(r)}function K1(r){return gn.getCamerasDevices(r)}function H1(r){return gn.getSpeakers(r)}function Y1(){return new xy}function q1(r){S.setLogLevel(r)}function J1(){S.enableLogUpload()}function z1(){S.disableLogUpload()}async function X1(r,t){var n;if(S.debug(O(n="loadModule: ".concat(r.name,", loadOption: ")).call(n,ht(t))),!r.moduleInit)throw S.debug("Invalid Plugin"),new M(L.INVALID_PLUGIN,"invalid plugin");try{await r.moduleInit({logger:S,report:gt},t)}catch(s){throw new M(L.UNEXPECTED_ERROR,"unexpected error in loadModule",s)}}function Z1(r){rM.processExternalMediaAEC(r)}jr("PROCESS_ID",O(F1=O(Q1=O(V1=O(G1="process-".concat(Le(8,""),"-")).call(G1,Le(4,""),"-")).call(V1,Le(4,""),"-")).call(Q1,Le(4,""),"-")).call(F1,Le(12,""))),function(){const r=we();Si.getDisplayMedia=function(t){return!!(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)}(),Si.getStreamFromExtension=r.name===Re.CHROME&&Number(r.version)>34,Si.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t=new RTCPeerConnection;let n=!1;try{t.addTransceiver("audio"),n=!0}catch{}return t.close(),n}(),Si.supportMinBitrate=r.name===Re.CHROME||r.name===Re.EDGE,Si.supportSetRtpSenderParameters=function(){const t=we();return!window.RTCRtpSender||!window.RTCRtpSender.prototype.setParameters||!window.RTCRtpSender.prototype.getParameters?!1:!!cl()||!(!Pi()&&!Od())||t.name===Re.FIREFOX&&Number(t.version)>=64}(),r.name===Re.SAFARI&&(Number(r.version)>=14?Si.supportDualStream=!0:Si.supportDualStream=!1),Si.webAudioMediaStreamDest=function(){const t=we();return!(t.name===Re.SAFARI&&Number(t.version)<12)}(),Si.supportReplaceTrack=function(){return window.RTCRtpSender?typeof RTCRtpSender.prototype.replaceTrack=="function":!1}(),Si.supportWebGL=typeof WebGLRenderingContext!="undefined",Si.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,cl()||(Si.webAudioWithAEC=!0),Si.supportShareAudio=function(){const t=we();return(t.os===Mn.WIN_10||t.os===Mn.WIN_81||t.os===Mn.WIN_7||t.os===Mn.LINUX||t.os===Mn.MAC_OS)&&t.name===Re.CHROME&&Number(t.version)>=74}(),Si.supportDualStreamEncoding=function(){const t=we();return t.name==="Safari"&&Number(t.version)>=14}(),S.info("browser compatibility",ht(Si),ht(r))}(),function(){const r=window.localStorage.getItem("websdk_ng_global_parameter");if(r)try{var t;const n=JSON.parse(window.atob(r)),s=pt();S.debug("Loading global parameters from cache",n),G(t=le(n)).call(t,c=>{if(Object.prototype.hasOwnProperty.call(Ii,c)){const{value:d,expires:h}=n[c];if(h&&h<=s)return;QA[c]=d,Ii[c]=d}})}catch(n){S.error("Error loading mutableParamsCache: ".concat(r),n.message)}}();const nM={__CLIENT_LIST__:ls,__TRACK_LIST__:oa,VERSION:Pn,BUILD:dl,setParameter:jr,getParameter:ot,getSupportedCodec:O1,checkSystemRequirements:k1,getDevices:j1,getMicrophones:W1,getCameras:K1,getElectronScreenSources:sg,getPlaybackDevices:H1,createClient:function(r={codec:"vp8",mode:"rtc"}){const t=gt.reportApiInvoke(null,{name:Kt.CREATE_CLIENT,options:[r],tag:Yt.TRACER});try{(function(n){Pr(n.codec,"config.codec",["vp8","vp9","av1","h264"]),Pr(n.mode,"config.mode",["rtc","live"]),n.proxyServer!==void 0&&pr(n.proxyServer,"config.proxyServer",1,1e4),n.turnServer!==void 0&&wC(n.turnServer),n.httpRetryConfig!==void 0&&RC(n.httpRetryConfig),n.websocketRetryConfig!==void 0&&RC(n.websocketRetryConfig)})(r)}catch(n){throw t.onError(n),n}return t.onSuccess(),new Ll(im({forceWaitGatewayResponse:!0},r,{role:r.mode==="rtc"?"host":r.role}))},createCameraVideoTrack:async function(r={encoderConfig:"480p_1"}){const t=gt.reportApiInvoke(null,{tag:Yt.TRACER,name:Kt.CREATE_CAM_VIDEO_TRACK,options:[fm({},r)]}),n=wl(r),s=Le(8,"track-cam-");let c=null;S.info("start create camera video track with config",ht(r),"trackId",s);try{c=(await nn({video:n},s)).getVideoTracks()[0]||null}catch(h){throw t.onError(h),h}if(!c){const h=new M(L.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(h),h.throw()}r.optimizationMode&&Am(s,c,r,r.encoderConfig&&cs(r.encoderConfig));const d=new Zd(c,r,n,r.scalabiltyMode?Ua(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,s);return t.onSuccess(d.getTrackId()),S.info("create camera video success, trackId:",s),d},createCustomVideoTrack:function(r){const t=gt.reportApiInvoke(null,{tag:Yt.TRACER,name:Kt.CREATE_CUSTOM_VIDEO_TRACK,options:[r]}),n=new dr(r.mediaStreamTrack,{bitrateMax:r.bitrateMax,bitrateMin:r.bitrateMin},r.scalabiltyMode?Ua(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode);return t.onSuccess(n.getTrackId()),S.info("create custom video track success with config",r,"trackId",n.getTrackId()),n},createScreenVideoTrack:async function(r={},t="disable"){const n=gt.reportApiInvoke(null,{tag:Yt.TRACER,name:Kt.CREATE_SCREEN_VIDEO_TRACK,options:[fm({},r),t]});r.encoderConfig?typeof r.encoderConfig=="string"||r.encoderConfig.width&&r.encoderConfig.height||(r.encoderConfig.width={max:1920},r.encoderConfig.height={max:1080}):r.encoderConfig="1080p_2";const s=Ky(r),c=Le(8,"track-scr");let d=null,h=null;const p=Dr();if(!p.supportShareAudio&&t==="enable"){const E=new M(L.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return n.onError(E),E.throw()}S.info("start create screen video track with config",r,"withAudio",t,"trackId",c);try{const E=await nn({screen:s,screenAudio:t==="auto"?p.supportShareAudio:t==="enable"},c);d=E.getVideoTracks()[0]||null,h=E.getAudioTracks()[0]||null}catch(E){throw n.onError(E),E}if(!d){const E=new M(L.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(E),E.throw()}if(!h&&t==="enable"){d&&d.stop();const E=new M(L.SHARE_AUDIO_NOT_ALLOWED);return n.onError(E),E.throw()}r.optimizationMode||(r.optimizationMode="detail"),r.optimizationMode&&(Am(c,d,r,r.encoderConfig&&Md(r.encoderConfig)),r.encoderConfig&&typeof r.encoderConfig!="string"&&(r.encoderConfig.bitrateMin=r.encoderConfig.bitrateMax));const A=new dr(d,r.encoderConfig?Md(r.encoderConfig):{},r.scalabiltyMode?Ua(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,c);if(A._hints.push(Xn.SCREEN_TRACK),!h)return n.onSuccess(A.getTrackId()),S.info("create screen video track success","video:",A.getTrackId()),A;const m=new qr(h);return n.onSuccess([A.getTrackId(),m.getTrackId()]),S.info("create screen video track success","video:",A.getTrackId(),"audio:",m.getTrackId()),[A,m]},createMicrophoneAndCameraTracks:async function(r={},t={encoderConfig:"480p_1"}){var n,s,c,d;const h=gt.reportApiInvoke(null,{tag:Yt.TRACER,name:Kt.CREATE_MIC_AND_CAM_TRACKS,options:[r,t]}),p=wl(t),A=Ip(r),m=Le(8,"track-mic-"),E=Le(8,"track-cam-");let v=null,C=null;S.info(O(n=O(s=O(c="start create camera video track(".concat(E,") and microphone audio track(")).call(c,m,") with config, audio: ")).call(s,ht(r),", video: ")).call(n,ht(t)));try{var b;const k=await nn({audio:A,video:p},O(b="".concat(m,"-")).call(b,E));v=k.getAudioTracks()[0],C=k.getVideoTracks()[0]}catch(k){throw h.onError(k),k}if(!v||!C){const k=new M(L.UNEXPECTED_ERROR,"can not find tracks in media stream");return h.onError(k),k.throw()}t.optimizationMode&&Am(E,C,t,t.encoderConfig&&cs(t.encoderConfig));const y=new jd(v,r,A,m),w=new Zd(C,t,p,t.scalabiltyMode?Ua(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,E);return h.onSuccess([y.getTrackId(),w.getTrackId()]),S.info(O(d="create camera video track(".concat(E,") and microphone audio track(")).call(d,m,") success")),[y,w]},createMicrophoneAudioTrack:async function(r={}){const t=gt.reportApiInvoke(null,{tag:Yt.TRACER,name:Kt.CREATE_MIC_AUDIO_TRACK,options:[r]}),n=Ip(r),s=Le(8,"track-mic-");let c=null;S.info("start create microphone audio track with config",ht(r),"trackId",s);try{c=(await nn({audio:n},s)).getAudioTracks()[0]||null}catch(h){throw t.onError(h),h}if(!c){const h=new M(L.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(h),h.throw()}const d=new jd(c,r,n,s);return t.onSuccess(d.getTrackId()),S.info("create microphone audio track success, trackId:",s),d},createCustomAudioTrack:function(r){const t=gt.reportApiInvoke(null,{tag:Yt.TRACER,name:Kt.CREATE_CUSTOM_AUDIO_TRACK,options:[r]}),n=new qr(r.mediaStreamTrack,r.encoderConfig?fc(r.encoderConfig):{});return S.info("create custom audio track success with config",r,"trackId",n.getTrackId()),t.onSuccess(n.getTrackId()),n},createBufferSourceAudioTrack:async function(r){const t=gt.reportApiInvoke(null,{tag:Yt.TRACER,name:Kt.CREATE_BUFFER_AUDIO_TRACK,options:[r]}),n=Le(8,"track-buf-");S.info("start create buffer source audio track with config",ht(r),"trackId",n);const s=r.source;if(!(r.source instanceof AudioBuffer))try{r.source=await M1(r.source,r.cacheOnlineFile)}catch(h){return t.onError(h),h.throw()}const c=new D1(r.source),d=new _l(s,c,r.encoderConfig?fc(r.encoderConfig):{},n);return S.info("create buffer source audio track success, trackId:",n),t.onSuccess(d.getTrackId()),d},setLogLevel:q1,enableLogUpload:J1,disableLogUpload:z1,createChannelMediaRelayConfiguration:Y1,checkAudioTrackIsActive:async function(r,t=5e3){const n=gt.reportApiInvoke(null,{tag:Yt.TRACER,name:Kt.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(r instanceof qr||r instanceof tm)){const A=new M(L.INVALID_TRACK,"the parameter is not a audio track");return n.onError(A),A.throw()}t&&t<1e3&&(t=1e3);const s=r instanceof qr?r.getTrackLabel():"remote_track",c=r.getVolumeLevel();let d=c,h=c;const p=pt();return new dt(A=>{const m=U1(()=>{const E=r.getVolumeLevel();d=E>d?E:d,h=E<h?E:h;const v=d-h>1e-4,C=pt()-p;if(v||C>t){var b;clearInterval(m);const y=v,w={duration:C,deviceLabel:s,maxVolumeLevel:d,result:y};S.info(O(b="[track-".concat(r.getTrackId(),"] check audio track active completed. ")).call(b,ht(w))),n.onSuccess(w),A(y)}},200)})},checkVideoTrackIsActive:async function(r,t=5e3){var n;const s=gt.reportApiInvoke(null,{tag:Yt.TRACER,name:Kt.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(r instanceof dr||r instanceof $g)){const C=new M(L.INVALID_TRACK,"the parameter is not a video track");return s.onError(C),C.throw()}t&&t<1e3&&(t=1e3);const c=r instanceof dr?r.getTrackLabel():"remote_track",d=r.getMediaStreamTrack(!0),h=document.createElement("video");h.style.width="1px",h.style.height="1px",h.setAttribute("muted",""),h.muted=!0,h.setAttribute("playsinline",""),h.controls=!1,(Pi()||Od())&&(h.style.opacity="0.01",h.style.position="fixed",h.style.left="0",h.style.top="0",document.body.appendChild(h)),h.srcObject=new MediaStream([d]),h.play();const p=document.createElement("canvas");p.width=160,p.height=120;let A=0,m=0;try{const C=pt();A=await function(b,y,w,k){let P,V=0,j=null;return new dt((st,mt)=>{function Et(){V>k&&P&&(P(),st(V));const At=w.getContext("2d");if(!At){const W=new M(L.UNEXPECTED_ERROR,"can not get canvas 2d context.");return S.error(W.toString()),void mt(W)}At.drawImage(b,0,0,160,120);const $=At.getImageData(0,0,w.width,w.height),rt=Math.floor($.data.length/3);if(j){for(let W=0;W<rt;W+=3)if($.data[W]!==j[W])return V+=1,void(j=$.data);j=$.data}else j=$.data}vn(()=>{P&&(P(),st(V))},y),P=Jh(()=>{Et()},30)})}(h,t,p,4),m=pt()-C}catch(C){throw s.onError(C),C}ZL===Re.SAFARI&&(h.pause(),h.remove()),h.srcObject=null;const E=A>4,v={duration:m,changedPicNum:A,deviceLabel:c,result:E};return S.info(O(n="[track-".concat(r.getTrackId(),"] check video track active completed. ")).call(n,ht(v))),s.onSuccess(v),E},setArea:Oy,loadModule:X1,processExternalMediaAEC:Z1},iM={__CLIENT_LIST__:ls,__TRACK_LIST__:oa,VERSION:Pn,BUILD:dl,setParameter:jr,getParameter:ot,getSupportedCodec:O1,checkSystemRequirements:k1,getDevices:j1,getMicrophones:W1,getCameras:K1,getElectronScreenSources:sg,getPlaybackDevices:H1,createClient:function(r={codec:"vp8",mode:"rtc"}){const t=bt.reportApiInvoke(null,{name:de.CREATE_CLIENT,options:[r],tag:Zt.TRACER});try{(function(n){Pr(n.codec,"config.codec",["vp8","vp9","av1","h264"]),Pr(n.mode,"config.mode",["rtc","live"]),n.proxyServer!==void 0&&pr(n.proxyServer,"config.proxyServer",1,1e4),n.turnServer!==void 0&&LT(n.turnServer),n.httpRetryConfig!==void 0&&DT(n.httpRetryConfig),n.websocketRetryConfig!==void 0&&DT(n.websocketRetryConfig)})(r)}catch(n){throw t.onError(n),n}return t.onSuccess(),new Fl(xl({forceWaitGatewayResponse:!0},r,{role:r.mode==="rtc"?"host":r.role}))},createCameraVideoTrack:async function(r={encoderConfig:"480p_1"}){const t=bt.reportApiInvoke(null,{tag:Zt.TRACER,name:de.CREATE_CAM_VIDEO_TRACK,options:[gm({},r)]}),n=wl(r),s=Le(8,"track-cam-");let c=null;S.info("start create camera video track with config",ht(r),"trackId",s);try{c=(await nn({video:n},s)).getVideoTracks()[0]||null}catch(h){throw t.onError(h),h}if(!c){const h=new M(Ze.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(h),h.throw()}r.optimizationMode&&mm(s,c,r,r.encoderConfig&&cs(r.encoderConfig));const d=new lu(c,r,n,r.scalabiltyMode?Ua(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,s);return t.onSuccess(d.getTrackId()),S.info("create camera video success, trackId:",s),d},createCustomVideoTrack:function(r){const t=bt.reportApiInvoke(null,{tag:Zt.TRACER,name:de.CREATE_CUSTOM_VIDEO_TRACK,options:[r]}),n=new Qr(r.mediaStreamTrack,{bitrateMax:r.bitrateMax,bitrateMin:r.bitrateMin},r.scalabiltyMode?Ua(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode);return t.onSuccess(n.getTrackId()),S.info("create custom video track success with config",r,"trackId",n.getTrackId()),n},createScreenVideoTrack:async function(r={},t="disable"){const n=bt.reportApiInvoke(null,{tag:Zt.TRACER,name:de.CREATE_SCREEN_VIDEO_TRACK,options:[gm({},r),t]});r.encoderConfig?typeof r.encoderConfig=="string"||r.encoderConfig.width&&r.encoderConfig.height||(r.encoderConfig.width={max:1920},r.encoderConfig.height={max:1080}):r.encoderConfig="1080p_2";const s=Ky(r),c=Le(8,"track-scr");let d=null,h=null;const p=Dr();if(!p.supportShareAudio&&t==="enable"){const E=new M(Ze.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return n.onError(E),E.throw()}S.info("start create screen video track with config",r,"withAudio",t,"trackId",c);try{const E=await nn({screen:s,screenAudio:t==="auto"?p.supportShareAudio:t==="enable"},c);d=E.getVideoTracks()[0]||null,h=E.getAudioTracks()[0]||null}catch(E){throw n.onError(E),E}if(!d){const E=new M(Ze.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(E),E.throw()}if(!h&&t==="enable"){d&&d.stop();const E=new M(Ze.SHARE_AUDIO_NOT_ALLOWED);return n.onError(E),E.throw()}r.optimizationMode||(r.optimizationMode="detail"),r.optimizationMode&&(mm(c,d,r,r.encoderConfig&&Md(r.encoderConfig)),r.encoderConfig&&typeof r.encoderConfig!="string"&&(r.encoderConfig.bitrateMin=r.encoderConfig.bitrateMax));const A=new Qr(d,r.encoderConfig?Md(r.encoderConfig):{},r.scalabiltyMode?Ua(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,c);if(A._hints.push(Bs.SCREEN_TRACK),!h)return n.onSuccess(A.getTrackId()),S.info("create screen video track success","video:",A.getTrackId()),A;const m=new xn(h);return n.onSuccess([A.getTrackId(),m.getTrackId()]),S.info("create screen video track success","video:",A.getTrackId(),"audio:",m.getTrackId()),[A,m]},createMicrophoneAndCameraTracks:async function(r={},t={encoderConfig:"480p_1"}){var n,s,c,d;const h=bt.reportApiInvoke(null,{tag:Zt.TRACER,name:de.CREATE_MIC_AND_CAM_TRACKS,options:[r,t]}),p=wl(t),A=Ip(r),m=Le(8,"track-mic-"),E=Le(8,"track-cam-");let v=null,C=null;S.info(O(n=O(s=O(c="start create camera video track(".concat(E,") and microphone audio track(")).call(c,m,") with config, audio: ")).call(s,ht(r),", video: ")).call(n,ht(t)));try{var b;const k=await nn({audio:A,video:p},O(b="".concat(m,"-")).call(b,E));v=k.getAudioTracks()[0],C=k.getVideoTracks()[0]}catch(k){throw h.onError(k),k}if(!v||!C){const k=new M(Ze.UNEXPECTED_ERROR,"can not find tracks in media stream");return h.onError(k),k.throw()}t.optimizationMode&&mm(E,C,t,t.encoderConfig&&cs(t.encoderConfig));const y=new ou(v,r,A,m),w=new lu(C,t,p,t.scalabiltyMode?Ua(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,E);return h.onSuccess([y.getTrackId(),w.getTrackId()]),S.info(O(d="create camera video track(".concat(E,") and microphone audio track(")).call(d,m,") success")),[y,w]},createMicrophoneAudioTrack:async function(r={}){const t=bt.reportApiInvoke(null,{tag:Zt.TRACER,name:de.CREATE_MIC_AUDIO_TRACK,options:[r]}),n=Ip(r),s=Le(8,"track-mic-");let c=null;S.info("start create microphone audio track with config",ht(r),"trackId",s);try{c=(await nn({audio:n},s)).getAudioTracks()[0]||null}catch(h){throw t.onError(h),h}if(!c){const h=new M(Ze.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(h),h.throw()}const d=new ou(c,r,n,s);return t.onSuccess(d.getTrackId()),S.info("create microphone audio track success, trackId:",s),d},createCustomAudioTrack:function(r){const t=bt.reportApiInvoke(null,{tag:Zt.TRACER,name:de.CREATE_CUSTOM_AUDIO_TRACK,options:[r]}),n=new xn(r.mediaStreamTrack,r.encoderConfig?fc(r.encoderConfig):{});return S.info("create custom audio track success with config",r,"trackId",n.getTrackId()),t.onSuccess(n.getTrackId()),n},createBufferSourceAudioTrack:async function(r){const t=bt.reportApiInvoke(null,{tag:Zt.TRACER,name:de.CREATE_BUFFER_AUDIO_TRACK,options:[r]}),n=Le(8,"track-buf-");S.info("start create buffer source audio track with config",ht(r),"trackId",n);const s=r.source;if(!(r.source instanceof AudioBuffer))try{r.source=await M1(r.source,r.cacheOnlineFile)}catch(h){return t.onError(h),h.throw()}const c=new D1(r.source),d=new Bl(s,c,r.encoderConfig?fc(r.encoderConfig):{},n);return S.info("create buffer source audio track success, trackId:",n),t.onSuccess(d.getTrackId()),d},setLogLevel:q1,enableLogUpload:J1,disableLogUpload:z1,createChannelMediaRelayConfiguration:Y1,checkAudioTrackIsActive:async function(r,t=5e3){const n=bt.reportApiInvoke(null,{tag:Zt.TRACER,name:de.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(r instanceof xn||r instanceof uu)){const A=new M(Ze.INVALID_TRACK,"the parameter is not a audio track");return n.onError(A),A.throw()}t&&t<1e3&&(t=1e3);const s=r instanceof xn?r.getTrackLabel():"remote_track",c=r.getVolumeLevel();let d=c,h=c;const p=pt();return new dt(A=>{const m=U1(()=>{const E=r.getVolumeLevel();d=E>d?E:d,h=E<h?E:h;const v=d-h>1e-4,C=pt()-p;if(v||C>t){var b;clearInterval(m);const y=v,w={duration:C,deviceLabel:s,maxVolumeLevel:d,result:y};S.info(O(b="[track-".concat(r.getTrackId(),"] check audio track active completed. ")).call(b,ht(w))),n.onSuccess(w),A(y)}},200)})},checkVideoTrackIsActive:async function(r,t=5e3){var n;const s=bt.reportApiInvoke(null,{tag:Zt.TRACER,name:de.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(r instanceof Qr||r instanceof du)){const C=new M(Ze.INVALID_TRACK,"the parameter is not a video track");return s.onError(C),C.throw()}t&&t<1e3&&(t=1e3);const c=r instanceof Qr?r.getTrackLabel():"remote_track",d=r.getMediaStreamTrack(!0),h=document.createElement("video");h.style.width="1px",h.style.height="1px",h.setAttribute("muted",""),h.muted=!0,h.setAttribute("playsinline",""),h.controls=!1,(Pi()||Od())&&(h.style.opacity="0.01",h.style.position="fixed",h.style.left="0",h.style.top="0",document.body.appendChild(h)),h.srcObject=new MediaStream([d]),h.play();const p=document.createElement("canvas");p.width=160,p.height=120;let A=0,m=0;try{const C=pt();A=await function(b,y,w,k){let P,V=0,j=null;return new dt((st,mt)=>{function Et(){V>k&&P&&(P(),st(V));const At=w.getContext("2d");if(!At){const W=new M(Ze.UNEXPECTED_ERROR,"can not get canvas 2d context.");return S.error(W.toString()),void mt(W)}At.drawImage(b,0,0,160,120);const $=At.getImageData(0,0,w.width,w.height),rt=Math.floor($.data.length/3);if(j){for(let W=0;W<rt;W+=3)if($.data[W]!==j[W])return V+=1,void(j=$.data);j=$.data}else j=$.data}vn(()=>{P&&(P(),st(V))},y),P=Jh(()=>{Et()},30)})}(h,t,p,4),m=pt()-C}catch(C){throw s.onError(C),C}$L===Dl.SAFARI&&(h.pause(),h.remove()),h.srcObject=null;const E=A>4,v={duration:m,changedPicNum:A,deviceLabel:c,result:E};return S.info(O(n="[track-".concat(r.getTrackId(),"] check video track active completed. ")).call(n,ht(v))),s.onSuccess(v),E},setArea:Oy,loadModule:X1,processExternalMediaAEC:Z1},ma=ot("SDK_FALLBACK")?iM:nM;return He(ma,{onAudioAutoplayFailed:{get:()=>eo.onAudioAutoplayFailed,set:r=>{eo.onAudioAutoplayFailed=r}},onAutoplayFailed:{get:()=>eo.onAutoplayFailed,set:r=>{eo.onAutoplayFailed=r}}}),gn.on(sa.CAMERA_DEVICE_CHANGED,r=>{S.info("camera device changed",ht(r)),ma.onCameraChanged&&ma.onCameraChanged(r)}),gn.on(sa.RECORDING_DEVICE_CHANGED,r=>{S.info("microphone device changed",ht(r)),ma.onMicrophoneChanged&&ma.onMicrophoneChanged(r)}),gn.on(sa.PLAYOUT_DEVICE_CHANGED,r=>{S.debug("playout device changed",ht(r)),ma.onPlaybackDeviceChanged&&ma.onPlaybackDeviceChanged(r)}),Yr.onAutoplayFailed=()=>{S.info("detect audio element autoplay failed"),eo.onAudioAutoplayFailed&&eo.onAudioAutoplayFailed()},ue.on("autoplay-failed",()=>{S.info("detect webaudio autoplay failed"),eo.onAudioAutoplayFailed&&eo.onAudioAutoplayFailed()}),window&&(window.__ARTC__=ma),ma})})(DN);var b_=CM(DN.exports);const h5=(o={token:null,channelName:null})=>{const e=wm(),i=o.token||e.token;return qM.request({url:"client/user/pub/videoToken",params:{uni_id_token:i,channelName:o.channelName}})},p5={props:{id:{type:String,default:""}},setup(o){const e=o,i=JM();wm();let a=Au({});const l=Au({uid:1,name:"a",hasOpenVideo:Tc(!1),hasOpenAudio:Tc(!1),videoTrack:null,audioTrack:null,isShow:!0}),u=async it=>{it.isShow=!1,it.hasOpenVideo&&it.videoTrack&&(it.videoTrack.stop(),it.videoTrack.close(),it.uid===l.uid&&_.unpublish(l.videoTrack)),it.hasOpenAudio&&it.audioTrack&&(it.audioTrack.stop(),it.audioTrack.close(),it.uid===l.uid&&_.unpublish(l.audioTrack))},f=async it=>{const z=it.uid;if(z===l.uid){if(!l.audioTrack){await D();return}l.hasOpenAudio?(l.audioTrack.setEnabled(!1),l.hasOpenAudio=!1):(l.audioTrack.setEnabled(!0),l.hasOpenAudio=!0);return}a[z].hasAudio?a[z].hasOpenAudio?(a[z].audioTrack.stop(),a[z].hasOpenAudio=!1):(a[z].audioTrack.play(),a[z].hasOpenAudio=!0):a[z].hasOpenAudio=!1},g=async it=>{const z=it.uid;if(z===l.uid){if(!l.videoTrack){await N();return}l.hasOpenVideo?(l.videoTrack.setEnabled(!1),l.hasOpenVideo=!1):(l.videoTrack.setEnabled(!0),l.hasOpenVideo=!0);return}a[z].hasVideo&&(a[z].hasOpenVideo?(a[z].videoTrack.stop(),a[z].hasOpenVideo=!1):(a[z].videoTrack.play(`player-${z}`),a[z].hasOpenVideo=!0))};let _=null,I=Au({audioTrack:null,videoTrack:null});_m(async()=>{_=b_.createClient({codec:"vp8",mode:"rtc"}),_.on("user-published",T),_.on("user-unpublished",K),_.on("user-left",J);const it=await h5({channelName:e.id}),{token:z,uid:Ot}=it.data;l.uid=await _.join(i.liveOptions.APPID,e.id,z,Ot),await N(),await D()}),cR(async()=>{await nt()});async function T(it,z){const Ot=it.uid;a[Ot]||(a[Ot]=it),F(it,z)}async function N(){I.videoTrack=await b_.createCameraVideoTrack().catch(it=>{}),I.videoTrack&&(l.hasOpenVideo=!0,l.isShow=!0,I.videoTrack.play("player-"+l.uid),l.videoTrack=I.videoTrack,_.publish(I.videoTrack))}async function D(){I.audioTrack=await b_.createMicrophoneAudioTrack().catch(it=>{}),I.audioTrack&&(l.hasOpenAudio=!0,l.audioTrack=I.audioTrack,_.publish(I.audioTrack))}async function F(it,z){const Ot=it.uid;await _.subscribe(it,z),z==="video"&&(a[Ot].isShow=!0,await iR(),a[Ot].videoTrack.play(`player-${Ot}`),a[Ot].hasOpenVideo=!0),z==="audio"&&(a[Ot].audioTrack.play(),a[Ot].hasOpenAudio=!0)}async function K(it){const z=it.uid;a[z].hasVideo?a[z].hasAudio||(a[z].hasOpenAudio=!1):a[z].isShow=!1}async function J(it){const z=it.uid;a[z].isShow=!1,a[z].hasOpenVideo&&a[z].videoTrack&&a[z].videoTrack.stop(),a[z].hasOpenAudio&&a[z].audioTrack&&a[z].audioTrack.stop(),delete a[z];for(const Ot in a)if(Object.hasOwnProperty.call(a,Ot)){const X=a[Ot];if(X.hasVideo){F(X,"video");break}}}async function nt(){for(const it in I){let z=I[it];z&&(z.stop(),z.close(),I[it]=void 0)}a={},await _.leave()}return(it,z)=>(Nn(),Vi(va,null,[(Nn(!0),Vi(va,null,Im(gs(a),(Ot,X,yt)=>(Nn(),Vi(va,{key:Ot.uid},[Ot.isShow?(Nn(),Vl(kN,{key:0,"live-user":Ot,onVideo:Mt=>g(Ot),onAudio:Mt=>f(Ot),onClose:Mt=>u(Ot),name:Ot.uid+"","class-name":"w-80 h-60 "+(yt==0?"bottom-[calc(100vh-19rem)]":"bottom-[calc(100vh-34.6rem)]")},null,8,["live-user","onVideo","onAudio","onClose","name","class-name"])):Cm("",!0)],64))),128)),gs(l).isShow?(Nn(),Vl(kN,{key:0,"live-user":gs(l),onVideo:z[0]||(z[0]=Ot=>g(gs(l))),onAudio:z[1]||(z[1]=Ot=>f(gs(l))),onClose:z[2]||(z[2]=Ot=>u(gs(l)))},null,8,["live-user"])):Cm("",!0)],64))}},f5={class:"pt-16 w-screen h-screen overflow-hidden"},v5={props:{id:{type:String,default:""}},setup(o){return(e,i)=>(Nn(),Vi(va,null,[Gi(r5),Rr("div",f5,[Gi(BV,{class:"h-full"})]),(Nn(),Vl(SM,null,{default:Gl(()=>[Gi(p5,{id:o.id},null,8,["id"])]),_:1}))],64))}};export{v5 as default};
