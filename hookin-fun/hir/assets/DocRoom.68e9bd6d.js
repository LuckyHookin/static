var mN=Object.defineProperty,vN=Object.defineProperties;var EN=Object.getOwnPropertyDescriptors;var Ed=Object.getOwnPropertySymbols;var jI=Object.prototype.hasOwnProperty,HI=Object.prototype.propertyIsEnumerable;var KI=(t,e,r)=>e in t?mN(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,fe=(t,e)=>{for(var r in e||(e={}))jI.call(e,r)&&KI(t,r,e[r]);if(Ed)for(var r of Ed(e))HI.call(e,r)&&KI(t,r,e[r]);return t},hc=(t,e)=>vN(t,EN(e));var WI=(t,e)=>{var r={};for(var o in t)jI.call(t,o)&&e.indexOf(o)<0&&(r[o]=t[o]);if(t!=null&&Ed)for(var o of Ed(t))e.indexOf(o)<0&&HI.call(t,o)&&(r[o]=t[o]);return r};import{h as _n,l as Sn,P as pc,S as Id,U as ca,w as IN,V as TA,b as Ei,W as YI,X as Cd,k as la,o as Xt,n as wo,q as $o,g as nr,c as Tn,p as qI,Y as CN,j as Tt,t as yd,y as un,F as Ac,Z as yN,_ as _N,$ as RA,a0 as fc,i as Fn,a1 as _d,R as Sd,a2 as SN,a3 as JI,H as zI,a4 as XI,T as TN,a5 as $I,a6 as RN,a7 as wN,r as ua,v as ZI,e as Tl,a8 as NN,a9 as ON,A as eC,B as tC,Q as kN,aa as bN,ab as DN,ac as BN}from"./vendor.033b9749.js";import{j as LN,G as MN,H as PN,I as QN,J as rC,K as nC,S as iC,L as xN,Y as Zo,M as UN,N as Is,P as FN,Q as VN,R as GN,z as Rl,T as jN,U as oC,V as HN,W as KN,X as WN,E as wA,Z as NA,_ as OA,D as YN,$ as qN,C as JN,a0 as zN,s as XN,a1 as $N,a2 as wl,a3 as sC,a4 as aC,a5 as ZN,a6 as eO,a7 as tO,c as kA,a8 as rO}from"./mutex.1833576a.js";import{_ as cC,S as gc,u as nO}from"./index.38edb8b3.js";const iO=t=>class{constructor(r){this._=r}destroy(){t(this._)}},oO=iO(clearTimeout),sO=(t,e)=>new oO(setTimeout(e,t));function lC(t,e,r){for(var o=0;;o++){if(o==t.childCount||o==e.childCount)return t.childCount==e.childCount?null:r;var a=t.child(o),l=e.child(o);if(a==l){r+=a.nodeSize;continue}if(!a.sameMarkup(l))return r;if(a.isText&&a.text!=l.text){for(var d=0;a.text[d]==l.text[d];d++)r++;return r}if(a.content.size||l.content.size){var A=lC(a.content,l.content,r+1);if(A!=null)return A}r+=a.nodeSize}}function uC(t,e,r,o){for(var a=t.childCount,l=e.childCount;;){if(a==0||l==0)return a==l?null:{a:r,b:o};var d=t.child(--a),A=e.child(--l),g=d.nodeSize;if(d==A){r-=g,o-=g;continue}if(!d.sameMarkup(A))return{a:r,b:o};if(d.isText&&d.text!=A.text){for(var v=0,C=Math.min(d.text.length,A.text.length);v<C&&d.text[d.text.length-v-1]==A.text[A.text.length-v-1];)v++,r--,o--;return{a:r,b:o}}if(d.content.size||A.content.size){var y=uC(d.content,A.content,r-1,o-1);if(y)return y}r-=g,o-=g}}var ee=function(e,r){if(this.content=e,this.size=r||0,r==null)for(var o=0;o<e.length;o++)this.size+=e[o].nodeSize},Td={firstChild:{configurable:!0},lastChild:{configurable:!0},childCount:{configurable:!0}};ee.prototype.nodesBetween=function(e,r,o,a,l){a===void 0&&(a=0);for(var d=0,A=0;A<r;d++){var g=this.content[d],v=A+g.nodeSize;if(v>e&&o(g,a+A,l,d)!==!1&&g.content.size){var C=A+1;g.nodesBetween(Math.max(0,e-C),Math.min(g.content.size,r-C),o,a+C)}A=v}};ee.prototype.descendants=function(e){this.nodesBetween(0,this.size,e)};ee.prototype.textBetween=function(e,r,o,a){var l="",d=!0;return this.nodesBetween(e,r,function(A,g){A.isText?(l+=A.text.slice(Math.max(e,g)-g,r-g),d=!o):A.isLeaf&&a?(l+=typeof a=="function"?a(A):a,d=!o):!d&&A.isBlock&&(l+=o,d=!0)},0),l};ee.prototype.append=function(e){if(!e.size)return this;if(!this.size)return e;var r=this.lastChild,o=e.firstChild,a=this.content.slice(),l=0;for(r.isText&&r.sameMarkup(o)&&(a[a.length-1]=r.withText(r.text+o.text),l=1);l<e.content.length;l++)a.push(e.content[l]);return new ee(a,this.size+e.size)};ee.prototype.cut=function(e,r){if(r==null&&(r=this.size),e==0&&r==this.size)return this;var o=[],a=0;if(r>e)for(var l=0,d=0;d<r;l++){var A=this.content[l],g=d+A.nodeSize;g>e&&((d<e||g>r)&&(A.isText?A=A.cut(Math.max(0,e-d),Math.min(A.text.length,r-d)):A=A.cut(Math.max(0,e-d-1),Math.min(A.content.size,r-d-1))),o.push(A),a+=A.nodeSize),d=g}return new ee(o,a)};ee.prototype.cutByIndex=function(e,r){return e==r?ee.empty:e==0&&r==this.content.length?this:new ee(this.content.slice(e,r))};ee.prototype.replaceChild=function(e,r){var o=this.content[e];if(o==r)return this;var a=this.content.slice(),l=this.size+r.nodeSize-o.nodeSize;return a[e]=r,new ee(a,l)};ee.prototype.addToStart=function(e){return new ee([e].concat(this.content),this.size+e.nodeSize)};ee.prototype.addToEnd=function(e){return new ee(this.content.concat(e),this.size+e.nodeSize)};ee.prototype.eq=function(e){if(this.content.length!=e.content.length)return!1;for(var r=0;r<this.content.length;r++)if(!this.content[r].eq(e.content[r]))return!1;return!0};Td.firstChild.get=function(){return this.content.length?this.content[0]:null};Td.lastChild.get=function(){return this.content.length?this.content[this.content.length-1]:null};Td.childCount.get=function(){return this.content.length};ee.prototype.child=function(e){var r=this.content[e];if(!r)throw new RangeError("Index "+e+" out of range for "+this);return r};ee.prototype.maybeChild=function(e){return this.content[e]};ee.prototype.forEach=function(e){for(var r=0,o=0;r<this.content.length;r++){var a=this.content[r];e(a,o,r),o+=a.nodeSize}};ee.prototype.findDiffStart=function(e,r){return r===void 0&&(r=0),lC(this,e,r)};ee.prototype.findDiffEnd=function(e,r,o){return r===void 0&&(r=this.size),o===void 0&&(o=e.size),uC(this,e,r,o)};ee.prototype.findIndex=function(e,r){if(r===void 0&&(r=-1),e==0)return Rd(0,e);if(e==this.size)return Rd(this.content.length,e);if(e>this.size||e<0)throw new RangeError("Position "+e+" outside of fragment ("+this+")");for(var o=0,a=0;;o++){var l=this.child(o),d=a+l.nodeSize;if(d>=e)return d==e||r>0?Rd(o+1,d):Rd(o,a);a=d}};ee.prototype.toString=function(){return"<"+this.toStringInner()+">"};ee.prototype.toStringInner=function(){return this.content.join(", ")};ee.prototype.toJSON=function(){return this.content.length?this.content.map(function(e){return e.toJSON()}):null};ee.fromJSON=function(e,r){if(!r)return ee.empty;if(!Array.isArray(r))throw new RangeError("Invalid input for Fragment.fromJSON");return new ee(r.map(e.nodeFromJSON))};ee.fromArray=function(e){if(!e.length)return ee.empty;for(var r,o=0,a=0;a<e.length;a++){var l=e[a];o+=l.nodeSize,a&&l.isText&&e[a-1].sameMarkup(l)?(r||(r=e.slice(0,a)),r[r.length-1]=l.withText(r[r.length-1].text+l.text)):r&&r.push(l)}return new ee(r||e,o)};ee.from=function(e){if(!e)return ee.empty;if(e instanceof ee)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new ee([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))};Object.defineProperties(ee.prototype,Td);var bA={index:0,offset:0};function Rd(t,e){return bA.index=t,bA.offset=e,bA}ee.empty=new ee([],0);function wd(t,e){if(t===e)return!0;if(!(t&&typeof t=="object")||!(e&&typeof e=="object"))return!1;var r=Array.isArray(t);if(Array.isArray(e)!=r)return!1;if(r){if(t.length!=e.length)return!1;for(var o=0;o<t.length;o++)if(!wd(t[o],e[o]))return!1}else{for(var a in t)if(!(a in e)||!wd(t[a],e[a]))return!1;for(var l in e)if(!(l in t))return!1}return!0}var Rt=function(e,r){this.type=e,this.attrs=r};Rt.prototype.addToSet=function(e){for(var r,o=!1,a=0;a<e.length;a++){var l=e[a];if(this.eq(l))return e;if(this.type.excludes(l.type))r||(r=e.slice(0,a));else{if(l.type.excludes(this.type))return e;!o&&l.type.rank>this.type.rank&&(r||(r=e.slice(0,a)),r.push(this),o=!0),r&&r.push(l)}}return r||(r=e.slice()),o||r.push(this),r};Rt.prototype.removeFromSet=function(e){for(var r=0;r<e.length;r++)if(this.eq(e[r]))return e.slice(0,r).concat(e.slice(r+1));return e};Rt.prototype.isInSet=function(e){for(var r=0;r<e.length;r++)if(this.eq(e[r]))return!0;return!1};Rt.prototype.eq=function(e){return this==e||this.type==e.type&&wd(this.attrs,e.attrs)};Rt.prototype.toJSON=function(){var e={type:this.type.name};for(var r in this.attrs){e.attrs=this.attrs;break}return e};Rt.fromJSON=function(e,r){if(!r)throw new RangeError("Invalid input for Mark.fromJSON");var o=e.marks[r.type];if(!o)throw new RangeError("There is no mark type "+r.type+" in this schema");return o.create(r.attrs)};Rt.sameSet=function(e,r){if(e==r)return!0;if(e.length!=r.length)return!1;for(var o=0;o<e.length;o++)if(!e[o].eq(r[o]))return!1;return!0};Rt.setFrom=function(e){if(!e||e.length==0)return Rt.none;if(e instanceof Rt)return[e];var r=e.slice();return r.sort(function(o,a){return o.type.rank-a.type.rank}),r};Rt.none=[];function No(t){var e=Error.call(this,t);return e.__proto__=No.prototype,e}No.prototype=Object.create(Error.prototype);No.prototype.constructor=No;No.prototype.name="ReplaceError";var ye=function(e,r,o){this.content=e,this.openStart=r,this.openEnd=o},dC={size:{configurable:!0}};dC.size.get=function(){return this.content.size-this.openStart-this.openEnd};ye.prototype.insertAt=function(e,r){var o=pC(this.content,e+this.openStart,r,null);return o&&new ye(o,this.openStart,this.openEnd)};ye.prototype.removeBetween=function(e,r){return new ye(hC(this.content,e+this.openStart,r+this.openStart),this.openStart,this.openEnd)};ye.prototype.eq=function(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd};ye.prototype.toString=function(){return this.content+"("+this.openStart+","+this.openEnd+")"};ye.prototype.toJSON=function(){if(!this.content.size)return null;var e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e};ye.fromJSON=function(e,r){if(!r)return ye.empty;var o=r.openStart||0,a=r.openEnd||0;if(typeof o!="number"||typeof a!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new ye(ee.fromJSON(e,r.content),o,a)};ye.maxOpen=function(e,r){r===void 0&&(r=!0);for(var o=0,a=0,l=e.firstChild;l&&!l.isLeaf&&(r||!l.type.spec.isolating);l=l.firstChild)o++;for(var d=e.lastChild;d&&!d.isLeaf&&(r||!d.type.spec.isolating);d=d.lastChild)a++;return new ye(e,o,a)};Object.defineProperties(ye.prototype,dC);function hC(t,e,r){var o=t.findIndex(e),a=o.index,l=o.offset,d=t.maybeChild(a),A=t.findIndex(r),g=A.index,v=A.offset;if(l==e||d.isText){if(v!=r&&!t.child(g).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(r))}if(a!=g)throw new RangeError("Removing non-flat range");return t.replaceChild(a,d.copy(hC(d.content,e-l-1,r-l-1)))}function pC(t,e,r,o){var a=t.findIndex(e),l=a.index,d=a.offset,A=t.maybeChild(l);if(d==e||A.isText)return o&&!o.canReplace(l,l,r)?null:t.cut(0,e).append(r).append(t.cut(e));var g=pC(A.content,e-d-1,r);return g&&t.replaceChild(l,A.copy(g))}ye.empty=new ye(ee.empty,0,0);function aO(t,e,r){if(r.openStart>t.depth)throw new No("Inserted content deeper than insertion position");if(t.depth-r.openStart!=e.depth-r.openEnd)throw new No("Inconsistent open depths");return AC(t,e,r,0)}function AC(t,e,r,o){var a=t.index(o),l=t.node(o);if(a==e.index(o)&&o<t.depth-r.openStart){var d=AC(t,e,r,o+1);return l.copy(l.content.replaceChild(a,d))}else if(r.content.size)if(!r.openStart&&!r.openEnd&&t.depth==o&&e.depth==o){var A=t.parent,g=A.content;return ha(A,g.cut(0,t.parentOffset).append(r.content).append(g.cut(e.parentOffset)))}else{var v=cO(r,t),C=v.start,y=v.end;return ha(l,gC(t,C,y,e,o))}else return ha(l,Nd(t,e,o))}function fC(t,e){if(!e.type.compatibleContent(t.type))throw new No("Cannot join "+e.type.name+" onto "+t.type.name)}function DA(t,e,r){var o=t.node(r);return fC(o,e.node(r)),o}function da(t,e){var r=e.length-1;r>=0&&t.isText&&t.sameMarkup(e[r])?e[r]=t.withText(e[r].text+t.text):e.push(t)}function Nl(t,e,r,o){var a=(e||t).node(r),l=0,d=e?e.index(r):a.childCount;t&&(l=t.index(r),t.depth>r?l++:t.textOffset&&(da(t.nodeAfter,o),l++));for(var A=l;A<d;A++)da(a.child(A),o);e&&e.depth==r&&e.textOffset&&da(e.nodeBefore,o)}function ha(t,e){if(!t.type.validContent(e))throw new No("Invalid content for node "+t.type.name);return t.copy(e)}function gC(t,e,r,o,a){var l=t.depth>a&&DA(t,e,a+1),d=o.depth>a&&DA(r,o,a+1),A=[];return Nl(null,t,a,A),l&&d&&e.index(a)==r.index(a)?(fC(l,d),da(ha(l,gC(t,e,r,o,a+1)),A)):(l&&da(ha(l,Nd(t,e,a+1)),A),Nl(e,r,a,A),d&&da(ha(d,Nd(r,o,a+1)),A)),Nl(o,null,a,A),new ee(A)}function Nd(t,e,r){var o=[];if(Nl(null,t,r,o),t.depth>r){var a=DA(t,e,r+1);da(ha(a,Nd(t,e,r+1)),o)}return Nl(e,null,r,o),new ee(o)}function cO(t,e){for(var r=e.depth-t.openStart,o=e.node(r),a=o.copy(t.content),l=r-1;l>=0;l--)a=e.node(l).copy(ee.from(a));return{start:a.resolveNoCache(t.openStart+r),end:a.resolveNoCache(a.content.size-t.openEnd-r)}}var ir=function(e,r,o){this.pos=e,this.path=r,this.depth=r.length/3-1,this.parentOffset=o},mc={parent:{configurable:!0},doc:{configurable:!0},textOffset:{configurable:!0},nodeAfter:{configurable:!0},nodeBefore:{configurable:!0}};ir.prototype.resolveDepth=function(e){return e==null?this.depth:e<0?this.depth+e:e};mc.parent.get=function(){return this.node(this.depth)};mc.doc.get=function(){return this.node(0)};ir.prototype.node=function(e){return this.path[this.resolveDepth(e)*3]};ir.prototype.index=function(e){return this.path[this.resolveDepth(e)*3+1]};ir.prototype.indexAfter=function(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)};ir.prototype.start=function(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1};ir.prototype.end=function(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size};ir.prototype.before=function(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]};ir.prototype.after=function(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize};mc.textOffset.get=function(){return this.pos-this.path[this.path.length-1]};mc.nodeAfter.get=function(){var t=this.parent,e=this.index(this.depth);if(e==t.childCount)return null;var r=this.pos-this.path[this.path.length-1],o=t.child(e);return r?t.child(e).cut(r):o};mc.nodeBefore.get=function(){var t=this.index(this.depth),e=this.pos-this.path[this.path.length-1];return e?this.parent.child(t).cut(0,e):t==0?null:this.parent.child(t-1)};ir.prototype.posAtIndex=function(e,r){r=this.resolveDepth(r);for(var o=this.path[r*3],a=r==0?0:this.path[r*3-1]+1,l=0;l<e;l++)a+=o.child(l).nodeSize;return a};ir.prototype.marks=function(){var e=this.parent,r=this.index();if(e.content.size==0)return Rt.none;if(this.textOffset)return e.child(r).marks;var o=e.maybeChild(r-1),a=e.maybeChild(r);if(!o){var l=o;o=a,a=l}for(var d=o.marks,A=0;A<d.length;A++)d[A].type.spec.inclusive===!1&&(!a||!d[A].isInSet(a.marks))&&(d=d[A--].removeFromSet(d));return d};ir.prototype.marksAcross=function(e){var r=this.parent.maybeChild(this.index());if(!r||!r.isInline)return null;for(var o=r.marks,a=e.parent.maybeChild(e.index()),l=0;l<o.length;l++)o[l].type.spec.inclusive===!1&&(!a||!o[l].isInSet(a.marks))&&(o=o[l--].removeFromSet(o));return o};ir.prototype.sharedDepth=function(e){for(var r=this.depth;r>0;r--)if(this.start(r)<=e&&this.end(r)>=e)return r;return 0};ir.prototype.blockRange=function(e,r){if(e===void 0&&(e=this),e.pos<this.pos)return e.blockRange(this);for(var o=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);o>=0;o--)if(e.pos<=this.end(o)&&(!r||r(this.node(o))))return new Ol(this,e,o)};ir.prototype.sameParent=function(e){return this.pos-this.parentOffset==e.pos-e.parentOffset};ir.prototype.max=function(e){return e.pos>this.pos?e:this};ir.prototype.min=function(e){return e.pos<this.pos?e:this};ir.prototype.toString=function(){for(var e="",r=1;r<=this.depth;r++)e+=(e?"/":"")+this.node(r).type.name+"_"+this.index(r-1);return e+":"+this.parentOffset};ir.resolve=function(e,r){if(!(r>=0&&r<=e.content.size))throw new RangeError("Position "+r+" out of range");for(var o=[],a=0,l=r,d=e;;){var A=d.content.findIndex(l),g=A.index,v=A.offset,C=l-v;if(o.push(d,g,a+v),!C||(d=d.child(g),d.isText))break;l=C-1,a+=v+1}return new ir(r,o,l)};ir.resolveCached=function(e,r){for(var o=0;o<BA.length;o++){var a=BA[o];if(a.pos==r&&a.doc==e)return a}var l=BA[LA]=ir.resolve(e,r);return LA=(LA+1)%lO,l};Object.defineProperties(ir.prototype,mc);var BA=[],LA=0,lO=12,Ol=function(e,r,o){this.$from=e,this.$to=r,this.depth=o},vc={start:{configurable:!0},end:{configurable:!0},parent:{configurable:!0},startIndex:{configurable:!0},endIndex:{configurable:!0}};vc.start.get=function(){return this.$from.before(this.depth+1)};vc.end.get=function(){return this.$to.after(this.depth+1)};vc.parent.get=function(){return this.$from.node(this.depth)};vc.startIndex.get=function(){return this.$from.index(this.depth)};vc.endIndex.get=function(){return this.$to.indexAfter(this.depth)};Object.defineProperties(Ol.prototype,vc);var uO=Object.create(null),Nt=function(e,r,o,a){this.type=e,this.attrs=r,this.content=o||ee.empty,this.marks=a||Rt.none},Ii={nodeSize:{configurable:!0},childCount:{configurable:!0},textContent:{configurable:!0},firstChild:{configurable:!0},lastChild:{configurable:!0},isBlock:{configurable:!0},isTextblock:{configurable:!0},inlineContent:{configurable:!0},isInline:{configurable:!0},isText:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};Ii.nodeSize.get=function(){return this.isLeaf?1:2+this.content.size};Ii.childCount.get=function(){return this.content.childCount};Nt.prototype.child=function(e){return this.content.child(e)};Nt.prototype.maybeChild=function(e){return this.content.maybeChild(e)};Nt.prototype.forEach=function(e){this.content.forEach(e)};Nt.prototype.nodesBetween=function(e,r,o,a){a===void 0&&(a=0),this.content.nodesBetween(e,r,o,a,this)};Nt.prototype.descendants=function(e){this.nodesBetween(0,this.content.size,e)};Ii.textContent.get=function(){return this.textBetween(0,this.content.size,"")};Nt.prototype.textBetween=function(e,r,o,a){return this.content.textBetween(e,r,o,a)};Ii.firstChild.get=function(){return this.content.firstChild};Ii.lastChild.get=function(){return this.content.lastChild};Nt.prototype.eq=function(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)};Nt.prototype.sameMarkup=function(e){return this.hasMarkup(e.type,e.attrs,e.marks)};Nt.prototype.hasMarkup=function(e,r,o){return this.type==e&&wd(this.attrs,r||e.defaultAttrs||uO)&&Rt.sameSet(this.marks,o||Rt.none)};Nt.prototype.copy=function(e){return e===void 0&&(e=null),e==this.content?this:new this.constructor(this.type,this.attrs,e,this.marks)};Nt.prototype.mark=function(e){return e==this.marks?this:new this.constructor(this.type,this.attrs,this.content,e)};Nt.prototype.cut=function(e,r){return e==0&&r==this.content.size?this:this.copy(this.content.cut(e,r))};Nt.prototype.slice=function(e,r,o){if(r===void 0&&(r=this.content.size),o===void 0&&(o=!1),e==r)return ye.empty;var a=this.resolve(e),l=this.resolve(r),d=o?0:a.sharedDepth(r),A=a.start(d),g=a.node(d),v=g.content.cut(a.pos-A,l.pos-A);return new ye(v,a.depth-d,l.depth-d)};Nt.prototype.replace=function(e,r,o){return aO(this.resolve(e),this.resolve(r),o)};Nt.prototype.nodeAt=function(e){for(var r=this;;){var o=r.content.findIndex(e),a=o.index,l=o.offset;if(r=r.maybeChild(a),!r)return null;if(l==e||r.isText)return r;e-=l+1}};Nt.prototype.childAfter=function(e){var r=this.content.findIndex(e),o=r.index,a=r.offset;return{node:this.content.maybeChild(o),index:o,offset:a}};Nt.prototype.childBefore=function(e){if(e==0)return{node:null,index:0,offset:0};var r=this.content.findIndex(e),o=r.index,a=r.offset;if(a<e)return{node:this.content.child(o),index:o,offset:a};var l=this.content.child(o-1);return{node:l,index:o-1,offset:a-l.nodeSize}};Nt.prototype.resolve=function(e){return ir.resolveCached(this,e)};Nt.prototype.resolveNoCache=function(e){return ir.resolve(this,e)};Nt.prototype.rangeHasMark=function(e,r,o){var a=!1;return r>e&&this.nodesBetween(e,r,function(l){return o.isInSet(l.marks)&&(a=!0),!a}),a};Ii.isBlock.get=function(){return this.type.isBlock};Ii.isTextblock.get=function(){return this.type.isTextblock};Ii.inlineContent.get=function(){return this.type.inlineContent};Ii.isInline.get=function(){return this.type.isInline};Ii.isText.get=function(){return this.type.isText};Ii.isLeaf.get=function(){return this.type.isLeaf};Ii.isAtom.get=function(){return this.type.isAtom};Nt.prototype.toString=function(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);var e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),dO(this.marks,e)};Nt.prototype.contentMatchAt=function(e){var r=this.type.contentMatch.matchFragment(this.content,0,e);if(!r)throw new Error("Called contentMatchAt on a node with invalid content");return r};Nt.prototype.canReplace=function(e,r,o,a,l){o===void 0&&(o=ee.empty),a===void 0&&(a=0),l===void 0&&(l=o.childCount);var d=this.contentMatchAt(e).matchFragment(o,a,l),A=d&&d.matchFragment(this.content,r);if(!A||!A.validEnd)return!1;for(var g=a;g<l;g++)if(!this.type.allowsMarks(o.child(g).marks))return!1;return!0};Nt.prototype.canReplaceWith=function(e,r,o,a){if(a&&!this.type.allowsMarks(a))return!1;var l=this.contentMatchAt(e).matchType(o),d=l&&l.matchFragment(this.content,r);return d?d.validEnd:!1};Nt.prototype.canAppend=function(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)};Nt.prototype.check=function(){if(!this.type.validContent(this.content))throw new RangeError("Invalid content for node "+this.type.name+": "+this.content.toString().slice(0,50));for(var e=Rt.none,r=0;r<this.marks.length;r++)e=this.marks[r].addToSet(e);if(!Rt.sameSet(e,this.marks))throw new RangeError("Invalid collection of marks for node "+this.type.name+": "+this.marks.map(function(o){return o.type.name}));this.content.forEach(function(o){return o.check()})};Nt.prototype.toJSON=function(){var e={type:this.type.name};for(var r in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(function(o){return o.toJSON()})),e};Nt.fromJSON=function(e,r){if(!r)throw new RangeError("Invalid input for Node.fromJSON");var o=null;if(r.marks){if(!Array.isArray(r.marks))throw new RangeError("Invalid mark data for Node.fromJSON");o=r.marks.map(e.markFromJSON)}if(r.type=="text"){if(typeof r.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(r.text,o)}var a=ee.fromJSON(e,r.content);return e.nodeType(r.type).create(r.attrs,a,o)};Object.defineProperties(Nt.prototype,Ii);function dO(t,e){for(var r=t.length-1;r>=0;r--)e=t[r].type.name+"("+e+")";return e}var Vn=function(e){this.validEnd=e,this.next=[],this.wrapCache=[]},Od={inlineContent:{configurable:!0},defaultType:{configurable:!0},edgeCount:{configurable:!0}};Vn.parse=function(e,r){var o=new kd(e,r);if(o.next==null)return Vn.empty;var a=vC(o);o.next&&o.err("Unexpected trailing text");var l=vO(mO(a));return EO(l,o),l};Vn.prototype.matchType=function(e){for(var r=0;r<this.next.length;r+=2)if(this.next[r]==e)return this.next[r+1];return null};Vn.prototype.matchFragment=function(e,r,o){r===void 0&&(r=0),o===void 0&&(o=e.childCount);for(var a=this,l=r;a&&l<o;l++)a=a.matchType(e.child(l).type);return a};Od.inlineContent.get=function(){var t=this.next[0];return t?t.isInline:!1};Od.defaultType.get=function(){for(var t=0;t<this.next.length;t+=2){var e=this.next[t];if(!(e.isText||e.hasRequiredAttrs()))return e}};Vn.prototype.compatible=function(e){for(var r=0;r<this.next.length;r+=2)for(var o=0;o<e.next.length;o+=2)if(this.next[r]==e.next[o])return!0;return!1};Vn.prototype.fillBefore=function(e,r,o){r===void 0&&(r=!1),o===void 0&&(o=0);var a=[this];function l(d,A){var g=d.matchFragment(e,o);if(g&&(!r||g.validEnd))return ee.from(A.map(function(k){return k.createAndFill()}));for(var v=0;v<d.next.length;v+=2){var C=d.next[v],y=d.next[v+1];if(!(C.isText||C.hasRequiredAttrs())&&a.indexOf(y)==-1){a.push(y);var w=l(y,A.concat(C));if(w)return w}}}return l(this,[])};Vn.prototype.findWrapping=function(e){for(var r=0;r<this.wrapCache.length;r+=2)if(this.wrapCache[r]==e)return this.wrapCache[r+1];var o=this.computeWrapping(e);return this.wrapCache.push(e,o),o};Vn.prototype.computeWrapping=function(e){for(var r=Object.create(null),o=[{match:this,type:null,via:null}];o.length;){var a=o.shift(),l=a.match;if(l.matchType(e)){for(var d=[],A=a;A.type;A=A.via)d.push(A.type);return d.reverse()}for(var g=0;g<l.next.length;g+=2){var v=l.next[g];!v.isLeaf&&!v.hasRequiredAttrs()&&!(v.name in r)&&(!a.type||l.next[g+1].validEnd)&&(o.push({match:v.contentMatch,type:v,via:a}),r[v.name]=!0)}}};Od.edgeCount.get=function(){return this.next.length>>1};Vn.prototype.edge=function(e){var r=e<<1;if(r>=this.next.length)throw new RangeError("There's no "+e+"th edge in this content match");return{type:this.next[r],next:this.next[r+1]}};Vn.prototype.toString=function(){var e=[];function r(o){e.push(o);for(var a=1;a<o.next.length;a+=2)e.indexOf(o.next[a])==-1&&r(o.next[a])}return r(this),e.map(function(o,a){for(var l=a+(o.validEnd?"*":" ")+" ",d=0;d<o.next.length;d+=2)l+=(d?", ":"")+o.next[d].name+"->"+e.indexOf(o.next[d+1]);return l}).join(`
`)};Object.defineProperties(Vn.prototype,Od);Vn.empty=new Vn(!0);var kd=function(e,r){this.string=e,this.nodeTypes=r,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()},mC={next:{configurable:!0}};mC.next.get=function(){return this.tokens[this.pos]};kd.prototype.eat=function(e){return this.next==e&&(this.pos++||!0)};kd.prototype.err=function(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")};Object.defineProperties(kd.prototype,mC);function vC(t){var e=[];do e.push(hO(t));while(t.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function hO(t){var e=[];do e.push(pO(t));while(t.next&&t.next!=")"&&t.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function pO(t){for(var e=gO(t);;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else if(t.eat("{"))e=AO(t,e);else break;return e}function EC(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");var e=Number(t.next);return t.pos++,e}function AO(t,e){var r=EC(t),o=r;return t.eat(",")&&(t.next!="}"?o=EC(t):o=-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:r,max:o,expr:e}}function fO(t,e){var r=t.nodeTypes,o=r[e];if(o)return[o];var a=[];for(var l in r){var d=r[l];d.groups.indexOf(e)>-1&&a.push(d)}return a.length==0&&t.err("No node type or group '"+e+"' found"),a}function gO(t){if(t.eat("(")){var e=vC(t);return t.eat(")")||t.err("Missing closing paren"),e}else if(/\W/.test(t.next))t.err("Unexpected token '"+t.next+"'");else{var r=fO(t,t.next).map(function(o){return t.inline==null?t.inline=o.isInline:t.inline!=o.isInline&&t.err("Mixing inline and block content"),{type:"name",value:o}});return t.pos++,r.length==1?r[0]:{type:"choice",exprs:r}}}function mO(t){var e=[[]];return a(l(t,0),r()),e;function r(){return e.push([])-1}function o(d,A,g){var v={term:g,to:A};return e[d].push(v),v}function a(d,A){d.forEach(function(g){return g.to=A})}function l(d,A){if(d.type=="choice")return d.exprs.reduce(function(J,U){return J.concat(l(U,A))},[]);if(d.type=="seq")for(var g=0;;g++){var v=l(d.exprs[g],A);if(g==d.exprs.length-1)return v;a(v,A=r())}else if(d.type=="star"){var C=r();return o(A,C),a(l(d.expr,C),C),[o(C)]}else if(d.type=="plus"){var y=r();return a(l(d.expr,A),y),a(l(d.expr,y),y),[o(y)]}else{if(d.type=="opt")return[o(A)].concat(l(d.expr,A));if(d.type=="range"){for(var w=A,k=0;k<d.min;k++){var M=r();a(l(d.expr,w),M),w=M}if(d.max==-1)a(l(d.expr,w),w);else for(var F=d.min;F<d.max;F++){var K=r();o(w,K),a(l(d.expr,w),K),w=K}return[o(w)]}else if(d.type=="name")return[o(A,null,d.value)]}}}function IC(t,e){return e-t}function CC(t,e){var r=[];return o(e),r.sort(IC);function o(a){var l=t[a];if(l.length==1&&!l[0].term)return o(l[0].to);r.push(a);for(var d=0;d<l.length;d++){var A=l[d],g=A.term,v=A.to;!g&&r.indexOf(v)==-1&&o(v)}}}function vO(t){var e=Object.create(null);return r(CC(t,0));function r(o){var a=[];o.forEach(function(g){t[g].forEach(function(v){var C=v.term,y=v.to;if(!!C){var w=a.indexOf(C),k=w>-1&&a[w+1];CC(t,y).forEach(function(M){k||a.push(C,k=[]),k.indexOf(M)==-1&&k.push(M)})}})});for(var l=e[o.join(",")]=new Vn(o.indexOf(t.length-1)>-1),d=0;d<a.length;d+=2){var A=a[d+1].sort(IC);l.next.push(a[d],e[A.join(",")]||r(A))}return l}}function EO(t,e){for(var r=0,o=[t];r<o.length;r++){for(var a=o[r],l=!a.validEnd,d=[],A=0;A<a.next.length;A+=2){var g=a.next[A],v=a.next[A+1];d.push(g.name),l&&!(g.isText||g.hasRequiredAttrs())&&(l=!1),o.indexOf(v)==-1&&o.push(v)}l&&e.err("Only non-generatable nodes ("+d.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function yC(t){var e=Object.create(null);for(var r in t){var o=t[r];if(!o.hasDefault)return null;e[r]=o.default}return e}function _C(t,e){var r=Object.create(null);for(var o in t){var a=e&&e[o];if(a===void 0){var l=t[o];if(l.hasDefault)a=l.default;else throw new RangeError("No value supplied for attribute "+o)}r[o]=a}return r}function SC(t){var e=Object.create(null);if(t)for(var r in t)e[r]=new TC(t[r]);return e}var Ci=function(e,r,o){this.name=e,this.schema=r,this.spec=o,this.groups=o.group?o.group.split(" "):[],this.attrs=SC(o.attrs),this.defaultAttrs=yC(this.attrs),this.contentMatch=null,this.markSet=null,this.inlineContent=null,this.isBlock=!(o.inline||e=="text"),this.isText=e=="text"},kl={isInline:{configurable:!0},isTextblock:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};kl.isInline.get=function(){return!this.isBlock};kl.isTextblock.get=function(){return this.isBlock&&this.inlineContent};kl.isLeaf.get=function(){return this.contentMatch==Vn.empty};kl.isAtom.get=function(){return this.isLeaf||this.spec.atom};Ci.prototype.hasRequiredAttrs=function(){for(var e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1};Ci.prototype.compatibleContent=function(e){return this==e||this.contentMatch.compatible(e.contentMatch)};Ci.prototype.computeAttrs=function(e){return!e&&this.defaultAttrs?this.defaultAttrs:_C(this.attrs,e)};Ci.prototype.create=function(e,r,o){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Nt(this,this.computeAttrs(e),ee.from(r),Rt.setFrom(o))};Ci.prototype.createChecked=function(e,r,o){if(r=ee.from(r),!this.validContent(r))throw new RangeError("Invalid content for node "+this.name);return new Nt(this,this.computeAttrs(e),r,Rt.setFrom(o))};Ci.prototype.createAndFill=function(e,r,o){if(e=this.computeAttrs(e),r=ee.from(r),r.size){var a=this.contentMatch.fillBefore(r);if(!a)return null;r=a.append(r)}var l=this.contentMatch.matchFragment(r).fillBefore(ee.empty,!0);return l?new Nt(this,e,r.append(l),Rt.setFrom(o)):null};Ci.prototype.validContent=function(e){var r=this.contentMatch.matchFragment(e);if(!r||!r.validEnd)return!1;for(var o=0;o<e.childCount;o++)if(!this.allowsMarks(e.child(o).marks))return!1;return!0};Ci.prototype.allowsMarkType=function(e){return this.markSet==null||this.markSet.indexOf(e)>-1};Ci.prototype.allowsMarks=function(e){if(this.markSet==null)return!0;for(var r=0;r<e.length;r++)if(!this.allowsMarkType(e[r].type))return!1;return!0};Ci.prototype.allowedMarks=function(e){if(this.markSet==null)return e;for(var r,o=0;o<e.length;o++)this.allowsMarkType(e[o].type)?r&&r.push(e[o]):r||(r=e.slice(0,o));return r?r.length?r:Rt.empty:e};Ci.compile=function(e,r){var o=Object.create(null);e.forEach(function(d,A){return o[d]=new Ci(d,r,A)});var a=r.spec.topNode||"doc";if(!o[a])throw new RangeError("Schema is missing its top node type ('"+a+"')");if(!o.text)throw new RangeError("Every schema needs a 'text' type");for(var l in o.text.attrs)throw new RangeError("The text node type should not have attributes");return o};Object.defineProperties(Ci.prototype,kl);var TC=function(e){this.hasDefault=Object.prototype.hasOwnProperty.call(e,"default"),this.default=e.default},RC={isRequired:{configurable:!0}};RC.isRequired.get=function(){return!this.hasDefault};Object.defineProperties(TC.prototype,RC);var pa=function(e,r,o,a){this.name=e,this.schema=o,this.spec=a,this.attrs=SC(a.attrs),this.rank=r,this.excluded=null;var l=yC(this.attrs);this.instance=l&&new Rt(this,l)};pa.prototype.create=function(e){return!e&&this.instance?this.instance:new Rt(this,_C(this.attrs,e))};pa.compile=function(e,r){var o=Object.create(null),a=0;return e.forEach(function(l,d){return o[l]=new pa(l,a++,r,d)}),o};pa.prototype.removeFromSet=function(e){for(var r=0;r<e.length;r++)e[r].type==this&&(e=e.slice(0,r).concat(e.slice(r+1)),r--);return e};pa.prototype.isInSet=function(e){for(var r=0;r<e.length;r++)if(e[r].type==this)return e[r]};pa.prototype.excludes=function(e){return this.excluded.indexOf(e)>-1};var ao=function(e,r){var o=this;this.schema=e,this.rules=r,this.tags=[],this.styles=[],r.forEach(function(a){a.tag?o.tags.push(a):a.style&&o.styles.push(a)}),this.normalizeLists=!this.tags.some(function(a){if(!/^(ul|ol)\b/.test(a.tag)||!a.node)return!1;var l=e.nodes[a.node];return l.contentMatch.matchType(l)})};ao.prototype.parse=function(e,r){r===void 0&&(r={});var o=new $t(this,r,!1);return o.addAll(e,null,r.from,r.to),o.finish()};ao.prototype.parseSlice=function(e,r){r===void 0&&(r={});var o=new $t(this,r,!0);return o.addAll(e,null,r.from,r.to),ye.maxOpen(o.finish())};ao.prototype.matchTag=function(e,r,o){for(var a=o?this.tags.indexOf(o)+1:0;a<this.tags.length;a++){var l=this.tags[a];if(yO(e,l.tag)&&(l.namespace===void 0||e.namespaceURI==l.namespace)&&(!l.context||r.matchesContext(l.context))){if(l.getAttrs){var d=l.getAttrs(e);if(d===!1)continue;l.attrs=d}return l}}};ao.prototype.matchStyle=function(e,r,o,a){for(var l=a?this.styles.indexOf(a)+1:0;l<this.styles.length;l++){var d=this.styles[l];if(!(d.style.indexOf(e)!=0||d.context&&!o.matchesContext(d.context)||d.style.length>e.length&&(d.style.charCodeAt(e.length)!=61||d.style.slice(e.length+1)!=r))){if(d.getAttrs){var A=d.getAttrs(r);if(A===!1)continue;d.attrs=A}return d}}};ao.schemaRules=function(e){var r=[];function o(g){for(var v=g.priority==null?50:g.priority,C=0;C<r.length;C++){var y=r[C],w=y.priority==null?50:y.priority;if(w<v)break}r.splice(C,0,g)}var a=function(g){var v=e.marks[g].spec.parseDOM;v&&v.forEach(function(C){o(C=OC(C)),C.mark=g})};for(var l in e.marks)a(l);var d=function(g){var v=e.nodes[A].spec.parseDOM;v&&v.forEach(function(C){o(C=OC(C)),C.node=A})};for(var A in e.nodes)d();return r};ao.fromSchema=function(e){return e.cached.domParser||(e.cached.domParser=new ao(e,ao.schemaRules(e)))};var MA={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},IO={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},wC={ol:!0,ul:!0},PA=1,QA=2,bl=4;function NC(t){return(t?PA:0)|(t==="full"?QA:0)}var es=function(e,r,o,a,l,d,A){this.type=e,this.attrs=r,this.solid=l,this.match=d||(A&bl?null:e.contentMatch),this.options=A,this.content=[],this.marks=o,this.activeMarks=Rt.none,this.pendingMarks=a,this.stashMarks=[]};es.prototype.findWrapping=function(e){if(!this.match){if(!this.type)return[];var r=this.type.contentMatch.fillBefore(ee.from(e));if(r)this.match=this.type.contentMatch.matchFragment(r);else{var o=this.type.contentMatch,a;return(a=o.findWrapping(e.type))?(this.match=o,a):null}}return this.match.findWrapping(e.type)};es.prototype.finish=function(e){if(!(this.options&PA)){var r=this.content[this.content.length-1],o;r&&r.isText&&(o=/[ \t\r\n\u000c]+$/.exec(r.text))&&(r.text.length==o[0].length?this.content.pop():this.content[this.content.length-1]=r.withText(r.text.slice(0,r.text.length-o[0].length)))}var a=ee.from(this.content);return!e&&this.match&&(a=a.append(this.match.fillBefore(ee.empty,!0))),this.type?this.type.create(this.attrs,a,this.marks):a};es.prototype.popFromStashMark=function(e){for(var r=this.stashMarks.length-1;r>=0;r--)if(e.eq(this.stashMarks[r]))return this.stashMarks.splice(r,1)[0]};es.prototype.applyPending=function(e){for(var r=0,o=this.pendingMarks;r<o.length;r++){var a=o[r];(this.type?this.type.allowsMarkType(a.type):SO(a.type,e))&&!a.isInSet(this.activeMarks)&&(this.activeMarks=a.addToSet(this.activeMarks),this.pendingMarks=a.removeFromSet(this.pendingMarks))}};es.prototype.inlineContext=function(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!MA.hasOwnProperty(e.parentNode.nodeName.toLowerCase())};var $t=function(e,r,o){this.parser=e,this.options=r,this.isOpen=o;var a=r.topNode,l,d=NC(r.preserveWhitespace)|(o?bl:0);a?l=new es(a.type,a.attrs,Rt.none,Rt.none,!0,r.topMatch||a.type.contentMatch,d):o?l=new es(null,null,Rt.none,Rt.none,!0,null,d):l=new es(e.schema.topNodeType,null,Rt.none,Rt.none,!0,null,d),this.nodes=[l],this.open=0,this.find=r.findPositions,this.needsBlock=!1},xA={top:{configurable:!0},currentPos:{configurable:!0}};xA.top.get=function(){return this.nodes[this.open]};$t.prototype.addDOM=function(e){if(e.nodeType==3)this.addTextNode(e);else if(e.nodeType==1){var r=e.getAttribute("style"),o=r?this.readStyles(_O(r)):null,a=this.top;if(o!=null)for(var l=0;l<o.length;l++)this.addPendingMark(o[l]);if(this.addElement(e),o!=null)for(var d=0;d<o.length;d++)this.removePendingMark(o[d],a)}};$t.prototype.addTextNode=function(e){var r=e.nodeValue,o=this.top;if(o.options&QA||o.inlineContext(e)||/[^ \t\r\n\u000c]/.test(r)){if(o.options&PA)o.options&QA?r=r.replace(/\r\n?/g,`
`):r=r.replace(/\r?\n|\r/g," ");else if(r=r.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(r)&&this.open==this.nodes.length-1){var a=o.content[o.content.length-1],l=e.previousSibling;(!a||l&&l.nodeName=="BR"||a.isText&&/[ \t\r\n\u000c]$/.test(a.text))&&(r=r.slice(1))}r&&this.insertNode(this.parser.schema.text(r)),this.findInText(e)}else this.findInside(e)};$t.prototype.addElement=function(e,r){var o=e.nodeName.toLowerCase(),a;wC.hasOwnProperty(o)&&this.parser.normalizeLists&&CO(e);var l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(a=this.parser.matchTag(e,this,r));if(l?l.ignore:IO.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);var d,A=this.top,g=this.needsBlock;if(MA.hasOwnProperty(o))d=!0,A.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e);return}this.addAll(e),d&&this.sync(A),this.needsBlock=g}else this.addElementByRule(e,l,l.consuming===!1?a:null)};$t.prototype.leafFallback=function(e){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`))};$t.prototype.ignoreFallback=function(e){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"))};$t.prototype.readStyles=function(e){var r=Rt.none;e:for(var o=0;o<e.length;o+=2)for(var a=null;;){var l=this.parser.matchStyle(e[o],e[o+1],this,a);if(!l)continue e;if(l.ignore)return null;if(r=this.parser.schema.marks[l.mark].create(l.attrs).addToSet(r),l.consuming===!1)a=l;else break}return r};$t.prototype.addElementByRule=function(e,r,o){var a=this,l,d,A,g;r.node?(d=this.parser.schema.nodes[r.node],d.isLeaf?this.insertNode(d.create(r.attrs))||this.leafFallback(e):l=this.enter(d,r.attrs,r.preserveWhitespace)):(A=this.parser.schema.marks[r.mark],g=A.create(r.attrs),this.addPendingMark(g));var v=this.top;if(d&&d.isLeaf)this.findInside(e);else if(o)this.addElement(e,o);else if(r.getContent)this.findInside(e),r.getContent(e,this.parser.schema).forEach(function(y){return a.insertNode(y)});else{var C=r.contentElement;typeof C=="string"?C=e.querySelector(C):typeof C=="function"&&(C=C(e)),C||(C=e),this.findAround(e,C,!0),this.addAll(C,l)}l&&(this.sync(v),this.open--),g&&this.removePendingMark(g,v)};$t.prototype.addAll=function(e,r,o,a){for(var l=o||0,d=o?e.childNodes[o]:e.firstChild,A=a==null?null:e.childNodes[a];d!=A;d=d.nextSibling,++l)this.findAtPoint(e,l),this.addDOM(d),r&&MA.hasOwnProperty(d.nodeName.toLowerCase())&&this.sync(r);this.findAtPoint(e,l)};$t.prototype.findPlace=function(e){for(var r,o,a=this.open;a>=0;a--){var l=this.nodes[a],d=l.findWrapping(e);if(d&&(!r||r.length>d.length)&&(r=d,o=l,!d.length)||l.solid)break}if(!r)return!1;this.sync(o);for(var A=0;A<r.length;A++)this.enterInner(r[A],null,!1);return!0};$t.prototype.insertNode=function(e){if(e.isInline&&this.needsBlock&&!this.top.type){var r=this.textblockFromContext();r&&this.enterInner(r)}if(this.findPlace(e)){this.closeExtra();var o=this.top;o.applyPending(e.type),o.match&&(o.match=o.match.matchType(e.type));for(var a=o.activeMarks,l=0;l<e.marks.length;l++)(!o.type||o.type.allowsMarkType(e.marks[l].type))&&(a=e.marks[l].addToSet(a));return o.content.push(e.mark(a)),!0}return!1};$t.prototype.enter=function(e,r,o){var a=this.findPlace(e.create(r));return a&&this.enterInner(e,r,!0,o),a};$t.prototype.enterInner=function(e,r,o,a){this.closeExtra();var l=this.top;l.applyPending(e),l.match=l.match&&l.match.matchType(e,r);var d=a==null?l.options&~bl:NC(a);l.options&bl&&l.content.length==0&&(d|=bl),this.nodes.push(new es(e,r,l.activeMarks,l.pendingMarks,o,null,d)),this.open++};$t.prototype.closeExtra=function(e){var r=this.nodes.length-1;if(r>this.open){for(;r>this.open;r--)this.nodes[r-1].content.push(this.nodes[r].finish(e));this.nodes.length=this.open+1}};$t.prototype.finish=function(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)};$t.prototype.sync=function(e){for(var r=this.open;r>=0;r--)if(this.nodes[r]==e){this.open=r;return}};xA.currentPos.get=function(){this.closeExtra();for(var t=0,e=this.open;e>=0;e--){for(var r=this.nodes[e].content,o=r.length-1;o>=0;o--)t+=r[o].nodeSize;e&&t++}return t};$t.prototype.findAtPoint=function(e,r){if(this.find)for(var o=0;o<this.find.length;o++)this.find[o].node==e&&this.find[o].offset==r&&(this.find[o].pos=this.currentPos)};$t.prototype.findInside=function(e){if(this.find)for(var r=0;r<this.find.length;r++)this.find[r].pos==null&&e.nodeType==1&&e.contains(this.find[r].node)&&(this.find[r].pos=this.currentPos)};$t.prototype.findAround=function(e,r,o){if(e!=r&&this.find){for(var a=0;a<this.find.length;a++)if(this.find[a].pos==null&&e.nodeType==1&&e.contains(this.find[a].node)){var l=r.compareDocumentPosition(this.find[a].node);l&(o?2:4)&&(this.find[a].pos=this.currentPos)}}};$t.prototype.findInText=function(e){if(this.find)for(var r=0;r<this.find.length;r++)this.find[r].node==e&&(this.find[r].pos=this.currentPos-(e.nodeValue.length-this.find[r].offset))};$t.prototype.matchesContext=function(e){var r=this;if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);var o=e.split("/"),a=this.options.context,l=!this.isOpen&&(!a||a.parent.type==this.nodes[0].type),d=-(a?a.depth+1:0)+(l?0:1),A=function(g,v){for(;g>=0;g--){var C=o[g];if(C==""){if(g==o.length-1||g==0)continue;for(;v>=d;v--)if(A(g-1,v))return!0;return!1}else{var y=v>0||v==0&&l?r.nodes[v].type:a&&v>=d?a.node(v-d).type:null;if(!y||y.name!=C&&y.groups.indexOf(C)==-1)return!1;v--}}return!0};return A(o.length-1,this.open)};$t.prototype.textblockFromContext=function(){var e=this.options.context;if(e)for(var r=e.depth;r>=0;r--){var o=e.node(r).contentMatchAt(e.indexAfter(r)).defaultType;if(o&&o.isTextblock&&o.defaultAttrs)return o}for(var a in this.parser.schema.nodes){var l=this.parser.schema.nodes[a];if(l.isTextblock&&l.defaultAttrs)return l}};$t.prototype.addPendingMark=function(e){var r=TO(e,this.top.pendingMarks);r&&this.top.stashMarks.push(r),this.top.pendingMarks=e.addToSet(this.top.pendingMarks)};$t.prototype.removePendingMark=function(e,r){for(var o=this.open;o>=0;o--){var a=this.nodes[o],l=a.pendingMarks.lastIndexOf(e);if(l>-1)a.pendingMarks=e.removeFromSet(a.pendingMarks);else{a.activeMarks=e.removeFromSet(a.activeMarks);var d=a.popFromStashMark(e);d&&a.type&&a.type.allowsMarkType(d.type)&&(a.activeMarks=d.addToSet(a.activeMarks))}if(a==r)break}};Object.defineProperties($t.prototype,xA);function CO(t){for(var e=t.firstChild,r=null;e;e=e.nextSibling){var o=e.nodeType==1?e.nodeName.toLowerCase():null;o&&wC.hasOwnProperty(o)&&r?(r.appendChild(e),e=r):o=="li"?r=e:o&&(r=null)}}function yO(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function _O(t){for(var e=/\s*([\w-]+)\s*:\s*([^;]+)/g,r,o=[];r=e.exec(t);)o.push(r[1],r[2].trim());return o}function OC(t){var e={};for(var r in t)e[r]=t[r];return e}function SO(t,e){var r=e.schema.nodes,o=function(d){var A=r[d];if(!!A.allowsMarkType(t)){var g=[],v=function(C){g.push(C);for(var y=0;y<C.edgeCount;y++){var w=C.edge(y),k=w.type,M=w.next;if(k==e||g.indexOf(M)<0&&v(M))return!0}};if(v(A.contentMatch))return{v:!0}}};for(var a in r){var l=o(a);if(l)return l.v}}function TO(t,e){for(var r=0;r<e.length;r++)if(t.eq(e[r]))return e[r]}var Rn=function(e,r){this.nodes=e||{},this.marks=r||{}};Rn.prototype.serializeFragment=function(e,r,o){var a=this;r===void 0&&(r={}),o||(o=UA(r).createDocumentFragment());var l=o,d=null;return e.forEach(function(A){if(d||A.marks.length){d||(d=[]);for(var g=0,v=0;g<d.length&&v<A.marks.length;){var C=A.marks[v];if(!a.marks[C.type.name]){v++;continue}if(!C.eq(d[g])||C.type.spec.spanning===!1)break;g+=2,v++}for(;g<d.length;)l=d.pop(),d.pop();for(;v<A.marks.length;){var y=A.marks[v++],w=a.serializeMark(y,A.isInline,r);w&&(d.push(y,l),l.appendChild(w.dom),l=w.contentDOM||w.dom)}}l.appendChild(a.serializeNodeInner(A,r))}),o};Rn.prototype.serializeNodeInner=function(e,r){r===void 0&&(r={});var o=Rn.renderSpec(UA(r),this.nodes[e.type.name](e)),a=o.dom,l=o.contentDOM;if(l){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");r.onContent?r.onContent(e,l,r):this.serializeFragment(e.content,r,l)}return a};Rn.prototype.serializeNode=function(e,r){r===void 0&&(r={});for(var o=this.serializeNodeInner(e,r),a=e.marks.length-1;a>=0;a--){var l=this.serializeMark(e.marks[a],e.isInline,r);l&&((l.contentDOM||l.dom).appendChild(o),o=l.dom)}return o};Rn.prototype.serializeMark=function(e,r,o){o===void 0&&(o={});var a=this.marks[e.type.name];return a&&Rn.renderSpec(UA(o),a(e,r))};Rn.renderSpec=function(e,r,o){if(o===void 0&&(o=null),typeof r=="string")return{dom:e.createTextNode(r)};if(r.nodeType!=null)return{dom:r};if(r.dom&&r.dom.nodeType!=null)return r;var a=r[0],l=a.indexOf(" ");l>0&&(o=a.slice(0,l),a=a.slice(l+1));var d=null,A=o?e.createElementNS(o,a):e.createElement(a),g=r[1],v=1;if(g&&typeof g=="object"&&g.nodeType==null&&!Array.isArray(g)){v=2;for(var C in g)if(g[C]!=null){var y=C.indexOf(" ");y>0?A.setAttributeNS(C.slice(0,y),C.slice(y+1),g[C]):A.setAttribute(C,g[C])}}for(var w=v;w<r.length;w++){var k=r[w];if(k===0){if(w<r.length-1||w>v)throw new RangeError("Content hole must be the only child of its parent node");return{dom:A,contentDOM:A}}else{var M=Rn.renderSpec(e,k,o),F=M.dom,K=M.contentDOM;if(A.appendChild(F),K){if(d)throw new RangeError("Multiple content holes");d=K}}}return{dom:A,contentDOM:d}};Rn.fromSchema=function(e){return e.cached.domSerializer||(e.cached.domSerializer=new Rn(this.nodesFromSchema(e),this.marksFromSchema(e)))};Rn.nodesFromSchema=function(e){var r=kC(e.nodes);return r.text||(r.text=function(o){return o.text}),r};Rn.marksFromSchema=function(e){return kC(e.marks)};function kC(t){var e={};for(var r in t){var o=t[r].spec.toDOM;o&&(e[r]=o)}return e}function UA(t){return t.document||window.document}var bC=65535,DC=Math.pow(2,16);function RO(t,e){return t+e*DC}function BC(t){return t&bC}function wO(t){return(t-(t&bC))/DC}var FA=function(e,r,o){r===void 0&&(r=!1),o===void 0&&(o=null),this.pos=e,this.deleted=r,this.recover=o},dn=function(e,r){r===void 0&&(r=!1),this.ranges=e,this.inverted=r};dn.prototype.recover=function(e){var r=0,o=BC(e);if(!this.inverted)for(var a=0;a<o;a++)r+=this.ranges[a*3+2]-this.ranges[a*3+1];return this.ranges[o*3]+r+wO(e)};dn.prototype.mapResult=function(e,r){return r===void 0&&(r=1),this._map(e,r,!1)};dn.prototype.map=function(e,r){return r===void 0&&(r=1),this._map(e,r,!0)};dn.prototype._map=function(e,r,o){for(var a=0,l=this.inverted?2:1,d=this.inverted?1:2,A=0;A<this.ranges.length;A+=3){var g=this.ranges[A]-(this.inverted?a:0);if(g>e)break;var v=this.ranges[A+l],C=this.ranges[A+d],y=g+v;if(e<=y){var w=v?e==g?-1:e==y?1:r:r,k=g+a+(w<0?0:C);if(o)return k;var M=e==(r<0?g:y)?null:RO(A/3,e-g);return new FA(k,r<0?e!=g:e!=y,M)}a+=C-v}return o?e+a:new FA(e+a)};dn.prototype.touches=function(e,r){for(var o=0,a=BC(r),l=this.inverted?2:1,d=this.inverted?1:2,A=0;A<this.ranges.length;A+=3){var g=this.ranges[A]-(this.inverted?o:0);if(g>e)break;var v=this.ranges[A+l],C=g+v;if(e<=C&&A==a*3)return!0;o+=this.ranges[A+d]-v}return!1};dn.prototype.forEach=function(e){for(var r=this.inverted?2:1,o=this.inverted?1:2,a=0,l=0;a<this.ranges.length;a+=3){var d=this.ranges[a],A=d-(this.inverted?l:0),g=d+(this.inverted?0:l),v=this.ranges[a+r],C=this.ranges[a+o];e(A,A+v,g,g+C),l+=C-v}};dn.prototype.invert=function(){return new dn(this.ranges,!this.inverted)};dn.prototype.toString=function(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)};dn.offset=function(e){return e==0?dn.empty:new dn(e<0?[0,-e,0]:[0,0,e])};dn.empty=new dn([]);var wn=function(e,r,o,a){this.maps=e||[],this.from=o||0,this.to=a==null?this.maps.length:a,this.mirror=r};wn.prototype.slice=function(e,r){return e===void 0&&(e=0),r===void 0&&(r=this.maps.length),new wn(this.maps,this.mirror,e,r)};wn.prototype.copy=function(){return new wn(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)};wn.prototype.appendMap=function(e,r){this.to=this.maps.push(e),r!=null&&this.setMirror(this.maps.length-1,r)};wn.prototype.appendMapping=function(e){for(var r=0,o=this.maps.length;r<e.maps.length;r++){var a=e.getMirror(r);this.appendMap(e.maps[r],a!=null&&a<r?o+a:null)}};wn.prototype.getMirror=function(e){if(this.mirror){for(var r=0;r<this.mirror.length;r++)if(this.mirror[r]==e)return this.mirror[r+(r%2?-1:1)]}};wn.prototype.setMirror=function(e,r){this.mirror||(this.mirror=[]),this.mirror.push(e,r)};wn.prototype.appendMappingInverted=function(e){for(var r=e.maps.length-1,o=this.maps.length+e.maps.length;r>=0;r--){var a=e.getMirror(r);this.appendMap(e.maps[r].invert(),a!=null&&a>r?o-a-1:null)}};wn.prototype.invert=function(){var e=new wn;return e.appendMappingInverted(this),e};wn.prototype.map=function(e,r){if(r===void 0&&(r=1),this.mirror)return this._map(e,r,!0);for(var o=this.from;o<this.to;o++)e=this.maps[o].map(e,r);return e};wn.prototype.mapResult=function(e,r){return r===void 0&&(r=1),this._map(e,r,!1)};wn.prototype._map=function(e,r,o){for(var a=!1,l=this.from;l<this.to;l++){var d=this.maps[l],A=d.mapResult(e,r);if(A.recover!=null){var g=this.getMirror(l);if(g!=null&&g>l&&g<this.to){l=g,e=this.maps[g].recover(A.recover);continue}}A.deleted&&(a=!0),e=A.pos}return o?e:new FA(e,a)};function Ec(t){var e=Error.call(this,t);return e.__proto__=Ec.prototype,e}Ec.prototype=Object.create(Error.prototype);Ec.prototype.constructor=Ec;Ec.prototype.name="TransformError";var Tr=function(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new wn},VA={before:{configurable:!0},docChanged:{configurable:!0}};VA.before.get=function(){return this.docs.length?this.docs[0]:this.doc};Tr.prototype.step=function(e){var r=this.maybeStep(e);if(r.failed)throw new Ec(r.failed);return this};Tr.prototype.maybeStep=function(e){var r=e.apply(this.doc);return r.failed||this.addStep(e,r.doc),r};VA.docChanged.get=function(){return this.steps.length>0};Tr.prototype.addStep=function(e,r){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=r};Object.defineProperties(Tr.prototype,VA);function bd(){throw new Error("Override me")}var GA=Object.create(null),Nn=function(){};Nn.prototype.apply=function(e){return bd()};Nn.prototype.getMap=function(){return dn.empty};Nn.prototype.invert=function(e){return bd()};Nn.prototype.map=function(e){return bd()};Nn.prototype.merge=function(e){return null};Nn.prototype.toJSON=function(){return bd()};Nn.fromJSON=function(e,r){if(!r||!r.stepType)throw new RangeError("Invalid input for Step.fromJSON");var o=GA[r.stepType];if(!o)throw new RangeError("No step type "+r.stepType+" defined");return o.fromJSON(e,r)};Nn.jsonID=function(e,r){if(e in GA)throw new RangeError("Duplicate use of step JSON ID "+e);return GA[e]=r,r.prototype.jsonID=e,r};var Gn=function(e,r){this.doc=e,this.failed=r};Gn.ok=function(e){return new Gn(e,null)};Gn.fail=function(e){return new Gn(null,e)};Gn.fromReplace=function(e,r,o,a){try{return Gn.ok(e.replace(r,o,a))}catch(l){if(l instanceof No)return Gn.fail(l.message);throw l}};var ts=function(t){function e(r,o,a,l){t.call(this),this.from=r,this.to=o,this.slice=a,this.structure=!!l}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(o){return this.structure&&jA(o,this.from,this.to)?Gn.fail("Structure replace would overwrite content"):Gn.fromReplace(o,this.from,this.to,this.slice)},e.prototype.getMap=function(){return new dn([this.from,this.to-this.from,this.slice.size])},e.prototype.invert=function(o){return new e(this.from,this.from+this.slice.size,o.slice(this.from,this.to))},e.prototype.map=function(o){var a=o.mapResult(this.from,1),l=o.mapResult(this.to,-1);return a.deleted&&l.deleted?null:new e(a.pos,Math.max(a.pos,l.pos),this.slice)},e.prototype.merge=function(o){if(!(o instanceof e)||o.structure||this.structure)return null;if(this.from+this.slice.size==o.from&&!this.slice.openEnd&&!o.slice.openStart){var a=this.slice.size+o.slice.size==0?ye.empty:new ye(this.slice.content.append(o.slice.content),this.slice.openStart,o.slice.openEnd);return new e(this.from,this.to+(o.to-o.from),a,this.structure)}else if(o.to==this.from&&!this.slice.openStart&&!o.slice.openEnd){var l=this.slice.size+o.slice.size==0?ye.empty:new ye(o.slice.content.append(this.slice.content),o.slice.openStart,this.slice.openEnd);return new e(o.from,this.to,l,this.structure)}else return null},e.prototype.toJSON=function(){var o={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(o.slice=this.slice.toJSON()),this.structure&&(o.structure=!0),o},e.fromJSON=function(o,a){if(typeof a.from!="number"||typeof a.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new e(a.from,a.to,ye.fromJSON(o,a.slice),!!a.structure)},e}(Nn);Nn.jsonID("replace",ts);var ri=function(t){function e(r,o,a,l,d,A,g){t.call(this),this.from=r,this.to=o,this.gapFrom=a,this.gapTo=l,this.slice=d,this.insert=A,this.structure=!!g}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(o){if(this.structure&&(jA(o,this.from,this.gapFrom)||jA(o,this.gapTo,this.to)))return Gn.fail("Structure gap-replace would overwrite content");var a=o.slice(this.gapFrom,this.gapTo);if(a.openStart||a.openEnd)return Gn.fail("Gap is not a flat range");var l=this.slice.insertAt(this.insert,a.content);return l?Gn.fromReplace(o,this.from,this.to,l):Gn.fail("Content does not fit in gap")},e.prototype.getMap=function(){return new dn([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])},e.prototype.invert=function(o){var a=this.gapTo-this.gapFrom;return new e(this.from,this.from+this.slice.size+a,this.from+this.insert,this.from+this.insert+a,o.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)},e.prototype.map=function(o){var a=o.mapResult(this.from,1),l=o.mapResult(this.to,-1),d=o.map(this.gapFrom,-1),A=o.map(this.gapTo,1);return a.deleted&&l.deleted||d<a.pos||A>l.pos?null:new e(a.pos,l.pos,d,A,this.slice,this.insert,this.structure)},e.prototype.toJSON=function(){var o={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(o.slice=this.slice.toJSON()),this.structure&&(o.structure=!0),o},e.fromJSON=function(o,a){if(typeof a.from!="number"||typeof a.to!="number"||typeof a.gapFrom!="number"||typeof a.gapTo!="number"||typeof a.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new e(a.from,a.to,a.gapFrom,a.gapTo,ye.fromJSON(o,a.slice),a.insert,!!a.structure)},e}(Nn);Nn.jsonID("replaceAround",ri);function jA(t,e,r){for(var o=t.resolve(e),a=r-e,l=o.depth;a>0&&l>0&&o.indexAfter(l)==o.node(l).childCount;)l--,a--;if(a>0)for(var d=o.node(l).maybeChild(o.indexAfter(l));a>0;){if(!d||d.isLeaf)return!0;d=d.firstChild,a--}return!1}function NO(t,e,r){return(e==0||t.canReplace(e,t.childCount))&&(r==t.childCount||t.canReplace(0,r))}function Ic(t){for(var e=t.parent,r=e.content.cutByIndex(t.startIndex,t.endIndex),o=t.depth;;--o){var a=t.$from.node(o),l=t.$from.index(o),d=t.$to.indexAfter(o);if(o<t.depth&&a.canReplace(l,d,r))return o;if(o==0||a.type.spec.isolating||!NO(a,l,d))break}}Tr.prototype.lift=function(t,e){for(var r=t.$from,o=t.$to,a=t.depth,l=r.before(a+1),d=o.after(a+1),A=l,g=d,v=ee.empty,C=0,y=a,w=!1;y>e;y--)w||r.index(y)>0?(w=!0,v=ee.from(r.node(y).copy(v)),C++):A--;for(var k=ee.empty,M=0,F=a,K=!1;F>e;F--)K||o.after(F+1)<o.end(F)?(K=!0,k=ee.from(o.node(F).copy(k)),M++):g++;return this.step(new ri(A,g,l,d,new ye(v.append(k),C,M),v.size-C,!0))};function HA(t,e,r,o){o===void 0&&(o=t);var a=OO(t,e),l=a&&kO(o,e);return l?a.map(LC).concat({type:e,attrs:r}).concat(l.map(LC)):null}function LC(t){return{type:t,attrs:null}}function OO(t,e){var r=t.parent,o=t.startIndex,a=t.endIndex,l=r.contentMatchAt(o).findWrapping(e);if(!l)return null;var d=l.length?l[0]:e;return r.canReplaceWith(o,a,d)?l:null}function kO(t,e){var r=t.parent,o=t.startIndex,a=t.endIndex,l=r.child(o),d=e.contentMatch.findWrapping(l.type);if(!d)return null;for(var A=d.length?d[d.length-1]:e,g=A.contentMatch,v=o;g&&v<a;v++)g=g.matchType(r.child(v).type);return!g||!g.validEnd?null:d}Tr.prototype.wrap=function(t,e){for(var r=ee.empty,o=e.length-1;o>=0;o--)r=ee.from(e[o].type.create(e[o].attrs,r));var a=t.start,l=t.end;return this.step(new ri(a,l,a,l,new ye(r,0,0),e.length,!0))};Tr.prototype.setBlockType=function(t,e,r,o){var a=this;if(e===void 0&&(e=t),!r.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");var l=this.steps.length;return this.doc.nodesBetween(t,e,function(d,A){if(d.isTextblock&&!d.hasMarkup(r,o)&&bO(a.doc,a.mapping.slice(l).map(A),r)){a.clearIncompatible(a.mapping.slice(l).map(A,1),r);var g=a.mapping.slice(l),v=g.map(A,1),C=g.map(A+d.nodeSize,1);return a.step(new ri(v,C,v+1,C-1,new ye(ee.from(r.create(o,null,d.marks)),0,0),1,!0)),!1}}),this};function bO(t,e,r){var o=t.resolve(e),a=o.index();return o.parent.canReplaceWith(a,a+1,r)}Tr.prototype.setNodeMarkup=function(t,e,r,o){var a=this.doc.nodeAt(t);if(!a)throw new RangeError("No node at given position");e||(e=a.type);var l=e.create(r,null,o||a.marks);if(a.isLeaf)return this.replaceWith(t,t+a.nodeSize,l);if(!e.validContent(a.content))throw new RangeError("Invalid content for node type "+e.name);return this.step(new ri(t,t+a.nodeSize,t+1,t+a.nodeSize-1,new ye(ee.from(l),0,0),1,!0))};function rs(t,e,r,o){r===void 0&&(r=1);var a=t.resolve(e),l=a.depth-r,d=o&&o[o.length-1]||a.parent;if(l<0||a.parent.type.spec.isolating||!a.parent.canReplace(a.index(),a.parent.childCount)||!d.type.validContent(a.parent.content.cutByIndex(a.index(),a.parent.childCount)))return!1;for(var A=a.depth-1,g=r-2;A>l;A--,g--){var v=a.node(A),C=a.index(A);if(v.type.spec.isolating)return!1;var y=v.content.cutByIndex(C,v.childCount),w=o&&o[g]||v;if(w!=v&&(y=y.replaceChild(0,w.type.create(w.attrs))),!v.canReplace(C+1,v.childCount)||!w.type.validContent(y))return!1}var k=a.indexAfter(l),M=o&&o[0];return a.node(l).canReplaceWith(k,k,M?M.type:a.node(l+1).type)}Tr.prototype.split=function(t,e,r){e===void 0&&(e=1);for(var o=this.doc.resolve(t),a=ee.empty,l=ee.empty,d=o.depth,A=o.depth-e,g=e-1;d>A;d--,g--){a=ee.from(o.node(d).copy(a));var v=r&&r[g];l=ee.from(v?v.type.create(v.attrs,l):o.node(d).copy(l))}return this.step(new ts(t,t,new ye(a.append(l),e,e),!0))};function KA(t,e){var r=t.resolve(e),o=r.index();return DO(r.nodeBefore,r.nodeAfter)&&r.parent.canReplace(o,o+1)}function DO(t,e){return t&&e&&!t.isLeaf&&t.canAppend(e)}Tr.prototype.join=function(t,e){e===void 0&&(e=1);var r=new ts(t-e,t+e,ye.empty,!0);return this.step(r)};function BO(t,e,r){var o=t.resolve(e);if(o.parent.canReplaceWith(o.index(),o.index(),r))return e;if(o.parentOffset==0)for(var a=o.depth-1;a>=0;a--){var l=o.index(a);if(o.node(a).canReplaceWith(l,l,r))return o.before(a+1);if(l>0)return null}if(o.parentOffset==o.parent.content.size)for(var d=o.depth-1;d>=0;d--){var A=o.indexAfter(d);if(o.node(d).canReplaceWith(A,A,r))return o.after(d+1);if(A<o.node(d).childCount)return null}}function MC(t,e,r){var o=t.resolve(e);if(!r.content.size)return e;for(var a=r.content,l=0;l<r.openStart;l++)a=a.firstChild.content;for(var d=1;d<=(r.openStart==0&&r.size?2:1);d++)for(var A=o.depth;A>=0;A--){var g=A==o.depth?0:o.pos<=(o.start(A+1)+o.end(A+1))/2?-1:1,v=o.index(A)+(g>0?1:0),C=o.node(A),y=!1;if(d==1)y=C.canReplace(v,v,a);else{var w=C.contentMatchAt(v).findWrapping(a.firstChild.type);y=w&&C.canReplaceWith(v,v,w[0])}if(y)return g==0?o.pos:g<0?o.before(A+1):o.after(A+1)}return null}function WA(t,e,r){for(var o=[],a=0;a<t.childCount;a++){var l=t.child(a);l.content.size&&(l=l.copy(WA(l.content,e,l))),l.isInline&&(l=e(l,r,a)),o.push(l)}return ee.fromArray(o)}var YA=function(t){function e(r,o,a){t.call(this),this.from=r,this.to=o,this.mark=a}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(o){var a=this,l=o.slice(this.from,this.to),d=o.resolve(this.from),A=d.node(d.sharedDepth(this.to)),g=new ye(WA(l.content,function(v,C){return!v.isAtom||!C.type.allowsMarkType(a.mark.type)?v:v.mark(a.mark.addToSet(v.marks))},A),l.openStart,l.openEnd);return Gn.fromReplace(o,this.from,this.to,g)},e.prototype.invert=function(){return new Dl(this.from,this.to,this.mark)},e.prototype.map=function(o){var a=o.mapResult(this.from,1),l=o.mapResult(this.to,-1);return a.deleted&&l.deleted||a.pos>=l.pos?null:new e(a.pos,l.pos,this.mark)},e.prototype.merge=function(o){if(o instanceof e&&o.mark.eq(this.mark)&&this.from<=o.to&&this.to>=o.from)return new e(Math.min(this.from,o.from),Math.max(this.to,o.to),this.mark)},e.prototype.toJSON=function(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},e.fromJSON=function(o,a){if(typeof a.from!="number"||typeof a.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new e(a.from,a.to,o.markFromJSON(a.mark))},e}(Nn);Nn.jsonID("addMark",YA);var Dl=function(t){function e(r,o,a){t.call(this),this.from=r,this.to=o,this.mark=a}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(o){var a=this,l=o.slice(this.from,this.to),d=new ye(WA(l.content,function(A){return A.mark(a.mark.removeFromSet(A.marks))}),l.openStart,l.openEnd);return Gn.fromReplace(o,this.from,this.to,d)},e.prototype.invert=function(){return new YA(this.from,this.to,this.mark)},e.prototype.map=function(o){var a=o.mapResult(this.from,1),l=o.mapResult(this.to,-1);return a.deleted&&l.deleted||a.pos>=l.pos?null:new e(a.pos,l.pos,this.mark)},e.prototype.merge=function(o){if(o instanceof e&&o.mark.eq(this.mark)&&this.from<=o.to&&this.to>=o.from)return new e(Math.min(this.from,o.from),Math.max(this.to,o.to),this.mark)},e.prototype.toJSON=function(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},e.fromJSON=function(o,a){if(typeof a.from!="number"||typeof a.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new e(a.from,a.to,o.markFromJSON(a.mark))},e}(Nn);Nn.jsonID("removeMark",Dl);Tr.prototype.addMark=function(t,e,r){var o=this,a=[],l=[],d=null,A=null;return this.doc.nodesBetween(t,e,function(g,v,C){if(!!g.isInline){var y=g.marks;if(!r.isInSet(y)&&C.type.allowsMarkType(r.type)){for(var w=Math.max(v,t),k=Math.min(v+g.nodeSize,e),M=r.addToSet(y),F=0;F<y.length;F++)y[F].isInSet(M)||(d&&d.to==w&&d.mark.eq(y[F])?d.to=k:a.push(d=new Dl(w,k,y[F])));A&&A.to==w?A.to=k:l.push(A=new YA(w,k,r))}}}),a.forEach(function(g){return o.step(g)}),l.forEach(function(g){return o.step(g)}),this};Tr.prototype.removeMark=function(t,e,r){var o=this;r===void 0&&(r=null);var a=[],l=0;return this.doc.nodesBetween(t,e,function(d,A){if(!!d.isInline){l++;var g=null;if(r instanceof pa)for(var v=d.marks,C;C=r.isInSet(v);)(g||(g=[])).push(C),v=C.removeFromSet(v);else r?r.isInSet(d.marks)&&(g=[r]):g=d.marks;if(g&&g.length)for(var y=Math.min(A+d.nodeSize,e),w=0;w<g.length;w++){for(var k=g[w],M=void 0,F=0;F<a.length;F++){var K=a[F];K.step==l-1&&k.eq(a[F].style)&&(M=K)}M?(M.to=y,M.step=l):a.push({style:k,from:Math.max(A,t),to:y,step:l})}}}),a.forEach(function(d){return o.step(new Dl(d.from,d.to,d.style))}),this};Tr.prototype.clearIncompatible=function(t,e,r){r===void 0&&(r=e.contentMatch);for(var o=this.doc.nodeAt(t),a=[],l=t+1,d=0;d<o.childCount;d++){var A=o.child(d),g=l+A.nodeSize,v=r.matchType(A.type,A.attrs);if(!v)a.push(new ts(l,g,ye.empty));else{r=v;for(var C=0;C<A.marks.length;C++)e.allowsMarkType(A.marks[C].type)||this.step(new Dl(l,g,A.marks[C]))}l=g}if(!r.validEnd){var y=r.fillBefore(ee.empty,!0);this.replace(l,l,new ye(y,0,0))}for(var w=a.length-1;w>=0;w--)this.step(a[w]);return this};function LO(t,e,r,o){if(r===void 0&&(r=e),o===void 0&&(o=ye.empty),e==r&&!o.size)return null;var a=t.resolve(e),l=t.resolve(r);return PC(a,l,o)?new ts(e,r,o):new Vi(a,l,o).fit()}Tr.prototype.replace=function(t,e,r){e===void 0&&(e=t),r===void 0&&(r=ye.empty);var o=LO(this.doc,t,e,r);return o&&this.step(o),this};Tr.prototype.replaceWith=function(t,e,r){return this.replace(t,e,new ye(ee.from(r),0,0))};Tr.prototype.delete=function(t,e){return this.replace(t,e,ye.empty)};Tr.prototype.insert=function(t,e){return this.replaceWith(t,t,e)};function PC(t,e,r){return!r.openStart&&!r.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),r.content)}var Vi=function(e,r,o){this.$to=r,this.$from=e,this.unplaced=o,this.frontier=[];for(var a=0;a<=e.depth;a++){var l=e.node(a);this.frontier.push({type:l.type,match:l.contentMatchAt(e.indexAfter(a))})}this.placed=ee.empty;for(var d=e.depth;d>0;d--)this.placed=ee.from(e.node(d).copy(this.placed))},QC={depth:{configurable:!0}};QC.depth.get=function(){return this.frontier.length-1};Vi.prototype.fit=function(){for(;this.unplaced.size;){var e=this.findFittable();e?this.placeNodes(e):this.openMore()||this.dropNode()}var r=this.mustMoveInline(),o=this.placed.size-this.depth-this.$from.depth,a=this.$from,l=this.close(r<0?this.$to:a.doc.resolve(r));if(!l)return null;for(var d=this.placed,A=a.depth,g=l.depth;A&&g&&d.childCount==1;)d=d.firstChild.content,A--,g--;var v=new ye(d,A,g);if(r>-1)return new ri(a.pos,r,this.$to.pos,this.$to.end(),v,o);if(v.size||a.pos!=this.$to.pos)return new ts(a.pos,l.pos,v)};Vi.prototype.findFittable=function(){for(var e=1;e<=2;e++)for(var r=this.unplaced.openStart;r>=0;r--){var o=void 0,a=void 0;r?(a=qA(this.unplaced.content,r-1).firstChild,o=a.content):o=this.unplaced.content;for(var l=o.firstChild,d=this.depth;d>=0;d--){var A=this.frontier[d],g=A.type,v=A.match,C=void 0,y=void 0;if(e==1&&(l?v.matchType(l.type)||(y=v.fillBefore(ee.from(l),!1)):g.compatibleContent(a.type)))return{sliceDepth:r,frontierDepth:d,parent:a,inject:y};if(e==2&&l&&(C=v.findWrapping(l.type)))return{sliceDepth:r,frontierDepth:d,parent:a,wrap:C};if(a&&v.matchType(a.type))break}}};Vi.prototype.openMore=function(){var e=this.unplaced,r=e.content,o=e.openStart,a=e.openEnd,l=qA(r,o);return!l.childCount||l.firstChild.isLeaf?!1:(this.unplaced=new ye(r,o+1,Math.max(a,l.size+o>=r.size-a?o+1:0)),!0)};Vi.prototype.dropNode=function(){var e=this.unplaced,r=e.content,o=e.openStart,a=e.openEnd,l=qA(r,o);if(l.childCount<=1&&o>0){var d=r.size-o<=o+l.size;this.unplaced=new ye(Bl(r,o-1,1),o-1,d?o-1:a)}else this.unplaced=new ye(Bl(r,o,1),o,a)};Vi.prototype.placeNodes=function(e){for(var r=e.sliceDepth,o=e.frontierDepth,a=e.parent,l=e.inject,d=e.wrap;this.depth>o;)this.closeFrontierNode();if(d)for(var A=0;A<d.length;A++)this.openFrontierNode(d[A]);var g=this.unplaced,v=a?a.content:g.content,C=g.openStart-r,y=0,w=[],k=this.frontier[o],M=k.match,F=k.type;if(l){for(var K=0;K<l.childCount;K++)w.push(l.child(K));M=M.matchFragment(l)}for(var J=v.size+r-(g.content.size-g.openEnd);y<v.childCount;){var U=v.child(y),te=M.matchType(U.type);if(!te)break;y++,(y>1||C==0||U.content.size)&&(M=te,w.push(xC(U.mark(F.allowedMarks(U.marks)),y==1?C:0,y==v.childCount?J:-1)))}var P=y==v.childCount;P||(J=-1),this.placed=Ll(this.placed,o,ee.from(w)),this.frontier[o].match=M,P&&J<0&&a&&a.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(var he=0,ne=v;he<J;he++){var me=ne.lastChild;this.frontier.push({type:me.type,match:me.contentMatchAt(me.childCount)}),ne=me.content}this.unplaced=P?r==0?ye.empty:new ye(Bl(g.content,r-1,1),r-1,J<0?g.openEnd:r-1):new ye(Bl(g.content,r,y),g.openStart,g.openEnd)};Vi.prototype.mustMoveInline=function(){if(!this.$to.parent.isTextblock||this.$to.end()==this.$to.pos)return-1;var e=this.frontier[this.depth],r;if(!e.type.isTextblock||!JA(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(r=this.findCloseLevel(this.$to))&&r.depth==this.depth)return-1;for(var o=this.$to,a=o.depth,l=this.$to.after(a);a>1&&l==this.$to.end(--a);)++l;return l};Vi.prototype.findCloseLevel=function(e){e:for(var r=Math.min(this.depth,e.depth);r>=0;r--){var o=this.frontier[r],a=o.match,l=o.type,d=r<e.depth&&e.end(r+1)==e.pos+(e.depth-(r+1)),A=JA(e,r,l,a,d);if(!!A){for(var g=r-1;g>=0;g--){var v=this.frontier[g],C=v.match,y=v.type,w=JA(e,g,y,C,!0);if(!w||w.childCount)continue e}return{depth:r,fit:A,move:d?e.doc.resolve(e.after(r+1)):e}}}};Vi.prototype.close=function(e){var r=this.findCloseLevel(e);if(!r)return null;for(;this.depth>r.depth;)this.closeFrontierNode();r.fit.childCount&&(this.placed=Ll(this.placed,r.depth,r.fit)),e=r.move;for(var o=r.depth+1;o<=e.depth;o++){var a=e.node(o),l=a.type.contentMatch.fillBefore(a.content,!0,e.index(o));this.openFrontierNode(a.type,a.attrs,l)}return e};Vi.prototype.openFrontierNode=function(e,r,o){var a=this.frontier[this.depth];a.match=a.match.matchType(e),this.placed=Ll(this.placed,this.depth,ee.from(e.create(r,o))),this.frontier.push({type:e,match:e.contentMatch})};Vi.prototype.closeFrontierNode=function(){var e=this.frontier.pop(),r=e.match.fillBefore(ee.empty,!0);r.childCount&&(this.placed=Ll(this.placed,this.frontier.length,r))};Object.defineProperties(Vi.prototype,QC);function Bl(t,e,r){return e==0?t.cutByIndex(r):t.replaceChild(0,t.firstChild.copy(Bl(t.firstChild.content,e-1,r)))}function Ll(t,e,r){return e==0?t.append(r):t.replaceChild(t.childCount-1,t.lastChild.copy(Ll(t.lastChild.content,e-1,r)))}function qA(t,e){for(var r=0;r<e;r++)t=t.firstChild.content;return t}function xC(t,e,r){if(e<=0)return t;var o=t.content;return e>1&&(o=o.replaceChild(0,xC(o.firstChild,e-1,o.childCount==1?r-1:0))),e>0&&(o=t.type.contentMatch.fillBefore(o).append(o),r<=0&&(o=o.append(t.type.contentMatch.matchFragment(o).fillBefore(ee.empty,!0)))),t.copy(o)}function JA(t,e,r,o,a){var l=t.node(e),d=a?t.indexAfter(e):t.index(e);if(d==l.childCount&&!r.compatibleContent(l.type))return null;var A=o.fillBefore(l.content,!0,d);return A&&!MO(r,l.content,d)?A:null}function MO(t,e,r){for(var o=r;o<e.childCount;o++)if(!t.allowsMarks(e.child(o).marks))return!0;return!1}Tr.prototype.replaceRange=function(t,e,r){if(!r.size)return this.deleteRange(t,e);var o=this.doc.resolve(t),a=this.doc.resolve(e);if(PC(o,a,r))return this.step(new ts(t,e,r));var l=FC(o,this.doc.resolve(e));l[l.length-1]==0&&l.pop();var d=-(o.depth+1);l.unshift(d);for(var A=o.depth,g=o.pos-1;A>0;A--,g--){var v=o.node(A).type.spec;if(v.defining||v.isolating)break;l.indexOf(A)>-1?d=A:o.before(A)==g&&l.splice(1,0,-A)}for(var C=l.indexOf(d),y=[],w=r.openStart,k=r.content,M=0;;M++){var F=k.firstChild;if(y.push(F),M==r.openStart)break;k=F.content}w>0&&y[w-1].type.spec.defining&&o.node(C).type!=y[w-1].type?w-=1:w>=2&&y[w-1].isTextblock&&y[w-2].type.spec.defining&&o.node(C).type!=y[w-2].type&&(w-=2);for(var K=r.openStart;K>=0;K--){var J=(K+w+1)%(r.openStart+1),U=y[J];if(!!U)for(var te=0;te<l.length;te++){var P=l[(te+C)%l.length],he=!0;P<0&&(he=!1,P=-P);var ne=o.node(P-1),me=o.index(P-1);if(ne.canReplaceWith(me,me,U.type,U.marks))return this.replace(o.before(P),he?a.after(P):e,new ye(UC(r.content,0,r.openStart,J),J,r.openEnd))}}for(var Pe=this.steps.length,Me=l.length-1;Me>=0&&(this.replace(t,e,r),!(this.steps.length>Pe));Me--){var be=l[Me];be<0||(t=o.before(be),e=a.after(be))}return this};function UC(t,e,r,o,a){if(e<r){var l=t.firstChild;t=t.replaceChild(0,l.copy(UC(l.content,e+1,r,o,l)))}if(e>o){var d=a.contentMatchAt(0),A=d.fillBefore(t).append(t);t=A.append(d.matchFragment(A).fillBefore(ee.empty,!0))}return t}Tr.prototype.replaceRangeWith=function(t,e,r){if(!r.isInline&&t==e&&this.doc.resolve(t).parent.content.size){var o=BO(this.doc,t,r.type);o!=null&&(t=e=o)}return this.replaceRange(t,e,new ye(ee.from(r),0,0))};Tr.prototype.deleteRange=function(t,e){for(var r=this.doc.resolve(t),o=this.doc.resolve(e),a=FC(r,o),l=0;l<a.length;l++){var d=a[l],A=l==a.length-1;if(A&&d==0||r.node(d).type.contentMatch.validEnd)return this.delete(r.start(d),o.end(d));if(d>0&&(A||r.node(d-1).canReplace(r.index(d-1),o.indexAfter(d-1))))return this.delete(r.before(d),o.after(d))}for(var g=1;g<=r.depth&&g<=o.depth;g++)if(t-r.start(g)==r.depth-g&&e>r.end(g)&&o.end(g)-e!=o.depth-g)return this.delete(r.before(g),e);return this.delete(t,e)};function FC(t,e){for(var r=[],o=Math.min(t.depth,e.depth),a=o;a>=0;a--){var l=t.start(a);if(l<t.pos-(t.depth-a)||e.end(a)>e.pos+(e.depth-a)||t.node(a).type.spec.isolating||e.node(a).type.spec.isolating)break;(l==e.start(a)||a==t.depth&&a==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&a&&e.start(a-1)==l-1)&&r.push(a)}return r}var zA=Object.create(null),nt=function(e,r,o){this.ranges=o||[new PO(e.min(r),e.max(r))],this.$anchor=e,this.$head=r},Cs={anchor:{configurable:!0},head:{configurable:!0},from:{configurable:!0},to:{configurable:!0},$from:{configurable:!0},$to:{configurable:!0},empty:{configurable:!0}};Cs.anchor.get=function(){return this.$anchor.pos};Cs.head.get=function(){return this.$head.pos};Cs.from.get=function(){return this.$from.pos};Cs.to.get=function(){return this.$to.pos};Cs.$from.get=function(){return this.ranges[0].$from};Cs.$to.get=function(){return this.ranges[0].$to};Cs.empty.get=function(){for(var t=this.ranges,e=0;e<t.length;e++)if(t[e].$from.pos!=t[e].$to.pos)return!1;return!0};nt.prototype.content=function(){return this.$from.node(0).slice(this.from,this.to,!0)};nt.prototype.replace=function(e,r){r===void 0&&(r=ye.empty);for(var o=r.content.lastChild,a=null,l=0;l<r.openEnd;l++)a=o,o=o.lastChild;for(var d=e.steps.length,A=this.ranges,g=0;g<A.length;g++){var v=A[g],C=v.$from,y=v.$to,w=e.mapping.slice(d);e.replaceRange(w.map(C.pos),w.map(y.pos),g?ye.empty:r),g==0&&VC(e,d,(o?o.isInline:a&&a.isTextblock)?-1:1)}};nt.prototype.replaceWith=function(e,r){for(var o=e.steps.length,a=this.ranges,l=0;l<a.length;l++){var d=a[l],A=d.$from,g=d.$to,v=e.mapping.slice(o),C=v.map(A.pos),y=v.map(g.pos);l?e.deleteRange(C,y):(e.replaceRangeWith(C,y,r),VC(e,o,r.isInline?-1:1))}};nt.findFrom=function(e,r,o){var a=e.parent.inlineContent?new Ot(e):Cc(e.node(0),e.parent,e.pos,e.index(),r,o);if(a)return a;for(var l=e.depth-1;l>=0;l--){var d=r<0?Cc(e.node(0),e.node(l),e.before(l+1),e.index(l),r,o):Cc(e.node(0),e.node(l),e.after(l+1),e.index(l)+1,r,o);if(d)return d}};nt.near=function(e,r){return r===void 0&&(r=1),this.findFrom(e,r)||this.findFrom(e,-r)||new ns(e.node(0))};nt.atStart=function(e){return Cc(e,e,0,0,1)||new ns(e)};nt.atEnd=function(e){return Cc(e,e,e.content.size,e.childCount,-1)||new ns(e)};nt.fromJSON=function(e,r){if(!r||!r.type)throw new RangeError("Invalid input for Selection.fromJSON");var o=zA[r.type];if(!o)throw new RangeError("No selection type "+r.type+" defined");return o.fromJSON(e,r)};nt.jsonID=function(e,r){if(e in zA)throw new RangeError("Duplicate use of selection JSON ID "+e);return zA[e]=r,r.prototype.jsonID=e,r};nt.prototype.getBookmark=function(){return Ot.between(this.$anchor,this.$head).getBookmark()};Object.defineProperties(nt.prototype,Cs);nt.prototype.visible=!0;var PO=function(e,r){this.$from=e,this.$to=r},Ot=function(t){function e(o,a){a===void 0&&(a=o),t.call(this,o,a)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={$cursor:{configurable:!0}};return r.$cursor.get=function(){return this.$anchor.pos==this.$head.pos?this.$head:null},e.prototype.map=function(a,l){var d=a.resolve(l.map(this.head));if(!d.parent.inlineContent)return t.near(d);var A=a.resolve(l.map(this.anchor));return new e(A.parent.inlineContent?A:d,d)},e.prototype.replace=function(a,l){if(l===void 0&&(l=ye.empty),t.prototype.replace.call(this,a,l),l==ye.empty){var d=this.$from.marksAcross(this.$to);d&&a.ensureMarks(d)}},e.prototype.eq=function(a){return a instanceof e&&a.anchor==this.anchor&&a.head==this.head},e.prototype.getBookmark=function(){return new Ml(this.anchor,this.head)},e.prototype.toJSON=function(){return{type:"text",anchor:this.anchor,head:this.head}},e.fromJSON=function(a,l){if(typeof l.anchor!="number"||typeof l.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new e(a.resolve(l.anchor),a.resolve(l.head))},e.create=function(a,l,d){d===void 0&&(d=l);var A=a.resolve(l);return new this(A,d==l?A:a.resolve(d))},e.between=function(a,l,d){var A=a.pos-l.pos;if((!d||A)&&(d=A>=0?1:-1),!l.parent.inlineContent){var g=t.findFrom(l,d,!0)||t.findFrom(l,-d,!0);if(g)l=g.$head;else return t.near(l,d)}return a.parent.inlineContent||(A==0?a=l:(a=(t.findFrom(a,-d,!0)||t.findFrom(a,d,!0)).$anchor,a.pos<l.pos!=A<0&&(a=l))),new e(a,l)},Object.defineProperties(e.prototype,r),e}(nt);nt.jsonID("text",Ot);var Ml=function(e,r){this.anchor=e,this.head=r};Ml.prototype.map=function(e){return new Ml(e.map(this.anchor),e.map(this.head))};Ml.prototype.resolve=function(e){return Ot.between(e.resolve(this.anchor),e.resolve(this.head))};var et=function(t){function e(r){var o=r.nodeAfter,a=r.node(0).resolve(r.pos+o.nodeSize);t.call(this,r,a),this.node=o}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.map=function(o,a){var l=a.mapResult(this.anchor),d=l.deleted,A=l.pos,g=o.resolve(A);return d?t.near(g):new e(g)},e.prototype.content=function(){return new ye(ee.from(this.node),0,0)},e.prototype.eq=function(o){return o instanceof e&&o.anchor==this.anchor},e.prototype.toJSON=function(){return{type:"node",anchor:this.anchor}},e.prototype.getBookmark=function(){return new Dd(this.anchor)},e.fromJSON=function(o,a){if(typeof a.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new e(o.resolve(a.anchor))},e.create=function(o,a){return new this(o.resolve(a))},e.isSelectable=function(o){return!o.isText&&o.type.spec.selectable!==!1},e}(nt);et.prototype.visible=!1;nt.jsonID("node",et);var Dd=function(e){this.anchor=e};Dd.prototype.map=function(e){var r=e.mapResult(this.anchor),o=r.deleted,a=r.pos;return o?new Ml(a,a):new Dd(a)};Dd.prototype.resolve=function(e){var r=e.resolve(this.anchor),o=r.nodeAfter;return o&&et.isSelectable(o)?new et(r):nt.near(r)};var ns=function(t){function e(r){t.call(this,r.resolve(0),r.resolve(r.content.size))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.replace=function(o,a){if(a===void 0&&(a=ye.empty),a==ye.empty){o.delete(0,o.doc.content.size);var l=t.atStart(o.doc);l.eq(o.selection)||o.setSelection(l)}else t.prototype.replace.call(this,o,a)},e.prototype.toJSON=function(){return{type:"all"}},e.fromJSON=function(o){return new e(o)},e.prototype.map=function(o){return new e(o)},e.prototype.eq=function(o){return o instanceof e},e.prototype.getBookmark=function(){return QO},e}(nt);nt.jsonID("all",ns);var QO={map:function(){return this},resolve:function(e){return new ns(e)}};function Cc(t,e,r,o,a,l){if(e.inlineContent)return Ot.create(t,r);for(var d=o-(a>0?0:1);a>0?d<e.childCount:d>=0;d+=a){var A=e.child(d);if(A.isAtom){if(!l&&et.isSelectable(A))return et.create(t,r-(a<0?A.nodeSize:0))}else{var g=Cc(t,A,r+a,a<0?A.childCount:0,a,l);if(g)return g}r+=A.nodeSize*a}}function VC(t,e,r){var o=t.steps.length-1;if(!(o<e)){var a=t.steps[o];if(a instanceof ts||a instanceof ri){var l=t.mapping.maps[o],d;l.forEach(function(A,g,v,C){d==null&&(d=C)}),t.setSelection(nt.near(t.doc.resolve(d),r))}}}var GC=1,Bd=2,jC=4,xO=function(t){function e(o){t.call(this,o.doc),this.time=Date.now(),this.curSelection=o.selection,this.curSelectionFor=0,this.storedMarks=o.storedMarks,this.updated=0,this.meta=Object.create(null)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={selection:{configurable:!0},selectionSet:{configurable:!0},storedMarksSet:{configurable:!0},isGeneric:{configurable:!0},scrolledIntoView:{configurable:!0}};return r.selection.get=function(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection},e.prototype.setSelection=function(a){if(a.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=a,this.curSelectionFor=this.steps.length,this.updated=(this.updated|GC)&~Bd,this.storedMarks=null,this},r.selectionSet.get=function(){return(this.updated&GC)>0},e.prototype.setStoredMarks=function(a){return this.storedMarks=a,this.updated|=Bd,this},e.prototype.ensureMarks=function(a){return Rt.sameSet(this.storedMarks||this.selection.$from.marks(),a)||this.setStoredMarks(a),this},e.prototype.addStoredMark=function(a){return this.ensureMarks(a.addToSet(this.storedMarks||this.selection.$head.marks()))},e.prototype.removeStoredMark=function(a){return this.ensureMarks(a.removeFromSet(this.storedMarks||this.selection.$head.marks()))},r.storedMarksSet.get=function(){return(this.updated&Bd)>0},e.prototype.addStep=function(a,l){t.prototype.addStep.call(this,a,l),this.updated=this.updated&~Bd,this.storedMarks=null},e.prototype.setTime=function(a){return this.time=a,this},e.prototype.replaceSelection=function(a){return this.selection.replace(this,a),this},e.prototype.replaceSelectionWith=function(a,l){var d=this.selection;return l!==!1&&(a=a.mark(this.storedMarks||(d.empty?d.$from.marks():d.$from.marksAcross(d.$to)||Rt.none))),d.replaceWith(this,a),this},e.prototype.deleteSelection=function(){return this.selection.replace(this),this},e.prototype.insertText=function(a,l,d){d===void 0&&(d=l);var A=this.doc.type.schema;if(l==null)return a?this.replaceSelectionWith(A.text(a),!0):this.deleteSelection();if(!a)return this.deleteRange(l,d);var g=this.storedMarks;if(!g){var v=this.doc.resolve(l);g=d==l?v.marks():v.marksAcross(this.doc.resolve(d))}return this.replaceRangeWith(l,d,A.text(a,g)),this.selection.empty||this.setSelection(nt.near(this.selection.$to)),this},e.prototype.setMeta=function(a,l){return this.meta[typeof a=="string"?a:a.key]=l,this},e.prototype.getMeta=function(a){return this.meta[typeof a=="string"?a:a.key]},r.isGeneric.get=function(){for(var o in this.meta)return!1;return!0},e.prototype.scrollIntoView=function(){return this.updated|=jC,this},r.scrolledIntoView.get=function(){return(this.updated&jC)>0},Object.defineProperties(e.prototype,r),e}(Tr);function HC(t,e){return!e||!t?t:t.bind(e)}var Pl=function(e,r,o){this.name=e,this.init=HC(r.init,o),this.apply=HC(r.apply,o)},UO=[new Pl("doc",{init:function(e){return e.doc||e.schema.topNodeType.createAndFill()},apply:function(e){return e.doc}}),new Pl("selection",{init:function(e,r){return e.selection||nt.atStart(r.doc)},apply:function(e){return e.selection}}),new Pl("storedMarks",{init:function(e){return e.storedMarks||null},apply:function(e,r,o,a){return a.selection.$cursor?e.storedMarks:null}}),new Pl("scrollToSelection",{init:function(){return 0},apply:function(e,r){return e.scrolledIntoView?r+1:r}})],XA=function(e,r){var o=this;this.schema=e,this.fields=UO.concat(),this.plugins=[],this.pluginsByKey=Object.create(null),r&&r.forEach(function(a){if(o.pluginsByKey[a.key])throw new RangeError("Adding different instances of a keyed plugin ("+a.key+")");o.plugins.push(a),o.pluginsByKey[a.key]=a,a.spec.state&&o.fields.push(new Pl(a.key,a.spec.state,a))})},jn=function(e){this.config=e},Ld={schema:{configurable:!0},plugins:{configurable:!0},tr:{configurable:!0}};Ld.schema.get=function(){return this.config.schema};Ld.plugins.get=function(){return this.config.plugins};jn.prototype.apply=function(e){return this.applyTransaction(e).state};jn.prototype.filterTransaction=function(e,r){r===void 0&&(r=-1);for(var o=0;o<this.config.plugins.length;o++)if(o!=r){var a=this.config.plugins[o];if(a.spec.filterTransaction&&!a.spec.filterTransaction.call(a,e,this))return!1}return!0};jn.prototype.applyTransaction=function(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};for(var r=[e],o=this.applyInner(e),a=null;;){for(var l=!1,d=0;d<this.config.plugins.length;d++){var A=this.config.plugins[d];if(A.spec.appendTransaction){var g=a?a[d].n:0,v=a?a[d].state:this,C=g<r.length&&A.spec.appendTransaction.call(A,g?r.slice(g):r,v,o);if(C&&o.filterTransaction(C,d)){if(C.setMeta("appendedTransaction",e),!a){a=[];for(var y=0;y<this.config.plugins.length;y++)a.push(y<d?{state:o,n:r.length}:{state:this,n:0})}r.push(C),o=o.applyInner(C),l=!0}a&&(a[d]={state:o,n:r.length})}}if(!l)return{state:o,transactions:r}}};jn.prototype.applyInner=function(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");for(var r=new jn(this.config),o=this.config.fields,a=0;a<o.length;a++){var l=o[a];r[l.name]=l.apply(e,this[l.name],this,r)}for(var d=0;d<Ql.length;d++)Ql[d](this,e,r);return r};Ld.tr.get=function(){return new xO(this)};jn.create=function(e){for(var r=new XA(e.doc?e.doc.type.schema:e.schema,e.plugins),o=new jn(r),a=0;a<r.fields.length;a++)o[r.fields[a].name]=r.fields[a].init(e,o);return o};jn.prototype.reconfigure=function(e){for(var r=new XA(this.schema,e.plugins),o=r.fields,a=new jn(r),l=0;l<o.length;l++){var d=o[l].name;a[d]=this.hasOwnProperty(d)?this[d]:o[l].init(e,a)}return a};jn.prototype.toJSON=function(e){var r={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(r.storedMarks=this.storedMarks.map(function(d){return d.toJSON()})),e&&typeof e=="object")for(var o in e){if(o=="doc"||o=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");var a=e[o],l=a.spec.state;l&&l.toJSON&&(r[o]=l.toJSON.call(a,this[a.key]))}return r};jn.fromJSON=function(e,r,o){if(!r)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");var a=new XA(e.schema,e.plugins),l=new jn(a);return a.fields.forEach(function(d){if(d.name=="doc")l.doc=Nt.fromJSON(e.schema,r.doc);else if(d.name=="selection")l.selection=nt.fromJSON(l.doc,r.selection);else if(d.name=="storedMarks")r.storedMarks&&(l.storedMarks=r.storedMarks.map(e.schema.markFromJSON));else{if(o)for(var A in o){var g=o[A],v=g.spec.state;if(g.key==d.name&&v&&v.fromJSON&&Object.prototype.hasOwnProperty.call(r,A)){l[d.name]=v.fromJSON.call(g,e,r[A],l);return}}l[d.name]=d.init(e,l)}}),l};jn.addApplyListener=function(e){Ql.push(e)};jn.removeApplyListener=function(e){var r=Ql.indexOf(e);r>-1&&Ql.splice(r,1)};Object.defineProperties(jn.prototype,Ld);var Ql=[];function KC(t,e,r){for(var o in t){var a=t[o];a instanceof Function?a=a.bind(e):o=="handleDOMEvents"&&(a=KC(a,e,{})),r[o]=a}return r}var ni=function(e){this.props={},e.props&&KC(e.props,this,this.props),this.spec=e,this.key=e.key?e.key.key:WC("plugin")};ni.prototype.getState=function(e){return e[this.key]};var $A=Object.create(null);function WC(t){return t in $A?t+"$"+ ++$A[t]:($A[t]=0,t+"$")}var ii=function(e){e===void 0&&(e="key"),this.key=WC(e)};ii.prototype.get=function(e){return e.config.pluginsByKey[this.key]};ii.prototype.getState=function(e){return e[this.key]};function ZA(t,e){return t.selection.empty?!1:(e&&e(t.tr.deleteSelection().scrollIntoView()),!0)}function YC(t,e,r){var o=t.selection,a=o.$cursor;if(!a||(r?!r.endOfTextblock("backward",t):a.parentOffset>0))return!1;var l=JC(a);if(!l){var d=a.blockRange(),A=d&&Ic(d);return A==null?!1:(e&&e(t.tr.lift(d,A).scrollIntoView()),!0)}var g=l.nodeBefore;if(!g.type.spec.isolating&&i0(t,l,e))return!0;if(a.parent.content.size==0&&(yc(g,"end")||et.isSelectable(g))){if(e){var v=t.tr.deleteRange(a.before(),a.after());v.setSelection(yc(g,"end")?nt.findFrom(v.doc.resolve(v.mapping.map(l.pos,-1)),-1):et.create(v.doc,l.pos-g.nodeSize)),e(v.scrollIntoView())}return!0}return g.isAtom&&l.depth==a.depth-1?(e&&e(t.tr.delete(l.pos-g.nodeSize,l.pos).scrollIntoView()),!0):!1}function yc(t,e,r){for(;t;t=e=="start"?t.firstChild:t.lastChild){if(t.isTextblock)return!0;if(r&&t.childCount!=1)return!1}return!1}function qC(t,e,r){var o=t.selection,a=o.$head,l=o.empty,d=a;if(!l)return!1;if(a.parent.isTextblock){if(r?!r.endOfTextblock("backward",t):a.parentOffset>0)return!1;d=JC(a)}var A=d&&d.nodeBefore;return!A||!et.isSelectable(A)?!1:(e&&e(t.tr.setSelection(et.create(t.doc,d.pos-A.nodeSize)).scrollIntoView()),!0)}function JC(t){if(!t.parent.type.spec.isolating)for(var e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}function zC(t,e,r){var o=t.selection,a=o.$cursor;if(!a||(r?!r.endOfTextblock("forward",t):a.parentOffset<a.parent.content.size))return!1;var l=$C(a);if(!l)return!1;var d=l.nodeAfter;if(i0(t,l,e))return!0;if(a.parent.content.size==0&&(yc(d,"start")||et.isSelectable(d))){if(e){var A=t.tr.deleteRange(a.before(),a.after());A.setSelection(yc(d,"start")?nt.findFrom(A.doc.resolve(A.mapping.map(l.pos)),1):et.create(A.doc,A.mapping.map(l.pos))),e(A.scrollIntoView())}return!0}return d.isAtom&&l.depth==a.depth-1?(e&&e(t.tr.delete(l.pos,l.pos+d.nodeSize).scrollIntoView()),!0):!1}function XC(t,e,r){var o=t.selection,a=o.$head,l=o.empty,d=a;if(!l)return!1;if(a.parent.isTextblock){if(r?!r.endOfTextblock("forward",t):a.parentOffset<a.parent.content.size)return!1;d=$C(a)}var A=d&&d.nodeAfter;return!A||!et.isSelectable(A)?!1:(e&&e(t.tr.setSelection(et.create(t.doc,d.pos)).scrollIntoView()),!0)}function $C(t){if(!t.parent.type.spec.isolating)for(var e=t.depth-1;e>=0;e--){var r=t.node(e);if(t.index(e)+1<r.childCount)return t.doc.resolve(t.after(e+1));if(r.type.spec.isolating)break}return null}function ZC(t,e){var r=t.selection,o=r.$from,a=r.$to,l=o.blockRange(a),d=l&&Ic(l);return d==null?!1:(e&&e(t.tr.lift(l,d).scrollIntoView()),!0)}function e0(t,e){var r=t.selection,o=r.$head,a=r.$anchor;return!o.parent.type.spec.code||!o.sameParent(a)?!1:(e&&e(t.tr.insertText(`
`).scrollIntoView()),!0)}function ef(t){for(var e=0;e<t.edgeCount;e++){var r=t.edge(e),o=r.type;if(o.isTextblock&&!o.hasRequiredAttrs())return o}return null}function t0(t,e){var r=t.selection,o=r.$head,a=r.$anchor;if(!o.parent.type.spec.code||!o.sameParent(a))return!1;var l=o.node(-1),d=o.indexAfter(-1),A=ef(l.contentMatchAt(d));if(!l.canReplaceWith(d,d,A))return!1;if(e){var g=o.after(),v=t.tr.replaceWith(g,g,A.createAndFill());v.setSelection(nt.near(v.doc.resolve(g),1)),e(v.scrollIntoView())}return!0}function r0(t,e){var r=t.selection,o=r.$from,a=r.$to;if(r instanceof ns||o.parent.inlineContent||a.parent.inlineContent)return!1;var l=ef(a.parent.contentMatchAt(a.indexAfter()));if(!l||!l.isTextblock)return!1;if(e){var d=(!o.parentOffset&&a.index()<a.parent.childCount?o:a).pos,A=t.tr.insert(d,l.createAndFill());A.setSelection(Ot.create(A.doc,d+1)),e(A.scrollIntoView())}return!0}function n0(t,e){var r=t.selection,o=r.$cursor;if(!o||o.parent.content.size)return!1;if(o.depth>1&&o.after()!=o.end(-1)){var a=o.before();if(rs(t.doc,a))return e&&e(t.tr.split(a).scrollIntoView()),!0}var l=o.blockRange(),d=l&&Ic(l);return d==null?!1:(e&&e(t.tr.lift(l,d).scrollIntoView()),!0)}function FO(t,e){var r=t.selection,o=r.$from,a=r.$to;if(t.selection instanceof et&&t.selection.node.isBlock)return!o.parentOffset||!rs(t.doc,o.pos)?!1:(e&&e(t.tr.split(o.pos).scrollIntoView()),!0);if(!o.parent.isBlock)return!1;if(e){var l=a.parentOffset==a.parent.content.size,d=t.tr;(t.selection instanceof Ot||t.selection instanceof ns)&&d.deleteSelection();var A=o.depth==0?null:ef(o.node(-1).contentMatchAt(o.indexAfter(-1))),g=l&&A?[{type:A}]:null,v=rs(d.doc,d.mapping.map(o.pos),1,g);if(!g&&!v&&rs(d.doc,d.mapping.map(o.pos),1,A&&[{type:A}])&&(g=[{type:A}],v=!0),v&&(d.split(d.mapping.map(o.pos),1,g),!l&&!o.parentOffset&&o.parent.type!=A)){var C=d.mapping.map(o.before()),y=d.doc.resolve(C);o.node(-1).canReplaceWith(y.index(),y.index()+1,A)&&d.setNodeMarkup(d.mapping.map(o.before()),A)}e(d.scrollIntoView())}return!0}function VO(t,e){var r=t.selection,o=r.$from,a=r.to,l,d=o.sharedDepth(a);return d==0?!1:(l=o.before(d),e&&e(t.tr.setSelection(et.create(t.doc,l))),!0)}function GO(t,e){return e&&e(t.tr.setSelection(new ns(t.doc))),!0}function jO(t,e,r){var o=e.nodeBefore,a=e.nodeAfter,l=e.index();return!o||!a||!o.type.compatibleContent(a.type)?!1:!o.content.size&&e.parent.canReplace(l-1,l)?(r&&r(t.tr.delete(e.pos-o.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(l,l+1)||!(a.isTextblock||KA(t.doc,e.pos))?!1:(r&&r(t.tr.clearIncompatible(e.pos,o.type,o.contentMatchAt(o.childCount)).join(e.pos).scrollIntoView()),!0)}function i0(t,e,r){var o=e.nodeBefore,a=e.nodeAfter,l,d;if(o.type.spec.isolating||a.type.spec.isolating)return!1;if(jO(t,e,r))return!0;var A=e.parent.canReplace(e.index(),e.index()+1);if(A&&(l=(d=o.contentMatchAt(o.childCount)).findWrapping(a.type))&&d.matchType(l[0]||a.type).validEnd){if(r){for(var g=e.pos+a.nodeSize,v=ee.empty,C=l.length-1;C>=0;C--)v=ee.from(l[C].create(null,v));v=ee.from(o.copy(v));var y=t.tr.step(new ri(e.pos-1,g,e.pos,g,new ye(v,1,0),l.length,!0)),w=g+2*l.length;KA(y.doc,w)&&y.join(w),r(y.scrollIntoView())}return!0}var k=nt.findFrom(e,1),M=k&&k.$from.blockRange(k.$to),F=M&&Ic(M);if(F!=null&&F>=e.depth)return r&&r(t.tr.lift(M,F).scrollIntoView()),!0;if(A&&yc(a,"start",!0)&&yc(o,"end")){for(var K=o,J=[];J.push(K),!K.isTextblock;)K=K.lastChild;for(var U=a,te=1;!U.isTextblock;U=U.firstChild)te++;if(K.canReplace(K.childCount,K.childCount,U.content)){if(r){for(var P=ee.empty,he=J.length-1;he>=0;he--)P=ee.from(J[he].copy(P));var ne=t.tr.step(new ri(e.pos-J.length,e.pos+a.nodeSize,e.pos+te,e.pos+a.nodeSize-te,new ye(P,J.length,0),0,!0));r(ne.scrollIntoView())}return!0}}return!1}function o0(t,e){return function(r,o){var a=r.selection,l=a.$from,d=a.$to,A=l.blockRange(d),g=A&&HA(A,t,e);return g?(o&&o(r.tr.wrap(A,g).scrollIntoView()),!0):!1}}function HO(t,e){return function(r,o){var a=r.selection,l=a.from,d=a.to,A=!1;return r.doc.nodesBetween(l,d,function(g,v){if(A)return!1;if(!(!g.isTextblock||g.hasMarkup(t,e)))if(g.type==t)A=!0;else{var C=r.doc.resolve(v),y=C.index();A=C.parent.canReplaceWith(y,y+1,t)}}),A?(o&&o(r.tr.setBlockType(l,d,t,e).scrollIntoView()),!0):!1}}function tf(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return function(r,o,a){for(var l=0;l<t.length;l++)if(t[l](r,o,a))return!0;return!1}}var rf=tf(ZA,YC,qC),s0=tf(ZA,zC,XC),ys={Enter:tf(e0,r0,n0,FO),"Mod-Enter":t0,Backspace:rf,"Mod-Backspace":rf,"Shift-Backspace":rf,Delete:s0,"Mod-Delete":s0,"Mod-a":GO},KO={"Ctrl-h":ys.Backspace,"Alt-Backspace":ys["Mod-Backspace"],"Ctrl-d":ys.Delete,"Ctrl-Alt-Backspace":ys["Mod-Delete"],"Alt-Delete":ys["Mod-Delete"],"Alt-d":ys["Mod-Delete"]};for(var a0 in ys)KO[a0]=ys[a0];typeof navigator!="undefined"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os!="undefined"&&os.platform()=="darwin";function WO(t,e){return function(r,o){var a=r.selection,l=a.$from,d=a.$to,A=l.blockRange(d),g=!1,v=A;if(!A)return!1;if(A.depth>=2&&l.node(A.depth-1).type.compatibleContent(t)&&A.startIndex==0){if(l.index(A.depth-1)==0)return!1;var C=r.doc.resolve(A.start-2);v=new Ol(C,C,A.depth),A.endIndex<A.parent.childCount&&(A=new Ol(l,r.doc.resolve(d.end(A.depth)),A.depth)),g=!0}var y=HA(v,t,e,A);return y?(o&&o(YO(r.tr,A,y,g,t).scrollIntoView()),!0):!1}}function YO(t,e,r,o,a){for(var l=ee.empty,d=r.length-1;d>=0;d--)l=ee.from(r[d].type.create(r[d].attrs,l));t.step(new ri(e.start-(o?2:0),e.end,e.start,e.end,new ye(l,0,0),r.length,!0));for(var A=0,g=0;g<r.length;g++)r[g].type==a&&(A=g+1);for(var v=r.length-A,C=e.start+r.length-(o?2:0),y=e.parent,w=e.startIndex,k=e.endIndex,M=!0;w<k;w++,M=!1)!M&&rs(t.doc,C,v)&&(t.split(C,v),C+=2*v),C+=y.child(w).nodeSize;return t}function qO(t){return function(e,r){var o=e.selection,a=o.$from,l=o.$to,d=a.blockRange(l,function(A){return A.childCount&&A.firstChild.type==t});return d?r?a.node(d.depth-1).type==t?JO(e,r,t,d):zO(e,r,d):!0:!1}}function JO(t,e,r,o){var a=t.tr,l=o.end,d=o.$to.end(o.depth);return l<d&&(a.step(new ri(l-1,d,l,d,new ye(ee.from(r.create(null,o.parent.copy())),1,0),1,!0)),o=new Ol(a.doc.resolve(o.$from.pos),a.doc.resolve(d),o.depth)),e(a.lift(o,Ic(o)).scrollIntoView()),!0}function zO(t,e,r){for(var o=t.tr,a=r.parent,l=r.end,d=r.endIndex-1,A=r.startIndex;d>A;d--)l-=a.child(d).nodeSize,o.delete(l-1,l+1);var g=o.doc.resolve(r.start),v=g.nodeAfter;if(o.mapping.map(r.end)!=r.start+g.nodeAfter.nodeSize)return!1;var C=r.startIndex==0,y=r.endIndex==a.childCount,w=g.node(-1),k=g.index(-1);if(!w.canReplace(k+(C?0:1),k+1,v.content.append(y?ee.empty:ee.from(a))))return!1;var M=g.pos,F=M+v.nodeSize;return o.step(new ri(M-(C?1:0),F+(y?1:0),M+1,F-1,new ye((C?ee.empty:ee.from(a.copy(ee.empty))).append(y?ee.empty:ee.from(a.copy(ee.empty))),C?0:1,y?0:1),C?0:1)),e(o.scrollIntoView()),!0}function XO(t){return function(e,r){var o=e.selection,a=o.$from,l=o.$to,d=a.blockRange(l,function(F){return F.childCount&&F.firstChild.type==t});if(!d)return!1;var A=d.startIndex;if(A==0)return!1;var g=d.parent,v=g.child(A-1);if(v.type!=t)return!1;if(r){var C=v.lastChild&&v.lastChild.type==g.type,y=ee.from(C?t.create():null),w=new ye(ee.from(t.create(null,ee.from(g.type.create(null,y)))),C?3:1,0),k=d.start,M=d.end;r(e.tr.step(new ri(k-(C?3:1),M,k,M,w,1,!0)).scrollIntoView())}return!0}}var ce={};if(typeof navigator!="undefined"&&typeof document!="undefined"){var nf=/Edge\/(\d+)/.exec(navigator.userAgent),c0=/MSIE \d/.test(navigator.userAgent),of=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),sf=ce.ie=!!(c0||of||nf);ce.ie_version=c0?document.documentMode||6:of?+of[1]:nf?+nf[1]:null,ce.gecko=!sf&&/gecko\/(\d+)/i.test(navigator.userAgent),ce.gecko_version=ce.gecko&&+(/Firefox\/(\d+)/.exec(navigator.userAgent)||[0,0])[1];var af=!sf&&/Chrome\/(\d+)/.exec(navigator.userAgent);ce.chrome=!!af,ce.chrome_version=af&&+af[1],ce.safari=!sf&&/Apple Computer/.test(navigator.vendor),ce.ios=ce.safari&&(/Mobile\/\w+/.test(navigator.userAgent)||navigator.maxTouchPoints>2),ce.mac=ce.ios||/Mac/.test(navigator.platform),ce.android=/Android \d/.test(navigator.userAgent),ce.webkit="webkitFontSmoothing"in document.documentElement.style,ce.webkit_version=ce.webkit&&+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]}var yi=function(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e},cf=function(t){var e=t.assignedSlot||t.parentNode;return e&&e.nodeType==11?e.host:e},l0=null,is=function(t,e,r){var o=l0||(l0=document.createRange());return o.setEnd(t,r==null?t.nodeValue.length:r),o.setStart(t,e||0),o},Md=function(t,e,r,o){return r&&(u0(t,e,r,o,-1)||u0(t,e,r,o,1))},$O=/^(img|br|input|textarea|hr)$/i;function u0(t,e,r,o,a){for(;;){if(t==r&&e==o)return!0;if(e==(a<0?0:Oo(t))){var l=t.parentNode;if(l.nodeType!=1||ek(t)||$O.test(t.nodeName)||t.contentEditable=="false")return!1;e=yi(t)+(a<0?0:1),t=l}else if(t.nodeType==1){if(t=t.childNodes[e+(a<0?-1:0)],t.contentEditable=="false")return!1;e=a<0?Oo(t):0}else return!1}}function Oo(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function ZO(t,e,r){for(var o=e==0,a=e==Oo(t);o||a;){if(t==r)return!0;var l=yi(t);if(t=t.parentNode,!t)return!1;o=o&&l==0,a=a&&l==Oo(t)}}function ek(t){for(var e,r=t;r&&!(e=r.pmViewDesc);r=r.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}var lf=function(t){var e=t.isCollapsed;return e&&ce.chrome&&t.rangeCount&&!t.getRangeAt(0).collapsed&&(e=!1),e};function _c(t,e){var r=document.createEvent("Event");return r.initEvent("keydown",!0,!0),r.keyCode=t,r.key=r.code=e,r}function tk(t){return{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function _s(t,e){return typeof t=="number"?t:t[e]}function rk(t){var e=t.getBoundingClientRect(),r=e.width/t.offsetWidth||1,o=e.height/t.offsetHeight||1;return{left:e.left,right:e.left+t.clientWidth*r,top:e.top,bottom:e.top+t.clientHeight*o}}function d0(t,e,r){for(var o=t.someProp("scrollThreshold")||0,a=t.someProp("scrollMargin")||5,l=t.dom.ownerDocument,d=r||t.dom;d;d=cf(d))if(d.nodeType==1){var A=d==l.body||d.nodeType!=1,g=A?tk(l):rk(d),v=0,C=0;if(e.top<g.top+_s(o,"top")?C=-(g.top-e.top+_s(a,"top")):e.bottom>g.bottom-_s(o,"bottom")&&(C=e.bottom-g.bottom+_s(a,"bottom")),e.left<g.left+_s(o,"left")?v=-(g.left-e.left+_s(a,"left")):e.right>g.right-_s(o,"right")&&(v=e.right-g.right+_s(a,"right")),v||C)if(A)l.defaultView.scrollBy(v,C);else{var y=d.scrollLeft,w=d.scrollTop;C&&(d.scrollTop+=C),v&&(d.scrollLeft+=v);var k=d.scrollLeft-y,M=d.scrollTop-w;e={left:e.left-k,top:e.top-M,right:e.right-k,bottom:e.bottom-M}}if(A)break}}function nk(t){for(var e=t.dom.getBoundingClientRect(),r=Math.max(0,e.top),o,a,l=(e.left+e.right)/2,d=r+1;d<Math.min(innerHeight,e.bottom);d+=5){var A=t.root.elementFromPoint(l,d);if(!(A==t.dom||!t.dom.contains(A))){var g=A.getBoundingClientRect();if(g.top>=r-20){o=A,a=g.top;break}}}return{refDOM:o,refTop:a,stack:h0(t.dom)}}function h0(t){for(var e=[],r=t.ownerDocument;t&&(e.push({dom:t,top:t.scrollTop,left:t.scrollLeft}),t!=r);t=cf(t));return e}function ik(t){var e=t.refDOM,r=t.refTop,o=t.stack,a=e?e.getBoundingClientRect().top:0;p0(o,a==0?0:a-r)}function p0(t,e){for(var r=0;r<t.length;r++){var o=t[r],a=o.dom,l=o.top,d=o.left;a.scrollTop!=l+e&&(a.scrollTop=l+e),a.scrollLeft!=d&&(a.scrollLeft=d)}}var Sc=null;function ok(t){if(t.setActive)return t.setActive();if(Sc)return t.focus(Sc);var e=h0(t);t.focus(Sc==null?{get preventScroll(){return Sc={preventScroll:!0},!0}}:void 0),Sc||(Sc=!1,p0(e,0))}function A0(t,e){for(var r,o=2e8,a,l=0,d=e.top,A=e.top,g=t.firstChild,v=0;g;g=g.nextSibling,v++){var C=void 0;if(g.nodeType==1)C=g.getClientRects();else if(g.nodeType==3)C=is(g).getClientRects();else continue;for(var y=0;y<C.length;y++){var w=C[y];if(w.top<=d&&w.bottom>=A){d=Math.max(w.bottom,d),A=Math.min(w.top,A);var k=w.left>e.left?w.left-e.left:w.right<e.left?e.left-w.right:0;if(k<o){r=g,o=k,a=k&&r.nodeType==3?{left:w.right<e.left?w.right:w.left,top:e.top}:e,g.nodeType==1&&k&&(l=v+(e.left>=(w.left+w.right)/2?1:0));continue}}!r&&(e.left>=w.right&&e.top>=w.top||e.left>=w.left&&e.top>=w.bottom)&&(l=v+1)}}return r&&r.nodeType==3?sk(r,a):!r||o&&r.nodeType==1?{node:t,offset:l}:A0(r,a)}function sk(t,e){for(var r=t.nodeValue.length,o=document.createRange(),a=0;a<r;a++){o.setEnd(t,a+1),o.setStart(t,a);var l=Ss(o,1);if(l.top!=l.bottom&&uf(e,l))return{node:t,offset:a+(e.left>=(l.left+l.right)/2?1:0)}}return{node:t,offset:0}}function uf(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function ak(t,e){var r=t.parentNode;return r&&/^li$/i.test(r.nodeName)&&e.left<t.getBoundingClientRect().left?r:t}function ck(t,e,r){var o=A0(e,r),a=o.node,l=o.offset,d=-1;if(a.nodeType==1&&!a.firstChild){var A=a.getBoundingClientRect();d=A.left!=A.right&&r.left>(A.left+A.right)/2?1:-1}return t.docView.posFromDOM(a,l,d)}function lk(t,e,r,o){for(var a=-1,l=e;l!=t.dom;){var d=t.docView.nearestDesc(l,!0);if(!d)return null;if(d.node.isBlock&&d.parent){var A=d.dom.getBoundingClientRect();if(A.left>o.left||A.top>o.top)a=d.posBefore;else if(A.right<o.left||A.bottom<o.top)a=d.posAfter;else break}l=d.dom.parentNode}return a>-1?a:t.docView.posFromDOM(e,r)}function f0(t,e,r){var o=t.childNodes.length;if(o&&r.top<r.bottom)for(var a=Math.max(0,Math.min(o-1,Math.floor(o*(e.top-r.top)/(r.bottom-r.top))-2)),l=a;;){var d=t.childNodes[l];if(d.nodeType==1)for(var A=d.getClientRects(),g=0;g<A.length;g++){var v=A[g];if(uf(e,v))return f0(d,e,v)}if((l=(l+1)%o)==a)break}return t}function uk(t,e){var r,o,a=t.dom.ownerDocument,l,d;if(a.caretPositionFromPoint)try{var A=a.caretPositionFromPoint(e.left,e.top);A&&(r=A,l=r.offsetNode,d=r.offset)}catch{}if(!l&&a.caretRangeFromPoint){var g=a.caretRangeFromPoint(e.left,e.top);g&&(o=g,l=o.startContainer,d=o.startOffset)}var v=(t.root.elementFromPoint?t.root:a).elementFromPoint(e.left,e.top+1),C;if(!v||!t.dom.contains(v.nodeType!=1?v.parentNode:v)){var y=t.dom.getBoundingClientRect();if(!uf(e,y)||(v=f0(t.dom,e,y),!v))return null}if(ce.safari)for(var w=v;l&&w;w=cf(w))w.draggable&&(l=d=null);if(v=ak(v,e),l){if(ce.gecko&&l.nodeType==1&&(d=Math.min(d,l.childNodes.length),d<l.childNodes.length)){var k=l.childNodes[d],M;k.nodeName=="IMG"&&(M=k.getBoundingClientRect()).right<=e.left&&M.bottom>e.top&&d++}l==t.dom&&d==l.childNodes.length-1&&l.lastChild.nodeType==1&&e.top>l.lastChild.getBoundingClientRect().bottom?C=t.state.doc.content.size:(d==0||l.nodeType!=1||l.childNodes[d-1].nodeName!="BR")&&(C=lk(t,l,d,e))}C==null&&(C=ck(t,v,e));var F=t.docView.nearestDesc(v,!0);return{pos:C,inside:F?F.posAtStart-F.border:-1}}function Ss(t,e){var r=t.getClientRects();return r.length?r[e<0?0:r.length-1]:t.getBoundingClientRect()}var dk=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function g0(t,e,r){var o=t.docView.domFromPos(e,r<0?-1:1),a=o.node,l=o.offset,d=ce.webkit||ce.gecko;if(a.nodeType==3)if(d&&(dk.test(a.nodeValue)||(r<0?!l:l==a.nodeValue.length))){var A=Ss(is(a,l,l),r);if(ce.gecko&&l&&/\s/.test(a.nodeValue[l-1])&&l<a.nodeValue.length){var g=Ss(is(a,l-1,l-1),-1);if(g.top==A.top){var v=Ss(is(a,l,l+1),-1);if(v.top!=A.top)return xl(v,v.left<g.left)}}return A}else{var C=l,y=l,w=r<0?1:-1;return r<0&&!l?(y++,w=-1):r>=0&&l==a.nodeValue.length?(C--,w=1):r<0?C--:y++,xl(Ss(is(a,C,y),w),w<0)}if(!t.state.doc.resolve(e).parent.inlineContent){if(l&&(r<0||l==Oo(a))){var k=a.childNodes[l-1];if(k.nodeType==1)return df(k.getBoundingClientRect(),!1)}if(l<Oo(a)){var M=a.childNodes[l];if(M.nodeType==1)return df(M.getBoundingClientRect(),!0)}return df(a.getBoundingClientRect(),r>=0)}if(l&&(r<0||l==Oo(a))){var F=a.childNodes[l-1],K=F.nodeType==3?is(F,Oo(F)-(d?0:1)):F.nodeType==1&&(F.nodeName!="BR"||!F.nextSibling)?F:null;if(K)return xl(Ss(K,1),!1)}if(l<Oo(a)){for(var J=a.childNodes[l];J.pmViewDesc&&J.pmViewDesc.ignoreForCoords;)J=J.nextSibling;var U=J?J.nodeType==3?is(J,0,d?0:1):J.nodeType==1?J:null:null;if(U)return xl(Ss(U,-1),!0)}return xl(Ss(a.nodeType==3?is(a):a,-r),r>=0)}function xl(t,e){if(t.width==0)return t;var r=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:r,right:r}}function df(t,e){if(t.height==0)return t;var r=e?t.top:t.bottom;return{top:r,bottom:r,left:t.left,right:t.right}}function m0(t,e,r){var o=t.state,a=t.root.activeElement;o!=e&&t.updateState(e),a!=t.dom&&t.focus();try{return r()}finally{o!=e&&t.updateState(o),a!=t.dom&&a&&a.focus()}}function hk(t,e,r){var o=e.selection,a=r=="up"?o.$from:o.$to;return m0(t,e,function(){for(var l=t.docView.domFromPos(a.pos,r=="up"?-1:1),d=l.node;;){var A=t.docView.nearestDesc(d,!0);if(!A)break;if(A.node.isBlock){d=A.dom;break}d=A.dom.parentNode}for(var g=g0(t,a.pos,1),v=d.firstChild;v;v=v.nextSibling){var C=void 0;if(v.nodeType==1)C=v.getClientRects();else if(v.nodeType==3)C=is(v,0,v.nodeValue.length).getClientRects();else continue;for(var y=0;y<C.length;y++){var w=C[y];if(w.bottom>w.top+1&&(r=="up"?g.top-w.top>(w.bottom-g.top)*2:w.bottom-g.bottom>(g.bottom-w.top)*2))return!1}}return!0})}var pk=/[\u0590-\u08ac]/;function Ak(t,e,r){var o=e.selection,a=o.$head;if(!a.parent.isTextblock)return!1;var l=a.parentOffset,d=!l,A=l==a.parent.content.size,g=t.root.getSelection();return!pk.test(a.parent.textContent)||!g.modify?r=="left"||r=="backward"?d:A:m0(t,e,function(){var v=g.getRangeAt(0),C=g.focusNode,y=g.focusOffset,w=g.caretBidiLevel;g.modify("move",r,"character");var k=a.depth?t.docView.domAfterPos(a.before()):t.dom,M=!k.contains(g.focusNode.nodeType==1?g.focusNode:g.focusNode.parentNode)||C==g.focusNode&&y==g.focusOffset;return g.removeAllRanges(),g.addRange(v),w!=null&&(g.caretBidiLevel=w),M})}var v0=null,E0=null,I0=!1;function fk(t,e,r){return v0==e&&E0==r?I0:(v0=e,E0=r,I0=r=="up"||r=="down"?hk(t,e,r):Ak(t,e,r))}var co=0,C0=1,Ul=2,Ts=3,Jt=function(e,r,o,a){this.parent=e,this.children=r,this.dom=o,o.pmViewDesc=this,this.contentDOM=a,this.dirty=co},ko={size:{configurable:!0},border:{configurable:!0},posBefore:{configurable:!0},posAtStart:{configurable:!0},posAfter:{configurable:!0},posAtEnd:{configurable:!0},contentLost:{configurable:!0},domAtom:{configurable:!0},ignoreForCoords:{configurable:!0}};Jt.prototype.matchesWidget=function(){return!1};Jt.prototype.matchesMark=function(){return!1};Jt.prototype.matchesNode=function(){return!1};Jt.prototype.matchesHack=function(e){return!1};Jt.prototype.parseRule=function(){return null};Jt.prototype.stopEvent=function(){return!1};ko.size.get=function(){for(var t=0,e=0;e<this.children.length;e++)t+=this.children[e].size;return t};ko.border.get=function(){return 0};Jt.prototype.destroy=function(){this.parent=null,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=null);for(var e=0;e<this.children.length;e++)this.children[e].destroy()};Jt.prototype.posBeforeChild=function(e){for(var r=0,o=this.posAtStart;r<this.children.length;r++){var a=this.children[r];if(a==e)return o;o+=a.size}};ko.posBefore.get=function(){return this.parent.posBeforeChild(this)};ko.posAtStart.get=function(){return this.parent?this.parent.posBeforeChild(this)+this.border:0};ko.posAfter.get=function(){return this.posBefore+this.size};ko.posAtEnd.get=function(){return this.posAtStart+this.size-2*this.border};Jt.prototype.localPosFromDOM=function(e,r,o){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(o<0){var a,l;if(e==this.contentDOM)a=e.childNodes[r-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;a=e.previousSibling}for(;a&&!((l=a.pmViewDesc)&&l.parent==this);)a=a.previousSibling;return a?this.posBeforeChild(l)+l.size:this.posAtStart}else{var d,A;if(e==this.contentDOM)d=e.childNodes[r];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;d=e.nextSibling}for(;d&&!((A=d.pmViewDesc)&&A.parent==this);)d=d.nextSibling;return d?this.posBeforeChild(A):this.posAtEnd}var g;if(e==this.dom&&this.contentDOM)g=r>yi(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))g=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(r==0)for(var v=e;;v=v.parentNode){if(v==this.dom){g=!1;break}if(v.parentNode.firstChild!=v)break}if(g==null&&r==e.childNodes.length)for(var C=e;;C=C.parentNode){if(C==this.dom){g=!0;break}if(C.parentNode.lastChild!=C)break}}return(g==null?o>0:g)?this.posAtEnd:this.posAtStart};Jt.prototype.nearestDesc=function(e,r){for(var o=!0,a=e;a;a=a.parentNode){var l=this.getDesc(a);if(l&&(!r||l.node))if(o&&l.nodeDOM&&!(l.nodeDOM.nodeType==1?l.nodeDOM.contains(e.nodeType==1?e:e.parentNode):l.nodeDOM==e))o=!1;else return l}};Jt.prototype.getDesc=function(e){for(var r=e.pmViewDesc,o=r;o;o=o.parent)if(o==this)return r};Jt.prototype.posFromDOM=function(e,r,o){for(var a=e;a;a=a.parentNode){var l=this.getDesc(a);if(l)return l.localPosFromDOM(e,r,o)}return-1};Jt.prototype.descAt=function(e){for(var r=0,o=0;r<this.children.length;r++){var a=this.children[r],l=o+a.size;if(o==e&&l!=o){for(;!a.border&&a.children.length;)a=a.children[0];return a}if(e<l)return a.descAt(e-o-a.border);o=l}};Jt.prototype.domFromPos=function(e,r){if(!this.contentDOM)return{node:this.dom,offset:0};for(var o=0,a=0,l=0;o<this.children.length;o++){var d=this.children[o],A=l+d.size;if(A>e||d instanceof T0){a=e-l;break}l=A}if(a)return this.children[o].domFromPos(a-this.children[o].border,r);for(var g=void 0;o&&!(g=this.children[o-1]).size&&g instanceof y0&&g.widget.type.side>=0;o--);if(r<=0){for(var v,C=!0;v=o?this.children[o-1]:null,!(!v||v.dom.parentNode==this.contentDOM);o--,C=!1);return v&&r&&C&&!v.border&&!v.domAtom?v.domFromPos(v.size,r):{node:this.contentDOM,offset:v?yi(v.dom)+1:0}}else{for(var y,w=!0;y=o<this.children.length?this.children[o]:null,!(!y||y.dom.parentNode==this.contentDOM);o++,w=!1);return y&&w&&!y.border&&!y.domAtom?y.domFromPos(0,r):{node:this.contentDOM,offset:y?yi(y.dom):this.contentDOM.childNodes.length}}};Jt.prototype.parseRange=function(e,r,o){if(o===void 0&&(o=0),this.children.length==0)return{node:this.contentDOM,from:e,to:r,fromOffset:0,toOffset:this.contentDOM.childNodes.length};for(var a=-1,l=-1,d=o,A=0;;A++){var g=this.children[A],v=d+g.size;if(a==-1&&e<=v){var C=d+g.border;if(e>=C&&r<=v-g.border&&g.node&&g.contentDOM&&this.contentDOM.contains(g.contentDOM))return g.parseRange(e,r,C);e=d;for(var y=A;y>0;y--){var w=this.children[y-1];if(w.size&&w.dom.parentNode==this.contentDOM&&!w.emptyChildAt(1)){a=yi(w.dom)+1;break}e-=w.size}a==-1&&(a=0)}if(a>-1&&(v>r||A==this.children.length-1)){r=v;for(var k=A+1;k<this.children.length;k++){var M=this.children[k];if(M.size&&M.dom.parentNode==this.contentDOM&&!M.emptyChildAt(-1)){l=yi(M.dom);break}r+=M.size}l==-1&&(l=this.contentDOM.childNodes.length);break}d=v}return{node:this.contentDOM,from:e,to:r,fromOffset:a,toOffset:l}};Jt.prototype.emptyChildAt=function(e){if(this.border||!this.contentDOM||!this.children.length)return!1;var r=this.children[e<0?0:this.children.length-1];return r.size==0||r.emptyChildAt(e)};Jt.prototype.domAfterPos=function(e){var r=this.domFromPos(e,0),o=r.node,a=r.offset;if(o.nodeType!=1||a==o.childNodes.length)throw new RangeError("No node after pos "+e);return o.childNodes[a]};Jt.prototype.setSelection=function(e,r,o,a){for(var l=Math.min(e,r),d=Math.max(e,r),A=0,g=0;A<this.children.length;A++){var v=this.children[A],C=g+v.size;if(l>g&&d<C)return v.setSelection(e-g-v.border,r-g-v.border,o,a);g=C}var y=this.domFromPos(e,e?-1:1),w=r==e?y:this.domFromPos(r,r?-1:1),k=o.getSelection(),M=!1;if((ce.gecko||ce.safari)&&e==r){var F=y.node,K=y.offset;if(F.nodeType==3){if(M=K&&F.nodeValue[K-1]==`
`,M&&K==F.nodeValue.length)for(var J=F,U=void 0;J;J=J.parentNode){if(U=J.nextSibling){U.nodeName=="BR"&&(y=w={node:U.parentNode,offset:yi(U)+1});break}var te=J.pmViewDesc;if(te&&te.node&&te.node.isBlock)break}}else{var P=F.childNodes[K-1];M=P&&(P.nodeName=="BR"||P.contentEditable=="false")}}if(ce.gecko&&k.focusNode&&k.focusNode!=w.node&&k.focusNode.nodeType==1){var he=k.focusNode.childNodes[k.focusOffset];he&&he.contentEditable=="false"&&(a=!0)}if(!(!(a||M&&ce.safari)&&Md(y.node,y.offset,k.anchorNode,k.anchorOffset)&&Md(w.node,w.offset,k.focusNode,k.focusOffset))){var ne=!1;if((k.extend||e==r)&&!M){k.collapse(y.node,y.offset);try{e!=r&&k.extend(w.node,w.offset),ne=!0}catch(Me){if(!(Me instanceof DOMException))throw Me}}if(!ne){if(e>r){var me=y;y=w,w=me}var Pe=document.createRange();Pe.setEnd(w.node,w.offset),Pe.setStart(y.node,y.offset),k.removeAllRanges(),k.addRange(Pe)}}};Jt.prototype.ignoreMutation=function(e){return!this.contentDOM&&e.type!="selection"};ko.contentLost.get=function(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)};Jt.prototype.markDirty=function(e,r){for(var o=0,a=0;a<this.children.length;a++){var l=this.children[a],d=o+l.size;if(o==d?e<=d&&r>=o:e<d&&r>o){var A=o+l.border,g=d-l.border;if(e>=A&&r<=g){this.dirty=e==o||r==d?Ul:C0,e==A&&r==g&&(l.contentLost||l.dom.parentNode!=this.contentDOM)?l.dirty=Ts:l.markDirty(e-A,r-A);return}else l.dirty=l.dom==l.contentDOM&&l.dom.parentNode==this.contentDOM?Ul:Ts}o=d}this.dirty=Ul};Jt.prototype.markParentsDirty=function(){for(var e=1,r=this.parent;r;r=r.parent,e++){var o=e==1?Ul:C0;r.dirty<o&&(r.dirty=o)}};ko.domAtom.get=function(){return!1};ko.ignoreForCoords.get=function(){return!1};Object.defineProperties(Jt.prototype,ko);var Rs=[],y0=function(t){function e(o,a,l,d){var A,g=a.type.toDOM;if(typeof g=="function"&&(g=g(l,function(){if(!A)return d;if(A.parent)return A.parent.posBeforeChild(A)})),!a.type.spec.raw){if(g.nodeType!=1){var v=document.createElement("span");v.appendChild(g),g=v}g.contentEditable=!1,g.classList.add("ProseMirror-widget")}t.call(this,o,Rs,g,null),this.widget=a,A=this}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={domAtom:{configurable:!0}};return e.prototype.matchesWidget=function(a){return this.dirty==co&&a.type.eq(this.widget.type)},e.prototype.parseRule=function(){return{ignore:!0}},e.prototype.stopEvent=function(a){var l=this.widget.spec.stopEvent;return l?l(a):!1},e.prototype.ignoreMutation=function(a){return a.type!="selection"||this.widget.spec.ignoreSelection},r.domAtom.get=function(){return!0},Object.defineProperties(e.prototype,r),e}(Jt),gk=function(t){function e(o,a,l,d){t.call(this,o,Rs,a,null),this.textDOM=l,this.text=d}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={size:{configurable:!0}};return r.size.get=function(){return this.text.length},e.prototype.localPosFromDOM=function(a,l){return a!=this.textDOM?this.posAtStart+(l?this.size:0):this.posAtStart+l},e.prototype.domFromPos=function(a){return{node:this.textDOM,offset:a}},e.prototype.ignoreMutation=function(a){return a.type==="characterData"&&a.target.nodeValue==a.oldValue},Object.defineProperties(e.prototype,r),e}(Jt),hf=function(t){function e(r,o,a,l){t.call(this,r,[],a,l),this.mark=o}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.create=function(o,a,l,d){var A=d.nodeViews[a.type.name],g=A&&A(a,d,l);return(!g||!g.dom)&&(g=Rn.renderSpec(document,a.type.spec.toDOM(a,l))),new e(o,a,g.dom,g.contentDOM||g.dom)},e.prototype.parseRule=function(){return{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}},e.prototype.matchesMark=function(o){return this.dirty!=Ts&&this.mark.eq(o)},e.prototype.markDirty=function(o,a){if(t.prototype.markDirty.call(this,o,a),this.dirty!=co){for(var l=this.parent;!l.node;)l=l.parent;l.dirty<this.dirty&&(l.dirty=this.dirty),this.dirty=co}},e.prototype.slice=function(o,a,l){var d=e.create(this.parent,this.mark,!0,l),A=this.children,g=this.size;a<g&&(A=ff(A,a,g,l)),o>0&&(A=ff(A,0,o,l));for(var v=0;v<A.length;v++)A[v].parent=d;return d.children=A,d},e}(Jt),Fl=function(t){function e(o,a,l,d,A,g,v,C,y){t.call(this,o,a.isLeaf?Rs:[],A,g),this.nodeDOM=v,this.node=a,this.outerDeco=l,this.innerDeco=d,g&&this.updateChildren(C,y)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={size:{configurable:!0},border:{configurable:!0},domAtom:{configurable:!0}};return e.create=function(a,l,d,A,g,v){var C,y=g.nodeViews[l.type.name],w,k=y&&y(l,g,function(){if(!w)return v;if(w.parent)return w.parent.posBeforeChild(w)},d,A),M=k&&k.dom,F=k&&k.contentDOM;if(l.isText){if(!M)M=document.createTextNode(l.text);else if(M.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else M||(C=Rn.renderSpec(document,l.type.spec.toDOM(l)),M=C.dom,F=C.contentDOM);!F&&!l.isText&&M.nodeName!="BR"&&(M.hasAttribute("contenteditable")||(M.contentEditable=!1),l.type.spec.draggable&&(M.draggable=!0));var K=M;return M=N0(M,d,l),k?w=new mk(a,l,d,A,M,F,K,k,g,v+1):l.isText?new S0(a,l,d,A,M,K,g):new e(a,l,d,A,M,F,K,g,v+1)},e.prototype.parseRule=function(){var a=this;if(this.node.type.spec.reparseInView)return null;var l={node:this.node.type.name,attrs:this.node.attrs};return this.node.type.spec.code&&(l.preserveWhitespace="full"),this.contentDOM&&!this.contentLost?l.contentElement=this.contentDOM:l.getContent=function(){return a.contentDOM?ee.empty:a.node.content},l},e.prototype.matchesNode=function(a,l,d){return this.dirty==co&&a.eq(this.node)&&Af(l,this.outerDeco)&&d.eq(this.innerDeco)},r.size.get=function(){return this.node.nodeSize},r.border.get=function(){return this.node.isLeaf?0:1},e.prototype.updateChildren=function(a,l){var d=this,A=this.node.inlineContent,g=l,v=a.composing&&this.localCompositionInfo(a,l),C=v&&v.pos>-1?v:null,y=v&&v.pos<0,w=new Gi(this,C&&C.node);Ck(this.node,this.innerDeco,function(k,M,F){k.spec.marks?w.syncToMarks(k.spec.marks,A,a):k.type.side>=0&&!F&&w.syncToMarks(M==d.node.childCount?Rt.none:d.node.child(M).marks,A,a),w.placeWidget(k,a,g)},function(k,M,F,K){w.syncToMarks(k.marks,A,a);var J;w.findNodeMatch(k,M,F,K)||y&&a.state.selection.from>g&&a.state.selection.to<g+k.nodeSize&&(J=w.findIndexWithChild(v.node))>-1&&w.updateNodeAt(k,M,F,J,a)||w.updateNextNode(k,M,F,a,K)||w.addNode(k,M,F,a,g),g+=k.nodeSize}),w.syncToMarks(Rs,A,a),this.node.isTextblock&&w.addTextblockHacks(),w.destroyRest(),(w.changed||this.dirty==Ul)&&(C&&this.protectLocalComposition(a,C),R0(this.contentDOM,this.children,a),ce.ios&&yk(this.dom))},e.prototype.localCompositionInfo=function(a,l){var d=a.state.selection,A=d.from,g=d.to;if(!(!(a.state.selection instanceof Ot)||A<l||g>l+this.node.content.size)){var v=a.root.getSelection(),C=_k(v.focusNode,v.focusOffset);if(!(!C||!this.dom.contains(C.parentNode)))if(this.node.inlineContent){var y=C.nodeValue,w=Sk(this.node.content,y,A-l,g-l);return w<0?null:{node:C,pos:w,text:y}}else return{node:C,pos:-1}}},e.prototype.protectLocalComposition=function(a,l){var d=l.node,A=l.pos,g=l.text;if(!this.getDesc(d)){for(var v=d;v.parentNode!=this.contentDOM;v=v.parentNode){for(;v.previousSibling;)v.parentNode.removeChild(v.previousSibling);for(;v.nextSibling;)v.parentNode.removeChild(v.nextSibling);v.pmViewDesc&&(v.pmViewDesc=null)}var C=new gk(this,v,d,g);a.compositionNodes.push(C),this.children=ff(this.children,A,A+g.length,a,C)}},e.prototype.update=function(a,l,d,A){return this.dirty==Ts||!a.sameMarkup(this.node)?!1:(this.updateInner(a,l,d,A),!0)},e.prototype.updateInner=function(a,l,d,A){this.updateOuterDeco(l),this.node=a,this.innerDeco=d,this.contentDOM&&this.updateChildren(A,this.posAtStart),this.dirty=co},e.prototype.updateOuterDeco=function(a){if(!Af(a,this.outerDeco)){var l=this.nodeDOM.nodeType!=1,d=this.dom;this.dom=w0(this.dom,this.nodeDOM,pf(this.outerDeco,this.node,l),pf(a,this.node,l)),this.dom!=d&&(d.pmViewDesc=null,this.dom.pmViewDesc=this),this.outerDeco=a}},e.prototype.selectNode=function(){this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.dom.draggable=!0)},e.prototype.deselectNode=function(){this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.dom.removeAttribute("draggable")},r.domAtom.get=function(){return this.node.isAtom},Object.defineProperties(e.prototype,r),e}(Jt);function _0(t,e,r,o,a){return N0(o,e,t),new Fl(null,t,e,r,o,o,o,a,0)}var S0=function(t){function e(o,a,l,d,A,g,v){t.call(this,o,a,l,d,A,null,g,v)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={domAtom:{configurable:!0}};return e.prototype.parseRule=function(){for(var a=this.nodeDOM.parentNode;a&&a!=this.dom&&!a.pmIsDeco;)a=a.parentNode;return{skip:a||!0}},e.prototype.update=function(a,l,d,A){return this.dirty==Ts||this.dirty!=co&&!this.inParent()||!a.sameMarkup(this.node)?!1:(this.updateOuterDeco(l),(this.dirty!=co||a.text!=this.node.text)&&a.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=a.text,A.trackWrites==this.nodeDOM&&(A.trackWrites=null)),this.node=a,this.dirty=co,!0)},e.prototype.inParent=function(){for(var a=this.parent.contentDOM,l=this.nodeDOM;l;l=l.parentNode)if(l==a)return!0;return!1},e.prototype.domFromPos=function(a){return{node:this.nodeDOM,offset:a}},e.prototype.localPosFromDOM=function(a,l,d){return a==this.nodeDOM?this.posAtStart+Math.min(l,this.node.text.length):t.prototype.localPosFromDOM.call(this,a,l,d)},e.prototype.ignoreMutation=function(a){return a.type!="characterData"&&a.type!="selection"},e.prototype.slice=function(a,l,d){var A=this.node.cut(a,l),g=document.createTextNode(A.text);return new e(this.parent,A,this.outerDeco,this.innerDeco,g,g,d)},e.prototype.markDirty=function(a,l){t.prototype.markDirty.call(this,a,l),this.dom!=this.nodeDOM&&(a==0||l==this.nodeDOM.nodeValue.length)&&(this.dirty=Ts)},r.domAtom.get=function(){return!1},Object.defineProperties(e.prototype,r),e}(Fl),T0=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={domAtom:{configurable:!0},ignoreForCoords:{configurable:!0}};return e.prototype.parseRule=function(){return{ignore:!0}},e.prototype.matchesHack=function(a){return this.dirty==co&&this.dom.nodeName==a},r.domAtom.get=function(){return!0},r.ignoreForCoords.get=function(){return this.dom.nodeName=="IMG"},Object.defineProperties(e.prototype,r),e}(Jt),mk=function(t){function e(r,o,a,l,d,A,g,v,C,y){t.call(this,r,o,a,l,d,A,g,C,y),this.spec=v}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.update=function(o,a,l,d){if(this.dirty==Ts)return!1;if(this.spec.update){var A=this.spec.update(o,a,l);return A&&this.updateInner(o,a,l,d),A}else return!this.contentDOM&&!o.isLeaf?!1:t.prototype.update.call(this,o,a,l,d)},e.prototype.selectNode=function(){this.spec.selectNode?this.spec.selectNode():t.prototype.selectNode.call(this)},e.prototype.deselectNode=function(){this.spec.deselectNode?this.spec.deselectNode():t.prototype.deselectNode.call(this)},e.prototype.setSelection=function(o,a,l,d){this.spec.setSelection?this.spec.setSelection(o,a,l):t.prototype.setSelection.call(this,o,a,l,d)},e.prototype.destroy=function(){this.spec.destroy&&this.spec.destroy(),t.prototype.destroy.call(this)},e.prototype.stopEvent=function(o){return this.spec.stopEvent?this.spec.stopEvent(o):!1},e.prototype.ignoreMutation=function(o){return this.spec.ignoreMutation?this.spec.ignoreMutation(o):t.prototype.ignoreMutation.call(this,o)},e}(Fl);function R0(t,e,r){for(var o=t.firstChild,a=!1,l=0;l<e.length;l++){var d=e[l],A=d.dom;if(A.parentNode==t){for(;A!=o;)o=O0(o),a=!0;o=o.nextSibling}else a=!0,t.insertBefore(A,o);if(d instanceof hf){var g=o?o.previousSibling:t.lastChild;R0(d.contentDOM,d.children,r),o=g?g.nextSibling:t.firstChild}}for(;o;)o=O0(o),a=!0;a&&r.trackWrites==t&&(r.trackWrites=null)}function Vl(t){t&&(this.nodeName=t)}Vl.prototype=Object.create(null);var Aa=[new Vl];function pf(t,e,r){if(t.length==0)return Aa;for(var o=r?Aa[0]:new Vl,a=[o],l=0;l<t.length;l++){var d=t[l].type.attrs;if(!!d){d.nodeName&&a.push(o=new Vl(d.nodeName));for(var A in d){var g=d[A];g!=null&&(r&&a.length==1&&a.push(o=new Vl(e.isInline?"span":"div")),A=="class"?o.class=(o.class?o.class+" ":"")+g:A=="style"?o.style=(o.style?o.style+";":"")+g:A!="nodeName"&&(o[A]=g))}}}return a}function w0(t,e,r,o){if(r==Aa&&o==Aa)return e;for(var a=e,l=0;l<o.length;l++){var d=o[l],A=r[l];if(l){var g=void 0;A&&A.nodeName==d.nodeName&&a!=t&&(g=a.parentNode)&&g.tagName.toLowerCase()==d.nodeName||(g=document.createElement(d.nodeName),g.pmIsDeco=!0,g.appendChild(a),A=Aa[0]),a=g}vk(a,A||Aa[0],d)}return a}function vk(t,e,r){for(var o in e)o!="class"&&o!="style"&&o!="nodeName"&&!(o in r)&&t.removeAttribute(o);for(var a in r)a!="class"&&a!="style"&&a!="nodeName"&&r[a]!=e[a]&&t.setAttribute(a,r[a]);if(e.class!=r.class){for(var l=e.class?e.class.split(" ").filter(Boolean):Rs,d=r.class?r.class.split(" ").filter(Boolean):Rs,A=0;A<l.length;A++)d.indexOf(l[A])==-1&&t.classList.remove(l[A]);for(var g=0;g<d.length;g++)l.indexOf(d[g])==-1&&t.classList.add(d[g])}if(e.style!=r.style){if(e.style)for(var v=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,C;C=v.exec(e.style);)t.style.removeProperty(C[1]);r.style&&(t.style.cssText+=r.style)}}function N0(t,e,r){return w0(t,t,Aa,pf(e,r,t.nodeType!=1))}function Af(t,e){if(t.length!=e.length)return!1;for(var r=0;r<t.length;r++)if(!t[r].type.eq(e[r].type))return!1;return!0}function O0(t){var e=t.nextSibling;return t.parentNode.removeChild(t),e}var Gi=function(e,r){this.top=e,this.lock=r,this.index=0,this.stack=[],this.changed=!1,this.preMatch=Ek(e.node.content,e.children)};Gi.prototype.destroyBetween=function(e,r){if(e!=r){for(var o=e;o<r;o++)this.top.children[o].destroy();this.top.children.splice(e,r-e),this.changed=!0}};Gi.prototype.destroyRest=function(){this.destroyBetween(this.index,this.top.children.length)};Gi.prototype.syncToMarks=function(e,r,o){for(var a=0,l=this.stack.length>>1,d=Math.min(l,e.length);a<d&&(a==l-1?this.top:this.stack[a+1<<1]).matchesMark(e[a])&&e[a].type.spec.spanning!==!1;)a++;for(;a<l;)this.destroyRest(),this.top.dirty=co,this.index=this.stack.pop(),this.top=this.stack.pop(),l--;for(;l<e.length;){this.stack.push(this.top,this.index+1);for(var A=-1,g=this.index;g<Math.min(this.index+3,this.top.children.length);g++)if(this.top.children[g].matchesMark(e[l])){A=g;break}if(A>-1)A>this.index&&(this.changed=!0,this.destroyBetween(this.index,A)),this.top=this.top.children[this.index];else{var v=hf.create(this.top,e[l],r,o);this.top.children.splice(this.index,0,v),this.top=v,this.changed=!0}this.index=0,l++}};Gi.prototype.findNodeMatch=function(e,r,o,a){var l=this.top.children,d=-1;if(a>=this.preMatch.index){for(var A=this.index;A<l.length;A++)if(l[A].matchesNode(e,r,o)){d=A;break}}else for(var g=this.index,v=Math.min(l.length,g+1);g<v;g++){var C=l[g];if(C.matchesNode(e,r,o)&&!this.preMatch.matched.has(C)){d=g;break}}return d<0?!1:(this.destroyBetween(this.index,d),this.index++,!0)};Gi.prototype.updateNodeAt=function(e,r,o,a,l){var d=this.top.children[a];return d.update(e,r,o,l)?(this.destroyBetween(this.index,a),this.index=a+1,!0):!1};Gi.prototype.findIndexWithChild=function(e){for(;;){var r=e.parentNode;if(!r)return-1;if(r==this.top.contentDOM){var o=e.pmViewDesc;if(o){for(var a=this.index;a<this.top.children.length;a++)if(this.top.children[a]==o)return a}return-1}e=r}};Gi.prototype.updateNextNode=function(e,r,o,a,l){for(var d=this.index;d<this.top.children.length;d++){var A=this.top.children[d];if(A instanceof Fl){var g=this.preMatch.matched.get(A);if(g!=null&&g!=l)return!1;var v=A.dom,C=this.lock&&(v==this.lock||v.nodeType==1&&v.contains(this.lock.parentNode))&&!(e.isText&&A.node&&A.node.isText&&A.nodeDOM.nodeValue==e.text&&A.dirty!=Ts&&Af(r,A.outerDeco));if(!C&&A.update(e,r,o,a))return this.destroyBetween(this.index,d),A.dom!=v&&(this.changed=!0),this.index++,!0;break}}return!1};Gi.prototype.addNode=function(e,r,o,a,l){this.top.children.splice(this.index++,0,Fl.create(this.top,e,r,o,a,l)),this.changed=!0};Gi.prototype.placeWidget=function(e,r,o){var a=this.index<this.top.children.length?this.top.children[this.index]:null;if(a&&a.matchesWidget(e)&&(e==a.widget||!a.widget.type.toDOM.parentNode))this.index++;else{var l=new y0(this.top,e,r,o);this.top.children.splice(this.index++,0,l),this.changed=!0}};Gi.prototype.addTextblockHacks=function(){for(var e=this.top.children[this.index-1];e instanceof hf;)e=e.children[e.children.length-1];(!e||!(e instanceof S0)||/\n$/.test(e.node.text))&&((ce.safari||ce.chrome)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG"),this.addHackNode("BR"))};Gi.prototype.addHackNode=function(e){if(this.index<this.top.children.length&&this.top.children[this.index].matchesHack(e))this.index++;else{var r=document.createElement(e);e=="IMG"&&(r.className="ProseMirror-separator"),e=="BR"&&(r.className="ProseMirror-trailingBreak"),this.top.children.splice(this.index++,0,new T0(this.top,Rs,r,null)),this.changed=!0}};function Ek(t,e){for(var r=t.childCount,o=e.length,a=new Map;r>0&&o>0;o--){var l=e[o-1],d=l.node;if(!!d){if(d!=t.child(r-1))break;--r,a.set(l,r)}}return{index:r,matched:a}}function Ik(t,e){return t.type.side-e.type.side}function Ck(t,e,r,o){var a=e.locals(t),l=0;if(a.length==0){for(var d=0;d<t.childCount;d++){var A=t.child(d);o(A,a,e.forChild(l,A),d),l+=A.nodeSize}return}for(var g=0,v=[],C=null,y=0;;){if(g<a.length&&a[g].to==l){for(var w=a[g++],k=void 0;g<a.length&&a[g].to==l;)(k||(k=[w])).push(a[g++]);if(k){k.sort(Ik);for(var M=0;M<k.length;M++)r(k[M],y,!!C)}else r(w,y,!!C)}var F=void 0,K=void 0;if(C)K=-1,F=C,C=null;else if(y<t.childCount)K=y,F=t.child(y++);else break;for(var J=0;J<v.length;J++)v[J].to<=l&&v.splice(J--,1);for(;g<a.length&&a[g].from<=l&&a[g].to>l;)v.push(a[g++]);var U=l+F.nodeSize;if(F.isText){var te=U;g<a.length&&a[g].from<te&&(te=a[g].from);for(var P=0;P<v.length;P++)v[P].to<te&&(te=v[P].to);te<U&&(C=F.cut(te-l),F=F.cut(0,te-l),U=te,K=-1)}var he=v.length?F.isInline&&!F.isLeaf?v.filter(function(ne){return!ne.inline}):v.slice():Rs;o(F,he,e.forChild(l,F),K),l=U}}function yk(t){if(t.nodeName=="UL"||t.nodeName=="OL"){var e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t).listStyle,t.style.cssText=e}}function _k(t,e){for(;;){if(t.nodeType==3)return t;if(t.nodeType==1&&e>0){if(t.childNodes.length>e&&t.childNodes[e].nodeType==3)return t.childNodes[e];t=t.childNodes[e-1],e=Oo(t)}else if(t.nodeType==1&&e<t.childNodes.length)t=t.childNodes[e],e=0;else return null}}function Sk(t,e,r,o){for(var a=0,l=0;a<t.childCount&&l<=o;){var d=t.child(a++),A=l;if(l+=d.nodeSize,!!d.isText){for(var g=d.text;a<t.childCount;){var v=t.child(a++);if(l+=v.nodeSize,!v.isText)break;g+=v.text}if(l>=r){var C=g.lastIndexOf(e,o-A);if(C>=0&&C+e.length+A>=r)return A+C}}}return-1}function ff(t,e,r,o,a){for(var l=[],d=0,A=0;d<t.length;d++){var g=t[d],v=A,C=A+=g.size;v>=r||C<=e?l.push(g):(v<e&&l.push(g.slice(0,e-v,o)),a&&(l.push(a),a=null),C>r&&l.push(g.slice(r-v,g.size,o)))}return l}function k0(t,e){var r=t.root.getSelection(),o=t.state.doc;if(!r.focusNode)return null;var a=t.docView.nearestDesc(r.focusNode),l=a&&a.size==0,d=t.docView.posFromDOM(r.focusNode,r.focusOffset);if(d<0)return null;var A=o.resolve(d),g,v;if(lf(r)){for(g=A;a&&!a.node;)a=a.parent;if(a&&a.node.isAtom&&et.isSelectable(a.node)&&a.parent&&!(a.node.isInline&&ZO(r.focusNode,r.focusOffset,a.dom))){var C=a.posBefore;v=new et(d==C?A:o.resolve(C))}}else{var y=t.docView.posFromDOM(r.anchorNode,r.anchorOffset);if(y<0)return null;g=o.resolve(y)}if(!v){var w=e=="pointer"||t.state.selection.head<A.pos&&!l?1:-1;v=mf(t,g,A,w)}return v}function b0(t){return t.editable?t.hasFocus():vf(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function ws(t,e){var r=t.state.selection;if(M0(t,r),!!b0(t)){if(!e&&t.mouseDown&&t.mouseDown.allowDefault){t.mouseDown.delayedSelectionSync=!0,t.domObserver.setCurSelection();return}if(t.domObserver.disconnectSelection(),t.cursorWrapper)Rk(t);else{var o=r.anchor,a=r.head,l,d;D0&&!(r instanceof Ot)&&(r.$from.parent.inlineContent||(l=B0(t,r.from)),!r.empty&&!r.$from.parent.inlineContent&&(d=B0(t,r.to))),t.docView.setSelection(o,a,t.root,e),D0&&(l&&L0(l),d&&L0(d)),r.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&Tk(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}var D0=ce.safari||ce.chrome&&ce.chrome_version<63;function B0(t,e){var r=t.docView.domFromPos(e,0),o=r.node,a=r.offset,l=a<o.childNodes.length?o.childNodes[a]:null,d=a?o.childNodes[a-1]:null;if(ce.safari&&l&&l.contentEditable=="false")return gf(l);if((!l||l.contentEditable=="false")&&(!d||d.contentEditable=="false")){if(l)return gf(l);if(d)return gf(d)}}function gf(t){return t.contentEditable="true",ce.safari&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function L0(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function Tk(t){var e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.hideSelectionGuard);var r=t.root.getSelection(),o=r.anchorNode,a=r.anchorOffset;e.addEventListener("selectionchange",t.hideSelectionGuard=function(){(r.anchorNode!=o||r.anchorOffset!=a)&&(e.removeEventListener("selectionchange",t.hideSelectionGuard),setTimeout(function(){(!b0(t)||t.state.selection.visible)&&t.dom.classList.remove("ProseMirror-hideselection")},20))})}function Rk(t){var e=t.root.getSelection(),r=document.createRange(),o=t.cursorWrapper.dom,a=o.nodeName=="IMG";a?r.setEnd(o.parentNode,yi(o)+1):r.setEnd(o,0),r.collapse(!1),e.removeAllRanges(),e.addRange(r),!a&&!t.state.selection.visible&&ce.ie&&ce.ie_version<=11&&(o.disabled=!0,o.disabled=!1)}function M0(t,e){if(e instanceof et){var r=t.docView.descAt(e.from);r!=t.lastSelectedViewDesc&&(P0(t),r&&r.selectNode(),t.lastSelectedViewDesc=r)}else P0(t)}function P0(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=null)}function mf(t,e,r,o){return t.someProp("createSelectionBetween",function(a){return a(t,e,r)})||Ot.between(e,r,o)}function wk(t){return t.editable&&t.root.activeElement!=t.dom?!1:vf(t)}function vf(t){var e=t.root.getSelection();if(!e.anchorNode)return!1;try{return t.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function Nk(t){var e=t.docView.domFromPos(t.state.selection.anchor,0),r=t.root.getSelection();return Md(e.node,e.offset,r.anchorNode,r.anchorOffset)}function Ef(t,e){var r=t.selection,o=r.$anchor,a=r.$head,l=e>0?o.max(a):o.min(a),d=l.parent.inlineContent?l.depth?t.doc.resolve(e>0?l.after():l.before()):null:l;return d&&nt.findFrom(d,e)}function fa(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function Q0(t,e,r){var o=t.state.selection;if(o instanceof Ot){if(!o.empty||r.indexOf("s")>-1)return!1;if(t.endOfTextblock(e>0?"right":"left")){var a=Ef(t.state,e);return a&&a instanceof et?fa(t,a):!1}else if(!(ce.mac&&r.indexOf("m")>-1)){var l=o.$head,d=l.textOffset?null:e<0?l.nodeBefore:l.nodeAfter,A;if(!d||d.isText)return!1;var g=e<0?l.pos-d.nodeSize:l.pos;return d.isAtom||(A=t.docView.descAt(g))&&!A.contentDOM?et.isSelectable(d)?fa(t,new et(e<0?t.state.doc.resolve(l.pos-d.nodeSize):l)):ce.webkit?fa(t,new Ot(t.state.doc.resolve(e<0?g:g+d.nodeSize))):!1:!1}}else{if(o instanceof et&&o.node.isInline)return fa(t,new Ot(e>0?o.$to:o.$from));var v=Ef(t.state,e);return v?fa(t,v):!1}}function Pd(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function Gl(t){var e=t.pmViewDesc;return e&&e.size==0&&(t.nextSibling||t.nodeName!="BR")}function If(t){var e=t.root.getSelection(),r=e.focusNode,o=e.focusOffset;if(!!r){var a,l,d=!1;for(ce.gecko&&r.nodeType==1&&o<Pd(r)&&Gl(r.childNodes[o])&&(d=!0);;)if(o>0){if(r.nodeType!=1)break;var A=r.childNodes[o-1];if(Gl(A))a=r,l=--o;else if(A.nodeType==3)r=A,o=r.nodeValue.length;else break}else{if(x0(r))break;for(var g=r.previousSibling;g&&Gl(g);)a=r.parentNode,l=yi(g),g=g.previousSibling;if(g)r=g,o=Pd(r);else{if(r=r.parentNode,r==t.dom)break;o=0}}d?yf(t,e,r,o):a&&yf(t,e,a,l)}}function Cf(t){var e=t.root.getSelection(),r=e.focusNode,o=e.focusOffset;if(!!r){for(var a=Pd(r),l,d;;)if(o<a){if(r.nodeType!=1)break;var A=r.childNodes[o];if(Gl(A))l=r,d=++o;else break}else{if(x0(r))break;for(var g=r.nextSibling;g&&Gl(g);)l=g.parentNode,d=yi(g)+1,g=g.nextSibling;if(g)r=g,o=0,a=Pd(r);else{if(r=r.parentNode,r==t.dom)break;o=a=0}}l&&yf(t,e,l,d)}}function x0(t){var e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function yf(t,e,r,o){if(lf(e)){var a=document.createRange();a.setEnd(r,o),a.setStart(r,o),e.removeAllRanges(),e.addRange(a)}else e.extend&&e.extend(r,o);t.domObserver.setCurSelection();var l=t.state;setTimeout(function(){t.state==l&&ws(t)},50)}function U0(t,e,r){var o=t.state.selection;if(o instanceof Ot&&!o.empty||r.indexOf("s")>-1||ce.mac&&r.indexOf("m")>-1)return!1;var a=o.$from,l=o.$to;if(!a.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){var d=Ef(t.state,e);if(d&&d instanceof et)return fa(t,d)}if(!a.parent.inlineContent){var A=e<0?a:l,g=o instanceof ns?nt.near(A,e):nt.findFrom(A,e);return g?fa(t,g):!1}return!1}function F0(t,e){if(!(t.state.selection instanceof Ot))return!0;var r=t.state.selection,o=r.$head,a=r.$anchor,l=r.empty;if(!o.sameParent(a))return!0;if(!l)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;var d=!o.textOffset&&(e<0?o.nodeBefore:o.nodeAfter);if(d&&!d.isText){var A=t.state.tr;return e<0?A.delete(o.pos-d.nodeSize,o.pos):A.delete(o.pos,o.pos+d.nodeSize),t.dispatch(A),!0}return!1}function V0(t,e,r){t.domObserver.stop(),e.contentEditable=r,t.domObserver.start()}function Ok(t){if(!(!ce.safari||t.state.selection.$head.parentOffset>0)){var e=t.root.getSelection(),r=e.focusNode,o=e.focusOffset;if(r&&r.nodeType==1&&o==0&&r.firstChild&&r.firstChild.contentEditable=="false"){var a=r.firstChild;V0(t,a,!0),setTimeout(function(){return V0(t,a,!1)},20)}}}function kk(t){var e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}function bk(t,e){var r=e.keyCode,o=kk(e);return r==8||ce.mac&&r==72&&o=="c"?F0(t,-1)||If(t):r==46||ce.mac&&r==68&&o=="c"?F0(t,1)||Cf(t):r==13||r==27?!0:r==37?Q0(t,-1,o)||If(t):r==39?Q0(t,1,o)||Cf(t):r==38?U0(t,-1,o)||If(t):r==40?Ok(t)||U0(t,1,o)||Cf(t):o==(ce.mac?"m":"c")&&(r==66||r==73||r==89||r==90)}function Dk(t,e,r){var o=t.docView.parseRange(e,r),a=o.node,l=o.fromOffset,d=o.toOffset,A=o.from,g=o.to,v=t.root.getSelection(),C=null,y=v.anchorNode;if(y&&t.dom.contains(y.nodeType==1?y:y.parentNode)&&(C=[{node:y,offset:v.anchorOffset}],lf(v)||C.push({node:v.focusNode,offset:v.focusOffset})),ce.chrome&&t.lastKeyCode===8)for(var w=d;w>l;w--){var k=a.childNodes[w-1],M=k.pmViewDesc;if(k.nodeName=="BR"&&!M){d=w;break}if(!M||M.size)break}var F=t.state.doc,K=t.someProp("domParser")||ao.fromSchema(t.state.schema),J=F.resolve(A),U=null,te=K.parse(a,{topNode:J.parent,topMatch:J.parent.contentMatchAt(J.index()),topOpen:!0,from:l,to:d,preserveWhitespace:J.parent.type.spec.code?"full":!0,editableContent:!0,findPositions:C,ruleFromNode:Bk,context:J});if(C&&C[0].pos!=null){var P=C[0].pos,he=C[1]&&C[1].pos;he==null&&(he=P),U={anchor:P+A,head:he+A}}return{doc:te,sel:U,from:A,to:g}}function Bk(t){var e=t.pmViewDesc;if(e)return e.parseRule();if(t.nodeName=="BR"&&t.parentNode){if(ce.safari&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){var r=document.createElement("div");return r.appendChild(document.createElement("li")),{skip:r}}else if(t.parentNode.lastChild==t||ce.safari&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if(t.nodeName=="IMG"&&t.getAttribute("mark-placeholder"))return{ignore:!0}}function Lk(t,e,r,o,a){if(e<0){var l=t.lastSelectionTime>Date.now()-50?t.lastSelectionOrigin:null,d=k0(t,l);if(d&&!t.state.selection.eq(d)){var A=t.state.tr.setSelection(d);l=="pointer"?A.setMeta("pointer",!0):l=="key"&&A.scrollIntoView(),t.dispatch(A)}return}var g=t.state.doc.resolve(e),v=g.sharedDepth(r);e=g.before(v+1),r=t.state.doc.resolve(r).after(v+1);var C=t.state.selection,y=Dk(t,e,r);if(ce.chrome&&t.cursorWrapper&&y.sel&&y.sel.anchor==t.cursorWrapper.deco.from){var w=t.cursorWrapper.deco.type.toDOM.nextSibling,k=w&&w.nodeValue?w.nodeValue.length:1;y.sel={anchor:y.sel.anchor+k,head:y.sel.anchor+k}}var M=t.state.doc,F=M.slice(y.from,y.to),K,J;t.lastKeyCode===8&&Date.now()-100<t.lastKeyCodeTime?(K=t.state.selection.to,J="end"):(K=t.state.selection.from,J="start"),t.lastKeyCode=null;var U=Qk(F.content,y.doc.content,y.from,K,J);if(!U)if(o&&C instanceof Ot&&!C.empty&&C.$head.sameParent(C.$anchor)&&!t.composing&&!(y.sel&&y.sel.anchor!=y.sel.head))U={start:C.from,endA:C.to,endB:C.to};else if((ce.ios&&t.lastIOSEnter>Date.now()-225||ce.android)&&a.some(function(Et){return Et.nodeName=="DIV"||Et.nodeName=="P"})&&t.someProp("handleKeyDown",function(Et){return Et(t,_c(13,"Enter"))})){t.lastIOSEnter=0;return}else{if(y.sel){var te=G0(t,t.state.doc,y.sel);te&&!te.eq(t.state.selection)&&t.dispatch(t.state.tr.setSelection(te))}return}t.domChangeCount++,t.state.selection.from<t.state.selection.to&&U.start==U.endB&&t.state.selection instanceof Ot&&(U.start>t.state.selection.from&&U.start<=t.state.selection.from+2?U.start=t.state.selection.from:U.endA<t.state.selection.to&&U.endA>=t.state.selection.to-2&&(U.endB+=t.state.selection.to-U.endA,U.endA=t.state.selection.to)),ce.ie&&ce.ie_version<=11&&U.endB==U.start+1&&U.endA==U.start&&U.start>y.from&&y.doc.textBetween(U.start-y.from-1,U.start-y.from+1)==" \xA0"&&(U.start--,U.endA--,U.endB--);var P=y.doc.resolveNoCache(U.start-y.from),he=y.doc.resolveNoCache(U.endB-y.from),ne=P.sameParent(he)&&P.parent.inlineContent,me;if((ce.ios&&t.lastIOSEnter>Date.now()-225&&(!ne||a.some(function(Et){return Et.nodeName=="DIV"||Et.nodeName=="P"}))||!ne&&P.pos<y.doc.content.size&&(me=nt.findFrom(y.doc.resolve(P.pos+1),1,!0))&&me.head==he.pos)&&t.someProp("handleKeyDown",function(Et){return Et(t,_c(13,"Enter"))})){t.lastIOSEnter=0;return}if(t.state.selection.anchor>U.start&&Pk(M,U.start,U.endA,P,he)&&t.someProp("handleKeyDown",function(Et){return Et(t,_c(8,"Backspace"))})){ce.android&&ce.chrome&&t.domObserver.suppressSelectionUpdates();return}ce.chrome&&ce.android&&U.toB==U.from&&(t.lastAndroidDelete=Date.now()),ce.android&&!ne&&P.start()!=he.start()&&he.parentOffset==0&&P.depth==he.depth&&y.sel&&y.sel.anchor==y.sel.head&&y.sel.head==U.endA&&(U.endB-=2,he=y.doc.resolveNoCache(U.endB-y.from),setTimeout(function(){t.someProp("handleKeyDown",function(Et){return Et(t,_c(13,"Enter"))})},20));var Pe=U.start,Me=U.endA,be,Gt,At,it;if(ne){if(P.pos==he.pos)ce.ie&&ce.ie_version<=11&&P.parentOffset==0&&(t.domObserver.suppressSelectionUpdates(),setTimeout(function(){return ws(t)},20)),be=t.state.tr.delete(Pe,Me),Gt=M.resolve(U.start).marksAcross(M.resolve(U.endA));else if(U.endA==U.endB&&(it=M.resolve(U.start))&&(At=Mk(P.parent.content.cut(P.parentOffset,he.parentOffset),it.parent.content.cut(it.parentOffset,U.endA-it.start()))))be=t.state.tr,At.type=="add"?be.addMark(Pe,Me,At.mark):be.removeMark(Pe,Me,At.mark);else if(P.parent.child(P.index()).isText&&P.index()==he.index()-(he.textOffset?0:1)){var gr=P.parent.textBetween(P.parentOffset,he.parentOffset);if(t.someProp("handleTextInput",function(Et){return Et(t,Pe,Me,gr)}))return;be=t.state.tr.insertText(gr,Pe,Me)}}if(be||(be=t.state.tr.replace(Pe,Me,y.doc.slice(U.start-y.from,U.endB-y.from))),y.sel){var _t=G0(t,be.doc,y.sel);_t&&!(ce.chrome&&ce.android&&t.composing&&_t.empty&&(U.start!=U.endB||t.lastAndroidDelete<Date.now()-100)&&(_t.head==Pe||_t.head==be.mapping.map(Me)-1)||ce.ie&&_t.empty&&_t.head==Pe)&&be.setSelection(_t)}Gt&&be.ensureMarks(Gt),t.dispatch(be.scrollIntoView())}function G0(t,e,r){return Math.max(r.anchor,r.head)>e.content.size?null:mf(t,e.resolve(r.anchor),e.resolve(r.head))}function Mk(t,e){for(var r=t.firstChild.marks,o=e.firstChild.marks,a=r,l=o,d,A,g,v=0;v<o.length;v++)a=o[v].removeFromSet(a);for(var C=0;C<r.length;C++)l=r[C].removeFromSet(l);if(a.length==1&&l.length==0)A=a[0],d="add",g=function(k){return k.mark(A.addToSet(k.marks))};else if(a.length==0&&l.length==1)A=l[0],d="remove",g=function(k){return k.mark(A.removeFromSet(k.marks))};else return null;for(var y=[],w=0;w<e.childCount;w++)y.push(g(e.child(w)));if(ee.from(y).eq(t))return{mark:A,type:d}}function Pk(t,e,r,o,a){if(!o.parent.isTextblock||r-e<=a.pos-o.pos||_f(o,!0,!1)<a.pos)return!1;var l=t.resolve(e);if(l.parentOffset<l.parent.content.size||!l.parent.isTextblock)return!1;var d=t.resolve(_f(l,!0,!0));return!d.parent.isTextblock||d.pos>r||_f(d,!0,!1)<r?!1:o.parent.content.cut(o.parentOffset).eq(d.parent.content)}function _f(t,e,r){for(var o=t.depth,a=e?t.end():t.pos;o>0&&(e||t.indexAfter(o)==t.node(o).childCount);)o--,a++,e=!1;if(r)for(var l=t.node(o).maybeChild(t.indexAfter(o));l&&!l.isLeaf;)l=l.firstChild,a++;return a}function Qk(t,e,r,o,a){var l=t.findDiffStart(e,r);if(l==null)return null;var d=t.findDiffEnd(e,r+t.size,r+e.size),A=d.a,g=d.b;if(a=="end"){var v=Math.max(0,l-Math.min(A,g));o-=A+v-l}if(A<l&&t.size<e.size){var C=o<=l&&o>=A?l-o:0;l-=C,g=l+(g-A),A=l}else if(g<l){var y=o<=l&&o>=g?l-o:0;l-=y,A=l+(A-g),g=l}return{start:l,endA:A,endB:g}}function j0(t,e){for(var r=[],o=e.content,a=e.openStart,l=e.openEnd;a>1&&l>1&&o.childCount==1&&o.firstChild.childCount==1;){a--,l--;var d=o.firstChild;r.push(d.type.name,d.attrs!=d.type.defaultAttrs?d.attrs:null),o=d.content}var A=t.someProp("clipboardSerializer")||Rn.fromSchema(t.state.schema),g=X0(),v=g.createElement("div");v.appendChild(A.serializeFragment(o,{document:g}));for(var C=v.firstChild,y;C&&C.nodeType==1&&(y=J0[C.nodeName.toLowerCase()]);){for(var w=y.length-1;w>=0;w--){for(var k=g.createElement(y[w]);v.firstChild;)k.appendChild(v.firstChild);v.appendChild(k),y[w]!="tbody"&&(a++,l++)}C=v.firstChild}C&&C.nodeType==1&&C.setAttribute("data-pm-slice",a+" "+l+" "+JSON.stringify(r));var M=t.someProp("clipboardTextSerializer",function(F){return F(e)})||e.content.textBetween(0,e.content.size,`

`);return{dom:v,text:M}}function H0(t,e,r,o,a){var l,d=a.parent.type.spec.code,A;if(!r&&!e)return null;var g=e&&(o||d||!r);if(g){if(t.someProp("transformPastedText",function(he){e=he(e,d||o)}),d)return e?new ye(ee.from(t.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0):ye.empty;var v=t.someProp("clipboardTextParser",function(he){return he(e,a,o)});if(v)A=v;else{var C=a.marks(),y=t.state,w=y.schema,k=Rn.fromSchema(w);l=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(function(he){var ne=l.appendChild(document.createElement("p"));he&&ne.appendChild(k.serializeNode(w.text(he,C)))})}}else t.someProp("transformPastedHTML",function(he){r=he(r)}),l=Uk(r),ce.webkit&&Fk(l);var M=l&&l.querySelector("[data-pm-slice]"),F=M&&/^(\d+) (\d+) (.*)/.exec(M.getAttribute("data-pm-slice"));if(!A){var K=t.someProp("clipboardParser")||t.someProp("domParser")||ao.fromSchema(t.state.schema);A=K.parseSlice(l,{preserveWhitespace:!!(g||F),context:a})}if(F)A=Vk(q0(A,+F[1],+F[2]),F[3]);else if(A=ye.maxOpen(xk(A.content,a),!0),A.openStart||A.openEnd){for(var J=0,U=0,te=A.content.firstChild;J<A.openStart&&!te.type.spec.isolating;J++,te=te.firstChild);for(var P=A.content.lastChild;U<A.openEnd&&!P.type.spec.isolating;U++,P=P.lastChild);A=q0(A,J,U)}return t.someProp("transformPasted",function(he){A=he(A)}),A}function xk(t,e){if(t.childCount<2)return t;for(var r=function(l){var d=e.node(l),A=d.contentMatchAt(e.index(l)),g=void 0,v=[];if(t.forEach(function(C){if(!!v){var y=A.findWrapping(C.type),w;if(!y)return v=null;if(w=v.length&&g.length&&W0(y,g,C,v[v.length-1],0))v[v.length-1]=w;else{v.length&&(v[v.length-1]=Y0(v[v.length-1],g.length));var k=K0(C,y);v.push(k),A=A.matchType(k.type,k.attrs),g=y}}}),v)return{v:ee.from(v)}},o=e.depth;o>=0;o--){var a=r(o);if(a)return a.v}return t}function K0(t,e,r){r===void 0&&(r=0);for(var o=e.length-1;o>=r;o--)t=e[o].create(null,ee.from(t));return t}function W0(t,e,r,o,a){if(a<t.length&&a<e.length&&t[a]==e[a]){var l=W0(t,e,r,o.lastChild,a+1);if(l)return o.copy(o.content.replaceChild(o.childCount-1,l));var d=o.contentMatchAt(o.childCount);if(d.matchType(a==t.length-1?r.type:t[a+1]))return o.copy(o.content.append(ee.from(K0(r,t,a+1))))}}function Y0(t,e){if(e==0)return t;var r=t.content.replaceChild(t.childCount-1,Y0(t.lastChild,e-1)),o=t.contentMatchAt(t.childCount).fillBefore(ee.empty,!0);return t.copy(r.append(o))}function Sf(t,e,r,o,a,l){var d=e<0?t.firstChild:t.lastChild,A=d.content;return a<o-1&&(A=Sf(A,e,r,o,a+1,l)),a>=r&&(A=e<0?d.contentMatchAt(0).fillBefore(A,t.childCount>1||l<=a).append(A):A.append(d.contentMatchAt(d.childCount).fillBefore(ee.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,d.copy(A))}function q0(t,e,r){return e<t.openStart&&(t=new ye(Sf(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),r<t.openEnd&&(t=new ye(Sf(t.content,1,r,t.openEnd,0,0),t.openStart,r)),t}var J0={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]},z0=null;function X0(){return z0||(z0=document.implementation.createHTMLDocument("title"))}function Uk(t){var e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));var r=X0().createElement("div"),o=/<([a-z][^>\s]+)/i.exec(t),a;if((a=o&&J0[o[1].toLowerCase()])&&(t=a.map(function(d){return"<"+d+">"}).join("")+t+a.map(function(d){return"</"+d+">"}).reverse().join("")),r.innerHTML=t,a)for(var l=0;l<a.length;l++)r=r.querySelector(a[l])||r;return r}function Fk(t){for(var e=t.querySelectorAll(ce.chrome?"span:not([class]):not([style])":"span.Apple-converted-space"),r=0;r<e.length;r++){var o=e[r];o.childNodes.length==1&&o.textContent=="\xA0"&&o.parentNode&&o.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),o)}}function Vk(t,e){if(!t.size)return t;var r=t.content.firstChild.type.schema,o;try{o=JSON.parse(e)}catch{return t}for(var a=t.content,l=t.openStart,d=t.openEnd,A=o.length-2;A>=0;A-=2){var g=r.nodes[o[A]];if(!g||g.hasRequiredAttrs())break;a=ee.from(g.create(o[A+1],a)),l++,d++}return new ye(a,l,d)}var Gk={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},Tf=ce.ie&&ce.ie_version<=11,Rf=function(){this.anchorNode=this.anchorOffset=this.focusNode=this.focusOffset=null};Rf.prototype.set=function(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset};Rf.prototype.eq=function(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset};var _i=function(e,r){var o=this;this.view=e,this.handleDOMChange=r,this.queue=[],this.flushingSoon=-1,this.observer=window.MutationObserver&&new window.MutationObserver(function(a){for(var l=0;l<a.length;l++)o.queue.push(a[l]);ce.ie&&ce.ie_version<=11&&a.some(function(d){return d.type=="childList"&&d.removedNodes.length||d.type=="characterData"&&d.oldValue.length>d.target.nodeValue.length})?o.flushSoon():o.flush()}),this.currentSelection=new Rf,Tf&&(this.onCharData=function(a){o.queue.push({target:a.target,type:"characterData",oldValue:a.prevValue}),o.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.suppressingSelectionUpdates=!1};_i.prototype.flushSoon=function(){var e=this;this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(function(){e.flushingSoon=-1,e.flush()},20))};_i.prototype.forceFlush=function(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())};_i.prototype.start=function(){this.observer&&this.observer.observe(this.view.dom,Gk),Tf&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()};_i.prototype.stop=function(){var e=this;if(this.observer){var r=this.observer.takeRecords();if(r.length){for(var o=0;o<r.length;o++)this.queue.push(r[o]);window.setTimeout(function(){return e.flush()},20)}this.observer.disconnect()}Tf&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()};_i.prototype.connectSelection=function(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)};_i.prototype.disconnectSelection=function(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)};_i.prototype.suppressSelectionUpdates=function(){var e=this;this.suppressingSelectionUpdates=!0,setTimeout(function(){return e.suppressingSelectionUpdates=!1},50)};_i.prototype.onSelectionChange=function(){if(!!wk(this.view)){if(this.suppressingSelectionUpdates)return ws(this.view);if(ce.ie&&ce.ie_version<=11&&!this.view.state.selection.empty){var e=this.view.root.getSelection();if(e.focusNode&&Md(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}};_i.prototype.setCurSelection=function(){this.currentSelection.set(this.view.root.getSelection())};_i.prototype.ignoreSelectionChange=function(e){if(e.rangeCount==0)return!0;var r=e.getRangeAt(0).commonAncestorContainer,o=this.view.docView.nearestDesc(r);if(o&&o.ignoreMutation({type:"selection",target:r.nodeType==3?r.parentNode:r}))return this.setCurSelection(),!0};_i.prototype.flush=function(){if(!(!this.view.docView||this.flushingSoon>-1)){var e=this.observer?this.observer.takeRecords():[];this.queue.length&&(e=this.queue.concat(e),this.queue.length=0);var r=this.view.root.getSelection(),o=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(r)&&vf(this.view)&&!this.ignoreSelectionChange(r),a=-1,l=-1,d=!1,A=[];if(this.view.editable)for(var g=0;g<e.length;g++){var v=this.registerMutation(e[g],A);v&&(a=a<0?v.from:Math.min(v.from,a),l=l<0?v.to:Math.max(v.to,l),v.typeOver&&(d=!0))}if(ce.gecko&&A.length>1){var C=A.filter(function(k){return k.nodeName=="BR"});if(C.length==2){var y=C[0],w=C[1];y.parentNode&&y.parentNode.parentNode==w.parentNode?w.remove():y.remove()}}(a>-1||o)&&(a>-1&&(this.view.docView.markDirty(a,l),jk(this.view)),this.handleDOMChange(a,l,d,A),this.view.docView.dirty?this.view.updateState(this.view.state):this.currentSelection.eq(r)||ws(this.view),this.currentSelection.set(r))}};_i.prototype.registerMutation=function(e,r){if(r.indexOf(e.target)>-1)return null;var o=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(o==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!o||o.ignoreMutation(e))return null;if(e.type=="childList"){for(var a=0;a<e.addedNodes.length;a++)r.push(e.addedNodes[a]);if(o.contentDOM&&o.contentDOM!=o.dom&&!o.contentDOM.contains(e.target))return{from:o.posBefore,to:o.posAfter};var l=e.previousSibling,d=e.nextSibling;if(ce.ie&&ce.ie_version<=11&&e.addedNodes.length)for(var A=0;A<e.addedNodes.length;A++){var g=e.addedNodes[A],v=g.previousSibling,C=g.nextSibling;(!v||Array.prototype.indexOf.call(e.addedNodes,v)<0)&&(l=v),(!C||Array.prototype.indexOf.call(e.addedNodes,C)<0)&&(d=C)}var y=l&&l.parentNode==e.target?yi(l)+1:0,w=o.localPosFromDOM(e.target,y,-1),k=d&&d.parentNode==e.target?yi(d):e.target.childNodes.length,M=o.localPosFromDOM(e.target,k,1);return{from:w,to:M}}else return e.type=="attributes"?{from:o.posAtStart-o.border,to:o.posAtEnd+o.border}:{from:o.posAtStart,to:o.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}};var $0=!1;function jk(t){$0||($0=!0,getComputedStyle(t.dom).whiteSpace=="normal"&&console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."))}var oi={},Hn={};function Hk(t){t.shiftKey=!1,t.mouseDown=null,t.lastKeyCode=null,t.lastKeyCodeTime=0,t.lastClick={time:0,x:0,y:0,type:""},t.lastSelectionOrigin=null,t.lastSelectionTime=0,t.lastIOSEnter=0,t.lastIOSEnterFallbackTimeout=null,t.lastAndroidDelete=0,t.composing=!1,t.composingTimeout=null,t.compositionNodes=[],t.compositionEndedAt=-2e8,t.domObserver=new _i(t,function(o,a,l,d){return Lk(t,o,a,l,d)}),t.domObserver.start(),t.domChangeCount=0,t.eventHandlers=Object.create(null);var e=function(o){var a=oi[o];t.dom.addEventListener(o,t.eventHandlers[o]=function(l){Wk(t,l)&&!Nf(t,l)&&(t.editable||!(l.type in Hn))&&a(t,l)})};for(var r in oi)e(r);ce.safari&&t.dom.addEventListener("input",function(){return null}),wf(t)}function ga(t,e){t.lastSelectionOrigin=e,t.lastSelectionTime=Date.now()}function Kk(t){t.domObserver.stop();for(var e in t.eventHandlers)t.dom.removeEventListener(e,t.eventHandlers[e]);clearTimeout(t.composingTimeout),clearTimeout(t.lastIOSEnterFallbackTimeout)}function wf(t){t.someProp("handleDOMEvents",function(e){for(var r in e)t.eventHandlers[r]||t.dom.addEventListener(r,t.eventHandlers[r]=function(o){return Nf(t,o)})})}function Nf(t,e){return t.someProp("handleDOMEvents",function(r){var o=r[e.type];return o?o(t,e)||e.defaultPrevented:!1})}function Wk(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(var r=e.target;r!=t.dom;r=r.parentNode)if(!r||r.nodeType==11||r.pmViewDesc&&r.pmViewDesc.stopEvent(e))return!1;return!0}function Yk(t,e){!Nf(t,e)&&oi[e.type]&&(t.editable||!(e.type in Hn))&&oi[e.type](t,e)}Hn.keydown=function(t,e){if(t.shiftKey=e.keyCode==16||e.shiftKey,!ey(t,e))if(e.keyCode!=229&&t.domObserver.forceFlush(),t.lastKeyCode=e.keyCode,t.lastKeyCodeTime=Date.now(),ce.ios&&e.keyCode==13&&!e.ctrlKey&&!e.altKey&&!e.metaKey){var r=Date.now();t.lastIOSEnter=r,t.lastIOSEnterFallbackTimeout=setTimeout(function(){t.lastIOSEnter==r&&(t.someProp("handleKeyDown",function(o){return o(t,_c(13,"Enter"))}),t.lastIOSEnter=0)},200)}else t.someProp("handleKeyDown",function(o){return o(t,e)})||bk(t,e)?e.preventDefault():ga(t,"key")};Hn.keyup=function(t,e){e.keyCode==16&&(t.shiftKey=!1)};Hn.keypress=function(t,e){if(!(ey(t,e)||!e.charCode||e.ctrlKey&&!e.altKey||ce.mac&&e.metaKey)){if(t.someProp("handleKeyPress",function(a){return a(t,e)})){e.preventDefault();return}var r=t.state.selection;if(!(r instanceof Ot)||!r.$from.sameParent(r.$to)){var o=String.fromCharCode(e.charCode);t.someProp("handleTextInput",function(a){return a(t,r.$from.pos,r.$to.pos,o)})||t.dispatch(t.state.tr.insertText(o).scrollIntoView()),e.preventDefault()}}};function Qd(t){return{left:t.clientX,top:t.clientY}}function qk(t,e){var r=e.x-t.clientX,o=e.y-t.clientY;return r*r+o*o<100}function Of(t,e,r,o,a){if(o==-1)return!1;for(var l=t.state.doc.resolve(o),d=function(v){if(t.someProp(e,function(C){return v>l.depth?C(t,r,l.nodeAfter,l.before(v),a,!0):C(t,r,l.node(v),l.before(v),a,!1)}))return{v:!0}},A=l.depth+1;A>0;A--){var g=d(A);if(g)return g.v}return!1}function Tc(t,e,r){t.focused||t.focus();var o=t.state.tr.setSelection(e);r=="pointer"&&o.setMeta("pointer",!0),t.dispatch(o)}function Jk(t,e){if(e==-1)return!1;var r=t.state.doc.resolve(e),o=r.nodeAfter;return o&&o.isAtom&&et.isSelectable(o)?(Tc(t,new et(r),"pointer"),!0):!1}function zk(t,e){if(e==-1)return!1;var r=t.state.selection,o,a;r instanceof et&&(o=r.node);for(var l=t.state.doc.resolve(e),d=l.depth+1;d>0;d--){var A=d>l.depth?l.nodeAfter:l.node(d);if(et.isSelectable(A)){o&&r.$from.depth>0&&d>=r.$from.depth&&l.before(r.$from.depth+1)==r.$from.pos?a=l.before(r.$from.depth):a=l.before(d);break}}return a!=null?(Tc(t,et.create(t.state.doc,a),"pointer"),!0):!1}function Xk(t,e,r,o,a){return Of(t,"handleClickOn",e,r,o)||t.someProp("handleClick",function(l){return l(t,e,o)})||(a?zk(t,r):Jk(t,r))}function $k(t,e,r,o){return Of(t,"handleDoubleClickOn",e,r,o)||t.someProp("handleDoubleClick",function(a){return a(t,e,o)})}function Zk(t,e,r,o){return Of(t,"handleTripleClickOn",e,r,o)||t.someProp("handleTripleClick",function(a){return a(t,e,o)})||eb(t,r,o)}function eb(t,e,r){if(r.button!=0)return!1;var o=t.state.doc;if(e==-1)return o.inlineContent?(Tc(t,Ot.create(o,0,o.content.size),"pointer"),!0):!1;for(var a=o.resolve(e),l=a.depth+1;l>0;l--){var d=l>a.depth?a.nodeAfter:a.node(l),A=a.before(l);if(d.inlineContent)Tc(t,Ot.create(o,A+1,A+1+d.content.size),"pointer");else if(et.isSelectable(d))Tc(t,et.create(o,A),"pointer");else continue;return!0}}function kf(t){return Ud(t)}var Z0=ce.mac?"metaKey":"ctrlKey";oi.mousedown=function(t,e){t.shiftKey=e.shiftKey;var r=kf(t),o=Date.now(),a="singleClick";o-t.lastClick.time<500&&qk(e,t.lastClick)&&!e[Z0]&&(t.lastClick.type=="singleClick"?a="doubleClick":t.lastClick.type=="doubleClick"&&(a="tripleClick")),t.lastClick={time:o,x:e.clientX,y:e.clientY,type:a};var l=t.posAtCoords(Qd(e));!l||(a=="singleClick"?(t.mouseDown&&t.mouseDown.done(),t.mouseDown=new xd(t,l,e,r)):(a=="doubleClick"?$k:Zk)(t,l.pos,l.inside,e)?e.preventDefault():ga(t,"pointer"))};var xd=function(e,r,o,a){var l=this;this.view=e,this.startDoc=e.state.doc,this.pos=r,this.event=o,this.flushed=a,this.selectNode=o[Z0],this.allowDefault=o.shiftKey,this.delayedSelectionSync=!1;var d,A;if(r.inside>-1)d=e.state.doc.nodeAt(r.inside),A=r.inside;else{var g=e.state.doc.resolve(r.pos);d=g.parent,A=g.depth?g.before():0}this.mightDrag=null;var v=a?null:o.target,C=v?e.docView.nearestDesc(v,!0):null;this.target=C?C.dom:null;var y=e.state,w=y.selection;(o.button==0&&d.type.spec.draggable&&d.type.spec.selectable!==!1||w instanceof et&&w.from<=A&&w.to>A)&&(this.mightDrag={node:d,pos:A,addAttr:this.target&&!this.target.draggable,setUneditable:this.target&&ce.gecko&&!this.target.hasAttribute("contentEditable")}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(function(){l.view.mouseDown==l&&l.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),ga(e,"pointer")};xd.prototype.done=function(){var e=this;this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(function(){return ws(e.view)}),this.view.mouseDown=null};xd.prototype.up=function(e){if(this.done(),!!this.view.dom.contains(e.target.nodeType==3?e.target.parentNode:e.target)){var r=this.pos;this.view.state.doc!=this.startDoc&&(r=this.view.posAtCoords(Qd(e))),this.allowDefault||!r?ga(this.view,"pointer"):Xk(this.view,r.pos,r.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||ce.safari&&this.mightDrag&&!this.mightDrag.node.isAtom||ce.chrome&&!(this.view.state.selection instanceof Ot)&&Math.min(Math.abs(r.pos-this.view.state.selection.from),Math.abs(r.pos-this.view.state.selection.to))<=2)?(Tc(this.view,nt.near(this.view.state.doc.resolve(r.pos)),"pointer"),e.preventDefault()):ga(this.view,"pointer")}};xd.prototype.move=function(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0),ga(this.view,"pointer"),e.buttons==0&&this.done()};oi.touchdown=function(t){kf(t),ga(t,"pointer")};oi.contextmenu=function(t){return kf(t)};function ey(t,e){return t.composing?!0:ce.safari&&Math.abs(e.timeStamp-t.compositionEndedAt)<500?(t.compositionEndedAt=-2e8,!0):!1}var tb=ce.android?5e3:-1;Hn.compositionstart=Hn.compositionupdate=function(t){if(!t.composing){t.domObserver.flush();var e=t.state,r=e.selection.$from;if(e.selection.empty&&(e.storedMarks||!r.textOffset&&r.parentOffset&&r.nodeBefore.marks.some(function(A){return A.type.spec.inclusive===!1})))t.markCursor=t.state.storedMarks||r.marks(),Ud(t,!0),t.markCursor=null;else if(Ud(t),ce.gecko&&e.selection.empty&&r.parentOffset&&!r.textOffset&&r.nodeBefore.marks.length)for(var o=t.root.getSelection(),a=o.focusNode,l=o.focusOffset;a&&a.nodeType==1&&l!=0;){var d=l<0?a.lastChild:a.childNodes[l-1];if(!d)break;if(d.nodeType==3){o.collapse(d,d.nodeValue.length);break}else a=d,l=-1}t.composing=!0}ty(t,tb)};Hn.compositionend=function(t,e){t.composing&&(t.composing=!1,t.compositionEndedAt=e.timeStamp,ty(t,20))};function ty(t,e){clearTimeout(t.composingTimeout),e>-1&&(t.composingTimeout=setTimeout(function(){return Ud(t)},e))}function ry(t){for(t.composing&&(t.composing=!1,t.compositionEndedAt=rb());t.compositionNodes.length>0;)t.compositionNodes.pop().markParentsDirty()}function rb(){var t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}function Ud(t,e){if(t.domObserver.forceFlush(),ry(t),e||t.docView.dirty){var r=k0(t);return r&&!r.eq(t.state.selection)?t.dispatch(t.state.tr.setSelection(r)):t.updateState(t.state),!0}return!1}function nb(t,e){if(!!t.dom.parentNode){var r=t.dom.parentNode.appendChild(document.createElement("div"));r.appendChild(e),r.style.cssText="position: fixed; left: -10000px; top: 10px";var o=getSelection(),a=document.createRange();a.selectNodeContents(e),t.dom.blur(),o.removeAllRanges(),o.addRange(a),setTimeout(function(){r.parentNode&&r.parentNode.removeChild(r),t.focus()},50)}}var Rc=ce.ie&&ce.ie_version<15||ce.ios&&ce.webkit_version<604;oi.copy=Hn.cut=function(t,e){var r=t.state.selection,o=e.type=="cut";if(!r.empty){var a=Rc?null:e.clipboardData,l=r.content(),d=j0(t,l),A=d.dom,g=d.text;a?(e.preventDefault(),a.clearData(),a.setData("text/html",A.innerHTML),a.setData("text/plain",g)):nb(t,A),o&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))}};function ib(t){return t.openStart==0&&t.openEnd==0&&t.content.childCount==1?t.content.firstChild:null}function ob(t,e){if(!!t.dom.parentNode){var r=t.shiftKey||t.state.selection.$from.parent.type.spec.code,o=t.dom.parentNode.appendChild(document.createElement(r?"textarea":"div"));r||(o.contentEditable="true"),o.style.cssText="position: fixed; left: -10000px; top: 10px",o.focus(),setTimeout(function(){t.focus(),o.parentNode&&o.parentNode.removeChild(o),r?bf(t,o.value,null,e):bf(t,o.textContent,o.innerHTML,e)},50)}}function bf(t,e,r,o){var a=H0(t,e,r,t.shiftKey,t.state.selection.$from);if(t.someProp("handlePaste",function(A){return A(t,o,a||ye.empty)}))return!0;if(!a)return!1;var l=ib(a),d=l?t.state.tr.replaceSelectionWith(l,t.shiftKey):t.state.tr.replaceSelection(a);return t.dispatch(d.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}Hn.paste=function(t,e){var r=Rc?null:e.clipboardData;r&&bf(t,r.getData("text/plain"),r.getData("text/html"),e)?e.preventDefault():ob(t,e)};var sb=function(e,r){this.slice=e,this.move=r},ny=ce.mac?"altKey":"ctrlKey";oi.dragstart=function(t,e){var r=t.mouseDown;if(r&&r.done(),!!e.dataTransfer){var o=t.state.selection,a=o.empty?null:t.posAtCoords(Qd(e));if(!(a&&a.pos>=o.from&&a.pos<=(o instanceof et?o.to-1:o.to))){if(r&&r.mightDrag)t.dispatch(t.state.tr.setSelection(et.create(t.state.doc,r.mightDrag.pos)));else if(e.target&&e.target.nodeType==1){var l=t.docView.nearestDesc(e.target,!0);l&&l.node.type.spec.draggable&&l!=t.docView&&t.dispatch(t.state.tr.setSelection(et.create(t.state.doc,l.posBefore)))}}var d=t.state.selection.content(),A=j0(t,d),g=A.dom,v=A.text;e.dataTransfer.clearData(),e.dataTransfer.setData(Rc?"Text":"text/html",g.innerHTML),e.dataTransfer.effectAllowed="copyMove",Rc||e.dataTransfer.setData("text/plain",v),t.dragging=new sb(d,!e[ny])}};oi.dragend=function(t){var e=t.dragging;window.setTimeout(function(){t.dragging==e&&(t.dragging=null)},50)};Hn.dragover=Hn.dragenter=function(t,e){return e.preventDefault()};Hn.drop=function(t,e){var r=t.dragging;if(t.dragging=null,!!e.dataTransfer){var o=t.posAtCoords(Qd(e));if(!!o){var a=t.state.doc.resolve(o.pos);if(!!a){var l=r&&r.slice;l?t.someProp("transformPasted",function(M){l=M(l)}):l=H0(t,e.dataTransfer.getData(Rc?"Text":"text/plain"),Rc?null:e.dataTransfer.getData("text/html"),!1,a);var d=r&&!e[ny];if(t.someProp("handleDrop",function(M){return M(t,e,l||ye.empty,d)})){e.preventDefault();return}if(!!l){e.preventDefault();var A=l?MC(t.state.doc,a.pos,l):a.pos;A==null&&(A=a.pos);var g=t.state.tr;d&&g.deleteSelection();var v=g.mapping.map(A),C=l.openStart==0&&l.openEnd==0&&l.content.childCount==1,y=g.doc;if(C?g.replaceRangeWith(v,v,l.content.firstChild):g.replaceRange(v,v,l),!g.doc.eq(y)){var w=g.doc.resolve(v);if(C&&et.isSelectable(l.content.firstChild)&&w.nodeAfter&&w.nodeAfter.sameMarkup(l.content.firstChild))g.setSelection(new et(w));else{var k=g.mapping.map(A);g.mapping.maps[g.mapping.maps.length-1].forEach(function(M,F,K,J){return k=J}),g.setSelection(mf(t,w,g.doc.resolve(k)))}t.focus(),t.dispatch(g.setMeta("uiEvent","drop"))}}}}}};oi.focus=function(t){t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout(function(){t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.root.getSelection())&&ws(t)},20))};oi.blur=function(t,e){t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),e.relatedTarget&&t.dom.contains(e.relatedTarget)&&t.domObserver.currentSelection.set({}),t.focused=!1)};oi.beforeinput=function(t,e){if(ce.chrome&&ce.android&&e.inputType=="deleteContentBackward"){var r=t.domChangeCount;setTimeout(function(){if(t.domChangeCount==r&&(t.dom.blur(),t.focus(),!t.someProp("handleKeyDown",function(l){return l(t,_c(8,"Backspace"))}))){var o=t.state.selection,a=o.$cursor;a&&a.pos>0&&t.dispatch(t.state.tr.delete(a.pos-1,a.pos).scrollIntoView())}},50)}};for(var iy in Hn)oi[iy]=Hn[iy];function jl(t,e){if(t==e)return!0;for(var r in t)if(t[r]!==e[r])return!1;for(var o in e)if(!(o in t))return!1;return!0}var Hl=function(e,r){this.spec=r||ma,this.side=this.spec.side||0,this.toDOM=e};Hl.prototype.map=function(e,r,o,a){var l=e.mapResult(r.from+a,this.side<0?-1:1),d=l.pos,A=l.deleted;return A?null:new Pr(d-o,d-o,this)};Hl.prototype.valid=function(){return!0};Hl.prototype.eq=function(e){return this==e||e instanceof Hl&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&jl(this.spec,e.spec))};var lo=function(e,r){this.spec=r||ma,this.attrs=e};lo.prototype.map=function(e,r,o,a){var l=e.map(r.from+a,this.spec.inclusiveStart?-1:1)-o,d=e.map(r.to+a,this.spec.inclusiveEnd?1:-1)-o;return l>=d?null:new Pr(l,d,this)};lo.prototype.valid=function(e,r){return r.from<r.to};lo.prototype.eq=function(e){return this==e||e instanceof lo&&jl(this.attrs,e.attrs)&&jl(this.spec,e.spec)};lo.is=function(e){return e.type instanceof lo};var Kl=function(e,r){this.spec=r||ma,this.attrs=e};Kl.prototype.map=function(e,r,o,a){var l=e.mapResult(r.from+a,1);if(l.deleted)return null;var d=e.mapResult(r.to+a,-1);return d.deleted||d.pos<=l.pos?null:new Pr(l.pos-o,d.pos-o,this)};Kl.prototype.valid=function(e,r){var o=e.content.findIndex(r.from),a=o.index,l=o.offset,d;return l==r.from&&!(d=e.child(a)).isText&&l+d.nodeSize==r.to};Kl.prototype.eq=function(e){return this==e||e instanceof Kl&&jl(this.attrs,e.attrs)&&jl(this.spec,e.spec)};var Pr=function(e,r,o){this.from=e,this.to=r,this.type=o},Df={spec:{configurable:!0},inline:{configurable:!0}};Pr.prototype.copy=function(e,r){return new Pr(e,r,this.type)};Pr.prototype.eq=function(e,r){return r===void 0&&(r=0),this.type.eq(e.type)&&this.from+r==e.from&&this.to+r==e.to};Pr.prototype.map=function(e,r,o){return this.type.map(e,this,r,o)};Pr.widget=function(e,r,o){return new Pr(e,e,new Hl(r,o))};Pr.inline=function(e,r,o,a){return new Pr(e,r,new lo(o,a))};Pr.node=function(e,r,o,a){return new Pr(e,r,new Kl(o,a))};Df.spec.get=function(){return this.type.spec};Df.inline.get=function(){return this.type instanceof lo};Object.defineProperties(Pr.prototype,Df);var Fd=[],ma={},Ut=function(e,r){this.local=e&&e.length?e:Fd,this.children=r&&r.length?r:Fd};Ut.create=function(e,r){return r.length?Vd(r,e,0,ma):hn};Ut.prototype.find=function(e,r,o){var a=[];return this.findInner(e==null?0:e,r==null?1e9:r,a,0,o),a};Ut.prototype.findInner=function(e,r,o,a,l){for(var d=0;d<this.local.length;d++){var A=this.local[d];A.from<=r&&A.to>=e&&(!l||l(A.spec))&&o.push(A.copy(A.from+a,A.to+a))}for(var g=0;g<this.children.length;g+=3)if(this.children[g]<r&&this.children[g+1]>e){var v=this.children[g]+1;this.children[g+2].findInner(e-v,r-v,o,a+v,l)}};Ut.prototype.map=function(e,r,o){return this==hn||e.maps.length==0?this:this.mapInner(e,r,0,0,o||ma)};Ut.prototype.mapInner=function(e,r,o,a,l){for(var d,A=0;A<this.local.length;A++){var g=this.local[A].map(e,o,a);g&&g.type.valid(r,g)?(d||(d=[])).push(g):l.onRemove&&l.onRemove(this.local[A].spec)}return this.children.length?ab(this.children,d,e,r,o,a,l):d?new Ut(d.sort(va)):hn};Ut.prototype.add=function(e,r){return r.length?this==hn?Ut.create(e,r):this.addInner(e,r,0):this};Ut.prototype.addInner=function(e,r,o){var a=this,l,d=0;e.forEach(function(v,C){var y=C+o,w;if(!!(w=sy(r,v,y))){for(l||(l=a.children.slice());d<l.length&&l[d]<C;)d+=3;l[d]==C?l[d+2]=l[d+2].addInner(v,w,y+1):l.splice(d,0,C,C+v.nodeSize,Vd(w,v,y+1,ma)),d+=3}});for(var A=oy(d?ay(r):r,-o),g=0;g<A.length;g++)A[g].type.valid(e,A[g])||A.splice(g--,1);return new Ut(A.length?this.local.concat(A).sort(va):this.local,l||this.children)};Ut.prototype.remove=function(e){return e.length==0||this==hn?this:this.removeInner(e,0)};Ut.prototype.removeInner=function(e,r){for(var o=this.children,a=this.local,l=0;l<o.length;l+=3){for(var d=void 0,A=o[l]+r,g=o[l+1]+r,v=0,C=void 0;v<e.length;v++)(C=e[v])&&C.from>A&&C.to<g&&(e[v]=null,(d||(d=[])).push(C));if(!!d){o==this.children&&(o=this.children.slice());var y=o[l+2].removeInner(d,A+1);y!=hn?o[l+2]=y:(o.splice(l,3),l-=3)}}if(a.length){for(var w=0,k=void 0;w<e.length;w++)if(k=e[w])for(var M=0;M<a.length;M++)a[M].eq(k,r)&&(a==this.local&&(a=this.local.slice()),a.splice(M--,1))}return o==this.children&&a==this.local?this:a.length||o.length?new Ut(a,o):hn};Ut.prototype.forChild=function(e,r){if(this==hn)return this;if(r.isLeaf)return Ut.empty;for(var o,a,l=0;l<this.children.length;l+=3)if(this.children[l]>=e){this.children[l]==e&&(o=this.children[l+2]);break}for(var d=e+1,A=d+r.content.size,g=0;g<this.local.length;g++){var v=this.local[g];if(v.from<A&&v.to>d&&v.type instanceof lo){var C=Math.max(d,v.from)-d,y=Math.min(A,v.to)-d;C<y&&(a||(a=[])).push(v.copy(C,y))}}if(a){var w=new Ut(a.sort(va));return o?new ji([w,o]):w}return o||hn};Ut.prototype.eq=function(e){if(this==e)return!0;if(!(e instanceof Ut)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(var r=0;r<this.local.length;r++)if(!this.local[r].eq(e.local[r]))return!1;for(var o=0;o<this.children.length;o+=3)if(this.children[o]!=e.children[o]||this.children[o+1]!=e.children[o+1]||!this.children[o+2].eq(e.children[o+2]))return!1;return!0};Ut.prototype.locals=function(e){return Bf(this.localsInner(e))};Ut.prototype.localsInner=function(e){if(this==hn)return Fd;if(e.inlineContent||!this.local.some(lo.is))return this.local;for(var r=[],o=0;o<this.local.length;o++)this.local[o].type instanceof lo||r.push(this.local[o]);return r};var hn=new Ut;Ut.empty=hn;Ut.removeOverlap=Bf;var ji=function(e){this.members=e};ji.prototype.map=function(e,r){var o=this.members.map(function(a){return a.map(e,r,ma)});return ji.from(o)};ji.prototype.forChild=function(e,r){if(r.isLeaf)return Ut.empty;for(var o=[],a=0;a<this.members.length;a++){var l=this.members[a].forChild(e,r);l!=hn&&(l instanceof ji?o=o.concat(l.members):o.push(l))}return ji.from(o)};ji.prototype.eq=function(e){if(!(e instanceof ji)||e.members.length!=this.members.length)return!1;for(var r=0;r<this.members.length;r++)if(!this.members[r].eq(e.members[r]))return!1;return!0};ji.prototype.locals=function(e){for(var r,o=!0,a=0;a<this.members.length;a++){var l=this.members[a].localsInner(e);if(!!l.length)if(!r)r=l;else{o&&(r=r.slice(),o=!1);for(var d=0;d<l.length;d++)r.push(l[d])}}return r?Bf(o?r:r.sort(va)):Fd};ji.from=function(e){switch(e.length){case 0:return hn;case 1:return e[0];default:return new ji(e)}};function ab(t,e,r,o,a,l,d){for(var A=t.slice(),g=function(Gt,At,it,gr){for(var _t=0;_t<A.length;_t+=3){var Et=A[_t+1],ar=void 0;Et==-1||Gt>Et+l||(At>=A[_t]+l?A[_t+1]=-1:it>=a&&(ar=gr-it-(At-Gt))&&(A[_t]+=ar,A[_t+1]+=ar))}},v=0;v<r.maps.length;v++)r.maps[v].forEach(g);for(var C=!1,y=0;y<A.length;y+=3)if(A[y+1]==-1){var w=r.map(t[y]+l),k=w-a;if(k<0||k>=o.content.size){C=!0;continue}var M=r.map(t[y+1]+l,-1),F=M-a,K=o.content.findIndex(k),J=K.index,U=K.offset,te=o.maybeChild(J);if(te&&U==k&&U+te.nodeSize==F){var P=A[y+2].mapInner(r,te,w+1,t[y]+l+1,d);P!=hn?(A[y]=k,A[y+1]=F,A[y+2]=P):(A[y+1]=-2,C=!0)}else C=!0}if(C){var he=cb(A,t,e||[],r,a,l,d),ne=Vd(he,o,0,d);e=ne.local;for(var me=0;me<A.length;me+=3)A[me+1]<0&&(A.splice(me,3),me-=3);for(var Pe=0,Me=0;Pe<ne.children.length;Pe+=3){for(var be=ne.children[Pe];Me<A.length&&A[Me]<be;)Me+=3;A.splice(Me,0,ne.children[Pe],ne.children[Pe+1],ne.children[Pe+2])}}return new Ut(e&&e.sort(va),A)}function oy(t,e){if(!e||!t.length)return t;for(var r=[],o=0;o<t.length;o++){var a=t[o];r.push(new Pr(a.from+e,a.to+e,a.type))}return r}function cb(t,e,r,o,a,l,d){function A(v,C){for(var y=0;y<v.local.length;y++){var w=v.local[y].map(o,a,C);w?r.push(w):d.onRemove&&d.onRemove(v.local[y].spec)}for(var k=0;k<v.children.length;k+=3)A(v.children[k+2],v.children[k]+C+1)}for(var g=0;g<t.length;g+=3)t[g+1]==-1&&A(t[g+2],e[g]+l+1);return r}function sy(t,e,r){if(e.isLeaf)return null;for(var o=r+e.nodeSize,a=null,l=0,d=void 0;l<t.length;l++)(d=t[l])&&d.from>r&&d.to<o&&((a||(a=[])).push(d),t[l]=null);return a}function ay(t){for(var e=[],r=0;r<t.length;r++)t[r]!=null&&e.push(t[r]);return e}function Vd(t,e,r,o){var a=[],l=!1;e.forEach(function(g,v){var C=sy(t,g,v+r);if(C){l=!0;var y=Vd(C,g,r+v+1,o);y!=hn&&a.push(v,v+g.nodeSize,y)}});for(var d=oy(l?ay(t):t,-r).sort(va),A=0;A<d.length;A++)d[A].type.valid(e,d[A])||(o.onRemove&&o.onRemove(d[A].spec),d.splice(A--,1));return d.length||a.length?new Ut(d,a):hn}function va(t,e){return t.from-e.from||t.to-e.to}function Bf(t){for(var e=t,r=0;r<e.length-1;r++){var o=e[r];if(o.from!=o.to)for(var a=r+1;a<e.length;a++){var l=e[a];if(l.from==o.from){l.to!=o.to&&(e==t&&(e=t.slice()),e[a]=l.copy(l.from,o.to),cy(e,a+1,l.copy(o.to,l.to)));continue}else{l.from<o.to&&(e==t&&(e=t.slice()),e[r]=o.copy(o.from,l.from),cy(e,a,o.copy(l.from,o.to)));break}}}return e}function cy(t,e,r){for(;e<t.length&&va(r,t[e])>0;)e++;t.splice(e,0,r)}function Lf(t){var e=[];return t.someProp("decorations",function(r){var o=r(t.state);o&&o!=hn&&e.push(o)}),t.cursorWrapper&&e.push(Ut.create(t.state.doc,[t.cursorWrapper.deco])),ji.from(e)}var jr=function(e,r){this._props=r,this.state=r.state,this.directPlugins=r.plugins||[],this.directPlugins.forEach(py),this.dispatch=this.dispatch.bind(this),this._root=null,this.focused=!1,this.trackWrites=null,this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):e.apply?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=dy(this),this.markCursor=null,this.cursorWrapper=null,uy(this),this.nodeViews=hy(this),this.docView=_0(this.state.doc,ly(this),Lf(this),this.dom,this),this.lastSelectedViewDesc=null,this.dragging=null,Hk(this),this.prevDirectPlugins=[],this.pluginViews=[],this.updatePluginViews()},Mf={props:{configurable:!0},root:{configurable:!0}};Mf.props.get=function(){if(this._props.state!=this.state){var t=this._props;this._props={};for(var e in t)this._props[e]=t[e];this._props.state=this.state}return this._props};jr.prototype.update=function(e){e.handleDOMEvents!=this._props.handleDOMEvents&&wf(this),this._props=e,e.plugins&&(e.plugins.forEach(py),this.directPlugins=e.plugins),this.updateStateInner(e.state,!0)};jr.prototype.setProps=function(e){var r={};for(var o in this._props)r[o]=this._props[o];r.state=this.state;for(var a in e)r[a]=e[a];this.update(r)};jr.prototype.updateState=function(e){this.updateStateInner(e,this.state.plugins!=e.plugins)};jr.prototype.updateStateInner=function(e,r){var o=this,a=this.state,l=!1,d=!1;if(e.storedMarks&&this.composing&&(ry(this),d=!0),this.state=e,r){var A=hy(this);ub(A,this.nodeViews)&&(this.nodeViews=A,l=!0),wf(this)}this.editable=dy(this),uy(this);var g=Lf(this),v=ly(this),C=r?"reset":e.scrollToSelection>a.scrollToSelection?"to selection":"preserve",y=l||!this.docView.matchesNode(e.doc,v,g);(y||!e.selection.eq(a.selection))&&(d=!0);var w=C=="preserve"&&d&&this.dom.style.overflowAnchor==null&&nk(this);if(d){this.domObserver.stop();var k=y&&(ce.ie||ce.chrome)&&!this.composing&&!a.selection.empty&&!e.selection.empty&&lb(a.selection,e.selection);if(y){var M=ce.chrome?this.trackWrites=this.root.getSelection().focusNode:null;(l||!this.docView.update(e.doc,v,g,this))&&(this.docView.updateOuterDeco([]),this.docView.destroy(),this.docView=_0(e.doc,v,g,this.dom,this)),M&&!this.trackWrites&&(k=!0)}k||!(this.mouseDown&&this.domObserver.currentSelection.eq(this.root.getSelection())&&Nk(this))?ws(this,k):(M0(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}if(this.updatePluginViews(a),C=="reset")this.dom.scrollTop=0;else if(C=="to selection"){var F=this.root.getSelection().focusNode;this.someProp("handleScrollToSelection",function(K){return K(o)})||(e.selection instanceof et?d0(this,this.docView.domAfterPos(e.selection.from).getBoundingClientRect(),F):d0(this,this.coordsAtPos(e.selection.head,1),F))}else w&&ik(w)};jr.prototype.destroyPluginViews=function(){for(var e;e=this.pluginViews.pop();)e.destroy&&e.destroy()};jr.prototype.updatePluginViews=function(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(var r=0;r<this.directPlugins.length;r++){var o=this.directPlugins[r];o.spec.view&&this.pluginViews.push(o.spec.view(this))}for(var a=0;a<this.state.plugins.length;a++){var l=this.state.plugins[a];l.spec.view&&this.pluginViews.push(l.spec.view(this))}}else for(var d=0;d<this.pluginViews.length;d++){var A=this.pluginViews[d];A.update&&A.update(this,e)}};jr.prototype.someProp=function(e,r){var o=this._props&&this._props[e],a;if(o!=null&&(a=r?r(o):o))return a;for(var l=0;l<this.directPlugins.length;l++){var d=this.directPlugins[l].props[e];if(d!=null&&(a=r?r(d):d))return a}var A=this.state.plugins;if(A)for(var g=0;g<A.length;g++){var v=A[g].props[e];if(v!=null&&(a=r?r(v):v))return a}};jr.prototype.hasFocus=function(){return this.root.activeElement==this.dom};jr.prototype.focus=function(){this.domObserver.stop(),this.editable&&ok(this.dom),ws(this),this.domObserver.start()};Mf.root.get=function(){var t=this._root;if(t==null){for(var e=this.dom.parentNode;e;e=e.parentNode)if(e.nodeType==9||e.nodeType==11&&e.host)return e.getSelection||(Object.getPrototypeOf(e).getSelection=function(){return document.getSelection()}),this._root=e}return t||document};jr.prototype.posAtCoords=function(e){return uk(this,e)};jr.prototype.coordsAtPos=function(e,r){return r===void 0&&(r=1),g0(this,e,r)};jr.prototype.domAtPos=function(e,r){return r===void 0&&(r=0),this.docView.domFromPos(e,r)};jr.prototype.nodeDOM=function(e){var r=this.docView.descAt(e);return r?r.nodeDOM:null};jr.prototype.posAtDOM=function(e,r,o){o===void 0&&(o=-1);var a=this.docView.posFromDOM(e,r,o);if(a==null)throw new RangeError("DOM position not inside the editor");return a};jr.prototype.endOfTextblock=function(e,r){return fk(this,r||this.state,e)};jr.prototype.destroy=function(){!this.docView||(Kk(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],Lf(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null)};jr.prototype.dispatchEvent=function(e){return Yk(this,e)};jr.prototype.dispatch=function(e){var r=this._props.dispatchTransaction;r?r.call(this,e):this.updateState(this.state.apply(e))};Object.defineProperties(jr.prototype,Mf);function ly(t){var e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),e.translate="no",t.someProp("attributes",function(r){if(typeof r=="function"&&(r=r(t.state)),r)for(var o in r)o=="class"&&(e.class+=" "+r[o]),o=="style"?e.style=(e.style?e.style+";":"")+r[o]:!e[o]&&o!="contenteditable"&&o!="nodeName"&&(e[o]=String(r[o]))}),[Pr.node(0,t.state.doc.content.size,e)]}function uy(t){if(t.markCursor){var e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),t.cursorWrapper={dom:e,deco:Pr.widget(t.state.selection.head,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function dy(t){return!t.someProp("editable",function(e){return e(t.state)===!1})}function lb(t,e){var r=Math.min(t.$anchor.sharedDepth(t.head),e.$anchor.sharedDepth(e.head));return t.$anchor.start(r)!=e.$anchor.start(r)}function hy(t){var e={};return t.someProp("nodeViews",function(r){for(var o in r)Object.prototype.hasOwnProperty.call(e,o)||(e[o]=r[o])}),e}function ub(t,e){var r=0,o=0;for(var a in t){if(t[a]!=e[a])return!0;r++}for(var l in e)o++;return r!=o}function py(t){if(t.spec.state||t.spec.filterTransaction||t.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var Ns={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",229:"q"},Gd={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"',229:"Q"},Ay=typeof navigator!="undefined"&&/Chrome\/(\d+)/.exec(navigator.userAgent),db=typeof navigator!="undefined"&&/Apple Computer/.test(navigator.vendor),hb=typeof navigator!="undefined"&&/Gecko\/\d+/.test(navigator.userAgent),fy=typeof navigator!="undefined"&&/Mac/.test(navigator.platform),pb=typeof navigator!="undefined"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),Ab=Ay&&(fy||+Ay[1]<57)||hb&&fy;for(var pn=0;pn<10;pn++)Ns[48+pn]=Ns[96+pn]=String(pn);for(var pn=1;pn<=24;pn++)Ns[pn+111]="F"+pn;for(var pn=65;pn<=90;pn++)Ns[pn]=String.fromCharCode(pn+32),Gd[pn]=String.fromCharCode(pn);for(var Pf in Ns)Gd.hasOwnProperty(Pf)||(Gd[Pf]=Ns[Pf]);function fb(t){var e=Ab&&(t.ctrlKey||t.altKey||t.metaKey)||(db||pb)&&t.shiftKey&&t.key&&t.key.length==1,r=!e&&t.key||(t.shiftKey?Gd:Ns)[t.keyCode]||t.key||"Unidentified";return r=="Esc"&&(r="Escape"),r=="Del"&&(r="Delete"),r=="Left"&&(r="ArrowLeft"),r=="Up"&&(r="ArrowUp"),r=="Right"&&(r="ArrowRight"),r=="Down"&&(r="ArrowDown"),r}var gb=typeof navigator!="undefined"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!1;function mb(t){var e=t.split(/-(?!$)/),r=e[e.length-1];r=="Space"&&(r=" ");for(var o,a,l,d,A=0;A<e.length-1;A++){var g=e[A];if(/^(cmd|meta|m)$/i.test(g))d=!0;else if(/^a(lt)?$/i.test(g))o=!0;else if(/^(c|ctrl|control)$/i.test(g))a=!0;else if(/^s(hift)?$/i.test(g))l=!0;else if(/^mod$/i.test(g))gb?d=!0:a=!0;else throw new Error("Unrecognized modifier name: "+g)}return o&&(r="Alt-"+r),a&&(r="Ctrl-"+r),d&&(r="Meta-"+r),l&&(r="Shift-"+r),r}function vb(t){var e=Object.create(null);for(var r in t)e[mb(r)]=t[r];return e}function Qf(t,e,r){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),r!==!1&&e.shiftKey&&(t="Shift-"+t),t}function Eb(t){var e=vb(t);return function(r,o){var a=fb(o),l=a.length==1&&a!=" ",d,A=e[Qf(a,o,!l)];if(A&&A(r.state,r.dispatch,r))return!0;if(l&&(o.shiftKey||o.altKey||o.metaKey||a.charCodeAt(0)>127)&&(d=Ns[o.keyCode])&&d!=a){var g=e[Qf(d,o,!0)];if(g&&g(r.state,r.dispatch,r))return!0}else if(l&&o.shiftKey){var v=e[Qf(a,o,!0)];if(v&&v(r.state,r.dispatch,r))return!0}return!1}}function Ib(t){return Object.prototype.toString.call(t).slice(8,-1)}function xf(t){return Ib(t)!=="Object"?!1:t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function jd(t,e){const r=fe({},t);return xf(t)&&xf(e)&&Object.keys(e).forEach(o=>{xf(e[o])?o in t?r[o]=jd(t[o],e[o]):Object.assign(r,{[o]:e[o]}):Object.assign(r,{[o]:e[o]})}),r}function Cb(t){return typeof t=="function"}function Er(t,e=void 0,...r){return Cb(t)?e?t.bind(e)(...r):t(...r):t}function Hr(t,e,r){return t.config[e]===void 0&&t.parent?Hr(t.parent,e,r):typeof t.config[e]=="function"?t.config[e].bind(hc(fe({},r),{parent:t.parent?Hr(t.parent,e,r):null})):t.config[e]}class tn{constructor(e={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config=fe(fe({},this.config),e),this.name=this.config.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=Er(Hr(this,"addOptions",{name:this.name}))),this.storage=Er(Hr(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new tn(e)}configure(e={}){const r=this.extend();return r.options=jd(this.options,e),r.storage=Er(Hr(r,"addStorage",{name:r.name,options:r.options})),r}extend(e={}){const r=new tn(e);return r.parent=this,this.child=r,r.name=e.name?e.name:r.parent.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${r.name}".`),r.options=e.defaultOptions?e.defaultOptions:r.parent.options,e.addOptions&&(r.options=Er(Hr(r,"addOptions",{name:r.name}))),r.storage=Er(Hr(r,"addStorage",{name:r.name,options:r.options})),r}}function yb(t,e,r){const{from:o,to:a}=e,{blockSeparator:l=`

`,textSerializers:d={}}=r||{};let A="",g=!0;return t.nodesBetween(o,a,(v,C,y,w)=>{var k;const M=d==null?void 0:d[v.type.name];M?(v.isBlock&&!g&&(A+=l,g=!0),A+=M({node:v,pos:C,parent:y,index:w})):v.isText?(A+=(k=v==null?void 0:v.text)===null||k===void 0?void 0:k.slice(Math.max(o,C)-C,a-C),g=!1):v.isBlock&&!g&&(A+=l,g=!0)}),A}function _b(t){return Object.fromEntries(Object.entries(t.nodes).filter(([,e])=>e.spec.toText).map(([e,r])=>[e,r.spec.toText]))}tn.create({name:"clipboardTextSerializer",addProseMirrorPlugins(){return[new ni({key:new ii("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:t}=this,{state:e,schema:r}=t,{doc:o,selection:a}=e,{from:l,to:d}=a,A=_b(r);return yb(o,{from:l,to:d},{textSerializers:A})}}})]}});const Sb=()=>({editor:t,view:e})=>(requestAnimationFrame(()=>{t.isDestroyed||e.dom.blur()}),!0);var Tb=Object.freeze({__proto__:null,blur:Sb});const Rb=(t=!1)=>({commands:e})=>e.setContent("",t);var wb=Object.freeze({__proto__:null,clearContent:Rb});const Nb=()=>({state:t,tr:e,dispatch:r})=>{const{selection:o}=e,{ranges:a}=o;return a.forEach(l=>{t.doc.nodesBetween(l.$from.pos,l.$to.pos,(d,A)=>{if(d.type.isText)return;const g=e.doc.resolve(e.mapping.map(A)),v=e.doc.resolve(e.mapping.map(A+d.nodeSize)),C=g.blockRange(v);if(!C)return;const y=Ic(C);if(d.type.isTextblock&&r){const{defaultType:w}=g.parent.contentMatchAt(g.index());e.setNodeMarkup(C.start,w)}(y||y===0)&&r&&e.lift(C,y)})}),!0};var Ob=Object.freeze({__proto__:null,clearNodes:Nb});const kb=t=>e=>t(e);var bb=Object.freeze({__proto__:null,command:kb});const Db=()=>({state:t,dispatch:e})=>r0(t,e);var Bb=Object.freeze({__proto__:null,createParagraphNear:Db});function On(t,e){if(typeof t=="string"){if(!e.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return e.nodes[t]}return t}const Lb=t=>({tr:e,state:r,dispatch:o})=>{const a=On(t,r.schema),l=e.selection.$anchor;for(let d=l.depth;d>0;d-=1)if(l.node(d).type===a){if(o){const g=l.before(d),v=l.after(d);e.delete(g,v).scrollIntoView()}return!0}return!1};var Mb=Object.freeze({__proto__:null,deleteNode:Lb});const Pb=t=>({tr:e,dispatch:r})=>{const{from:o,to:a}=t;return r&&e.delete(o,a),!0};var Qb=Object.freeze({__proto__:null,deleteRange:Pb});const xb=()=>({state:t,dispatch:e})=>ZA(t,e);var Ub=Object.freeze({__proto__:null,deleteSelection:xb});const Fb=()=>({commands:t})=>t.keyboardShortcut("Enter");var Vb=Object.freeze({__proto__:null,enter:Fb});const Gb=()=>({state:t,dispatch:e})=>t0(t,e);var jb=Object.freeze({__proto__:null,exitCode:Gb});function Os(t,e){if(typeof t=="string"){if(!e.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return e.marks[t]}return t}function Hb(t){return Object.prototype.toString.call(t)==="[object RegExp]"}function Hd(t,e,r={strict:!0}){const o=Object.keys(e);return o.length?o.every(a=>r.strict?e[a]===t[a]:Hb(e[a])?e[a].test(t[a]):e[a]===t[a]):!0}function Uf(t,e,r={}){return t.find(o=>o.type===e&&Hd(o.attrs,r))}function Kb(t,e,r={}){return!!Uf(t,e,r)}function gy(t,e,r={}){if(!t||!e)return;const o=t.parent.childAfter(t.parentOffset);if(!o.node)return;const a=Uf(o.node.marks,e,r);if(!a)return;let l=t.index(),d=t.start()+o.offset,A=l+1,g=d+o.node.nodeSize;for(Uf(o.node.marks,e,r);l>0&&a.isInSet(t.parent.child(l-1).marks);)l-=1,d-=t.parent.child(l).nodeSize;for(;A<t.parent.childCount&&Kb(t.parent.child(A).marks,e,r);)g+=t.parent.child(A).nodeSize,A+=1;return{from:d,to:g}}const Wb=(t,e={})=>({tr:r,state:o,dispatch:a})=>{const l=Os(t,o.schema),{doc:d,selection:A}=r,{$from:g,from:v,to:C}=A;if(a){const y=gy(g,l,e);if(y&&y.from<=v&&y.to>=C){const w=Ot.create(d,y.from,y.to);r.setSelection(w)}}return!0};var Yb=Object.freeze({__proto__:null,extendMarkRange:Wb});const qb=t=>e=>{const r=typeof t=="function"?t(e):t;for(let o=0;o<r.length;o+=1)if(r[o](e))return!0;return!1};var Jb=Object.freeze({__proto__:null,first:qb});function Ea(t=0,e=0,r=0){return Math.min(Math.max(t,e),r)}function zb(t){var e;return((e=t.constructor)===null||e===void 0?void 0:e.toString().substring(0,5))==="class"}function my(t){return t&&typeof t=="object"&&!Array.isArray(t)&&!zb(t)}function vy(t){return my(t)&&t instanceof Ot}function Xb(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}function $b(t,e=null){if(!e)return null;if(e==="start"||e===!0)return{from:0,to:0};if(e==="end"){const{size:r}=t.doc.content;return{from:r,to:r}}return{from:e,to:e}}const Zb=(t=null)=>({editor:e,view:r,tr:o,dispatch:a})=>{const l=()=>{Xb()&&r.dom.focus(),requestAnimationFrame(()=>{e.isDestroyed||(r.focus(),e.commands.scrollIntoView())})};if(r.hasFocus()&&t===null||t===!1)return!0;if(a&&t===null&&!vy(e.state.selection))return l(),!0;const{from:d,to:A}=$b(e.state,t)||e.state.selection,{doc:g,storedMarks:v}=o,C=nt.atStart(g).from,y=nt.atEnd(g).to,w=Ea(d,C,y),k=Ea(A,C,y),M=Ot.create(g,w,k),F=e.state.selection.eq(M);return a&&(F||o.setSelection(M),F&&v&&o.setStoredMarks(v),l()),!0};var eD=Object.freeze({__proto__:null,focus:Zb});const tD=(t,e)=>r=>t.every((o,a)=>e(o,hc(fe({},r),{index:a})));var rD=Object.freeze({__proto__:null,forEach:tD});const nD=(t,e)=>({tr:r,commands:o})=>o.insertContentAt({from:r.selection.from,to:r.selection.to},t,e);var iD=Object.freeze({__proto__:null,insertContent:nD});function Ey(t){const e=`<body>${t}</body>`;return new window.DOMParser().parseFromString(e,"text/html").body}function Kd(t,e,r){if(r=fe({slice:!0,parseOptions:{}},r),typeof t=="object"&&t!==null)try{return Array.isArray(t)?ee.fromArray(t.map(o=>e.nodeFromJSON(o))):e.nodeFromJSON(t)}catch(o){return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",o),Kd("",e,r)}if(typeof t=="string"){const o=ao.fromSchema(e);return r.slice?o.parseSlice(Ey(t),r.parseOptions).content:o.parse(Ey(t),r.parseOptions)}return Kd("",e,r)}function oD(t,e,r){const o=t.steps.length-1;if(o<e)return;const a=t.steps[o];if(!(a instanceof ts||a instanceof ri))return;const l=t.mapping.maps[o];let d=0;l.forEach((A,g,v,C)=>{d===0&&(d=C)}),t.setSelection(nt.near(t.doc.resolve(d),r))}const sD=(t,e,r)=>({tr:o,dispatch:a,editor:l})=>{if(a){r=fe({parseOptions:{},updateSelection:!0},r);const d=Kd(e,l.schema,{parseOptions:fe({preserveWhitespace:"full"},r.parseOptions)});if(d.toString()==="<>")return!0;const{from:A,to:g}=typeof t=="number"?{from:t,to:t}:t;o.replaceWith(A,g,d),r.updateSelection&&oD(o,o.steps.length-1,1)}return!0};var aD=Object.freeze({__proto__:null,insertContentAt:sD});const cD=()=>({state:t,dispatch:e})=>YC(t,e);var lD=Object.freeze({__proto__:null,joinBackward:cD});const uD=()=>({state:t,dispatch:e})=>zC(t,e);var dD=Object.freeze({__proto__:null,joinForward:uD});const hD=typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1;function pD(t){const e=t.split(/-(?!$)/);let r=e[e.length-1];r==="Space"&&(r=" ");let o,a,l,d;for(let A=0;A<e.length-1;A+=1){const g=e[A];if(/^(cmd|meta|m)$/i.test(g))d=!0;else if(/^a(lt)?$/i.test(g))o=!0;else if(/^(c|ctrl|control)$/i.test(g))a=!0;else if(/^s(hift)?$/i.test(g))l=!0;else if(/^mod$/i.test(g))hD?d=!0:a=!0;else throw new Error(`Unrecognized modifier name: ${g}`)}return o&&(r=`Alt-${r}`),a&&(r=`Ctrl-${r}`),d&&(r=`Meta-${r}`),l&&(r=`Shift-${r}`),r}const AD=t=>({editor:e,view:r,tr:o,dispatch:a})=>{const l=pD(t).split(/-(?!$)/),d=l.find(v=>!["Alt","Ctrl","Meta","Shift"].includes(v)),A=new KeyboardEvent("keydown",{key:d==="Space"?" ":d,altKey:l.includes("Alt"),ctrlKey:l.includes("Ctrl"),metaKey:l.includes("Meta"),shiftKey:l.includes("Shift"),bubbles:!0,cancelable:!0}),g=e.captureTransaction(()=>{r.someProp("handleKeyDown",v=>v(r,A))});return g==null||g.steps.forEach(v=>{const C=v.map(o.mapping);C&&a&&o.maybeStep(C)}),!0};var fD=Object.freeze({__proto__:null,keyboardShortcut:AD});function Wd(t,e,r={}){const{from:o,to:a,empty:l}=t.selection,d=e?On(e,t.schema):null,A=[];t.doc.nodesBetween(o,a,(y,w)=>{if(y.isText)return;const k=Math.max(o,w),M=Math.min(a,w+y.nodeSize);A.push({node:y,from:k,to:M})});const g=a-o,v=A.filter(y=>d?d.name===y.node.type.name:!0).filter(y=>Hd(y.node.attrs,r,{strict:!1}));return l?!!v.length:v.reduce((y,w)=>y+w.to-w.from,0)>=g}const gD=(t,e={})=>({state:r,dispatch:o})=>{const a=On(t,r.schema);return Wd(r,a,e)?ZC(r,o):!1};var mD=Object.freeze({__proto__:null,lift:gD});const vD=()=>({state:t,dispatch:e})=>n0(t,e);var ED=Object.freeze({__proto__:null,liftEmptyBlock:vD});const ID=t=>({state:e,dispatch:r})=>{const o=On(t,e.schema);return qO(o)(e,r)};var CD=Object.freeze({__proto__:null,liftListItem:ID});const yD=()=>({state:t,dispatch:e})=>e0(t,e);var _D=Object.freeze({__proto__:null,newlineInCode:yD});function Iy(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function Cy(t,e){const r=typeof e=="string"?[e]:e;return Object.keys(t).reduce((o,a)=>(r.includes(a)||(o[a]=t[a]),o),{})}const SD=(t,e)=>({tr:r,state:o,dispatch:a})=>{let l=null,d=null;const A=Iy(typeof t=="string"?t:t.name,o.schema);return A?(A==="node"&&(l=On(t,o.schema)),A==="mark"&&(d=Os(t,o.schema)),a&&r.selection.ranges.forEach(g=>{o.doc.nodesBetween(g.$from.pos,g.$to.pos,(v,C)=>{l&&l===v.type&&r.setNodeMarkup(C,void 0,Cy(v.attrs,e)),d&&v.marks.length&&v.marks.forEach(y=>{d===y.type&&r.addMark(C,C+v.nodeSize,d.create(Cy(y.attrs,e)))})})}),!0):!1};var TD=Object.freeze({__proto__:null,resetAttributes:SD});const RD=()=>({tr:t,dispatch:e})=>(e&&t.scrollIntoView(),!0);var wD=Object.freeze({__proto__:null,scrollIntoView:RD});const ND=()=>({tr:t,commands:e})=>e.setTextSelection({from:0,to:t.doc.content.size});var OD=Object.freeze({__proto__:null,selectAll:ND});const kD=()=>({state:t,dispatch:e})=>qC(t,e);var bD=Object.freeze({__proto__:null,selectNodeBackward:kD});const DD=()=>({state:t,dispatch:e})=>XC(t,e);var BD=Object.freeze({__proto__:null,selectNodeForward:DD});const LD=()=>({state:t,dispatch:e})=>VO(t,e);var MD=Object.freeze({__proto__:null,selectParentNode:LD});function PD(t,e,r={}){return Kd(t,e,{slice:!1,parseOptions:r})}const QD=(t,e=!1,r={})=>({tr:o,editor:a,dispatch:l})=>{const{doc:d}=o,A=PD(t,a.schema,r),g=Ot.create(d,0,d.content.size);return l&&o.setSelection(g).replaceSelectionWith(A,!1).setMeta("preventUpdate",!e),!0};var xD=Object.freeze({__proto__:null,setContent:QD});function UD(t,e){const r=Os(e,t.schema),{from:o,to:a,empty:l}=t.selection,d=[];l?(t.storedMarks&&d.push(...t.storedMarks),d.push(...t.selection.$head.marks())):t.doc.nodesBetween(o,a,g=>{d.push(...g.marks)});const A=d.find(g=>g.type.name===r.name);return A?fe({},A.attrs):{}}const FD=(t,e={})=>({tr:r,state:o,dispatch:a})=>{const{selection:l}=r,{empty:d,ranges:A}=l,g=Os(t,o.schema);if(a)if(d){const v=UD(o,g);r.addStoredMark(g.create(fe(fe({},v),e)))}else A.forEach(v=>{const C=v.$from.pos,y=v.$to.pos;o.doc.nodesBetween(C,y,(w,k)=>{const M=Math.max(k,C),F=Math.min(k+w.nodeSize,y);w.marks.find(J=>J.type===g)?w.marks.forEach(J=>{g===J.type&&r.addMark(M,F,g.create(fe(fe({},J.attrs),e)))}):r.addMark(M,F,g.create(e))})});return!0};var VD=Object.freeze({__proto__:null,setMark:FD});const GD=(t,e)=>({tr:r})=>(r.setMeta(t,e),!0);var jD=Object.freeze({__proto__:null,setMeta:GD});const HD=(t,e={})=>({state:r,dispatch:o})=>{const a=On(t,r.schema);return HO(a,e)(r,o)};var KD=Object.freeze({__proto__:null,setNode:HD});const WD=t=>({tr:e,dispatch:r})=>{if(r){const{doc:o}=e,a=nt.atStart(o).from,l=nt.atEnd(o).to,d=Ea(t,a,l),A=et.create(o,d);e.setSelection(A)}return!0};var YD=Object.freeze({__proto__:null,setNodeSelection:WD});const qD=t=>({tr:e,dispatch:r})=>{if(r){const{doc:o}=e,{from:a,to:l}=typeof t=="number"?{from:t,to:t}:t,d=nt.atStart(o).from,A=nt.atEnd(o).to,g=Ea(a,d,A),v=Ea(l,d,A),C=Ot.create(o,g,v);e.setSelection(C)}return!0};var JD=Object.freeze({__proto__:null,setTextSelection:qD});const zD=t=>({state:e,dispatch:r})=>{const o=On(t,e.schema);return XO(o)(e,r)};var XD=Object.freeze({__proto__:null,sinkListItem:zD});function Yd(t,e,r){return Object.fromEntries(Object.entries(r).filter(([o])=>{const a=t.find(l=>l.type===e&&l.name===o);return a?a.attribute.keepOnSplit:!1}))}function $D(t){for(let e=0;e<t.edgeCount;e+=1){const{type:r}=t.edge(e);if(r.isTextblock&&!r.hasRequiredAttrs())return r}return null}function yy(t,e){const r=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(r){const o=r.filter(a=>e==null?void 0:e.includes(a.type.name));t.tr.ensureMarks(o)}}const ZD=({keepMarks:t=!0}={})=>({tr:e,state:r,dispatch:o,editor:a})=>{const{selection:l,doc:d}=e,{$from:A,$to:g}=l,v=a.extensionManager.attributes,C=Yd(v,A.node().type.name,A.node().attrs);if(l instanceof et&&l.node.isBlock)return!A.parentOffset||!rs(d,A.pos)?!1:(o&&(t&&yy(r,a.extensionManager.splittableMarks),e.split(A.pos).scrollIntoView()),!0);if(!A.parent.isBlock)return!1;if(o){const y=g.parentOffset===g.parent.content.size;l instanceof Ot&&e.deleteSelection();const w=A.depth===0?void 0:$D(A.node(-1).contentMatchAt(A.indexAfter(-1)));let k=y&&w?[{type:w,attrs:C}]:void 0,M=rs(e.doc,e.mapping.map(A.pos),1,k);if(!k&&!M&&rs(e.doc,e.mapping.map(A.pos),1,w?[{type:w}]:void 0)&&(M=!0,k=w?[{type:w,attrs:C}]:void 0),M&&(e.split(e.mapping.map(A.pos),1,k),w&&!y&&!A.parentOffset&&A.parent.type!==w)){const F=e.mapping.map(A.before()),K=e.doc.resolve(F);A.node(-1).canReplaceWith(K.index(),K.index()+1,w)&&e.setNodeMarkup(e.mapping.map(A.before()),w)}t&&yy(r,a.extensionManager.splittableMarks),e.scrollIntoView()}return!0};var eB=Object.freeze({__proto__:null,splitBlock:ZD});const tB=t=>({tr:e,state:r,dispatch:o,editor:a})=>{var l;const d=On(t,r.schema),{$from:A,$to:g}=r.selection,v=r.selection.node;if(v&&v.isBlock||A.depth<2||!A.sameParent(g))return!1;const C=A.node(-1);if(C.type!==d)return!1;const y=a.extensionManager.attributes;if(A.parent.content.size===0&&A.node(-1).childCount===A.indexAfter(-1)){if(A.depth===2||A.node(-3).type!==d||A.index(-2)!==A.node(-2).childCount-1)return!1;if(o){let K=ee.empty;const J=A.index(-1)?1:A.index(-2)?2:3;for(let me=A.depth-J;me>=A.depth-3;me-=1)K=ee.from(A.node(me).copy(K));const U=A.indexAfter(-1)<A.node(-2).childCount?1:A.indexAfter(-2)<A.node(-3).childCount?2:3,te=Yd(y,A.node().type.name,A.node().attrs),P=((l=d.contentMatch.defaultType)===null||l===void 0?void 0:l.createAndFill(te))||void 0;K=K.append(ee.from(d.createAndFill(null,P)||void 0));const he=A.before(A.depth-(J-1));e.replace(he,A.after(-U),new ye(K,4-J,0));let ne=-1;e.doc.nodesBetween(he,e.doc.content.size,(me,Pe)=>{if(ne>-1)return!1;me.isTextblock&&me.content.size===0&&(ne=Pe+1)}),ne>-1&&e.setSelection(Ot.near(e.doc.resolve(ne))),e.scrollIntoView()}return!0}const w=g.pos===A.end()?C.contentMatchAt(0).defaultType:null,k=Yd(y,C.type.name,C.attrs),M=Yd(y,A.node().type.name,A.node().attrs);e.delete(A.pos,g.pos);const F=w?[{type:d,attrs:k},{type:w,attrs:M}]:[{type:d,attrs:k}];return rs(e.doc,A.pos,2)?(o&&e.split(A.pos,2,F).scrollIntoView(),!0):!1};var rB=Object.freeze({__proto__:null,splitListItem:tB});function nB(t,e){for(let r=t.depth;r>0;r-=1){const o=t.node(r);if(e(o))return{pos:r>0?t.before(r):0,start:t.start(r),depth:r,node:o}}}function iB(t){return e=>nB(e.$from,t)}function oB(t){const e=t.filter(a=>a.type==="extension"),r=t.filter(a=>a.type==="node"),o=t.filter(a=>a.type==="mark");return{baseExtensions:e,nodeExtensions:r,markExtensions:o}}function _y(t,e){const{nodeExtensions:r}=oB(e),o=r.find(d=>d.name===t);if(!o)return!1;const a={name:o.name,options:o.options,storage:o.storage},l=Er(Hr(o,"group",a));return typeof l!="string"?!1:l.split(" ").includes("list")}const sB=(t,e)=>({editor:r,tr:o,state:a,dispatch:l,chain:d,commands:A,can:g})=>{const{extensions:v}=r.extensionManager,C=On(t,a.schema),y=On(e,a.schema),{selection:w}=a,{$from:k,$to:M}=w,F=k.blockRange(M);if(!F)return!1;const K=iB(U=>_y(U.type.name,v))(w);if(F.depth>=1&&K&&F.depth-K.depth<=1){if(K.node.type===C)return A.liftListItem(y);if(_y(K.node.type.name,v)&&C.validContent(K.node.content)&&l)return o.setNodeMarkup(K.pos,C),!0}return g().wrapInList(C)?A.wrapInList(C):d().clearNodes().wrapInList(C).run()};var aB=Object.freeze({__proto__:null,toggleList:sB});function cB(t,e,r={}){const{empty:o,ranges:a}=t.selection,l=e?Os(e,t.schema):null;if(o)return!!(t.storedMarks||t.selection.$from.marks()).filter(y=>l?l.name===y.type.name:!0).find(y=>Hd(y.attrs,r,{strict:!1}));let d=0;const A=[];if(a.forEach(({$from:y,$to:w})=>{const k=y.pos,M=w.pos;t.doc.nodesBetween(k,M,(F,K)=>{if(!F.isText&&!F.marks.length)return;const J=Math.max(k,K),U=Math.min(M,K+F.nodeSize);d+=U-J,A.push(...F.marks.map(P=>({mark:P,from:J,to:U})))})}),d===0)return!1;const g=A.filter(y=>l?l.name===y.mark.type.name:!0).filter(y=>Hd(y.mark.attrs,r,{strict:!1})).reduce((y,w)=>y+w.to-w.from,0),v=A.filter(y=>l?y.mark.type!==l&&y.mark.type.excludes(l):!0).reduce((y,w)=>y+w.to-w.from,0);return(g>0?g+v:g)>=d}const lB=(t,e={},r={})=>({state:o,commands:a})=>{const{extendEmptyMarkRange:l=!1}=r,d=Os(t,o.schema);return cB(o,d,e)?a.unsetMark(d,{extendEmptyMarkRange:l}):a.setMark(d,e)};var uB=Object.freeze({__proto__:null,toggleMark:lB});const dB=(t,e,r={})=>({state:o,commands:a})=>{const l=On(t,o.schema),d=On(e,o.schema);return Wd(o,l,r)?a.setNode(d):a.setNode(l,r)};var hB=Object.freeze({__proto__:null,toggleNode:dB});const pB=(t,e={})=>({state:r,dispatch:o})=>{const a=On(t,r.schema);return Wd(r,a,e)?ZC(r,o):o0(a,e)(r,o)};var AB=Object.freeze({__proto__:null,toggleWrap:pB});const fB=()=>({state:t,dispatch:e})=>{const r=t.plugins;for(let o=0;o<r.length;o+=1){const a=r[o];let l;if(a.spec.isInputRules&&(l=a.getState(t))){if(e){const d=t.tr,A=l.transform;for(let g=A.steps.length-1;g>=0;g-=1)d.step(A.steps[g].invert(A.docs[g]));if(l.text){const g=d.doc.resolve(l.from).marks();d.replaceWith(l.from,l.to,t.schema.text(l.text,g))}else d.delete(l.from,l.to)}return!0}}return!1};var gB=Object.freeze({__proto__:null,undoInputRule:fB});const mB=()=>({tr:t,state:e,dispatch:r})=>{const{selection:o}=t,{empty:a,ranges:l}=o;return a||r&&Object.entries(e.schema.marks).forEach(([,d])=>{l.forEach(A=>{t.removeMark(A.$from.pos,A.$to.pos,d)})}),!0};var vB=Object.freeze({__proto__:null,unsetAllMarks:mB});const EB=(t,e={})=>({tr:r,state:o,dispatch:a})=>{var l;const{extendEmptyMarkRange:d=!1}=e,{selection:A}=r,g=Os(t,o.schema),{$from:v,empty:C,ranges:y}=A;if(!a)return!0;if(C&&d){let{from:w,to:k}=A;const M=(l=v.marks().find(K=>K.type===g))===null||l===void 0?void 0:l.attrs,F=gy(v,g,M);F&&(w=F.from,k=F.to),r.removeMark(w,k,g)}else y.forEach(w=>{r.removeMark(w.$from.pos,w.$to.pos,g)});return r.removeStoredMark(g),!0};var IB=Object.freeze({__proto__:null,unsetMark:EB});const CB=(t,e={})=>({tr:r,state:o,dispatch:a})=>{let l=null,d=null;const A=Iy(typeof t=="string"?t:t.name,o.schema);return A?(A==="node"&&(l=On(t,o.schema)),A==="mark"&&(d=Os(t,o.schema)),a&&r.selection.ranges.forEach(g=>{const v=g.$from.pos,C=g.$to.pos;o.doc.nodesBetween(v,C,(y,w)=>{l&&l===y.type&&r.setNodeMarkup(w,void 0,fe(fe({},y.attrs),e)),d&&y.marks.length&&y.marks.forEach(k=>{if(d===k.type){const M=Math.max(w,v),F=Math.min(w+y.nodeSize,C);r.addMark(M,F,d.create(fe(fe({},k.attrs),e)))}})})}),!0):!1};var yB=Object.freeze({__proto__:null,updateAttributes:CB});const _B=(t,e={})=>({state:r,dispatch:o})=>{const a=On(t,r.schema);return Wd(r,a,e)?!1:o0(a,e)(r,o)};var SB=Object.freeze({__proto__:null,wrapIn:_B});const TB=(t,e={})=>({state:r,dispatch:o})=>{const a=On(t,r.schema);return WO(a,e)(r,o)};var RB=Object.freeze({__proto__:null,wrapInList:TB});tn.create({name:"commands",addCommands(){return fe(fe(fe(fe(fe(fe(fe(fe(fe(fe(fe(fe(fe(fe(fe(fe(fe(fe(fe(fe(fe(fe(fe(fe(fe(fe(fe(fe(fe(fe(fe(fe(fe(fe(fe(fe(fe(fe(fe(fe(fe(fe(fe(fe(fe(fe(fe(fe({},Tb),wb),Ob),bb),Bb),Mb),Qb),Ub),Vb),jb),Yb),Jb),eD),rD),iD),aD),lD),dD),fD),mD),ED),CD),_D),TD),wD),OD),bD),BD),MD),xD),VD),jD),KD),YD),JD),XD),eB),rB),aB),uB),hB),AB),gB),vB),IB),yB),SB),RB)}});tn.create({name:"editable",addProseMirrorPlugins(){return[new ni({key:new ii("editable"),props:{editable:()=>this.editor.options.editable}})]}});tn.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:t}=this;return[new ni({key:new ii("focusEvents"),props:{handleDOMEvents:{focus:(e,r)=>{t.isFocused=!0;const o=t.state.tr.setMeta("focus",{event:r}).setMeta("addToHistory",!1);return e.dispatch(o),!1},blur:(e,r)=>{t.isFocused=!1;const o=t.state.tr.setMeta("blur",{event:r}).setMeta("addToHistory",!1);return e.dispatch(o),!1}}}})]}});tn.create({name:"keymap",addKeyboardShortcuts(){const t=()=>this.editor.commands.first(({commands:r})=>[()=>r.undoInputRule(),()=>r.deleteSelection(),()=>r.joinBackward(),()=>r.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:r})=>[()=>r.deleteSelection(),()=>r.joinForward(),()=>r.selectNodeForward()]);return{Enter:()=>this.editor.commands.first(({commands:r})=>[()=>r.newlineInCode(),()=>r.createParagraphNear(),()=>r.liftEmptyBlock(),()=>r.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()}}});tn.create({name:"tabindex",addProseMirrorPlugins(){return[new ni({key:new ii("tabindex"),props:{attributes:{tabindex:"0"}}})]}});class qd{constructor(e){this.find=e.find,this.handler=e.handler}}class wB{constructor(e){this.find=e.find,this.handler=e.handler}}function kn(...t){return t.filter(e=>!!e).reduce((e,r)=>{const o=fe({},e);return Object.entries(r).forEach(([a,l])=>{if(!o[a]){o[a]=l;return}a==="class"?o[a]=[o[a],l].join(" "):a==="style"?o[a]=[o[a],l].join("; "):o[a]=l}),o},{})}class bn{constructor(e={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config=fe(fe({},this.config),e),this.name=this.config.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=Er(Hr(this,"addOptions",{name:this.name}))),this.storage=Er(Hr(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new bn(e)}configure(e={}){const r=this.extend();return r.options=jd(this.options,e),r.storage=Er(Hr(r,"addStorage",{name:r.name,options:r.options})),r}extend(e={}){const r=new bn(e);return r.parent=this,this.child=r,r.name=e.name?e.name:r.parent.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${r.name}".`),r.options=e.defaultOptions?e.defaultOptions:r.parent.options,e.addOptions&&(r.options=Er(Hr(r,"addOptions",{name:r.name}))),r.storage=Er(Hr(r,"addStorage",{name:r.name,options:r.options})),r}}class ks{constructor(e={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config=fe(fe({},this.config),e),this.name=this.config.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=Er(Hr(this,"addOptions",{name:this.name}))),this.storage=Er(Hr(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new ks(e)}configure(e={}){const r=this.extend();return r.options=jd(this.options,e),r.storage=Er(Hr(r,"addStorage",{name:r.name,options:r.options})),r}extend(e={}){const r=new ks(e);return r.parent=this,this.child=r,r.name=e.name?e.name:r.parent.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${r.name}".`),r.options=e.defaultOptions?e.defaultOptions:r.parent.options,e.addOptions&&(r.options=Er(Hr(r,"addOptions",{name:r.name}))),r.storage=Er(Hr(r,"addStorage",{name:r.name,options:r.options})),r}}function NB(t){return new qd({find:t.find,handler:({state:e,range:r,match:o})=>{const a=Er(t.getAttributes,void 0,o)||{},{tr:l}=e,d=r.from;let A=r.to;if(o[1]){const g=o[0].lastIndexOf(o[1]);let v=d+g;v>A?v=A:A=v+o[1].length;const C=o[0][o[0].length-1];l.insertText(C,d+o[0].length-1),l.replaceWith(v,A,t.type.create(a))}else o[0]&&l.replaceWith(d,A,t.type.create(a))}})}function Sy(t,e,r){const o=[];return r.doc.nodesBetween(t,e,(a,l)=>{o.push(...a.marks.map(d=>({from:l,to:l+a.nodeSize,mark:d})))}),o}function Ia(t){return new qd({find:t.find,handler:({state:e,range:r,match:o})=>{const a=Er(t.getAttributes,void 0,o);if(a===!1||a===null)return;const{tr:l}=e,d=o[o.length-1],A=o[0];let g=r.to;if(d){const v=A.search(/\S/),C=r.from+A.indexOf(d),y=C+d.length;if(Sy(r.from,r.to,e).filter(k=>k.mark.type.excluded.find(F=>F===t.type&&F!==k.mark.type)).filter(k=>k.to>C).length)return null;y<r.to&&l.delete(y,r.to),C>r.from&&l.delete(r.from+v,C),g=r.from+v+d.length,l.addMark(r.from+v,g,t.type.create(a||{})),l.removeStoredMark(t.type)}}})}function Ff(t){return new qd({find:t.find,handler:({state:e,range:r,match:o})=>{const a=e.doc.resolve(r.from),l=Er(t.getAttributes,void 0,o)||{};if(!a.node(-1).canReplaceWith(a.index(-1),a.indexAfter(-1),t.type))return null;e.tr.delete(r.from,r.to).setBlockType(r.from,r.from,t.type,l)}})}function Jd(t){return new qd({find:t.find,handler:({state:e,range:r,match:o})=>{const a=Er(t.getAttributes,void 0,o)||{},l=e.tr.delete(r.from,r.to),A=l.doc.resolve(r.from).blockRange(),g=A&&HA(A,t.type,a);if(!g)return null;l.wrap(A,g);const v=l.doc.resolve(r.from-1).nodeBefore;v&&v.type===t.type&&KA(l.doc,r.from-1)&&(!t.joinPredicate||t.joinPredicate(o,v))&&l.join(r.from-1)}})}function Ca(t){return new wB({find:t.find,handler:({state:e,range:r,match:o})=>{const a=Er(t.getAttributes,void 0,o);if(a===!1||a===null)return;const{tr:l}=e,d=o[o.length-1],A=o[0];let g=r.to;if(d){const v=A.search(/\S/),C=r.from+A.indexOf(d),y=C+d.length;if(Sy(r.from,r.to,e).filter(k=>k.mark.type.excluded.find(F=>F===t.type&&F!==k.mark.type)).filter(k=>k.to>C).length)return null;y<r.to&&l.delete(y,r.to),C>r.from&&l.delete(r.from+v,C),g=r.from+v+d.length,l.addMark(r.from+v,g,t.type.create(a||{})),l.removeStoredMark(t.type)}}})}function OB(t){return my(t)&&t instanceof et}function Ty(t,e,r){const o=0,a=t.state.doc.content.size,l=Ea(e,o,a),d=Ea(r,o,a),A=t.coordsAtPos(l),g=t.coordsAtPos(d,-1),v=Math.min(A.top,g.top),C=Math.max(A.bottom,g.bottom),y=Math.min(A.left,g.left),w=Math.max(A.right,g.right),k=w-y,M=C-v,J={top:v,bottom:C,left:y,right:w,width:k,height:M,x:y,y:v};return hc(fe({},J),{toJSON:()=>J})}var Si="top",Hi="bottom",Ki="right",Ti="left",Vf="auto",Wl=[Si,Hi,Ki,Ti],wc="start",Yl="end",kB="clippingParents",Ry="viewport",ql="popper",bB="reference",wy=Wl.reduce(function(t,e){return t.concat([e+"-"+wc,e+"-"+Yl])},[]),Ny=[].concat(Wl,[Vf]).reduce(function(t,e){return t.concat([e,e+"-"+wc,e+"-"+Yl])},[]),DB="beforeRead",BB="read",LB="afterRead",MB="beforeMain",PB="main",QB="afterMain",xB="beforeWrite",UB="write",FB="afterWrite",VB=[DB,BB,LB,MB,PB,QB,xB,UB,FB];function bo(t){return t?(t.nodeName||"").toLowerCase():null}function uo(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function Jl(t){var e=uo(t).Element;return t instanceof e||t instanceof Element}function Wi(t){var e=uo(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function Oy(t){if(typeof ShadowRoot=="undefined")return!1;var e=uo(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function GB(t){var e=t.state;Object.keys(e.elements).forEach(function(r){var o=e.styles[r]||{},a=e.attributes[r]||{},l=e.elements[r];!Wi(l)||!bo(l)||(Object.assign(l.style,o),Object.keys(a).forEach(function(d){var A=a[d];A===!1?l.removeAttribute(d):l.setAttribute(d,A===!0?"":A)}))})}function jB(t){var e=t.state,r={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,r.popper),e.styles=r,e.elements.arrow&&Object.assign(e.elements.arrow.style,r.arrow),function(){Object.keys(e.elements).forEach(function(o){var a=e.elements[o],l=e.attributes[o]||{},d=Object.keys(e.styles.hasOwnProperty(o)?e.styles[o]:r[o]),A=d.reduce(function(g,v){return g[v]="",g},{});!Wi(a)||!bo(a)||(Object.assign(a.style,A),Object.keys(l).forEach(function(g){a.removeAttribute(g)}))})}}var ky={name:"applyStyles",enabled:!0,phase:"write",fn:GB,effect:jB,requires:["computeStyles"]};function Do(t){return t.split("-")[0]}function Nc(t,e){var r=t.getBoundingClientRect(),o=1,a=1;return{width:r.width/o,height:r.height/a,top:r.top/a,right:r.right/o,bottom:r.bottom/a,left:r.left/o,x:r.left/o,y:r.top/a}}function Gf(t){var e=Nc(t),r=t.offsetWidth,o=t.offsetHeight;return Math.abs(e.width-r)<=1&&(r=e.width),Math.abs(e.height-o)<=1&&(o=e.height),{x:t.offsetLeft,y:t.offsetTop,width:r,height:o}}function by(t,e){var r=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(r&&Oy(r)){var o=e;do{if(o&&t.isSameNode(o))return!0;o=o.parentNode||o.host}while(o)}return!1}function ss(t){return uo(t).getComputedStyle(t)}function HB(t){return["table","td","th"].indexOf(bo(t))>=0}function bs(t){return((Jl(t)?t.ownerDocument:t.document)||window.document).documentElement}function zd(t){return bo(t)==="html"?t:t.assignedSlot||t.parentNode||(Oy(t)?t.host:null)||bs(t)}function Dy(t){return!Wi(t)||ss(t).position==="fixed"?null:t.offsetParent}function KB(t){var e=navigator.userAgent.toLowerCase().indexOf("firefox")!==-1,r=navigator.userAgent.indexOf("Trident")!==-1;if(r&&Wi(t)){var o=ss(t);if(o.position==="fixed")return null}for(var a=zd(t);Wi(a)&&["html","body"].indexOf(bo(a))<0;){var l=ss(a);if(l.transform!=="none"||l.perspective!=="none"||l.contain==="paint"||["transform","perspective"].indexOf(l.willChange)!==-1||e&&l.willChange==="filter"||e&&l.filter&&l.filter!=="none")return a;a=a.parentNode}return null}function zl(t){for(var e=uo(t),r=Dy(t);r&&HB(r)&&ss(r).position==="static";)r=Dy(r);return r&&(bo(r)==="html"||bo(r)==="body"&&ss(r).position==="static")?e:r||KB(t)||e}function jf(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}var Ds=Math.max,Xl=Math.min,Xd=Math.round;function $d(t,e,r){return Ds(t,Xl(e,r))}function By(){return{top:0,right:0,bottom:0,left:0}}function Ly(t){return Object.assign({},By(),t)}function My(t,e){return e.reduce(function(r,o){return r[o]=t,r},{})}var WB=function(e,r){return e=typeof e=="function"?e(Object.assign({},r.rects,{placement:r.placement})):e,Ly(typeof e!="number"?e:My(e,Wl))};function YB(t){var e,r=t.state,o=t.name,a=t.options,l=r.elements.arrow,d=r.modifiersData.popperOffsets,A=Do(r.placement),g=jf(A),v=[Ti,Ki].indexOf(A)>=0,C=v?"height":"width";if(!(!l||!d)){var y=WB(a.padding,r),w=Gf(l),k=g==="y"?Si:Ti,M=g==="y"?Hi:Ki,F=r.rects.reference[C]+r.rects.reference[g]-d[g]-r.rects.popper[C],K=d[g]-r.rects.reference[g],J=zl(l),U=J?g==="y"?J.clientHeight||0:J.clientWidth||0:0,te=F/2-K/2,P=y[k],he=U-w[C]-y[M],ne=U/2-w[C]/2+te,me=$d(P,ne,he),Pe=g;r.modifiersData[o]=(e={},e[Pe]=me,e.centerOffset=me-ne,e)}}function qB(t){var e=t.state,r=t.options,o=r.element,a=o===void 0?"[data-popper-arrow]":o;a!=null&&(typeof a=="string"&&(a=e.elements.popper.querySelector(a),!a)||!by(e.elements.popper,a)||(e.elements.arrow=a))}var JB={name:"arrow",enabled:!0,phase:"main",fn:YB,effect:qB,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Oc(t){return t.split("-")[1]}var zB={top:"auto",right:"auto",bottom:"auto",left:"auto"};function XB(t){var e=t.x,r=t.y,o=window,a=o.devicePixelRatio||1;return{x:Xd(Xd(e*a)/a)||0,y:Xd(Xd(r*a)/a)||0}}function Py(t){var e,r=t.popper,o=t.popperRect,a=t.placement,l=t.variation,d=t.offsets,A=t.position,g=t.gpuAcceleration,v=t.adaptive,C=t.roundOffsets,y=C===!0?XB(d):typeof C=="function"?C(d):d,w=y.x,k=w===void 0?0:w,M=y.y,F=M===void 0?0:M,K=d.hasOwnProperty("x"),J=d.hasOwnProperty("y"),U=Ti,te=Si,P=window;if(v){var he=zl(r),ne="clientHeight",me="clientWidth";he===uo(r)&&(he=bs(r),ss(he).position!=="static"&&A==="absolute"&&(ne="scrollHeight",me="scrollWidth")),he=he,(a===Si||(a===Ti||a===Ki)&&l===Yl)&&(te=Hi,F-=he[ne]-o.height,F*=g?1:-1),(a===Ti||(a===Si||a===Hi)&&l===Yl)&&(U=Ki,k-=he[me]-o.width,k*=g?1:-1)}var Pe=Object.assign({position:A},v&&zB);if(g){var Me;return Object.assign({},Pe,(Me={},Me[te]=J?"0":"",Me[U]=K?"0":"",Me.transform=(P.devicePixelRatio||1)<=1?"translate("+k+"px, "+F+"px)":"translate3d("+k+"px, "+F+"px, 0)",Me))}return Object.assign({},Pe,(e={},e[te]=J?F+"px":"",e[U]=K?k+"px":"",e.transform="",e))}function $B(t){var e=t.state,r=t.options,o=r.gpuAcceleration,a=o===void 0?!0:o,l=r.adaptive,d=l===void 0?!0:l,A=r.roundOffsets,g=A===void 0?!0:A,v={placement:Do(e.placement),variation:Oc(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:a};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,Py(Object.assign({},v,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:d,roundOffsets:g})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,Py(Object.assign({},v,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:g})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}var ZB={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:$B,data:{}},Zd={passive:!0};function eL(t){var e=t.state,r=t.instance,o=t.options,a=o.scroll,l=a===void 0?!0:a,d=o.resize,A=d===void 0?!0:d,g=uo(e.elements.popper),v=[].concat(e.scrollParents.reference,e.scrollParents.popper);return l&&v.forEach(function(C){C.addEventListener("scroll",r.update,Zd)}),A&&g.addEventListener("resize",r.update,Zd),function(){l&&v.forEach(function(C){C.removeEventListener("scroll",r.update,Zd)}),A&&g.removeEventListener("resize",r.update,Zd)}}var tL={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:eL,data:{}},rL={left:"right",right:"left",bottom:"top",top:"bottom"};function eh(t){return t.replace(/left|right|bottom|top/g,function(e){return rL[e]})}var nL={start:"end",end:"start"};function Qy(t){return t.replace(/start|end/g,function(e){return nL[e]})}function Hf(t){var e=uo(t),r=e.pageXOffset,o=e.pageYOffset;return{scrollLeft:r,scrollTop:o}}function Kf(t){return Nc(bs(t)).left+Hf(t).scrollLeft}function iL(t){var e=uo(t),r=bs(t),o=e.visualViewport,a=r.clientWidth,l=r.clientHeight,d=0,A=0;return o&&(a=o.width,l=o.height,/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||(d=o.offsetLeft,A=o.offsetTop)),{width:a,height:l,x:d+Kf(t),y:A}}function oL(t){var e,r=bs(t),o=Hf(t),a=(e=t.ownerDocument)==null?void 0:e.body,l=Ds(r.scrollWidth,r.clientWidth,a?a.scrollWidth:0,a?a.clientWidth:0),d=Ds(r.scrollHeight,r.clientHeight,a?a.scrollHeight:0,a?a.clientHeight:0),A=-o.scrollLeft+Kf(t),g=-o.scrollTop;return ss(a||r).direction==="rtl"&&(A+=Ds(r.clientWidth,a?a.clientWidth:0)-l),{width:l,height:d,x:A,y:g}}function Wf(t){var e=ss(t),r=e.overflow,o=e.overflowX,a=e.overflowY;return/auto|scroll|overlay|hidden/.test(r+a+o)}function xy(t){return["html","body","#document"].indexOf(bo(t))>=0?t.ownerDocument.body:Wi(t)&&Wf(t)?t:xy(zd(t))}function $l(t,e){var r;e===void 0&&(e=[]);var o=xy(t),a=o===((r=t.ownerDocument)==null?void 0:r.body),l=uo(o),d=a?[l].concat(l.visualViewport||[],Wf(o)?o:[]):o,A=e.concat(d);return a?A:A.concat($l(zd(d)))}function Yf(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function sL(t){var e=Nc(t);return e.top=e.top+t.clientTop,e.left=e.left+t.clientLeft,e.bottom=e.top+t.clientHeight,e.right=e.left+t.clientWidth,e.width=t.clientWidth,e.height=t.clientHeight,e.x=e.left,e.y=e.top,e}function Uy(t,e){return e===Ry?Yf(iL(t)):Wi(e)?sL(e):Yf(oL(bs(t)))}function aL(t){var e=$l(zd(t)),r=["absolute","fixed"].indexOf(ss(t).position)>=0,o=r&&Wi(t)?zl(t):t;return Jl(o)?e.filter(function(a){return Jl(a)&&by(a,o)&&bo(a)!=="body"}):[]}function cL(t,e,r){var o=e==="clippingParents"?aL(t):[].concat(e),a=[].concat(o,[r]),l=a[0],d=a.reduce(function(A,g){var v=Uy(t,g);return A.top=Ds(v.top,A.top),A.right=Xl(v.right,A.right),A.bottom=Xl(v.bottom,A.bottom),A.left=Ds(v.left,A.left),A},Uy(t,l));return d.width=d.right-d.left,d.height=d.bottom-d.top,d.x=d.left,d.y=d.top,d}function Fy(t){var e=t.reference,r=t.element,o=t.placement,a=o?Do(o):null,l=o?Oc(o):null,d=e.x+e.width/2-r.width/2,A=e.y+e.height/2-r.height/2,g;switch(a){case Si:g={x:d,y:e.y-r.height};break;case Hi:g={x:d,y:e.y+e.height};break;case Ki:g={x:e.x+e.width,y:A};break;case Ti:g={x:e.x-r.width,y:A};break;default:g={x:e.x,y:e.y}}var v=a?jf(a):null;if(v!=null){var C=v==="y"?"height":"width";switch(l){case wc:g[v]=g[v]-(e[C]/2-r[C]/2);break;case Yl:g[v]=g[v]+(e[C]/2-r[C]/2);break}}return g}function Zl(t,e){e===void 0&&(e={});var r=e,o=r.placement,a=o===void 0?t.placement:o,l=r.boundary,d=l===void 0?kB:l,A=r.rootBoundary,g=A===void 0?Ry:A,v=r.elementContext,C=v===void 0?ql:v,y=r.altBoundary,w=y===void 0?!1:y,k=r.padding,M=k===void 0?0:k,F=Ly(typeof M!="number"?M:My(M,Wl)),K=C===ql?bB:ql,J=t.rects.popper,U=t.elements[w?K:C],te=cL(Jl(U)?U:U.contextElement||bs(t.elements.popper),d,g),P=Nc(t.elements.reference),he=Fy({reference:P,element:J,strategy:"absolute",placement:a}),ne=Yf(Object.assign({},J,he)),me=C===ql?ne:P,Pe={top:te.top-me.top+F.top,bottom:me.bottom-te.bottom+F.bottom,left:te.left-me.left+F.left,right:me.right-te.right+F.right},Me=t.modifiersData.offset;if(C===ql&&Me){var be=Me[a];Object.keys(Pe).forEach(function(Gt){var At=[Ki,Hi].indexOf(Gt)>=0?1:-1,it=[Si,Hi].indexOf(Gt)>=0?"y":"x";Pe[Gt]+=be[it]*At})}return Pe}function lL(t,e){e===void 0&&(e={});var r=e,o=r.placement,a=r.boundary,l=r.rootBoundary,d=r.padding,A=r.flipVariations,g=r.allowedAutoPlacements,v=g===void 0?Ny:g,C=Oc(o),y=C?A?wy:wy.filter(function(M){return Oc(M)===C}):Wl,w=y.filter(function(M){return v.indexOf(M)>=0});w.length===0&&(w=y);var k=w.reduce(function(M,F){return M[F]=Zl(t,{placement:F,boundary:a,rootBoundary:l,padding:d})[Do(F)],M},{});return Object.keys(k).sort(function(M,F){return k[M]-k[F]})}function uL(t){if(Do(t)===Vf)return[];var e=eh(t);return[Qy(t),e,Qy(e)]}function dL(t){var e=t.state,r=t.options,o=t.name;if(!e.modifiersData[o]._skip){for(var a=r.mainAxis,l=a===void 0?!0:a,d=r.altAxis,A=d===void 0?!0:d,g=r.fallbackPlacements,v=r.padding,C=r.boundary,y=r.rootBoundary,w=r.altBoundary,k=r.flipVariations,M=k===void 0?!0:k,F=r.allowedAutoPlacements,K=e.options.placement,J=Do(K),U=J===K,te=g||(U||!M?[eh(K)]:uL(K)),P=[K].concat(te).reduce(function(mn,xr){return mn.concat(Do(xr)===Vf?lL(e,{placement:xr,boundary:C,rootBoundary:y,padding:v,flipVariations:M,allowedAutoPlacements:F}):xr)},[]),he=e.rects.reference,ne=e.rects.popper,me=new Map,Pe=!0,Me=P[0],be=0;be<P.length;be++){var Gt=P[be],At=Do(Gt),it=Oc(Gt)===wc,gr=[Si,Hi].indexOf(At)>=0,_t=gr?"width":"height",Et=Zl(e,{placement:Gt,boundary:C,rootBoundary:y,altBoundary:w,padding:v}),ar=gr?it?Ki:Ti:it?Hi:Si;he[_t]>ne[_t]&&(ar=eh(ar));var mr=eh(ar),si=[];if(l&&si.push(Et[At]<=0),A&&si.push(Et[ar]<=0,Et[mr]<=0),si.every(function(mn){return mn})){Me=Gt,Pe=!1;break}me.set(Gt,si)}if(Pe)for(var Jn=M?3:1,ai=function(xr){var ci=P.find(function(Ao){var vn=me.get(Ao);if(vn)return vn.slice(0,xr).every(function(xe){return xe})});if(ci)return Me=ci,"break"},rn=Jn;rn>0;rn--){var Oi=ai(rn);if(Oi==="break")break}e.placement!==Me&&(e.modifiersData[o]._skip=!0,e.placement=Me,e.reset=!0)}}var hL={name:"flip",enabled:!0,phase:"main",fn:dL,requiresIfExists:["offset"],data:{_skip:!1}};function Vy(t,e,r){return r===void 0&&(r={x:0,y:0}),{top:t.top-e.height-r.y,right:t.right-e.width+r.x,bottom:t.bottom-e.height+r.y,left:t.left-e.width-r.x}}function Gy(t){return[Si,Ki,Hi,Ti].some(function(e){return t[e]>=0})}function pL(t){var e=t.state,r=t.name,o=e.rects.reference,a=e.rects.popper,l=e.modifiersData.preventOverflow,d=Zl(e,{elementContext:"reference"}),A=Zl(e,{altBoundary:!0}),g=Vy(d,o),v=Vy(A,a,l),C=Gy(g),y=Gy(v);e.modifiersData[r]={referenceClippingOffsets:g,popperEscapeOffsets:v,isReferenceHidden:C,hasPopperEscaped:y},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":C,"data-popper-escaped":y})}var AL={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:pL};function fL(t,e,r){var o=Do(t),a=[Ti,Si].indexOf(o)>=0?-1:1,l=typeof r=="function"?r(Object.assign({},e,{placement:t})):r,d=l[0],A=l[1];return d=d||0,A=(A||0)*a,[Ti,Ki].indexOf(o)>=0?{x:A,y:d}:{x:d,y:A}}function gL(t){var e=t.state,r=t.options,o=t.name,a=r.offset,l=a===void 0?[0,0]:a,d=Ny.reduce(function(C,y){return C[y]=fL(y,e.rects,l),C},{}),A=d[e.placement],g=A.x,v=A.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=g,e.modifiersData.popperOffsets.y+=v),e.modifiersData[o]=d}var mL={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:gL};function vL(t){var e=t.state,r=t.name;e.modifiersData[r]=Fy({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}var EL={name:"popperOffsets",enabled:!0,phase:"read",fn:vL,data:{}};function IL(t){return t==="x"?"y":"x"}function CL(t){var e=t.state,r=t.options,o=t.name,a=r.mainAxis,l=a===void 0?!0:a,d=r.altAxis,A=d===void 0?!1:d,g=r.boundary,v=r.rootBoundary,C=r.altBoundary,y=r.padding,w=r.tether,k=w===void 0?!0:w,M=r.tetherOffset,F=M===void 0?0:M,K=Zl(e,{boundary:g,rootBoundary:v,padding:y,altBoundary:C}),J=Do(e.placement),U=Oc(e.placement),te=!U,P=jf(J),he=IL(P),ne=e.modifiersData.popperOffsets,me=e.rects.reference,Pe=e.rects.popper,Me=typeof F=="function"?F(Object.assign({},e.rects,{placement:e.placement})):F,be={x:0,y:0};if(!!ne){if(l||A){var Gt=P==="y"?Si:Ti,At=P==="y"?Hi:Ki,it=P==="y"?"height":"width",gr=ne[P],_t=ne[P]+K[Gt],Et=ne[P]-K[At],ar=k?-Pe[it]/2:0,mr=U===wc?me[it]:Pe[it],si=U===wc?-Pe[it]:-me[it],Jn=e.elements.arrow,ai=k&&Jn?Gf(Jn):{width:0,height:0},rn=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:By(),Oi=rn[Gt],mn=rn[At],xr=$d(0,me[it],ai[it]),ci=te?me[it]/2-ar-xr-Oi-Me:mr-xr-Oi-Me,Ao=te?-me[it]/2+ar+xr+mn+Me:si+xr+mn+Me,vn=e.elements.arrow&&zl(e.elements.arrow),xe=vn?P==="y"?vn.clientTop||0:vn.clientLeft||0:0,St=e.modifiersData.offset?e.modifiersData.offset[e.placement][P]:0,tr=ne[P]+ci-St-xe,Zt=ne[P]+Ao-St;if(l){var Kr=$d(k?Xl(_t,tr):_t,gr,k?Ds(Et,Zt):Et);ne[P]=Kr,be[P]=Kr-gr}if(A){var fo=P==="x"?Si:Ti,qe=P==="x"?Hi:Ki,xo=ne[he],go=xo+K[fo],Us=xo-K[qe],Ji=$d(k?Xl(go,tr):go,xo,k?Ds(Us,Zt):Us);ne[he]=Ji,be[he]=Ji-xo}}e.modifiersData[o]=be}}var yL={name:"preventOverflow",enabled:!0,phase:"main",fn:CL,requiresIfExists:["offset"]};function _L(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function SL(t){return t===uo(t)||!Wi(t)?Hf(t):_L(t)}function TL(t){var e=t.getBoundingClientRect(),r=e.width/t.offsetWidth||1,o=e.height/t.offsetHeight||1;return r!==1||o!==1}function RL(t,e,r){r===void 0&&(r=!1);var o=Wi(e);Wi(e)&&TL(e);var a=bs(e),l=Nc(t),d={scrollLeft:0,scrollTop:0},A={x:0,y:0};return(o||!o&&!r)&&((bo(e)!=="body"||Wf(a))&&(d=SL(e)),Wi(e)?(A=Nc(e),A.x+=e.clientLeft,A.y+=e.clientTop):a&&(A.x=Kf(a))),{x:l.left+d.scrollLeft-A.x,y:l.top+d.scrollTop-A.y,width:l.width,height:l.height}}function wL(t){var e=new Map,r=new Set,o=[];t.forEach(function(l){e.set(l.name,l)});function a(l){r.add(l.name);var d=[].concat(l.requires||[],l.requiresIfExists||[]);d.forEach(function(A){if(!r.has(A)){var g=e.get(A);g&&a(g)}}),o.push(l)}return t.forEach(function(l){r.has(l.name)||a(l)}),o}function NL(t){var e=wL(t);return VB.reduce(function(r,o){return r.concat(e.filter(function(a){return a.phase===o}))},[])}function OL(t){var e;return function(){return e||(e=new Promise(function(r){Promise.resolve().then(function(){e=void 0,r(t())})})),e}}function kL(t){var e=t.reduce(function(r,o){var a=r[o.name];return r[o.name]=a?Object.assign({},a,o,{options:Object.assign({},a.options,o.options),data:Object.assign({},a.data,o.data)}):o,r},{});return Object.keys(e).map(function(r){return e[r]})}var jy={placement:"bottom",modifiers:[],strategy:"absolute"};function Hy(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return!e.some(function(o){return!(o&&typeof o.getBoundingClientRect=="function")})}function bL(t){t===void 0&&(t={});var e=t,r=e.defaultModifiers,o=r===void 0?[]:r,a=e.defaultOptions,l=a===void 0?jy:a;return function(A,g,v){v===void 0&&(v=l);var C={placement:"bottom",orderedModifiers:[],options:Object.assign({},jy,l),modifiersData:{},elements:{reference:A,popper:g},attributes:{},styles:{}},y=[],w=!1,k={state:C,setOptions:function(J){var U=typeof J=="function"?J(C.options):J;F(),C.options=Object.assign({},l,C.options,U),C.scrollParents={reference:Jl(A)?$l(A):A.contextElement?$l(A.contextElement):[],popper:$l(g)};var te=NL(kL([].concat(o,C.options.modifiers)));return C.orderedModifiers=te.filter(function(P){return P.enabled}),M(),k.update()},forceUpdate:function(){if(!w){var J=C.elements,U=J.reference,te=J.popper;if(!!Hy(U,te)){C.rects={reference:RL(U,zl(te),C.options.strategy==="fixed"),popper:Gf(te)},C.reset=!1,C.placement=C.options.placement,C.orderedModifiers.forEach(function(be){return C.modifiersData[be.name]=Object.assign({},be.data)});for(var P=0;P<C.orderedModifiers.length;P++){if(C.reset===!0){C.reset=!1,P=-1;continue}var he=C.orderedModifiers[P],ne=he.fn,me=he.options,Pe=me===void 0?{}:me,Me=he.name;typeof ne=="function"&&(C=ne({state:C,options:Pe,name:Me,instance:k})||C)}}}},update:OL(function(){return new Promise(function(K){k.forceUpdate(),K(C)})}),destroy:function(){F(),w=!0}};if(!Hy(A,g))return k;k.setOptions(v).then(function(K){!w&&v.onFirstUpdate&&v.onFirstUpdate(K)});function M(){C.orderedModifiers.forEach(function(K){var J=K.name,U=K.options,te=U===void 0?{}:U,P=K.effect;if(typeof P=="function"){var he=P({state:C,name:J,instance:k,options:te}),ne=function(){};y.push(he||ne)}})}function F(){y.forEach(function(K){return K()}),y=[]}return k}}var DL=[tL,EL,ZB,ky,mL,hL,yL,JB,AL],BL=bL({defaultModifiers:DL}),LL="tippy-box",Ky="tippy-content",ML="tippy-backdrop",Wy="tippy-arrow",Yy="tippy-svg-arrow",ya={passive:!0,capture:!0},qy=function(){return document.body};function qf(t,e,r){if(Array.isArray(t)){var o=t[e];return o==null?Array.isArray(r)?r[e]:r:o}return t}function Jf(t,e){var r={}.toString.call(t);return r.indexOf("[object")===0&&r.indexOf(e+"]")>-1}function Jy(t,e){return typeof t=="function"?t.apply(void 0,e):t}function zy(t,e){if(e===0)return t;var r;return function(o){clearTimeout(r),r=setTimeout(function(){t(o)},e)}}function PL(t){return t.split(/\s+/).filter(Boolean)}function kc(t){return[].concat(t)}function Xy(t,e){t.indexOf(e)===-1&&t.push(e)}function QL(t){return t.filter(function(e,r){return t.indexOf(e)===r})}function xL(t){return t.split("-")[0]}function th(t){return[].slice.call(t)}function $y(t){return Object.keys(t).reduce(function(e,r){return t[r]!==void 0&&(e[r]=t[r]),e},{})}function eu(){return document.createElement("div")}function rh(t){return["Element","Fragment"].some(function(e){return Jf(t,e)})}function UL(t){return Jf(t,"NodeList")}function FL(t){return Jf(t,"MouseEvent")}function VL(t){return!!(t&&t._tippy&&t._tippy.reference===t)}function GL(t){return rh(t)?[t]:UL(t)?th(t):Array.isArray(t)?t:th(document.querySelectorAll(t))}function zf(t,e){t.forEach(function(r){r&&(r.style.transitionDuration=e+"ms")})}function Zy(t,e){t.forEach(function(r){r&&r.setAttribute("data-state",e)})}function jL(t){var e,r=kc(t),o=r[0];return o!=null&&(e=o.ownerDocument)!=null&&e.body?o.ownerDocument:document}function HL(t,e){var r=e.clientX,o=e.clientY;return t.every(function(a){var l=a.popperRect,d=a.popperState,A=a.props,g=A.interactiveBorder,v=xL(d.placement),C=d.modifiersData.offset;if(!C)return!0;var y=v==="bottom"?C.top.y:0,w=v==="top"?C.bottom.y:0,k=v==="right"?C.left.x:0,M=v==="left"?C.right.x:0,F=l.top-o+y>g,K=o-l.bottom-w>g,J=l.left-r+k>g,U=r-l.right-M>g;return F||K||J||U})}function Xf(t,e,r){var o=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(a){t[o](a,r)})}function KL(t,e){for(var r=e;r;){var o;if(t.contains(r))return!0;r=r.getRootNode==null||(o=r.getRootNode())==null?void 0:o.host}return!1}var Bo={isTouch:!1},e_=0;function WL(){Bo.isTouch||(Bo.isTouch=!0,window.performance&&document.addEventListener("mousemove",t_))}function t_(){var t=performance.now();t-e_<20&&(Bo.isTouch=!1,document.removeEventListener("mousemove",t_)),e_=t}function YL(){var t=document.activeElement;if(VL(t)){var e=t._tippy;t.blur&&!e.state.isVisible&&t.blur()}}function qL(){document.addEventListener("touchstart",WL,ya),window.addEventListener("blur",YL)}var JL=typeof window!="undefined"&&typeof document!="undefined",zL=JL?!!window.msCrypto:!1,XL={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},$L={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},ho=Object.assign({appendTo:qy,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},XL,$L),ZL=Object.keys(ho),eM=function(e){var r=Object.keys(e);r.forEach(function(o){ho[o]=e[o]})};function r_(t){var e=t.plugins||[],r=e.reduce(function(o,a){var l=a.name,d=a.defaultValue;if(l){var A;o[l]=t[l]!==void 0?t[l]:(A=ho[l])!=null?A:d}return o},{});return Object.assign({},t,r)}function tM(t,e){var r=e?Object.keys(r_(Object.assign({},ho,{plugins:e}))):ZL,o=r.reduce(function(a,l){var d=(t.getAttribute("data-tippy-"+l)||"").trim();if(!d)return a;if(l==="content")a[l]=d;else try{a[l]=JSON.parse(d)}catch{a[l]=d}return a},{});return o}function n_(t,e){var r=Object.assign({},e,{content:Jy(e.content,[t])},e.ignoreAttributes?{}:tM(t,e.plugins));return r.aria=Object.assign({},ho.aria,r.aria),r.aria={expanded:r.aria.expanded==="auto"?e.interactive:r.aria.expanded,content:r.aria.content==="auto"?e.interactive?null:"describedby":r.aria.content},r}var rM=function(){return"innerHTML"};function $f(t,e){t[rM()]=e}function i_(t){var e=eu();return t===!0?e.className=Wy:(e.className=Yy,rh(t)?e.appendChild(t):$f(e,t)),e}function o_(t,e){rh(e.content)?($f(t,""),t.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?$f(t,e.content):t.textContent=e.content)}function Zf(t){var e=t.firstElementChild,r=th(e.children);return{box:e,content:r.find(function(o){return o.classList.contains(Ky)}),arrow:r.find(function(o){return o.classList.contains(Wy)||o.classList.contains(Yy)}),backdrop:r.find(function(o){return o.classList.contains(ML)})}}function s_(t){var e=eu(),r=eu();r.className=LL,r.setAttribute("data-state","hidden"),r.setAttribute("tabindex","-1");var o=eu();o.className=Ky,o.setAttribute("data-state","hidden"),o_(o,t.props),e.appendChild(r),r.appendChild(o),a(t.props,t.props);function a(l,d){var A=Zf(e),g=A.box,v=A.content,C=A.arrow;d.theme?g.setAttribute("data-theme",d.theme):g.removeAttribute("data-theme"),typeof d.animation=="string"?g.setAttribute("data-animation",d.animation):g.removeAttribute("data-animation"),d.inertia?g.setAttribute("data-inertia",""):g.removeAttribute("data-inertia"),g.style.maxWidth=typeof d.maxWidth=="number"?d.maxWidth+"px":d.maxWidth,d.role?g.setAttribute("role",d.role):g.removeAttribute("role"),(l.content!==d.content||l.allowHTML!==d.allowHTML)&&o_(v,t.props),d.arrow?C?l.arrow!==d.arrow&&(g.removeChild(C),g.appendChild(i_(d.arrow))):g.appendChild(i_(d.arrow)):C&&g.removeChild(C)}return{popper:e,onUpdate:a}}s_.$$tippy=!0;var nM=1,nh=[],eg=[];function iM(t,e){var r=n_(t,Object.assign({},ho,r_($y(e)))),o,a,l,d=!1,A=!1,g=!1,v=!1,C,y,w,k=[],M=zy(fo,r.interactiveDebounce),F,K=nM++,J=null,U=QL(r.plugins),te={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},P={id:K,reference:t,popper:eu(),popperInstance:J,props:r,state:te,plugins:U,clearDelayTimeouts:xc,setProps:cs,setContent:Uc,show:Na,hide:Oa,hideWithInteractivity:Wr,enable:mo,disable:mu,unmount:ls,destroy:Ve};if(!r.render)return P;var he=r.render(P),ne=he.popper,me=he.onUpdate;ne.setAttribute("data-tippy-root",""),ne.id="tippy-"+P.id,P.popper=ne,t._tippy=P,ne._tippy=P;var Pe=U.map(function(X){return X.fn(P)}),Me=t.hasAttribute("aria-expanded");return tr(),Jn(),ar(),mr("onCreate",[P]),r.showOnCreate&&Bn(),ne.addEventListener("mouseenter",function(){P.props.interactive&&P.state.isVisible&&P.clearDelayTimeouts()}),ne.addEventListener("mouseleave",function(){P.props.interactive&&P.props.trigger.indexOf("mouseenter")>=0&&gr().addEventListener("mousemove",M)}),P;function be(){var X=P.props.touch;return Array.isArray(X)?X:[X,0]}function Gt(){return be()[0]==="hold"}function At(){var X;return!!((X=P.props.render)!=null&&X.$$tippy)}function it(){return F||t}function gr(){var X=it().parentNode;return X?jL(X):document}function _t(){return Zf(ne)}function Et(X){return P.state.isMounted&&!P.state.isVisible||Bo.isTouch||C&&C.type==="focus"?0:qf(P.props.delay,X?0:1,ho.delay)}function ar(){ne.style.pointerEvents=P.props.interactive&&P.state.isVisible?"":"none",ne.style.zIndex=""+P.props.zIndex}function mr(X,we,Ye){if(Ye===void 0&&(Ye=!0),Pe.forEach(function(ft){ft[X]&&ft[X].apply(ft,we)}),Ye){var Dt;(Dt=P.props)[X].apply(Dt,we)}}function si(){var X=P.props.aria;if(!!X.content){var we="aria-"+X.content,Ye=ne.id,Dt=kc(P.props.triggerTarget||t);Dt.forEach(function(ft){var Nr=ft.getAttribute(we);if(P.state.isVisible)ft.setAttribute(we,Nr?Nr+" "+Ye:Ye);else{var Ln=Nr&&Nr.replace(Ye,"").trim();Ln?ft.setAttribute(we,Ln):ft.removeAttribute(we)}})}}function Jn(){if(!(Me||!P.props.aria.expanded)){var X=kc(P.props.triggerTarget||t);X.forEach(function(we){P.props.interactive?we.setAttribute("aria-expanded",P.state.isVisible&&we===it()?"true":"false"):we.removeAttribute("aria-expanded")})}}function ai(){gr().removeEventListener("mousemove",M),nh=nh.filter(function(X){return X!==M})}function rn(X){if(!(Bo.isTouch&&(g||X.type==="mousedown"))){var we=X.composedPath&&X.composedPath()[0]||X.target;if(!(P.props.interactive&&KL(ne,we))){if(kc(P.props.triggerTarget||t).indexOf(we)!==-1){if(Bo.isTouch||P.state.isVisible&&P.props.trigger.indexOf("click")>=0)return}else mr("onClickOutside",[P,X]);P.props.hideOnClick===!0&&(P.clearDelayTimeouts(),P.hide(),A=!0,setTimeout(function(){A=!1}),P.state.isMounted||ci())}}}function Oi(){g=!0}function mn(){g=!1}function xr(){var X=gr();X.addEventListener("mousedown",rn,!0),X.addEventListener("touchend",rn,ya),X.addEventListener("touchstart",mn,ya),X.addEventListener("touchmove",Oi,ya)}function ci(){var X=gr();X.removeEventListener("mousedown",rn,!0),X.removeEventListener("touchend",rn,ya),X.removeEventListener("touchstart",mn,ya),X.removeEventListener("touchmove",Oi,ya)}function Ao(X,we){xe(X,function(){!P.state.isVisible&&ne.parentNode&&ne.parentNode.contains(ne)&&we()})}function vn(X,we){xe(X,we)}function xe(X,we){var Ye=_t().box;function Dt(ft){ft.target===Ye&&(Xf(Ye,"remove",Dt),we())}if(X===0)return we();Xf(Ye,"remove",y),Xf(Ye,"add",Dt),y=Dt}function St(X,we,Ye){Ye===void 0&&(Ye=!1);var Dt=kc(P.props.triggerTarget||t);Dt.forEach(function(ft){ft.addEventListener(X,we,Ye),k.push({node:ft,eventType:X,handler:we,options:Ye})})}function tr(){Gt()&&(St("touchstart",Kr,{passive:!0}),St("touchend",qe,{passive:!0})),PL(P.props.trigger).forEach(function(X){if(X!=="manual")switch(St(X,Kr),X){case"mouseenter":St("mouseleave",qe);break;case"focus":St(zL?"focusout":"blur",xo);break;case"focusin":St("focusout",xo);break}})}function Zt(){k.forEach(function(X){var we=X.node,Ye=X.eventType,Dt=X.handler,ft=X.options;we.removeEventListener(Ye,Dt,ft)}),k=[]}function Kr(X){var we,Ye=!1;if(!(!P.state.isEnabled||go(X)||A)){var Dt=((we=C)==null?void 0:we.type)==="focus";C=X,F=X.currentTarget,Jn(),!P.state.isVisible&&FL(X)&&nh.forEach(function(ft){return ft(X)}),X.type==="click"&&(P.props.trigger.indexOf("mouseenter")<0||d)&&P.props.hideOnClick!==!1&&P.state.isVisible?Ye=!0:Bn(X),X.type==="click"&&(d=!Ye),Ye&&!Dt&&ki(X)}}function fo(X){var we=X.target,Ye=it().contains(we)||ne.contains(we);if(!(X.type==="mousemove"&&Ye)){var Dt=wr().concat(ne).map(function(ft){var Nr,Ln=ft._tippy,zi=(Nr=Ln.popperInstance)==null?void 0:Nr.state;return zi?{popperRect:ft.getBoundingClientRect(),popperState:zi,props:r}:null}).filter(Boolean);HL(Dt,X)&&(ai(),ki(X))}}function qe(X){var we=go(X)||P.props.trigger.indexOf("click")>=0&&d;if(!we){if(P.props.interactive){P.hideWithInteractivity(X);return}ki(X)}}function xo(X){P.props.trigger.indexOf("focusin")<0&&X.target!==it()||P.props.interactive&&X.relatedTarget&&ne.contains(X.relatedTarget)||ki(X)}function go(X){return Bo.isTouch?Gt()!==X.type.indexOf("touch")>=0:!1}function Us(){Ji();var X=P.props,we=X.popperOptions,Ye=X.placement,Dt=X.offset,ft=X.getReferenceClientRect,Nr=X.moveTransition,Ln=At()?Zf(ne).arrow:null,zi=ft?{getBoundingClientRect:ft,contextElement:ft.contextElement||it()}:t,Fc={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(Uo){var Fo=Uo.state;if(At()){var vu=_t(),us=vu.box;["placement","reference-hidden","escaped"].forEach(function(Ir){Ir==="placement"?us.setAttribute("data-placement",Fo.placement):Fo.attributes.popper["data-popper-"+Ir]?us.setAttribute("data-"+Ir,""):us.removeAttribute("data-"+Ir)}),Fo.attributes.popper={}}}},li=[{name:"offset",options:{offset:Dt}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!Nr}},Fc];At()&&Ln&&li.push({name:"arrow",options:{element:Ln,padding:3}}),li.push.apply(li,(we==null?void 0:we.modifiers)||[]),P.popperInstance=BL(zi,ne,Object.assign({},we,{placement:Ye,onFirstUpdate:w,modifiers:li}))}function Ji(){P.popperInstance&&(P.popperInstance.destroy(),P.popperInstance=null)}function Fs(){var X=P.props.appendTo,we,Ye=it();P.props.interactive&&X===qy||X==="parent"?we=Ye.parentNode:we=Jy(X,[Ye]),we.contains(ne)||we.appendChild(ne),Us()}function wr(){return th(ne.querySelectorAll("[data-tippy-root]"))}function Bn(X){P.clearDelayTimeouts(),X&&mr("onTrigger",[P,X]),xr();var we=Et(!0),Ye=be(),Dt=Ye[0],ft=Ye[1];Bo.isTouch&&Dt==="hold"&&ft&&(we=ft),we?o=setTimeout(function(){P.show()},we):P.show()}function ki(X){if(P.clearDelayTimeouts(),mr("onUntrigger",[P,X]),!P.state.isVisible){ci();return}if(!(P.props.trigger.indexOf("mouseenter")>=0&&P.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(X.type)>=0&&d)){var we=Et(!1);we?a=setTimeout(function(){P.state.isVisible&&P.hide()},we):l=requestAnimationFrame(function(){P.hide()})}}function mo(){P.state.isEnabled=!0}function mu(){P.hide(),P.state.isEnabled=!1}function xc(){clearTimeout(o),clearTimeout(a),cancelAnimationFrame(l)}function cs(X){if(!P.state.isDestroyed){mr("onBeforeUpdate",[P,X]),Zt();var we=P.props,Ye=n_(t,Object.assign({},we,$y(X),{ignoreAttributes:!0}));P.props=Ye,tr(),we.interactiveDebounce!==Ye.interactiveDebounce&&(ai(),M=zy(fo,Ye.interactiveDebounce)),we.triggerTarget&&!Ye.triggerTarget?kc(we.triggerTarget).forEach(function(Dt){Dt.removeAttribute("aria-expanded")}):Ye.triggerTarget&&t.removeAttribute("aria-expanded"),Jn(),ar(),me&&me(we,Ye),P.popperInstance&&(Us(),wr().forEach(function(Dt){requestAnimationFrame(Dt._tippy.popperInstance.forceUpdate)})),mr("onAfterUpdate",[P,X])}}function Uc(X){P.setProps({content:X})}function Na(){var X=P.state.isVisible,we=P.state.isDestroyed,Ye=!P.state.isEnabled,Dt=Bo.isTouch&&!P.props.touch,ft=qf(P.props.duration,0,ho.duration);if(!(X||we||Ye||Dt)&&!it().hasAttribute("disabled")&&(mr("onShow",[P],!1),P.props.onShow(P)!==!1)){if(P.state.isVisible=!0,At()&&(ne.style.visibility="visible"),ar(),xr(),P.state.isMounted||(ne.style.transition="none"),At()){var Nr=_t(),Ln=Nr.box,zi=Nr.content;zf([Ln,zi],0)}w=function(){var li;if(!(!P.state.isVisible||v)){if(v=!0,ne.offsetHeight,ne.style.transition=P.props.moveTransition,At()&&P.props.animation){var Vs=_t(),Uo=Vs.box,Fo=Vs.content;zf([Uo,Fo],ft),Zy([Uo,Fo],"visible")}si(),Jn(),Xy(eg,P),(li=P.popperInstance)==null||li.forceUpdate(),P.state.isMounted=!0,mr("onMount",[P]),P.props.animation&&At()&&vn(ft,function(){P.state.isShown=!0,mr("onShown",[P])})}},Fs()}}function Oa(){var X=!P.state.isVisible,we=P.state.isDestroyed,Ye=!P.state.isEnabled,Dt=qf(P.props.duration,1,ho.duration);if(!(X||we||Ye)&&(mr("onHide",[P],!1),P.props.onHide(P)!==!1)){if(P.state.isVisible=!1,P.state.isShown=!1,v=!1,d=!1,At()&&(ne.style.visibility="hidden"),ai(),ci(),ar(),At()){var ft=_t(),Nr=ft.box,Ln=ft.content;P.props.animation&&(zf([Nr,Ln],Dt),Zy([Nr,Ln],"hidden"))}si(),Jn(),P.props.animation?At()&&Ao(Dt,P.unmount):P.unmount()}}function Wr(X){gr().addEventListener("mousemove",M),Xy(nh,M),M(X)}function ls(){P.state.isVisible&&P.hide(),!!P.state.isMounted&&(Ji(),wr().forEach(function(X){X._tippy.unmount()}),ne.parentNode&&ne.parentNode.removeChild(ne),eg=eg.filter(function(X){return X!==P}),P.state.isMounted=!1,mr("onHidden",[P]))}function Ve(){P.state.isDestroyed||(P.clearDelayTimeouts(),P.unmount(),Zt(),delete t._tippy,P.state.isDestroyed=!0,mr("onDestroy",[P]))}}function bc(t,e){e===void 0&&(e={});var r=ho.plugins.concat(e.plugins||[]);qL();var o=Object.assign({},e,{plugins:r}),a=GL(t),l=a.reduce(function(d,A){var g=A&&iM(A,o);return g&&d.push(g),d},[]);return rh(t)?l[0]:l}bc.defaultProps=ho;bc.setDefaultProps=eM;bc.currentInput=Bo;Object.assign({},ky,{effect:function(e){var r=e.state,o={popper:{position:r.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(r.elements.popper.style,o.popper),r.styles=o,r.elements.arrow&&Object.assign(r.elements.arrow.style,o.arrow)}});bc.setDefaultProps({render:s_});class oM{constructor({editor:e,element:r,view:o,tippyOptions:a={},shouldShow:l}){this.preventHide=!1,this.shouldShow=({state:d,from:A,to:g})=>{const{doc:v,selection:C}=d,{empty:y}=C,w=!v.textBetween(A,g).length&&vy(d.selection);return!(y||w)},this.mousedownHandler=()=>{this.preventHide=!0},this.dragstartHandler=()=>{this.hide()},this.focusHandler=()=>{setTimeout(()=>this.update(this.editor.view))},this.blurHandler=({event:d})=>{var A;if(this.preventHide){this.preventHide=!1;return}(d==null?void 0:d.relatedTarget)&&((A=this.element.parentNode)===null||A===void 0?void 0:A.contains(d.relatedTarget))||this.hide()},this.editor=e,this.element=r,this.view=o,l&&(this.shouldShow=l),this.element.addEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.view.dom.addEventListener("dragstart",this.dragstartHandler),this.editor.on("focus",this.focusHandler),this.editor.on("blur",this.blurHandler),this.tippyOptions=a,this.element.remove(),this.element.style.visibility="visible"}createTooltip(){const{element:e}=this.editor.options,r=!!e.parentElement;this.tippy||!r||(this.tippy=bc(e,fe({duration:0,getReferenceClientRect:null,content:this.element,interactive:!0,trigger:"manual",placement:"top",hideOnClick:"toggle"},this.tippyOptions)))}update(e,r){var o,a;const{state:l,composing:d}=e,{doc:A,selection:g}=l,v=r&&r.doc.eq(A)&&r.selection.eq(g);if(d||v)return;this.createTooltip();const{ranges:C}=g,y=Math.min(...C.map(M=>M.$from.pos)),w=Math.max(...C.map(M=>M.$to.pos));if(!((o=this.shouldShow)===null||o===void 0?void 0:o.call(this,{editor:this.editor,view:e,state:l,oldState:r,from:y,to:w}))){this.hide();return}(a=this.tippy)===null||a===void 0||a.setProps({getReferenceClientRect:()=>{if(OB(l.selection)){const M=e.nodeDOM(y);if(M)return M.getBoundingClientRect()}return Ty(e,y,w)}}),this.show()}show(){var e;(e=this.tippy)===null||e===void 0||e.show()}hide(){var e;(e=this.tippy)===null||e===void 0||e.hide()}destroy(){var e;(e=this.tippy)===null||e===void 0||e.destroy(),this.element.removeEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.view.dom.removeEventListener("dragstart",this.dragstartHandler),this.editor.off("focus",this.focusHandler),this.editor.off("blur",this.blurHandler)}}const a_=t=>new ni({key:typeof t.pluginKey=="string"?new ii(t.pluginKey):t.pluginKey,view:e=>new oM(fe({view:e},t))});tn.create({name:"bubbleMenu",addOptions(){return{element:null,tippyOptions:{},pluginKey:"bubbleMenu",shouldShow:null}},addProseMirrorPlugins(){return this.options.element?[a_({pluginKey:this.options.pluginKey,editor:this.editor,element:this.options.element,tippyOptions:this.options.tippyOptions,shouldShow:this.options.shouldShow})]:[]}});class sM{constructor({editor:e,element:r,view:o,tippyOptions:a={},shouldShow:l}){this.preventHide=!1,this.shouldShow=({state:d})=>{const{selection:A}=d,{$anchor:g,empty:v}=A,C=g.depth===1,y=g.parent.isTextblock&&!g.parent.type.spec.code&&!g.parent.textContent;return!(!v||!C||!y)},this.mousedownHandler=()=>{this.preventHide=!0},this.focusHandler=()=>{setTimeout(()=>this.update(this.editor.view))},this.blurHandler=({event:d})=>{var A;if(this.preventHide){this.preventHide=!1;return}(d==null?void 0:d.relatedTarget)&&((A=this.element.parentNode)===null||A===void 0?void 0:A.contains(d.relatedTarget))||this.hide()},this.editor=e,this.element=r,this.view=o,l&&(this.shouldShow=l),this.element.addEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.editor.on("focus",this.focusHandler),this.editor.on("blur",this.blurHandler),this.tippyOptions=a,this.element.remove(),this.element.style.visibility="visible"}createTooltip(){const{element:e}=this.editor.options,r=!!e.parentElement;this.tippy||!r||(this.tippy=bc(e,fe({duration:0,getReferenceClientRect:null,content:this.element,interactive:!0,trigger:"manual",placement:"right",hideOnClick:"toggle"},this.tippyOptions)))}update(e,r){var o,a;const{state:l,composing:d}=e,{doc:A,selection:g}=l,{from:v,to:C}=g,y=r&&r.doc.eq(A)&&r.selection.eq(g);if(d||y)return;if(this.createTooltip(),!((o=this.shouldShow)===null||o===void 0?void 0:o.call(this,{editor:this.editor,view:e,state:l,oldState:r}))){this.hide();return}(a=this.tippy)===null||a===void 0||a.setProps({getReferenceClientRect:()=>Ty(e,v,C)}),this.show()}show(){var e;(e=this.tippy)===null||e===void 0||e.show()}hide(){var e;(e=this.tippy)===null||e===void 0||e.hide()}destroy(){var e;(e=this.tippy)===null||e===void 0||e.destroy(),this.element.removeEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.editor.off("focus",this.focusHandler),this.editor.off("blur",this.blurHandler)}}const c_=t=>new ni({key:typeof t.pluginKey=="string"?new ii(t.pluginKey):t.pluginKey,view:e=>new sM(fe({view:e},t))});tn.create({name:"floatingMenu",addOptions(){return{element:null,tippyOptions:{},pluginKey:"floatingMenu",shouldShow:null}},addProseMirrorPlugins(){return this.options.element?[c_({pluginKey:this.options.pluginKey,editor:this.editor,element:this.options.element,tippyOptions:this.options.tippyOptions,shouldShow:this.options.shouldShow})]:[]}});_n({name:"BubbleMenu",props:{pluginKey:{type:null,default:"bubbleMenu"},editor:{type:Object,required:!0},tippyOptions:{type:Object,default:()=>({})},shouldShow:{type:Function,default:null}},setup(t,{slots:e}){const r=Sn(null);return pc(()=>{const{pluginKey:o,editor:a,tippyOptions:l,shouldShow:d}=t;a.registerPlugin(a_({pluginKey:o,editor:a,element:r.value,tippyOptions:l,shouldShow:d}))}),Id(()=>{const{pluginKey:o,editor:a}=t;a.unregisterPlugin(o)}),()=>{var o;return ca("div",{ref:r},(o=e.default)===null||o===void 0?void 0:o.call(e))}}});_n({name:"EditorContent",props:{editor:{default:null,type:Object}},setup(t){const e=Sn(),r=Cd();return IN(()=>{const o=t.editor;o&&o.options.element&&e.value&&TA(()=>{if(!e.value||!o.options.element.firstChild)return;const a=Ei(e.value);e.value.append(...o.options.element.childNodes),o.contentComponent=r.ctx._,o.setOptions({element:a}),o.createNodeViews()})}),Id(()=>{const o=t.editor;if(!o||(o.isDestroyed||o.view.setProps({nodeViews:{}}),o.contentComponent=null,!o.options.element.firstChild))return;const a=document.createElement("div");a.append(...o.options.element.childNodes),o.setOptions({element:a})}),{rootEl:e}},render(){const t=[];return this.editor&&this.editor.vueRenderers.forEach(e=>{const r=ca(YI,{to:e.teleportElement,key:e.id},ca(e.component,fe({ref:e.id},e.props)));t.push(r)}),ca("div",{ref:e=>{this.rootEl=e}},...t)}});_n({name:"FloatingMenu",props:{pluginKey:{type:null,default:"floatingMenu"},editor:{type:Object,required:!0},tippyOptions:{type:Object,default:()=>({})},shouldShow:{type:Function,default:null}},setup(t,{slots:e}){const r=Sn(null);return pc(()=>{const{pluginKey:o,editor:a,tippyOptions:l,shouldShow:d}=t;a.registerPlugin(c_({pluginKey:o,editor:a,element:r.value,tippyOptions:l,shouldShow:d}))}),Id(()=>{const{pluginKey:o,editor:a}=t;a.unregisterPlugin(o)}),()=>{var o;return ca("div",{ref:r},(o=e.default)===null||o===void 0?void 0:o.call(e))}}});_n({props:{as:{type:String,default:"div"}},inject:["onDragStart","decorationClasses"],render(){var t,e;return ca(this.as,{class:this.decorationClasses.value,style:{whiteSpace:"normal"},"data-node-view-wrapper":"",onDragstart:this.onDragStart},(e=(t=this.$slots).default)===null||e===void 0?void 0:e.call(t))}});_n({props:{as:{type:String,default:"div"}},render(){return ca(this.as,{style:{whiteSpace:"pre-wrap"},"data-node-view-content":""})}});const aM=/^\s*>\s$/,cM=bn.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block*",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:t}){return["blockquote",kn(this.options.HTMLAttributes,t),0]},addCommands(){return{setBlockquote:()=>({commands:t})=>t.wrapIn("blockquote"),toggleBlockquote:()=>({commands:t})=>t.toggleWrap("blockquote"),unsetBlockquote:()=>({commands:t})=>t.lift("blockquote")}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[Jd({find:aM,type:this.type})]}}),lM=/(?:^|\s)((?:\*\*)((?:[^*]+))(?:\*\*))$/,uM=/(?:^|\s)((?:\*\*)((?:[^*]+))(?:\*\*))/g,dM=/(?:^|\s)((?:__)((?:[^__]+))(?:__))$/,hM=/(?:^|\s)((?:__)((?:[^__]+))(?:__))/g,pM=ks.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:t=>t.style.fontWeight!=="normal"&&null},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}]},renderHTML({HTMLAttributes:t}){return["strong",kn(this.options.HTMLAttributes,t),0]},addCommands(){return{setBold:()=>({commands:t})=>t.setMark("bold"),toggleBold:()=>({commands:t})=>t.toggleMark("bold"),unsetBold:()=>({commands:t})=>t.unsetMark("bold")}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold()}},addInputRules(){return[Ia({find:lM,type:this.type}),Ia({find:dM,type:this.type})]},addPasteRules(){return[Ca({find:uM,type:this.type}),Ca({find:hM,type:this.type})]}}),AM=/^\s*([-+*])\s$/,fM=bn.create({name:"bulletList",addOptions(){return{HTMLAttributes:{}}},group:"block list",content:"listItem+",parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:t}){return["ul",kn(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleBulletList:()=>({commands:t})=>t.toggleList("bulletList","listItem")}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){return[Jd({find:AM,type:this.type})]}}),gM=/(?:^|\s)((?:`)((?:[^`]+))(?:`))$/,mM=/(?:^|\s)((?:`)((?:[^`]+))(?:`))/g,vM=ks.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:t}){return["code",kn(this.options.HTMLAttributes,t),0]},addCommands(){return{setCode:()=>({commands:t})=>t.setMark("code"),toggleCode:()=>({commands:t})=>t.toggleMark("code"),unsetCode:()=>({commands:t})=>t.unsetMark("code")}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[Ia({find:gM,type:this.type})]},addPasteRules(){return[Ca({find:mM,type:this.type})]}}),EM=/^```(?<language>[a-z]*)?[\s\n]$/,IM=/^~~~(?<language>[a-z]*)?[\s\n]$/,CM=bn.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:null,parseHTML:t=>{var e;const{languageClassPrefix:r}=this.options,l=[...((e=t.firstElementChild)===null||e===void 0?void 0:e.classList)||[]].filter(d=>d.startsWith(r)).map(d=>d.replace(r,""))[0];return l||null},renderHTML:t=>t.language?{class:this.options.languageClassPrefix+t.language}:null}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({HTMLAttributes:t}){return["pre",this.options.HTMLAttributes,["code",t,0]]},addCommands(){return{setCodeBlock:t=>({commands:e})=>e.setNode("codeBlock",t),toggleCodeBlock:t=>({commands:e})=>e.toggleNode("codeBlock","paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:t,$anchor:e}=this.editor.state.selection,r=e.pos===1;return!t||e.parent.type.name!==this.name?!1:r||!e.parent.textContent.length?this.editor.commands.clearNodes():!1}}},addInputRules(){return[Ff({find:EM,type:this.type,getAttributes:({groups:t})=>t}),Ff({find:IM,type:this.type,getAttributes:({groups:t})=>t})]},addProseMirrorPlugins(){return[new ni({key:new ii("codeBlockVSCodeHandler"),props:{handlePaste:(t,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const r=e.clipboardData.getData("text/plain"),o=e.clipboardData.getData("vscode-editor-data"),a=o?JSON.parse(o):void 0,l=a==null?void 0:a.mode;if(!r||!l)return!1;const{tr:d}=t.state;return d.replaceSelectionWith(this.type.create({language:l})),d.setSelection(Ot.near(d.doc.resolve(Math.max(0,d.selection.from-2)))),d.insertText(r.replace(/\r\n?/g,`
`)),d.setMeta("paste",!0),t.dispatch(d),!0}}})]}}),yM=bn.create({name:"doc",topNode:!0,content:"block+"});function _M(t){return t===void 0&&(t={}),new ni({view:function(r){return new Lo(r,t)}})}var Lo=function(e,r){var o=this;this.editorView=e,this.width=r.width||1,this.color=r.color||"black",this.class=r.class,this.cursorPos=null,this.element=null,this.timeout=null,this.handlers=["dragover","dragend","drop","dragleave"].map(function(a){var l=function(d){return o[a](d)};return e.dom.addEventListener(a,l),{name:a,handler:l}})};Lo.prototype.destroy=function(){var e=this;this.handlers.forEach(function(r){var o=r.name,a=r.handler;return e.editorView.dom.removeEventListener(o,a)})};Lo.prototype.update=function(e,r){this.cursorPos!=null&&r.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())};Lo.prototype.setCursor=function(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())};Lo.prototype.updateOverlay=function(){var e=this.editorView.state.doc.resolve(this.cursorPos),r;if(!e.parent.inlineContent){var o=e.nodeBefore,a=e.nodeAfter;if(o||a){var l=this.editorView.nodeDOM(this.cursorPos-(o?o.nodeSize:0)).getBoundingClientRect(),d=o?l.bottom:l.top;o&&a&&(d=(d+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),r={left:l.left,right:l.right,top:d-this.width/2,bottom:d+this.width/2}}}if(!r){var A=this.editorView.coordsAtPos(this.cursorPos);r={left:A.left-this.width/2,right:A.left+this.width/2,top:A.top,bottom:A.bottom}}var g=this.editorView.dom.offsetParent;this.element||(this.element=g.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none; background-color: "+this.color);var v,C;if(!g||g==document.body&&getComputedStyle(g).position=="static")v=-pageXOffset,C=-pageYOffset;else{var y=g.getBoundingClientRect();v=y.left-g.scrollLeft,C=y.top-g.scrollTop}this.element.style.left=r.left-v+"px",this.element.style.top=r.top-C+"px",this.element.style.width=r.right-r.left+"px",this.element.style.height=r.bottom-r.top+"px"};Lo.prototype.scheduleRemoval=function(e){var r=this;clearTimeout(this.timeout),this.timeout=setTimeout(function(){return r.setCursor(null)},e)};Lo.prototype.dragover=function(e){if(!!this.editorView.editable){var r=this.editorView.posAtCoords({left:e.clientX,top:e.clientY});if(r){var o=r.pos;if(this.editorView.dragging&&this.editorView.dragging.slice&&(o=MC(this.editorView.state.doc,o,this.editorView.dragging.slice),o==null))return this.setCursor(null);this.setCursor(o),this.scheduleRemoval(5e3)}}};Lo.prototype.dragend=function(){this.scheduleRemoval(20)};Lo.prototype.drop=function(){this.scheduleRemoval(20)};Lo.prototype.dragleave=function(e){(e.target==this.editorView.dom||!this.editorView.dom.contains(e.relatedTarget))&&this.setCursor(null)};const SM=tn.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:null}},addProseMirrorPlugins(){return[_M(this.options)]}});var po=function(t){function e(r){t.call(this,r,r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.map=function(o,a){var l=o.resolve(a.map(this.head));return e.valid(l)?new e(l):t.near(l)},e.prototype.content=function(){return ye.empty},e.prototype.eq=function(o){return o instanceof e&&o.head==this.head},e.prototype.toJSON=function(){return{type:"gapcursor",pos:this.head}},e.fromJSON=function(o,a){if(typeof a.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new e(o.resolve(a.pos))},e.prototype.getBookmark=function(){return new ih(this.anchor)},e.valid=function(o){var a=o.parent;if(a.isTextblock||!TM(o)||!RM(o))return!1;var l=a.type.spec.allowGapCursor;if(l!=null)return l;var d=a.contentMatchAt(o.index()).defaultType;return d&&d.isTextblock},e.findFrom=function(o,a,l){e:for(;;){if(!l&&e.valid(o))return o;for(var d=o.pos,A=null,g=o.depth;;g--){var v=o.node(g);if(a>0?o.indexAfter(g)<v.childCount:o.index(g)>0){A=v.child(a>0?o.indexAfter(g):o.index(g)-1);break}else if(g==0)return null;d+=a;var C=o.doc.resolve(d);if(e.valid(C))return C}for(;;){var y=a>0?A.firstChild:A.lastChild;if(!y){if(A.isAtom&&!A.isText&&!et.isSelectable(A)){o=o.doc.resolve(d+A.nodeSize*a),l=!1;continue e}break}A=y,d+=a;var w=o.doc.resolve(d);if(e.valid(w))return w}return null}},e}(nt);po.prototype.visible=!1;nt.jsonID("gapcursor",po);var ih=function(e){this.pos=e};ih.prototype.map=function(e){return new ih(e.map(this.pos))};ih.prototype.resolve=function(e){var r=e.resolve(this.pos);return po.valid(r)?new po(r):nt.near(r)};function TM(t){for(var e=t.depth;e>=0;e--){var r=t.index(e);if(r!=0)for(var o=t.node(e).child(r-1);;o=o.lastChild){if(o.childCount==0&&!o.inlineContent||o.isAtom||o.type.spec.isolating)return!0;if(o.inlineContent)return!1}}return!0}function RM(t){for(var e=t.depth;e>=0;e--){var r=t.indexAfter(e),o=t.node(e);if(r!=o.childCount)for(var a=o.child(r);;a=a.firstChild){if(a.childCount==0&&!a.inlineContent||a.isAtom||a.type.spec.isolating)return!0;if(a.inlineContent)return!1}}return!0}var wM=function(){return new ni({props:{decorations:kM,createSelectionBetween:function(e,r,o){if(r.pos==o.pos&&po.valid(o))return new po(o)},handleClick:OM,handleKeyDown:NM}})},NM=Eb({ArrowLeft:oh("horiz",-1),ArrowRight:oh("horiz",1),ArrowUp:oh("vert",-1),ArrowDown:oh("vert",1)});function oh(t,e){var r=t=="vert"?e>0?"down":"up":e>0?"right":"left";return function(o,a,l){var d=o.selection,A=e>0?d.$to:d.$from,g=d.empty;if(d instanceof Ot){if(!l.endOfTextblock(r)||A.depth==0)return!1;g=!1,A=o.doc.resolve(e>0?A.after():A.before())}var v=po.findFrom(A,e,g);return v?(a&&a(o.tr.setSelection(new po(v))),!0):!1}}function OM(t,e,r){if(!t.editable)return!1;var o=t.state.doc.resolve(e);if(!po.valid(o))return!1;var a=t.posAtCoords({left:r.clientX,top:r.clientY}),l=a.inside;return l>-1&&et.isSelectable(t.state.doc.nodeAt(l))?!1:(t.dispatch(t.state.tr.setSelection(new po(o))),!0)}function kM(t){if(!(t.selection instanceof po))return null;var e=document.createElement("div");return e.className="ProseMirror-gapcursor",Ut.create(t.doc,[Pr.widget(t.selection.head,e,{key:"gapcursor"})])}const bM=tn.create({name:"gapCursor",addProseMirrorPlugins(){return[wM()]},extendNodeSchema(t){var e;const r={name:t.name,options:t.options,storage:t.storage};return{allowGapCursor:(e=Er(Hr(t,"allowGapCursor",r)))!==null&&e!==void 0?e:null}}}),DM=bn.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:t}){return["br",kn(this.options.HTMLAttributes,t)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:t,chain:e,state:r,editor:o})=>t.first([()=>t.exitCode(),()=>t.command(()=>{const{selection:a,storedMarks:l}=r;if(a.$from.parent.type.spec.isolating)return!1;const{keepMarks:d}=this.options,{splittableMarks:A}=o.extensionManager,g=l||a.$to.parentOffset&&a.$from.marks();return e().insertContent({type:this.name}).command(({tr:v,dispatch:C})=>{if(C&&g&&d){const y=g.filter(w=>A.includes(w.type.name));v.ensureMarks(y)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),BM=bn.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(t=>({tag:`h${t}`,attrs:{level:t}}))},renderHTML({node:t,HTMLAttributes:e}){return[`h${this.options.levels.includes(t.attrs.level)?t.attrs.level:this.options.levels[0]}`,kn(this.options.HTMLAttributes,e),0]},addCommands(){return{setHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.setNode("heading",t):!1,toggleHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.toggleNode("heading","paragraph",t):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((t,e)=>hc(fe({},t),{[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(t=>Ff({find:new RegExp(`^(#{1,${t}})\\s$`),type:this.type,getAttributes:{level:t}}))}});var sh=200,An=function(){};An.prototype.append=function(e){return e.length?(e=An.from(e),!this.length&&e||e.length<sh&&this.leafAppend(e)||this.length<sh&&e.leafPrepend(this)||this.appendInner(e)):this};An.prototype.prepend=function(e){return e.length?An.from(e).append(this):this};An.prototype.appendInner=function(e){return new LM(this,e)};An.prototype.slice=function(e,r){return e===void 0&&(e=0),r===void 0&&(r=this.length),e>=r?An.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,r))};An.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};An.prototype.forEach=function(e,r,o){r===void 0&&(r=0),o===void 0&&(o=this.length),r<=o?this.forEachInner(e,r,o,0):this.forEachInvertedInner(e,r,o,0)};An.prototype.map=function(e,r,o){r===void 0&&(r=0),o===void 0&&(o=this.length);var a=[];return this.forEach(function(l,d){return a.push(e(l,d))},r,o),a};An.from=function(e){return e instanceof An?e:e&&e.length?new l_(e):An.empty};var l_=function(t){function e(o){t.call(this),this.values=o}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(a,l){return a==0&&l==this.length?this:new e(this.values.slice(a,l))},e.prototype.getInner=function(a){return this.values[a]},e.prototype.forEachInner=function(a,l,d,A){for(var g=l;g<d;g++)if(a(this.values[g],A+g)===!1)return!1},e.prototype.forEachInvertedInner=function(a,l,d,A){for(var g=l-1;g>=d;g--)if(a(this.values[g],A+g)===!1)return!1},e.prototype.leafAppend=function(a){if(this.length+a.length<=sh)return new e(this.values.concat(a.flatten()))},e.prototype.leafPrepend=function(a){if(this.length+a.length<=sh)return new e(a.flatten().concat(this.values))},r.length.get=function(){return this.values.length},r.depth.get=function(){return 0},Object.defineProperties(e.prototype,r),e}(An);An.empty=new l_([]);var LM=function(t){function e(r,o){t.call(this),this.left=r,this.right=o,this.length=r.length+o.length,this.depth=Math.max(r.depth,o.depth)+1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(o){return o<this.left.length?this.left.get(o):this.right.get(o-this.left.length)},e.prototype.forEachInner=function(o,a,l,d){var A=this.left.length;if(a<A&&this.left.forEachInner(o,a,Math.min(l,A),d)===!1||l>A&&this.right.forEachInner(o,Math.max(a-A,0),Math.min(this.length,l)-A,d+A)===!1)return!1},e.prototype.forEachInvertedInner=function(o,a,l,d){var A=this.left.length;if(a>A&&this.right.forEachInvertedInner(o,a-A,Math.max(l,A)-A,d+A)===!1||l<A&&this.left.forEachInvertedInner(o,Math.min(a,A),l,d)===!1)return!1},e.prototype.sliceInner=function(o,a){if(o==0&&a==this.length)return this;var l=this.left.length;return a<=l?this.left.slice(o,a):o>=l?this.right.slice(o-l,a-l):this.left.slice(o,l).append(this.right.slice(0,a-l))},e.prototype.leafAppend=function(o){var a=this.right.leafAppend(o);if(a)return new e(this.left,a)},e.prototype.leafPrepend=function(o){var a=this.left.leafPrepend(o);if(a)return new e(a,this.right)},e.prototype.appendInner=function(o){return this.left.depth>=Math.max(this.right.depth,o.depth)+1?new e(this.left,new e(this.right,o)):new e(this,o)},e}(An),u_=An,MM=500,fn=function(e,r){this.items=e,this.eventCount=r};fn.prototype.popEvent=function(e,r){var o=this;if(this.eventCount==0)return null;for(var a=this.items.length;;a--){var l=this.items.get(a-1);if(l.selection){--a;break}}var d,A;r&&(d=this.remapping(a,this.items.length),A=d.maps.length);var g=e.tr,v,C,y=[],w=[];return this.items.forEach(function(k,M){if(!k.step){d||(d=o.remapping(a,M+1),A=d.maps.length),A--,w.push(k);return}if(d){w.push(new Mo(k.map));var F=k.step.map(d.slice(A)),K;F&&g.maybeStep(F).doc&&(K=g.mapping.maps[g.mapping.maps.length-1],y.push(new Mo(K,null,null,y.length+w.length))),A--,K&&d.appendMap(K,A)}else g.maybeStep(k.step);if(k.selection)return v=d?k.selection.map(d.slice(A)):k.selection,C=new fn(o.items.slice(0,a).append(w.reverse().concat(y)),o.eventCount-1),!1},this.items.length,0),{remaining:C,transform:g,selection:v}};fn.prototype.addTransform=function(e,r,o,a){for(var l=[],d=this.eventCount,A=this.items,g=!a&&A.length?A.get(A.length-1):null,v=0;v<e.steps.length;v++){var C=e.steps[v].invert(e.docs[v]),y=new Mo(e.mapping.maps[v],C,r),w=void 0;(w=g&&g.merge(y))&&(y=w,v?l.pop():A=A.slice(0,A.length-1)),l.push(y),r&&(d++,r=null),a||(g=y)}var k=d-o.depth;return k>QM&&(A=PM(A,k),d-=k),new fn(A.append(l),d)};fn.prototype.remapping=function(e,r){var o=new wn;return this.items.forEach(function(a,l){var d=a.mirrorOffset!=null&&l-a.mirrorOffset>=e?o.maps.length-a.mirrorOffset:null;o.appendMap(a.map,d)},e,r),o};fn.prototype.addMaps=function(e){return this.eventCount==0?this:new fn(this.items.append(e.map(function(r){return new Mo(r)})),this.eventCount)};fn.prototype.rebased=function(e,r){if(!this.eventCount)return this;var o=[],a=Math.max(0,this.items.length-r),l=e.mapping,d=e.steps.length,A=this.eventCount;this.items.forEach(function(k){k.selection&&A--},a);var g=r;this.items.forEach(function(k){var M=l.getMirror(--g);if(M!=null){d=Math.min(d,M);var F=l.maps[M];if(k.step){var K=e.steps[M].invert(e.docs[M]),J=k.selection&&k.selection.map(l.slice(g+1,M));J&&A++,o.push(new Mo(F,K,J))}else o.push(new Mo(F))}},a);for(var v=[],C=r;C<d;C++)v.push(new Mo(l.maps[C]));var y=this.items.slice(0,a).append(v).append(o),w=new fn(y,A);return w.emptyItemCount()>MM&&(w=w.compress(this.items.length-o.length)),w};fn.prototype.emptyItemCount=function(){var e=0;return this.items.forEach(function(r){r.step||e++}),e};fn.prototype.compress=function(e){e===void 0&&(e=this.items.length);var r=this.remapping(0,e),o=r.maps.length,a=[],l=0;return this.items.forEach(function(d,A){if(A>=e)a.push(d),d.selection&&l++;else if(d.step){var g=d.step.map(r.slice(o)),v=g&&g.getMap();if(o--,v&&r.appendMap(v,o),g){var C=d.selection&&d.selection.map(r.slice(o));C&&l++;var y=new Mo(v.invert(),g,C),w,k=a.length-1;(w=a.length&&a[k].merge(y))?a[k]=w:a.push(y)}}else d.map&&o--},this.items.length,0),new fn(u_.from(a.reverse()),l)};fn.empty=new fn(u_.empty,0);function PM(t,e){var r;return t.forEach(function(o,a){if(o.selection&&e--==0)return r=a,!1}),t.slice(r)}var Mo=function(e,r,o,a){this.map=e,this.step=r,this.selection=o,this.mirrorOffset=a};Mo.prototype.merge=function(e){if(this.step&&e.step&&!e.selection){var r=e.step.merge(this.step);if(r)return new Mo(r.getMap().invert(),r,this.selection)}};var Bs=function(e,r,o,a){this.done=e,this.undone=r,this.prevRanges=o,this.prevTime=a},QM=20;function xM(t,e,r,o){var a=r.getMeta(Ls),l;if(a)return a.historyState;r.getMeta(FM)&&(t=new Bs(t.done,t.undone,null,0));var d=r.getMeta("appendedTransaction");if(r.steps.length==0)return t;if(d&&d.getMeta(Ls))return d.getMeta(Ls).redo?new Bs(t.done.addTransform(r,null,o,ah(e)),t.undone,d_(r.mapping.maps[r.steps.length-1]),t.prevTime):new Bs(t.done,t.undone.addTransform(r,null,o,ah(e)),null,t.prevTime);if(r.getMeta("addToHistory")!==!1&&!(d&&d.getMeta("addToHistory")===!1)){var A=t.prevTime==0||!d&&(t.prevTime<(r.time||0)-o.newGroupDelay||!UM(r,t.prevRanges)),g=d?tg(t.prevRanges,r.mapping):d_(r.mapping.maps[r.steps.length-1]);return new Bs(t.done.addTransform(r,A?e.selection.getBookmark():null,o,ah(e)),fn.empty,g,r.time)}else return(l=r.getMeta("rebased"))?new Bs(t.done.rebased(r,l),t.undone.rebased(r,l),tg(t.prevRanges,r.mapping),t.prevTime):new Bs(t.done.addMaps(r.mapping.maps),t.undone.addMaps(r.mapping.maps),tg(t.prevRanges,r.mapping),t.prevTime)}function UM(t,e){if(!e)return!1;if(!t.docChanged)return!0;var r=!1;return t.mapping.maps[0].forEach(function(o,a){for(var l=0;l<e.length;l+=2)o<=e[l+1]&&a>=e[l]&&(r=!0)}),r}function d_(t){var e=[];return t.forEach(function(r,o,a,l){return e.push(a,l)}),e}function tg(t,e){if(!t)return null;for(var r=[],o=0;o<t.length;o+=2){var a=e.map(t[o],1),l=e.map(t[o+1],-1);a<=l&&r.push(a,l)}return r}function h_(t,e,r,o){var a=ah(e),l=Ls.get(e).spec.config,d=(o?t.undone:t.done).popEvent(e,a);if(!!d){var A=d.selection.resolve(d.transform.doc),g=(o?t.done:t.undone).addTransform(d.transform,e.selection.getBookmark(),l,a),v=new Bs(o?g:d.remaining,o?d.remaining:g,null,0);r(d.transform.setSelection(A).setMeta(Ls,{redo:o,historyState:v}).scrollIntoView())}}var rg=!1,p_=null;function ah(t){var e=t.plugins;if(p_!=e){rg=!1,p_=e;for(var r=0;r<e.length;r++)if(e[r].spec.historyPreserveItems){rg=!0;break}}return rg}var Ls=new ii("history"),FM=new ii("closeHistory");function VM(t){return t={depth:t&&t.depth||100,newGroupDelay:t&&t.newGroupDelay||500},new ni({key:Ls,state:{init:function(){return new Bs(fn.empty,fn.empty,null,0)},apply:function(r,o,a){return xM(o,a,r,t)}},config:t,props:{handleDOMEvents:{beforeinput:function(r,o){var a=o.inputType=="historyUndo"?A_(r.state,r.dispatch):o.inputType=="historyRedo"?f_(r.state,r.dispatch):!1;return a&&o.preventDefault(),a}}}})}function A_(t,e){var r=Ls.getState(t);return!r||r.done.eventCount==0?!1:(e&&h_(r,t,e,!1),!0)}function f_(t,e){var r=Ls.getState(t);return!r||r.undone.eventCount==0?!1:(e&&h_(r,t,e,!0),!0)}const GM=tn.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:t,dispatch:e})=>A_(t,e),redo:()=>({state:t,dispatch:e})=>f_(t,e)}},addProseMirrorPlugins(){return[VM(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Mod-y":()=>this.editor.commands.redo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-\u044F":()=>this.editor.commands.undo(),"Shift-Mod-\u044F":()=>this.editor.commands.redo()}}}),jM=bn.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:t}){return["hr",kn(this.options.HTMLAttributes,t)]},addCommands(){return{setHorizontalRule:()=>({chain:t})=>t().command(({tr:e,dispatch:r})=>{const{selection:o}=e,{empty:a,$anchor:l}=o,d=l.parent.isTextblock&&!l.parent.type.spec.code&&!l.parent.textContent;if(!a||!d||!r)return!0;const A=l.before(),g=l.start();return e.deleteRange(A,g),e.setSelection(Ot.create(e.doc,A)),!0}).insertContent({type:this.name}).command(({tr:e,dispatch:r})=>{var o;if(r){const{parent:a,pos:l}=e.selection.$from,d=l+1;if(!e.doc.nodeAt(d)){const g=(o=a.type.contentMatch.defaultType)===null||o===void 0?void 0:o.create();g&&(e.insert(d,g),e.setSelection(Ot.create(e.doc,d)))}e.scrollIntoView()}return!0}).run()}},addInputRules(){return[NB({find:/^(?:---|-|___\s|\*\*\*\s)$/,type:this.type})]}}),HM=/(?:^|\s)((?:\*)((?:[^*]+))(?:\*))$/,KM=/(?:^|\s)((?:\*)((?:[^*]+))(?:\*))/g,WM=/(?:^|\s)((?:_)((?:[^_]+))(?:_))$/,YM=/(?:^|\s)((?:_)((?:[^_]+))(?:_))/g,qM=ks.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:t=>t.style.fontStyle!=="normal"&&null},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:t}){return["em",kn(this.options.HTMLAttributes,t),0]},addCommands(){return{setItalic:()=>({commands:t})=>t.setMark("italic"),toggleItalic:()=>({commands:t})=>t.toggleMark("italic"),unsetItalic:()=>({commands:t})=>t.unsetMark("italic")}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[Ia({find:HM,type:this.type}),Ia({find:WM,type:this.type})]},addPasteRules(){return[Ca({find:KM,type:this.type}),Ca({find:YM,type:this.type})]}}),JM=bn.create({name:"listItem",addOptions(){return{HTMLAttributes:{}}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",kn(this.options.HTMLAttributes,t),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem("listItem"),Tab:()=>this.editor.commands.sinkListItem("listItem"),"Shift-Tab":()=>this.editor.commands.liftListItem("listItem")}}}),zM=/^(\d+)\.\s$/,XM=bn.create({name:"orderedList",addOptions(){return{HTMLAttributes:{}}},group:"block list",content:"listItem+",addAttributes(){return{start:{default:1,parseHTML:t=>t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:t}){const o=t,{start:e}=o,r=WI(o,["start"]);return e===1?["ol",kn(this.options.HTMLAttributes,r),0]:["ol",kn(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleOrderedList:()=>({commands:t})=>t.toggleList("orderedList","listItem")}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){return[Jd({find:zM,type:this.type,getAttributes:t=>({start:+t[1]}),joinPredicate:(t,e)=>e.childCount+e.attrs.start===+t[1]})]}}),$M=bn.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",kn(this.options.HTMLAttributes,t),0]},addCommands(){return{setParagraph:()=>({commands:t})=>t.setNode("paragraph")}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),ZM=/(?:^|\s)((?:~~)((?:[^~]+))(?:~~))$/,eP=/(?:^|\s)((?:~~)((?:[^~]+))(?:~~))/g,tP=ks.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["s",kn(this.options.HTMLAttributes,t),0]},addCommands(){return{setStrike:()=>({commands:t})=>t.setMark("strike"),toggleStrike:()=>({commands:t})=>t.toggleMark("strike"),unsetStrike:()=>({commands:t})=>t.unsetMark("strike")}},addKeyboardShortcuts(){return{"Mod-Shift-x":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[Ia({find:ZM,type:this.type})]},addPasteRules(){return[Ca({find:eP,type:this.type})]}}),rP=bn.create({name:"text",group:"inline"});tn.create({name:"starterKit",addExtensions(){var t,e,r,o,a,l,d,A,g,v,C,y,w,k,M,F,K,J;const U=[];return this.options.blockquote!==!1&&U.push(cM.configure((t=this.options)===null||t===void 0?void 0:t.blockquote)),this.options.bold!==!1&&U.push(pM.configure((e=this.options)===null||e===void 0?void 0:e.bold)),this.options.bulletList!==!1&&U.push(fM.configure((r=this.options)===null||r===void 0?void 0:r.bulletList)),this.options.code!==!1&&U.push(vM.configure((o=this.options)===null||o===void 0?void 0:o.code)),this.options.codeBlock!==!1&&U.push(CM.configure((a=this.options)===null||a===void 0?void 0:a.codeBlock)),this.options.document!==!1&&U.push(yM.configure((l=this.options)===null||l===void 0?void 0:l.document)),this.options.dropcursor!==!1&&U.push(SM.configure((d=this.options)===null||d===void 0?void 0:d.dropcursor)),this.options.gapcursor!==!1&&U.push(bM.configure((A=this.options)===null||A===void 0?void 0:A.gapcursor)),this.options.hardBreak!==!1&&U.push(DM.configure((g=this.options)===null||g===void 0?void 0:g.hardBreak)),this.options.heading!==!1&&U.push(BM.configure((v=this.options)===null||v===void 0?void 0:v.heading)),this.options.history!==!1&&U.push(GM.configure((C=this.options)===null||C===void 0?void 0:C.history)),this.options.horizontalRule!==!1&&U.push(jM.configure((y=this.options)===null||y===void 0?void 0:y.horizontalRule)),this.options.italic!==!1&&U.push(qM.configure((w=this.options)===null||w===void 0?void 0:w.italic)),this.options.listItem!==!1&&U.push(JM.configure((k=this.options)===null||k===void 0?void 0:k.listItem)),this.options.orderedList!==!1&&U.push(XM.configure((M=this.options)===null||M===void 0?void 0:M.orderedList)),this.options.paragraph!==!1&&U.push($M.configure((F=this.options)===null||F===void 0?void 0:F.paragraph)),this.options.strike!==!1&&U.push(tP.configure((K=this.options)===null||K===void 0?void 0:K.strike)),this.options.text!==!1&&U.push(rP.configure((J=this.options)===null||J===void 0?void 0:J.text)),U}});const nP=(t,e)=>{let r=0,o=0;for(;r<t.length&&r<e.length&&t[r]===e[r];)r++;if(r!==t.length||r!==e.length)for(;o+r<t.length&&o+r<e.length&&t[t.length-o-1]===e[e.length-o-1];)o++;return{index:r,remove:t.length-r-o,insert:e.slice(r,e.length-o)}},iP=nP,Qr=new ii("y-sync"),_a=new ii("y-undo"),ch=new ii("yjs-cursor"),lh=(t,e)=>e===void 0?!t.deleted:e.sv.has(t.id.client)&&e.sv.get(t.id.client)>t.id.clock&&!xN(e.ds,t.id),oP=[{light:"#ecd44433",dark:"#ecd444"}],sP=(t,e,r)=>{if(!t.has(r)){if(t.size<e.length){const o=WN();t.forEach(a=>o.add(a)),e=e.filter(a=>!o.has(a))}t.set(r,jN(e))}return t.get(r)},aP=(t,{colors:e=oP,colorMapping:r=new Map,permanentUserData:o=null}={})=>{let a=!1;const l=new ni({props:{editable:d=>{const A=Qr.getState(d);return A.snapshot==null&&A.prevSnapshot==null}},key:Qr,state:{init:(d,A)=>({type:t,doc:t.doc,binding:null,snapshot:null,prevSnapshot:null,isChangeOrigin:!1,colors:e,colorMapping:r,permanentUserData:o}),apply:(d,A)=>{const g=d.getMeta(Qr);if(g!==void 0){A=Object.assign({},A);for(const v in g)A[v]=g[v]}return A.isChangeOrigin=g!==void 0&&!!g.isChangeOrigin,A.binding!==null&&g!==void 0&&(g.snapshot!=null||g.prevSnapshot!=null)&&setTimeout(()=>{g.restore==null?A.binding._renderSnapshot(g.snapshot,g.prevSnapshot,A):(A.binding._renderSnapshot(g.snapshot,g.snapshot,A),delete A.restore,delete A.snapshot,delete A.prevSnapshot,A.binding._prosemirrorChanged(A.binding.prosemirrorView.state.doc))},0),A}},view:d=>{const A=new lP(t,d);return setTimeout(()=>{A._forceRerender(),d.dispatch(d.state.tr.setMeta(Qr,{binding:A}))},0),{update:()=>{const g=l.getState(d.state);g.snapshot==null&&g.prevSnapshot==null&&(a||d.state.doc.content.findDiffStart(d.state.doc.type.createAndFill().content)!==null)&&(a=!0,A._prosemirrorChanged(d.state.doc))},destroy:()=>{A.destroy()}}}});return l},cP=(t,e,r)=>{if(e!==null&&e.anchor!==null&&e.head!==null){const o=nu(r.doc,r.type,e.anchor,r.mapping),a=nu(r.doc,r.type,e.head,r.mapping);o!==null&&a!==null&&(t=t.setSelection(Ot.create(t.doc,o,a)))}},ng=(t,e)=>({anchor:ph(e.selection.anchor,t.type,t.mapping),head:ph(e.selection.head,t.type,t.mapping)});class lP{constructor(e,r){this.type=e,this.prosemirrorView=r,this.mux=LN(),this.mapping=new Map,this._observeFunction=this._typeChanged.bind(this),this.doc=e.doc,this.beforeTransactionSelection=null,this.beforeAllTransactions=()=>{this.beforeTransactionSelection===null&&(this.beforeTransactionSelection=ng(this,r.state))},this.afterAllTransactions=()=>{this.beforeTransactionSelection=null},this.doc.on("beforeAllTransactions",this.beforeAllTransactions),this.doc.on("afterAllTransactions",this.afterAllTransactions),e.observeDeep(this._observeFunction),this._domSelectionInView=null}_isLocalCursorInView(){return this.prosemirrorView.hasFocus()?(MN&&this._domSelectionInView===null&&(setTimeout(()=>{this._domSelectionInView=null},0),this._domSelectionInView=this._isDomSelectionInView()),this._domSelectionInView):!1}_isDomSelectionInView(){const e=this.prosemirrorView._root.getSelection(),r=this.prosemirrorView._root.createRange();r.setStart(e.anchorNode,e.anchorOffset),r.setEnd(e.focusNode,e.focusOffset),r.getClientRects().length===0&&r.startContainer&&r.collapsed&&r.selectNodeContents(r.startContainer);const a=r.getBoundingClientRect(),l=PN.documentElement;return a.bottom>=0&&a.right>=0&&a.left<=(window.innerWidth||l.clientWidth||0)&&a.top<=(window.innerHeight||l.clientHeight||0)}renderSnapshot(e,r){r||(r=VN(GN(),new Map)),this.prosemirrorView.dispatch(this.prosemirrorView.state.tr.setMeta(Qr,{snapshot:e,prevSnapshot:r}))}unrenderSnapshot(){this.mapping=new Map,this.mux(()=>{const e=this.type.toArray().map(o=>uh(o,this.prosemirrorView.state.schema,this.mapping)).filter(o=>o!==null),r=this.prosemirrorView.state.tr.replace(0,this.prosemirrorView.state.doc.content.size,new ye(new ee(e),0,0));r.setMeta(Qr,{snapshot:null,prevSnapshot:null}),this.prosemirrorView.dispatch(r)})}_forceRerender(){this.mapping=new Map,this.mux(()=>{const e=this.type.toArray().map(o=>uh(o,this.prosemirrorView.state.schema,this.mapping)).filter(o=>o!==null),r=this.prosemirrorView.state.tr.replace(0,this.prosemirrorView.state.doc.content.size,new ye(new ee(e),0,0));this.prosemirrorView.dispatch(r)})}_renderSnapshot(e,r,o){e||(e=QN(this.doc)),this.mapping=new Map,this.mux(()=>{this.doc.transact(a=>{const l=o.permanentUserData;l&&l.dss.forEach(v=>{rC(a,v,C=>{})});const d=(v,C)=>{const y=v==="added"?l.getUserByClientId(C.client):l.getUserByDeletedId(C);return{user:y,type:v,color:sP(o.colorMapping,o.colors,y)}},A=nC(this.type,new iC(r.ds,e.sv)).map(v=>!v._item.deleted||lh(v._item,e)||lh(v._item,r)?uh(v,this.prosemirrorView.state.schema,new Map,e,r,d):null).filter(v=>v!==null),g=this.prosemirrorView.state.tr.replace(0,this.prosemirrorView.state.doc.content.size,new ye(new ee(A),0,0));this.prosemirrorView.dispatch(g)},Qr)})}_typeChanged(e,r){const o=Qr.getState(this.prosemirrorView.state);if(e.length===0||o.snapshot!=null||o.prevSnapshot!=null){this.renderSnapshot(o.snapshot,o.prevSnapshot);return}this.mux(()=>{const a=(A,g)=>this.mapping.delete(g);rC(r,r.deleteSet,A=>A.constructor===oC&&this.mapping.delete(A.content.type)),r.changed.forEach(a),r.changedParentTypes.forEach(a);const l=this.type.toArray().map(A=>g_(A,this.prosemirrorView.state.schema,this.mapping)).filter(A=>A!==null);let d=this.prosemirrorView.state.tr.replace(0,this.prosemirrorView.state.doc.content.size,new ye(new ee(l),0,0));cP(d,this.beforeTransactionSelection,this),d=d.setMeta(Qr,{isChangeOrigin:!0}),this.beforeTransactionSelection!==null&&this._isLocalCursorInView()&&d.scrollIntoView(),this.prosemirrorView.dispatch(d)})}_prosemirrorChanged(e){this.mux(()=>{this.doc.transact(()=>{sg(this.doc,this.type,e,this.mapping),this.beforeTransactionSelection=ng(this,this.prosemirrorView.state)},Qr)})}destroy(){this.type.unobserveDeep(this._observeFunction),this.doc.off("beforeAllTransactions",this.beforeAllTransactions),this.doc.off("afterAllTransactions",this.afterAllTransactions)}}const g_=(t,e,r,o,a,l)=>{const d=r.get(t);if(d===void 0){if(t instanceof Zo)return uh(t,e,r,o,a,l);throw UN()}return d},uh=(t,e,r,o,a,l)=>{const d=[],A=g=>{if(g.constructor===Zo){const v=g_(g,e,r,o,a,l);v!==null&&d.push(v)}else{const v=uP(g,e,r,o,a,l);v!==null&&v.forEach(C=>{C!==null&&d.push(C)})}};o===void 0||a===void 0?t.toArray().forEach(A):nC(t,new iC(a.ds,o.sv)).forEach(A);try{const g=t.getAttributes(o);o!==void 0&&(lh(t._item,o)?lh(t._item,a)||(g.ychange=l?l("added",t._item.id):{type:"added"}):g.ychange=l?l("removed",t._item.id):{type:"removed"});const v=e.node(t.nodeName,g,d);return r.set(t,v),v}catch{return t.doc.transact(v=>{t._item.delete(v)},Qr),r.delete(t),null}},uP=(t,e,r,o,a,l)=>{const d=[],A=t.toDelta(o,a,l);try{for(let g=0;g<A.length;g++){const v=A[g],C=[];for(const y in v.attributes)C.push(e.mark(y,v.attributes[y]));d.push(e.text(v.insert,C))}}catch{return t.doc.transact(v=>{t._item.delete(v)},Qr),null}return d},dP=(t,e)=>{const r=new Is,o=t.map(a=>({insert:a.text,attributes:E_(a.marks)}));return r.applyDelta(o),e.set(r,t),r},hP=(t,e)=>{const r=new Zo(t.type.name);for(const o in t.attrs){const a=t.attrs[o];a!==null&&o!=="ychange"&&r.setAttribute(o,a)}return r.insert(0,dh(t).map(o=>ig(o,e))),e.set(r,t),r},ig=(t,e)=>t instanceof Array?dP(t,e):hP(t,e),og=(t,e)=>{const r=Object.keys(t).filter(a=>t[a]!==null);let o=r.length===Object.keys(e).filter(a=>e[a]!==null).length;for(let a=0;a<r.length&&o;a++){const l=r[a],d=t[l],A=e[l];o=l==="ychange"||d===A||typeof d=="object"&&typeof A=="object"&&og(d,A)}return o},dh=t=>{const e=t.content.content,r=[];for(let o=0;o<e.length;o++){const a=e[o];if(a.isText){const l=[];for(let d=e[o];o<e.length&&d.isText;d=e[++o])l.push(d);o--,r.push(l)}else r.push(a)}return r},m_=(t,e)=>{const r=t.toDelta();return r.length===e.length&&r.every((o,a)=>o.insert===e[a].text&&FN(o.attributes||{}).length===e[a].marks.length&&e[a].marks.every(l=>og(o.attributes[l.type.name]||{},l.attrs)))},tu=(t,e)=>{if(t instanceof Zo&&!(e instanceof Array)&&ag(t,e)){const r=dh(e);return t._length===r.length&&og(t.getAttributes(),e.attrs)&&t.toArray().every((o,a)=>tu(o,r[a]))}return t instanceof Is&&e instanceof Array&&m_(t,e)},hh=(t,e)=>t===e||t instanceof Array&&e instanceof Array&&t.length===e.length&&t.every((r,o)=>e[o]===r),v_=(t,e,r)=>{const o=t.toArray(),a=dh(e),l=a.length,d=o.length,A=Rl(d,l);let g=0,v=0,C=!1;for(;g<A;g++){const y=o[g],w=a[g];if(hh(r.get(y),w))C=!0;else if(!tu(y,w))break}for(;g+v<A;v++){const y=o[d-v-1],w=a[l-v-1];if(hh(r.get(y),w))C=!0;else if(!tu(y,w))break}return{equalityFactor:g+v,foundMappedChild:C}},pP=t=>{let e="",r=t._start;const o={};for(;r!==null;)r.deleted||(r.countable&&r.content instanceof HN?e+=r.content.str:r.content instanceof KN&&(o[r.content.key]=null)),r=r.right;return{str:e,nAttrs:o}},AP=(t,e,r)=>{r.set(t,e);const{nAttrs:o,str:a}=pP(t),l=e.map(v=>({insert:v.text,attributes:Object.assign({},o,E_(v.marks))})),{insert:d,remove:A,index:g}=iP(a,l.map(v=>v.insert).join(""));t.delete(g,A),t.insert(g,d),t.applyDelta(l.map(v=>({retain:v.insert.length,attributes:v.attributes})))},E_=t=>{const e={};return t.forEach(r=>{r.type.name!=="ychange"&&(e[r.type.name]=r.attrs)}),e},sg=(t,e,r,o)=>{if(e instanceof Zo&&e.nodeName!==r.type.name)throw new Error("node name mismatch!");if(o.set(e,r),e instanceof Zo){const y=e.getAttributes(),w=r.attrs;for(const k in w)w[k]!==null?y[k]!==w[k]&&k!=="ychange"&&e.setAttribute(k,w[k]):e.removeAttribute(k);for(const k in y)w[k]===void 0&&e.removeAttribute(k)}const a=dh(r),l=a.length,d=e.toArray(),A=d.length,g=Rl(l,A);let v=0,C=0;for(;v<g;v++){const y=d[v],w=a[v];if(!hh(o.get(y),w))if(tu(y,w))o.set(y,w);else break}for(;C+v+1<g;C++){const y=d[A-C-1],w=a[l-C-1];if(!hh(o.get(y),w))if(tu(y,w))o.set(y,w);else break}t.transact(()=>{for(;A-v-C>0&&l-v-C>0;){const w=d[v],k=a[v],M=d[A-C-1],F=a[l-C-1];if(w instanceof Is&&k instanceof Array)m_(w,k)||AP(w,k,o),v+=1;else{let K=w instanceof Zo&&ag(w,k),J=M instanceof Zo&&ag(M,F);if(K&&J){const U=v_(w,k,o),te=v_(M,F,o);U.foundMappedChild&&!te.foundMappedChild?J=!1:!U.foundMappedChild&&te.foundMappedChild||U.equalityFactor<te.equalityFactor?K=!1:J=!1}K?(sg(t,w,k,o),v+=1):J?(sg(t,M,F,o),C+=1):(e.delete(v,1),e.insert(v,[ig(k,o)]),v+=1)}}const y=A-v-C;if(y>0&&e.delete(v,y),v+C<l){const w=[];for(let k=v;k<l-C;k++)w.push(ig(a[k],o));e.insert(v,w)}},Qr)},ag=(t,e)=>!(e instanceof Array)&&t.nodeName===e.type.name;let ru=null;const fP=()=>{const t=ru;ru=null,t.forEach((e,r)=>{const o=r.state.tr;e.forEach((a,l)=>{o.setMeta(l,a)}),r.dispatch(o)})},gP=(t,e,r)=>{ru||(ru=new Map,sO(0,fP)),XN(ru,t,$N).set(e,r)},ph=(t,e,r)=>{if(t===0)return wA(e,0);let o=e._first===null?null:e._first.content.type;for(;o!==null&&e!==o;){if(o.constructor===Is){if(o._length>=t)return wA(o,t);if(t-=o._length,o._item!==null&&o._item.next!==null)o=o._item.next.content.type;else{do o=o._item===null?null:o._item.parent,t--;while(o!==e&&o!==null&&o._item!==null&&o._item.next===null);o!==null&&o!==e&&(o=o._item===null?null:o._item.next.content.type)}}else{const a=(r.get(o)||{nodeSize:0}).nodeSize;if(o._first!==null&&t<a)o=o._first.content.type,t--;else{if(t===1&&o._length===0&&a>1)return new NA(o._item===null?null:o._item.id,o._item===null?OA(o):null,null);if(t-=a,o._item!==null&&o._item.next!==null)o=o._item.next.content.type;else{if(t===0)return o=o._item===null?o:o._item.parent,new NA(o._item===null?null:o._item.id,o._item===null?OA(o):null,null);do o=o._item.parent,t--;while(o!==e&&o._item.next===null);o!==e&&(o=o._item.next.content.type)}}}if(o===null)throw YN();if(t===0&&o.constructor!==Is&&o!==e)return mP(o._item.parent,o._item)}return wA(e,e._length)},mP=(t,e)=>{let r=null,o=null;return t._item===null?o=OA(t):r=qN(t._item.id.client,t._item.id.clock),new NA(r,o,e.id)},nu=(t,e,r,o)=>{const a=JN(r,t);if(a===null||a.type!==e&&!zN(e,a.type._item))return null;let l=a.type,d=0;if(l.constructor===Is)d=a.index;else if(l._item===null||!l._item.deleted){let A=l._first,g=0;for(;g<l._length&&g<a.index&&A!==null;){if(!A.deleted){const v=A.content.type;g++,v.constructor===Is?d+=v._length:d+=o.get(v).nodeSize}A=A.right}d+=1}for(;l!==e&&l._item!==null;){const A=l._item.parent;if(A._item===null||!A._item.deleted){d+=1;let g=A._first;for(;g!==null;){const v=g.content.type;if(v===l)break;g.deleted||(v.constructor===Is?d+=v._length:d+=o.get(v).nodeSize),g=g.right}}l=A}return d-1},vP=t=>{const e=document.createElement("span");e.classList.add("ProseMirror-yjs-cursor"),e.setAttribute("style",`border-color: ${t.color}`);const r=document.createElement("div");return r.setAttribute("style",`background-color: ${t.color}`),r.insertBefore(document.createTextNode(t.name),null),e.insertBefore(r,null),e},I_=(t,e,r)=>{const o=Qr.getState(t),a=o.doc,l=[];return o.snapshot!=null||o.prevSnapshot!=null||o.binding===null?Ut.create(t.doc,[]):(e.getStates().forEach((d,A)=>{if(A!==a.clientID&&d.cursor!=null){const g=d.user||{};g.color==null&&(g.color="#ffa500"),g.name==null&&(g.name=`User: ${A}`);let v=nu(a,o.type,wl(d.cursor.anchor),o.binding.mapping),C=nu(a,o.type,wl(d.cursor.head),o.binding.mapping);if(v!==null&&C!==null){const y=sC(t.doc.content.size-1,0);v=Rl(v,y),C=Rl(C,y),l.push(Pr.widget(C,()=>r(g),{key:A+"",side:10}));const w=Rl(v,C),k=sC(v,C);l.push(Pr.inline(w,k,{style:`background-color: ${g.color}70`},{inclusiveEnd:!0,inclusiveStart:!1}))}}}),Ut.create(t.doc,l))},EP=(t,{cursorBuilder:e=vP,getSelection:r=a=>a.selection}={},o="cursor")=>new ni({key:ch,state:{init(a,l){return I_(l,t,e)},apply(a,l,d,A){const g=Qr.getState(A),v=a.getMeta(ch);return g&&g.isChangeOrigin||v&&v.awarenessUpdated?I_(A,t,e):l.map(a.mapping,a.doc)}},props:{decorations:a=>ch.getState(a)},view:a=>{const l=()=>{a.docView&&gP(a,ch,{awarenessUpdated:!0})},d=()=>{const A=Qr.getState(a.state),g=t.getLocalState()||{};if(a.hasFocus()&&A.binding!==null){const v=r(a.state),C=ph(v.anchor,A.type,A.binding.mapping),y=ph(v.head,A.type,A.binding.mapping);(g.cursor==null||!aC(wl(g.cursor.anchor),C)||!aC(wl(g.cursor.head),y))&&t.setLocalStateField(o,{anchor:C,head:y})}else g.cursor!=null&&nu(A.doc,A.type,wl(g.cursor.anchor),A.binding.mapping)!==null&&t.setLocalStateField(o,null)};return t.on("change",l),a.dom.addEventListener("focusin",d),a.dom.addEventListener("focusout",d),{update:d,destroy:()=>{a.dom.removeEventListener("focusin",d),a.dom.removeEventListener("focusout",d),t.off("change",l),t.setLocalStateField(o,null)}}}}),IP=t=>{const e=_a.getState(t).undoManager;if(e!=null)return e.undo(),!0},CP=t=>{const e=_a.getState(t).undoManager;if(e!=null)return e.redo(),!0},yP=({protectedNodes:t=new Set(["paragraph"]),trackedOrigins:e=[]}={})=>new ni({key:_a,state:{init:(r,o)=>{const a=Qr.getState(o),l=new ZN(a.type,{trackedOrigins:new Set([Qr].concat(e)),deleteFilter:d=>!(d instanceof oC)||!(d.content instanceof eO)||!(d.content.type instanceof tO||d.content.type instanceof Zo&&t.has(d.content.type.nodeName))||d.content.type._length===0});return{undoManager:l,prevSel:null,hasUndoOps:l.undoStack.length>0,hasRedoOps:l.redoStack.length>0}},apply:(r,o,a,l)=>{const d=Qr.getState(l).binding,A=o.undoManager,g=A.undoStack.length>0,v=A.redoStack.length>0;return d?{undoManager:A,prevSel:ng(d,a),hasUndoOps:g,hasRedoOps:v}:g!==o.hasUndoOps||v!==o.hasRedoOps?Object.assign({},o,{hasUndoOps:A.undoStack.length>0,hasRedoOps:A.redoStack.length>0}):o}},view:r=>{const o=Qr.getState(r.state),a=_a.getState(r.state).undoManager;return a.on("stack-item-added",({stackItem:l})=>{const d=o.binding;d&&l.meta.set(d,_a.getState(r.state).prevSel)}),a.on("stack-item-popped",({stackItem:l})=>{const d=o.binding;d&&(d.beforeTransactionSelection=l.meta.get(d)||d.beforeTransactionSelection)}),{destroy:()=>{a.destroy()}}}});tn.create({name:"collaboration",priority:1e3,addOptions(){return{document:null,field:"default",fragment:null}},onCreate(){this.editor.extensionManager.extensions.find(t=>t.name==="history")&&console.warn('[tiptap warn]: "@tiptap/extension-collaboration" comes with its own history support and is not compatible with "@tiptap/extension-history".')},addCommands(){return{undo:()=>({tr:t,state:e,dispatch:r})=>(t.setMeta("preventDispatch",!0),_a.getState(e).undoManager.undoStack.length===0?!1:r?IP(e):!0),redo:()=>({tr:t,state:e,dispatch:r})=>(t.setMeta("preventDispatch",!0),_a.getState(e).undoManager.redoStack.length===0?!1:r?CP(e):!0)}},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Mod-y":()=>this.editor.commands.redo(),"Shift-Mod-z":()=>this.editor.commands.redo()}},addProseMirrorPlugins(){const t=this.options.fragment?this.options.fragment:this.options.document.getXmlFragment(this.options.field);return[aP(t),yP()]}});const C_=t=>Array.from(t.entries()).map(([e,r])=>fe({clientId:e},r.user)),y_=()=>null;tn.create({name:"collaborationCursor",addOptions(){return{provider:null,user:{name:null,color:null},render:t=>{const e=document.createElement("span");e.classList.add("collaboration-cursor__caret"),e.setAttribute("style",`border-color: ${t.color}`);const r=document.createElement("div");return r.classList.add("collaboration-cursor__label"),r.setAttribute("style",`background-color: ${t.color}`),r.insertBefore(document.createTextNode(t.name),null),e.insertBefore(r,null),e},onUpdate:y_}},onCreate(){this.options.onUpdate!==y_&&console.warn('[tiptap warn]: DEPRECATED: The "onUpdate" option is deprecated. Please use `editor.storage.collaborationCursor.users` instead. Read more: https://tiptap.dev/api/extensions/collaboration-cursor')},addStorage(){return{users:[]}},addCommands(){return{updateUser:t=>()=>(this.options.user=t,this.options.provider.awareness.setLocalStateField("user",this.options.user),!0),user:t=>({editor:e})=>(console.warn('[tiptap warn]: DEPRECATED: The "user" command is deprecated. Please use "updateUser" instead. Read more: https://tiptap.dev/api/extensions/collaboration-cursor'),e.commands.updateUser(t))}},addProseMirrorPlugins(){return[EP((()=>(this.options.provider.awareness.setLocalStateField("user",this.options.user),this.storage.users=C_(this.options.provider.awareness.states),this.options.provider.awareness.on("update",()=>{this.storage.users=C_(this.options.provider.awareness.states)}),this.options.provider.awareness))(),{cursorBuilder:this.options.render})]}});bn.create({name:"taskList",addOptions(){return{HTMLAttributes:{}}},group:"block list",content:"taskItem+",parseHTML(){return[{tag:'ul[data-type="taskList"]',priority:51}]},renderHTML({HTMLAttributes:t}){return["ul",kn(this.options.HTMLAttributes,t,{"data-type":"taskList"}),0]},addCommands(){return{toggleTaskList:()=>({commands:t})=>t.toggleList("taskList","taskItem")}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}});const _P=/^\s*(\[([ |x])\])\s$/;bn.create({name:"taskItem",addOptions(){return{nested:!1,HTMLAttributes:{}}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:t=>t.getAttribute("data-checked")==="true",renderHTML:t=>({"data-checked":t.checked})}}},parseHTML(){return[{tag:'li[data-type="taskItem"]',priority:51}]},renderHTML({HTMLAttributes:t}){return["li",kn(this.options.HTMLAttributes,t,{"data-type":"taskItem"}),0]},addKeyboardShortcuts(){const t={Enter:()=>this.editor.commands.splitListItem("taskItem"),"Shift-Tab":()=>this.editor.commands.liftListItem("taskItem")};return this.options.nested?hc(fe({},t),{Tab:()=>this.editor.commands.sinkListItem("taskItem")}):t},addNodeView(){return({node:t,HTMLAttributes:e,getPos:r,editor:o})=>{const a=document.createElement("li"),l=document.createElement("label"),d=document.createElement("span"),A=document.createElement("input"),g=document.createElement("div");return l.contentEditable="false",A.type="checkbox",A.addEventListener("change",v=>{if(!o.isEditable){A.checked=!A.checked;return}const{checked:C}=v.target;o.isEditable&&typeof r=="function"&&o.chain().focus().command(({tr:y})=>(y.setNodeMarkup(r(),void 0,{checked:C}),!0)).run()}),Object.entries(this.options.HTMLAttributes).forEach(([v,C])=>{a.setAttribute(v,C)}),a.dataset.checked=t.attrs.checked,t.attrs.checked&&A.setAttribute("checked","checked"),l.append(A,d),a.append(l,g),Object.entries(e).forEach(([v,C])=>{a.setAttribute(v,C)}),{dom:a,contentDOM:g,update:v=>v.type!==this.type?!1:(a.dataset.checked=v.attrs.checked,v.attrs.checked?A.setAttribute("checked","checked"):A.removeAttribute("checked"),!0)}}},addInputRules(){return[Jd({find:_P,type:this.type,getAttributes:t=>({checked:t[t.length-1]==="x"})})]}});const SP=/(?:^|\s)((?:==)((?:[^~]+))(?:==))$/,TP=/(?:^|\s)((?:==)((?:[^~]+))(?:==))/g;ks.create({name:"highlight",addOptions(){return{multicolor:!1,HTMLAttributes:{}}},addAttributes(){return this.options.multicolor?{color:{default:null,parseHTML:t=>t.getAttribute("data-color")||t.style.backgroundColor,renderHTML:t=>t.color?{"data-color":t.color,style:`background-color: ${t.color}`}:{}}}:{}},parseHTML(){return[{tag:"mark"}]},renderHTML({HTMLAttributes:t}){return["mark",kn(this.options.HTMLAttributes,t),0]},addCommands(){return{setHighlight:t=>({commands:e})=>e.setMark("highlight",t),toggleHighlight:t=>({commands:e})=>e.toggleMark("highlight",t),unsetHighlight:()=>({commands:t})=>t.unsetMark("highlight")}},addKeyboardShortcuts(){return{"Mod-Shift-h":()=>this.editor.commands.toggleHighlight()}},addInputRules(){return[Ia({find:SP,type:this.type})]},addPasteRules(){return[Ca({find:TP,type:this.type})]}});function __(t,e,r){for(var o=0;;o++){if(o==t.childCount||o==e.childCount)return t.childCount==e.childCount?null:r;var a=t.child(o),l=e.child(o);if(a==l){r+=a.nodeSize;continue}if(!a.sameMarkup(l))return r;if(a.isText&&a.text!=l.text){for(var d=0;a.text[d]==l.text[d];d++)r++;return r}if(a.content.size||l.content.size){var A=__(a.content,l.content,r+1);if(A!=null)return A}r+=a.nodeSize}}function S_(t,e,r,o){for(var a=t.childCount,l=e.childCount;;){if(a==0||l==0)return a==l?null:{a:r,b:o};var d=t.child(--a),A=e.child(--l),g=d.nodeSize;if(d==A){r-=g,o-=g;continue}if(!d.sameMarkup(A))return{a:r,b:o};if(d.isText&&d.text!=A.text){for(var v=0,C=Math.min(d.text.length,A.text.length);v<C&&d.text[d.text.length-v-1]==A.text[A.text.length-v-1];)v++,r--,o--;return{a:r,b:o}}if(d.content.size||A.content.size){var y=S_(d.content,A.content,r-1,o-1);if(y)return y}r-=g,o-=g}}var ge=function(e,r){if(this.content=e,this.size=r||0,r==null)for(var o=0;o<e.length;o++)this.size+=e[o].nodeSize},Ah={firstChild:{configurable:!0},lastChild:{configurable:!0},childCount:{configurable:!0}};ge.prototype.nodesBetween=function(e,r,o,a,l){a===void 0&&(a=0);for(var d=0,A=0;A<r;d++){var g=this.content[d],v=A+g.nodeSize;if(v>e&&o(g,a+A,l,d)!==!1&&g.content.size){var C=A+1;g.nodesBetween(Math.max(0,e-C),Math.min(g.content.size,r-C),o,a+C)}A=v}};ge.prototype.descendants=function(e){this.nodesBetween(0,this.size,e)};ge.prototype.textBetween=function(e,r,o,a){var l="",d=!0;return this.nodesBetween(e,r,function(A,g){A.isText?(l+=A.text.slice(Math.max(e,g)-g,r-g),d=!o):A.isLeaf&&a?(l+=typeof a=="function"?a(A):a,d=!o):!d&&A.isBlock&&(l+=o,d=!0)},0),l};ge.prototype.append=function(e){if(!e.size)return this;if(!this.size)return e;var r=this.lastChild,o=e.firstChild,a=this.content.slice(),l=0;for(r.isText&&r.sameMarkup(o)&&(a[a.length-1]=r.withText(r.text+o.text),l=1);l<e.content.length;l++)a.push(e.content[l]);return new ge(a,this.size+e.size)};ge.prototype.cut=function(e,r){if(r==null&&(r=this.size),e==0&&r==this.size)return this;var o=[],a=0;if(r>e)for(var l=0,d=0;d<r;l++){var A=this.content[l],g=d+A.nodeSize;g>e&&((d<e||g>r)&&(A.isText?A=A.cut(Math.max(0,e-d),Math.min(A.text.length,r-d)):A=A.cut(Math.max(0,e-d-1),Math.min(A.content.size,r-d-1))),o.push(A),a+=A.nodeSize),d=g}return new ge(o,a)};ge.prototype.cutByIndex=function(e,r){return e==r?ge.empty:e==0&&r==this.content.length?this:new ge(this.content.slice(e,r))};ge.prototype.replaceChild=function(e,r){var o=this.content[e];if(o==r)return this;var a=this.content.slice(),l=this.size+r.nodeSize-o.nodeSize;return a[e]=r,new ge(a,l)};ge.prototype.addToStart=function(e){return new ge([e].concat(this.content),this.size+e.nodeSize)};ge.prototype.addToEnd=function(e){return new ge(this.content.concat(e),this.size+e.nodeSize)};ge.prototype.eq=function(e){if(this.content.length!=e.content.length)return!1;for(var r=0;r<this.content.length;r++)if(!this.content[r].eq(e.content[r]))return!1;return!0};Ah.firstChild.get=function(){return this.content.length?this.content[0]:null};Ah.lastChild.get=function(){return this.content.length?this.content[this.content.length-1]:null};Ah.childCount.get=function(){return this.content.length};ge.prototype.child=function(e){var r=this.content[e];if(!r)throw new RangeError("Index "+e+" out of range for "+this);return r};ge.prototype.maybeChild=function(e){return this.content[e]};ge.prototype.forEach=function(e){for(var r=0,o=0;r<this.content.length;r++){var a=this.content[r];e(a,o,r),o+=a.nodeSize}};ge.prototype.findDiffStart=function(e,r){return r===void 0&&(r=0),__(this,e,r)};ge.prototype.findDiffEnd=function(e,r,o){return r===void 0&&(r=this.size),o===void 0&&(o=e.size),S_(this,e,r,o)};ge.prototype.findIndex=function(e,r){if(r===void 0&&(r=-1),e==0)return fh(0,e);if(e==this.size)return fh(this.content.length,e);if(e>this.size||e<0)throw new RangeError("Position "+e+" outside of fragment ("+this+")");for(var o=0,a=0;;o++){var l=this.child(o),d=a+l.nodeSize;if(d>=e)return d==e||r>0?fh(o+1,d):fh(o,a);a=d}};ge.prototype.toString=function(){return"<"+this.toStringInner()+">"};ge.prototype.toStringInner=function(){return this.content.join(", ")};ge.prototype.toJSON=function(){return this.content.length?this.content.map(function(e){return e.toJSON()}):null};ge.fromJSON=function(e,r){if(!r)return ge.empty;if(!Array.isArray(r))throw new RangeError("Invalid input for Fragment.fromJSON");return new ge(r.map(e.nodeFromJSON))};ge.fromArray=function(e){if(!e.length)return ge.empty;for(var r,o=0,a=0;a<e.length;a++){var l=e[a];o+=l.nodeSize,a&&l.isText&&e[a-1].sameMarkup(l)?(r||(r=e.slice(0,a)),r[r.length-1]=l.withText(r[r.length-1].text+l.text)):r&&r.push(l)}return new ge(r||e,o)};ge.from=function(e){if(!e)return ge.empty;if(e instanceof ge)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new ge([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))};Object.defineProperties(ge.prototype,Ah);var cg={index:0,offset:0};function fh(t,e){return cg.index=t,cg.offset=e,cg}ge.empty=new ge([],0);function gh(t,e){if(t===e)return!0;if(!(t&&typeof t=="object")||!(e&&typeof e=="object"))return!1;var r=Array.isArray(t);if(Array.isArray(e)!=r)return!1;if(r){if(t.length!=e.length)return!1;for(var o=0;o<t.length;o++)if(!gh(t[o],e[o]))return!1}else{for(var a in t)if(!(a in e)||!gh(t[a],e[a]))return!1;for(var l in e)if(!(l in t))return!1}return!0}var kt=function(e,r){this.type=e,this.attrs=r};kt.prototype.addToSet=function(e){for(var r,o=!1,a=0;a<e.length;a++){var l=e[a];if(this.eq(l))return e;if(this.type.excludes(l.type))r||(r=e.slice(0,a));else{if(l.type.excludes(this.type))return e;!o&&l.type.rank>this.type.rank&&(r||(r=e.slice(0,a)),r.push(this),o=!0),r&&r.push(l)}}return r||(r=e.slice()),o||r.push(this),r};kt.prototype.removeFromSet=function(e){for(var r=0;r<e.length;r++)if(this.eq(e[r]))return e.slice(0,r).concat(e.slice(r+1));return e};kt.prototype.isInSet=function(e){for(var r=0;r<e.length;r++)if(this.eq(e[r]))return!0;return!1};kt.prototype.eq=function(e){return this==e||this.type==e.type&&gh(this.attrs,e.attrs)};kt.prototype.toJSON=function(){var e={type:this.type.name};for(var r in this.attrs){e.attrs=this.attrs;break}return e};kt.fromJSON=function(e,r){if(!r)throw new RangeError("Invalid input for Mark.fromJSON");var o=e.marks[r.type];if(!o)throw new RangeError("There is no mark type "+r.type+" in this schema");return o.create(r.attrs)};kt.sameSet=function(e,r){if(e==r)return!0;if(e.length!=r.length)return!1;for(var o=0;o<e.length;o++)if(!e[o].eq(r[o]))return!1;return!0};kt.setFrom=function(e){if(!e||e.length==0)return kt.none;if(e instanceof kt)return[e];var r=e.slice();return r.sort(function(o,a){return o.type.rank-a.type.rank}),r};kt.none=[];function Po(t){var e=Error.call(this,t);return e.__proto__=Po.prototype,e}Po.prototype=Object.create(Error.prototype);Po.prototype.constructor=Po;Po.prototype.name="ReplaceError";var Fe=function(e,r,o){this.content=e,this.openStart=r,this.openEnd=o},T_={size:{configurable:!0}};T_.size.get=function(){return this.content.size-this.openStart-this.openEnd};Fe.prototype.insertAt=function(e,r){var o=w_(this.content,e+this.openStart,r,null);return o&&new Fe(o,this.openStart,this.openEnd)};Fe.prototype.removeBetween=function(e,r){return new Fe(R_(this.content,e+this.openStart,r+this.openStart),this.openStart,this.openEnd)};Fe.prototype.eq=function(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd};Fe.prototype.toString=function(){return this.content+"("+this.openStart+","+this.openEnd+")"};Fe.prototype.toJSON=function(){if(!this.content.size)return null;var e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e};Fe.fromJSON=function(e,r){if(!r)return Fe.empty;var o=r.openStart||0,a=r.openEnd||0;if(typeof o!="number"||typeof a!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new Fe(ge.fromJSON(e,r.content),o,a)};Fe.maxOpen=function(e,r){r===void 0&&(r=!0);for(var o=0,a=0,l=e.firstChild;l&&!l.isLeaf&&(r||!l.type.spec.isolating);l=l.firstChild)o++;for(var d=e.lastChild;d&&!d.isLeaf&&(r||!d.type.spec.isolating);d=d.lastChild)a++;return new Fe(e,o,a)};Object.defineProperties(Fe.prototype,T_);function R_(t,e,r){var o=t.findIndex(e),a=o.index,l=o.offset,d=t.maybeChild(a),A=t.findIndex(r),g=A.index,v=A.offset;if(l==e||d.isText){if(v!=r&&!t.child(g).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(r))}if(a!=g)throw new RangeError("Removing non-flat range");return t.replaceChild(a,d.copy(R_(d.content,e-l-1,r-l-1)))}function w_(t,e,r,o){var a=t.findIndex(e),l=a.index,d=a.offset,A=t.maybeChild(l);if(d==e||A.isText)return o&&!o.canReplace(l,l,r)?null:t.cut(0,e).append(r).append(t.cut(e));var g=w_(A.content,e-d-1,r);return g&&t.replaceChild(l,A.copy(g))}Fe.empty=new Fe(ge.empty,0,0);function RP(t,e,r){if(r.openStart>t.depth)throw new Po("Inserted content deeper than insertion position");if(t.depth-r.openStart!=e.depth-r.openEnd)throw new Po("Inconsistent open depths");return N_(t,e,r,0)}function N_(t,e,r,o){var a=t.index(o),l=t.node(o);if(a==e.index(o)&&o<t.depth-r.openStart){var d=N_(t,e,r,o+1);return l.copy(l.content.replaceChild(a,d))}else if(r.content.size)if(!r.openStart&&!r.openEnd&&t.depth==o&&e.depth==o){var A=t.parent,g=A.content;return Ta(A,g.cut(0,t.parentOffset).append(r.content).append(g.cut(e.parentOffset)))}else{var v=wP(r,t),C=v.start,y=v.end;return Ta(l,k_(t,C,y,e,o))}else return Ta(l,mh(t,e,o))}function O_(t,e){if(!e.type.compatibleContent(t.type))throw new Po("Cannot join "+e.type.name+" onto "+t.type.name)}function lg(t,e,r){var o=t.node(r);return O_(o,e.node(r)),o}function Sa(t,e){var r=e.length-1;r>=0&&t.isText&&t.sameMarkup(e[r])?e[r]=t.withText(e[r].text+t.text):e.push(t)}function iu(t,e,r,o){var a=(e||t).node(r),l=0,d=e?e.index(r):a.childCount;t&&(l=t.index(r),t.depth>r?l++:t.textOffset&&(Sa(t.nodeAfter,o),l++));for(var A=l;A<d;A++)Sa(a.child(A),o);e&&e.depth==r&&e.textOffset&&Sa(e.nodeBefore,o)}function Ta(t,e){if(!t.type.validContent(e))throw new Po("Invalid content for node "+t.type.name);return t.copy(e)}function k_(t,e,r,o,a){var l=t.depth>a&&lg(t,e,a+1),d=o.depth>a&&lg(r,o,a+1),A=[];return iu(null,t,a,A),l&&d&&e.index(a)==r.index(a)?(O_(l,d),Sa(Ta(l,k_(t,e,r,o,a+1)),A)):(l&&Sa(Ta(l,mh(t,e,a+1)),A),iu(e,r,a,A),d&&Sa(Ta(d,mh(r,o,a+1)),A)),iu(o,null,a,A),new ge(A)}function mh(t,e,r){var o=[];if(iu(null,t,r,o),t.depth>r){var a=lg(t,e,r+1);Sa(Ta(a,mh(t,e,r+1)),o)}return iu(e,null,r,o),new ge(o)}function wP(t,e){for(var r=e.depth-t.openStart,o=e.node(r),a=o.copy(t.content),l=r-1;l>=0;l--)a=e.node(l).copy(ge.from(a));return{start:a.resolveNoCache(t.openStart+r),end:a.resolveNoCache(a.content.size-t.openEnd-r)}}var or=function(e,r,o){this.pos=e,this.path=r,this.depth=r.length/3-1,this.parentOffset=o},Dc={parent:{configurable:!0},doc:{configurable:!0},textOffset:{configurable:!0},nodeAfter:{configurable:!0},nodeBefore:{configurable:!0}};or.prototype.resolveDepth=function(e){return e==null?this.depth:e<0?this.depth+e:e};Dc.parent.get=function(){return this.node(this.depth)};Dc.doc.get=function(){return this.node(0)};or.prototype.node=function(e){return this.path[this.resolveDepth(e)*3]};or.prototype.index=function(e){return this.path[this.resolveDepth(e)*3+1]};or.prototype.indexAfter=function(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)};or.prototype.start=function(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1};or.prototype.end=function(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size};or.prototype.before=function(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]};or.prototype.after=function(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize};Dc.textOffset.get=function(){return this.pos-this.path[this.path.length-1]};Dc.nodeAfter.get=function(){var t=this.parent,e=this.index(this.depth);if(e==t.childCount)return null;var r=this.pos-this.path[this.path.length-1],o=t.child(e);return r?t.child(e).cut(r):o};Dc.nodeBefore.get=function(){var t=this.index(this.depth),e=this.pos-this.path[this.path.length-1];return e?this.parent.child(t).cut(0,e):t==0?null:this.parent.child(t-1)};or.prototype.posAtIndex=function(e,r){r=this.resolveDepth(r);for(var o=this.path[r*3],a=r==0?0:this.path[r*3-1]+1,l=0;l<e;l++)a+=o.child(l).nodeSize;return a};or.prototype.marks=function(){var e=this.parent,r=this.index();if(e.content.size==0)return kt.none;if(this.textOffset)return e.child(r).marks;var o=e.maybeChild(r-1),a=e.maybeChild(r);if(!o){var l=o;o=a,a=l}for(var d=o.marks,A=0;A<d.length;A++)d[A].type.spec.inclusive===!1&&(!a||!d[A].isInSet(a.marks))&&(d=d[A--].removeFromSet(d));return d};or.prototype.marksAcross=function(e){var r=this.parent.maybeChild(this.index());if(!r||!r.isInline)return null;for(var o=r.marks,a=e.parent.maybeChild(e.index()),l=0;l<o.length;l++)o[l].type.spec.inclusive===!1&&(!a||!o[l].isInSet(a.marks))&&(o=o[l--].removeFromSet(o));return o};or.prototype.sharedDepth=function(e){for(var r=this.depth;r>0;r--)if(this.start(r)<=e&&this.end(r)>=e)return r;return 0};or.prototype.blockRange=function(e,r){if(e===void 0&&(e=this),e.pos<this.pos)return e.blockRange(this);for(var o=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);o>=0;o--)if(e.pos<=this.end(o)&&(!r||r(this.node(o))))return new b_(this,e,o)};or.prototype.sameParent=function(e){return this.pos-this.parentOffset==e.pos-e.parentOffset};or.prototype.max=function(e){return e.pos>this.pos?e:this};or.prototype.min=function(e){return e.pos<this.pos?e:this};or.prototype.toString=function(){for(var e="",r=1;r<=this.depth;r++)e+=(e?"/":"")+this.node(r).type.name+"_"+this.index(r-1);return e+":"+this.parentOffset};or.resolve=function(e,r){if(!(r>=0&&r<=e.content.size))throw new RangeError("Position "+r+" out of range");for(var o=[],a=0,l=r,d=e;;){var A=d.content.findIndex(l),g=A.index,v=A.offset,C=l-v;if(o.push(d,g,a+v),!C||(d=d.child(g),d.isText))break;l=C-1,a+=v+1}return new or(r,o,l)};or.resolveCached=function(e,r){for(var o=0;o<ug.length;o++){var a=ug[o];if(a.pos==r&&a.doc==e)return a}var l=ug[dg]=or.resolve(e,r);return dg=(dg+1)%NP,l};Object.defineProperties(or.prototype,Dc);var ug=[],dg=0,NP=12,b_=function(e,r,o){this.$from=e,this.$to=r,this.depth=o},Bc={start:{configurable:!0},end:{configurable:!0},parent:{configurable:!0},startIndex:{configurable:!0},endIndex:{configurable:!0}};Bc.start.get=function(){return this.$from.before(this.depth+1)};Bc.end.get=function(){return this.$to.after(this.depth+1)};Bc.parent.get=function(){return this.$from.node(this.depth)};Bc.startIndex.get=function(){return this.$from.index(this.depth)};Bc.endIndex.get=function(){return this.$to.indexAfter(this.depth)};Object.defineProperties(b_.prototype,Bc);var OP=Object.create(null),bt=function(e,r,o,a){this.type=e,this.attrs=r,this.content=o||ge.empty,this.marks=a||kt.none},Ri={nodeSize:{configurable:!0},childCount:{configurable:!0},textContent:{configurable:!0},firstChild:{configurable:!0},lastChild:{configurable:!0},isBlock:{configurable:!0},isTextblock:{configurable:!0},inlineContent:{configurable:!0},isInline:{configurable:!0},isText:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};Ri.nodeSize.get=function(){return this.isLeaf?1:2+this.content.size};Ri.childCount.get=function(){return this.content.childCount};bt.prototype.child=function(e){return this.content.child(e)};bt.prototype.maybeChild=function(e){return this.content.maybeChild(e)};bt.prototype.forEach=function(e){this.content.forEach(e)};bt.prototype.nodesBetween=function(e,r,o,a){a===void 0&&(a=0),this.content.nodesBetween(e,r,o,a,this)};bt.prototype.descendants=function(e){this.nodesBetween(0,this.content.size,e)};Ri.textContent.get=function(){return this.textBetween(0,this.content.size,"")};bt.prototype.textBetween=function(e,r,o,a){return this.content.textBetween(e,r,o,a)};Ri.firstChild.get=function(){return this.content.firstChild};Ri.lastChild.get=function(){return this.content.lastChild};bt.prototype.eq=function(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)};bt.prototype.sameMarkup=function(e){return this.hasMarkup(e.type,e.attrs,e.marks)};bt.prototype.hasMarkup=function(e,r,o){return this.type==e&&gh(this.attrs,r||e.defaultAttrs||OP)&&kt.sameSet(this.marks,o||kt.none)};bt.prototype.copy=function(e){return e===void 0&&(e=null),e==this.content?this:new this.constructor(this.type,this.attrs,e,this.marks)};bt.prototype.mark=function(e){return e==this.marks?this:new this.constructor(this.type,this.attrs,this.content,e)};bt.prototype.cut=function(e,r){return e==0&&r==this.content.size?this:this.copy(this.content.cut(e,r))};bt.prototype.slice=function(e,r,o){if(r===void 0&&(r=this.content.size),o===void 0&&(o=!1),e==r)return Fe.empty;var a=this.resolve(e),l=this.resolve(r),d=o?0:a.sharedDepth(r),A=a.start(d),g=a.node(d),v=g.content.cut(a.pos-A,l.pos-A);return new Fe(v,a.depth-d,l.depth-d)};bt.prototype.replace=function(e,r,o){return RP(this.resolve(e),this.resolve(r),o)};bt.prototype.nodeAt=function(e){for(var r=this;;){var o=r.content.findIndex(e),a=o.index,l=o.offset;if(r=r.maybeChild(a),!r)return null;if(l==e||r.isText)return r;e-=l+1}};bt.prototype.childAfter=function(e){var r=this.content.findIndex(e),o=r.index,a=r.offset;return{node:this.content.maybeChild(o),index:o,offset:a}};bt.prototype.childBefore=function(e){if(e==0)return{node:null,index:0,offset:0};var r=this.content.findIndex(e),o=r.index,a=r.offset;if(a<e)return{node:this.content.child(o),index:o,offset:a};var l=this.content.child(o-1);return{node:l,index:o-1,offset:a-l.nodeSize}};bt.prototype.resolve=function(e){return or.resolveCached(this,e)};bt.prototype.resolveNoCache=function(e){return or.resolve(this,e)};bt.prototype.rangeHasMark=function(e,r,o){var a=!1;return r>e&&this.nodesBetween(e,r,function(l){return o.isInSet(l.marks)&&(a=!0),!a}),a};Ri.isBlock.get=function(){return this.type.isBlock};Ri.isTextblock.get=function(){return this.type.isTextblock};Ri.inlineContent.get=function(){return this.type.inlineContent};Ri.isInline.get=function(){return this.type.isInline};Ri.isText.get=function(){return this.type.isText};Ri.isLeaf.get=function(){return this.type.isLeaf};Ri.isAtom.get=function(){return this.type.isAtom};bt.prototype.toString=function(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);var e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),kP(this.marks,e)};bt.prototype.contentMatchAt=function(e){var r=this.type.contentMatch.matchFragment(this.content,0,e);if(!r)throw new Error("Called contentMatchAt on a node with invalid content");return r};bt.prototype.canReplace=function(e,r,o,a,l){o===void 0&&(o=ge.empty),a===void 0&&(a=0),l===void 0&&(l=o.childCount);var d=this.contentMatchAt(e).matchFragment(o,a,l),A=d&&d.matchFragment(this.content,r);if(!A||!A.validEnd)return!1;for(var g=a;g<l;g++)if(!this.type.allowsMarks(o.child(g).marks))return!1;return!0};bt.prototype.canReplaceWith=function(e,r,o,a){if(a&&!this.type.allowsMarks(a))return!1;var l=this.contentMatchAt(e).matchType(o),d=l&&l.matchFragment(this.content,r);return d?d.validEnd:!1};bt.prototype.canAppend=function(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)};bt.prototype.check=function(){if(!this.type.validContent(this.content))throw new RangeError("Invalid content for node "+this.type.name+": "+this.content.toString().slice(0,50));for(var e=kt.none,r=0;r<this.marks.length;r++)e=this.marks[r].addToSet(e);if(!kt.sameSet(e,this.marks))throw new RangeError("Invalid collection of marks for node "+this.type.name+": "+this.marks.map(function(o){return o.type.name}));this.content.forEach(function(o){return o.check()})};bt.prototype.toJSON=function(){var e={type:this.type.name};for(var r in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(function(o){return o.toJSON()})),e};bt.fromJSON=function(e,r){if(!r)throw new RangeError("Invalid input for Node.fromJSON");var o=null;if(r.marks){if(!Array.isArray(r.marks))throw new RangeError("Invalid mark data for Node.fromJSON");o=r.marks.map(e.markFromJSON)}if(r.type=="text"){if(typeof r.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(r.text,o)}var a=ge.fromJSON(e,r.content);return e.nodeType(r.type).create(r.attrs,a,o)};Object.defineProperties(bt.prototype,Ri);function kP(t,e){for(var r=t.length-1;r>=0;r--)e=t[r].type.name+"("+e+")";return e}var Kn=function(e){this.validEnd=e,this.next=[],this.wrapCache=[]},vh={inlineContent:{configurable:!0},defaultType:{configurable:!0},edgeCount:{configurable:!0}};Kn.parse=function(e,r){var o=new Eh(e,r);if(o.next==null)return Kn.empty;var a=B_(o);o.next&&o.err("Unexpected trailing text");var l=QP(PP(a));return xP(l,o),l};Kn.prototype.matchType=function(e){for(var r=0;r<this.next.length;r+=2)if(this.next[r]==e)return this.next[r+1];return null};Kn.prototype.matchFragment=function(e,r,o){r===void 0&&(r=0),o===void 0&&(o=e.childCount);for(var a=this,l=r;a&&l<o;l++)a=a.matchType(e.child(l).type);return a};vh.inlineContent.get=function(){var t=this.next[0];return t?t.isInline:!1};vh.defaultType.get=function(){for(var t=0;t<this.next.length;t+=2){var e=this.next[t];if(!(e.isText||e.hasRequiredAttrs()))return e}};Kn.prototype.compatible=function(e){for(var r=0;r<this.next.length;r+=2)for(var o=0;o<e.next.length;o+=2)if(this.next[r]==e.next[o])return!0;return!1};Kn.prototype.fillBefore=function(e,r,o){r===void 0&&(r=!1),o===void 0&&(o=0);var a=[this];function l(d,A){var g=d.matchFragment(e,o);if(g&&(!r||g.validEnd))return ge.from(A.map(function(k){return k.createAndFill()}));for(var v=0;v<d.next.length;v+=2){var C=d.next[v],y=d.next[v+1];if(!(C.isText||C.hasRequiredAttrs())&&a.indexOf(y)==-1){a.push(y);var w=l(y,A.concat(C));if(w)return w}}}return l(this,[])};Kn.prototype.findWrapping=function(e){for(var r=0;r<this.wrapCache.length;r+=2)if(this.wrapCache[r]==e)return this.wrapCache[r+1];var o=this.computeWrapping(e);return this.wrapCache.push(e,o),o};Kn.prototype.computeWrapping=function(e){for(var r=Object.create(null),o=[{match:this,type:null,via:null}];o.length;){var a=o.shift(),l=a.match;if(l.matchType(e)){for(var d=[],A=a;A.type;A=A.via)d.push(A.type);return d.reverse()}for(var g=0;g<l.next.length;g+=2){var v=l.next[g];!v.isLeaf&&!v.hasRequiredAttrs()&&!(v.name in r)&&(!a.type||l.next[g+1].validEnd)&&(o.push({match:v.contentMatch,type:v,via:a}),r[v.name]=!0)}}};vh.edgeCount.get=function(){return this.next.length>>1};Kn.prototype.edge=function(e){var r=e<<1;if(r>=this.next.length)throw new RangeError("There's no "+e+"th edge in this content match");return{type:this.next[r],next:this.next[r+1]}};Kn.prototype.toString=function(){var e=[];function r(o){e.push(o);for(var a=1;a<o.next.length;a+=2)e.indexOf(o.next[a])==-1&&r(o.next[a])}return r(this),e.map(function(o,a){for(var l=a+(o.validEnd?"*":" ")+" ",d=0;d<o.next.length;d+=2)l+=(d?", ":"")+o.next[d].name+"->"+e.indexOf(o.next[d+1]);return l}).join(`
`)};Object.defineProperties(Kn.prototype,vh);Kn.empty=new Kn(!0);var Eh=function(e,r){this.string=e,this.nodeTypes=r,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()},D_={next:{configurable:!0}};D_.next.get=function(){return this.tokens[this.pos]};Eh.prototype.eat=function(e){return this.next==e&&(this.pos++||!0)};Eh.prototype.err=function(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")};Object.defineProperties(Eh.prototype,D_);function B_(t){var e=[];do e.push(bP(t));while(t.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function bP(t){var e=[];do e.push(DP(t));while(t.next&&t.next!=")"&&t.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function DP(t){for(var e=MP(t);;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else if(t.eat("{"))e=BP(t,e);else break;return e}function L_(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");var e=Number(t.next);return t.pos++,e}function BP(t,e){var r=L_(t),o=r;return t.eat(",")&&(t.next!="}"?o=L_(t):o=-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:r,max:o,expr:e}}function LP(t,e){var r=t.nodeTypes,o=r[e];if(o)return[o];var a=[];for(var l in r){var d=r[l];d.groups.indexOf(e)>-1&&a.push(d)}return a.length==0&&t.err("No node type or group '"+e+"' found"),a}function MP(t){if(t.eat("(")){var e=B_(t);return t.eat(")")||t.err("Missing closing paren"),e}else if(/\W/.test(t.next))t.err("Unexpected token '"+t.next+"'");else{var r=LP(t,t.next).map(function(o){return t.inline==null?t.inline=o.isInline:t.inline!=o.isInline&&t.err("Mixing inline and block content"),{type:"name",value:o}});return t.pos++,r.length==1?r[0]:{type:"choice",exprs:r}}}function PP(t){var e=[[]];return a(l(t,0),r()),e;function r(){return e.push([])-1}function o(d,A,g){var v={term:g,to:A};return e[d].push(v),v}function a(d,A){d.forEach(function(g){return g.to=A})}function l(d,A){if(d.type=="choice")return d.exprs.reduce(function(J,U){return J.concat(l(U,A))},[]);if(d.type=="seq")for(var g=0;;g++){var v=l(d.exprs[g],A);if(g==d.exprs.length-1)return v;a(v,A=r())}else if(d.type=="star"){var C=r();return o(A,C),a(l(d.expr,C),C),[o(C)]}else if(d.type=="plus"){var y=r();return a(l(d.expr,A),y),a(l(d.expr,y),y),[o(y)]}else{if(d.type=="opt")return[o(A)].concat(l(d.expr,A));if(d.type=="range"){for(var w=A,k=0;k<d.min;k++){var M=r();a(l(d.expr,w),M),w=M}if(d.max==-1)a(l(d.expr,w),w);else for(var F=d.min;F<d.max;F++){var K=r();o(w,K),a(l(d.expr,w),K),w=K}return[o(w)]}else if(d.type=="name")return[o(A,null,d.value)]}}}function M_(t,e){return e-t}function P_(t,e){var r=[];return o(e),r.sort(M_);function o(a){var l=t[a];if(l.length==1&&!l[0].term)return o(l[0].to);r.push(a);for(var d=0;d<l.length;d++){var A=l[d],g=A.term,v=A.to;!g&&r.indexOf(v)==-1&&o(v)}}}function QP(t){var e=Object.create(null);return r(P_(t,0));function r(o){var a=[];o.forEach(function(g){t[g].forEach(function(v){var C=v.term,y=v.to;if(!!C){var w=a.indexOf(C),k=w>-1&&a[w+1];P_(t,y).forEach(function(M){k||a.push(C,k=[]),k.indexOf(M)==-1&&k.push(M)})}})});for(var l=e[o.join(",")]=new Kn(o.indexOf(t.length-1)>-1),d=0;d<a.length;d+=2){var A=a[d+1].sort(M_);l.next.push(a[d],e[A.join(",")]||r(A))}return l}}function xP(t,e){for(var r=0,o=[t];r<o.length;r++){for(var a=o[r],l=!a.validEnd,d=[],A=0;A<a.next.length;A+=2){var g=a.next[A],v=a.next[A+1];d.push(g.name),l&&!(g.isText||g.hasRequiredAttrs())&&(l=!1),o.indexOf(v)==-1&&o.push(v)}l&&e.err("Only non-generatable nodes ("+d.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function Q_(t){var e=Object.create(null);for(var r in t){var o=t[r];if(!o.hasDefault)return null;e[r]=o.default}return e}function x_(t,e){var r=Object.create(null);for(var o in t){var a=e&&e[o];if(a===void 0){var l=t[o];if(l.hasDefault)a=l.default;else throw new RangeError("No value supplied for attribute "+o)}r[o]=a}return r}function U_(t){var e=Object.create(null);if(t)for(var r in t)e[r]=new F_(t[r]);return e}var wi=function(e,r,o){this.name=e,this.schema=r,this.spec=o,this.groups=o.group?o.group.split(" "):[],this.attrs=U_(o.attrs),this.defaultAttrs=Q_(this.attrs),this.contentMatch=null,this.markSet=null,this.inlineContent=null,this.isBlock=!(o.inline||e=="text"),this.isText=e=="text"},ou={isInline:{configurable:!0},isTextblock:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};ou.isInline.get=function(){return!this.isBlock};ou.isTextblock.get=function(){return this.isBlock&&this.inlineContent};ou.isLeaf.get=function(){return this.contentMatch==Kn.empty};ou.isAtom.get=function(){return this.isLeaf||this.spec.atom};wi.prototype.hasRequiredAttrs=function(){for(var e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1};wi.prototype.compatibleContent=function(e){return this==e||this.contentMatch.compatible(e.contentMatch)};wi.prototype.computeAttrs=function(e){return!e&&this.defaultAttrs?this.defaultAttrs:x_(this.attrs,e)};wi.prototype.create=function(e,r,o){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new bt(this,this.computeAttrs(e),ge.from(r),kt.setFrom(o))};wi.prototype.createChecked=function(e,r,o){if(r=ge.from(r),!this.validContent(r))throw new RangeError("Invalid content for node "+this.name);return new bt(this,this.computeAttrs(e),r,kt.setFrom(o))};wi.prototype.createAndFill=function(e,r,o){if(e=this.computeAttrs(e),r=ge.from(r),r.size){var a=this.contentMatch.fillBefore(r);if(!a)return null;r=a.append(r)}var l=this.contentMatch.matchFragment(r).fillBefore(ge.empty,!0);return l?new bt(this,e,r.append(l),kt.setFrom(o)):null};wi.prototype.validContent=function(e){var r=this.contentMatch.matchFragment(e);if(!r||!r.validEnd)return!1;for(var o=0;o<e.childCount;o++)if(!this.allowsMarks(e.child(o).marks))return!1;return!0};wi.prototype.allowsMarkType=function(e){return this.markSet==null||this.markSet.indexOf(e)>-1};wi.prototype.allowsMarks=function(e){if(this.markSet==null)return!0;for(var r=0;r<e.length;r++)if(!this.allowsMarkType(e[r].type))return!1;return!0};wi.prototype.allowedMarks=function(e){if(this.markSet==null)return e;for(var r,o=0;o<e.length;o++)this.allowsMarkType(e[o].type)?r&&r.push(e[o]):r||(r=e.slice(0,o));return r?r.length?r:kt.empty:e};wi.compile=function(e,r){var o=Object.create(null);e.forEach(function(d,A){return o[d]=new wi(d,r,A)});var a=r.spec.topNode||"doc";if(!o[a])throw new RangeError("Schema is missing its top node type ('"+a+"')");if(!o.text)throw new RangeError("Every schema needs a 'text' type");for(var l in o.text.attrs)throw new RangeError("The text node type should not have attributes");return o};Object.defineProperties(wi.prototype,ou);var F_=function(e){this.hasDefault=Object.prototype.hasOwnProperty.call(e,"default"),this.default=e.default},V_={isRequired:{configurable:!0}};V_.isRequired.get=function(){return!this.hasDefault};Object.defineProperties(F_.prototype,V_);var Ra=function(e,r,o,a){this.name=e,this.schema=o,this.spec=a,this.attrs=U_(a.attrs),this.rank=r,this.excluded=null;var l=Q_(this.attrs);this.instance=l&&new kt(this,l)};Ra.prototype.create=function(e){return!e&&this.instance?this.instance:new kt(this,x_(this.attrs,e))};Ra.compile=function(e,r){var o=Object.create(null),a=0;return e.forEach(function(l,d){return o[l]=new Ra(l,a++,r,d)}),o};Ra.prototype.removeFromSet=function(e){for(var r=0;r<e.length;r++)e[r].type==this&&(e=e.slice(0,r).concat(e.slice(r+1)),r--);return e};Ra.prototype.isInSet=function(e){for(var r=0;r<e.length;r++)if(e[r].type==this)return e[r]};Ra.prototype.excludes=function(e){return this.excluded.indexOf(e)>-1};var hg={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},UP={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},G_={ol:!0,ul:!0},pg=1,Ag=2,su=4;function j_(t){return(t?pg:0)|(t==="full"?Ag:0)}var as=function(e,r,o,a,l,d,A){this.type=e,this.attrs=r,this.solid=l,this.match=d||(A&su?null:e.contentMatch),this.options=A,this.content=[],this.marks=o,this.activeMarks=kt.none,this.pendingMarks=a,this.stashMarks=[]};as.prototype.findWrapping=function(e){if(!this.match){if(!this.type)return[];var r=this.type.contentMatch.fillBefore(ge.from(e));if(r)this.match=this.type.contentMatch.matchFragment(r);else{var o=this.type.contentMatch,a;return(a=o.findWrapping(e.type))?(this.match=o,a):null}}return this.match.findWrapping(e.type)};as.prototype.finish=function(e){if(!(this.options&pg)){var r=this.content[this.content.length-1],o;r&&r.isText&&(o=/[ \t\r\n\u000c]+$/.exec(r.text))&&(r.text.length==o[0].length?this.content.pop():this.content[this.content.length-1]=r.withText(r.text.slice(0,r.text.length-o[0].length)))}var a=ge.from(this.content);return!e&&this.match&&(a=a.append(this.match.fillBefore(ge.empty,!0))),this.type?this.type.create(this.attrs,a,this.marks):a};as.prototype.popFromStashMark=function(e){for(var r=this.stashMarks.length-1;r>=0;r--)if(e.eq(this.stashMarks[r]))return this.stashMarks.splice(r,1)[0]};as.prototype.applyPending=function(e){for(var r=0,o=this.pendingMarks;r<o.length;r++){var a=o[r];(this.type?this.type.allowsMarkType(a.type):GP(a.type,e))&&!a.isInSet(this.activeMarks)&&(this.activeMarks=a.addToSet(this.activeMarks),this.pendingMarks=a.removeFromSet(this.pendingMarks))}};as.prototype.inlineContext=function(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!hg.hasOwnProperty(e.parentNode.nodeName.toLowerCase())};var sr=function(e,r,o){this.parser=e,this.options=r,this.isOpen=o;var a=r.topNode,l,d=j_(r.preserveWhitespace)|(o?su:0);a?l=new as(a.type,a.attrs,kt.none,kt.none,!0,r.topMatch||a.type.contentMatch,d):o?l=new as(null,null,kt.none,kt.none,!0,null,d):l=new as(e.schema.topNodeType,null,kt.none,kt.none,!0,null,d),this.nodes=[l],this.open=0,this.find=r.findPositions,this.needsBlock=!1},fg={top:{configurable:!0},currentPos:{configurable:!0}};fg.top.get=function(){return this.nodes[this.open]};sr.prototype.addDOM=function(e){if(e.nodeType==3)this.addTextNode(e);else if(e.nodeType==1){var r=e.getAttribute("style"),o=r?this.readStyles(VP(r)):null,a=this.top;if(o!=null)for(var l=0;l<o.length;l++)this.addPendingMark(o[l]);if(this.addElement(e),o!=null)for(var d=0;d<o.length;d++)this.removePendingMark(o[d],a)}};sr.prototype.addTextNode=function(e){var r=e.nodeValue,o=this.top;if(o.options&Ag||o.inlineContext(e)||/[^ \t\r\n\u000c]/.test(r)){if(o.options&pg)o.options&Ag?r=r.replace(/\r\n?/g,`
`):r=r.replace(/\r?\n|\r/g," ");else if(r=r.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(r)&&this.open==this.nodes.length-1){var a=o.content[o.content.length-1],l=e.previousSibling;(!a||l&&l.nodeName=="BR"||a.isText&&/[ \t\r\n\u000c]$/.test(a.text))&&(r=r.slice(1))}r&&this.insertNode(this.parser.schema.text(r)),this.findInText(e)}else this.findInside(e)};sr.prototype.addElement=function(e,r){var o=e.nodeName.toLowerCase(),a;G_.hasOwnProperty(o)&&this.parser.normalizeLists&&FP(e);var l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(a=this.parser.matchTag(e,this,r));if(l?l.ignore:UP.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);var d,A=this.top,g=this.needsBlock;if(hg.hasOwnProperty(o))d=!0,A.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e);return}this.addAll(e),d&&this.sync(A),this.needsBlock=g}else this.addElementByRule(e,l,l.consuming===!1?a:null)};sr.prototype.leafFallback=function(e){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`))};sr.prototype.ignoreFallback=function(e){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"))};sr.prototype.readStyles=function(e){var r=kt.none;e:for(var o=0;o<e.length;o+=2)for(var a=null;;){var l=this.parser.matchStyle(e[o],e[o+1],this,a);if(!l)continue e;if(l.ignore)return null;if(r=this.parser.schema.marks[l.mark].create(l.attrs).addToSet(r),l.consuming===!1)a=l;else break}return r};sr.prototype.addElementByRule=function(e,r,o){var a=this,l,d,A,g;r.node?(d=this.parser.schema.nodes[r.node],d.isLeaf?this.insertNode(d.create(r.attrs))||this.leafFallback(e):l=this.enter(d,r.attrs,r.preserveWhitespace)):(A=this.parser.schema.marks[r.mark],g=A.create(r.attrs),this.addPendingMark(g));var v=this.top;if(d&&d.isLeaf)this.findInside(e);else if(o)this.addElement(e,o);else if(r.getContent)this.findInside(e),r.getContent(e,this.parser.schema).forEach(function(y){return a.insertNode(y)});else{var C=r.contentElement;typeof C=="string"?C=e.querySelector(C):typeof C=="function"&&(C=C(e)),C||(C=e),this.findAround(e,C,!0),this.addAll(C,l)}l&&(this.sync(v),this.open--),g&&this.removePendingMark(g,v)};sr.prototype.addAll=function(e,r,o,a){for(var l=o||0,d=o?e.childNodes[o]:e.firstChild,A=a==null?null:e.childNodes[a];d!=A;d=d.nextSibling,++l)this.findAtPoint(e,l),this.addDOM(d),r&&hg.hasOwnProperty(d.nodeName.toLowerCase())&&this.sync(r);this.findAtPoint(e,l)};sr.prototype.findPlace=function(e){for(var r,o,a=this.open;a>=0;a--){var l=this.nodes[a],d=l.findWrapping(e);if(d&&(!r||r.length>d.length)&&(r=d,o=l,!d.length)||l.solid)break}if(!r)return!1;this.sync(o);for(var A=0;A<r.length;A++)this.enterInner(r[A],null,!1);return!0};sr.prototype.insertNode=function(e){if(e.isInline&&this.needsBlock&&!this.top.type){var r=this.textblockFromContext();r&&this.enterInner(r)}if(this.findPlace(e)){this.closeExtra();var o=this.top;o.applyPending(e.type),o.match&&(o.match=o.match.matchType(e.type));for(var a=o.activeMarks,l=0;l<e.marks.length;l++)(!o.type||o.type.allowsMarkType(e.marks[l].type))&&(a=e.marks[l].addToSet(a));return o.content.push(e.mark(a)),!0}return!1};sr.prototype.enter=function(e,r,o){var a=this.findPlace(e.create(r));return a&&this.enterInner(e,r,!0,o),a};sr.prototype.enterInner=function(e,r,o,a){this.closeExtra();var l=this.top;l.applyPending(e),l.match=l.match&&l.match.matchType(e,r);var d=a==null?l.options&~su:j_(a);l.options&su&&l.content.length==0&&(d|=su),this.nodes.push(new as(e,r,l.activeMarks,l.pendingMarks,o,null,d)),this.open++};sr.prototype.closeExtra=function(e){var r=this.nodes.length-1;if(r>this.open){for(;r>this.open;r--)this.nodes[r-1].content.push(this.nodes[r].finish(e));this.nodes.length=this.open+1}};sr.prototype.finish=function(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)};sr.prototype.sync=function(e){for(var r=this.open;r>=0;r--)if(this.nodes[r]==e){this.open=r;return}};fg.currentPos.get=function(){this.closeExtra();for(var t=0,e=this.open;e>=0;e--){for(var r=this.nodes[e].content,o=r.length-1;o>=0;o--)t+=r[o].nodeSize;e&&t++}return t};sr.prototype.findAtPoint=function(e,r){if(this.find)for(var o=0;o<this.find.length;o++)this.find[o].node==e&&this.find[o].offset==r&&(this.find[o].pos=this.currentPos)};sr.prototype.findInside=function(e){if(this.find)for(var r=0;r<this.find.length;r++)this.find[r].pos==null&&e.nodeType==1&&e.contains(this.find[r].node)&&(this.find[r].pos=this.currentPos)};sr.prototype.findAround=function(e,r,o){if(e!=r&&this.find){for(var a=0;a<this.find.length;a++)if(this.find[a].pos==null&&e.nodeType==1&&e.contains(this.find[a].node)){var l=r.compareDocumentPosition(this.find[a].node);l&(o?2:4)&&(this.find[a].pos=this.currentPos)}}};sr.prototype.findInText=function(e){if(this.find)for(var r=0;r<this.find.length;r++)this.find[r].node==e&&(this.find[r].pos=this.currentPos-(e.nodeValue.length-this.find[r].offset))};sr.prototype.matchesContext=function(e){var r=this;if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);var o=e.split("/"),a=this.options.context,l=!this.isOpen&&(!a||a.parent.type==this.nodes[0].type),d=-(a?a.depth+1:0)+(l?0:1),A=function(g,v){for(;g>=0;g--){var C=o[g];if(C==""){if(g==o.length-1||g==0)continue;for(;v>=d;v--)if(A(g-1,v))return!0;return!1}else{var y=v>0||v==0&&l?r.nodes[v].type:a&&v>=d?a.node(v-d).type:null;if(!y||y.name!=C&&y.groups.indexOf(C)==-1)return!1;v--}}return!0};return A(o.length-1,this.open)};sr.prototype.textblockFromContext=function(){var e=this.options.context;if(e)for(var r=e.depth;r>=0;r--){var o=e.node(r).contentMatchAt(e.indexAfter(r)).defaultType;if(o&&o.isTextblock&&o.defaultAttrs)return o}for(var a in this.parser.schema.nodes){var l=this.parser.schema.nodes[a];if(l.isTextblock&&l.defaultAttrs)return l}};sr.prototype.addPendingMark=function(e){var r=jP(e,this.top.pendingMarks);r&&this.top.stashMarks.push(r),this.top.pendingMarks=e.addToSet(this.top.pendingMarks)};sr.prototype.removePendingMark=function(e,r){for(var o=this.open;o>=0;o--){var a=this.nodes[o],l=a.pendingMarks.lastIndexOf(e);if(l>-1)a.pendingMarks=e.removeFromSet(a.pendingMarks);else{a.activeMarks=e.removeFromSet(a.activeMarks);var d=a.popFromStashMark(e);d&&a.type&&a.type.allowsMarkType(d.type)&&(a.activeMarks=d.addToSet(a.activeMarks))}if(a==r)break}};Object.defineProperties(sr.prototype,fg);function FP(t){for(var e=t.firstChild,r=null;e;e=e.nextSibling){var o=e.nodeType==1?e.nodeName.toLowerCase():null;o&&G_.hasOwnProperty(o)&&r?(r.appendChild(e),e=r):o=="li"?r=e:o&&(r=null)}}function VP(t){for(var e=/\s*([\w-]+)\s*:\s*([^;]+)/g,r,o=[];r=e.exec(t);)o.push(r[1],r[2].trim());return o}function GP(t,e){var r=e.schema.nodes,o=function(d){var A=r[d];if(!!A.allowsMarkType(t)){var g=[],v=function(C){g.push(C);for(var y=0;y<C.edgeCount;y++){var w=C.edge(y),k=w.type,M=w.next;if(k==e||g.indexOf(M)<0&&v(M))return!0}};if(v(A.contentMatch))return{v:!0}}};for(var a in r){var l=o(a);if(l)return l.v}}function jP(t,e){for(var r=0;r<e.length;r++)if(t.eq(e[r]))return e[r]}var H_=65535,K_=Math.pow(2,16);function HP(t,e){return t+e*K_}function W_(t){return t&H_}function KP(t){return(t-(t&H_))/K_}var gg=function(e,r,o){r===void 0&&(r=!1),o===void 0&&(o=null),this.pos=e,this.deleted=r,this.recover=o},gn=function(e,r){r===void 0&&(r=!1),this.ranges=e,this.inverted=r};gn.prototype.recover=function(e){var r=0,o=W_(e);if(!this.inverted)for(var a=0;a<o;a++)r+=this.ranges[a*3+2]-this.ranges[a*3+1];return this.ranges[o*3]+r+KP(e)};gn.prototype.mapResult=function(e,r){return r===void 0&&(r=1),this._map(e,r,!1)};gn.prototype.map=function(e,r){return r===void 0&&(r=1),this._map(e,r,!0)};gn.prototype._map=function(e,r,o){for(var a=0,l=this.inverted?2:1,d=this.inverted?1:2,A=0;A<this.ranges.length;A+=3){var g=this.ranges[A]-(this.inverted?a:0);if(g>e)break;var v=this.ranges[A+l],C=this.ranges[A+d],y=g+v;if(e<=y){var w=v?e==g?-1:e==y?1:r:r,k=g+a+(w<0?0:C);if(o)return k;var M=e==(r<0?g:y)?null:HP(A/3,e-g);return new gg(k,r<0?e!=g:e!=y,M)}a+=C-v}return o?e+a:new gg(e+a)};gn.prototype.touches=function(e,r){for(var o=0,a=W_(r),l=this.inverted?2:1,d=this.inverted?1:2,A=0;A<this.ranges.length;A+=3){var g=this.ranges[A]-(this.inverted?o:0);if(g>e)break;var v=this.ranges[A+l],C=g+v;if(e<=C&&A==a*3)return!0;o+=this.ranges[A+d]-v}return!1};gn.prototype.forEach=function(e){for(var r=this.inverted?2:1,o=this.inverted?1:2,a=0,l=0;a<this.ranges.length;a+=3){var d=this.ranges[a],A=d-(this.inverted?l:0),g=d+(this.inverted?0:l),v=this.ranges[a+r],C=this.ranges[a+o];e(A,A+v,g,g+C),l+=C-v}};gn.prototype.invert=function(){return new gn(this.ranges,!this.inverted)};gn.prototype.toString=function(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)};gn.offset=function(e){return e==0?gn.empty:new gn(e<0?[0,-e,0]:[0,0,e])};gn.empty=new gn([]);var Wn=function(e,r,o,a){this.maps=e||[],this.from=o||0,this.to=a==null?this.maps.length:a,this.mirror=r};Wn.prototype.slice=function(e,r){return e===void 0&&(e=0),r===void 0&&(r=this.maps.length),new Wn(this.maps,this.mirror,e,r)};Wn.prototype.copy=function(){return new Wn(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)};Wn.prototype.appendMap=function(e,r){this.to=this.maps.push(e),r!=null&&this.setMirror(this.maps.length-1,r)};Wn.prototype.appendMapping=function(e){for(var r=0,o=this.maps.length;r<e.maps.length;r++){var a=e.getMirror(r);this.appendMap(e.maps[r],a!=null&&a<r?o+a:null)}};Wn.prototype.getMirror=function(e){if(this.mirror){for(var r=0;r<this.mirror.length;r++)if(this.mirror[r]==e)return this.mirror[r+(r%2?-1:1)]}};Wn.prototype.setMirror=function(e,r){this.mirror||(this.mirror=[]),this.mirror.push(e,r)};Wn.prototype.appendMappingInverted=function(e){for(var r=e.maps.length-1,o=this.maps.length+e.maps.length;r>=0;r--){var a=e.getMirror(r);this.appendMap(e.maps[r].invert(),a!=null&&a>r?o-a-1:null)}};Wn.prototype.invert=function(){var e=new Wn;return e.appendMappingInverted(this),e};Wn.prototype.map=function(e,r){if(r===void 0&&(r=1),this.mirror)return this._map(e,r,!0);for(var o=this.from;o<this.to;o++)e=this.maps[o].map(e,r);return e};Wn.prototype.mapResult=function(e,r){return r===void 0&&(r=1),this._map(e,r,!1)};Wn.prototype._map=function(e,r,o){for(var a=!1,l=this.from;l<this.to;l++){var d=this.maps[l],A=d.mapResult(e,r);if(A.recover!=null){var g=this.getMirror(l);if(g!=null&&g>l&&g<this.to){l=g,e=this.maps[g].recover(A.recover);continue}}A.deleted&&(a=!0),e=A.pos}return o?e:new gg(e,a)};function Lc(t){var e=Error.call(this,t);return e.__proto__=Lc.prototype,e}Lc.prototype=Object.create(Error.prototype);Lc.prototype.constructor=Lc;Lc.prototype.name="TransformError";var Rr=function(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new Wn},mg={before:{configurable:!0},docChanged:{configurable:!0}};mg.before.get=function(){return this.docs.length?this.docs[0]:this.doc};Rr.prototype.step=function(e){var r=this.maybeStep(e);if(r.failed)throw new Lc(r.failed);return this};Rr.prototype.maybeStep=function(e){var r=e.apply(this.doc);return r.failed||this.addStep(e,r.doc),r};mg.docChanged.get=function(){return this.steps.length>0};Rr.prototype.addStep=function(e,r){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=r};Object.defineProperties(Rr.prototype,mg);function Ih(){throw new Error("Override me")}var vg=Object.create(null),Dn=function(){};Dn.prototype.apply=function(e){return Ih()};Dn.prototype.getMap=function(){return gn.empty};Dn.prototype.invert=function(e){return Ih()};Dn.prototype.map=function(e){return Ih()};Dn.prototype.merge=function(e){return null};Dn.prototype.toJSON=function(){return Ih()};Dn.fromJSON=function(e,r){if(!r||!r.stepType)throw new RangeError("Invalid input for Step.fromJSON");var o=vg[r.stepType];if(!o)throw new RangeError("No step type "+r.stepType+" defined");return o.fromJSON(e,r)};Dn.jsonID=function(e,r){if(e in vg)throw new RangeError("Duplicate use of step JSON ID "+e);return vg[e]=r,r.prototype.jsonID=e,r};var Yn=function(e,r){this.doc=e,this.failed=r};Yn.ok=function(e){return new Yn(e,null)};Yn.fail=function(e){return new Yn(null,e)};Yn.fromReplace=function(e,r,o,a){try{return Yn.ok(e.replace(r,o,a))}catch(l){if(l instanceof Po)return Yn.fail(l.message);throw l}};var Ms=function(t){function e(r,o,a,l){t.call(this),this.from=r,this.to=o,this.slice=a,this.structure=!!l}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(o){return this.structure&&Eg(o,this.from,this.to)?Yn.fail("Structure replace would overwrite content"):Yn.fromReplace(o,this.from,this.to,this.slice)},e.prototype.getMap=function(){return new gn([this.from,this.to-this.from,this.slice.size])},e.prototype.invert=function(o){return new e(this.from,this.from+this.slice.size,o.slice(this.from,this.to))},e.prototype.map=function(o){var a=o.mapResult(this.from,1),l=o.mapResult(this.to,-1);return a.deleted&&l.deleted?null:new e(a.pos,Math.max(a.pos,l.pos),this.slice)},e.prototype.merge=function(o){if(!(o instanceof e)||o.structure||this.structure)return null;if(this.from+this.slice.size==o.from&&!this.slice.openEnd&&!o.slice.openStart){var a=this.slice.size+o.slice.size==0?Fe.empty:new Fe(this.slice.content.append(o.slice.content),this.slice.openStart,o.slice.openEnd);return new e(this.from,this.to+(o.to-o.from),a,this.structure)}else if(o.to==this.from&&!this.slice.openStart&&!o.slice.openEnd){var l=this.slice.size+o.slice.size==0?Fe.empty:new Fe(o.slice.content.append(this.slice.content),o.slice.openStart,this.slice.openEnd);return new e(o.from,this.to,l,this.structure)}else return null},e.prototype.toJSON=function(){var o={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(o.slice=this.slice.toJSON()),this.structure&&(o.structure=!0),o},e.fromJSON=function(o,a){if(typeof a.from!="number"||typeof a.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new e(a.from,a.to,Fe.fromJSON(o,a.slice),!!a.structure)},e}(Dn);Dn.jsonID("replace",Ms);var wa=function(t){function e(r,o,a,l,d,A,g){t.call(this),this.from=r,this.to=o,this.gapFrom=a,this.gapTo=l,this.slice=d,this.insert=A,this.structure=!!g}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(o){if(this.structure&&(Eg(o,this.from,this.gapFrom)||Eg(o,this.gapTo,this.to)))return Yn.fail("Structure gap-replace would overwrite content");var a=o.slice(this.gapFrom,this.gapTo);if(a.openStart||a.openEnd)return Yn.fail("Gap is not a flat range");var l=this.slice.insertAt(this.insert,a.content);return l?Yn.fromReplace(o,this.from,this.to,l):Yn.fail("Content does not fit in gap")},e.prototype.getMap=function(){return new gn([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])},e.prototype.invert=function(o){var a=this.gapTo-this.gapFrom;return new e(this.from,this.from+this.slice.size+a,this.from+this.insert,this.from+this.insert+a,o.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)},e.prototype.map=function(o){var a=o.mapResult(this.from,1),l=o.mapResult(this.to,-1),d=o.map(this.gapFrom,-1),A=o.map(this.gapTo,1);return a.deleted&&l.deleted||d<a.pos||A>l.pos?null:new e(a.pos,l.pos,d,A,this.slice,this.insert,this.structure)},e.prototype.toJSON=function(){var o={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(o.slice=this.slice.toJSON()),this.structure&&(o.structure=!0),o},e.fromJSON=function(o,a){if(typeof a.from!="number"||typeof a.to!="number"||typeof a.gapFrom!="number"||typeof a.gapTo!="number"||typeof a.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new e(a.from,a.to,a.gapFrom,a.gapTo,Fe.fromJSON(o,a.slice),a.insert,!!a.structure)},e}(Dn);Dn.jsonID("replaceAround",wa);function Eg(t,e,r){for(var o=t.resolve(e),a=r-e,l=o.depth;a>0&&l>0&&o.indexAfter(l)==o.node(l).childCount;)l--,a--;if(a>0)for(var d=o.node(l).maybeChild(o.indexAfter(l));a>0;){if(!d||d.isLeaf)return!0;d=d.firstChild,a--}return!1}Rr.prototype.lift=function(t,e){for(var r=t.$from,o=t.$to,a=t.depth,l=r.before(a+1),d=o.after(a+1),A=l,g=d,v=ge.empty,C=0,y=a,w=!1;y>e;y--)w||r.index(y)>0?(w=!0,v=ge.from(r.node(y).copy(v)),C++):A--;for(var k=ge.empty,M=0,F=a,K=!1;F>e;F--)K||o.after(F+1)<o.end(F)?(K=!0,k=ge.from(o.node(F).copy(k)),M++):g++;return this.step(new wa(A,g,l,d,new Fe(v.append(k),C,M),v.size-C,!0))};Rr.prototype.wrap=function(t,e){for(var r=ge.empty,o=e.length-1;o>=0;o--)r=ge.from(e[o].type.create(e[o].attrs,r));var a=t.start,l=t.end;return this.step(new wa(a,l,a,l,new Fe(r,0,0),e.length,!0))};Rr.prototype.setBlockType=function(t,e,r,o){var a=this;if(e===void 0&&(e=t),!r.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");var l=this.steps.length;return this.doc.nodesBetween(t,e,function(d,A){if(d.isTextblock&&!d.hasMarkup(r,o)&&WP(a.doc,a.mapping.slice(l).map(A),r)){a.clearIncompatible(a.mapping.slice(l).map(A,1),r);var g=a.mapping.slice(l),v=g.map(A,1),C=g.map(A+d.nodeSize,1);return a.step(new wa(v,C,v+1,C-1,new Fe(ge.from(r.create(o,null,d.marks)),0,0),1,!0)),!1}}),this};function WP(t,e,r){var o=t.resolve(e),a=o.index();return o.parent.canReplaceWith(a,a+1,r)}Rr.prototype.setNodeMarkup=function(t,e,r,o){var a=this.doc.nodeAt(t);if(!a)throw new RangeError("No node at given position");e||(e=a.type);var l=e.create(r,null,o||a.marks);if(a.isLeaf)return this.replaceWith(t,t+a.nodeSize,l);if(!e.validContent(a.content))throw new RangeError("Invalid content for node type "+e.name);return this.step(new wa(t,t+a.nodeSize,t+1,t+a.nodeSize-1,new Fe(ge.from(l),0,0),1,!0))};Rr.prototype.split=function(t,e,r){e===void 0&&(e=1);for(var o=this.doc.resolve(t),a=ge.empty,l=ge.empty,d=o.depth,A=o.depth-e,g=e-1;d>A;d--,g--){a=ge.from(o.node(d).copy(a));var v=r&&r[g];l=ge.from(v?v.type.create(v.attrs,l):o.node(d).copy(l))}return this.step(new Ms(t,t,new Fe(a.append(l),e,e),!0))};Rr.prototype.join=function(t,e){e===void 0&&(e=1);var r=new Ms(t-e,t+e,Fe.empty,!0);return this.step(r)};function YP(t,e,r){var o=t.resolve(e);if(o.parent.canReplaceWith(o.index(),o.index(),r))return e;if(o.parentOffset==0)for(var a=o.depth-1;a>=0;a--){var l=o.index(a);if(o.node(a).canReplaceWith(l,l,r))return o.before(a+1);if(l>0)return null}if(o.parentOffset==o.parent.content.size)for(var d=o.depth-1;d>=0;d--){var A=o.indexAfter(d);if(o.node(d).canReplaceWith(A,A,r))return o.after(d+1);if(A<o.node(d).childCount)return null}}function Ig(t,e,r){for(var o=[],a=0;a<t.childCount;a++){var l=t.child(a);l.content.size&&(l=l.copy(Ig(l.content,e,l))),l.isInline&&(l=e(l,r,a)),o.push(l)}return ge.fromArray(o)}var Cg=function(t){function e(r,o,a){t.call(this),this.from=r,this.to=o,this.mark=a}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(o){var a=this,l=o.slice(this.from,this.to),d=o.resolve(this.from),A=d.node(d.sharedDepth(this.to)),g=new Fe(Ig(l.content,function(v,C){return!v.isAtom||!C.type.allowsMarkType(a.mark.type)?v:v.mark(a.mark.addToSet(v.marks))},A),l.openStart,l.openEnd);return Yn.fromReplace(o,this.from,this.to,g)},e.prototype.invert=function(){return new au(this.from,this.to,this.mark)},e.prototype.map=function(o){var a=o.mapResult(this.from,1),l=o.mapResult(this.to,-1);return a.deleted&&l.deleted||a.pos>=l.pos?null:new e(a.pos,l.pos,this.mark)},e.prototype.merge=function(o){if(o instanceof e&&o.mark.eq(this.mark)&&this.from<=o.to&&this.to>=o.from)return new e(Math.min(this.from,o.from),Math.max(this.to,o.to),this.mark)},e.prototype.toJSON=function(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},e.fromJSON=function(o,a){if(typeof a.from!="number"||typeof a.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new e(a.from,a.to,o.markFromJSON(a.mark))},e}(Dn);Dn.jsonID("addMark",Cg);var au=function(t){function e(r,o,a){t.call(this),this.from=r,this.to=o,this.mark=a}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(o){var a=this,l=o.slice(this.from,this.to),d=new Fe(Ig(l.content,function(A){return A.mark(a.mark.removeFromSet(A.marks))}),l.openStart,l.openEnd);return Yn.fromReplace(o,this.from,this.to,d)},e.prototype.invert=function(){return new Cg(this.from,this.to,this.mark)},e.prototype.map=function(o){var a=o.mapResult(this.from,1),l=o.mapResult(this.to,-1);return a.deleted&&l.deleted||a.pos>=l.pos?null:new e(a.pos,l.pos,this.mark)},e.prototype.merge=function(o){if(o instanceof e&&o.mark.eq(this.mark)&&this.from<=o.to&&this.to>=o.from)return new e(Math.min(this.from,o.from),Math.max(this.to,o.to),this.mark)},e.prototype.toJSON=function(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},e.fromJSON=function(o,a){if(typeof a.from!="number"||typeof a.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new e(a.from,a.to,o.markFromJSON(a.mark))},e}(Dn);Dn.jsonID("removeMark",au);Rr.prototype.addMark=function(t,e,r){var o=this,a=[],l=[],d=null,A=null;return this.doc.nodesBetween(t,e,function(g,v,C){if(!!g.isInline){var y=g.marks;if(!r.isInSet(y)&&C.type.allowsMarkType(r.type)){for(var w=Math.max(v,t),k=Math.min(v+g.nodeSize,e),M=r.addToSet(y),F=0;F<y.length;F++)y[F].isInSet(M)||(d&&d.to==w&&d.mark.eq(y[F])?d.to=k:a.push(d=new au(w,k,y[F])));A&&A.to==w?A.to=k:l.push(A=new Cg(w,k,r))}}}),a.forEach(function(g){return o.step(g)}),l.forEach(function(g){return o.step(g)}),this};Rr.prototype.removeMark=function(t,e,r){var o=this;r===void 0&&(r=null);var a=[],l=0;return this.doc.nodesBetween(t,e,function(d,A){if(!!d.isInline){l++;var g=null;if(r instanceof Ra)for(var v=d.marks,C;C=r.isInSet(v);)(g||(g=[])).push(C),v=C.removeFromSet(v);else r?r.isInSet(d.marks)&&(g=[r]):g=d.marks;if(g&&g.length)for(var y=Math.min(A+d.nodeSize,e),w=0;w<g.length;w++){for(var k=g[w],M=void 0,F=0;F<a.length;F++){var K=a[F];K.step==l-1&&k.eq(a[F].style)&&(M=K)}M?(M.to=y,M.step=l):a.push({style:k,from:Math.max(A,t),to:y,step:l})}}}),a.forEach(function(d){return o.step(new au(d.from,d.to,d.style))}),this};Rr.prototype.clearIncompatible=function(t,e,r){r===void 0&&(r=e.contentMatch);for(var o=this.doc.nodeAt(t),a=[],l=t+1,d=0;d<o.childCount;d++){var A=o.child(d),g=l+A.nodeSize,v=r.matchType(A.type,A.attrs);if(!v)a.push(new Ms(l,g,Fe.empty));else{r=v;for(var C=0;C<A.marks.length;C++)e.allowsMarkType(A.marks[C].type)||this.step(new au(l,g,A.marks[C]))}l=g}if(!r.validEnd){var y=r.fillBefore(ge.empty,!0);this.replace(l,l,new Fe(y,0,0))}for(var w=a.length-1;w>=0;w--)this.step(a[w]);return this};function qP(t,e,r,o){if(r===void 0&&(r=e),o===void 0&&(o=Fe.empty),e==r&&!o.size)return null;var a=t.resolve(e),l=t.resolve(r);return Y_(a,l,o)?new Ms(e,r,o):new Yi(a,l,o).fit()}Rr.prototype.replace=function(t,e,r){e===void 0&&(e=t),r===void 0&&(r=Fe.empty);var o=qP(this.doc,t,e,r);return o&&this.step(o),this};Rr.prototype.replaceWith=function(t,e,r){return this.replace(t,e,new Fe(ge.from(r),0,0))};Rr.prototype.delete=function(t,e){return this.replace(t,e,Fe.empty)};Rr.prototype.insert=function(t,e){return this.replaceWith(t,t,e)};function Y_(t,e,r){return!r.openStart&&!r.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),r.content)}var Yi=function(e,r,o){this.$to=r,this.$from=e,this.unplaced=o,this.frontier=[];for(var a=0;a<=e.depth;a++){var l=e.node(a);this.frontier.push({type:l.type,match:l.contentMatchAt(e.indexAfter(a))})}this.placed=ge.empty;for(var d=e.depth;d>0;d--)this.placed=ge.from(e.node(d).copy(this.placed))},q_={depth:{configurable:!0}};q_.depth.get=function(){return this.frontier.length-1};Yi.prototype.fit=function(){for(;this.unplaced.size;){var e=this.findFittable();e?this.placeNodes(e):this.openMore()||this.dropNode()}var r=this.mustMoveInline(),o=this.placed.size-this.depth-this.$from.depth,a=this.$from,l=this.close(r<0?this.$to:a.doc.resolve(r));if(!l)return null;for(var d=this.placed,A=a.depth,g=l.depth;A&&g&&d.childCount==1;)d=d.firstChild.content,A--,g--;var v=new Fe(d,A,g);if(r>-1)return new wa(a.pos,r,this.$to.pos,this.$to.end(),v,o);if(v.size||a.pos!=this.$to.pos)return new Ms(a.pos,l.pos,v)};Yi.prototype.findFittable=function(){for(var e=1;e<=2;e++)for(var r=this.unplaced.openStart;r>=0;r--){var o=void 0,a=void 0;r?(a=yg(this.unplaced.content,r-1).firstChild,o=a.content):o=this.unplaced.content;for(var l=o.firstChild,d=this.depth;d>=0;d--){var A=this.frontier[d],g=A.type,v=A.match,C=void 0,y=void 0;if(e==1&&(l?v.matchType(l.type)||(y=v.fillBefore(ge.from(l),!1)):g.compatibleContent(a.type)))return{sliceDepth:r,frontierDepth:d,parent:a,inject:y};if(e==2&&l&&(C=v.findWrapping(l.type)))return{sliceDepth:r,frontierDepth:d,parent:a,wrap:C};if(a&&v.matchType(a.type))break}}};Yi.prototype.openMore=function(){var e=this.unplaced,r=e.content,o=e.openStart,a=e.openEnd,l=yg(r,o);return!l.childCount||l.firstChild.isLeaf?!1:(this.unplaced=new Fe(r,o+1,Math.max(a,l.size+o>=r.size-a?o+1:0)),!0)};Yi.prototype.dropNode=function(){var e=this.unplaced,r=e.content,o=e.openStart,a=e.openEnd,l=yg(r,o);if(l.childCount<=1&&o>0){var d=r.size-o<=o+l.size;this.unplaced=new Fe(cu(r,o-1,1),o-1,d?o-1:a)}else this.unplaced=new Fe(cu(r,o,1),o,a)};Yi.prototype.placeNodes=function(e){for(var r=e.sliceDepth,o=e.frontierDepth,a=e.parent,l=e.inject,d=e.wrap;this.depth>o;)this.closeFrontierNode();if(d)for(var A=0;A<d.length;A++)this.openFrontierNode(d[A]);var g=this.unplaced,v=a?a.content:g.content,C=g.openStart-r,y=0,w=[],k=this.frontier[o],M=k.match,F=k.type;if(l){for(var K=0;K<l.childCount;K++)w.push(l.child(K));M=M.matchFragment(l)}for(var J=v.size+r-(g.content.size-g.openEnd);y<v.childCount;){var U=v.child(y),te=M.matchType(U.type);if(!te)break;y++,(y>1||C==0||U.content.size)&&(M=te,w.push(J_(U.mark(F.allowedMarks(U.marks)),y==1?C:0,y==v.childCount?J:-1)))}var P=y==v.childCount;P||(J=-1),this.placed=lu(this.placed,o,ge.from(w)),this.frontier[o].match=M,P&&J<0&&a&&a.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(var he=0,ne=v;he<J;he++){var me=ne.lastChild;this.frontier.push({type:me.type,match:me.contentMatchAt(me.childCount)}),ne=me.content}this.unplaced=P?r==0?Fe.empty:new Fe(cu(g.content,r-1,1),r-1,J<0?g.openEnd:r-1):new Fe(cu(g.content,r,y),g.openStart,g.openEnd)};Yi.prototype.mustMoveInline=function(){if(!this.$to.parent.isTextblock||this.$to.end()==this.$to.pos)return-1;var e=this.frontier[this.depth],r;if(!e.type.isTextblock||!_g(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(r=this.findCloseLevel(this.$to))&&r.depth==this.depth)return-1;for(var o=this.$to,a=o.depth,l=this.$to.after(a);a>1&&l==this.$to.end(--a);)++l;return l};Yi.prototype.findCloseLevel=function(e){e:for(var r=Math.min(this.depth,e.depth);r>=0;r--){var o=this.frontier[r],a=o.match,l=o.type,d=r<e.depth&&e.end(r+1)==e.pos+(e.depth-(r+1)),A=_g(e,r,l,a,d);if(!!A){for(var g=r-1;g>=0;g--){var v=this.frontier[g],C=v.match,y=v.type,w=_g(e,g,y,C,!0);if(!w||w.childCount)continue e}return{depth:r,fit:A,move:d?e.doc.resolve(e.after(r+1)):e}}}};Yi.prototype.close=function(e){var r=this.findCloseLevel(e);if(!r)return null;for(;this.depth>r.depth;)this.closeFrontierNode();r.fit.childCount&&(this.placed=lu(this.placed,r.depth,r.fit)),e=r.move;for(var o=r.depth+1;o<=e.depth;o++){var a=e.node(o),l=a.type.contentMatch.fillBefore(a.content,!0,e.index(o));this.openFrontierNode(a.type,a.attrs,l)}return e};Yi.prototype.openFrontierNode=function(e,r,o){var a=this.frontier[this.depth];a.match=a.match.matchType(e),this.placed=lu(this.placed,this.depth,ge.from(e.create(r,o))),this.frontier.push({type:e,match:e.contentMatch})};Yi.prototype.closeFrontierNode=function(){var e=this.frontier.pop(),r=e.match.fillBefore(ge.empty,!0);r.childCount&&(this.placed=lu(this.placed,this.frontier.length,r))};Object.defineProperties(Yi.prototype,q_);function cu(t,e,r){return e==0?t.cutByIndex(r):t.replaceChild(0,t.firstChild.copy(cu(t.firstChild.content,e-1,r)))}function lu(t,e,r){return e==0?t.append(r):t.replaceChild(t.childCount-1,t.lastChild.copy(lu(t.lastChild.content,e-1,r)))}function yg(t,e){for(var r=0;r<e;r++)t=t.firstChild.content;return t}function J_(t,e,r){if(e<=0)return t;var o=t.content;return e>1&&(o=o.replaceChild(0,J_(o.firstChild,e-1,o.childCount==1?r-1:0))),e>0&&(o=t.type.contentMatch.fillBefore(o).append(o),r<=0&&(o=o.append(t.type.contentMatch.matchFragment(o).fillBefore(ge.empty,!0)))),t.copy(o)}function _g(t,e,r,o,a){var l=t.node(e),d=a?t.indexAfter(e):t.index(e);if(d==l.childCount&&!r.compatibleContent(l.type))return null;var A=o.fillBefore(l.content,!0,d);return A&&!JP(r,l.content,d)?A:null}function JP(t,e,r){for(var o=r;o<e.childCount;o++)if(!t.allowsMarks(e.child(o).marks))return!0;return!1}Rr.prototype.replaceRange=function(t,e,r){if(!r.size)return this.deleteRange(t,e);var o=this.doc.resolve(t),a=this.doc.resolve(e);if(Y_(o,a,r))return this.step(new Ms(t,e,r));var l=X_(o,this.doc.resolve(e));l[l.length-1]==0&&l.pop();var d=-(o.depth+1);l.unshift(d);for(var A=o.depth,g=o.pos-1;A>0;A--,g--){var v=o.node(A).type.spec;if(v.defining||v.isolating)break;l.indexOf(A)>-1?d=A:o.before(A)==g&&l.splice(1,0,-A)}for(var C=l.indexOf(d),y=[],w=r.openStart,k=r.content,M=0;;M++){var F=k.firstChild;if(y.push(F),M==r.openStart)break;k=F.content}w>0&&y[w-1].type.spec.defining&&o.node(C).type!=y[w-1].type?w-=1:w>=2&&y[w-1].isTextblock&&y[w-2].type.spec.defining&&o.node(C).type!=y[w-2].type&&(w-=2);for(var K=r.openStart;K>=0;K--){var J=(K+w+1)%(r.openStart+1),U=y[J];if(!!U)for(var te=0;te<l.length;te++){var P=l[(te+C)%l.length],he=!0;P<0&&(he=!1,P=-P);var ne=o.node(P-1),me=o.index(P-1);if(ne.canReplaceWith(me,me,U.type,U.marks))return this.replace(o.before(P),he?a.after(P):e,new Fe(z_(r.content,0,r.openStart,J),J,r.openEnd))}}for(var Pe=this.steps.length,Me=l.length-1;Me>=0&&(this.replace(t,e,r),!(this.steps.length>Pe));Me--){var be=l[Me];be<0||(t=o.before(be),e=a.after(be))}return this};function z_(t,e,r,o,a){if(e<r){var l=t.firstChild;t=t.replaceChild(0,l.copy(z_(l.content,e+1,r,o,l)))}if(e>o){var d=a.contentMatchAt(0),A=d.fillBefore(t).append(t);t=A.append(d.matchFragment(A).fillBefore(ge.empty,!0))}return t}Rr.prototype.replaceRangeWith=function(t,e,r){if(!r.isInline&&t==e&&this.doc.resolve(t).parent.content.size){var o=YP(this.doc,t,r.type);o!=null&&(t=e=o)}return this.replaceRange(t,e,new Fe(ge.from(r),0,0))};Rr.prototype.deleteRange=function(t,e){for(var r=this.doc.resolve(t),o=this.doc.resolve(e),a=X_(r,o),l=0;l<a.length;l++){var d=a[l],A=l==a.length-1;if(A&&d==0||r.node(d).type.contentMatch.validEnd)return this.delete(r.start(d),o.end(d));if(d>0&&(A||r.node(d-1).canReplace(r.index(d-1),o.indexAfter(d-1))))return this.delete(r.before(d),o.after(d))}for(var g=1;g<=r.depth&&g<=o.depth;g++)if(t-r.start(g)==r.depth-g&&e>r.end(g)&&o.end(g)-e!=o.depth-g)return this.delete(r.before(g),e);return this.delete(t,e)};function X_(t,e){for(var r=[],o=Math.min(t.depth,e.depth),a=o;a>=0;a--){var l=t.start(a);if(l<t.pos-(t.depth-a)||e.end(a)>e.pos+(e.depth-a)||t.node(a).type.spec.isolating||e.node(a).type.spec.isolating)break;(l==e.start(a)||a==t.depth&&a==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&a&&e.start(a-1)==l-1)&&r.push(a)}return r}var Sg=Object.create(null),fr=function(e,r,o){this.ranges=o||[new zP(e.min(r),e.max(r))],this.$anchor=e,this.$head=r},Ps={anchor:{configurable:!0},head:{configurable:!0},from:{configurable:!0},to:{configurable:!0},$from:{configurable:!0},$to:{configurable:!0},empty:{configurable:!0}};Ps.anchor.get=function(){return this.$anchor.pos};Ps.head.get=function(){return this.$head.pos};Ps.from.get=function(){return this.$from.pos};Ps.to.get=function(){return this.$to.pos};Ps.$from.get=function(){return this.ranges[0].$from};Ps.$to.get=function(){return this.ranges[0].$to};Ps.empty.get=function(){for(var t=this.ranges,e=0;e<t.length;e++)if(t[e].$from.pos!=t[e].$to.pos)return!1;return!0};fr.prototype.content=function(){return this.$from.node(0).slice(this.from,this.to,!0)};fr.prototype.replace=function(e,r){r===void 0&&(r=Fe.empty);for(var o=r.content.lastChild,a=null,l=0;l<r.openEnd;l++)a=o,o=o.lastChild;for(var d=e.steps.length,A=this.ranges,g=0;g<A.length;g++){var v=A[g],C=v.$from,y=v.$to,w=e.mapping.slice(d);e.replaceRange(w.map(C.pos),w.map(y.pos),g?Fe.empty:r),g==0&&$_(e,d,(o?o.isInline:a&&a.isTextblock)?-1:1)}};fr.prototype.replaceWith=function(e,r){for(var o=e.steps.length,a=this.ranges,l=0;l<a.length;l++){var d=a[l],A=d.$from,g=d.$to,v=e.mapping.slice(o),C=v.map(A.pos),y=v.map(g.pos);l?e.deleteRange(C,y):(e.replaceRangeWith(C,y,r),$_(e,o,r.isInline?-1:1))}};fr.findFrom=function(e,r,o){var a=e.parent.inlineContent?new uu(e):Pc(e.node(0),e.parent,e.pos,e.index(),r,o);if(a)return a;for(var l=e.depth-1;l>=0;l--){var d=r<0?Pc(e.node(0),e.node(l),e.before(l+1),e.index(l),r,o):Pc(e.node(0),e.node(l),e.after(l+1),e.index(l)+1,r,o);if(d)return d}};fr.near=function(e,r){return r===void 0&&(r=1),this.findFrom(e,r)||this.findFrom(e,-r)||new hu(e.node(0))};fr.atStart=function(e){return Pc(e,e,0,0,1)||new hu(e)};fr.atEnd=function(e){return Pc(e,e,e.content.size,e.childCount,-1)||new hu(e)};fr.fromJSON=function(e,r){if(!r||!r.type)throw new RangeError("Invalid input for Selection.fromJSON");var o=Sg[r.type];if(!o)throw new RangeError("No selection type "+r.type+" defined");return o.fromJSON(e,r)};fr.jsonID=function(e,r){if(e in Sg)throw new RangeError("Duplicate use of selection JSON ID "+e);return Sg[e]=r,r.prototype.jsonID=e,r};fr.prototype.getBookmark=function(){return uu.between(this.$anchor,this.$head).getBookmark()};Object.defineProperties(fr.prototype,Ps);fr.prototype.visible=!0;var zP=function(e,r){this.$from=e,this.$to=r},uu=function(t){function e(o,a){a===void 0&&(a=o),t.call(this,o,a)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={$cursor:{configurable:!0}};return r.$cursor.get=function(){return this.$anchor.pos==this.$head.pos?this.$head:null},e.prototype.map=function(a,l){var d=a.resolve(l.map(this.head));if(!d.parent.inlineContent)return t.near(d);var A=a.resolve(l.map(this.anchor));return new e(A.parent.inlineContent?A:d,d)},e.prototype.replace=function(a,l){if(l===void 0&&(l=Fe.empty),t.prototype.replace.call(this,a,l),l==Fe.empty){var d=this.$from.marksAcross(this.$to);d&&a.ensureMarks(d)}},e.prototype.eq=function(a){return a instanceof e&&a.anchor==this.anchor&&a.head==this.head},e.prototype.getBookmark=function(){return new du(this.anchor,this.head)},e.prototype.toJSON=function(){return{type:"text",anchor:this.anchor,head:this.head}},e.fromJSON=function(a,l){if(typeof l.anchor!="number"||typeof l.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new e(a.resolve(l.anchor),a.resolve(l.head))},e.create=function(a,l,d){d===void 0&&(d=l);var A=a.resolve(l);return new this(A,d==l?A:a.resolve(d))},e.between=function(a,l,d){var A=a.pos-l.pos;if((!d||A)&&(d=A>=0?1:-1),!l.parent.inlineContent){var g=t.findFrom(l,d,!0)||t.findFrom(l,-d,!0);if(g)l=g.$head;else return t.near(l,d)}return a.parent.inlineContent||(A==0?a=l:(a=(t.findFrom(a,-d,!0)||t.findFrom(a,d,!0)).$anchor,a.pos<l.pos!=A<0&&(a=l))),new e(a,l)},Object.defineProperties(e.prototype,r),e}(fr);fr.jsonID("text",uu);var du=function(e,r){this.anchor=e,this.head=r};du.prototype.map=function(e){return new du(e.map(this.anchor),e.map(this.head))};du.prototype.resolve=function(e){return uu.between(e.resolve(this.anchor),e.resolve(this.head))};var Mc=function(t){function e(r){var o=r.nodeAfter,a=r.node(0).resolve(r.pos+o.nodeSize);t.call(this,r,a),this.node=o}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.map=function(o,a){var l=a.mapResult(this.anchor),d=l.deleted,A=l.pos,g=o.resolve(A);return d?t.near(g):new e(g)},e.prototype.content=function(){return new Fe(ge.from(this.node),0,0)},e.prototype.eq=function(o){return o instanceof e&&o.anchor==this.anchor},e.prototype.toJSON=function(){return{type:"node",anchor:this.anchor}},e.prototype.getBookmark=function(){return new Ch(this.anchor)},e.fromJSON=function(o,a){if(typeof a.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new e(o.resolve(a.anchor))},e.create=function(o,a){return new this(o.resolve(a))},e.isSelectable=function(o){return!o.isText&&o.type.spec.selectable!==!1},e}(fr);Mc.prototype.visible=!1;fr.jsonID("node",Mc);var Ch=function(e){this.anchor=e};Ch.prototype.map=function(e){var r=e.mapResult(this.anchor),o=r.deleted,a=r.pos;return o?new du(a,a):new Ch(a)};Ch.prototype.resolve=function(e){var r=e.resolve(this.anchor),o=r.nodeAfter;return o&&Mc.isSelectable(o)?new Mc(r):fr.near(r)};var hu=function(t){function e(r){t.call(this,r.resolve(0),r.resolve(r.content.size))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.replace=function(o,a){if(a===void 0&&(a=Fe.empty),a==Fe.empty){o.delete(0,o.doc.content.size);var l=t.atStart(o.doc);l.eq(o.selection)||o.setSelection(l)}else t.prototype.replace.call(this,o,a)},e.prototype.toJSON=function(){return{type:"all"}},e.fromJSON=function(o){return new e(o)},e.prototype.map=function(o){return new e(o)},e.prototype.eq=function(o){return o instanceof e},e.prototype.getBookmark=function(){return XP},e}(fr);fr.jsonID("all",hu);var XP={map:function(){return this},resolve:function(e){return new hu(e)}};function Pc(t,e,r,o,a,l){if(e.inlineContent)return uu.create(t,r);for(var d=o-(a>0?0:1);a>0?d<e.childCount:d>=0;d+=a){var A=e.child(d);if(A.isAtom){if(!l&&Mc.isSelectable(A))return Mc.create(t,r-(a<0?A.nodeSize:0))}else{var g=Pc(t,A,r+a,a<0?A.childCount:0,a,l);if(g)return g}r+=A.nodeSize*a}}function $_(t,e,r){var o=t.steps.length-1;if(!(o<e)){var a=t.steps[o];if(a instanceof Ms||a instanceof wa){var l=t.mapping.maps[o],d;l.forEach(function(A,g,v,C){d==null&&(d=C)}),t.setSelection(fr.near(t.doc.resolve(d),r))}}}var Z_=1,yh=2,eS=4,$P=function(t){function e(o){t.call(this,o.doc),this.time=Date.now(),this.curSelection=o.selection,this.curSelectionFor=0,this.storedMarks=o.storedMarks,this.updated=0,this.meta=Object.create(null)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={selection:{configurable:!0},selectionSet:{configurable:!0},storedMarksSet:{configurable:!0},isGeneric:{configurable:!0},scrolledIntoView:{configurable:!0}};return r.selection.get=function(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection},e.prototype.setSelection=function(a){if(a.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=a,this.curSelectionFor=this.steps.length,this.updated=(this.updated|Z_)&~yh,this.storedMarks=null,this},r.selectionSet.get=function(){return(this.updated&Z_)>0},e.prototype.setStoredMarks=function(a){return this.storedMarks=a,this.updated|=yh,this},e.prototype.ensureMarks=function(a){return kt.sameSet(this.storedMarks||this.selection.$from.marks(),a)||this.setStoredMarks(a),this},e.prototype.addStoredMark=function(a){return this.ensureMarks(a.addToSet(this.storedMarks||this.selection.$head.marks()))},e.prototype.removeStoredMark=function(a){return this.ensureMarks(a.removeFromSet(this.storedMarks||this.selection.$head.marks()))},r.storedMarksSet.get=function(){return(this.updated&yh)>0},e.prototype.addStep=function(a,l){t.prototype.addStep.call(this,a,l),this.updated=this.updated&~yh,this.storedMarks=null},e.prototype.setTime=function(a){return this.time=a,this},e.prototype.replaceSelection=function(a){return this.selection.replace(this,a),this},e.prototype.replaceSelectionWith=function(a,l){var d=this.selection;return l!==!1&&(a=a.mark(this.storedMarks||(d.empty?d.$from.marks():d.$from.marksAcross(d.$to)||kt.none))),d.replaceWith(this,a),this},e.prototype.deleteSelection=function(){return this.selection.replace(this),this},e.prototype.insertText=function(a,l,d){d===void 0&&(d=l);var A=this.doc.type.schema;if(l==null)return a?this.replaceSelectionWith(A.text(a),!0):this.deleteSelection();if(!a)return this.deleteRange(l,d);var g=this.storedMarks;if(!g){var v=this.doc.resolve(l);g=d==l?v.marks():v.marksAcross(this.doc.resolve(d))}return this.replaceRangeWith(l,d,A.text(a,g)),this.selection.empty||this.setSelection(fr.near(this.selection.$to)),this},e.prototype.setMeta=function(a,l){return this.meta[typeof a=="string"?a:a.key]=l,this},e.prototype.getMeta=function(a){return this.meta[typeof a=="string"?a:a.key]},r.isGeneric.get=function(){for(var o in this.meta)return!1;return!0},e.prototype.scrollIntoView=function(){return this.updated|=eS,this},r.scrolledIntoView.get=function(){return(this.updated&eS)>0},Object.defineProperties(e.prototype,r),e}(Rr);function tS(t,e){return!e||!t?t:t.bind(e)}var pu=function(e,r,o){this.name=e,this.init=tS(r.init,o),this.apply=tS(r.apply,o)},ZP=[new pu("doc",{init:function(e){return e.doc||e.schema.topNodeType.createAndFill()},apply:function(e){return e.doc}}),new pu("selection",{init:function(e,r){return e.selection||fr.atStart(r.doc)},apply:function(e){return e.selection}}),new pu("storedMarks",{init:function(e){return e.storedMarks||null},apply:function(e,r,o,a){return a.selection.$cursor?e.storedMarks:null}}),new pu("scrollToSelection",{init:function(){return 0},apply:function(e,r){return e.scrolledIntoView?r+1:r}})],Tg=function(e,r){var o=this;this.schema=e,this.fields=ZP.concat(),this.plugins=[],this.pluginsByKey=Object.create(null),r&&r.forEach(function(a){if(o.pluginsByKey[a.key])throw new RangeError("Adding different instances of a keyed plugin ("+a.key+")");o.plugins.push(a),o.pluginsByKey[a.key]=a,a.spec.state&&o.fields.push(new pu(a.key,a.spec.state,a))})},qn=function(e){this.config=e},_h={schema:{configurable:!0},plugins:{configurable:!0},tr:{configurable:!0}};_h.schema.get=function(){return this.config.schema};_h.plugins.get=function(){return this.config.plugins};qn.prototype.apply=function(e){return this.applyTransaction(e).state};qn.prototype.filterTransaction=function(e,r){r===void 0&&(r=-1);for(var o=0;o<this.config.plugins.length;o++)if(o!=r){var a=this.config.plugins[o];if(a.spec.filterTransaction&&!a.spec.filterTransaction.call(a,e,this))return!1}return!0};qn.prototype.applyTransaction=function(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};for(var r=[e],o=this.applyInner(e),a=null;;){for(var l=!1,d=0;d<this.config.plugins.length;d++){var A=this.config.plugins[d];if(A.spec.appendTransaction){var g=a?a[d].n:0,v=a?a[d].state:this,C=g<r.length&&A.spec.appendTransaction.call(A,g?r.slice(g):r,v,o);if(C&&o.filterTransaction(C,d)){if(C.setMeta("appendedTransaction",e),!a){a=[];for(var y=0;y<this.config.plugins.length;y++)a.push(y<d?{state:o,n:r.length}:{state:this,n:0})}r.push(C),o=o.applyInner(C),l=!0}a&&(a[d]={state:o,n:r.length})}}if(!l)return{state:o,transactions:r}}};qn.prototype.applyInner=function(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");for(var r=new qn(this.config),o=this.config.fields,a=0;a<o.length;a++){var l=o[a];r[l.name]=l.apply(e,this[l.name],this,r)}for(var d=0;d<Au.length;d++)Au[d](this,e,r);return r};_h.tr.get=function(){return new $P(this)};qn.create=function(e){for(var r=new Tg(e.doc?e.doc.type.schema:e.schema,e.plugins),o=new qn(r),a=0;a<r.fields.length;a++)o[r.fields[a].name]=r.fields[a].init(e,o);return o};qn.prototype.reconfigure=function(e){for(var r=new Tg(this.schema,e.plugins),o=r.fields,a=new qn(r),l=0;l<o.length;l++){var d=o[l].name;a[d]=this.hasOwnProperty(d)?this[d]:o[l].init(e,a)}return a};qn.prototype.toJSON=function(e){var r={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(r.storedMarks=this.storedMarks.map(function(d){return d.toJSON()})),e&&typeof e=="object")for(var o in e){if(o=="doc"||o=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");var a=e[o],l=a.spec.state;l&&l.toJSON&&(r[o]=l.toJSON.call(a,this[a.key]))}return r};qn.fromJSON=function(e,r,o){if(!r)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");var a=new Tg(e.schema,e.plugins),l=new qn(a);return a.fields.forEach(function(d){if(d.name=="doc")l.doc=bt.fromJSON(e.schema,r.doc);else if(d.name=="selection")l.selection=fr.fromJSON(l.doc,r.selection);else if(d.name=="storedMarks")r.storedMarks&&(l.storedMarks=r.storedMarks.map(e.schema.markFromJSON));else{if(o)for(var A in o){var g=o[A],v=g.spec.state;if(g.key==d.name&&v&&v.fromJSON&&Object.prototype.hasOwnProperty.call(r,A)){l[d.name]=v.fromJSON.call(g,e,r[A],l);return}}l[d.name]=d.init(e,l)}}),l};qn.addApplyListener=function(e){Au.push(e)};qn.removeApplyListener=function(e){var r=Au.indexOf(e);r>-1&&Au.splice(r,1)};Object.defineProperties(qn.prototype,_h);var Au=[];function rS(t,e,r){for(var o in t){var a=t[o];a instanceof Function?a=a.bind(e):o=="handleDOMEvents"&&(a=rS(a,e,{})),r[o]=a}return r}var nS=function(e){this.props={},e.props&&rS(e.props,this,this.props),this.spec=e,this.key=e.key?e.key.key:iS("plugin")};nS.prototype.getState=function(e){return e[this.key]};var Rg=Object.create(null);function iS(t){return t in Rg?t+"$"+ ++Rg[t]:(Rg[t]=0,t+"$")}var wg=function(e){e===void 0&&(e="key"),this.key=iS(e)};wg.prototype.get=function(e){return e.config.pluginsByKey[this.key]};wg.prototype.getState=function(e){return e[this.key]};const e3=new wg("characterLimit");tn.create({name:"characterCount",addOptions(){return{limit:0}},addProseMirrorPlugins(){const{options:t}=this;return[new nS({key:e3,appendTransaction:(e,r,o)=>{const a=o.doc.content.size;if(t.limit&&a>t.limit)return o.tr.insertText("",t.limit+1,a)}})]}});const t3={setup(t){const e=la([{name:"\u97F3\u9891",value:0},{name:"\u89C6\u9891",value:1}]),r=Sn(0),o=a=>{r.value=a};return(a,l)=>(Xt(),wo(Ei(_N),{onChange:o},{default:$o(()=>[nr(Ei(yN),{class:"flex p-1 space-x-1 bg-indigo-500 rounded-lg dark border dark:border-gray-600 transition"},{default:$o(()=>[(Xt(!0),Tn(Ac,null,qI(Ei(e),d=>(Xt(),wo(Ei(CN),{as:"template",key:d.value},{default:$o(({selected:A})=>[Tt("button",{class:un(["w-full py-1 text-sm leading-5 font-mediumtext-white text-white font-bold rounded-md","focus:outline-none focus:ring-2 ring-offset-2 ring-offset-indigo-300",A?"bg-white shadow text-indigo-700":"hover:bg-white/[0.12]"])},yd(d.name),3)]),_:2},1024))),128))]),_:1})]),_:1}))}},oS=Object.prototype.toString;function r3(t){return oS.call(t)==="[object Array]"}function sS(t){return oS.call(t)==="[object String]"}function n3(t){return t===void 0}function Ng(t){return typeof t=="function"}const i3=Symbol("ArcoConfigProvider");var o3=Object.defineProperty,s3=Object.defineProperties,a3=Object.getOwnPropertyDescriptors,aS=Object.getOwnPropertySymbols,c3=Object.prototype.hasOwnProperty,l3=Object.prototype.propertyIsEnumerable,cS=(t,e,r)=>e in t?o3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,u3=(t,e)=>{for(var r in e||(e={}))c3.call(e,r)&&cS(t,r,e[r]);if(aS)for(var r of aS(e))l3.call(e,r)&&cS(t,r,e[r]);return t},d3=(t,e)=>s3(t,a3(e));const h3="A",p3="arco",Og="$arco",lS=t=>{var e;return(e=t==null?void 0:t.componentPrefix)!=null?e:h3},uS=(t,e)=>{var r;e&&e.classPrefix&&(t.config.globalProperties[Og]=d3(u3({},(r=t.config.globalProperties[Og])!=null?r:{}),{classPrefix:e.classPrefix}))},Qo=t=>{var e,r,o;const a=Cd(),l=RA(i3,void 0),d=(o=(r=l==null?void 0:l.prefixCls)!=null?r:(e=a==null?void 0:a.appContext.config.globalProperties[Og])==null?void 0:e.classPrefix)!=null?o:p3;return t?`${d}-${t}`:d},dS=["info","success","warning","error"],A3=["top","tl","tr","bottom","bl","br","left","lt","lb","right","rt","rb"],hS=["hover","click","focus","contextMenu"];var Qs=(t,e)=>{for(const[r,o]of e)t[r]=o;return t};const f3=_n({name:"IconHover",props:{prefix:{type:String},size:{type:String,default:"medium"},disabled:{type:Boolean,default:!1}},setup(){return{prefixCls:Qo("icon-hover")}}});function g3(t,e,r,o,a,l){return Xt(),Tn("span",{class:un([t.prefixCls,{[`${t.prefix}-icon-hover`]:t.prefix,[`${t.prefixCls}-size-${t.size}`]:t.size!=="default",[`${t.prefixCls}-disabled`]:t.disabled}])},[fc(t.$slots,"default")],2)}var m3=Qs(f3,[["render",g3]]);const v3=_n({name:"IconClose",props:{strokeWidth:{type:Number,default:4},strokeLinecap:{type:String,default:"butt",validator:t=>["butt","round","square"].includes(t)},strokeLinejoin:{type:String,default:"miter",validator:t=>["arcs","bevel","miter","miter-clip","round"].includes(t)},spin:Boolean},setup(t){const e=Qo("icon");return{cls:Fn(()=>[e,`${e}-close`,{[`${e}-spin`]:t.spin}])}}}),E3=["stroke-width","stroke-linecap","stroke-linejoin"],I3=Tt("path",{d:"M9.857 9.858 24 24m0 0 14.142 14.142M24 24 38.142 9.858M24 24 9.857 38.142"},null,-1),C3=[I3];function y3(t,e,r,o,a,l){return Xt(),Tn("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:un(t.cls),"stroke-width":t.strokeWidth,"stroke-linecap":t.strokeLinecap,"stroke-linejoin":t.strokeLinejoin},C3,10,E3)}var kg=Qs(v3,[["render",y3]]);const _3=Object.assign(kg,{install:(t,e)=>{var r;const o=(r=e==null?void 0:e.iconPrefix)!=null?r:"";t.component(o+kg.name,kg)}});var S3=Object.defineProperty,pS=Object.getOwnPropertySymbols,T3=Object.prototype.hasOwnProperty,R3=Object.prototype.propertyIsEnumerable,AS=(t,e,r)=>e in t?S3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ni=(t,e)=>{for(var r in e||(e={}))T3.call(e,r)&&AS(t,r,e[r]);if(pS)for(var r of pS(e))R3.call(e,r)&&AS(t,r,e[r]);return t};const w3=()=>({width:document.documentElement.clientWidth||window.innerWidth,height:document.documentElement.clientHeight||window.innerHeight}),fS=(t,e)=>{const r=t.getBoundingClientRect();return{top:r.top,bottom:r.bottom,left:r.left,right:r.right,scrollTop:r.top-e.top,scrollBottom:r.bottom-e.top,scrollLeft:r.left-e.left,scrollRight:r.right-e.left,width:t.offsetWidth,height:t.offsetHeight}},N3=t=>{switch(t){case"top":case"tl":case"tr":return"top";case"bottom":case"bl":case"br":return"bottom";case"left":case"lt":case"lb":return"left";case"right":case"rt":case"rb":return"right";default:return"top"}},Sh=(t,e)=>{switch(e){case"top":switch(t){case"bottom":return"top";case"bl":return"tl";case"br":return"tr";default:return t}case"bottom":switch(t){case"top":return"bottom";case"tl":return"bl";case"tr":return"br";default:return t}case"left":switch(t){case"right":return"left";case"rt":return"lt";case"rb":return"lb";default:return t}case"right":switch(t){case"left":return"right";case"lt":return"rt";case"lb":return"rb";default:return t}default:return t}},O3=(t,e,{containerRect:r,triggerRect:o,popupRect:a,offset:l,translate:d})=>{const A=N3(t),g=w3(),v={top:r.top+e.top,bottom:g.height-(r.top+e.top+a.height),left:r.left+e.left,right:g.width-(r.left+e.left+a.width)};let C=t;if(A==="top"&&v.top<0)if(o.top>a.height)e.top=-r.top;else{const y=fu("bottom",o,a,{offset:l,translate:d});g.height-(r.top+y.top+a.height)>0&&(C=Sh(t,"bottom"),e.top=y.top)}if(A==="bottom"&&v.bottom<0)if(g.height-o.bottom>a.height)e.top=-r.top+(g.height-a.height);else{const y=fu("top",o,a,{offset:l,translate:d});r.top+y.top>0&&(C=Sh(t,"top"),e.top=y.top)}if(A==="left"&&v.left<0)if(o.left>a.width)e.left=-r.left;else{const y=fu("right",o,a,{offset:l,translate:d});g.width-(r.left+y.left+a.width)>0&&(C=Sh(t,"right"),e.left=y.left)}if(A==="right"&&v.right<0)if(g.width-o.right>a.width)e.left=-r.left+(g.width-a.width);else{const y=fu("left",o,a,{offset:l,translate:d});r.left+y.left>0&&(C=Sh(t,"left"),e.left=y.left)}return(A==="top"||A==="bottom")&&(v.left<0?e.left=-r.left:v.right<0&&(e.left=-r.left+(g.width-a.width))),(A==="left"||A==="right")&&(v.top<0?e.top=-r.top:v.bottom<0&&(e.top=-r.top+(g.height-a.height))),{popupPosition:e,position:C}},fu=(t,e,r,{offset:o=0,translate:a=[0,0]}={})=>{var l;const d=(l=r3(a)?a:a[t])!=null?l:[0,0];switch(t){case"top":return{left:e.scrollLeft+Math.round(e.width/2)-Math.round(r.width/2)+d[0],top:e.scrollTop-r.height-o+d[1]};case"tl":return{left:e.scrollLeft+d[0],top:e.scrollTop-r.height-o+d[1]};case"tr":return{left:e.scrollRight-r.width+d[0],top:e.scrollTop-r.height-o+d[1]};case"bottom":return{left:e.scrollLeft+Math.round(e.width/2)-Math.round(r.width/2)+d[0],top:e.scrollBottom+o+d[1]};case"bl":return{left:e.scrollLeft+d[0],top:e.scrollBottom+o+d[1]};case"br":return{left:e.scrollRight-r.width+d[0],top:e.scrollBottom+o+d[1]};case"left":return{left:e.scrollLeft-r.width-o+d[0],top:e.scrollTop+Math.round(e.height/2)-Math.round(r.height/2)+d[1]};case"lt":return{left:e.scrollLeft-r.width-o+d[0],top:e.scrollTop+d[1]};case"lb":return{left:e.scrollLeft-r.width-o+d[0],top:e.scrollBottom-r.height+d[1]};case"right":return{left:e.scrollRight+o+d[0],top:e.scrollTop+Math.round(e.height/2)-Math.round(r.height/2)+d[1]};case"rt":return{left:e.scrollRight+o+d[0],top:e.scrollTop+d[1]};case"rb":return{left:e.scrollRight+o+d[0],top:e.scrollBottom-r.height+d[1]};default:return{left:0,top:0}}},k3=(t,e,r,o,{offset:a=0,translate:l=[0,0],customStyle:d={},autoFitPosition:A=!1,autoFitTransformOrigin:g=!1}={})=>{let v=t,C=fu(t,r,o,{offset:a,translate:l});if(A){const w=O3(t,C,{containerRect:e,popupRect:o,triggerRect:r,offset:a,translate:l});C=w.popupPosition,v=w.position}const y=Ni({left:`${C.left}px`,top:`${C.top}px`},d);if(g){let w="0";["top","bottom"].includes(v)?w="50%":["left","lt","lb","tr","br"].includes(v)&&(w="100%");let k="0";["left","right"].includes(v)?k="50%":["top","tl","tr","lt","rt"].includes(v)&&(k="100%"),y.transformOrigin=`${w} ${k}`}return{style:y,position:v}},qi=t=>`${t} rotate(45deg)`,b3=(t,e,{customStyle:r={}})=>{switch(t){case"top":return Ni({left:"50%",bottom:"0",transform:qi("translate(-50%,50%)")},r);case"tl":return Ni({left:`${Math.round(e.width/2)}px`,bottom:"0",transform:qi("translate(-50%,50%)")},r);case"tr":return Ni({right:`${Math.round(e.width/2)}px`,bottom:"0",transform:qi("translate(50%,50%)")},r);case"bottom":return Ni({left:"50%",top:"0",transform:qi("translate(-50%,-50%)")},r);case"bl":return Ni({left:`${Math.round(e.width/2)}px`,top:"0",transform:qi("translate(-50%,-50%)")},r);case"br":return Ni({right:`${Math.round(e.width/2)}px`,top:"0",transform:qi("translate(50%,-50%)")},r);case"left":return Ni({right:"0",top:"50%",transform:qi("translate(50%,-50%)")},r);case"lt":return Ni({right:"0",top:`${Math.round(e.height/2)}px`,transform:qi("translate(50%,-50%)")},r);case"lb":return Ni({right:"0",bottom:`${Math.round(e.height/2)}px`,transform:qi("translate(50%,50%)")},r);case"right":return Ni({left:"0",top:"50%",transform:qi("translate(-50%,-50%)")},r);case"rt":return Ni({left:"0",top:`${Math.round(e.height/2)}px`,transform:qi("translate(-50%,-50%)")},r);case"rb":return Ni({left:"0",bottom:`${Math.round(e.height/2)}px`,transform:qi("translate(-50%,50%)")},r);default:return{}}},D3=t=>t.scrollHeight>t.offsetHeight||t.scrollWidth>t.offsetWidth,B3=t=>{const e=[];let r=t;for(;r&&r!==document.documentElement;)D3(r)&&e.push(r),r=r.parentElement;return e};var gS=function(){if(typeof Map!="undefined")return Map;function t(e,r){var o=-1;return e.some(function(a,l){return a[0]===r?(o=l,!0):!1}),o}return function(){function e(){this.__entries__=[]}return Object.defineProperty(e.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),e.prototype.get=function(r){var o=t(this.__entries__,r),a=this.__entries__[o];return a&&a[1]},e.prototype.set=function(r,o){var a=t(this.__entries__,r);~a?this.__entries__[a][1]=o:this.__entries__.push([r,o])},e.prototype.delete=function(r){var o=this.__entries__,a=t(o,r);~a&&o.splice(a,1)},e.prototype.has=function(r){return!!~t(this.__entries__,r)},e.prototype.clear=function(){this.__entries__.splice(0)},e.prototype.forEach=function(r,o){o===void 0&&(o=null);for(var a=0,l=this.__entries__;a<l.length;a++){var d=l[a];r.call(o,d[1],d[0])}},e}()}(),bg=typeof window!="undefined"&&typeof document!="undefined"&&window.document===document,Th=function(){return typeof global!="undefined"&&global.Math===Math?global:typeof self!="undefined"&&self.Math===Math?self:typeof window!="undefined"&&window.Math===Math?window:Function("return this")()}(),L3=function(){return typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(Th):function(t){return setTimeout(function(){return t(Date.now())},1e3/60)}}(),M3=2;function P3(t,e){var r=!1,o=!1,a=0;function l(){r&&(r=!1,t()),o&&A()}function d(){L3(l)}function A(){var g=Date.now();if(r){if(g-a<M3)return;o=!0}else r=!0,o=!1,setTimeout(d,e);a=g}return A}var Q3=20,x3=["top","right","bottom","left","width","height","size","weight"],U3=typeof MutationObserver!="undefined",F3=function(){function t(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=P3(this.refresh.bind(this),Q3)}return t.prototype.addObserver=function(e){~this.observers_.indexOf(e)||this.observers_.push(e),this.connected_||this.connect_()},t.prototype.removeObserver=function(e){var r=this.observers_,o=r.indexOf(e);~o&&r.splice(o,1),!r.length&&this.connected_&&this.disconnect_()},t.prototype.refresh=function(){var e=this.updateObservers_();e&&this.refresh()},t.prototype.updateObservers_=function(){var e=this.observers_.filter(function(r){return r.gatherActive(),r.hasActive()});return e.forEach(function(r){return r.broadcastActive()}),e.length>0},t.prototype.connect_=function(){!bg||this.connected_||(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),U3?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},t.prototype.disconnect_=function(){!bg||!this.connected_||(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},t.prototype.onTransitionEnd_=function(e){var r=e.propertyName,o=r===void 0?"":r,a=x3.some(function(l){return!!~o.indexOf(l)});a&&this.refresh()},t.getInstance=function(){return this.instance_||(this.instance_=new t),this.instance_},t.instance_=null,t}(),mS=function(t,e){for(var r=0,o=Object.keys(e);r<o.length;r++){var a=o[r];Object.defineProperty(t,a,{value:e[a],enumerable:!1,writable:!1,configurable:!0})}return t},Qc=function(t){var e=t&&t.ownerDocument&&t.ownerDocument.defaultView;return e||Th},vS=wh(0,0,0,0);function Rh(t){return parseFloat(t)||0}function ES(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];return e.reduce(function(o,a){var l=t["border-"+a+"-width"];return o+Rh(l)},0)}function V3(t){for(var e=["top","right","bottom","left"],r={},o=0,a=e;o<a.length;o++){var l=a[o],d=t["padding-"+l];r[l]=Rh(d)}return r}function G3(t){var e=t.getBBox();return wh(0,0,e.width,e.height)}function j3(t){var e=t.clientWidth,r=t.clientHeight;if(!e&&!r)return vS;var o=Qc(t).getComputedStyle(t),a=V3(o),l=a.left+a.right,d=a.top+a.bottom,A=Rh(o.width),g=Rh(o.height);if(o.boxSizing==="border-box"&&(Math.round(A+l)!==e&&(A-=ES(o,"left","right")+l),Math.round(g+d)!==r&&(g-=ES(o,"top","bottom")+d)),!K3(t)){var v=Math.round(A+l)-e,C=Math.round(g+d)-r;Math.abs(v)!==1&&(A-=v),Math.abs(C)!==1&&(g-=C)}return wh(a.left,a.top,A,g)}var H3=function(){return typeof SVGGraphicsElement!="undefined"?function(t){return t instanceof Qc(t).SVGGraphicsElement}:function(t){return t instanceof Qc(t).SVGElement&&typeof t.getBBox=="function"}}();function K3(t){return t===Qc(t).document.documentElement}function W3(t){return bg?H3(t)?G3(t):j3(t):vS}function Y3(t){var e=t.x,r=t.y,o=t.width,a=t.height,l=typeof DOMRectReadOnly!="undefined"?DOMRectReadOnly:Object,d=Object.create(l.prototype);return mS(d,{x:e,y:r,width:o,height:a,top:r,right:e+o,bottom:a+r,left:e}),d}function wh(t,e,r,o){return{x:t,y:e,width:r,height:o}}var q3=function(){function t(e){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=wh(0,0,0,0),this.target=e}return t.prototype.isActive=function(){var e=W3(this.target);return this.contentRect_=e,e.width!==this.broadcastWidth||e.height!==this.broadcastHeight},t.prototype.broadcastRect=function(){var e=this.contentRect_;return this.broadcastWidth=e.width,this.broadcastHeight=e.height,e},t}(),J3=function(){function t(e,r){var o=Y3(r);mS(this,{target:e,contentRect:o})}return t}(),z3=function(){function t(e,r,o){if(this.activeObservations_=[],this.observations_=new gS,typeof e!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=e,this.controller_=r,this.callbackCtx_=o}return t.prototype.observe=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element=="undefined"||!(Element instanceof Object))){if(!(e instanceof Qc(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var r=this.observations_;r.has(e)||(r.set(e,new q3(e)),this.controller_.addObserver(this),this.controller_.refresh())}},t.prototype.unobserve=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element=="undefined"||!(Element instanceof Object))){if(!(e instanceof Qc(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var r=this.observations_;!r.has(e)||(r.delete(e),r.size||this.controller_.removeObserver(this))}},t.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},t.prototype.gatherActive=function(){var e=this;this.clearActive(),this.observations_.forEach(function(r){r.isActive()&&e.activeObservations_.push(r)})},t.prototype.broadcastActive=function(){if(!!this.hasActive()){var e=this.callbackCtx_,r=this.activeObservations_.map(function(o){return new J3(o.target,o.broadcastRect())});this.callback_.call(e,r,e),this.clearActive()}},t.prototype.clearActive=function(){this.activeObservations_.splice(0)},t.prototype.hasActive=function(){return this.activeObservations_.length>0},t}(),IS=typeof WeakMap!="undefined"?new WeakMap:new gS,CS=function(){function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var r=F3.getInstance(),o=new z3(e,r,this);IS.set(this,o)}return t}();["observe","unobserve","disconnect"].forEach(function(t){CS.prototype[t]=function(){var e;return(e=IS.get(this))[t].apply(e,arguments)}});var X3=function(){return typeof Th.ResizeObserver!="undefined"?Th.ResizeObserver:CS}();const Dg=()=>{},Bg=(()=>{try{return!(typeof window!="undefined"&&document!==void 0)}catch{return!0}})(),$3=(()=>Bg?Dg:(t,e,r,o=!1)=>{t.addEventListener(e,r,o)})(),Z3=(()=>Bg?Dg:(t,e,r,o=!1)=>{t.removeEventListener(e,r,o)})(),yS=t=>{let e=t.el;for(;e&&!e.tagName;)e=e.nextSibling;return e},e4=t=>{const e=document.createElement("div");return e.setAttribute("class",`arco-overlay arco-overlay-${t}`),e},t4=t=>Bg?Dg():document.querySelector(t),r4=t=>sS(t)?t4(t):t||void 0;var n4=_n({name:"ResizeObserver",emits:["resize"],setup(t,{emit:e,slots:r}){let o;const a=g=>yS(g.vnode),l=g=>yS(g.subTree),d=g=>{!g||(o=new X3(v=>{const C=v[0];e("resize",C)}),o.observe(g))},A=()=>{o&&(o.disconnect(),o=null)};return pc(()=>{const g=Cd();if(g){const v=a(g);d(v)}}),_d(()=>{const g=Cd();if(g){const v=a(g),C=l(g);v!==C&&(o&&A(),d(v))}else A()}),Sd(()=>{A()}),()=>{const g=r.default&&r.default();return g&&g.length?g[0]:null}}}),_S;(function(t){t[t.ELEMENT=1]="ELEMENT",t[t.FUNCTIONAL_COMPONENT=2]="FUNCTIONAL_COMPONENT",t[t.STATEFUL_COMPONENT=4]="STATEFUL_COMPONENT",t[t.COMPONENT=6]="COMPONENT",t[t.TEXT_CHILDREN=8]="TEXT_CHILDREN",t[t.ARRAY_CHILDREN=16]="ARRAY_CHILDREN",t[t.SLOTS_CHILDREN=32]="SLOTS_CHILDREN",t[t.TELEPORT=64]="TELEPORT",t[t.SUSPENSE=128]="SUSPENSE",t[t.COMPONENT_SHOULD_KEEP_ALIVE=256]="COMPONENT_SHOULD_KEEP_ALIVE",t[t.COMPONENT_KEPT_ALIVE=512]="COMPONENT_KEPT_ALIVE"})(_S||(_S={}));const i4=t=>(t==null?void 0:t.$)!==void 0,o4=t=>Boolean(t&&t.shapeFlag&1),s4=(t,e)=>Boolean(t&&t.shapeFlag&6),a4=(t,e)=>Boolean(t&&t.shapeFlag&16),c4=(t,e)=>Boolean(t&&t.shapeFlag&32),l4=t=>{if(!t)return!0;for(const e of t)if(e.children)return!1;return!0},Lg=(t,e)=>{var r,o,a;for(let l=0;l<t.length;l++){const d=t[l];if(o4(d)||s4(d)){const A=Ng(e)?e(d):e;return t[l]=SN(d,A,!0),!0}if(a4(d,d.children)){if(Lg(d.children,e))return!0}else if(c4(d,d.children)){const A=(a=(o=(r=d.children).default)==null?void 0:o.call(r))!=null?a:[];if(Lg(A,e))return t[l]=nr(d,null,{default:()=>A}),!0}}return!1};function u4(t,e){const r=Sn(t[e]);return _d(()=>{const o=t[e];r.value!==o&&(r.value=o)}),r}const SS=Symbol("ArcoTrigger"),TS=Symbol("ArcoZIndex"),RS=typeof window=="undefined"?global:window,d4=RS.requestAnimationFrame,wS=RS.cancelAnimationFrame;function h4(t){let e=0;const r=(...o)=>{e&&wS(e),e=d4(()=>{t(...o),e=0})};return r.cancel=()=>{wS(e),e=0},r}var p4=Object.defineProperty,A4=Object.defineProperties,f4=Object.getOwnPropertyDescriptors,NS=Object.getOwnPropertySymbols,g4=Object.prototype.hasOwnProperty,m4=Object.prototype.propertyIsEnumerable,OS=(t,e,r)=>e in t?p4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,kS=(t,e)=>{for(var r in e||(e={}))g4.call(e,r)&&OS(t,r,e[r]);if(NS)for(var r of NS(e))m4.call(e,r)&&OS(t,r,e[r]);return t},v4=(t,e)=>A4(t,f4(e));function E4(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!XI(t)}const I4=100;var Mg=_n({name:"Trigger",inheritAttrs:!1,props:{popupVisible:{type:Boolean,default:void 0},defaultPopupVisible:{type:Boolean,default:!1},trigger:{type:[String,Array],default:"hover",validator:t=>{const e=[].concat(t);for(const r of e)if(!hS.includes(r))return!1;return!0}},position:{type:String,default:"bottom"},disabled:{type:Boolean,default:!1},popupOffset:{type:Number,default:0},popupTranslate:{type:[Array,Object]},showArrow:{type:Boolean,default:!1},alignPoint:{type:Boolean,default:!1},popupHoverStay:{type:Boolean,default:!0},blurToClose:{type:Boolean,default:!0},clickToClose:{type:Boolean,default:!0},clickOutsideToClose:{type:Boolean,default:!0},unmountOnClose:{type:Boolean,default:!0},contentClass:{type:[String,Array,Object]},contentStyle:{type:Object},arrowClass:{type:[String,Array,Object]},arrowStyle:{type:Object},popupStyle:{type:Object},animationName:{type:String,default:"fade-in"},duration:{type:[Number,Object]},mouseEnterDelay:{type:Number,default:100},mouseLeaveDelay:{type:Number,default:100},focusDelay:{type:Number,default:0},autoFitPopupWidth:{type:Boolean,default:!1},autoFitPopupMinWidth:{type:Boolean,default:!1},autoFixPosition:{type:Boolean,default:!0},popupContainer:{type:[String,Object]},updateAtScroll:{type:Boolean,default:!1},autoFitTransformOrigin:{type:Boolean,default:!1},hideEmpty:{type:Boolean,default:!1},openedCls:{type:String},autoFitPosition:{type:Boolean,default:!0},renderToBody:{type:Boolean,default:!0},onPopupVisibleChange:{type:Function}},emits:["update:popupVisible","popupVisibleChange"],setup(t,{emit:e,slots:r,attrs:o}){var a;const l=Qo("trigger"),d=Fn(()=>[].concat(t.trigger)),A=new Set,g=RA(SS,void 0),v=RA(TS,void 0),C=((a=v==null?void 0:v.zIndex)!=null?a:0)+I4,y=Sn(),w=Fn(()=>i4(y.value)?y.value.$el:y.value),k={},M=Sn(),F=Sn(t.defaultPopupVisible),K=Sn(t.position),J={},U=Sn({}),te=Sn({}),P=Fn(()=>{var xe;return r4((xe=t.popupContainer)!=null?xe:document.documentElement)}),he=Sn(),ne=Sn({top:"0px",left:"0px"}),me=Fn(()=>{var xe;return(xe=t.popupVisible)!=null?xe:F.value});let Pe=0,Me=!1;const be=()=>{Pe&&(window.clearTimeout(Pe),Pe=0)},Gt=xe=>{if(t.alignPoint){const{pageX:St,pageY:tr}=xe;ne.value={top:`${tr}px`,left:`${St}px`}}},At=()=>{if(t.alignPoint)U.value=ne.value;else{if(!w.value||!M.value||!P.value)return;const xe=P.value.getBoundingClientRect(),St=fS(w.value,xe),tr=fS(M.value,xe),{style:Zt,position:Kr}=k3(t.position,xe,St,tr,{offset:t.popupOffset,translate:t.popupTranslate,customStyle:t.popupStyle,autoFitPosition:t.autoFitPosition,autoFitTransformOrigin:t.autoFitTransformOrigin});t.autoFitPopupMinWidth?Zt.minWidth=`${St.width}px`:t.autoFitPopupWidth&&(Zt.width=`${St.width}px`),K.value!==Kr&&(K.value=Kr),U.value=Zt,t.showArrow&&(te.value=b3(Kr,St,{customStyle:t.arrowStyle}))}},it=(xe,St)=>{if(xe===me.value&&Pe===0)return;const tr=()=>{F.value=xe,e("update:popupVisible",xe),e("popupVisibleChange",xe),xe&&TA(()=>{At()})};St?(be(),Pe=window.setTimeout(tr,St)):tr()},gr=xe=>{me.value&&!t.clickToClose||(Gt(xe),it(!me.value))},_t=xe=>{g==null||g.onMouseenter(),Gt(xe),it(!0,t.mouseEnterDelay)},Et=()=>{g==null||g.onMouseleave(),it(!1,t.mouseLeaveDelay)},ar=()=>{g==null||g.onFocusin(),it(!0,t.focusDelay)},mr=()=>{g==null||g.onFocusout(),!!t.blurToClose&&it(!1)};d.value.includes("click")&&(k.onClick=gr),d.value.includes("hover")&&(k.onMouseenter=_t,k.onMouseleave=Et,t.popupHoverStay&&(J.onMouseenter=_t,J.onMouseleave=Et)),d.value.includes("focus")&&(k.onFocusin=ar,k.onFocusout=mr),d.value.includes("contextMenu")&&(k.onContextmenu=xe=>{xe.preventDefault(),gr(xe)}),JI(SS,la({onMouseenter:_t,onMouseleave:Et,onFocusin:ar,onFocusout:mr,addChildRef:xe=>{A.add(xe),g==null||g.addChildRef(xe)},removeChildRef:xe=>{A.delete(xe),g==null||g.removeChildRef(xe)}})),JI(TS,la({zIndex:C}));const ai=()=>{Z3(document.documentElement,"mousedown",mn),Me=!1},rn=u4(r,"content"),Oi=Fn(()=>{var xe;return t.hideEmpty&&l4((xe=rn.value)==null?void 0:xe.call(rn))}),mn=xe=>{var St,tr,Zt;if(!(((St=w.value)==null?void 0:St.contains(xe.target))||((tr=M.value)==null?void 0:tr.contains(xe.target)))){for(const Kr of A)if((Zt=Kr.value)==null?void 0:Zt.contains(xe.target))return;ai(),it(!1)}},xr=h4(()=>{me.value&&At()}),ci=()=>{me.value&&At()};g==null||g.addChildRef(M);const Ao=Fn(()=>me.value?t.openedCls:void 0);let vn;return zI(me,xe=>{if(t.clickOutsideToClose){if(Me&&!xe){ai();return}Me||($3(document.documentElement,"mousedown",mn),Me=!0)}if(t.updateAtScroll){if(xe){vn=B3(w.value);for(const St of vn)St.addEventListener("scroll",xr)}else if(vn)for(const St of vn)St.removeEventListener("scroll",xr)}}),zI(()=>[t.autoFitPopupWidth,t.autoFitPopupMinWidth],()=>{me.value&&At()}),pc(()=>{me.value&&At()}),_d(()=>{me.value&&At()}),Id(()=>{g==null||g.removeChildRef(M)}),()=>{var xe,St,tr;const Zt=(St=(xe=r.default)==null?void 0:xe.call(r))!=null?St:[];return!t.disabled&&Zt&&Lg(Zt,kS({ref:y,class:Ao.value},k)),nr(Ac,null,[t.autoFixPosition?nr(n4,{onResize:ci},E4(Zt)?Zt:{default:()=>[Zt]}):Zt,nr(YI,{to:(tr=t.popupContainer)!=null?tr:"body",disabled:!t.renderToBody},{default:()=>[nr(TN,{name:t.animationName,duration:t.duration},{default:()=>{var Kr;return[(!t.unmountOnClose||me.value)&&!Oi.value&&$I(nr("div",wN({ref:M,class:[`${l}-popup`,`${l}-position-${K.value}`],style:v4(kS({},U.value),{zIndex:C}),"trigger-placement":K.value},J,{onMousedown:fo=>fo.preventDefault()},o),[nr("div",{class:[`${l}-content`,t.contentClass],style:t.contentStyle},[(Kr=r.content)==null?void 0:Kr.call(r)]),t.showArrow&&nr("div",{ref:he,class:[`${l}-arrow`,t.arrowClass],style:te.value},null)]),[[RN,me.value]])]}})]})])}}});const C4=Object.assign(Mg,{install:(t,e)=>{uS(t,e);const r=lS(e);t.component(r+Mg.name,Mg)}}),y4=_n({name:"IconCheckCircleFill",props:{strokeWidth:{type:Number,default:4},strokeLinecap:{type:String,default:"butt",validator:t=>["butt","round","square"].includes(t)},strokeLinejoin:{type:String,default:"miter",validator:t=>["arcs","bevel","miter","miter-clip","round"].includes(t)},spin:Boolean},setup(t){const e=Qo("icon");return{cls:Fn(()=>[e,`${e}-check-circle-fill`,{[`${e}-spin`]:t.spin}])}}}),_4=["stroke-width","stroke-linecap","stroke-linejoin"],S4=Tt("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M24 44c11.046 0 20-8.954 20-20S35.046 4 24 4 4 12.954 4 24s8.954 20 20 20Zm10.207-24.379a1 1 0 0 0 0-1.414l-1.414-1.414a1 1 0 0 0-1.414 0L22 26.172l-4.878-4.88a1 1 0 0 0-1.415 0l-1.414 1.415a1 1 0 0 0 0 1.414l7 7a1 1 0 0 0 1.414 0l11.5-11.5Z",fill:"currentColor",stroke:"none"},null,-1),T4=[S4];function R4(t,e,r,o,a,l){return Xt(),Tn("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:un(t.cls),"stroke-width":t.strokeWidth,"stroke-linecap":t.strokeLinecap,"stroke-linejoin":t.strokeLinejoin},T4,10,_4)}var Pg=Qs(y4,[["render",R4]]);const w4=Object.assign(Pg,{install:(t,e)=>{var r;const o=(r=e==null?void 0:e.iconPrefix)!=null?r:"";t.component(o+Pg.name,Pg)}}),N4=_n({name:"Popover",components:{Trigger:C4},props:{popupVisible:{type:Boolean,default:void 0},defaultPopupVisible:{type:Boolean,default:!1},title:String,content:String,trigger:{type:[String,Array],default:"hover",validator:t=>{const e=[].concat(t);for(const r of e)if(!hS.includes(r))return!1;return!0}},position:{type:String,default:"top",validator:t=>A3.includes(t)},contentClass:{type:[String,Array,Object]},contentStyle:{type:Object},arrowClass:{type:[String,Array,Object]},arrowStyle:{type:Object},popupContainer:{type:[String,Object]}},emits:["update:popupVisible","popupVisibleChange"],setup(t,{emit:e}){const r=Qo("popover"),o=Sn(t.defaultPopupVisible),a=Fn(()=>{var g;return(g=t.popupVisible)!=null?g:o.value}),l=g=>{o.value=g,e("update:popupVisible",g),e("popupVisibleChange",g)},d=Fn(()=>[`${r}-popup-content`,t.contentClass]),A=Fn(()=>[`${r}-popup-arrow`,t.arrowClass]);return{prefixCls:r,computedPopupVisible:a,contentCls:d,arrowCls:A,handlePopupVisibleChange:l}}});function O4(t,e,r,o,a,l){const d=ua("trigger");return Xt(),wo(d,{class:un(t.prefixCls),trigger:t.trigger,position:t.position,"popup-visible":t.computedPopupVisible,"popup-offset":10,"content-class":t.contentCls,"content-style":t.contentStyle,"arrow-class":t.arrowCls,"arrow-style":t.arrowStyle,"show-arrow":"","popup-container":t.popupContainer,onPopupVisibleChange:t.handlePopupVisibleChange},{content:$o(()=>[Tt("div",{class:un(`${t.prefixCls}-title`)},[fc(t.$slots,"title",{},()=>[ZI(yd(t.title),1)])],2),Tt("div",{class:un(`${t.prefixCls}-content`)},[fc(t.$slots,"content",{},()=>[ZI(yd(t.content),1)])],2)]),default:$o(()=>[fc(t.$slots,"default")]),_:3},8,["class","trigger","position","popup-visible","content-class","content-style","arrow-class","arrow-style","popup-container","onPopupVisibleChange"])}var Qg=Qs(N4,[["render",O4]]);const k4=Object.assign(Qg,{install:(t,e)=>{uS(t,e);const r=lS(e);t.component(r+Qg.name,Qg)}}),b4=_n({name:"IconExclamationCircleFill",props:{strokeWidth:{type:Number,default:4},strokeLinecap:{type:String,default:"butt",validator:t=>["butt","round","square"].includes(t)},strokeLinejoin:{type:String,default:"miter",validator:t=>["arcs","bevel","miter","miter-clip","round"].includes(t)},spin:Boolean},setup(t){const e=Qo("icon");return{cls:Fn(()=>[e,`${e}-exclamation-circle-fill`,{[`${e}-spin`]:t.spin}])}}}),D4=["stroke-width","stroke-linecap","stroke-linejoin"],B4=Tt("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M24 44c11.046 0 20-8.954 20-20S35.046 4 24 4 4 12.954 4 24s8.954 20 20 20Zm-2-11a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1h-2a1 1 0 0 0-1 1v2Zm4-18a1 1 0 0 0-1-1h-2a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1V15Z",fill:"currentColor",stroke:"none"},null,-1),L4=[B4];function M4(t,e,r,o,a,l){return Xt(),Tn("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:un(t.cls),"stroke-width":t.strokeWidth,"stroke-linecap":t.strokeLinecap,"stroke-linejoin":t.strokeLinejoin},L4,10,D4)}var xg=Qs(b4,[["render",M4]]);const P4=Object.assign(xg,{install:(t,e)=>{var r;const o=(r=e==null?void 0:e.iconPrefix)!=null?r:"";t.component(o+xg.name,xg)}}),Q4=_n({name:"IconInfoCircleFill",props:{strokeWidth:{type:Number,default:4},strokeLinecap:{type:String,default:"butt",validator:t=>["butt","round","square"].includes(t)},strokeLinejoin:{type:String,default:"miter",validator:t=>["arcs","bevel","miter","miter-clip","round"].includes(t)},spin:Boolean},setup(t){const e=Qo("icon");return{cls:Fn(()=>[e,`${e}-info-circle-fill`,{[`${e}-spin`]:t.spin}])}}}),x4=["stroke-width","stroke-linecap","stroke-linejoin"],U4=Tt("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M24 44c11.046 0 20-8.954 20-20S35.046 4 24 4 4 12.954 4 24s8.954 20 20 20Zm2-30a1 1 0 0 0-1-1h-2a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1v-2Zm0 17h1a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1h-6a1 1 0 0 1-1-1v-2a1 1 0 0 1 1-1h1v-8a1 1 0 0 1-1-1v-2a1 1 0 0 1 1-1h3a1 1 0 0 1 1 1v11Z",fill:"currentColor",stroke:"none"},null,-1),F4=[U4];function V4(t,e,r,o,a,l){return Xt(),Tn("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:un(t.cls),"stroke-width":t.strokeWidth,"stroke-linecap":t.strokeLinecap,"stroke-linejoin":t.strokeLinejoin},F4,10,x4)}var Ug=Qs(Q4,[["render",V4]]);const G4=Object.assign(Ug,{install:(t,e)=>{var r;const o=(r=e==null?void 0:e.iconPrefix)!=null?r:"";t.component(o+Ug.name,Ug)}}),j4=_n({name:"IconCloseCircleFill",props:{strokeWidth:{type:Number,default:4},strokeLinecap:{type:String,default:"butt",validator:t=>["butt","round","square"].includes(t)},strokeLinejoin:{type:String,default:"miter",validator:t=>["arcs","bevel","miter","miter-clip","round"].includes(t)},spin:Boolean},setup(t){const e=Qo("icon");return{cls:Fn(()=>[e,`${e}-close-circle-fill`,{[`${e}-spin`]:t.spin}])}}}),H4=["stroke-width","stroke-linecap","stroke-linejoin"],K4=Tt("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M24 44c11.046 0 20-8.954 20-20S35.046 4 24 4 4 12.954 4 24s8.954 20 20 20Zm4.955-27.771-4.95 4.95-4.95-4.95a1 1 0 0 0-1.414 0l-1.414 1.414a1 1 0 0 0 0 1.414l4.95 4.95-4.95 4.95a1 1 0 0 0 0 1.414l1.414 1.414a1 1 0 0 0 1.414 0l4.95-4.95 4.95 4.95a1 1 0 0 0 1.414 0l1.414-1.414a1 1 0 0 0 0-1.414l-4.95-4.95 4.95-4.95a1 1 0 0 0 0-1.414l-1.414-1.414a1 1 0 0 0-1.414 0Z",fill:"currentColor",stroke:"none"},null,-1),W4=[K4];function Y4(t,e,r,o,a,l){return Xt(),Tn("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:un(t.cls),"stroke-width":t.strokeWidth,"stroke-linecap":t.strokeLinecap,"stroke-linejoin":t.strokeLinejoin},W4,10,H4)}var Fg=Qs(j4,[["render",Y4]]);const q4=Object.assign(Fg,{install:(t,e)=>{var r;const o=(r=e==null?void 0:e.iconPrefix)!=null?r:"";t.component(o+Fg.name,Fg)}}),J4=_n({name:"Message",components:{AIconHover:m3,IconInfoCircleFill:G4,IconCheckCircleFill:w4,IconExclamationCircleFill:P4,IconCloseCircleFill:q4,IconClose:_3},props:{type:{type:String,default:"info",validator:t=>dS.includes(t)},closable:{type:Boolean,default:!1},showIcon:{type:Boolean,default:!0},duration:{type:Number,default:3e3},resetOnUpdate:{type:Boolean,default:!1}},emits:["close"],setup(t,{emit:e}){const r=Qo("message");let o=0;const a=()=>{e("close")};return pc(()=>{t.duration>0&&(o=window.setTimeout(a,t.duration))}),_d(()=>{t.resetOnUpdate&&(o&&(window.clearTimeout(o),o=0),t.duration>0&&(o=window.setTimeout(a,t.duration)))}),Sd(()=>{o&&window.clearTimeout(o)}),{prefixCls:r,handleClose:a}}});function z4(t,e,r,o,a,l){const d=ua("icon-info-circle-fill"),A=ua("icon-check-circle-fill"),g=ua("icon-exclamation-circle-fill"),v=ua("icon-close-circle-fill"),C=ua("icon-close"),y=ua("a-icon-hover");return Xt(),Tn("li",{class:un([t.prefixCls,`${t.prefixCls}-${t.type}`,{[`${t.prefixCls}-closable`]:t.closable}])},[t.showIcon?(Xt(),Tn("span",{key:0,class:un(`${t.prefixCls}-icon`)},[fc(t.$slots,"icon",{},()=>[t.type==="info"?(Xt(),wo(d,{key:0})):t.type==="success"?(Xt(),wo(A,{key:1})):t.type==="warning"?(Xt(),wo(g,{key:2})):t.type==="error"?(Xt(),wo(v,{key:3})):Tl("v-if",!0)])],2)):Tl("v-if",!0),Tt("span",{class:un(`${t.prefixCls}-content`)},[fc(t.$slots,"default")],2),t.closable?(Xt(),Tn("span",{key:1,class:un(`${t.prefixCls}-close-btn`),onClick:e[0]||(e[0]=(...w)=>t.handleClose&&t.handleClose(...w))},[nr(y,null,{default:$o(()=>[nr(C)]),_:1})],2)):Tl("v-if",!0)],2)}var X4=Qs(J4,[["render",z4]]);const $4=["top","bottom"];function Z4(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!XI(t)}var eQ=_n({name:"MessageList",props:{messages:{type:Array,default:()=>[]},position:{type:String,default:"top",validator:t=>$4.includes(t)}},emits:["close"],setup(t,e){const r=Qo("message-list");return()=>{let o;return nr(NN,{class:[r,`${r}-${t.position}`],name:"fade-message",tag:"ul"},Z4(o=t.messages.map(a=>{const l={default:()=>Ng(a.content)?a.content():a.content,icon:()=>Ng(a.icon)?a.icon():a.icon};return nr(X4,{key:a.id,type:a.type,duration:a.duration,closable:a.closable,resetOnUpdate:a.resetOnUpdate,onClose:()=>e.emit("close",a.id)},l)}))?o:{default:()=>[o]})}}}),tQ=Object.defineProperty,rQ=Object.defineProperties,nQ=Object.getOwnPropertyDescriptors,bS=Object.getOwnPropertySymbols,iQ=Object.prototype.hasOwnProperty,oQ=Object.prototype.propertyIsEnumerable,DS=(t,e,r)=>e in t?tQ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Nh=(t,e)=>{for(var r in e||(e={}))iQ.call(e,r)&&DS(t,r,e[r]);if(bS)for(var r of bS(e))oQ.call(e,r)&&DS(t,r,e[r]);return t},BS=(t,e)=>rQ(t,nQ(e));class sQ{constructor(e,r){this.messageCount=0,this.add=l=>{var d;this.messageCount++;const A=(d=l.id)!=null?d:`__arco_message_${this.messageCount}`;if(this.messageIds.has(A))return this.update(A,l);const g=la(Nh({id:A},l));return this.messages.value.push(g),this.messageIds.add(A),{close:()=>this.remove(A)}},this.update=(l,d)=>{for(let A=0;A<this.messages.value.length;A++)if(this.messages.value[A].id===l){const g=!n3(d.duration);Object.assign(this.messages.value[A],BS(Nh({},d),{id:l,resetOnUpdate:g}));break}return{close:()=>this.remove(l)}},this.remove=l=>{for(let d=0;d<this.messages.value.length;d++)if(this.messages.value[d].id===l){this.messages.value.splice(d,1),this.messageIds.delete(l);break}},this.clear=()=>{this.messages.value.splice(0)};const{position:o}=e;this.container=e4("message"),this.messageIds=new Set,this.messages=Sn([]);const a=nr(eQ,{messages:this.messages.value,position:o,onClose:this.remove});r&&(a.appContext=r),ON(a,this.container),document.body.appendChild(this.container)}}const gu={},Vg=dS.reduce((t,e)=>(t[e]=r=>{sS(r)&&(r={content:r});const o=Nh({type:e},r),{position:a="top"}=o;return gu[a]||(gu[a]=new sQ(o)),gu[a].add(o)},t),{});Vg.clear=t=>{var e;t?(e=gu[t])==null||e.clear():Object.values(gu).forEach(r=>r.clear())};const aQ=BS(Nh({},Vg),{install:t=>{t.config.globalProperties.$message=Vg}});const xs=t=>(eC("data-v-0391e847"),t=t(),tC(),t),cQ={as:"nav",class:"bg-gray-800 rounded-b-md fixed top-0 w-full z-10"},lQ={class:"max-w-7xl mx-auto px-2 sm:px-6 lg:px-8"},uQ={class:"relative flex items-center justify-between h-16"},dQ={class:"flex-1 flex items-center justify-center sm:justify-start"},hQ={class:"absolute inset-y-0 inset-x-0 right-0 flex items-center px-2 sm:static sm:inset-auto sm:pr-0"},pQ={class:"video-btn mr-4"},AQ=xs(()=>Tt("span",{class:"sr-only"},"Open live",-1)),fQ={class:"w-80"},gQ=xs(()=>Tt("div",null,"\u656C\u8BF7\u671F\u5F85~",-1)),mQ=xs(()=>Tt("hr",{class:"my-4"},null,-1)),vQ={class:"flex items-center"},EQ=xs(()=>Tt("div",{class:"w-24 text-right"},"\u5206\u4EAB\u6A21\u5F0F\uFF1A",-1)),IQ={class:"w-40"},CQ=xs(()=>Tt("button",{class:"close-btn"},"\u5173\u95ED",-1)),yQ=xs(()=>Tt("div",{class:"flex-grow"},null,-1)),_Q=xs(()=>Tt("span",{class:"sr-only"},"Copy Share Link",-1)),SQ=xs(()=>Tt("div",{class:"leave-btn"},"\u79BB\u5F00",-1)),TQ={setup(t){const e=window.location.href,r=()=>{navigator.clipboard.writeText(e),aQ.success("\u5DF2\u6210\u529F\u590D\u5236\u9080\u8BF7\u94FE\u63A5\uFF01")};return(o,a)=>(Xt(),Tn("nav",cQ,[Tt("div",lQ,[Tt("div",uQ,[Tt("div",dQ,[nr(gc,{name:"logo",class:"h-8 w-8"})]),Tt("div",hQ,[nr(Ei(k4),null,{content:$o(()=>[Tt("div",fQ,[gQ,mQ,Tt("div",vQ,[EQ,Tt("div",IQ,[nr(t3)]),CQ])])]),default:$o(()=>[Tt("button",pQ,[AQ,nr(gc,{name:"toolbar-live",class:"h-6 w-6"})])]),_:1}),yQ,Tt("button",{title:"\u70B9\u51FB\u5206\u4EAB\u6B64\u623F\u95F4 share",class:"text-gray-300 hover:text-white cursor-pointer mr-4",onClick:r},[_Q,nr(gc,{name:"toolbar-share",class:"inline-block h-5 w-5"})]),SQ])])])]))}};var RQ=cC(TQ,[["__scopeId","data-v-0391e847"]]);const wQ=t=>(eC("data-v-dc7c0494"),t=t(),tC(),t),NQ={class:"z-10 absolute flex left-0 right-0 group-hover:bg-gray-800 text-white p-1 transition"},OQ={class:"sm-btn w-5 bg-indigo-600 text-center overflow-hidden",title:"\u540D\u79F0"},kQ=["title"],bQ=["title"],DQ=wQ(()=>Tt("div",{class:"flex-1"},null,-1)),BQ=["id","onClick"];function LQ(t,{emit:e}){const r=t,o=Sn(null);kN(window,"resize",()=>{const l=window.getComputedStyle(o.value,null),d=+l.left.replace(/\px/g,""),A=+l.top.replace(/\px/g,"");(d<0||A<0)&&(o.value.style.right="8px",o.value.style.bottom="8px")});const a=()=>{};return Sd(()=>{}),(l,d)=>{const A=bN("drag");return $I((Xt(),Tn("div",{ref:(g,v)=>{v.target=g,o.value=g},class:un(["fixed min-w-[10rem] min-h-[8rem] right-2 select-none z-10 bg-gray-100 rounded overflow-hidden border-4 border-indigo-300 shadow-md hover:shadow-lg transition group",t.className])},[Tt("div",NQ,[Tt("div",OQ,yd(r.name[0]),1),Tt("button",{class:un(["sm-btn",t.hasVideo?"":"active"]),title:t.hasVideo?"\u505C\u6B62\u5F55\u50CF":"\u5F00\u59CB\u5F55\u50CF",onClick:d[0]||(d[0]=g=>l.$emit("video",r.name))},[nr(gc,{name:"live-camera-off",class:"w-5 h-5"})],10,kQ),Tt("button",{class:un(["sm-btn",t.hasAudio?"":"active"]),title:t.hasAudio?"\u505C\u6B62\u5F55\u97F3":"\u5F00\u59CB\u5F55\u97F3",onClick:d[1]||(d[1]=g=>l.$emit("audio",r.name))},[nr(gc,{name:"live-mic-off",class:"w-5 h-5"})],10,bQ),DQ,Tt("button",{class:"close-btn",onClick:d[2]||(d[2]=g=>l.$emit("close",r.name)),title:"\u5173\u95ED"},[nr(gc,{name:"close",class:"h-5 w-5"})])]),Tt("div",{class:"player",id:t.domId,onClick:DN(a,["stop"])},null,8,BQ)],2)),[[A]])}}const MQ={directives:{drag:{mounted(t){t.style.cursor="move";const e=window.getComputedStyle(t,null);t.onmousedown=r=>{const o=r.clientX,a=r.clientY,l=+e.right.replace(/\px/g,""),d=+e.bottom.replace(/\px/g,""),A=+e.width.replace(/\px/g,""),g=+e.height.replace(/\px/g,""),v=window.innerWidth,C=window.innerHeight;document.onmousemove=function(y){const w=y.clientX-o,k=y.clientY-a,M=l-w,F=d-k;M<0||F<0||M>v-A||F>C-g||(t.style.right=M+"px",t.style.bottom=F+"px")},document.onmouseup=function(y){document.onmousemove=null,document.onmouseup=null}}}}}},PQ=Object.assign(MQ,{props:{name:{type:String,default:"\u6211"},domId:{type:String,default:"player-me"},className:{type:String,default:"bottom-2"},hasVideo:{type:Boolean},hasAudio:{type:Boolean}},emits:["close","video","audio"],setup:LQ});var LS=cC(PQ,[["__scopeId","data-v-dc7c0494"]]),MS={exports:{}};(function(t,e){(function(r,o){t.exports=o()})(kA,function(){function r(i,n,s){return i(s={path:n,exports:{},require:function(c,u){throw Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}},s.exports),s.exports}function o(i,n,s){return(i=i.match(n))&&i.length>=s&&dr(i[s],10)}function a(i,n,s){if(i.RTCPeerConnection){i=i.RTCPeerConnection.prototype;var c=i.addEventListener;i.addEventListener=function(h,p){if(h!==n)return c.apply(this,arguments);let f=m=>{(m=s(m))&&p(m)};return this._eventMap=this._eventMap||{},this._eventMap[p]=f,c.apply(this,[h,f])};var u=i.removeEventListener;i.removeEventListener=function(h,p){if(h!==n||!this._eventMap||!this._eventMap[p])return u.apply(this,arguments);let f=this._eventMap[p];return delete this._eventMap[p],u.apply(this,[h,f])},dt(i,"on"+n,{get(){return this["_on"+n]},set(h){this["_on"+n]&&(this.removeEventListener(n,this["_on"+n]),delete this["_on"+n]),h&&this.addEventListener(n,this["_on"+n]=h)},enumerable:!0,configurable:!0})}}function l(i){return typeof i!="boolean"?Error("Argument type: "+typeof i+". Please use a boolean."):(Bv=i,i?"adapter.js logging disabled":"adapter.js logging enabled")}function d(i){return typeof i!="boolean"?Error("Argument type: "+typeof i+". Please use a boolean."):(Lv=!i,"adapter.js deprecation warnings "+(i?"disabled":"enabled"))}function A(){typeof window!="object"||Bv||typeof console!="undefined"&&typeof console.log=="function"&&console.log.apply(console,arguments)}function g(i,n){Lv&&console.warn(i+" is deprecated, please use "+n+" instead.")}function v(i){let{navigator:n}=i,s={browser:null,version:null};if(i===void 0||!i.navigator)return s.browser="Not a browser.",s;if(n.mozGetUserMedia)s.browser="firefox",s.version=o(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||i.isSecureContext===!1&&i.webkitRTCPeerConnection&&!i.RTCIceGatherer)s.browser="chrome",s.version=o(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(n.mediaDevices&&n.userAgent.match(/Edge\/(\d+).(\d+)$/))s.browser="edge",s.version=o(n.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!i.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return s.browser="Not a supported browser.",s;s.browser="safari",s.version=o(n.userAgent,/AppleWebKit\/(\d+)\./,1),s.supportsUnifiedPlan=i.RTCRtpTransceiver&&"currentDirection"in i.RTCRtpTransceiver.prototype}return s}function C(i){var n;return Object.prototype.toString.call(i)==="[object Object]"?ju(n=ut(i)).call(n,function(s,c){var u=Object.prototype.toString.call(i[c])==="[object Object]";let h=u?C(i[c]):i[c];return u=u&&!ut(h).length,h===void 0||u?s:sn(s,{[c]:h})},{}):i}function y(i,n,s){let c=s?"outbound-rtp":"inbound-rtp",u=new Ct;if(n===null)return u;let h=[];return H(i).call(i,p=>{p.type==="track"&&p.trackIdentifier===n.id&&h.push(p)}),H(h).call(h,p=>{H(i).call(i,f=>{f.type===c&&f.trackId===p.id&&function m(I,E,_){var S;E&&!_.has(E.id)&&(_.set(E.id,E),H(S=ut(E)).call(S,N=>{if(Tv(N).call(N,"Id"))m(I,I.get(E[N]),_);else if(Tv(N).call(N,"Ids")){var O;H(O=E[N]).call(O,B=>{m(I,I.get(B),_)})}}))}(i,f,u)})}),u}function w(i){let n=i&&i.navigator;if(n.mediaDevices){var s=v(i),c=function(f){var m;if(typeof f!="object"||f.mandatory||f.optional)return f;const I={};var E;return H(m=ut(f)).call(m,_=>{if(_!=="require"&&_!=="advanced"&&_!=="mediaSource"){var S=typeof f[_]=="object"?f[_]:{ideal:f[_]};S.exact!==void 0&&typeof S.exact=="number"&&(S.min=S.max=S.exact);var N=function(B,Q){return B?B+Q.charAt(0).toUpperCase()+Ur(Q).call(Q,1):Q==="deviceId"?"sourceId":Q};if(S.ideal!==void 0){I.optional=I.optional||[];let B={};typeof S.ideal=="number"?(B[N("min",_)]=S.ideal,I.optional.push(B),B={},B[N("max",_)]=S.ideal,I.optional.push(B)):(B[N("",_)]=S.ideal,I.optional.push(B))}var O;S.exact!==void 0&&typeof S.exact!="number"?(I.mandatory=I.mandatory||{},I.mandatory[N("",_)]=S.exact):H(O=["min","max"]).call(O,B=>{S[B]!==void 0&&(I.mandatory=I.mandatory||{},I.mandatory[N(B,_)]=S[B])})}}),f.advanced&&(I.optional=b(E=I.optional||[]).call(E,f.advanced)),I},u=function(f,m){if(61<=s.version)return m(f);if((f=JSON.parse(pe(f)))&&typeof f.audio=="object"){var I=function(E,_,S){_ in E&&!(S in E)&&(E[S]=E[_],delete E[_])};I((f=JSON.parse(pe(f))).audio,"autoGainControl","googAutoGainControl"),I(f.audio,"noiseSuppression","googNoiseSuppression"),f.audio=c(f.audio)}if(f&&typeof f.video=="object"){let E=f.video.facingMode;if(E=E&&(typeof E=="object"?E:{ideal:E}),I=66>s.version,!(!E||E.exact!=="user"&&E.exact!=="environment"&&E.ideal!=="user"&&E.ideal!=="environment"||n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!I)){let _;if(delete f.video.facingMode,E.exact==="environment"||E.ideal==="environment"?_=["back","rear"]:E.exact!=="user"&&E.ideal!=="user"||(_=["front"]),_)return n.mediaDevices.enumerateDevices().then(S=>{S=Qe(S).call(S,O=>O.kind==="videoinput");let N=ze(S).call(S,O=>CE(_).call(_,B=>{var Q;return gt(Q=O.label.toLowerCase()).call(Q,B)}));return!N&&S.length&&gt(_).call(_,"back")&&(N=S[S.length-1]),N&&(f.video.deviceId=E.exact?{exact:N.deviceId}:{ideal:N.deviceId}),f.video=c(f.video),yE("chrome: "+pe(f)),m(f)})}f.video=c(f.video)}return yE("chrome: "+pe(f)),m(f)},h=function(f){return 64<=s.version?f:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[f.name]||f.name,message:f.message,constraint:f.constraint||f.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(i=function(f,m,I){u(f,E=>{n.webkitGetUserMedia(E,m,_=>{I&&I(h(_))})})},n.getUserMedia=hr(i).call(i,n),n.mediaDevices.getUserMedia){var p;let f=hr(p=n.mediaDevices.getUserMedia).call(p,n.mediaDevices);n.mediaDevices.getUserMedia=function(m){return u(m,I=>f(I).then(E=>{var _;if(I.audio&&!E.getAudioTracks().length||I.video&&!E.getVideoTracks().length)throw H(_=E.getTracks()).call(_,S=>{S.stop()}),new DOMException("","NotFoundError");return E},E=>se.reject(h(E))))}}}}function k(i){i.MediaStream=i.MediaStream||i.webkitMediaStream}function M(i){if(typeof i!="object"||!i.RTCPeerConnection||"ontrack"in i.RTCPeerConnection.prototype)a(i,"track",n=>(n.transceiver||dt(n,"transceiver",{value:{receiver:n.receiver}}),n));else{dt(i.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(s){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=s)},enumerable:!0,configurable:!0});let n=i.RTCPeerConnection.prototype.setRemoteDescription;i.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=s=>{var c;s.stream.addEventListener("addtrack",u=>{let h;var p;i.RTCPeerConnection.prototype.getReceivers?h=ze(p=this.getReceivers()).call(p,f=>f.track&&f.track.id===u.track.id):h={track:u.track},p=new Event("track"),p.track=u.track,p.receiver=h,p.transceiver={receiver:h},p.streams=[s.stream],this.dispatchEvent(p)}),H(c=s.stream.getTracks()).call(c,u=>{let h;var p;i.RTCPeerConnection.prototype.getReceivers?h=ze(p=this.getReceivers()).call(p,f=>f.track&&f.track.id===u.id):h={track:u},p=new Event("track"),p.track=u,p.receiver=h,p.transceiver={receiver:h},p.streams=[s.stream],this.dispatchEvent(p)})},this.addEventListener("addstream",this._ontrackpoly)),n.apply(this,arguments)}}}function F(i){if(typeof i=="object"&&i.RTCPeerConnection&&!("getSenders"in i.RTCPeerConnection.prototype)&&"createDTMFSender"in i.RTCPeerConnection.prototype){let n=function(u,h){return{track:h,get dtmf(){return this._dtmf===void 0&&(h.kind==="audio"?this._dtmf=u.createDTMFSender(h):this._dtmf=null),this._dtmf},_pc:u}};if(!i.RTCPeerConnection.prototype.getSenders){i.RTCPeerConnection.prototype.getSenders=function(){var p;return this._senders=this._senders||[],Ur(p=this._senders).call(p)};let u=i.RTCPeerConnection.prototype.addTrack;i.RTCPeerConnection.prototype.addTrack=function(p,f){let m=u.apply(this,arguments);return m||(m=n(this,p),this._senders.push(m)),m};let h=i.RTCPeerConnection.prototype.removeTrack;i.RTCPeerConnection.prototype.removeTrack=function(p){var f;h.apply(this,arguments);let m=He(f=this._senders).call(f,p);var I;m!==-1&&qr(I=this._senders).call(I,m,1)}}let s=i.RTCPeerConnection.prototype.addStream;i.RTCPeerConnection.prototype.addStream=function(u){var h;this._senders=this._senders||[],s.apply(this,[u]),H(h=u.getTracks()).call(h,p=>{this._senders.push(n(this,p))})};let c=i.RTCPeerConnection.prototype.removeStream;i.RTCPeerConnection.prototype.removeStream=function(u){var h;this._senders=this._senders||[],c.apply(this,[u]),H(h=u.getTracks()).call(h,p=>{var f;let m=ze(f=this._senders).call(f,_=>_.track===p);var I,E;m&&qr(I=this._senders).call(I,He(E=this._senders).call(E,m),1)})}}else if(typeof i=="object"&&i.RTCPeerConnection&&"getSenders"in i.RTCPeerConnection.prototype&&"createDTMFSender"in i.RTCPeerConnection.prototype&&i.RTCRtpSender&&!("dtmf"in i.RTCRtpSender.prototype)){let n=i.RTCPeerConnection.prototype.getSenders;i.RTCPeerConnection.prototype.getSenders=function(){let s=n.apply(this,[]);return H(s).call(s,c=>c._pc=this),s},dt(i.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function K(i){if(i.RTCPeerConnection){var n=i.RTCPeerConnection.prototype.getStats;i.RTCPeerConnection.prototype.getStats=function(){let[s,c,u]=arguments;if(0<arguments.length&&typeof s=="function")return n.apply(this,arguments);if(n.length===0&&(arguments.length===0||typeof s!="function"))return n.apply(this,[]);let h=function(f){const m={};return f=f.result(),H(f).call(f,I=>{var E;const _={id:I.id,timestamp:I.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[I.type]||I.type};H(E=I.names()).call(E,S=>{_[S]=I.stat(S)}),m[_.id]=_}),m},p=function(f){var m;return new Ct(Ie(m=ut(f)).call(m,I=>[I,f[I]]))};return 2<=arguments.length?n.apply(this,[function(f){c(p(h(f)))},s]):new se((f,m)=>{n.apply(this,[function(I){f(p(h(I)))},m])}).then(c,u)}}}function J(i){if(typeof i=="object"&&i.RTCPeerConnection&&i.RTCRtpSender&&i.RTCRtpReceiver){if(!("getStats"in i.RTCRtpSender.prototype)){let s=i.RTCPeerConnection.prototype.getSenders;s&&(i.RTCPeerConnection.prototype.getSenders=function(){let u=s.apply(this,[]);return H(u).call(u,h=>h._pc=this),u});let c=i.RTCPeerConnection.prototype.addTrack;c&&(i.RTCPeerConnection.prototype.addTrack=function(){let u=c.apply(this,arguments);return u._pc=this,u}),i.RTCRtpSender.prototype.getStats=function(){let u=this;return this._pc.getStats().then(h=>y(h,u.track,!0))}}if(!("getStats"in i.RTCRtpReceiver.prototype)){let s=i.RTCPeerConnection.prototype.getReceivers;s&&(i.RTCPeerConnection.prototype.getReceivers=function(){let c=s.apply(this,[]);return H(c).call(c,u=>u._pc=this),c}),a(i,"track",c=>(c.receiver._pc=c.srcElement,c)),i.RTCRtpReceiver.prototype.getStats=function(){let c=this;return this._pc.getStats().then(u=>y(u,c.track,!1))}}if("getStats"in i.RTCRtpSender.prototype&&"getStats"in i.RTCRtpReceiver.prototype){var n=i.RTCPeerConnection.prototype.getStats;i.RTCPeerConnection.prototype.getStats=function(){if(0<arguments.length&&arguments[0]instanceof i.MediaStreamTrack){var s,c;let u=arguments[0],h,p,f;return H(s=this.getSenders()).call(s,m=>{m.track===u&&(h?f=!0:h=m)}),H(c=this.getReceivers()).call(c,m=>(m.track===u&&(p?f=!0:p=m),m.track===u)),f||h&&p?se.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):h?h.getStats():p?p.getStats():se.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return n.apply(this,arguments)}}}}function U(i){i.RTCPeerConnection.prototype.getLocalStreams=function(){var h;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Ie(h=ut(this._shimmedLocalStreams)).call(h,p=>this._shimmedLocalStreams[p][0])};let n=i.RTCPeerConnection.prototype.addTrack;i.RTCPeerConnection.prototype.addTrack=function(h,p){var f;if(!p)return n.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let m=n.apply(this,arguments);return this._shimmedLocalStreams[p.id]?He(f=this._shimmedLocalStreams[p.id]).call(f,m)===-1&&this._shimmedLocalStreams[p.id].push(m):this._shimmedLocalStreams[p.id]=[p,m],m};let s=i.RTCPeerConnection.prototype.addStream;i.RTCPeerConnection.prototype.addStream=function(h){var p,f,m;this._shimmedLocalStreams=this._shimmedLocalStreams||{},H(p=h.getTracks()).call(p,E=>{var _;if(ze(_=this.getSenders()).call(_,S=>S.track===E))throw new DOMException("Track already exists.","InvalidAccessError")});let I=this.getSenders();s.apply(this,arguments),p=Qe(f=this.getSenders()).call(f,E=>He(I).call(I,E)===-1),this._shimmedLocalStreams[h.id]=b(m=[h]).call(m,p)};let c=i.RTCPeerConnection.prototype.removeStream;i.RTCPeerConnection.prototype.removeStream=function(h){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[h.id],c.apply(this,arguments)};let u=i.RTCPeerConnection.prototype.removeTrack;i.RTCPeerConnection.prototype.removeTrack=function(h){var p;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},h&&H(p=ut(this._shimmedLocalStreams)).call(p,f=>{var m;let I=He(m=this._shimmedLocalStreams[f]).call(m,h);var E;I!==-1&&qr(E=this._shimmedLocalStreams[f]).call(E,I,1),this._shimmedLocalStreams[f].length===1&&delete this._shimmedLocalStreams[f]}),u.apply(this,arguments)}}function te(i){function n(E,_){var S;let N=_.sdp;return H(S=ut(E._reverseStreams||[])).call(S,O=>{O=E._reverseStreams[O],N=N.replace(new RegExp(E._streams[O.id].id,"g"),O.id)}),new RTCSessionDescription({type:_.type,sdp:N})}function s(E,_){var S;let N=_.sdp;return H(S=ut(E._reverseStreams||[])).call(S,O=>{O=E._reverseStreams[O],N=N.replace(new RegExp(O.id,"g"),E._streams[O.id].id)}),new RTCSessionDescription({type:_.type,sdp:N})}var c;if(i.RTCPeerConnection){var u=v(i);if(i.RTCPeerConnection.prototype.addTrack&&65<=u.version)return U(i);var h=i.RTCPeerConnection.prototype.getLocalStreams;i.RTCPeerConnection.prototype.getLocalStreams=function(){let E=h.apply(this);return this._reverseStreams=this._reverseStreams||{},Ie(E).call(E,_=>this._reverseStreams[_.id])};var p=i.RTCPeerConnection.prototype.addStream;i.RTCPeerConnection.prototype.addStream=function(E){var _;this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},H(_=E.getTracks()).call(_,S=>{var N;if(ze(N=this.getSenders()).call(N,O=>O.track===S))throw new DOMException("Track already exists.","InvalidAccessError")}),this._reverseStreams[E.id]||(_=new i.MediaStream(E.getTracks()),this._streams[E.id]=_,this._reverseStreams[_.id]=E,E=_),p.apply(this,[E])};var f=i.RTCPeerConnection.prototype.removeStream;i.RTCPeerConnection.prototype.removeStream=function(E){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},f.apply(this,[this._streams[E.id]||E]),delete this._reverseStreams[this._streams[E.id]?this._streams[E.id].id:E.id],delete this._streams[E.id]},i.RTCPeerConnection.prototype.addTrack=function(E,_){var S,N,O;if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let B=Ur([]).call(arguments,1);if(B.length!==1||!ze(S=B[0].getTracks()).call(S,Q=>Q===E))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(ze(N=this.getSenders()).call(N,Q=>Q.track===E))throw new DOMException("Track already exists.","InvalidAccessError");return this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},(S=this._streams[_.id])?(S.addTrack(E),se.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))})):(S=new i.MediaStream([E]),this._streams[_.id]=S,this._reverseStreams[S.id]=_,this.addStream(S)),ze(O=this.getSenders()).call(O,Q=>Q.track===E)},H(c=["createOffer","createAnswer"]).call(c,function(E){let _=i.RTCPeerConnection.prototype[E];i.RTCPeerConnection.prototype[E]={[E](){const S=arguments;return arguments.length&&typeof arguments[0]=="function"?_.apply(this,[N=>{N=n(this,N),S[0].apply(null,[N])},N=>{S[1]&&S[1].apply(null,N)},arguments[2]]):_.apply(this,arguments).then(N=>n(this,N))}}[E]});var m=i.RTCPeerConnection.prototype.setLocalDescription;i.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=s(this,arguments[0]),m.apply(this,arguments)):m.apply(this,arguments)};var I=at(i.RTCPeerConnection.prototype,"localDescription");dt(i.RTCPeerConnection.prototype,"localDescription",{get(){let E=I.get.apply(this);return E.type===""?E:n(this,E)}}),i.RTCPeerConnection.prototype.removeTrack=function(E){var _;if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!E._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(E._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let S;this._streams=this._streams||{},H(_=ut(this._streams)).call(_,N=>{var O;ze(O=this._streams[N].getTracks()).call(O,B=>E.track===B)&&(S=this._streams[N])}),S&&(S.getTracks().length===1?this.removeStream(this._reverseStreams[S.id]):S.removeTrack(E.track),this.dispatchEvent(new Event("negotiationneeded")))}}}function P(i){let n=v(i);if(!i.RTCPeerConnection&&i.webkitRTCPeerConnection&&(i.RTCPeerConnection=i.webkitRTCPeerConnection),i.RTCPeerConnection){var s;53>n.version&&H(s=["setLocalDescription","setRemoteDescription","addIceCandidate"]).call(s,function(u){let h=i.RTCPeerConnection.prototype[u];i.RTCPeerConnection.prototype[u]={[u](){return arguments[0]=new(u==="addIceCandidate"?i.RTCIceCandidate:i.RTCSessionDescription)(arguments[0]),h.apply(this,arguments)}}[u]});var c=i.RTCPeerConnection.prototype.addIceCandidate;i.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?78>n.version&&arguments[0]&&arguments[0].candidate===""?se.resolve():c.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),se.resolve())}}}function he(i){a(i,"negotiationneeded",n=>{if(n.target.signalingState==="stable")return n})}function ne(i,n,s,c,u){return n=Ue.writeRtpDescription(i.kind,n),n+=Ue.writeIceParameters(i.iceGatherer.getLocalParameters()),n+=Ue.writeDtlsParameters(i.dtlsTransport.getLocalParameters(),s==="offer"?"actpass":u||"active"),n+="a=mid:"+i.mid+`\r
`,i.rtpSender&&i.rtpReceiver?n+=`a=sendrecv\r
`:i.rtpSender?n+=`a=sendonly\r
`:i.rtpReceiver?n+=`a=recvonly\r
`:n+=`a=inactive\r
`,i.rtpSender&&(s=i.rtpSender._initialTrackId||i.rtpSender.track.id,i.rtpSender._initialTrackId=s,c="msid:"+(c?c.id:"-")+" "+s+`\r
`,n=n+("a="+c)+("a=ssrc:"+i.sendEncodingParameters[0].ssrc+" "+c),i.sendEncodingParameters[0].rtx&&(n+="a=ssrc:"+i.sendEncodingParameters[0].rtx.ssrc+" "+c,n+="a=ssrc-group:FID "+i.sendEncodingParameters[0].ssrc+" "+i.sendEncodingParameters[0].rtx.ssrc+`\r
`)),n+="a=ssrc:"+i.sendEncodingParameters[0].ssrc+" cname:"+Ue.localCName+`\r
`,i.rtpSender&&i.sendEncodingParameters[0].rtx&&(n+="a=ssrc:"+i.sendEncodingParameters[0].rtx.ssrc+" cname:"+Ue.localCName+`\r
`),n}function me(i,n){var s={codecs:[],headerExtensions:[],fecMechanisms:[]},c=function(h,p){h=parseInt(h,10);for(var f=0;f<p.length;f++)if(p[f].payloadType===h||p[f].preferredPayloadType===h)return p[f]},u=function(h,p,f,m){return h=c(h.parameters.apt,f),p=c(p.parameters.apt,m),h&&p&&h.name.toLowerCase()===p.name.toLowerCase()};return i.codecs.forEach(function(h){for(var p=0;p<n.codecs.length;p++){var f=n.codecs[p];if(h.name.toLowerCase()===f.name.toLowerCase()&&h.clockRate===f.clockRate&&(h.name.toLowerCase()!=="rtx"||!h.parameters||!f.parameters.apt||u(h,f,i.codecs,n.codecs))){(f=JSON.parse(JSON.stringify(f))).numChannels=Math.min(h.numChannels,f.numChannels),s.codecs.push(f),f.rtcpFeedback=f.rtcpFeedback.filter(function(m){for(var I=0;I<h.rtcpFeedback.length;I++)if(h.rtcpFeedback[I].type===m.type&&h.rtcpFeedback[I].parameter===m.parameter)return!0;return!1});break}}}),i.headerExtensions.forEach(function(h){for(var p=0;p<n.headerExtensions.length;p++){var f=n.headerExtensions[p];if(h.uri===f.uri){s.headerExtensions.push(f);break}}}),s}function Pe(i,n,s){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[n][i].indexOf(s)!==-1}function Me(i,n){var s=i.getRemoteCandidates().find(function(c){return n.foundation===c.foundation&&n.ip===c.ip&&n.port===c.port&&n.priority===c.priority&&n.protocol===c.protocol&&n.type===c.type});return s||i.addRemoteCandidate(n),!s}function be(i,n){return n=Error(n),n.name=i,n.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[i],n}function Gt(i){var n;i=i&&i.navigator;let s=hr(n=i.mediaDevices.getUserMedia).call(n,i.mediaDevices);i.mediaDevices.getUserMedia=function(c){return s(c).catch(u=>se.reject(function(h){return{name:{PermissionDeniedError:"NotAllowedError"}[h.name]||h.name,message:h.message,constraint:h.constraint,toString(){return this.name}}}(u)))}}function At(i){var n;"getDisplayMedia"in i.navigator&&i.navigator.mediaDevices&&(i.navigator.mediaDevices&&"getDisplayMedia"in i.navigator.mediaDevices||(i.navigator.mediaDevices.getDisplayMedia=hr(n=i.navigator.getDisplayMedia).call(n,i.navigator)))}function it(i){let n=v(i);if(i.RTCIceGatherer&&(i.RTCIceCandidate||(i.RTCIceCandidate=function(c){return c}),i.RTCSessionDescription||(i.RTCSessionDescription=function(c){return c}),15025>n.version)){let c=at(i.MediaStreamTrack.prototype,"enabled");dt(i.MediaStreamTrack.prototype,"enabled",{set(u){c.set.call(this,u);let h=new Event("enabled");h.enabled=u,this.dispatchEvent(h)}})}!i.RTCRtpSender||"dtmf"in i.RTCRtpSender.prototype||dt(i.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=new i.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}}),i.RTCDtmfSender&&!i.RTCDTMFSender&&(i.RTCDTMFSender=i.RTCDtmfSender);let s=eR(i,n.version);i.RTCPeerConnection=function(c){return c&&c.iceServers&&(c.iceServers=function(u,h){let p=!1;return u=JSON.parse(pe(u)),Qe(u).call(u,f=>{if(f&&(f.urls||f.url)){var m=f.urls||f.url;f.url&&!f.urls&&g("RTCIceServer.url","RTCIceServer.urls");let I=typeof m=="string";return I&&(m=[m]),m=Qe(m).call(m,E=>He(E).call(E,"stun:")===0?!1:(E=ol(E).call(E,"turn")&&!ol(E).call(E,"turn:[")&&gt(E).call(E,"transport=udp"))&&!p?(p=!0,!0):E&&!p),delete f.url,f.urls=I?m[0]:m,!!m.length}})}(c.iceServers,n.version),A("ICE servers after filtering:",c.iceServers)),new s(c)},i.RTCPeerConnection.prototype=s.prototype}function gr(i){!i.RTCRtpSender||"replaceTrack"in i.RTCRtpSender.prototype||(i.RTCRtpSender.prototype.replaceTrack=i.RTCRtpSender.prototype.setTrack)}function _t(i){let n=v(i),s=i&&i.navigator;if(i=i&&i.MediaStreamTrack,s.getUserMedia=function(u,h,p){g("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),s.mediaDevices.getUserMedia(u).then(h,p)},!(55<n.version&&"autoGainControl"in s.mediaDevices.getSupportedConstraints())){var c;let u=function(p,f,m){f in p&&!(m in p)&&(p[m]=p[f],delete p[f])},h=hr(c=s.mediaDevices.getUserMedia).call(c,s.mediaDevices);if(s.mediaDevices.getUserMedia=function(p){return typeof p=="object"&&typeof p.audio=="object"&&(p=JSON.parse(pe(p)),u(p.audio,"autoGainControl","mozAutoGainControl"),u(p.audio,"noiseSuppression","mozNoiseSuppression")),h(p)},i&&i.prototype.getSettings){let p=i.prototype.getSettings;i.prototype.getSettings=function(){let f=p.apply(this,arguments);return u(f,"mozAutoGainControl","autoGainControl"),u(f,"mozNoiseSuppression","noiseSuppression"),f}}if(i&&i.prototype.applyConstraints){let p=i.prototype.applyConstraints;i.prototype.applyConstraints=function(f){return this.kind==="audio"&&typeof f=="object"&&(f=JSON.parse(pe(f)),u(f,"autoGainControl","mozAutoGainControl"),u(f,"noiseSuppression","mozNoiseSuppression")),p.apply(this,[f])}}}}function Et(i){typeof i=="object"&&i.RTCTrackEvent&&"receiver"in i.RTCTrackEvent.prototype&&!("transceiver"in i.RTCTrackEvent.prototype)&&dt(i.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ar(i){let n=v(i);if(typeof i=="object"&&(i.RTCPeerConnection||i.mozRTCPeerConnection)){var s;!i.RTCPeerConnection&&i.mozRTCPeerConnection&&(i.RTCPeerConnection=i.mozRTCPeerConnection),53>n.version&&H(s=["setLocalDescription","setRemoteDescription","addIceCandidate"]).call(s,function(p){let f=i.RTCPeerConnection.prototype[p];i.RTCPeerConnection.prototype[p]={[p](){return arguments[0]=new(p==="addIceCandidate"?i.RTCIceCandidate:i.RTCSessionDescription)(arguments[0]),f.apply(this,arguments)}}[p]});var c=i.RTCPeerConnection.prototype.addIceCandidate;i.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?68>n.version&&arguments[0]&&arguments[0].candidate===""?se.resolve():c.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),se.resolve())};var u={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},h=i.RTCPeerConnection.prototype.getStats;i.RTCPeerConnection.prototype.getStats=function(){let[p,f,m]=arguments;return h.apply(this,[p||null]).then(I=>{if(53>n.version&&!f)try{H(I).call(I,E=>{E.type=u[E.type]||E.type})}catch(E){if(E.name!=="TypeError")throw E;H(I).call(I,(_,S)=>{I.set(S,sn({},_,{type:u[_.type]||_.type}))})}return I}).then(f,m)}}}function mr(i){if(typeof i=="object"&&i.RTCPeerConnection&&i.RTCRtpSender&&!(i.RTCRtpSender&&"getStats"in i.RTCRtpSender.prototype)){var n=i.RTCPeerConnection.prototype.getSenders;n&&(i.RTCPeerConnection.prototype.getSenders=function(){let c=n.apply(this,[]);return H(c).call(c,u=>u._pc=this),c});var s=i.RTCPeerConnection.prototype.addTrack;s&&(i.RTCPeerConnection.prototype.addTrack=function(){let c=s.apply(this,arguments);return c._pc=this,c}),i.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):se.resolve(new Ct)}}}function si(i){if(typeof i=="object"&&i.RTCPeerConnection&&i.RTCRtpSender&&!(i.RTCRtpSender&&"getStats"in i.RTCRtpReceiver.prototype)){var n=i.RTCPeerConnection.prototype.getReceivers;n&&(i.RTCPeerConnection.prototype.getReceivers=function(){let s=n.apply(this,[]);return H(s).call(s,c=>c._pc=this),s}),a(i,"track",s=>(s.receiver._pc=s.srcElement,s)),i.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}}function Jn(i){!i.RTCPeerConnection||"removeStream"in i.RTCPeerConnection.prototype||(i.RTCPeerConnection.prototype.removeStream=function(n){var s;g("removeStream","removeTrack"),H(s=this.getSenders()).call(s,c=>{var u;c.track&&gt(u=n.getTracks()).call(u,c.track)&&this.removeTrack(c)})})}function ai(i){i.DataChannel&&!i.RTCDataChannel&&(i.RTCDataChannel=i.DataChannel)}function rn(i){if(typeof i=="object"&&i.RTCPeerConnection){if("getLocalStreams"in i.RTCPeerConnection.prototype||(i.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in i.RTCPeerConnection.prototype)){let n=i.RTCPeerConnection.prototype.addTrack;i.RTCPeerConnection.prototype.addStream=function(s){var c,u,h;this._localStreams||(this._localStreams=[]),gt(c=this._localStreams).call(c,s)||this._localStreams.push(s),H(u=s.getAudioTracks()).call(u,p=>n.call(this,p,s)),H(h=s.getVideoTracks()).call(h,p=>n.call(this,p,s))},i.RTCPeerConnection.prototype.addTrack=function(s,c){var u;return c&&(this._localStreams?gt(u=this._localStreams).call(u,c)||this._localStreams.push(c):this._localStreams=[c]),n.call(this,s,c)}}"removeStream"in i.RTCPeerConnection.prototype||(i.RTCPeerConnection.prototype.removeStream=function(n){var s,c,u;this._localStreams||(this._localStreams=[]);let h=He(s=this._localStreams).call(s,n);if(h!==-1){qr(c=this._localStreams).call(c,h,1);var p=n.getTracks();H(u=this.getSenders()).call(u,f=>{gt(p).call(p,f.track)&&this.removeTrack(f)})}})}}function Oi(i){if(typeof i=="object"&&i.RTCPeerConnection&&("getRemoteStreams"in i.RTCPeerConnection.prototype||(i.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in i.RTCPeerConnection.prototype))){dt(i.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(s){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=s),this.addEventListener("track",this._onaddstreampoly=c=>{var u;H(u=c.streams).call(u,h=>{var p;this._remoteStreams||(this._remoteStreams=[]),gt(p=this._remoteStreams).call(p,h)||(this._remoteStreams.push(h),p=new Event("addstream"),p.stream=h,this.dispatchEvent(p))})})}});let n=i.RTCPeerConnection.prototype.setRemoteDescription;i.RTCPeerConnection.prototype.setRemoteDescription=function(){let s=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(c){var u;H(u=c.streams).call(u,h=>{var p;s._remoteStreams||(s._remoteStreams=[]),0<=He(p=s._remoteStreams).call(p,h)||(s._remoteStreams.push(h),p=new Event("addstream"),p.stream=h,s.dispatchEvent(p))})}),n.apply(s,arguments)}}}function mn(i){if(typeof i=="object"&&i.RTCPeerConnection){i=i.RTCPeerConnection.prototype;var n=i.createOffer,s=i.createAnswer,c=i.setLocalDescription,u=i.setRemoteDescription,h=i.addIceCandidate;i.createOffer=function(f,m){let I=n.apply(this,[2<=arguments.length?arguments[2]:arguments[0]]);return m?(I.then(f,m),se.resolve()):I},i.createAnswer=function(f,m){let I=s.apply(this,[2<=arguments.length?arguments[2]:arguments[0]]);return m?(I.then(f,m),se.resolve()):I};var p=function(f,m,I){return f=c.apply(this,[f]),I?(f.then(m,I),se.resolve()):f};i.setLocalDescription=p,p=function(f,m,I){return f=u.apply(this,[f]),I?(f.then(m,I),se.resolve()):f},i.setRemoteDescription=p,p=function(f,m,I){return f=h.apply(this,[f]),I?(f.then(m,I),se.resolve()):f},i.addIceCandidate=p}}function xr(i){let n=i&&i.navigator;if(n.mediaDevices&&n.mediaDevices.getUserMedia){var s;i=n.mediaDevices;let u=hr(s=i.getUserMedia).call(s,i);n.mediaDevices.getUserMedia=h=>u(ci(h))}var c;!n.getUserMedia&&n.mediaDevices&&n.mediaDevices.getUserMedia&&(n.getUserMedia=hr(c=function(u,h,p){n.mediaDevices.getUserMedia(u).then(h,p)}).call(c,n))}function ci(i){return i&&i.video!==void 0?sn({},i,{video:C(i.video)}):i}function Ao(i){let n=i.RTCPeerConnection;i.RTCPeerConnection=function(s,c){if(s&&s.iceServers){let u=[];for(let h=0;h<s.iceServers.length;h++){let p=s.iceServers[h];!p.hasOwnProperty("urls")&&p.hasOwnProperty("url")?(g("RTCIceServer.url","RTCIceServer.urls"),p=JSON.parse(pe(p)),p.urls=p.url,delete p.url,u.push(p)):u.push(s.iceServers[h])}s.iceServers=u}return new n(s,c)},i.RTCPeerConnection.prototype=n.prototype,"generateCertificate"in i.RTCPeerConnection&&dt(i.RTCPeerConnection,"generateCertificate",{get:()=>n.generateCertificate})}function vn(i){typeof i=="object"&&i.RTCPeerConnection&&"receiver"in i.RTCTrackEvent.prototype&&!i.RTCTransceiver&&dt(i.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function xe(i){let n=i.RTCPeerConnection.prototype.createOffer;i.RTCPeerConnection.prototype.createOffer=function(s){if(s){var c,u;s.offerToReceiveAudio!==void 0&&(s.offerToReceiveAudio=!!s.offerToReceiveAudio);let h=ze(c=this.getTransceivers()).call(c,p=>p.receiver.track.kind==="audio");s.offerToReceiveAudio===!1&&h?h.direction==="sendrecv"?h.setDirection?h.setDirection("sendonly"):h.direction="sendonly":h.direction==="recvonly"&&(h.setDirection?h.setDirection("inactive"):h.direction="inactive"):s.offerToReceiveAudio!==!0||h||this.addTransceiver("audio"),s.offerToReceiveVideo!==void 0&&(s.offerToReceiveVideo=!!s.offerToReceiveVideo),c=ze(u=this.getTransceivers()).call(u,p=>p.receiver.track.kind==="video"),s.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):s.offerToReceiveVideo!==!0||c||this.addTransceiver("video")}return n.apply(this,arguments)}}function St(i){if(i.RTCIceCandidate&&!(i.RTCIceCandidate&&"foundation"in i.RTCIceCandidate.prototype)){var n=i.RTCIceCandidate;i.RTCIceCandidate=function(s){var c;if(typeof s=="object"&&s.candidate&&He(c=s.candidate).call(c,"a=")===0&&((s=JSON.parse(pe(s))).candidate=s.candidate.substr(2)),s.candidate&&s.candidate.length){c=new n(s),s=Ue.parseCandidate(s.candidate);let u=sn(c,s);return u.toJSON=function(){return{candidate:u.candidate,sdpMid:u.sdpMid,sdpMLineIndex:u.sdpMLineIndex,usernameFragment:u.usernameFragment}},u}return new n(s)},i.RTCIceCandidate.prototype=n.prototype,a(i,"icecandidate",s=>(s.candidate&&dt(s,"candidate",{value:new i.RTCIceCandidate(s.candidate),writable:"false"}),s))}}function tr(i){if(i.RTCPeerConnection){var n=v(i);"sctp"in i.RTCPeerConnection.prototype||dt(i.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});var s=function(f){return!f||!f.sdp?!1:(f=Ue.splitSections(f.sdp),f.shift(),CE(f).call(f,m=>{var I;return(m=Ue.parseMLine(m))&&m.kind==="application"&&He(I=m.protocol).call(I,"SCTP")!==-1}))},c=function(f){return f=f.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/),f===null||2>f.length?-1:(f=dr(f[1],10),f!=f?-1:f)},u=function(f){let m=65536;return n.browser==="firefox"&&(m=57>n.version?f===-1?16384:2147483637:60>n.version?n.version===57?65535:65536:2147483637),m},h=function(f,m){let I=65536;return n.browser==="firefox"&&n.version===57&&(I=65535),f=Ue.matchPrefix(f.sdp,"a=max-message-size:"),0<f.length?I=dr(f[0].substr(19),10):n.browser==="firefox"&&m!==-1&&(I=2147483637),I},p=i.RTCPeerConnection.prototype.setRemoteDescription;i.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,n.browser==="chrome"&&76<=n.version){var{sdpSemantics:f}=this.getConfiguration();f==="plan-b"&&dt(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(s(arguments[0])){var m=c(arguments[0]);f=u(m),m=h(arguments[0],m);let I;I=f===0&&m===0?Number.POSITIVE_INFINITY:f===0||m===0?Math.max(f,m):Math.min(f,m),f={},dt(f,"maxMessageSize",{get:()=>I}),this._sctp=f}return p.apply(this,arguments)}}}function Zt(i){function n(c,u){let h=c.send;c.send=function(){var p=arguments[0];if(p=p.length||p.size||p.byteLength,c.readyState==="open"&&u.sctp&&p>u.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+u.sctp.maxMessageSize+" bytes)");return h.apply(c,arguments)}}if(i.RTCPeerConnection&&"createDataChannel"in i.RTCPeerConnection.prototype){var s=i.RTCPeerConnection.prototype.createDataChannel;i.RTCPeerConnection.prototype.createDataChannel=function(){let c=s.apply(this,arguments);return n(c,this),c},a(i,"datachannel",c=>(n(c.channel,c.target),c))}}function Kr(i){var n;if(i.RTCPeerConnection&&!("connectionState"in i.RTCPeerConnection.prototype)){var s=i.RTCPeerConnection.prototype;dt(s,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),dt(s,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(c){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),c&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=c)},enumerable:!0,configurable:!0}),H(n=["setLocalDescription","setRemoteDescription"]).call(n,c=>{let u=s[c];s[c]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=h=>{let p=h.target;if(p._lastConnectionState!==p.connectionState){p._lastConnectionState=p.connectionState;let f=new Event("connectionstatechange",h);p.dispatchEvent(f)}return h},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),u.apply(this,arguments)}})}}function fo(i){if(i.RTCPeerConnection){var n=v(i);if(!(n.browser==="chrome"&&71<=n.version)){var s=i.RTCPeerConnection.prototype.setRemoteDescription;i.RTCPeerConnection.prototype.setRemoteDescription=function(c){var u,h;return c&&c.sdp&&He(u=c.sdp).call(u,`
a=extmap-allow-mixed`)!==-1&&(c.sdp=Qe(h=c.sdp.split(`
`)).call(h,p=>Zs(p).call(p)!=="a=extmap-allow-mixed").join(`
`)),s.apply(this,arguments)}}}}function qe(i){i&&Op.setUA(i),En=Op.getResult(),i=xo(En);var n,s=(n=En.engine.name==="Blink"?En.engine.version||"":En.browser.version||"",n.split(".")[0]);e:switch(En.os.name){case"Windows":n=En.os.version?En.os.name+" "+En.os.version:En.os.name;break e;default:n=En.os.name||""}return{name:i,version:s,os:n,osVersion:En.os.version}}function xo(i){if(i.engine.name==="Blink")return Xe.CHROME;switch(i.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Xe.CHROME;case"Safari":case"Mobile Safari":return Xe.SAFARI;case"Edge":return Xe.EDGE;case"Firefox":return Xe.FIREFOX;case"QQBrowser":return Xe.QQ;case"Opera":return Xe.OPERA;case"WeChat":return Xe.WECHAT;default:return i.browser.name||""}}function go(){let i=qe();return!!(En.engine.name==="WebKit"&&i.os===an.MAC_OS&&navigator.maxTouchPoints&&0<navigator.maxTouchPoints&&i.name!==Xe.SAFARI||Bn()&&i.name!==Xe.SAFARI)}function Us(){var i=qe();return!!(go()&&(i.os===an.MAC_OS||i.os===an.IOS&&((i=En.os.version&&En.os.version.split("."))&&Number(i[0])===14&&i[1]&&3<=Number(i[1])||i&&14<Number(i[0]))))}function Ji(){return qe().name===Xe.CHROME}function Fs(){return qe().name===Xe.SAFARI}function wr(){return qe().name===Xe.FIREFOX}function Bn(){return qe().os===an.IOS}function ki(){let i=qe();return i.os===an.IOS&&Number(i.osVersion&&i.osVersion.split(".")[0])===15}function mo(){return Fs()&&0<navigator.maxTouchPoints}function mu(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&35>=window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]}function xc(){let i=qe();return i.name===Xe.EDGE||i.name===Xe.SAFARI?!1:!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function cs(i){return typeof i=="string"?sn({},rR[i]):i}function Uc(i){return typeof i=="string"?sn({},nR[i]):i}function Na(i){return typeof i=="string"?sn({},iR[i]):i}function Oa(i){return typeof i=="string"?sn({},oR[i]):i}function Wr(i,n){var s;gt(s=ut(re)).call(s,i)&&(re[i]=n)}function ls(i,n,s){return{sampleRate:i,stereo:n,bitrate:s}}function Ve(i,n,s,c,u){return{width:i,height:n,frameRate:s,bitrateMin:c,bitrateMax:u}}function X(i,n,s,c,u){return{width:{max:i},height:{max:n},frameRate:s,bitrateMin:c,bitrateMax:u}}function we(i,n){return{numSpatialLayers:i,numTemporalLayers:n}}function Ye(i){return za.call(i)==="[object Array]"}function Dt(i){return i!==null&&typeof i=="object"}function ft(i){return za.call(i)==="[object Function]"}function Nr(i,n){if(i!=null)if(typeof i!="object"&&(i=[i]),Ye(i))for(var s=0,c=i.length;s<c;s++)n.call(null,i[s],s,i);else for(s in i)Object.prototype.hasOwnProperty.call(i,s)&&n.call(null,i[s],s,i)}function Ln(i){return encodeURIComponent(i).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function zi(){this.handlers=[]}function Fc(i,n){!Ke.isUndefined(i)&&Ke.isUndefined(i["Content-Type"])&&(i["Content-Type"]=n)}function li(i){this.defaults=i,this.interceptors={request:new PE,response:new PE}}function Vs(i){this.message=i}function Uo(i){if(typeof i!="function")throw new TypeError("executor must be a function.");var n;this.promise=new Promise(function(c){n=c});var s=this;i(function(c){s.reason||(s.reason=new UE(c),n(s.reason))})}function Fo(i){i=new Xu(i);var n=LE(Xu.prototype.request,i);return Ke.extend(n,Xu.prototype,i),Ke.extend(n,i),n}function vu(){let i=new Date;return i.toTimeString().split(" ")[0]+":"+i.getMilliseconds()}function us(i,n){if(typeof i!="boolean")throw new L(D.INVALID_PARAMS,"Invalid ".concat(n,": The value is of the boolean type."))}function Ir(i,n,s){var c;if(!gt(s).call(s,i))throw new L(D.INVALID_PARAMS,b(c="".concat(n," can only be set as ")).call(c,pe(s)))}function It(i,n,s=1,c=1e4,u=!0){if(i<s||i>c||u&&(typeof i!="number"||i%1!=0)){var h,p;throw new L(D.INVALID_PARAMS,b(h=b(p="invalid ".concat(n,": the value range is [")).call(p,s,", ")).call(h,c,"]. integer only"))}}function Yr(i,n,s=1,c=255,u=!0){if(i==null)throw new L(D.INVALID_PARAMS,"".concat(n||"param"," cannot be empty"));var h,p,f;if(!jg(i,s,c,u))throw new L(D.INVALID_PARAMS,b(h=b(p=b(f="Invalid ".concat(n||"string param",": Length of the string: [")).call(f,s,",")).call(p,c,"].")).call(h,u?" ASCII characters only.":""))}function Oh(i,n){if(!to(i))throw new L(D.INVALID_PARAMS,"".concat(n," should be an array"))}function kh(i){if(typeof i!="string"||!/^[a-zA-Z0-9 !#\$%&\(\)\+\-:;<=\.>\?@\[\]\^_\{\}\|~,]{1,64}$/.test(i))throw R.error("Invalid Channel Name ".concat(i)),new L(D.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function bh(i){var n;if(!(typeof i=="number"&&Math.floor(i)===i&&0<=i&&4294967295>=i||jg(i,1,255)))throw R.error(b(n="Invalid UID ".concat(i," ")).call(n,typeof i)),new L(D.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");typeof i=="string"&&R.warning("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}function jg(i,n=1,s=255,c=!0){if(n=typeof i=="string"&&i.length<=s&&i.length>=n){if(!(c=!c))e:if(typeof i!="string")c=!1;else{for(c=0;c<i.length;c+=1)if(n=i.charCodeAt(c),0>n||255<n){c=!1;break e}c=!0}n=c}return n}function PS(i){return Yr(i.reportId,"params.reportId",0,100,!1),Yr(i.category,"params.category",0,100,!1),Yr(i.event,"params.event",0,100,!1),Yr(i.label,"params.label",0,100,!1),It(i.value,"params.value",-9007199254740991,9007199254740991,!1),!0}function Hg(i){return It(i.timeout,"config.timeout",0,1e5),It(i.timeoutFactor,"config.timeoutFactor",0,100,!1),It(i.maxRetryCount,"config.maxRetryConfig",0,1/0),It(i.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}function Kg(i){if(!to(i)||1>i.length)return!1;try{H(i).call(i,n=>{if(!n.urls)throw Error()})}catch{return!1}return!0}function Wg(i){return Yr(i.turnServerURL,"turnServerURL"),Yr(i.username,"username"),Yr(i.password,"password"),i.udpport&&It(i.udpport,"udpport",1,99999,!0),i.forceturn&&us(i.forceturn,"forceturn"),i.security&&us(i.security,"security"),i.tcpport&&It(i.tcpport,"tcpport",1,99999,!0),!0}function Yg(i){return i.level!==void 0&&Ir(i.level,"level",[1,2,3]),!0}function Dh(i,n){Yr(i.url,"".concat(n,".url"),1,1e3,!1),i.x==null||It(i.x,"".concat(n,".x"),0,1e4),i.y==null||It(i.y,"".concat(n,".y"),0,1e4),i.width==null||It(i.width,"".concat(n,".width"),0,1e4),i.height==null||It(i.height,"".concat(n,".height"),0,1e4),i.zOrder==null||It(i.zOrder,"".concat(n,".zOrder"),0,255),i.alpha==null||It(i.alpha,"".concat(n,".alpha"),0,1,!1)}function qg(i){if(!i.channelName)throw new L(D.INVALID_PARAMS,"invalid channelName in info");if(!i.uid||typeof i.uid!="number")throw new L(D.INVALID_PARAMS,"invalid uid in info, uid must be a number");return i.token&&Yr(i.token,"info.token",1,2047),bh(i.uid),kh(i.channelName),!0}function Jg(i){return Ir(i,"mediaSource",["screen","window","application"]),!0}function zg(i,n){var s=ut(i);if(Mt){var c=Mt(i);n&&(c=Qe(c).call(c,function(u){return at(i,u).enumerable})),s.push.apply(s,c)}return s}function Xi(i,n,s){return new se((c,u)=>{n.timeout=n.timeout||re.HTTP_CONNECT_TIMEOUT,n.responseType=n.responseType||"json",n.data&&!s?(n.data=pe(n.data),td+=ba(n.data)):s&&(n.data.size?td+=n.data.size:n.data instanceof FormData?td+=function(h){let p=0;return/DingTalk/i.test(navigator.userAgent)&&h.realFormData&&(h=h.realFormData),H(h).call(h,f=>{p+=typeof f=="string"?ba(f):f.size}),p+138}(n.data):td+=ba(pe(n.data))),n.headers=n.headers||{},n.headers["Content-Type"]=n.headers["Content-Type"]||"application/json",n.method="POST",n.url=i,_o.request(n).then(h=>{typeof h.data=="string"?Wp+=ba(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?Wp+=h.data.byteLength:Wp+=ba(pe(h.data)),c(h.data)}).catch(h=>{_o.isCancel(h)?u(new L(D.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new L(D.NETWORK_TIMEOUT,h.message)):h.response?u(new L(D.NETWORK_RESPONSE_ERROR,h.response.status)):u(new L(D.NETWORK_ERROR,h.message))})})}async function QS(i,n){let s=new Blob([n.data],{type:"buffer"});return await Xi(i,function(c){for(var u=1;u<arguments.length;u++){var h,p=arguments[u]!=null?arguments[u]:{};if(u%2)H(h=zg(Object(p),!0)).call(h,function(m){yn(c,m,p[m])});else if(Lt)In(c,Lt(p));else{var f;H(f=zg(Object(p))).call(f,function(m){dt(c,m,at(p,m))})}}return c}({},n,{data:s,headers:{"Content-Type":"application/octet-stream"}}),!0)}function vo(i,n,s,c){let u=sn({},Dr,c),h=u.timeout,p=async()=>{await Mn(h),h*=u.timeoutFactor,h=Math.min(u.maxRetryTimeout,h)},f=!1;return c=new se(async(m,I)=>{n=n||(()=>!1),s=s||(()=>!0);for(let E=0;E<u.maxRetryCount;E+=1){if(f)return I(new L(D.OPERATION_ABORTED));try{const _=await i();if(!n(_,E)||E+1===u.maxRetryCount)return m(_);await p()}catch(_){if(!s(_,E)||E+1===u.maxRetryCount)return I(_);await p()}}}),c.cancel=()=>f=!0,c}function Xg(i,n){var s=ut(i);if(Mt){var c=Mt(i);n&&(c=Qe(c).call(c,function(u){return at(i,u).enumerable})),s.push.apply(s,c)}return s}function Cr(i){for(var n=1;n<arguments.length;n++){var s,c=arguments[n]!=null?arguments[n]:{};if(n%2)H(s=Xg(Object(c),!0)).call(s,function(h){yn(i,h,c[h])});else if(Lt)In(i,Lt(c));else{var u;H(u=Xg(Object(c))).call(u,function(h){dt(i,h,at(c,h))})}}return i}function Vc(i={report:z}){return function(n,s,c){let u=n[s];if(typeof u=="function"){let h=n.constructor.name==="AgoraRTCClient"?"Client":n.constructor.name;c.value=function(...p){var f;let m=i.report.reportApiInvoke(this._sessionId||null,{name:b(f="".concat(h,".")).call(f,s),options:p,tag:Te.TRACER});try{let I=u.apply(this,p);return m.onSuccess(),I}catch(I){throw m.onError(I),I}}}return c}}function Bh(i={report:z}){return function(n,s,c){let u=n[s];if(typeof u=="function"){let h=n.constructor.name==="AgoraRTCClient"?"Client":n.constructor.name;c.value=async function(...p){var f;let m=i.report.reportApiInvoke(this._sessionId||null,{name:b(f="".concat(h,".")).call(f,s),options:p,tag:Te.TRACER});try{let I=await u.apply(this,p);return m.onSuccess(),I}catch(I){throw m.onError(I),I}}}return c}}function xS(){c1?(R.info("create audio context"),oo=new c1,ht.curState=oo.state,oo.onstatechange=()=>{var i;ht.prevState=ht.curState,ht.curState=oo?oo.state:void 0,R.debug("AudioContext State Change",b(i="".concat(ht.prevState,"=>")).call(i,ht.curState)),(Bn()||mo())&&ht.prevState==="running"&&ht.curState==="interrupted"&&(R.info("ios-interruption-start"),ht.emit(Zr.IOS_INTERRUPTION_START)),(Bn()||mo())&&ht.prevState==="interrupted"&&ht.curState==="running"&&(R.info("ios-interruption-end"),ht.emit(Zr.IOS_INTERRUPTION_END)),ht.emit("state-change")},async function(i){function n(O){i.state==="running"?s(!1):Bn()||mo()?i.state==="suspended"&&(s(!0),O?i.resume().then(c,c):s(!1)):i.state!=="closed"&&(s(!0),O?i.resume().then(c,c):s(!1))}function s(O){if(_!==O){_=O;for(let B=0,Q=I;B<Q.length;B+=1){let q=Q[B];O?window.addEventListener(q,u,{capture:!0,passive:!0}):window.removeEventListener(q,u,{capture:!0,passive:!0})}}}function c(){n(!1)}function u(){n(!0)}function h(O){if(!N)if(E.paused)if(O){p(!1),N=!0,O=void 0;try{(O=E.play())?O.then(f,f):(E.addEventListener("playing",f),E.addEventListener("abort",f),E.addEventListener("error",f))}catch{f()}}else p(!0);else p(!1)}function p(O){if(S!==O){S=O;for(let B=0,Q=I;B<Q.length;B++){let q=Q[B];O?window.addEventListener(q,m,{capture:!0,passive:!0}):window.removeEventListener(q,m,{capture:!0,passive:!0})}}}function f(){E.removeEventListener("playing",f),E.removeEventListener("abort",f),E.removeEventListener("error",f),N=!1,h(!1)}function m(){h(!0)}let I="click contextmenu auxclick dblclick mousedown mouseup touchend keydown keyup".split(" "),E,_=!1,S=!1,N=!1;if(Bn()){let O=i.createMediaStreamDestination(),B=document.createElement("div");B.innerHTML="<audio x-webkit-airplay='deny'></audio>",E=B.children.item(0),E.controls=!1,E.disableRemotePlayback=!0,E.preload="auto",E.srcObject=O.stream,h(!0)}ht.on("state-change",function(){n(!0)}),n(!1)}(oo)):R.error("your browser is not support web audio")}function Gc(){if(!oo&&(xS(),!oo))throw new L(D.NOT_SUPPORTED,"can not create audio context");return oo}function jc(i){if(!function(){if(Yp!==null)return Yp;var c=Gc();let u=c.createBufferSource(),h=c.createGain();c=c.createGain(),u.connect(h),u.connect(c),u.disconnect(h),c=!1;try{u.disconnect(h)}catch{c=!0}return u.disconnect(),Yp=c,c}()){R.debug("polyfill audio node");var n=i.connect,s=i.disconnect;i.connect=(c,u,h)=>{var p;return i._inputNodes||(i._inputNodes=[]),gt(p=i._inputNodes).call(p,c)||(c instanceof AudioNode?(i._inputNodes.push(c),n.call(i,c,u,h)):n.call(i,c,u)),i},i.disconnect=(c,u,h)=>{s.call(i),c?js(i._inputNodes,c):i._inputNodes=[];for(let p of i._inputNodes)n.call(i,p)}}}function Lh(i,n){let s=1/n,c=Gc(),u=c.createGain();u.gain.value=0,u.connect(c.destination);let h=!1,p=()=>{if(h)return void(u=null);const f=c.createOscillator();f.onended=p,f.connect(u),f.start(0),f.stop(c.currentTime+s),i(c.currentTime)};return p(),()=>{h=!0}}async function $g(i,n){let s=(c,u)=>c?typeof c!="number"?c.max||c.exact||c.ideal||c.min||u:c:u;return i={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxHeight:s(n.height,1080),maxWidth:s(n.width,1920)}}},n.frameRate&&typeof n.frameRate!="number"?(i.video.mandatory.maxFrameRate=n.frameRate.max,i.video.mandatory.minFrameRate=n.frameRate.min):typeof n.frameRate=="number"&&(i.video.mandatory.maxFrameRate=n.frameRate),await navigator.mediaDevices.getUserMedia(i)}async function US(i){let n=await function(s){return new se((c,u)=>{const h=document.createElement("div");h.innerText="share screen",h.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const p=document.createElement("div");p.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const f=document.createElement("div");f.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",f.setAttribute("style","height: 12%;");const m=document.createElement("div");m.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const I=document.createElement("div");I.setAttribute("style","text-align: right; padding: 16px 0;");const E=document.createElement("button");E.innerHTML="cancel",E.setAttribute("style","width: 85px;"),E.onclick=()=>{document.body.removeChild(_);const S=Error("NotAllowedError");S.name="NotAllowedError",u(S)},I.appendChild(E),p.appendChild(f),p.appendChild(m),p.appendChild(I);const _=document.createElement("div");_.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),_.appendChild(h),_.appendChild(p),document.body.appendChild(_),Ie(s).call(s,S=>{if(S.id){const N=document.createElement("div");N.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let O=S.thumbnail;const{width:B}=O.getSize();1920<B&&(O=O.resize({width:1920})),N.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+O.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+(S.name.replace(/[\u00A0-\u9999<>&]/g,function(Q){return"&#"+Q.charCodeAt(0)+";"})+"</span>"),N.onclick=()=>{document.body.removeChild(_),c(S.id)},m.appendChild(N)}})})}(await Zg(i.mediaSource));return await $g(n,i)}async function Zg(i){let n=["window","screen"];i!=="application"&&i!=="window"||(n=["window"]),i==="screen"&&(n=["screen"]);let s=em();if(!s)throw new L(D.ELECTRON_IS_NULL);i=null;try{i=s.desktopCapturer.getSources({types:n})}catch{i=null}i&&i.then||(i=new se((c,u)=>{s.desktopCapturer.getSources({types:n},(h,p)=>{h?u(h):c(p)})}));try{return await i}catch(c){throw new L(D.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,c.toString())}}function em(){if(nd)return nd;try{return nd=window.require("electron"),nd}catch{return null}}async function bi(i,n){let s=0,c=null;for(;2>s;)try{c=await FS(i,n,0<s);break}catch(p){var u,h;if(p instanceof L)throw R.error(b(h="[".concat(n,"] ")).call(h,p.toString())),p;let f=Eu(p.name||p.code||p,p.message);if(f.code===D.MEDIA_OPTION_INVALID)R.debug("[".concat(n,"] detect media option invalid, retry")),s+=1,await Mn(500);else throw R.error(b(u="[".concat(n,"] ")).call(u,f.toString())),f}if(!c)throw new L(D.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return c}async function FS(i,n,s){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new L(D.NOT_SUPPORTED,"can not find getUserMedia");s&&(i.video&&(delete i.video.width,delete i.video.height),i.screen&&(delete i.screen.width,delete i.screen.height));var c=Bt;if(s=new MediaStream,i.audioSource&&s.addTrack(i.audioSource),i.videoSource&&s.addTrack(i.videoSource),!i.audio&&!i.video&&!i.screen)return R.debug("Using Video Source/ Audio Source"),s;if(i.screen)if(em())i.screen.sourceId?ka(s,await $g(i.screen.sourceId,i.screen)):ka(s,await US(i.screen));else if(Ji()&&i.screen.extensionId&&i.screen.mandatory){if(!c.getStreamFromExtension)throw new L(D.NOT_SUPPORTED,"This browser does not support screen sharing");R.debug("[".concat(n,'] Screen access on chrome stable, looking for extension"'));var u=await(h=i.screen.extensionId,p=n,new se((m,I)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},_=>{if(!_||!_.streamId)return R.error("[".concat(p,"] No response from Chrome Plugin. Plugin not installed properly"),_),void I(new L(D.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));m(_.streamId)})}catch(_){var E;R.error(b(E="[".concat(p,"] AgoraRTC screensharing plugin is not accessible(")).call(E,h,")"),_.toString()),I(new L(D.CHROME_PLUGIN_NOT_INSTALL))}}));i.screen.mandatory.chromeMediaSourceId=u,ka(s,await navigator.mediaDevices.getUserMedia({video:{mandatory:i.screen.mandatory}}))}else if(c.getDisplayMedia)i.screen.mediaSource&&Jg(i.screen.mediaSource),u={width:i.screen.width,height:i.screen.height,frameRate:i.screen.frameRate,displaySurface:i.screen.mediaSource==="screen"?"monitor":i.screen.mediaSource},R.debug("[".concat(n,"] getDisplayMedia:"),pe({video:u,audio:!!i.screenAudio})),ka(s,await navigator.mediaDevices.getDisplayMedia({video:u,audio:!!i.screenAudio}));else{if(!wr())throw R.error("[".concat(n,"] This browser does not support screenSharing")),new L(D.NOT_SUPPORTED,"This browser does not support screen sharing");i.screen.mediaSource&&Jg(i.screen.mediaSource),c={video:{mediaSource:i.screen.mediaSource,width:i.screen.width,height:i.screen.height,frameRate:i.screen.frameRate}},R.debug(b(u="[".concat(n,"] getUserMedia: ")).call(u,pe(c))),ka(s,await navigator.mediaDevices.getUserMedia(c))}var h,p;if(!i.video&&!i.audio)return s;i={video:i.video,audio:i.audio},R.debug("[".concat(n,"] GetUserMedia"),pe(i)),qe();let f;n=null,(Fs()||Bn()||go())&&(n=await qp.lock());try{f=await navigator.mediaDevices.getUserMedia(i)}catch(m){throw n&&n(),m}return i.audio&&(d1=!0),i.video&&(h1=!0),ka(s,f),n&&n(),s}function Eu(i,n){switch(i){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":var s;return new L(D.MEDIA_OPTION_INVALID,b(s="".concat(i,": ")).call(s,n));case"NotFoundError":case"DevicesNotFoundError":var c;return new L(D.DEVICE_NOT_FOUND,b(c="".concat(i,": ")).call(c,n));case"NotSupportedError":var u;return new L(D.NOT_SUPPORTED,b(u="".concat(i,": ")).call(u,n));case"NotReadableError":var h;return new L(D.NOT_READABLE,b(h="".concat(i,": ")).call(h,n));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":var p;return new L(D.PERMISSION_DENIED,b(p="".concat(i,": ")).call(p,n));case"ConstraintNotSatisfiedError":var f;return new L(D.CONSTRAINT_NOT_SATISFIED,b(f="".concat(i,": ")).call(f,n));default:var m;return R.error("getUserMedia unexpected error",i),new L(D.UNEXPECTED_ERROR,b(m="".concat(i,": ")).call(m,n))}}function ka(i,n){let s=i.getVideoTracks()[0],c=i.getAudioTracks()[0],u=n.getVideoTracks()[0];(n=n.getAudioTracks()[0])&&(c&&i.removeTrack(c),i.addTrack(n)),u&&(s&&i.removeTrack(s),i.addTrack(u))}function tm(){if(!Jp){let i=n=>{n.preventDefault(),Jp=!1,document.body.removeEventListener("touchstart",i,!0),document.body.removeEventListener("mousedown",i,!0)};Jp=!0,document.body.addEventListener("touchstart",i,!0),document.body.addEventListener("mousedown",i,!0),f1.emit("autoplay-failed")}}function Ht(){return function(i,n,s){let c=i[n];typeof c=="function"&&(s.value=function(...u){this._isClosed&&new L(D.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning");let h=c.apply(this,u);return h instanceof se?new se((p,f)=>{h.then(p).catch(f)}):h})}}function rm(i,n){var s=ut(i);if(Mt){var c=Mt(i);n&&(c=Qe(c).call(c,function(u){return at(i,u).enumerable})),s.push.apply(s,c)}return s}function Iu(i){for(var n=1;n<arguments.length;n++){var s,c=arguments[n]!=null?arguments[n]:{};if(n%2)H(s=rm(Object(c),!0)).call(s,function(h){yn(i,h,c[h])});else if(Lt)In(i,Lt(c));else{var u;H(u=rm(Object(c))).call(u,function(h){dt(i,h,at(c,h))})}}return i}function nm(i,n){var s=ut(i);if(Mt){var c=Mt(i);n&&(c=Qe(c).call(c,function(u){return at(i,u).enumerable})),s.push.apply(s,c)}return s}function Eo(i){for(var n=1;n<arguments.length;n++){var s,c=arguments[n]!=null?arguments[n]:{};if(n%2)H(s=nm(Object(c),!0)).call(s,function(h){yn(i,h,c[h])});else if(Lt)In(i,Lt(c));else{var u;H(u=nm(Object(c))).call(u,function(h){dt(i,h,at(c,h))})}}return i}function im(i,n){var s=ut(i);if(Mt){var c=Mt(i);n&&(c=Qe(c).call(c,function(u){return at(i,u).enumerable})),s.push.apply(s,c)}return s}function om(i){for(var n=1;n<arguments.length;n++){var s,c=arguments[n]!=null?arguments[n]:{};if(n%2)H(s=im(Object(c),!0)).call(s,function(h){yn(i,h,c[h])});else if(Lt)In(i,Lt(c));else{var u;H(u=im(Object(c))).call(u,function(h){dt(i,h,at(c,h))})}}return i}function VS(i){if(!i.address||!i.tcp)throw new L(D.UNEXPECTED_RESPONSE,"Invalid address format ".concat(i));return i.address.match(/^[\.:\d]+$/)?"".concat(i.address.replace(/[^\d]/g,"-"),".edge.agora.io"):(R.info("Cannot recognized as IP address ".concat(i.address,". Used As Host instead")),b(n="".concat(i.address,":")).call(n,i.tcp));var n}function sm(i,n){var s;let c=re.GATEWAY_DOMAINS,u=c[1]&&He(n).call(n,c[1])!==-1?1:0;return i.addresses=i.addresses||[],{gatewayAddrs:Ie(s=i.addresses).call(s,h=>{var p,f,m;return h.ip.match(/^[\.:\d]+$/)?b(p=b(f="".concat(h.ip.replace(/[^\d]/g,"-"),".")).call(f,c[u++%c.length],":")).call(p,h.port):(R.info("Cannot recognized as IP address ".concat(h.ip,". Used As Host instead")),b(m="".concat(h.ip,":")).call(m,h.port))}),uid:i.uid,cid:i.cid,vid:i.detail&&i.detail[8],uni_lbs_ip:i.detail&&i.detail[1],res:i,csIp:i.detail&&i.detail[502]}}function ds(i){return typeof i=="number"?i:i.exact||i.ideal||i.max||i.min||0}function am(i,n){let s=i.videoSend[0];return s?(n=n&&n.videoSend[0]?n.videoSend[0].inputFrame:void 0,i={id:rr(10,""),timestamp:new Date(i.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:s.ssrc.toString()},s.inputFrame&&(n&&s.inputFrame.height===n.height||(i.A_fhi=s.inputFrame.height?s.inputFrame.height.toString():"0"),n&&s.inputFrame.width===n.width||(i.A_fwi=s.inputFrame.width?s.inputFrame.width.toString():"0"),n&&s.inputFrame.frameRate===n.frameRate||(i.A_fri=s.inputFrame.frameRate?s.inputFrame.frameRate.toString():"0")),i):null}function cm(i){return 0<=i&&.17>i?1:.17<=i&&.36>i?2:.36<=i&&.59>i?3:.59<=i&&1>=i?4:1<i?5:0}function GS(i,n){let s={};return i.height&&i.width&&(n=n._videoHeight||n.getMediaStreamTrack(!0).getSettings().height,s.scaleResolutionDownBy=n?n/ds(i.height):4),s.maxFramerate=i.framerate?ds(i.framerate):void 0,s.maxBitrate=i.bitrate?1e3*i.bitrate:void 0,s}function Mh(i,n){var s;let c,u;switch(n){case Cn.CHOOSE_SERVER:c=4096,n="choose server";break;case Cn.CLOUD_PROXY:c=1048576,n="proxy";break;case Cn.CLOUD_PROXY_5:c=4194304,n="proxy5";break;default:throw new L(D.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:i.detail&&i.detail[502],retry:!1})}if(H(s=i.response_body).call(s,h=>{var p;h.buffer&&h.buffer.flag===c&&(u={code:h.buffer.code,addresses:Ie(p=h.buffer.edges_services).call(p,f=>om({},f,{ticket:h.buffer.cert})),server_ts:i.enter_ts,uid:h.buffer.uid,cid:h.buffer.cid,cname:h.buffer.cname,detail:om({},h.buffer.detail,{},i.detail),flag:h.buffer.flag,opid:i.opid})}),!u)throw new L(D.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(n," from multi unilbs response"),{csIp:i.detail&&i.detail[502]});return u}function jS(i){var n;return Ie(n=i.addresses).call(n,s=>({address:s.ip,tcpport:s.port,udpport:s.port,username:Fr.username,password:Fr.password}))}function lm(i,n){var s=ut(i);if(Mt){var c=Mt(i);n&&(c=Qe(c).call(c,function(u){return at(i,u).enumerable})),s.push.apply(s,c)}return s}function Ph(i){for(var n=1;n<arguments.length;n++){var s,c=arguments[n]!=null?arguments[n]:{};if(n%2)H(s=lm(Object(c),!0)).call(s,function(h){yn(i,h,c[h])});else if(Lt)In(i,Lt(c));else{var u;H(u=lm(Object(c))).call(u,function(h){dt(i,h,at(c,h))})}}return i}function ba(i){return window.TextEncoder?new TextEncoder().encode(i).length:i.length}function Mn(i){return new se(n=>{window.setTimeout(n,i)})}function HS(i){let n=new L(D.TIMEOUT,"timeout");return new se((s,c)=>{window.setTimeout(()=>c(n),i)})}function rr(i=7,n){var s,c;let u=Math.random().toString(16).substr(2,i).toLowerCase();return u.length===i?b(s="".concat(n)).call(s,u):b(c="".concat(n)).call(c,u)+rr(i-u.length,"")}function um(i){return new se((n,s)=>{let c=!1,u=document.createElement("video");u.setAttribute("autoplay",""),u.setAttribute("muted",""),u.muted=!0,u.autoplay=!0,u.setAttribute("playsinline",""),u.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(u),s=Bn()?"canplay":"playing",u.addEventListener(s,()=>{let h=u.videoWidth,p=u.videoHeight;!h&&wr()||(c=!0,u.srcObject=null,u.remove(),n([h,p]))}),u.srcObject=new MediaStream([i]),u.play().catch(id),pi(()=>{c||(u.srcObject=null,u.remove(),n([u.videoWidth,u.videoHeight]))},4e3)})}function Da(i){return se.all(Ie(i).call(i,n=>n.then(s=>{throw s},s=>s))).then(n=>{throw n},n=>n)}function Or(i,n,...s){return i.getListeners(n).length===0?se.reject(new L(D.UNEXPECTED_ERROR,"can not emit promise")):new se((c,u)=>{i.emit(n,...s,c,u)})}function nn(i,n,...s){return i.getListeners(n).length===0?se.resolve():Or(i,n,...s)}function Gs(i,n,...s){return i.getListeners(n).length===0?null:Hc(i,n,...s)}function Hc(i,n,...s){let c=null,u=null;if(i.emit(n,...s,h=>{c=h},h=>{u=h}),u!==null)throw u;if(c===null)throw new L(D.UNEXPECTED_ERROR,"handler is not sync");return c}function js(i,n){n=He(i).call(i,n),n!==-1&&qr(i).call(i,n,1)}function dm(i){let n=[];return H(i).call(i,s=>{He(n).call(n,s)===-1&&n.push(s)}),n}function ui(i){se.resolve().then(i)}function Kc(i,n){E1[n]||(E1[n]=!0,i())}function Qh(i){i=window.atob(i);let n=new Uint8Array(new ArrayBuffer(i.length));for(let s=0;s<i.length;s+=1)n[s]=i.charCodeAt(s);return n}function Cu(i){let n="";for(let s=0;s<i.length;s+=1)n+=String.fromCharCode(i[s]);return window.btoa(n)}function yu(i){var n=UR[Math.floor(i/1e4)];if(!n)return{desc:"unkonw error",retry:!1};if(n=n[i%1e4],!n){if(Math.floor(i/1e4)===Xa.ACCESS_POINT){if(n=i%1e4,n.toString()[0]==="1")return{desc:i.toString(),retry:!1};if(n.toString()[0]==="2")return{desc:i.toString(),retry:!0}}return{desc:"unkonw error",retry:!1}}return n}function hm(i){return FR[i]||{desc:"UNKNOW_ERROR_".concat(i),action:"failed"}}async function KS(){function i(de){let Le=f["_"+de];var _e;return _e="Cannot call unknown function "+de+", make sure it is exported",Le||s("Assertion failed: "+_e),Le}function n(de,Le,_e,_r,sa){sa={string:function(ot){let qt=0;if(ot!=null&&ot!==0){var Mr=1+(ot.length<<2);qt=ue(Mr);var Sr=ie,Ar=qt;if(0<Mr){Mr=Ar+Mr-1;for(let so=0;so<ot.length;++so){let Gr=ot.charCodeAt(so);if(55296<=Gr&&57343>=Gr&&(Gr=65536+((1023&Gr)<<10)|1023&ot.charCodeAt(++so)),127>=Gr){if(Ar>=Mr)break;Sr[Ar++]=Gr}else{if(2047>=Gr){if(Ar+1>=Mr)break;Sr[Ar++]=192|Gr>>6}else{if(65535>=Gr){if(Ar+2>=Mr)break;Sr[Ar++]=224|Gr>>12}else{if(Ar+3>=Mr)break;Sr[Ar++]=240|Gr>>18,Sr[Ar++]=128|Gr>>12&63}Sr[Ar++]=128|Gr>>6&63}Sr[Ar++]=128|63&Gr}}Sr[Ar]=0}}return qt},array:function(ot){const qt=ue(ot.length);return q.set(ot,qt),qt}};let aa=i(de),ac=[];if(de=0,_r)for(let ot=0;ot<_r.length;ot++){let qt=sa[_e[ot]];qt?(de===0&&(de=Y()),ac[ot]=qt(_r[ot])):ac[ot]=_r[ot]}return _e=aa.apply(null,ac),_e=function(ot){if(Le==="string")if(Sr=ot){ot=ie;var qt=Sr+Mr,Mr=Sr;let Ar="";for(;ot[Mr]&&!(Mr>=qt);)++Mr;if(16<Mr-Sr&&ot.subarray&&Q)ot=Q.decode(ot.subarray(Sr,Mr));else{for(;Sr<Mr;){if(qt=ot[Sr++],!(128&qt)){Ar+=String.fromCharCode(qt);continue}let so=63&ot[Sr++];if((224&qt)==192){Ar+=String.fromCharCode((31&qt)<<6|so);continue}let Gr=63&ot[Sr++];qt=(240&qt)==224?(15&qt)<<12|so<<6|Gr:(7&qt)<<18|so<<12|Gr<<6|63&ot[Sr++],65536>qt?Ar+=String.fromCharCode(qt):(qt-=65536,Ar+=String.fromCharCode(55296|qt>>10,56320|1023&qt))}ot=Ar}}else ot="";else ot=Le==="boolean"?!!ot:ot;return ot;var Sr}(_e),de!==0&&Z(de),_e}function s(de){throw f.onAbort&&f.onAbort(de),N(de+=""),B=!0,new WebAssembly.RuntimeError("abort("+de+"). Build with -s ASSERTIONS=1 for more info.")}function c(de){for(;0<de.length;){let Le=de.shift();if(typeof Le=="function"){Le(f);continue}let _e=Le.func;typeof _e=="number"?Le.arg===void 0?Ae.get(_e)():Ae.get(_e)(Le.arg):_e(Le.arg===void 0?null:Le.arg)}}function u(de){function Le(){if(!xt&&(xt=!0,f.calledRun=!0,!B)){if(c(ke),c(yt),f.onRuntimeInitialized&&f.onRuntimeInitialized(),f.postRun)for(typeof f.postRun=="function"&&(f.postRun=[f.postRun]);f.postRun.length;){var _e=f.postRun.shift();ve.unshift(_e)}c(ve)}}0<Ze||(function(){if(f.preRun)for(typeof f.preRun=="function"&&(f.preRun=[f.preRun]);f.preRun.length;){var _e=f.preRun.shift();Be.unshift(_e)}c(Be)}(),0<Ze||(f.setStatus?(f.setStatus("Running..."),pi(function(){pi(function(){f.setStatus("")},1),Le()},1)):Le()))}var h,p;if($p)return $p;let f={},m,I={};for(m in f)Object.prototype.hasOwnProperty.call(f,m)&&(I[m]=f[m]);let E=!1,_=!1;E=typeof window=="object",_=typeof importScripts=="function";let S="";(E||_)&&(_?S=self.location.href:typeof document!="undefined"&&document.currentScript&&(S=document.currentScript.src),S=He(S).call(S,"blob:")!==0?S.substr(0,$R(S).call(S,"/")+1):""),f.print||hr(h=console.log).call(h,console);let N=f.printErr||hr(p=console.warn).call(p,console);for(m in I)Object.prototype.hasOwnProperty.call(I,m)&&(f[m]=I[m]);let O;I=null,typeof WebAssembly!="object"&&s("no native wasm support detected");let B=!1,Q=typeof TextDecoder!="undefined"?new TextDecoder("utf8"):void 0;typeof TextDecoder!="undefined"&&new TextDecoder("utf-16le");let q,ie,Ae,Be=[],ke=[],yt=[],ve=[];ke.push({func:function(){ln()}});let Ze=0,vt=null;f.preloadedImages={},f.preloadedAudios={},h="deflate.wasm";var Yt;ol(Yt=h).call(Yt,"data:application/octet-stream;base64,")||(h=function(de){return f.locateFile?f.locateFile(de,S):S+de}(h));let Lr={emscripten_memcpy_big:function(de,Le,_e){var _r=ie.copyWithin;(ie===y1||ie instanceof Array&&_r===y1.copyWithin?jR:_r).call(ie,de,Le,Le+_e)},emscripten_resize_heap:function(de){s("OOM")}};await async function(){function de(_e,_r){f.asm=_e.exports,O=f.asm.memory,_e=O.buffer,f.HEAP8=q=new Int8Array(_e),f.HEAP16=new Int16Array(_e),f.HEAP32=new Int32Array(_e),f.HEAPU8=ie=new Uint8Array(_e),f.HEAPU16=new Uint16Array(_e),f.HEAPU32=new Uint32Array(_e),f.HEAPF32=new Float32Array(_e),f.HEAPF64=new Float64Array(_e),Ae=f.asm.__indirect_function_table,Ze--,f.monitorRunDependencies&&f.monitorRunDependencies(Ze),Ze==0&&vt&&(_e=vt,vt=null,_e())}let Le={env:Lr,wasi_snapshot_preview1:Lr};if(Ze++,f.monitorRunDependencies&&f.monitorRunDependencies(Ze),f.instantiateWasm)try{return f.instantiateWasm(Le,de)}catch(_e){return N("Module.instantiateWasm callback failed with error: "+_e),!1}return await function(_e){return new se((_r,sa)=>{_r(ZR().buffer)}).then(function(_r){return WebAssembly.instantiate(_r,Le)}).then(_e,function(_r){N("failed to asynchronously prepare wasm: "+_r),s(_r)})}(function(_e){de(_e.instance)}),{}}();let xt,ln=f.___wasm_call_ctors=function(){return(ln=f.___wasm_call_ctors=f.asm.__wasm_call_ctors).apply(null,arguments)},G=f._malloc=function(){return(G=f._malloc=f.asm.malloc).apply(null,arguments)};f._free=function(){return(f._free=f.asm.free).apply(null,arguments)},f.___errno_location=function(){return(f.___errno_location=f.asm.__errno_location).apply(null,arguments)},f._zlibCompress=function(){return(f._zlibCompress=f.asm.zlibCompress).apply(null,arguments)};let Y=f.stackSave=function(){return(Y=f.stackSave=f.asm.stackSave).apply(null,arguments)},Z=f.stackRestore=function(){return(Z=f.stackRestore=f.asm.stackRestore).apply(null,arguments)},ue=f.stackAlloc=function(){return(ue=f.stackAlloc=f.asm.stackAlloc).apply(null,arguments)};if(f.ccall=n,f.cwrap=function(de,Le,_e,_r){let sa=KR(_e=_e||[]).call(_e,function(aa){return aa==="number"});return Le!=="string"&&sa&&!_r?i(de):function(){return n(de,Le,_e,arguments)}},f.allocate=function(de,Le){let _e;return _e=Le==1?ue(de.length):G(de.length),de.subarray||Ur(de)?ie.set(de,_e):ie.set(new Uint8Array(de),_e),_e},vt=function de(){xt||u(),xt||(vt=de)},f.run=u,f.preInit)for(typeof f.preInit=="function"&&(f.preInit=[f.preInit]);0<f.preInit.length;)f.preInit.pop()();return u(),$p=f,f}function pm(i,n){var s=ut(i);if(Mt){var c=Mt(i);n&&(c=Qe(c).call(c,function(u){return at(i,u).enumerable})),s.push.apply(s,c)}return s}function xh(i){for(var n=1;n<arguments.length;n++){var s,c=arguments[n]!=null?arguments[n]:{};if(n%2)H(s=pm(Object(c),!0)).call(s,function(h){yn(i,h,c[h])});else if(Lt)In(i,Lt(c));else{var u;H(u=pm(Object(c))).call(u,function(h){dt(i,h,at(c,h))})}}return i}function Am(i,n){var s=ut(i);if(Mt){var c=Mt(i);n&&(c=Qe(c).call(c,function(u){return at(i,u).enumerable})),s.push.apply(s,c)}return s}function WS(i,n,s,c,u){EA+=1;let h={sid:s.sid,command:"convergeAllocateEdge",uid:"666",appId:s.appId,ts:Math.floor(le()/1e3),seq:EA,requestId:EA,version:Xn,cname:s.cname},p={service_name:n,json_body:pe(h)},f,m,I=i[0];return vo(async()=>{f=le();var E=await Xi(I,{data:p,cancelToken:c,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(m=le()-f,E.code!==0){var _=new L(D.UNEXPECTED_RESPONSE,"live streaming ap error, code"+E.code,{retry:!0,responseTime:m});throw R.error(_.toString()),_}if(E=JSON.parse(E.json_body),E.code!==200)throw E=new L(D.UNEXPECTED_RESPONSE,b(_="live streaming app center error, code: ".concat(E.code,", reason: ")).call(_,E.reason),{code:E.code,responseTime:m}),R.error(E.toString()),E;if(!E.servers||E.servers.length===0)throw _=new L(D.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:E.code,responseTime:m}),R.error(_.toString()),_;return _=function(S,N){var O;return{addressList:Ie(O=S.servers).call(O,B=>{var Q,q;return b(Q=b(q="wss://".concat(B.address.replace(/\./g,"-"),".edge.agora.io:")).call(q,B.wss,"?serviceName=")).call(Q,encodeURIComponent(N))}),workerToken:S.workerToken,vid:S.vid}}(E,n),re.LIVE_STREAMING_ADDRESS&&(_.addressList=re.LIVE_STREAMING_ADDRESS instanceof Array?re.LIVE_STREAMING_ADDRESS:[re.LIVE_STREAMING_ADDRESS]),function(S){for(var N=1;N<arguments.length;N++){var O,B=arguments[N]!=null?arguments[N]:{};if(N%2)H(O=Am(Object(B),!0)).call(O,function(q){yn(S,q,B[q])});else if(Lt)In(S,Lt(B));else{var Q;H(Q=Am(Object(B))).call(Q,function(q){dt(S,q,at(B,q))})}}return S}({},_,{responseTime:m})},(E,_)=>(z.apworkerEvent(s.sid,{success:!0,sc:200,serviceName:n,responseDetail:pe(E.addressList),firstSuccess:_===0,responseTime:m,serverIp:i[_%i.length]}),!1),(E,_)=>(z.apworkerEvent(s.sid,{success:!1,sc:E.data&&E.data.code||200,serviceName:n,responseTime:m,serverIp:i[_%i.length]}),!!(E.code!==D.OPERATION_ABORTED&&E.code!==D.UNEXPECTED_RESPONSE||E.data&&E.data.retry)&&(I=i[(_+1)%i.length],!0)),u)}function fm({url:i,areaCode:n},s,c,u){let h=le(),[p,f]=AI(s,n,[Cn.CHOOSE_SERVER]),m=ei.networkState;return vo(async()=>{m&&ei.networkState===Ui.OFFLINE&&ei.onlineWaiter&&await se.race([ei.onlineWaiter,Mn(u&&u.maxRetryTimeout||Dr.maxRetryTimeout)]),m=ei.networkState;var I=await Xi(i,{data:p,cancelToken:c,headers:{"Content-Type":"multipart/form-data;"}},!0);return hI(I,i,s,h,[Cn.CHOOSE_SERVER]),I=Mh(I,Cn.CHOOSE_SERVER),pI(I),sm(I,i)},I=>(I&&z.joinChooseServer(s.sid,{lts:h,succ:!0,csAddr:i,opid:f,serverList:I.gatewayAddrs,ec:null,cid:I.cid.toString(),uid:I.uid.toString(),csIp:I.csIp,unilbsServerIds:[Cn.CHOOSE_SERVER].toString()}),!1),I=>I.code!==D.OPERATION_ABORTED&&(I.code===D.CAN_NOT_GET_GATEWAY_SERVER?I.data.retry:(z.joinChooseServer(s.sid,{lts:h,succ:!1,csAddr:i,serverList:null,opid:f,ec:I.code,csIp:I.data&&I.data.csIp,unilbsServerIds:[Cn.CHOOSE_SERVER].toString(),extend:pe({networkState:m})}),R.warning("[".concat(s.clientId,"] Choose server network error, retry"),I),!0)),u)}function gm({url:i,areaCode:n,serviceIds:s},c,u,h){let p=le(),[f,m]=AI(c,n,s),I;return vo(async()=>{I&&ei.networkState===Ui.OFFLINE&&ei.onlineWaiter&&await se.race([ei.onlineWaiter,Mn(h&&h.maxRetryTimeout||Dr.maxRetryTimeout)]),I=ei.networkState;var E=await Xi(i,{data:f,cancelToken:u,headers:{"Content-Type":"multipart/form-data;"}},!0);hI(E,i,c,p,s);let _=Mh(E,Cn.CHOOSE_SERVER);return E=Mh(E,c.cloudProxyServer==="proxy5"?Cn.CLOUD_PROXY_5:Cn.CLOUD_PROXY),pI(_),{gatewayInfo:sm(_,i),proxyInfo:E,url:i}},E=>{var _;return E.gatewayInfo&&z.joinChooseServer(c.sid,{lts:p,succ:!0,csAddr:i,serverList:E.gatewayInfo.gatewayAddrs,ec:null,opid:m,cid:E.gatewayInfo.cid.toString(),uid:E.gatewayInfo.uid.toString(),csIp:E.gatewayInfo.csIp,unilbsServerIds:s.toString()}),E.proxyInfo&&z.joinWebProxyAP(c.sid,{lts:p,sucess:1,apServerAddr:i,turnServerAddrList:Ie(_=E.proxyInfo.addresses).call(_,S=>S.ip).join(","),errorCode:null,eventType:c.cloudProxyServer,unilbsServerIds:s.toString()}),!1},E=>E.code!==D.OPERATION_ABORTED&&(E.code===D.CAN_NOT_GET_GATEWAY_SERVER?E.data.retry:(z.joinWebProxyAP(c.sid,{lts:p,sucess:0,apServerAddr:i,turnServerAddrList:null,errorCode:E.code,eventType:c.cloudProxyServer,unilbsServerIds:s.toString(),extend:pe({networkState:I})}),R.warning("[".concat(c.clientId,"] multi unilbs network error, retry"),E),!0)),h)}async function Wc(i,n,s){return{gatewayInfo:await async function(c,u,h){var p,f;const m=Ie(p=Ur(f=re.WEBCS_DOMAIN).call(f,0,re.AJAX_REQUEST_CONCURRENT)).call(p,_=>{var S;return{url:c.proxyServer?b(S="https://".concat(c.proxyServer,"/ap/?url=")).call(S,_+"/api/v2/transpond/webrtc?v=2"):"https://".concat(_,"/api/v2/transpond/webrtc?v=2"),areaCode:vl()}});let I=null;const E=[];return I=await Da([(async()=>await rc({fragementLength:re.FRAGEMENT_LENGTH,referenceList:m,asyncMapHandler:_=>(R.debug("[".concat(c.clientId,"] Connect to choose_server:"),_.url),fm(_,c,u,h)),allFailedhandler:_=>{throw _[0]},promisesCollector:E}))(),(async()=>{var _;if(await Mn(1e3),I!==null)return I;const S=Ie(_=re.WEBCS_DOMAIN_BACKUP_LIST).call(_,N=>{var O;return{url:c.proxyServer?b(O="https://".concat(c.proxyServer,"/ap/?url=")).call(O,N+"/api/v2/transpond/webrtc?v=2"):"https://".concat(N,"/api/v2/transpond/webrtc?v=2"),areaCode:vl()}});return await rc({fragementLength:re.FRAGEMENT_LENGTH,referenceList:S,asyncMapHandler:N=>(R.debug("[".concat(c.clientId,"] Connect to backup choose_server:"),N.url),fm(N,c,u,h)),allFailedhandler:N=>{throw N[0]},promisesCollector:E})})()]),E.length&&H(E).call(E,_=>_.cancel&&typeof _.cancel=="function"&&_.cancel()),I}(i,n,s)}}async function mm(i,n,s,c){var u,h;if(i.cloudProxyServer==="disabled")return c?await Wc(i,n,s):void 0;let p;if(i.cloudProxyServer==="443only"||i.cloudProxyServer==="normal"){var f;let m;c?i.cloudProxyServer!=="normal"?[m,p]=await se.all([_u(i,n,s),Wc(i,n,s)]):(m=await _u(i,n,s),i.proxyServer=m.addresses[0],z.setProxyServer(i.proxyServer),R.setProxyServer(i.proxyServer),p=await Wc(i,n,s)):(p=void 0,i.cloudProxyServer!=="normal"?m=await _u(i,n,s):(m=await _u(i,n,s),i.proxyServer=m.addresses[0],z.setProxyServer(i.proxyServer),R.setProxyServer(i.proxyServer))),i.turnServer={mode:"manual",servers:Ie(f=m.addresses).call(f,I=>({turnServerURL:I,tcpport:i.cloudProxyServer==="proxy3"?void 0:m.serverResponse.tcpport?m.serverResponse.tcpport:Fr.tcpport,udpport:i.cloudProxyServer==="proxy4"?void 0:m.serverResponse.udpport?m.serverResponse.udpport:Fr.udpport,username:m.serverResponse.username||Fr.username,password:m.serverResponse.password||Fr.password,forceturn:i.cloudProxyServer!=="proxy4"&&i.cloudProxyServer!=="proxy5",security:i.cloudProxyServer==="proxy5"}))}}else{let{proxyInfo:m,gatewayInfo:I}=await async function(E,_,S){var N,O;const B=re.PROXY_SERVER_TYPE3,Q=(ve,Ze)=>{var vt;let Yt=B;return to(Yt)&&(Yt=Ze%2==0?B[1]:B[0]),b(vt="https://".concat(Yt,"/ap/?url=")).call(vt,ve)},q=Ie(N=Ur(O=re.WEBCS_DOMAIN).call(O,0,re.AJAX_REQUEST_CONCURRENT)).call(N,(ve,Ze)=>({url:Q("".concat(ve,"/api/v2/transpond/webrtc?v=2"),Ze),areaCode:vl(),serviceIds:[Cn.CHOOSE_SERVER,E.cloudProxyServer==="proxy5"?Cn.CLOUD_PROXY_5:Cn.CLOUD_PROXY]}));let ie=null;const Ae=[],{gatewayInfo:Be,proxyInfo:ke,url:yt}=await Da([(async()=>await rc({fragementLength:re.FRAGEMENT_LENGTH,referenceList:q,asyncMapHandler:ve=>(R.debug("[".concat(E.clientId,"] Connect to choose_server:"),ve.url),gm(ve,E,_,S)),allFailedhandler:ve=>{throw ve[0]},promisesCollector:Ae}))(),(async()=>{var ve;if(await Mn(1e3),ie!==null)return ie;const Ze=Ie(ve=re.WEBCS_DOMAIN_BACKUP_LIST).call(ve,(vt,Yt)=>({url:Q("".concat(vt,"/api/v2/transpond/webrtc?v=2"),Yt),areaCode:vl(),serviceIds:[11,18]}));return await rc({fragementLength:re.FRAGEMENT_LENGTH,referenceList:Ze,asyncMapHandler:vt=>(R.debug("[".concat(E.clientId,"] Connect to backup choose_server:"),vt.url),gm(vt,E,_,S)),allFailedhandler:vt=>{throw vt[0]},promisesCollector:Ae})})()]);if(Ae.length&&H(Ae).call(Ae,ve=>ve.cancel&&typeof ve.cancel=="function"&&ve.cancel()),!Be||!ke)throw new L(D.UNEXPECTED_ERROR,"missing gateway or proxy response").print();return to(B)&&yt&&(N=new Bw(yt).host,gt(B).call(B,N)&&(E.proxyServer=N,R.setProxyServer(N),z.setProxyServer(N))),ie={gatewayInfo:Be,proxyInfo:jS(ke)},ie}(i,n,s);p={gatewayInfo:I},i.turnServer={mode:"manual",servers:Ie(m).call(m,E=>({turnServerURL:E.address,tcpport:i.cloudProxyServer==="proxy3"?void 0:E.tcpport?E.tcpport:Fr.tcpport,udpport:i.cloudProxyServer==="proxy4"?void 0:E.udpport?E.udpport:Fr.udpport,username:E.username||Fr.username,password:E.password||Fr.password,forceturn:i.cloudProxyServer!=="proxy4"&&i.cloudProxyServer!=="proxy5",security:i.cloudProxyServer==="proxy5"}))}}return R.debug(b(u=b(h="[".concat(i.clientId,"] set proxy server: ")).call(h,i.proxyServer,", mode: ")).call(u,i.cloudProxyServer)),p}async function Uh(i,n,s,c){var u;let h=Ur(u=re.ACCOUNT_REGISTER).call(u,0,re.AJAX_REQUEST_CONCURRENT);return u=[],u=n.proxyServer?Ie(h).call(h,p=>{var f;return b(f="https://".concat(n.proxyServer,"/ap/?url=")).call(f,p+"/api/v1")}):Ie(h).call(h,p=>"https://".concat(p,"/api/v1")),(await async function(p,f,m,I,E){let _=le(),S={sid:m.sid,opid:10,appid:m.appId,string_uid:f},N=p[0];if(m=await vo(()=>Xi(N+"".concat(He(N).call(N,"?")===-1?"?":"&","action=stringuid"),{data:S,cancelToken:I,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(O,B)=>{if(O.code===0){var Q;if(0>=O.uid||O.uid>=Math.pow(2,32))throw R.error(b(Q="Invalid Uint Uid ".concat(f," => ")).call(Q,O.uid),O),z.reqUserAccount(S.sid,{lts:_,success:!1,serverAddr:N,stringUid:S.string_uid,uid:O.uid,errorCode:D.INVALID_UINT_UID_FROM_STRING_UID,extend:S}),new L(D.INVALID_UINT_UID_FROM_STRING_UID);return z.reqUserAccount(S.sid,{lts:_,success:!0,serverAddr:N,stringUid:S.string_uid,uid:O.uid,errorCode:null,extend:S}),!1}return Q=yu(O.code),Q.retry&&(N=p[(B+1)%p.length]),z.reqUserAccount(S.sid,{lts:_,success:!1,serverAddr:N,stringUid:S.string_uid,uid:O.uid,errorCode:Q.desc,extend:S}),Q.retry},(O,B)=>O.code!==D.OPERATION_ABORTED&&(z.reqUserAccount(S.sid,{lts:_,success:!1,serverAddr:N,stringUid:S.string_uid,uid:null,errorCode:O.code,extend:S}),N=p[(B+1)%p.length],!0),E),m.code!==0)throw m=yu(m.code),new L(D.UNEXPECTED_RESPONSE,m.desc);return m}(u,i,n,s,c)).uid}async function _u(i,n,s){var c,u=le(),h=Ie(c=re[i.cloudProxyServer==="normal"?"PROXY_CS":"WEBCS_DOMAIN"]).call(c,f=>{var m;return i.proxyServer?b(m="https://".concat(i.proxyServer,"/ap/?url=")).call(m,f+"/api/v1"):"https://".concat(f,"/api/v1")});if(i.cloudProxyServer==="proxy3"||i.cloudProxyServer==="proxy4"||i.cloudProxyServer==="proxy5"){u=Ie(h).call(h,f=>({url:f,areaCode:vl()}));var p=null;if(p=await rc({fragementLength:re.FRAGEMENT_LENGTH,referenceList:u,asyncMapHandler:f=>function({url:m,areaCode:I},E,_,S){let N=le(),O={opid:133,flag:E.cloudProxyServer==="proxy5"?4194304:1048576,ts:+new Date,key:E.token,cname:E.cname,sid:E.sid,detail:{6:E.stringUid,11:I},uid:E.uid||0};return vo(async()=>await Xi(m,{data:O,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":69}}),B=>{var Q;if(B.code===0)return z.joinWebProxyAP(E.sid,{lts:N,sucess:1,apServerAddr:m,turnServerAddrList:Ie(Q=B.addresses).call(Q,q=>q.ip).join(","),errorCode:null,eventType:E.cloudProxyServer}),!1;throw B=yu(B.code),new L(D.CAN_NOT_GET_GATEWAY_SERVER,B.desc,{retry:B.retry})},B=>{return B.code!==D.OPERATION_ABORTED&&(B.code===D.CAN_NOT_GET_GATEWAY_SERVER?(z.joinWebProxyAP(O.sid,{lts:N,sucess:0,apServerAddr:m,turnServerAddrList:null,errorCode:B.code,eventType:E.cloudProxyServer}),R.warning(b(Q=b(q=b(ie="[".concat(E.clientId,"] proxy ap server ")).call(ie,m," failed, message: ")).call(q,B.message,", retry: ")).call(Q,B.data.retry)),B.data.retry):(z.joinWebProxyAP(O.sid,{lts:N,sucess:0,apServerAddr:m,turnServerAddrList:null,errorCode:B.code,eventType:E.cloudProxyServer}),!0));var Q,q,ie},S)}(f,i,n,s),allFailedhandler:()=>{throw R.error("[".concat(i.clientId,"] can not get proxy server after trying several times")),new L(D.CAN_NOT_GET_PROXY_SERVER)}}),u=p.addresses,!u||u.length===0)throw R.error("[".concat(i.clientId,"] can not get proxy server, empty proxy server list")),new L(D.CAN_NOT_GET_PROXY_SERVER,"empty proxy server list");return{addresses:Ie(u).call(u,f=>f.ip),serverResponse:{tcpport:u[0].port||443,udpport:u[0].port||Fr.udpport,username:Fr.username,password:Fr.password}}}if(c=null,c=await rc({fragementLength:re.FRAGEMENT_LENGTH,referenceList:h,asyncMapHandler:f=>function(m,I,E,_){let S=le(),N={command:"convergeAllocateEdge",sid:I.sid,appId:I.appId,token:I.token,uid:I.uid,cname:I.cname,ts:Math.floor(le()/1e3),version:Xn,seq:0,requestId:1};return vo(async()=>({res:await Xi(m,{data:{service_name:"webrtc_proxy",json_body:pe(N)},cancelToken:E,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}}),url:m}),O=>{if(!O.res.json_body)throw R.debug("[".concat(I.clientId,"] Get proxy server failed: no json_body")),new L(D.UNEXPECTED_RESPONSE,pe(O.res));let B=JSON.parse(O.res.json_body);var Q,q;if(B.code!==200)throw R.debug(b(Q=b(q="[".concat(I.clientId,"] Get proxy server failed: response code [")).call(q,B.code,"], reason [")).call(Q,B.reason,"]")),new L(D.UNEXPECTED_RESPONSE,pe(O.res));return R.debug("[".concat(I.clientId,"] App return server length"),B.servers.length),!1},O=>O.code!==D.OPERATION_ABORTED&&(z.requestProxyAppCenter(N.sid,{lts:S,succ:!1,APAddr:m,workerManagerList:null,ec:O.code,response:O.message}),!0),_)}(f,i,n,s),allFailedhandler:()=>{throw R.error("[".concat(i.clientId,"] can not get proxy server after trying several times")),new L(D.CAN_NOT_GET_PROXY_SERVER)}}),h=JSON.parse(c.res.json_body),h=Ie(p=h.servers).call(p,VS),i.cloudProxyServer==="443only")return{addresses:h,serverResponse:{tcpport:443,udpport:Fr.udpport,username:Fr.username,password:Fr.password}};z.requestProxyAppCenter(i.sid,{lts:u,succ:!0,APAddr:c.url,workerManagerList:pe(h),ec:null,response:pe(c.res)}),u=le(),p=Ie(h).call(h,f=>function(m,I,E,_){const S=le();let N=m;ol(m).call(m,"http")||(N="https://".concat(m,":4000/v2/machine"));const O={command:"request",gatewayType:"http",appId:I.appId,cname:I.cname,uid:(I.uid||"").toString(),sdkVersion:"2.3.1",sid:I.sid,seq:1,ts:le(),requestId:3,clientRequest:{appId:I.appId,cname:I.cname,uid:(I.uid||"").toString(),sid:I.sid}};return vo(async()=>({res:await Xi(N,{data:O,cancelToken:E}),url:m}),B=>{if(!B.res.serverResponse)throw new L(D.UNEXPECTED_RESPONSE,"requeet worker manager server failed: serverResponse is undefined");return!1},B=>B.code!==D.OPERATION_ABORTED&&(z.requestProxyWorkerManager(O.sid,{lts:S,succ:!1,workerManagerAddr:m,ec:B.code,response:B.message}),!0),_)}(f,i,n,s)),c=null;try{c=await Da(p)}catch{throw R.error("[".concat(i.clientId,"] can not get worker manager after trying several times")),new L(D.CAN_NOT_GET_PROXY_SERVER)}return H(p).call(p,f=>f.cancel()),z.requestProxyWorkerManager(i.sid,{lts:u,succ:!0,workerManagerAddr:c.url,ec:null,response:pe(c.res)}),{addresses:[c.url],serverResponse:c.res.serverResponse}}async function YS(i,n,s){var c,u,h=Ie(c=Ur(u=re.CDS_AP).call(u,0,re.AJAX_REQUEST_CONCURRENT)).call(c,f=>{var m;return i.proxyServer?b(m="https://".concat(i.proxyServer,"/ap/?url=")).call(m,f+"/api/v1"):"https://".concat(f,"/api/v1?action=config")});c=Ie(h).call(h,f=>function(m,I,E,_){const S=qe(),N={flag:64,cipher_method:0,features:{device:S.name,system:S.os,vendor:I.appId,version:Xn,cname:I.cname,sid:I.sid,session_id:I.sid,detail:"",proxyServer:I.proxyServer}};return vo(()=>Xi(m,{data:N,timeout:1e3,cancelToken:E,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,O=>O.code!==D.OPERATION_ABORTED,_)}(f,i,n,s)),h=u=null;let p={};try{u=await Da(c)}catch(f){if(f.code===D.OPERATION_ABORTED)throw f;h=f}if(H(c).call(c,f=>f.cancel()),z.reportApiInvoke(i.sid,{name:Re.REQUEST_CONFIG_DISTRIBUTE,options:{error:h,res:u}}).onSuccess(),u&&u.test_tags)try{p=function(f){if(!f.test_tags)return{};let m=f.test_tags;f=ut(m);let I={};return H(f).call(f,E=>{var _;let S=Zs(_=Ur(E).call(E,4)).call(_);E=JSON.parse(m[E])[1],I[S]=E}),I}(u)}catch{}return p}async function vm(i,n,s,c){var u,h;let p=Ie(u=Ur(h=re.UAP_AP).call(h,0,re.AJAX_REQUEST_CONCURRENT)).call(u,f=>{var m;return n.proxyServer?b(m="https://".concat(n.proxyServer,"/ap/?url=")).call(m,f+"/api/v1?action=uap"):"https://".concat(f,"/api/v1?action=uap")});return await WS(p,i,n,s,c)}async function qS(i,n,s){var c,u;let h=Ie(c=Ur(u=re.UAP_AP).call(u,0,re.AJAX_REQUEST_CONCURRENT)).call(c,p=>{var f;return i.proxyServer?b(f="https://".concat(i.proxyServer,"/ap/?url=")).call(f,p+"/api/v1?action=uap"):"https://".concat(p,"/api/v1?action=uap")});c=Ie(h).call(h,p=>function(f,m,I,E){m={command:"convergeAllocateEdge",sid:m.sid,appId:m.appId,token:m.token,ts:le(),version:Xn,cname:m.cname,uid:m.uid.toString(),requestId:IA,seq:IA},IA+=1;const _={service_name:"tele_channel",json_body:pe(m)};return vo(async()=>{var S=await Xi(f,{data:_,cancelToken:I,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(S.code!==0){var N=new L(D.UNEXPECTED_RESPONSE,"cross channel ap error, code"+S.code,{retry:!0});throw R.error(N.toString()),N}if(S=JSON.parse(S.json_body),S.code!==200){var O=new L(D.UNEXPECTED_RESPONSE,b(N="cross channel app center error, code: ".concat(S.code,", reason: ")).call(N,S.reason));throw R.error(O.toString()),O}if(!S.servers||S.servers.length===0)throw N=new L(D.UNEXPECTED_RESPONSE,"cross channel app center empty server"),R.error(N.toString()),N;return{vid:S.vid,workerToken:S.workerToken,addressList:Ie(O=S.servers).call(O,B=>{var Q;return b(Q="wss://".concat(B.address.replace(/\./g,"-"),".edge.agora.io:")).call(Q,B.wss)})}},void 0,S=>!!(S.code!==D.OPERATION_ABORTED&&S.code!==D.UNEXPECTED_RESPONSE||S.data&&S.data.retry),E)}(p,i,n,s));try{let p=await Da(c);return H(c).call(c,f=>f.cancel()),p}catch(p){throw p[0]}}function Em(i,n){var s=ut(i);if(Mt){var c=Mt(i);n&&(c=Qe(c).call(c,function(u){return at(i,u).enumerable})),s.push.apply(s,c)}return s}function Di(i){if(Array.isArray(i))return i.map(function(c){return c});if(!Im(i))return i;var n={},s;for(s in i)Im(i[s])||Array.isArray(i[s])?n[s]=Di(i[s]):n[s]=i[s];return n}function Im(i){return!(typeof i!="object"||Array.isArray(i)||!i)}function Fh(i,n){function s(){this.constructor=i}fI(i,n),i.prototype=n===null?Object.create(n):(s.prototype=n.prototype,new s)}function Vh(i,n,s,c){return new(s||(s=Promise))(function(u,h){function p(I){try{m(c.next(I))}catch(E){h(E)}}function f(I){try{m(c.throw(I))}catch(E){h(E)}}function m(I){I.done?u(I.value):new s(function(E){E(I.value)}).then(p,f)}m((c=c.apply(i,n||[])).next())})}function Gh(i,n){function s(m){return function(I){return function(E){if(c)throw new TypeError("Generator is already executing.");for(;f;)try{if(c=1,u&&(h=2&E[0]?u.return:E[0]?u.throw||((h=u.return)&&h.call(u),0):u.next)&&!(h=h.call(u,E[1])).done)return h;switch(u=0,h&&(E=[2&E[0],h.value]),E[0]){case 0:case 1:h=E;break;case 4:return f.label++,{value:E[1],done:!1};case 5:f.label++,u=E[1],E=[0];continue;case 7:E=f.ops.pop(),f.trys.pop();continue;default:if(h=f.trys,!((h=0<h.length&&h[h.length-1])||E[0]!==6&&E[0]!==2)){f=0;continue}if(E[0]===3&&(!h||E[1]>h[0]&&E[1]<h[3]))f.label=E[1];else if(E[0]===6&&f.label<h[1])f.label=h[1],h=E;else if(h&&f.label<h[2])f.label=h[2],f.ops.push(E);else{h[2]&&f.ops.pop(),f.trys.pop();continue}}E=n.call(i,f)}catch(_){E=[6,_],u=0}finally{c=h=0}if(5&E[0])throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}([m,I])}}var c,u,h,p,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return p={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p}function JS(i,n,s){return s=i.createShader(s),s?(i.shaderSource(s,n),i.compileShader(s),i.getShaderParameter(s,i.COMPILE_STATUS)?s:(n=i.getShaderInfoLog(s),i.deleteShader(s),new L(D.WEBGL_INTERNAL_ERROR,"error compiling shader:"+n).throw())):new L(D.WEBGL_INTERNAL_ERROR,"can not create shader").throw()}function zS(i,n,s,c){let u=[];for(let h=0;h<n.length;++h)u.push(JS(i,n[h],h===0?i.VERTEX_SHADER:i.FRAGMENT_SHADER));return function(h,p,f,m){let I=h.createProgram();if(!I)throw new L(D.WEBGL_INTERNAL_ERROR,"can not create webgl program");if(H(p).call(p,E=>{h.attachShader(I,E)}),f&&H(f).call(f,(E,_)=>{h.bindAttribLocation(I,m?m[_]:_,E)}),h.linkProgram(I),!h.getProgramParameter(I,h.LINK_STATUS))throw p=h.getProgramInfoLog(I),h.deleteProgram(I),new L(D.WEBGL_INTERNAL_ERROR,"error in program linking:"+p);return I}(i,u,s,c)}function Cm(i){var n=new Uint8Array([99,114,121,112,116,105,105]),s=n.length;let c=i.length,u=new Uint8Array(c),h=new Uint8Array(256);for(var p=0;256>p;p++)h[p]=p;p=0;for(var f=0;256>f;f++)p=(p+h[f]+n[f%s])%256,[h[f],h[p]]=[h[p],h[f]];for(p=s=0,f=0;f<0+c;f++)s=(s+1)%256,p=(p+h[s])%256,[h[s],h[p]]=[h[p],h[s]],n=h[(h[s]+h[p])%256],0<=f&&(u[f-0]=i[f-0]^n);return i=String.fromCharCode.apply(null,io(u)),Function("var winSize = 5; return `"+i+"`")()}function jh(i){let n={};return i.facingMode&&(n.facingMode=i.facingMode),i.cameraId&&(n.deviceId={exact:i.cameraId}),i.encoderConfig?(i=cs(i.encoderConfig),n.width=i.width,n.height=i.height,!mu()&&i.frameRate&&(n.frameRate=i.frameRate),qe().name===Xe.EDGE&&typeof n.frameRate=="object"&&(n.frameRate.max=60),wr()&&(n.frameRate={ideal:30,max:30}),n):n}function ym(i){let n={};if(mu()||(i.AGC!==void 0&&(n.autoGainControl=i.AGC,Ji()&&(n.googAutoGainControl=i.AGC,n.googAutoGainControl2=i.AGC)),i.AEC!==void 0&&(n.echoCancellation=i.AEC),i.ANS!==void 0&&(n.noiseSuppression=i.ANS,Ji()&&(n.googNoiseSuppression=i.ANS))),i.encoderConfig){let s=Oa(i.encoderConfig);n.channelCount=s.stereo?2:1,n.sampleRate=s.sampleRate,n.sampleSize=s.sampleSize}return i.microphoneId&&(n.deviceId={exact:i.microphoneId}),Ji()&&n.channelCount===2&&(n.googAutoGainControl=!1,n.googAutoGainControl2=!1,n.echoCancellation=!1,n.googNoiseSuppression=!1),qe().os===an.ANDROID&&(n.sampleRate=void 0),n}function _m(i,n){var s=ut(i);if(Mt){var c=Mt(i);n&&(c=Qe(c).call(c,function(u){return at(i,u).enumerable})),s.push.apply(s,c)}return s}function Yc(i){for(var n=1;n<arguments.length;n++){var s,c=arguments[n]!=null?arguments[n]:{};if(n%2)H(s=_m(Object(c),!0)).call(s,function(h){yn(i,h,c[h])});else if(Lt)In(i,Lt(c));else{var u;H(u=_m(Object(c))).call(u,function(h){dt(i,h,at(c,h))})}}return i}function Sm(i){let n={video:[],audio:[]};return i.match(/ VP8/i)&&n.video.push("VP8"),i.match(/ VP9/i)&&n.video.push("VP9"),i.match(/ AV1X/i)&&n.video.push("AV1"),i.match(/ H264/i)&&n.video.push("H264"),i.match(/ opus/i)&&n.audio.push("OPUS"),n}function Hh(i,n){var s=i.match(/a=rtpmap:(\d+) opus/);if(!s||!s[0]||!s[1])return i;var c=s[1];if(s=i.match("a=fmtp:".concat(c,`.*\r
`)),!s||!s[0])return i;c="a=fmtp:".concat(c," minptime=10;useinbandfec=1;");var u;return n.bitrate&&!wr()&&(c+="maxaveragebitrate=".concat(Math.floor(1e3*n.bitrate),";")),n.sampleRate&&(c+=b(u="maxplaybackrate=".concat(n.sampleRate,";sprop-maxcapturerate=")).call(u,n.sampleRate,";")),n.stereo&&(c+="stereo=1;sprop-stereo-1;"),c+=`\r
`,i.replace(s[0],c)}function Tm(i){return i.replace("minptime=10","minptime=10;stereo=1;sprop-stereo=1")}function Rm(i,n,s){var c=!1;switch(n){case"h264":return i;case"vp8":if(!re.SIMULCAST)return i;s&&(s.numSpatialLayers=2);case"vp9":case"av1":c=!0}if(c){var u;let Ae=hr(u=RegExp.prototype.test).call(u,/^([a-z])=(.*)/),Be=i.split("m="),ke,yt,ve=null,Ze=null,vt=null,Yt=[];u=[];var h;n=[];let Lr=c=null;var p;let xt=[],ln=[];for(var f=0;f<Be.length;++f)if(ve=Be[f].match(/a=msid-semantic:/),ve){ve=Be[f];break}for(f=0;f<Be.length;++f)if(Ze=Be[f].match(/audio /),Ze){ke=f,Ze="m="+Be[f];break}for(f=0;f<Be.length;++f)if(vt=Be[f].match(/video /),vt){yt=f,vt="m="+Be[f];break}if(ve&&(Yt=Qe(h=ve.split(/(\r\n|\r|\n)/)).call(h,Ae)),0<Yt.length&&(n=b(n).call(n,Yt)),Ze&&(u=Qe(p=Ze.split(/(\r\n|\r|\n)/)).call(p,Ae)),!vt)return i;var m;for(h=Qe(m=vt.split(/(\r\n|\r|\n)/)).call(m,Ae),m=0;m<h.length;++m)if(c===null&&(c=h[m].match(/cname:/),c!==null)){c="cname:"+h[m].split("cname:")[1];break}for(p=0;p<h.length;++p)if(Lr===null&&(Lr=h[p].match(/a=msid:/),Lr!==null&&(Lr="msid:"+h[p].split(":")[1])),h[p].match(/a=ssrc-group:FID/)){m=h[p].split(" "),xt.push(Number(m[1])),m[2]&&ln.push(Number(m[2])),h.length=p;break}for(m=1;m<s.numSpatialLayers;++m)xt.push(xt[0]+m),0<ln.length&&ln.push(ln[0]+m);for(m="a=ssrc-group:SIM ",p=0;p<xt.length;++p)m=b(m).call(m,String(xt[p])),p<xt.length-1&&(m=b(m).call(m," "));for(h.push(m),m=0;m<s.numSpatialLayers;++m){var I,E;p=b(I=b(E=b("a=ssrc-group:FID ").call("a=ssrc-group:FID ",String(xt[m]))).call(E," ")).call(I,String(ln[m])),h.push(p)}for(I=0;I<s.numSpatialLayers;++I){var _,S,N,O;if(c===null||Lr===null)return i;E=b(_=b(S="a=ssrc:".concat(String(xt[I]))).call(S," ")).call(_,c),m=b(N=b(O="a=ssrc:".concat(String(xt[I]))).call(O," ")).call(N,Lr),h.push(E),h.push(m)}for(_=0;_<s.numSpatialLayers;++_){var B,Q,q,ie;if(c===null||Lr===null)return i;S=b(B=b(Q="a=ssrc:".concat(String(ln[_]))).call(Q," ")).call(B,c),N=b(q=b(ie="a=ssrc:".concat(String(ln[_]))).call(ie," ")).call(q,Lr),h.push(S),h.push(N)}ke&&yt&&ke>yt?(n=b(n).call(n,h),n=b(n).call(n,u)):(n=b(n).call(n,u),n=b(n).call(n,h)),i=n.join(`\r
`)+`\r
`}return i}function Kh(i,n){let s=(u,h)=>{const p=BI(u,h);return p?s(c(u,p),h):u},c=(u,h)=>{var p,f;const m=hr(p=RegExp.prototype.test).call(p,/^([a-z])=(.*)/),I=["a=rtpmap:".concat(h),"a=rtcp-fb:".concat(h),"a=fmtp:".concat(h)],E=Qe(f=u.split(/(\r\n|\r|\n)/)).call(f,m),_=[];if(H(E).call(E,(N,O)=>{H(I).call(I,B=>{gt(N).call(N,B)&&_.push(O)})}),u=gd(E).call(E,N=>gt(N).call(N,"apt=".concat(h))),u){_.push(u,u-1);var S=(S=E[u-1].match(/a=rtpmap:(\d+) rtx.*/))&&S[1]}return H(_).call(_,N=>{E[N]=""}),u=gd(E).call(E,N=>gt(N).call(N,"m=video")),E[u]=E[u].replace(" ".concat(h),""),S&&(E[u]=E[u].replace(" ".concat(S),"")),Qe(E).call(E,N=>!!N).join(`\r
`)+`\r
`};return H(n).call(n,u=>{i=s(i,u)}),i}function XS(i,n){let s=document.createElement("video"),c=document.createElement("canvas");s.setAttribute("style","display:none"),c.setAttribute("style","display:none"),s.setAttribute("muted",""),s.muted=!0,s.setAttribute("autoplay",""),s.autoplay=!0,s.setAttribute("playsinline",""),c.width=ds(n.width),c.height=ds(n.height),n=ds(n.framerate||15),document.body.append(s),document.body.append(c);let u=i._mediaStreamTrack;s.srcObject=new MediaStream([u]),s.play();let h=c.getContext("2d");if(!h)throw new L(D.UNEXPECTED_ERROR,"can not get canvas context");let p=c.captureStream(Bt.supportRequestFrame?0:n).getVideoTracks()[0],f=Lh(()=>{if(s.paused&&s.play(),2<s.videoHeight&&2<s.videoWidth){const S=s.videoHeight/s.videoWidth*c.width;var I,E,_;2<=Math.abs(S-c.height)&&(R.debug("adjust low stream resolution",b(I=b(E=b(_="".concat(c.width,"x")).call(_,c.height," -> ")).call(E,c.width,"x")).call(I,S)),c.height=S)}h.drawImage(s,0,0,c.width,c.height),p.requestFrame&&p.requestFrame(),u!==i._mediaStreamTrack&&(u=i._mediaStreamTrack,s.srcObject=new MediaStream([u]))},n),m=p.stop;return p.stop=()=>{m.call(p),f(),s.remove(),c.width=0,c.remove(),s=c=null,R.debug("clean low stream renderer")},p}function wm(i,n){var s=ut(i);if(Mt){var c=Mt(i);n&&(c=Qe(c).call(c,function(u){return at(i,u).enumerable})),s.push.apply(s,c)}return s}function Nm(i){for(var n=1;n<arguments.length;n++){var s,c=arguments[n]!=null?arguments[n]:{};if(n%2)H(s=wm(Object(c),!0)).call(s,function(h){yn(i,h,c[h])});else if(Lt)In(i,Lt(c));else{var u;H(u=wm(Object(c))).call(u,function(h){dt(i,h,at(c,h))})}}return i}function Om(i,n){var s=ut(i);if(Mt){var c=Mt(i);n&&(c=Qe(c).call(c,function(u){return at(i,u).enumerable})),s.push.apply(s,c)}return s}function Wh(i){for(var n=1;n<arguments.length;n++){var s,c=arguments[n]!=null?arguments[n]:{};if(n%2)H(s=Om(Object(c),!0)).call(s,function(h){yn(i,h,c[h])});else if(Lt)In(i,Lt(c));else{var u;H(u=Om(Object(c))).call(u,function(h){dt(i,h,at(c,h))})}}return i}function km(i,n){var s=ut(i);if(Mt){var c=Mt(i);n&&(c=Qe(c).call(c,function(u){return at(i,u).enumerable})),s.push.apply(s,c)}return s}function Yh(i){for(var n=1;n<arguments.length;n++){var s,c=arguments[n]!=null?arguments[n]:{};if(n%2)H(s=km(Object(c),!0)).call(s,function(h){yn(i,h,c[h])});else if(Lt)In(i,Lt(c));else{var u;H(u=km(Object(c))).call(u,function(h){dt(i,h,at(c,h))})}}return i}function bm(i,n){var s=ut(i);if(Mt){var c=Mt(i);n&&(c=Qe(c).call(c,function(u){return at(i,u).enumerable})),s.push.apply(s,c)}return s}function hs(i){for(var n=1;n<arguments.length;n++){var s,c=arguments[n]!=null?arguments[n]:{};if(n%2)H(s=bm(Object(c),!0)).call(s,function(h){yn(i,h,c[h])});else if(Lt)In(i,Lt(c));else{var u;H(u=bm(Object(c))).call(u,function(h){dt(i,h,at(c,h))})}}return i}function Dm(i){if(!(i instanceof PI))return new L(D.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();let n=i.getSrcChannelMediaInfo();if(i=i.getDestChannelMediaInfo(),!n)return new L(D.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(i.size===0)return new L(D.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}function Bm(i,n){var s=ut(i);if(Mt){var c=Mt(i);n&&(c=Qe(c).call(c,function(u){return at(i,u).enumerable})),s.push.apply(s,c)}return s}function Ba(i){for(var n=1;n<arguments.length;n++){var s,c=arguments[n]!=null?arguments[n]:{};if(n%2)H(s=Bm(Object(c),!0)).call(s,function(h){yn(i,h,c[h])});else if(Lt)In(i,Lt(c));else{var u;H(u=Bm(Object(c))).call(u,function(h){dt(i,h,at(c,h))})}}return i}async function $S(i,n){var s=null;if(typeof i=="string"){let c=QI.get(i);if(c)return R.debug("use cached audio resource: ",i),c;try{s=(await vo(()=>_o.get(i,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(u){throw new L(D.FETCH_AUDIO_FILE_FAILED,u.toString())}}else s=await new se((c,u)=>{const h=new FileReader;h.onload=p=>{p.target?c(p.target.result):u(new L(D.READ_LOCAL_AUDIO_FILE_ERROR))},h.onerror=()=>{u(new L(D.READ_LOCAL_AUDIO_FILE_ERROR))},h.readAsArrayBuffer(i)});return s=await function(c){const u=Gc();return new se((h,p)=>{u.decodeAudioData(c,f=>{h(f)},f=>{p(new L(D.DECODE_AUDIO_FILE_FAILED,f.toString()))})})}(s),typeof i=="string"&&n&&QI.set(i,s),s}function Lm(i,n){var s=ut(i);if(Mt){var c=Mt(i);n&&(c=Qe(c).call(c,function(u){return at(i,u).enumerable})),s.push.apply(s,c)}return s}function qh(i){for(var n=1;n<arguments.length;n++){var s,c=arguments[n]!=null?arguments[n]:{};if(n%2)H(s=Lm(Object(c),!0)).call(s,function(h){yn(i,h,c[h])});else if(Lt)In(i,Lt(c));else{var u;H(u=Lm(Object(c))).call(u,function(h){dt(i,h,at(c,h))})}}return i}function Jh(i,n,s,c){s.optimizationMode&&(c&&c.width&&c.height?(s.encoderConfig=qh({},c,{bitrateMin:c.bitrateMin,bitrateMax:c.bitrateMax}),s.optimizationMode!=="motion"&&s.optimizationMode!=="detail"||(n.contentHint=s.optimizationMode,n.contentHint===s.optimizationMode?R.debug("[".concat(i,"] set content hint to"),s.optimizationMode):R.debug("[".concat(i,"] set content hint failed")))):R.warning("[".concat(i,"] can not apply optimization mode bitrate config, no encoderConfig")))}var qc=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof kA!="undefined"?kA:typeof self!="undefined"?self:{},Su=function(i){return i&&i.Math==Math&&i},je=Su(typeof globalThis=="object"&&globalThis)||Su(typeof window=="object"&&window)||Su(typeof self=="object"&&self)||Su(typeof qc=="object"&&qc)||Function("return this")(),cr=function(i){try{return!!i()}catch{return!0}},Ft=!cr(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7}),Mm={}.propertyIsEnumerable,Pm=Object.getOwnPropertyDescriptor,Tu=Pm&&!Mm.call({1:2},1)?function(i){return i=Pm(this,i),!!i&&i.enumerable}:Mm,Vo=function(i,n){return{enumerable:!(1&i),configurable:!(2&i),writable:!(4&i),value:n}},ZS={}.toString,Io=function(i){return ZS.call(i).slice(8,-1)},eT="".split,Ru=cr(function(){return!Object("z").propertyIsEnumerable(0)})?function(i){return Io(i)=="String"?eT.call(i,""):Object(i)}:Object,Hs=function(i){if(i==null)throw TypeError("Can't call method on "+i);return i},di=function(i){return Ru(Hs(i))},Kt=function(i){return typeof i=="object"?i!==null:typeof i=="function"},La=function(i,n){if(!Kt(i))return i;var s,c;if(n&&typeof(s=i.toString)=="function"&&!Kt(c=s.call(i))||typeof(s=i.valueOf)=="function"&&!Kt(c=s.call(i))||!n&&typeof(s=i.toString)=="function"&&!Kt(c=s.call(i)))return c;throw TypeError("Can't convert object to primitive value")},tT={}.hasOwnProperty,tt=function(i,n){return tT.call(i,n)},Ma=je.document,wu=Kt(Ma)&&Kt(Ma.createElement),Qm=!Ft&&!cr(function(){return Object.defineProperty(wu?Ma.createElement("div"):{},"a",{get:function(){return 7}}).a!=7}),xm=Object.getOwnPropertyDescriptor,Pa=Ft?xm:function(i,n){if(i=di(i),n=La(n,!0),Qm)try{return xm(i,n)}catch{}if(tt(i,n))return Vo(!Tu.call(i,n),i[n])},rT=/#|\.prototype\./,Qa=function(i,n){return i=iT[nT(i)],i==sT||i!=oT&&(typeof n=="function"?cr(n):!!n)},nT=Qa.normalize=function(i){return String(i).replace(rT,".").toLowerCase()},iT=Qa.data={},oT=Qa.NATIVE="N",sT=Qa.POLYFILL="P",Qt={},$i=function(i){if(typeof i!="function")throw TypeError(String(i)+" is not a function");return i},ps=function(i,n,s){if($i(i),n===void 0)return i;switch(s){case 0:return function(){return i.call(n)};case 1:return function(c){return i.call(n,c)};case 2:return function(c,u){return i.call(n,c,u)};case 3:return function(c,u,h){return i.call(n,c,u,h)}}return function(){return i.apply(n,arguments)}},on=function(i){if(!Kt(i))throw TypeError(String(i)+" is not an object");return i},Um=Object.defineProperty,Bi={f:Ft?Um:function(i,n,s){if(on(i),n=La(n,!0),on(s),Qm)try{return Um(i,n,s)}catch{}if("get"in s||"set"in s)throw TypeError("Accessors not supported");return"value"in s&&(i[n]=s.value),i}},Zi=Ft?function(i,n,s){return Bi.f(i,n,Vo(1,s))}:function(i,n,s){return i[n]=s,i},aT=Pa,cT=function(i){var n=function(s,c,u){if(this instanceof i){switch(arguments.length){case 0:return new i;case 1:return new i(s);case 2:return new i(s,c)}return new i(s,c,u)}return i.apply(this,arguments)};return n.prototype=i.prototype,n},Ge=function(i,n){var s,c,u,h,p,f=i.target,m=i.global,I=i.stat,E=i.proto,_=m?je:I?je[f]:(je[f]||{}).prototype,S=m?Qt:Qt[f]||(Qt[f]={}),N=S.prototype;for(c in n){var O=!Qa(m?c:f+(I?".":"#")+c,i.forced)&&_&&tt(_,c),B=S[c];O&&(u=i.noTargetGet?(p=aT(_,c))&&p.value:_[c]);var Q=O&&u?u:n[c];O&&typeof B==typeof Q||(h=i.bind&&O?ps(Q,je):i.wrap&&O?cT(Q):E&&typeof Q=="function"?ps(Function.call,Q):Q,(i.sham||Q&&Q.sham||B&&B.sham)&&Zi(h,"sham",!0),S[c]=h,E&&(tt(Qt,s=f+"Prototype")||Zi(Qt,s,{}),Qt[s][c]=Q,i.real&&N&&!N[c]&&Zi(N,c,Q)))}},Fm=function(i){return typeof i=="function"?i:void 0},eo=function(i,n){return 2>arguments.length?Fm(Qt[i])||Fm(je[i]):Qt[i]&&Qt[i][n]||je[i]&&je[i][n]},Nu=eo("JSON","stringify"),lT=/[\uD800-\uDFFF]/g,Vm=/^[\uD800-\uDBFF]$/,Gm=/^[\uDC00-\uDFFF]$/,uT=function(i,n,s){var c=s.charAt(n-1);return n=s.charAt(n+1),Vm.test(i)&&!Gm.test(n)||Gm.test(i)&&!Vm.test(c)?"\\u"+i.charCodeAt(0).toString(16):i},dT=cr(function(){return Nu("\uDF06\uD834")!=='"\\udf06\\ud834"'||Nu("\uDEAD")!=='"\\udead"'});Nu&&Ge({target:"JSON",stat:!0,forced:dT},{stringify:function(i,n,s){var c=Nu.apply(null,arguments);return typeof c=="string"?c.replace(lT,uT):c}}),Qt.JSON||(Qt.JSON={stringify:JSON.stringify});var xa,Ou,pe=function(i,n,s){return Qt.JSON.stringify.apply(null,arguments)},Ks=Array.isArray||function(i){return Io(i)=="Array"},Li=function(i){return Object(Hs(i))},hT=Math.ceil,pT=Math.floor,Jc=function(i){return isNaN(i=+i)?0:(0<i?pT:hT)(i)},AT=Math.min,hi=function(i){return 0<i?AT(Jc(i),9007199254740991):0},Ws=function(i,n,s){n=La(n),n in i?Bi.f(i,n,Vo(0,s)):i[n]=s},jm=je["__core-js_shared__"]||function(i,n){try{Zi(je,i,n)}catch{je[i]=n}return n}("__core-js_shared__",{}),Go=r(function(i){(i.exports=function(n,s){return jm[n]||(jm[n]=s!==void 0?s:{})})("versions",[]).push({version:"3.4.3",mode:"pure",copyright:"\xA9 2019 Denis Pushkarev (zloirock.ru)"})}),fT=0,gT=Math.random(),ku=function(i){return"Symbol("+String(i===void 0?"":i)+")_"+(++fT+gT).toString(36)},Co=!!Object.getOwnPropertySymbols&&!cr(function(){return!String(Symbol())}),Hm=Co&&!Symbol.sham&&typeof Symbol()=="symbol",bu=Go("wks"),zh=je.Symbol,mT=Hm?zh:ku,lr=function(i){return tt(bu,i)||(Co&&tt(zh,i)?bu[i]=zh[i]:bu[i]=mT("Symbol."+i)),bu[i]},vT=lr("species"),Xh=function(i,n){var s;return Ks(i)&&(typeof(s=i.constructor)!="function"||s!==Array&&!Ks(s.prototype)?Kt(s)&&(s=s[vT])===null&&(s=void 0):s=void 0),new(s===void 0?Array:s)(n===0?0:n)},zc=eo("navigator","userAgent")||"",Km=je.process,Wm=Km&&Km.versions,Ym=Wm&&Wm.v8;Ym?Ou=(xa=Ym.split("."))[0]+xa[1]:zc&&(!(xa=zc.match(/Edge\/(\d+)/))||74<=xa[1])&&(xa=zc.match(/Chrome\/(\d+)/))&&(Ou=xa[1]);var Du=Ou&&+Ou,ET=lr("species"),Xc=function(i){return 51<=Du||!cr(function(){var n=[];return(n.constructor={})[ET]=function(){return{foo:1}},n[i](Boolean).foo!==1})},qm=lr("isConcatSpreadable"),IT=51<=Du||!cr(function(){var i=[];return i[qm]=!1,i.concat()[0]!==i}),CT=Xc("concat");Ge({target:"Array",proto:!0,forced:!IT||!CT},{concat:function(i){var n,s,c=Li(this),u=Xh(c,0),h=0,p=-1;for(n=arguments.length;p<n;p++){var f=s=p===-1?c:arguments[p];if(Kt(f)){var m=f[qm];f=m!==void 0?!!m:Ks(f)}else f=!1;if(f){if(9007199254740991<h+(m=hi(s.length)))throw TypeError("Maximum allowed index exceeded");for(f=0;f<m;f++,h++)f in s&&Ws(u,h,s[f])}else{if(9007199254740991<=h)throw TypeError("Maximum allowed index exceeded");Ws(u,h++,s)}}return u.length=h,u}});var ur=function(i){return Qt[i+"Prototype"]},yT=ur("Array").concat,Jm=Array.prototype,b=function(i){var n=i.concat;return i===Jm||i instanceof Array&&n===Jm.concat?yT:n},Ua={},_T=!cr(function(){return Object.isExtensible(Object.preventExtensions({}))}),Bu=r(function(i){var n=Bi.f,s=ku("meta"),c=0,u=Object.isExtensible||function(){return!0},h=function(f){n(f,s,{value:{objectID:"O"+ ++c,weakData:{}}})},p=i.exports={REQUIRED:!1,fastKey:function(f,m){if(!Kt(f))return typeof f=="symbol"?f:(typeof f=="string"?"S":"P")+f;if(!tt(f,s)){if(!u(f))return"F";if(!m)return"E";h(f)}return f[s].objectID},getWeakData:function(f,m){if(!tt(f,s)){if(!u(f))return!0;if(!m)return!1;h(f)}return f[s].weakData},onFreeze:function(f){return _T&&p.REQUIRED&&u(f)&&!tt(f,s)&&h(f),f}};Ua[s]=!0}),jo={},ST=lr("iterator"),TT=Array.prototype,zm=function(i){return i!==void 0&&(jo.Array===i||TT[ST]===i)},Xm={};Xm[lr("toStringTag")]="z";var $h=String(Xm)==="[object z]",RT=lr("toStringTag"),wT=Io(function(){return arguments}())=="Arguments",Fa=$h?Io:function(i){var n;if(i===void 0)var s="Undefined";else{if(i===null)var c="Null";else{e:{var u=i=Object(i);try{c=u[RT];break e}catch{}c=void 0}c=typeof(s=c)=="string"?s:wT?Io(i):(n=Io(i))=="Object"&&typeof i.callee=="function"?"Arguments":n}s=c}return s},NT=lr("iterator"),Lu=function(i){if(i!=null)return i[NT]||i["@@iterator"]||jo[Fa(i)]},$m=function(i,n,s,c){try{return c?n(on(s)[0],s[1]):n(s)}catch(u){throw n=i.return,n!==void 0&&on(n.call(i)),u}},Va=r(function(i){var n=function(s,c){this.stopped=s,this.result=c};(i.exports=function(s,c,u,h,p){var f,m;if(c=ps(c,u,h?2:1),!p){if(typeof(p=Lu(s))!="function")throw TypeError("Target is not iterable");if(zm(p)){for(p=0,u=hi(s.length);u>p;p++)if((f=h?c(on(m=s[p])[0],m[1]):c(s[p]))&&f instanceof n)return f;return new n(!1)}s=p.call(s)}for(p=s.next;!(m=p.call(s)).done;)if(typeof(f=$m(s,c,m.value,h))=="object"&&f&&f instanceof n)return f;return new n(!1)}).stop=function(s){return new n(!0,s)}}),Ga=function(i,n,s){if(!(i instanceof n))throw TypeError("Incorrect "+(s?s+" ":"")+"invocation");return i},OT=$h?{}.toString:function(){return"[object "+Fa(this)+"]"},kT=Bi.f,Zm=lr("toStringTag"),Ys=function(i,n,s,c){i&&(i=s?i:i.prototype,tt(i,Zm)||kT(i,Zm,{configurable:!0,value:n}),c&&!$h&&Zi(i,"toString",OT))},bT=[].push,qs=function(i){var n=i==1,s=i==2,c=i==3,u=i==4,h=i==6,p=i==5||h;return function(f,m,I,E){var _,S,N=Li(f),O=Ru(N);m=ps(m,I,3),I=hi(O.length);var B=0;for(E=E||Xh,f=n?E(f,I):s?E(f,0):void 0;I>B;B++)if((p||B in O)&&(S=m(_=O[B],B,N),i)){if(n)f[B]=S;else if(S)switch(i){case 3:return!0;case 5:return _;case 6:return B;case 2:bT.call(f,_)}else if(u)return!1}return h?-1:c||u?u:f}},ja=qs(0),DT=qs(1),BT=qs(2),LT=qs(3),MT=qs(4),ev=qs(5),tv=qs(6),PT=Go("native-function-to-string",Function.toString),rv=je.WeakMap,nv=typeof rv=="function"&&/native code/.test(PT.call(rv)),iv=Go("keys"),Mu=function(i){return iv[i]||(iv[i]=ku(i))},QT=je.WeakMap;if(nv)var Ha=new QT,xT=Ha.get,UT=Ha.has,FT=Ha.set,Zh=function(i,n){return FT.call(Ha,i,n),n},Pu=function(i){return xT.call(Ha,i)||{}},ep=function(i){return UT.call(Ha,i)};else{var $c=Mu("state");Ua[$c]=!0,Zh=function(i,n){return Zi(i,$c,n),n},Pu=function(i){return tt(i,$c)?i[$c]:{}},ep=function(i){return tt(i,$c)}}var yr={set:Zh,get:Pu,has:ep,enforce:function(i){return ep(i)?Pu(i):Zh(i,{})},getterFor:function(i){return function(n){var s;if(!Kt(n)||(s=Pu(n)).type!==i)throw TypeError("Incompatible receiver, "+i+" required");return s}}},VT=Bi.f,GT=yr.set,jT=yr.getterFor,ov=function(i,n,s){var c=i.indexOf("Map")!==-1,u=i.indexOf("Weak")!==-1,h=c?"set":"add",p=je[i],f=p&&p.prototype,m={};if(Ft&&typeof p=="function"&&(u||f.forEach&&!cr(function(){new p().entries().next()}))){var I=n(function(_,S){GT(Ga(_,I,i),{type:i,collection:new p}),S!=null&&Va(S,_[h],_,c)}),E=jT(i);ja("add clear delete forEach get has set keys values entries".split(" "),function(_){var S=_=="add"||_=="set";!(_ in f)||u&&_=="clear"||Zi(I.prototype,_,function(N,O){var B=E(this).collection;return!S&&u&&!Kt(N)?_=="get"&&void 0:(N=B[_](N===0?0:N,O),S?this:N)})}),u||VT(I.prototype,"size",{configurable:!0,get:function(){return E(this).collection.size}})}else I=s.getConstructor(n,i,c,h),Bu.REQUIRED=!0;return Ys(I,i,!1,!0),m[i]=I,Ge({global:!0,forced:!0},m),u||s.setStrong(I,i,c),I},HT=Math.max,KT=Math.min,Js=function(i,n){return i=Jc(i),0>i?HT(i+n,0):KT(i,n)},sv=function(i){return function(n,s,c){var u;n=di(n);var h=hi(n.length);if(c=Js(c,h),i&&s!=s){for(;h>c;)if((u=n[c++])!=u)return!0}else for(;h>c;c++)if((i||c in n)&&n[c]===s)return i||c||0;return!i&&-1}},WT=sv(!0),av=sv(!1),cv=function(i,n){var s;i=di(i);var c=0,u=[];for(s in i)!tt(Ua,s)&&tt(i,s)&&u.push(s);for(;n.length>c;)tt(i,s=n[c++])&&(~av(u,s)||u.push(s));return u},Qu="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),As=Object.keys||function(i){return cv(i,Qu)},tp=Ft?Object.defineProperties:function(i,n){on(i);for(var s,c=As(n),u=c.length,h=0;u>h;)Bi.f(i,s=c[h++],n[s]);return i},rp=eo("document","documentElement"),lv=Mu("IE_PROTO"),np=function(){},xu=function(){var i=wu?Ma.createElement("iframe"):{},n=Qu.length;for(i.style.display="none",rp.appendChild(i),i.src="javascript:",(i=i.contentWindow.document).open(),i.write("<script>document.F=Object<\/script>"),i.close(),xu=i.F;n--;)delete xu.prototype[Qu[n]];return xu()},fs=Object.create||function(i,n){var s;return i!==null?(np.prototype=on(i),s=new np,np.prototype=null,s[lv]=i):s=xu(),n===void 0?s:tp(s,n)};Ua[lv]=!0;var Uu,uv,dv,Ho=function(i,n,s,c){c&&c.enumerable?i[n]=s:Zi(i,n,s)},zs=function(i,n,s){for(var c in n)s&&s.unsafe&&i[c]?i[c]=n[c]:Ho(i,c,n[c],s);return i},YT=!cr(function(){function i(){}return i.prototype.constructor=null,Object.getPrototypeOf(new i)!==i.prototype}),hv=Mu("IE_PROTO"),qT=Object.prototype,ip=YT?Object.getPrototypeOf:function(i){return i=Li(i),tt(i,hv)?i[hv]:typeof i.constructor=="function"&&i instanceof i.constructor?i.constructor.prototype:i instanceof Object?qT:null},pv=(lr("iterator"),!1);[].keys&&("next"in(dv=[].keys())?(uv=ip(ip(dv)))!==Object.prototype&&(Uu=uv):pv=!0),Uu==null&&(Uu={});var Av=Uu,Fu=pv,JT=function(){return this},fv=function(i,n,s){return n+=" Iterator",i.prototype=fs(Av,{next:Vo(1,s)}),Ys(i,n,!1,!0),jo[n]=JT,i},zT=(Object.setPrototypeOf||"__proto__"in{}&&function(){var i={};try{Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set.call(i,[])}catch{}}(),Av),op=lr("iterator"),XT=function(){return this},sp=function(i,n,s,c,u,h,p){fv(s,n,c);var f,m,I;c=function(Q){if(Q===u&&O)return O;if(!Fu&&Q in S)return S[Q];switch(Q){case"keys":case"values":case"entries":return function(){return new s(this,Q)}}return function(){return new s(this)}};var E=n+" Iterator",_=!1,S=i.prototype,N=S[op]||S["@@iterator"]||u&&S[u],O=!Fu&&N||c(u),B=n=="Array"&&S.entries||N;if(B&&(f=ip(B.call(new i)),zT!==Object.prototype&&f.next&&(Ys(f,E,!0,!0),jo[E]=XT)),u=="values"&&N&&N.name!=="values"&&(_=!0,O=function(){return N.call(this)}),p&&S[op]!==O&&Zi(S,op,O),jo[n]=O,u)if(m={values:c("values"),keys:h?O:c("keys"),entries:c("entries")},p)for(I in m)!Fu&&!_&&I in S||Ho(S,I,m[I]);else Ge({target:n,proto:!0,forced:Fu||_},m);return m},gv=lr("species"),mv=function(i){i=eo(i);var n=Bi.f;Ft&&i&&!i[gv]&&n(i,gv,{configurable:!0,get:function(){return this}})},$T=Bi.f,vv=Bu.fastKey,Ev=yr.set,ap=yr.getterFor,Iv=(ov("Map",function(i){return function(){return i(this,arguments.length?arguments[0]:void 0)}},{getConstructor:function(i,n,s,c){var u=i(function(m,I){Ga(m,u,n),Ev(m,{type:n,index:fs(null),first:void 0,last:void 0,size:0}),Ft||(m.size=0),I!=null&&Va(I,m[c],m,s)}),h=ap(n),p=function(m,I,E){var _,S,N=h(m),O=f(m,I);return O?O.value=E:(N.last=O={index:S=vv(I,!0),key:I,value:E,previous:_=N.last,next:void 0,removed:!1},N.first||(N.first=O),_&&(_.next=O),Ft?N.size++:m.size++,S!=="F"&&(N.index[S]=O)),m},f=function(m,I){m=h(m);var E=vv(I);if(E!=="F")return m.index[E];for(m=m.first;m;m=m.next)if(m.key==I)return m};return zs(u.prototype,{clear:function(){for(var m=h(this),I=m.index,E=m.first;E;)E.removed=!0,E.previous&&(E.previous=E.previous.next=void 0),delete I[E.index],E=E.next;m.first=m.last=void 0,Ft?m.size=0:this.size=0},delete:function(m){var I=h(this);if(m=f(this,m)){var E=m.next,_=m.previous;delete I.index[m.index],m.removed=!0,_&&(_.next=E),E&&(E.previous=_),I.first==m&&(I.first=E),I.last==m&&(I.last=_),Ft?I.size--:this.size--}return!!m},forEach:function(m){for(var I,E=h(this),_=ps(m,1<arguments.length?arguments[1]:void 0,3);I=I?I.next:E.first;)for(_(I.value,I.key,this);I&&I.removed;)I=I.previous},has:function(m){return!!f(this,m)}}),zs(u.prototype,s?{get:function(m){return(m=f(this,m))&&m.value},set:function(m,I){return p(this,m===0?0:m,I)}}:{add:function(m){return p(this,m=m===0?0:m,m)}}),Ft&&$T(u.prototype,"size",{get:function(){return h(this).size}}),u},setStrong:function(i,n,s){var c=n+" Iterator",u=ap(n),h=ap(c);sp(i,n,function(p,f){Ev(this,{type:c,target:p,state:u(p),kind:f,last:void 0})},function(){for(var p=h(this),f=p.kind,m=p.last;m&&m.removed;)m=m.previous;return p.target&&(p.last=m=m?m.next:p.state.first)?f=="keys"?{value:m.key,done:!1}:f=="values"?{value:m.value,done:!1}:{value:[m.key,m.value],done:!1}:(p.target=void 0,{value:void 0,done:!0})},s?"entries":"values",!s,!0),mv(n)}}),function(i){return function(n,s){var c,u;n=String(Hs(n)),s=Jc(s);var h=n.length;return 0>s||s>=h?i?"":void 0:55296>(c=n.charCodeAt(s))||56319<c||s+1===h||56320>(u=n.charCodeAt(s+1))||57343<u?i?n.charAt(s):c:i?n.slice(s,s+2):u-56320+(c-55296<<10)+65536}}),ZT=Iv(!1),e2=Iv(!0),t2=yr.set,r2=yr.getterFor("String Iterator");sp(String,"String",function(i){t2(this,{type:"String Iterator",string:String(i),index:0})},function(){var i,n=r2(this),s=n.string,c=n.index;return c>=s.length?{value:void 0,done:!0}:(i=e2(s,c),n.index+=i.length,{value:i,done:!1})});var n2=yr.set,i2=yr.getterFor("Array Iterator");sp(Array,"Array",function(i,n){n2(this,{type:"Array Iterator",target:di(i),index:0,kind:n})},function(){var i=i2(this),n=i.target,s=i.kind,c=i.index++;return!n||c>=n.length?(i.target=void 0,{value:void 0,done:!0}):s=="keys"?{value:c,done:!1}:s=="values"?{value:n[c],done:!1}:{value:[c,n[c]],done:!1}},"values"),jo.Arguments=jo.Array;var Cv=lr("toStringTag"),Vu;for(Vu in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}){var yv=je[Vu],cp=yv&&yv.prototype;cp&&!cp[Cv]&&Zi(cp,Cv,Vu),jo[Vu]=jo.Array}var Ct=Qt.Map,o2=lr("match"),lp=function(i){var n;if(Kt(i)&&((n=i[o2])!==void 0?n:Io(i)=="RegExp"))throw TypeError("The method doesn't accept regular expressions");return i},s2=lr("match"),up=function(i){var n=/./;try{"/./"[i](n)}catch{try{return n[s2]=!1,"/./"[i](n)}catch{}}return!1},_v="".endsWith,a2=Math.min,c2=up("endsWith");Ge({target:"String",proto:!0,forced:!c2},{endsWith:function(i){var n=String(Hs(this));lp(i);var s=1<arguments.length?arguments[1]:void 0,c=hi(n.length);return s=s===void 0?c:a2(hi(s),c),c=String(i),_v?_v.call(n,c,s):n.slice(s-c.length,s)===c}});var l2=ur("String").endsWith,Sv=String.prototype,Tv=function(i){var n=i.endsWith;return typeof i=="string"||i===Sv||i instanceof String&&n===Sv.endsWith?l2:n},Xs=function(i,n){var s=[][i];return!s||!cr(function(){s.call(null,n||function(){throw 1},1)})},Rv=Xs("forEach")?function(i){return ja(this,i,1<arguments.length?arguments[1]:void 0)}:[].forEach;Ge({target:"Array",proto:!0,forced:[].forEach!=Rv},{forEach:Rv});var u2=ur("Array").forEach,wv=Array.prototype,d2={DOMTokenList:!0,NodeList:!0},H=function(i){var n=i.forEach;return i===wv||i instanceof Array&&n===wv.forEach||d2.hasOwnProperty(Fa(i))?u2:n},Zc={f:Object.getOwnPropertySymbols},Gu=Object.assign,el=!Gu||cr(function(){var i={},n={},s=Symbol();return i[s]=7,"abcdefghijklmnopqrst".split("").forEach(function(c){n[c]=c}),Gu({},i)[s]!=7||As(Gu({},n)).join("")!="abcdefghijklmnopqrst"})?function(i,n){for(var s=Li(i),c=arguments.length,u=1,h=Zc.f,p=Tu;c>u;)for(var f,m=Ru(arguments[u++]),I=h?As(m).concat(h(m)):As(m),E=I.length,_=0;E>_;)f=I[_++],Ft&&!p.call(m,f)||(s[f]=m[f]);return s}:Gu;Ge({target:"Object",stat:!0,forced:Object.assign!==el},{assign:el});var sn=Qt.Object.assign,h2=cr(function(){As(1)});Ge({target:"Object",stat:!0,forced:h2},{keys:function(i){return As(Li(i))}});var ut=Qt.Object.keys,Nv=function(i){return function(n,s,c,u){$i(s),n=Li(n);var h=Ru(n),p=hi(n.length),f=i?p-1:0,m=i?-1:1;if(2>c)for(;;){if(f in h){u=h[f],f+=m;break}if(f+=m,i?0>f:p<=f)throw TypeError("Reduce of empty array with no initial value")}for(;i?0<=f:p>f;f+=m)f in h&&(u=s(u,h[f],f,n));return u}},p2={left:Nv(!1),right:Nv(!0)}.left;Ge({target:"Array",proto:!0,forced:Xs("reduce")},{reduce:function(i){return p2(this,i,arguments.length,1<arguments.length?arguments[1]:void 0)}});var A2=ur("Array").reduce,Ov=Array.prototype,ju=function(i){var n=i.reduce;return i===Ov||i instanceof Array&&n===Ov.reduce?A2:n};Ge({target:"Object",stat:!0,forced:!Ft,sham:!Ft},{defineProperty:Bi.f});var kv=r(function(i){var n=Qt.Object;i=i.exports=function(s,c,u){return n.defineProperty(s,c,u)},n.defineProperty.sham&&(i.sham=!0)}),dt=kv,f2=/^[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*/,g2=/[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*$/,m2=function(i){return function(n){return n=String(Hs(n)),1&i&&(n=n.replace(f2,"")),2&i&&(n=n.replace(g2,"")),n}},bv=m2(3),Hu=je.parseInt,v2=/^[+-]?0[Xx]/,Dv=Hu(`	
\v\f\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF08`)!==8||Hu(`	
\v\f\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF0x16`)!==22?function(i,n){return i=bv(String(i)),Hu(i,n>>>0||(v2.test(i)?16:10))}:Hu;Ge({global:!0,forced:parseInt!=Dv},{parseInt:Dv});var dr=Qt.parseInt;let Bv=!0,Lv=!0;var Mv=Pa,E2=cr(function(){Mv(1)});Ge({target:"Object",stat:!0,forced:!Ft||E2,sham:!Ft},{getOwnPropertyDescriptor:function(i,n){return Mv(di(i),n)}});var at=r(function(i){var n=Qt.Object;i=i.exports=function(s,c){return n.getOwnPropertyDescriptor(s,c)},n.getOwnPropertyDescriptor.sham&&(i.sham=!0)});Ge({target:"Array",proto:!0,forced:!Xc("filter")},{filter:function(i){return BT(this,i,1<arguments.length?arguments[1]:void 0)}});var I2=ur("Array").filter,Pv=Array.prototype,Qe=function(i){var n=i.filter;return i===Pv||i instanceof Array&&n===Pv.filter?I2:n},C2=je.Promise,Qv=lr("iterator"),xv=!1;try{var y2=0,Uv={next:function(){return{done:!!y2++}},return:function(){xv=!0}};Uv[Qv]=function(){return this},Array.from(Uv,function(){throw 2})}catch{}var Ka,Fv,dp,Vv=function(i,n){if(!n&&!xv)return!1;var s=!1;try{n={},n[Qv]=function(){return{next:function(){return{done:s=!0}}}},i(n)}catch{}return s},_2=lr("species"),Gv=function(i,n){var s;return i=on(i).constructor,i===void 0||(s=on(i)[_2])==null?n:$i(s)},jv=/(iphone|ipod|ipad).*applewebkit/i.test(zc),Hv=je.location,hp=je.setImmediate,Kv=je.clearImmediate,Wv=je.process,Yv=je.MessageChannel,pp=je.Dispatch,Ap=0,tl={},fp=function(i){if(tl.hasOwnProperty(i)){var n=tl[i];delete tl[i],n()}},gp=function(i){return function(){fp(i)}},qv=function(i){fp(i.data)},Jv=function(i){je.postMessage(i+"",Hv.protocol+"//"+Hv.host)};hp&&Kv||(hp=function(i){for(var n=[],s=1;arguments.length>s;)n.push(arguments[s++]);return tl[++Ap]=function(){(typeof i=="function"?i:Function(i)).apply(void 0,n)},Ka(Ap),Ap},Kv=function(i){delete tl[i]},Io(Wv)=="process"?Ka=function(i){Wv.nextTick(gp(i))}:pp&&pp.now?Ka=function(i){pp.now(gp(i))}:Yv&&!jv?(dp=(Fv=new Yv).port2,Fv.port1.onmessage=qv,Ka=ps(dp.postMessage,dp,1)):!je.addEventListener||typeof postMessage!="function"||je.importScripts||cr(Jv)?Ka="onreadystatechange"in(wu?Ma.createElement("script"):{})?function(i){rp.appendChild(wu?Ma.createElement("script"):{}).onreadystatechange=function(){rp.removeChild(this),fp(i)}}:function(i){setTimeout(gp(i),0)}:(Ka=Jv,je.addEventListener("message",qv,!1)));var rl,$s,nl,Wa,mp,vp,Ep,zv,Ip=hp,S2=Pa,Xv=je.MutationObserver||je.WebKitMutationObserver,Cp=je.process,yp=je.Promise,$v=Io(Cp)=="process",Zv=S2(je,"queueMicrotask"),eE=Zv&&Zv.value;eE||(rl=function(){var i;for($v&&(i=Cp.domain)&&i.exit();$s;){var n=$s.fn;$s=$s.next;try{n()}catch(s){throw $s?Wa():nl=void 0,s}}nl=void 0,i&&i.enter()},$v?Wa=function(){Cp.nextTick(rl)}:Xv&&!jv?(mp=!0,vp=document.createTextNode(""),new Xv(rl).observe(vp,{characterData:!0}),Wa=function(){vp.data=mp=!mp}):yp&&yp.resolve?(Ep=yp.resolve(void 0),zv=Ep.then,Wa=function(){zv.call(Ep,rl)}):Wa=function(){Ip.call(je,rl)});var _p,tE,rE=eE||function(i){i={fn:i,next:void 0},nl&&(nl.next=i),$s||($s=i,Wa()),nl=i},T2=function(i){var n,s;this.promise=new i(function(c,u){if(n!==void 0||s!==void 0)throw TypeError("Bad Promise constructor");n=c,s=u}),this.resolve=$i(n),this.reject=$i(s)},Ku={f:function(i){return new T2(i)}},Sp=function(i,n){return on(i),Kt(n)&&n.constructor===i?n:(i=Ku.f(i),(0,i.resolve)(n),i.promise)},Wu=function(i){try{return{error:!1,value:i()}}catch(n){return{error:!0,value:n}}},R2=lr("species"),nE=yr.get,w2=yr.set,N2=yr.getterFor("Promise"),zn=C2,iE=je.TypeError,Tp=je.document,Yu=je.process,O2=Go("inspectSource"),Ya=(eo("fetch"),Ku.f),k2=Ya,il=Io(Yu)=="process",b2=!!(Tp&&Tp.createEvent&&je.dispatchEvent),qu=Qa("Promise",function(){if(O2(zn)===String(zn)&&(Du===66||!il&&typeof PromiseRejectionEvent!="function")||!zn.prototype.finally)return!0;if(51<=Du&&/native code/.test(zn))return!1;var i=zn.resolve(1),n=function(s){s(function(){},function(){})};return(i.constructor={})[R2]=n,!(i.then(function(){})instanceof n)}),D2=qu||!Vv(function(i){zn.all(i).catch(function(){})}),oE=function(i){var n;return!(!Kt(i)||typeof(n=i.then)!="function")&&n},Rp=function(i,n,s){if(!n.notified){n.notified=!0;var c=n.reactions;rE(function(){for(var u=n.value,h=n.state==1,p=0;c.length>p;){var f,m,I,E=c[p++],_=h?E.ok:E.fail,S=E.resolve,N=E.reject,O=E.domain;try{_?(h||(n.rejection===2&&L2(i,n),n.rejection=1),_===!0?f=u:(O&&O.enter(),f=_(u),O&&(O.exit(),I=!0)),f===E.promise?N(iE("Promise-chain cycle")):(m=oE(f))?m.call(f,S,N):S(f)):N(u)}catch(B){O&&!I&&O.exit(),N(B)}}n.reactions=[],n.notified=!1,s&&!n.rejection&&B2(i,n)})}},sE=function(i,n,s){var c,u;b2?((c=Tp.createEvent("Event")).promise=n,c.reason=s,c.initEvent(i,!1,!0),je.dispatchEvent(c)):c={promise:n,reason:s},(u=je["on"+i])?u(c):i==="unhandledrejection"&&function(h,p){var f=je.console;f&&f.error&&(arguments.length===1?f.error(h):f.error(h,p))}("Unhandled promise rejection",s)},B2=function(i,n){Ip.call(je,function(){var s,c=n.value;if(n.rejection!==1&&!n.parent&&(s=Wu(function(){il?Yu.emit("unhandledRejection",c,i):sE("unhandledrejection",i,c)}),n.rejection=il||n.rejection!==1&&!n.parent?2:1,s.error))throw s.value})},L2=function(i,n){Ip.call(je,function(){il?Yu.emit("rejectionHandled",i):sE("rejectionhandled",i,n.value)})},qa=function(i,n,s,c){return function(u){i(n,s,u,c)}},Ja=function(i,n,s,c){n.done||(n.done=!0,c&&(n=c),n.value=s,n.state=2,Rp(i,n,!0))},wp=function(i,n,s,c){if(!n.done){n.done=!0,c&&(n=c);try{if(i===s)throw iE("Promise can't be resolved itself");var u=oE(s);u?rE(function(){var h={done:!1};try{u.call(s,qa(wp,i,h,n),qa(Ja,i,h,n))}catch(p){Ja(i,h,p,n)}}):(n.value=s,n.state=1,Rp(i,n,!1))}catch(h){Ja(i,{done:!1},h,n)}}};qu&&(zn=function(i){Ga(this,zn,"Promise"),$i(i),_p.call(this);var n=nE(this);try{i(qa(wp,this,n),qa(Ja,this,n))}catch(s){Ja(this,n,s)}},(_p=function(i){w2(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=zs(zn.prototype,{then:function(i,n){var s=N2(this),c=Ya(Gv(this,zn));return c.ok=typeof i!="function"||i,c.fail=typeof n=="function"&&n,c.domain=il?Yu.domain:void 0,s.parent=!0,s.reactions.push(c),s.state!=0&&Rp(this,s,!1),c.promise},catch:function(i){return this.then(void 0,i)}}),tE=function(){var i=new _p,n=nE(i);this.promise=i,this.resolve=qa(wp,i,n),this.reject=qa(Ja,i,n)},Ku.f=Ya=function(i){return i===zn||i===aE?new tE(i):k2(i)}),Ge({global:!0,wrap:!0,forced:qu},{Promise:zn}),Ys(zn,"Promise",!1,!0),mv("Promise");var aE=eo("Promise");Ge({target:"Promise",stat:!0,forced:qu},{reject:function(i){var n=Ya(this);return n.reject.call(void 0,i),n.promise}}),Ge({target:"Promise",stat:!0,forced:!0},{resolve:function(i){return Sp(this===aE?zn:this,i)}}),Ge({target:"Promise",stat:!0,forced:D2},{all:function(i){var n=this,s=Ya(n),c=s.resolve,u=s.reject,h=Wu(function(){var p=$i(n.resolve),f=[],m=0,I=1;Va(i,function(E){var _=m++,S=!1;f.push(void 0),I++,p.call(n,E).then(function(N){S||(S=!0,f[_]=N,--I||c(f))},u)}),--I||c(f)});return h.error&&u(h.value),s.promise},race:function(i){var n=this,s=Ya(n),c=s.reject,u=Wu(function(){var h=$i(n.resolve);Va(i,function(p){h.call(n,p).then(s.resolve,c)})});return u.error&&c(u.value),s.promise}}),Ge({target:"Promise",stat:!0},{allSettled:function(i){var n=this,s=Ku.f(n),c=s.resolve,u=s.reject,h=Wu(function(){var p=$i(n.resolve),f=[],m=0,I=1;Va(i,function(E){var _=m++,S=!1;f.push(void 0),I++,p.call(n,E).then(function(N){S||(S=!0,f[_]={status:"fulfilled",value:N},--I||c(f))},function(N){S||(S=!0,f[_]={status:"rejected",reason:N},--I||c(f))})}),--I||c(f)});return h.error&&u(h.value),s.promise}}),Ge({target:"Promise",proto:!0,real:!0},{finally:function(i){var n=Gv(this,eo("Promise")),s=typeof i=="function";return this.then(s?function(c){return Sp(n,i()).then(function(){return c})}:i,s?function(c){return Sp(n,i()).then(function(){throw c})}:i)}});var se=Qt.Promise;Ge({target:"Array",proto:!0,forced:!Xc("map")},{map:function(i){return DT(this,i,1<arguments.length?arguments[1]:void 0)}});var M2=ur("Array").map,cE=Array.prototype,Ie=function(i){var n=i.map;return i===cE||i instanceof Array&&n===cE.map?M2:n},P2=Math.max,Q2=Math.min;Ge({target:"Array",proto:!0,forced:!Xc("splice")},{splice:function(i,n){var s,c,u,h,p=Li(this),f=hi(p.length),m=Js(i,f),I=arguments.length;if(I===0?s=c=0:I===1?(s=0,c=f-m):(s=I-2,c=Q2(P2(Jc(n),0),f-m)),9007199254740991<f+s-c)throw TypeError("Maximum allowed length exceeded");for(I=Xh(p,c),u=0;u<c;u++)(h=m+u)in p&&Ws(I,u,p[h]);if(I.length=c,s<c){for(u=m;u<f-c;u++){var E=u+s;(h=u+c)in p?p[E]=p[h]:delete p[E]}for(u=f;u>f-c+s;u--)delete p[u-1]}else if(s>c)for(u=f-c;u>m;u--)E=u+s-1,(h=u+c-1)in p?p[E]=p[h]:delete p[E];for(u=0;u<s;u++)p[u+m]=arguments[u+2];return p.length=f-c+s,I}});var x2=ur("Array").splice,lE=Array.prototype,qr=function(i){var n=i.splice;return i===lE||i instanceof Array&&n===lE.splice?x2:n},uE=[].indexOf,dE=!!uE&&0>1/[1].indexOf(1,-0),U2=Xs("indexOf");Ge({target:"Array",proto:!0,forced:dE||U2},{indexOf:function(i){return dE?uE.apply(this,arguments)||0:av(this,i,1<arguments.length?arguments[1]:void 0)}});var F2=ur("Array").indexOf,hE=Array.prototype,He=function(i){var n=i.indexOf;return i===hE||i instanceof Array&&n===hE.indexOf?F2:n},V2=lr("species"),G2=[].slice,j2=Math.max;Ge({target:"Array",proto:!0,forced:!Xc("slice")},{slice:function(i,n){var s,c=di(this),u=hi(c.length);if(i=Js(i,u),n=Js(n===void 0?u:n,u),Ks(c)&&(typeof(s=c.constructor)!="function"||s!==Array&&!Ks(s.prototype)?Kt(s)&&(s=s[V2])===null&&(s=void 0):s=void 0,s===Array||s===void 0))return G2.call(c,i,n);for(s=new(s===void 0?Array:s)(j2(n-i,0)),u=0;i<n;i++,u++)i in c&&Ws(s,u,c[i]);return s.length=u,s}});var H2=ur("Array").slice,pE=Array.prototype,Ur=function(i){var n=i.slice;return i===pE||i instanceof Array&&n===pE.slice?H2:n},AE=!0;"find"in[]&&Array(1).find(function(){AE=!1}),Ge({target:"Array",proto:!0,forced:AE},{find:function(i){return ev(this,i,1<arguments.length?arguments[1]:void 0)}});var K2=ur("Array").find,fE=Array.prototype,ze=function(i){var n=i.find;return i===fE||i instanceof Array&&n===fE.find?K2:n},gE=[].slice,Np={};Ge({target:"Function",proto:!0},{bind:Function.bind||function(i){var n=$i(this),s=gE.call(arguments,1),c=function(){var u=s.concat(gE.call(arguments));if(this instanceof c){var h=u.length;if(!(h in Np)){for(var p=[],f=0;f<h;f++)p[f]="a["+f+"]";Np[h]=Function("C,a","return new C("+p.join(",")+")")}u=Np[h](n,u)}else u=n.apply(i,u);return u};return Kt(n.prototype)&&(c.prototype=n.prototype),c}});var W2=ur("Function").bind,mE=Function.prototype,hr=function(i){var n=i.bind;return i===mE||i instanceof Function&&n===mE.bind?W2:n};Ge({target:"Array",proto:!0},{includes:function(i){return WT(this,i,1<arguments.length?arguments[1]:void 0)}});var Y2=ur("Array").includes;Ge({target:"String",proto:!0,forced:!up("includes")},{includes:function(i){return!!~String(Hs(this)).indexOf(lp(i),1<arguments.length?arguments[1]:void 0)}});var q2=ur("String").includes,vE=Array.prototype,EE=String.prototype,gt=function(i){var n=i.includes;return i===vE||i instanceof Array&&n===vE.includes?Y2:typeof i=="string"||i===EE||i instanceof String&&n===EE.includes?q2:n};Ge({target:"Array",proto:!0,forced:Xs("some")},{some:function(i){return LT(this,i,1<arguments.length?arguments[1]:void 0)}});var J2=ur("Array").some,IE=Array.prototype,CE=function(i){var n=i.some;return i===IE||i instanceof Array&&n===IE.some?J2:n};let yE=A;var _E=Object.freeze({__proto__:null,shimMediaStream:k,shimOnTrack:M,shimGetSendersWithDtmf:F,shimGetStats:K,shimSenderReceiverGetStats:J,shimAddTrackRemoveTrackWithNative:U,shimAddTrackRemoveTrack:te,shimPeerConnection:P,fixNegotiationNeeded:he,shimGetUserMedia:w,shimGetDisplayMedia:function(i,n){i.navigator.mediaDevices&&"getDisplayMedia"in i.navigator.mediaDevices||i.navigator.mediaDevices&&(typeof n=="function"?i.navigator.mediaDevices.getDisplayMedia=function(s){return n(s).then(c=>{let u=s.video&&s.video.width,h=s.video&&s.video.height;return s.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:c,maxFrameRate:s.video&&s.video.frameRate||3}},u&&(s.video.mandatory.maxWidth=u),h&&(s.video.mandatory.maxHeight=h),i.navigator.mediaDevices.getUserMedia(s)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}}),SE="".startsWith,z2=Math.min,X2=up("startsWith");Ge({target:"String",proto:!0,forced:!X2},{startsWith:function(i){var n=String(Hs(this));lp(i);var s=hi(z2(1<arguments.length?arguments[1]:void 0,n.length)),c=String(i);return SE?SE.call(n,c,s):n.slice(s,s+c.length)===c}});var $2=ur("String").startsWith,TE=String.prototype,ol=function(i){var n=i.startsWith;return typeof i=="string"||i===TE||i instanceof String&&n===TE.startsWith?$2:n};Ge({target:"String",proto:!0,forced:cr(function(){return`	
\v\f\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF`.trim.name!=="trim"})},{trim:function(){return bv(this)}});var Z2=ur("String").trim,RE=String.prototype,Zs=function(i){var n=i.trim;return typeof i=="string"||i===RE||i instanceof String&&n===RE.trim?Z2:n},Ue=r(function(i){var n={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};n.localCName=n.generateIdentifier(),n.splitLines=function(s){var c;return Ie(c=Zs(s).call(s).split(`
`)).call(c,function(u){return Zs(u).call(u)})},n.splitSections=function(s){return s=s.split(`
m=`),Ie(s).call(s,function(c,u){var h;return Zs(h=0<u?"m="+c:c).call(h)+`\r
`})},n.getDescription=function(s){return(s=n.splitSections(s))&&s[0]},n.getMediaSections=function(s){return s=n.splitSections(s),s.shift(),s},n.matchPrefix=function(s,c){var u;return Qe(u=n.splitLines(s)).call(u,function(h){return He(h).call(h,c)===0})},n.parseCandidate=function(s){var c;s={foundation:(c=He(s).call(s,"a=candidate:")===0?s.substring(12).split(" "):s.substring(10).split(" "))[0],component:dr(c[1],10),protocol:c[2].toLowerCase(),priority:dr(c[3],10),ip:c[4],address:c[4],port:dr(c[5],10),type:c[7]};for(var u=8;u<c.length;u+=2)switch(c[u]){case"raddr":s.relatedAddress=c[u+1];break;case"rport":s.relatedPort=dr(c[u+1],10);break;case"tcptype":s.tcpType=c[u+1];break;case"ufrag":s.ufrag=c[u+1],s.usernameFragment=c[u+1];break;default:s[c[u]]=c[u+1]}return s},n.writeCandidate=function(s){var c=[];c.push(s.foundation),c.push(s.component),c.push(s.protocol.toUpperCase()),c.push(s.priority),c.push(s.address||s.ip),c.push(s.port);var u=s.type;return c.push("typ"),c.push(u),u!=="host"&&s.relatedAddress&&s.relatedPort&&(c.push("raddr"),c.push(s.relatedAddress),c.push("rport"),c.push(s.relatedPort)),s.tcpType&&s.protocol.toLowerCase()==="tcp"&&(c.push("tcptype"),c.push(s.tcpType)),(s.usernameFragment||s.ufrag)&&(c.push("ufrag"),c.push(s.usernameFragment||s.ufrag)),"candidate:"+c.join(" ")},n.parseIceOptions=function(s){return s.substr(14).split(" ")},n.parseRtpMap=function(s){s=s.substr(9).split(" ");var c={payloadType:dr(s.shift(),10)};return s=s[0].split("/"),c.name=s[0],c.clockRate=dr(s[1],10),c.channels=s.length===3?dr(s[2],10):1,c.numChannels=c.channels,c},n.writeRtpMap=function(s){var c=s.payloadType;s.preferredPayloadType!==void 0&&(c=s.preferredPayloadType);var u=s.channels||s.numChannels||1;return"a=rtpmap:"+c+" "+s.name+"/"+s.clockRate+(u!==1?"/"+u:"")+`\r
`},n.parseExtmap=function(s){var c;return s=s.substr(9).split(" "),{id:dr(s[0],10),direction:0<He(c=s[0]).call(c,"/")?s[0].split("/")[1]:"sendrecv",uri:s[1]}},n.writeExtmap=function(s){return"a=extmap:"+(s.id||s.preferredId)+(s.direction&&s.direction!=="sendrecv"?"/"+s.direction:"")+" "+s.uri+`\r
`},n.parseFmtp=function(s){for(var c={},u=s.substr(He(s).call(s," ")+1).split(";"),h=0;h<u.length;h++){var p,f;s=Zs(p=u[h]).call(p).split("="),c[Zs(f=s[0]).call(f)]=s[1]}return c},n.writeFmtp=function(s){var c="",u=s.payloadType;if(s.preferredPayloadType!==void 0&&(u=s.preferredPayloadType),s.parameters&&ut(s.parameters).length){var h,p=[];H(h=ut(s.parameters)).call(h,function(f){s.parameters[f]?p.push(f+"="+s.parameters[f]):p.push(f)}),c+="a=fmtp:"+u+" "+p.join(";")+`\r
`}return c},n.parseRtcpFb=function(s){return s=s.substr(He(s).call(s," ")+1).split(" "),{type:s.shift(),parameter:s.join(" ")}},n.writeRtcpFb=function(s){var c,u="",h=s.payloadType;return s.preferredPayloadType!==void 0&&(h=s.preferredPayloadType),s.rtcpFeedback&&s.rtcpFeedback.length&&H(c=s.rtcpFeedback).call(c,function(p){u+="a=rtcp-fb:"+h+" "+p.type+(p.parameter&&p.parameter.length?" "+p.parameter:"")+`\r
`}),u},n.parseSsrcMedia=function(s){var c=He(s).call(s," "),u={ssrc:dr(s.substr(7,c-7),10)},h=He(s).call(s,":",c);return-1<h?(u.attribute=s.substr(c+1,h-c-1),u.value=s.substr(h+1)):u.attribute=s.substr(c+1),u},n.parseSsrcGroup=function(s){return s=s.substr(13).split(" "),{semantics:s.shift(),ssrcs:Ie(s).call(s,function(c){return dr(c,10)})}},n.getMid=function(s){if(s=n.matchPrefix(s,"a=mid:")[0])return s.substr(6)},n.parseFingerprint=function(s){return s=s.substr(14).split(" "),{algorithm:s[0].toLowerCase(),value:s[1]}},n.getDtlsParameters=function(s,c){return s=n.matchPrefix(s+c,"a=fingerprint:"),{role:"auto",fingerprints:Ie(s).call(s,n.parseFingerprint)}},n.writeDtlsParameters=function(s,c){var u,h="a=setup:"+c+`\r
`;return H(u=s.fingerprints).call(u,function(p){h+="a=fingerprint:"+p.algorithm+" "+p.value+`\r
`}),h},n.getIceParameters=function(s,c){return s=n.splitLines(s),s=b(s).call(s,n.splitLines(c)),{usernameFragment:Qe(s).call(s,function(u){return He(u).call(u,"a=ice-ufrag:")===0})[0].substr(12),password:Qe(s).call(s,function(u){return He(u).call(u,"a=ice-pwd:")===0})[0].substr(10)}},n.writeIceParameters=function(s){return"a=ice-ufrag:"+s.usernameFragment+`\r
a=ice-pwd:`+s.password+`\r
`},n.parseRtpParameters=function(s){for(var c,u={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},h=n.splitLines(s)[0].split(" "),p=3;p<h.length;p++){var f=h[p],m=n.matchPrefix(s,"a=rtpmap:"+f+" ")[0];if(m){var I;m=n.parseRtpMap(m);var E=n.matchPrefix(s,"a=fmtp:"+f+" ");switch(m.parameters=E.length?n.parseFmtp(E[0]):{},m.rtcpFeedback=Ie(I=n.matchPrefix(s,"a=rtcp-fb:"+f+" ")).call(I,n.parseRtcpFb),u.codecs.push(m),m.name.toUpperCase()){case"RED":case"ULPFEC":u.fecMechanisms.push(m.name.toUpperCase())}}}return H(c=n.matchPrefix(s,"a=extmap:")).call(c,function(_){u.headerExtensions.push(n.parseExtmap(_))}),u},n.writeRtpDescription=function(s,c){var u,h,p,f="";f+="m="+s+" ",f+=0<c.codecs.length?"9":"0",f+=" UDP/TLS/RTP/SAVPF ",f+=Ie(u=c.codecs).call(u,function(E){return E.preferredPayloadType!==void 0?E.preferredPayloadType:E.payloadType}).join(" ")+`\r
`,f+=`c=IN IP4 0.0.0.0\r
`,f+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,H(h=c.codecs).call(h,function(E){f+=n.writeRtpMap(E),f+=n.writeFmtp(E),f+=n.writeRtcpFb(E)});var m,I=0;return H(p=c.codecs).call(p,function(E){E.maxptime>I&&(I=E.maxptime)}),0<I&&(f+="a=maxptime:"+I+`\r
`),f+=`a=rtcp-mux\r
`,c.headerExtensions&&H(m=c.headerExtensions).call(m,function(E){f+=n.writeExtmap(E)}),f},n.parseRtpEncodingParameters=function(s){var c,u,h,p,f,m,I,E=[],_=n.parseRtpParameters(s),S=He(c=_.fecMechanisms).call(c,"RED")!==-1,N=He(u=_.fecMechanisms).call(u,"ULPFEC")!==-1;c=Qe(h=Ie(p=n.matchPrefix(s,"a=ssrc:")).call(p,function(ie){return n.parseSsrcMedia(ie)})).call(h,function(ie){return ie.attribute==="cname"});var O=0<c.length&&c[0].ssrc;h=Ie(f=n.matchPrefix(s,"a=ssrc-group:FID")).call(f,function(ie){return ie=ie.substr(17).split(" "),Ie(ie).call(ie,function(Ae){return dr(Ae,10)})}),0<h.length&&1<h[0].length&&h[0][0]===O&&(I=h[0][1]),H(m=_.codecs).call(m,function(ie){ie.name.toUpperCase()==="RTX"&&ie.parameters.apt&&(ie={ssrc:O,codecPayloadType:dr(ie.parameters.apt,10)},O&&I&&(ie.rtx={ssrc:I}),E.push(ie),S&&((ie=JSON.parse(pe(ie))).fec={ssrc:O,mechanism:N?"red+ulpfec":"red"},E.push(ie)))}),E.length===0&&O&&E.push({ssrc:O});var B,Q,q=n.matchPrefix(s,"b=");return q.length&&(q=He(B=q[0]).call(B,"b=TIAS:")===0?dr(q[0].substr(7),10):He(Q=q[0]).call(Q,"b=AS:")===0?950*dr(q[0].substr(5),10)-16e3:void 0,H(E).call(E,function(ie){ie.maxBitrate=q})),E},n.parseRtcpParameters=function(s){var c,u,h={},p=Qe(c=Ie(u=n.matchPrefix(s,"a=ssrc:")).call(u,function(f){return n.parseSsrcMedia(f)})).call(c,function(f){return f.attribute==="cname"})[0];return p&&(h.cname=p.value,h.ssrc=p.ssrc),c=n.matchPrefix(s,"a=rtcp-rsize"),h.reducedSize=0<c.length,h.compound=c.length===0,s=n.matchPrefix(s,"a=rtcp-mux"),h.mux=0<s.length,h},n.parseMsid=function(s){var c,u,h,p=n.matchPrefix(s,"a=msid:");return p.length===1?{stream:(h=p[0].substr(7).split(" "))[0],track:h[1]}:(s=Qe(c=Ie(u=n.matchPrefix(s,"a=ssrc:")).call(u,function(f){return n.parseSsrcMedia(f)})).call(c,function(f){return f.attribute==="msid"}),0<s.length?{stream:(h=s[0].value.split(" "))[0],track:h[1]}:void 0)},n.generateSessionId=function(){return Math.random().toString().substr(2,21)},n.writeSessionBoilerplate=function(s,c,u){return c=c!==void 0?c:2,`v=0\r
o=`+(u||"thisisadapterortc")+" "+(s||n.generateSessionId())+" "+c+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},n.writeMediaSection=function(s,c,u,h){return c=n.writeRtpDescription(s.kind,c),c+=n.writeIceParameters(s.iceGatherer.getLocalParameters()),c+=n.writeDtlsParameters(s.dtlsTransport.getLocalParameters(),u==="offer"?"actpass":"active"),c+="a=mid:"+s.mid+`\r
`,s.direction?c+="a="+s.direction+`\r
`:s.rtpSender&&s.rtpReceiver?c+=`a=sendrecv\r
`:s.rtpSender?c+=`a=sendonly\r
`:s.rtpReceiver?c+=`a=recvonly\r
`:c+=`a=inactive\r
`,s.rtpSender&&(u="msid:"+h.id+" "+s.rtpSender.track.id+`\r
`,c=c+("a="+u)+("a=ssrc:"+s.sendEncodingParameters[0].ssrc+" "+u),s.sendEncodingParameters[0].rtx&&(c+="a=ssrc:"+s.sendEncodingParameters[0].rtx.ssrc+" "+u,c+="a=ssrc-group:FID "+s.sendEncodingParameters[0].ssrc+" "+s.sendEncodingParameters[0].rtx.ssrc+`\r
`)),c+="a=ssrc:"+s.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+`\r
`,s.rtpSender&&s.sendEncodingParameters[0].rtx&&(c+="a=ssrc:"+s.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+`\r
`),c},n.getDirection=function(s,c){s=n.splitLines(s);for(var u=0;u<s.length;u++)switch(s[u]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return s[u].substr(2)}return c?n.getDirection(c):"sendrecv"},n.getKind=function(s){return n.splitLines(s)[0].split(" ")[0].substr(2)},n.isRejected=function(s){return s.split(" ",2)[1]==="0"},n.parseMLine=function(s){return s=n.splitLines(s)[0].substr(2).split(" "),{kind:s[0],port:dr(s[1],10),protocol:s[2],fmt:Ur(s).call(s,3).join(" ")}},n.parseOLine=function(s){return s=n.matchPrefix(s,"o=")[0].substr(2).split(" "),{username:s[0],sessionId:s[1],sessionVersion:dr(s[2],10),netType:s[3],addressType:s[4],address:s[5]}},n.isValidSDP=function(s){if(typeof s!="string"||s.length===0)return!1;s=n.splitLines(s);for(var c=0;c<s.length;c++)if(2>s[c].length||s[c].charAt(1)!=="=")return!1;return!0},i.exports=n}),eR=function(i,n){function s(p,f){f.addTrack(p),f.dispatchEvent(new i.MediaStreamTrackEvent("addtrack",{track:p}))}function c(p,f,m,I){var E=new Event("track");E.track=f,E.receiver=m,E.transceiver={receiver:m},E.streams=I,i.setTimeout(function(){p._dispatchEvent("track",E)})}var u=function(p){var f=this,m=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(E){f[E]=m[E].bind(m)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",p=JSON.parse(JSON.stringify(p||{})),this.usingBundle=p.bundlePolicy==="max-bundle",p.rtcpMuxPolicy==="negotiate")throw be("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(p.rtcpMuxPolicy||(p.rtcpMuxPolicy="require"),p.iceTransportPolicy){case"all":case"relay":break;default:p.iceTransportPolicy="all"}switch(p.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:p.bundlePolicy="balanced"}if(p.iceServers=function(E,_){var S=!1;return(E=JSON.parse(JSON.stringify(E))).filter(function(N){if(N&&(N.urls||N.url)){var O=N.urls||N.url;N.url&&!N.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var B=typeof O=="string";return B&&(O=[O]),O=O.filter(function(Q){return Q.indexOf("turn:")!==0||Q.indexOf("transport=udp")===-1||Q.indexOf("turn:[")!==-1||S?Q.indexOf("stun:")===0&&14393<=_&&Q.indexOf("?transport=udp")===-1:(S=!0,!0)}),delete N.url,N.urls=B?O[0]:O,!!O.length}})}(p.iceServers||[],n),this._iceGatherers=[],p.iceCandidatePoolSize)for(var I=p.iceCandidatePoolSize;0<I;I--)this._iceGatherers.push(new i.RTCIceGatherer({iceServers:p.iceServers,gatherPolicy:p.iceTransportPolicy}));else p.iceCandidatePoolSize=0;this._config=p,this.transceivers=[],this._sdpSessionId=Ue.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(u.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(u.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),u.prototype.onicecandidate=null,u.prototype.onaddstream=null,u.prototype.ontrack=null,u.prototype.onremovestream=null,u.prototype.onsignalingstatechange=null,u.prototype.oniceconnectionstatechange=null,u.prototype.onconnectionstatechange=null,u.prototype.onicegatheringstatechange=null,u.prototype.onnegotiationneeded=null,u.prototype.ondatachannel=null,u.prototype._dispatchEvent=function(p,f){this._isClosed||(this.dispatchEvent(f),typeof this["on"+p]=="function"&&this["on"+p](f))},u.prototype._emitGatheringStateChange=function(){var p=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",p)},u.prototype.getConfiguration=function(){return this._config},u.prototype.getLocalStreams=function(){return this.localStreams},u.prototype.getRemoteStreams=function(){return this.remoteStreams},u.prototype._createTransceiver=function(p,f){var m=0<this.transceivers.length;return p={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:p,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0},this.usingBundle&&m?(p.iceTransport=this.transceivers[0].iceTransport,p.dtlsTransport=this.transceivers[0].dtlsTransport):(m=this._createIceAndDtlsTransports(),p.iceTransport=m.iceTransport,p.dtlsTransport=m.dtlsTransport),f||this.transceivers.push(p),p},u.prototype.addTrack=function(p,f){if(this._isClosed)throw be("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var m;if(this.transceivers.find(function(E){return E.track===p}))throw be("InvalidAccessError","Track already exists.");for(var I=0;I<this.transceivers.length;I++)this.transceivers[I].track||this.transceivers[I].kind!==p.kind||(m=this.transceivers[I]);return m||(m=this._createTransceiver(p.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(f)===-1&&this.localStreams.push(f),m.track=p,m.stream=f,m.rtpSender=new i.RTCRtpSender(p,m.dtlsTransport),m.rtpSender},u.prototype.addStream=function(p){var f=this;if(15025<=n)p.getTracks().forEach(function(I){f.addTrack(I,p)});else{var m=p.clone();p.getTracks().forEach(function(I,E){var _=m.getTracks()[E];I.addEventListener("enabled",function(S){_.enabled=S.enabled})}),m.getTracks().forEach(function(I){f.addTrack(I,m)})}},u.prototype.removeTrack=function(p){if(this._isClosed)throw be("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(p instanceof i.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var f=this.transceivers.find(function(I){return I.rtpSender===p});if(!f)throw be("InvalidAccessError","Sender was not created by this connection.");var m=f.stream;f.rtpSender.stop(),f.rtpSender=null,f.track=null,f.stream=null,this.transceivers.map(function(I){return I.stream}).indexOf(m)===-1&&-1<this.localStreams.indexOf(m)&&this.localStreams.splice(this.localStreams.indexOf(m),1),this._maybeFireNegotiationNeeded()},u.prototype.removeStream=function(p){var f=this;p.getTracks().forEach(function(m){var I=f.getSenders().find(function(E){return E.track===m});I&&f.removeTrack(I)})},u.prototype.getSenders=function(){return this.transceivers.filter(function(p){return!!p.rtpSender}).map(function(p){return p.rtpSender})},u.prototype.getReceivers=function(){return this.transceivers.filter(function(p){return!!p.rtpReceiver}).map(function(p){return p.rtpReceiver})},u.prototype._createIceGatherer=function(p,f){var m=this;if(f&&0<p)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var I=new i.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(I,"state",{value:"new",writable:!0}),this.transceivers[p].bufferedCandidateEvents=[],this.transceivers[p].bufferCandidates=function(E){var _=!E.candidate||Object.keys(E.candidate).length===0;I.state=_?"completed":"gathering",m.transceivers[p].bufferedCandidateEvents!==null&&m.transceivers[p].bufferedCandidateEvents.push(E)},I.addEventListener("localcandidate",this.transceivers[p].bufferCandidates),I},u.prototype._gather=function(p,f){var m=this,I=this.transceivers[f].iceGatherer;if(!I.onlocalcandidate){var E=this.transceivers[f].bufferedCandidateEvents;this.transceivers[f].bufferedCandidateEvents=null,I.removeEventListener("localcandidate",this.transceivers[f].bufferCandidates),I.onlocalcandidate=function(_){if(!(m.usingBundle&&0<f)){var S=new Event("icecandidate");S.candidate={sdpMid:p,sdpMLineIndex:f};var N=_.candidate;(_=!N||Object.keys(N).length===0)?I.state!=="new"&&I.state!=="gathering"||(I.state="completed"):(I.state==="new"&&(I.state="gathering"),N.component=1,N.ufrag=I.getLocalParameters().usernameFragment,N=Ue.writeCandidate(N),S.candidate=Object.assign(S.candidate,Ue.parseCandidate(N)),S.candidate.candidate=N,S.candidate.toJSON=function(){return{candidate:S.candidate.candidate,sdpMid:S.candidate.sdpMid,sdpMLineIndex:S.candidate.sdpMLineIndex,usernameFragment:S.candidate.usernameFragment}}),N=Ue.getMediaSections(m._localDescription.sdp),N[S.candidate.sdpMLineIndex]+=_?`a=end-of-candidates\r
`:"a="+S.candidate.candidate+`\r
`,m._localDescription.sdp=Ue.getDescription(m._localDescription.sdp)+N.join(""),N=m.transceivers.every(function(O){return O.iceGatherer&&O.iceGatherer.state==="completed"}),m.iceGatheringState!=="gathering"&&(m.iceGatheringState="gathering",m._emitGatheringStateChange()),_||m._dispatchEvent("icecandidate",S),N&&(m._dispatchEvent("icecandidate",new Event("icecandidate")),m.iceGatheringState="complete",m._emitGatheringStateChange())}},i.setTimeout(function(){E.forEach(function(_){I.onlocalcandidate(_)})},0)}},u.prototype._createIceAndDtlsTransports=function(){var p=this,f=new i.RTCIceTransport(null);f.onicestatechange=function(){p._updateIceConnectionState(),p._updateConnectionState()};var m=new i.RTCDtlsTransport(f);return m.ondtlsstatechange=function(){p._updateConnectionState()},m.onerror=function(){Object.defineProperty(m,"state",{value:"failed",writable:!0}),p._updateConnectionState()},{iceTransport:f,dtlsTransport:m}},u.prototype._disposeIceAndDtlsTransports=function(p){var f=this.transceivers[p].iceGatherer;f&&(delete f.onlocalcandidate,delete this.transceivers[p].iceGatherer),(f=this.transceivers[p].iceTransport)&&(delete f.onicestatechange,delete this.transceivers[p].iceTransport),(f=this.transceivers[p].dtlsTransport)&&(delete f.ondtlsstatechange,delete f.onerror,delete this.transceivers[p].dtlsTransport)},u.prototype._transceive=function(p,f,m){var I=me(p.localCapabilities,p.remoteCapabilities);f&&p.rtpSender&&(I.encodings=p.sendEncodingParameters,I.rtcp={cname:Ue.localCName,compound:p.rtcpParameters.compound},p.recvEncodingParameters.length&&(I.rtcp.ssrc=p.recvEncodingParameters[0].ssrc),p.rtpSender.send(I)),m&&p.rtpReceiver&&0<I.codecs.length&&(p.kind==="video"&&p.recvEncodingParameters&&15019>n&&p.recvEncodingParameters.forEach(function(E){delete E.rtx}),p.recvEncodingParameters.length?I.encodings=p.recvEncodingParameters:I.encodings=[{}],I.rtcp={compound:p.rtcpParameters.compound},p.rtcpParameters.cname&&(I.rtcp.cname=p.rtcpParameters.cname),p.sendEncodingParameters.length&&(I.rtcp.ssrc=p.sendEncodingParameters[0].ssrc),p.rtpReceiver.receive(I))},u.prototype.setLocalDescription=function(p){var f=this;if(["offer","answer"].indexOf(p.type)===-1)return Promise.reject(be("TypeError",'Unsupported type "'+p.type+'"'));if(!Pe("setLocalDescription",p.type,f.signalingState)||f._isClosed)return Promise.reject(be("InvalidStateError","Can not set local "+p.type+" in state "+f.signalingState));if(p.type==="offer"){var m=Ue.splitSections(p.sdp),I=m.shift();m.forEach(function(_,S){_=Ue.parseRtpParameters(_),f.transceivers[S].localCapabilities=_}),f.transceivers.forEach(function(_,S){f._gather(_.mid,S)})}else if(p.type==="answer"){m=Ue.splitSections(f._remoteDescription.sdp),I=m.shift();var E=0<Ue.matchPrefix(I,"a=ice-lite").length;m.forEach(function(_,S){var N=f.transceivers[S],O=N.iceGatherer,B=N.iceTransport,Q=N.dtlsTransport,q=N.localCapabilities,ie=N.remoteCapabilities;if(!(Ue.isRejected(_)&&Ue.matchPrefix(_,"a=bundle-only").length===0||N.rejected)){var Ae=Ue.getIceParameters(_,I);_=Ue.getDtlsParameters(_,I),E&&(_.role="server"),f.usingBundle&&S!==0||(f._gather(N.mid,S),B.state==="new"&&B.start(O,Ae,E?"controlling":"controlled"),Q.state==="new"&&Q.start(_)),S=me(q,ie),f._transceive(N,0<S.codecs.length,!1)}})}return f._localDescription={type:p.type,sdp:p.sdp},p.type==="offer"?f._updateSignalingState("have-local-offer"):f._updateSignalingState("stable"),Promise.resolve()},u.prototype.setRemoteDescription=function(p){var f=this;if(["offer","answer"].indexOf(p.type)===-1)return Promise.reject(be("TypeError",'Unsupported type "'+p.type+'"'));if(!Pe("setRemoteDescription",p.type,f.signalingState)||f._isClosed)return Promise.reject(be("InvalidStateError","Can not set remote "+p.type+" in state "+f.signalingState));var m={};f.remoteStreams.forEach(function(B){m[B.id]=B});var I=[],E=Ue.splitSections(p.sdp),_=E.shift(),S=0<Ue.matchPrefix(_,"a=ice-lite").length,N=0<Ue.matchPrefix(_,"a=group:BUNDLE ").length;f.usingBundle=N;var O=Ue.matchPrefix(_,"a=ice-options:")[0];return f.canTrickleIceCandidates=!!O&&0<=O.substr(14).split(" ").indexOf("trickle"),E.forEach(function(B,Q){var q=Ue.splitLines(B),ie=Ue.getKind(B),Ae=Ue.isRejected(B)&&Ue.matchPrefix(B,"a=bundle-only").length===0,Be=q[0].substr(2).split(" ")[2];q=Ue.getDirection(B,_);var ke=Ue.parseMsid(B),yt=Ue.getMid(B)||Ue.generateIdentifier();if(Ae||ie==="application"&&(Be==="DTLS/SCTP"||Be==="UDP/DTLS/SCTP"))f.transceivers[Q]={mid:yt,kind:ie,protocol:Be,rejected:!0};else{var ve,Ze;!Ae&&f.transceivers[Q]&&f.transceivers[Q].rejected&&(f.transceivers[Q]=f._createTransceiver(ie,!0));var vt,Yt,Lr=Ue.parseRtpParameters(B);Ae||(vt=Ue.getIceParameters(B,_),(Yt=Ue.getDtlsParameters(B,_)).role="client"),Be=Ue.parseRtpEncodingParameters(B);var xt=Ue.parseRtcpParameters(B),ln=0<Ue.matchPrefix(B,"a=end-of-candidates",_).length;if(B=Ue.matchPrefix(B,"a=candidate:").map(function(ue){return Ue.parseCandidate(ue)}).filter(function(ue){return ue.component===1}),(p.type==="offer"||p.type==="answer")&&!Ae&&N&&0<Q&&f.transceivers[Q]&&(f._disposeIceAndDtlsTransports(Q),f.transceivers[Q].iceGatherer=f.transceivers[0].iceGatherer,f.transceivers[Q].iceTransport=f.transceivers[0].iceTransport,f.transceivers[Q].dtlsTransport=f.transceivers[0].dtlsTransport,f.transceivers[Q].rtpSender&&f.transceivers[Q].rtpSender.setTransport(f.transceivers[0].dtlsTransport),f.transceivers[Q].rtpReceiver&&f.transceivers[Q].rtpReceiver.setTransport(f.transceivers[0].dtlsTransport)),p.type!=="offer"||Ae){if(p.type==="answer"&&!Ae){ie=(ve=f.transceivers[Q]).iceGatherer;var G=ve.iceTransport,Y=ve.dtlsTransport,Z=ve.rtpReceiver;Ae=ve.sendEncodingParameters,yt=ve.localCapabilities,f.transceivers[Q].recvEncodingParameters=Be,f.transceivers[Q].remoteCapabilities=Lr,f.transceivers[Q].rtcpParameters=xt,B.length&&G.state==="new"&&(!S&&!ln||N&&Q!==0?B.forEach(function(ue){Me(ve.iceTransport,ue)}):G.setRemoteCandidates(B)),N&&Q!==0||(G.state==="new"&&G.start(ie,vt,"controlling"),Y.state==="new"&&Y.start(Yt)),!me(ve.localCapabilities,ve.remoteCapabilities).codecs.filter(function(ue){return ue.name.toLowerCase()==="rtx"}).length&&ve.sendEncodingParameters[0].rtx&&delete ve.sendEncodingParameters[0].rtx,f._transceive(ve,q==="sendrecv"||q==="recvonly",q==="sendrecv"||q==="sendonly"),!Z||q!=="sendrecv"&&q!=="sendonly"?delete ve.rtpReceiver:(Ze=Z.track,ke?(m[ke.stream]||(m[ke.stream]=new i.MediaStream),s(Ze,m[ke.stream]),I.push([Ze,Z,m[ke.stream]])):(m.default||(m.default=new i.MediaStream),s(Ze,m.default),I.push([Ze,Z,m.default])))}}else(ve=f.transceivers[Q]||f._createTransceiver(ie)).mid=yt,ve.iceGatherer||(ve.iceGatherer=f._createIceGatherer(Q,N)),B.length&&ve.iceTransport.state==="new"&&(!ln||N&&Q!==0?B.forEach(function(ue){Me(ve.iceTransport,ue)}):ve.iceTransport.setRemoteCandidates(B)),yt=i.RTCRtpReceiver.getCapabilities(ie),15019>n&&(yt.codecs=yt.codecs.filter(function(ue){return ue.name!=="rtx"})),Ae=ve.sendEncodingParameters||[{ssrc:1001*(2*Q+2)}],vt=!1,q==="sendrecv"||q==="sendonly"?(vt=!ve.rtpReceiver,Z=ve.rtpReceiver||new i.RTCRtpReceiver(ve.dtlsTransport,ie),vt&&(Ze=Z.track,ke&&ke.stream==="-"||(ke?(m[ke.stream]||(m[ke.stream]=new i.MediaStream,Object.defineProperty(m[ke.stream],"id",{get:function(){return ke.stream}})),Object.defineProperty(Ze,"id",{get:function(){return ke.track}}),G=m[ke.stream]):(m.default||(m.default=new i.MediaStream),G=m.default)),G&&(s(Ze,G),ve.associatedRemoteMediaStreams.push(G)),I.push([Ze,Z,G]))):ve.rtpReceiver&&ve.rtpReceiver.track&&(ve.associatedRemoteMediaStreams.forEach(function(ue){var de=ue.getTracks().find(function(Le){return Le.id===ve.rtpReceiver.track.id});de&&function(Le,_e){_e.removeTrack(Le),_e.dispatchEvent(new i.MediaStreamTrackEvent("removetrack",{track:Le}))}(de,ue)}),ve.associatedRemoteMediaStreams=[]),ve.localCapabilities=yt,ve.remoteCapabilities=Lr,ve.rtpReceiver=Z,ve.rtcpParameters=xt,ve.sendEncodingParameters=Ae,ve.recvEncodingParameters=Be,f._transceive(f.transceivers[Q],!1,vt)}}),f._dtlsRole===void 0&&(f._dtlsRole=p.type==="offer"?"active":"passive"),f._remoteDescription={type:p.type,sdp:p.sdp},p.type==="offer"?f._updateSignalingState("have-remote-offer"):f._updateSignalingState("stable"),Object.keys(m).forEach(function(B){var Q=m[B];if(Q.getTracks().length){if(f.remoteStreams.indexOf(Q)===-1){f.remoteStreams.push(Q);var q=new Event("addstream");q.stream=Q,i.setTimeout(function(){f._dispatchEvent("addstream",q)})}I.forEach(function(ie){var Ae=ie[0],Be=ie[1];Q.id===ie[2].id&&c(f,Ae,Be,[Q])})}}),I.forEach(function(B){B[2]||c(f,B[0],B[1],[])}),i.setTimeout(function(){f&&f.transceivers&&f.transceivers.forEach(function(B){B.iceTransport&&B.iceTransport.state==="new"&&0<B.iceTransport.getRemoteCandidates().length&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),B.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},u.prototype.close=function(){this.transceivers.forEach(function(p){p.iceTransport&&p.iceTransport.stop(),p.dtlsTransport&&p.dtlsTransport.stop(),p.rtpSender&&p.rtpSender.stop(),p.rtpReceiver&&p.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},u.prototype._updateSignalingState=function(p){this.signalingState=p,p=new Event("signalingstatechange"),this._dispatchEvent("signalingstatechange",p)},u.prototype._maybeFireNegotiationNeeded=function(){var p=this;this.signalingState==="stable"&&this.needNegotiation!==!0&&(this.needNegotiation=!0,i.setTimeout(function(){if(p.needNegotiation){p.needNegotiation=!1;var f=new Event("negotiationneeded");p._dispatchEvent("negotiationneeded",f)}},0))},u.prototype._updateIceConnectionState=function(){var p,f={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(function(m){m.iceTransport&&!m.rejected&&f[m.iceTransport.state]++}),p="new",0<f.failed?p="failed":0<f.checking?p="checking":0<f.disconnected?p="disconnected":0<f.new?p="new":0<f.connected?p="connected":0<f.completed&&(p="completed"),p!==this.iceConnectionState&&(this.iceConnectionState=p,p=new Event("iceconnectionstatechange"),this._dispatchEvent("iceconnectionstatechange",p))},u.prototype._updateConnectionState=function(){var p,f={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(function(m){m.iceTransport&&m.dtlsTransport&&!m.rejected&&(f[m.iceTransport.state]++,f[m.dtlsTransport.state]++)}),f.connected+=f.completed,p="new",0<f.failed?p="failed":0<f.connecting?p="connecting":0<f.disconnected?p="disconnected":0<f.new?p="new":0<f.connected&&(p="connected"),p!==this.connectionState&&(this.connectionState=p,p=new Event("connectionstatechange"),this._dispatchEvent("connectionstatechange",p))},u.prototype.createOffer=function(p){var f=this;if(f._isClosed)return Promise.reject(be("InvalidStateError","Can not call createOffer after close"));var m=f.transceivers.filter(function(_){return _.kind==="audio"}).length,I=f.transceivers.filter(function(_){return _.kind==="video"}).length;if(p){if(p.mandatory||p.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");p.offerToReceiveAudio!==void 0&&(m=p.offerToReceiveAudio===!0?1:p.offerToReceiveAudio===!1?0:p.offerToReceiveAudio),p.offerToReceiveVideo!==void 0&&(I=p.offerToReceiveVideo===!0?1:p.offerToReceiveVideo===!1?0:p.offerToReceiveVideo)}for(f.transceivers.forEach(function(_){_.kind==="audio"?0>--m&&(_.wantReceive=!1):_.kind==="video"&&0>--I&&(_.wantReceive=!1)});0<m||0<I;)0<m&&(f._createTransceiver("audio"),m--),0<I&&(f._createTransceiver("video"),I--);var E=Ue.writeSessionBoilerplate(f._sdpSessionId,f._sdpSessionVersion++);return f.transceivers.forEach(function(_,S){var N=_.track,O=_.kind,B=_.mid||Ue.generateIdentifier();_.mid=B,_.iceGatherer||(_.iceGatherer=f._createIceGatherer(S,f.usingBundle)),B=i.RTCRtpSender.getCapabilities(O),15019>n&&(B.codecs=B.codecs.filter(function(Q){return Q.name!=="rtx"})),B.codecs.forEach(function(Q){Q.name==="H264"&&Q.parameters["level-asymmetry-allowed"]===void 0&&(Q.parameters["level-asymmetry-allowed"]="1"),_.remoteCapabilities&&_.remoteCapabilities.codecs&&_.remoteCapabilities.codecs.forEach(function(q){Q.name.toLowerCase()===q.name.toLowerCase()&&Q.clockRate===q.clockRate&&(Q.preferredPayloadType=q.payloadType)})}),B.headerExtensions.forEach(function(Q){(_.remoteCapabilities&&_.remoteCapabilities.headerExtensions||[]).forEach(function(q){Q.uri===q.uri&&(Q.id=q.id)})}),S=_.sendEncodingParameters||[{ssrc:1001*(2*S+1)}],N&&15019<=n&&O==="video"&&!S[0].rtx&&(S[0].rtx={ssrc:S[0].ssrc+1}),_.wantReceive&&(_.rtpReceiver=new i.RTCRtpReceiver(_.dtlsTransport,O)),_.localCapabilities=B,_.sendEncodingParameters=S}),f._config.bundlePolicy!=="max-compat"&&(E+="a=group:BUNDLE "+f.transceivers.map(function(_){return _.mid}).join(" ")+`\r
`),E+=`a=ice-options:trickle\r
`,f.transceivers.forEach(function(_,S){E+=ne(_,_.localCapabilities,"offer",_.stream,f._dtlsRole),E+=`a=rtcp-rsize\r
`,!_.iceGatherer||f.iceGatheringState==="new"||S!==0&&f.usingBundle||(_.iceGatherer.getLocalCandidates().forEach(function(N){N.component=1,E+="a="+Ue.writeCandidate(N)+`\r
`}),_.iceGatherer.state==="completed"&&(E+=`a=end-of-candidates\r
`))}),p=new i.RTCSessionDescription({type:"offer",sdp:E}),Promise.resolve(p)},u.prototype.createAnswer=function(){var p=this;if(p._isClosed)return Promise.reject(be("InvalidStateError","Can not call createAnswer after close"));if(p.signalingState!=="have-remote-offer"&&p.signalingState!=="have-local-pranswer")return Promise.reject(be("InvalidStateError","Can not call createAnswer in signalingState "+p.signalingState));var f=Ue.writeSessionBoilerplate(p._sdpSessionId,p._sdpSessionVersion++);p.usingBundle&&(f+="a=group:BUNDLE "+p.transceivers.map(function(E){return E.mid}).join(" ")+`\r
`),f+=`a=ice-options:trickle\r
`;var m=Ue.getMediaSections(p._remoteDescription.sdp).length;p.transceivers.forEach(function(E,_){if(!(_+1>m)){if(E.rejected)return E.kind==="application"?E.protocol==="DTLS/SCTP"?f+=`m=application 0 DTLS/SCTP 5000\r
`:f+="m=application 0 "+E.protocol+` webrtc-datachannel\r
`:E.kind==="audio"?f+=`m=audio 0 UDP/TLS/RTP/SAVPF 0\r
a=rtpmap:0 PCMU/8000\r
`:E.kind==="video"&&(f+=`m=video 0 UDP/TLS/RTP/SAVPF 120\r
a=rtpmap:120 VP8/90000\r
`),void(f+=`c=IN IP4 0.0.0.0\r
a=inactive\r
a=mid:`+E.mid+`\r
`);var S;E.stream&&(E.kind==="audio"?S=E.stream.getAudioTracks()[0]:E.kind==="video"&&(S=E.stream.getVideoTracks()[0]),S&&15019<=n&&E.kind==="video"&&!E.sendEncodingParameters[0].rtx&&(E.sendEncodingParameters[0].rtx={ssrc:E.sendEncodingParameters[0].ssrc+1})),_=me(E.localCapabilities,E.remoteCapabilities),!_.codecs.filter(function(N){return N.name.toLowerCase()==="rtx"}).length&&E.sendEncodingParameters[0].rtx&&delete E.sendEncodingParameters[0].rtx,f+=ne(E,_,"answer",E.stream,p._dtlsRole),E.rtcpParameters&&E.rtcpParameters.reducedSize&&(f+=`a=rtcp-rsize\r
`)}});var I=new i.RTCSessionDescription({type:"answer",sdp:f});return Promise.resolve(I)},u.prototype.addIceCandidate=function(p){var f,m=this;return p&&p.sdpMLineIndex===void 0&&!p.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(I,E){if(!m._remoteDescription)return E(be("InvalidStateError","Can not add ICE candidate without a remote description"));if(p&&p.candidate!==""){var _=p.sdpMLineIndex;if(p.sdpMid){for(var S=0;S<m.transceivers.length;S++)if(m.transceivers[S].mid===p.sdpMid){_=S;break}}var N=m.transceivers[_];if(!N)return E(be("OperationError","Can not add ICE candidate"));if(N.rejected||(S=0<Object.keys(p.candidate).length?Ue.parseCandidate(p.candidate):{},S.protocol==="tcp"&&(S.port===0||S.port===9)||S.component&&S.component!==1))return I();if((_===0||0<_&&N.iceTransport!==m.transceivers[0].iceTransport)&&!Me(N.iceTransport,S))return E(be("OperationError","Can not add ICE candidate"));E=p.candidate.trim(),E.indexOf("a=")===0&&(E=E.substr(2)),(f=Ue.getMediaSections(m._remoteDescription.sdp))[_]+="a="+(S.type?E:"end-of-candidates")+`\r
`,m._remoteDescription.sdp=Ue.getDescription(m._remoteDescription.sdp)+f.join("")}else for(_=0;_<m.transceivers.length&&(m.transceivers[_].rejected||(m.transceivers[_].iceTransport.addRemoteCandidate({}),(f=Ue.getMediaSections(m._remoteDescription.sdp))[_]+=`a=end-of-candidates\r
`,m._remoteDescription.sdp=Ue.getDescription(m._remoteDescription.sdp)+f.join(""),!m.usingBundle));_++);I()})},u.prototype.getStats=function(p){if(p&&p instanceof i.MediaStreamTrack){var f=null;if(this.transceivers.forEach(function(I){I.rtpSender&&I.rtpSender.track===p?f=I.rtpSender:I.rtpReceiver&&I.rtpReceiver.track===p&&(f=I.rtpReceiver)}),!f)throw be("InvalidAccessError","Invalid selector.");return f.getStats()}var m=[];return this.transceivers.forEach(function(I){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(E){I[E]&&m.push(I[E].getStats())})}),Promise.all(m).then(function(I){var E=new Map;return I.forEach(function(_){_.forEach(function(S){E.set(S.id,S)})}),E})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(p){if((p=i[p])&&p.prototype&&p.prototype.getStats){var f=p.prototype.getStats;p.prototype.getStats=function(){return f.apply(this).then(function(m){var I=new Map;return Object.keys(m).forEach(function(E){var _;m[E].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(_=m[E]).type]||_.type,I.set(E,m[E])}),I})}}});var h=["createOffer","createAnswer"];return h.forEach(function(p){var f=u.prototype[p];u.prototype[p]=function(){var m=arguments;return typeof m[0]=="function"||typeof m[1]=="function"?f.apply(this,[arguments[2]]).then(function(I){typeof m[0]=="function"&&m[0].apply(null,[I])},function(I){typeof m[1]=="function"&&m[1].apply(null,[I])}):f.apply(this,arguments)}}),(h=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(p){var f=u.prototype[p];u.prototype[p]=function(){var m=arguments;return typeof m[1]=="function"||typeof m[2]=="function"?f.apply(this,arguments).then(function(){typeof m[1]=="function"&&m[1].apply(null)},function(I){typeof m[2]=="function"&&m[2].apply(null,[I])}):f.apply(this,arguments)}}),["getStats"].forEach(function(p){var f=u.prototype[p];u.prototype[p]=function(){var m=arguments;return typeof m[1]=="function"?f.apply(this,arguments).then(function(){typeof m[1]=="function"&&m[1].apply(null)}):f.apply(this,arguments)}}),u},wE=Object.freeze({__proto__:null,shimPeerConnection:it,shimReplaceTrack:gr,shimGetUserMedia:Gt,shimGetDisplayMedia:At}),NE=Object.freeze({__proto__:null,shimOnTrack:Et,shimPeerConnection:ar,shimSenderGetStats:mr,shimReceiverGetStats:si,shimRemoveStream:Jn,shimRTCDataChannel:ai,shimGetUserMedia:_t,shimGetDisplayMedia:function(i,n){i.navigator.mediaDevices&&"getDisplayMedia"in i.navigator.mediaDevices||i.navigator.mediaDevices&&(i.navigator.mediaDevices.getDisplayMedia=function(s){return s&&s.video?(s.video===!0?s.video={mediaSource:n}:s.video.mediaSource=n,i.navigator.mediaDevices.getUserMedia(s)):(s=new DOMException("getDisplayMedia without video constraints is undefined"),s.name="NotFoundError",s.code=8,se.reject(s))})}}),OE=Object.freeze({__proto__:null,shimLocalStreamsAPI:rn,shimRemoteStreamsAPI:Oi,shimCallbacksAPI:mn,shimGetUserMedia:xr,shimConstraints:ci,shimRTCIceServerUrls:Ao,shimTrackEventTransceiver:vn,shimCreateOfferLegacy:xe}),tR=Object.freeze({__proto__:null,shimRTCIceCandidate:St,shimMaxMessageSize:tr,shimSendThrowTypeError:Zt,shimConnectionState:Kr,removeAllowExtmapMixed:fo});(function({window:i}={},n={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){let s=v(i),c={browserDetails:s,commonShim:tR,extractVersion:o,disableLog:l,disableWarnings:d};switch(s.browser){case"chrome":if(!_E||!P||!n.shimChrome)return A("Chrome shim is not included in this adapter release."),c;A("adapter.js shimming chrome."),c.browserShim=_E,w(i),k(i),P(i),M(i),te(i),F(i),K(i),J(i),he(i),St(i),Kr(i),tr(i),Zt(i),fo(i);break;case"firefox":if(!NE||!ar||!n.shimFirefox)return A("Firefox shim is not included in this adapter release."),c;A("adapter.js shimming firefox."),c.browserShim=NE,_t(i),ar(i),Et(i),Jn(i),mr(i),si(i),ai(i),St(i),Kr(i),tr(i),Zt(i);break;case"edge":if(!wE||!it||!n.shimEdge)return A("MS edge shim is not included in this adapter release."),c;A("adapter.js shimming edge."),c.browserShim=wE,Gt(i),At(i),it(i),gr(i),tr(i),Zt(i);break;case"safari":if(!OE||!n.shimSafari)return A("Safari shim is not included in this adapter release."),c;A("adapter.js shimming safari."),c.browserShim=OE,Ao(i),xe(i),mn(i),rn(i),Oi(i),vn(i),xr(i),St(i),tr(i),Zt(i),fo(i);break;default:A("Unsupported browser!")}})({window});var an,Xe;(function(i){i.WIN_10="Windows 10",i.WIN_81="Windows 8.1",i.WIN_8="Windows 8",i.WIN_7="Windows 7",i.WIN_VISTA="Windows Vista",i.WIN_SERVER_2003="Windows Server 2003",i.WIN_XP="Windows XP",i.WIN_2000="Windows 2000",i.ANDROID="Android",i.OPEN_BSD="Open BSD",i.SUN_OS="Sun OS",i.LINUX="Linux",i.IOS="iOS",i.MAC_OS="Mac OS",i.QNX="QNX",i.UNIX="UNIX",i.BEOS="BeOS",i.OS_2="OS/2",i.SEARCH_BOT="Search Bot"})(an||(an={})),function(i){i.CHROME="Chrome",i.SAFARI="Safari",i.EDGE="Edge",i.FIREFOX="Firefox",i.OPERA="OPR",i.QQ="QQBrowser",i.WECHAT="MicroMessenger"}(Xe||(Xe={}));let Op=new(r(function(i,n){(function(s,c){var u={extend:function(S,N){var O={},B;for(B in S)N[B]&&N[B].length%2==0?O[B]=N[B].concat(S[B]):O[B]=S[B];return O},has:function(S,N){return typeof S=="string"&&N.toLowerCase().indexOf(S.toLowerCase())!==-1},lowerize:function(S){return S.toLowerCase()},major:function(S){return typeof S=="string"?S.replace(/[^\d\.]/g,"").split(".")[0]:c},trim:function(S,N){return S=S.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),N===void 0?S:S.substring(0,255)}},h=function(S,N){for(var O,B,Q,q,ie,Ae,Be=0;Be<N.length&&!ie;){var ke=N[Be],yt=N[Be+1];for(O=B=0;O<ke.length&&!ie;)if(ie=ke[O++].exec(S))for(Q=0;Q<yt.length;Q++)Ae=ie[++B],typeof(q=yt[Q])=="object"&&0<q.length?q.length==2?typeof q[1]=="function"?this[q[0]]=q[1].call(this,Ae):this[q[0]]=q[1]:q.length==3?typeof q[1]!="function"||q[1].exec&&q[1].test?this[q[0]]=Ae?Ae.replace(q[1],q[2]):c:this[q[0]]=Ae?q[1].call(this,Ae,q[2]):c:q.length==4&&(this[q[0]]=Ae?q[3].call(this,Ae.replace(q[1],q[2])):c):this[q]=Ae||c;Be+=2}},p=function(S,N){for(var O in N)if(typeof N[O]=="object"&&0<N[O].length){for(var B=0;B<N[O].length;B++)if(u.has(N[O][B],S))return O==="?"?c:O}else if(u.has(N[O],S))return O==="?"?c:O;return S},f={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},m={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],["version",["name","Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],["version",["name","Edge"]],[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]{3,6})\b.+version\/([\w\.-]+)/i,/(opera)(?:.+version\/|[\/\s]+)([\w\.]+)/i],["name","version"],[/opios[\/\s]+([\w\.]+)/i],["version",["name","Opera Mini"]],[/\sopr\/([\w\.]+)/i],["version",["name","Opera"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]*)/i,/(avant\s|iemobile|slim)(?:browser)?[\/\s]?([\w\.]*)/i,/(ba?idubrowser)[\/\s]?([\w\.]+)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon)\/([\w\.-]+)/i,/(rekonq|puffin|brave|whale|qqbrowserlite|qq)\/([\w\.]+)/i,/(weibo)__([\d\.]+)/i],["name","version"],[/(?:[\s\/]uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],["version",["name","UCBrowser"]],[/(?:windowswechat)?\sqbcore\/([\w\.]+)\b.*(?:windowswechat)?/i],["version",["name","WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],["version",["name","WeChat"]],[/konqueror\/([\w\.]+)/i],["version",["name","Konqueror"]],[/trident.+rv[:\s]([\w\.]{1,9})\b.+like\sgecko/i],["version",["name","IE"]],[/yabrowser\/([\w\.]+)/i],["version",["name","Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[["name",/(.+)/,"$1 Secure Browser"],"version"],[/focus\/([\w\.]+)/i],["version",["name","Firefox Focus"]],[/opt\/([\w\.]+)/i],["version",["name","Opera Touch"]],[/coc_coc_browser\/([\w\.]+)/i],["version",["name","Coc Coc"]],[/dolfin\/([\w\.]+)/i],["version",["name","Dolphin"]],[/coast\/([\w\.]+)/i],["version",["name","Opera Coast"]],[/xiaomi\/miuibrowser\/([\w\.]+)/i],["version",["name","MIUI Browser"]],[/fxios\/([\w\.-]+)/i],["version",["name","Firefox"]],[/(qihu|qhbrowser|qihoobrowser|360browser)/i],[["name","360 Browser"]],[/(oculus|samsung|sailfish)browser\/([\w\.]+)/i],[["name",/(.+)/,"$1 Browser"],"version"],[/(comodo_dragon)\/([\w\.]+)/i],[["name",/_/g," "],"version"],[/\s(electron)\/([\w\.]+)\ssafari/i,/(tesla)(?:\sqtcarbrowser|\/(20[12]\d\.[\w\.-]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/\s]?([\w\.]+)/i],["name","version"],[/(MetaSr)[\/\s]?([\w\.]+)/i,/(LBBROWSER)/i],["name"],[/;fbav\/([\w\.]+);/i],["version",["name","Facebook"]],[/FBAN\/FBIOS|FB_IAB\/FB4A/i],[["name","Facebook"]],[/safari\s(line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/\s]([\w\.-]+)/i],["name","version"],[/\bgsa\/([\w\.]+)\s.*safari\//i],["version",["name","GSA"]],[/headlesschrome(?:\/([\w\.]+)|\s)/i],["version",["name","Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[["name","Chrome WebView"],"version"],[/droid.+\sversion\/([\w\.]+)\b.+(?:mobile\ssafari|safari)/i],["version",["name","Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],["name","version"],[/version\/([\w\.]+)\s.*mobile\/\w+\s(safari)/i],["version",["name","Mobile Safari"]],[/version\/([\w\.]+)\s.*(mobile\s?safari|safari)/i],["version","name"],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],["name",["version",p,{"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],["name","version"],[/(navigator|netscape)\/([\w\.-]+)/i],[["name","Netscape"],"version"],[/ile\svr;\srv:([\w\.]+)\).+firefox/i],["version",["name","Firefox Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([\w\.-]+)$/i,/(firefox)\/([\w\.]+)\s[\w\s\-]+\/[\w\.]+$/i,/(mozilla)\/([\w\.]+)\s.+rv:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]*)/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],["name","version"]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[["architecture","amd64"]],[/(ia32(?=;))/i],[["architecture",u.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[["architecture","ia32"]],[/\b(aarch64|armv?8e?l?)\b/i],[["architecture","arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[["architecture","armhf"]],[/windows\s(ce|mobile);\sppc;/i],[["architecture","arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[["architecture",/ower/,"",u.lowerize]],[/(sun4\w)[;\)]/i],[["architecture","sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?:64|(?=v(?:[1-7]|[5-7]1)l?|;|eabi))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[["architecture",u.lowerize]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[pt]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus\s10)/i],["model",["vendor","Samsung"],["type","tablet"]],[/\b((?:s[cgp]h|gt|sm)-\w+|galaxy\snexus)/i,/\ssamsung[\s-]([\w-]+)/i,/sec-(sgh\w+)/i],["model",["vendor","Samsung"],["type","mobile"]],[/\((ip(?:hone|od)[\s\w]*);/i],["model",["vendor","Apple"],["type","mobile"]],[/\((ipad);[\w\s\),;-]+apple/i,/applecoremedia\/[\w\.]+\s\((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],["model",["vendor","Apple"],["type","tablet"]],[/\b((?:agr|ags[23]|bah2?|sht?)-a?[lw]\d{2})/i],["model",["vendor","Huawei"],["type","tablet"]],[/d\/huawei([\w\s-]+)[;\)]/i,/\b(nexus\s6p|vog-[at]?l\d\d|ane-[at]?l[x\d]\d|eml-a?l\d\da?|lya-[at]?l\d[\dc]|clt-a?l\d\di?|ele-l\d\d)/i,/\b(\w{2,4}-[atu][ln][01259][019])[;\)\s]/i],["model",["vendor","Huawei"],["type","mobile"]],[/\b(poco[\s\w]+)(?:\sbuild|\))/i,/\b;\s(\w+)\sbuild\/hm\1/i,/\b(hm[\s\-_]?note?[\s_]?(?:\d\w)?)\sbuild/i,/\b(redmi[\s\-_]?(?:note|k)?[\w\s_]+)(?:\sbuild|\))/i,/\b(mi[\s\-_]?(?:a\d|one|one[\s_]plus|note lte)?[\s_]?(?:\d?\w?)[\s_]?(?:plus)?)\sbuild/i],[["model",/_/g," "],["vendor","Xiaomi"],["type","mobile"]],[/\b(mi[\s\-_]?(?:pad)(?:[\w\s_]+))(?:\sbuild|\))/i],[["model",/_/g," "],["vendor","Xiaomi"],["type","tablet"]],[/;\s(\w+)\sbuild.+\soppo/i,/\s(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007)\b/i],["model",["vendor","OPPO"],["type","mobile"]],[/\svivo\s(\w+)(?:\sbuild|\))/i,/\s(v[12]\d{3}\w?[at])(?:\sbuild|;)/i],["model",["vendor","Vivo"],["type","mobile"]],[/\s(rmx[12]\d{3})(?:\sbuild|;)/i],["model",["vendor","Realme"],["type","mobile"]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?:?(\s4g)?)\b[\w\s]+build\//i,/\smot(?:orola)?[\s-](\w*)/i,/((?:moto[\s\w\(\)]+|xt\d{3,4}|nexus\s6)(?=\sbuild|\)))/i],["model",["vendor","Motorola"],["type","mobile"]],[/\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],["model",["vendor","Motorola"],["type","tablet"]],[/((?=lg)?[vl]k\-?\d{3})\sbuild|\s3\.[\s\w;-]{10}lg?-([06cv9]{3,4})/i],["model",["vendor","LG"],["type","tablet"]],[/(lm-?f100[nv]?|nexus\s[45])/i,/lg[e;\s\/-]+((?!browser|netcast)\w+)/i,/\blg(\-?[\d\w]+)\sbuild/i],["model",["vendor","LG"],["type","mobile"]],[/(ideatab[\w\-\s]+)/i,/lenovo\s?(s(?:5000|6000)(?:[\w-]+)|tab(?:[\s\w]+)|yt[\d\w-]{6}|tb[\d\w-]{6})/i],["model",["vendor","Lenovo"],["type","tablet"]],[/(?:maemo|nokia).*(n900|lumia\s\d+)/i,/nokia[\s_-]?([\w\.-]*)/i],[["model",/_/g," "],["vendor","Nokia"],["type","mobile"]],[/droid.+;\s(pixel\sc)[\s)]/i],["model",["vendor","Google"],["type","tablet"]],[/droid.+;\s(pixel[\s\daxl]{0,6})(?:\sbuild|\))/i],["model",["vendor","Google"],["type","mobile"]],[/droid.+\s([c-g]\d{4}|so[-l]\w+|xq-a\w[4-7][12])(?=\sbuild\/|\).+chrome\/(?![1-6]{0,1}\d\.))/i],["model",["vendor","Sony"],["type","mobile"]],[/sony\stablet\s[ps]\sbuild\//i,/(?:sony)?sgp\w+(?:\sbuild\/|\))/i],[["model","Xperia Tablet"],["vendor","Sony"],["type","tablet"]],[/\s(kb2005|in20[12]5|be20[12][59])\b/i,/\ba000(1)\sbuild/i,/\boneplus\s(a\d{4})[\s)]/i],["model",["vendor","OnePlus"],["type","mobile"]],[/(alexa)webm/i,/(kf[a-z]{2}wi)(\sbuild\/|\))/i,/(kf[a-z]+)(\sbuild\/|\)).+silk\//i],["model",["vendor","Amazon"],["type","tablet"]],[/(sd|kf)[0349hijorstuw]+(\sbuild\/|\)).+silk\//i],[["model","Fire Phone"],["vendor","Amazon"],["type","mobile"]],[/\((playbook);[\w\s\),;-]+(rim)/i],["model","vendor",["type","tablet"]],[/((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10;\s(\w+)/i],["model",["vendor","BlackBerry"],["type","mobile"]],[/(?:\b|asus_)(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus\s7|padfone|p00[cj])/i],["model",["vendor","ASUS"],["type","tablet"]],[/\s(z[es]6[027][01][km][ls]|zenfone\s\d\w?)\b/i],["model",["vendor","ASUS"],["type","mobile"]],[/(nexus\s9)/i],["model",["vendor","HTC"],["type","tablet"]],[/(htc)[;_\s-]{1,2}([\w\s]+(?=\)|\sbuild)|\w+)/i,/(zte)-(\w*)/i,/(alcatel|geeksphone|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]*)/i],["vendor",["model",/_/g," "],["type","mobile"]],[/droid[x\d\.\s;]+\s([ab][1-7]\-?[0178a]\d\d?)/i],["model",["vendor","Acer"],["type","tablet"]],[/droid.+;\s(m[1-5]\snote)\sbuild/i,/\bmz-([\w-]{2,})/i],["model",["vendor","Meizu"],["type","mobile"]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]*)/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i,/(microsoft);\s(lumia[\s\w]+)/i,/(lenovo)[_\s-]?([\w-]+)/i,/linux;.+(jolla);/i,/droid.+;\s(oppo)\s?([\w\s]+)\sbuild/i],["vendor","model",["type","mobile"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i,/[;\/]\s?(le[\s\-]+pan)[\s\-]+(\w{1,9})\sbuild/i,/[;\/]\s?(trinity)[\-\s]*(t\d{3})\sbuild/i,/\b(gigaset)[\s\-]+(q\w{1,9})\sbuild/i,/\b(vodafone)\s([\w\s]+)(?:\)|\sbuild)/i],["vendor","model",["type","tablet"]],[/\s(surface\sduo)\s/i],["model",["vendor","Microsoft"],["type","tablet"]],[/droid\s[\d\.]+;\s(fp\du?)\sbuild/i],["model",["vendor","Fairphone"],["type","mobile"]],[/\s(u304aa)\sbuild/i],["model",["vendor","AT&T"],["type","mobile"]],[/sie-(\w*)/i],["model",["vendor","Siemens"],["type","mobile"]],[/[;\/]\s?(rct\w+)\sbuild/i],["model",["vendor","RCA"],["type","tablet"]],[/[;\/\s](venue[\d\s]{2,7})\sbuild/i],["model",["vendor","Dell"],["type","tablet"]],[/[;\/]\s?(q(?:mv|ta)\w+)\sbuild/i],["model",["vendor","Verizon"],["type","tablet"]],[/[;\/]\s(?:barnes[&\s]+noble\s|bn[rt])([\w\s\+]*)\sbuild/i],["model",["vendor","Barnes & Noble"],["type","tablet"]],[/[;\/]\s(tm\d{3}\w+)\sbuild/i],["model",["vendor","NuVision"],["type","tablet"]],[/;\s(k88)\sbuild/i],["model",["vendor","ZTE"],["type","tablet"]],[/;\s(nx\d{3}j)\sbuild/i],["model",["vendor","ZTE"],["type","mobile"]],[/[;\/]\s?(gen\d{3})\sbuild.*49h/i],["model",["vendor","Swiss"],["type","mobile"]],[/[;\/]\s?(zur\d{3})\sbuild/i],["model",["vendor","Swiss"],["type","tablet"]],[/[;\/]\s?((zeki)?tb.*\b)\sbuild/i],["model",["vendor","Zeki"],["type","tablet"]],[/[;\/]\s([yr]\d{2})\sbuild/i,/[;\/]\s(dragon[\-\s]+touch\s|dt)(\w{5})\sbuild/i],[["vendor","Dragon Touch"],"model",["type","tablet"]],[/[;\/]\s?(ns-?\w{0,9})\sbuild/i],["model",["vendor","Insignia"],["type","tablet"]],[/[;\/]\s?((nxa|Next)-?\w{0,9})\sbuild/i],["model",["vendor","NextBook"],["type","tablet"]],[/[;\/]\s?(xtreme_)?(v(1[045]|2[015]|[3469]0|7[05]))\sbuild/i],[["vendor","Voice"],"model",["type","mobile"]],[/[;\/]\s?(lvtel\-)?(v1[12])\sbuild/i],[["vendor","LvTel"],"model",["type","mobile"]],[/;\s(ph-1)\s/i],["model",["vendor","Essential"],["type","mobile"]],[/[;\/]\s?(v(100md|700na|7011|917g).*\b)\sbuild/i],["model",["vendor","Envizen"],["type","tablet"]],[/[;\/]\s?(trio[\s\w\-\.]+)\sbuild/i],["model",["vendor","MachSpeed"],["type","tablet"]],[/[;\/]\s?tu_(1491)\sbuild/i],["model",["vendor","Rotor"],["type","tablet"]],[/(shield[\w\s]+)\sbuild/i],["model",["vendor","Nvidia"],["type","tablet"]],[/(sprint)\s(\w+)/i],["vendor","model",["type","mobile"]],[/(kin\.[onetw]{3})/i],[["model",/\./g," "],["vendor","Microsoft"],["type","mobile"]],[/droid\s[\d\.]+;\s(cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],["model",["vendor","Zebra"],["type","tablet"]],[/droid\s[\d\.]+;\s(ec30|ps20|tc[2-8]\d[kx])\)/i],["model",["vendor","Zebra"],["type","mobile"]],[/\s(ouya)\s/i,/(nintendo)\s([wids3utch]+)/i],["vendor","model",["type","console"]],[/droid.+;\s(shield)\sbuild/i],["model",["vendor","Nvidia"],["type","console"]],[/(playstation\s[345portablevi]+)/i],["model",["vendor","Sony"],["type","console"]],[/[\s\(;](xbox(?:\sone)?(?!;\sxbox))[\s\);]/i],["model",["vendor","Microsoft"],["type","console"]],[/smart-tv.+(samsung)/i],["vendor",["type","smarttv"]],[/hbbtv.+maple;(\d+)/i],[["model",/^/,"SmartTV"],["vendor","Samsung"],["type","smarttv"]],[/(?:linux;\snetcast.+smarttv|lg\snetcast\.tv-201\d)/i],[["vendor","LG"],["type","smarttv"]],[/(apple)\s?tv/i],["vendor",["model","Apple TV"],["type","smarttv"]],[/crkey/i],[["model","Chromecast"],["vendor","Google"],["type","smarttv"]],[/droid.+aft([\w])(\sbuild\/|\))/i],["model",["vendor","Amazon"],["type","smarttv"]],[/\(dtv[\);].+(aquos)/i],["model",["vendor","Sharp"],["type","smarttv"]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[["vendor",u.trim],["model",u.trim],["type","smarttv"]],[/[\s\/\(](android\s|smart[-\s]?|opera\s)tv[;\)\s]/i],[["type","smarttv"]],[/((pebble))app\/[\d\.]+\s/i],["vendor","model",["type","wearable"]],[/droid.+;\s(glass)\s\d/i],["model",["vendor","Google"],["type","wearable"]],[/droid\s[\d\.]+;\s(wt63?0{2,3})\)/i],["model",["vendor","Zebra"],["type","wearable"]],[/(tesla)(?:\sqtcarbrowser|\/20[12]\d\.[\w\.-]+)/i],["vendor",["type","embedded"]],[/droid .+?; ([^;]+?)(?: build|\) applewebkit).+? mobile safari/i],["model",["type","mobile"]],[/droid .+?;\s([^;]+?)(?: build|\) applewebkit).+?(?! mobile) safari/i],["model",["type","tablet"]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[["type",u.lowerize]],[/(android[\w\.\s\-]{0,9});.+build/i],["model",["vendor","Generic"]],[/(phone)/i],[["type","mobile"]]],engine:[[/windows.+\sedge\/([\w\.]+)/i],["version",["name","EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],["version",["name","Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],["name","version"],[/rv:([\w\.]{1,9})\b.+(gecko)/i],["version","name"]],os:[[/microsoft\s(windows)\s(vista|xp)/i],["name","version"],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s\w]*)/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)(?!.+xbox)/i],["name",["version",p,f]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[["name","Windows"],["version",p,f]],[/ip[honead]{2,4}\b(?:.*os\s([\w]+)\slike\smac|;\sopera)/i,/cfnetwork\/.+darwin/i],[["version",/_/g,"."],["name","iOS"]],[/(mac\sos\sx)\s?([\w\s\.]*)/i,/(macintosh|mac(?=_powerpc)\s)(?!.+haiku)/i],[["name","Mac OS"],["version",/_/g,"."]],[/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|sailfish|contiki)[\/\s-]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/\s]([\w\.]+)/i,/\((series40);/i],["name","version"],[/\(bb(10);/i],["version",["name","BlackBerry"]],[/(?:symbian\s?os|symbos|s60(?=;)|series60)[\/\s-]?([\w\.]*)/i],["version",["name","Symbian"]],[/mozilla.+\(mobile;.+gecko.+firefox/i],[["name","Firefox OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],["version",["name","webOS"]],[/crkey\/([\d\.]+)/i],["version",["name","Chromecast"]],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[["name","Chromium OS"],"version"],[/(nintendo|playstation)\s([wids345portablevuch]+)/i,/(xbox);\s+xbox\s([^\);]+)/i,/(mint)[\/\s\(\)]?(\w*)/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?=\slinux)|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus|raspbian)(?:\sgnu\/linux)?(?:\slinux)?[\/\s-]?(?!chrom|package)([\w\.-]*)/i,/(hurd|linux)\s?([\w\.]*)/i,/(gnu)\s?([\w\.]*)/i,/\s([frentopc-]{0,4}bsd|dragonfly)\s?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku)\s(\w+)/i],["name","version"],[/(sunos)\s?([\w\.\d]*)/i],[["name","Solaris"],"version"],[/((?:open)?solaris)[\/\s-]?([\w\.]*)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.])*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms|fuchsia)/i,/(unix)\s?([\w\.]*)/i],["name","version"]]},I=function(S,N){if(typeof S=="object"&&(N=S,S=c),!(this instanceof I))return new I(S,N).getResult();var O=S||(s!==void 0&&s.navigator&&s.navigator.userAgent?s.navigator.userAgent:""),B=N?u.extend(m,N):m;return this.getBrowser=function(){var Q={name:c,version:c};return h.call(Q,O,B.browser),Q.major=u.major(Q.version),Q},this.getCPU=function(){var Q={architecture:c};return h.call(Q,O,B.cpu),Q},this.getDevice=function(){var Q={vendor:c,model:c,type:c};return h.call(Q,O,B.device),Q},this.getEngine=function(){var Q={name:c,version:c};return h.call(Q,O,B.engine),Q},this.getOS=function(){var Q={name:c,version:c};return h.call(Q,O,B.os),Q},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return O},this.setUA=function(Q){return O=typeof Q=="string"&&255<Q.length?u.trim(Q,255):Q,this},this.setUA(O),this};I.VERSION="0.7.28",I.BROWSER={NAME:"name",MAJOR:"major",VERSION:"version"},I.CPU={ARCHITECTURE:"architecture"},I.DEVICE={MODEL:"model",VENDOR:"vendor",TYPE:"type",CONSOLE:"console",MOBILE:"mobile",SMARTTV:"smarttv",TABLET:"tablet",WEARABLE:"wearable",EMBEDDED:"embedded"},I.ENGINE={NAME:"name",VERSION:"version"},I.OS={NAME:"name",VERSION:"version"},i.exports&&(n=i.exports=I),n.UAParser=I;var E=s!==void 0&&(s.jQuery||s.Zepto);if(E&&!E.ua){var _=new I;E.ua=_.getResult(),E.ua.get=function(){return _.getUA()},E.ua.set=function(S){_.setUA(S),S=_.getResult();for(var N in S)E.ua[N]=S[N]}}})(typeof window=="object"?window:qc)})),En=Op.getResult(),Xn=function(i){if(i.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return i;var n=i.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(n&&n[1]&&n[2]){var s,c=n[2];return b(s="".concat(n[1],".")).call(s,c)}return(n=i.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/))&&n[1]&&n[2]?(s=n[2],b(c="".concat(n[1],".")).call(c,100*(Number(s)+1))):"4.0.0.999"}("4.7.2");try{var kE=JSON.parse("true")===!0}catch{kE=!0}let kp=kE,Fr={username:"test",password:"111111",turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1},rR={"90p":Ve(160,90),"90p_1":Ve(160,90),"120p":Ve(160,120,15,30,65),"120p_1":Ve(160,120,15,30,65),"120p_3":Ve(120,120,15,30,50),"120p_4":Ve(212,120),"180p":Ve(320,180,15,30,140),"180p_1":Ve(320,180,15,30,140),"180p_3":Ve(180,180,15,30,100),"180p_4":Ve(240,180,15,30,120),"240p":Ve(320,240,15,40,200),"240p_1":Ve(320,240,15,40,200),"240p_3":Ve(240,240,15,40,140),"240p_4":Ve(424,240,15,40,220),"360p":Ve(640,360,15,80,400),"360p_1":Ve(640,360,15,80,400),"360p_3":Ve(360,360,15,80,260),"360p_4":Ve(640,360,30,80,600),"360p_6":Ve(360,360,30,80,400),"360p_7":Ve(480,360,15,80,320),"360p_8":Ve(480,360,30,80,490),"360p_9":Ve(640,360,15,80,800),"360p_10":Ve(640,360,24,80,800),"360p_11":Ve(640,360,24,80,1e3),"480p":Ve(640,480,15,100,500),"480p_1":Ve(640,480,15,100,500),"480p_2":Ve(640,480,30,100,1e3),"480p_3":Ve(480,480,15,100,400),"480p_4":Ve(640,480,30,100,750),"480p_6":Ve(480,480,30,100,600),"480p_8":Ve(848,480,15,100,610),"480p_9":Ve(848,480,30,100,930),"480p_10":Ve(640,480,10,100,400),"720p":Ve(1280,720,15,120,1130),"720p_1":Ve(1280,720,15,120,1130),"720p_2":Ve(1280,720,30,120,2e3),"720p_3":Ve(1280,720,30,120,1710),"720p_5":Ve(960,720,15,120,910),"720p_6":Ve(960,720,30,120,1380),"1080p":Ve(1920,1080,15,120,2080),"1080p_1":Ve(1920,1080,15,120,2080),"1080p_2":Ve(1920,1080,30,120,3e3),"1080p_3":Ve(1920,1080,30,120,3150),"1080p_5":Ve(1920,1080,60,120,4780),"1440p":Ve(2560,1440,30,120,4850),"1440p_1":Ve(2560,1440,30,120,4850),"1440p_2":Ve(2560,1440,60,120,7350),"4k":Ve(3840,2160,30,120,8910),"4k_1":Ve(3840,2160,30,120,8910),"4k_3":Ve(3840,2160,60,120,13500)},nR={"480p":X(640,480,5),"480p_1":X(640,480,5),"480p_2":X(640,480,30),"480p_3":X(640,480,15),"720p":X(1280,720,5),"720p_1":X(1280,720,5),"720p_2":X(1280,720,30),"720p_3":X(1280,720,15),"1080p":X(1920,1080,5),"1080p_1":X(1920,1080,5),"1080p_2":X(1920,1080,30),"1080p_3":X(1920,1080,15)},iR={"1SL1TL":we(1,1),"3SL3TL":we(3,3),"2SL3TL":we(2,3)},oR={speech_low_quality:ls(16e3,!1),speech_standard:ls(32e3,!1,18),music_standard:ls(48e3,!1),standard_stereo:ls(48e3,!0,56),high_quality:ls(48e3,!1,128),high_quality_stereo:ls(48e3,!0,192)},re={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,HTTP_CONNECT_TIMEOUT:5e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_TIMEOUT:1e4,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],FILEPATH_LENMAX:255,SUBSCRIBE_TCC:!0,PING_PONG_TIME_OUT:10,DUALSTREAM_OPERATION_CHECK:!0,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,MEDIA_ELEMENT_EXISTS_DEPTH:3,CANDIDATE_TIMEOUT:5e3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,SHOW_REPORT_INVOKER_LOG:!1,STATS_FILTER:{transportId:!0,googTrackId:!0},JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,ENUMERATE_DEVICES_INTERVAL:!0};kp||(re.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],re.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],re.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],re.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],re.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],re.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],re.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",re.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",re.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",re.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",re.AREAS=["NORTH_AMERICA","OVERSEA"]);let sR=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Ko=[],gs=[];var bp=[],bE=bp.sort,aR=cr(function(){bp.sort(void 0)}),cR=cr(function(){bp.sort(null)}),lR=Xs("sort");Ge({target:"Array",proto:!0,forced:aR||!cR||lR},{sort:function(i){return i===void 0?bE.call(Li(this)):bE.call(Li(this),$i(i))}});var uR=ur("Array").sort,DE=Array.prototype,sl=function(i){var n=i.sort;return i===DE||i instanceof Array&&n===DE.sort?uR:n};Ge({target:"Array",stat:!0},{isArray:Ks});var D,to=Qt.Array.isArray;(function(i){i.UNEXPECTED_ERROR="UNEXPECTED_ERROR",i.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",i.TIMEOUT="TIMEOUT",i.INVALID_PARAMS="INVALID_PARAMS",i.NOT_READABLE="NOT_READABLE",i.NOT_SUPPORTED="NOT_SUPPORTED",i.INVALID_OPERATION="INVALID_OPERATION",i.OPERATION_ABORTED="OPERATION_ABORTED",i.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",i.NETWORK_ERROR="NETWORK_ERROR",i.NETWORK_TIMEOUT="NETWORK_TIMEOUT",i.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",i.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",i.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",i.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",i.ELECTRON_IS_NULL="ELECTRON_IS_NULL",i.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",i.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",i.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",i.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",i.PERMISSION_DENIED="PERMISSION_DENIED",i.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",i.TRACK_IS_DISABLED="TRACK_IS_DISABLED",i.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",i.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",i.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",i.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",i.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",i.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",i.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",i.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",i.UID_CONFLICT="UID_CONFLICT",i.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",i.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",i.INVALID_TRACK="INVALID_TRACK",i.SENDER_NOT_FOUND="SENDER_NOT_FOUND",i.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",i.SET_ANSWER_FAILED="SET_ANSWER_FAILED",i.ICE_FAILED="ICE_FAILED",i.PC_CLOSED="PC_CLOSED",i.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",i.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",i.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",i.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",i.CAN_NOT_PUBLISH_MULTIPLE_AUDIO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_AUDIO_TRACKS",i.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",i.INVALID_REMOTE_USER="INVALID_REMOTE_USER",i.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",i.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",i.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",i.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",i.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",i.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",i.WS_ABORT="WS_ABORT",i.WS_DISCONNECT="WS_DISCONNECT",i.WS_ERR="WS_ERR",i.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",i.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",i.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",i.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",i.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",i.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",i.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",i.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",i.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",i.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",i.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",i.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",i.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",i.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",i.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",i.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",i.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",i.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",i.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",i.INVALID_PLUGIN="INVALID_PLUGIN"})(D||(D={}));var dR=[].slice,hR=/MSIE .\./.test(zc),BE=function(i){return function(n,s){var c=2<arguments.length,u=c?dR.call(arguments,2):void 0;return i(c?function(){(typeof n=="function"?n:Function(n)).apply(this,u)}:n,s)}};Ge({global:!0,bind:!0,forced:hR},{setTimeout:BE(je.setTimeout),setInterval:BE(je.setInterval)});var pi=Qt.setTimeout;Ge({target:"Date",stat:!0},{now:function(){return new Date().getTime()}});var le=Qt.Date.now,LE=function(i,n){return function(){for(var s=Array(arguments.length),c=0;c<s.length;c++)s[c]=arguments[c];return i.apply(n,s)}},za=Object.prototype.toString,Ke={isArray:Ye,isArrayBuffer:function(i){return za.call(i)==="[object ArrayBuffer]"},isBuffer:function(i){return i!=null&&i.constructor!=null&&typeof i.constructor.isBuffer=="function"&&i.constructor.isBuffer(i)},isFormData:function(i){return typeof FormData!="undefined"&&i instanceof FormData},isArrayBufferView:function(i){return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?ArrayBuffer.isView(i):i&&i.buffer&&i.buffer instanceof ArrayBuffer},isString:function(i){return typeof i=="string"},isNumber:function(i){return typeof i=="number"},isObject:Dt,isUndefined:function(i){return i===void 0},isDate:function(i){return za.call(i)==="[object Date]"},isFile:function(i){return za.call(i)==="[object File]"},isBlob:function(i){return za.call(i)==="[object Blob]"},isFunction:ft,isStream:function(i){return Dt(i)&&ft(i.pipe)},isURLSearchParams:function(i){return typeof URLSearchParams!="undefined"&&i instanceof URLSearchParams},isStandardBrowserEnv:function(){return(typeof navigator=="undefined"||navigator.product!=="ReactNative"&&navigator.product!=="NativeScript"&&navigator.product!=="NS")&&typeof window!="undefined"&&typeof document!="undefined"},forEach:Nr,merge:function i(){function n(h,p){typeof s[p]=="object"&&typeof h=="object"?s[p]=i(s[p],h):s[p]=h}for(var s={},c=0,u=arguments.length;c<u;c++)Nr(arguments[c],n);return s},deepMerge:function i(){function n(h,p){typeof s[p]=="object"&&typeof h=="object"?s[p]=i(s[p],h):s[p]=typeof h=="object"?i({},h):h}for(var s={},c=0,u=arguments.length;c<u;c++)Nr(arguments[c],n);return s},extend:function(i,n,s){return Nr(n,function(c,u){i[u]=s&&typeof c=="function"?LE(c,s):c}),i},trim:function(i){return i.replace(/^\s*/,"").replace(/\s*$/,"")}},ME=function(i,n,s){if(!n)return i;if(s)n=s(n);else if(Ke.isURLSearchParams(n))n=n.toString();else{var c=[];Ke.forEach(n,function(u,h){u!=null&&(Ke.isArray(u)?h+="[]":u=[u],Ke.forEach(u,function(p){Ke.isDate(p)?p=p.toISOString():Ke.isObject(p)&&(p=JSON.stringify(p)),c.push(Ln(h)+"="+Ln(p))}))}),n=c.join("&")}return n&&(s=i.indexOf("#"),s!==-1&&(i=i.slice(0,s)),i+=(i.indexOf("?")===-1?"?":"&")+n),i};zi.prototype.use=function(i,n){return this.handlers.push({fulfilled:i,rejected:n}),this.handlers.length-1},zi.prototype.eject=function(i){this.handlers[i]&&(this.handlers[i]=null)},zi.prototype.forEach=function(i){Ke.forEach(this.handlers,function(n){n!==null&&i(n)})};var PE=zi,Dp=function(i,n,s){return Ke.forEach(s,function(c){i=c(i,n)}),i},QE=function(i){return!(!i||!i.__CANCEL__)},xE=function(i,n){Ke.forEach(i,function(s,c){c!==n&&c.toUpperCase()===n.toUpperCase()&&(i[n]=s,delete i[c])})},Ju=function(i,n,s,c,u){return function(h,p,f,m,I){return h.config=p,f&&(h.code=f),h.request=m,h.response=I,h.isAxiosError=!0,h.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},h}(Error(i),n,s,c,u)},pR="age authorization content-length content-type etag expires from host if-modified-since if-unmodified-since last-modified location max-forwards proxy-authorization referer retry-after user-agent".split(" "),AR=Ke.isStandardBrowserEnv()?function(){function i(u){return s&&(c.setAttribute("href",u),u=c.href),c.setAttribute("href",u),{href:c.href,protocol:c.protocol?c.protocol.replace(/:$/,""):"",host:c.host,search:c.search?c.search.replace(/^\?/,""):"",hash:c.hash?c.hash.replace(/^#/,""):"",hostname:c.hostname,port:c.port,pathname:c.pathname.charAt(0)==="/"?c.pathname:"/"+c.pathname}}var n,s=/(msie|trident)/i.test(navigator.userAgent),c=document.createElement("a");return n=i(window.location.href),function(u){return u=Ke.isString(u)?i(u):u,u.protocol===n.protocol&&u.host===n.host}}():function(){return!0},fR=Ke.isStandardBrowserEnv()?{write:function(i,n,s,c,u,h){var p=[];p.push(i+"="+encodeURIComponent(n)),Ke.isNumber(s)&&p.push("expires="+new Date(s).toGMTString()),Ke.isString(c)&&p.push("path="+c),Ke.isString(u)&&p.push("domain="+u),h===!0&&p.push("secure"),document.cookie=p.join("; ")},read:function(i){return(i=document.cookie.match(new RegExp("(^|;\\s*)("+i+")=([^;]*)")))?decodeURIComponent(i[3]):null},remove:function(i){this.write(i,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},gR=function(i){return new Promise(function(n,s){var c=i.data,u=i.headers;Ke.isFormData(c)&&delete u["Content-Type"];var h=new XMLHttpRequest;if(i.auth&&(u.Authorization="Basic "+btoa((i.auth.username||"")+":"+(i.auth.password||""))),h.open(i.method.toUpperCase(),ME(i.url,i.params,i.paramsSerializer),!0),h.timeout=i.timeout,h.onreadystatechange=function(){if(h&&h.readyState===4&&(h.status!==0||h.responseURL&&h.responseURL.indexOf("file:")===0)){var f,m,I,E,_,S="getAllResponseHeaders"in h?(f=h.getAllResponseHeaders(),_={},f&&Ke.forEach(f.split(`
`),function(N){E=N.indexOf(":"),m=Ke.trim(N.substr(0,E)).toLowerCase(),I=Ke.trim(N.substr(E+1)),!m||_[m]&&0<=pR.indexOf(m)||(_[m]=m==="set-cookie"?(_[m]?_[m]:[]).concat([I]):_[m]?_[m]+", "+I:I)}),_):null;(function(N,O,B){var Q=B.config.validateStatus;!Q||Q(B.status)?N(B):O(Ju("Request failed with status code "+B.status,B.config,null,B.request,B))})(n,s,{data:i.responseType&&i.responseType!=="text"?h.response:h.responseText,status:h.status,statusText:h.statusText,headers:S,config:i,request:h}),h=null}},h.onabort=function(){h&&(s(Ju("Request aborted",i,"ECONNABORTED",h)),h=null)},h.onerror=function(){s(Ju("Network Error",i,null,h)),h=null},h.ontimeout=function(){s(Ju("timeout of "+i.timeout+"ms exceeded",i,"ECONNABORTED",h)),h=null},Ke.isStandardBrowserEnv()){var p=(i.withCredentials||AR(i.url))&&i.xsrfCookieName?fR.read(i.xsrfCookieName):void 0;p&&(u[i.xsrfHeaderName]=p)}if("setRequestHeader"in h&&Ke.forEach(u,function(f,m){c===void 0&&m.toLowerCase()==="content-type"?delete u[m]:h.setRequestHeader(m,f)}),i.withCredentials&&(h.withCredentials=!0),i.responseType)try{h.responseType=i.responseType}catch(f){if(i.responseType!=="json")throw f}typeof i.onDownloadProgress=="function"&&h.addEventListener("progress",i.onDownloadProgress),typeof i.onUploadProgress=="function"&&h.upload&&h.upload.addEventListener("progress",i.onUploadProgress),i.cancelToken&&i.cancelToken.promise.then(function(f){h&&(h.abort(),s(f),h=null)}),c===void 0&&(c=null),h.send(c)})},mR={"Content-Type":"application/x-www-form-urlencoded"},zu={adapter:function(){var i;return(typeof process!="undefined"&&Object.prototype.toString.call(process)==="[object process]"||typeof XMLHttpRequest!="undefined")&&(i=gR),i}(),transformRequest:[function(i,n){return xE(n,"Accept"),xE(n,"Content-Type"),Ke.isFormData(i)||Ke.isArrayBuffer(i)||Ke.isBuffer(i)||Ke.isStream(i)||Ke.isFile(i)||Ke.isBlob(i)?i:Ke.isArrayBufferView(i)?i.buffer:Ke.isURLSearchParams(i)?(Fc(n,"application/x-www-form-urlencoded;charset=utf-8"),i.toString()):Ke.isObject(i)?(Fc(n,"application/json;charset=utf-8"),JSON.stringify(i)):i}],transformResponse:[function(i){if(typeof i=="string")try{i=JSON.parse(i)}catch{}return i}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(i){return 200<=i&&300>i},headers:{common:{Accept:"application/json, text/plain, */*"}}};Ke.forEach(["delete","get","head"],function(i){zu.headers[i]={}}),Ke.forEach(["post","put","patch"],function(i){zu.headers[i]=Ke.merge(mR)});var vR=function(i){var n,s;return i.cancelToken&&i.cancelToken.throwIfRequested(),i.baseURL&&!/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(i.url)&&(i.url=(n=i.baseURL,(s=i.url)?n.replace(/\/+$/,"")+"/"+s.replace(/^\/+/,""):n)),i.headers=i.headers||{},i.data=Dp(i.data,i.headers,i.transformRequest),i.headers=Ke.merge(i.headers.common||{},i.headers[i.method]||{},i.headers||{}),Ke.forEach("delete get head post put patch common".split(" "),function(c){delete i.headers[c]}),(i.adapter||zu.adapter)(i).then(function(c){return i.cancelToken&&i.cancelToken.throwIfRequested(),c.data=Dp(c.data,c.headers,i.transformResponse),c},function(c){return QE(c)||(i.cancelToken&&i.cancelToken.throwIfRequested(),c&&c.response&&(c.response.data=Dp(c.response.data,c.response.headers,i.transformResponse))),Promise.reject(c)})},Bp=function(i,n){n=n||{};var s={};return Ke.forEach(["url","method","params","data"],function(c){n[c]!==void 0&&(s[c]=n[c])}),Ke.forEach(["headers","auth","proxy"],function(c){Ke.isObject(n[c])?s[c]=Ke.deepMerge(i[c],n[c]):n[c]!==void 0?s[c]=n[c]:Ke.isObject(i[c])?s[c]=Ke.deepMerge(i[c]):i[c]!==void 0&&(s[c]=i[c])}),Ke.forEach("baseURL transformRequest transformResponse paramsSerializer timeout withCredentials adapter responseType xsrfCookieName xsrfHeaderName onUploadProgress onDownloadProgress maxContentLength validateStatus maxRedirects httpAgent httpsAgent cancelToken socketPath".split(" "),function(c){n[c]!==void 0?s[c]=n[c]:i[c]!==void 0&&(s[c]=i[c])}),s};li.prototype.request=function(i,n){typeof i=="string"?(i=n||{}).url=i:i=i||{},(i=Bp(this.defaults,i)).method=i.method?i.method.toLowerCase():"get";var s=[vR,void 0];for(i=Promise.resolve(i),this.interceptors.request.forEach(function(c){s.unshift(c.fulfilled,c.rejected)}),this.interceptors.response.forEach(function(c){s.push(c.fulfilled,c.rejected)});s.length;)i=i.then(s.shift(),s.shift());return i},li.prototype.getUri=function(i){return i=Bp(this.defaults,i),ME(i.url,i.params,i.paramsSerializer).replace(/^\?/,"")},Ke.forEach(["delete","get","head","options"],function(i){li.prototype[i]=function(n,s){return this.request(Ke.merge(s||{},{method:i,url:n}))}}),Ke.forEach(["post","put","patch"],function(i){li.prototype[i]=function(n,s,c){return this.request(Ke.merge(c||{},{method:i,url:n,data:s}))}});var Xu=li;Vs.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},Vs.prototype.__CANCEL__=!0;var UE=Vs;Uo.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},Uo.source=function(){var i;return{token:new Uo(function(n){i=n}),cancel:i}};var yo=Fo(zu);yo.Axios=Xu,yo.create=function(i){return Fo(Bp(yo.defaults,i))},yo.Cancel=UE,yo.CancelToken=Uo,yo.isCancel=QE,yo.all=function(i){return Promise.all(i)},yo.spread=function(i){return function(n){return i.apply(null,n)}};var _o=yo.default=yo;let Mi={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},FE=le(),VE=i=>{for(const n in Mi)if(Object.prototype.hasOwnProperty.call(Mi,n)&&Mi[n]===i)return n;return"DEFAULT"},R=new class{constructor(){this.logLevel=Mi.DEBUG,this.uploadState="collecting",this.uploadLogWaitingList=[],this.uploadLogUploadingList=[],this.currentLogID=this.uploadErrorCount=0}debug(...i){var n;i=b(n=[Mi.DEBUG]).call(n,i),this.log.apply(this,i)}info(...i){var n;i=b(n=[Mi.INFO]).call(n,i),this.log.apply(this,i)}warning(...i){var n;i=b(n=[Mi.WARNING]).call(n,i),this.log.apply(this,i)}error(...i){var n;i=b(n=[Mi.ERROR]).call(n,i),this.log.apply(this,i)}setLogLevel(i){this.logLevel=i=Math.min(Math.max(0,i),4)}enableLogUpload(){Wr("UPLOAD_LOG",!0)}disableLogUpload(){Wr("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(i){this.proxyServerURL=i}log(...i){var n,s,c,u;if(100>le()-FE)return void pi(()=>{this.log(...i)},le()-FE);const h=Math.max(0,Math.min(4,i[0]));if(i[0]=vu()+" Agora-SDK [".concat(VE(h),"]:"),this.appendLogToWaitingList(h,i),!(h<this.logLevel)){var p=vu()+" %cAgora-SDK [".concat(VE(h),"]:"),f=[];switch(h){case Mi.DEBUG:f=b(n=[p,"color: #64B5F6;"]).call(n,Ur(i).call(i,1)),console.log.apply(console,f);break;case Mi.INFO:f=b(s=[p,"color: #1E88E5; font-weight: bold;"]).call(s,Ur(i).call(i,1)),console.log.apply(console,f);break;case Mi.WARNING:f=b(c=[p,"color: #FB8C00; font-weight: bold;"]).call(c,Ur(i).call(i,1)),console.warn.apply(console,f);break;case Mi.ERROR:f=b(u=[p,"color: #B00020; font-weight: bold;"]).call(u,Ur(i).call(i,1)),console.error.apply(console,f)}}}appendLogToWaitingList(i,...n){if(re.UPLOAD_LOG){var s="";H(n).call(n,c=>{typeof c=="object"&&(c=pe(c)),s+="".concat(c," ")}),this.uploadLogWaitingList.push({payload_str:s,log_level:i,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){var i,n={sdk_version:Xn,process_id:re.PROCESS_ID,payload:pe(this.uploadLogUploadingList)};if(n=await _o.post(this.url||(this.proxyServerURL?b(i="https://".concat(this.proxyServerURL,"/ls/?h=")).call(i,re.LOG_UPLOAD_SERVER,"&p=443&d=upload/v1"):"https://".concat(re.LOG_UPLOAD_SERVER,"/upload/v1")),n,{responseType:"text"}),n.data!=="OK")throw Error("unexpected upload log response: "+n.data);this.uploadLogUploadingList=[]}uploadLogInterval(){if(this.uploadLogUploadingList.length!==0||this.uploadLogWaitingList.length!==0){var i;this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=qr(i=this.uploadLogWaitingList).call(i,0,10)),this.uploadLogs().then(()=>{this.uploadErrorCount=0,0<this.uploadLogWaitingList.length&&window.setTimeout(()=>this.uploadLogInterval(),3e3)}).catch(n=>{this.uploadErrorCount+=1,2>this.uploadErrorCount?window.setTimeout(()=>this.uploadLogInterval(),200):window.setTimeout(()=>this.uploadLogInterval(),1e3)})}}};class L{constructor(n,s="",c){var u;this.name="AgoraRTCException",this.code=n,this.message=b(u="AgoraRTCError ".concat(this.code,": ")).call(u,s),this.data=c}toString(){var n;return this.data?b(n="".concat(this.message," data: ")).call(n,pe(this.data)):this.message}print(n="error"){return n==="error"&&R.error(this.toString()),n==="warning"&&R.warning(this.toString()),this}throw(){throw this.print(),this}}var GE,Vr;(function(i){i.FREE="free",i.UPLOADING="uploading"})(GE||(GE={})),function(i){i.NONE="none",i.INIT="init",i.CANPLAY="canplay",i.PLAYING="playing",i.PAUSED="paused",i.SUSPEND="suspend",i.STALLED="stalled",i.WAITING="waiting",i.ERROR="error",i.DESTROYED="destroyed",i.ABORT="abort",i.ENDED="ended",i.EMPTIED="emptied"}(Vr||(Vr={})),Ge({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991}),Ge({target:"Number",stat:!0},{MIN_SAFE_INTEGER:-9007199254740991});let ER={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};var Jr,zt,jE,Re,Te,ea,Wo,Xa,al,$n,zr,Ne,Je,Pn,vr,$e,wt,Pi,mt,Oe,Qi;(function(i){i.PUBLISH="publish",i.SUBSCRIBE="subscribe",i.SESSION_INIT="session_init",i.JOIN_CHOOSE_SERVER="join_choose_server",i.REQ_USER_ACCOUNT="req_user_account",i.JOIN_GATEWAY="join_gateway",i.STREAM_SWITCH="stream_switch",i.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",i.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",i.FIRST_VIDEO_RECEIVED="first_video_received",i.FIRST_AUDIO_RECEIVED="first_audio_received",i.FIRST_VIDEO_DECODE="first_video_decode",i.FIRST_AUDIO_DECODE="first_audio_decode",i.ON_ADD_AUDIO_STREAM="on_add_audio_stream",i.ON_ADD_VIDEO_STREAM="on_add_video_stream",i.ON_UPDATE_STREAM="on_update_stream",i.ON_REMOVE_STREAM="on_remove_stream",i.USER_ANALYTICS="req_user_analytics"})(Jr||(Jr={})),function(i){i.SESSION="io.agora.pb.Wrtc.Session",i.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",i.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",i.JOIN_GATEWAT="io.agora.pb.Wrtc.JoinGateway",i.PUBLISH="io.agora.pb.Wrtc.Publish",i.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",i.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",i.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",i.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",i.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",i.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",i.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",i.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",i.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",i.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",i.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",i.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",i.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",i.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",i.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",i.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",i.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",i.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",i.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",i.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",i.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",i.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics"}(zt||(zt={})),function(i){i[i.WORKER_EVENT=156]="WORKER_EVENT",i[i.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}(jE||(jE={})),function(i){i.CREATE_CLIENT="createClient",i.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",i.SET_AREA="setArea",i.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",i.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",i.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",i.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",i.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",i.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",i.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",i.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",i.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",i.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",i.START_PROXY_SERVER="Client.startProxyServer",i.STOP_PROXY_SERVER="Client.stopProxyServer",i.SET_PROXY_SERVER="Client.setProxyServer",i.SET_TURN_SERVER="Client.setTurnServer",i.SET_CLIENT_ROLE="Client.setClientRole",i.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",i.ENABLE_DUAL_STREAM="Client.enableDualStream",i.DISABLE_DUAL_STREAM="Client.disableDualStream",i.JOIN="Client.join",i.LEAVE="Client.leave",i.PUBLISH="Client.publish",i.UNPUBLISH="Client.unpublish",i.SUBSCRIBE="Client.subscribe",i.UNSUBSCRIBE="Client.unsubscribe",i.RENEW_TOKEN="Client.renewToken",i.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",i.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",i.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",i.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",i.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",i.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",i.START_LIVE_STREAMING="Client.startLiveStreaming",i.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",i.STOP_LIVE_STREAMING="Client.stopLiveStreaming",i.ADD_INJECT_STREAM_URL="Client.addInjectStreamUrl",i.REMOVE_INJECT_STREAM_URL="Client.removeInjectStreamUrl",i.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",i.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",i.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",i.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",i.SET_CONFIG_DISTRIBUTE="_configDistribute",i.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",i.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",i.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",i.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",i.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",i.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",i.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",i.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",i.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",i.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",i.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",i.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",i.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",i.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",i.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",i.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",i.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",i.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",i.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",i.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",i.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",i.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",i.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",i.STREAM_TYPE_CHANGE="streamTypeChange"}(Re||(Re={})),(Te||(Te={})).TRACER="tracer",function(i){i.IDLE="IDLE",i.INITING="INITING",i.INITEND="INITEND"}(ea||(ea={})),function(i){i.STATE_CHANGE="state_change",i.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",i.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",i.CAMERA_DEVICE_CHANGED="cameraDeviceChanged"}(Wo||(Wo={})),function(i){i[i.ACCESS_POINT=101]="ACCESS_POINT",i[i.UNILBS=201]="UNILBS",i[i.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR"}(Xa||(Xa={})),function(i){i[i.IIIEGAL_APPID=1]="IIIEGAL_APPID",i[i.IIIEGAL_UID=2]="IIIEGAL_UID",i[i.INTERNAL_ERROR=3]="INTERNAL_ERROR"}(al||(al={})),function(i){i[i.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",i[i.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",i[i.INTERNAL_ERROR=8]="INTERNAL_ERROR",i[i.NO_AUTHORIZED=9]="NO_AUTHORIZED",i[i.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",i[i.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",i[i.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",i[i.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",i[i.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",i[i.USER_OVERLOAD=16]="USER_OVERLOAD",i[i.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",i[i.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND"}($n||($n={})),function(i){i[i.NO_FLAG_SET=100]="NO_FLAG_SET",i[i.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",i[i.INVALID_FALG_SET=102]="INVALID_FALG_SET",i[i.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",i[i.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",i[i.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",i[i.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",i[i.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",i[i.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",i[i.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",i[i.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",i[i.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",i[i.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",i[i.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",i[i.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",i[i.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",i[i.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV"}(zr||(zr={})),function(i){i[i.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",i[i.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",i[i.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",i[i.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",i[i.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",i[i.K_TICKET_INVALID=7]="K_TICKET_INVALID",i[i.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",i[i.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",i[i.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",i[i.K_UID_BANNED=14]="K_UID_BANNED",i[i.K_IP_BANNED=15]="K_IP_BANNED",i[i.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",i[i.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",i[i.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",i[i.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",i[i.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",i[i.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",i[i.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",i[i.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",i[i.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",i[i.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",i[i.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",i[i.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",i[i.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",i[i.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",i[i.ERR_INVALID_UID=117]="ERR_INVALID_UID",i[i.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",i[i.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",i[i.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",i[i.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",i[i.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",i[i.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",i[i.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",i[i.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",i[i.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",i[i.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",i[i.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",i[i.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",i[i.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",i[i.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",i[i.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",i[i.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",i[i.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",i[i.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",i[i.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",i[i.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",i[i.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",i[i.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",i[i.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",i[i.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",i[i.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",i[i.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",i[i.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",i[i.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",i[i.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY"}(Ne||(Ne={})),function(i){i.CONNECTION_STATE_CHANGE="connection-state-change",i.MEDIA_RECONNECT_START="media-reconnect-start",i.MEDIA_RECONNECT_END="media-reconnect-end",i.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",i.USER_JOINED="user-joined",i.USER_LEAVED="user-left",i.USER_PUBLISHED="user-published",i.USER_UNPUBLISHED="user-unpublished",i.USER_INFO_UPDATED="user-info-updated",i.CLIENT_BANNED="client-banned",i.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",i.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",i.VOLUME_INDICATOR="volume-indicator",i.CRYPT_ERROR="crypt-error",i.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",i.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",i.NETWORK_QUALITY="network-quality",i.STREAM_TYPE_CHANGED="stream-type-changed",i.STREAM_FALLBACK="stream-fallback",i.RECEIVE_METADATA="receive-metadata",i.STREAM_MESSAGE="stream-message",i.LIVE_STREAMING_ERROR="live-streaming-error",i.LIVE_STREAMING_WARNING="live-streaming-warning",i.INJECT_STREAM_STATUS="stream-inject-status",i.EXCEPTION="exception",i.ERROR="error",i.P2P_LOST="p2p_lost"}(Je||(Je={})),function(i){i.NETWORK_ERROR="NETWORK_ERROR",i.SERVER_ERROR="SERVER_ERROR",i.MULTI_IP="MULTI_IP",i.TIMEOUT="TIMEOUT",i.OFFLINE="OFFLINE",i.LEAVE="LEAVE"}(Pn||(Pn={})),function(i){i.CONNECTING="connecting",i.CONNECTED="connected",i.RECONNECTING="reconnecting",i.CLOSED="closed"}(vr||(vr={})),function(i){i.WS_CONNECTED="ws_connected",i.WS_RECONNECTING="ws_reconnecting",i.WS_CLOSED="ws_closed",i.ON_BINARY_DATA="on_binary_data",i.REQUEST_RECOVER="request_recover",i.REQUEST_JOIN_INFO="request_join_info",i.REQUEST_REJOIN_INFO="req_rejoin_info",i.IS_P2P_DISCONNECTED="is_p2p_dis",i.DISCONNECT_P2P="dis_p2p",i.NEED_RENEW_SESSION="need-sid",i.REPORT_JOIN_GATEWAY="report_join_gateway",i.REQUEST_TIMEOUT="request_timeout",i.REQUEST_SUCCESS="request_success"}($e||($e={})),function(i){i.PING="ping",i.PING_BACK="ping_back",i.JOIN="join_v2",i.REJOIN="rejoin",i.LEAVE="leave",i.SET_CLIENT_ROLE="set_client_role",i.PUBLISH="publish",i.UNPUBLISH="unpublish",i.SUBSCRIBE="subscribe",i.UNSUBSCRIBE="unsubscribe",i.SUBSCRIBE_CHANGE="subscribe_change",i.TRAFFIC_STATS="traffic_stats",i.RENEW_TOKEN="renew_token",i.SWITCH_VIDEO_STREAM="switch_video_stream",i.SET_FALLBACK_OPTION="set_fallback_option",i.GATEWAY_INFO="gateway_info",i.CONTROL="control",i.SEND_METADATA="send_metadata",i.DATA_STREAM="data_stream",i.PICK_SVC_LAYER="pick_svc_layer"}(wt||(wt={})),function(i){i.PUBLISH_STATS="publish_stats",i.PUBLISH_RELATED_STATS="publish_related_stats",i.SUBSCRIBE_STATS="subscribe_stats",i.SUBSCRIBE_RELATED_STATS="subscribe_related_stats",i.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length"}(Pi||(Pi={})),function(i){i.ON_USER_ONLINE="on_user_online",i.ON_USER_OFFLINE="on_user_offline",i.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",i.ON_PUBLISH_STREAM="on_publish_stream",i.ON_UPLINK_STATS="on_uplink_stats",i.ON_P2P_LOST="on_p2p_lost",i.ON_REMOVE_STREAM="on_remove_stream",i.ON_ADD_AUDIO_STREAM="on_add_audio_stream",i.ON_ADD_VIDEO_STREAM="on_add_video_stream",i.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",i.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",i.ON_USER_BANNED="on_user_banned",i.ON_NOTIFICATION="on_notification",i.ON_CRYPT_ERROR="on_crypt_error",i.MUTE_AUDIO="mute_audio",i.MUTE_VIDEO="mute_video",i.UNMUTE_AUDIO="unmute_audio",i.UNMUTE_VIDEO="unmute_video",i.RECEIVE_METADATA="receive_metadata",i.ON_DATA_STREAM="on_data_stream",i.ENABLE_LOCAL_VIDEO="enable_local_video",i.DISABLE_LOCAL_VIDEO="disable_local_video",i.ENABLE_LOCAL_AUDIO="enable_local_audio",i.DISABLE_LOCAL_AUDIO="disable_local_audio"}(mt||(mt={})),function(i){i.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",i.NEED_ANSWER="NEED_ANSWER",i.NEED_RENEGOTIATE="NEED_RENEGOTIATE",i.P2P_LOST="P2P_LOST",i.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",i.NEED_UNPUB="NEED_UNPUB",i.NEED_UNSUB="NEED_UNSUB",i.NEED_UPLOAD="NEED_UPLOAD",i.NEED_CONTROL="NEED_CONTROL",i.START_RECONNECT="START_RECONNECT",i.END_RECONNECT="END_RECONNECT",i.NEED_SIGNAL_RTT="NEED_SIGNAL_RTT"}(Oe||(Oe={})),function(i){i.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",i.RECEIVE_TRACK_BUFFER="receive_track_buffer",i.ON_AUDIO_BUFFER="on_audio_buffer"}(Qi||(Qi={}));let $u={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,currentPacketLossRate:0},Zu={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},Lp={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},HE={uplinkNetworkQuality:0,downlinkNetworkQuality:0},Mp={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};var ct,er;(function(i){i.CONNECTED="websocket:connected",i.RECONNECTING="websocket:reconnecting",i.WILL_RECONNECT="websocket:will_reconnect",i.CLOSED="websocket:closed",i.FAILED="websocket:failed",i.ON_MESSAGE="websocket:on_message",i.REQUEST_NEW_URLS="websocket:request_new_urls"})(ct||(ct={})),function(i){i.TRANSCODE="mix_streaming",i.RAW="raw_streaming",i.INJECT="inject_streaming"}(er||(er={}));let IR={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},Pp={x:0,y:0,width:160,height:160,zOrder:255,alpha:1},CR={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},yR={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};var xi,$a,Vt,KE,Xr,kr,De,ro,ta,cl;(function(i){i.WARNING="@live_uap-warning",i.ERROR="@line_uap-error",i.PUBLISH_STREAM_STATUS="@live_uap-publish-status",i.INJECT_STREAM_STATUS="@live_uap-inject-status",i.WORKER_STATUS="@live_uap-worker-status",i.REQUEST_NEW_ADDRESS="@live_uap-request-address"})(xi||(xi={})),($a||($a={})).REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",function(i){i[i.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",i[i.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",i[i.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",i[i.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",i[i.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",i[i.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",i[i.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",i[i.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",i[i.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",i[i.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",i[i.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",i[i.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",i[i.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",i[i.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",i[i.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",i[i.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",i[i.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",i[i.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",i[i.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",i[i.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",i[i.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(Vt||(Vt={})),function(i){i.CONNECT_FAILED="connect failed",i.CONNECT_TIMEOUT="connect timeout",i.WS_DISCONNECTED="websocket disconnected",i.REQUEST_TIMEOUT="request timeout",i.REQUEST_FAILED="request failed",i.WAIT_STATUS_TIMEOUT="wait status timeout",i.WAIT_STATUS_ERROR="wait status error",i.BAD_STATE="bad state",i.WS_ABORT="ws abort",i.AP_REQUEST_TIMEOUT="AP request timeout",i.AP_JSON_PARSE_ERROR="AP json parse error",i.AP_REQUEST_ERROR="AP request error",i.AP_REQUEST_ABORT="AP request abort"}(KE||(KE={})),function(i){i[i.SetSdkProfile=0]="SetSdkProfile",i[i.SetSourceChannel=1]="SetSourceChannel",i[i.SetSourceUserId=2]="SetSourceUserId",i[i.SetDestChannel=3]="SetDestChannel",i[i.StartPacketTransfer=4]="StartPacketTransfer",i[i.StopPacketTransfer=5]="StopPacketTransfer",i[i.UpdateDestChannel=6]="UpdateDestChannel",i[i.Reconnect=7]="Reconnect",i[i.SetVideoProfile=8]="SetVideoProfile"}(Xr||(Xr={})),function(i){i.DISCONNECT="disconnect",i.CONNECTION_STATE_CHANGE="connection-state-change",i.NETWORK_QUALITY="network-quality",i.STREAM_TYPE_CHANGE="stream-type-change",i.IS_P2P_DISCONNECTED="is-p2p-dis",i.DISCONNECT_P2P="dis-p2p",i.REQUEST_NEW_GATEWAY_LIST="req-gate-url",i.NEED_RENEW_SESSION="need-sid"}(kr||(kr={})),function(i){i.NEED_RENEGOTIATE="@need_renegotiate",i.NEED_REPLACE_TRACK="@need_replace_track",i.NEED_CLOSE="@need_close",i.NEED_ADD_TRACK="@need_add_track",i.NEED_REMOVE_TRACK="@need_remove_track",i.NEED_SESSION_ID="@need_sid",i.SET_OPTIMIZATION_MODE="@set_optimization_mode",i.GET_STATS="@get_stats",i.GET_LOW_VIDEO_TRACK="@get_low_video_track",i.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",i.SET_VIDEO_TRACK_MUTED="@set_video_track_muted",i.SET_AUDIO_TRACK_MUTED="@set_audio_track_muted"}(De||(De={})),function(i){i.SCREEN_TRACK="screen_track",i.LOW_STREAM="low_stream"}(ro||(ro={})),function(i){i.SOURCE_STATE_CHANGE="source-state-change",i.TRACK_ENDED="track-ended",i.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload"}(ta||(ta={})),(cl||(cl={})).FIRST_FRAME_DECODED="first-frame-decoded";let WE="AFRICA ASIA CHINA EUROPE GLOBAL INDIA JAPAN NORTH_AMERICA OCEANIA OVERSEA SOUTH_AMERICA".split(" ");var br;(function(i){i.CHINA="CN",i.ASIA="AS",i.NORTH_AMERICA="NA",i.EUROPE="EU",i.JAPAN="JP",i.INDIA="IN",i.OCEANIA="OC",i.SOUTH_AMERICA="SA",i.AFRICA="AF",i.OVERSEA="OVERSEA",i.GLOBAL="GLOBAL"})(br||(br={}));let Qp={CHINA:{},ASIA:{CODE:br.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:br.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:br.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:br.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","	uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:br.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:br.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:br.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:br.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:br.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:br.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]}};var ll,Ui,Za;kp&&(Qp.CHINA={CODE:br.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),(ll||(ll={})).UPDATE_BITRATE_LIMIT="update_bitrate_limit",function(i){i.ONLINE="ONLINE",i.OFFLINE="OFFLINE"}(Ui||(Ui={})),function(i){i.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",i.ONLINE="ONLINE",i.OFFLINE="OFFLINE"}(Za||(Za={}));let _R={join:["startJoin","startRequestAp","startJoinGateway","finishJoin"],publish:["startPublish"]},Bt={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1};Ge({target:"Object",stat:!0,forced:!Ft,sham:!Ft},{defineProperties:tp});var In=r(function(i){var n=Qt.Object;i=i.exports=function(s,c){return n.defineProperties(s,c)},n.defineProperties.sham&&(i.sham=!0)}),SR=Qu.concat("length","prototype"),xp={f:Object.getOwnPropertyNames||function(i){return cv(i,SR)}},TR=eo("Reflect","ownKeys")||function(i){var n=xp.f(on(i)),s=Zc.f;return s?n.concat(s(i)):n};Ge({target:"Object",stat:!0,sham:!Ft},{getOwnPropertyDescriptors:function(i){var n,s;i=di(i);for(var c=Pa,u=TR(i),h={},p=0;u.length>p;)(s=c(i,n=u[p++]))!==void 0&&Ws(h,n,s);return h}});var Lt=Qt.Object.getOwnPropertyDescriptors,YE=xp.f,RR={}.toString,qE=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],JE=function(i){if(qE&&RR.call(i)=="[object Window]")try{var n=YE(i)}catch{n=qE.slice()}else n=YE(di(i));return n},zE={f:lr},wR=Bi.f,Zn=Mu("hidden"),XE=lr("toPrimitive"),NR=yr.set,$E=yr.getterFor("Symbol"),no=Object.prototype,Ai=je.Symbol,ul=eo("JSON","stringify"),ZE=Pa,ms=Bi.f,e1=JE,OR=Tu,Yo=Go("symbols"),dl=Go("op-symbols"),Up=Go("string-to-symbol-registry"),Fp=Go("symbol-to-string-registry"),kR=Go("wks"),Vp=je.QObject,Gp=!Vp||!Vp.prototype||!Vp.prototype.findChild,jp=Ft&&cr(function(){return fs(ms({},"a",{get:function(){return ms(this,"a",{value:7}).a}})).a!=7})?function(i,n,s){var c=ZE(no,n);c&&delete no[n],ms(i,n,s),c&&i!==no&&ms(no,n,c)}:ms,t1=function(i,n){var s=Yo[i]=fs(Ai.prototype);return NR(s,{type:"Symbol",tag:i,description:n}),Ft||(s.description=n),s},Hp=Co&&typeof Ai.iterator=="symbol"?function(i){return typeof i=="symbol"}:function(i){return Object(i)instanceof Ai},ed=function(i,n,s){return i===no&&ed(dl,n,s),on(i),n=La(n,!0),on(s),tt(Yo,n)?(s.enumerable?(tt(i,Zn)&&i[Zn][n]&&(i[Zn][n]=!1),s=fs(s,{enumerable:Vo(0,!1)})):(tt(i,Zn)||ms(i,Zn,Vo(1,{})),i[Zn][n]=!0),jp(i,n,s)):ms(i,n,s)},r1=function(i,n){on(i);var s=di(n);return n=As(s).concat(Kp(s)),ja(n,function(c){Ft&&!n1.call(s,c)||ed(i,c,s[c])}),i},n1=function(i){i=La(i,!0);var n=OR.call(this,i);return!(this===no&&tt(Yo,i)&&!tt(dl,i))&&(!(n||!tt(this,i)||!tt(Yo,i)||tt(this,Zn)&&this[Zn][i])||n)},i1=function(i,n){if(i=di(i),n=La(n,!0),i!==no||!tt(Yo,n)||tt(dl,n)){var s=ZE(i,n);return!s||!tt(Yo,n)||tt(i,Zn)&&i[Zn][n]||(s.enumerable=!0),s}},o1=function(i){i=e1(di(i));var n=[];return ja(i,function(s){tt(Yo,s)||tt(Ua,s)||n.push(s)}),n},Kp=function(i){var n=i===no;i=e1(n?dl:di(i));var s=[];return ja(i,function(c){!tt(Yo,c)||n&&!tt(no,c)||s.push(Yo[c])}),s};if(Co||(Ho((Ai=function(){if(this instanceof Ai)throw TypeError("Symbol is not a constructor");var i=arguments.length&&arguments[0]!==void 0?String(arguments[0]):void 0,n=ku(i),s=function(c){this===no&&s.call(dl,c),tt(this,Zn)&&tt(this[Zn],n)&&(this[Zn][n]=!1),jp(this,n,Vo(1,c))};return Ft&&Gp&&jp(no,n,{configurable:!0,set:s}),t1(n,i)}).prototype,"toString",function(){return $E(this).tag}),Tu=n1,Bi.f=ed,Pa=i1,xp.f=JE=o1,Zc.f=Kp,Ft&&ms(Ai.prototype,"description",{configurable:!0,get:function(){return $E(this).description}})),Hm||(zE.f=function(i){return t1(lr(i),i)}),Ge({global:!0,wrap:!0,forced:!Co,sham:!Co},{Symbol:Ai}),ja(As(kR),function(i){var n=Qt.Symbol||(Qt.Symbol={});tt(n,i)||wR(n,i,{value:zE.f(i)})}),Ge({target:"Symbol",stat:!0,forced:!Co},{for:function(i){if(i=String(i),tt(Up,i))return Up[i];var n=Ai(i);return Up[i]=n,Fp[n]=i,n},keyFor:function(i){if(!Hp(i))throw TypeError(i+" is not a symbol");if(tt(Fp,i))return Fp[i]},useSetter:function(){Gp=!0},useSimple:function(){Gp=!1}}),Ge({target:"Object",stat:!0,forced:!Co,sham:!Ft},{create:function(i,n){return n===void 0?fs(i):r1(fs(i),n)},defineProperty:ed,defineProperties:r1,getOwnPropertyDescriptor:i1}),Ge({target:"Object",stat:!0,forced:!Co},{getOwnPropertyNames:o1,getOwnPropertySymbols:Kp}),Ge({target:"Object",stat:!0,forced:cr(function(){Zc.f(1)})},{getOwnPropertySymbols:function(i){return Zc.f(Li(i))}}),ul){var bR=!Co||cr(function(){var i=Ai();return ul([i])!="[null]"||ul({a:i})!="{}"||ul(Object(i))!="{}"});Ge({target:"JSON",stat:!0,forced:bR},{stringify:function(i,n,s){for(var c,u=[i],h=1;arguments.length>h;)u.push(arguments[h++]);if(c=n,(Kt(n)||i!==void 0)&&!Hp(i))return Ks(n)||(n=function(p,f){if(typeof c=="function"&&(f=c.call(this,p,f)),!Hp(f))return f}),u[1]=n,ul.apply(null,u)}})}Ai.prototype[XE]||Zi(Ai.prototype,XE,Ai.prototype.valueOf),Ys(Ai,"Symbol"),Ua[Zn]=!0;var Mt=Qt.Object.getOwnPropertySymbols,Cn,yn=function(i,n,s){return n in i?kv(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s,i};(function(i){i[i.CHOOSE_SERVER=11]="CHOOSE_SERVER",i[i.CLOUD_PROXY=18]="CLOUD_PROXY",i[i.CLOUD_PROXY_5=20]="CLOUD_PROXY_5"})(Cn||(Cn={}));var DR=ur("Array").values,s1=Array.prototype,BR={DOMTokenList:!0,NodeList:!0},ra=function(i){var n=i.values;return i===s1||i instanceof Array&&n===s1.values||BR.hasOwnProperty(Fa(i))?DR:n},na=function(i){var n=Li(i),s=typeof this=="function"?this:Array,c=arguments.length,u=1<c?arguments[1]:void 0,h=u!==void 0,p=0,f=Lu(n);if(h&&(u=ps(u,2<c?arguments[2]:void 0,2)),f==null||s==Array&&zm(f))for(s=new s(c=hi(n.length));c>p;p++)Ws(s,p,h?u(n[p],p):n[p]);else for(c=(n=f.call(n)).next,s=new s;!(f=c.call(n)).done;p++)Ws(s,p,h?$m(n,u,[f.value,p],!0):f.value);return s.length=p,s},LR=!Vv(function(i){Array.from(i)});Ge({target:"Array",stat:!0,forced:LR},{from:na});var io=Qt.Array.from;class $r{constructor(){this._events={},this.addListener=this.on}getListeners(n){var s;return this._events[n]?Ie(s=this._events[n]).call(s,c=>c.listener):[]}on(n,s){this._events[n]||(this._events[n]=[]),n=this._events[n],this._indexOfListener(n,s)===-1&&n.push({listener:s,once:!1})}once(n,s){this._events[n]||(this._events[n]=[]),n=this._events[n],this._indexOfListener(n,s)===-1&&n.push({listener:s,once:!0})}off(n,s){if(this._events[n]){var c=this._events[n];s=this._indexOfListener(c,s),s!==-1&&qr(c).call(c,s,1),this._events[n].length===0&&delete this._events[n]}}removeAllListeners(n){n?delete this._events[n]:this._events={}}emit(n,...s){var c;this._events[n]||(this._events[n]=[]);let u=Ie(c=this._events[n]).call(c,h=>h);for(c=0;c<u.length;c+=1){let h=u[c];h.once&&this.off(n,h.listener),h.listener.apply(this,s||[])}}_indexOfListener(n,s){let c=n.length;for(;c--;)if(n[c].listener===s)return c;return-1}}let td=0,Wp=0,ei=new class extends $r{constructor(){super();this._moduleName="network-indicator",this._networkState=Ui.ONLINE,window.addEventListener("online",()=>{this.networkState=Ui.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Ui.OFFLINE})}set networkState(i){R.info("[".concat(this._moduleName,"]")+"network state changed, "+this._networkState+" -> "+i),this.emit(Za.NETWORK_STATE_CHANGE,i,this._networkState),i===Ui.ONLINE?this.emit(Za.ONLINE):i===Ui.OFFLINE&&(this.onlineWaiter=new se(n=>{this.once(Za.ONLINE,()=>{this.onlineWaiter=void 0,n(Ui.ONLINE)})}),this.emit(Za.OFFLINE)),this._networkState=i}get networkState(){return this._networkState}},Dr={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4},z=new class{constructor(){var i,n;this.baseInfoMap=new Ct,this.clientList=Ko,this.keyEventUploadPendingItems=[],this.normalEventUploadPendingItems=[],this.apiInvokeUploadPendingItems=[],this.apiInvokeCount=0,this.ltsList=[],this.lastSendNormalEventTime=le(),this.customReportCount=0,this.eventUploadTimer=window.setInterval(hr(i=this.doSend).call(i,this),re.EVENT_REPORT_SEND_INTERVAL),this.setSessionIdTimer=window.setInterval(hr(n=this.appendSessionId).call(n,this),re.EVENT_REPORT_SEND_INTERVAL)}reportApiInvoke(i,n,s){n.timeout=n.timeout||6e4,n.reportResult=n.reportResult===void 0||n.reportResult;const c=le(),u=this.apiInvokeCount+=1,h=()=>({tag:n.tag,invokeId:u,sid:i,name:n.name,apiInvokeTime:c,options:n.options,states:n.states||null}),p=!!re.SHOW_REPORT_INVOKER_LOG;p&&R.info("".concat(n.name," start"),n.options);let f=!1;Mn(n.timeout).then(()=>{f||(this.sendApiInvoke(Cr({},h(),{error:D.API_INVOKE_TIMEOUT,success:!1})),R.debug("".concat(n.name," timeout")))});const m=new L(D.UNEXPECTED_ERROR,"".concat(n.name,": this api invoke is end"));return{onSuccess:I=>{const E=()=>{if(f)throw m;return f=!0,this.sendApiInvoke(Cr({},h(),{success:!0},n.reportResult&&{result:I})),p&&R.info("".concat(n.name," onSuccess")),I};return s?C1(E,n.name+"Success",s,()=>f=!0):E()},onError:I=>{const E=()=>{if(f)throw I;f=!0,this.sendApiInvoke(Cr({},h(),{success:!1,error:I.toString()})),p&&R.info("".concat(n.name," onFailure"),I.toString())};return s?C1(E,n.name+"Error",s,()=>f=!0):E()}}}sessionInit(i,n){if(!this.baseInfoMap.has(i)){var s=le();i=this.createBaseInfo(i,s),i.cname=n.cname;var c=sn({},{willUploadConsoleLog:re.UPLOAD_LOG,maxTouchPoints:navigator.maxTouchPoints,areaVersion:kp?"global":"oversea",areas:re.AREAS&&re.AREAS.join(",")},n.extend),u=le();n=Cr({},i,{eventType:Jr.SESSION_INIT,appid:n.appid,browser:navigator.userAgent,build:"v4.7.2-0-gf83f608b(10/13/2021, 5:32:13 PM)",lts:u,elapse:u-s,extend:pe(c),mode:n.mode,process:re.PROCESS_ID,success:!0,version:Xn}),this.send({type:zt.SESSION,data:n},!0)}}joinChooseServer(i,n){if(i=this.baseInfoMap.get(i)){var s=i.info,c=le();n=Cr({},s,{eventType:Jr.JOIN_CHOOSE_SERVER,lts:c,eventElapse:c-n.lts,chooseServerAddr:n.csAddr,errorCode:n.ec,elapse:c-i.startTime,success:n.succ,chooseServerAddrList:pe(n.serverList),uid:n.uid?dr(n.uid):null,cid:n.cid?dr(n.cid):null,chooseServerIp:n.csIp||"",opid:n.opid,unilbsServerIds:n.unilbsServerIds,extend:n.extend||void 0}),this.send({type:zt.JOIN_CHOOSE_SERVER,data:n},!0)}}reqUserAccount(i,n){if(i=this.baseInfoMap.get(i)){var s=i.info,c=le();n=Cr({},s,{eventType:Jr.REQ_USER_ACCOUNT,lts:c,success:n.success,serverAddress:n.serverAddr,stringUid:n.stringUid,uid:n.uid,errorCode:n.errorCode,elapse:c-i.startTime,eventElapse:c-n.lts,extend:pe(n.extend)}),this.send({type:zt.REQ_USER_ACCOUNT,data:n},!0)}}joinGateway(i,n){if(i=this.baseInfoMap.get(i)){var s=i.info;n.vid&&(s.vid=n.vid),s.uid=n.uid,s.cid=n.cid;var c=le();s=Cr({},s,{eventType:Jr.JOIN_GATEWAY,lts:c,gatewayAddr:n.addr,success:n.succ,errorCode:n.ec,elapse:c-i.startTime,eventElapse:c-n.lts}),n.succ&&(i.lastJoinSuccessTime=c),this.send({type:zt.JOIN_GATEWAT,data:s},!0)}}joinChannelTimeout(i,n){if(i=this.baseInfoMap.get(i)){var s=le();n=Cr({},i.info,{lts:s,timeout:n,elapse:s-i.startTime}),this.send({type:zt.JOIN_CHANNEL_TIMEOUT,data:n},!0)}}publish(i,n){if(i=this.baseInfoMap.get(i)){var s=i.info,c=le();n=Cr({},s,{eventType:Jr.PUBLISH,lts:c,eventElapse:c-n.lts,elapse:c-i.startTime,success:n.succ,errorCode:n.ec,videoName:n.videoName,audioName:n.audioName,screenName:n.screenName,screenshare:n.screenshare,audio:n.audio,video:n.video,p2pid:n.p2pid,publishRequestid:n.publishRequestid}),this.send({type:zt.PUBLISH,data:n},!0)}}subscribe(i,n){if(i=this.baseInfoMap.get(i)){var s=i.info,c=le();i=Cr({},s,{eventType:Jr.SUBSCRIBE,lts:c,eventElapse:c-n.lts,elapse:c-i.startTime,success:n.succ,errorCode:n.ec,video:n.video,audio:n.audio,subscribeRequestid:n.subscribeRequestid,p2pid:n.p2pid}),typeof n.peerid=="string"?i.peerSuid=n.peerid:i.peer=n.peerid,this.send({type:zt.SUBSCRIBE,data:i},!0)}}firstRemoteFrame(i,n,s,c){if(i=this.baseInfoMap.get(i)){var u=i.info,h=le();n=Cr({},u,{},c,{elapse:h-i.startTime,eventType:n,lts:h}),this.send({type:s,data:n},!0)}}onGatewayStream(i,n,s,c){(i=this.baseInfoMap.get(i))&&(n=Cr({},i.info,{},c,{eventType:n,lts:le()}),this.send({type:s,data:n},!0))}streamSwitch(i,n){if(i=this.baseInfoMap.get(i)){var s=i.info,c=le();n=Cr({},s,{eventType:Jr.STREAM_SWITCH,lts:c,isDual:n.isdual,elapse:c-i.startTime,success:n.succ}),this.send({type:zt.STREAM_SWITCH,data:n},!0)}}requestProxyAppCenter(i,n){if(i=this.baseInfoMap.get(i)){var s=i.info,c=le();n=Cr({},s,{eventType:Jr.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-n.lts,elapse:c-i.startTime,APAddr:n.APAddr,workerManagerList:n.workerManagerList,response:n.response,errorCode:n.ec,success:n.succ}),this.send({type:zt.REQUEST_PROXY_APPCENTER,data:n},!0)}}requestProxyWorkerManager(i,n){if(i=this.baseInfoMap.get(i)){var s=i.info,c=le();n=Cr({},s,{eventType:Jr.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-n.lts,elapse:c-i.startTime,workerManagerAddr:n.workerManagerAddr,response:n.response,errorCode:n.ec,success:n.succ}),this.send({type:zt.REQUEST_PROXY_WORKER_MANAGER,data:n},!0)}}setProxyServer(i){(this.proxyServer=i)?R.debug("reportProxyServerurl: ".concat(i)):R.debug("disable reportProxyServerurl: ".concat(i))}peerPublishStatus(i,n){if(i=this.baseInfoMap.get(i)){var s=i.info,c=le();n=Cr({},s,{subscribeElapse:n.subscribeElapse,peer:n.peer,peerPublishDuration:Math.max(n.audioPublishDuration,n.videoPublishDuration),audiotag:0<n.audioPublishDuration?1:-1,videotag:0<n.videoPublishDuration?1:-1,lts:c,elapse:c-i.startTime,joinChannelSuccessElapse:c-(i.lastJoinSuccessTime||c)}),this.send({type:zt.PEER_PUBLISH_STATUS,data:n},!0)}}workerEvent(i,n){if(i=this.baseInfoMap.get(i)){var s=i.info,c=le();n=function(u,h,p){const f=u[h];if(!f||typeof f!="string")return[u];u[h]="";const m=ba(pe(u));let I=0;const E=[];let _=0;for(let S=0;S<f.length;S++)_+=127>=f.charCodeAt(S)?1:3,_<=p-m||(E[E.length]=Ph({},u,{[h]:f.substring(I,S)}),I=S,_=127>=f.charCodeAt(S)?1:3);return I!==f.length-1&&(E[E.length]=Ph({},u,{[h]:f.substring(I)})),E}(Cr({},s,{},n,{elapse:c-i.startTime,lts:c,productType:"WebRTC"}),"payload",1300),H(n).call(n,u=>this.send({type:zt.WORKER_EVENT,data:u},!0))}}apworkerEvent(i,n){if(i=this.baseInfoMap.get(i)){var s=i.info,c=le();n=Cr({},s,{},n,{elapse:c-i.startTime,lts:c}),this.send({type:zt.AP_WORKER_EVENT,data:n},!0)}}joinWebProxyAP(i,n){if(i=this.baseInfoMap.get(i)){var s=i.info,c=le();n=Cr({},s,{},n,{elapse:c-i.startTime,lts:c,extend:n.extend||void 0}),this.send({type:zt.JOIN_WEB_PROXY_AP,data:n},!0)}}WebSocketQuit(i,n){if(i=this.baseInfoMap.get(i)){var s=i.info,c=le();n=Cr({},s,{},n,{elapse:c-i.startTime,lts:c}),this.send({type:zt.WEBSOCKET_QUIT,data:n},!0)}}async sendCustomReportMessage(i,n){if(this.customReportCount+=n.length,this.customReportCount>re.CUSTOM_REPORT_LIMIT)throw new L(D.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3)),n=Ie(n).call(n,s=>({type:zt.USER_ANALYTICS,data:Cr({sid:i},s)})),n={msgType:"EventMessages",sentTs:Math.round(le()/1e3),payloads:Ie(n).call(n,s=>pe(s))};try{await this.postDataToStatsCollector(n)}catch(s){throw R.error("send custom report message failed",s.toString()),new L(D.CUSTOM_REPORT_SEND_FAILED,s.message)}}sendApiInvoke(i){var n=re.NOT_REPORT_EVENT;if(i.tag&&gt(n)&&gt(n).call(n,i.tag))return!1;if(i.sid===null)return this.apiInvokeUploadPendingItems.push(i),!1;if(n=this.baseInfoMap.get(i.sid),!n)return this.apiInvokeUploadPendingItems.push(i),!1;const{cname:s,uid:c,cid:u}=n.info;return i.lts=i.lts||le(),i={invokeId:i.invokeId,sid:i.sid,cname:s,cid:u,uid:c,lts:i.lts,success:i.success,elapse:i.lts-n.startTime,execElapse:i.lts-i.apiInvokeTime,apiName:i.name,options:i.options?pe(i.options):void 0,execStates:i.states?pe(i.states):void 0,execResult:i.result?pe(i.result):void 0,errorCode:i.error?pe(i.error):void 0},this.send({type:zt.API_INVOKE,data:i},!1),!0}appendSessionId(){var i;H(i=this.clientList).call(i,n=>{if(n._sessionId){const s=this.apiInvokeUploadPendingItems.length;for(let c=0;c<s;c++){const u=this.apiInvokeUploadPendingItems.shift();u&&(u.sid=n._sessionId,this.sendApiInvoke(sn({},u)))}}})}send(i,n){if(n)return this.keyEventUploadPendingItems.push(i),void this.sendItems(this.keyEventUploadPendingItems,!0);var s;this.normalEventUploadPendingItems.push(i),this.normalEventUploadPendingItems.length>re.NORMAL_EVENT_QUEUE_CAPACITY&&qr(s=this.normalEventUploadPendingItems).call(s,0,1),10<=this.normalEventUploadPendingItems.length&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){0<this.keyEventUploadPendingItems.length&&this.sendItems(this.keyEventUploadPendingItems,!0),0<this.normalEventUploadPendingItems.length&&5e3<=le()-this.lastSendNormalEventTime&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(i,n){const s=[];for(var c=[];i.length;){const p=i.shift();20>s.length?s.push(p):c.push(p)}i.push(...c);for(const p of[...s]){var u,h;He(u=this.ltsList).call(u,p.data.lts)!==-1?(p.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(p.data.lts)):(this.ltsList.push(p.data.lts),sl(h=this.ltsList).call(h,(f,m)=>f-m))}return n||(this.lastSendNormalEventTime=le()),c={msgType:"EventMessages",sentTs:Math.round(le()/1e3),payloads:Ie(s).call(s,p=>pe(p)),vid:(p=>(p=p&&p.data.sid&&this.baseInfoMap.get(p.data.sid))&&p.info.vid&&+p.info.vid||0)(s[0])},s.length&&this.postDataToStatsCollector(c).catch((p=>f=>{var m,I,E;re.EVENT_REPORT_RETRY&&(n?this.keyEventUploadPendingItems=b(m=this.keyEventUploadPendingItems).call(m,p):(this.normalEventUploadPendingItems=b(I=this.normalEventUploadPendingItems).call(I,p),this.normalEventUploadPendingItems.length>re.NORMAL_EVENT_QUEUE_CAPACITY&&(qr(E=this.normalEventUploadPendingItems).call(E,0,this.normalEventUploadPendingItems.length-re.NORMAL_EVENT_QUEUE_CAPACITY),R.warning("report: drop normal events"))))})(s)),i}async postDataToStatsCollector(i,n=!1){var s,c,u;ei.networkState===Ui.OFFLINE&&await se.race([ei.onlineWaiter,Mn(2*Dr.maxRetryTimeout)]);const h=n?"/events/proto-raws":"/events/messages";let p=this.url||(this.proxyServer?b(s=b(c="https://".concat(this.proxyServer,"/rs/?h=")).call(c,re.EVENT_REPORT_DOMAIN,"&p=6443&d=")).call(s,h):b(u="https://".concat(re.EVENT_REPORT_DOMAIN,":6443")).call(u,h));for(s=0;2>s;s+=1){var f,m,I;s===1&&(p=this.backupUrl||(this.proxyServer?b(f=b(m="https://".concat(this.proxyServer,"/rs/?h=")).call(m,re.EVENT_REPORT_BACKUP_DOMAIN,"&p=6443&d=")).call(f,h):b(I="https://".concat(re.EVENT_REPORT_BACKUP_DOMAIN,":6443")).call(I,h)));try{n?await QS(p,{timeout:1e4,data:i}):await Xi(p,{timeout:1e4,data:i})}catch(E){if(s===1)throw E;continue}break}}createBaseInfo(i,n){const s=sn({},ER);return s.sid=i,this.baseInfoMap.set(i,{info:s,startTime:n}),s}};class a1 extends $r{constructor(n,s){super();this._hints=[],this._isClosed=!1,this._ID=s||rr(8,"track-"),this._mediaStreamTrack=this._originMediaStreamTrack=n,gt(gs).call(gs,this)||gs.push(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(n){return n||(n=z.reportApiInvoke(null,{name:Re.GET_MEDIA_STREAM_TRACK,options:[],tag:Te.TRACER}),this._mediaStreamTrack&&typeof this._mediaStreamTrack.label=="string"?n.onSuccess(this._mediaStreamTrack.label):n.onSuccess("")),this._mediaStreamTrack}close(){this._isClosed=!0;{let n=He(gs).call(gs,this);n!==-1&&qr(gs).call(gs,n,1)}}}let MR=1;class qo{constructor(n){var s;this.lockingPromise=se.resolve(),this.locks=0,this.name="",this.lockId=MR++,n&&(this.name=n),R.debug(b(s="[lock-".concat(this.name,"-")).call(s,this.lockId,"] is created."))}get isLocked(){return 0<this.locks}lock(){var n,s;let c;this.locks+=1,R.debug(b(n=b(s="[lock-".concat(this.name,"-")).call(s,this.lockId,"] is locked, current queue ")).call(n,this.locks,"."));let u=new se(h=>{c=()=>{var p,f;--this.locks,R.debug(b(p=b(f="[lock-".concat(this.name,"-")).call(f,this.lockId,"] is not locked, current queue ")).call(p,this.locks,".")),h()}});return n=this.lockingPromise.then(()=>c),this.lockingPromise=this.lockingPromise.then(()=>u),n}}class rd extends a1{constructor(n,s){super(n,s);this._enabled=!0,this._isClosed=this._muted=!1,this._trackProcessors=[],this._handleTrackEnded=()=>{this.onTrackEnded()},this._enabledMutex=new qo("".concat(s)),n.addEventListener("ended",this._handleTrackEnded)}get muted(){return this._muted}get enabled(){return this._enabled}getTrackLabel(){return this._originMediaStreamTrack.label}close(){var n;this._isClosed||(this.stop(),H(n=this._trackProcessors).call(n,s=>s.destroy()),this._trackProcessors=[],this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,R.debug("[".concat(this.getTrackId(),"] close")),this.emit(De.NEED_CLOSE),super.close())}async _registerTrackProcessor(n){var s;if(He(s=this._trackProcessors).call(s,n)===-1){var c=this._trackProcessors[this._trackProcessors.length-1];this._trackProcessors.push(n),n.onOutputChange=async()=>{this._mediaStreamTrack=n.output||this._originMediaStreamTrack,this._updatePlayerSource(),await nn(this,De.NEED_REPLACE_TRACK,this._mediaStreamTrack)},c?(c.onOutputChange=async()=>{c.output&&await n.setInput(c.output)},await n.setInput(c.output||c.input||this._originMediaStreamTrack)):await n.setInput(this._originMediaStreamTrack)}}_getOutputFromProcessors(){if(this._trackProcessors.length===0)return this._originMediaStreamTrack;let n=this._trackProcessors[this._trackProcessors.length-1];return n.output||n.input||this._originMediaStreamTrack}async _updateOriginMediaStreamTrack(n,s){n!==this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),s&&this._originMediaStreamTrack.stop(),n.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=n,0<this._trackProcessors.length?(await this._trackProcessors[0].setInput(n),this._mediaStreamTrack=this._getOutputFromProcessors()):this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await nn(this,De.NEED_REPLACE_TRACK,this._mediaStreamTrack))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){R.debug("[".concat(this.getTrackId(),"] track ended")),this.emit(ta.TRACK_ENDED)}stateCheck(n,s){var c,u,h;if(R.debug(b(c=b(u=b(h="check track state, [muted: ".concat(this._muted,", enabled: ")).call(h,this._enabled,"] to [")).call(u,n,": ")).call(c,s,"]")),n==="muted"&&!Bt.webAudioMediaStreamDest)throw new L(D.NOT_SUPPORTED,"current environment does not support set mute").print();if(us(s,n),this._enabled&&this._muted&&n==="enabled"&&s===!1)throw new L(D.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print();if(!this._enabled&&!this._muted&&n==="muted"&&s===!0)throw new L(D.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print()}}var Zr;(function(i){i.IOS_15_INTERRUPTION_START="ios15-interruption-start",i.IOS_15_INTERRUPTION_END="ios15-interruption-end",i.IOS_INTERRUPTION_START="ios-interruption-start",i.IOS_INTERRUPTION_END="ios-interruption-end"})(Zr||(Zr={}));let c1=window.AudioContext||window.webkitAudioContext,oo=null,ht=new class extends $r{constructor(){super(...arguments);this.onLocalAudioTrackMute=()=>{R.info("ios15-interruption-start"),this.emit(Zr.IOS_15_INTERRUPTION_START)},this.onLocalAudioTrackUnmute=async()=>{R.info("ios15-interruption-end"),this.curState==="running"&&(oo&&await oo.suspend(),this.emit(Zr.IOS_15_INTERRUPTION_END))}}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(i){R.debug("webaudio bindInterruptDetectorTrack ".concat(i.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=i,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(i){R.debug("webaudio unbindInterruptDetectorTrack ".concat(i.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===i&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}},Yp=null;class l1 extends $r{constructor(){super();this.isPlayed=!1,this.audioOutputLevel=0,this.isNoAudioInput=this.isDestroyed=!1,this._noAudioInputCount=0,this.context=Gc(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),jc(this.outputNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.smoothingTimeConstant=.4,this.analyserNode.fftSize=2048}startGetAudioBuffer(n){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(n),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=s=>{this.emit(Qi.ON_AUDIO_BUFFER,function(c){for(let u=0;u<c.outputBuffer.numberOfChannels;u+=1){let h=c.outputBuffer.getChannelData(u);for(let p=0;p<h.length;p+=1)h[p]=0}return c.inputBuffer}(s))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Bt.webAudioMediaStreamDest)throw new L(D.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(n){this.context.state!=="running"&&ui(()=>{ht.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=n||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){if(!this.context||Bn()||mo()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode)return 0;let n=new Uint8Array(this.analyserNode.frequencyBinCount);this.analyserNode.getByteFrequencyData(n);let s=0;for(let c=0;c<n.length;c++)s+=64>c?Math.abs(10*n[c]):Math.abs(6*n[c]/15);return s/n.length/255}async checkHasAudioInput(n=0){if(5<n)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;if(Bn()||mo()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume(),!this.analyserNode)return!1;let s=new Uint8Array(this.analyserNode.frequencyBinCount);this.analyserNode.getByteFrequencyData(s);let c=!1;for(let u=0;u<s.length;u++)s[u]!==0&&(c=!0);return c?(this.isNoAudioInput=!1,!0):(await Mn(200),await this.checkHasAudioInput(n?n+1:1)&&c)}getAudioVolume(){return this.outputNode.gain.value}setVolume(n){this.outputNode.gain.setValueAtTime(n,this.context.currentTime)}setMute(n){n?(this.disconnect(),this.audioOutputLevel=0):this.connect()}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){this.sourceNode&&this.sourceNode.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){this.sourceNode&&this.sourceNode.connect(this.outputNode),this.outputNode.connect(this.analyserNode)}}class u1 extends l1{constructor(n,s){if(super(),this.isCurrentTrackCloned=!1,this.isRemoteTrack=!1,this.rebuildWebAudio=async()=>{if(R.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void R.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>R.info("resume success")),R.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();var c=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?c.stop():this.isCurrentTrackCloned=!0,c=new MediaStream([this.track]),this.sourceNode=this.context.createMediaStreamSource(c),jc(this.sourceNode),this.analyserNode=this.context.createAnalyser();let u=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(u,this.context.currentTime),jc(this.outputNode),this.connect(),this.audioElement.srcObject=c,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()},n.kind!=="audio")throw new L(D.UNEXPECTED_ERROR);this.track=n,n=new MediaStream([this.track]),this.isRemoteTrack=!!s,this.sourceNode=this.context.createMediaStreamSource(n),jc(this.sourceNode),this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=n,n=qe(),s&&n.os===an.IOS&&15>Number(n.osVersion&&n.osVersion.split(".")[0])&&(ht.on("state-change",()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(c=>{c||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}get isFreeze(){return!1}updateTrack(n){this.sourceNode.disconnect(),this.track=n,this.isCurrentTrackCloned=!1,n=new MediaStream([n]),this.sourceNode=this.context.createMediaStreamSource(n),jc(this.sourceNode),this.sourceNode.connect(this.outputNode),this.audioElement.srcObject=n}destroy(){this.audioElement.srcObject=null,this.audioElement.remove(),ht.off("state-change",this.rebuildWebAudio),super.destroy()}}let nd=null,qp=new qo("safari"),d1=!1,h1=!1,Qn=new class extends $r{constructor(){super();this._state=ea.IDLE,this.lastAccessCameraPermission=this.lastAccessMicrophonePermission=this.isAccessCameraPermission=this.isAccessMicrophonePermission=!1,this.deviceInfoMap=new Ct,this.init().then(()=>{var i;navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",hr(i=this.updateDevicesInfo).call(i,this)),window.setInterval(()=>qe().name!==Xe.WECHAT&&re.ENUMERATE_DEVICES_INTERVAL&&this.updateDevicesInfo(),6e4)}).catch(i=>R.error(i.toString()))}get state(){return this._state}set state(i){i!==this._state&&(this.emit(Wo.STATE_CHANGE,i),this._state=i)}async enumerateDevices(i,n,s=!1){if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new L(D.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();var c=await navigator.mediaDevices.enumerateDevices();c=this.checkMediaDeviceInfoIsOk(c);let u=!this.isAccessMicrophonePermission&&i,h=!this.isAccessCameraPermission&&n;c.audio&&(u=!1),c.video&&(h=!1);let p=c=null,f=null;if(!s&&(u||h)){if(qp.isLocked&&(R.debug("[device manager] wait GUM lock"),(await qp.lock())(),R.debug("[device manager] GUM unlock")),d1&&(u=!1,this.isAccessMicrophonePermission=!0),h1&&(h=!1,this.isAccessCameraPermission=!0),R.debug("[device manager] check media device permissions",i,n,u,h),u&&h){try{f=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(O){if(s=Eu(O.name||O.code||O,O.message),s.code===D.PERMISSION_DENIED)throw s;R.warning("getUserMedia failed in getDevices",s)}this.isAccessMicrophonePermission=this.isAccessCameraPermission=!0}else if(u){try{c=await navigator.mediaDevices.getUserMedia({audio:i})}catch(O){if(s=Eu(O.name||O.code||O,O.message),s.code===D.PERMISSION_DENIED)throw s;R.warning("getUserMedia failed in getDevices",s)}this.isAccessMicrophonePermission=!0}else if(h){try{p=await navigator.mediaDevices.getUserMedia({video:n})}catch(O){if(s=Eu(O.name||O.code||O,O.message),s.code===D.PERMISSION_DENIED)throw s;R.warning("getUserMedia failed in getDevices",s)}this.isAccessCameraPermission=!0}R.debug("[device manager] mic permission",i,"cam permission",n)}try{var m,I,E;const O=await navigator.mediaDevices.enumerateDevices();return c&&H(m=c.getTracks()).call(m,B=>B.stop()),p&&H(I=p.getTracks()).call(I,B=>B.stop()),f&&H(E=f.getTracks()).call(E,B=>B.stop()),c=null,p=null,f=null,O}catch(O){var _,S,N;return c&&H(_=c.getTracks()).call(_,B=>B.stop()),p&&H(S=p.getTracks()).call(S,B=>B.stop()),f&&H(N=f.getTracks()).call(N,B=>B.stop()),f=p=c=null,new L(D.ENUMERATE_DEVICES_FAILED,O.toString()).throw()}}async getRecordingDevices(i=!1){return i=await this.enumerateDevices(!0,!1,i),Qe(i).call(i,n=>n.kind==="audioinput")}async getCamerasDevices(i=!1){return i=await this.enumerateDevices(!1,!0,i),Qe(i).call(i,n=>n.kind==="videoinput")}async getSpeakers(i=!1){return i=await this.enumerateDevices(!0,!1,i),Qe(i).call(i,n=>n.kind==="audiooutput")}searchDeviceNameById(i){return(i=this.deviceInfoMap.get(i))?i.device.label||i.device.deviceId:null}searchDeviceIdByName(i){var n;let s=null;return H(n=this.deviceInfoMap).call(n,c=>{c.device.label===i&&(s=c.device.deviceId)}),s}async getDeviceById(i){var n=await this.enumerateDevices(!0,!0,!0);if(n=ze(n).call(n,s=>s.deviceId===i),!n)throw new L(D.DEVICE_NOT_FOUND,"deviceId: ".concat(i));return n}async init(){this.state=ea.INITING;try{await this.updateDevicesInfo(),this.state=ea.INITEND}catch(n){R.warning("Device Detection functionality cannot start properly.",n.toString()),this.state=ea.IDLE;var i=typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1";throw i||new L(D.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),n}}async updateDevicesInfo(){var i;const n=await this.enumerateDevices(!0,!0,!0),s=le(),c=[],u=this.checkMediaDeviceInfoIsOk(n);if(H(n).call(n,h=>{if(h.deviceId){var p=this.deviceInfoMap.get(h.deviceId);if((p?p.state:"INACTIVE")!=="ACTIVE"){const f={initAt:s,updateAt:s,device:h,state:"ACTIVE"};this.deviceInfoMap.set(h.deviceId,f),c.push(f)}p&&(p.updateAt=s)}}),H(i=this.deviceInfoMap).call(i,(h,p)=>{h.state==="ACTIVE"&&h.updateAt!==s&&(h.state="INACTIVE",c.push(h))}),this.state!==ea.INITEND)return u.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(u.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));H(c).call(c,h=>{switch(h.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Wo.RECORDING_DEVICE_CHANGED,h);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Wo.CAMERA_DEVICE_CHANGED,h);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Wo.PLAYOUT_DEVICE_CHANGED,h)}}),u.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),u.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(i){const n=Qe(i).call(i,c=>c.kind==="audioinput");i=Qe(i).call(i,c=>c.kind==="videoinput");const s={audio:!1,video:!1};for(const c of n)if(c.label&&c.deviceId){s.audio=!0;break}for(const c of i)if(c.label&&c.deviceId){s.video=!0;break}return s}};var PR=ur("Array").entries,p1=Array.prototype,QR={DOMTokenList:!0,NodeList:!0},A1=function(i){var n=i.entries;return i===p1||i instanceof Array&&n===p1.entries||QR.hasOwnProperty(Fa(i))?PR:n};let Jp=!1,f1=new $r,g1="play playing loadeddata canplay pause stalled suspend waiting abort emptied ended".split(" "),fi=new class{constructor(){this.elementMap=new Ct,this.elementStateMap=new Ct,this.elementsNeedToResume=[],this.sinkIdMap=new Ct,this.autoResumeAfterInterruption=()=>{var i,n;H(i=io(A1(n=this.elementMap).call(n))).call(i,([s,c])=>{s=this.elementStateMap.get(s);const u=c.srcObject.getAudioTracks()[0];ki()?u&&u.readyState==="live"&&ht.curState==="running"&&(R.debug("auto resume after interruption for iOS 15"),c.pause(),c.play()):s&&s==="pause"&&u&&u.readyState==="live"&&ht.curState==="running"&&(R.debug("auto resume after interruption for iOS"),c.play())})},this.autoResumeAfterInterruptionOnIOS15=()=>{var i,n;H(i=io(A1(n=this.elementMap).call(n))).call(i,([,s])=>{const c=s.srcObject.getAudioTracks()[0];c&&c.readyState==="live"&&(R.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),s.pause(),s.play())})},this.autoResumeAudioElement(),ht.on(Zr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),ht.on(Zr.IOS_15_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15)}async setSinkID(i,n){const s=this.elementMap.get(i);if(this.sinkIdMap.set(i,n),s)try{await s.setSinkId(n)}catch(c){throw new L(D.PERMISSION_DENIED,"can not set sink id: "+c.toString())}}play(i,n,s){if(!this.elementMap.has(n)){var c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([i]),this.bindAudioElementEvents(n,c),this.elementMap.set(n,c),this.elementStateMap.set(n,Vr.INIT),this.setVolume(n,s),(i=this.sinkIdMap.get(n))&&c.setSinkId(i).catch(u=>{R.warning("[".concat(n,"] set sink id failed"),u.toString())}),(i=c.play())&&i.then&&i.catch(u=>{R.warning("audio element play warning",u.toString()),this.elementMap.has(n)&&u.name==="NotAllowedError"&&(R.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),ui(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),tm()}))})}}updateTrack(i,n){(i=this.elementMap.get(i))&&(i.srcObject=new MediaStream([n]))}isPlaying(i){return this.elementMap.has(i)}setVolume(i,n){(i=this.elementMap.get(i))&&(n=Math.max(0,Math.min(100,n)),i.volume=n/100)}stop(i){var n,s;const c=this.elementMap.get(i);if(this.sinkIdMap.delete(i),c){var u=He(n=this.elementsNeedToResume).call(n,c);qr(s=this.elementsNeedToResume).call(s,u,1),c.srcObject=null,c.remove(),this.elementMap.delete(i),this.elementStateMap.delete(i)}}bindAudioElementEvents(i,n){H(g1).call(g1,s=>{n.addEventListener(s,c=>{var u,h;const p=this.elementStateMap.get(i);c=c.type,R.debug(b(u=b(h="[".concat(i,"] audio-element-status change ")).call(h,p," => ")).call(u,c)),this.elementStateMap.set(i,c)})})}autoResumeAudioElement(){const i=()=>{var n;H(n=this.elementsNeedToResume).call(n,s=>{s.play().then(c=>{R.debug("Auto resume audio element success")}).catch(c=>{R.warning("Auto resume audio element failed!",c)})}),this.elementsNeedToResume=[]};new se(n=>{document.body?n():window.addEventListener("load",()=>n())}).then(()=>{document.body.addEventListener("touchstart",i,!0),document.body.addEventListener("mousedown",i,!0)})}};var ti=function(i,n,s,c){var u,h=arguments.length,p=3>h?n:c===null?c=at(n,s):c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")p=Reflect.decorate(i,n,s,c);else for(var f=i.length-1;0<=f;f--)(u=i[f])&&(p=(3>h?u(p):3<h?u(n,s,p):u(n,s))||p);return 3<h&&p&&dt(n,s,p),p},rt=function(i,n){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,n)};class Br extends rd{constructor(n,s,c){super(n,c);this.trackMediaType="audio",this._enabled=!0,this._volume=100,this._bypassWebAudio=this._useAudioElement=!1,this._encoderConfig=s,this._source=new u1(n)}get isPlaying(){return this._useAudioElement?fi.isPlaying(this.getTrackId()):this._source.isPlayed}setVolume(n){It(n,"volume",0,1e3);let s=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.LOCAL_AUDIO_TRACK_SET_VOLUME,options:[this.getTrackId(),n]},300);this._volume=n,this._source.setVolume(n/100),this._useAudioElement&&fi.setVolume(this.getTrackId(),n);try{if(this._bypassWebAudio)return void R.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));let c=this._source.createOutputTrack();this._mediaStreamTrack!==c&&(this._mediaStreamTrack=c,nn(this,De.NEED_REPLACE_TRACK,this._mediaStreamTrack).then(()=>{R.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(u=>{R.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),u)}))}catch{}s.onSuccess()}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}async setPlaybackDevice(n){let s=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.REMOTE_AUDIO_SET_OUTPUT_DEVICE,options:[this.getTrackId(),n]});if(!this._useAudioElement)throw new L(D.NOT_SUPPORTED,"your browser does not support setting the audio output device");try{await fi.setSinkID(this.getTrackId(),n)}catch(c){throw s.onError(c),c}s.onSuccess()}async setEnabled(n,s,c){var u;if(!c){if(n===this._enabled)return;this.stateCheck("enabled",n)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),n),s=await this._enabledMutex.lock(),!n){this._originMediaStreamTrack.enabled=!1;try{await nn(this,De.NEED_REMOVE_TRACK,this)}catch(h){throw R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),h.toString()),s(),h}return c||(this._enabled=!1),s()}this._originMediaStreamTrack.enabled=!0;try{await nn(this,De.NEED_ADD_TRACK,this)}catch(h){throw R.error("[".concat(this.getTrackId(),"] setEnabled to true error"),h.toString()),s(),h}R.info(b(u="[".concat(this.getTrackId(),"] setEnabled to ")).call(u,n," success")),c||(this._enabled=!0),s()}async setMuted(n){var s,c;if(this._bypassWebAudio)return R.debug(b(c="[".concat(this.getTrackId(),"] setMuted:")).call(c,n," fallback to setEnabled because no pass through.")),void await this.setEnabled(!n);if(n!==this._muted){if(this.stateCheck("muted",n),this._muted=n,qe().name===Xe.FIREFOX)return R.debug("[".concat(this.getTrackId(),"] firefox set mute fallback to set enabled")),void await this.setEnabled(!n,void 0,!0);this._mediaStreamTrack.enabled=!n,R.debug(b(s="[".concat(this.getTrackId(),"] start set muted: ")).call(s,n)),await nn(this,De.SET_AUDIO_TRACK_MUTED,{track:this,muted:n})}}getStats(){return Kc(()=>{R.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Gs(this,De.GET_STATS)||Iu({},$u)}setAudioFrameCallback(n,s=4096){if(!n)return this._source.removeAllListeners(Qi.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(s),this._source.removeAllListeners(Qi.ON_AUDIO_BUFFER),this._source.on(Qi.ON_AUDIO_BUFFER,c=>n(c))}play(){let n=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.LOCAL_AUDIO_TRACK_PLAY,options:[this.getTrackId()]});R.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(R.debug("[".concat(this.getTrackId(),"] start audio playback in element")),fi.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play(),n.onSuccess()}stop(){let n=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.LOCAL_AUDIO_TRACK_STOP,options:[this.getTrackId()]});R.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?fi.stop(this.getTrackId()):this._source.stop(),n.onSuccess()}close(){super.close(),this._source.destroy()}_updatePlayerSource(){R.debug("[".concat(this.getTrackId(),"] update player source track")),this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&fi.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(n,s){this._originMediaStreamTrack!==n&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n.addEventListener("ended",this._handleTrackEnded),s&&this._originMediaStreamTrack.stop(),this._originMediaStreamTrack=n,this._source.updateTrack(this._originMediaStreamTrack),this._mediaStreamTrack!==this._source.outputTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await nn(this,De.NEED_REPLACE_TRACK,this._mediaStreamTrack)))}renewMediaStreamTrack(){return se.resolve(void 0)}}ti([Ht(),rt("design:type",Function),rt("design:paramtypes",[String]),rt("design:returntype",se)],Br.prototype,"setPlaybackDevice",null),ti([Ht(),rt("design:type",Function),rt("design:paramtypes",[Boolean,Object,Boolean]),rt("design:returntype",se)],Br.prototype,"setEnabled",null),ti([Ht(),Bh({report:z}),rt("design:type",Function),rt("design:paramtypes",[Boolean]),rt("design:returntype",se)],Br.prototype,"setMuted",null),ti([Ht(),rt("design:type",Function),rt("design:paramtypes",[]),rt("design:returntype",Object)],Br.prototype,"getStats",null),ti([Ht(),rt("design:type",Function),rt("design:paramtypes",[Object,Number]),rt("design:returntype",void 0)],Br.prototype,"setAudioFrameCallback",null),ti([Ht(),rt("design:type",Function),rt("design:paramtypes",[]),rt("design:returntype",void 0)],Br.prototype,"play",null),ti([Ht(),rt("design:type",Function),rt("design:paramtypes",[]),rt("design:returntype",void 0)],Br.prototype,"stop",null);class hl extends Br{constructor(n,s,c,u){super(n,s.encoderConfig?Oa(s.encoderConfig):{},u);this._deviceName="default",this._enabled=!0,this._config=s,this._constraints=c,this._deviceName=n.label,typeof s.bypassWebAudio=="boolean"&&(this._bypassWebAudio=s.bypassWebAudio),ki()&&ht.bindInterruptDetectorTrack(this)}async setDevice(n){var s,c;let u=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.MIC_AUDIO_TRACK_SET_DEVICE,options:[this.getTrackId(),n]});if(R.info(b(s="[".concat(this.getTrackId(),"] start set device to ")).call(s,n)),this._enabled)try{let h=await Qn.getDeviceById(n);s={},s.audio=Iu({},this._constraints),s.audio.deviceId={exact:n},this._originMediaStreamTrack.stop();let p=null;try{p=await bi(s,this.getTrackId())}catch(f){throw R.error("[".concat(this.getTrackId(),"] setDevice failed"),f.toString()),p=await bi({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(p.getAudioTracks()[0],!1),f}await this._updateOriginMediaStreamTrack(p.getAudioTracks()[0],!1),this._deviceName=h.label,this._config.microphoneId=n,this._constraints.deviceId={exact:n}}catch(h){throw u.onError(h),R.error("[".concat(this.getTrackId(),"] setDevice error"),h.toString()),h}else try{this._deviceName=(await Qn.getDeviceById(n)).label,this._config.microphoneId=n,this._constraints.deviceId={exact:n}}catch(h){throw u.onError(h),R.error("[".concat(this.getTrackId(),"] setDevice error"),h.toString()),h}u.onSuccess(),R.info(b(c="[".concat(this.getTrackId(),"] set device to ")).call(c,n," success"))}async setEnabled(n,s,c){if(s)return R.debug("[".concat(this.getTrackId,"] setEnabled false (do not close microphone)")),await super.setEnabled(n);if(!c){if(n===this._enabled)return;this.stateCheck("enabled",n)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),n),s=await this._enabledMutex.lock(),!n){this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),c||(this._enabled=!1);try{await nn(this,De.NEED_REMOVE_TRACK,this)}catch(h){throw R.error("[".concat(this.getTrackId(),"] setEnabled false failed"),h.toString()),s(),h}return void s()}n=Iu({},this._constraints);let u=Qn.searchDeviceIdByName(this._deviceName);u&&!n.deviceId&&(n.deviceId=u);try{let h=await bi({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),await nn(this,De.NEED_ADD_TRACK,this)}catch(h){throw s(),R.error("[".concat(this.getTrackId(),"] setEnabled true failed"),h.toString()),h}c||(this._enabled=!0),R.info("[".concat(this.getTrackId(),"] setEnabled success")),s()}close(){super.close(),ki()&&ht.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Bn()||mo())&&this._enabled&&!this._isClosed&&ht.duringInterruption){let n=async()=>{ht.off(Zr.IOS_INTERRUPTION_END,n),this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};ht.on(Zr.IOS_INTERRUPTION_END,n)}else R.debug("[".concat(this.getTrackId(),"] track ended")),this.emit(ta.TRACK_ENDED)}async renewMediaStreamTrack(){var n=Iu({},this._constraints);let s=Qn.searchDeviceIdByName(this._deviceName);s&&!n.deviceId&&(n.deviceId=s),n=await bi({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(n.getAudioTracks()[0],!0)}}ti([Ht(),rt("design:type",Function),rt("design:paramtypes",[String]),rt("design:returntype",se)],hl.prototype,"setDevice",null),ti([Ht(),rt("design:type",Function),rt("design:paramtypes",[Boolean,Boolean,Boolean]),rt("design:returntype",se)],hl.prototype,"setEnabled",null);class ec extends Br{constructor(n,s,c,u){super(s.createOutputTrack(),c,u);this.source=n,this._bufferSource=s,this._bufferSource.on(Qi.AUDIO_SOURCE_STATE_CHANGE,h=>{this.emit(ta.SOURCE_STATE_CHANGE,h)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(n){let s=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.BUFFER_AUDIO_TRACK_START,options:[this.getTrackId(),n,this.duration]});n&&this._bufferSource.updateOptions(n),this._bufferSource.startProcessAudioBuffer(),s.onSuccess()}pauseProcessAudioBuffer(){let n=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.BUFFER_AUDIO_TRACK_PAUSE,options:[this.getTrackId()]});this._bufferSource.pauseProcessAudioBuffer(),n.onSuccess()}seekAudioBuffer(n){let s=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.BUFFER_AUDIO_TRACK_SEEK,options:[this.getTrackId()]});this._bufferSource.seekAudioBuffer(n),s.onSuccess()}resumeProcessAudioBuffer(){let n=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.BUFFER_AUDIO_TRACK_RESUME,options:[this.getTrackId()]});this._bufferSource.resumeProcessAudioBuffer(),n.onSuccess()}stopProcessAudioBuffer(){let n=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.BUFFER_AUDIO_TRACK_STOP,options:[this.getTrackId()]});this._bufferSource.stopProcessAudioBuffer(),n.onSuccess()}}ti([Ht(),rt("design:type",Function),rt("design:paramtypes",[Object]),rt("design:returntype",void 0)],ec.prototype,"startProcessAudioBuffer",null),ti([Ht(),rt("design:type",Function),rt("design:paramtypes",[]),rt("design:returntype",void 0)],ec.prototype,"pauseProcessAudioBuffer",null),ti([Ht(),rt("design:type",Function),rt("design:paramtypes",[Number]),rt("design:returntype",void 0)],ec.prototype,"seekAudioBuffer",null),ti([Ht(),rt("design:type",Function),rt("design:paramtypes",[]),rt("design:returntype",void 0)],ec.prototype,"resumeProcessAudioBuffer",null),ti([Ht(),rt("design:type",Function),rt("design:paramtypes",[]),rt("design:returntype",void 0)],ec.prototype,"stopProcessAudioBuffer",null);class cn extends Br{constructor(){let n=Gc().createMediaStreamDestination();super(n.stream.getAudioTracks()[0],void 0,rr(8,"track-mix-"));try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=n,this.trackList=[]}get isActive(){var n;return!(!this.trackList.length||!ze(n=this.trackList).call(n,s=>!s.muted))}getSubTrackLabels(){var n;return Ie(n=this.trackList).call(n,s=>s.getTrackLabel())}hasAudioTrack(n){var s;return He(s=this.trackList).call(s,n)!==-1}addAudioTrack(n){var s;He(s=this.trackList).call(s,n)===-1?(R.debug("add ".concat(n.getTrackId()," to mixing track")),n._source.outputNode.connect(this.destNode),this.trackList.push(n),this.updateEncoderConfig()):R.debug("track ".concat(n.getTrackId()," is already added"))}removeAudioTrack(n){var s;if(He(s=this.trackList).call(s,n)!==-1){R.debug("remove ".concat(n.getTrackId()," from mixing track"));try{n._source.outputNode.disconnect(this.destNode)}catch{}js(this.trackList,n),this.updateEncoderConfig()}}updateEncoderConfig(){var n;let s={};H(n=this.trackList).call(n,c=>{c._encoderConfig&&((c._encoderConfig.bitrate||0)>(s.bitrate||0)&&(s.bitrate=c._encoderConfig.bitrate),(c._encoderConfig.sampleRate||0)>(s.sampleRate||0)&&(s.sampleRate=c._encoderConfig.sampleRate),(c._encoderConfig.sampleSize||0)>(s.sampleSize||0)&&(s.sampleSize=c._encoderConfig.sampleSize),c._encoderConfig.stereo&&(s.stereo=!0))}),this._encoderConfig=s}}class xR extends $r{constructor(){super(...arguments);this.resultStorage=new Ct}setLocalAudioStats(n,s,c){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",n,this.checkAudioInputLevel(c,s)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",n,this.checkSendAudioBitrate(c,s))}setLocalVideoStats(n,s,c){this.record("SEND_VIDEO_BITRATE_TOO_LOW",n,this.checkSendVideoBitrate(c,s)),this.record("FRAMERATE_INPUT_TOO_LOW",n,this.checkFramerateInput(c,s)),this.record("FRAMERATE_SENT_TOO_LOW",n,this.checkFramerateSent(c))}setRemoteAudioStats(n,s){n=n.getUserId(),this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",n,this.checkAudioOutputLevel(s))}setRemoteVideoStats(n,s){n=n.getUserId(),this.record("RECV_VIDEO_DECODE_FAILED",n,this.checkVideoDecode(s))}record(n,s,c){this.resultStorage.has(n)||this.resultStorage.set(n,{result:[],isPrevNormal:!0});let u=this.resultStorage.get(n);if(u&&(u.result.push(c),5<=u.result.length)){var h;c=gt(h=u.result).call(h,!0),u.isPrevNormal&&!c&&this.emit("exception",m1[n],n,s),!u.isPrevNormal&&c&&this.emit("exception",m1[n]+2e3,n+"_RECOVER",s),u.isPrevNormal=c,u.result=[]}}checkAudioOutputLevel(n){return!(0<n.receiveBitrate&&n.receiveLevel===0)}checkAudioInputLevel(n,s){return s instanceof cn&&!s.isActive||!!s.muted||n.sendVolumeLevel!==0}checkFramerateInput(n,s){let c=null;return s._encoderConfig&&s._encoderConfig.frameRate&&(c=ds(s._encoderConfig.frameRate)),n=n.captureFrameRate,!c||!n||!(10<c&&5>n||10>c&&5<=c&&1>=n)}checkFramerateSent(n){return!(n.captureFrameRate&&n.sendFrameRate&&5<n.captureFrameRate&&1>=n.sendFrameRate)}checkSendVideoBitrate(n,s){return!!s.muted||n.sendBitrate!==0}checkSendAudioBitrate(n,s){return s instanceof cn&&!s.isActive||!!s.muted||n.sendBitrate!==0}checkVideoDecode(n){return n.receiveBitrate===0||n.decodeFrameRate!==0}}let m1={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003};class tc{constructor(n){this.localConnectionsMap=new Ct,this.remoteConnectionsMap=new Ct,this.trafficStatsPeerList=[],this.updateStats=()=>{var s,c;H(s=this.remoteConnectionsMap).call(s,u=>{var h;let p=u.audioStats;var f=u.videoStats,m=u.pcStats;let I=Eo({},Lp),E=Eo({},Mp),_=Eo({},HE),S=u.connection.pc.getStats(),N=S.audioRecv[0],O=S.videoRecv[0];m=m?m.videoRecv[0]:void 0;let B=u.connection.pc._statsFilter.videoIsReady===!0,Q=this.trafficStats&&ze(h=this.trafficStats.peer_delay).call(h,q=>q.peer_uid===u.connection.getUserId());N&&(N.codec!=="opus"&&N.codec!=="aac"||(I.codecType=N.codec),N.outputLevel?I.receiveLevel=Math.round(32767*N.outputLevel):u.connection.user.audioTrack&&(I.receiveLevel=Math.round(32767*u.connection.user.audioTrack.getVolumeLevel())),I.receiveBytes=N.bytes,I.receivePackets=N.packets,I.receivePacketsLost=N.packetsLost,I.packetLossRate=I.receivePacketsLost/(I.receivePackets+I.receivePacketsLost),I.receiveBitrate=p?8*Math.max(0,I.receiveBytes-p.receiveBytes):0,I.totalDuration=p?p.totalDuration+1:1,I.totalFreezeTime=p?p.totalFreezeTime:0,I.freezeRate=I.totalFreezeTime/I.totalDuration,I.receiveDelay=N.jitterBufferMs,h=u.connection.user.audioTrack,10<I.totalDuration&&tc.isRemoteAudioFreeze(h)&&(I.totalFreezeTime+=1)),O&&(O.codec!=="H264"&&O.codec!=="VP8"&&O.codec!=="VP9"&&O.codec!=="AV1X"||(E.codecType=O.codec),E.receiveBytes=O.bytes,E.receiveBitrate=f?8*Math.max(0,E.receiveBytes-f.receiveBytes):0,E.decodeFrameRate=O.decodeFrameRate,E.renderFrameRate=O.decodeFrameRate,O.outputFrame&&(E.renderFrameRate=O.outputFrame.frameRate),O.receivedFrame?(E.receiveFrameRate=O.receivedFrame.frameRate,E.receiveResolutionHeight=O.receivedFrame.height,E.receiveResolutionWidth=O.receivedFrame.width):u.connection.user.videoTrack&&(E.receiveResolutionHeight=u.connection.user.videoTrack._videoHeight||0,E.receiveResolutionWidth=u.connection.user.videoTrack._videoWidth||0),O.framesRateFirefox!==void 0&&(E.receiveFrameRate=Math.round(O.framesRateFirefox)),E.receivePackets=O.packets,E.receivePacketsLost=O.packetsLost,E.packetLossRate=E.receivePacketsLost/(E.receivePackets+E.receivePacketsLost),E.totalDuration=f?f.totalDuration+1:1,E.totalFreezeTime=f?f.totalFreezeTime:0,E.receiveDelay=O.jitterBufferMs||0,f=u.connection.user.videoTrack,u.connection.subscribeOptions.video&&B&&tc.isRemoteVideoFreeze(f,O,m)&&(E.totalFreezeTime+=1),E.freezeRate=E.totalFreezeTime/E.totalDuration),Q&&(I.end2EndDelay=Q.B_ad,E.end2EndDelay=Q.B_vd,I.transportDelay=Q.B_ed,E.transportDelay=Q.B_ed,I.currentPacketLossRate=Q.B_ealr4/100,E.currentPacketLossRate=Q.B_evlr4/100,_.uplinkNetworkQuality=Q.B_punq?Q.B_punq:0,_.downlinkNetworkQuality=Q.B_pdnq?Q.B_punq:0),u.audioStats=I,u.videoStats=E,u.pcStats=S,u.networkStats=_,u.connection.user.audioTrack&&this.exceptionMonitor.setRemoteAudioStats(u.connection.user.audioTrack,I),u.connection.user.videoTrack&&this.exceptionMonitor.setRemoteVideoStats(u.connection.user.videoTrack,E)}),H(c=this.localConnectionsMap).call(c,u=>{let h=u.audioStats,p=u.videoStats,f=Eo({},$u),m=Eo({},Zu);var I=u.connection.pc.getStats();let E=I.audioSend[0];I=I.videoSend[0];let _=u.connection.getUserId();E&&(E.codec!=="opus"&&E.codec!=="aac"||(f.codecType=E.codec),E.inputLevel?f.sendVolumeLevel=Math.round(32767*E.inputLevel):u.connection.audioTrack&&(f.sendVolumeLevel=Math.round(32767*u.connection.audioTrack.getVolumeLevel())),f.sendBytes=E.bytes,f.sendPackets=E.packets,f.sendPacketsLost=E.packetsLost,f.sendBitrate=h?8*Math.max(0,f.sendBytes-h.sendBytes):0),I&&(I.codec!=="H264"&&I.codec!=="VP8"&&I.codec!=="VP9"&&I.codec!=="AV1X"||(m.codecType=I.codec),m.sendBytes=I.bytes,m.sendBitrate=p?8*Math.max(0,m.sendBytes-p.sendBytes):0,I.inputFrame?(m.captureFrameRate=I.inputFrame.frameRate,m.captureResolutionHeight=I.inputFrame.height,m.captureResolutionWidth=I.inputFrame.width):u.connection.videoTrack&&(m.captureResolutionWidth=u.connection.videoTrack._videoWidth||0,m.captureResolutionHeight=u.connection.videoTrack._videoHeight||0),I.sentFrame?(m.sendFrameRate=I.sentFrame.frameRate,m.sendResolutionHeight=I.sentFrame.height,m.sendResolutionWidth=I.sentFrame.width):u.connection.videoTrack&&(m.sendResolutionWidth=u.connection.videoTrack._videoWidth||0,m.sendResolutionHeight=u.connection.videoTrack._videoHeight||0),I.avgEncodeMs&&(m.encodeDelay=I.avgEncodeMs),u.connection.videoTrack&&u.connection.videoTrack._encoderConfig&&u.connection.videoTrack._encoderConfig.bitrateMax&&(m.targetSendBitrate=1e3*u.connection.videoTrack._encoderConfig.bitrateMax),m.sendPackets=I.packets,m.sendPacketsLost=I.packetsLost,m.totalDuration=p?p.totalDuration+1:1,m.totalFreezeTime=p?p.totalFreezeTime:0,this.isLocalVideoFreeze(I)&&(m.totalFreezeTime+=1)),this.trafficStats&&(f.sendPacketsLost=this.trafficStats.B_palr4/100,m.sendPacketsLost=this.trafficStats.B_pvlr4/100),u.audioStats=f,u.videoStats=m,u.audioStats&&u.connection.audioTrack&&this.exceptionMonitor.setLocalAudioStats(_,u.connection.audioTrack,u.audioStats),u.videoStats&&u.connection.videoTrack&&this.exceptionMonitor.setLocalVideoStats(_,u.connection.videoTrack,u.videoStats)})},this.clientId=n,this.updateStatsInterval=window.setInterval(this.updateStats,1e3),this.exceptionMonitor=new xR,this.exceptionMonitor.on("exception",(s,c,u)=>{this.onStatsException&&this.onStatsException(s,c,u)})}reset(){this.localConnectionsMap=new Ct,this.remoteConnectionsMap=new Ct,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(n){return(n=this.localConnectionsMap.get(n))&&n.audioStats?n.audioStats:Eo({},$u)}getLocalVideoTrackStats(n){return(n=this.localConnectionsMap.get(n))&&n.videoStats?n.videoStats:Eo({},Zu)}getRemoteAudioTrackStats(n){var s;let c=this.remoteConnectionsMap.get(n);return!c||!c.audioStats?Eo({},Lp):this.trafficStats?(n=ze(s=this.trafficStats.peer_delay).call(s,u=>u.peer_uid===c.connection.user.uid),n&&(c.audioStats.publishDuration=n.B_ppad+(le()-this.trafficStats.timestamp)),c.audioStats):c.audioStats}getRemoteNetworkQualityStats(n){return(n=this.remoteConnectionsMap.get(n))&&n.networkStats?n.networkStats:Eo({},HE)}getRemoteVideoTrackStats(n){var s;let c=this.remoteConnectionsMap.get(n);return!c||!c.videoStats?Eo({},Mp):this.trafficStats?(n=ze(s=this.trafficStats.peer_delay).call(s,u=>u.peer_uid===c.connection.user.uid),n&&(c.videoStats.publishDuration=n.B_ppvd+(le()-this.trafficStats.timestamp)),c.videoStats):c.videoStats}getRTCStats(){var n,s;let c=0,u=0,h=0,p=0;return H(n=this.localConnectionsMap).call(n,f=>{f.audioStats&&(c+=f.audioStats.sendBytes,u+=f.audioStats.sendBitrate),f.videoStats&&(c+=f.videoStats.sendBytes,u+=f.videoStats.sendBitrate)}),H(s=this.remoteConnectionsMap).call(s,f=>{f.audioStats&&(h+=f.audioStats.receiveBytes,p+=f.audioStats.receiveBitrate),f.videoStats&&(h+=f.videoStats.receiveBytes,p+=f.videoStats.receiveBitrate)}),n=1,this.trafficStats&&(n+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:n,SendBitrate:u,SendBytes:c,RecvBytes:h,RecvBitrate:p,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}removeConnection(n){this.localConnectionsMap.delete(n),this.remoteConnectionsMap.delete(n)}addLocalConnection(n){let s=n.connectionId;this.localConnectionsMap.has(s)||this.localConnectionsMap.set(s,{connection:n})}addRemoteConnection(n){let s=n.connectionId;this.remoteConnectionsMap.has(s)||this.remoteConnectionsMap.set(s,{connection:n})}updateTrafficStats(n){var s;let c=Qe(s=n.peer_delay).call(s,u=>{var h;return He(h=this.trafficStatsPeerList).call(h,u.peer_uid)===-1});H(c).call(c,u=>{var h,p;let f=ze(h=io(ra(p=this.remoteConnectionsMap).call(p))).call(h,m=>m.connection._userId===u.peer_uid);u.B_ppad!==void 0&&u.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(u.peer_uid,u.B_ppad,u.B_ppvd,f?le()-f.connection.startTime:0),this.trafficStatsPeerList.push(u.peer_uid))}),this.trafficStats=n}updateUplinkStats(n){var s;this.uplinkStats&&this.uplinkStats.B_fir!==n.B_fir&&R.debug(b(s="[".concat(this.clientId,"]: Period fir changes to ")).call(s,n.B_fir)),this.uplinkStats=n}static isRemoteVideoFreeze(n,s,c){return n?(n=!c||s.framesDecodeCount>c.framesDecodeCount,!!c&&s.framesDecodeFreezeTime>c.framesDecodeFreezeTime||!n):!1}static isRemoteAudioFreeze(n){return!!n&&n._isFreeze()}isLocalVideoFreeze(n){return!(!n.inputFrame||!n.sentFrame)&&5<n.inputFrame.frameRate&&3>n.sentFrame.frameRate}}var v1;let id=()=>{},E1={},I1=new class{constructor(){this.fnMap=new Ct}throttleByKey(i,n,s,c,...u){if(this.fnMap.has(n)){var h=this.fnMap.get(n);h.threshold!==s?(h.fn(...h.args),clearTimeout(h.timer),h=window.setTimeout(()=>{const p=this.fnMap.get(n);p&&p.fn(...p.args),this.fnMap.delete(n)},s),this.fnMap.set(n,{fn:i,threshold:s,timer:h,args:u,skipFn:c})):(h.skipFn&&h.skipFn(...h.args),this.fnMap.set(n,Ph({},h,{fn:i,args:u,skipFn:c})))}else h=window.setTimeout(()=>{const p=this.fnMap.get(n);p&&p.fn(...p.args),this.fnMap.delete(n)},s),this.fnMap.set(n,{fn:i,threshold:s,timer:h,args:u,skipFn:c})}},C1=hr(v1=I1.throttleByKey).call(v1,I1),rc=async({fragementLength:i,referenceList:n,asyncMapHandler:s,allFailedhandler:c,promisesCollector:u})=>{let h=0,p,f=0;const m=async()=>{const I=(()=>{var E=h*i;const _=E+i;return E=Ur(n).call(n,E,_),Ie(E).call(E,s)})();u&&u.push(...I);try{p=await Da(I)}catch(E){if(f+=i,h++,!(f>=n.length))return void await m();c(E)}H(I).call(I,E=>E.cancel())};return await m(),p},UR={[Xa.ACCESS_POINT]:{[zr.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[zr.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[zr.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[zr.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[zr.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[zr.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voice service available",retry:!0},[zr.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[zr.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[zr.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[zr.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[zr.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[zr.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[zr.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[zr.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[zr.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[zr.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[Xa.UNILBS]:{[$n.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[$n.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[$n.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[$n.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[$n.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[$n.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[$n.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[$n.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[$n.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[$n.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[$n.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[$n.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[Xa.STRING_UID_ALLOCATOR]:{[al.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[al.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[al.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}},FR={[Ne.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Ne.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Ne.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Ne.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Ne.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Ne.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Ne.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Ne.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Ne.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Ne.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Ne.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Ne.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Ne.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Ne.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Ne.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Ne.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Ne.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Ne.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Ne.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Ne.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Ne.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Ne.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Ne.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Ne.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Ne.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Ne.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Ne.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Ne.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Ne.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Ne.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Ne.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Ne.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Ne.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Ne.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Ne.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Ne.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Ne.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Ne.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Ne.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Ne.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Ne.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Ne.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ne.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ne.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Ne.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Ne.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Ne.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Ne.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Ne.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Ne.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Ne.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Ne.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Ne.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Ne.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Ne.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Ne.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"}};var VR=r(function(i,n){i.exports=function(){function s(x){for(var T=x.length,V=0,j=0;j<T;){var $=x.charCodeAt(j++);if((4294967168&$)!=0)if((4294965248&$)==0)V+=2;else{if(55296<=$&&56319>=$&&j<T){var W=x.charCodeAt(j);(64512&W)==56320&&(++j,$=((1023&$)<<10)+(1023&W)+65536)}V+=(4294901760&$)==0?3:4}else V++}return V}function c(x,T,V){V=T+V;for(var j=[],$="";T<V;){var W=x[T++];if((128&W)==0)j.push(W);else if((224&W)==192){var Ce=63&x[T++];j.push((31&W)<<6|Ce)}else if((240&W)==224){Ce=63&x[T++];var oe=63&x[T++];j.push((31&W)<<12|Ce<<6|oe)}else(248&W)==240&&(W=(7&W)<<18|(63&x[T++])<<12|(63&x[T++])<<6|63&x[T++],65535<W&&(W-=65536,j.push(W>>>10&1023|55296),W=56320|1023&W)),j.push(W);4096<=j.length&&($+=String.fromCharCode.apply(String,ve([],yt(j))),j.length=0)}return 0<j.length&&($+=String.fromCharCode.apply(String,ve([],yt(j)))),$}function u(x,T){return 4294967296*x.getInt32(T)+x.getUint32(T+4)}function h(x){var T,V=x.sec;if(x=x.nsec,0<=V&&0<=x&&17179869183>=V){if(x===0&&4294967295>=V){var j=new Uint8Array(4);return new DataView(j.buffer).setUint32(0,V),j}var $=V/4294967296;return V&=4294967295,j=new Uint8Array(8),(T=new DataView(j.buffer)).setUint32(0,x<<2|3&$),T.setUint32(4,V),j}return j=new Uint8Array(12),(T=new DataView(j.buffer)).setUint32(0,x),T.setUint32(4,Math.floor(V/4294967296)),T.setUint32(8,V),j}function p(x){var T=x.getTime();x=Math.floor(T/1e3),T=1e6*(T-1e3*x);var V=Math.floor(T/1e9);return{sec:x+V,nsec:T-1e9*V}}function f(x){return x instanceof Date?h(p(x)):null}function m(x){var T=new DataView(x.buffer,x.byteOffset,x.byteLength);switch(x.byteLength){case 4:return{sec:T.getUint32(0),nsec:0};case 8:return x=T.getUint32(0),{sec:4294967296*(3&x)+T.getUint32(4),nsec:x>>>2};case 12:return{sec:u(T,4),nsec:T.getUint32(0)};default:throw Error("Unrecognized data size for timestamp: "+x.length)}}function I(x){return x=m(x),new Date(1e3*x.sec+x.nsec/1e6)}function E(x){return x instanceof Uint8Array?x:ArrayBuffer.isView(x)?new Uint8Array(x.buffer,x.byteOffset,x.byteLength):x instanceof ArrayBuffer?new Uint8Array(x):Uint8Array.from(x)}function _(x,T){return T===void 0&&(T=_e),new Le(T.extensionCodec,T.context,T.maxDepth,T.initialBufferSize,T.sortKeys,T.forceFloat32,T.ignoreUndefined,T.forceIntegerToFloat).encode(x)}function S(x){return(0>x?"-":"")+"0x"+Math.abs(x).toString(16).padStart(2,"0")}function N(x,T){return T===void 0&&(T=lc),new cc(T.extensionCodec,T.context,T.maxStrLength,T.maxBinLength,T.maxArrayLength,T.maxMapLength,T.maxExtLength).decode(x)}function O(x,T){return T===void 0&&(T=lc),new cc(T.extensionCodec,T.context,T.maxStrLength,T.maxBinLength,T.maxArrayLength,T.maxMapLength,T.maxExtLength).decodeMulti(x)}function B(x){return x[Symbol.asyncIterator]!=null?x:function(T){return gN(this,arguments,function(){var V,j,$,W;return fN(this,function(Ce){switch(Ce.label){case 0:V=T.getReader(),Ce.label=1;case 1:Ce.trys.push([1,,9,10]),Ce.label=2;case 2:return[4,uc(V.read())];case 3:return j=Ce.sent(),$=j.done,W=j.value,$?[4,uc(void 0)]:[3,5];case 4:return[2,Ce.sent()];case 5:if(W==null)throw Error("Assertion Failure: value must not be null nor undefined");return[4,uc(W)];case 6:return[4,Ce.sent()];case 7:return Ce.sent(),[3,2];case 8:return[3,10];case 9:return V.releaseLock(),[7];case 10:return[2]}})})}(x)}function Q(x,T){return T===void 0&&(T=lc),V=this,j=void 0,W=function(){var Ce;return function(oe,We){function Pt(vi){return function(dc){return function(pt){if(ae)throw new TypeError("Generator is already executing.");for(;lt;)try{if(ae=1,Se&&(Ee=2&pt[0]?Se.return:pt[0]?Se.throw||((Ee=Se.return)&&Ee.call(Se),0):Se.next)&&!(Ee=Ee.call(Se,pt[1])).done)return Ee;switch(Se=0,Ee&&(pt=[2&pt[0],Ee.value]),pt[0]){case 0:case 1:Ee=pt;break;case 4:return lt.label++,{value:pt[1],done:!1};case 5:lt.label++,Se=pt[1],pt=[0];continue;case 7:pt=lt.ops.pop(),lt.trys.pop();continue;default:if(!((Ee=0<(Ee=lt.trys).length&&Ee[Ee.length-1])||pt[0]!==6&&pt[0]!==2)){lt=0;continue}if(pt[0]===3&&(!Ee||pt[1]>Ee[0]&&pt[1]<Ee[3]))lt.label=pt[1];else if(pt[0]===6&&lt.label<Ee[1])lt.label=Ee[1],Ee=pt;else if(Ee&&lt.label<Ee[2])lt.label=Ee[2],lt.ops.push(pt);else{Ee[2]&&lt.ops.pop(),lt.trys.pop();continue}}pt=We.call(oe,lt)}catch(vd){pt=[6,vd],Se=0}finally{ae=Ee=0}if(5&pt[0])throw pt[1];return{value:pt[0]?pt[1]:void 0,done:!0}}([vi,dc])}}var ae,Se,Ee,jt,lt={label:0,sent:function(){if(1&Ee[0])throw Ee[1];return Ee[1]},trys:[],ops:[]};return jt={next:Pt(0),throw:Pt(1),return:Pt(2)},typeof Symbol=="function"&&(jt[Symbol.iterator]=function(){return this}),jt}(this,function(oe){return Ce=B(x),[2,new cc(T.extensionCodec,T.context,T.maxStrLength,T.maxBinLength,T.maxArrayLength,T.maxMapLength,T.maxExtLength).decodeAsync(Ce)]})},new($=void 0,$=Promise)(function(Ce,oe){function We(Se){try{ae(W.next(Se))}catch(Ee){oe(Ee)}}function Pt(Se){try{ae(W.throw(Se))}catch(Ee){oe(Ee)}}function ae(Se){var Ee;Se.done?Ce(Se.value):(Ee=Se.value,Ee instanceof $?Ee:new $(function(jt){jt(Ee)})).then(We,Pt)}ae((W=W.apply(V,j||[])).next())});var V,j,$,W}function q(x,T){return T===void 0&&(T=lc),x=B(x),new cc(T.extensionCodec,T.context,T.maxStrLength,T.maxBinLength,T.maxArrayLength,T.maxMapLength,T.maxExtLength).decodeArrayStream(x)}function ie(x,T){return T===void 0&&(T=lc),x=B(x),new cc(T.extensionCodec,T.context,T.maxStrLength,T.maxBinLength,T.maxArrayLength,T.maxMapLength,T.maxExtLength).decodeStream(x)}function Ae(x,T){return T===void 0&&(T=lc),ie(x,T)}var Be={d:function(x,T){for(var V in T)Be.o(T,V)&&!Be.o(x,V)&&Object.defineProperty(x,V,{enumerable:!0,get:T[V]})},o:function(x,T){return Object.prototype.hasOwnProperty.call(x,T)},r:function(x){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(x,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(x,"__esModule",{value:!0})}},ke={};Be.r(ke),Be.d(ke,{DecodeError:function(){return Ro},Decoder:function(){return cc},EXT_TIMESTAMP:function(){return Y},Encoder:function(){return Le},ExtData:function(){return G},ExtensionCodec:function(){return ue},decode:function(){return N},decodeArrayStream:function(){return q},decodeAsync:function(){return Q},decodeMulti:function(){return O},decodeMultiStream:function(){return ie},decodeStream:function(){return Ae},decodeTimestampExtension:function(){return I},decodeTimestampToTimeSpec:function(){return m},encode:function(){return _},encodeDateToTimeSpec:function(){return p},encodeTimeSpecToTimestamp:function(){return h},encodeTimestampExtension:function(){return f}});var yt=function(x,T){var V=typeof Symbol=="function"&&x[Symbol.iterator];if(!V)return x;var j;x=V.call(x);var $=[];try{for(;(T===void 0||0<T--)&&!(j=x.next()).done;)$.push(j.value)}catch(Ce){var W={error:Ce}}finally{try{j&&!j.done&&(V=x.return)&&V.call(x)}finally{if(W)throw W.error}}return $},ve=function(x,T){for(var V=0,j=T.length,$=x.length;V<j;V++,$++)x[$]=T[V];return x},Ze=typeof TextEncoder!="undefined"&&typeof TextDecoder!="undefined",vt=Ze?new TextEncoder:void 0,Yt=Ze?typeof process!="undefined"?200:0:4294967295,Lr=(vt==null?0:vt.encodeInto)?function(x,T,V){vt.encodeInto(x,T.subarray(V))}:function(x,T,V){T.set(vt.encode(x),V)},xt=Ze?new TextDecoder:null,ln=Ze?typeof process!="undefined"?200:0:4294967295,G=function(x,T){this.type=x,this.data=T},Y=-1,Z={type:Y,encode:f,decode:I},ue=function(){function x(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(Z)}return x.prototype.register=function(T){var V=T.type,j=T.encode;T=T.decode,0<=V?(this.encoders[V]=j,this.decoders[V]=T):(V=1+V,this.builtInEncoders[V]=j,this.builtInDecoders[V]=T)},x.prototype.tryToEncode=function(T,V){for(var j=0;j<this.builtInEncoders.length;j++)if(($=this.builtInEncoders[j])!=null&&(W=$(T,V))!=null)return new G(-1-j,W);for(j=0;j<this.encoders.length;j++){var $,W;if(($=this.encoders[j])!=null&&(W=$(T,V))!=null)return new G(j,W)}return T instanceof G?T:null},x.prototype.decode=function(T,V,j){var $=0>V?this.builtInDecoders[-1-V]:this.decoders[V];return $?$(T,V,j):new G(V,T)},x.defaultCodec=new x,x}(),de=function(x){var T=typeof Symbol=="function"&&Symbol.iterator,V=T&&x[T],j=0;if(V)return V.call(x);if(x&&typeof x.length=="number")return{next:function(){return x&&j>=x.length&&(x=void 0),{value:x&&x[j++],done:!x}}};throw new TypeError(T?"Object is not iterable.":"Symbol.iterator is not defined.")},Le=function(){function x(T,V,j,$,W,Ce,oe,We){T===void 0&&(T=ue.defaultCodec),V===void 0&&(V=void 0),j===void 0&&(j=100),$===void 0&&($=2048),W===void 0&&(W=!1),Ce===void 0&&(Ce=!1),oe===void 0&&(oe=!1),We===void 0&&(We=!1),this.extensionCodec=T,this.context=V,this.maxDepth=j,this.initialBufferSize=$,this.sortKeys=W,this.forceFloat32=Ce,this.ignoreUndefined=oe,this.forceIntegerToFloat=We,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}return x.prototype.getUint8Array=function(){return this.bytes.subarray(0,this.pos)},x.prototype.reinitializeState=function(){this.pos=0},x.prototype.encode=function(T){return this.reinitializeState(),this.doEncode(T,1),this.getUint8Array()},x.prototype.doEncode=function(T,V){if(V>this.maxDepth)throw Error("Too deep objects in depth "+V);T==null?this.encodeNil():typeof T=="boolean"?this.encodeBoolean(T):typeof T=="number"?this.encodeNumber(T):typeof T=="string"?this.encodeString(T):this.encodeObject(T,V)},x.prototype.ensureBufferSizeToWrite=function(T){T=this.pos+T,this.view.byteLength<T&&this.resizeBuffer(2*T)},x.prototype.resizeBuffer=function(T){var V=new ArrayBuffer(T);T=new Uint8Array(V),V=new DataView(V),T.set(this.bytes),this.view=V,this.bytes=T},x.prototype.encodeNil=function(){this.writeU8(192)},x.prototype.encodeBoolean=function(T){T===!1?this.writeU8(194):this.writeU8(195)},x.prototype.encodeNumber=function(T){Number.isSafeInteger(T)&&!this.forceIntegerToFloat?0<=T?128>T?this.writeU8(T):256>T?(this.writeU8(204),this.writeU8(T)):65536>T?(this.writeU8(205),this.writeU16(T)):4294967296>T?(this.writeU8(206),this.writeU32(T)):(this.writeU8(207),this.writeU64(T)):-32<=T?this.writeU8(224|T+32):-128<=T?(this.writeU8(208),this.writeI8(T)):-32768<=T?(this.writeU8(209),this.writeI16(T)):-2147483648<=T?(this.writeU8(210),this.writeI32(T)):(this.writeU8(211),this.writeI64(T)):this.forceFloat32?(this.writeU8(202),this.writeF32(T)):(this.writeU8(203),this.writeF64(T))},x.prototype.writeStringHeader=function(T){if(32>T)this.writeU8(160+T);else if(256>T)this.writeU8(217),this.writeU8(T);else if(65536>T)this.writeU8(218),this.writeU16(T);else{if(!(4294967296>T))throw Error("Too long string: "+T+" bytes in UTF-8");this.writeU8(219),this.writeU32(T)}},x.prototype.encodeString=function(T){if(T.length>Yt){var V=s(T);this.ensureBufferSizeToWrite(5+V),this.writeStringHeader(V),Lr(T,this.bytes,this.pos)}else{V=s(T),this.ensureBufferSizeToWrite(5+V),this.writeStringHeader(V);for(var j=this.bytes,$=T.length,W=this.pos,Ce=0;Ce<$;){var oe=T.charCodeAt(Ce++);if((4294967168&oe)!=0){if((4294965248&oe)==0)j[W++]=oe>>6&31|192;else{if(55296<=oe&&56319>=oe&&Ce<$){var We=T.charCodeAt(Ce);(64512&We)==56320&&(++Ce,oe=((1023&oe)<<10)+(1023&We)+65536)}(4294901760&oe)==0?(j[W++]=oe>>12&15|224,j[W++]=oe>>6&63|128):(j[W++]=oe>>18&7|240,j[W++]=oe>>12&63|128,j[W++]=oe>>6&63|128)}j[W++]=63&oe|128}else j[W++]=oe}}this.pos+=V},x.prototype.encodeObject=function(T,V){var j=this.extensionCodec.tryToEncode(T,this.context);if(j!=null)this.encodeExtension(j);else if(Array.isArray(T))this.encodeArray(T,V);else if(ArrayBuffer.isView(T))this.encodeBinary(T);else{if(typeof T!="object")throw Error("Unrecognized object: "+Object.prototype.toString.apply(T));this.encodeMap(T,V)}},x.prototype.encodeBinary=function(T){var V=T.byteLength;if(256>V)this.writeU8(196),this.writeU8(V);else if(65536>V)this.writeU8(197),this.writeU16(V);else{if(!(4294967296>V))throw Error("Too large binary: "+V);this.writeU8(198),this.writeU32(V)}T=E(T),this.writeU8a(T)},x.prototype.encodeArray=function(T,V){var j,$=T.length;if(16>$)this.writeU8(144+$);else if(65536>$)this.writeU8(220),this.writeU16($);else{if(!(4294967296>$))throw Error("Too large array: "+$);this.writeU8(221),this.writeU32($)}try{for(var W=de(T),Ce=W.next();!Ce.done;Ce=W.next())this.doEncode(Ce.value,V+1)}catch(We){var oe={error:We}}finally{try{Ce&&!Ce.done&&(j=W.return)&&j.call(W)}finally{if(oe)throw oe.error}}},x.prototype.countWithoutUndefined=function(T,V){var j,$=0;try{for(var W=de(V),Ce=W.next();!Ce.done;Ce=W.next())T[Ce.value]!==void 0&&$++}catch(We){var oe={error:We}}finally{try{Ce&&!Ce.done&&(j=W.return)&&j.call(W)}finally{if(oe)throw oe.error}}return $},x.prototype.encodeMap=function(T,V){var j,$=Object.keys(T);this.sortKeys&&$.sort();var W=this.ignoreUndefined?this.countWithoutUndefined(T,$):$.length;if(16>W)this.writeU8(128+W);else if(65536>W)this.writeU8(222),this.writeU16(W);else{if(!(4294967296>W))throw Error("Too large map object: "+W);this.writeU8(223),this.writeU32(W)}try{for(var Ce=de($),oe=Ce.next();!oe.done;oe=Ce.next()){var We=oe.value,Pt=T[We];this.ignoreUndefined&&Pt===void 0||(this.encodeString(We),this.doEncode(Pt,V+1))}}catch(Se){var ae={error:Se}}finally{try{oe&&!oe.done&&(j=Ce.return)&&j.call(Ce)}finally{if(ae)throw ae.error}}},x.prototype.encodeExtension=function(T){var V=T.data.length;if(V===1)this.writeU8(212);else if(V===2)this.writeU8(213);else if(V===4)this.writeU8(214);else if(V===8)this.writeU8(215);else if(V===16)this.writeU8(216);else if(256>V)this.writeU8(199),this.writeU8(V);else if(65536>V)this.writeU8(200),this.writeU16(V);else{if(!(4294967296>V))throw Error("Too large extension object: "+V);this.writeU8(201),this.writeU32(V)}this.writeI8(T.type),this.writeU8a(T.data)},x.prototype.writeU8=function(T){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,T),this.pos++},x.prototype.writeU8a=function(T){var V=T.length;this.ensureBufferSizeToWrite(V),this.bytes.set(T,this.pos),this.pos+=V},x.prototype.writeI8=function(T){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,T),this.pos++},x.prototype.writeU16=function(T){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,T),this.pos+=2},x.prototype.writeI16=function(T){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,T),this.pos+=2},x.prototype.writeU32=function(T){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,T),this.pos+=4},x.prototype.writeI32=function(T){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,T),this.pos+=4},x.prototype.writeF32=function(T){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,T),this.pos+=4},x.prototype.writeF64=function(T){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,T),this.pos+=8},x.prototype.writeU64=function(T){this.ensureBufferSizeToWrite(8);var V=this.view,j=this.pos;V.setUint32(j,T/4294967296),V.setUint32(j+4,T),this.pos+=8},x.prototype.writeI64=function(T){this.ensureBufferSizeToWrite(8);var V=this.view,j=this.pos;V.setUint32(j,Math.floor(T/4294967296)),V.setUint32(j+4,T),this.pos+=8},x}(),_e={},_r;Ze=function(){function x(T,V){for(T===void 0&&(T=16),V===void 0&&(V=16),this.maxKeyLength=T,this.maxLengthPerKey=V,this.miss=this.hit=0,this.caches=[],T=0;T<this.maxKeyLength;T++)this.caches.push([])}return x.prototype.canBeCached=function(T){return 0<T&&T<=this.maxKeyLength},x.prototype.find=function(T,V,j){var $,W=this.caches[j-1];try{var Ce=function(Se){var Ee=typeof Symbol=="function"&&Symbol.iterator,jt=Ee&&Se[Ee],lt=0;if(jt)return jt.call(Se);if(Se&&typeof Se.length=="number")return{next:function(){return Se&&lt>=Se.length&&(Se=void 0),{value:Se&&Se[lt++],done:!Se}}};throw new TypeError(Ee?"Object is not iterable.":"Symbol.iterator is not defined.")}(W),oe=Ce.next();e:for(;!oe.done;oe=Ce.next()){var We=oe.value,Pt=We.bytes;for(W=0;W<j;W++)if(Pt[W]!==T[V+W])continue e;return We.str}}catch(Se){var ae={error:Se}}finally{try{oe&&!oe.done&&($=Ce.return)&&$.call(Ce)}finally{if(ae)throw ae.error}}return null},x.prototype.store=function(T,V){var j=this.caches[T.length-1];T={bytes:T,str:V},j.length>=this.maxLengthPerKey?j[Math.random()*j.length|0]=T:j.push(T)},x.prototype.decode=function(T,V,j){var $=this.find(T,V,j);return $!=null?(this.hit++,$):(this.miss++,$=c(T,V,j),T=Uint8Array.prototype.slice.call(T,V,V+j),this.store(T,$),$)},x}();var sa=(_r=function(x,T){return(_r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(V,j){V.__proto__=j}||function(V,j){for(var $ in j)Object.prototype.hasOwnProperty.call(j,$)&&(V[$]=j[$])})(x,T)},function(x,T){function V(){this.constructor=x}if(typeof T!="function"&&T!==null)throw new TypeError("Class extends value "+String(T)+" is not a constructor or null");_r(x,T),x.prototype=T===null?Object.create(T):(V.prototype=T.prototype,new V)}),aa=function(x,T){function V(We){return function(Pt){return function(ae){if(j)throw new TypeError("Generator is already executing.");for(;oe;)try{if(j=1,$&&(W=2&ae[0]?$.return:ae[0]?$.throw||((W=$.return)&&W.call($),0):$.next)&&!(W=W.call($,ae[1])).done)return W;switch($=0,W&&(ae=[2&ae[0],W.value]),ae[0]){case 0:case 1:W=ae;break;case 4:return oe.label++,{value:ae[1],done:!1};case 5:oe.label++,$=ae[1],ae=[0];continue;case 7:ae=oe.ops.pop(),oe.trys.pop();continue;default:if(!((W=0<(W=oe.trys).length&&W[W.length-1])||ae[0]!==6&&ae[0]!==2)){oe=0;continue}if(ae[0]===3&&(!W||ae[1]>W[0]&&ae[1]<W[3]))oe.label=ae[1];else if(ae[0]===6&&oe.label<W[1])oe.label=W[1],W=ae;else if(W&&oe.label<W[2])oe.label=W[2],oe.ops.push(ae);else{W[2]&&oe.ops.pop(),oe.trys.pop();continue}}ae=T.call(x,oe)}catch(Se){ae=[6,Se],$=0}finally{j=W=0}if(5&ae[0])throw ae[1];return{value:ae[0]?ae[1]:void 0,done:!0}}([We,Pt])}}var j,$,W,Ce,oe={label:0,sent:function(){if(1&W[0])throw W[1];return W[1]},trys:[],ops:[]};return Ce={next:V(0),throw:V(1),return:V(2)},typeof Symbol=="function"&&(Ce[Symbol.iterator]=function(){return this}),Ce},ac=function(x){function T($){V[$]=x[$]&&function(W){return new Promise(function(Ce,oe){(function(We,Pt,ae,Se){Promise.resolve(Se).then(function(Ee){We({value:Ee,done:ae})},Pt)})(Ce,oe,(W=x[$](W)).done,W.value)})}}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var V,j=x[Symbol.asyncIterator];return j?j.call(x):(x=typeof __values=="function"?__values(x):x[Symbol.iterator](),V={},T("next"),T("throw"),T("return"),V[Symbol.asyncIterator]=function(){return this},V)},ot=function(x){return this instanceof ot?(this.v=x,this):new ot(x)},qt=function(x,T,V){function j(Se){Pt[Se]&&(We[Se]=function(Ee){return new Promise(function(jt,lt){1<ae.push([Se,Ee,jt,lt])||$(Se,Ee)})})}function $(Se,Ee){try{(jt=Pt[Se](Ee)).value instanceof ot?Promise.resolve(jt.value.v).then(W,Ce):oe(ae[0][2],jt)}catch(lt){oe(ae[0][3],lt)}var jt}function W(Se){$("next",Se)}function Ce(Se){$("throw",Se)}function oe(Se,Ee){Se(Ee),ae.shift(),ae.length&&$(ae[0][0],ae[0][1])}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var We,Pt=V.apply(x,T||[]),ae=[];return We={},j("next"),j("throw"),j("return"),We[Symbol.asyncIterator]=function(){return this},We},Mr=new DataView(new ArrayBuffer(0)),Sr=new Uint8Array(Mr.buffer);e:{try{Mr.getInt8(0)}catch(x){var Ar=x.constructor;break e}throw Error("never reached")}var so=new Ar("Insufficient data"),Gr=new Ze,Ro=function(x){function T(V){V=x.call(this,V)||this;var j=Object.create(T.prototype);return Object.setPrototypeOf(V,j),Object.defineProperty(V,"name",{configurable:!0,enumerable:!1,value:T.name}),V}return sa(T,x),T}(Error),cc=function(){function x(T,V,j,$,W,Ce,oe,We){T===void 0&&(T=ue.defaultCodec),V===void 0&&(V=void 0),j===void 0&&(j=4294967295),$===void 0&&($=4294967295),W===void 0&&(W=4294967295),Ce===void 0&&(Ce=4294967295),oe===void 0&&(oe=4294967295),We===void 0&&(We=Gr),this.extensionCodec=T,this.context=V,this.maxStrLength=j,this.maxBinLength=$,this.maxArrayLength=W,this.maxMapLength=Ce,this.maxExtLength=oe,this.keyDecoder=We,this.pos=this.totalPos=0,this.view=Mr,this.bytes=Sr,this.headByte=-1,this.stack=[]}return x.prototype.reinitializeState=function(){this.totalPos=0,this.headByte=-1,this.stack.length=0},x.prototype.setBuffer=function(T){this.bytes=E(T),T=this.bytes,T instanceof ArrayBuffer?T=new DataView(T):(T=E(T),T=new DataView(T.buffer,T.byteOffset,T.byteLength)),this.view=T,this.pos=0},x.prototype.appendBuffer=function(T){if(this.headByte!==-1||this.hasRemaining()){var V=this.bytes.subarray(this.pos);T=E(T);var j=new Uint8Array(V.length+T.length);j.set(V),j.set(T,V.length),this.setBuffer(j)}else this.setBuffer(T)},x.prototype.hasRemaining=function(T){return T===void 0&&(T=1),this.view.byteLength-this.pos>=T},x.prototype.createExtraByteError=function(T){var V=this.view;return new RangeError("Extra "+(V.byteLength-this.pos)+" of "+V.byteLength+" byte(s) found at buffer["+T+"]")},x.prototype.decode=function(T){if(this.reinitializeState(),this.setBuffer(T),T=this.doDecodeSync(),this.hasRemaining())throw this.createExtraByteError(this.pos);return T},x.prototype.decodeMulti=function(T){return aa(this,function(V){switch(V.label){case 0:this.reinitializeState(),this.setBuffer(T),V.label=1;case 1:return this.hasRemaining()?[4,this.doDecodeSync()]:[3,3];case 2:return V.sent(),[3,1];case 3:return[2]}})},x.prototype.decodeAsync=function(T){var V,j,$,W,Ce,oe,We;return Ce=this,We=function(){var Pt,ae,Se,Ee,jt,lt,vi,dc;return aa(this,function(pt){switch(pt.label){case 0:Pt=!1,pt.label=1;case 1:pt.trys.push([1,6,7,12]),V=ac(T),pt.label=2;case 2:return[4,V.next()];case 3:if((j=pt.sent()).done)return[3,5];if(Se=j.value,Pt)throw this.createExtraByteError(this.totalPos);this.appendBuffer(Se);try{ae=this.doDecodeSync(),Pt=!0}catch(vd){if(!(vd instanceof Ar))throw vd}this.totalPos+=this.pos,pt.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return Ee=pt.sent(),$={error:Ee},[3,12];case 7:return pt.trys.push([7,,10,11]),j&&!j.done&&(W=V.return)?[4,W.call(V)]:[3,9];case 8:pt.sent(),pt.label=9;case 9:return[3,11];case 10:if($)throw $.error;return[7];case 11:return[7];case 12:if(Pt){if(this.hasRemaining())throw this.createExtraByteError(this.totalPos);return[2,ae]}throw lt=(jt=this).headByte,vi=jt.pos,dc=jt.totalPos,new RangeError("Insufficient data in parsing "+S(lt)+" at "+dc+" ("+vi+" in the current buffer)")}})},new(oe=void 0,oe=Promise)(function(Pt,ae){function Se(lt){try{jt(We.next(lt))}catch(vi){ae(vi)}}function Ee(lt){try{jt(We.throw(lt))}catch(vi){ae(vi)}}function jt(lt){var vi;lt.done?Pt(lt.value):(vi=lt.value,vi instanceof oe?vi:new oe(function(dc){dc(vi)})).then(Se,Ee)}jt((We=We.apply(Ce,[])).next())})},x.prototype.decodeArrayStream=function(T){return this.decodeMultiAsync(T,!0)},x.prototype.decodeStream=function(T){return this.decodeMultiAsync(T,!1)},x.prototype.decodeMultiAsync=function(T,V){return qt(this,arguments,function(){var j,$,W,Ce,oe,We,Pt,ae,Se;return aa(this,function(Ee){switch(Ee.label){case 0:j=V,$=-1,Ee.label=1;case 1:Ee.trys.push([1,13,14,19]),W=ac(T),Ee.label=2;case 2:return[4,ot(W.next())];case 3:if((Ce=Ee.sent()).done)return[3,12];if(oe=Ce.value,V&&$===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(oe),j&&($=this.readArraySize(),j=!1,this.complete()),Ee.label=4;case 4:Ee.trys.push([4,9,,10]),Ee.label=5;case 5:return[4,ot(this.doDecodeSync())];case 6:return[4,Ee.sent()];case 7:return Ee.sent(),--$==0?[3,8]:[3,5];case 8:return[3,10];case 9:if(!((We=Ee.sent())instanceof Ar))throw We;return[3,10];case 10:this.totalPos+=this.pos,Ee.label=11;case 11:return[3,2];case 12:return[3,19];case 13:return Pt=Ee.sent(),ae={error:Pt},[3,19];case 14:return Ee.trys.push([14,,17,18]),Ce&&!Ce.done&&(Se=W.return)?[4,ot(Se.call(W))]:[3,16];case 15:Ee.sent(),Ee.label=16;case 16:return[3,18];case 17:if(ae)throw ae.error;return[7];case 18:return[7];case 19:return[2]}})})},x.prototype.doDecodeSync=function(){e:for(;;){var T=this.readHeadByte();if(224<=T)T-=256;else if(192>T){if(!(128>T))if(144>T){if((T-=128)!=0){this.pushMapState(T),this.complete();continue e}T={}}else if(160>T){if((T-=144)!=0){this.pushArrayState(T),this.complete();continue e}T=[]}else T-=160,T=this.decodeUtf8String(T,0)}else if(T===192)T=null;else if(T===194)T=!1;else if(T===195)T=!0;else if(T===202)T=this.readF32();else if(T===203)T=this.readF64();else if(T===204)T=this.readU8();else if(T===205)T=this.readU16();else if(T===206)T=this.readU32();else if(T===207)T=this.readU64();else if(T===208)T=this.readI8();else if(T===209)T=this.readI16();else if(T===210)T=this.readI32();else if(T===211)T=this.readI64();else if(T===217)T=this.lookU8(),T=this.decodeUtf8String(T,1);else if(T===218)T=this.lookU16(),T=this.decodeUtf8String(T,2);else if(T===219)T=this.lookU32(),T=this.decodeUtf8String(T,4);else if(T===220){if((T=this.readU16())!==0){this.pushArrayState(T),this.complete();continue e}T=[]}else if(T===221){if((T=this.readU32())!==0){this.pushArrayState(T),this.complete();continue e}T=[]}else if(T===222){if((T=this.readU16())!==0){this.pushMapState(T),this.complete();continue e}T={}}else if(T===223){if((T=this.readU32())!==0){this.pushMapState(T),this.complete();continue e}T={}}else if(T===196)T=this.lookU8(),T=this.decodeBinary(T,1);else if(T===197)T=this.lookU16(),T=this.decodeBinary(T,2);else if(T===198)T=this.lookU32(),T=this.decodeBinary(T,4);else if(T===212)T=this.decodeExtension(1,0);else if(T===213)T=this.decodeExtension(2,0);else if(T===214)T=this.decodeExtension(4,0);else if(T===215)T=this.decodeExtension(8,0);else if(T===216)T=this.decodeExtension(16,0);else if(T===199)T=this.lookU8(),T=this.decodeExtension(T,1);else if(T===200)T=this.lookU16(),T=this.decodeExtension(T,2);else{if(T!==201)throw new Ro("Unrecognized type byte: "+S(T));T=this.lookU32(),T=this.decodeExtension(T,4)}this.complete();for(var V=this.stack;0<V.length;){var j=V[V.length-1];if(j.type===0){if(j.array[j.position]=T,j.position++,j.position!==j.size)continue e;V.pop(),T=j.array}else{if(j.type===1){if(($=typeof T)!="string"&&$!=="number")throw new Ro("The type of key must be string or number but "+typeof T);if(T==="__proto__")throw new Ro("The key __proto__ is not allowed");j.key=T,j.type=2;continue e}if(j.map[j.key]=T,j.readCount++,j.readCount!==j.size){j.key=null,j.type=1;continue e}V.pop(),T=j.map}}return T}var $},x.prototype.readHeadByte=function(){return this.headByte===-1&&(this.headByte=this.readU8()),this.headByte},x.prototype.complete=function(){this.headByte=-1},x.prototype.readArraySize=function(){var T=this.readHeadByte();switch(T){case 220:return this.readU16();case 221:return this.readU32();default:if(160>T)return T-144;throw new Ro("Unrecognized array type byte: "+S(T))}},x.prototype.pushMapState=function(T){if(T>this.maxMapLength)throw new Ro("Max length exceeded: map length ("+T+") > maxMapLengthLength ("+this.maxMapLength+")");this.stack.push({type:1,size:T,key:null,readCount:0,map:{}})},x.prototype.pushArrayState=function(T){if(T>this.maxArrayLength)throw new Ro("Max length exceeded: array length ("+T+") > maxArrayLength ("+this.maxArrayLength+")");this.stack.push({type:0,size:T,array:Array(T),position:0})},x.prototype.decodeUtf8String=function(T,V){var j;if(T>this.maxStrLength)throw new Ro("Max length exceeded: UTF-8 byte length ("+T+") > maxStrLength ("+this.maxStrLength+")");if(this.bytes.byteLength<this.pos+V+T)throw so;var $,W=this.pos+V;return this.stateIsMapKey()&&((j=this.keyDecoder)===null||j===void 0?0:j.canBeCached(T))?j=this.keyDecoder.decode(this.bytes,W,T):T>ln?(j=this.bytes.subarray(W,W+T),j=xt.decode(j)):j=c(this.bytes,W,T),$=j,this.pos+=V+T,$},x.prototype.stateIsMapKey=function(){return 0<this.stack.length&&this.stack[this.stack.length-1].type===1},x.prototype.decodeBinary=function(T,V){if(T>this.maxBinLength)throw new Ro("Max length exceeded: bin length ("+T+") > maxBinLength ("+this.maxBinLength+")");if(!this.hasRemaining(T+V))throw so;var j=this.pos+V;return j=this.bytes.subarray(j,j+T),this.pos+=V+T,j},x.prototype.decodeExtension=function(T,V){if(T>this.maxExtLength)throw new Ro("Max length exceeded: ext length ("+T+") > maxExtLength ("+this.maxExtLength+")");var j=this.view.getInt8(this.pos+V);return T=this.decodeBinary(T,V+1),this.extensionCodec.decode(T,j,this.context)},x.prototype.lookU8=function(){return this.view.getUint8(this.pos)},x.prototype.lookU16=function(){return this.view.getUint16(this.pos)},x.prototype.lookU32=function(){return this.view.getUint32(this.pos)},x.prototype.readU8=function(){var T=this.view.getUint8(this.pos);return this.pos++,T},x.prototype.readI8=function(){var T=this.view.getInt8(this.pos);return this.pos++,T},x.prototype.readU16=function(){var T=this.view.getUint16(this.pos);return this.pos+=2,T},x.prototype.readI16=function(){var T=this.view.getInt16(this.pos);return this.pos+=2,T},x.prototype.readU32=function(){var T=this.view.getUint32(this.pos);return this.pos+=4,T},x.prototype.readI32=function(){var T=this.view.getInt32(this.pos);return this.pos+=4,T},x.prototype.readU64=function(){var T,V,j=(T=this.view,V=this.pos,4294967296*T.getUint32(V)+T.getUint32(V+4));return this.pos+=8,j},x.prototype.readI64=function(){var T=u(this.view,this.pos);return this.pos+=8,T},x.prototype.readF32=function(){var T=this.view.getFloat32(this.pos);return this.pos+=4,T},x.prototype.readF64=function(){var T=this.view.getFloat64(this.pos);return this.pos+=8,T},x}(),lc={},fN=function(x,T){function V(We){return function(Pt){return function(ae){if(j)throw new TypeError("Generator is already executing.");for(;oe;)try{if(j=1,$&&(W=2&ae[0]?$.return:ae[0]?$.throw||((W=$.return)&&W.call($),0):$.next)&&!(W=W.call($,ae[1])).done)return W;switch($=0,W&&(ae=[2&ae[0],W.value]),ae[0]){case 0:case 1:W=ae;break;case 4:return oe.label++,{value:ae[1],done:!1};case 5:oe.label++,$=ae[1],ae=[0];continue;case 7:ae=oe.ops.pop(),oe.trys.pop();continue;default:if(!((W=0<(W=oe.trys).length&&W[W.length-1])||ae[0]!==6&&ae[0]!==2)){oe=0;continue}if(ae[0]===3&&(!W||ae[1]>W[0]&&ae[1]<W[3]))oe.label=ae[1];else if(ae[0]===6&&oe.label<W[1])oe.label=W[1],W=ae;else if(W&&oe.label<W[2])oe.label=W[2],oe.ops.push(ae);else{W[2]&&oe.ops.pop(),oe.trys.pop();continue}}ae=T.call(x,oe)}catch(Se){ae=[6,Se],$=0}finally{j=W=0}if(5&ae[0])throw ae[1];return{value:ae[0]?ae[1]:void 0,done:!0}}([We,Pt])}}var j,$,W,Ce,oe={label:0,sent:function(){if(1&W[0])throw W[1];return W[1]},trys:[],ops:[]};return Ce={next:V(0),throw:V(1),return:V(2)},typeof Symbol=="function"&&(Ce[Symbol.iterator]=function(){return this}),Ce},uc=function(x){return this instanceof uc?(this.v=x,this):new uc(x)},gN=function(x,T,V){function j(Se){Pt[Se]&&(We[Se]=function(Ee){return new Promise(function(jt,lt){1<ae.push([Se,Ee,jt,lt])||$(Se,Ee)})})}function $(Se,Ee){try{(jt=Pt[Se](Ee)).value instanceof uc?Promise.resolve(jt.value.v).then(W,Ce):oe(ae[0][2],jt)}catch(lt){oe(ae[0][3],lt)}var jt}function W(Se){$("next",Se)}function Ce(Se){$("throw",Se)}function oe(Se,Ee){Se(Ee),ae.shift(),ae.length&&$(ae[0][0],ae[0][1])}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var We,Pt=V.apply(x,T||[]),ae=[];return We={},j("next"),j("throw"),j("return"),We[Symbol.asyncIterator]=function(){return this},We};return ke}()}),GR=Math.min;Ge({target:"Array",proto:!0},{copyWithin:[].copyWithin||function(i,n){var s=Li(this),c=hi(s.length),u=Js(i,c),h=Js(n,c),p=2<arguments.length?arguments[2]:void 0;for(c=GR((p===void 0?c:Js(p,c))-h,c-u),p=1,h<u&&u<h+c&&(p=-1,h+=c-1,u+=c-1);0<c--;)h in s?s[u]=s[h]:delete s[u],u+=p,h+=p;return s}});var jR=ur("Array").copyWithin,y1=Array.prototype;Ge({target:"Array",proto:!0,forced:Xs("every")},{every:function(i){return MT(this,i,1<arguments.length?arguments[1]:void 0)}});var HR=ur("Array").every,_1=Array.prototype,KR=function(i){var n=i.every;return i===_1||i instanceof Array&&n===_1.every?HR:n},od=Bu.getWeakData,WR=yr.set,YR=yr.getterFor,qR=0,sd=function(i){return i.frozen||(i.frozen=new S1)},S1=function(){this.entries=[]},zp=function(i,n){return ev(i.entries,function(s){return s[0]===n})};S1.prototype={get:function(i){if(i=zp(this,i))return i[1]},has:function(i){return!!zp(this,i)},set:function(i,n){var s=zp(this,i);s?s[1]=n:this.entries.push([i,n])},delete:function(i){var n=tv(this.entries,function(s){return s[0]===i});return~n&&this.entries.splice(n,1),!!~n}};var T1={getConstructor:function(i,n,s,c){var u=i(function(f,m){Ga(f,u,n),WR(f,{type:n,id:qR++,frozen:void 0}),m!=null&&Va(m,f[c],f,s)}),h=YR(n),p=function(f,m,I){var E=h(f),_=od(on(m),!0);return _===!0?sd(E).set(m,I):_[E.id]=I,f};return zs(u.prototype,{delete:function(f){var m=h(this);if(!Kt(f))return!1;var I=od(f);return I===!0?sd(m).delete(f):I&&tt(I,m.id)&&delete I[m.id]},has:function(f){var m=h(this);if(!Kt(f))return!1;var I=od(f);return I===!0?sd(m).has(f):I&&tt(I,m.id)}}),zs(u.prototype,s?{get:function(f){var m=h(this);if(Kt(f)){var I=od(f);return I===!0?sd(m).get(f):I?I[m.id]:void 0}},set:function(f,m){return p(this,f,m)}}:{add:function(f){return p(this,f,!0)}}),u}},JR=(r(function(i){var n=yr.enforce,s=!je.ActiveXObject&&"ActiveXObject"in je,c=Object.isExtensible,u=function(E){return function(){return E(this,arguments.length?arguments[0]:void 0)}};if(i=i.exports=ov("WeakMap",u,T1),nv&&s){var h=T1.getConstructor(u,"WeakMap",!0);Bu.REQUIRED=!0,s=i.prototype;var p=s.delete,f=s.has,m=s.get,I=s.set;zs(s,{delete:function(E){if(Kt(E)&&!c(E)){var _=n(this);return _.frozen||(_.frozen=new h),p.call(this,E)||_.frozen.delete(E)}return p.call(this,E)},has:function(E){if(Kt(E)&&!c(E)){var _=n(this);return _.frozen||(_.frozen=new h),f.call(this,E)||_.frozen.has(E)}return f.call(this,E)},get:function(E){if(Kt(E)&&!c(E)){var _=n(this);return _.frozen||(_.frozen=new h),f.call(this,E)?m.call(this,E):_.frozen.get(E)}return m.call(this,E)},set:function(E,_){if(Kt(E)&&!c(E)){var S=n(this);S.frozen||(S.frozen=new h),f.call(this,E)?I.call(this,E,_):S.frozen.set(E,_)}else I.call(this,E,_);return this}})}}),Math.min),Xp=[].lastIndexOf,R1=!!Xp&&0>1/[1].lastIndexOf(1,-0),zR=Xs("lastIndexOf"),w1=R1||zR?function(i){if(R1)return Xp.apply(this,arguments)||0;var n=di(this),s=hi(n.length),c=s-1;for(1<arguments.length&&(c=JR(c,Jc(arguments[1]))),0>c&&(c=s+c);0<=c;c--)if(c in n&&n[c]===i)return c||0;return-1}:Xp;Ge({target:"Array",proto:!0,forced:w1!==[].lastIndexOf},{lastIndexOf:w1});var XR=ur("Array").lastIndexOf,N1=Array.prototype,$R=function(i){var n=i.lastIndexOf;return i===N1||i instanceof Array&&n===N1.lastIndexOf?XR:n};let ZR=()=>function(i){var n;return i=Ie(n=window.atob(i).split("")).call(n,s=>s.charCodeAt(0)),new Uint8Array(i,0,i.length/Uint8Array.BYTES_PER_ELEMENT)}("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AAA2AkAgACgCKCABKAJMQQIgACgCIBEAACECIAFBADYCwC0gASACNgJEIAFBgAg2ApwtIAEgACgCKEGACEEEIAAoAiARAAAiAjYCCCABIAEoApwtIgNBAnQ2AgwCQAJAIAEoAjhFDQAgASgCQEUNACACRQ0AIAEoAkQNAQsgAUGaBTYCBCAAQbjfACgCADYCGCAAEAgPCyABQQA2AogBIAFBCTYChAEgAUEIOgAkIAEgAiADQQNsajYCmC0gASACIANBfnFqNgKkLSAAEAkNACAAKAIcIgAgACgCLEEBdDYCPCAAKAJEIgEgACgCTEEBdEECayIDakEAOwEAIAEgAxAgIABBADYCtC0gAEKAgICAIDcCdCAAQgA3AmggAEKAgICAIDcCXCAAQQA2AkggACAAKAKEAUEMbCIBQYTIAGovAQA2ApABIAAgAUGAyABqLwEANgKMASAAIAFBgsgAai8BADYCgAEgACABQYbIAGovAQA2AnwLC6kCAQN/AkAgAEUNACAAKAIgRQ0AIAAoAiQiA0UNACAAKAIcIgFFDQAgASgCACAARw0AAkACQCABKAIEIgJBOWsOOQECAgICAgICAgICAgECAgIBAgICAgICAgICAgICAgICAgIBAgICAgICAgICAgIBAgICAgICAgICAQALIAJBmgVGDQAgAkEqRw0BCwJ/An8CfyABKAIIIgIEQCAAKAIoIAIgAxECACAAKAIcIQELIAEoAkQiAgsEQCAAKAIoIAIgACgCJBECACAAKAIcIQELIAEoAkAiAgsEQCAAKAIoIAIgACgCJBECACAAKAIcIQELIAEoAjgiAgsEQCAAKAIoIAIgACgCJBECACAAKAIcIQELIAAoAiggASAAKAIkEQIAIABBADYCHAsLlgIBA39BfiECAkAgAEUNACAAKAIgRQ0AIAAoAiRFDQAgACgCHCIBRQ0AIAEoAgAgAEcNAAJAAkAgASgCBCIDQTlrDjkBAgICAgICAgICAgIBAgICAQICAgICAgICAgICAgICAgICAQICAgICAgICAgICAQICAgICAgICAgEACyADQZoFRg0AIANBKkcNAQsgAEECNgIsIABBADYCCCAAQgA3AhQgAUEANgIUIAEgASgCCDYCECABKAIYIgJBf0wEQCABQQAgAmsiAjYCGAsgAUE5QSpB8QAgAhsgAkECRhs2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KAIIaiACQR9wIAJyQR9zOgAAIAEoAmwEQCAAKAIwIQIgASABKAIUIgNBAWo2AhQgAyABKAIIaiACQRh2OgAAIAEgASgCFCIDQQFqNgIUIAMgASgCCGogAkEQdjoAACAAKAIwIQIgASABKAIUIgNBAWo2AhQgAyABKAIIaiACQQh2OgAAIAEgASgCFCIDQQFqNgIUIAMgASgCCGogAjoAAAsgAEEAQQBBABAENgIwIAFB8QA2AgQgACgCHCICEBMCQCAAKAIQIgMgAigCFCIEIAMgBEkbIgNFDQAgACgCDCACKAIQIAMQHxogACAAKAIMIANqNgIMIAIgAigCECADajYCECAAIAAoAhQgA2o2AhQgACAAKAIQIANrNgIQIAIgAigCFCADayIDNgIUIAMNACACIAIoAgg2AhALIAEoAhQNBCABKAIEIQMLAkACQAJAAkACQAJAAkAgA0E5RgR/IABBAEEAQQAQBjYCMCABIAEoAhQiAkEBajYCFCACIAEoAghqQR86AAAgASABKAIUIgJBAWo2AhQgAiABKAIIakGLAToAACABIAEoAhQiAkEBajYCFCACIAEoAghqQQg6AAAgASgCHCICDQIgASABKAIUIgJBAWo2AhQgAiABKAIIakEAOgAAIAEgASgCFCICQQFqNgIUIAIgASgCCGpBADoAACABIAEoAhQiAkEBajYCFCACIAEoAghqQQA6AAAgASABKAIUIgJBAWo2AhQgAiABKAIIakEAOgAAIAEgASgCFCICQQFqNgIUIAIgASgCCGpBADoAAEECIQIgASgChAEiA0EJRwRAQQQgASgCiAFBAUpBAnQgA0ECSBshAgsgASABKAIUIgNBAWo2AhQgAyABKAIIaiACOgAAIAEgASgCFCICQQFqNgIUIAIgASgCCGpBAzoAACABQfEANgIEIAAoAhwiAhATAkAgACgCECIDIAIoAhQiBCADIARJGyIDRQ0AIAAoAgwgAigCECADEB8aIAAgACgCDCADajYCDCACIAIoAhAgA2o2AhAgACAAKAIUIANqNgIUIAAgACgCECADazYCECACIAIoAhQgA2siAzYCFCADDQAgAiACKAIINgIQCyABKAIUDQEgASgCBAUgAwtBxQBrDiMCBgYGAwYGBgYGBgYGBgYGBgYGBgYGBAYGBgYGBgYGBgYGBQYLIAFBfzYCKA8LIAIoAiQhAyACKAIcIQQgAigCECEFIAIoAiwhBiACKAIAIQggASABKAIUIgdBAWo2AhRBAiECIAcgASgCCGogBkEAR0EBdCAIQQBHciAFQQBHQQJ0ciAEQQBHQQN0ciADQQBHQQR0cjoAACABKAIcKAIEIQMgASABKAIUIgRBAWo2AhQgBCABKAIIaiADOgAAIAEoAhwoAgQhAyABIAEoAhQiBEEBajYCFCAEIAEoAghqIANBCHY6AAAgASgCHC8BBiEDIAEgASgCFCIEQQFqNgIUIAQgASgCCGogAzoAACABKAIcLQAHIQMgASABKAIUIgRBAWo2AhQgBCABKAIIaiADOgAAIAEoAoQBIgNBCUcEQEEEIAEoAogBQQFKQQJ0IANBAkgbIQILIAEgASgCFCIDQQFqNgIUIAMgASgCCGogAjoAACABKAIcKAIMIQIgASABKAIUIgNBAWo2AhQgAyABKAIIaiACOgAAIAEoAhwiAigCEAR/IAIoAhQhAiABIAEoAhQiA0EBajYCFCADIAEoAghqIAI6AAAgASgCHCgCFCECIAEgASgCFCIDQQFqNgIUIAMgASgCCGogAkEIdjoAACABKAIcBSACCygCLARAIAAgACgCMCABKAIIIAEoAhQQBjYCMAsgAUHFADYCBCABQQA2AiALIAEoAhwiBCgCECIDBEAgASgCFCICIAQvARQgASgCICIGayIFaiABKAIMIgRLBEADQCABKAIIIAJqIAMgBmogBCACayIEEB8aIAEgASgCDCIDNgIUAkAgAiADTw0AIAEoAhwoAixFDQAgACAAKAIwIAEoAgggAmogAyACaxAGNgIwCyABIAEoAiAgBGo2AiAgACgCHCICEBMCQCAAKAIQIgMgAigCFCIGIAMgBkkbIgNFDQAgACgCDCACKAIQIAMQHxogACAAKAIMIANqNgIMIAIgAigCECADajYCECAAIAAoAhQgA2o2AhQgACAAKAIQIANrNgIQIAIgAigCFCADayIDNgIUIAMNACACIAIoAgg2AhALIAEoAhQEQCABQX82AigPCyABKAIgIQYgASgCHCgCECEDQQAhAiAFIARrIgUgASgCDCIESw0ACwsgASgCCCACaiADIAZqIAUQHxogASABKAIUIAVqIgM2AhQCQCACIANPDQAgASgCHCgCLEUNACAAIAAoAjAgASgCCCACaiADIAJrEAY2AjALIAFBADYCIAsgAUHJADYCBAsgASgCHCgCHARAIAEoAhQiAiEFA0ACQCACIAEoAgxHDQACQCACIAVNDQAgASgCHCgCLEUNACAAIAAoAjAgASgCCCAFaiACIAVrEAY2AjALIAAoAhwiAhATAkAgACgCECIDIAIoAhQiBCADIARJGyIDRQ0AIAAoAgwgAigCECADEB8aIAAgACgCDCADajYCDCACIAIoAhAgA2o2AhAgACAAKAIUIANqNgIUIAAgACgCECADazYCECACIAIoAhQgA2siAzYCFCADDQAgAiACKAIINgIQC0EAIQJBACEFIAEoAhRFDQAgAUF/NgIoDwsgASgCHCgCHCEDIAEgASgCICIEQQFqNgIgIAMgBGotAAAhAyABIAJBAWo2AhQgASgCCCACaiADOgAAIAMEQCABKAIUIQIMAQsLAkAgASgCHCgCLEUNACABKAIUIgIgBU0NACAAIAAoAjAgASgCCCAFaiACIAVrEAY2AjALIAFBADYCIAsgAUHbADYCBAsCQCABKAIcKAIkRQ0AIAEoAhQiAiEFA0ACQCACIAEoAgxHDQACQCACIAVNDQAgASgCHCgCLEUNACAAIAAoAjAgASgCCCAFaiACIAVrEAY2AjALIAAoAhwiAhATAkAgACgCECIDIAIoAhQiBCADIARJGyIDRQ0AIAAoAgwgAigCECADEB8aIAAgACgCDCADajYCDCACIAIoAhAgA2o2AhAgACAAKAIUIANqNgIUIAAgACgCECADazYCECACIAIoAhQgA2siAzYCFCADDQAgAiACKAIINgIQC0EAIQJBACEFIAEoAhRFDQAgAUF/NgIoDwsgASgCHCgCJCEDIAEgASgCICIEQQFqNgIgIAMgBGotAAAhAyABIAJBAWo2AhQgASgCCCACaiADOgAAIAMEQCABKAIUIQIMAQsLIAEoAhwoAixFDQAgASgCFCICIAVNDQAgACAAKAIwIAEoAgggBWogAiAFaxAGNgIwCyABQecANgIECyABKAIcKAIsBEAgASgCDCABKAIUIgJBAmpJBEAgACgCHCICEBMCQCAAKAIQIgMgAigCFCIEIAMgBEkbIgNFDQAgACgCDCACKAIQIAMQHxogACAAKAIMIANqNgIMIAIgAigCECADajYCECAAIAAoAhQgA2o2AhQgACAAKAIQIANrNgIQIAIgAigCFCADayIDNgIUIAMNACACIAIoAgg2AhALIAEoAhQNBUEAIQILIAAoAjAhAyABIAJBAWo2AhQgASgCCCACaiADOgAAIAAoAjAhAiABIAEoAhQiA0EBajYCFCADIAEoAghqIAJBCHY6AAAgAEEAQQBBABAGNgIwCyABQfEANgIEIAAoAhwiAhATAkAgACgCECIDIAIoAhQiBCADIARJGyIDRQ0AIAAoAgwgAigCECADEB8aIAAgACgCDCADajYCDCACIAIoAhAgA2o2AhAgACAAKAIUIANqNgIUIAAgACgCECADazYCECACIAIoAhQgA2siAzYCFCADDQAgAiACKAIINgIQCyABKAIURQ0AIAFBfzYCKA8LIAAoAgQNAQsgASgCdA0AIAEoAgRBmgVGDQgLIAEoAoQBIgJFBEAgAUEDEAwMBAsCQAJAIAEoAogBQQJrDgIAAQQLA0ACQAJAIAEoAnQNACABEAogASgCdA0AIAFBADYCtC0MAQsgAUEANgJgIAEoAjggASgCbGotAAAhAiABKAKkLSABKAKgLSIDQQF0akEAOwEAIAEgA0EBajYCoC0gAyABKAKYLWogAjoAACABIAJBAnRqQZQBaiICIAIvAQBBAWo7AQAgASABKAJ0QQFrNgJ0IAEgASgCbEEBaiICNgJsIAEoAqAtIAEoApwtQQFrRw0BIAEgASgCXCIEQQBOBH8gASgCOCAEagVBAAsgAiAEa0EAEBQgASABKAJsNgJcIAEoAgAiAigCHCIDEBMCQCACKAIQIgQgAygCFCIFIAQgBUkbIgRFDQAgAigCDCADKAIQIAQQHxogAiACKAIMIARqNgIMIAMgAygCECAEajYCECACIAIoAhQgBGo2AhQgAiACKAIQIARrNgIQIAMgAygCFCAEayICNgIUIAINACADIAMoAgg2AhALIAEoAgAoAhANAQwHCwsgASgCoC1FDQcgASABKAJcIgNBAE4EfyABKAI4IANqBUEACyABKAJsIANrQQAQFCABIAEoAmw2AlwgASgCACICKAIcIgMQEwJAIAIoAhAiBCADKAIUIgUgBCAFSRsiBEUNACACKAIMIAMoAhAgBBAfGiACIAIoAgwgBGo2AgwgAyADKAIQIARqNgIQIAIgAigCFCAEajYCFCACIAIoAhAgBGs2AhAgAyADKAIUIARrIgI2AhQgAg0AIAMgAygCCDYCEAsgASgCACgCEEUNBQwHCwNAAkACQAJAIAEoAnQiAkGDAk8EQCABQQA2AmAMAQsgARAKIAEoAnQiAgRAIAFBADYCYCACQQJLDQEgASgCbCEDDAILIAFBADYCtC0gASgCoC1FDQogASABKAJcIgNBAE4EfyABKAI4IANqBUEACyABKAJsIANrQQAQFCABIAEoAmw2AlwgASgCACICKAIcIgMQEwJAIAIoAhAiBCADKAIUIgUgBCAFSRsiBEUNACACKAIMIAMoAhAgBBAfGiACIAIoAgwgBGo2AgwgAyADKAIQIARqNgIQIAIgAigCFCAEajYCFCACIAIoAhAgBGs2AhAgAyADKAIUIARrIgI2AhQgAg0AIAMgAygCCDYCEAsgASgCACgCEEUNCAwKCyABKAJsIgNFBEBBACEDDAELIAEoAjggA2oiBkEBayIFLQAAIgQgBi0AAEcNACAEIAUtAAJHDQAgBCAFLQADRw0AIAZBggJqIQlBfyEIAkACQAJAAkACQAJAA0AgBiAIaiIFLQAEIARGBEAgBCAFLQAFRw0CIAQgBS0ABkcNAyAEIAUtAAdHDQQgBCAGIAhBCGoiCmoiBy0AAEcNByAEIAUtAAlHDQUgBCAFLQAKRw0GIAVBC2ohByAIQfYBSg0HIAohCCAEIActAABGDQEMBwsLIAVBBGohBwwFCyAFQQVqIQcMBAsgBUEGaiEHDAMLIAVBB2ohBwwCCyAFQQlqIQcMAQsgBUEKaiEHCyABIAIgByAJa0GCAmoiBCACIARJGyICNgJgIAJBA0kNACABKAKkLSABKAKgLSIDQQF0akEBOwEAIAEgA0EBajYCoC0gAyABKAKYLWogAkEDayICOgAAIAJB/wFxQYDNAGotAABBAnQgAWpBmAlqIgIgAi8BAEEBajsBACABQYDJAC0AAEECdGpBiBNqIgIgAi8BAEEBajsBACABKAJgIQIgAUEANgJgIAEgASgCdCACazYCdCABIAIgASgCbGoiAjYCbCABKAKgLSABKAKcLUEBa0cNAgwBCyABKAI4IANqLQAAIQIgASgCpC0gASgCoC0iA0EBdGpBADsBACABIANBAWo2AqAtIAMgASgCmC1qIAI6AAAgASACQQJ0akGUAWoiAiACLwEAQQFqOwEAIAEgASgCdEEBazYCdCABIAEoAmxBAWoiAjYCbCABKAKgLSABKAKcLUEBa0cNAQsgASABKAJcIgRBAE4EfyABKAI4IARqBUEACyACIARrQQAQFCABIAEoAmw2AlwgASgCACICKAIcIgMQEwJAIAIoAhAiBCADKAIUIgUgBCAFSRsiBEUNACACKAIMIAMoAhAgBBAfGiACIAIoAgwgBGo2AgwgAyADKAIQIARqNgIQIAIgAigCFCAEajYCFCACIAIoAhAgBGs2AhAgAyADKAIUIARrIgI2AhQgAg0AIAMgAygCCDYCEAsgASgCACgCEA0ACwwECyABQX82AigPCyABQX82AigPCyABQQMgAkEMbEGIyABqKAIAEQQACyICQX5xQQJGBEAgAUGaBTYCBAsgAkF9cQ0BCyAAKAIQDQMgAUF/NgIoDwsgAkEBRw0BCyABQQBBAEEAEBIgASgCRCICIAEoAkxBAXRBAmsiA2pBADsBACACIAMQICABKAJ0RQRAIAFBADYCtC0gAUEANgJcIAFBADYCbAsgACgCHCICEBMCQCAAKAIQIgQgAigCFCIDIAMgBEsbIgNFDQAgACgCDCACKAIQIAMQHxogACAAKAIMIANqNgIMIAIgAigCECADajYCECAAIAAoAhQgA2o2AhQgACAAKAIQIANrIgQ2AhAgAiACKAIUIANrIgM2AhQgAw0AIAIgAigCCDYCEAsgBA0AIAFBfzYCKAsLC7YNAQt/IAAoAgAiBCgCBCEJQQEhCAJAIAQoAhAiAyAAKAK8LUEqakEDdSICSQ0AIAAoAiwiBSAAKAIMQQVrIgYgBSAGSRshCiABQQRHIQsDQCAKIAMgAmsiAyAAKAJsIAAoAlxrIgYgBCgCBGoiAkH//wMgAkH//wNJGyIFIAMgBUkbIgNLBEAgAiADRw0CIAFFDQIgCyADRXENAgsgAEEAQQAgAUEERiACIANGcSIHEBIgACgCFCAAKAIIakEEayADOgAAIAAoAhQgACgCCGpBA2sgA0EIdjoAACAAKAIUIAAoAghqQQJrIANBf3MiAjoAACAAKAIUIAAoAghqQQFrIAJBCHY6AAAgACgCACICKAIcIgQQEwJAIAIoAhAiBSAEKAIUIgwgBSAMSRsiBUUNACACKAIMIAQoAhAgBRAfGiACIAIoAgwgBWo2AgwgBCAEKAIQIAVqNgIQIAIgAigCFCAFajYCFCACIAIoAhAgBWs2AhAgBCAEKAIUIAVrIgI2AhQgAg0AIAQgBCgCCDYCEAsCfyAGBEAgACgCACgCDCAAKAI4IAAoAlxqIAMgBiADIAZJGyICEB8aIAAoAgAiBCAEKAIMIAJqNgIMIAQgBCgCECACazYCECAEIAQoAhQgAmo2AhQgACAAKAJcIAJqNgJcIAMgAmshAwsgAwsEQCAAKAIAIgIoAgwhBSADIAIoAgQiBiADIAZJGyIEBEAgAiAGIARrNgIEIAUgAigCACAEEB8hBQJAAkACQCACKAIcKAIYQQFrDgIAAQILIAIgAigCMCAFIAQQBDYCMAwBCyACIAIoAjAgBSAEEAY2AjALIAIgAigCACAEajYCACACIAIoAgggBGo2AgggACgCACICKAIMIQULIAIgAyAFajYCDCACIAIoAhAgA2s2AhAgAiACKAIUIANqNgIUCyAAKAIAIQQgBwRAQQAhCAwCCyAEKAIQIgMgACgCvC1BKmpBA3UiAk8NAAsLAkAgCSAEKAIEayIDRQRAIAAoAmwhAgwBCwJAIAAoAiwiAiADTQRAIABBAjYCsC0gACgCOCAEKAIAIAJrIAIQHxogACAAKAIsIgQ2AmwgBCECDAELAkAgACgCPCAAKAJsIgRrIANLDQAgACAEIAJrIgQ2AmwgACgCOCIFIAIgBWogBBAfGiAAKAKwLSICQQFLDQAgACACQQFqNgKwLQsgACgCOCAAKAJsaiAAKAIAKAIAIANrIAMQHxogACAAKAJsIANqIgI2AmwgACgCLCEECyAAIAI2AlwgACAEIAAoArQtIgVrIgQgAyADIARLGyAFajYCtC0LIAIgACgCwC1LBEAgACACNgLALQtBAyEDAkAgCEUNACAAKAIAIgQoAgQhAwJAAkAgAUF7cUUNACADDQBBASEDIAIgACgCXEYNAiAAKAI8IAJBf3NqIQVBACEDDAELIAMgACgCPCACQX9zaiIFTQ0AIAAoAlwiByAAKAIsIgZIDQAgACACIAZrIgM2AmwgACAHIAZrNgJcIAAoAjgiAiACIAZqIAMQHxogACgCsC0iA0EBTQRAIAAgA0EBajYCsC0LIAAoAiwgBWohBSAAKAIAIgQoAgQhAwsCQCADIAUgAyAFSRsiAkUEQCAAKAJsIQMMAQsgACgCbCEFIAAoAjghBiAEIAMgAms2AgQgBSAGaiAEKAIAIAIQHyEDAkACQAJAIAQoAhwoAhhBAWsOAgABAgsgBCAEKAIwIAMgAhAENgIwDAELIAQgBCgCMCADIAIQBjYCMAsgBCAEKAIAIAJqNgIAIAQgBCgCCCACajYCCCAAIAAoAmwgAmoiAzYCbAsgAyAAKALALUsEQCAAIAM2AsAtCyADIAAoAlwiBmsiBCAAKAIsIgMgACgCDCAAKAK8LUEqakEDdWsiAkH//wMgAkH//wNJGyICIAIgA0sbSQRAQQAhAyABRQ0BIAFBBEYgBEEAR3JFDQEgAiAESQ0BIAAoAgAoAgQNAQtBACEFIAAgACgCOCAGaiACIAQgAiAESRsiAwJ/IAFBBEYEQCAAKAIAKAIERSACIARPcSEFCyAFCxASIAAgACgCXCADajYCXCAAKAIAIgAoAhwiAxATAkAgACgCECICIAMoAhQiBCACIARJGyICRQ0AIAAoAgwgAygCECACEB8aIAAgACgCDCACajYCDCADIAMoAhAgAmo2AhAgACAAKAIUIAJqNgIUIAAgACgCECACazYCECADIAMoAhQgAmsiADYCFCAADQAgAyADKAIINgIQC0ECQQAgBRshAwsgAwu5CwENfwJAA0ACQAJAIAAoAnRBhQJNBEAgABAKIAAoAnQhAgJAIAENACACQYYCTw0AQQAPCyACRQ0EIAJBA0kNAQsgACAAKAJUIAAoAmwiAiAAKAI4ai0AAiAAKAJIIAAoAlh0c3EiAzYCSCAAKAJAIAIgACgCNHFBAXRqIAAoAkQgA0EBdGoiBC8BACIDOwEAIAQgAjsBACADRQ0AIAAoAixBhgJrIAIgA2tJDQAgACAAIAMQDiICNgJgDAELIAAoAmAhAgsCQCACQQNPBEAgACgCpC0gACgCoC0iA0EBdGogACgCbCAAKAJwayIEOwEAIAAgA0EBajYCoC0gAyAAKAKYLWogAkEDayICOgAAIAJB/wFxQYDNAGotAABBAnQgAGpBmAlqIgIgAi8BAEEBajsBACAAIARBAWtB//8DcSICIAJBB3ZBgAJqIAJBgAJJG0GAyQBqLQAAQQJ0akGIE2oiAiACLwEAQQFqOwEAIAAgACgCdCAAKAJgIgJrIgM2AnQgACgCnC1BAWshBiAAKAKgLSEHAkAgA0EDSQ0AIAIgACgCgAFLDQAgACACQQFrIgM2AmAgACgCSCEEIAAoAmwhAiAAKAI0IQggACgCQCEJIAAoAkQhCiAAKAJUIQsgACgCOCEMIAAoAlghDQNAIAAgAiIFQQFqIgI2AmwgACAFIAxqLQADIAQgDXRzIAtxIgQ2AkggCSACIAhxQQF0aiAKIARBAXRqIg4vAQA7AQAgDiACOwEAIAAgA0EBayIDNgJgIAMNAAsgACAFQQJqIgI2AmwgBiAHRw0DDAILIABBADYCYCAAIAAoAmwgAmoiAjYCbCAAIAAoAjggAmoiAy0AACIENgJIIAAgACgCVCADLQABIAQgACgCWHRzcTYCSCAGIAdHDQIMAQsgACgCOCAAKAJsai0AACECIAAoAqQtIAAoAqAtIgNBAXRqQQA7AQAgACADQQFqNgKgLSADIAAoApgtaiACOgAAIAAgAkECdGpBlAFqIgIgAi8BAEEBajsBACAAIAAoAnRBAWs2AnQgACAAKAJsQQFqIgI2AmwgACgCoC0gACgCnC1BAWtHDQELQQAhAyAAIAAoAlwiBEEATgR/IAAoAjggBGoFIAMLIAIgBGtBABAUIAAgACgCbDYCXCAAKAIAIgIoAhwiAxATAkAgAigCECIEIAMoAhQiBSAEIAVJGyIERQ0AIAIoAgwgAygCECAEEB8aIAIgAigCDCAEajYCDCADIAMoAhAgBGo2AhAgAiACKAIUIARqNgIUIAIgAigCECAEazYCECADIAMoAhQgBGsiAjYCFCACDQAgAyADKAIINgIQCyAAKAIAKAIQDQALQQAPCyAAIAAoAmwiAkECIAJBAkkbNgK0LSABQQRGBEBBACEDIAAgACgCXCIEQQBOBH8gACgCOCAEagUgAwsgAiAEa0EBEBQgACAAKAJsNgJcIAAoAgAiAigCHCIDEBMCQCACKAIQIgQgAygCFCIFIAQgBUkbIgRFDQAgAigCDCADKAIQIAQQHxogAiACKAIMIARqNgIMIAMgAygCECAEajYCECACIAIoAhQgBGo2AhQgAiACKAIQIARrNgIQIAMgAygCFCAEayICNgIUIAINACADIAMoAgg2AhALQQNBAiAAKAIAKAIQGw8LAkAgACgCoC1FDQBBACEDIAAgACgCXCIEQQBOBH8gACgCOCAEagUgAwsgAiAEa0EAEBQgACAAKAJsNgJcIAAoAgAiAigCHCIDEBMCQCACKAIQIgQgAygCFCIFIAQgBUkbIgRFDQAgAigCDCADKAIQIAQQHxogAiACKAIMIARqNgIMIAMgAygCECAEajYCECACIAIoAhQgBGo2AhQgAiACKAIQIARrNgIQIAMgAygCFCAEayICNgIUIAINACADIAMoAgg2AhALIAAoAgAoAhANAEEADwtBAQukBAEQfyAAKAJ8IgMgA0ECdiAAKAJ4IgQgACgCjAFJGyEJQQAgACgCbCIDIAAoAixrQYYCaiICIAIgA0sbIQwgACgCdCIHIAAoApABIgIgAiAHSxshDSAAKAI4Ig4gA2oiBUGCAmohDyAEIAVqIgMtAAAhCiADQQFrLQAAIQsgACgCNCEQIAAoAkAhEQNAAkACQCABIA5qIgMgBGoiAi0AACAKRw0AIAJBAWstAAAgC0cNACADLQAAIAUtAABHDQBBAiEGIAMtAAEgBS0AAUcNAAJAAkACQAJAAkACQAJAA0AgBSAGaiICLQABIAMtAANHDQYgAi0AAiADLQAERw0FIAItAAMgAy0ABUcNBCACLQAEIAMtAAZHDQMgAi0ABSADLQAHRw0CIAItAAYgAy0ACEcNASACLQAHIAMtAAlGBEAgBkH5AUshCCAFIAZBCGoiBmohAiAIDQggAy0ACiEIIANBCGohAyACLQAAIAhGDQEMCAsLIAJBB2ohAgwGCyACQQZqIQIMBQsgAkEFaiECDAQLIAJBBGohAgwDCyACQQNqIQIMAgsgAkECaiECDAELIAJBAWohAgsgAiAPayICQYICaiIDIARMDQAgACABNgJwIAMgDU4EQCADIQQMAgsgAyAFai0AACEKIAIgBWotAIECIQsgAyEECyAJQQFrIglFDQAgDCARIAEgEHFBAXRqLwEAIgFJDQELCyAHIAQgBCAHSxsL3Q4BB38DQAJAAkACQCAAKAJ0QYUCSw0AIAAQCiAAKAJ0IQICQCABDQAgAkGGAk8NAEEADwsgAkUNAiACQQJLDQAgACAAKAJgIgI2AnggACAAKAJwNgJkQQIhAyAAQQI2AmAMAQtBAiEDIAAgACgCVCAAKAJsIgIgACgCOGotAAIgACgCSCAAKAJYdHNxIgQ2AkggACgCQCACIAAoAjRxQQF0aiAAKAJEIARBAXRqIgUvAQAiBDsBACAFIAI7AQAgACAAKAJgIgI2AnggACAAKAJwNgJkIABBAjYCYCAERQ0AAkAgAiAAKAKAAU8NACAAKAIsQYYCayAAKAJsIARrSQ0AIAAgACAEEA4iAzYCYCADQQVLDQAgACgCiAFBAUcEQCADQQNHDQFBAyEDIAAoAmwgACgCcGtBgSBJDQELQQIhAyAAQQI2AmALIAAoAnghAgsCQCACQQNJDQAgAiADSQ0AIAAoAnQhBCAAKAKkLSAAKAKgLSIDQQF0aiAAKAJsIgUgACgCZEF/c2oiBjsBACAAIANBAWo2AqAtIAMgACgCmC1qIAJBA2siAjoAACACQf8BcUGAzQBqLQAAQQJ0IABqQZgJaiICIAIvAQBBAWo7AQAgACAGQQFrQf//A3EiAiACQQd2QYACaiACQYACSRtBgMkAai0AAEECdGpBiBNqIgIgAi8BAEEBajsBACAAIAAoAngiAkECayIDNgJ4IAAgACgCdCACa0EBajYCdCAEIAVqQQNrIQUgACgCnC1BAWshByAAKAJsIQIgACgCoC0hCANAIAAgAiIEQQFqIgI2AmwgAiAFTQRAIAAgACgCVCAEIAAoAjhqLQADIAAoAkggACgCWHRzcSIGNgJIIAAoAkAgACgCNCACcUEBdGogACgCRCAGQQF0aiIGLwEAOwEAIAYgAjsBAAsgACADQQFrIgM2AnggAw0ACyAAQQI2AmAgAEEANgJoIAAgBEECaiICNgJsIAcgCEcNAkEAIQMgACAAKAJcIgRBAE4EfyAAKAI4IARqBSADCyACIARrQQAQFCAAIAAoAmw2AlwgACgCACICKAIcIgMQEwJAIAIoAhAiBCADKAIUIgUgBCAFSRsiBEUNACACKAIMIAMoAhAgBBAfGiACIAIoAgwgBGo2AgwgAyADKAIQIARqNgIQIAIgAigCFCAEajYCFCACIAIoAhAgBGs2AhAgAyADKAIUIARrIgI2AhQgAg0AIAMgAygCCDYCEAsgACgCACgCEA0CQQAPCyAAKAJoBEAgACgCbCAAKAI4akEBay0AACECIAAoAqQtIAAoAqAtIgNBAXRqQQA7AQAgACADQQFqNgKgLSADIAAoApgtaiACOgAAIAAgAkECdGpBlAFqIgIgAi8BAEEBajsBAAJAIAAoAqAtIAAoApwtQQFrRw0AQQAhAyAAIAAoAlwiAkEATgR/IAAoAjggAmoFIAMLIAAoAmwgAmtBABAUIAAgACgCbDYCXCAAKAIAIgIoAhwiAxATIAIoAhAiBCADKAIUIgUgBCAFSRsiBEUNACACKAIMIAMoAhAgBBAfGiACIAIoAgwgBGo2AgwgAyADKAIQIARqNgIQIAIgAigCFCAEajYCFCACIAIoAhAgBGs2AhAgAyADKAIUIARrIgI2AhQgAg0AIAMgAygCCDYCEAsgACAAKAJsQQFqNgJsIAAgACgCdEEBazYCdCAAKAIAKAIQDQJBAA8FIABBATYCaCAAIAAoAmxBAWo2AmwgACAAKAJ0QQFrNgJ0DAILAAsLIAAoAmgEQCAAKAJsIAAoAjhqQQFrLQAAIQIgACgCpC0gACgCoC0iA0EBdGpBADsBACAAIANBAWo2AqAtIAMgACgCmC1qIAI6AAAgACACQQJ0akGUAWoiAiACLwEAQQFqOwEAIABBADYCaAsgACAAKAJsIgJBAiACQQJJGzYCtC0gAUEERgRAQQAhAyAAIAAoAlwiBEEATgR/IAAoAjggBGoFIAMLIAIgBGtBARAUIAAgACgCbDYCXCAAKAIAIgIoAhwiAxATAkAgAigCECIEIAMoAhQiBSAEIAVJGyIERQ0AIAIoAgwgAygCECAEEB8aIAIgAigCDCAEajYCDCADIAMoAhAgBGo2AhAgAiACKAIUIARqNgIUIAIgAigCECAEazYCECADIAMoAhQgBGsiAjYCFCACDQAgAyADKAIINgIQC0EDQQIgACgCACgCEBsPCwJAIAAoAqAtRQ0AQQAhAyAAIAAoAlwiBEEATgR/IAAoAjggBGoFIAMLIAIgBGtBABAUIAAgACgCbDYCXCAAKAIAIgIoAhwiAxATAkAgAigCECIEIAMoAhQiBSAEIAVJGyIERQ0AIAIoAgwgAygCECAEEB8aIAIgAigCDCAEajYCDCADIAMoAhAgBGo2AhAgAiACKAIUIARqNgIUIAIgAigCECAEazYCECADIAMoAhQgBGsiAjYCFCACDQAgAyADKAIINgIQCyAAKAIAKAIQDQBBAA8LQQELYQAgAEEANgK8LSAAQQA7AbgtIABBuBZqQajPADYCACAAIABB/BRqNgKwFiAAQawWakGUzwA2AgAgACAAQYgTajYCpBYgAEGgFmpBgM8ANgIAIAAgAEGUAWo2ApgWIAAQEQvwBAEDfyAAQZQBaiECA0AgAiABQQJ0IgNqQQA7AQAgAiADQQRyakEAOwEAIAFBAmoiAUGeAkcNAAsgAEEAOwH8FCAAQQA7AYgTIABBxBVqQQA7AQAgAEHAFWpBADsBACAAQbwVakEAOwEAIABBuBVqQQA7AQAgAEG0FWpBADsBACAAQbAVakEAOwEAIABBrBVqQQA7AQAgAEGoFWpBADsBACAAQaQVakEAOwEAIABBoBVqQQA7AQAgAEGcFWpBADsBACAAQZgVakEAOwEAIABBlBVqQQA7AQAgAEGQFWpBADsBACAAQYwVakEAOwEAIABBiBVqQQA7AQAgAEGEFWpBADsBACAAQYAVakEAOwEAIABB/BNqQQA7AQAgAEH4E2pBADsBACAAQfQTakEAOwEAIABB8BNqQQA7AQAgAEHsE2pBADsBACAAQegTakEAOwEAIABB5BNqQQA7AQAgAEHgE2pBADsBACAAQdwTakEAOwEAIABB2BNqQQA7AQAgAEHUE2pBADsBACAAQdATakEAOwEAIABBzBNqQQA7AQAgAEHIE2pBADsBACAAQcQTakEAOwEAIABBwBNqQQA7AQAgAEG8E2pBADsBACAAQbgTakEAOwEAIABBtBNqQQA7AQAgAEGwE2pBADsBACAAQawTakEAOwEAIABBqBNqQQA7AQAgAEGkE2pBADsBACAAQaATakEAOwEAIABBnBNqQQA7AQAgAEGYE2pBADsBACAAQZQTakEAOwEAIABBkBNqQQA7AQAgAEGME2pBADsBACAAQgA3AqwtIABBlAlqQQE7AQAgAEEANgKoLSAAQQA2AqAtC7IDAQJ/IAAgAC8BuC0gA0H//wNxIgUgACgCvC0iBHRyIgM7AbgtAkACQAJ/IARBDk4EQCAAIAAoAhQiBEEBajYCFCAEIAAoAghqIAM6AAAgACAAKAIUIgNBAWo2AhQgAyAAKAIIaiAAQbktai0AADoAACAAIAVBECAAKAK8LSIEa3YiAzsBuC0gBEENawwBCyAEQQNqCyIEQQlOBEAgACAAKAIUIgRBAWo2AhQgBCAAKAIIaiADOgAAIAAgACgCFCIDQQFqNgIUIAMgACgCCGohBCAAQbktai0AACEDDAELIARBAUgNASAAIAAoAhQiBEEBajYCFCAEIAAoAghqIQQLIAQgAzoAAAsgAEEANgK8LSAAQQA7AbgtIAAgACgCFCIDQQFqNgIUIAMgACgCCGogAjoAACAAIAAoAhQiA0EBajYCFCADIAAoAghqIAJBCHY6AAAgACAAKAIUIgNBAWo2AhQgAyAAKAIIaiACQX9zIgM6AAAgACAAKAIUIgRBAWo2AhQgBCAAKAIIaiADQQh2OgAAIAAoAgggACgCFGogASACEB8aIAAgACgCFCACajYCFAusAQEBfwJAIAACfyAAKAK8LSIBQRBGBEAgACAAKAIUIgFBAWo2AhQgASAAKAIIaiAALQC4LToAACAAIAAoAhQiAUEBajYCFCABIAAoAghqIABBuS1qLQAAOgAAIABBADsBuC1BAAwBCyABQQhIDQEgACAAKAIUIgFBAWo2AhQgASAAKAIIaiAALQC4LToAACAAIABBuS1qLQAAOwG4LSAAKAK8LUEIaws2ArwtCwuhEwENfwJ/AkACQAJAIAAoAoQBQQFOBEAgACgCACIGKAIsQQJHDQNB/4D/n38hBANAAkAgBEEBcUUNACAAIAVBAnRqLwGUAUUNAEEAIQQMBAsCQCAEQQJxRQ0AIAAgBUECdEEEcmovAZQBRQ0AQQAhBAwECyAEQQJ2IQQgBUECaiIFQSBHDQALDAELIAJBBWoiBQwDCwJAIAAvAbgBDQAgAC8BvAENACAALwHIAQ0AQSAhBQNAIAAgBUECdCIEai8BlAENASAAIARBBHJqLwGUAQ0BIAAgBEEIcmovAZQBDQEgACAEQQxyai8BlAENAUEAIQQgBUEEaiIFQYACRw0ACwwBC0EBIQQLIAYgBDYCLAsgACAAQZgWahAVIAAgAEGkFmoQFSAALwGWASEEIAAgAEGcFmooAgAiCkECdGpB//8DOwGaASAKQQBOBEBBB0GKASAEGyEJQQRBAyAEGyELIABBwBVqIQ4gAEHEFWohDyAAQbwVaiEQQX8hDANAIAQhBSAAIAgiDUEBaiIIQQJ0ai8BlgEhBAJAAkAgB0EBaiIGIAlODQAgBCAFRw0AIAYhBwwBCwJ/IAYgC0gEQCAAIAVBAnRqQfwUaiIHLwEAIAZqDAELIAUEQCAFIAxHBEAgACAFQQJ0akH8FGoiBiAGLwEAQQFqOwEACyAQIgcvAQBBAWoMAQsgB0EJTARAIA4iBy8BAEEBagwBCyAPIgcvAQBBAWoLIQYgByAGOwEAQQAhBwJ/IARFBEBBAyELQYoBDAELQQNBBCAEIAVGIgYbIQtBBkEHIAYbCyEJIAUhDAsgCiANRw0ACwsgAEGKE2ovAQAhBCAAIABBqBZqKAIAIgpBAnRqQY4TakH//wM7AQBBACEHIApBAE4EQEEHQYoBIAQbIQlBBEEDIAQbIQsgAEHAFWohDiAAQcQVaiEPIABBvBVqIRBBfyEMQQAhCANAIAQhBSAAIAgiDUEBaiIIQQJ0akGKE2ovAQAhBAJAAkAgB0EBaiIGIAlODQAgBCAFRw0AIAYhBwwBCwJ/IAYgC0gEQCAAIAVBAnRqQfwUaiIHLwEAIAZqDAELIAUEQCAFIAxHBEAgACAFQQJ0akH8FGoiBiAGLwEAQQFqOwEACyAQIgcvAQBBAWoMAQsgB0EJTARAIA4iBy8BAEEBagwBCyAPIgcvAQBBAWoLIQYgByAGOwEAQQAhBwJ/IARFBEBBAyELQYoBDAELQQNBBCAEIAVGIgYbIQtBBkEHIAYbCyEJIAUhDAsgCiANRw0ACwsgACAAQbAWahAVIAAgACgCqC0Cf0ESIABBuhVqLwEADQAaQREgAEGCFWovAQANABpBECAAQbYVai8BAA0AGkEPIABBhhVqLwEADQAaQQ4gAEGyFWovAQANABpBDSAAQYoVai8BAA0AGkEMIABBrhVqLwEADQAaQQsgAEGOFWovAQANABpBCiAAQaoVai8BAA0AGkEJIABBkhVqLwEADQAaQQggAEGmFWovAQANABpBByAAQZYVai8BAA0AGkEGIABBohVqLwEADQAaQQUgAEGaFWovAQANABpBBCAAQZ4Vai8BAA0AGkEDQQIgAEH+FGovAQAbCyIIQQNsaiIEQRFqNgKoLSAEQRtqQQN2IgQgACgCrC1BCmpBA3YiBSAEIAVJGwshBAJAAkAgAUUNACACQQRqIARLDQAgACABIAIgAxASDAELIAAoArwtIQYCQCAEIAVHBEAgACgCiAFBBEcNAQsgACAALwG4LSADQQJqQf//A3EiBCAGdHIiBTsBuC0gAAJ/IAZBDk4EQCAAIAAoAhQiBkEBajYCFCAGIAAoAghqIAU6AAAgACAAKAIUIgVBAWo2AhQgBSAAKAIIaiAAQbktai0AADoAACAAIARBECAAKAK8LSIFa3Y7AbgtIAVBDWsMAQsgBkEDags2ArwtIABBwM8AQcDYABAWDAELIAAvAbgtIANBBGpB//8DcSIHIAZ0ciEFAkAgBkEOTgRAIAAgBTsBuC0gACAAKAIUIgRBAWo2AhQgBCAAKAIIaiAFOgAAIAAgACgCFCIEQQFqNgIUIAQgACgCCGogAEG5LWotAAA6AAAgACgCvC0iBUENayEEIAdBECAFa3YhBQwBCyAGQQNqIQQLIAAgBDYCvC0gAEGcFmooAgAiCkGA/gNqQf//A3EiByAEdCEGIABBqBZqKAIAIQkCfyAEQQxOBEAgACAFIAZyIgQ7AbgtIAAgACgCFCIFQQFqNgIUIAUgACgCCGogBDoAACAAIAAoAhQiBEEBajYCFCAEIAAoAghqIABBuS1qLQAAOgAAIAAoArwtIgVBC2shBCAHQRAgBWt2DAELIARBBWohBCAFIAZyCyEFIAAgBDYCvC0gCUH//wNxIgcgBHQhBgJ/IARBDE4EQCAAIAUgBnIiBDsBuC0gACAAKAIUIgVBAWo2AhQgBSAAKAIIaiAEOgAAIAAgACgCFCIEQQFqNgIUIAQgACgCCGogAEG5LWotAAA6AAAgACgCvC0iBUELayEEIAdBECAFa3YMAQsgBEEFaiEEIAUgBnILIQUgACAENgK8LSAIQf3/A2pB//8DcSIHIAR0IQYCfyAEQQ1OBEAgACAFIAZyIgQ7AbgtIAAgACgCFCIFQQFqNgIUIAUgACgCCGogBDoAACAAIAAoAhQiBEEBajYCFCAEIAAoAghqIABBuS1qLQAAOgAAIAAoArwtIgVBDGshBCAHQRAgBWt2DAELIARBBGohBCAFIAZyCyEGIAAgBDYCvC1BACEFIABBuS1qIQ0DQCAAIAYgACAFQZDcAGotAABBAnRqQf4Uai8BACIHIAR0ciIGOwG4LSAAAn8gBEEOTgRAIAAgACgCFCIEQQFqNgIUIAQgACgCCGogBjoAACAAIAAoAhQiBEEBajYCFCAEIAAoAghqIA0tAAA6AAAgACAHQRAgACgCvC0iBGt2IgY7AbgtIARBDWsMAQsgBEEDagsiBDYCvC0gBSAIRyEHIAVBAWohBSAHDQALIAAgAEGUAWoiBCAKEBcgACAAQYgTaiIFIAkQFyAAIAQgBRAWCyAAEBEgAwRAAkACfyAAKAK8LSIEQQlOBEAgACAAKAIUIgRBAWo2AhQgBCAAKAIIaiAALQC4LToAACAAIAAoAhQiBEEBajYCFCAEIAAoAghqIQQgAEG5LWotAAAMAQsgBEEBSA0BIAAgACgCFCIEQQFqNgIUIAQgACgCCGohBCAALQC4LQshBSAEIAU6AAALIABBADYCvC0gAEEAOwG4LQsLsRUBFX8jAEEgayEKIAEoAgAhCSABKAIIIgIoAgAhBSACKAIMIQ0gAEKAgICA0McANwLQKEF/IRACQCANQQBKBEBBACECA0ACQCAJIAJBAnRqIgMvAQAEQCAAIAAoAtAoQQFqIgM2AtAoIAAgA0ECdGpB3BZqIAI2AgAgACACakHYKGpBADoAACACIRAMAQsgA0EAOwECCyACQQFqIgIgDUcNAAsgACgC0CgiBEEBSg0BCwNAIAAgBEEBaiICNgLQKCAAIAJBAnRqQdwWaiAQQQFqIgNBACAQQQJIIgQbIgI2AgAgCSACQQJ0IgdqQQE7AQAgACACakHYKGpBADoAACAAIAAoAqgtQQFrNgKoLSAFBEAgACAAKAKsLSAFIAdqLwECazYCrC0LIAMgECAEGyEQIAAoAtAoIgRBAkgNAAsLIAEgEDYCBCAEQQF2IQgDQCAAIAhBAnRqQdwWaigCACELAkAgCCICQQF0IgMgBEoNACAAIAtqQdgoaiEPIAkgC0ECdGohBiAIIQUDQAJAIAMgBE4EQCADIQIMAQsgCSAAQdwWaiICIANBAXIiBEECdGooAgAiDkECdGovAQAiByAJIAIgA0ECdGooAgAiDEECdGovAQAiAk8EQCACIAdHBEAgAyECDAILIAMhAiAAQdgoaiIDIA5qLQAAIAMgDGotAABLDQELIAQhAgsgBi8BACIEIAkgACACQQJ0akHcFmooAgAiA0ECdGovAQAiB0kEQCAFIQIMAgsCQCAEIAdHDQAgDy0AACAAIANqQdgoai0AAEsNACAFIQIMAgsgACAFQQJ0akHcFmogAzYCACACIQUgAkEBdCIDIAAoAtAoIgRMDQALCyAAIAJBAnRqQdwWaiALNgIAIAhBAk4EQCAIQQFrIQggACgC0CghBAwBCwsgACgC0CghAwNAIA0hCCAAIANBAWsiBDYC0CggACgC4BYhCyAAIAAgA0ECdGpB3BZqKAIAIg02AuAWQQEhAgJAIANBA0gNACAAIA1qQdgoaiEPQQIhAyAJIA1BAnRqIQZBASEFA0ACQCADIAROBEAgAyECDAELIAkgAEHcFmoiAiADQQFyIgRBAnRqKAIAIg5BAnRqLwEAIgcgCSACIANBAnRqKAIAIgxBAnRqLwEAIgJPBEAgAiAHRwRAIAMhAgwCCyADIQIgAEHYKGoiAyAOai0AACADIAxqLQAASw0BCyAEIQILIAYvAQAiBCAJIAAgAkECdGpB3BZqKAIAIgNBAnRqLwEAIgdJBEAgBSECDAILAkAgBCAHRw0AIA8tAAAgACADakHYKGotAABLDQAgBSECDAILIAAgBUECdGpB3BZqIAM2AgAgAiEFIAJBAXQiAyAAKALQKCIETA0ACwtBAiEDIABB3BZqIgYgAkECdGogDTYCACAAIAAoAtQoQQFrIgQ2AtQoIAAoAuAWIQIgBiAEQQJ0aiALNgIAIAAgACgC1ChBAWsiBDYC1CggBiAEQQJ0aiACNgIAIAkgCEECdGoiDiAJIAJBAnRqIgQvAQAgCSALQQJ0aiIFLwEAajsBACAAQdgoaiIMIAhqIg8gAiAMai0AACICIAsgDGotAAAiByACIAdLG0EBajoAACAEIAg7AQIgBSAIOwECIAAgCDYC4BZBASEFQQEhAgJAIAAoAtAoIgRBAkgNAANAAn8gAyADIARODQAaIAkgBiADQQFyIgRBAnRqKAIAIgtBAnRqLwEAIgIgCSAGIANBAnRqKAIAIg1BAnRqLwEAIgdPBEAgAyACIAdHDQEaIAMgCyAMai0AACAMIA1qLQAASw0BGgsgBAshAiAOLwEAIgQgCSAAIAJBAnRqQdwWaigCACIDQQJ0ai8BACIHSQRAIAUhAgwCCwJAIAQgB0cNACAPLQAAIAAgA2pB2ChqLQAASw0AIAUhAgwCCyAAIAVBAnRqQdwWaiADNgIAIAIhBSACQQF0IgMgACgC0CgiBEwNAAsLIAhBAWohDSAAIAJBAnRqQdwWaiAINgIAIAAoAtAoIgNBAUoNAAsgACAAKALUKEEBayICNgLUKCAAQdwWaiIDIAJBAnRqIAAoAuAWNgIAIAEoAgQhByABKAIIIgIoAhAhBiACKAIIIREgAigCBCETIAIoAgAhEiABKAIAIQwgAEHUFmoiAUIANwEAIABBzBZqIhRCADcBACAAQcQWaiIVQgA3AQAgAEG8FmoiFkIANwEAQQAhCCAMIAMgACgC1ChBAnRqKAIAQQJ0akEAOwECAkAgACgC1CgiAkG7BEoNACACQQFqIQJBACEOA0AgDCAAIAJBAnRqQdwWaigCACIEQQJ0Ig1qIgUgDCAFLwECQQJ0ai8BAiIDQQFqIAYgAyAGSBsiDzsBAiADIAZOIQMCQCAEIAdKDQAgACAPQQF0akG8FmoiCyALLwEAQQFqOwEAQQAhCyAEIBFOBEAgEyAEIBFrQQJ0aigCACELCyAAIAAoAqgtIAUvAQAiBCALIA9qbGo2AqgtIBJFDQAgACAAKAKsLSALIA0gEmovAQJqIARsajYCrC0LIAMgDmohDiACQQFqIgJBvQRHDQALIA5FDQAgACAGQQF0akG8FmohDwNAIAYhAgNAIAAgAiIDQQFrIgJBAXRqQbwWaiIELwEAIgVFDQALIAQgBUEBazsBACAAIANBAXRqQbwWaiICIAIvAQBBAmo7AQAgDyAPLwEAQQFrIgI7AQAgDkECSiEDIA5BAmshDiADDQALIAZFDQBBvQQhBQNAIAJB//8DcSEDIAUhAgNAIAMEQCAAIAJBAWsiAkECdGpB3BZqKAIAIgQgB0oNASAMIARBAnRqIgQvAQIiBSAGRwRAIAAgACgCqC0gBC8BACAGIAVrbGo2AqgtIAQgBjsBAgsgA0EBayEDIAIhBQwBCwsgBkEBayIGRQ0BIAAgBkEBdGpBvBZqLwEAIQIMAAsACyAKIBYvAQBBAXQiAjsBAiAKIAIgAEG+FmovAQBqQQF0IgI7AQQgCiACIABBwBZqLwEAakEBdCICOwEGIAogAiAAQcIWai8BAGpBAXQiAjsBCCAKIAIgFS8BAGpBAXQiAjsBCiAKIAIgAEHGFmovAQBqQQF0IgI7AQwgCiACIABByBZqLwEAakEBdCICOwEOIAogAiAAQcoWai8BAGpBAXQiAjsBECAKIAIgFC8BAGpBAXQiAjsBEiAKIAIgAEHOFmovAQBqQQF0IgI7ARQgCiACIABB0BZqLwEAakEBdCICOwEWIAogAiAAQdIWai8BAGpBAXQiAjsBGCAKIAEvAQAgAmpBAXQiAjsBGiAKIABB1hZqLwEAIAJqQQF0IgI7ARwgCiACIABB2BZqLwEAakEBdDsBHiAQQQBOBEADQCAJIAhBAnRqIgcvAQIiBARAIAogBEEBdGoiACAALwEAIgBBAWo7AQAgBEEDcSEDQQAhAiAEQQFrQQNPBEAgBEH8/wNxIQUDQCAAQQN2QQFxIABBAnZBAXEgAEECcSACIABBAXFyQQJ0cnJBAXRyIgRBAXQhAiAAQQR2IQAgBUEEayIFDQALCyADBEADQCACIABBAXFyIgRBAXQhAiAAQQF2IQAgA0EBayIDDQALCyAHIAQ7AQALIAggEEchACAIQQFqIQggAA0ACwsL2QgBCn8CQCAAKAKgLUUEQCAAKAK8LSEDDAELIABBuS1qIQgDQCAEQQFqIQogACgCmC0gBGotAAAhBQJAIAACfyAAKAKkLSAEQQF0ai8BACIHRQRAIAEgBUECdGoiAy8BAiEEIAAgAC8BuC0gAy8BACIFIAAoArwtIgN0ciIHOwG4LUEQIARrIANIBEAgACAAKAIUIgNBAWo2AhQgAyAAKAIIaiAHOgAAIAAgACgCFCIDQQFqNgIUIAMgACgCCGogCC0AADoAACAAIAVBECAAKAK8LSIDa3Y7AbgtIAMgBGpBEGsMAgsgAyAEagwBCyAFQYDNAGotAAAiC0ECdCIJQYAIciABaiIDLwEGIQQgACAALwG4LSADLwEEIgwgACgCvC0iBnRyIgM7AbgtIAACf0EQIARrIAZIBEAgACAAKAIUIgZBAWo2AhQgBiAAKAIIaiADOgAAIAAgACgCFCIDQQFqNgIUIAMgACgCCGogCC0AADoAACAAIAxBECAAKAK8LSIGa3YiAzsBuC0gBCAGakEQawwBCyAEIAZqCyIENgK8LSALQQhrQRNNBEAgACADIAUgCUGw3ABqKAIAa0H//wNxIgYgBHRyIgM7AbgtIAACf0EQIAlBwNkAaigCACIFayAESARAIAAgACgCFCIEQQFqNgIUIAQgACgCCGogAzoAACAAIAAoAhQiBEEBajYCFCAEIAAoAghqIAgtAAA6AAAgACAGQRAgACgCvC0iBGt2IgM7AbgtIAQgBWpBEGsMAQsgBCAFagsiBDYCvC0LIAIgB0EBayIFIAVBB3ZBgAJqIAVBgAJJG0GAyQBqLQAAIgtBAnQiCWoiBi8BAiEHIAAgAyAGLwEAIgwgBHRyIgY7AbgtIAACf0EQIAdrIARIBEAgACAAKAIUIgRBAWo2AhQgBCAAKAIIaiAGOgAAIAAgACgCFCIEQQFqNgIUIAQgACgCCGogCC0AADoAACAAIAxBECAAKAK8LSIEa3YiBjsBuC0gBCAHakEQawwBCyAEIAdqCyIDNgK8LSALQQRJDQEgACAGIAUgCUGw3QBqKAIAa0H//wNxIgUgA3RyIgc7AbgtQRAgCUHA2gBqKAIAIgRrIANIBEAgACAAKAIUIgNBAWo2AhQgAyAAKAIIaiAHOgAAIAAgACgCFCIDQQFqNgIUIAMgACgCCGogCC0AADoAACAAIAVBECAAKAK8LSIDa3Y7AbgtIAMgBGpBEGsMAQsgAyAEagsiAzYCvC0LIAoiBCAAKAKgLUkNAAsLIAFBgghqLwEAIQQgACAALwG4LSABLwGACCIKIAN0ciIFOwG4LUEQIARrIANIBEAgACAAKAIUIgNBAWo2AhQgAyAAKAIIaiAFOgAAIAAgACgCFCIDQQFqNgIUIAMgACgCCGogAEG5LWotAAA6AAAgACAKQRAgACgCvC0iA2t2OwG4LSAAIAMgBGpBEGs2ArwtDwsgACADIARqNgK8LQuXCwEMfyACQQBOBEBBBEEDIAEvAQIiChshBkEHQYoBIAobIQMgAEG5LWohCEF/IQcDQCAKIQkgASALIgxBAWoiC0ECdGovAQIhCgJAAkAgBUEBaiIEIANODQAgCSAKRw0AIAQhBQwBCwJAIAQgBkgEQCAAIAlBAnRqIgVB/BRqIQ0gBUH+FGohDiAAKAK8LSEFA0AgDi8BACEDIAAgAC8BuC0gDS8BACIGIAV0ciIHOwG4LSAAAn9BECADayAFSARAIAAgACgCFCIFQQFqNgIUIAUgACgCCGogBzoAACAAIAAoAhQiBUEBajYCFCAFIAAoAghqIAgtAAA6AAAgACAGQRAgACgCvC0iBWt2OwG4LSADIAVqQRBrDAELIAMgBWoLIgU2ArwtIARBAWsiBA0ACwwBCyAAAn8gCQRAAkAgByAJRgRAIAAoArwtIQMgBCEFDAELIAAgCUECdGoiBEH+FGovAQAhAyAAIAAvAbgtIARB/BRqLwEAIgYgACgCvC0iBHRyIgc7AbgtIAACf0EQIANrIARIBEAgACAAKAIUIgRBAWo2AhQgBCAAKAIIaiAHOgAAIAAgACgCFCIEQQFqNgIUIAQgACgCCGogCC0AADoAACAAIAZBECAAKAK8LSIEa3Y7AbgtIAMgBGpBEGsMAQsgAyAEagsiAzYCvC0LIAAvAbgtIAAvAbwVIgcgA3RyIQQCQEEQIAAvAb4VIgZrIANIBEAgACAEOwG4LSAAIAAoAhQiA0EBajYCFCADIAAoAghqIAQ6AAAgACAAKAIUIgNBAWo2AhQgAyAAKAIIaiAILQAAOgAAIAYgACgCvC0iBGpBEGshAyAHQRAgBGt2IQQMAQsgAyAGaiEDCyAAIAM2ArwtIAAgBCAFQf3/A2pB//8DcSIFIAN0ciIEOwG4LSADQQ9OBEAgACAAKAIUIgNBAWo2AhQgAyAAKAIIaiAEOgAAIAAgACgCFCIDQQFqNgIUIAMgACgCCGogCC0AADoAACAAIAVBECAAKAK8LSIDa3Y7AbgtIANBDmsMAgsgA0ECagwBCyAFQQlMBEAgAC8BuC0gAC8BwBUiByAAKAK8LSIDdHIhBAJAQRAgAC8BwhUiBmsgA0gEQCAAIAQ7AbgtIAAgACgCFCIDQQFqNgIUIAMgACgCCGogBDoAACAAIAAoAhQiA0EBajYCFCADIAAoAghqIAgtAAA6AAAgBiAAKAK8LSIEakEQayEDIAdBECAEa3YhBAwBCyADIAZqIQMLIAAgAzYCvC0gACAEIAVB/v8DakH//wNxIgUgA3RyIgQ7AbgtIANBDk4EQCAAIAAoAhQiA0EBajYCFCADIAAoAghqIAQ6AAAgACAAKAIUIgNBAWo2AhQgAyAAKAIIaiAILQAAOgAAIAAgBUEQIAAoArwtIgNrdjsBuC0gA0ENawwCCyADQQNqDAELIAAvAbgtIAAvAcQVIgcgACgCvC0iA3RyIQQCQEEQIAAvAcYVIgZrIANIBEAgACAEOwG4LSAAIAAoAhQiA0EBajYCFCADIAAoAghqIAQ6AAAgACAAKAIUIgNBAWo2AhQgAyAAKAIIaiAILQAAOgAAIAYgACgCvC0iBGpBEGshAyAHQRAgBGt2IQQMAQsgAyAGaiEDCyAAIAM2ArwtIAAgBCAFQfb/A2pB//8DcSIFIAN0ciIEOwG4LSADQQpOBEAgACAAKAIUIgNBAWo2AhQgAyAAKAIIaiAEOgAAIAAgACgCFCIDQQFqNgIUIAMgACgCCGogCC0AADoAACAAIAVBECAAKAK8LSIDa3Y7AbgtIANBCWsMAQsgA0EHags2ArwtC0EAIQUCfyAKRQRAQYoBIQNBAwwBC0EGQQcgCSAKRiIEGyEDQQNBBCAEGwshBiAJIQcLIAIgDEcNAAsLCwkAIAEgAmwQHAsGACABEB0LXwEBfyMAQUBqIgMkACADQQA2AjAgA0IANwMoIAMgADYCCCADIAI2AhQgAyABNgIMIAMgAUEDbDYCGCADQQhqEAcgA0EIahALIANBCGoQCCADKAIcIQEgA0FAayQAIAELBgBB1N8AC6QuAQx/IwBBEGsiDCQAAkACQAJAAkACQAJAAkACQAJAAkACQAJAIABB9AFNBEBB2N8AKAIAIgZBECAAQQtqQXhxIABBC0kbIgRBA3YiAXYiAEEDcQRAIABBf3NBAXEgAWoiAkEDdCIDQYjgAGooAgAiAUEIaiEAAkAgASgCCCIEIANBgOAAaiIDRgRAQdjfACAGQX4gAndxNgIADAELIAQgAzYCDCADIAQ2AggLIAEgAkEDdCICQQNyNgIEIAEgAmoiASABKAIEQQFyNgIEDA0LIARB4N8AKAIAIghNDQEgAARAAkAgACABdEECIAF0IgBBACAAa3JxIgBBACAAa3FBAWsiACAAQQx2QRBxIgB2IgFBBXZBCHEiAiAAciABIAJ2IgBBAnZBBHEiAXIgACABdiIAQQF2QQJxIgFyIAAgAXYiAEEBdkEBcSIBciAAIAF2aiICQQN0IgNBiOAAaigCACIBKAIIIgAgA0GA4ABqIgNGBEBB2N8AIAZBfiACd3EiBjYCAAwBCyAAIAM2AgwgAyAANgIICyABQQhqIQAgASAEQQNyNgIEIAEgBGoiAyACQQN0IgUgBGsiAkEBcjYCBCABIAVqIAI2AgAgCARAIAhBA3YiBUEDdEGA4ABqIQRB7N8AKAIAIQECfyAGQQEgBXQiBXFFBEBB2N8AIAUgBnI2AgAgBAwBCyAEKAIICyEFIAQgATYCCCAFIAE2AgwgASAENgIMIAEgBTYCCAtB7N8AIAM2AgBB4N8AIAI2AgAMDQtB3N8AKAIAIglFDQEgCUEAIAlrcUEBayIAIABBDHZBEHEiAHYiAUEFdkEIcSICIAByIAEgAnYiAEECdkEEcSIBciAAIAF2IgBBAXZBAnEiAXIgACABdiIAQQF2QQFxIgFyIAAgAXZqQQJ0QYjiAGooAgAiAygCBEF4cSAEayEBIAMhAgNAAkAgAigCECIARQRAIAIoAhQiAEUNAQsgACgCBEF4cSAEayICIAEgASACSyICGyEBIAAgAyACGyEDIAAhAgwBCwsgAyAEaiILIANNDQIgAygCGCEKIAMgAygCDCIFRwRAIAMoAggiAEHo3wAoAgBJGiAAIAU2AgwgBSAANgIIDAwLIANBFGoiAigCACIARQRAIAMoAhAiAEUNBCADQRBqIQILA0AgAiEHIAAiBUEUaiICKAIAIgANACAFQRBqIQIgBSgCECIADQALIAdBADYCAAwLC0F/IQQgAEG/f0sNACAAQQtqIgBBeHEhBEHc3wAoAgAiCEUNAEEfIQcgBEH///8HTQRAIABBCHYiACAAQYD+P2pBEHZBCHEiAHQiASABQYDgH2pBEHZBBHEiAXQiAiACQYCAD2pBEHZBAnEiAnRBD3YgACABciACcmsiAEEBdCAEIABBFWp2QQFxckEcaiEHC0EAIARrIQECQAJAAkAgB0ECdEGI4gBqKAIAIgJFBEBBACEADAELQQAhACAEQQBBGSAHQQF2ayAHQR9GG3QhAwNAAkAgAigCBEF4cSAEayIGIAFPDQAgAiEFIAYiAQ0AQQAhASACIQAMAwsgACACKAIUIgYgBiACIANBHXZBBHFqKAIQIgJGGyAAIAYbIQAgA0EBdCEDIAINAAsLIAAgBXJFBEBBAiAHdCIAQQAgAGtyIAhxIgBFDQMgAEEAIABrcUEBayIAIABBDHZBEHEiAHYiAkEFdkEIcSIDIAByIAIgA3YiAEECdkEEcSICciAAIAJ2IgBBAXZBAnEiAnIgACACdiIAQQF2QQFxIgJyIAAgAnZqQQJ0QYjiAGooAgAhAAsgAEUNAQsDQCAAKAIEQXhxIARrIgYgAUkhAyAGIAEgAxshASAAIAUgAxshBSAAKAIQIgIEfyACBSAAKAIUCyIADQALCyAFRQ0AIAFB4N8AKAIAIARrTw0AIAQgBWoiByAFTQ0BIAUoAhghCSAFIAUoAgwiA0cEQCAFKAIIIgBB6N8AKAIASRogACADNgIMIAMgADYCCAwKCyAFQRRqIgIoAgAiAEUEQCAFKAIQIgBFDQQgBUEQaiECCwNAIAIhBiAAIgNBFGoiAigCACIADQAgA0EQaiECIAMoAhAiAA0ACyAGQQA2AgAMCQsgBEHg3wAoAgAiAE0EQEHs3wAoAgAhAQJAIAAgBGsiAkEQTwRAQeDfACACNgIAQezfACABIARqIgM2AgAgAyACQQFyNgIEIAAgAWogAjYCACABIARBA3I2AgQMAQtB7N8AQQA2AgBB4N8AQQA2AgAgASAAQQNyNgIEIAAgAWoiACAAKAIEQQFyNgIECyABQQhqIQAMCwsgBEHk3wAoAgAiA0kEQEHk3wAgAyAEayIBNgIAQfDfAEHw3wAoAgAiACAEaiICNgIAIAIgAUEBcjYCBCAAIARBA3I2AgQgAEEIaiEADAsLQQAhACAEQS9qIggCf0Gw4wAoAgAEQEG44wAoAgAMAQtBvOMAQn83AgBBtOMAQoCggICAgAQ3AgBBsOMAIAxBDGpBcHFB2KrVqgVzNgIAQcTjAEEANgIAQZTjAEEANgIAQYAgCyIBaiIGQQAgAWsiB3EiBSAETQ0KQZDjACgCACIBBEBBiOMAKAIAIgIgBWoiCSACTQ0LIAEgCUkNCwtBlOMALQAAQQRxDQUCQAJAQfDfACgCACIBBEBBmOMAIQADQCABIAAoAgAiAk8EQCACIAAoAgRqIAFLDQMLIAAoAggiAA0ACwtBABAeIgNBf0YNBiAFIQZBtOMAKAIAIgBBAWsiASADcQRAIAUgA2sgASADakEAIABrcWohBgsgBCAGTw0GIAZB/v///wdLDQZBkOMAKAIAIgAEQEGI4wAoAgAiASAGaiICIAFNDQcgACACSQ0HCyAGEB4iACADRw0BDAgLIAYgA2sgB3EiBkH+////B0sNBSAGEB4iAyAAKAIAIAAoAgRqRg0EIAMhAAsCQCAEQTBqIAZNDQAgAEF/Rg0AQbjjACgCACIBIAggBmtqQQAgAWtxIgFB/v///wdLBEAgACEDDAgLIAEQHkF/RwRAIAEgBmohBiAAIQMMCAtBACAGaxAeGgwFCyAAIQMgAEF/Rw0GDAQLAAtBACEFDAcLQQAhAwwFCyADQX9HDQILQZTjAEGU4wAoAgBBBHI2AgALIAVB/v///wdLDQEgBRAeIgNBABAeIgBPDQEgA0F/Rg0BIABBf0YNASAAIANrIgYgBEEoak0NAQtBiOMAQYjjACgCACAGaiIANgIAQYzjACgCACAASQRAQYzjACAANgIACwJAAkACQEHw3wAoAgAiAQRAQZjjACEAA0AgAyAAKAIAIgIgACgCBCIFakYNAiAAKAIIIgANAAsMAgtB6N8AKAIAIgBBACAAIANNG0UEQEHo3wAgAzYCAAtBACEAQZzjACAGNgIAQZjjACADNgIAQfjfAEF/NgIAQfzfAEGw4wAoAgA2AgBBpOMAQQA2AgADQCAAQQN0IgFBiOAAaiABQYDgAGoiAjYCACABQYzgAGogAjYCACAAQQFqIgBBIEcNAAtB5N8AIAZBKGsiAEF4IANrQQdxQQAgA0EIakEHcRsiAWsiAjYCAEHw3wAgASADaiIBNgIAIAEgAkEBcjYCBCAAIANqQSg2AgRB9N8AQcDjACgCADYCAAwCCyABIANPDQAgASACSQ0AIAAoAgxBCHENACAAIAUgBmo2AgRB8N8AIAFBeCABa0EHcUEAIAFBCGpBB3EbIgBqIgI2AgBB5N8AQeTfACgCACAGaiIDIABrIgA2AgAgAiAAQQFyNgIEIAEgA2pBKDYCBEH03wBBwOMAKAIANgIADAELQejfACgCACADSwRAQejfACADNgIACyADIAZqIQJBmOMAIQACQAJAAkACQAJAAkADQCACIAAoAgBHBEAgACgCCCIADQEMAgsLIAAtAAxBCHFFDQELQZjjACEAA0AgASAAKAIAIgJPBEAgAiAAKAIEaiICIAFLDQMLIAAoAgghAAwACwALIAAgAzYCACAAIAAoAgQgBmo2AgQgA0F4IANrQQdxQQAgA0EIakEHcRtqIgcgBEEDcjYCBCACQXggAmtBB3FBACACQQhqQQdxG2oiBiAHayAEayECIAQgB2ohBCABIAZGBEBB8N8AIAQ2AgBB5N8AQeTfACgCACACaiIANgIAIAQgAEEBcjYCBAwDCyAGQezfACgCAEYEQEHs3wAgBDYCAEHg3wBB4N8AKAIAIAJqIgA2AgAgBCAAQQFyNgIEIAAgBGogADYCAAwDCyAGKAIEIgBBA3FBAUYEQCAAQXhxIQgCQCAAQf8BTQRAIAYoAggiASAAQQN2IgVBA3RBgOAAakYaIAEgBigCDCIARgRAQdjfAEHY3wAoAgBBfiAFd3E2AgAMAgsgASAANgIMIAAgATYCCAwBCyAGKAIYIQkCQCAGIAYoAgwiA0cEQCAGKAIIIgAgAzYCDCADIAA2AggMAQsCQCAGQRRqIgAoAgAiAQ0AIAZBEGoiACgCACIBDQBBACEDDAELA0AgACEFIAEiA0EUaiIAKAIAIgENACADQRBqIQAgAygCECIBDQALIAVBADYCAAsgCUUNAAJAIAYgBigCHCIBQQJ0QYjiAGoiACgCAEYEQCAAIAM2AgAgAw0BQdzfAEHc3wAoAgBBfiABd3E2AgAMAgsgCUEQQRQgCSgCECAGRhtqIAM2AgAgA0UNAQsgAyAJNgIYIAYoAhAiAARAIAMgADYCECAAIAM2AhgLIAYoAhQiAEUNACADIAA2AhQgACADNgIYCyAGIAhqIQYgAiAIaiECCyAGIAYoAgRBfnE2AgQgBCACQQFyNgIEIAIgBGogAjYCACACQf8BTQRAIAJBA3YiAUEDdEGA4ABqIQACf0HY3wAoAgAiAkEBIAF0IgFxRQRAQdjfACABIAJyNgIAIAAMAQsgACgCCAshASAAIAQ2AgggASAENgIMIAQgADYCDCAEIAE2AggMAwtBHyEAIAJB////B00EQCACQQh2IgAgAEGA/j9qQRB2QQhxIgB0IgEgAUGA4B9qQRB2QQRxIgF0IgMgA0GAgA9qQRB2QQJxIgN0QQ92IAAgAXIgA3JrIgBBAXQgAiAAQRVqdkEBcXJBHGohAAsgBCAANgIcIARCADcCECAAQQJ0QYjiAGohAQJAQdzfACgCACIDQQEgAHQiBXFFBEBB3N8AIAMgBXI2AgAgASAENgIAIAQgATYCGAwBCyACQQBBGSAAQQF2ayAAQR9GG3QhACABKAIAIQMDQCADIgEoAgRBeHEgAkYNAyAAQR12IQMgAEEBdCEAIAEgA0EEcWpBEGoiBSgCACIDDQALIAUgBDYCACAEIAE2AhgLIAQgBDYCDCAEIAQ2AggMAgtB5N8AIAZBKGsiAEF4IANrQQdxQQAgA0EIakEHcRsiBWsiBzYCAEHw3wAgAyAFaiIFNgIAIAUgB0EBcjYCBCAAIANqQSg2AgRB9N8AQcDjACgCADYCACABIAJBJyACa0EHcUEAIAJBJ2tBB3EbakEvayIAIAAgAUEQakkbIgVBGzYCBCAFQaDjACkCADcCECAFQZjjACkCADcCCEGg4wAgBUEIajYCAEGc4wAgBjYCAEGY4wAgAzYCAEGk4wBBADYCACAFQRhqIQADQCAAQQc2AgQgAEEIaiEDIABBBGohACACIANLDQALIAEgBUYNAyAFIAUoAgRBfnE2AgQgASAFIAFrIgZBAXI2AgQgBSAGNgIAIAZB/wFNBEAgBkEDdiICQQN0QYDgAGohAAJ/QdjfACgCACIDQQEgAnQiAnFFBEBB2N8AIAIgA3I2AgAgAAwBCyAAKAIICyECIAAgATYCCCACIAE2AgwgASAANgIMIAEgAjYCCAwEC0EfIQAgAUIANwIQIAZB////B00EQCAGQQh2IgAgAEGA/j9qQRB2QQhxIgB0IgIgAkGA4B9qQRB2QQRxIgJ0IgMgA0GAgA9qQRB2QQJxIgN0QQ92IAAgAnIgA3JrIgBBAXQgBiAAQRVqdkEBcXJBHGohAAsgASAANgIcIABBAnRBiOIAaiECAkBB3N8AKAIAIgNBASAAdCIFcUUEQEHc3wAgAyAFcjYCACACIAE2AgAgASACNgIYDAELIAZBAEEZIABBAXZrIABBH0YbdCEAIAIoAgAhAwNAIAMiAigCBEF4cSAGRg0EIABBHXYhAyAAQQF0IQAgAiADQQRxakEQaiIFKAIAIgMNAAsgBSABNgIAIAEgAjYCGAsgASABNgIMIAEgATYCCAwDCyABKAIIIgAgBDYCDCABIAQ2AgggBEEANgIYIAQgATYCDCAEIAA2AggLIAdBCGohAAwFCyACKAIIIgAgATYCDCACIAE2AgggAUEANgIYIAEgAjYCDCABIAA2AggLQeTfACgCACIAIARNDQBB5N8AIAAgBGsiATYCAEHw3wBB8N8AKAIAIgAgBGoiAjYCACACIAFBAXI2AgQgACAEQQNyNgIEIABBCGohAAwDC0HU3wBBMDYCAEEAIQAMAgsCQCAJRQ0AAkAgBSgCHCICQQJ0QYjiAGoiACgCACAFRgRAIAAgAzYCACADDQFB3N8AIAhBfiACd3EiCDYCAAwCCyAJQRBBFCAJKAIQIAVGG2ogAzYCACADRQ0BCyADIAk2AhggBSgCECIABEAgAyAANgIQIAAgAzYCGAsgBSgCFCIARQ0AIAMgADYCFCAAIAM2AhgLAkAgAUEPTQRAIAUgASAEaiIAQQNyNgIEIAAgBWoiACAAKAIEQQFyNgIEDAELIAUgBEEDcjYCBCAHIAFBAXI2AgQgASAHaiABNgIAIAFB/wFNBEAgAUEDdiIBQQN0QYDgAGohAAJ/QdjfACgCACICQQEgAXQiAXFFBEBB2N8AIAEgAnI2AgAgAAwBCyAAKAIICyEBIAAgBzYCCCABIAc2AgwgByAANgIMIAcgATYCCAwBC0EfIQAgAUH///8HTQRAIAFBCHYiACAAQYD+P2pBEHZBCHEiAHQiAiACQYDgH2pBEHZBBHEiAnQiBCAEQYCAD2pBEHZBAnEiBHRBD3YgACACciAEcmsiAEEBdCABIABBFWp2QQFxckEcaiEACyAHIAA2AhwgB0IANwIQIABBAnRBiOIAaiECAkACQCAIQQEgAHQiBHFFBEBB3N8AIAQgCHI2AgAgAiAHNgIAIAcgAjYCGAwBCyABQQBBGSAAQQF2ayAAQR9GG3QhACACKAIAIQQDQCAEIgIoAgRBeHEgAUYNAiAAQR12IQQgAEEBdCEAIAIgBEEEcWpBEGoiAygCACIEDQALIAMgBzYCACAHIAI2AhgLIAcgBzYCDCAHIAc2AggMAQsgAigCCCIAIAc2AgwgAiAHNgIIIAdBADYCGCAHIAI2AgwgByAANgIICyAFQQhqIQAMAQsCQCAKRQ0AAkAgAygCHCICQQJ0QYjiAGoiACgCACADRgRAIAAgBTYCACAFDQFB3N8AIAlBfiACd3E2AgAMAgsgCkEQQRQgCigCECADRhtqIAU2AgAgBUUNAQsgBSAKNgIYIAMoAhAiAARAIAUgADYCECAAIAU2AhgLIAMoAhQiAEUNACAFIAA2AhQgACAFNgIYCwJAIAFBD00EQCADIAEgBGoiAEEDcjYCBCAAIANqIgAgACgCBEEBcjYCBAwBCyADIARBA3I2AgQgCyABQQFyNgIEIAEgC2ogATYCACAIBEAgCEEDdiIEQQN0QYDgAGohAkHs3wAoAgAhAAJ/QQEgBHQiBCAGcUUEQEHY3wAgBCAGcjYCACACDAELIAIoAggLIQQgAiAANgIIIAQgADYCDCAAIAI2AgwgACAENgIIC0Hs3wAgCzYCAEHg3wAgATYCAAsgA0EIaiEACyAMQRBqJAAgAAvMDAEHfwJAIABFDQAgAEEIayICIABBBGsoAgAiAUF4cSIAaiEFAkAgAUEBcQ0AIAFBA3FFDQEgAiACKAIAIgFrIgJB6N8AKAIASQ0BIAAgAWohACACQezfACgCAEcEQCABQf8BTQRAIAIoAggiBCABQQN2IgdBA3RBgOAAakYaIAQgAigCDCIBRgRAQdjfAEHY3wAoAgBBfiAHd3E2AgAMAwsgBCABNgIMIAEgBDYCCAwCCyACKAIYIQYCQCACIAIoAgwiA0cEQCACKAIIIgEgAzYCDCADIAE2AggMAQsCQCACQRRqIgEoAgAiBA0AIAJBEGoiASgCACIEDQBBACEDDAELA0AgASEHIAQiA0EUaiIBKAIAIgQNACADQRBqIQEgAygCECIEDQALIAdBADYCAAsgBkUNAQJAIAIgAigCHCIEQQJ0QYjiAGoiASgCAEYEQCABIAM2AgAgAw0BQdzfAEHc3wAoAgBBfiAEd3E2AgAMAwsgBkEQQRQgBigCECACRhtqIAM2AgAgA0UNAgsgAyAGNgIYIAIoAhAiAQRAIAMgATYCECABIAM2AhgLIAIoAhQiAUUNASADIAE2AhQgASADNgIYDAELIAUoAgQiAUEDcUEDRw0AQeDfACAANgIAIAUgAUF+cTYCBCACIABBAXI2AgQgACACaiAANgIADwsgAiAFTw0AIAUoAgQiAUEBcUUNAAJAIAFBAnFFBEAgBUHw3wAoAgBGBEBB8N8AIAI2AgBB5N8AQeTfACgCACAAaiIANgIAIAIgAEEBcjYCBCACQezfACgCAEcNA0Hg3wBBADYCAEHs3wBBADYCAA8LIAVB7N8AKAIARgRAQezfACACNgIAQeDfAEHg3wAoAgAgAGoiADYCACACIABBAXI2AgQgACACaiAANgIADwsgAUF4cSAAaiEAAkAgAUH/AU0EQCAFKAIIIgQgAUEDdiIHQQN0QYDgAGpGGiAEIAUoAgwiAUYEQEHY3wBB2N8AKAIAQX4gB3dxNgIADAILIAQgATYCDCABIAQ2AggMAQsgBSgCGCEGAkAgBSAFKAIMIgNHBEAgBSgCCCIBQejfACgCAEkaIAEgAzYCDCADIAE2AggMAQsCQCAFQRRqIgEoAgAiBA0AIAVBEGoiASgCACIEDQBBACEDDAELA0AgASEHIAQiA0EUaiIBKAIAIgQNACADQRBqIQEgAygCECIEDQALIAdBADYCAAsgBkUNAAJAIAUgBSgCHCIEQQJ0QYjiAGoiASgCAEYEQCABIAM2AgAgAw0BQdzfAEHc3wAoAgBBfiAEd3E2AgAMAgsgBkEQQRQgBigCECAFRhtqIAM2AgAgA0UNAQsgAyAGNgIYIAUoAhAiAQRAIAMgATYCECABIAM2AhgLIAUoAhQiAUUNACADIAE2AhQgASADNgIYCyACIABBAXI2AgQgACACaiAANgIAIAJB7N8AKAIARw0BQeDfACAANgIADwsgBSABQX5xNgIEIAIgAEEBcjYCBCAAIAJqIAA2AgALIABB/wFNBEAgAEEDdiIBQQN0QYDgAGohAAJ/QdjfACgCACIEQQEgAXQiAXFFBEBB2N8AIAEgBHI2AgAgAAwBCyAAKAIICyEBIAAgAjYCCCABIAI2AgwgAiAANgIMIAIgATYCCA8LQR8hASACQgA3AhAgAEH///8HTQRAIABBCHYiASABQYD+P2pBEHZBCHEiAXQiBCAEQYDgH2pBEHZBBHEiBHQiAyADQYCAD2pBEHZBAnEiA3RBD3YgASAEciADcmsiAUEBdCAAIAFBFWp2QQFxckEcaiEBCyACIAE2AhwgAUECdEGI4gBqIQQCQAJAAkBB3N8AKAIAIgNBASABdCIFcUUEQEHc3wAgAyAFcjYCACAEIAI2AgAgAiAENgIYDAELIABBAEEZIAFBAXZrIAFBH0YbdCEBIAQoAgAhAwNAIAMiBCgCBEF4cSAARg0CIAFBHXYhAyABQQF0IQEgBCADQQRxakEQaiIFKAIAIgMNAAsgBSACNgIAIAIgBDYCGAsgAiACNgIMIAIgAjYCCAwBCyAEKAIIIgAgAjYCDCAEIAI2AgggAkEANgIYIAIgBDYCDCACIAA2AggLQfjfAEH43wAoAgBBAWsiAkF/IAIbNgIACwtVAQJ/QdDfACgCACIBIABBA2pBfHEiAmohAAJAIAJBAU5BACAAIAFNGw0APwBBEHQgAEkEQCAAEABFDQELQdDfACAANgIAIAEPC0HU3wBBMDYCAEF/C4IEAQN/IAJBgARPBEAgACABIAIQARogAA8LIAAgAmohAwJAIAAgAXNBA3FFBEACQCACQQFIBEAgACECDAELIABBA3FFBEAgACECDAELIAAhAgNAIAIgAS0AADoAACABQQFqIQEgAkEBaiICIANPDQEgAkEDcQ0ACwsCQCADQXxxIgRBwABJDQAgAiAEQUBqIgVLDQADQCACIAEoAgA2AgAgAiABKAIENgIEIAIgASgCCDYCCCACIAEoAgw2AgwgAiABKAIQNgIQIAIgASgCFDYCFCACIAEoAhg2AhggAiABKAIcNgIcIAIgASgCIDYCICACIAEoAiQ2AiQgAiABKAIoNgIoIAIgASgCLDYCLCACIAEoAjA2AjAgAiABKAI0NgI0IAIgASgCODYCOCACIAEoAjw2AjwgAUFAayEBIAJBQGsiAiAFTQ0ACwsgAiAETw0BA0AgAiABKAIANgIAIAFBBGohASACQQRqIgIgBEkNAAsMAQsgA0EESQRAIAAhAgwBCyAAIANBBGsiBEsEQCAAIQIMAQsgACECA0AgAiABLQAAOgAAIAIgAS0AAToAASACIAEtAAI6AAIgAiABLQADOgADIAFBBGohASACQQRqIgIgBE0NAAsLIAIgA0kEQANAIAIgAS0AADoAACABQQFqIQEgAkEBaiICIANHDQALCyAAC9YCAQJ/AkAgAUUNACAAIAFqIgJBAWtBADoAACAAQQA6AAAgAUEDSQ0AIAJBAmtBADoAACAAQQA6AAEgAkEDa0EAOgAAIABBADoAAiABQQdJDQAgAkEEa0EAOgAAIABBADoAAyABQQlJDQAgAEEAIABrQQNxIgNqIgJBADYCACACIAEgA2tBfHEiA2oiAUEEa0EANgIAIANBCUkNACACQQA2AgggAkEANgIEIAFBCGtBADYCACABQQxrQQA2AgAgA0EZSQ0AIAJBADYCGCACQQA2AhQgAkEANgIQIAJBADYCDCABQRBrQQA2AgAgAUEUa0EANgIAIAFBGGtBADYCACABQRxrQQA2AgAgAyACQQRxQRhyIgNrIgFBIEkNACACIANqIQIDQCACQgA3AxggAkIANwMQIAJCADcDCCACQgA3AwAgAkEgaiECIAFBIGsiAUEfSw0ACwsLBAAjAAsGACAAJAALEAAjACAAa0FwcSIAJAAgAAsLvVYIAEGECAvxQJYwB3csYQ7uulEJmRnEbQeP9GpwNaVj6aOVZJ4yiNsOpLjceR7p1eCI2dKXK0y2Cb18sX4HLbjnkR2/kGQQtx3yILBqSHG5895BvoR91Noa6+TdbVG11PTHhdODVphsE8Coa2R6+WL97Mllik9cARTZbAZjYz0P+vUNCI3IIG47XhBpTORBYNVycWei0eQDPEfUBEv9hQ3Sa7UKpfqotTVsmLJC1sm720D5vKzjbNgydVzfRc8N1txZPdGrrDDZJjoA3lGAUdfIFmHQv7X0tCEjxLNWmZW6zw+lvbieuAIoCIgFX7LZDMYk6Quxh3xvLxFMaFirHWHBPS1mtpBB3HYGcdsBvCDSmCoQ1e+JhbFxH7W2BqXkv58z1LjooskHeDT5AA+OqAmWGJgO4bsNan8tPW0Il2xkkQFcY+b0UWtrYmFsHNgwZYVOAGLy7ZUGbHulARvB9AiCV8QP9cbZsGVQ6bcS6ri+i3yIufzfHd1iSS3aFfN804xlTNT7WGGyTc5RtTp0ALyj4jC71EGl30rXldg9bcTRpPv01tNq6WlD/NluNEaIZ63QuGDacy0EROUdAzNfTAqqyXwN3TxxBVCqQQInEBALvoYgDMkltWhXs4VvIAnUZrmf5GHODvneXpjJ2SkimNCwtKjXxxc9s1mBDbQuO1y9t61susAgg7jttrO/mgzitgOa0rF0OUfV6q930p0VJtsEgxbccxILY+OEO2SUPmptDahaanoLzw7knf8JkyeuAAqxngd9RJMP8NKjCIdo8gEe/sIGaV1XYvfLZ2WAcTZsGecGa252G9T+4CvTiVp62hDMSt1nb9+5+fnvvo5DvrcX1Y6wYOij1tZ+k9GhxMLYOFLy30/xZ7vRZ1e8pt0GtT9LNrJI2isN2EwbCq/2SgM2YHoEQcPvYN9V32eo745uMXm+aUaMs2HLGoNmvKDSbyU24mhSlXcMzANHC7u5FgIiLyYFVb47usUoC72yklq0KwRqs1yn/9fCMc/QtYue2Swdrt5bsMJkmybyY+yco2p1CpNtAqkGCZw/Ng7rhWcHchNXAAWCSr+VFHq44q4rsXs4G7YMm47Skg2+1eW379x8Id/bC9TS04ZC4tTx+LPdaG6D2h/NFr6BWya59uF3sG93R7cY5loIiHBqD//KOwZmXAsBEf+eZY9prmL40/9rYUXPbBZ44gqg7tIN11SDBE7CswM5YSZnp/cWYNBNR2lJ23duPkpq0a7cWtbZZgvfQPA72DdTrrypxZ673n/Pskfp/7UwHPK9vYrCusowk7NTpqO0JAU20LqTBtfNKVfeVL9n2SMuemazuEphxAIbaF2UK28qN74LtKGODMMb3wVaje8CLQAAAABBMRsZgmI2MsNTLSsExWxkRfR3fYanWlbHlkFPCIrZyEm7wtGK6O/6y9n04wxPtaxNfq61ji2Dns8cmIdREsJKECPZU9Nw9HiSQe9hVdeuLhTmtTfXtZgcloSDBVmYG4IYqQCb2/otsJrLNqldXXfmHGxs/98/QdSeDlrNoiSEleMVn4wgRrKnYXepvqbh6PHn0PPoJIPew2Wyxdqqrl1d659GRCjMa29p/XB2rmsxOe9aKiAsCQcLbTgcEvM2Rt+yB13GcVRw7TBla/T38yq7tsIxonWRHIk0oAeQ+7yfF7qNhA553qklOO+yPP9583O+SOhqfRvFQTwq3lgFT3nwRH5i6YctT8LGHFTbAYoVlEC7Do2D6COmwtk4vw3FoDhM9Lshj6eWCs6WjRMJAMxcSDHXRYti+m7KU+F3VF27uhVsoKPWP42Ilw6WkVCY194RqczH0vrh7JPL+vVc12JyHeZ5a961VECfhE9ZWBIOFhkjFQ/acDgkm0EjPadr/WXmWuZ8JQnLV2Q40E6jrpEB4p+KGCHMpzNg/bwqr+Ekre7QP7QtgxKfbLIJhqskSMnqFVPQKUZ++2h3ZeL2eT8vt0gkNnQbCR01KhIE8rxTS7ONSFJw3mV5Me9+YP7z5ue/wv3+fJHQ1T2gy8z6NoqDuweRmnhUvLE5ZaeoS5iDOwqpmCLJ+rUJiMuuEE9d718ObPRGzT/ZbYwOwnRDElrzAiNB6sFwbMGAQXfYR9c2lwbmLY7FtQClhIQbvBqKQXFbu1pomOh3Q9nZbFoeTy0VX342DJwtGyfdHAA+EgCYuVMxg6CQYq6L0VO1khbF9N1X9O/ElKfC79WW2fbpvAeuqI0ct2veMZwq7yqF7XlryqxIcNNvG134LipG4eE23magB8V/Y1ToVCJl803l87ICpMKpG2eRhDAmoJ8puK7F5Pmf3v06zPPWe/3oz7xrqYD9WrKZPgmfsn84hKuwJBws8RUHNTJGKh5zdzEHtOFwSPXQa1E2g0Z6d7JdY07X+ssP5uHSzLXM+Y2E1+BKEpavCyONtshwoJ2JQbuERl0jAwdsOBrEPxUxhQ4OKEKYT2cDqVR+wPp5VYHLYkwfxTiBXvQjmJ2nDrPclhWqGwBU5VoxT/yZYmLX2FN5zhdP4UlWfvpQlS3Xe9QczGITio0tUruWNJHoux/Q2aAG7PN+Xq3CZUdukUhsL6BTdeg2EjqpBwkjalQkCCtlPxHkeaeWpUi8j2YbkaQnKoq94LzL8qGN0Oti3v3AI+/m2b3hvBT80KcNP4OKJn6ykT+5JNBw+BXLaTtG5kJ6d/1btWtl3PRafsU3CVPudjhI97GuCbjwnxKhM8w/inL9JJMAAAAAN2rCAW7UhANZvkYC3KgJB+vCywayfI0EhRZPBbhREw6PO9EP1oWXDeHvVQxk+RoJU5PYCAotngo9R1wLcKMmHEfJ5B0ed6IfKR1gHqwLLxubYe0awt+rGPW1aRnI8jUS/5j3E6YmsRGRTHMQFFo8FSMw/hR6jrgWTeR6F+BGTTjXLI85jpLJO7n4Czo87kQ/C4SGPlI6wDxlUAI9WBdeNm99nDc2w9o1AakYNIS/VzGz1ZUw6mvTMt0BETOQ5Wskp4+pJf4x7yfJWy0mTE1iI3snoCIimeYgFfMkISi0eCof3rorRmD8KXEKPij0HHEtw3azLJrI9S6tojcvwI2acPfnWHGuWR5zmTPcchwlk3crT1F2cvEXdEWb1XV43Il+T7ZLfxYIDX0hYs98pHSAeZMeQnjKoAR6/crGe7AuvGyHRH5t3vo4b+mQ+m5shrVrW+x3agJSMWg1OPNpCH+vYj8VbWNmqythUcHpYNTXpmXjvWRkugMiZo1p4Gcgy9dIF6EVSU4fU0t5dZFK/GPeT8sJHE6St1pMpd2YTZiaxEav8AZH9k5ARcEkgkREMs1Bc1gPQCrmSUIdjItDUGjxVGcCM1U+vHVXCda3VozA+FO7qjpS4hR8UNV+vlHoOeJa31MgW4btZlmxh6RYNJHrXQP7KVxaRW9ebS+tX4AbNeG3cffg7s+x4tmlc+Ncszzma9n+5zJnuOUFDXrkOEom7w8g5O5WnqLsYfRg7eTiL+jTiO3pijar671caerwuBP9x9LR/J5sl/6pBlX/LBAa+ht62PtCxJ75da5c+EjpAPN/g8LyJj2E8BFXRvGUQQn0oyvL9fqVjffN/0/2YF142Vc3utgOifzaOeM+27z1cd6Ln7Pf0iH13eVLN9zYDGvX72ap1rbY79SBsi3VBKRi0DPOoNFqcObTXRok0hD+XsUnlJzEfiraxklAGMfMVlfC+zyVw6KC08GV6BHAqK9Ny5/Fj8rGe8nI8RELyXQHRMxDbYbNGtPAzy25As5Alq+Rd/xtkC5CK5IZKOmTnD6mlqtUZJfy6iKVxYDglPjHvJ/PrX6elhM4nKF5+p0kb7WYEwV3mUq7MZt90fOaMDWJjQdfS4xe4Q2OaYvPj+ydgIrb90KLgkkEibUjxoiIZJqDvw5YguawHoDR2tyBVMyThGOmUYU6GBeHDXLVhqDQ4qmXuiCozgRmqvlupKt8eOuuSxIprxKsb60lxq2sGIHxpy/rM6Z2VXWkQT+3pcQp+KDzQzqhqv18o52XvqLQc8S15xkGtL6nQLaJzYK3DNvNsjuxD7NiD0mxVWWLsGgi17tfSBW6BvZTuDGckbm0it68g+AcvdpeWr/tNJi+AAAAAGVnvLiLyAmq7q+1EleXYo8y8N433F9rJbk4153vKLTFik8IfWTgvW8BhwHXuL/WSt3YavIzd9/gVhBjWJ9XGVD6MKXoFJ8Q+nH4rELIwHvfrafHZ0MIcnUmb87NcH+tlRUYES37t6Q/ntAYhyfozxpCj3OirCDGsMlHegg+rzKgW8iOGLVnOwrQAIeyaThQLwxf7Jfi8FmFh5flPdGHhmW04DrdWk+Pzz8oM3eGEOTq43dYUg3Y7UBov1H4ofgr8MSfl0gqMCJaT1ee4vZvSX+TCPXHfadA1RjA/G1O0J81K7cjjcUYlp+gfyonGUf9unwgQQKSj/QQ9+hIqD1YFJtYP6gjtpAdMdP3oYlqz3YUD6jKrOEHf76EYMMG0nCgXrcXHOZZuKn0PN8VTIXnwtHggH5pDi/Le2tId8OiDw3Lx2ixcynHBGFMoLjZ9ZhvRJD/0/x+UGbuGzfaVk0nuQ4oQAW2xu+wpKOIDBwasNuBf9dnOZF40iv0H26TA/cmO2aQmoOIPy+R7ViTKVRgRLQxB/gM36hNHrrP8abs35L+ibguRmcXm1QCcCfsu0jwcd4vTMkwgPnbVedFY5ygP2v5x4PTF2g2wXIPinnLN13krlDhXED/VE4lmOj2c4iLrhbvNxb4QIIEnSc+vCQf6SFBeFWZr9fgi8qwXDM7tlntXtHlVbB+UEfVGez/bCE7YglGh9rn6TLIgo6OcNSe7Six+VGQX1bkgjoxWDqDCY+n5m4zHwjBhg1tpjq1pOFAvcGG/AUvKUkXSk71r/N2IjKWEZ6KeL4rmB3ZlyBLyfR4Lq5IwMAB/dKlZkFqHF6W93k5Kk+Xlp9d8vEj5QUZa01gftf1jtFi5+u23l9SjgnCN+m1etlGAGi8IbzQ6jHfiI9WYzBh+dYiBJ5qmr2mvQfYwQG/Nm60rVMJCBWaTnId/ynOpRGGe7d04ccPzdkQkqi+rCpGERk4I3algHVmxtgQAXpg/q7PcpvJc8oi8aRXR5YY76k5rf3MXhFFBu5NdmOJ8c6NJkTc6EH4ZFF5L/k0HpNB2rEmU7/WmuvpxvmzjKFFC2IO8BkHaUyhvlGbPNs2J4Q1mZKWUP4uLpm5VCb83uieEnFdjHcW4TTOLjapq0mKEUXmPwMggYO7dpHg4xP2XFv9WelJmD5V8SEGgmxEYT7Uqs6Lxs+pN344QX/WXSbDbrOJdnzW7srEb9YdWQqxoeHkHhTzgXmoS9dpyxOyDnerXKHCuTnGfgGA/qmc5ZkVJAs2oDZuURyOpxZmhsJx2j4s3m8sSbnTlPCBBAmV5rixe0kNox4usRtIPtJDLVlu+8P22+mmkWdRH6mwzHrODHSUYblm8QYF3gAAAAB3BzCW7g5hLJkJUboHbcQZcGr0j+ljpTWeZJWjDtuIMnncuKTg1ekel9LZiAm2TCt+sXy957gtB5C/HZEdtxBkarAg8vO5cUiEvkHeGtrUfW3d5Ov01LVRg9OFxxNsmFZka6jA/WL5eoplyewUAVxPYwZs2foPPWONCA31O24gyExpEF7VYEHkomdxcjwD5NFLBNRH0g2F/aUKtWs1taj6QrKYbNu7ydasvPlAMths40XfXHXc1g3Pq9E9WSbZMKxR3gA6yNdRgL/QYRYhtPS1VrPEI8+6lZm4vaUPKAK4nl8FiAjGDNmysQvpJC9vfIdYaEwRwWEdq7ZmLT123EGQAdtxBpjSILzv1RAqcbGFiQa2tR+fv+Sl6LjUM3gHyaIPAPk0lgmojuEOmBh/ag27CG09LZFkbJfmY1wBa2tR9BxsYWKFZTDY8mIATmwGle0bAaV7ggj0wfUPxFdlsNnGErfpUIu+uOr8uYh8Yt0d3xXaLUmM03zz+9RMZU2yYVg6tVHOo7wAdNS7MOJK36VBPdiV16TRxG3T1vT7Q2npajRu2fytZ4hG2mC40EQELXMzAx3lqgpMX90NfMlQBXE8JwJBqr4LEBDJDCCGV2i1JSBvhbO5ZtQJzmHkn17e+Q4p2cmYsNCYIsfXqLRZsz0XLrQNgbe9XDvAumyt7biDIJq/s7YDtuIMdLHSmurVRzmd0nevBNsmFXPcFoPjYwsSlGQ7hA1taj56alqo5A7PC5MJ/50KAK4nfQeesfAPk0SHCKPSHgHyaGkGwv73YlddgGVnyxlsNnFuawbn/tQbdonTK+AQ2npaZ91KzPm532+Ovu/5F7e+Q2CwjtXW1qPoodGTfjjYwsRP3/JS0btn8aa8V2c/tQbdSLI2S9gNK9qvChtMNgNK9kEEemDfYO/DqGffVTFuju9Gab55y2GzjLxmgxolb9KgUmjiNswMd5W7C0cDIgIWuVUFJi/Fuju+sr0LKCu0WpJcs2oEwtf/p7XQzzEs2Z6LW96uHZtkwrDsY/ImdWqjnAJtkwqcCQap6w42P3IHZ4UFAFcTlb9KguK4ehR7sSuuDLYbOJLSjpvl1b4NfNzvtwvb3yGG09LU8dTiQmjds/gf2oNugb4Wzfa5JltvsHfhGLdHd4gIWub/D2pwZgY7yhEBC1yPZZ7/+GKuaWFr/9MWbM9FoArieNcN0u5OBINUOQOzwqdnJmHQYBb3SWlHTT5ud9uu0WpK2dZa3EDfC2Y32DvwqbyuU967nsVHss9/MLX/6b298hzKusKKU7OTMCS0o6a60DYFzdcGk1TeVykj2We/s2Z6LsRhSrhdaBsCKm8rlLQLvjfDDI6hWgXfGy0C740AAAAAGRsxQTI2YoIrLVPDZGzFBH139EVWWqeGT0GWx8jZigjRwrtJ+u/oiuP02custU8Mta5+TZ6DLY6HmBzPSsISUVPZIxB49HDTYe9Bki6u11U3teYUHJi11wWDhJaCG5hZmwCpGLAt+tupNsua5nddXf9sbBzUQT/fzVoOnpWEJKKMnxXjp7JGIL6pd2Hx6OGm6PPQ58PegyTaxbJlXV2uqkRGn+tva8wodnD9aTkxa64gKlrvCwcJLBIcOG3fRjbzxl0Hsu1wVHH0a2Uwuyrz96IxwraJHJF1kAegNBefvPsOhI26JaneeTyy7zhz83n/auhIvkHFG31Y3io88HlPBelifkTCTy2H21QcxpQVigGNDrtApiPog7842cI4oMUNIbv0TAqWp48TjZbOXMwACUXXMUhu+mKLd+FTyrq7XVSjoGwViI0/1pGWDpfe15hQx8ypEezh+tL1+suTcmLXXGt55h1AVLXeWU+EnxYOElgPFSMZJDhw2j0jQZtl/WunfOZa5lfLCSVO0DhkAZGuoxiKn+Izp8whKrz9YK0k4a+0P9DunxKDLYYJsmzJSCSr0FMV6vt+RiniZXdoLz959jYkSLcdCRt0BBIqNUtTvPJSSI2zeWXecGB+7zHn5vP+/v3Cv9XQkXzMy6A9g4o2+pqRB7uxvFR4qKdlOTuDmEsimKkKCbX6yRCuy4hf711PRvRsDm3ZP810wg6M81oSQ+pBIwLBbHDB2HdBgJc210eOLeYGpQC1xbwbhIRxQYoaaFq7W0N36JhabNnZFS1PHgw2fl8nGy2cPgAc3bmYABKggzFTi65ikJK1U9Hd9MUWxO/0V+/Cp5T22ZbVrge86bccjaicMd5rhSrvKspree3TcEis+F0bb+FGKi5m3jbhf8UHoFToVGNN82UiArLz5RupwqQwhJFnKZ+gJuTFrrj93p/51vPMOs/o/XuAqWu8mbJa/bKfCT6rhDh/LBwksDUHFfEeKkYyBzF3c0hw4bRRa9D1ekaDNmNdsnfL+tdO0uHmD/nMtczg14SNr5YSSraNIwudoHDIhLtBiQMjXUYaOGwHMRU/xCgODoVnT5hCflSpA1V5+sBMYsuBgTjFH5gj9F6zDqedqhWW3OVUABv8TzFa12Jimc55U9hJ4U8XUPp+VnvXLZVizBzULY2KEzSWu1Ifu+iRBqDZ0F5+8+xHZcKtbEiRbnVToC86EjboIwkHqQgkVGoRP2Urlqd55I+8SKWkkRtmvYoqJ/LLvODr0I2hwP3eYtnm7yMUvOG9DafQ/CaKgz8/kbJ+cNAkuWnLFfhC5kY7W/13etxla7XFflr07lMJN/dIOHa4Ca6xoRKf8Io/zDOTJP1yAAAAAAHCajcDhNRuAka+WQcJqNwGy8LrBI18sgVPFoUOE1G4D9E7jw2XhdYMVe/hCRr5ZAjYk1MKni0KC1xHPRwmo3Ad5MlHH6J3Hh5gHSkbLwusGu1hmxir38IZabX1EjXyyBP3mP8RsSamEHNMkRU8WhQU/jAjFriOehd65E04TUbgOY8s1zvJko46C/i5P0TuPD6GhAs8wDpSPQJQZTZeF1g3nH1vNdrDNjQYqQExV7+EMJXVszLTa+ozEQHdJGvlkCWpj6cn7zH+Ji1bySNiTUwioCd7IOaZIiEk8xUqeLQoK7reHyn8YEYoPgpxLXEc9CyzdsMu9ciaLzeirXCajcBxWOf3cx5ZrnLcM5l3kyUcdlFPK3QX8XJ11ZtFfonceH9Ltk99DQgWfM9iIXmAdKR4Qh6TegSgynvGyv1svC6wbX5Eh284+t5u+pDpa7WGbGp37FtoMVICafM4NWKvfwhjbRU/YSurZmDpwVFlptfUZGS942YiA7pn4GmNSNfLIEkVoRdLUx9OSpF1eU/eY/xOHAnLTFq3kk2Y3aVGxJqYRwbwr0VATvZEgiTBQc0yREAPWHNCSeYqQ4uMHVTxaFBVMwJnV3W8Pla31glT+MCMUjqqu1B8FOJRvn7VWuI56FsgU99ZZu2GWKSHsV3rkTRcKfsDXm9FWl+tL23hNRuA4Pdxt+Kxz+7jc6XZ5jyzXOf+2WvluGcy5HoNBe8mSjju5CAP7KKeVu1g9GHoL+Lk6e2I0+urNorqaVy9/RO48PzR0sf+l2ye/1UGqfoaECz72Hob+Z7EQvhcrnXzAOlI8sKDf/CEPSbxRlcR9AlBlPXLK6P3jZX69k//zdl4XWDYujdX2vyJDts+4znecfW837Ofi931IdLcN0vl12sM2NapZu/U79i21S2ygdBipATRoM4z0+ZwatIkGl3FXv4QxJyUJ8baKn7HGEBJwldWzMOVPPvB04KiwBHolctNr6jKj8WfyMl7xskLEfHMRAd0zYZtQ8/A0xrOArktka+WQJBt/HeSK0Iuk+koGZamPpyXZFSrlSLq8pTggMWfvMf4nn6tz5w4E5ad+nmhmLVvJJl3BRObMbtKmvPRfY2JNTCMS18Hjg3hXo/Pi2mKgJ3si0L324kESYKIxiO1g5pkiIJYDr+AHrDmgdza0YSTzFSFUaZjhxcYOobVcg2p4tCgqCC6l6pmBM6rpG75rut4fK8pEkutb6wSrK3GJafxgRimM+svpHVVdqW3P0Gg+CnEoTpD86N8/aqivpedtcRz0LQGGee2QKe+t4LNibLN2wyzD7E7sUkPYrCLZVW71yJouhVIX7hT9ga5kZwxvN6KtL0c4IO/Wl7avpg07QAAAAC4vGdlqgnIixK1r+6PYpdXN97wMiVrX9yd1zi5xbQo730IT4pvveBk1wGHAUrWv7jyatjd4N93M1hjEFZQGVef6KUw+voQnxRCrPhx33vAyGfHp611cghDzc5vJpWtf3AtERgVP6S3+4cY0J4az+gnonOPQrDGIKwIekfJoDKvPhiOyFsKO2e1socA0C9QOGmX7F8MhVnw4j3ll4dlhofR3TrgtM+PT1p3Myg/6uQQhlJYd+NA7dgN+FG/aPAr+KFIl5/EWiIwKuKeV09/SW/2x/UIk9VAp31t/MAYNZ/QTo0jtyuflhjFJyp/oLr9RxkCQSB8EPSPkqhI6PebFFg9I6g/WDEdkLaJoffTFHbPaqzKqA++fwfhBsNghF6gcNLmHBe39Km4WUwV3zzRwueFaX6A4HvLLw7Dd0hryw0PonOxaMdhBMcp2bigTERvmPX80/+Q7mZQflbaNxsOuSdNtgVAKKSw78YcDIijgduwGjln138r0niRk24f9Dsm9wODmpBmkS8/iCmTWO20RGBUDPgHMR5NqN+m8c+6/pLf7EYuuIlUmxdn7CdwAnHwSLvJTC/e2/mAMGNF51VrP6Cc04PH+cE2aBd5ig9y5F03y1zhUK5OVP9A9uiYJa6LiHMWN+8WBIJA+Lw+J50h6R8kmVV4QYvg168zXLDK7Vm2O1Xl0V5HUH6w/+wZ1WI7IWzah0YJyDLp53COjoIo7Z7UkFH5sYLkVl86WDE6p48Jgx8zbuYNhsEItTqmbb1A4aQF/IbBF0kpL6/1TkoyInbzip4Rlpgrvnggl9kdePTJS8BIri7S/QHAakFmpfeWXhxPKjl5XZ+Wl+Uj8fJNaxkF9dd+YOdi0Y5f3rbrwgmOUnq16TdoAEbZ0LwhvIjfMeowY1aPItb5YZpqngQHvaa9vwHB2K20bjYVCAlTHXJOmqXOKf+3e4YRD8fhdJIQ2c0qrL6oOBkRRoCldiPYxmZ1YHoBEHLPrv7Kc8mbV6TxIu8Ylkf9rTmpRRFezHZN7gbO8Ylj3EQmjWT4Qej5L3lRQZMeNFMmsdrrmta/s/nG6QtFoYwZ8A5ioUxpBzybUb6EJzbblpKZNS4u/lAmVLmZnuje/IxdcRI04RZ3qTYuzhGKSasDP+ZFu4OBIOPgkXZbXPYTSelZ/fFVPphsggYh1D5hRMaLzqp+N6nP1n9BOG7DJl18domzxMru1lkd1m/hobEK8xQe5EuoeYETy2nXq3cOsrnCoVwBfsY5nKn+gCQVmeU2oDYLjhxRboZmFqc+2nHCLG/eLJTTuUkJBIHwsbjmlaMNSXsbsS4eQ9I+SPtuWS3p2/bDUWeRpsywqR90DM56ZrlhlN4FBvEAAAAAAAAAAAMAAAAEAAQACAAEAAQAAAAEAAUAEAAIAAQAAAAEAAYAIAAgAAQAAAAEAAQAEAAQAAUAAAAIABAAIAAgAAUAAAAIABAAgACAAAUAAAAIACAAgAAAAQUAAAAgAIAAAgEABAUAAAAgAAIBAgEAEAUAQYHJAAu2EAECAwQEBQUGBgYGBwcHBwgICAgICAgICQkJCQkJCQkKCgoKCgoKCgoKCgoKCgoKCwsLCwsLCwsLCwsLCwsLCwwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDwAAEBESEhMTFBQUFBUVFRUWFhYWFhYWFhcXFxcXFxcXGBgYGBgYGBgYGBgYGBgYGBkZGRkZGRkZGRkZGRkZGRkaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHB0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0AAQIDBAUGBwgICQkKCgsLDAwMDA0NDQ0ODg4ODw8PDxAQEBAQEBAQERERERERERESEhISEhISEhMTExMTExMTFBQUFBQUFBQUFBQUFBQUFBUVFRUVFRUVFRUVFRUVFRUWFhYWFhYWFhYWFhYWFhYWFxcXFxcXFxcXFxcXFxcXFxgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxscwCcAAMAsAAABAQAAHgEAAA8AAABALAAAQC0AAAAAAAAeAAAADwAAAAAAAADALQAAAAAAABMAAAAHAAAAAAAAAAwACACMAAgATAAIAMwACAAsAAgArAAIAGwACADsAAgAHAAIAJwACABcAAgA3AAIADwACAC8AAgAfAAIAPwACAACAAgAggAIAEIACADCAAgAIgAIAKIACABiAAgA4gAIABIACACSAAgAUgAIANIACAAyAAgAsgAIAHIACADyAAgACgAIAIoACABKAAgAygAIACoACACqAAgAagAIAOoACAAaAAgAmgAIAFoACADaAAgAOgAIALoACAB6AAgA+gAIAAYACACGAAgARgAIAMYACAAmAAgApgAIAGYACADmAAgAFgAIAJYACABWAAgA1gAIADYACAC2AAgAdgAIAPYACAAOAAgAjgAIAE4ACADOAAgALgAIAK4ACABuAAgA7gAIAB4ACACeAAgAXgAIAN4ACAA+AAgAvgAIAH4ACAD+AAgAAQAIAIEACABBAAgAwQAIACEACAChAAgAYQAIAOEACAARAAgAkQAIAFEACADRAAgAMQAIALEACABxAAgA8QAIAAkACACJAAgASQAIAMkACAApAAgAqQAIAGkACADpAAgAGQAIAJkACABZAAgA2QAIADkACAC5AAgAeQAIAPkACAAFAAgAhQAIAEUACADFAAgAJQAIAKUACABlAAgA5QAIABUACACVAAgAVQAIANUACAA1AAgAtQAIAHUACAD1AAgADQAIAI0ACABNAAgAzQAIAC0ACACtAAgAbQAIAO0ACAAdAAgAnQAIAF0ACADdAAgAPQAIAL0ACAB9AAgA/QAIABMACQATAQkAkwAJAJMBCQBTAAkAUwEJANMACQDTAQkAMwAJADMBCQCzAAkAswEJAHMACQBzAQkA8wAJAPMBCQALAAkACwEJAIsACQCLAQkASwAJAEsBCQDLAAkAywEJACsACQArAQkAqwAJAKsBCQBrAAkAawEJAOsACQDrAQkAGwAJABsBCQCbAAkAmwEJAFsACQBbAQkA2wAJANsBCQA7AAkAOwEJALsACQC7AQkAewAJAHsBCQD7AAkA+wEJAAcACQAHAQkAhwAJAIcBCQBHAAkARwEJAMcACQDHAQkAJwAJACcBCQCnAAkApwEJAGcACQBnAQkA5wAJAOcBCQAXAAkAFwEJAJcACQCXAQkAVwAJAFcBCQDXAAkA1wEJADcACQA3AQkAtwAJALcBCQB3AAkAdwEJAPcACQD3AQkADwAJAA8BCQCPAAkAjwEJAE8ACQBPAQkAzwAJAM8BCQAvAAkALwEJAK8ACQCvAQkAbwAJAG8BCQDvAAkA7wEJAB8ACQAfAQkAnwAJAJ8BCQBfAAkAXwEJAN8ACQDfAQkAPwAJAD8BCQC/AAkAvwEJAH8ACQB/AQkA/wAJAP8BCQAAAAcAQAAHACAABwBgAAcAEAAHAFAABwAwAAcAcAAHAAgABwBIAAcAKAAHAGgABwAYAAcAWAAHADgABwB4AAcABAAHAEQABwAkAAcAZAAHABQABwBUAAcANAAHAHQABwADAAgAgwAIAEMACADDAAgAIwAIAKMACABjAAgA4wAIAAAABQAQAAUACAAFABgABQAEAAUAFAAFAAwABQAcAAUAAgAFABIABQAKAAUAGgAFAAYABQAWAAUADgAFAB4ABQABAAUAEQAFAAkABQAZAAUABQAFABUABQANAAUAHQAFAAMABQATAAUACwAFABsABQAHAAUAFwAFAEHg2QALTQEAAAABAAAAAQAAAAEAAAACAAAAAgAAAAIAAAACAAAAAwAAAAMAAAADAAAAAwAAAAQAAAAEAAAABAAAAAQAAAAFAAAABQAAAAUAAAAFAEHQ2gALZQEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAUAAAAGAAAABgAAAAcAAAAHAAAACAAAAAgAAAAJAAAACQAAAAoAAAAKAAAACwAAAAsAAAAMAAAADAAAAA0AAAANAEGA3AALIwIAAAADAAAABwAAAAAAAAAQERIACAcJBgoFCwQMAw0CDgEPAEG03AALaQEAAAACAAAAAwAAAAQAAAAFAAAABgAAAAcAAAAIAAAACgAAAAwAAAAOAAAAEAAAABQAAAAYAAAAHAAAACAAAAAoAAAAMAAAADgAAABAAAAAUAAAAGAAAABwAAAAgAAAAKAAAADAAAAA4ABBtN0AC5oCAQAAAAIAAAADAAAABAAAAAYAAAAIAAAADAAAABAAAAAYAAAAIAAAADAAAABAAAAAYAAAAIAAAADAAAAAAAEAAIABAAAAAgAAAAMAAAAEAAAABgAAAAgAAAAMAAAAEAAAABgAAAAgAAAAMAAAAEAAAABgAABuZWVkIGRpY3Rpb25hcnkAc3RyZWFtIGVuZAAAZmlsZSBlcnJvcgBzdHJlYW0gZXJyb3IAZGF0YSBlcnJvcgBpbnN1ZmZpY2llbnQgbWVtb3J5AGJ1ZmZlciBlcnJvcgBpbmNvbXBhdGlibGUgdmVyc2lvbgAAAAAoLwAAOC8AAEMvAABELwAATy8AAFwvAABnLwAAey8AAIgvAABDLwAAMS4yLjExAEHQ3wALA9AxUA=="),$p,Jo,O1=Uint8Array.BYTES_PER_ELEMENT,ew={bytesReceived:"br",frameDropped:"fd",frameReceived:"fr",googJitterReceived:"jr",isAudioMute:"am",isFreeze:"fz",mediaType:"mt",packetsLost:"pl",packetsReceived:"pr",peerId:"pid",id:"id",ssrc:"ssrc",timestamp:"ts",type:"tp",frameRateInput:"fi",frameRateSent:"fs",googRtt:"rt",isVideoMute:"vm"},tw={stats:"sts",state:"st",stream_id:"stid",session_id:"seid",stream_type:"stt",app_id:"aid",channel_key:"ck",channel_name:"cn",sdk_version:"sv",browser:"b",process_id:"pcid",mode:"m",codec:"c",role:"r",has_changed_gateway:"hcg",ap_response:"ar",extends:"es",details:"d",features:"ft",p2p_id:"ppid",sdp:"sdp",audio:"a",video:"v",attributes:"at",hq:"h",lq:"l",stereo:"str",speech:"spe",extend:"e",pingpongElapse:"ppe"},rw={_message:"m",_type:"t",_id:"id"},nw={join_v2:"j2",publish:"pub",publish_related_stats:"prs",ping:"pi",traffic_stats:"ts",ping_back:"pib",publish_stats:"pubs"},Zp;class iw{constructor(){}async init(){Zp||(Zp=(await(async()=>(Jo||(Jo=await KS()),{zlibCompress:n=>{var s,c=new Uint8Array(n);const u=O1*c.byteLength;n=Jo._malloc(u);const h=Jo._malloc(3*u);for(let p=0;p<u;p++)Jo.HEAP8[n/O1+p]=c[p];return c=Jo._zlibCompress(n,u,h),c=new Uint8Array(Ur(s=Jo.HEAP8).call(s,h,h+c)),Jo._free(n),Jo._free(h),c}}))()).zlibCompress),this.zlibCompress=Zp}msgPackCompress(n){return VR.encode(n)}compress(n){let s=le(),c=this.compressKeyAndValue(JSON.parse(pe(n))),u=this.msgPackCompress(c);var h=this.zlibCompress(u);return h=new Uint8Array([49,49,49,50,...io(h)]),{origin:sn({},n),originLength:pe(n).length,shortKeyAndValue:c,msgpackSer:u,compressed:h,compressedLength:h.length,time:le()-s}}compressKeyAndValue(n){return this._ObjectKeyCompress(this._typeCompress(n))}_typeCompress(n){let s=n._type;return s&&(n._type=nw[s]||s),n}_ObjectKeyCompress(n){let s=n._message;if(s){let c=s.stats;c&&(s.stats=this._statsCompress(c)),n._message=this._messageCompress(s)}return this._reportCompress(n)}_statsCompress(n){return this._keyCompress(n,ew)}_messageCompress(n){return this._keyCompress(n,tw)}_reportCompress(n){return this._keyCompress(n,rw)}_keyCompress(n,s){let c={},u=ut(n);return ju(u).call(u,(h,p)=>(h=n[p],s[p]?c[s[p]]=h:c[p]=h,c),c),c}}class ow extends $r{constructor(n){super();this.lowPriorityQueue=[],this.highPriorityQueue=[],this.AgoraWebSocketManager=n}get queue(){return[...this.highPriorityQueue,...this.lowPriorityQueue]}reset(){this.lowPriorityQueue=[],this.highPriorityQueue=[]}pushMessage(n,s=!1){s?this.highPriorityQueue.push(n):this.lowPriorityQueue.push(n),this.sendMessage()}sendMessage(){let n=this.queue.length;pi(()=>{this._sendMessage()},5>n?15*n:60+3*(n-4))}_sendMessage(){var n;if(this.queue.length){var s=this.AgoraWebSocketManager.getConnection();if(s&&s.readyState===1){var c=this.queue.shift();return gt(n=this.lowPriorityQueue).call(n,c)?this.lowPriorityQueue.shift():this.highPriorityQueue.shift(),s.send(c.compressed),c}}}}class eA extends $r{constructor(n,s,c=!1){super();this.currentURLIndex=this.connectionID=0,this.reconnectMode="tryNext",this._state="closed",this.reconnectCount=0,this.isCompressorInitSuccess=!1,this.wsDeflateLength=this.wsInflateLength=0,this.name=n,this.retryConfig=s,this.useCompress=c}get url(){return this.websocket?this.websocket.url:null}get state(){return this._state}set state(n){n!==this._state&&(this._state=n,this._state==="reconnecting"?this.emit(ct.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(ct.CONNECTED):this._state==="closed"?this.emit(ct.CLOSED):this._state==="failed"&&this.emit(ct.FAILED))}getConnection(){return this.websocket||void 0}init(n){let s=(c,u)=>{this.urls=n;const h=this.urls[this.currentURLIndex];this.state="connecting",this.messageSender=new ow(this),this.createWebSocketConnection(h).then(c).catch(u),this.once(ct.CLOSED,()=>u(new L(D.WS_DISCONNECT))),this.once(ct.CONNECTED,()=>c())};return new se((c,u)=>{this.compressor=new iw,this.compressor.init().then(()=>{var h;R.debug("websocket compressor initialized successfully"),this.isCompressorInitSuccess=!0,this.compress=hr(h=this.compressor.compress).call(h,this.compressor),s(c,u)}).catch(()=>{R.debug("websocket compressor failed to initialize"),s(c,u)})})}close(n,s){if(this.currentURLIndex=0,this.reconnectCount=0,this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;let c=this.websocket;s?pi(()=>c.close(),500):c.close(),this.websocket=void 0}this.state=n?"failed":"closed"}reconnect(n,s){if(!this.websocket)return void R.warning("[".concat(this.name,"] can not reconnect, no websocket"));n!==void 0&&(this.reconnectMode=n),R.debug("[".concat(this.name,"] reconnect is triggered initiative")),n=this.websocket.onclose,this.websocket.onclose=null,this.websocket.close(),n&&hr(n).call(n,this.websocket)({code:9999,reason:s})}sendMessage(n,s=!1){if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new L(D.WS_ABORT,"websocket is not ready");try{let c=null;if(this.isCompressorInitSuccess&&this.useCompress&&re.WEBSOCKET_COMPRESS)c=this.compress(n),this.setWsInflateData(c);else{if(this.isCompressorInitSuccess&&this.useCompress){let h=this.compress(n);this.setWsInflateData(h)}let u=pe(n);c={compressed:u,compressedLength:u.length,origin:n}}s?this.websocket.send(c.compressed):this.messageSender.pushMessage(c)}catch(c){throw new L(D.WS_ERR,"send websocket message error"+c.toString())}}setWsInflateData(n){this.wsDeflateLength+=n.originLength,this.wsInflateLength+=n.compressedLength}getWsInflateData(){let n=this.wsInflateLength,s=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:n,wsDeflateLength:s}}clearWsInflateData(){this.wsDeflateLength=this.wsInflateLength=0}async createWebSocketConnection(n){let s=this.connectionID+=1;return new se((c,u)=>{var h,p;this.websocket&&(this.websocket.onclose=null,this.websocket.close()),re.GATEWAY_WSS_ADDRESS&&ol(h=this.name).call(h,"gateway")&&(n=re.GATEWAY_WSS_ADDRESS),R.debug(b(p="[".concat(this.name,"] start connect, url: ")).call(p,n));try{this.websocket=new WebSocket(n),this.websocket.binaryType="arraybuffer"}catch(m){var f;return h=new L(D.WS_ERR,"init websocket failed! Error: ".concat(m.toString())),R.error(b(f="[".concat(this.name,"]")).call(f,h)),void u(h)}Mn(5e3).then(()=>{s===this.connectionID&&this.websocket&&this.websocket.readyState!==WebSocket.OPEN&&this.websocket&&this.websocket.close()}),this.websocket.onopen=()=>{R.debug("[".concat(this.name,"] websocket opened:"),n),this.reconnectMode="retry",this.state="connected",this.reconnectCount=0,c()},this.websocket.onclose=async m=>{var I,E,_,S;if(R.debug(b(I=b(E=b(_=b(S="[".concat(this.name,"] websocket close ")).call(S,this.websocket&&this.websocket.url,", code: ")).call(_,m.code,", reason: ")).call(E,m.reason,", current mode: ")).call(I,this.reconnectMode)),this.reconnectCount<this.retryConfig.maxRetryCount){if(this.state==="connected"&&(this.reconnectReason=m.reason,this.state="reconnecting"),I=Gs(this,ct.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,I=await this.reconnectWithAction(I),this.state==="closed")return void R.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!I)return u(new L(D.WS_DISCONNECT,"websocket reconnect failed: ".concat(m.code))),void this.close(!0);c()}else u(new L(D.WS_DISCONNECT,"websocket close: ".concat(m.code))),this.close()},this.websocket.onmessage=m=>{this.emit(ct.ON_MESSAGE,m)}})}async reconnectWithAction(n,s){var c,u;if(!s&&this.reconnectCount>=this.retryConfig.maxRetryCount||!this.urls||this.state==="closed"||(this.onlineReconnectListener||ei.networkState!==Ui.OFFLINE||(this.onlineReconnectListener=ei.onlineWaiter&&ei.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0})),s=function(f,m){return Math.min(m.maxRetryTimeout,m.timeout*Math.pow(m.timeoutFactor,f))}(this.reconnectCount,this.retryConfig),R.debug(b(c=b(u="[".concat(this.name,"] wait ")).call(u,s,"ms to reconnect websocket, mode: ")).call(c,n)),await se.race([Mn(s),this.onlineReconnectListener||new se(()=>{})]),this.state==="closed"))return!1;this.reconnectCount+=1;try{if(n==="retry")await this.createWebSocketConnection(this.urls[this.currentURLIndex]);else if(n==="tryNext"){var h,p;if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return await this.reconnectWithAction("recover");R.debug(b(h=b(p="[".concat(this.name,"] websocket url length: ")).call(p,this.urls.length," current index: ")).call(h,this.currentURLIndex)),await this.createWebSocketConnection(this.urls[this.currentURLIndex])}else n==="recover"&&(R.debug("[".concat(this.name,"] request new urls")),this.urls=await Or(this,ct.REQUEST_NEW_URLS),this.currentURLIndex=0,await this.createWebSocketConnection(this.urls[this.currentURLIndex]));return!0}catch(f){return R.error("[".concat(this.name,"] reconnect failed"),f.toString()),await this.reconnectWithAction(n)}}}class sw{constructor(n){this.input=[],this.size=n}add(n){var s;this.input.push(n),this.input.length>this.size&&qr(s=this.input).call(s,0,1)}mean(){var n;return this.input.length===0?0:ju(n=this.input).call(n,(s,c)=>s+c)/this.input.length}}class aw extends $r{constructor(n){super();this._connectionState=vr.CLOSED,this.openConnectionTime=le(),this.lastMsgTime=le(),this.uploadCache=[],this.rttRolling=new sw(5),this.pingpongTimeoutCount=0,this.onWebsocketMessage=s=>{if(s.data instanceof ArrayBuffer)return void this.emit($e.ON_BINARY_DATA,s.data);if(s=JSON.parse(s.data),this.lastMsgTime=le(),Object.prototype.hasOwnProperty.call(s,"_id")){let c="res-@".concat(s._id);this.emit(c,s._result,s._message)}else if(Object.prototype.hasOwnProperty.call(s,"_type")&&(this.emit(s._type,s._message),s._type===mt.ON_NOTIFICATION&&this.handleNotification(s._message),s._type===mt.ON_USER_BANNED))switch(s._message.error_code){case 14:this.close("UID_BANNED");break;case 15:this.close("IP_BANNED");break;case 16:this.close("CHANNEL_BANNED")}},this.clientId=n.clientId,this.spec=n,this.websocket=new eA("gateway-".concat(this.clientId),this.spec.retryConfig,!0),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===vr.CONNECTED&&this.reconnect("retry",Pn.OFFLINE)})}get connectionState(){return this._connectionState}set connectionState(n){n!==this._connectionState&&(this._connectionState=n,n===vr.CONNECTED?this.emit($e.WS_CONNECTED):n===vr.RECONNECTING?this.emit($e.WS_RECONNECTING,this._websocketReconnectReason):n===vr.CLOSED&&this.emit($e.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}async request(n,s,c,u){var h,p,f,m,I;let E=rr(6,"");var _={_id:E,_type:n,_message:s};let S=this.websocket.connectionID;var N=()=>new se((O,B)=>{if(this.connectionState===vr.CONNECTED)return O();const Q=()=>{this.off($e.WS_CLOSED,q),O()},q=()=>{this.off($e.WS_CONNECTED,Q),B(new L(D.WS_ABORT))};this.once($e.WS_CONNECTED,Q),this.once($e.WS_CLOSED,q)});if(this.connectionState!==vr.CONNECTING&&this.connectionState!==vr.RECONNECTING||n===wt.JOIN||n===wt.REJOIN||await N(),this.websocket.sendMessage(_,!0),!u){_=new se((O,B)=>{let Q=!1;const q=(Ae,Be)=>{Q=!0,O({isSuccess:Ae==="success",message:Be||{}}),this.off($e.WS_CLOSED,ie),this.off($e.WS_RECONNECTING,ie),this.emit($e.REQUEST_SUCCESS,n,s)};this.once("res-@".concat(E),q);const ie=()=>{B(new L(D.WS_ABORT,"type: ".concat(n))),this.off($e.WS_CLOSED,ie),this.off($e.WS_RECONNECTING,ie),this.off("res-@".concat(E),q)};this.once($e.WS_CLOSED,ie),this.once($e.WS_RECONNECTING,ie),Mn(re.SIGNAL_REQUEST_TIMEOUT).then(()=>{this.websocket.connectionID!==S||Q||(R.warning("ws request timeout, type: ".concat(n)),this.emit($e.REQUEST_TIMEOUT,n,s))})}),u=null;try{u=await _}catch(O){if(this.connectionState===vr.CLOSED||n===wt.LEAVE)throw new L(D.WS_ABORT);return!this.spec.forceWaitGatewayResponse||c?O.throw():n===wt.JOIN||n===wt.REJOIN?null:(await N(),await this.request(n,s))}return u.isSuccess?u.message:(c=Number(u.message.error_code||u.message.code),N=hm(c),_=new L(D.UNEXPECTED_RESPONSE,b(h="".concat(N.desc,": ")).call(h,u.message.error_str),{code:c,data:u.message}),N.action==="success"?u.message:(R.warning(b(p=b(f=b(m=b(I="[".concat(this.websocket.connectionID,"] unexpected response from type ")).call(I,n,", error_code: ")).call(m,c,", message: ")).call(f,N.desc,", action: ")).call(p,N.action)),N.action==="failed"?_.throw():N.action==="quit"?(this.initError=_,this.close(),_.throw()):(c===Ne.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=u.message.option,R.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Pn.MULTI_IP)):this.reconnect(N.action,Pn.SERVER_ERROR),n===wt.JOIN||n===wt.REJOIN?null:await this.request(n,s))))}}waitMessage(n,s){return new se(c=>{let u=h=>{s&&!s(h)||(this.off(n,u),c(h))};this.on(n,u)})}upload(n,s){n={_type:n,_message:s};try{this.websocket.sendMessage(n)}catch{s=re.MAX_UPLOAD_CACHE||50;var c;this.uploadCache.push(n),this.uploadCache.length>s&&qr(c=this.uploadCache).call(c,0,1),0<this.uploadCache.length&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{var h;if(this.connectionState===vr.CONNECTED){var p=qr(h=this.uploadCache).call(h,0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(p._type,p._message)}},re.UPLOAD_CACHE_INTERVAL||2e3))}}send(n,s){this.websocket.sendMessage({_type:n,_message:s})}init(n){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,new se((s,c)=>{this.once($e.WS_CONNECTED,()=>s(this.joinResponse)),this.once($e.WS_CLOSED,()=>c(this.initError||new L(D.WS_ABORT))),this.connectionState=vr.CONNECTING,this.websocket.init(n).catch(c),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.joinResponse=this.reconnectToken=void 0,this._disconnectedReason=n||"LEAVE",this.connectionState=vr.CLOSED,this.websocket.close()}async join(){var n;if(!this.joinResponse){var s=Hc(this,$e.REQUEST_JOIN_INFO);if(s=await this.request(wt.JOIN,s),!s)return this.emit($e.REPORT_JOIN_GATEWAY,D.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=vr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(hr(n=this.handlePingPong).call(n,this),3e3),!0}async rejoin(){var n,s;if(!this.reconnectToken)throw new L(D.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");var c=Hc(this,$e.REQUEST_REJOIN_INFO);return c.token=this.reconnectToken,c=await this.request(wt.REJOIN,c),!!c&&(this.connectionState=vr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(hr(n=this.handlePingPong).call(n,this),3e3),c.peers&&H(s=c.peers).call(s,u=>{this.emit(mt.ON_USER_ONLINE,{uid:u.uid}),u.audio_mute?this.emit(mt.MUTE_AUDIO,{uid:u.uid}):this.emit(mt.UNMUTE_AUDIO,{uid:u.uid}),u.video_mute?this.emit(mt.MUTE_VIDEO,{uid:u.uid}):this.emit(mt.UNMUTE_VIDEO,{uid:u.uid}),u.audio_enable_local?this.emit(mt.ENABLE_LOCAL_AUDIO,{uid:u.uid}):this.emit(mt.DISABLE_LOCAL_AUDIO,{uid:u.uid}),u.video_enable_local?this.emit(mt.ENABLE_LOCAL_VIDEO,{uid:u.uid}):this.emit(mt.DISABLE_LOCAL_VIDEO,{uid:u.uid}),u.audio||u.video||this.emit(mt.ON_REMOVE_STREAM,{uid:u.uid,uint_id:u.uint_id}),u.audio&&this.emit(mt.ON_ADD_AUDIO_STREAM,{uid:u.uid,uint_id:u.uint_id,audio:!0}),u.video&&this.emit(mt.ON_ADD_VIDEO_STREAM,{uid:u.uid,uint_id:u.uint_id,video:!0})}),!0)}reconnect(n,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(n,s)}handleNotification(n){if(R.debug("[".concat(this.clientId,"] receive notification: "),n),n=hm(n.code),n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close("UID_BANNED"),void this.close()):void this.reconnect(n.action,Pn.SERVER_ERROR);R.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(this.websocket&&this.websocket.state==="connected"){0<this.pingpongTimeoutCount&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;var n=re.PING_PONG_TIME_OUT,s=le();this.pingpongTimeoutCount>=n&&(R.warning("PINGPONG Timeout. Last Socket Message: ".concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>re.WEBSOCKET_TIMEOUT_MIN)?this.reconnect("retry",Pn.TIMEOUT):this.request(wt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let c=le()-s;this.rttRolling.add(c),re.REPORT_STATS&&this.send(wt.PING_BACK,{pingpongElapse:c})}).catch(c=>{})}}handleWsInflateData(){let{wsInflateLength:n,wsDeflateLength:s}=this.websocket.getWsInflateData();n!==0&&s!==0&&this.upload(Pi.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:s,ws_inflate_length:n})}handleWebsocketEvents(){this.websocket.on(ct.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(ct.CLOSED,()=>{this.connectionState=vr.CLOSED}),this.websocket.on(ct.FAILED,()=>{this._disconnectedReason="NETWORK_ERROR",this.connectionState=vr.CLOSED}),this.websocket.on(ct.RECONNECTING,n=>{this._websocketReconnectReason=n,this.joinResponse=void 0,this.connectionState===vr.CONNECTED?this.connectionState=vr.RECONNECTING:this.connectionState=vr.CONNECTING}),this.websocket.on(ct.WILL_RECONNECT,(n,s)=>{if(Hc(this,$e.IS_P2P_DISCONNECTED)&&n==="retry")return this.reconnectToken=void 0,this.emit($e.NEED_RENEW_SESSION),this.emit($e.DISCONNECT_P2P),s("tryNext");n!=="retry"&&(this.reconnectToken=void 0,this.emit($e.NEED_RENEW_SESSION),this.emit($e.DISCONNECT_P2P)),s(n)}),this.websocket.on(ct.CONNECTED,()=>{this.openConnectionTime=le(),this.reconnectToken?this.rejoin().catch(n=>{var s;R.warning(b(s="[".concat(this.clientId,"] rejoin failed ")).call(s,n)),this.reconnect("tryNext",Pn.SERVER_ERROR)}):this.join().catch(n=>{if(this.emit($e.REPORT_JOIN_GATEWAY,n.message||n.code,this.url||""),n instanceof L&&n.code===D.UNEXPECTED_RESPONSE&&n.data.code===Ne.ERR_NO_AUTHORIZED)return R.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Pn.SERVER_ERROR);R.error("[".concat(this.clientId,"] join gateway request failed"),n.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Pn.SERVER_ERROR):(this.initError=n,this.close())})}),this.websocket.on(ct.REQUEST_NEW_URLS,(n,s)=>{Or(this,$e.REQUEST_RECOVER,this.multiIpOption).then(n).catch(s)})}}let tA=new Ct;class cw extends $r{constructor(n){super();this.inChannelInfo={joinAt:null,duration:0},this._state="DISCONNECTED",this.needToSendUnpubUnsub=new Ct,this.hasChangeBGPAddress=this.isSignalRecover=!1,this.joinGatewayStartTime=0,this._signalTimeout=!1,this.clientId=n.clientId,this.spec=n,this.signal=new aw(xh({},n,{retryConfig:n.websocketRetryConfig})),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}get state(){return this._state}set state(n){if(n!==this._state){var s=this._state;this._state=n,n==="DISCONNECTED"&&this._disconnectedReason?this.emit(kr.CONNECTION_STATE_CHANGE,n,s,this._disconnectedReason):this.emit(kr.CONNECTION_STATE_CHANGE,n,s)}}async join(n,s){var c,u;n.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);let h=le();var p=tA.get(n.cname);if(p||(p=new Ct,tA.set(n.cname,p)),p.has(n.uid))throw p=new L(D.UID_CONFLICT),z.joinGateway(n.sid,{lts:h,succ:!1,ec:p.message,addr:null,uid:n.uid,cid:n.cid}),p;p.set(n.uid,!0),this.joinInfo=n,this.key=s,s=n.proxyServer?Ie(c=n.gatewayAddrs).call(c,f=>{var m,I;return f=f.split(":"),b(m=b(I="wss://".concat(n.proxyServer,"/ws/?h=")).call(I,f[0],"&p=")).call(m,f[1])}):Ie(u=n.gatewayAddrs).call(u,f=>"wss://".concat(f)),c=0,this.joinGatewayStartTime=h;try{c=(await this.signal.init(s)).uid}catch(f){throw R.error("[".concat(this.clientId,"] User join failed"),f.toString()),z.joinGateway(n.sid,{lts:h,succ:!1,ec:f.message,addr:this.signal.url,uid:n.uid,cid:n.cid}),p.delete(n.uid),this.signal.close(),f}return this.state="CONNECTED",this.inChannelInfo.joinAt=le(),R.debug("[".concat(this.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(f=>{R.warning("[".concat(this.clientId,"] get traffic stats error"),f.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(kr.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(kr.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(kr.NETWORK_QUALITY,{uplinkNetworkQuality:cm(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:cm(this._statsCollector.trafficStats.B_dnq)}):this.emit(kr.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),c}async leave(n=!1){if(this.state!=="DISCONNECTED"){this.state="DISCONNECTING";try{if(!n&&this.signal.connectionState===vr.CONNECTED){var s=this.signal.request(wt.LEAVE,void 0,!0);await(1/0==3e3?s:se.race([s,HS(3e3)]))}}catch(c){R.warning("[".concat(this.clientId,"] leave request failed, ignore"),c)}this.signal.close(),this.reset(),this.state="DISCONNECTED"}}async publish(n,s){if(!this.joinInfo)throw new L(D.UNEXPECTED_ERROR,"publish no joinInfo");let c=n.getUserId(),u=n.videoTrack?function(h){var p;if(h=h._encoderConfig,!h)return{};const f={resolution:h.width&&h.height?b(p="".concat(ds(h.width),"x")).call(p,ds(h.height)):void 0,maxVideoBW:h.bitrateMax,minVideoBW:h.bitrateMin};return typeof h.frameRate=="number"?(f.maxFrameRate=h.frameRate,f.minFrameRate=h.frameRate):h.frameRate&&(f.maxFrameRate=h.frameRate.max||h.frameRate.ideal||h.frameRate.exact||h.frameRate.min,f.minFrameRate=h.frameRate.min||h.frameRate.ideal||h.frameRate.exact||h.frameRate.max),f}(n.videoTrack):{};if(n.on(Oe.NEED_ANSWER,(h,p,f)=>{var m;let I={state:"offer",stream_type:s,p2p_id:n.pc.ID,sdp:pe(h),audio:!!n.audioTrack,video:!!n.videoTrack,screen:n.videoTrack&&He(m=n.videoTrack._hints).call(m,ro.SCREEN_TRACK)!==-1,attributes:u,dtx:n.audioTrack instanceof hl&&n.audioTrack._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1,mode:this.spec.mode,codec:this.spec.codec,extend:re.PUB_EXTEND};n.audioTrack&&n.audioTrack instanceof cn&&(n.audioTrack&&(m={stream_id:this.joinInfo&&(this.joinInfo.stringUid||this.joinInfo.uid),action:""},n.audioTrack.isActive?m.action="unmute_local_audio":m.action="mute_local_audio",this.sendControl(m)),n.videoTrack&&(m={stream_id:this.joinInfo&&(this.joinInfo.stringUid||this.joinInfo.uid),action:""},n.videoTrack.muted?m.action="mute_local_video":m.action="unmute_local_video",this.sendControl(m))),this.signal.request(wt.PUBLISH,I,!0).then(E=>{c&&this.needToSendUnpubUnsub.set(c,!0),p(JSON.parse(E.sdp))}).catch(E=>{if(h.retry&&E.data&&E.data.code===Ne.ERR_PUBLISH_REQUEST_INVALID)return R.warning("[".concat(this.clientId,"] receiver publish error code, retry"),E.toString()),Or(n,Oe.NEED_UNPUB).then(()=>{h.retry=!1,Or(n,Oe.NEED_ANSWER,h).then(p).catch(f)});E.code!==D.WS_ABORT&&f(E)})}),n.on(Oe.NEED_RENEGOTIATE,(h,p,f)=>{this.signal.request(wt.PUBLISH,{state:"negotiation",stream_type:s,p2p_id:n.pc.ID,sdp:h},!0).then(m=>{p(JSON.parse(m.sdp))}).catch(m=>{m.code!==D.WS_ABORT&&f(m)})}),n.on(Oe.NEED_UNPUB,h=>c&&!this.needToSendUnpubUnsub.has(c)?h(!1):this.state==="RECONNECTING"?h(!0):void this.signal.request(wt.UNPUBLISH,{stream_id:n.getUserId(),stream_type:s},!0).then(()=>h(!1)).catch(p=>{R.warning("unpublish warning: ",p),h(!0)})),n.on(Oe.NEED_UPLOAD,(h,p)=>{this.signal.upload(h,{stream_type:s,stats:p})}),n.on(Oe.NEED_SIGNAL_RTT,h=>{h(this.signal.rtt)}),n.on(Oe.NEED_CONTROL,(h,p,f)=>{if(h.type==="video"&&h.muted)h="mute_local_video";else if(h.type!=="video"||h.muted)if(h.type==="audio"&&h.muted)h="mute_local_audio";else{if(h.type!=="audio"||h.muted)return;h="unmute_local_audio"}else h="unmute_local_video";this.sendControl({stream_id:this.joinInfo&&(this.joinInfo.stringUid||this.joinInfo.uid),action:h}).then(p).catch(f)}),this.state!=="RECONNECTING"){if(this.state!=="CONNECTED")return new L(D.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state)).throw();await n.startP2PConnection()}else n.readyToReconnectPC()}async subscribe(n){if(!this.joinInfo)throw new L(D.UNEXPECTED_ERROR,"subscribe no joinInfo");let s=n.getUserId();if(n.on(Oe.NEED_ANSWER,(c,u,h)=>{var p=n.subscribeOptions;p={stream_id:n.getUserId(),audio:!!p.audio,video:!!p.video,mode:this.spec.mode,codec:this.spec.codec,p2p_id:n.pc.ID,sdp:pe(c),tcc:!!re.SUBSCRIBE_TCC,extend:re.SUB_EXTEND},this.signal.request(wt.SUBSCRIBE,p,!0).then(f=>{this.needToSendUnpubUnsub.set(s,!0),u(JSON.parse(f.sdp))}).catch(f=>{if(c.retry&&f.data&&f.data.code===Ne.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.clientId,"] receiver subscribe error code, retry"),f.toString()),Or(n,Oe.NEED_UNSUB).then(()=>{c.retry=!1,Or(n,Oe.NEED_ANSWER,c).then(u).catch(h)});f.code!==D.WS_ABORT&&h(f)})}),n.on(Oe.NEED_UNSUB,c=>this.needToSendUnpubUnsub.has(s)?this.state==="RECONNECTING"?c(!0):void this.signal.request(wt.UNSUBSCRIBE,{stream_id:n.getUserId()},!0).then(()=>c(!1)).catch(u=>{R.warning("unsubscribe warning",u),c(!0)}):c(!1)),n.on(Oe.NEED_UPLOAD,(c,u)=>{this.signal.upload(c,{stream_id:n.getUserId(),stats:u})}),n.on(Oe.NEED_SIGNAL_RTT,c=>{c(this.signal.rtt)}),this.state!=="RECONNECTING"){if(this.state!=="CONNECTED")return new L(D.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state)).throw();await n.startP2PConnection()}else n.readyToReconnectPC()}async subscribeChange(n,s){var c,u;if(!this.joinInfo)throw new L(D.UNEXPECTED_ERROR,"subscribe no joinInfo");if(await n.setSubscribeOptions(s),this.state!=="RECONNECTING"){if(this.state!=="CONNECTED")return new L(D.INVALID_OPERATION,"can not subscribe change when connection state is ".concat(this.state)).throw();R.debug(b(c=b(u="[".concat(this.clientId,"] send subscribe change, audio: ")).call(u,s.audio,", video: ")).call(c,s.video)),await this.signal.request(wt.SUBSCRIBE_CHANGE,{stream_id:n.getUserId(),audio:!!s.audio,video:!!s.video},!0)}}async sendControl(n){this.signal.request(wt.CONTROL,n,!0,!0)}async unsubscribe(n){await n.closeP2PConnection()}getGatewayInfo(){return this.signal.request(wt.GATEWAY_INFO)}renewToken(n){return this.signal.request(wt.RENEW_TOKEN,{token:n})}async setClientRole(n,s){if(s&&(this._clientRoleOptions=sn({},s)),this.state!=="CONNECTED")return void(this.role=n);await this.signal.request(wt.SET_CLIENT_ROLE,{role:n,level:n==="audience"?this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:0}),this.role=n}async setRemoteVideoStreamType(n,s){await this.signal.request(wt.SWITCH_VIDEO_STREAM,{stream_id:n,stream_type:s})}async setStreamFallbackOption(n,s){await this.signal.request(wt.SET_FALLBACK_OPTION,{stream_id:n,fallback_type:s})}async pickSVCLayer(n,s){await this.signal.request(wt.PICK_SVC_LAYER,{stream_id:n,spatial_layer:s.spatialLayer,temporal_layer:s.temporalLayer})}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=le()-this.inChannelInfo.joinAt),xh({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(wt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=le()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){let n=tA.get(this.joinInfo.cname);n&&n.delete(this.joinInfo.uid)}this.needToSendUnpubUnsub=new Ct,this.key=this.joinInfo=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(this.joinInfo){var n=(n=((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex])||"").match(/(wss:\/\/)?([^:]+):(\d+)/))?{username:Fr.username,password:Fr.password,turnServerURL:n[2],tcpport:dr(n[3])+30,udpport:dr(n[3])+30,forceturn:!1}:null;this.joinInfo.turnServer.serversFromGateway=[],n&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(xh({},Fr,{turnServerURL:n.turnServerURL,tcpport:n.tcpport,udpport:n.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}}async updateTrafficStats(){var n;if(this.state==="CONNECTED"){var s=await this.signal.request(wt.TRAFFIC_STATS,void 0,!0);s.timestamp=le(),H(n=s.peer_delay).call(n,c=>{var u;let h=this._statsCollector.trafficStats&&ze(u=this._statsCollector.trafficStats.peer_delay).call(u,p=>p.peer_uid===c.peer_uid);h&&h.B_st!==c.B_st&&ui(()=>{this.emit(kr.STREAM_TYPE_CHANGE,c.peer_uid,c.B_st)})}),this._statsCollector.updateTrafficStats(s)}}getJoinMessage(){if(!this.joinInfo||!this.key)throw new L(D.UNEXPECTED_ERROR,"can not generate join message, no join info");let n=sn({},this.joinInfo.apResponse);var s=re.REPORT_APP_SCENARIO;if(typeof s!="string")try{s=pe(s)}catch{s=void 0}return s&&128<s.length&&(s=void 0),s={session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Xn,browser:navigator.userAgent,process_id:re.PROCESS_ID,mode:this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:n,extend:re.JOIN_EXTEND,details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:s},this.joinInfo.stringUid&&(s.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(s.aes_mode=this.joinInfo.aesmode,re.ENCRYPT_AES?(s.aes_secret=this.joinInfo.aespassword,s.aes_encrypt=!0):s.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(s.aes_salt=this.joinInfo.aessalt)),n.addresses[this.signal.websocket.currentURLIndex]&&(s.ap_response.ticket=n.addresses[this.signal.websocket.currentURLIndex].ticket,delete n.addresses),s}getRejoinMessage(){if(!this.joinInfo)throw new L(D.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on($e.WS_RECONNECTING,n=>{this.joinInfo&&z.WebSocketQuit(this.joinInfo.sid,{lts:le(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n||Pn.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",z.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode}),this.isSignalRecover=!1,this.joinGatewayStartTime=le())}),this.signal.on($e.WS_CLOSED,n=>{let s;switch(n){case"LEAVE":s=Pn.LEAVE;break;case"UID_BANNED":case"IP_BANNED":case"CHANNEL_BANNED":case"SERVER_ERROR":s=Pn.SERVER_ERROR;break;default:s=Pn.NETWORK_ERROR}R.debug("[signal] websocket closed, reason: ".concat(s||"undefined -> "+Pn.NETWORK_ERROR)),this.joinInfo&&z.WebSocketQuit(this.joinInfo.sid,{lts:le(),succ:n==="LEAVE"?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:s}),this.reset(),this._disconnectedReason=n,this.state="DISCONNECTED"}),this.signal.on($e.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){var n,s,c;if(this.role==="audience"&&this._clientRoleOptions&&this._clientRoleOptions.level&&(R.debug(b(n=b(s=b(c="[".concat(this.clientId,"] patch to send set client role, role: ")).call(c,this.role,", mode: ")).call(s,this.spec.mode,", level: ")).call(n,this._clientRoleOptions&&this._clientRoleOptions.level)),this.setClientRole(this.role,this._clientRoleOptions)),z.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid}),this.joinInfo.useLocalAccessPoint){n=this.signal.url&&this.signal.url.match(/wss:\/\/([^:]+):(\d+)/);var u;if(!n)return void R.error(b(u="[".concat(this.clientId,"] set local access point after joined failed: ")).call(u,n));Wr("EVENT_REPORT_DOMAIN",n[1]),Wr("EVENT_REPORT_BACKUP_DOMAIN",n[1]),Wr("LOG_UPLOAD_SERVER","".concat(n[1],":6444"))}}}),this.signal.on(mt.ON_UPLINK_STATS,n=>{this._statsCollector.updateUplinkStats(n)}),this.signal.on($e.REQUEST_RECOVER,(n,s,c)=>{if(!this.joinInfo)return c(new L(D.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));n&&(this.joinInfo.multiIP=n,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Or(this,kr.REQUEST_NEW_GATEWAY_LIST).then(s).catch(c)}),this.signal.on($e.REQUEST_JOIN_INFO,n=>{n(this.getJoinMessage())}),this.signal.on($e.REQUEST_REJOIN_INFO,n=>{n(this.getRejoinMessage())}),this.signal.on($e.REPORT_JOIN_GATEWAY,(n,s)=>{this.joinInfo&&z.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:n,addr:s,uid:this.joinInfo.uid,cid:this.joinInfo.cid})}),this.signal.on($e.IS_P2P_DISCONNECTED,n=>{n(Hc(this,kr.IS_P2P_DISCONNECTED))}),this.signal.on($e.DISCONNECT_P2P,()=>{this.needToSendUnpubUnsub=new Ct,this.emit(kr.DISCONNECT_P2P)}),this.signal.on($e.NEED_RENEW_SESSION,()=>{this.emit(kr.NEED_RENEW_SESSION)}),this.signal.on($e.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on($e.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0})}}var lw=lr("iterator"),rA=!cr(function(){var i=new URL("b?a=1&b=2&c=3","http://a"),n=i.searchParams,s="";return i.pathname="c%20d",n.forEach(function(c,u){n.delete("b"),s+=u+c}),!i.toJSON||!n.sort||i.href!=="http://a/c%20d?a=1&c=3"||n.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!n[lw]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://\u0442\u0435\u0441\u0442").host!=="xn--e1aybc"||new URL("http://a#\u0431").hash!=="#%D0%B1"||s!=="a1c3"||new URL("http://x",void 0).host!=="x"}),uw=/[^\0-\u007E]/,dw=/[.\u3002\uFF0E\uFF61]/g,nc=Math.floor,nA=String.fromCharCode,k1=function(i){return i+22+75*(26>i)},hw=function(i){for(var n,s=[],c=[],u=0,h=i.length;u<h;){var p=i.charCodeAt(u++);if(55296<=p&&56319>=p&&u<h){var f=i.charCodeAt(u++);(64512&f)==56320?c.push(((1023&p)<<10)+(1023&f)+65536):(c.push(p),u--)}else c.push(p)}u=(i=c).length,h=128;var m=0,I=72;for(c=0;c<i.length;c++)128>(n=i[c])&&s.push(nA(n));for((f=p=s.length)&&s.push("-");f<u;){var E=2147483647;for(c=0;c<i.length;c++)(n=i[c])>=h&&n<E&&(E=n);var _=f+1;if(E-h>nc((2147483647-m)/_))throw RangeError("Overflow: input needs wider integers to process");for(m+=(E-h)*_,h=E,c=0;c<i.length;c++){if((n=i[c])<h&&2147483647<++m)throw RangeError("Overflow: input needs wider integers to process");if(n==h){var S=m;for(E=36;;E+=36){var N=E<=I?1:E>=I+26?26:E-I;if(S<N)break;S-=N;var O=36-N;s.push(nA(k1(N+S%O))),S=nc(S/O)}for(s.push(nA(k1(S))),I=_,E=0,m=f==p?nc(m/700):m>>1,m+=nc(m/I);455<m;E+=36)m=nc(m/35);I=nc(E+36*m/(m+38)),m=0,++f}}++m,++h}return s.join("")},b1=function(i){var n=Lu(i);if(typeof n!="function")throw TypeError(String(i)+" is not iterable");return on(n.call(i))},D1=eo("fetch"),iA=eo("Headers"),pw=lr("iterator"),B1=yr.set,gi=yr.getterFor("URLSearchParams"),Aw=yr.getterFor("URLSearchParamsIterator"),fw=/\+/g,L1=Array(4),gw=function(i){return L1[i-1]||(L1[i-1]=RegExp("((?:%[\\da-f]{2}){"+i+"})","gi"))},mw=function(i){try{return decodeURIComponent(i)}catch{return i}},M1=function(i){i=i.replace(fw," ");var n=4;try{return decodeURIComponent(i)}catch{for(;n;)i=i.replace(gw(n--),mw);return i}},P1=/[!'()~]|%20/g,vw={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},Q1=function(i){return vw[i]},x1=function(i,n){if(n){var s,c;n=n.split("&");for(var u=0;u<n.length;)(s=n[u++]).length&&(c=s.split("="),i.push({key:M1(c.shift()),value:M1(c.join("="))}))}},Ew=function(i){this.entries.length=0,x1(this.entries,i)},ic=function(i,n){if(i<n)throw TypeError("Not enough arguments")},oA=fv(function(i,n){B1(this,{type:"URLSearchParamsIterator",iterator:b1(gi(i).entries),kind:n})},"Iterator",function(){var i=Aw(this),n=i.kind;i=i.iterator.next();var s=i.value;return i.done||(i.value=n==="keys"?s.key:n==="values"?s.value:[s.key,s.value]),i}),pl=function(){Ga(this,pl,"URLSearchParams");var i,n,s,c,u,h=0<arguments.length?arguments[0]:void 0,p=[];if(B1(this,{type:"URLSearchParams",entries:p,updateURL:function(){},updateSearchParams:Ew}),h!==void 0)if(Kt(h))if(typeof(i=Lu(h))=="function")for(n=(i=i.call(h)).next;!(h=n.call(i)).done;){if((h=(c=(s=b1(on(h.value))).next).call(s)).done||(u=c.call(s)).done||!c.call(s).done)throw TypeError("Expected sequence with length 2");p.push({key:h.value+"",value:u.value+""})}else for(n in h)tt(h,n)&&p.push({key:n,value:h[n]+""});else x1(p,typeof h=="string"?h.charAt(0)==="?"?h.slice(1):h:h+"")},ad=pl.prototype;zs(ad,{append:function(i,n){ic(arguments.length,2);var s=gi(this);s.entries.push({key:i+"",value:n+""}),s.updateURL()},delete:function(i){ic(arguments.length,1);for(var n=gi(this),s=n.entries,c=i+"",u=0;u<s.length;)s[u].key===c?s.splice(u,1):u++;n.updateURL()},get:function(i){ic(arguments.length,1);for(var n=gi(this).entries,s=i+"",c=0;c<n.length;c++)if(n[c].key===s)return n[c].value;return null},getAll:function(i){ic(arguments.length,1);for(var n=gi(this).entries,s=i+"",c=[],u=0;u<n.length;u++)n[u].key===s&&c.push(n[u].value);return c},has:function(i){ic(arguments.length,1);for(var n=gi(this).entries,s=i+"",c=0;c<n.length;)if(n[c++].key===s)return!0;return!1},set:function(i,n){ic(arguments.length,1);for(var s,c=gi(this),u=c.entries,h=!1,p=i+"",f=n+"",m=0;m<u.length;m++)(s=u[m]).key===p&&(h?u.splice(m--,1):(h=!0,s.value=f));h||u.push({key:p,value:f}),c.updateURL()},sort:function(){var i,n,s=gi(this),c=s.entries,u=c.slice();for(n=c.length=0;n<u.length;n++){var h=u[n];for(i=0;i<n;i++)if(c[i].key>h.key){c.splice(i,0,h);break}i===n&&c.push(h)}s.updateURL()},forEach:function(i){for(var n,s=gi(this).entries,c=ps(i,1<arguments.length?arguments[1]:void 0,3),u=0;u<s.length;)c((n=s[u++]).value,n.key,this)},keys:function(){return new oA(this,"keys")},values:function(){return new oA(this,"values")},entries:function(){return new oA(this,"entries")}},{enumerable:!0}),Ho(ad,pw,ad.entries),Ho(ad,"toString",function(){for(var i,n=gi(this).entries,s=[],c=0;c<n.length;)i=n[c++],s.push(encodeURIComponent(i.key).replace(P1,Q1)+"="+encodeURIComponent(i.value).replace(P1,Q1));return s.join("&")},{enumerable:!0}),Ys(pl,"URLSearchParams"),Ge({global:!0,forced:!rA},{URLSearchParams:pl}),rA||typeof D1!="function"||typeof iA!="function"||Ge({global:!0,enumerable:!0,forced:!0},{fetch:function(i){var n,s,c,u=[i];return 1<arguments.length&&(Kt(n=arguments[1])&&(s=n.body,Fa(s)==="URLSearchParams"&&((c=n.headers?new iA(n.headers):new iA).has("content-type")||c.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),n=fs(n,{body:Vo(0,String(s)),headers:Vo(0,c)}))),u.push(n)),D1.apply(this,u)}});var Al=je.URL,Iw=pl,Cw=yr.set,pr=yr.getterFor("URL"),yw=Math.floor,U1=Math.pow,F1=/[A-Za-z]/,_w=/[\d+\-.A-Za-z]/,sA=/\d/,Sw=/^(0x|0X)/,Tw=/^[0-7]+$/,Rw=/^\d+$/,V1=/^[\dA-Fa-f]+$/,ww=/[\u0000\u0009\u000A\u000D #%/:?@[\\]]/,Nw=/[\u0000\u0009\u000A\u000D #/:?@[\\]]/,Ow=/^[\u0000-\u001F ]+|[\u0000-\u001F ]+$/g,kw=/[\u0009\u000A\u000D]/g,aA=function(i,n){var s,c;if(n.charAt(0)=="["){if(n.charAt(n.length-1)!="]"||!(s=Dw(n.slice(1,-1))))return"Invalid host"}else if(en(i)){var u=[],h=n.toLowerCase().replace(dw,".").split(".");for(c=0;c<h.length;c++){var p=h[c];u.push(uw.test(p)?"xn--"+hw(p):p)}if(n=u.join("."),ww.test(n)||(s=bw(n))===null)return"Invalid host"}else{if(Nw.test(n))return"Invalid host";for(s="",n=na(n),c=0;c<n.length;c++)s+=vs(n[c],cd)}i.host=s},bw=function(i){var n,s,c,u,h=i.split(".");if(h.length&&h[h.length-1]==""&&h.pop(),4<(n=h.length))return i;var p=[];for(s=0;s<n;s++){if((c=h[s])=="")return i;if(u=10,1<c.length&&c.charAt(0)=="0"&&(u=Sw.test(c)?16:8,c=c.slice(u==8?1:2)),c==="")c=0;else{if(!(u==10?Rw:u==8?Tw:V1).test(c))return i;c=parseInt(c,u)}p.push(c)}for(s=0;s<n;s++)if(c=p[s],s==n-1){if(c>=U1(256,5-n))return null}else if(255<c)return null;for(i=p.pop(),s=0;s<p.length;s++)i+=p[s]*U1(256,3-s);return i},Dw=function(i){var n,s,c,u=[0,0,0,0,0,0,0,0],h=0,p=null,f=0,m=function(){return i.charAt(f)};if(m()==":"){if(i.charAt(1)!=":")return;f+=2,p=++h}for(;m();){if(h==8)return;if(m()!=":"){for(n=s=0;4>s&&V1.test(m());)n=16*n+parseInt(m(),16),f++,s++;if(m()=="."){if(s==0||(f-=s,6<h))return;for(n=0;m();){if(s=null,0<n){if(!(m()=="."&&4>n))return;f++}if(!sA.test(m()))return;for(;sA.test(m());){if(c=parseInt(m(),10),s===null)s=c;else{if(s==0)return;s=10*s+c}if(255<s)return;f++}u[h]=256*u[h]+s,++n!=2&&n!=4||h++}if(n!=4)return;break}if(m()==":"){if(f++,!m())return}else if(m())return;u[h++]=n}else{if(p!==null)return;f++,p=++h}}if(p!==null)for(m=h-p,h=7;h!=0&&0<m;)n=u[h],u[h--]=u[p+m-1],u[p+--m]=n;else if(h!=8)return;return u},fl=function(i){var n,s;if(typeof i=="number"){var c=[];for(n=0;4>n;n++)c.unshift(i%256),i=yw(i/256);return c.join(".")}if(typeof i=="object"){c="",n=null;for(var u=1,h=null,p=0,f=0;8>f;f++)i[f]!==0?(p>u&&(n=h,u=p),h=null,p=0):(h===null&&(h=f),++p);for(u=(p>u&&(n=h),n),n=0;8>n;n++)s&&i[n]===0||(s&&(s=!1),u===n?(c+=n?":":"::",s=!0):(c+=i[n].toString(16),7>n&&(c+=":")));return"["+c+"]"}return i},cd={},G1=el({},cd,{" ":1,'"':1,"<":1,">":1,"`":1}),j1=el({},G1,{"#":1,"?":1,"{":1,"}":1}),cA=el({},j1,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),vs=function(i,n){var s=ZT(i,0);return 32<s&&127>s&&!tt(n,i)?i:encodeURIComponent(i)},ld={ftp:21,file:null,http:80,https:443,ws:80,wss:443},en=function(i){return tt(ld,i.scheme)},lA=function(i){return!i.host||i.cannotBeABaseURL||i.scheme=="file"},gl=function(i,n){var s;return i.length==2&&F1.test(i.charAt(0))&&((s=i.charAt(1))==":"||!n&&s=="|")},H1=function(i){var n;return 1<i.length&&gl(i.slice(0,2))&&(i.length==2||(n=i.charAt(2))==="/"||n==="\\"||n==="?"||n==="#")},K1=function(i){var n=i.path,s=n.length;!s||i.scheme=="file"&&s==1&&gl(n[0],!0)||n.pop()},uA={},W1={},dA={},Y1={},q1={},hA={},J1={},z1={},ud={},dd={},pA={},AA={},fA={},gA={},X1={},mA={},ml={},So={},$1={},ia={},zo={},To=function(i,n,s,c){var u,h,p=s||uA,f=0,m="",I=!1,E=!1,_=!1;for(s||(i.scheme="",i.username="",i.password="",i.host=null,i.port=null,i.path=[],i.query=null,i.fragment=null,i.cannotBeABaseURL=!1,n=n.replace(Ow,"")),n=n.replace(kw,""),n=na(n);f<=n.length;){switch(u=n[f],p){case uA:if(!u||!F1.test(u)){if(s)return"Invalid scheme";p=dA;continue}m+=u.toLowerCase(),p=W1;break;case W1:if(u&&(_w.test(u)||u=="+"||u=="-"||u=="."))m+=u.toLowerCase();else{if(u!=":"){if(s)return"Invalid scheme";m="",p=dA,f=0;continue}if(s&&(en(i)!=tt(ld,m)||m=="file"&&(i.username!=""||i.password!=""||i.port!==null)||i.scheme=="file"&&!i.host))return;if(i.scheme=m,s)return void(en(i)&&ld[i.scheme]==i.port&&(i.port=null));m="",i.scheme=="file"?p=gA:en(i)&&c&&c.scheme==i.scheme?p=Y1:en(i)?p=z1:n[f+1]=="/"?(p=q1,f++):(i.cannotBeABaseURL=!0,i.path.push(""),p=$1)}break;case dA:if(!c||c.cannotBeABaseURL&&u!="#")return"Invalid scheme";if(c.cannotBeABaseURL&&u=="#"){i.scheme=c.scheme,i.path=c.path.slice(),i.query=c.query,i.fragment="",i.cannotBeABaseURL=!0,p=zo;break}p=c.scheme=="file"?gA:hA;continue;case Y1:if(u!="/"||n[f+1]!="/"){p=hA;continue}p=ud,f++;break;case q1:if(u=="/"){p=dd;break}p=So;continue;case hA:if(i.scheme=c.scheme,u==null)i.username=c.username,i.password=c.password,i.host=c.host,i.port=c.port,i.path=c.path.slice(),i.query=c.query;else if(u=="/"||u=="\\"&&en(i))p=J1;else if(u=="?")i.username=c.username,i.password=c.password,i.host=c.host,i.port=c.port,i.path=c.path.slice(),i.query="",p=ia;else{if(u!="#"){i.username=c.username,i.password=c.password,i.host=c.host,i.port=c.port,i.path=c.path.slice(),i.path.pop(),p=So;continue}i.username=c.username,i.password=c.password,i.host=c.host,i.port=c.port,i.path=c.path.slice(),i.query=c.query,i.fragment="",p=zo}break;case J1:if(!en(i)||u!="/"&&u!="\\"){if(u!="/"){i.username=c.username,i.password=c.password,i.host=c.host,i.port=c.port,p=So;continue}p=dd}else p=ud;break;case z1:if(p=ud,u!="/"||m.charAt(f+1)!="/")continue;f++;break;case ud:if(u!="/"&&u!="\\"){p=dd;continue}break;case dd:if(u=="@"){for(I&&(m="%40"+m),I=!0,m=na(m),u=0;u<m.length;u++){var S=m[u];S!=":"||_?(S=vs(S,cA),_?i.password+=S:i.username+=S):_=!0}m=""}else if(u==null||u=="/"||u=="?"||u=="#"||u=="\\"&&en(i)){if(I&&m=="")return"Invalid authority";f-=na(m).length+1,m="",p=pA}else m+=u;break;case pA:case AA:if(s&&i.scheme=="file"){p=mA;continue}if(u!=":"||E){if(u==null||u=="/"||u=="?"||u=="#"||u=="\\"&&en(i)){if(en(i)&&m=="")return"Invalid host";if(s&&m==""&&(i.username!=""||i.password!=""||i.port!==null))return;if(p=aA(i,m))return p;if(m="",p=ml,s)return;continue}u=="["?E=!0:u=="]"&&(E=!1),m+=u}else{if(m=="")return"Invalid host";if(p=aA(i,m))return p;if(m="",p=fA,s==AA)return}break;case fA:if(!sA.test(u)){if(u==null||u=="/"||u=="?"||u=="#"||u=="\\"&&en(i)||s){if(m!=""){if(p=parseInt(m,10),65535<p)return"Invalid port";i.port=en(i)&&p===ld[i.scheme]?null:p,m=""}if(s)return;p=ml;continue}return"Invalid port"}m+=u;break;case gA:if(i.scheme="file",u=="/"||u=="\\")p=X1;else{if(!c||c.scheme!="file"){p=So;continue}if(u==null)i.host=c.host,i.path=c.path.slice(),i.query=c.query;else if(u=="?")i.host=c.host,i.path=c.path.slice(),i.query="",p=ia;else{if(u!="#"){H1(n.slice(f).join(""))||(i.host=c.host,i.path=c.path.slice(),K1(i)),p=So;continue}i.host=c.host,i.path=c.path.slice(),i.query=c.query,i.fragment="",p=zo}}break;case X1:if(u=="/"||u=="\\"){p=mA;break}c&&c.scheme=="file"&&!H1(n.slice(f).join(""))&&(gl(c.path[0],!0)?i.path.push(c.path[0]):i.host=c.host),p=So;continue;case mA:if(u==null||u=="/"||u=="\\"||u=="?"||u=="#"){if(!s&&gl(m))p=So;else{if(m==""){if(i.host="",s)return}else{if(p=aA(i,m))return p;if(i.host=="localhost"&&(i.host=""),s)return;m=""}p=ml}continue}m+=u;break;case ml:if(en(i)){if(p=So,u!="/"&&u!="\\")continue}else if(s||u!="?")if(s||u!="#"){if(u!=null&&(p=So,u!="/"))continue}else i.fragment="",p=zo;else i.query="",p=ia;break;case So:if(u==null||u=="/"||u=="\\"&&en(i)||!s&&(u=="?"||u=="#")){if((h=(h=m).toLowerCase())===".."||h==="%2e."||h===".%2e"||h==="%2e%2e"?(K1(i),u=="/"||u=="\\"&&en(i)||i.path.push("")):m==="."||m.toLowerCase()==="%2e"?u=="/"||u=="\\"&&en(i)||i.path.push(""):(i.scheme=="file"&&!i.path.length&&gl(m)&&(i.host&&(i.host=""),m=m.charAt(0)+":"),i.path.push(m)),m="",i.scheme=="file"&&(u==null||u=="?"||u=="#"))for(;1<i.path.length&&i.path[0]==="";)i.path.shift();u=="?"?(i.query="",p=ia):u=="#"&&(i.fragment="",p=zo)}else m+=vs(u,j1);break;case $1:u=="?"?(i.query="",p=ia):u=="#"?(i.fragment="",p=zo):u!=null&&(i.path[0]+=vs(u,cd));break;case ia:s||u!="#"?u!=null&&(u=="'"&&en(i)?i.query+="%27":i.query+=u=="#"?"%23":vs(u,cd)):(i.fragment="",p=zo);break;case zo:u!=null&&(i.fragment+=vs(u,G1))}f++}},oa=function(i){var n=Ga(this,oa,"URL"),s=1<arguments.length?arguments[1]:void 0,c=String(i),u=Cw(n,{type:"URL"});if(s!==void 0){if(s instanceof oa)var h=pr(s);else if(s=To(h={},String(s)))throw TypeError(s)}if(s=To(u,c,null,h))throw TypeError(s);var p=u.searchParams=new Iw;h=gi(p),h.updateSearchParams(u.query),h.updateURL=function(){u.query=String(p)||null},Ft||(n.href=hd.call(n),n.origin=Z1.call(n),n.protocol=eI.call(n),n.username=tI.call(n),n.password=rI.call(n),n.host=nI.call(n),n.hostname=iI.call(n),n.port=oI.call(n),n.pathname=sI.call(n),n.search=aI.call(n),n.searchParams=cI.call(n),n.hash=lI.call(n))},vA=oa.prototype,hd=function(){var i=pr(this),n=i.scheme,s=i.username,c=i.password,u=i.host,h=i.port,p=i.path,f=i.query,m=i.fragment,I=n+":";return u!==null?(I+="//",(i.username!=""||i.password!="")&&(I+=s+(c?":"+c:"")+"@"),I+=fl(u),h!==null&&(I+=":"+h)):n=="file"&&(I+="//"),I+=i.cannotBeABaseURL?p[0]:p.length?"/"+p.join("/"):"",f!==null&&(I+="?"+f),m!==null&&(I+="#"+m),I},Z1=function(){var i=pr(this),n=i.scheme,s=i.port;if(n=="blob")try{return new URL(n.path[0]).origin}catch{return"null"}return n!="file"&&en(i)?n+"://"+fl(i.host)+(s!==null?":"+s:""):"null"},eI=function(){return pr(this).scheme+":"},tI=function(){return pr(this).username},rI=function(){return pr(this).password},nI=function(){var i=pr(this),n=i.host;return i=i.port,n===null?"":i===null?fl(n):fl(n)+":"+i},iI=function(){var i=pr(this).host;return i===null?"":fl(i)},oI=function(){var i=pr(this).port;return i===null?"":String(i)},sI=function(){var i=pr(this),n=i.path;return i.cannotBeABaseURL?n[0]:n.length?"/"+n.join("/"):""},aI=function(){var i=pr(this).query;return i?"?"+i:""},cI=function(){return pr(this).searchParams},lI=function(){var i=pr(this).fragment;return i?"#"+i:""},Fi=function(i,n){return{get:i,set:n,configurable:!0,enumerable:!0}};if(Ft&&tp(vA,{href:Fi(hd,function(i){var n=pr(this);if(i=To(n,String(i)))throw TypeError(i);gi(n.searchParams).updateSearchParams(n.query)}),origin:Fi(Z1),protocol:Fi(eI,function(i){var n=pr(this);To(n,String(i)+":",uA)}),username:Fi(tI,function(i){var n=pr(this);if(i=na(String(i)),!lA(n)){n.username="";for(var s=0;s<i.length;s++)n.username+=vs(i[s],cA)}}),password:Fi(rI,function(i){var n=pr(this);if(i=na(String(i)),!lA(n)){n.password="";for(var s=0;s<i.length;s++)n.password+=vs(i[s],cA)}}),host:Fi(nI,function(i){var n=pr(this);n.cannotBeABaseURL||To(n,String(i),pA)}),hostname:Fi(iI,function(i){var n=pr(this);n.cannotBeABaseURL||To(n,String(i),AA)}),port:Fi(oI,function(i){var n=pr(this);lA(n)||((i=String(i))==""?n.port=null:To(n,i,fA))}),pathname:Fi(sI,function(i){var n=pr(this);n.cannotBeABaseURL||(n.path=[],To(n,i+"",ml))}),search:Fi(aI,function(i){var n=pr(this);(i=String(i))==""?n.query=null:(i.charAt(0)=="?"&&(i=i.slice(1)),n.query="",To(n,i,ia)),gi(n.searchParams).updateSearchParams(n.query)}),searchParams:Fi(cI),hash:Fi(lI,function(i){var n=pr(this);(i=String(i))!=""?(i.charAt(0)=="#"&&(i=i.slice(1)),n.fragment="",To(n,i,zo)):n.fragment=null})}),Ho(vA,"toJSON",function(){return hd.call(this)},{enumerable:!0}),Ho(vA,"toString",function(){return hd.call(this)},{enumerable:!0}),Al){var uI=Al.createObjectURL,dI=Al.revokeObjectURL;uI&&Ho(oa,"createObjectURL",function(i){return uI.apply(Al,arguments)}),dI&&Ho(oa,"revokeObjectURL",function(i){return dI.apply(Al,arguments)})}Ys(oa,"URL"),Ge({global:!0,forced:!rA,sham:!Ft},{URL:oa});var Bw=Qt.URL;(function(){function i(G){var Y=0;return function(){return Y<G.length?{done:!1,value:G[Y++]}:{done:!0}}}function n(G,Y){if(Y)e:{var Z=O;G=G.split(".");for(var ue=0;ue<G.length-1;ue++){var de=G[ue];if(!(de in Z))break e;Z=Z[de]}(Y=Y(ue=Z[G=G[G.length-1]]))!=ue&&Y!=null&&N(Z,G,{configurable:!0,writable:!0,value:Y})}}function s(G){return(G={next:G})[Symbol.iterator]=function(){return this},G}function c(G){var Y=typeof Symbol!="undefined"&&Symbol.iterator&&G[Symbol.iterator];return Y?Y.call(G):{next:i(G)}}function u(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function h(G){if(G.m)throw new TypeError("Generator is already running");G.m=!0}function p(G,Y){return G.h=3,{value:Y}}function f(G){this.g=new u,this.G=G}function m(G,Y,Z,ue){try{var de=Y.call(G.g.j,Z);if(!(de instanceof Object))throw new TypeError("Iterator result "+de+" is not an object");if(!de.done)return G.g.m=!1,de;var Le=de.value}catch(_e){return G.g.j=null,G.g.s(_e),I(G)}return G.g.j=null,ue.call(G.g,Le),I(G)}function I(G){for(;G.g.h;)try{var Y=G.G(G.g);if(Y)return G.g.m=!1,{value:Y.value,done:!1}}catch(Z){G.g.v=void 0,G.g.s(Z)}if(G.g.m=!1,G.g.l){if(Y=G.g.l,G.g.l=null,Y.F)throw Y.D;return{value:Y.return,done:!0}}return{value:void 0,done:!0}}function E(G){this.next=function(Y){return G.o(Y)},this.throw=function(Y){return G.s(Y)},this.return=function(Y){return function(Z,ue){h(Z.g);var de=Z.g.j;return de?m(Z,"return"in de?de.return:function(Le){return{value:Le,done:!0}},ue,Z.g.return):(Z.g.return(ue),I(Z))}(G,Y)},this[Symbol.iterator]=function(){return this}}function _(G,Y){return Y=new E(new f(Y)),q&&G.prototype&&q(Y,G.prototype),Y}var S,N=typeof Object.defineProperties=="function"?Object.defineProperty:function(G,Y,Z){return G==Array.prototype||G==Object.prototype||(G[Y]=Z.value),G},O=function(G){G=[typeof globalThis=="object"&&globalThis,G,typeof window=="object"&&window,typeof self=="object"&&self,typeof qc=="object"&&qc];for(var Y=0;Y<G.length;++Y){var Z=G[Y];if(Z&&Z.Math==Math)return Z}throw Error("Cannot find global object")}(this);if(n("Symbol",function(G){function Y(de,Le){this.A=de,N(this,"description",{configurable:!0,writable:!0,value:Le})}if(G)return G;Y.prototype.toString=function(){return this.A};var Z="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",ue=0;return function de(Le){if(this instanceof de)throw new TypeError("Symbol is not a constructor");return new Y(Z+(Le||"")+"_"+ue++,Le)}}),n("Symbol.iterator",function(G){if(G)return G;G=Symbol("Symbol.iterator");for(var Y="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Z=0;Z<Y.length;Z++){var ue=O[Y[Z]];typeof ue=="function"&&typeof ue.prototype[G]!="function"&&N(ue.prototype,G,{configurable:!0,writable:!0,value:function(){return s(i(this))}})}return G}),typeof Object.setPrototypeOf=="function")var B=Object.setPrototypeOf;else{e:{var Q={};try{Q.__proto__={a:!0},B=Q.a;break e}catch{}B=!1}B=B?function(G,Y){if(G.__proto__=Y,G.__proto__!==Y)throw new TypeError(G+" is not extensible");return G}:null}var q=B;if(u.prototype.o=function(G){this.v=G},u.prototype.s=function(G){this.l={D:G,F:!0},this.h=this.C||this.u},u.prototype.return=function(G){this.l={return:G},this.h=this.u},f.prototype.o=function(G){return h(this.g),this.g.j?m(this,this.g.j.next,G,this.g.o):(this.g.o(G),I(this))},f.prototype.s=function(G){return h(this.g),this.g.j?m(this,this.g.j.throw,G,this.g.o):(this.g.s(G),I(this))},n("Array.prototype.entries",function(G){return G||function(){return function(Y,Z){Y instanceof String&&(Y+="");var ue=0,de=!1,Le={next:function(){if(!de&&ue<Y.length){var _e=ue++;return{value:Z(_e,Y[_e]),done:!1}}return de=!0,{done:!0,value:void 0}}};return Le[Symbol.iterator]=function(){return Le},Le}(this,function(Y,Z){return[Y,Z]})}}),typeof Blob!="undefined"&&(typeof FormData=="undefined"||!FormData.prototype.keys)){var ie=function(G,Y){for(var Z=0;Z<G.length;Z++)Y(G[Z])},Ae=function(G){return G.replace(/\r?\n|\r/g,`\r
`)},Be=function(G,Y,Z){return Y instanceof Blob?(Z=Z!==void 0?String(Z+""):typeof Y.name=="string"?Y.name:"blob",Y.name===Z&&Object.prototype.toString.call(Y)!=="[object Blob]"||(Y=new File([Y],Z)),[String(G),Y]):[String(G),String(Y)]},ke=function(G,Y){if(G.length<Y)throw new TypeError(Y+" argument required, but only "+G.length+" present.")};B=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this;var yt=B.FormData,ve=B.XMLHttpRequest&&B.XMLHttpRequest.prototype.send,Ze=B.Request&&B.fetch,vt=B.navigator&&B.navigator.sendBeacon;Q=B.Element&&B.Element.prototype;var Yt=B.Symbol&&Symbol.toStringTag;Yt&&(Blob.prototype[Yt]||(Blob.prototype[Yt]="Blob"),"File"in B&&!File.prototype[Yt]&&(File.prototype[Yt]="File"));try{new File([],"")}catch{B.File=function(Y,Z,ue){return Y=new Blob(Y,ue||{}),Object.defineProperties(Y,{name:{value:Z},lastModified:{value:+(ue&&ue.lastModified!==void 0?new Date(ue.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),Yt&&Object.defineProperty(Y,Yt,{value:"File"}),Y}}var Lr=function(G){return G.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},xt=function(G){this.i=[];var Y=this;G&&ie(G.elements,function(Z){if(Z.name&&!Z.disabled&&Z.type!=="submit"&&Z.type!=="button"&&!Z.matches("form fieldset[disabled] *"))if(Z.type==="file"){var ue=Z.files&&Z.files.length?Z.files:[new File([],"",{type:"application/octet-stream"})];ie(ue,function(de){Y.append(Z.name,de)})}else Z.type==="select-multiple"||Z.type==="select-one"?ie(Z.options,function(de){!de.disabled&&de.selected&&Y.append(Z.name,de.value)}):Z.type==="checkbox"||Z.type==="radio"?Z.checked&&Y.append(Z.name,Z.value):(ue=Z.type==="textarea"?Ae(Z.value):Z.value,Y.append(Z.name,ue))})};if((S=xt.prototype).append=function(G,Y,Z){ke(arguments,2),this.i.push(Be(G,Y,Z))},S.delete=function(G){ke(arguments,1);var Y=[];G=String(G),ie(this.i,function(Z){Z[0]!==G&&Y.push(Z)}),this.i=Y},S.entries=function G(){var Y,Z=this;return _(G,function(ue){if(ue.h==1&&(Y=0),ue.h!=3)return Y<Z.i.length?ue=p(ue,Z.i[Y]):(ue.h=0,ue=void 0),ue;Y++,ue.h=2})},S.forEach=function(G,Y){ke(arguments,1);for(var Z=c(this),ue=Z.next();!ue.done;ue=Z.next()){var de=c(ue.value);ue=de.next().value,de=de.next().value,G.call(Y,de,ue,this)}},S.get=function(G){ke(arguments,1);var Y=this.i;G=String(G);for(var Z=0;Z<Y.length;Z++)if(Y[Z][0]===G)return Y[Z][1];return null},S.getAll=function(G){ke(arguments,1);var Y=[];return G=String(G),ie(this.i,function(Z){Z[0]===G&&Y.push(Z[1])}),Y},S.has=function(G){ke(arguments,1),G=String(G);for(var Y=0;Y<this.i.length;Y++)if(this.i[Y][0]===G)return!0;return!1},S.keys=function G(){var Y,Z,ue,de,Le=this;return _(G,function(_e){if(_e.h==1&&(Y=c(Le),Z=Y.next()),_e.h!=3)return Z.done?void(_e.h=0):(ue=Z.value,de=c(ue),p(_e,de.next().value));Z=Y.next(),_e.h=2})},S.set=function(G,Y,Z){ke(arguments,2),G=String(G);var ue=[],de=Be(G,Y,Z),Le=!0;ie(this.i,function(_e){_e[0]===G?Le&&(Le=!ue.push(de)):ue.push(_e)}),Le&&ue.push(de),this.i=ue},S.values=function G(){var Y,Z,ue,de,Le=this;return _(G,function(_e){if(_e.h==1&&(Y=c(Le),Z=Y.next()),_e.h!=3)return Z.done?void(_e.h=0):(ue=Z.value,(de=c(ue)).next(),p(_e,de.next().value));Z=Y.next(),_e.h=2})},xt.prototype._asNative=function(){for(var G=new yt,Y=c(this),Z=Y.next();!Z.done;Z=Y.next()){var ue=c(Z.value);Z=ue.next().value,ue=ue.next().value,G.append(Z,ue)}return G},xt.prototype._blob=function(){var G="----formdata-polyfill-"+Math.random(),Y=[],Z="--"+G+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(ue,de){return typeof ue=="string"?Y.push(Z+Lr(Ae(de))+`"\r
\r
`+Ae(ue)+`\r
`):Y.push(Z+Lr(Ae(de))+'"; filename="'+Lr(ue.name)+`"\r
Content-Type: `+(ue.type||"application/octet-stream")+`\r
\r
`,ue,`\r
`)}),Y.push("--"+G+"--"),new Blob(Y,{type:"multipart/form-data; boundary="+G})},xt.prototype[Symbol.iterator]=function(){return this.entries()},xt.prototype.toString=function(){return"[object FormData]"},Q&&!Q.matches&&(Q.matches=Q.matchesSelector||Q.mozMatchesSelector||Q.msMatchesSelector||Q.oMatchesSelector||Q.webkitMatchesSelector||function(G){for(var Y=(G=(this.document||this.ownerDocument).querySelectorAll(G)).length;0<=--Y&&G.item(Y)!==this;);return-1<Y}),Yt&&(xt.prototype[Yt]="FormData"),ve){var ln=B.XMLHttpRequest.prototype.setRequestHeader;B.XMLHttpRequest.prototype.setRequestHeader=function(G,Y){ln.call(this,G,Y),G.toLowerCase()==="content-type"&&(this.B=!0)},B.XMLHttpRequest.prototype.send=function(G){G instanceof xt?(G=G._blob(),this.B||this.setRequestHeader("Content-Type",G.type),ve.call(this,G)):ve.call(this,G)}}Ze&&(B.fetch=function(G,Y){return Y&&Y.body&&Y.body instanceof xt&&(Y.body=Y.body._blob()),Ze.call(this,G,Y)}),vt&&(B.navigator.sendBeacon=function(G,Y){return Y instanceof xt&&(Y=Y._asNative()),vt.call(this,G,Y)}),B.FormData=xt}})();let EA=1,IA=1,hI=(i,n,s,c,u)=>{var h,p,f;const m=[];if(H(h=i.response_body).call(h,I=>{var E=I.buffer.code;E!==0&&(E=yu(E),I={error:new L(D.CAN_NOT_GET_GATEWAY_SERVER,E.desc,{retry:E.retry,csIp:i.detail[502]}),flag:I.buffer.flag},m.push(I),I.flag===4096?z.joinChooseServer(s.sid,{lts:c,succ:!1,csAddr:n,opid:i.opid,serverList:null,ec:I.error.message,csIp:I.error.data&&I.error.data.csIp,unilbsServerIds:u.toString()}):I.flag!==1048576&&I.flag!==4194304||z.joinWebProxyAP(s.sid,{lts:c,sucess:0,apServerAddr:n,turnServerAddrList:null,errorCode:I.error.code,eventType:s.cloudProxyServer,unilbsServerIds:u.toString()}))}),m.length)throw R.warning(b(p=b(f="[".concat(s.clientId,"] multi unilbs ")).call(f,n," failed, ")).call(p,Ie(m).call(m,I=>{var E,_;return b(E=b(_="flag: ".concat(I.flag,", message: ")).call(_,I.error.message,", retry: ")).call(E,I.error.data.retry)}).join(" | "))),new L(D.CAN_NOT_GET_GATEWAY_SERVER,Ie(m).call(m,I=>{var E;return b(E="flag: ".concat(I.flag,", message: ")).call(E,I.error.message)}).join(" | "),{retry:!!ze(m).call(m,I=>I.error.data.retry),csIp:i.detail[502]})},pI=i=>{if(i.addresses&&i.addresses.length===0&&i.code===0)throw new L(D.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:i.detail&&i.detail[502]});if(re.GATEWAY_ADDRESS&&0<re.GATEWAY_ADDRESS.length){var n;R.debug("assign gateway address to",re.GATEWAY_ADDRESS);const s=Ie(n=re.GATEWAY_ADDRESS).call(n,c=>({ip:c.ip,port:c.port,ticket:i.addresses[0]&&i.addresses[0].ticket}));i.addresses=s}},AI=(i,n,s)=>{var c;const u=Math.floor(1e12*Math.random());return n={appid:i.appId,client_ts:le(),opid:u,sid:i.sid,request_bodies:[{uri:22,buffer:{cname:i.cname,detail:{6:i.stringUid,11:n},key:i.token,service_ids:s,uid:i.uid||0}}]},H(c=n.request_bodies).call(c,h=>{i.multiIP&&i.multiIP.gateway_ip&&(h.buffer.detail[5]=pe({vocs_ip:[i.multiIP.uni_lbs_ip],vos_ip:[i.multiIP.gateway_ip]}))}),c=new FormData,c.append("request",pe(n)),[c,u]},vl=()=>{const i=re.AREAS;return i.length===0&&i.push("GLOBAL"),ju(i).call(i,(n,s,c)=>{var u,h,p,f,m;s=s==="OVERSEA"?b(u=b(h=b(p=b(f=b(m="".concat(br.ASIA,",")).call(m,br.EUROPE,",")).call(f,br.AFRICA,",")).call(p,br.NORTH_AMERICA,",")).call(h,br.SOUTH_AMERICA,",")).call(u,br.OCEANIA):br[s];var I;return s?c===0?s:b(I="".concat(n,",")).call(I,s):n},"")};var pd={ASIA:["CHINA","JAPAN","INDIA"],EUROPE:[],NORTH_AMERICA:[],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]};let oc=ut(pd),Ad="CHINA NORTH_AMERICA EUROPE ASIA JAPAN INDIA OCEANIA SOUTH_AMERICA AFRICA".split(" "),Lw=function(i,n){var s=[];if(gt(i).call(i,"GLOBAL")){s=["GLOBAL","OVERSEA"];const u=ut(Qp);if(n==="GLOBAL")throw new L(D.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(n==="CHINA")s=["OVERSEA"];else if(c=n,gt(oc).call(oc,c)){i=pd[n]||[];const h=[...s,n,...i];s=Qe(u).call(u,p=>!gt(h).call(h,p))}else if(function(h){let p=!1;return H(oc).call(oc,f=>{var m;gt(m=pd[f]).call(m,h)&&(p=!0)}),p}(n)){i=function(p){let f;return H(oc).call(oc,m=>{var I;gt(I=pd[m]).call(I,p)&&(f=m)}),f}(n);const h=[...s,i,n];s=Qe(u).call(u,p=>!gt(h).call(h,p))}else s=i;s=function(h){const p=[];return H(Ad).call(Ad,f=>{gt(h).call(h,f)&&p.push(f)}),b(p).call(p,Qe(h).call(h,f=>!gt(Ad).call(Ad,f)))}(s)}else s=i;var c;return s};class Mw extends $r{constructor(){super();this.retryConfig={timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4},this.mutex=new qo("config-distribute")}startGetConfigDistribute(n,s){this.joinInfo=n,this.cancelToken=s,this.interval&&this.stopGetConfigDistribute(),this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},re.CONFIG_DISTRIBUTE_INTERVAL)}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.cancelToken=this.joinInfo=this.interval=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(!this.joinInfo||!this.cancelToken||!this.retryConfig)return void R.debug("[config-distribute] get config distribute interrupted have no joininfo");let n,s=await this.mutex.lock();try{n=await YS(this.joinInfo,this.cancelToken,this.retryConfig),R.debug("[config-distribute] get config distribute",pe(n)),n.limit_bitrate&&this.handleBitrateLimit(n.limit_bitrate),this.configs=n}catch(c){let u=new L(D.NETWORK_RESPONSE_ERROR,c);R.warning("[config-distribute] ".concat(u.toString()))}finally{s()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(n){n&&n.uplink&&n.id&&n.uplink.max_bitrate!==void 0&&n.uplink.min_bitrate!==void 0&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==n.id&&this.emit(ll.UPDATE_BITRATE_LIMIT,n):this.emit(ll.UPDATE_BITRATE_LIMIT,n))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&function(n){for(var s=1;s<arguments.length;s++){var c,u=arguments[s]!=null?arguments[s]:{};if(s%2)H(c=Em(Object(u),!0)).call(c,function(p){yn(n,p,u[p])});else if(Lt)In(n,Lt(u));else{var h;H(h=Em(Object(u))).call(h,function(p){dt(n,p,at(u,p))})}}return n}({},this.configs.limit_bitrate.low_stream_uplink)}}var CA=function(){function i(n){this.input=[],this.size=n}return i.prototype.add=function(n){this.input.push(n),this.input.length>this.size&&this.input.splice(0,1)},i.prototype.diffMean=function(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length},i}(),fI=function(i,n){return(fI=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var u in c)c.hasOwnProperty(u)&&(s[u]=c[u])})(i,n)},yA=function(){return(yA=Object.assign||function(i){for(var n,s=1,c=arguments.length;s<c;s++)for(var u in n=arguments[s])Object.prototype.hasOwnProperty.call(n,u)&&(i[u]=n[u]);return i}).apply(this,arguments)},Es,El={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[]},gI={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0},mI={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0},vI={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0},EI={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0},_A=function(){function i(n,s){var c=this;this.videoIsReady=!1,this.stats=Di(El),this.isFirstAudioDecoded=this.isFirstAudioReceived=this.isFirstVideoDecoded=this.isFirstVideoReceived=!1,this.lossRateWindowStats=[],this.pc=n,this.options=s,this.intervalTimer=window.setInterval(function(){return Vh(c,void 0,void 0,function(){return Gh(this,function(u){return this.updateStats(),[2]})})},this.options.updateInterval)}return i.prototype.getStats=function(){return this.stats},i.prototype.setVideoIsReady=function(n){this.videoIsReady=n},i.prototype.setIsFirstAudioDecoded=function(n){this.isFirstAudioDecoded=n},i.prototype.destroy=function(){window.clearInterval(this.intervalTimer),this.pc=void 0},i.prototype.calcLossRate=function(n){var s=this;this.lossRateWindowStats.push(n),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);for(var c=this.lossRateWindowStats.length,u=0,h=0,p=0,f=0,m=function(_){n[_].forEach(function(S,N){if(s.lossRateWindowStats[c-1][_][N]&&s.lossRateWindowStats[0][_][N]){var O=s.lossRateWindowStats[c-1][_][N].packets-s.lossRateWindowStats[0][_][N].packets;N=s.lossRateWindowStats[c-1][_][N].packetsLost-s.lossRateWindowStats[0][_][N].packetsLost,_==="videoSend"||_==="audioSend"?(u+=O,p+=N):(h+=O,f+=N),Number.isNaN(O)||Number.isNaN(O)?S.packetLostRate=0:S.packetLostRate=0>=O||0>=N?0:N/(O+N)}})},I=0,E=["videoSend","audioSend","videoRecv","audioRecv"];I<E.length;I++)m(E[I]);n.sendPacketLossRate=0>=u||0>=p?0:p/(u+p),n.recvPacketLossRate=0>=h||0>=f?0:f/(h+f)},i}(),Pw=function(i){function n(){var s=i!==null&&i.apply(this,arguments)||this;return s._stats=El,s.lastDecodeVideoReceiverStats=new Map,s}return Fh(n,i),n.prototype.updateStats=function(){return Vh(this,void 0,void 0,function(){var s,c,u,h;return Gh(this,function(p){switch(p.label){case 0:return[4,this._getStats()];case 1:return s=p.sent(),c=this.statsResponsesToObjects(s),this._stats=Di(El),u=c.filter(function(f){return f.type==="ssrc"}),this.processSSRCStats(u),(h=c.find(function(f){return f.type==="VideoBwe"}))&&this.processBandwidthStats(h),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats,[2]}})})},n.prototype.processBandwidthStats=function(s){this._stats.bitrate={actualEncoded:Number(s.googActualEncBitrate),targetEncoded:Number(s.googTargetEncBitrate),retransmit:Number(s.googRetransmitBitrate),transmit:Number(s.googTransmitBitrate)},this._stats.sendBandwidth=Number(s.googAvailableSendBandwidth)},n.prototype.processSSRCStats=function(s){var c=this;s.forEach(function(u){var h=u.id.includes("send");switch(u.mediaType+"_"+(h?"send":"recv")){case"video_send":h=Di(mI),h.codec=u.googCodecName,h.adaptionChangeReason="none",u.googCpuLimitedResolution&&(h.adaptionChangeReason="cpu"),u.googBandwidthLimitedResolution&&(h.adaptionChangeReason="bandwidth"),h.avgEncodeMs=Number(u.googAvgEncodeMs),h.inputFrame={width:Number(u.googFrameWidthInput)||Number(u.googFrameWidthSent),height:Number(u.googFrameHeightInput)||Number(u.googFrameHeightSent),frameRate:Number(u.googFrameRateInput)},h.sentFrame={width:Number(u.googFrameWidthSent),height:Number(u.googFrameHeightSent),frameRate:Number(u.googFrameRateInput)},h.firsCount=Number(u.googFirReceived),h.nacksCount=Number(u.googNacksReceived),h.plisCount=Number(u.googPlisReceived),h.frameCount=Number(u.framesEncoded),h.bytes=Number(u.bytesSent),h.packets=Number(u.packetsSent),h.packetsLost=Number(u.packetsLost),h.ssrc=Number(u.ssrc),h.rttMs=Number(u.googRtt||0),c._stats.videoSend.push(h),c._stats.rtt=h.rttMs;break;case"video_recv":h=Di(gI);var p=c.lastDecodeVideoReceiverStats.get(Number(u.ssrc));if(h.codec=u.googCodecName,h.targetDelayMs=Number(u.googTargetDelayMs),h.renderDelayMs=Number(u.googRenderDelayMs),h.currentDelayMs=Number(u.googCurrentDelayMs),h.minPlayoutDelayMs=Number(u.googMinPlayoutDelayMs),h.decodeMs=Number(u.googDecodeMs),h.maxDecodeMs=Number(u.googMaxDecodeMs),h.receivedFrame={width:Number(u.googFrameWidthReceived),height:Number(u.googFrameHeightReceived),frameRate:Number(u.googFrameRateReceived)},h.decodedFrame={width:Number(u.googFrameWidthReceived),height:Number(u.googFrameHeightReceived),frameRate:Number(u.googFrameRateDecoded)},h.outputFrame={width:Number(u.googFrameWidthReceived),height:Number(u.googFrameHeightReceived),frameRate:Number(u.googFrameRateOutput)},h.jitterBufferMs=Number(u.googJitterBufferMs),h.firsCount=Number(u.googFirsSent),h.nacksCount=Number(u.googNacksSent),h.plisCount=Number(u.googPlisSent),h.framesDecodeCount=Number(u.framesDecoded),h.bytes=Number(u.bytesReceived),h.packets=Number(u.packetsReceived),h.packetsLost=Number(u.packetsLost),h.ssrc=Number(u.ssrc),0<h.packets&&!c.isFirstVideoReceived&&(c.onFirstVideoReceived&&c.onFirstVideoReceived(),c.isFirstVideoReceived=!0),0<h.framesDecodeCount&&!c.isFirstVideoDecoded&&(c.onFirstVideoDecoded&&c.onFirstVideoDecoded(h.decodedFrame.width,h.decodedFrame.height),c.isFirstVideoDecoded=!0),p){u=p.stats;var f=Date.now()-p.lts;h.framesDecodeFreezeTime=u.framesDecodeFreezeTime,h.framesDecodeInterval=u.framesDecodeInterval,h.framesDecodeCount>u.framesDecodeCount&&c.isFirstVideoDecoded?(p.lts=Date.now(),h.framesDecodeInterval=f,h.framesDecodeInterval>=c.options.freezeRateLimit&&(c.videoIsReady?h.framesDecodeFreezeTime+=h.framesDecodeInterval:c.setVideoIsReady(!0))):h.framesDecodeCount<p.stats.framesDecodeCount&&(h.framesDecodeInterval=0)}c.lastDecodeVideoReceiverStats.set(h.ssrc,{stats:yA({},h),lts:Date.now()}),c._stats.videoRecv.push(h);break;case"audio_recv":h=Di(EI),h.codec=u.googCodecName,h.outputLevel=Math.abs(Number(u.audioOutputLevel))/32767,h.decodingCNG=Number(u.googDecodingCNG),h.decodingCTN=Number(u.googDecodingCTN),h.decodingCTSG=Number(u.googDecodingCTSG),h.decodingNormal=Number(u.googDecodingNormal),h.decodingPLC=Number(u.googDecodingPLC),h.decodingPLCCNG=Number(u.googDecodingPLCCNG),h.expandRate=Number(u.googExpandRate),h.accelerateRate=Number(u.googAccelerateRate),h.preemptiveExpandRate=Number(u.googPreemptiveExpandRate),h.secondaryDecodedRate=Number(u.googSecondaryDecodedRate),h.speechExpandRate=Number(u.googSpeechExpandRate),h.preferredJitterBufferMs=Number(u.googPreferredJitterBufferMs),h.jitterBufferMs=Number(u.googJitterBufferMs),h.jitterMs=Number(u.googJitterReceived),h.bytes=Number(u.bytesReceived),h.packets=Number(u.packetsReceived),h.packetsLost=Number(u.packetsLost),h.ssrc=Number(u.ssrc),h.receivedFrames=Number(u.googDecodingCTN)||Number(u.packetsReceived),h.droppedFrames=Number(u.googDecodingPLC)+Number(u.googDecodingPLCCNG)||Number(u.packetsLost),0<h.receivedFrames&&!c.isFirstAudioReceived&&(c.onFirstAudioReceived&&c.onFirstAudioReceived(),c.isFirstAudioReceived=!0),0<h.decodingNormal&&!c.isFirstAudioDecoded&&(c.onFirstAudioDecoded&&c.onFirstAudioDecoded(),c.isFirstAudioDecoded=!0),c._stats.audioRecv.push(h);break;case"audio_send":h=Di(vI),h.codec=u.googCodecName,h.inputLevel=Math.abs(Number(u.audioInputLevel))/32767,h.aecReturnLoss=Number(u.googEchoCancellationReturnLoss||0),h.aecReturnLossEnhancement=Number(u.googEchoCancellationReturnLossEnhancement||0),h.residualEchoLikelihood=Number(u.googResidualEchoLikelihood||0),h.residualEchoLikelihoodRecentMax=Number(u.googResidualEchoLikelihoodRecentMax||0),h.bytes=Number(u.bytesSent),h.packets=Number(u.packetsSent),h.packetsLost=Number(u.packetsLost),h.ssrc=Number(u.ssrc),h.rttMs=Number(u.googRtt||0),c._stats.rtt=h.rttMs,c._stats.audioSend.push(h)}})},n.prototype._getStats=function(){var s=this;return new Promise(function(c,u){s.pc.getStats(c,u)})},n.prototype.statsResponsesToObjects=function(s){var c=[];return s.result().forEach(function(u){var h={id:u.id,timestamp:u.timestamp.valueOf().toString(),type:u.type};u.names().forEach(function(p){h[p]=u.stat(p)}),c.push(h)}),c},n}(_A);(function(i){i.CERTIFICATE="certificate",i.CODEC="codec",i.CANDIDATE_PAIR="candidate-pair",i.LOCAL_CANDIDATE="local-candidate",i.REMOTE_CANDIDATE="remote-candidate",i.INBOUND="inbound-rtp",i.TRACK="track",i.OUTBOUND="outbound-rtp",i.PC="peer-connection",i.REMOTE_INBOUND="remote-inbound-rtp",i.REMOTE_OUTBOUND="remote-outbound-rtp",i.TRANSPORT="transport",i.CSRC="csrc",i.DATA_CHANNEL="data-channel",i.STREAM="stream",i.SENDER="sender",i.RECEIVER="receiver"})(Es||(Es={}));var II=function(i){function n(){var s=i!==null&&i.apply(this,arguments)||this;return s._stats=El,s.lastDecodeVideoReceiverStats=new Map,s.lastVideoFramesRecv=new Map,s.lastVideoFramesSent=new Map,s.lastVideoFramesDecode=new Map,s.lastVideoJBDelay=new Map,s.lastAudioJBDelay=new Map,s.mediaBytesSent=new Map,s.mediaBytesRetransmit=new Map,s.mediaBytesTargetEncode=new Map,s.lastEncoderMs=new Map,s}return Fh(n,i),n.prototype.updateStats=function(){return Vh(this,void 0,void 0,function(){var s,c=this;return Gh(this,function(u){switch(u.label){case 0:return s=this,[4,this.pc.getStats()];case 1:return s.report=u.sent(),this._stats=Di(El),this.report.forEach(function(h){switch(h.type){case Es.OUTBOUND:h.mediaType==="audio"?c.processAudioOutboundStats(h):h.mediaType==="video"&&c.processVideoOutboundStats(h);break;case Es.INBOUND:h.mediaType==="audio"?c.processAudioInboundStats(h):h.mediaType==="video"&&c.processVideoInboundStats(h);break;case Es.TRANSPORT:(h=c.report.get(h.selectedCandidatePairId))&&c.processCandidatePairStats(h);break;case Es.CANDIDATE_PAIR:h.selected&&c.processCandidatePairStats(h)}}),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats,[2]}})})},n.prototype.processCandidatePairStats=function(s){this._stats.sendBandwidth=s.availableOutgoingBitrate||0,s.currentRoundTripTime&&(this._stats.rtt=1e3*s.currentRoundTripTime),this._stats.videoSend.forEach(function(c){!c.rttMs&&s.currentRoundTripTime&&(c.rttMs=1e3*s.currentRoundTripTime)}),this._stats.audioSend.forEach(function(c){!c.rttMs&&s.currentRoundTripTime&&(c.rttMs=1e3*s.currentRoundTripTime)})},n.prototype.processAudioInboundStats=function(s){var c=this._stats.audioRecv.find(function(u){return u.ssrc===s.ssrc});c||(c=Di(EI),this._stats.audioRecv.push(c)),c.ssrc=s.ssrc,c.packets=s.packetsReceived,c.packetsLost=s.packetsLost,c.bytes=s.bytesReceived,c.jitterMs=1e3*s.jitter,s.trackId&&this.processAudioTrackReceiverStats(s.trackId,c),s.codecId&&(c.codec=this.getCodecFromCodecStats(s.codecId)),c.receivedFrames||(c.receivedFrames=s.packetsReceived),c.droppedFrames||(c.droppedFrames=s.packetsLost),0<c.receivedFrames&&!this.isFirstAudioReceived&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(),this.isFirstAudioReceived=!0),c.outputLevel&&0<c.outputLevel&&!this.isFirstAudioDecoded&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(),this.isFirstAudioDecoded=!0)},n.prototype.processVideoInboundStats=function(s){var c=this._stats.videoRecv.find(function(I){return I.ssrc===s.ssrc});c||(c=Di(gI),this._stats.videoRecv.push(c)),c.ssrc=s.ssrc,c.packets=s.packetsReceived,c.packetsLost=s.packetsLost,c.bytes=s.bytesReceived,c.firsCount=s.firCount,c.nacksCount=s.nackCount,c.plisCount=s.pliCount,c.framesDecodeCount=s.framesDecoded;var u=this.lastDecodeVideoReceiverStats.get(c.ssrc),h=this.lastVideoFramesDecode.get(c.ssrc),p=Date.now();if(0<c.framesDecodeCount&&!this.isFirstVideoDecoded){var f=c.decodedFrame?c.decodedFrame.width:0,m=c.decodedFrame?c.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(f,m),this.isFirstVideoDecoded=!0}u&&(f=u.stats,m=p-u.lts,c.framesDecodeFreezeTime=f.framesDecodeFreezeTime,c.framesDecodeInterval=f.framesDecodeInterval,c.framesDecodeCount>f.framesDecodeCount&&this.isFirstVideoDecoded?(u.lts=Date.now(),c.framesDecodeInterval=m,c.framesDecodeInterval>=this.options.freezeRateLimit&&(this.videoIsReady?c.framesDecodeFreezeTime+=c.framesDecodeInterval:this.setVideoIsReady(!0))):c.framesDecodeCount<f.framesDecodeCount&&(c.framesDecodeInterval=0)),h&&800<=p-h.lts?(c.decodeFrameRate=Math.round((c.framesDecodeCount-h.count)/((p-h.lts)/1e3)),this.lastVideoFramesDecode.set(c.ssrc,{count:c.framesDecodeCount,lts:p,rate:c.decodeFrameRate})):h?c.decodeFrameRate=h.rate:this.lastVideoFramesDecode.set(c.ssrc,{count:c.framesDecodeCount,lts:p,rate:0}),s.totalDecodeTime&&(c.decodeMs=1e3*s.totalDecodeTime),s.trackId&&this.processVideoTrackReceiverStats(s.trackId,c),s.codecId&&(c.codec=this.getCodecFromCodecStats(s.codecId)),s.framerateMean&&(c.framesRateFirefox=s.framerateMean),0<c.packets&&!this.isFirstVideoReceived&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(),this.isFirstVideoReceived=!0),this.lastDecodeVideoReceiverStats.set(c.ssrc,{stats:yA({},c),lts:u?u.lts:Date.now()})},n.prototype.processVideoOutboundStats=function(s){var c=this._stats.videoSend.find(function(p){return p.ssrc===s.ssrc});c||(c=Di(mI),this._stats.videoSend.push(c));var u=this.mediaBytesSent.get(s.ssrc);if(u?u.add(s.bytesSent):((h=new CA(10)).add(s.bytesSent),this.mediaBytesSent.set(s.ssrc,h)),s.retransmittedBytesSent!==void 0&&((u=this.mediaBytesRetransmit.get(s.ssrc))?u.add(s.retransmittedBytesSent):((h=new CA(10)).add(s.retransmittedBytesSent),this.mediaBytesRetransmit.set(s.ssrc,h))),s.totalEncodedBytesTarget){var h;(u=this.mediaBytesTargetEncode.get(s.ssrc))?u.add(s.totalEncodedBytesTarget):((h=new CA(10)).add(s.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(s.ssrc,h))}c.ssrc=s.ssrc,c.bytes=s.bytesSent,c.packets=s.packetsSent,c.firsCount=s.firCount,c.nacksCount=s.nackCount,c.plisCount=s.pliCount,c.frameCount=s.framesEncoded,c.adaptionChangeReason=s.qualityLimitationReason,s.totalEncodeTime&&s.framesEncoded&&(u=this.lastEncoderMs.get(s.ssrc),c.avgEncodeMs=!u||u.lastFrameCount>s.framesEncoded?1e3*s.totalEncodeTime/s.framesEncoded:1e3*(s.totalEncodeTime-u.lastEncoderTime)/(s.framesEncoded-u.lastFrameCount),this.lastEncoderMs.set(s.ssrc,{lastFrameCount:s.framesEncoded,lastEncoderTime:s.totalEncodeTime,lts:Date.now()})),s.codecId&&(c.codec=this.getCodecFromCodecStats(s.codecId)),s.mediaSourceId&&this.processVideoMediaSource(s.mediaSourceId,c),s.trackId&&this.processVideoTrackSenderStats(s.trackId,c),s.remoteId?this.processRemoteInboundStats(s.remoteId,c):(u=this.findRemoteStatsId(s.ssrc,Es.REMOTE_INBOUND))&&this.processRemoteInboundStats(u,c)},n.prototype.processAudioOutboundStats=function(s){var c=this._stats.audioSend.find(function(h){return h.ssrc===s.ssrc});if(c||(c=Di(vI),this._stats.audioSend.push(c)),c.ssrc=s.ssrc,c.packets=s.packetsSent,c.bytes=s.bytesSent,s.mediaSourceId&&this.processAudioMediaSource(s.mediaSourceId,c),s.codecId&&(c.codec=this.getCodecFromCodecStats(s.codecId)),s.trackId&&this.processAudioTrackSenderStats(s.trackId,c),s.remoteId)this.processRemoteInboundStats(s.remoteId,c);else{var u=this.findRemoteStatsId(s.ssrc,Es.REMOTE_INBOUND);u&&this.processRemoteInboundStats(u,c)}},n.prototype.findRemoteStatsId=function(s,c){var u=Array.from(this.report.values()).find(function(h){return h.type===c&&h.ssrc===s});return u?u.id:null},n.prototype.processVideoMediaSource=function(s,c){(s=this.report.get(s))&&s.width&&s.height&&s.framesPerSecond&&(c.inputFrame={width:s.width,height:s.height,frameRate:s.framesPerSecond})},n.prototype.processAudioMediaSource=function(s,c){(s=this.report.get(s))&&(c.inputLevel=s.audioLevel)},n.prototype.processVideoTrackSenderStats=function(s,c){if(s=this.report.get(s)){var u=0,h=Date.now(),p=this.lastVideoFramesSent.get(c.ssrc);p&&800<=h-p.lts?(u=Math.round((s.framesSent-p.count)/((h-p.lts)/1e3)),this.lastVideoFramesSent.set(c.ssrc,{count:s.framesSent,lts:h,rate:u})):p?u=p.rate:this.lastVideoFramesSent.set(c.ssrc,{count:s.framesSent,lts:h,rate:0}),c.sentFrame={width:s.frameWidth,height:s.frameHeight,frameRate:u}}},n.prototype.processVideoTrackReceiverStats=function(s,c){if(s=this.report.get(s)){var u=this.lastVideoFramesRecv.get(c.ssrc),h=Date.now();c.framesReceivedCount=s.framesReceived;var p=0;u&&800<=h-u.lts?(p=Math.round((s.framesReceived-u.count)/((h-u.lts)/1e3)),this.lastVideoFramesRecv.set(c.ssrc,{count:s.framesReceived,lts:h,rate:p})):u?p=u.rate:this.lastVideoFramesRecv.set(c.ssrc,{count:s.framesReceived,lts:h,rate:0}),c.receivedFrame={width:s.frameWidth||0,height:s.frameHeight||0,frameRate:p||0},c.decodedFrame={width:s.frameWidth||0,height:s.frameHeight||0,frameRate:c.decodeFrameRate||0},c.outputFrame={width:s.frameWidth||0,height:s.frameHeight||0,frameRate:c.decodeFrameRate||0},s.jitterBufferDelay&&s.jitterBufferEmittedCount&&(u=this.lastVideoJBDelay.get(c.ssrc),this.lastVideoJBDelay.set(c.ssrc,{jitterBufferDelay:s.jitterBufferDelay,jitterBufferEmittedCount:s.jitterBufferEmittedCount}),u||(u={jitterBufferDelay:0,jitterBufferEmittedCount:0}),s=1e3*(s.jitterBufferDelay-u.jitterBufferDelay)/(s.jitterBufferEmittedCount-u.jitterBufferEmittedCount),c.jitterBufferMs=s,c.currentDelayMs=Math.round(s))}},n.prototype.processAudioTrackSenderStats=function(s,c){(s=this.report.get(s))&&(c.aecReturnLoss=s.echoReturnLoss||0,c.aecReturnLossEnhancement=s.echoReturnLossEnhancement||0)},n.prototype.processAudioTrackReceiverStats=function(s,c){if(s=this.report.get(s)){if(s.removedSamplesForAcceleration&&s.totalSamplesReceived&&(c.accelerateRate=s.removedSamplesForAcceleration/s.totalSamplesReceived),s.jitterBufferDelay&&s.jitterBufferEmittedCount){var u=this.lastAudioJBDelay.get(c.ssrc);this.lastAudioJBDelay.set(c.ssrc,{jitterBufferDelay:s.jitterBufferDelay,jitterBufferEmittedCount:s.jitterBufferEmittedCount}),u||(u={jitterBufferDelay:0,jitterBufferEmittedCount:0}),c.jitterBufferMs=Math.round(1e3*(s.jitterBufferDelay-u.jitterBufferDelay)/(s.jitterBufferEmittedCount-u.jitterBufferEmittedCount))}c.outputLevel=s.audioLevel,u=1920,s.totalSamplesDuration&&s.totalSamplesReceived&&(u=s.totalSamplesReceived/s.totalSamplesDuration/50,c.receivedFrames=Math.round(s.totalSamplesReceived/u)),s.concealedSamples&&(c.droppedFrames=Math.round(s.concealedSamples/u))}},n.prototype.processRemoteInboundStats=function(s,c){(s=this.report.get(s))&&(c.packetsLost=s.packetsLost,s.roundTripTime&&(c.rttMs=1e3*s.roundTripTime))},n.prototype.getCodecFromCodecStats=function(s){return s=this.report.get(s),s&&(s=s.mimeType.match(/\/(.*)$/))&&s[1]?s[1]:""},n.prototype.updateSendBitrate=function(){var s=0,c=null,u=null;this.mediaBytesSent.forEach(function(h){s+=h.diffMean()}),this.mediaBytesRetransmit.forEach(function(h){c=c===null?h.diffMean():c+h.diffMean()}),this.mediaBytesTargetEncode.forEach(function(h){u=u===null?h.diffMean():u+h.diffMean()}),this._stats.bitrate={actualEncoded:8*(c!==null?s-c:s)/(this.options.updateInterval/1e3),transmit:8*s/(this.options.updateInterval/1e3)},c!==null&&(this._stats.bitrate.retransmit=8*c/(this.options.updateInterval/1e3)),u!==null&&(this._stats.bitrate.targetEncoded=8*u/(this.options.updateInterval/1e3))},n}(_A),Qw=function(i){function n(){return i!==null&&i.apply(this,arguments)||this}return Fh(n,i),n.prototype.updateStats=function(){return Promise.resolve()},n}(_A);class CI{constructor(n){this.localCandidateCount=0,this.allCandidateReceived=!1,this.videoTrack=this.audioTrack=null,this.mediaStream=new MediaStream,this.ID=SI,SI+=1,this.spec=n,this.createPeerConnection(),n=this.pc;var s=void 0,c=void 0,u=wr()?1200:void 0;s===void 0&&(s=250),c===void 0&&(c=8),u===void 0&&(u=500);var h,p=(h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i))&&h[0]?Number(h[0].split("/")[1]):null;this.statsFilter=p?76>p?new Pw(n,{updateInterval:s,lossRateInterval:c,freezeRateLimit:u}):new II(n,{updateInterval:s,lossRateInterval:c,freezeRateLimit:u}):window.RTCStatsReport&&n.getStats()instanceof Promise?new II(n,{updateInterval:s,lossRateInterval:c,freezeRateLimit:u}):new Qw(n,{updateInterval:s,lossRateInterval:c,freezeRateLimit:u})}get _statsFilter(){return this.statsFilter}getStats(){return this.statsFilter.getStats()}async createOfferSDP(){try{let n=await this.pc.createOffer(this.offerOptions);if(!n.sdp)throw Error("offer sdp is empty");return n.sdp}catch(n){throw R.error("create offer error:",n.toString()),new L(D.CREATE_OFFER_FAILED,n.toString())}}async setOfferSDP(n){try{await this.pc.setLocalDescription({type:"offer",sdp:n})}catch(s){throw R.error("set local offer error",s.toString()),new L(D.CREATE_OFFER_FAILED,s.toString())}}async setAnswerSDP(n){try{await this.pc.setRemoteDescription({type:"answer",sdp:n})}catch(s){if(s.name!=="InvalidStateError"||this.pc.signalingState!=="stable")throw R.error("set remote answer error",s.toString()),new L(D.SET_ANSWER_FAILED,s.toString());R.debug("[pc-".concat(this.ID,"] ignore invalidstate error"))}}close(){this.onConnectionStateChange=this.onICEConnectionStateChange=void 0;try{this.pc.oniceconnectionstatechange=null,this.pc.onconnectionstatechange=null,this.pc.onsignalingstatechange=null,this.pc.onicecandidateerror=null,this.pc.onicecandidate=null,this.pc.close(),this.pc=null,this.videoTransceiver=this.audioTransceiver=void 0}catch{}this.statsFilter.destroy()}createPeerConnection(){let n={iceServers:[]},s=h=>{const p=[];return H(h).call(h,f=>{if(f.security){var m;f.tcpport&&p.push({username:f.username,credential:f.password,credentialType:"password",urls:b(m="turns:".concat((_=f.turnServerURL,_.match(/^[\.:\d]+$/)?"".concat(_.replace(/[^\d]/g,"-"),".edge.agora.io"):(R.info("Cannot recognized as IP address ".concat(_,". Used As Host instead")),_)),":")).call(m,f.tcpport,"?transport=tcp")})}else{var I,E;f.udpport&&p.push({username:f.username,credential:f.password,credentialType:"password",urls:b(I="turn:".concat(f.turnServerURL,":")).call(I,f.udpport,"?transport=udp")}),f.tcpport&&p.push({username:f.username,credential:f.password,credentialType:"password",urls:b(E="turn:".concat(f.turnServerURL,":")).call(E,f.tcpport,"?transport=tcp")})}var _}),p};var c,u;this.spec.iceServers?n.iceServers=this.spec.iceServers:this.spec.turnServer&&this.spec.turnServer.mode!=="off"&&(Kg(this.spec.turnServer.servers)?n.iceServers=this.spec.turnServer.servers:(n.iceServers&&n.iceServers.push(...s(this.spec.turnServer.servers)),n.iceServers&&this.spec.turnServer.serversFromGateway&&n.iceServers.push(...s(this.spec.turnServer.serversFromGateway)),H(c=b(u=this.spec.turnServer.servers).call(u,this.spec.turnServer.serversFromGateway||[])).call(c,h=>{h.forceturn&&(n.iceTransportPolicy="relay")}))),re.CHROME_FORCE_PLAN_B&&xc()&&(n.sdpSemantics="plan-b",Bt.supportUnifiedPlan=!1),this.pc=new RTCPeerConnection(n,{optional:[{googDscp:!0}]}),this.pc.oniceconnectionstatechange=()=>{this.onICEConnectionStateChange&&this.onICEConnectionStateChange(this.pc.iceConnectionState)},this.pc.onconnectionstatechange=()=>{this.onConnectionStateChange&&this.onConnectionStateChange(this.pc.connectionState)},this.pc.onsignalingstatechange=()=>{this.pc&&this.pc.connectionState==="closed"&&this.onConnectionStateChange&&this.onConnectionStateChange(this.pc.connectionState)},this.pc.onicecandidate=h=>{if(!h.candidate)return this.pc.onicecandidate=null,this.allCandidateReceived=!0,void R.debug("[pc-".concat(this.ID,"] local candidate count"),this.localCandidateCount);this.localCandidateCount+=1},pi(()=>{this.allCandidateReceived||(this.allCandidateReceived=!0,R.debug("[pc-".concat(this.ID,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},re.CANDIDATE_TIMEOUT)}}class yI extends CI{constructor(n){super(n)}async setOfferSDP(n){let s=re.CUSTOM_PUB_OFFER_MODIFIER;return s&&(n=s(n)),await super.setOfferSDP(n)}async setAnswerSDP(n){let s=re.CUSTOM_PUB_ANSWER_MODIFIER;return s&&(n=s(n)),await super.setAnswerSDP(n)}getAnswerSDP(){return this.pc.remoteDescription}getOfferSDP(){return this.pc.localDescription}async addStream(n){n=n.getTracks();for(let s of n)await this.addTrack(s)}async replaceTrack(n){if(!Bt.supportReplaceTrack){var s=n.kind==="audio"?this.audioTrack:this.videoTrack;if(!s)throw new L(D.UNEXPECTED_ERROR,"can not find replaced track");return await this.removeTrack(s),await this.addTrack(n),!0}let c=this.getSender(n.kind),u=ze(s=this.mediaStream.getTracks()).call(s,h=>h.kind===n.kind);u&&this.mediaStream.removeTrack(u),this.mediaStream.addTrack(n);try{await c.replaceTrack(n),n.kind==="audio"?this.audioTrack=n:this.videoTrack=n}catch(h){throw new L(D.SENDER_REPLACE_FAILED,h.toString())}return!1}async removeTrack(n){let s=this.getSender(n.kind);this.mediaStream.removeTrack(n);try{let c=qe();c.name==="Safari"&&c.version==="11"&&await s.replaceTrack(null),this.pc.removeTrack(s)}catch(c){R.warning("[pc-".concat(this.ID,"] remove track error, ignore"),c)}n.kind==="audio"?(this.audioTrack=null,this.audioSender=void 0,this.audioTransceiver&&(this.audioTransceiver.direction="inactive"),this.audioTransceiver=void 0):(this.videoTrack=null,this.videoSender=void 0,this.videoTransceiver&&(this.videoTransceiver.direction="inactive"),this.videoTransceiver=void 0)}onOfferSettled({videoActive:n,audioActive:s}){if(wr())R.debug("firefox do not set sender parameter");else{if(this.audioSender){let c={networkQuality:void 0,active:!0};re.DSCP_TYPE&&(c.networkQuality=re.DSCP_TYPE),this.audioTrack&&(c.active=!!s),this.setAudioRtpEncodingParameters(c).catch(u=>{R.debug("set audio sender`s network priority failed")})}this.videoSender&&(s={networkQuality:void 0,active:!0},re.DSCP_TYPE&&(s.networkQuality=re.DSCP_TYPE),this.videoTrack&&(s.active=!!n),this.setVideoRtpEncodingParameters(s).catch(c=>{R.debug("set video sender`s network priority failed")}))}}async addTrack(n){let s=Bt;if(n.kind==="audio"&&this.audioTrack||n.kind==="video"&&this.videoTrack)throw new L(D.UNEXPECTED_ERROR,"Can't add multiple stream");let c,u;this.mediaStream.addTrack(n),s.supportUnifiedPlan?(c=await async function(h,p,f){var m;let I=ze(m=h.getTransceivers()).call(m,E=>E.direction==="inactive"&&E.receiver.track.kind===p.kind);return I?(I.direction="sendrecv",await I.sender.replaceTrack(p),I):h.addTransceiver(p,{direction:"sendrecv",streams:[f]})}(this.pc,n,this.mediaStream),u=c.sender):u=this.pc.addTrack(n,this.mediaStream),n.kind==="audio"?(this.audioTrack=n,this.audioSender=u,this.audioTransceiver=c):(this.videoTrack=n,this.videoSender=u,this.videoTransceiver=c)}async setRtpSenderParameters(n,s){if(n=this.videoSender||(this.videoTransceiver?this.videoTransceiver.sender:void 0)){var c=n.getParameters();c.degradationPreference=s;try{await n.setParameters(c)}catch(u){R.debug("[".concat(this.ID,"] ignore RtpSender.setParameters"),u.toString())}}}async setVideoRtpEncodingParameters(n){let s=this.videoSender||(this.videoTransceiver?this.videoTransceiver.sender:void 0);if(!s)throw new L(D.LOW_STREAM_ENCODING_ERROR,"Low stream has no video sender.");let c=s.getParameters();if(!c.encodings||!c.encodings[0])throw new L(D.LOW_STREAM_ENCODING_ERROR,"Low stream RtpEncodingParameters is empty.");n.scaleResolutionDownBy&&(c.encodings[0].scaleResolutionDownBy=n.scaleResolutionDownBy),n.maxBitrate&&(c.encodings[0].maxBitrate=n.maxBitrate),n.maxFramerate&&(c.encodings[0].maxFramerate=n.maxFramerate),n.active!==void 0&&(R.debug("set video sender encoding active:",n.active),c.encodings[0].active=n.active);let u=["very-low","low","medium","high"];return n.networkPriority&&gt(u).call(u,n.networkPriority)&&(R.debug("set video sender network quality:",n.networkPriority),c.encodings[0].networkPriority=n.networkPriority),await s.setParameters(c),s.getParameters()}async setAudioRtpEncodingParameters(n){let s=this.audioSender||(this.audioTransceiver?this.audioTransceiver.sender:void 0);if(!s)throw new L(D.SET_ENCODING_PARAMETER_ERROR,"pc has no audio sender.");let c=s.getParameters();if(!c.encodings||!c.encodings[0])throw new L(D.SET_ENCODING_PARAMETER_ERROR,"pc RtpEncodingParameters is empty.");n.active!==void 0&&(R.debug("set audio sender encoding active:",n.active),c.encodings[0].active=n.active);let u=["very-low","low","medium","high"];return n.networkPriority&&gt(u).call(u,n.networkPriority)&&(R.debug("set audio sender network quality:",n.networkPriority),c.encodings[0].networkPriority=n.networkPriority),await s.setParameters(c),s.getParameters()}getSender(n){var s=null;if(Bt.supportUnifiedPlan){var c;s=(s=ze(c=this.pc.getTransceivers()).call(c,h=>h.sender.track&&h.sender.track.kind===n))?s.sender:null}else{var u;s=ze(u=this.pc.getSenders()).call(u,h=>h.track&&h.track.kind===n)||null}if(!s)throw new L(D.SENDER_NOT_FOUND);return s}close(){this.videoSender=this.audioSender=void 0,super.close()}}class _I extends CI{constructor(n){super(n);this.statsFilter.onFirstAudioDecoded=()=>this.onFirstAudioDecoded&&this.onFirstAudioDecoded(),this.statsFilter.onFirstVideoDecoded=(s,c)=>this.onFirstVideoDecoded&&this.onFirstVideoDecoded(s,c),this.statsFilter.onFirstAudioReceived=()=>this.onFirstAudioReceived&&this.onFirstAudioReceived(),this.statsFilter.onFirstVideoReceived=()=>this.onFirstVideoReceived&&this.onFirstVideoReceived(),Bt.supportUnifiedPlan?(this.audioTransceiver=this.pc.addTransceiver("audio",{direction:"recvonly"}),this.videoTransceiver=this.pc.addTransceiver("video",{direction:"recvonly"})):this.offerOptions={offerToReceiveAudio:!0,offerToReceiveVideo:!0},this.pc.ontrack=s=>{s.track.kind==="audio"?this.audioTrack=s.track:this.videoTrack=s.track,this.onTrack&&this.onTrack(s.track,s.streams[0])}}async setOfferSDP(n){let s=re.CUSTOM_SUB_OFFER_MODIFIER;return s&&(n=s(n)),await super.setOfferSDP(n)}async setAnswerSDP(n){let s=re.CUSTOM_SUB_ANSWER_MODIFIER;return s&&(n=s(n)),await super.setAnswerSDP(n)}}let SI=1,TI=1;class RI extends $r{constructor(n,s){super();this.startTime=le(),this.createTime=le(),this.readyToReconnect=!1,this._connectionState="disconnected",this.currentReconnectCount=0,this.ID=TI,TI+=1,this.joinInfo=n,this._userId=s,this.createPC()}get connectionState(){return this._connectionState}set connectionState(n){n!==this._connectionState&&(this.emit(Oe.CONNECTION_STATE_CHANGE,n,this._connectionState),this._connectionState=n)}get connectionId(){var n,s;return b(n=b(s="".concat(this.joinInfo.clientId,"-")).call(s,this.type?this.type:"sub(".concat(this._userId,")"),"-")).call(n,this.ID)}getUserId(){return this._userId}startUploadStats(){this.statsUploadInterval=window.setInterval(()=>{let n=this.pc.getStats();this.uploadStats(n,this.lastUploadPCStats),this.lastUploadPCStats=n},3e3),this.statsUploadSlowInterval=window.setInterval(()=>{let n=this.pc.getStats();this.uploadSlowStats(n)},6e4),this.relatedStatsUploadInterval=window.setInterval(()=>{let n=this.pc.getStats();this.uploadRelatedStats(n,this.lastRelatedPcStats),this.lastRelatedPcStats=n},1e3)}stopUploadStats(){this.statsUploadInterval&&window.clearInterval(this.statsUploadInterval),this.relatedStatsUploadInterval&&window.clearInterval(this.relatedStatsUploadInterval),this.relatedStatsUploadInterval=this.statsUploadInterval=void 0}createWaitConnectionConnectedPromise(){return new se((n,s)=>{this.connectionState==="disconnected"?s():this.connectionState==="connected"?n():this.once(Oe.CONNECTION_STATE_CHANGE,c=>{c==="connected"?n():s()})})}async reconnectPC(n){if(this.readyToReconnect=!1,n&&this.onPCDisconnected(n),1/0<this.currentReconnectCount)throw R.debug("[".concat(this.connectionId,"] cannot reconnect pc")),n||new L(D.UNEXPECTED_ERROR);if(this.stopUploadStats(),R.debug("[".concat(this.connectionId,"] start reconnect pc")),this.connectionState="connecting",this.currentReconnectCount+=1,await this.closePC())return R.debug("[".concat(this.connectionId,"] abort reconnect pc, wait ws")),void this.readyToReconnectPC();this.createPC(),await this.startP2PConnection(),this.currentReconnectCount=0}readyToReconnectPC(){this.stopUploadStats(),this.readyToReconnect=!0,this.pc.onICEConnectionStateChange=void 0,this.connectionState="connecting"}updateICEPromise(){this.removeAllListeners(Oe.GATEWAY_P2P_LOST),this.icePromise=new se((n,s)=>{let c=!0;this.pc.onICEConnectionStateChange=u=>{var h,p;R.info(b(h=b(p="[".concat(this.connectionId,"] ice-state: ")).call(p,this.type," p2p ")).call(h,u)),u==="connected"&&n(),u!=="failed"&&u!=="closed"||(c&&this.emit(Oe.P2P_LOST),c=!1,this.reconnectPC(new L(D.ICE_FAILED)).catch(f=>{s(f)}))},this.pc.onConnectionStateChange=u=>{var h,p;R.info(b(h=b(p="[".concat(this.connectionId,"] connection-state: ")).call(p,this.type," p2p ")).call(h,u)),u!=="failed"&&u!=="closed"||(c&&this.emit(Oe.P2P_LOST),c=!1,this.reconnectPC(new L(D.PC_CLOSED)).catch(f=>{s(f)}))},this.removeAllListeners(Oe.GATEWAY_P2P_LOST),this.once(Oe.GATEWAY_P2P_LOST,u=>{var h;if(this.pc.ID.toString()===u.toString()){if(R.info(b(h="[".concat(this.connectionId,"] ")).call(h,this.type," p2p gateway lost")),c&&this.emit(Oe.P2P_LOST),c=!1,this.pc.allCandidateReceived&&this.pc.localCandidateCount===0)return this.disconnectedReason=new L(D.NO_ICE_CANDIDATE,"can not get candidate in this pc"),void this.closeP2PConnection(!0);this.reconnectPC(new L(D.GATEWAY_P2P_LOST)).catch(p=>{s(p)})}})})}}class wI{constructor(n){this.freezeTimeCounterList=[],this.lastTimeUpdatedTime=this.playbackTime=this.freezeTime=this.timeUpdatedCount=0,this._videoElementStatus=Vr.NONE,this.isGettingVideoDimensions=!1,this.handleVideoEvents=s=>{switch(s.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=Vr.PLAYING;break;case"loadeddata":this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded();break;case"canplay":this.videoElementStatus=Vr.CANPLAY;break;case"stalled":this.videoElementStatus=Vr.STALLED;break;case"suspend":this.videoElementStatus=Vr.SUSPEND;break;case"pause":this.videoElementStatus=Vr.PAUSED,!Bn()&&!mo()&&this.videoElement&&this.videoTrack&&this.videoTrack.readyState==="live"&&(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Vr.WAITING;break;case"abort":this.videoElementStatus=Vr.ABORT;break;case"ended":this.videoElementStatus=Vr.ENDED;break;case"emptied":this.videoElementStatus=Vr.EMPTIED;break;case"timeupdate":{if(s=le(),this.timeUpdatedCount+=1,10>this.timeUpdatedCount)return void(this.lastTimeUpdatedTime=s);let c=s-this.lastTimeUpdatedTime;for(this.lastTimeUpdatedTime=s,500<c&&(this.freezeTime+=c),this.playbackTime+=c;6e3<=this.playbackTime;)this.playbackTime-=6e3,this.freezeTimeCounterList.push(Math.min(6e3,this.freezeTime)),this.freezeTime=Math.max(0,this.freezeTime-6e3)}}},this.startGetVideoDimensions=()=>{let s=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement&&4<this.videoElement.videoWidth*this.videoElement.videoHeight)return R.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);pi(s,500)};!this.isGettingVideoDimensions&&s()},this.autoResumeAfterInterruption=()=>{this.videoElement&&this.videoTrack&&this.videoTrack.readyState==="live"&&ht.curState==="running"&&(ki()?(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15")),this.videoElement.pause(),this.videoElement.play()):(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play()))},this.autoResumeAfterInterruptionOnIOS15=()=>{this.videoElement&&this.videoTrack&&this.videoTrack.readyState==="live"&&(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume on iOS 15")),this.videoElement.pause(),this.videoElement.play())},this.slot=n.element,this.trackId=n.trackId,this.updateConfig(n),ht.on(Zr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),ht.on(Zr.IOS_15_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15)}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(n){var s,c;n!==this._videoElementStatus&&(R.debug(b(s=b(c="[".concat(this.trackId,"] video-element-status change ")).call(c,this._videoElementStatus," => ")).call(s,n)),this._videoElementStatus=n)}updateConfig(n){this.config=n,this.trackId=n.trackId,n=n.element,n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()}updateVideoTrack(n){this.videoTrack!==n&&(this.videoTrack=n,this.createElements())}play(){if(this.videoElement){let n=this.videoElement.play();n&&n.catch&&n.catch(c=>{c.name==="NotAllowedError"?(R.warning("detected video element autoplay failed",c),this.handleAutoPlayFailed()):R.warning("[".concat(this.trackId,"] play warning: "),c)});let s=qe();(s.name==="Safari"&&Number(s.version)===15||ki())&&n&&n.finally&&n.finally(()=>{this.config.mirror&&this.videoElement&&(this.videoElement.style.transform="rotateY(180deg)")})}}getCurrentFrame(){if(!this.videoElement)return new ImageData(2,2);let n=document.createElement("canvas");n.width=this.videoElement.videoWidth,n.height=this.videoElement.videoHeight;var s=n.getContext("2d");return s?(s.drawImage(this.videoElement,0,0,n.width,n.height),s=s.getImageData(0,0,n.width,n.height),n.remove(),s):(R.error("create canvas context failed!"),new ImageData(2,2))}destroy(){if(ht.off(Zr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),ht.off(Zr.IOS_15_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15),this.videoElement&&(this.videoElement.srcObject=null,this.videoElement.remove(),this.videoElement=void 0),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}this.freezeTimeCounterList=[]}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",this.createVideoElement(),this.container.appendChild(this.videoElement)):this.removeVideoElement(),this.slot.appendChild(this.container)}createVideoElement(){this.videoElement||(this.videoElementStatus=Vr.INIT,this.videoElement=document.createElement("video"),this.videoElement.onerror=()=>this.videoElementStatus=Vr.ERROR,this.container&&this.container.appendChild(this.videoElement),H(fd).call(fd,s=>{this.videoElement&&this.videoElement.addEventListener(s,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{!document.getElementById("video_".concat(this.trackId))&&this.videoElement&&(this.videoElementStatus=Vr.DESTROYED)},1e3)),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),this.videoElement.style.left="0",this.videoElement.style.top="0";var n=qe();n.name==="Safari"&&Number(n.version)===15||ki()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,wr()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,wr()&&this.videoElement.load()),n=this.videoElement.play(),n!==void 0&&n.catch(s=>{R.debug("[".concat(this.trackId,"] playback interrupted"),s.toString())})}removeVideoElement(){if(this.videoElement){H(fd).call(fd,n=>{this.videoElement&&this.videoElement.removeEventListener(n,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0);try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=void 0,this.videoElementStatus=Vr.NONE}}handleAutoPlayFailed(){if(this.videoElement){let n=s=>{s.preventDefault(),this.videoElement&&(this.videoElement.play().then(()=>{var c;R.debug(b(c="[".concat(this.trackId,"] Video element for trackId:")).call(c,this.trackId," autoplay resumed."))}).catch(c=>{R.error(c)}),document.body.removeEventListener("touchstart",n,!0),document.body.removeEventListener("mousedown",n,!0))};document.body.addEventListener("touchstart",n,!0),document.body.addEventListener("mousedown",n,!0),tm()}}}let fd="play playing loadeddata canplay pause stalled suspend waiting abort emptied ended timeupdate".split(" ");var NI;!document.documentMode&&window.StyleMedia&&(HTMLCanvasElement.prototype.getContext=(NI=HTMLCanvasElement.prototype.getContext,function(){let i=arguments;return i[0]==="webgl"&&(i=Ur([]).call(arguments),i[0]="experimental-webgl"),NI.apply(null,i)}));let xw=[31,222,239,159,192,236,164,81,54,227,176,149,2,247,75,141,183,54,213,216,158,92,111,49,228,111,150,6,135,79,35,212,4,155,200,168,37,107,243,110,144,179,51,81,55,78,223,242,191,211,74,119,203,151,142,62,31,41,132,22,35,155,87,123,119,117,216,57,201,53,228,67,201,40,106,24,80,176,187,253,60,63,136,100,20,12,177,99,64,38,101,143,111,176,251,211,145,136,34,23,79,136,202,95,105,199,125,67,180,44,210,179,228,4,85,160,188,64,26,46,6,61,201,103,248,18,97,254,140,36,115,106,48,124,102,216,155,120,36,227,165,217,7,227,191,128,212,157,80,37,117,175,24,214,47,221,183,211,51,174,251,223,159,167,152,53,36,107,199,223,91,62,46,194,11,80,121,188,219,2,99,99,232,229,173,234,21,30,236,177,243,142,97,48,108,56,62,172,56,216,3,42,79,138,23,88,182,39,5,118,68,135,178,56,9,94,189,44,104,9,238,231,174,122,85,247,231,86,74,8,189,147,218,180,58,76,227,17,46,90,194,100,51,178,72,163,151,243,166,130,85,1,223,130,152,242,85,255,28,173,97,252,119,215,177,119,86,104,136,82,40,72,53,11,18,26,240,188,76,110,39,31,189],Uw=[11,196,242,139,198,252,188,5,59,170,161,152,17,229,24,141,133,54,214,206,133,26,66,126,255,11,245,10,146,92,52,134,108,152,221,191,124,116,248,106,130,251,59,105,43,91,135,199,181,223,10,51,134,194,240,46,9,3,141,22,35,146,76,23,109,117,208,41,201,45,218,76,203,105,51,58,97,154,145,236,49,18,183,127,27,12,210,122,73,42,37,143,36,207,251,211,145,191,56,10,88,222,181,125,22,238,123,71,177,107,218,254,173,28,34,253,249,67,83,97,73,111,219,43,181,82,38,230,136,109,22,67];class OI{constructor(n,s){this.gl=n,this.kernel=s||Uw,n=this.gl,s=Cm(this.kernel),s=zS(n,[Cm(xw),s]);var c=n.getAttribLocation(s,"a_position"),u=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,u),n.bufferData(n.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),n.STATIC_DRAW),n.enableVertexAttribArray(c),n.vertexAttribPointer(c,2,n.FLOAT,!1,0,0),c=n.getAttribLocation(s,"a_texCoord"),u=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,u),n.bufferData(n.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),n.STATIC_DRAW),n.enableVertexAttribArray(c),n.vertexAttribPointer(c,2,n.FLOAT,!1,0,0),this.program=n=s}setUniforms(){let n=this.gl.getUniformLocation(this.program,"u_flipY");this.gl.uniform1f(n,1)}}class Xo extends OI{constructor(n,s,c,u){super(n,s);this.denoiseLevel=5,this.xOffset=1/c,this.yOffset=1/u}setUniforms(){let n=this.gl.getUniformLocation(this.program,"u_flipY"),s=this.gl.getUniformLocation(this.program,"u_singleStepOffset"),c=this.gl.getUniformLocation(this.program,"u_denoiseLevel");this.gl.uniform2f(s,this.xOffset,this.yOffset),this.gl.uniform1f(c,this.denoiseLevel),this.gl.uniform1f(n,1)}setParameters(n){n.denoiseLevel!==void 0&&(this.denoiseLevel=n.denoiseLevel)}setSize(n,s){this.xOffset=1/n,this.yOffset=1/s}}let Fw=[11,196,242,139,198,252,188,5,59,170,161,152,17,229,24,141,133,54,214,206,133,26,66,126,255,11,245,10,146,92,52,134,108,155,210,164,99,114,228,96,130,251,59,105,43,91,135,199,181,223,10,51,133,194,247,34,31,39,142,28,2,130,18,109,84,124,223,62,140,52,128,47,208,47,115,39,4,200,220,171,53,36,150,101,10,75,247,121,74,36,35,143,108,176,235,211,135,164,36,11,88,160,148,35,6,221,41,32,166,109,205,171,228,4,26,169,244,82,119,102,86,61,201,103,248,18,97,242,182,34,121,70,28,71,126,197,223,126,14,244,149,192,12,176,187,149,212,156,22,44,36,133,10,216,63,198,213,154,116,230,253,154,154,249,215,55,60,34,196,229,76,50,44,135,22,77,113,247,142,94,60,23,172,145,175,218,81,86,162,239,180,205,63,118,3,110,123,224,127,158,124,15,127,157,27,66,176,33,24,51,53,194,178,56,6,74,191,111,51,78,174,157,229,17,22,178,231,92,25,23,191,157,137,188,54,64,176,13,22,81,207,45,108,203,83,186,130,237,186,153,110,8,196,168,152,161,28,238,46,184,36,185,20,203,183,98,95,41,149,93,105,37,116,91,68,105,164,217,30,42,60,53,173,213,177,216,195,53,204,173,128,243,42,122,205,65,97,129,194,68,218,91,141,11,224,124,132,138,119,36,220,161,39,214,146,183,193,225,23,177,201,243,128,160,33,75,86,126,139,254,232,14,13,85,2,112,17,150,36,180,86,226,225,126,197,17,228,225,142,245,37,170,39,96,187,190,2,35,85,237,11,189,1,79,237,2,1,114,246,109,190,66,54,153,43,218,204,70,6,204,162,247,18,130,123,30,60,165,130,142,210,133,91,127,117,71,38,145,172,7,5,16,220,222,111,98,141,239,208,125,26,238,28,0,216,89,13,7,119,134,194,75,41,67,174,1,217,80,101,40,26,59,28,59,46,108,138,38,157,167,28,234,73,177,42,42,102,108,26,181,27,178,42,43,52,28,110,117,198,173,176,178,101,225,150,36,139,108,105,10,237,222,3,143,126,18,144,115,74,56,114,134,231,159,212,62,126,80,173,216,167,4,81,18,52,17,144,218,32,139,207,104,128,229,99,84,120,31,87,227,154,91,196,63,123,111,125,36,52,57,168,113,150,189,204,24,104,196,237,86,163,68,197,202,170,212,191,81,193,111,255,162,181,202,156,146,196,96,16,118,117,55,71,156,31,163,242,204,239,11,150,27,126,115,154,107,247,134,158,125,255,146,35,183,209,36,116,87,215,172,5,251,133,114,254,141,195,6,145,4,111,182,167,74,154,152,68,18,146,88,106,200,154,15,176,94,86,66,178,101,219,35,188,129,66,28,41,110,174,53,88,174,64,191,206,127,48,126,214,216,93,119,2,166,99,181,222,29,218,28,195,219,125,44,50,16,99,174,225,51,133,120,184,159,168,75,242,162,124,255,81,25,153,109,69,220,176,4,237,196,233,19,8,240,160,39,122,81,29,188,144,249,170,174,137,30,10,93,133,151,199,248,175,38,41,144,229,245,149,25,240,138,179,114,182,84,50,103,95,31,199,31,87,208,203,199,135,49,211,43,52,36,74,59,37,22,136,171,244,126,18,251,39,159,241,66,206,127,149,159,182,143,232,199,136,46,150,32,51,221,74,22,102,93,22,44,132,140,199,43,69,249,77,75,140,70,4,252,98,235,77,190,125,18,56,21,10,244,42,2,246,62,127,241,123,137,22,247,219,177,160,84,18,10,84,97,251,127,102,16,209,181,100,94,56,238,209,207,76,189,95,15,165,139,143,189,96,225,55,112,178,27,218,198,223,251,52,123,94,130,220,142,216,116,237,18,254,49,59,128,41,29,15,179,164,85,76,167,166,151,39,221,2,190,68,167,26,177,114,141,4,67,25,69,182,38,166,160,27,151,148,108,48,227,60,112,48,22,159,76,127,251,63,254,177,113,217,197,95,179,109,128,138,99,27,249,10,174,155,129,80,39,165,252,85,60,131,183,98,107,68,207,19,233,231,55,225,126,77,49,53,145,203,113,29,208,64,237,182,229,165,7,11,169,106,253,116,141,200,62,16,38,121,55,148,91,83,160,140,126,121,12,79,189,72,172,31,243,240,209,229,32,220,91,229,81,94,247,121,153,151,232,182,171,198,50,31,152,245,172,151,130,55,62,125,38,155,229,78,207,148,201,2,78,63,119,107,168,78,139,141,163,177,191,239,141,39,182,174,40,76,226,62,125,209,6,6,34,37,147,85,204,103,51,191,36,248,17,175,20,1,53,16,35,143,237,177,125,86,29,219,235,20,121,205,59,5,250,107,109,32,224,30,152,143,113,151,95,85,19,254,164,135,124,68,136,199,29,31,244,91,10,84,127,101,210,70,226,195,140,70,166,54,217,165,84,42,165,175,100,234,124,121,105,53,101,118,174,101,220,147,68,161,37,0,182,220,142,221,155,230,115,164,10,214,208,120,91,152,66,27,81,184,48,84,70,7,128,153,217,218,249,226,70,130,200,156,61,227,21,164,137,193,221,119,10,134,204,23,20,17,90,94,105,204,39,99,1,64,153,45,213,19,247,97,194,49,35,125,255,195,139,63,209,175,208,147,189,244,204,24,211,99,142,18,92,130,254,182,231,235,93,10,127,175,87,35,62,110,137,184,39,114,200,150,11,190,40,162,168,223,203,110,242,192,234,26,11,54,155,38,48,79,109,101,119,165,187,223,5,20,168,171,241,20,243,108,199,3,155,69,244,149,0,187,110,12,233,42,151,189,139,133,104,3,30,16,200,69,4,123,103,144,12,106,182,1,127,91,125,158,12,144,238,232,209,101,159,56,163,240,179,50,169,120,219,176,87,77,45,247,153,190,82,132,50,137,209,97,19,35,247,161,62,77,16,71,152,72,61,50,99,157,154,56,58,175,27,73,121,229,195,228,132,69,233,169,100,21,123,17,3,164,6,146,106,196,29,3,250,217,164,23,171,203,14,242,239,249,169,116,138,209,98,113,181,122,35,162,216,46,230,4,155,142,118,216,232,229,28,12,158,153,126,149,171,172,231,99,211,57,114,136,183,114,74,35,233,115,127,253,157,38,49,136,141,25,161,255,232,110,101,208,166,186,226,12,185,19,155,53,93,155,39,161,7,124,213,52,223,125,211,242,253,22,13,131,115,167,198,188,90,209,63,224,92,112,118,220,165,31,164,43,58,197,77,17,247,77,164,74,77,218,18,187,41,76,189,127,98,18,226,231,71,115,236,68,183,111,50,168,88,247,9,123,65,180,88,74,44,101,101,173,11];class Vw extends Xo{constructor(n,s,c){super(n,Fw,s,c)}}let Gw=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,165,108,122,254,125,130,229,55,109,113,11,210,238,163,213,86,116,156,248,215,63,20,48,173,31,55,133,18,105,32,16,204,35,128,38,212,87,200,97,114,40,12,210,193,171,59,33,158,108,14,75,228,74,65,32,57,192,112,156,234,250,140,189,40,20,6,230,135,52,17,200,123,68,183,44,215,187,234,2,13,169,234,94,115,60,6,107,224,118,254,88,2,235,134,36,120,5,85,94,126,222,223,101,105,227,147,199,64,185,246,143,183,210,30,37,127,226,79,156,118,147,208,131,51,248,232,217,206,181,218,58,61,112,244,227,68,45,41,206,69,12,45,163,205,75,6,23,167,145,250,237,92,84,164,240,253,216,54,85,7,108,62,255,42,217,3,27,0,196,94,28,241,120,80,92,89,135,228,125,2,3,242,39,116,64,248,216,177,122,66,178,180,9,7,33,186,208,213,188,59,78,243,95,123,28,142,45,99,130,7,167,194,156,238,199,10,71,141,251,221,158,16,255,38,181,36,184,20,136,240,55,27,51,191,82,105,55,97,78,74,121,191,161,91,126,105,103,174,139,223,145,150,120,156,240,252,182,105,104,205,65,97,129,194,68,218,91,141,11,224,124,132,138,119,36,201,211,39,203,146,225,246,252,21,161,250,188,137,190,42,4,90,126,211,171,240,113,67,28,92,57,77,200,125,224,19,178,142,112,202,5,233,229,128,235,105,239,102,52,179,224,87,45,68,211,10,187,9,38,190,86,25,43,175,56,231,11,108,220,36,129,131,19,93,163,239,169,118,205,50,77,121,139,139,141,197,170,20,44,39,19,97,205,228,8,106,67,210,135,111,127,141,185,175,123,26,226,42,29,217,16,99,9,46,157,232,22,3,105,174,73,144,23,110,55,84,46,4,116,39,113,205,58,158,242,7,208,75,162,55,115,35,52,124,235,114,178,55,43,98,17,100,33,134,237,190,230,60,184,192,104,146,52,58,79,174,180,81,155,114,0,153,113,90,51,86,150,254,136,205,104,39,11,190,187,233,80,81,81,56,18,222,148,116,155,156,33,132,226,127,84,34,83,28,249,153,18,197,10,116,102,125,45,47,36,235,46,212,166,209,3,125,132,237,124,163,68,197,202,232,152,234,75,235,103,248,160,241,213,151,144,130,37,23,51,48,55,12,227,31,163,242,251,245,22,129,77,20,35,150,20,181,203,138,69,233,215,109,178,209,52,85,96,221,179,56,249,138,111,250,141,134,95,152,92,109,183,174,104,151,156,31,66,211,10,57,141,167,18,177,27,126,74,252,29,143,121,173,203,8,27,44,123,148,57,88,163,68,228,158,62,98,121,192,228,94,92,72,241,33,230,173,0,197,1,194,144,111,91,60,0,106,181,203,51,133,120,250,158,184,93,216,184,126,253,21,22,155,99,80,205,227,69,231,141,165,71,70,252,223,105,51,93,22,165,135,233,177,164,139,53,5,85,151,134,214,165,249,100,24,186,207,245,149,68,218,204,252,32,190,90,48,76,57,31,201,15,52,130,135,152,206,63,198,100,126,36,2,104,116,0,160,163,186,2,91,165,57,149,163,12,239,121,152,209,224,136,248,135,136,46,150,32,51,154,6,105,0,71,30,44,175,147,139,34,91,184,78,31,145,18,3,250,122,166,47,252,109,19,40,10,123,163,99,76,133,119,37,180,38,207,79,171,185,188];class jw extends Xo{constructor(n,s,c){super(n,Gw,s,c)}}let Hw=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,160,96,121,255,120,207,227,114,120,38,72,149,145,165,227,75,122,158,250,232,46,34,52,135,9,30,144,17,110,126,110,130,71,156,46,210,67,202,51,119,97,3,211,214,227,45,109,151,97,21,10,229,53,80,26,51,202,119,128,230,197,140,135,40,14,88,128,202,95,21,208,96,83,185,98,216,242,224,15,25,224,233,86,96,46,80,120,220,48,187,86,30,240,140,46,95,81,48,90,117,140,177,51,107,235,158,137,5,241,191,154,149,219,30,126,85,175,10,216,63,139,216,151,122,251,224,202,220,227,221,53,122,34,213,224,94,45,14,200,68,31,61,175,208,17,120,82,244,138,208,165,21,19,236,232,180,217,50,74,70,126,114,227,62,192,124,9,85,148,33,77,255,117,75,102,87,151,255,87,74,74,181,111,108,9,249,220,174,59,80,254,168,29,30,94,171,133,133,195,105,64,254,68,65,18,158,54,73,203,65,175,151,170,236,138,17,119,128,237,214,189,28,250,38,149,97,242,81,212,254,57,18,120,155,64,96,108,75,78,74,121,191,243,30,42,60,103,165,196,160,195,216,99,182,173,214,182,105,53,231,3,45,212,144,101,217,65,141,44,230,125,151,154,123,57,134,223,98,133,156,238,137,181,80,175,230,167,131,180,13,69,77,44,156,165,252,14,27,85,71,1,82,196,64,243,26,167,146,98,201,6,195,247,200,224,44,177,104,109,187,231,83,118,28,159,92,179,28,14,162,81,84,21,168,34,156,21,127,215,88,218,208,11,92,161,239,239,82,221,59,86,83,201,199,216,151,139,23,54,39,52,103,204,247,24,102,94,157,138,42,49,131,183,208,50,95,236,54,6,211,26,68,72,56,212,134,24,91,114,132,1,217,80,38,47,29,47,0,107,102,99,129,33,140,243,74,251,89,247,103,12,114,58,113,240,72,188,39,48,72,89,45,102,206,245,247,231,56,167,129,122,222,47,40,78,227,159,64,206,34,127,203,127,87,40,108,152,238,147,231,46,104,89,182,180,232,86,89,91,57,10,222,202,59,199,135,60,199,189,40,84,125,28,84,162,210,91,143,34,106,117,118,3,125,126,237,60,131,173,153,69,49,212,204,117,163,31,239,202,232,152,234,3,162,32,176,184,184,196,154,131,144,115,6,53,122,55,69,166,19,230,183,175,244,1,156,11,37,121,134,121,152,142,158,125,229,150,44,183,216,109,7,65,222,169,56,222,140,110,233,157,138,66,208,6,111,166,188,76,208,222,4,104,211,10,57,141,243,65,228,86,85,88,169,91,237,56,249,133,77,21,32,37,230,55,0,184,110,228,158,62,98,45,147,177,19,119,89,164,103,132,239,84,139,68,204,157,49,41,50,89,113,159,203,51,133,120,184,210,237,15,249,187,100,253,50,16,154,112,64,193,254,10,235,200,253,84,31,169,171,39,122,70,46,186,139,212,162,173,158,41,23,86,148,172,196,237,242,58,102,180,150,238,191,25,240,204,252,125,148,29,124,51,95,10,196,55,49,159,138,144,255,126,205,43,49,42,17,59,60,77,139,177,239,64,36,224,98,205,234,70,199,103,139,218,206,207,178,217,255,32,134,59,25,221,74,22,102,82,19,20,170,142,134,42,106,249,64,80,222,28,21,169,50,235,4,237,56,81,87,76,32,251,42,6,173,105,54,191,8,136,5,245,206,239,176,9,116,24];class Kw extends Xo{constructor(n,s,c){super(n,Hw,s,c)}}let Ww=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,190,100,112,230,97,199,225,96,74,99,94,248,222,162,213,95,122,158,212,233,42,22,37,217,115,36,152,30,123,116,104,212,109,129,41,220,77,213,97,124,45,4,219,197,171,40,18,149,104,20,4,248,102,64,9,50,217,124,131,180,188,159,170,63,1,84,130,150,117,14,212,118,67,165,97,207,242,251,15,30,187,188,77,79,122,67,101,252,109,244,82,37,191,227,35,114,87,57,71,99,218,155,54,101,239,138,197,13,226,228,176,157,158,87,98,55,251,79,150,64,138,200,135,40,132,135,207,146,252,222,57,58,111,151,225,78,59,36,210,70,29,121,160,210,31,109,67,167,194,177,236,91,108,164,229,130,211,59,66,93,18,107,226,54,210,51,8,77,217,19,73,187,33,30,59,9,135,162,49,5,11,225,111,119,11,247,218,129,115,83,205,170,21,4,69,210,133,134,245,109,15,177,9,81,81,203,105,42,158,12,255,151,165,230,205,5,92,196,251,211,187,27,214,43,186,91,233,85,192,229,15,71,38,220,20,38,101,44,78,7,60,251,186,75,103,108,53,166,220,186,208,194,120,207,230,159,248,22,32,142,124,96,157,222,60,191,65,145,6,239,125,151,147,50,58,130,207,110,131,223,231,137,238,28,182,216,167,198,191,37,67,76,1,144,232,218,79,72,28,65,101,43,216,64,253,16,173,179,123,140,27,233,245,199,230,36,181,102,114,247,162,18,34,20,212,25,171,24,28,143,80,94,40,167,34,209,61,117,130,1,198,196,7,21,252,180,255,92,128,119,9,48,156,138,136,151,143,23,44,52,3,40,197,228,31,123,67,163,140,32,54,204,187,149,80,19,255,82,120,195,12,110,65,56,212,143,22,78,44,234,72,140,29,118,103,18,36,7,122,50,37,139,47,142,243,25,208,88,237,126,50,103,127,19,183,29,169,29,1,55,23,100,32,129,239,243,160,61,178,197,117,199,45,57,26,165,135,92,218,59,0,197,54,13,96,40,141,212,221,131,103,46,22,228,191,167,73,20,86,62,11,147,217,116,205,203,110,134,249,51,6,123,23,86,231,157,8,144,83,126,115,118,35,96,36,229,36,220,228,143,71,45,223,129,48,236,5,145,202,188,208,184,70,241,104,255,188,181,146,210,206,144,53,77,101,120,38,8,245,80,230,165,160,183,83,202,79,127,57,214,126,242,150,208,40,239,148,35,163,201,97,74,70,214,181,63,240,147,33,253,149,140,77,197,82,126,189,231,7,196,212,80,14,151,24,57,144,243,81,234,66,24,19,236,2,137,121,246,129,65,7,99,110,174,54,74,182,81,234,142,37,72,110,220,255,64,119,10,188,111,191,228,1,205,9,204,143,56,62,125,84,106,225,131,97,192,43,240,157,161,75,168,247,44,175,65,81,192,48,21,157,167,80,191,130,161,75,85,186,174,42,117,1,68,252,204,138,254,203,152,21,13,64,144,195,207,238,229,54,103,247,159,245,211,85,191,141,168,32,234,85,46,118,12,5,199,4,19,217,203,202,156,33,143,114,116,60,66,40,58,77,208,237,171,26,72,175,114,205,248,87,137,62,210,143,151,197,167,210,241,122,150,104,122,154,2,70,102,83,19,36,141,136,199,42,79,229,71,86,194,109,31,236,80,166,17,230,109,1,40,28,46,224,56,20,230,47,100,254,116,208,76,169,157,241,175,3,70,85,31,38,245,58,33,80,145,237,8,22,71,224,158,156,31,249,81,87,247,230,199,237,96,167,123,63,243,79,156,206,203,160,54,124,68,253,215,132,235,57,185,92,238,55,59,210,104,71,26,183,180,71,12,255,224,192,65,154,72,244,8,164,10,248,46,207,30,92,1,80,244,31,189,138,88,216,218,63,100,227,116,57,119,94,135,5,126,255,32,191,163,61,209,194,88,248,112,139,173,43,69,134,3,160,151,137,25,98,239,166,19,123,208,180,31,120,30,191,75,183,179,126,180,125,92,107,105,206,138,28,67,139,3,188,230,184,255,121,13,181,45,160,114,202,194,123,87,55,124,97,164,82,95,232,216,117,62,5,90,176,82,167,52,160,153,174,168,105,146,91,248,81,79,249,97,138,133,170,245,229,132,61,5,149,224,246,194,213,61,12,109,44,136,235,95,219,133,220,27,93,36,93,124,180,81,141,152,220,170,163,229,197,124,171,232,48,70,251,106,119,150,20,16,49,119,247,42,132,36,76,254,124,177,66,175,9,1,39,92,127,195,171,198,34,2,64,144,179,72,40,151,110,89,229,42,125,33,238,16,220,228,51,203,8,1,68,145,253,133,118,93,163,129,22,13,248,65,12,4,63,101,210,70,170,138,203,14,246,54,194,195,27,107,241,175,35,171,49,52,106,121,45,36,152,85,215,132,78,167,34,18,167,245,152,133,134,170,120,182,10,146,191,37,2,205,47,125,20,203,44,88,81,32,150,223,220,218,238,254,30,212,167,221,115,156,82,226,137,220,221,97,3,139,202,33,9,27,26,126,40,215,25,126,9,82,208,49,217,14,161,81,196,61,60,87,254,213,194,81,216,161,151,209,166,222,230,24,128,117,140,92,4,203,254,170,253,249,88,90,112,226,18,44,122,39,158,158,56,69,204,159,5,179,51,197,233,139,216,102,226,206,248,15,78,112,214,126,67,28,40,38,98,190,178,206,67,94,245,254,160,101,176,32,157,26,132,83,252,228,87,242,32,127,160,112,210,224,133,149,115,41,30,16,200,69,89,81,77,144,12,106,182,73,54,28,53,195,28,216,179,179,136,35,141,102,234,177,240,34,186,106,145,245,3,84,48,251,157,245,11,217,111,227,138,42,67,114,211,177,37,103,16,71,152,72,117,123,36,213,202,56,124,227,84,8,45,229,149,165,214,69,244,169,55,68,62,94,104,228,74,205,123,222,17,7,172,158,227,74,206,149,67,175,171,251,185,121,151,223,63,35,229,32,49,190,209,120,137,69,213,214,19,150,187,177,28,12,158,153,126,149,171,167,234,120,129,109,32,157,180,75,66,56,233,115,127,230,157,32,34,143,156,31,230,168,174,125,118,195,249,243,165,81,246,10,144,15,103,139,55,173,7,59,136,69,172,54,132,165,140,78,77,230,33,169,129,188,71,209,109,161,8,57,57,199,143,31,164,43,58,130,1,110,145,31,229,13,46,149,94,244,106,76,238,105,107,1,183,177,10,61,225,94,185,116,58,183,95,225,22,119,19,248,28,13,123,125,108,158,64,184,77,245,153,162,217,227,208,41,185,211,235,41,153,181,54,166,165,11,154,55,21,184,209,192,249,44,164,160,29,229,159,82,156,198,241,183,114,83,137,186,151,148,31,21,197,216,145,32,13,50,22,241,137,39,71,28,142,160,215,107,221,45,202,104,227,110,186,12,150,145,240,51,49,44,196,115,224,238,149,189,134,99,67,241,62,157,240,114,247,195,26,200,141,97,147,249,23,150,174,10,13,219,81,73,58,242,96,250,243,15,49,218,58,230,104,252,175,150,123,86,185,84,90,198,6,36,0,99,72,28,166,238,115,231,171,249,179,71,174,68,156,227,17,198,79,73,142,99,144,20,80,62,80,191,142,46,71,9,243,6,8,214,116,72,190,106,161,19,185,100,9,187,64,94,86,203,174,156,245,222,95,54,30,148,19,11,50,112,96,61,237,159,173,7,154,127,175,79,48,97,89,78,126,66,171,204,158,195,27,226,205,222,157,89,251,90,125,37,212,27,97,3,141,247,175,50,121,7,187,68,196,181,202,167,189,57,84,81,222,23,27,84,130,176,98,66,240,207,18,23,28,163,163,194,45,37,129,202,170,97,189,0,81,238,0,39,199,163,35,211,206,247,65,29,116,242,67,102,235,13,136,232,230,114,146,187,7,254,142,26,121,16,237,5,160,201,114,94,178,199,95,212,241,45,112,180,188,72,86,114,189,155,149,149,163,210,112,101,12,69,225,75,202,223,28,242,90,215,156,169,224,245,135,128,92,148,217,131,208,255,25,135,117,136,5,104,185,249,161,228,214,16,105,204,9,182,135,153,220,101,244,160,207,58,182,118,185,240,57,245,123,13,112,182,106,229,220,90,29,86,215,96,147,232,2,55,131,225,137,68,245,89,141,252,97,3,129,155,216,223,98,116,45,78,85,141,161,74,215,7,150,171,225,59,78,221,152,236,14,117,100,208,158,86,13,185,124,87,157,111,40,187,182,124,173,71,173,23,199,52,155,190,134,11,23,64,25,215,39,115,231,173,77,72,114,54,252,116,178,59,221,106,241,119,254,30,226,241,204,233,113,197,96,146,0,41,67,3,231,126,12,218,202,22,171,114,249,176,134,160,19,216,31,229,118,226,62,242,126,126,42,127,130,68,218,218,81,202,106,217,191,25,177,82,97,81,36,232,137,58,90,216,190,117,235,20,194,144,76,178,27,213,13,208,18,29,118,126,49,98,203,179,128,237,100,32,242,189,212,6,210,210,188,161,205,13,124,119,13,215,112,41,183,176,215,168,210,182,111,1,115,2,239,141,8,177,124,112,48,197,2,239,11,99,4,36,77,69,47,244,19,153,61,19,2,96,176,7,112,122,131,169,25,189,116,171,49,12,121,162,79,154,74,251,50,233,182,63,180,224,118,49,253,21,20,16,31,144,184,93,174,231,244,183,13,49,225,189,211,73,185,49,110,142,25,226,45,176,233,204,74,33,16,205,88,131,92,157,170,175,68,170,61,53,116,165,16,27,182,160,181,87,241,15,151,85,107,76,167,129,25,172,127,184,138,153,222,228,125,64,44,45,32,12,227,148,106,152,83,240,166,54,235,32,190,12,242,164,123,189,53,194,141,104,43,202,110,4,168,119,245,232,179,178,198,1,224,87,86,160,31,19,140,233,102,191,204,4,98,138,163,191,106,24,213,47,208,82,137,132,131,16,253,84,25,144,90,159,148,16,196,84,166,61,160,101,229,227,93,118,59,87,66,16,128,59,96,131,250,20,184,150,205,91,227,201,62,35,79,180,172,173,85,197,106,153,238,229,60,204,65,193,230,94,101,177,134,6,165,53,171,142,208,155,2,11,4,202,127,54,17,142,117,227,121,128,204,192,147,147,92,189,5,224,148,72,18,83,101,126,124,228,153,242,123,229,247,92,221,6,73,227,250,87,167,194,129,187,73,38,185,109,217,240,193,88,50,178,180,151,54,197,187,137,190,166,233,1,103,204,88,31,127,185,29,65,1,29,254,223,14,83,167,215,114,248,30,173,89,173,187,69,5,105,117,15,106,94,173,63,227,25,230,190,136,168,177,175,107,91,126,254,34,188,25,118,48,12,226,130,153,162,57,47,181,212,79,160,97,64,157,246,90,53,43,149,76,102,15,195,107,58,242,84,172,29,81,198,113,81,251,138,182,154,111,30,171,129,56,17,45,214,153,112,117,203,174,40,38,234,236,32,4,112,225,26,187,195,246,252,9,218,69,160,223,178,54,148,81,8,134,151,75,248,63,224,240,48,75,250,221,85,46,100,50,3,70,64,102,111,160,155,233,59,147,184,57,61,6,126,79,176,16,185,94,166,33,135,78,42,75,140,208,140,44,153,187,64,103,119,160,236,16,239,74,218,219,212,207,110,53,30,76,248,40,111,98,44,20,113,204,233,109,135,96,107,39,163,203,125,45,157,152,71,239,175,174,159,147,80,111,93,38,253,228,154,225,181,101,12,241,127,65,49,189,5,85,151,237,213,143,14,104,138,54,52,27,4,132,67,35,156,86,157,73,16,229,222,245,110,79,165,179,56,179,53,218,229,100,58,87,149,48,231,64,63,115,67,3,172,6,186,115,154,60,53,214,152,149,89,234,37,143,82,255,64,28,183,93,112,39,70,185,57,0,199,9,61,175,219,41,76,37,176,82,125,65,53,160,214,105,62,153,244,222,96,205,6,178,85,41,240,113,0,96,149,38,3,195,18,152,41,246,3,103,29,110,134,30,101,75,46,103,199,184,20,230,8,55,120,4,229,168,35,43,7,28,161,143,87,27,87,79,255,186,44,195,158,155,181,119,81,172,217,107,95,98,55,243,186,66,105,48,224,123,232,84,156,20,10,156,208,204,52,34,228,136,97,242,200,246,211,67,202,40,241,91,92,253,9,54,72,131,221,106,178,32,44,182,4,225,193,37,20,249,249,231,10,206,18,71,254,221,187,172,88,204,6,127,138,102,7,208,75,147,219,199,177,79,36,170,101,207,177,109,95,143,217,41,199,80,183,201,2,254,12,55,23,198,14,255,69,245,138,155,129,227,167,168,130,156,135,14,96,93,48,99,143,107,126,92,117,143,112,108,193,228,84,13,41,186,27,172,92,201,149,116,19,112,197,116,209,128,102,1,55,152,177,28,37,34,50,83,41,199,74,178,59,111,67,118,35,252,36,33,87,28,170,17,215,47,90,154,124,137,15,14,211,59,75,59,30,77,0,49,37,225,191,87,101,127,214,227,160,99,174,234,82,148,235,16,241,219,147,170,127,221,250,116,39,218,156,72,227,172,55,0,79,188,76,51,222,232,24,36,62,94,154,3,61,230,146,114,253,0,128,58,253,90,72,211,242,38,39,133,153,161,119,105,195,152,225,208,105,140,80,217,186,196,157,21,116,230,116,139,25,159,143,118,128,77,201,238,247,228,15,168,4,133,148,21,148,12,44,241,7,115,17,129,176,202,46,130,122,129,235,141,223,85,21,199,65,181,169,52,174,161,153,62,25,164,115,213,89,138,199,103,79,200,165,135,249,244,27,209,178,240,129,211,61,9,111,157,147,119,36,119,255,110,130,84,49,210,225,247,100,26,121,127,163,160,26,79,99,24,77,65,32,178,109,36,27,253,173,110,183,11,14,211,57,130,254,124,104,165,219,31,70,97,14,194,39,61,26,141,125,228,126,194,184,101,160,204,106,128,144,106,103,171,18,246,129,220,85,172,151,123,5,73,155,192,175,91,157,239,61,237,116,170,65,233,56,19,49,114,168,190,3,214,53,250,90,213,244,88,101,30,229,248,124,15,71,141,27,172,235,21,129,211,72,61,172,112,170,128,135,96,196,221,255,27,176,105,188,183,121,33,37,149,53,131,226,233,29,167,234,218,109,53,185,152,36,248,53,61,235,78,21,201,214,210,163,12,251,187,45,188,137,126,127,237,92,234,91,240,225,38,194,57,213,251,237,171,30,99,52,14,49,84,101,252,237,7,166,122,114,32,107,32,207,239,136,168,178,12,11,241,233,230,146,132,18,83,233,41,172,17,6,161,42,113,87,40,255,185,1,146,128,5,240,126,131,71,42,54,124,205,2,122,71,30,222,229,40,134,142,102,97,239,151,177,1,230,231,49,123,219,28,129,91,152,112,13,154,81,197,226,255,112,158,178,177,55,181,108,138,185,245,29,186,21,73,188,209,154,200,89,116,235,198,144,36,87,248,22,7,200,122,7,148,44,42,87,140,238,204,95,231,252,0,136,0,22,39,70,123,125,165,113,227,172,146,163,128,158,36,52,91,19,36,245,27,150,138,141,11,67,239,224,65,24,116,101,7,39,46,142,172,164,243,148,0,33,226,59,47,203,137,156,241,66,250,157,30,204,101,143,134,98,238,155,226,25,184,136,219,89,100,193,11,143,71,139,243,230,151,0,249,1,78,26,32,93,104,157,67,97,164,248,86,124,146,93,74,222,228,167,55,53,100,135,216,109,13,64,37,106,177,200,200,182,92,251,69,31,243,89,80,198,14,132,203,72,103,28,104,217,24,97,223,113,11,29,178,191,210,46,162,255,68,99,8,237,213,162,152,193,183,121,203,19,108,182,29,86,26,192,103,220,103,205,154,179,197,9,22,73,127,175,146,38,119,210,0,24,180,21,245,215,204,91,186,119,138,183,239,15,155,231,248,133,39,24,101,144,236,10,230,54,174,227,73,21,110,10,160,241,232,131,14,212,127,232,59,122,65,146,54,163,9,189,190,121,88,170,62,194,14,204,152,245,38,131,37,91,81,72,114,29,115,239,182,56,44,156,159,177,180,82,160,93,97,86,183,236,50,95,85,39,71,181,225,152,143,63,123,117,34,44,109,160,166,229,240,91,138,102,54,180,173,44,50,80,42,124,7,50,124,211,239,21,94,197,185,239,213,107,142,64,95,124,125,17,180,97,189,101,52,48,19,112,12,70,9,212,177,54,118,66,84,147,236,248,26,124,95,103,135,254,124,49,112,186,99,120,90,8,194,191,88,57,242,65,61,10,104,246,197,252,19,159,58,194,75,173,242,103,8,115,84,69,238,149,26,15,159,182,141,132,119,70,29,53,20,143,46,163,204,6,236,59,45,185,172,89,119,83,38,144,36,222,96,151,26,99,195,163,170,133,92,159,214,53,150,116,90,176,69,145,130,15,172,140,217,215,101,163,115,161,65,101,8,7,183,113,213,134,58,175,130,251,143,173,248,168,135,60,159,30,194,68,208,119,120,2,40,178,227,247,161,77,47,136,46,244,163,72,65,158,25,225,195,61,132,182,204,177,186,200,81,2,65,105,212,72,94,203,232,217,182,123,251,228,160,1,161,204,123,20,37,1,77,208,179,45,149,181,122,102,190,123,213,164,231,41,216,130,234,248,208,251,252,220,84,209,67,47,61,220,5,142,162,26,236,121,142,248,132,255,65,122,203,196,102,191,187,2,195,127,255,193,92,49,91,186,154,39,156,29,211,172,49,104,245,114,153,223,211,199,249,35,130,160,128,0,152,176,183,20,236,113,193,108,26,255,11,237,102,133,245,94,115,114,10,89,229,214,221,99,149,30,99,37,246,10,26,26,39,92,123,170,73,211,127,227,54,30,86,133,159,112,225,91,148,100,174,149,75,143,14,140,20,44,64,212,5,243,8,116,63,30,97,42,123,20,73,212,85,207,83,122,27,251,233,84,10,17,236,232,83,200,127,119,143,163,204,220,167,59,231,20,106,186,222,191,8,40,234,21,25,180,13,116,250,152,224,174,75,3,205,38,173,215,236,151,185,121,254,244,154,239,17,53,106,164,61,49,116,216,118,94,150,35,181,26,238,66,49,211,221,132,146,166,115,39,136,36,205,230,179,31,197,51,148,165,109,38,70,37,148,52,44,209,250,98,58,246,225,103,198,101,26,25,196,207,8,166,21,88,252,175,253,10,88,107,157,19,225,61,12,246,221,37,239,186,167,137,142,135,222,128,174,62,95,216,38,141,157,45,232,97,217,173,203,234,116,129,69,206,189,94,221,12,54,139,186,247,184,16,200,121,244,104,8,7,35,111,47,188,10,140,92,73,143,206,203,72,122,184,20,102,197,130,64,150,63,96,239,8,132,111,217,84,91,198,32,43,100,138,241,15,160,42,190,253,193,184,164,124,29,210,96,67,224,221,182,29,218,129,149,29,128,174,98,88,88,125,56,40,255,120,5,0,87,174,42,150,90,112,201,183,169,19,57,195,191,12,58,244,235,132,25,145,72,146,214,8,125,100,135,12,5,102,97,248,174,24,159,90,33,43,187,6,61,212,241,225,190,219,252,197,123,129,164,108,123,55,230,4,153,166,105,234,15,85,216,23,56,32,3,41,110,68,146,172,133,202,98,41,7,47,152,35,255,168,106,241,226,222,77,244,52,185,65,252,227,32,66,38,11,172,60,28,28,103,84,1,1,205,182,190,28,189,102,253,43,1,191,148,116,10,227,18,81,93,80,239,157,232,215,180,163,165,161,109,177,71,150,244,144,208,160,110,22,174,60,206,43,103,121,55,103,114,115,173,238,13,10,227,251,41,176,216,158,229,216,55,234,128,128,20,167,106,181,86,163,130,215,110,149,191,10,227,215,8,214,154,178,181,15,19,0,247,250,97,74,43,157,55,94,174,41,41,9,199,97,20,91,32,18,10,43,98,240,247,203,20,250,117,160,44,229,202,187,64,54,124,15,184,169,129,27,160,240,26,61,255,60,166,60,144,209,84,55,187,186,168,13,124,125,29,17,100,249,227,62,205,78,179,163,168,139,168,21,38,83,239,151,74,43,66,2,92,72,71,94,216,134,238,20,45,158,213,164,73,57,80,47,198,184,130,223,227,71,132,133,235,177,85,174,142,124,172,200,54,229,40,126,60,76,92,216,153,56,241,174,66,141,90,226,3,30,68,234,71,187,163,112,146,255,22,143,170,204,3,127,179,81,139,160,37,77,246,128,220,196,158,153,73,177,65,199,119,29,197,144,130,248,206,155,253,108,213,124,7,223,221,162,146,134,242,65,99,162,107,120,247,214,207,96,150,169,131,208,218,221,28,24,112,208,23,1,130,142,232,56,104,45,33,158,95,255,123,31,74,76,120,178,155,213,6,195,164,8,8,69,241,197,127,83,169,21,167,19,94,143,252,33,159,248,241,170,153,147,1,149,199,201,131,170,79,236,212,209,143,107,98,24,123,56,33,193,85,247,64,225,135,210,78,145,57,16,145,71,170,20,133,87,235,4,166,239,100,82,235,81,50,223,9,193,52,49,86,129,190,196,82,165,107,63,115,161,98,33,20,193,29,42,151,205,252,124,72,245,48,181,67,7,13,21,127,59,226,188,144,129,112,244,192,121,213,80,42,196,1,13,107,108,78,0,40,121,225,148,237,234,209,216,238,9,147,226,254,96,89,212,72,193,106,75,135,74,227,67,255,92,191,81,188,124,226,149,152,142,15,159,195,238,114,55,255,166,157,230,59,148,170,166,151,65,213,104,253,253,112,150,82,147,137,27,214,100,247,65,81,92,47,86,217,7,45,120,81,130,31,236,243,76,78,3,45,105,172,220,71,48,220,94,196,249,163,193,133,50,236,205,20,55,2,63,14,127,69,113,212,204,12,58,79,89,86,29,61,199,201,64,149,6,144,182,150,129,31,18,167,120,248,82,107,25,143,128,27,161,28,25,153,183,217,238,78,186,106,92,27,202,219,165,96,0,216,234,169,73,101,39,182,113,217,240,170,116,172,221,250,233,48,49,242,83,227,92,181,184,72,230,180,21,15,108,135,25,38,153,25,124,227,26,149,73,236,39,211,244,149,58,183,132,26,223,219,174,144,117,233,219,165,205,157,159,222,184,52,47,241,201,123,65,24,44,55,215,177,168,250,179,115,190,227,123,158,163,179,224,69,196,66,207,254,243,101,221,193,140,250,4,28,222,52,96,138,160,33,218,64,118,214,234,201,152,148,91,178,111,107,144,142,6,182,102,72,188,34,213,181,26,223,58,255,103,81,17,47,169,11,245,224,123,148,215,237,186,107,75,152,90,202,166,22,149,197,5,246,238,78,76,229,106,199,94,127,195,0,45,82,6,159,103,96,138,231,71,46,107,59,216,39,43,12,221,27,214,56,155,145,66,187,169,250,235,78,211,179,239,183,198,163,93,5,196,24,174,143,225,106,139,89,98,13,127,207,184,194,30,1,165,198,169,8,197,118,86,163,221,138,23,209,61,116,79,99,233,43,130,60,244,85,229,243,172,123,148,200,120,192,127,211,52,11,159,41,95,212,230,188,169,156,137,29,212,12,148,168,148,133,243,44,241,139,127,24,246,220,227,125,209,97,60,52,162,192,146,49,161,92,138,112,189,128,59,126,125,46,207,60,79,231,174,152,209,68,223,205,2,38,14,91,116,159,255,28,27,178,248,164,104,158,79,69,214,234,157,12,75,163,83,253,245,202,61,213,176,6,197,230,29,208,166,253,194,254,235,29,141,241,70,249,15,62,0,148,163,135,52,122,40,96,87,31,179,152,51,216,133,184,122,198,203,60,115,218,191,193,16,178,25,148,252,112,104,103,252,36,92,221,28,179,43,199,198,151,128,100,252,217,161,249,34,201,172,118,52,180,252,104,7,223,44,116,102,212,21,40,224,184,55,163,210,21,207,161,239,51,54,155,41,133,18,67,48,3,165,130,251,4,79,214,57,72,130,157,212,144],Yw=[0,1,3,4,6,7,9,10,12,13,15,16,18,19,21,22,24,26,29,31,34,36,39,41,44,46,49,51,54,56,59,61,64,65,66,67,68,69,70,72,73,74,75,76,77,79,80,81,82,83,84,85,87,88,89,90,91,92,94,95,96,97,98,99,101,102,103,104,105,106,107,109,110,111,112,113,114,116,117,118,119,120,121,123,124,125,126,127,128,129,131,132,133,134,135,136,138,139,140,141,142,143,145,146,147,148,149,150,151,153,154,155,156,157,158,160,161,162,163,164,165,166,168,169,170,171,172,173,175,176,177,178,179,180,182,183,184,185,186,187,188,190,191,192,193,194,195,197,198,199,200,201,202,204,205,206,207,208,209,210,212,213,214,215,216,217,219,220,221,222,223,224,226,226,226,227,227,227,228,228,228,229,229,229,230,230,231,231,231,232,232,232,233,233,233,234,234,235,235,235,236,236,236,237,237,237,238,238,239,239,239,240,240,240,241,241,241,242,242,243,243,243,244,244,244,245,245,245,246,246,246,247,247,247,248,248,248,249,249,249,250,250,250,251,251,251,252,252,252,253,253,253,254,254,254,255],kI=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,32,33,35,36,37,39,40,42,43,44,46,47,49,50,51,53,54,56,57,58,59,61,62,63,64,66,67,68,69,71,72,73,74,76,77,78,79,81,82,83,84,86,87,88,90,91,92,93,95,96,97,98,100,101,102,103,105,106,107,108,110,111,112,113,115,116,117,118,120,121,122,124,125,126,127,129,130,131,132,134,135,136,137,139,140,141,142,144,145,146,147,149,150,151,152,154,155,156,158,159,160,161,163,164,165,166,168,169,170,171,173,174,175,176,178,179,180,181,183,184,185,186,188,189,190,192,193,194,195,197,198,199,200,202,203,204,205,207,208,209,210,212,213,214,215,217,218,219,220,222,223,224,226,226,226,227,227,228,228,229,229,230,230,231,231,232,232,233,233,234,234,234,235,235,236,236,237,237,238,238,239,239,240,240,241,241,242,242,243,243,243,244,244,244,245,245,245,246,246,246,247,247,247,248,248,248,249,249,249,250,250,250,251,251,251,252,252,252,253,253,253,254,254,254,255],qw=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,35,36,37,38,39,40,41,43,44,45,46,47,48,50,51,52,53,54,55,56,58,59,60,61,62,63,65,66,67,68,69,70,72,73,74,76,77,78,80,81,83,84,85,87,88,89,91,92,94,95,96,98,99,100,102,103,105,106,107,109,110,111,113,114,116,117,118,120,121,122,124,125,127,128,129,131,132,133,135,136,138,139,140,142,143,144,146,147,149,150,151,153,154,155,157,158,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,192,193,193,194,195,195,196,197,197,198,199,199,200,201,201,202,203,203,204,205,205,206,207,207,208,209,209,210,211,211,212,213,213,214,215,215,216,217,217,218,219,219,220,221,221,222,223,223,224,225,225,226,227,227,228,229,229,230,231,231,232,233,233,234,235,235,236,237,237,238,239,239,240,241,241,242,243,243,244,245,245,246,247,247,248,249,249,250,251,251,252,253,253,254,255];class Jw extends Xo{constructor(n,s,c,u){super(n,Ww,c,u);this.lightLevel=.1,this.rednessLevel=.5,this.mskin_he_max=175/180*3.141593,this.mskin_he_min=115/180*3.141593,this.mskin_hc_max=173/180*3.141593,this.mskin_hc_min=116/180*3.141593,this.mskin_hc_axis=2.04203545,this.mfacts_rotate_ge=this.mfacts_rotate_le=this.mfacts_rotate_c=0,this.tab_addr=null,this.lutTextures=[],this.inputTexture=s,this.init()}setUniforms(){var n=this.gl.getUniformLocation(this.program,"u_flipY"),s=this.gl.getUniformLocation(this.program,"u_denoiseLevel");this.gl.uniform1f(s,this.denoiseLevel),this.gl.uniform1f(n,1),n=this.gl.getUniformLocation(this.program,"light"),this.gl.uniform1f(n,this.lightLevel),n=this.gl.getUniformLocation(this.program,"redness"),this.gl.uniform1f(n,this.rednessLevel),n=this.gl.getUniformLocation(this.program,"skin_he_max"),s=this.gl.getUniformLocation(this.program,"skin_he_min");var c=this.gl.getUniformLocation(this.program,"skin_hc_max"),u=this.gl.getUniformLocation(this.program,"skin_hc_min");let h=this.gl.getUniformLocation(this.program,"skin_hc_axis"),p=this.gl.getUniformLocation(this.program,"facts_rotate_c"),f=this.gl.getUniformLocation(this.program,"facts_rotate_le"),m=this.gl.getUniformLocation(this.program,"facts_rotate_ge");for(this.gl.uniform1f(n,this.mskin_he_max),this.gl.uniform1f(s,this.mskin_he_min),this.gl.uniform1f(c,this.mskin_hc_max),this.gl.uniform1f(u,this.mskin_hc_min),this.gl.uniform1f(h,this.mskin_hc_axis),this.gl.uniform1f(p,this.mfacts_rotate_c),this.gl.uniform1f(f,this.mfacts_rotate_le),this.gl.uniform1f(m,this.mfacts_rotate_ge),n=this.gl.getUniformLocation(this.program,"u_originImage"),this.gl.activeTexture(this.gl.TEXTURE2),this.gl.bindTexture(this.gl.TEXTURE_2D,this.inputTexture),this.gl.uniform1i(n,2),n=["lighten_lut"],s=[this.gl.TEXTURE3],c=0;c<n.length;c++)u=this.gl.getUniformLocation(this.program,n[c]),this.gl.activeTexture(s[c]),this.gl.bindTexture(this.gl.TEXTURE_2D,this.lutTextures[c]),this.gl.uniform1i(u,c+3)}setParameters(n){n.denoiseLevel!==void 0&&(this.denoiseLevel=n.denoiseLevel),n.lightLevel!==void 0&&(this.lightLevel=n.lightLevel),n.rednessLevel!==void 0&&(this.rednessLevel=n.rednessLevel,this.updateRedness(this.rednessLevel)),n.lighteningContrastLevel&&this.updateLut(n.lighteningContrastLevel)}init(){this.tab_addr=new Uint8Array(kI);let n=[this.tab_addr],s=[256],c=[1];for(let u=0;u<n.length;u++){let h=this.gl.createTexture();if(!h)throw new L(D.WEBGL_INTERNAL_ERROR,"create lut texture failed");this.gl.bindTexture(this.gl.TEXTURE_2D,h),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.LUMINANCE,s[u],c[u],0,this.gl.LUMINANCE,this.gl.UNSIGNED_BYTE,n[u]),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.lutTextures.push(h)}}updateRedness(n){var s=n;1<n&&(n=1),0>n&&(n=0),1<s&&(s=1),0>s&&(s=0),this.mfacts_rotate_c=.8*n,.8>s&&(s=0),this.mskin_he_max=175/180*3.141593,this.mskin_hc_max=173/180*3.141593,this.mskin_he_min=(115-4*s)/180*3.141593,this.mskin_hc_min=(116-4*s)/180*3.141593,this.mskin_hc_axis=(117-4*s)/180*3.141593,this.mskin_hc_axis<this.mskin_hc_min&&(this.mskin_hc_axis=this.mskin_hc_min),1.5707965>this.mskin_hc_min&&(this.mskin_hc_min=1.5707965),1.5707965>this.mskin_hc_axis&&(this.mskin_hc_axis=1.5707965),1.5707965>this.mskin_he_min&&(this.mskin_he_min=1.5707965),3.141593<this.mskin_hc_max&&(this.mskin_hc_max=3.141593),3.141593<this.mskin_hc_axis&&(this.mskin_hc_axis=3.141593),3.141593<this.mskin_he_max&&(this.mskin_he_max=3.141593),n=this.mskin_he_max-this.mskin_hc_max,s=this.mskin_hc_max-this.mskin_hc_axis,this.mfacts_rotate_ge=.01<n?this.mfacts_rotate_c*s/n:this.mfacts_rotate_c,n=this.mskin_hc_min-this.mskin_he_min,s=this.mskin_hc_axis-this.mskin_hc_min,this.mfacts_rotate_le=.01<n?this.mfacts_rotate_c*s/n:this.mfacts_rotate_c}updateLut(n){var s=null;if(n===0&&(s=kI),n===1&&(s=qw),n===2&&(s=Yw),!s)throw new L(D.WEBGL_INTERNAL_ERROR,"invalid ylut_table value:"+n);this.tab_addr=new Uint8Array(s),n=[this.tab_addr],s=[256];let c=[1];for(let u=0;u<n.length;u++)this.gl.bindTexture(this.gl.TEXTURE_2D,this.lutTextures[u]),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.LUMINANCE,s[u],c[u],0,this.gl.LUMINANCE,this.gl.UNSIGNED_BYTE,n[u])}}class zw{constructor(){this.canvas=this.gl=null,this.programs=[],this.inputTexture=this.commonProgram=null,this.outputTextures=[],this.fbos=[],this.originalFrameHeight=this.originalFrameWidth=0,this.enableBeauty=!1,this.denoiseLevel=5,this.lightLevel=.35,this.rednessLevel=.5,this.lighteningContrastLevel=1}setEnableBeauty(n){this.enableBeauty=!!n}init(n,s,c){if(!Bt.supportWebGL)throw new L(D.NOT_SUPPORTED,"your browser is not support webGL");if(this.gl=c.getContext("webgl"),!this.gl)throw new L(D.WEBGL_INTERNAL_ERROR,"can not get webgl context");if(this.initGL(n,s),!this.inputTexture)throw new L(D.WEBGL_INTERNAL_ERROR,"can not find input texture");this.canvas=c,this.programs.push(new OI(this.gl)),this.programs.push(new Vw(this.gl,n,s)),this.programs.push(new jw(this.gl,n,s)),this.programs.push(new Kw(this.gl,n,s)),this.programs.push(new Jw(this.gl,this.inputTexture,n,s)),this.commonProgram=this.programs[0].program,this.setDenoiseLevel(this.denoiseLevel),this.setLightLevel(this.lightLevel),this.setRednessLevel(this.rednessLevel),this.setContrastLevel(this.lighteningContrastLevel)}render(n){if(!this.gl||!this.commonProgram||!this.canvas)return void R.warning("video effect manager is not init!");var s=0;if(this.originalFrameHeight===n.videoWidth&&this.originalFrameWidth===n.videoHeight)s=2;else if(this.originalFrameHeight!==n.videoHeight||this.originalFrameWidth!==n.videoWidth){var c,u,h;if(R.debug(b(c=b(u=b(h="beauty effect: resolution changed ".concat(this.originalFrameWidth,"x")).call(h,this.originalFrameHeight," -> ")).call(u,n.videoWidth,"x")).call(c,n.videoHeight)),n.videoHeight===0||n.videoWidth===0)return void R.debug("beauty effect: skip 0 resolution frame");this.canvas.width=n.videoWidth,this.canvas.height=n.videoHeight,n.setAttribute("width",n.videoWidth.toString()),n.setAttribute("height",n.videoHeight.toString()),this.release(),this.init(n.videoWidth,n.videoHeight,this.canvas)}for(this.gl.viewport(0,0,n.videoWidth,n.videoHeight),this.gl.bindTexture(this.gl.TEXTURE_2D,this.inputTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,n),n=this.enableBeauty?this.programs.length-1:0,c=0;c<=n;c++)u=this.programs[c].program,this.gl.useProgram(u),u=this.gl.getUniformLocation(u,"u_image"),this.programs[c].setUniforms(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.fbos[s+c%2]),this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.drawArrays(this.gl.TRIANGLES,0,6),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.outputTextures[s+c%2]),this.gl.uniform1i(u,0);this.gl.useProgram(this.commonProgram),s=this.gl.getUniformLocation(this.commonProgram,"u_flipY"),this.gl.uniform1f(s,-1),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.drawArrays(this.gl.TRIANGLES,0,6)}setDenoiseLevel(n){var s;H(s=this.programs).call(s,c=>{c instanceof Xo&&c.setParameters({denoiseLevel:n})}),this.denoiseLevel=n}setLightLevel(n){var s;H(s=this.programs).call(s,c=>{c instanceof Xo&&c.setParameters({lightLevel:n})}),this.lightLevel=n}setRednessLevel(n){var s;H(s=this.programs).call(s,c=>{c instanceof Xo&&c.setParameters({rednessLevel:n})}),this.rednessLevel=n}setContrastLevel(n){var s;H(s=this.programs).call(s,c=>{c instanceof Xo&&c.setParameters({lighteningContrastLevel:n})}),this.lighteningContrastLevel=n}setSize(n,s){var c;H(c=this.programs).call(c,u=>{u instanceof Xo&&u.setSize(n,s)})}release(){this.inputTexture=this.commonProgram=this.gl=null,this.programs=[],this.outputTextures=[],this.fbos=[]}initGL(n,s){if(!this.gl)throw new L(D.WEBGL_INTERNAL_ERROR,"can not find webgl context");this.inputTexture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.inputTexture),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR);for(let c=0;4>c;c++){let u=this.gl.createTexture();if(!u)throw new L(D.WEBGL_INTERNAL_ERROR,"create texture failed");this.gl.bindTexture(this.gl.TEXTURE_2D,u),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),2>c?this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,n,s,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null):this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,s,n,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null);let h=this.gl.createFramebuffer();if(!h)throw new L(D.WEBGL_INTERNAL_ERROR,"create frame buffer failed");this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,h),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,u,0),this.outputTextures.push(u),this.fbos.push(h)}this.gl.viewport(0,0,n,s),this.originalFrameWidth=n,this.originalFrameHeight=s}}class Xw{constructor(){this.recordedFrameCount=this.targetFrameRate=0,this.recordingTime=2}async startRecordBeautyEffectOutput(n,s=4){if(this.recordID)throw new L(D.UNEXPECTED_ERROR,"another beauty effect recording is in progress");let c=rr(6,"");return this.recordID=c,this.targetFrameRate=n,this.recordedFrameCount=0,this.recordingTime=s,await Mn(1e3*this.recordingTime),this.recordID!==c?(this.recordID=void 0,!0):(this.recordID=void 0,this.recordedFrameCount<this.targetFrameRate*this.recordingTime/2?(R.warning("detect beauty effect overload, current framerate",this.recordedFrameCount/2),!1):(R.debug("beauty effect current framerate",this.recordedFrameCount/2),!0))}stopRecordBeautyEffectOutput(){this.recordedFrameCount=this.targetFrameRate=0,this.recordID=void 0}addFrame(){this.recordID&&(this.recordedFrameCount+=1)}}class $w extends class{get output(){return this._output}async setInput(n){if(n!==this.input){if(n.kind!==this.kind)throw new L(D.UNEXPECTED_ERROR);this.input&&this.removeInput(),this.input=n,await this._setInput(n)}}removeInput(){this.input=void 0,this._removeInput()}async updateOutput(n){this.output!==n&&(this._output=n,this.onOutputChange&&await this.onOutputChange())}replaceOriginMediaStream(n,s){var c,u;let h=ze(c=n.getTracks()).call(c,p=>p.kind===this.kind);h&&n.removeTrack(h),s=ze(u=s.getTracks()).call(u,p=>p.kind===this.kind),this.output===void 0&&s&&n.addTrack(s),this.output&&(R.debug("replace ".concat(this.output.kind," track to origin media stream")),n.addTrack(this.output))}}{constructor(){super();this.kind="video",this.fps=15,this.overloadDetector=new Xw,this.enabled=!1,this.stopChromeBackgroundLoop=null,this.lastRenderTime=0,this.fps=30,this.manager=new zw}async setBeautyEffectOptions(n,s){s.smoothnessLevel!==void 0&&It(s.smoothnessLevel,"options.smoothnessLevel",0,1,!1),s.lighteningLevel!==void 0&&It(s.lighteningLevel,"options.lighteningLevel",0,1,!1),s.rednessLevel!==void 0&&It(s.rednessLevel,"options.rednessLevel",0,1,!1),s.lighteningContrastLevel!==void 0&&Ir(s.lighteningContrastLevel,"options.lighteningContrastLevel",[0,1,2]),s.smoothnessLevel!==void 0&&this.manager.setDenoiseLevel(Math.max(.1,10*s.smoothnessLevel)),s.lighteningLevel!==void 0&&this.manager.setLightLevel(Math.max(.1,s.lighteningLevel/2)),s.rednessLevel!==void 0&&this.manager.setRednessLevel(Math.max(.01,s.rednessLevel)),s.lighteningContrastLevel!==void 0&&this.manager.setContrastLevel(s.lighteningContrastLevel),this.enabled!==n&&(this.manager.setEnableBeauty(n),this.enabled=n,n?this.input&&await this.startEffect():await this.stopEffect())}destroy(){this.onOutputChange=void 0,this.stopEffect(),this.enabled=!1}async startEffect(){let n=qe();if(!this.input)return void R.warning("video track is null, fail to start video effect!");if(this.input&&this.output&&this.input!==this.output)return void R.warning("video effect is already enabled");let s=await this.renderWithWebGL();await this.updateOutput(s),R.info("start video effect, output:",this.output),this.overloadDetector.startRecordBeautyEffectOutput(this.fps).then(u=>{u||this.onOverload&&this.onOverload()});let c=()=>{this.enabled&&requestAnimationFrame(c);const u=le(),h=1e3/this.fps,p=this.lastRenderTime?u-this.lastRenderTime:h;p<h||(this.lastRenderTime=u-(p-h),this.video&&this.video.paused&&this.video.play(),this.enabled&&this.video&&(this.manager.render(this.video),this.output&&this.output.requestFrame&&this.output.requestFrame(),this.overloadDetector.addFrame()))};requestAnimationFrame(c),n.name===Xe.CHROME&&document.addEventListener("visibilitychange",()=>{document.hidden?this.stopChromeBackgroundLoop=Lh(()=>{this.enabled&&this.video&&this.manager.render(this.video),this.output&&this.output.requestFrame&&this.output.requestFrame(),this.overloadDetector.addFrame()},this.fps):this.stopChromeBackgroundLoop&&(this.stopChromeBackgroundLoop(),this.stopChromeBackgroundLoop=null)},!1)}async stopEffect(){R.info("stop video effect"),this.overloadDetector.stopRecordBeautyEffectOutput(),this.manager.release(),this.canvas&&this.canvas.remove(),this.video&&this.video.remove(),this.video=this.canvas=void 0,await this.updateOutput(this.input)}async _setInput(n){this.enabled&&!this.video&&await this.startEffect()}_removeInput(){this.stopEffect()}async renderWithWebGL(){var n;if(!this.input)throw new L(D.BEAUTY_PROCESSOR_INTERNAL_ERROR,"can not renderWithWebGL, no input");this.canvas&&(this.canvas.remove(),this.canvas=void 0),this.video&&(this.video.remove(),this.video=void 0),this.canvas=document.createElement("canvas"),this.video=document.createElement("video"),this.video.setAttribute("autoplay",""),this.video.setAttribute("muted",""),this.video.muted=!0,this.video.setAttribute("playsinline",""),this.video.setAttribute("style","display:none"),this.video.srcObject=new MediaStream([this.input]);var s=new se(h=>{const p=()=>{this.video&&this.video.removeEventListener("playing",p),h(void 0)};this.video&&this.video.addEventListener("playing",p)});this.video.play(),await s,s=this.input.getSettings();let c=s.width||this.video.videoWidth,u=s.height||this.video.videoHeight;if(s.frameRate&&this.fps!==s.frameRate&&(this.fps=s.frameRate,R.debug("beauty video processor: set fps to",this.fps)),R.debug(b(n="beauty video processor: width ".concat(c," height ")).call(n,u)),!c||!u)throw new L(D.BEAUTY_PROCESSOR_INTERNAL_ERROR,"can not get track resolution");return this.canvas.width=c,this.canvas.height=u,this.video.setAttribute("width",c.toString()),this.video.setAttribute("height",u.toString()),this.manager.init(c,u,this.canvas),this.canvas.captureStream(Bt.supportRequestFrame?0:this.fps).getVideoTracks()[0]}}var mi=function(i,n,s,c){var u,h=arguments.length,p=3>h?n:c===null?c=at(n,s):c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")p=Reflect.decorate(i,n,s,c);else for(var f=i.length-1;0<=f;f--)(u=i[f])&&(p=(3>h?u(p):3<h?u(n,s,p):u(n,s))||p);return 3<h&&p&&dt(n,s,p),p},st=function(i,n){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,n)};class Wt extends rd{constructor(n,s,c,u,h){super(n,h);this.trackMediaType="video",this._scalabiltyMode={numSpatialLayers:1,numTemporalLayers:1},this._enabled=!0,this.updateMediaStreamTrackResolution(),this._encoderConfig=s,this._scalabiltyMode=c,this._optimizationMode=u}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Vr.PLAYING)}play(n,s={}){let c=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.LOCAL_VIDEO_TRACK_PLAY,options:[this.getTrackId(),typeof n=="string"?n:"HTMLElement",s]});if(!(n instanceof HTMLElement)){let h=document.getElementById(n.toString());var u;h?n=h:(R.warning(b(u="[".concat(this.getTrackId(),'] can not find "#')).call(u,n,'" element, use document.body')),n=document.body)}R.debug("[".concat(this.getTrackId(),"] start video playback"),pe(s)),n=Yc({},this._getDefaultPlayerConfig(),{},s,{trackId:this.getTrackId(),element:n}),this._player?this._player.updateConfig(n):(this._player=new wI(n),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),c.onSuccess()}stop(){let n=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.LOCAL_VIDEO_TRACK_STOP,options:[this.getTrackId()]});if(!this._player)return n.onSuccess();this._player.destroy(),this._player=void 0,R.debug("[".concat(this.getTrackId(),"] stop video playback")),n.onSuccess()}async setEnabled(n,s){if(!s){if(n===this._enabled)return;this.stateCheck("enabled",n)}R.info("[".concat(this.getTrackId(),"] start setEnabled"),n);let c=await this._enabledMutex.lock();if(!n){this._originMediaStreamTrack.enabled=!1;try{await nn(this,De.NEED_REMOVE_TRACK,this)}catch(u){throw R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),u.toString()),c(),u}return s||(this._enabled=!1),R.info("[".concat(this.getTrackId(),"] setEnabled to false success")),c()}this._originMediaStreamTrack.enabled=!0;try{await nn(this,De.NEED_ADD_TRACK,this)}catch(u){throw R.error("[".concat(this.getTrackId(),"] setEnabled to true error"),u.toString()),c(),u}R.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0),c()}async setMuted(n){var s;if(n!==this._muted){if(this.stateCheck("muted",n),this._muted=n,qe().name===Xe.FIREFOX)return R.debug("[".concat(this.getTrackId(),"] firefox set mute fallback to set enabled")),void await this.setEnabled(!n,!0);this._mediaStreamTrack.enabled=!n,R.debug(b(s="[".concat(this.getTrackId(),"] start set muted: ")).call(s,n)),await nn(this,De.SET_VIDEO_TRACK_MUTED,{track:this,muted:n})}}getStats(){return Kc(()=>{R.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Gs(this,De.GET_STATS)||Yc({},Zu)}async setBeautyEffect(n,s={}){let c=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.LOCAL_VIDEO_TRACK_BEAUTY,options:[this.getTrackId(),n,s]});if(n||this._videoBeautyProcessor){if(qe().os===an.IOS||qe().os===an.ANDROID)throw n=new L(D.INVALID_OPERATION,"can not enable beauty effect on mobile device"),c.onError(n),n;if(!this._enabled&&n)throw n=new L(D.TRACK_IS_DISABLED,"can not enable beauty effect when track is disabled"),c.onError(n),n;R.info("[".concat(this.getTrackId(),"] start setBeautyEffect"),n,pe(s));try{this._videoBeautyProcessor?await this._videoBeautyProcessor.setBeautyEffectOptions(n,s):(this._videoBeautyProcessor=new $w,this._videoBeautyProcessor.onOverload=()=>{ui(()=>this.emit(ta.BEAUTY_EFFECT_OVERLOAD))},await this._videoBeautyProcessor.setBeautyEffectOptions(n,s),await this._registerTrackProcessor(this._videoBeautyProcessor))}catch(u){throw R.error("[".concat(this.getTrackId(),"] setBeautyEffect error"),u.toString()),c.onError(u),u}R.info("[".concat(this.getTrackId(),"] setBeautyEffect success")),c.onSuccess()}}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}clone(n,s,c,u){let h=this._mediaStreamTrack.clone();return new Wt(h,n,s,c,u)}async setBitrateLimit(n){var s;if(R.debug(b(s="[".concat(this.getTrackId(),"] set bitrate limit, ")).call(s,pe(n))),n){this._forceBitrateLimit=n,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<n.max_bitrate?this._encoderConfig.bitrateMax:n.max_bitrate:this._encoderConfig.bitrateMax=n.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=n.min_bitrate);try{await nn(this,De.NEED_RESET_REMOTE_SDP)}catch(c){return c.throw()}}}async setOptimizationMode(n){var s;if(n==="motion"||n==="detail"||n==="balanced"){try{this._optimizationMode=n,await nn(this,De.SET_OPTIMIZATION_MODE,n)}catch(c){throw R.error("[".concat(this.getTrackId(),"] set optimization mode failed"),c.toString()),c}R.info(b(s="[".concat(this.getTrackId(),"] set optimization mode success (")).call(s,n,")"))}else R.error(D.INVALID_PARAMS,"optimization mode must be motion, detail or balanced")}setScalabiltyMode(n){var s;if(n.numSpatialLayers===1&&n.numTemporalLayers!==1)return R.error(D.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabiltyMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabiltyMode=n,R.info(b(s="[".concat(this.getTrackId(),"] set scalability mode success (")).call(s,n,")"))}updateMediaStreamTrackResolution(){um(this._originMediaStreamTrack).then(([n,s])=>{this._videoHeight=s,this._videoWidth=n}).catch(id)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async renewMediaStreamTrack(){}}mi([Ht(),st("design:type",Function),st("design:paramtypes",[Object,Object]),st("design:returntype",void 0)],Wt.prototype,"play",null),mi([Ht(),st("design:type",Function),st("design:paramtypes",[Boolean,Boolean]),st("design:returntype",se)],Wt.prototype,"setEnabled",null),mi([Ht(),Bh({report:z}),st("design:type",Function),st("design:paramtypes",[Boolean]),st("design:returntype",se)],Wt.prototype,"setMuted",null),mi([Ht(),st("design:type",Function),st("design:paramtypes",[]),st("design:returntype",Object)],Wt.prototype,"getStats",null),mi([Ht(),st("design:type",Function),st("design:paramtypes",[Boolean,Object]),st("design:returntype",se)],Wt.prototype,"setBeautyEffect",null),mi([Ht(),st("design:type",Function),st("design:paramtypes",[]),st("design:returntype",ImageData)],Wt.prototype,"getCurrentFrameData",null),mi([Ht(),st("design:type",Function),st("design:paramtypes",[Object]),st("design:returntype",se)],Wt.prototype,"setBitrateLimit",null),mi([Ht(),st("design:type",Function),st("design:paramtypes",[String]),st("design:returntype",se)],Wt.prototype,"setOptimizationMode",null),mi([Ht(),st("design:type",Function),st("design:paramtypes",[Object]),st("design:returntype",void 0)],Wt.prototype,"setScalabiltyMode",null),mi([Ht(),st("design:type",Function),st("design:paramtypes",[]),st("design:returntype",void 0)],Wt.prototype,"updateMediaStreamTrackResolution",null);class Il extends Wt{constructor(n,s,c,u,h,p){super(n,s.encoderConfig?cs(s.encoderConfig):{},u,h,p);this._enabled=!0,this._deviceName="default",this.tryResumeVideoForIOS15WeChat=async()=>{ki()&&qe().name===Xe.WECHAT&&this._mediaStreamTrack.muted&&this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.setEnabled(!1),await this.setEnabled(!0))},this._config=s,this._constraints=c,this._deviceName=n.label,this._config.encoderConfig&&(this._encoderConfig=cs(this._config.encoderConfig)),ht.on(Zr.IOS_15_INTERRUPTION_END,this.tryResumeVideoForIOS15WeChat)}async setDevice(n){var s;let c=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.CAM_VIDEO_TRACK_SET_DEVICE,options:[this.getTrackId(),n]});if(R.info(b(s="[".concat(this.getTrackId(),"] set device to ")).call(s,n)),this._enabled)try{let u=await Qn.getDeviceById(n);s={},s.video=Yc({},this._constraints),s.video.deviceId={exact:n},s.video.facingMode=void 0,this._originMediaStreamTrack.stop();let h=null;try{h=await bi(s,this.getTrackId())}catch(p){throw R.error("[".concat(this.getTrackId(),"] setDevice failed"),p.toString()),h=await bi({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(h.getVideoTracks()[0],!1),p}await this._updateOriginMediaStreamTrack(h.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=u.label,this._config.cameraId=n,this._constraints.deviceId={exact:n}}catch(u){throw c.onError(u),R.error("[".concat(this.getTrackId(),"] setDevice error"),u.toString()),u}else try{this._deviceName=(await Qn.getDeviceById(n)).label,this._config.cameraId=n,this._constraints.deviceId={exact:n}}catch(u){throw c.onError(u),R.error("[".concat(this.getTrackId(),"] setDevice error"),u.toString()),u}R.info("[".concat(this.getTrackId(),"] setDevice success")),c.onSuccess()}async setEnabled(n,s){if(!s){if(n===this._enabled)return;this.stateCheck("enabled",n)}R.info("[".concat(this.getTrackId(),"] start setEnabled"),n);let c=await this._enabledMutex.lock();if(!n){this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),s||(this._enabled=!1);try{await nn(this,De.NEED_REMOVE_TRACK,this)}catch(h){throw R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),h.toString()),c(),h}return R.info("[".concat(this.getTrackId(),"] setEnabled to false success")),c()}n=Yc({},this._constraints);let u=Qn.searchDeviceIdByName(this._deviceName);u&&!n.deviceId&&(n.deviceId={exact:u});try{let h=await bi({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getVideoTracks()[0],!1),await nn(this,De.NEED_ADD_TRACK,this)}catch(h){throw R.error("[".concat(this.getTrackId(),"] setEnabled true error"),h.toString()),c(),h}this.updateMediaStreamTrackResolution(),R.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0),c()}async setEncoderConfiguration(n,s){if(s=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG,options:[this.getTrackId(),n]}),!this._enabled)throw n=new L(D.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled"),s.onError(n),n;n=cs(n),this._forceBitrateLimit&&(n.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:n.bitrateMax,n.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:n.bitrateMin);let c=(u=this._config,JSON.parse(pe(u)));var u;c.encoderConfig=n,u=jh(c),R.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),pe(n),pe(u));try{await this._originMediaStreamTrack.applyConstraints(u),this.updateMediaStreamTrackResolution()}catch(h){throw n=new L(D.UNEXPECTED_ERROR,h.toString()),R.error("[".concat(this.getTrackId(),"] applyConstraints error"),n.toString()),s.onError(n),n}this._config=c,this._constraints=u,this._encoderConfig=n;try{await nn(this,De.NEED_RENEGOTIATE)}catch(h){return s.onError(h),h.throw()}s.onSuccess()}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Bn()||mo())&&this._enabled&&!this._isClosed&&ht.duringInterruption){let n=async()=>{ht.off(Zr.IOS_INTERRUPTION_END,n),this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};ht.on(Zr.IOS_INTERRUPTION_END,n)}else R.debug("[".concat(this.getTrackId(),"] track ended")),this.emit(ta.TRACK_ENDED)}async renewMediaStreamTrack(){var n=Yc({},this._constraints);let s=Qn.searchDeviceIdByName(this._deviceName);s&&!n.deviceId&&(n.deviceId={exact:s}),n=await bi({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(n.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}close(){super.close(),ht.off(Zr.IOS_15_INTERRUPTION_END,this.tryResumeVideoForIOS15WeChat)}}mi([Ht(),st("design:type",Function),st("design:paramtypes",[String]),st("design:returntype",se)],Il.prototype,"setDevice",null),mi([Ht(),st("design:type",Function),st("design:paramtypes",[Boolean,Boolean]),st("design:returntype",se)],Il.prototype,"setEnabled",null),mi([Ht(),st("design:type",Function),st("design:paramtypes",[Object,Boolean]),st("design:returntype",se)],Il.prototype,"setEncoderConfiguration",null);var bI=!0;"findIndex"in[]&&Array(1).findIndex(function(){bI=!1}),Ge({target:"Array",proto:!0,forced:bI},{findIndex:function(i){return tv(this,i,1<arguments.length?arguments[1]:void 0)}});var Zw=ur("Array").findIndex,DI=Array.prototype,gd=function(i){var n=i.findIndex;return i===DI||i instanceof Array&&n===DI.findIndex?Zw:n};let BI=(i,n)=>{let s=null;if(n==="h264"?s=i.match(/a=rtpmap:(\d+) H264.*\r\n/)||i.match(/a=rtpmap:(\d+) H264.*\n/):n==="vp8"?s=i.match(/a=rtpmap:(\d+) VP8.*\r\n/)||i.match(/a=rtpmap:(\d+) VP8.*\n/):n==="vp9"?s=i.match(/a=rtpmap:(\d+) VP9.*\r\n/)||i.match(/a=rtpmap:(\d+) VP9.*\n/):n==="av1"&&(s=i.match(/a=rtpmap:(\d+) AV1.*\r\n/)||i.match(/a=rtpmap:(\d+) AV1.*\n/)),s&&s[1])return s[1]};class LI extends RI{constructor(n,s,c,u){super(s,s.stringUid||s.uid);this.suspendTracks=[],this.type="pub",this._waitingSuccessResponse=this.detecting=!1,this.handleMuteVideoTrack=({muted:h},p,f)=>{this.setVideoTrackMuteState(h).then(p).catch(f)},this.handleMuteAudioTrack=({track:h,muted:p},f,m)=>{this.setAudioTrackMuteState(p,h).then(f).catch(m)},this.renegotiateWithGateway=async()=>(R.debug("[pc-".concat(this.pc.ID,"] renegotiate start")),new se(async(h,p)=>{this.connectionState="connecting";let f=E=>{E==="connected"&&(this.off(Oe.CONNECTION_STATE_CHANGE,f),h()),E==="disconnected"&&(this.off(Oe.CONNECTION_STATE_CHANGE,f),p(new L(D.OPERATION_ABORTED,"renegotiate abort")))};this.on(Oe.CONNECTION_STATE_CHANGE,f),wr()&&re.SIMULCAST&&this.videoTrack&&this.videoTrack._scalabiltyMode&&await this.addSimulcast4Firefox(this.videoTrack._scalabiltyMode);var m=await this.pc.createOfferSDP();this.audioTrack&&this.audioTrack._encoderConfig&&(m=Hh(m,this.audioTrack._encoderConfig)),this.videoTrack&&this.videoTrack._scalabiltyMode&&(this.codec!=="vp9"&&this.codec!=="vp8"?(this.videoTrack._scalabiltyMode.numSpatialLayers=1,this.videoTrack._scalabiltyMode.numTemporalLayers=1):(1<this.videoTrack._scalabiltyMode.numSpatialLayers||1<this.videoTrack._scalabiltyMode.numTemporalLayers)&&(m=Rm(m,this.codec,this.videoTrack._scalabiltyMode)),R.debug("renegoation spatial layers: ",this.videoTrack._scalabiltyMode.numSpatialLayers)),await this.pc.setOfferSDP(m),this.audioTrack instanceof cn&&this.pc.onOfferSettled({videoActive:this.videoTrack&&!this.videoTrack.muted,audioActive:this.audioTrack&&this.audioTrack.isActive});let I=await Or(this,Oe.NEED_RENEGOTIATE,m);this.videoTrack&&!wr()&&re.SIMULCAST&&this.videoTrack._scalabiltyMode&&this.setSimulcastVideoRtpEncodingParameters(this.videoTrack._scalabiltyMode),m=function(E,_){var S,N,O;const B=hr(S=RegExp.prototype.test).call(S,/^([a-z])=(.*)/);E=Qe(N=E.split(/(\r\n|\r|\n)/)).call(N,B),_=Qe(O=_.split(/(\r\n|\r|\n)/)).call(O,B);let Q=null;const q=new Ct;return H(E).call(E,ie=>{const Ae=ie.match(/m=(audio|video)/);if(Ae&&Ae[1])return void(Q=Ae[1]);Q&&(ie=ie.match(/=(sendrecv|recvonly|sendonly|inactive)/))&&ie[1]&&q.set(Q,ie[1])}),Q=null,Ie(_).call(_,ie=>{var Ae=ie.match(/m=(audio|video)/);if(Ae&&Ae[1])return Q=Ae[1],ie;if(!Q)return ie;if((Ae=ie.match(/=(sendrecv|recvonly|sendonly|inactive)/))&&Ae[1]){const Be=q.get(Q);if(Be&&Be!==Ae[1])return ie.replace(Ae[1],Be)}return ie}).join(`\r
`)+`\r
`}(m,this.updateAnswerSDP(I.sdp)),await this.pc.setAnswerSDP(m),R.debug("[pc-".concat(this.pc.ID,"] renegotiate success")),this.connectionState="connected"})),this.handleStreamRenegotiate=(h,p)=>{this.connectionState==="connected"?this.renegotiateWithGateway().then(h).catch(p):h()},this.handleReplaceTrack=(h,p,f)=>{if(this.audioTrack instanceof cn&&h.kind==="audio")return p();this.pc.replaceTrack(h).then(m=>m?this.renegotiateWithGateway():se.resolve()).then(p).catch(f)},this.handleCloseAudioTrack=h=>{},this.handleCloseVideoTrack=()=>{this.lowStreamConnection&&this.lowStreamConnection.videoTrack&&this.lowStreamConnection.videoTrack.close()},this.handleGetSessionID=h=>{h(this.joinInfo.sid)},this.handleGetLocalVideoStats=h=>{h(this.statsCollector.getLocalVideoTrackStats(this.connectionId))},this.handleGetLocalAudioStats=h=>{h(this.statsCollector.getLocalAudioTrackStats(this.connectionId))},this.handleSetOptimizationMode=(h,p,f)=>{this.videoTrack&&this.setRtpSenderParametersByTrackConfig(this.videoTrack).then(p).catch(f)},this.isLowStreamConnection=!!u,this.codec=c,this.statsCollector=n,this.statsCollector.addLocalConnection(this)}getAllTracks(){let n=[];return this.videoTrack&&n.push(this.videoTrack),this.audioTrack&&this.audioTrack instanceof cn?n=b(n).call(n,this.audioTrack.trackList):this.audioTrack&&n.push(this.audioTrack),n.push(...this.suspendTracks),n}async addTracks(n){let s=Bt;if(this.connectionState==="connecting")try{return await this.createWaitConnectionConnectedPromise(),await this.addTracks(n)}catch{throw new L(D.OPERATION_ABORTED,"publish abort")}var c=!1;let u=this.getAllTracks();n=dm(n=Qe(n).call(n,p=>He(u).call(u,p)===-1));for(let p=0;p<n.length;p+=1){var h=n[p];if(!(h instanceof rd))return new L(D.INVALID_LOCAL_TRACK).throw();if(h instanceof Wt&&this.disabledVideoTrack){if(this.disabledVideoTrack!==h)return new L(D.EXIST_DISABLED_VIDEO_TRACK).throw();this.disabledVideoTrack=void 0}if(h instanceof Wt&&this.videoTrack)return new L(D.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw();if(h instanceof Br){if(this.audioTrack&&this.audioTrack._bypassWebAudio)throw R.error("One of the audio track was created with config bypassWebAudio set to true, there is no way to publish multiple audio tracks."),new L(D.CAN_NOT_PUBLISH_MULTIPLE_AUDIO_TRACKS);if(this.audioTrack instanceof cn)this.audioTrack.trackList.length===0&&await this.pc.setAudioRtpEncodingParameters({active:!0}),this.audioTrack.addAudioTrack(h);else if(s.webAudioMediaStreamDest)if(h._bypassWebAudio){if(this.audioTrack)throw R.error("Can not publish another audio track with bypassWebAudio set to true."),new L(D.CAN_NOT_PUBLISH_MULTIPLE_AUDIO_TRACKS);R.debug("[".concat(this.connectionId,"] audio track doesn't not pass through WebAudio, use original audio track to publish")),c=await this.addTrackWithPC(h)}else c=new cn,h.muted?this.suspendTracks.push(h):c.addAudioTrack(h),c=await this.addTrackWithPC(c);else R.debug("[".concat(this.connectionId,"] your browser does not support mixing track, use original audio track to publish")),c=await this.addTrackWithPC(h)}else h instanceof Wt&&this.isLowStreamConnection?(c=Nm({},{width:160,height:120,framerate:15,bitrate:50},{},this.lowStreamParameter),s.supportDualStreamEncoding?(R.debug("[".concat(this.connectionId,"] creating low stream using rtp encoding.")),this.lowStreamEncoding=GS(c,h),h=h.clone({bitrateMax:c.bitrate,bitrateMin:c.bitrate})):(R.debug("[".concat(this.connectionId,"] creating low stream using canvas.")),h=XS(h,c),h=new Wt(h,{bitrateMax:c.bitrate,bitrateMin:c.bitrate})),h._hints.push(ro.LOW_STREAM),c=await this.addTrackWithPC(h),this.bindTrackEvents(h)):(this.detecting=!0,pi(()=>{this.detecting=!1},8e3),c=await this.addTrackWithPC(h))}await this.updateControlMessage(),c&&await this.renegotiateWithGateway(),H(n).call(n,p=>this.bindTrackEvents(p))}async removeTracks(n,s){let c=this.getAllTracks();n=dm(n=Qe(n).call(n,p=>He(c).call(c,p)!==-1||p===this.disabledVideoTrack));let u=[];for(let p=0;p<n.length;p+=1){let f=n[p];if(this.unbindTrackEvents(f),this.audioTrack instanceof cn&&f instanceof Br)this.audioTrack.removeAudioTrack(f),js(this.suspendTracks,f),this.audioTrack.trackList.length===0&&(u.push(this.audioTrack),this.audioTrack=void 0);else if(f instanceof Br)u.push(f),this.audioTrack=void 0;else if(f instanceof Wt){if(s){if(this.disabledVideoTrack===f)return void(this.disabledVideoTrack=void 0)}else this.disabledVideoTrack=this.videoTrack;u.push(f),this.isLowStreamConnection&&f.close(),this.videoTrack=void 0}}if(this.videoTrack||this.audioTrack){if(u.length!==0){if(this.connectionState==="connecting")try{await this.createWaitConnectionConnectedPromise()}catch{return}for(let p of u){var h;R.debug(b(h="[".concat(this.connectionId,"] remove ")).call(h,p.trackMediaType," from pc")),await this.pc.removeTrack(p._mediaStreamTrack),n=qe(),n.name==="Safari"&&n.version==="11"&&await p.renewMediaStreamTrack()}await this.renegotiateWithGateway()}}else await this.closeP2PConnection()}async updateControlMessage(){this.audioTrack instanceof cn&&this.connectionState==="connected"&&(this.audioTrack&&await Or(this,Oe.NEED_CONTROL,{type:"audio",muted:!this.audioTrack.isActive}),this.videoTrack&&await Or(this,Oe.NEED_CONTROL,{type:"video",muted:this.videoTrack.muted}))}async setSimulcastVideoRtpEncodingParameters(n){let s=this.pc.getSender("video");if(!s)throw new L(D.LOW_STREAM_ENCODING_ERROR,"Low stream has no video sender.");let c=s.getParameters();if(!c.encodings||!c.encodings[0])throw new L(D.LOW_STREAM_ENCODING_ERROR,"Low stream RtpEncodingParameters is empty.");this.videoTrack&&this.videoTrack._encoderConfig&&this.videoTrack._encoderConfig.bitrateMax&&200<this.videoTrack._encoderConfig.bitrateMax&&1<n.numSpatialLayers&&(c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:1e3*(this.videoTrack._encoderConfig.bitrateMax-50)},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:5e4,scaleResolutionDownBy:4}]),await s.setParameters(c)}startP2PConnection(){return new se(async(n,s)=>{if(!this.audioTrack&&!this.videoTrack)return s(new L(D.UNEXPECTED_ERROR,"no track to publish"));let c=h=>{if(h==="connected"&&(this.off(Oe.CONNECTION_STATE_CHANGE,c),n()),h==="disconnected"){if(this.off(Oe.CONNECTION_STATE_CHANGE,c),this.disconnectedReason)return s(this.disconnectedReason);s(new L(D.OPERATION_ABORTED,"publish abort"))}};this.on(Oe.CONNECTION_STATE_CHANGE,c),this.disconnectedReason=void 0,this.connectionState="connecting",this._waitingSuccessResponse=!0,this.startTime=le();try{var u;!this.pc.audioTrack&&this.audioTrack&&await this.pc.addTrack(this.audioTrack._mediaStreamTrack),!this.pc.videoTrack&&this.videoTrack&&await this.pc.addTrack(this.videoTrack._mediaStreamTrack),wr()&&re.SIMULCAST&&this.videoTrack&&this.videoTrack._scalabiltyMode&&await this.addSimulcast4Firefox(this.videoTrack._scalabiltyMode);let h=await this.pc.createOfferSDP();re.REMOVE_NEW_CODECS&&(h=this.codec==="vp9"?Kh(h,["av1"]):this.codec==="av1"?Kh(h,["vp9"]):Kh(h,["vp9","av1"]));let p=Sm(h);this.videoTrack&&!gt(u=p.video).call(u,this.codec.toUpperCase())&&R.warning("current codec is not supported, support list: ".concat(p.video.join(","))),this.audioTrack&&this.audioTrack._encoderConfig&&(h=Hh(h,this.audioTrack._encoderConfig)),this.videoTrack&&!wr()&&this.videoTrack._scalabiltyMode&&(this.codec!=="vp9"&&this.codec!=="vp8"?(this.videoTrack._scalabiltyMode.numSpatialLayers=1,this.videoTrack._scalabiltyMode.numTemporalLayers=1):(1<this.videoTrack._scalabiltyMode.numSpatialLayers||1<this.videoTrack._scalabiltyMode.numTemporalLayers)&&(h=Rm(h,this.codec,this.videoTrack._scalabiltyMode)),R.debug("spatial layers: ",this.videoTrack._scalabiltyMode.numSpatialLayers)),await this.pc.setOfferSDP(h),this.audioTrack instanceof cn&&this.pc.onOfferSettled({videoActive:this.videoTrack&&!this.videoTrack.muted,audioActive:this.audioTrack&&this.audioTrack.isActive}),this.videoTrack&&this.setRtpSenderParametersByTrackConfig(this.videoTrack),R.debug("[".concat(this.connectionId,"] create and set offer success")),u={messageType:"OFFER",sdp:h,offererSessionId:104,retry:!0},Bt.supportDualStreamEncoding&&this.isLowStreamConnection&&this.lowStreamEncoding&&this.videoTrack&&await this.setLowStreamEncoding(this.lowStreamEncoding,this.videoTrack),this.videoTrack&&!wr()&&re.SIMULCAST&&this.videoTrack._scalabiltyMode&&this.setSimulcastVideoRtpEncodingParameters(this.videoTrack._scalabiltyMode);let f=await Or(this,Oe.NEED_ANSWER,u),m=this.updateAnswerSDP(f.sdp);await this.pc.setAnswerSDP(m),R.debug("[".concat(this.connectionId,"] set answer success")),await this.icePromise,this.connectionState="connected",this.startUploadStats()}catch(h){this.off(Oe.CONNECTION_STATE_CHANGE,c),this.connectionState="disconnected",this.reportPublishEvent(!1,h.code),R.error("[".concat(this.connectionId,"] connection error"),h.toString()),s(h)}})}reportPublishEvent(n,s,c){var u;this._waitingSuccessResponse=!1,z.publish(this.joinInfo.sid,{lts:this.startTime,succ:n,ec:s,audioName:this.audioTrack&&(this.audioTrack instanceof cn?this.audioTrack.getSubTrackLabels().join(","):this.audioTrack.getTrackLabel()),videoName:this.videoTrack&&this.videoTrack.getTrackLabel(),screenshare:!(!this.videoTrack||He(u=this.videoTrack._hints).call(u,ro.SCREEN_TRACK)===-1),audio:!!this.audioTrack,video:!!this.videoTrack,p2pid:this.pc.ID,publishRequestid:this.ID,extend:c})}async closeP2PConnection(n){let s=this.getAllTracks();var c;H(s).call(s,u=>{this.unbindTrackEvents(u)}),this.isLowStreamConnection&&this.videoTrack&&this.videoTrack.close(),this.videoTrack=void 0,this.audioTrack instanceof cn&&(H(c=this.audioTrack.trackList).call(c,u=>{this.audioTrack.removeAudioTrack(u)}),this.audioTrack.close()),this.audioTrack=void 0,this.stopUploadStats(),this.statsCollector.removeConnection(this.connectionId),await this.closePC(n),this.connectionState="disconnected",this.removeAllListeners()}getNetworkQuality(){var n,s=this.pc.getStats();if(!s.videoSend[0]&&!s.audioSend[0])return 1;var c=Gs(this,Oe.NEED_SIGNAL_RTT),u=s.videoSend[0]?s.videoSend[0].rttMs:void 0;let h=s.audioSend[0]?s.audioSend[0].rttMs:void 0;return u=u&&h?(u+h)/2:u||h,c=70*s.sendPacketLossRate/50+.3*((u&&c?(u+c)/2:u||c)||0)/1500,c=.17>c?1:.36>c?2:.59>c?3:.1>c?4:5,this.videoTrack&&this.videoTrack._encoderConfig&&He(n=this.videoTrack._hints).call(n,ro.SCREEN_TRACK)===-1&&(n=this.videoTrack._encoderConfig.bitrateMax,s=s.bitrate.actualEncoded,n&&s)?(s=(1e3*n-s)/(1e3*n),sR[.15>s?0:.3>s?1:.45>s?2:.6>s?3:4][c]):c}handleUpdateBitrateLimit(n){this.videoTrack&&this.videoTrack.setBitrateLimit(n)}async setAudioTrackMuteState(n,s){if(!(this.audioTrack instanceof cn))return void R.debug("[".concat(this.connectionId,"] set audio mute in unsupported environment"));let c=this.audioTrack;try{if(n){var u;c.removeAudioTrack(s),c.trackList.length===0&&(R.debug(b(u="[".concat(this.connectionId,"] set audio encoding active, id: ")).call(u,s.getTrackId(),", state: ",!1)),await this.pc.setAudioRtpEncodingParameters({active:!1})),this.suspendTracks.push(s)}else await this.pc.setAudioRtpEncodingParameters({active:!0}),c.addAudioTrack(s),js(this.suspendTracks,s)}catch(p){var h;R.warning(b(h="[".concat(this.connectionId,"] set audio muted error ")).call(h,p,", fallback to set enabled"))}await Or(this,Oe.NEED_CONTROL,{type:"audio",muted:!(!this.audioTrack||this.audioTrack.isActive)})}async setVideoTrackMuteState(n){let s=!n,c=!1;if(qe().name===Xe.FIREFOX)c=!0;else try{var u,h;R.debug(b(u=b(h="[".concat(this.connectionId,"] set video encoding active, id: ")).call(h,this.videoTrack&&this.videoTrack.getTrackId(),", state: ")).call(u,s)),await this.pc.setVideoRtpEncodingParameters({active:s})}catch(I){var p;R.warning(b(p="[".concat(this.connectionId,"] set video encoding active error ")).call(p,I,", fallback to set enabled")),c=!0}var f,m;c&&this.videoTrack&&(R.debug(b(f=b(m="[".concat(this.connectionId,"] set video encoding active fallback to enabled on firefox, type: ")).call(m,this.videoTrack&&this.videoTrack.getTrackId(),", state: ")).call(f,s)),this.videoTrack.getMediaStreamTrack().enabled=s),this.lowStreamConnection&&this.lowStreamConnection.setVideoTrackMuteState(n),!this.isLowStreamConnection&&await Or(this,Oe.NEED_CONTROL,{type:"video",muted:n})}uploadStats(n,s){let c=this.audioTrack?function(f,m){const I=f.audioSend[0];return I?(f={id:rr(10,""),timestamp:new Date(f.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:I.ssrc.toString()},f.A_astd=m._originMediaStreamTrack.enabled&&m._mediaStreamTrack.enabled?"0":"1",I.inputLevel?f.A_ail=Math.round(100*I.inputLevel).toString():f.A_ail=Math.round(100*m._source.getAccurateVolumeLevel()).toString(),f.A_apil=Math.round(100*m._source.getAccurateVolumeLevel()).toString(),f):null}(n,this.audioTrack):void 0,u=this.videoTrack?function(f,m){const I=f.videoSend[0];if(!I)return null;switch(f={id:rr(10,""),timestamp:new Date(f.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:I.ssrc.toString()},f.A_vstd=m._originMediaStreamTrack&&!m._originMediaStreamTrack.enabled||!m._mediaStreamTrack.enabled?"1":"0",I.sentFrame&&(f.A_fhs=I.sentFrame.height.toString(),f.A_frs=I.sentFrame.frameRate.toString(),f.A_fws=I.sentFrame.width.toString()),I.adaptionChangeReason){case"none":f.A_ac="0";break;case"cpu":f.A_ac="1";break;case"bandwidth":f.A_ac="2";break;case"other":f.A_ac="3"}return f.A_nr=I.nacksCount.toString(),I.avgEncodeMs&&(f.A_aem=I.avgEncodeMs.toFixed(0).toString()),f}(n,this.videoTrack):void 0,h=am(n,s),p=function(f){const m={id:"bweforvideo",timestamp:new Date(f.timestamp).toISOString(),type:"VideoBwe"};return f.bitrate.retransmit&&(m.A_rb=f.bitrate.retransmit.toString()),f.bitrate.targetEncoded&&(m.A_teb=f.bitrate.targetEncoded.toString()),m.A_aeb=f.bitrate.actualEncoded.toString(),m.A_tb=f.bitrate.transmit.toString(),f.sendBandwidth!==void 0&&(m.A_asb=f.sendBandwidth.toString()),m}(n);c&&ui(()=>this.emit(Oe.NEED_UPLOAD,Pi.PUBLISH_STATS,c)),u&&ui(()=>this.emit(Oe.NEED_UPLOAD,Pi.PUBLISH_STATS,Nm({},u,{},h))),p&&ui(()=>this.emit(Oe.NEED_UPLOAD,Pi.PUBLISH_STATS,p))}uploadSlowStats(n){let s=am(n);s&&ui(()=>this.emit(Oe.NEED_UPLOAD,Pi.PUBLISH_STATS,s))}uploadRelatedStats(n){let s=function(c){return(c=c.videoSend[0])?{mediaType:"video",isVideoMute:!1,frameRateInput:c.inputFrame&&c.inputFrame.frameRate.toString(),frameRateSent:c.sentFrame&&c.sentFrame.frameRate.toString(),googRtt:c.rttMs.toString()}:null}(n);s&&(s.isVideoMute=!(!this.videoTrack||!this.videoTrack.muted),ui(()=>{this.emit(Oe.NEED_UPLOAD,Pi.PUBLISH_RELATED_STATS,s)}))}async addSimulcast4Firefox(n){if(wr()&&this.videoTrack&&this.videoTrack._encoderConfig&&this.videoTrack._encoderConfig.bitrateMax&&200<this.videoTrack._encoderConfig.bitrateMax&&1<n.numSpatialLayers&&this.codec==="vp8"&&(n=this.pc.getSender("video"))){let s=n.getParameters();R.debug("getParameters : ",s),s||R.error("[".concat(this.connectionId,"] get sender parameter error.")),s.encodings=[{rid:"m",active:!0,maxBitrate:5e4,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:1e3*(this.videoTrack._encoderConfig.bitrateMax-50)}],await n.setParameters(s),R.debug("setParameters : ",s)}}bindTrackEvents(n){var s;n.addListener(De.NEED_RESET_REMOTE_SDP,hr(s=this.handleResetRemoteSdp).call(s,this)),this.isLowStreamConnection||(n instanceof Br?(n.addListener(De.GET_STATS,this.handleGetLocalAudioStats),n.addListener(De.NEED_CLOSE,this.handleCloseAudioTrack),n.addListener(De.SET_AUDIO_TRACK_MUTED,this.handleMuteAudioTrack)):n instanceof Wt&&(n.addListener(De.GET_STATS,this.handleGetLocalVideoStats),n.addListener(De.NEED_CLOSE,this.handleCloseVideoTrack),n.addListener(De.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),n.addListener(De.SET_VIDEO_TRACK_MUTED,this.handleMuteVideoTrack)),n.addListener(De.NEED_RENEGOTIATE,this.handleStreamRenegotiate),n.addListener(De.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(De.NEED_SESSION_ID,this.handleGetSessionID))}unbindTrackEvents(n){this.isLowStreamConnection||(n instanceof Br?(n.off(De.GET_STATS,this.handleGetLocalAudioStats),n.off(De.NEED_CLOSE,this.handleCloseAudioTrack),n.off(De.SET_AUDIO_TRACK_MUTED,this.handleMuteAudioTrack)):n instanceof Wt&&(n.off(De.GET_STATS,this.handleGetLocalVideoStats),n.off(De.NEED_CLOSE,this.handleCloseVideoTrack),n.off(De.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),n.off(De.SET_VIDEO_TRACK_MUTED,this.handleMuteVideoTrack)),n.off(De.NEED_RENEGOTIATE,this.handleStreamRenegotiate),n.off(De.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(De.NEED_SESSION_ID,this.handleGetSessionID))}async addTrackWithPC(n){if(this.connectionState==="connecting")return new L(D.INVALID_OPERATION,"last publish operation has not finished").throw();let s=this.videoTrack,c=!1;return this.audioTrack&&n instanceof cn?(this.audioTrack=n,R.debug("[".concat(this.connectionId,"] replace pc audio track")),c=await this.pc.replaceTrack(n._mediaStreamTrack)):this.videoTrack&&n instanceof Wt?(this.videoTrack=n,R.debug("[".concat(this.connectionId,"] replace pc video track")),c=await this.pc.replaceTrack(n._mediaStreamTrack)):n instanceof Br?(this.audioTrack=n,R.debug("[".concat(this.connectionId,"] add audio track to pc")),await this.pc.addTrack(n._mediaStreamTrack),c=!0):n instanceof Wt&&(this.videoTrack=n,R.debug("[".concat(this.connectionId,"] add video track to pc")),await this.pc.addTrack(n._mediaStreamTrack),c=!0),this.connectionState==="connected"&&this.videoTrack!==s&&this.videoTrack&&await this.setRtpSenderParametersByTrackConfig(this.videoTrack),this.connectionState!=="disconnected"&&c}handleResetRemoteSdp(){return new se((n,s)=>{var c;R.info("[pc-".concat(this.pc.ID,"] start reset remote sdp"));let u=this.pc.getOfferSDP();var h=this.pc.getAnswerSDP();if(!h||!u)return n();h=h.sdp;let p;this.videoTrack&&this.videoTrack._encoderConfig&&He(c=this.videoTrack._hints).call(c,ro.SCREEN_TRACK)===-1&&(p=function(f,m){var I,E;let _=m.bitrateMin;m=m.bitrateMax;let S=hr(I=RegExp.prototype.test).call(I,/^([a-z])=(.*)/);if(f=Qe(E=f.split(/(\r\n|\r|\n)/)).call(E,S),m){let O="AS";qe().name===Xe.FIREFOX&&(m=1e3*(m>>>0),O="TIAS"),E=gd(f).call(f,B=>gt(B).call(B,O));var N;0<E&&(f[E]=b(N="b=".concat(O,":")).call(N,m))}return _&&(N=gd(f).call(f,O=>gt(O).call(O,"x-google-min-bitrate")),0<N&&(f[N]=f[N].replace(/x-google-min-bitrate=(.*)/,"x-google-min-bitrate=".concat(_)))),f.join(`\r
`)+`\r
`}(h,this.videoTrack._encoderConfig)),h!==p?this.pc.setOfferSDP(u.sdp).then(()=>{if(p)return this.pc.setAnswerSDP(p)}).then(n).catch(f=>{var m;R.error(b(m="[pc-".concat(this.pc.ID,"] reset remote sdp error, ")).call(m,f)),s(f)}):R.debug("[pc-".concat(this.pc.ID,"] remote sdp have no not changed"))})}async setRtpSenderParametersByTrackConfig(n){if(!Bt.supportSetRtpSenderParameters)return void R.debug("[".concat(this.connectionId,"] do not support set pc rtp sender, skip"));let s={},c="balanced";n._optimizationMode==="motion"?c="maintain-framerate":n._optimizationMode==="detail"&&(c="maintain-resolution"),R.debug("[".concat(this.connectionId,"] set pc rtp sender"),s,c),await this.pc.setRtpSenderParameters(s,c)}updateAnswerSDP(n){var s,c;return n=n.replace(/a=x-google-flag:conference\r\n/g,""),this.videoTrack&&He(s=this.videoTrack._hints).call(s,ro.SCREEN_TRACK),this.videoTrack&&this.videoTrack._encoderConfig&&He(c=this.videoTrack._hints).call(c,ro.SCREEN_TRACK)===-1&&(n=function(u,h,p){let f=Bt;var m=p.bitrateMin;p=p.bitrateMax;let I=u.match(/m=video.*\r\n/)||u.match(/m=video.*\n/);if(I&&0<I.length&&f.supportMinBitrate&&m&&(h=BI(u,h)))if(re.SIMULCAST){var E,_;m=p?.7*p:300,u=u.replace(I[0],b(E=b(_="".concat(I[0],"a=fmtp:")).call(_,h," x-google-start-bitrate=")).call(E,m,`\r
`))}else{var S,N;u=u.replace(I[0],b(S=b(N="".concat(I[0],"a=fmtp:")).call(N,h," x-google-min-bitrate=")).call(S,m,`\r
`))}if(I&&0<I.length&&p){var O,B;E="AS",qe().name===Xe.FIREFOX&&(p=1e3*(p>>>0),E="TIAS"),u=u.replace(I[0],b(O=b(B="".concat(I[0],"b=")).call(B,E,":")).call(O,p,`\r
`))}return u}(n,this.codec,this.videoTrack._encoderConfig)),this.audioTrack&&this.audioTrack._encoderConfig&&(n=Hh(n,this.audioTrack._encoderConfig)),n=function(u){let h=qe();return h.name!==Xe.SAFARI&&h.os!==an.IOS?u:u.replace(/a=.*video-orientation\r\n/g,"")}(n)}createPC(){this.pc=new yI({turnServer:this.joinInfo.turnServer}),this.updateICEPromise()}async closePC(n){return this.pc.onICEConnectionStateChange=void 0,this.pc.close(),!n&&await Or(this,Oe.NEED_UNPUB)}onPCDisconnected(n){this.reportPublishEvent(!1,n.code)}async setLowStreamEncoding(n,s){try{let c=await this.pc.setVideoRtpEncodingParameters(n),u=s.getMediaStreamTrack();if(n.scaleResolutionDownBy&&c.encodings[0].scaleResolutionDownBy!==n.scaleResolutionDownBy){let h=s._videoHeight||u.getSettings().height,p=s._videoWidth||u.getSettings().width;h&&p&&await u.applyConstraints({height:h/n.scaleResolutionDownBy,width:p/n.scaleResolutionDownBy})}n.maxFramerate&&c.encodings[0].maxFramerate!==n.maxFramerate&&await u.applyConstraints({frameRate:n.maxFramerate})}catch(c){throw c instanceof L?c:new L(D.LOW_STREAM_ENCODING_ERROR,c.message)}}}class MI extends a1{constructor(n,s,c,u){var h,p;super(n,b(h=b(p="track-".concat(n.kind,"-")).call(p,s,"-")).call(h,u));this._isDestroyed=!1,this._userId=s,this._uintId=c}getUserId(){return this._userId}_updateOriginMediaStreamTrack(n){this._mediaStreamTrack=this._originMediaStreamTrack=n,this._updatePlayerSource()}_destroy(){this._isDestroyed=!0,R.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}}class Cl extends MI{constructor(n,s,c,u){super(n,s,c,u);this.trackMediaType="video",this.updateMediaStreamTrackResolution()}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Vr.PLAYING)}getStats(){return Kc(()=>{R.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Gs(this,De.GET_STATS)||Wh({},Mp)}play(n,s={}){let c=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.REMOTE_VIDEO_TRACK_PLAY,options:[this.getTrackId(),typeof n=="string"?n:"HTMLElement",s]});if(typeof n=="string"){let h=document.getElementById(n);var u;h?n=h:(R.warning(b(u="[".concat(this.getTrackId(),'] can not find "#')).call(u,n,'" element, use document.body')),n=document.body)}R.debug("[".concat(this.getTrackId(),"] start video playback"),pe(s)),n=Wh({fit:"cover"},s,{trackId:this.getTrackId(),element:n}),this._player?this._player.updateConfig(n):(this._player=new wI(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.emit(cl.FIRST_FRAME_DECODED)}),this._player.play(),c.onSuccess()}stop(){let n=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.REMOTE_VIDEO_TRACK_STOP,options:[this.getTrackId()]});if(!this._player)return n.onSuccess();this._player.destroy(),this._player=void 0,R.debug("[".concat(this.getTrackId(),"] stop video playback")),n.onSuccess()}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){um(this._originMediaStreamTrack).then(([n,s])=>{this._videoHeight=s,this._videoWidth=n}).catch(id)}_updatePlayerSource(){R.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}}class yl extends MI{constructor(n,s,c,u){super(n,s,c,u);this.trackMediaType="audio",this._useAudioElement=!0,this._volume=100,this._source=new u1(n,!0),this._source.once(Qi.RECEIVE_TRACK_BUFFER,()=>{this.emit(cl.FIRST_FRAME_DECODED)})}get isPlaying(){return this._useAudioElement?fi.isPlaying(this.getTrackId()):this._source.isPlayed}setAudioFrameCallback(n,s=4096){if(!n)return this._source.removeAllListeners(Qi.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(s),this._source.removeAllListeners(Qi.ON_AUDIO_BUFFER),this._source.on(Qi.ON_AUDIO_BUFFER,c=>n(c))}setVolume(n){let s=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.REMOTE_AUDIO_SET_VOLUME,options:[this.getTrackId(),n]},300);this._volume=n,this._useAudioElement?fi.setVolume(this.getTrackId(),n):this._source.setVolume(n/100),s.onSuccess()}async setPlaybackDevice(n){let s=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.REMOTE_AUDIO_SET_OUTPUT_DEVICE,options:[this.getTrackId(),n]});if(!this._useAudioElement)throw new L(D.NOT_SUPPORTED,"your browser does not support setting the audio output device");try{await fi.setSinkID(this.getTrackId(),n)}catch(c){throw s.onError(c),c}s.onSuccess()}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Kc(()=>{R.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Gs(this,De.GET_STATS)||Wh({},Lp)}play(){let n=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.REMOTE_AUDIO_TRACK_PLAY,options:[this.getTrackId()]});R.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(R.debug("[".concat(this.getTrackId(),"] use audio element to play")),fi.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play(),n.onSuccess()}stop(){let n=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.REMOTE_AUDIO_TRACK_STOP,options:[this.getTrackId()]});R.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?fi.stop(this.getTrackId()):this._source.stop(),n.onSuccess()}_destroy(){super._destroy(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){R.debug("[".concat(this.getTrackId(),"] update player source track")),this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&fi.updateTrack(this.getTrackId(),this._mediaStreamTrack)}}class eN extends RI{constructor(n,s,c,u){super(c,n.uid);this.type="sub",this.unusedTracks=[],this.onTrack=h=>{var p,f;if(h.kind==="audio"&&!this.subscribeOptions.audio||h.kind==="video"&&!this.subscribeOptions.video)return this.unusedTracks.push(h),void R.debug(b(f="[".concat(this.connectionId,"] unused ontrack event, kind: ")).call(f,h.kind));R.debug(b(p="[".concat(this.connectionId,"] emit pc ontrack after subscribe ")).call(p,h.kind),h),p=h.kind==="audio"?this.user._audioTrack:this.user._videoTrack;var m,I;p?p._updateOriginMediaStreamTrack(h):h.kind==="audio"?(this.pc._statsFilter.setIsFirstAudioDecoded(!1),this.user._audioTrack=new yl(h,this.getUserId(),this.user._uintid,this.joinInfo.clientId),R.info(b(m="[".concat(this.connectionId,"] create remote audio track: ")).call(m,this.user._audioTrack.getTrackId())),this.bindTrackEvents(this.user._audioTrack)):(this.user._videoTrack=new Cl(h,this.getUserId(),this.user._uintid,this.joinInfo.clientId),R.info(b(I="[".concat(this.connectionId,"] create remote video track: ")).call(I,this.user._videoTrack.getTrackId())),this.bindTrackEvents(this.user._videoTrack))},this.handleGetRemoteAudioStats=h=>{h(this.statsCollector.getRemoteAudioTrackStats(this.connectionId))},this.handleGetRemoteVideoStats=h=>{h(this.statsCollector.getRemoteVideoTrackStats(this.connectionId))},this.handleGetSessionID=h=>{h(this.joinInfo.sid)},this.user=n,this.statsCollector=s,this.statsCollector.addRemoteConnection(this),this.subscribeOptions=u}async startP2PConnection(){return new se(async(n,s)=>{let c=m=>{if(m==="connected"&&(z.subscribe(this.joinInfo.sid,{lts:this.startTime,succ:!0,video:this.subscribeOptions.video,audio:this.subscribeOptions.audio,peerid:this.user.uid,ec:null,subscribeRequestid:this.ID,p2pid:this.pc.ID}),this.off(Oe.CONNECTION_STATE_CHANGE,c),n()),m==="disconnected"){if(this.off(Oe.CONNECTION_STATE_CHANGE,c),this.disconnectedReason)return s(this.disconnectedReason);s(new L(D.OPERATION_ABORTED,"subscribe abort"))}};if(this.on(Oe.CONNECTION_STATE_CHANGE,c),this.disconnectedReason=void 0,this.connectionState="connecting",this.startTime=le(),!this.subscribeOptions)return void s(new L(D.UNEXPECTED_ERROR,"no subscribe options"));let u=new MediaStream,h=new se(m=>{this.pc.onTrack=(I,E)=>{var _,S;if(I.kind==="audio"&&!this.subscribeOptions.audio||I.kind==="video"&&!this.subscribeOptions.video)return this.unusedTracks.push(I),void R.debug(b(S="[".concat(this.connectionId,"] unused ontrack event ")).call(S,I.kind));u.addTrack(I),S={audio:0<u.getAudioTracks().length,video:0<u.getVideoTracks().length},R.debug(b(_="[".concat(this.connectionId,"] subscribe ontrack: ")).call(_,I.kind),E,I);e:{I=this.subscribeOptions;var N,O;for(E=sl(N=ut(S)).call(N),N=sl(O=ut(I)).call(O),O=0;O<E.length;O+=1){if(E[O]!==N[O]){S=!1;break e}if(S[E[O]]!==I[E[O]]){S=!1;break e}}S=!0}S&&(this.pc.onTrack=this.onTrack,R.debug("[".concat(this.connectionId,"] get all subscribed tracks")),m(u))}});try{let m=function(N){return qe().name!==Xe.FIREFOX?N:N.replace("/recvonly http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"," http://www.webrtc.org/experiments/rtp-hdrext/playout-delay")}(Tm(await this.pc.createOfferSDP()));await this.pc.setOfferSDP(m),R.debug("[".concat(this.connectionId,"] create and set offer success"));let I=await Or(this,Oe.NEED_ANSWER,{messageType:"OFFER",sdp:m,offererSessionId:104,retry:!0});await this.pc.setAnswerSDP(Tm(I.sdp)),R.debug("[".concat(this.connectionId,"] set answer success"));let E=await se.all([h,this.icePromise]),_=E[0].getAudioTracks()[0],S=E[0].getVideoTracks()[0];var p,f;_&&(this.user._audioTrack?this.user._audioTrack._updateOriginMediaStreamTrack(_):(this.user._audioTrack=new yl(_,this.getUserId(),this.user._uintid,this.joinInfo.clientId),R.info(b(p="[".concat(this.connectionId,"] create remote audio track: ")).call(p,this.user._audioTrack.getTrackId())),this.bindTrackEvents(this.user._audioTrack))),S&&(this.user._videoTrack?this.user._videoTrack._updateOriginMediaStreamTrack(S):(this.user._videoTrack=new Cl(S,this.getUserId(),this.user._uintid,this.joinInfo.clientId),R.info(b(f="[".concat(this.connectionId,"] create remote video track: ")).call(f,this.user._videoTrack.getTrackId())),this.bindTrackEvents(this.user._videoTrack))),this.connectionState="connected",this.startUploadStats()}catch(m){this.off(Oe.CONNECTION_STATE_CHANGE,c),this.connectionState="disconnected",z.subscribe(this.joinInfo.sid,{lts:this.startTime,succ:!1,video:this.subscribeOptions.video,audio:this.subscribeOptions.audio,peerid:this.user.uid,ec:m.code,subscribeRequestid:this.ID,p2pid:this.pc.ID}),s(m)}})}async closeP2PConnection(n){this.connectionState!=="disconnected"&&(this.stopUploadStats(),this.statsCollector.removeConnection(this.connectionId),this.connectionState="disconnected",await this.setSubscribeOptions({audio:!1,video:!1}),await this.closePC(n),this.removeAllListeners())}getNetworkQuality(){var n=this.pc.getStats();if(!n.audioRecv[0]&&!n.videoRecv[0])return 1;var s=Gs(this,Oe.NEED_SIGNAL_RTT),c=n.rtt;s=(c&&s?(c+s)/2:c||s)||0,c=n.audioRecv[0]?n.audioRecv[0].jitterMs:void 0,n=n.recvPacketLossRate;let u=70*n/50+.3*s/1500;return c&&(u=60*n/50+.2*s/1500+.2*c/400),.1>u?1:.17>u?2:.36>u?3:.59>u?4:5}uploadStats(n){let s=this.user.audioTrack?function(u,h){const p=u.audioRecv[0];return p?(u={id:rr(10,""),timestamp:new Date(u.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:p.ssrc.toString()},u.bytesReceived=p.bytes.toString(),u.packetsLost=p.packetsLost.toString(),u.packetsReceived=p.packets.toString(),p.outputLevel?u.A_aol=Math.round(100*p.outputLevel).toString():u.A_aol=Math.round(100*h._source.getAccurateVolumeLevel()).toString(),u.A_apol=Math.round(100*h._source.getAccurateVolumeLevel()).toString(),h&&(u.A_artd=h._originMediaStreamTrack.enabled&&h._mediaStreamTrack.enabled?"0":"1"),u.A_jr=p.jitterMs.toString(),u.A_jbm=Math.floor(p.jitterBufferMs).toString(),u.A_cdm=Math.floor(p.jitterBufferMs).toString(),u):null}(n,this.user.audioTrack):void 0,c=this.user.videoTrack?function(u,h){const p=u.videoRecv[0];if(!p)return null;u={id:rr(10,""),timestamp:new Date(u.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:p.ssrc.toString()};var f;return u.bytesReceived=p.bytes.toString(),u.packetsLost=p.packetsLost.toString(),u.packetsReceived=p.packets.toString(),p.framesRateFirefox&&(u.A_frr=p.framesRateFirefox.toString()),p.receivedFrame&&(u.A_frr=p.receivedFrame.frameRate.toString()),u.A_frd=p.decodeFrameRate.toString(),p.outputFrame&&(u.A_fro=p.outputFrame.frameRate.toString()),p.jitterBufferMs!==void 0&&(u.A_jbm=Math.floor(p.jitterBufferMs).toString()),p.currentDelayMs!==void 0&&(u.A_cdm=Math.floor(p.currentDelayMs).toString()),u.A_fs=p.firsCount.toString(),u.A_ns=p.nacksCount.toString(),u.A_ps=p.plisCount.toString(),h&&(u.A_vrtd=h._originMediaStreamTrack.enabled&&h._mediaStreamTrack.enabled?"0":"1"),h._player&&0<h._player.freezeTimeCounterList.length&&(u.A_vrft=qr(f=h._player.freezeTimeCounterList).call(f,0,1)[0].toString()),u}(n,this.user.videoTrack):void 0;s&&ui(()=>this.emit(Oe.NEED_UPLOAD,Pi.SUBSCRIBE_STATS,s)),c&&ui(()=>this.emit(Oe.NEED_UPLOAD,Pi.SUBSCRIBE_STATS,c))}uploadSlowStats(n){}uploadRelatedStats(n,s){let c=this.pc._statsFilter.videoIsReady===!0,u=function(p,f,m){return p=p.audioRecv[0],p?(m=tc.isRemoteAudioFreeze(m),{mediaType:"audio",isAudioMute:!1,peerId:f,googJitterReceived:p.jitterMs.toString(),isFreeze:m,bytesReceived:p.bytes.toString(),packetsReceived:p.packets.toString(),packetsLost:p.packetsLost.toString(),frameReceived:p.receivedFrames.toString(),frameDropped:p.droppedFrames.toString()}):null}(n,this.getUserId(),this.user.audioTrack),h=function(p,f,m,I,E){return f=f.videoRecv[0],f?(p=tc.isRemoteVideoFreeze(E,f,I?I.videoRecv[0]:void 0)&&p,m={mediaType:"video",isVideoMute:!1,peerId:m,frameRateReceived:f.receivedFrame&&f.receivedFrame.frameRate.toString(),frameRateDecoded:f.decodedFrame&&f.decodedFrame.frameRate.toString(),isFreeze:p,bytesReceived:f.bytes.toString(),packetsReceived:f.packets.toString(),packetsLost:f.packetsLost.toString()},f.framesRateFirefox&&(m.frameRateDecoded=f.framesRateFirefox.toString(),m.frameRateReceived=f.framesRateFirefox.toString()),m):null}(c,n,this.getUserId(),s,this.user.videoTrack);u&&ui(()=>{this.emit(Oe.NEED_UPLOAD,Pi.SUBSCRIBE_RELATED_STATS,u)}),h&&ui(()=>{this.emit(Oe.NEED_UPLOAD,Pi.SUBSCRIBE_RELATED_STATS,h)})}emitOnTrackFromUnusedTracks(){if(this.subscribeOptions){var n=this.subscribeOptions.video;if(this.subscribeOptions.audio){var s;let u=ze(s=this.unusedTracks).call(s,h=>h.kind==="audio"&&h.readyState==="live");js(this.unusedTracks,u),u&&this.onTrack(u)}if(n){var c;n=ze(c=this.unusedTracks).call(c,u=>u.kind==="video"&&u.readyState==="live"),js(this.unusedTracks,n),n&&this.onTrack(n)}}}async setSubscribeOptions(n){var s,c,u,h;if(n.audio!==this.subscribeOptions.audio||n.video!==this.subscribeOptions.video){if(this.connectionState==="connecting")try{await this.createWaitConnectionConnectedPromise()}catch{throw new L(D.OPERATION_ABORTED,"can not update subscribe options, operation abort")}n.audio===this.subscribeOptions.audio&&n.video===this.subscribeOptions.video||(R.debug(b(s=b(c=b(u=b(h="[".concat(this.connectionId,"] update subscribe options [a: ")).call(h,this.subscribeOptions.audio,", v: ")).call(u,this.subscribeOptions.video,"] -> [a: ")).call(c,n.audio,", v: ")).call(s,n.video,"]")),this.subscribeOptions=n,!n.audio&&this.user._audioTrack&&(this.unusedTracks.push(this.user._audioTrack._originMediaStreamTrack),this.user._audioTrack._destroy(),this.unbindTrackEvents(this.user._audioTrack),this.user._audioTrack=void 0),!n.video&&this.user._videoTrack&&(this.unusedTracks.push(this.user._videoTrack._originMediaStreamTrack),this.user._videoTrack._destroy(),this.unbindTrackEvents(this.user._videoTrack),this.user._videoTrack=void 0),this.emitOnTrackFromUnusedTracks())}}createPC(){this.pc=new _I({turnServer:this.joinInfo.turnServer}),this.pc.onFirstAudioDecoded=()=>{this.user.audioTrack&&this.user.audioTrack.emit(cl.FIRST_FRAME_DECODED),z.firstRemoteFrame(this.joinInfo.sid,Jr.FIRST_AUDIO_DECODE,zt.FIRST_AUDIO_DECODE,{peer:this.user._uintid,subscribeElapse:le()-this.startTime,subscribeRequestid:this.ID,p2pid:this.pc.ID})},this.pc.onFirstAudioReceived=()=>{z.firstRemoteFrame(this.joinInfo.sid,Jr.FIRST_AUDIO_RECEIVED,zt.FIRST_AUDIO_RECEIVED,{peer:this.user._uintid,subscribeElapse:le()-this.startTime,subscribeRequestid:this.ID,p2pid:this.pc.ID})},this.pc.onFirstVideoDecoded=(n,s)=>{z.firstRemoteFrame(this.joinInfo.sid,Jr.FIRST_VIDEO_DECODE,zt.FIRST_VIDEO_DECODE,{peer:this.user._uintid,videowidth:n,videoheight:s,subscribeElapse:le()-this.startTime,subscribeRequestid:this.ID,p2pid:this.pc.ID})},this.pc.onFirstVideoReceived=()=>{z.firstRemoteFrame(this.joinInfo.sid,Jr.FIRST_VIDEO_RECEIVED,zt.FIRST_VIDEO_RECEIVED,{peer:this.user._uintid,subscribeElapse:le()-this.startTime,subscribeRequestid:this.ID,p2pid:this.pc.ID})},this.updateICEPromise()}async closePC(n){return this.pc.audioTrack&&this.pc.audioTrack.stop(),this.pc.videoTrack&&this.pc.videoTrack.stop(),this.pc.onTrack=void 0,this.pc.onICEConnectionStateChange=void 0,this.pc.close(),n?!1:await Or(this,Oe.NEED_UNSUB)}onPCDisconnected(n){z.subscribe(this.joinInfo.sid,{lts:this.startTime,succ:!1,video:this.subscribeOptions.video,audio:this.subscribeOptions.audio,peerid:this.user.uid,ec:n.code,subscribeRequestid:this.ID,p2pid:this.pc.ID})}bindTrackEvents(n){n instanceof yl?n.addListener(De.GET_STATS,this.handleGetRemoteAudioStats):n instanceof Cl&&n.addListener(De.GET_STATS,this.handleGetRemoteVideoStats)}unbindTrackEvents(n){n instanceof yl?n.off(De.GET_STATS,this.handleGetRemoteAudioStats):n instanceof Cl&&n.off(De.GET_STATS,this.handleGetRemoteVideoStats)}}class tN extends $r{constructor(n,s,c,u){super();this.reconnectMode="retry",this.commandReqId=this.reqId=0,this.handleWebSocketOpen=()=>{this.reconnectMode="retry",this.startPingPong()},this.handleWebSocketMessage=h=>{if(h.data){h=JSON.parse(h.data);var p;h.requestId?this.emit(b(p="@".concat(h.requestId,"-")).call(p,h.sid),h):this.serviceMode===er.INJECT?this.emit(xi.INJECT_STREAM_STATUS,h):(z.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===er.TRANSCODE?1:2}),this.emit(xi.PUBLISH_STREAM_STATUS,h))}},this.spec=s,this.token=n,this.serviceMode=u,this.websocket=new eA("live-streaming",c),this.websocket.on(ct.CONNECTED,this.handleWebSocketOpen),this.websocket.on(ct.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(ct.REQUEST_NEW_URLS,(h,p)=>{Or(this,xi.REQUEST_NEW_ADDRESS).then(h).catch(p)}),this.websocket.on(ct.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(n){return this.websocket.init(n)}async request(n,s,c,u){this.reqId+=1,n==="request"&&(this.commandReqId+=1);let h=this.commandReqId,p=this.reqId;if(!p||!this.websocket)throw new L(D.UNEXPECTED_ERROR);var f=Yh({command:n,sdkVersion:Xn==="4.7.2"?"0.0.1":Xn,seq:p,requestId:p,allocate:c,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(le()/1e3)},s);if(this.websocket.state==="closed")throw new L(D.WS_DISCONNECT);let m=()=>new se((_,S)=>{this.websocket.once(ct.CLOSED,()=>S(new L(D.WS_ABORT))),this.websocket.once(ct.CONNECTED,_)});this.websocket.state!=="connected"&&await m(),f.clientRequest&&(f.clientRequest.workerToken=this.token);let I=new se((_,S)=>{var N;const O=()=>{S(new L(D.WS_ABORT))};this.websocket.once(ct.RECONNECTING,O),this.websocket.once(ct.CLOSED,O),this.once(b(N="@".concat(p,"-")).call(N,this.spec.sid),B=>{_(B)})});u&&z.workerEvent(this.spec.sid,Yh({},u,{requestId:h,actionType:"request",payload:pe(s.clientRequest),serverCode:0,code:0}));let E=le();this.websocket.sendMessage(f),f=null;try{f=await I}catch(_){if(this.websocket.state==="closed")throw _;return await m(),await this.request(n,s,c)}return u&&z.workerEvent(this.spec.sid,Yh({},u,{requestId:h,actionType:"response",payload:pe(f.serverResponse),serverCode:f.code,success:f.code===200,responseTime:le()-E})),f.code!==200&&this.handleResponseError(f),f}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){let n=Xn==="4.7.2"?"0.0.1":Xn;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:n,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(le()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(n){switch(n.code){case Vt.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void R.warning("live stream response already exists stream");case Vt.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Vt.LIVE_STREAM_RESPONSE_BAD_STREAM:case Vt.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new L(D.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:n.code}).throw();case Vt.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(n.serverResponse.command==="UnpublishStream"||n.serverResponse.command==="UninjectStream")break;throw new L(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Vt.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new L(D.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:n.code}).throw();case Vt.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:var s=new L(D.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(xi.WARNING,s,n.serverResponse.url);case Vt.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:return s=new L(D.LIVE_STREAMING_WARN_FREQUENT_REQUEST),this.emit(xi.WARNING,s,n.serverResponse.url);case Vt.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new L(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Vt.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new L(D.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:n.code}).throw();case Vt.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:return s=new L(D.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT),this.emit(xi.WARNING,s,n.serverResponse.url);case Vt.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new L(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:n.code}).throw();case Vt.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new L(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Vt.LIVE_STREAM_RESPONSE_WORKER_LOST:case Vt.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(n.serverResponse.command==="UnpublishStream"||n.serverResponse.command==="UninjectStream")break;throw new L(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Vt.ERROR_FAIL_SEND_MESSAGE:if(n.serverResponse.command==="UnpublishStream"||n.serverResponse.command==="UninjectStream")break;if(n.serverResponse.command==="UpdateTranscoding"||n.serverResponse.command==="ControlStream")return new L(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:n.code}).throw();throw new L(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Vt.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Vt.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Vt.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Vt.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new L(D.LIVE_STREAMING_CDN_ERROR,"",{code:n.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(id)},6e3)}}class rN extends $r{constructor(n,s=Dr,c=Dr){super();this.retryTimeout=1e4,this.streamingTasks=new Ct,this.isStartingStreamingTask=!1,this.taskMutex=new qo("live-streaming"),this.cancelToken=_o.CancelToken.source(),this.injectConfig=hs({},yR),this.injectLoopTimes=0,this.lastTaskId=1,this.statusError=new Ct,this.spec=n,this.httpRetryConfig=c,this.wsRetryConfig=s}async setTranscodingConfig(n){var s;let c=hs({},CR,{},n);var u,h;c.videoCodecProfile!==66&&c.videoCodecProfile!==77&&c.videoCodecProfile!==100&&(R.debug(b(u="[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ")).call(u,c.videoCodecProfile," -> 100")),c.videoCodecProfile=100),c.transcodingUsers||(c.transcodingUsers=c.userConfigs),c.transcodingUsers&&(c.transcodingUsers=Ie(h=c.transcodingUsers).call(h,S=>hs({},IR,{},S,{zOrder:S.zOrder?S.zOrder+1:1}))),function(S){var N,O;S.width==null||It(S.width,"config.width",0,1e4),S.height==null||It(S.height,"config.height",0,1e4),S.videoBitrate==null||It(S.videoBitrate,"config.videoBitrate",1,1e6),S.videoFrameRate==null||It(S.videoFrameRate,"config.videoFrameRate"),S.lowLatency==null||us(S.lowLatency,"config.lowLatency"),S.audioSampleRate==null||Ir(S.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),S.audioBitrate==null||It(S.audioBitrate,"config.audioBitrate",1,128),S.audioChannels==null||Ir(S.audioChannels,"config.audioChannels",[1,2,3,4,5]),S.videoGop==null||It(S.videoGop,"config.videoGop"),S.videoCodecProfile==null||Ir(S.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),S.userCount==null||It(S.userCount,"config.userCount",0,17),S.backgroundColor==null||It(S.backgroundColor,"config.backgroundColor",0,16777215),S.userConfigExtraInfo==null||Yr(S.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),S.transcodingUsers&&S.transcodingUsers!=null&&(Oh(S.transcodingUsers,"config.transcodingUsers"),H(N=S.transcodingUsers).call(N,(B,Q)=>{bh(B.uid),B.x==null||It(B.x,"transcodingUser[".concat(Q,"].x"),0,1e4),B.y==null||It(B.y,"transcodingUser[".concat(Q,"].y"),0,1e4),B.width==null||It(B.width,"transcodingUser[".concat(Q,"].width"),0,1e4),B.height==null||It(B.height,"transcodingUser[".concat(Q,"].height"),0,1e4),B.zOrder==null||It(B.zOrder-1,"transcodingUser[".concat(Q,"].zOrder"),0,100),B.alpha==null||It(B.alpha,"transcodingUser[".concat(Q,"].alpha"),0,1,!1)})),S.watermark==null||Dh(S.watermark,"watermark"),S.backgroundImage==null||Dh(S.backgroundImage,"backgroundImage"),S.images&&S.images!=null&&(Oh(S.images,"config.images"),H(O=S.images).call(O,(B,Q)=>{Dh(B,"images[".concat(Q,"]"))}))}(c),n=[];var p,f;if(c.images&&n.push(...Ie(p=c.images).call(p,S=>hs({},Pp,{},S,{zOrder:255}))),c.backgroundImage&&(n.push(hs({},Pp,{},c.backgroundImage,{zOrder:0})),delete c.backgroundImage),c.watermark&&(n.push(hs({},Pp,{},c.watermark,{zOrder:255})),delete c.watermark),c.images=n,c.transcodingUsers&&(c.userConfigs=Ie(f=c.transcodingUsers).call(f,S=>hs({},S)),c.userCount=c.transcodingUsers.length,delete c.transcodingUsers),p=Ie(s=c.userConfigs||[]).call(s,S=>typeof S.uid=="number"?se.resolve(S.uid):Uh(S.uid,this.spec,this.cancelToken.token,this.httpRetryConfig)),s=await se.all(p),H(s).call(s,(S,N)=>{c.userConfigs&&c.userConfigs[N]&&(c.userConfigs[N].uid=S)}),this.transcodingConfig=c,this.connection)try{var m,I,E;let S=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Ie(m=io(ra(I=this.streamingTasks).call(I))).call(m,N=>N.taskId).join("#")});R.debug(b(E="[".concat(this.spec.clientId,"] update live transcoding config success, code: ")).call(E,S.code,", config:"),pe(this.transcodingConfig))}catch(S){var _;if(!S.data||!S.data.retry)throw S;S.data.changeAddress&&this.connection.tryNextAddress(),H(_=this.streamingTasks).call(_,N=>{R.warning("[".concat(this.spec.clientId,"] live streaming receive error"),S.toString(),"try to republish",N.url),this.startLiveStreamingTask(N.url,N.mode,S).then(()=>{var O;R.debug(b(O="[".concat(this.spec.clientId,"] live streaming republish ")).call(O,N.url," success"))}).catch(O=>{R.error("[".concat(this.spec.clientId,"] live streaming republish failed"),N.url,O.toString()),this.onLiveStreamError&&this.onLiveStreamError(N.url,O)})})}}setInjectStreamConfig(n,s){this.injectConfig=sn({},this.injectConfig,n),this.injectLoopTimes=s}async startLiveStreamingTask(n,s,c){var u,h,p,f;if(ze(u=io(ra(h=this.streamingTasks).call(h))).call(u,I=>I.mode===er.INJECT)&&s===er.INJECT)return new L(D.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!this.transcodingConfig&&s===er.TRANSCODE)throw new L(D.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");if(u={command:"PublishStream",ts:le(),url:n,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0},R.debug(b(p=b(f="[".concat(this.spec.clientId,"] start live streaming ")).call(f,n,", mode: ")).call(p,s)),p=await this.taskMutex.lock(),!this.connection&&c)return void p();if(this.streamingTasks.get(n)&&!c)return p(),new L(D.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(s))}catch(I){throw p(),I}switch(s){case er.TRANSCODE:u.transcodingConfig=hs({},this.transcodingConfig);break;case er.INJECT:u={cname:this.spec.cname,command:"InjectStream",sid:this.spec.sid,transcodingConfig:this.injectConfig,ts:le(),url:n,loopTimes:this.injectLoopTimes}}this.uapResponse&&this.uapResponse.vid&&(u.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0,f=this.lastTaskId++;try{var m;let I=new se((_,S)=>{Mn(this.retryTimeout).then(()=>{if(c)return S(c);const N=this.statusError.get(n);return N?(this.statusError.delete(n),S(N)):void 0})}),E=await se.race([this.connection.request("request",{clientRequest:u},!0,{url:n,command:"PublishStream",workerType:s===er.TRANSCODE?1:2,requestByUser:!c,tid:f.toString()}),I]);this.isStartingStreamingTask=!1,R.debug(b(m="[".concat(this.spec.clientId,"] live streaming started, code: ")).call(m,E.code)),this.streamingTasks.set(n,{clientRequest:u,mode:s,url:n,taskId:f}),p()}catch(I){if(p(),this.isStartingStreamingTask=!1,!I.data||!I.data.retry||c)throw I;return I.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(n,s,I)):await this.startLiveStreamingTask(n,s,I)}}stopLiveStreamingTask(n){return new se((s,c)=>{let u=this.streamingTasks.get(n);if(!u||!this.connection)return new L(D.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();let h=u.mode;u.abortTask=()=>{R.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(n),s()},this.connection.request("request",{clientRequest:{command:h===er.INJECT?"UninjectStream":"UnpublishStream",url:u.url}},!1,{url:n,command:"UnPublishStream",workerType:h===er.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(p=>{var f;R.debug(b(f="[".concat(this.spec.clientId,"] stop live streaming success, code: ")).call(f,p.code)),this.streamingTasks.delete(n),this.streamingTasks.size===0&&h!==er.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),s(),h===er.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(5,this.spec.uid,n)}).catch(c)})}async controlInjectStream(n,s,c,u){let h=this.streamingTasks.get(n);if(!h||!this.connection||h.mode!==er.INJECT)throw new L(D.INVALID_OPERATION,"can not find inject stream task to control");return(await this.connection.request("request",{clientRequest:{command:"ControlStream",url:n,control:s,audioVolume:c,position:u}})).serverResponse}resetAllTask(){var n;let s=io(ra(n=this.streamingTasks).call(n));this.terminate();for(let c of s)this.startLiveStreamingTask(c.url,c.mode).catch(u=>{this.onLiveStreamError&&this.onLiveStreamError(c.url,u)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Ct,this.isStartingStreamingTask=!1,this.statusError=new Ct,this.cancelToken=_o.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(n){if(this.connection)throw new L(D.UNEXPECTED_ERROR,"live streaming connection has already connected");let s=await Or(this,$a.REQUEST_WORKER_MANAGER_LIST,n);return this.uapResponse=s,this.connection=new tN(s.workerToken,this.spec,this.wsRetryConfig,n),this.connection.on(xi.WARNING,(c,u)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(u,c)),this.connection.on(xi.PUBLISH_STREAM_STATUS,c=>this.handlePublishStreamServer(c)),this.connection.on(xi.INJECT_STREAM_STATUS,c=>this.handleInjectStreamServerStatus(c)),this.connection.on(xi.REQUEST_NEW_ADDRESS,(c,u)=>{if(!this.connection)return u(new L(D.UNEXPECTED_ERROR,"can not get new live streaming address list"));Or(this,$a.REQUEST_WORKER_MANAGER_LIST,n).then(h=>{this.uapResponse=h,c(h.addressList)}).catch(u)}),await this.connection.init(s.addressList),this.connection}handlePublishStreamServer(n){var s=n.serverStatus&&n.serverStatus.url||"empty_url";let c=this.streamingTasks.get(s),u=n.reason;switch(n.code){case Vt.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Vt.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Vt.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Vt.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:if(n=new L(D.LIVE_STREAMING_CDN_ERROR,"",{code:n.code}),c)return R.error(n.toString()),this.onLiveStreamError&&this.onLiveStreamError(s,n);if(!this.isStartingStreamingTask)break;this.statusError.set(s,n);case Vt.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:return n=new L(D.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,u),this.onLiveStreamWarning&&this.onLiveStreamWarning(s,n);case Vt.LIVE_STREAM_RESPONSE_WORKER_LOST:case Vt.LIVE_STREAM_RESPONSE_WORKER_QUIT:var h;if(this.connection){this.connection.tryNextAddress(),s=io(ra(h=this.streamingTasks).call(h));for(let p of s)p.abortTask?p.abortTask():(R.warning("[".concat(this.spec.clientId,"] publish stream status code"),n.code,"try to republish",p.url),this.startLiveStreamingTask(p.url,p.mode,new L(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:n.code})).then(()=>{R.debug("[".concat(this.spec.clientId,"] republish live stream success"),p.url)}).catch(f=>{R.error(f.toString()),this.onLiveStreamError&&this.onLiveStreamError(p.url,f)}))}}}handleInjectStreamServerStatus(n){let s=Number(n.uid),c=n.serverStatus&&n.serverStatus.url;switch(n.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(0,s,c));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(1,s,c),void this.streamingTasks.delete(c);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(2,s,c),void this.streamingTasks.delete(c);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(10,s,c),void this.streamingTasks.delete(c);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(3,s,c),void this.streamingTasks.delete(c);default:return void R.debug("inject stream server status",n)}}hasUrl(n){return this.streamingTasks.has(n)}}class PI{constructor(){this.destChannelMediaInfos=new Ct}setSrcChannelInfo(n){qg(n),this.srcChannelMediaInfo=n}addDestChannelInfo(n){qg(n),this.destChannelMediaInfos.set(n.channelName,n)}removeDestChannelInfo(n){kh(n),this.destChannelMediaInfos.delete(n)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}class nN extends $r{constructor(n,s,c){super();this.requestId=1,this.onOpen=()=>{this.emit("open"),this.startHeartBeatCheck()},this.onClose=u=>{this.emit("close"),this.dispose()},this.onMessage=u=>{if(u=JSON.parse(u.data),!u||u.command!=="serverResponse"||!u.requestId)return u&&u.command==="serverStatus"&&u.serverStatus&&u.serverStatus.command?(this.emit("status",u.serverStatus),void this.emit(u.serverStatus.command,u.serverStatus)):void 0;this.emit("req_".concat(u.requestId),u)},this.joinInfo=n,this.clientId=s,this.ws=new eA("cross-channel-".concat(this.clientId),c),this.ws.on(ct.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(ct.CONNECTED,this.onOpen),this.ws.on(ct.ON_MESSAGE,this.onMessage),this.ws.on(ct.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(n){let s=this.requestId++;return n.requestId=s,n.seq=s,this.ws.sendMessage(n),s}waitStatus(n){return new se((s,c)=>{let u=window.setTimeout(()=>{c(new L(D.TIMEOUT,"wait status timeout, status: ".concat(n)))},5e3);this.once(n,h=>{window.clearTimeout(u),h.state&&h.state!==0?c(new L(D.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(n))):s(void 0)}),this.once("dispose",()=>{window.clearTimeout(u),c(new L(D.WS_ABORT))})})}async request(n){if(this.ws.state==="closed")throw new L(D.WS_DISCONNECT);let s=()=>new se((u,h)=>{this.ws.once(ct.CLOSED,()=>h(new L(D.WS_ABORT))),this.ws.once(ct.CONNECTED,u)});this.ws.state!=="connected"&&await s();let c=this.sendMessage(n);if(n=await new se((u,h)=>{const p=()=>{h(new L(D.WS_ABORT))};this.ws.once(ct.RECONNECTING,p),this.ws.once(ct.CLOSED,p),this.once("req_".concat(c),u),Mn(3e3).then(()=>{this.removeAllListeners("req_".concat(c)),this.ws.off(ct.RECONNECTING,p),this.ws.off(ct.CLOSED,p),h(new L(D.TIMEOUT,"cross channel ws request timeout"))})}),!n||n.code!==200)throw new L(D.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(pe(n)));return n}async connect(n){this.ws.removeAllListeners(ct.REQUEST_NEW_URLS),this.ws.on(ct.REQUEST_NEW_URLS,s=>{s(n)}),await this.ws.init(n)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(n){let s=this.requestId++;return n.requestId=s,this.ws.sendMessage(n),s}startHeartBeatCheck(){this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class iN extends $r{constructor(n,s,c,u){super();this.cancelToken=_o.CancelToken.source(),this.requestId=0,this._state="RELAY_STATE_IDLE",this.errorCode="RELAY_OK",this.onStatus=h=>{var p;R.debug(b(p="[".concat(this.clientId,"] ChannelMediaStatus: ")).call(p,pe(h))),h&&h.command&&(h.command==="onAudioPacketReceived"&&this.emit("event","PACKET_RECEIVED_AUDIO_FROM_SRC"),h.command==="onVideoPacketReceived"&&this.emit("event","PACKET_RECEIVED_VIDEO_FROM_SRC"),h.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode="SRC_TOKEN_EXPIRED",this.state="RELAY_STATE_FAILURE"),h.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode="DEST_TOKEN_EXPIRED",this.state="RELAY_STATE_FAILURE"))},this.onReconnect=async()=>{R.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event","NETWORK_DISCONNECTED"),this.state="RELAY_STATE_IDLE",this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(h=>{this.state!=="RELAY_STATE_IDLE"&&(R.error("auto restart channel media relay failed",h.toString()),this.errorCode="SERVER_CONNECTION_LOST",this.state="RELAY_STATE_FAILURE")})},this.joinInfo=n,this.clientId=s,this.signal=new nN(this.joinInfo,this.clientId,c),this.httpRetryConfig=u}set state(n){n!==this._state&&(n!=="RELAY_STATE_FAILURE"&&(this.errorCode="RELAY_OK"),this.emit("state",n,this.errorCode),this._state=n)}get state(){return this._state}async startChannelMediaRelay(n){if(this.state!=="RELAY_STATE_IDLE")throw new L(D.INVALID_OPERATION);this.state="RELAY_STATE_CONNECTING",await this.connect(),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(n)}catch(s){throw s.data&&s.data.serverResponse&&s.data.serverResponse.command==="SetSourceChannel"?new L(D.CROSS_CHANNEL_FAILED_JOIN_SRC):s.data&&s.data.serverResponse&&s.serverResponse.command==="SetDestChannelStatus"?new L(D.CROSS_CHANNEL_FAILED_JOIN_DEST):s.data&&s.data.serverResponse&&s.serverResponse.command==="StartPacketTransfer"?new L(D.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):s}this.prevChannelMediaConfig=n}async updateChannelMediaRelay(n){if(this.state!=="RELAY_STATE_RUNNING")throw new L(D.INVALID_OPERATION);await this.sendUpdateMessage(n),this.prevChannelMediaConfig=n}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),R.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state="RELAY_STATE_IDLE",this.dispose()}dispose(){R.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=_o.CancelToken.source(),this.state="RELAY_STATE_IDLE",this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){let n=await qS(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=n.workerToken,await this.signal.connect(n.addressList),this.emit("event","NETWORK_CONNECTED"),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(n){var s=this.genMessage(Xr.StopPacketTransfer);await this.signal.request(s),await this.signal.waitStatus("Normal Quit"),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success")),s=this.genMessage(Xr.SetSdkProfile,n),await this.signal.request(s),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success")),s=this.genMessage(Xr.SetSourceChannel,n),await this.signal.request(s),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event","PACKET_JOINED_SRC_CHANNEL"),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success")),s=this.genMessage(Xr.SetSourceUserId,n),await this.signal.request(s),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success")),s=this.genMessage(Xr.SetDestChannel,n),await this.signal.request(s),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event","PACKET_JOINED_DEST_CHANNEL"),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success")),n=this.genMessage(Xr.StartPacketTransfer,n),await this.signal.request(n),this.emit("event","PACKET_SENT_TO_DEST_CHANNEL"),this.state="RELAY_STATE_RUNNING",R.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success"))}async sendUpdateMessage(n){n=this.genMessage(Xr.UpdateDestChannel,n),await this.signal.request(n),this.emit("event","PACKET_UPDATE_DEST_CHANNEL"),R.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){let n=this.genMessage(Xr.StopPacketTransfer);await this.signal.request(n),R.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(n,s){let c=[],u=[],h=[];this.requestId+=1;let p={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Xn,sid:this.joinInfo.sid,ts:le(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};p.sdkVersion==="4.7.2"&&(p.sdkVersion="0.0.1");let f=null,m=null;switch(n){case Xr.SetSdkProfile:return p.clientRequest={command:"SetSdkProfile",type:"multi_channel"},p;case Xr.SetSourceChannel:if(m=s&&s.getSrcChannelMediaInfo(),!m)throw new L(D.UNEXPECTED_ERROR,"can not find source config");return p.clientRequest={command:"SetSourceChannel",uid:"0",channelName:m.channelName,token:m.token||this.joinInfo.appId},p;case Xr.SetSourceUserId:if(m=s&&s.getSrcChannelMediaInfo(),!m)throw new L(D.UNEXPECTED_ERROR,"can not find source config");return p.clientRequest={command:"SetSourceUserId",uid:m.uid+""},p;case Xr.SetDestChannel:if(f=s&&s.getDestChannelMediaInfo(),!f)throw new L(D.UNEXPECTED_ERROR,"can not find dest config");return H(f).call(f,I=>{c.push(I.channelName),u.push(I.uid+""),h.push(I.token||this.joinInfo.appId)}),p.clientRequest={command:"SetDestChannel",channelName:c,uid:u,token:h},p;case Xr.StartPacketTransfer:return p.clientRequest={command:"StartPacketTransfer"},p;case Xr.Reconnect:return p.clientRequest={command:"Reconnect"},p;case Xr.StopPacketTransfer:return p.clientRequest={command:"StopPacketTransfer"},p;case Xr.UpdateDestChannel:if(f=s&&s.getDestChannelMediaInfo(),!f)throw new L(D.UNEXPECTED_ERROR,"can not find dest config");return H(f).call(f,I=>{c.push(I.channelName),u.push(I.uid+""),h.push(I.token||this.joinInfo.appId)}),p.clientRequest={command:"UpdateDestChannel",channelName:c,uid:u,token:h},p}return p}}class oN{constructor(n,s){this._trust_stream_added_state_=this._trust_video_mute_state_=this._trust_audio_mute_state_=this._trust_video_enabled_state_=this._trust_audio_enabled_state_=this._trust_in_room_=!0,this._video_muted_=this._audio_muted_=!1,this._video_enabled_=this._audio_enabled_=!0,this._video_added_=this._audio_added_=!1,this.uid=n,this._uintid=s}get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio)return this._audioTrack}get videoTrack(){if(this.hasVideo)return this._videoTrack}}let sN=async i=>{var n=Qh(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`);n=await window.crypto.subtle.importKey("spki",n,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),i=(s=i,new TextEncoder().encode(s));var s;return s=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},n,i),Cu(new Uint8Array(s))},md;class aN{constructor(n,s){var c;this.name=n,this.time=performance.now(),this.sequence=He(c=_R[s]).call(c,n)}setElapse(n){this.elapse=n}}let cN=new Ct;class lN{constructor(n,s){this.records=[],this._id=n,this._group=s,this._localTimeStamp=le(),this._performanceTimeStamp=performance.now()}checkPoint(n){var s;let c=new aN(n,this._group);c.sequence===-1&&R.warning("[".concat(this._id,"] check point record failed, cannot get the sequence")),this.records.push(c),(n=ze(s=this.records).call(s,u=>u.sequence===c.sequence-1))&&c.setElapse(c.time-n.time)}getRecord(n){var s;return ze(s=this.records).call(s,c=>c&&c.name===n)}resetRecords(){this.records.length=0}}var _l=function(i,n,s,c){var u,h=arguments.length,p=3>h?n:c===null?c=at(n,s):c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")p=Reflect.decorate(i,n,s,c);else for(var f=i.length-1;0<=f;f--)(u=i[f])&&(p=(3>h?u(p):3<h?u(n,s,p):u(n,s))||p);return 3<h&&p&&dt(n,s,p),p},xn=function(i,n){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,n)};class sc extends $r{constructor(n){var s,c,u,h;let p;if(super(),this._users=[],this._sessionId=null,this._bindEnabledTracks=[],this._leaveMutex=new qo("client-leave"),this._publishMutex=new qo("client-publish"),this._subscribeMutex=new Ct,this._remoteStream=new Ct,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._turnServer={servers:[],mode:"auto"},this._cloudProxyServerMode="disabled",this._isDualStreamEnabled=!1,this._streamFallbackTypeCacheMap=new Ct,this._remoteStreamTypeCacheMap=new Ct,this._axiosCancelSource=_o.CancelToken.source(),this._networkQualitySensitivity="normal",this._useLocalAccessPoint=!1,this._handleLocalTrackEnable=(m,I,E)=>{this.publish(m,!1).then(I).catch(E)},this._handleLocalTrackDisable=(m,I,E)=>{this.unpublish(m,!1).then(I).catch(E)},this._handleUserOnline=m=>{var I;this.isStringUID&&typeof m.uid!="string"&&R.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));let E=ze(I=this._users).call(I,_=>_.uid===m.uid);E?E._trust_in_room_=!0:(I=new oN(m.uid,m.uint_id||m.uid),this._users.push(I),R.debug("[".concat(this._clientId,"] user online"),m.uid),this.emit(Je.USER_JOINED,I))},this._handleUserOffline=m=>{var I;let E=ze(I=this._users).call(I,_=>_.uid===m.uid);E&&(this._handleRemoveStream(m),js(this._users,E),this._remoteStreamTypeCacheMap.delete(E.uid),this._streamFallbackTypeCacheMap.delete(E.uid),R.debug("[".concat(this._clientId,"] user offline"),m.uid,"reason:",m.reason),this.emit(Je.USER_LEAVED,E,m.reason))},this._handleAddAudioOrVideoStream=(m,I,E)=>{var _,S,N;let O=ze(_=this._users).call(_,q=>q.uid===I);if(!O)return void R.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));R.debug(b(S=b(N="[".concat(this._clientId,"] stream added with uid ")).call(N,I,", type ")).call(S,m)),_=m==="audio"?O.hasAudio:O.hasVideo;var B,Q;O._uintid||(O._uintid=E||I),O._trust_stream_added_state_=!0,m==="audio"?O._audio_added_=!0:O._video_added_=!0,(m==="audio"?O.hasAudio:O.hasVideo)&&!_&&(R.info(b(B=b(Q="[".concat(this._clientId,"] remote user ")).call(Q,O.uid," published ")).call(B,m)),this.emit(Je.USER_PUBLISHED,O,m)),m==="video"?z.onGatewayStream(this._sessionId,Jr.ON_ADD_VIDEO_STREAM,zt.ON_ADD_VIDEO_STREAM,{peer:E||I}):z.onGatewayStream(this._sessionId,Jr.ON_ADD_AUDIO_STREAM,zt.ON_ADD_AUDIO_STREAM,{peer:E||I}),(m=this._remoteStream.get(I))&&m.readyToReconnect&&m.connectionState==="connecting"&&m.reconnectPC().catch(q=>{R.error("[".concat(this._clientId,"] resubscribe error"),q.toString())})},this._handleRemoveStream=m=>{var I,E;let _=ze(I=this._users).call(I,S=>S.uid===m.uid);if(!_)return void R.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));R.debug(b(E="[".concat(this._clientId,"] stream removed with uid ")).call(E,m.uid)),I=()=>{},_.hasAudio&&_.hasVideo?I=()=>{var S,N;R.info(b(S="[".concat(this._clientId,"] remote user ")).call(S,_.uid," unpublished audio track")),this.emit(Je.USER_UNPUBLISHED,_,"audio"),R.info(b(N="[".concat(this._clientId,"] remote user ")).call(N,_.uid," unpublished video track")),this.emit(Je.USER_UNPUBLISHED,_,"video")}:_.hasVideo?I=()=>{var S;R.info(b(S="[".concat(this._clientId,"] remote user ")).call(S,_.uid," unpublished video track")),this.emit(Je.USER_UNPUBLISHED,_,"video")}:_.hasAudio&&(I=()=>{var S;R.info(b(S="[".concat(this._clientId,"] remote user ")).call(S,_.uid," unpublished audio track")),this.emit(Je.USER_UNPUBLISHED,_,"audio")}),_._trust_stream_added_state_=!0,_._audio_added_=!1,_._video_added_=!1,(E=this._remoteStream.get(_.uid))&&(E.closeP2PConnection(),this._remoteStream.delete(_.uid)),z.onGatewayStream(this._sessionId,Jr.ON_REMOVE_STREAM,zt.ON_REMOVE_STREAM,{peer:m.uint_id||m.uid}),I()},this._handleSetStreamLocalEnable=(m,I,E)=>{var _,S,N,O,B,Q;let q=ze(_=this._users).call(_,Ze=>Ze.uid===I);if(!q)return void R.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));if(R.debug(b(S=b(N=b(O="[".concat(this._clientId,"] local ")).call(O,m," ")).call(N,E?"enabled":"disabled"," with uid ")).call(S,I)),_=m==="audio"?q.hasAudio:q.hasVideo,m==="audio"){q._trust_audio_enabled_state_=!0;var ie=q._audio_enabled_;if(q._audio_enabled_=E,q._audio_enabled_===ie)return;var Ae,Be;E=q._audio_enabled_?"enable-local-audio":"disable-local-audio",R.debug(b(Ae=b(Be="[".concat(this._clientId,"] user-info-updated, uid: ")).call(Be,I,", msg: ")).call(Ae,E)),this.emit(Je.USER_INFO_UPDATED,I,E)}else{if(q._trust_video_enabled_state_=!0,Ae=q._video_enabled_,q._video_enabled_=E,q._video_enabled_===Ae)return;var ke;E=q._video_enabled_?"enable-local-video":"disable-local-video",R.debug(b(ie=b(ke="[".concat(this._clientId,"] user-info-update, uid: ")).call(ke,I,", msg: ")).call(ie,E)),this.emit(Je.USER_INFO_UPDATED,I,E)}if(E=m==="audio"?q.hasAudio:q.hasVideo,_!==E){var yt,ve;if(!_&&E)return R.info(b(yt=b(ve="[".concat(this._clientId,"] remote user ")).call(ve,I," published ")).call(yt,m)),void this.emit(Je.USER_PUBLISHED,q,m);(yt=this._remoteStream.get(I))&&(ve=Ba({},yt.subscribeOptions),ve.audio=!!q.hasAudio&&ve.audio,ve.video=!!q.hasVideo&&ve.video,ve.audio||ve.video?yt.setSubscribeOptions(ve):(yt.closeP2PConnection().catch(Ze=>{R.warning("close sub pc error",Ze)}),this._remoteStream.delete(q.uid))),R.info(b(B=b(Q="[".concat(this._clientId,"] remote user ")).call(Q,q.uid," unpublished ")).call(B,m)),this.emit(Je.USER_UNPUBLISHED,q,m)}},this._handleMuteStream=(m,I,E)=>{var _,S,N;R.debug("[".concat(this._clientId,"] receive mute message"),m,I,E);let O=ze(_=this._users).call(_,yt=>yt.uid===m);var B;if(!O)return void R.warning(b(B="[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ")).call(B,m));if(_=I==="audio"?O.hasAudio:O.hasVideo,I==="audio"){O._trust_audio_mute_state_=!0;var Q=O._audio_muted_;if(O._audio_muted_=E,O._audio_muted_===Q)return;var q,ie;E=O._audio_muted_?"mute-audio":"unmute-audio",R.debug(b(q=b(ie="[".concat(this._clientId,"] user-info-update, uid: ")).call(ie,m,", msg: ")).call(q,E)),this.emit(Je.USER_INFO_UPDATED,m,E)}else{if(O._trust_video_mute_state_=!0,q=O._video_muted_,O._video_muted_=E,O._video_muted_===q)return;var Ae;E=O._video_muted_?"mute-video":"unmute-video",R.debug(b(Q=b(Ae="[".concat(this._clientId,"] user-info-update, uid: ")).call(Ae,m,", msg: ")).call(Q,E)),this.emit(Je.USER_INFO_UPDATED,m,E)}if(E=I==="audio"?O.hasAudio:O.hasVideo,_!==E){var Be,ke;if(!_&&E)return R.info(b(Be=b(ke="[".concat(this._clientId,"] remote user ")).call(ke,m," published ")).call(Be,I)),void this.emit(Je.USER_PUBLISHED,O,I);(Be=this._remoteStream.get(m))&&(ke=Ba({},Be.subscribeOptions),ke.audio=!!O.hasAudio&&ke.audio,ke.video=!!O.hasVideo&&ke.video,I==="video"&&Be.pc._statsFilter.setVideoIsReady(!1),ke.audio||ke.video?Be.setSubscribeOptions(ke):(Be.closeP2PConnection().catch(yt=>{R.warning("close sub pc error",yt)}),this._remoteStream.delete(O.uid))),R.info(b(S=b(N="[".concat(this._clientId,"] remote user ")).call(N,m," unpublished ")).call(S,I)),this.emit(Je.USER_UNPUBLISHED,O,I)}},this._handleP2PLost=m=>{R.debug("[".concat(this._clientId,"] receive p2p lost"),m);let I=null;if(this._highStream&&this._highStream.pc.ID===m.p2pid)I=this._highStream;else if(this._lowStream&&this._lowStream.pc.ID===m.p2pid)I=this._lowStream;else{var E;H(E=this._remoteStream).call(E,_=>{_.pc.ID===m.p2pid&&(I=_)})}I?I.emit(Oe.GATEWAY_P2P_LOST,m.p2pid):R.warning("P2PLost stream not found",m)},this._handleTokenWillExpire=()=>{R.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.emit(Je.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)},this._handleBeforeUnload=m=>{m.returnValue!==void 0&&m.returnValue!==""||(this.leave(),R.info("[".concat(this._clientId,"] auto leave onbeforeunload")))},this._handleUpdateNetworkQuality=()=>{var m;if(this._networkQualitySensitivity!=="normal"){if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.emit(Je.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});var I={downlinkNetworkQuality:0,uplinkNetworkQuality:0};this._highStream&&!this._highStream.detecting&&(I.uplinkNetworkQuality=this._highStream.getNetworkQuality());var E=0;H(m=this._remoteStream).call(m,_=>E+=_.getNetworkQuality()),0<this._remoteStream.size&&(I.downlinkNetworkQuality=Math.round(E/this._remoteStream.size)),this.emit(Je.NETWORK_QUALITY,I)}},this._codec=n.codec,this._mode=n.mode,n.proxyServer&&(this._proxyServer=n.proxyServer,z.setProxyServer(this._proxyServer),R.setProxyServer(this._proxyServer)),n.turnServer&&(this._turnServer=Ba({},this._turnServer,{mode:"manual"},n.turnServer)),this._clientId=rr(5,"client-"),R.info(b(s=b(c=b(u=b(h="[".concat(this._clientId,"] Initializing AgoraRTC client v")).call(h,Xn," build: ")).call(u,"v4.7.2-0-gf83f608b(10/13/2021, 5:32:13 PM)",", mode: ")).call(c,this._mode,", codec: ")).call(s,this._codec)),this._performanceRecorder=function(m,I){return I=new lN(m,I),cN.set(m,I),I}(this._clientId,"join"),n.clientRoleOptions)try{Yg(n.clientRoleOptions),p=sn({},n.clientRoleOptions)}catch(m){var f;R.warning(b(f="[".concat(this._clientId,"] ")).call(f,m.toString()))}this._statsCollector=new tc(this._clientId),this._statsCollector.onStatsException=(m,I,E)=>{var _,S,N;R.debug(b(_=b(S=b(N="[".concat(this._clientId,"] receive exception msg, code: ")).call(N,m,", msg: ")).call(S,I,", uid: ")).call(_,E)),this.emit(Je.EXCEPTION,{code:m,msg:I,uid:E})},this._statsCollector.onUploadPublishDuration=(m,I,E,_)=>{var S;let N=ze(S=this._users).call(S,O=>O.uid===m);N&&z.peerPublishStatus(this._sessionId,{subscribeElapse:_,audioPublishDuration:I,videoPublishDuration:E,peer:N._uintid})},this._gateway=new cw({clientId:this._clientId,mode:this._mode,codec:this._codec,websocketRetryConfig:n.websocketRetryConfig||Dr,httpRetryConfig:n.httpRetryConfig||Dr,forceWaitGatewayResponse:n.forceWaitGatewayResponse===void 0||n.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:n.role,clientRoleOptions:p}),this._config=n,this._configDistribute=new Mw,this._handleGatewayEvents()}get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._highStream?this._highStream.getAllTracks():[]}get uid(){return this._uid}get channelName(){return this._channelName}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}async join(n,s,c,u,h){var p;this._performanceRecorder.checkPoint("startJoin");var f=(md||md||(md=(window.location.protocol.split(":")[0]||"").toUpperCase(),md))==="HTTPS";let m=window.isSecureContext!==void 0?window.isSecureContext:"Browser Not Support",I=()=>{R.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser")};window.isSecureContext!==void 0?window.isSecureContext||I():f||I(),f=z.reportApiInvoke(this._sessionId,{name:Re.JOIN,options:[n,s,c,u],states:{isHttps:f,isSecureContext:m},tag:Te.TRACER});try{if(!c&&c!==null)throw new L(D.INVALID_PARAMS,"Invalid token: ".concat(c,". If you don not use token, set it to null"));c&&Yr(c,"token",1,2047),Yr(n,"appid",1,2047),kh(s),u&&bh(u),h&&Yr(h,"optionalInfo",1,2047)}catch(O){throw f.onError(O),O}if(R.info(b(p="[".concat(this._clientId,"] start join channel ")).call(p,s)),this._leaveMutex.isLocked&&(R.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),R.debug("[".concat(this._clientId,"] join: continue"))),this.connectionState!=="DISCONNECTED")throw n=new L(D.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state")),f.onError(n),n;this._sessionId||(this._sessionId=rr(32,"").toUpperCase()),this._gateway.state="CONNECTING",h={clientId:this._clientId,appId:n,sid:this._sessionId,cname:s,uid:typeof u!="string"?u:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:c||n,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:h,useLocalAccessPoint:this._useLocalAccessPoint},typeof u=="string"&&(h.stringUid=u,this._uintUid?(h.uid=this._uintUid,this._uintUid=void 0):h.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret&&(h.aesmode=this._encryptionMode,h.aespassword=await sN(this._encryptionSecret),this._encryptionSalt&&(h.aessalt=this._encryptionSalt)),this._startSession(this._sessionId,{channel:s,appId:n}),pi(()=>{this.connectionState==="CONNECTING"&&z.joinChannelTimeout(this._sessionId,5)},5e3);try{var E;let O;if(h.cloudProxyServer==="443only")h.proxyServer=re.PROXY_SERVER_TYPE2;else if(h.cloudProxyServer==="proxy3"||h.cloudProxyServer==="proxy4"||h.cloudProxyServer==="proxy5"){let Q=re.PROXY_SERVER_TYPE3;to(Q)?h.proxyServer=Q[0]:h.proxyServer=Q}if(z.setProxyServer(h.proxyServer),R.setProxyServer(h.proxyServer),this._performanceRecorder.checkPoint("startRequestAp"),h.stringUid&&!h.uid&&h.cloudProxyServer==="normal"){var _;await mm(h,this._axiosCancelSource.token,this._config.httpRetryConfig||Dr,!1);let Q=await Uh(h.stringUid,h,this._axiosCancelSource.token,this._config.httpRetryConfig||Dr);R.debug(b(_="getUserAccount Success ".concat(h.stringUid," => ")).call(_,Q)),h.uid=Q,O=await Wc(h,this._axiosCancelSource.token,this._config.httpRetryConfig||Dr)}else{if(h.stringUid&&!h.uid){var S;let Q=await Uh(h.stringUid,h,this._axiosCancelSource.token,this._config.httpRetryConfig||Dr);R.debug(b(S="getUserAccount Success ".concat(h.stringUid," => ")).call(S,Q)),h.uid=Q}O=await mm(h,this._axiosCancelSource.token,this._config.httpRetryConfig||Dr,!0)}this._performanceRecorder.checkPoint("startJoinGateway"),this._configDistribute.startGetConfigDistribute(h,this._axiosCancelSource.token),this._configDistribute.on(ll.UPDATE_BITRATE_LIMIT,Q=>{this._highStream&&this._highStream.handleUpdateBitrateLimit(Q.uplink),Q.low_stream_uplink&&this._lowStream&&this._lowStream.handleUpdateBitrateLimit({max_bitrate:Q.low_stream_uplink.bitrate,min_bitrate:Q.low_stream_uplink.bitrate||0})}),this._key=c||n,this._joinInfo=Ba({},h,{cid:O.gatewayInfo.cid,uid:h.uid?h.uid:O.gatewayInfo.uid,vid:O.gatewayInfo.vid,apResponse:O.gatewayInfo.res,uni_lbs_ip:O.gatewayInfo.uni_lbs_ip,gatewayAddrs:O.gatewayInfo.gatewayAddrs});let B=await this._gateway.join(this._joinInfo,this._key);return f.onSuccess(B),this._appId=n,this._channelName=h.cname,this._uid=B,this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener("beforeunload",this._handleBeforeUnload),R.info(b(E="[".concat(this._clientId,"] Joining channel success: ")).call(E,s)),pi(()=>{R.startUpload()},5e3),this._performanceRecorder.checkPoint("finishJoin"),N=this,gt(Ko).call(Ko,N)||Ko.push(N),B}catch(O){throw n=to(O)?O[0]:O,R.error("[".concat(this._clientId,"] Joining channel failed, rollback"),n),n.code!==D.OPERATION_ABORTED&&(this._gateway.state="DISCONNECTED",this._reset()),f.onError(n),n}var N}async leave(){let n=z.reportApiInvoke(this._sessionId,{name:Re.LEAVE,options:[],tag:Te.TRACER});R.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener("beforeunload",this._handleBeforeUnload),this._reset();var s=He(Ko).call(Ko,this);if(s!==-1&&qr(Ko).call(Ko,s,1),s=await this._leaveMutex.lock(),this.connectionState==="DISCONNECTED")return R.info("[".concat(this._clientId,"] Leaving channel repeated, success")),s(),n.onSuccess();await this._gateway.leave(this.connectionState!=="CONNECTED"),R.info("[".concat(this._clientId,"] Leaving channel success")),s(),n.onSuccess()}async publish(n,s=!0){var c,u;to(n)||(n=[n]);let h=z.reportApiInvoke(this._sessionId,{name:Re.PUBLISH,options:Ie(n).call(n,p=>p?Object(p).toString():"null"),tag:Te.TRACER});if(n.length===0)return n=new L(D.INVALID_PARAMS,"track list is empty"),h.onError(n),n.throw();if(this._gateway.role==="audience")return n=new L(D.INVALID_OPERATION,"audience can not publish stream"),h.onError(n),n.throw();for(let p of n){if(!(p instanceof rd))return n=new L(D.INVALID_PARAMS,"pamameter is not local track"),h.onError(n),n.throw();if(!p._enabled&&s)return n=new L(D.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(p.getTrackId())),h.onError(n),n.throw()}if(R.info(b(c="[".concat(this._clientId,"] Publishing tracks, id ")).call(c,Ie(n).call(n,p=>"".concat(p.getTrackId()," ")))),await this._configDistribute.awaitConfigDistributeComplete(),s&&H(n).call(n,p=>{var f;let m=this._configDistribute.getBitrateLimit();var I;p instanceof Wt&&m&&p.setBitrateLimit(m.uplink),He(f=this._bindEnabledTracks).call(f,p)===-1&&(p.addListener(De.NEED_ADD_TRACK,this._handleLocalTrackEnable),p.addListener(De.NEED_REMOVE_TRACK,this._handleLocalTrackDisable),this._bindEnabledTracks.push(p),wr()&&p.muted&&R.debug(b(I="[".concat(this._clientId,"] on firefox publish a muted track ")).call(I,p.getTrackId(),", skip the pub operation and wait unmute")))}),wr()&&(n=Qe(n).call(n,p=>!p.muted)).length===0)return void h.onSuccess(Ie(n).call(n,p=>p.trackMediaType+":"+p.getTrackLabel()).toString());c=await this._publishMutex.lock();try{let p=await this._publishHighStream(n),f=(p.audioTrack,p.videoTrack);this._isDualStreamEnabled&&f&&!this._lowStream&&await this._publishLowStream(f),c(),h.onSuccess(Ie(n).call(n,m=>m.trackMediaType+":"+m.getTrackLabel()).toString())}catch(p){throw c(),s&&H(n).call(n,f=>{var m,I;let E=He(m=this._bindEnabledTracks).call(m,f);E!==-1&&(f.off(De.NEED_ADD_TRACK,this._handleLocalTrackEnable),f.off(De.NEED_REMOVE_TRACK,this._handleLocalTrackDisable),qr(I=this._bindEnabledTracks).call(I,E,1))}),h.onError(p),R.error("[".concat(this._clientId,"] publish error"),p.toString()),p}R.info(b(u="[".concat(this._clientId,"] Publish success, id ")).call(u,Ie(n).call(n,p=>"".concat(p.getTrackId()," "))))}async unpublish(n,s=!0){var c;let u=await this._publishMutex.lock(),h,p,f;try{var m,I;if(!this._highStream||(h=this._highStream.getAllTracks(),n?to(n)||(n=[n]):n=this._highStream.getAllTracks(),p=function(E,_){if(E.length!==_.length)return!1;for(let S=0;S<E.length;S+=1){let N=E[S];if(Qe(E).call(E,O=>O===N).length!==Qe(_).call(_,O=>O===N).length)return!1}return!0}(h,n),f=z.reportApiInvoke(this._sessionId,{name:Re.UNPUBLISH,options:Ie(n).call(n,E=>E.getTrackId()),tag:Te.TRACER}),R.info(b(m=b(I="[".concat(this._clientId,"] Unpublish tracks, tracks ")).call(I,Ie(n).call(n,E=>"".concat(E.getTrackId()," ")),", isClosePC: ")).call(m,p)),!this._highStream))return R.warning("[".concat(this._clientId,"] Could not find tracks to unpublish")),void(u&&u())}catch(E){throw u&&u(),E}try{this._lowStream&&0<Qe(n).call(n,E=>E.trackMediaType==="video").length&&(await this._lowStream.closeP2PConnection(),this._lowStream=void 0),p?await this._highStream.closeP2PConnection():await this._highStream.removeTracks(n,s),u&&u()}catch(E){if(E.code!==D.OPERATION_ABORTED)throw f.onError(E),R.error("[".concat(this._clientId,"] unpublish error"),E.toString()),u&&u(),E;R.debug("[".concat(this._clientId,"] ignore unpub operation abort")),u&&u()}this._highStream&&this._highStream.connectionState==="disconnected"&&(this._highStream=void 0,this._lowStream=void 0),s&&H(n).call(n,E=>{var _,S;let N=He(_=this._bindEnabledTracks).call(_,E);N!==-1&&(E.off(De.NEED_ADD_TRACK,this._handleLocalTrackEnable),E.off(De.NEED_REMOVE_TRACK,this._handleLocalTrackDisable),qr(S=this._bindEnabledTracks).call(S,N,1))}),R.info(b(c="[".concat(this._clientId,"] Unpublish success,tracks ")).call(c,Ie(n).call(n,E=>"".concat(E.getTrackId())))),f.onSuccess()}async subscribe(n,s){var c,u,h,p;Ir(s,"mediaType",["audio","video"]);let f=z.reportApiInvoke(this._sessionId,{name:Re.SUBSCRIBE,options:[n.uid,s],tag:Te.TRACER});if(!this._joinInfo)throw s=new L(D.INVALID_OPERATION,"Can't subscribe stream, not joined"),f.onError(s),s;if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw s=new L(D.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state")),f.onError(s),s;if(!ze(c=this._users).call(c,O=>O===n)){var m;throw s=new L(D.INVALID_REMOTE_USER,"user is not in the channel"),R.error(b(m="[".concat(this._clientId,"] can not subscribe ")).call(m,n.uid,", this user is not in the channel")),f.onError(s),s}if(!n.hasAudio&&!n.hasVideo){var I;throw s=new L(D.INVALID_REMOTE_USER,"user is not published"),R.error(b(I="[".concat(this._clientId,"] can not subscribe ")).call(I,n.uid,", user is not published")),f.onError(s),s}if(m={audio:s==="audio",video:s==="video"},!n.hasAudio&&m.audio||!n.hasVideo&&m.video){var E,_,S=new L(D.REMOTE_USER_IS_NOT_PUBLISHED);throw R.error(b(E=b(_="[".concat(this._clientId,"] can not subscribe ")).call(_,n.uid," with mediaType ")).call(E,s,", remote track is not published")),f.onError(S),S}(E=this._subscribeMutex.get(n.uid))||(E=new qo("sub-".concat(n.uid)),this._subscribeMutex.set(n.uid,E)),R.info(b(u=b(h="[".concat(this._clientId,"] subscribe user ")).call(h,n.uid,", mediaType: ")).call(u,s)),u=await E.lock(),h=this._remoteStream.get(n.uid);try{if(h)m.audio=m.audio||h.subscribeOptions.audio,m.video=m.video||h.subscribeOptions.video,await this._gateway.subscribeChange(h,m);else{h=new eN(n,this._statsCollector,this._joinInfo,m),this._remoteStream.set(n.uid,h);try{await this._gateway.subscribe(h)}catch(O){throw this._remoteStream.delete(n.uid),O}h.on(Oe.CONNECTION_STATE_CHANGE,(O,B)=>{O==="connecting"?this.emit(Je.MEDIA_RECONNECT_START,n.uid):O==="connected"&&this.emit(Je.MEDIA_RECONNECT_END,n.uid)})}u()}catch(O){var N;throw f.onError(O),u(),R.error(b(N="[".concat(this._clientId,"] subscribe user ")).call(N,n.uid," error"),O),O}return R.info(b(S=b(p="[".concat(this._clientId,"] subscribe success user ")).call(p,n.uid,", mediaType: ")).call(S,s)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(n.uid,this._defaultStreamFallbackType).catch(O=>{R.warning("[".concat(this._clientId,"] auto set fallback failed"),O)}),s=s==="audio"?n.audioTrack:n.videoTrack,s?(f.onSuccess(s.getTrackId()),s):(s=new L(D.UNEXPECTED_ERROR,"can not find remote track in user object"),f.onError(s),s.throw())}async unsubscribe(n,s){var c,u,h,p,f;s&&Ir(s,"mediaType",["audio","video"]);let m=z.reportApiInvoke(this._sessionId,{name:Re.UNSUBSCRIBE,options:[n.uid,s],tag:Te.TRACER});if(!ze(c=this._users).call(c,S=>S===n)){var I;throw s=new L(D.INVALID_REMOTE_USER,"user is not in the channel"),R.error(b(I="[".concat(this._clientId,"] can not subscribe ")).call(I,n.uid,", user is not in the channel")),m.onError(s),s}R.info(b(u=b(h="[".concat(this._clientId,"] unsubscribe uid: ")).call(h,n.uid,", mediaType: ")).call(u,s)),(I=this._subscribeMutex.get(n.uid))||(I=new qo("sub-".concat(n.uid)),this._subscribeMutex.set(n.uid,I)),I=await I.lock(),c=this._remoteStream.get(n.uid);var E;if(!c)return R.warning(b(E="[".concat(this._clientId,"]: you have not subscribe the remote user ")).call(E,n.uid)),m.onSuccess(),void I();E=Ba({},c.subscribeOptions),s==="audio"?E.audio=!1:s==="video"?(E.video=!1,c.pc._statsFilter.setVideoIsReady(!1)):(E.audio=!1,E.video=!1);try{E.audio||E.video?await this._gateway.subscribeChange(c,E):(await c.closeP2PConnection(),this._remoteStream.delete(n.uid)),I()}catch(S){var _;if(S.code!==D.OPERATION_ABORTED)throw m.onError(S),I(),R.error(b(_="[".concat(this._clientId,"] unsubscribe user ")).call(_,n.uid," error"),S.toString()),S;I(),R.debug("[".concat(this._clientId,"] ignore unsub operation abort"))}R.info(b(p=b(f="[".concat(this._clientId,"] unsubscribe success uid: ")).call(f,n.uid,", mediaType: ")).call(p,s)),m.onSuccess()}setLowStreamParameter(n){if(!n)throw new L(D.INVALID_PARAMS);n.width==null||It(n.width,"streamParameter.width"),n.height==null||It(n.height,"streamParameter.height"),n.framerate==null||It(n.framerate,"streamParameter.framerate"),n.bitrate==null||It(n.bitrate,"streamParameter.bitrate");let s=z.reportApiInvoke(this._sessionId,{name:Re.SET_LOW_STREAM_PARAMETER,options:[n],tag:Te.TRACER});(!n.width&&n.height||n.width&&!n.height)&&R.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),R.info("[".concat(this._clientId,"] set low stream parameter to"),pe(n));let c=this._configDistribute.getLowStreamConfigDistribute();c&&c.bitrate&&n.bitrate&&c.bitrate<n.bitrate&&(n.bitrate=c.bitrate),this._lowStreamParameter=n,s.onSuccess()}async enableDualStream(){let n=z.reportApiInvoke(this._sessionId,{name:Re.ENABLE_DUAL_STREAM,options:[],tag:Te.TRACER});if(!Bt.supportDualStream){z.streamSwitch(this._sessionId,{lts:le(),isdual:!0,succ:!1});var s=new L(D.NOT_SUPPORTED,"Your browser is not support dual stream");throw n.onError(s),s}if(this._isDualStreamEnabled)throw s=new L(D.INVALID_OPERATION,"Dual stream is already enabled"),n.onError(s),s;if(this._highStream&&this._highStream.connectionState==="connected"&&this._highStream.videoTrack)try{await this._publishLowStream(this._highStream.videoTrack)}catch(c){throw z.streamSwitch(this._sessionId,{lts:le(),isdual:!0,succ:!1}),n.onError(c),c}this._isDualStreamEnabled=!0,z.streamSwitch(this._sessionId,{lts:le(),isdual:!0,succ:!0}),R.info("[".concat(this._clientId,"] enable dual stream")),n.onSuccess()}async disableDualStream(){let n=z.reportApiInvoke(this._sessionId,{name:Re.DISABLE_DUAL_STREAM,options:[],tag:Te.TRACER});if(this._lowStream)try{await this._lowStream.closeP2PConnection()}catch(s){throw z.streamSwitch(this._sessionId,{lts:le(),isdual:!1,succ:!1}),n.onError(s),s}this._lowStream=void 0,this._isDualStreamEnabled=!1,this._highStream&&(this._highStream.lowStreamConnection=void 0),z.streamSwitch(this._sessionId,{lts:le(),isdual:!1,succ:!0}),R.info("[".concat(this._clientId,"] disable dual stream")),n.onSuccess()}async setClientRole(n,s){Ir(n,"role",["audience","host"]),s&&Yg(s);let c=z.reportApiInvoke(this._sessionId,{name:Re.SET_CLIENT_ROLE,options:[n,s],tag:Te.TRACER});if(this._mode==="rtc")return R.warning("[".concat(this._clientId,"]rtc mode can not use setClientRole")),n=new L(D.INVALID_OPERATION,"rtc mode can not use setClientRole"),c.onError(n),n.throw();if(s&&s.level&&n==="host")return n=new L(D.INVALID_OPERATION,"host mode can not set audience latency level"),c.onError(n),n.throw();try{var u,h;if(n==="audience"&&this._highStream){let p=new L(D.INVALID_OPERATION,"can not set client role to audience when publishing stream");return c.onError(p),p.throw()}await this._gateway.setClientRole(n,s),R.info(b(u=b(h="[".concat(this._clientId,"] set client role to ")).call(h,n,", level: ")).call(u,s&&s.level)),c.onSuccess()}catch(p){throw c.onError(p),p}}setProxyServer(n){if(Yr(n,"proxyServer"),this.connectionState!=="DISCONNECTED")throw new L(D.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new L(D.INVALID_OPERATION,"You have already set the proxy");this._proxyServer=n,z.setProxyServer(this._proxyServer),R.setProxyServer(this._proxyServer)}setTurnServer(n){if(to(n)||(n=[n]),this.connectionState!=="DISCONNECTED")throw new L(D.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new L(D.INVALID_OPERATION,"You have already set the proxy");var s;if(Kg(n))return this._turnServer={servers:n,mode:"original-manual"},void R.info(b(s="[".concat(this._clientId,"] Set original turnserver success: ")).call(s,Ie(n).call(n,c=>c.urls).join(","),"."));H(n).call(n,c=>Wg(c)),this._turnServer={servers:n,mode:"manual"},R.info("[".concat(this._clientId,"] Set turnserver success."))}startProxyServer(n){let s=z.reportApiInvoke(this._sessionId,{name:Re.START_PROXY_SERVER,options:[],tag:Te.TRACER});if(this.connectionState!=="DISCONNECTED")throw n=new L(D.INVALID_OPERATION,"Start proxy server before join channel"),s.onError(n),n;if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw n=new L(D.INVALID_OPERATION,"You have already set the proxy"),s.onError(n),n;let c=[1,2,3,4,5];switch(n===void 0&&(n=1),n){case 1:this._cloudProxyServerMode="normal";break;case 2:this._cloudProxyServerMode="443only";break;case 3:this._cloudProxyServerMode="proxy3";break;case 4:this._cloudProxyServerMode="proxy4";break;case 5:this._cloudProxyServerMode="proxy5";break;default:throw n=new L(D.INVALID_PARAMS,"proxy server mode must be ".concat(c.join("|"))),s.onError(n),n}R.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),s.onSuccess()}stopProxyServer(){let n=z.reportApiInvoke(this._sessionId,{name:Re.STOP_PROXY_SERVER,options:[],tag:Te.TRACER});if(this.connectionState!=="DISCONNECTED")throw new L(D.INVALID_OPERATION,"Stop proxy server after leave channel");z.setProxyServer(),R.setProxyServer(),this._cloudProxyServerMode="disabled",R.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]},n.onSuccess()}setLocalAccessPoints(n,s){if(Oh(n,"serverList"),Yr(s,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new L(D.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");let c=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;n=Ie(n).call(n,u=>{var h;return c.test(u)?b(h="".concat(u.replace(/\./g,"-"),".")).call(h,s):u}),this._useLocalAccessPoint=!0,Wr("WEBCS_DOMAIN",n),Wr("WEBCS_DOMAIN_BACKUP_LIST",n),Wr("GATEWAY_DOMAINS",[s]),Wr("EVENT_REPORT_DOMAIN",n[0]),Wr("EVENT_REPORT_BACKUP_DOMAIN",n[1]||n[0]),Wr("LOG_UPLOAD_SERVER","".concat(n[0],":6444")),R.info("set local access point success")}async setRemoteVideoStreamType(n,s){var c,u;Ir(s,"streamType",[0,1]);let h=z.reportApiInvoke(this._sessionId,{name:Re.SET_REMOTE_VIDEO_STREAM_TYPE,options:[n,s],tag:Te.TRACER});try{await this._gateway.setRemoteVideoStreamType(n,s),pi(()=>{var p;let f=ze(p=this._users).call(p,m=>m.uid===n);f&&f.videoTrack&&f.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(p){throw h.onError(p),R.error("[".concat(this._clientId,"] set remote video stream type error"),p.toString()),p}R.info(b(c=b(u="[".concat(this._clientId,"] set remote ")).call(u,n," video stream type to ")).call(c,s)),this._remoteStreamTypeCacheMap.set(n,s),h.onSuccess()}async setStreamFallbackOption(n,s){var c,u;Ir(s,"fallbackType",[0,1,2]);let h=z.reportApiInvoke(this._sessionId,{name:Re.SET_STREAM_FALLBACK_OPTION,options:["too long to show",s],tag:Te.TRACER});try{await this._gateway.setStreamFallbackOption(n,s)}catch(p){throw h.onError(p),R.error("[".concat(this._clientId,"] set stream fallback option"),p.toString()),p}R.info(b(c=b(u="[".concat(this._clientId,"] set remote ")).call(u,n," stream fallback type to ")).call(c,s)),this._streamFallbackTypeCacheMap.set(n,s),h.onSuccess()}setEncryptionConfig(n,s,c){Ir(n,"encryptionMode","aes-128-xts aes-256-xts aes-128-ecb sm4-128-ecb aes-128-gcm aes-256-gcm aes-128-gcm2 aes-256-gcm2 none".split(" ")),Yr(s,"secret");let u=["aes-128-gcm2","aes-256-gcm2"];if(gt(u).call(u,n)){if(!(c&&c instanceof Uint8Array&&c.length===32))throw new L(D.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(c)throw new L(D.INVALID_PARAMS,"current encrypt mode does not need salt");/^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\[\]])(?=.{8,})/.test(s)||R.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=n,this._encryptionSecret=s,c&&(this._encryptionSalt=Cu(c))}async renewToken(n){Yr(n,"token",1,2047);let s=z.reportApiInvoke(this._sessionId,{name:Re.RENEW_TOKEN,options:[n],tag:Te.TRACER});if(!this._key)return n=new L(D.INVALID_OPERATION,"renewToken should not be called before user join"),s.onError(n),n.throw();this._key=n;try{await this._gateway.renewToken(n)}catch(c){throw s.onError(c),R.error("[".concat(this._clientId,"] renewToken failed"),c.toString()),c}R.debug("[".concat(this._clientId,"] renewToken success")),s.onSuccess()}enableAudioVolumeIndicator(){let n=z.reportApiInvoke(this._sessionId,{name:Re.ENABLE_AUDIO_VOLUME_INDICATOR,options:[],tag:Te.TRACER});if(this._audioVolumeIndicationInterval)return R.warning("you have already enabled audio volume indicator!"),n.onSuccess();this._audioVolumeIndicationInterval=window.setInterval(()=>{var s,c,u;let h=sl(s=Ie(c=io(ra(u=this._remoteStream).call(u))).call(c,p=>({level:p.user.audioTrack?100*p.user.audioTrack._source.getAccurateVolumeLevel():0,uid:p.getUserId()}))).call(s,(p,f)=>p.level-f.level);this._highStream&&this._highStream.audioTrack&&(h.push({level:100*this._highStream.audioTrack._source.getAccurateVolumeLevel(),uid:this._highStream._userId}),h=sl(h).call(h,(p,f)=>p.level-f.level)),this.emit(Je.VOLUME_INDICATOR,h)},re.AUDIO_VOLUME_INDICATION_INTERVAL||2e3),n.onSuccess()}getRTCStats(){let n=this._statsCollector.getRTCStats(),s=this._gateway.getInChannelInfo();return n.Duration=Math.round(s.duration/1e3),n}startLiveStreaming(n,s){let c=z.reportApiInvoke(this._sessionId,{name:Re.START_LIVE_STREAMING,options:[n,s],tag:Te.TRACER});if(!s){if(this._codec!=="h264")return n=new L(D.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264"),c.onError(n),se.reject(n);if(!this._highStream)return n=new L(D.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming"),c.onError(n),se.reject(n)}return this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(n)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(n)?(n=new L(D.LIVE_STREAMING_TASK_CONFLICT),c.onError(n),se.reject(n)):(s=s?er.TRANSCODE:er.RAW,this._createLiveStreamingClient(s).startLiveStreamingTask(n,s).then(()=>c.onSuccess()).catch(u=>{throw c.onError(u),u}))}setLiveTranscoding(n){let s=z.reportApiInvoke(this._sessionId,{name:Re.SET_LIVE_TRANSCODING,options:[n],tag:Te.TRACER});return this._createLiveStreamingClient(er.TRANSCODE).setTranscodingConfig(n).then(()=>s.onSuccess()).catch(c=>{throw s.onError(c),c})}stopLiveStreaming(n){var s;let c=z.reportApiInvoke(this._sessionId,{name:Re.STOP_LIVE_STREAMING,options:[n],tag:Te.TRACER}),u=Qe(s=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient]).call(s,h=>h&&h.hasUrl(n));return u.length?se.all(Ie(u).call(u,h=>h&&h.stopLiveStreamingTask(n))).then(()=>c.onSuccess()).catch(h=>{throw c.onError(h),h}):(s=new L(D.INVALID_PARAMS,"can not find live streaming url to stop"),c.onError(s),se.reject(s))}async addInjectStreamUrl(n,s){let c=z.reportApiInvoke(this._sessionId,{name:Re.ADD_INJECT_STREAM_URL,options:[n,s],tag:Te.TRACER});try{if(!this._joinInfo)throw new L(D.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");let u=this._createLiveStreamingClient(er.INJECT);u.setInjectStreamConfig(s,0),await u.startLiveStreamingTask(n,er.INJECT)}catch(u){throw c.onError(u),u}c.onSuccess()}async removeInjectStreamUrl(){let n=z.reportApiInvoke(this._sessionId,{name:Re.REMOVE_INJECT_STREAM_URL,options:[],tag:Te.TRACER});try{var s,c;let u=this._createLiveStreamingClient(er.INJECT),h=ze(s=io(ra(c=u.streamingTasks).call(c))).call(s,p=>p.mode===er.INJECT);if(!this._joinInfo||!h)throw new L(D.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");await u.stopLiveStreamingTask(h.url)}catch(u){throw n.onError(u),u}n.onSuccess()}async startChannelMediaRelay(n){let s=z.reportApiInvoke(this._sessionId,{name:Re.START_CHANNEL_MEDIA_RELAY,options:[n],tag:Te.TRACER});try{Dm(n),await this._createChannelMediaRelayClient().startChannelMediaRelay(n)}catch(c){return s.onError(c),c.throw()}s.onSuccess()}async updateChannelMediaRelay(n){let s=z.reportApiInvoke(this._sessionId,{name:Re.UPDATE_CHANNEL_MEDIA_RELAY,options:[n],tag:Te.TRACER});try{Dm(n),await this._createChannelMediaRelayClient().updateChannelMediaRelay(n)}catch(c){return s.onError(c),c.throw()}s.onSuccess()}async stopChannelMediaRelay(){let n=z.reportApiInvoke(this._sessionId,{name:Re.STOP_CHANNEL_MEDIA_RELAY,options:[],tag:Te.TRACER});try{await this._createChannelMediaRelayClient().stopChannelMediaRelay()}catch(s){return n.onError(s),s.throw()}n.onSuccess()}sendStreamMessage(n,s=!0){if(!this._joinInfo)throw new L(D.INVALID_OPERATION,"can not send data stream, not joined");if(typeof n=="string"&&(n=new TextEncoder().encode(n)),1024<new Blob([n]).size)throw new L(D.INVALID_PARAMS,"stream message out of range.");return this._gateway.signal.request(wt.DATA_STREAM,{payload:Cu(n)},!s)}sendMetadata(n){if(!this._joinInfo)throw new L(D.INVALID_OPERATION,"can not send metadata, not joined");if(1024<new Blob([n]).size)throw new L(D.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(wt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Cu(n)})}async sendCustomReportMessage(n){to(n)||(n=[n]),H(n).call(n,PS);let s=z.reportApiInvoke(this._sessionId,{name:Re.SEND_CUSTOM_REPORT_MESSAGE,options:[pe(n)],tag:Te.TRACER});if(!this._joinInfo)return n=new L(D.INVALID_OPERATION,"can not send custom report, not joined"),s.onError(n),n.throw();await z.sendCustomReportMessage(this._joinInfo.sid,n),s.onSuccess()}getLocalAudioStats(){if(!this._highStream)return $u;let n=this._statsCollector.getLocalAudioTrackStats(this._highStream.connectionId);return Fs()&&this._highStream&&this._highStream.audioTrack&&(this._highStream.audioTrack instanceof cn?!this._highStream.audioTrack.isActive:!this._highStream.audioTrack.enabled)&&(n.sendVolumeLevel=0),n}getRemoteAudioStats(){var n;let s={};return H(n=this._remoteStream).call(n,(c,u)=>{s[u]=this._statsCollector.getRemoteAudioTrackStats(c.connectionId)}),s}getLocalVideoStats(){return this._highStream?this._statsCollector.getLocalVideoTrackStats(this._highStream.connectionId):Zu}getRemoteVideoStats(){var n;let s={};return H(n=this._remoteStream).call(n,(c,u)=>{s[u]=this._statsCollector.getRemoteVideoTrackStats(c.connectionId)}),s}getRemoteNetworkQuality(){var n;let s={};return H(n=this._remoteStream).call(n,(c,u)=>{s[u]=this._statsCollector.getRemoteNetworkQualityStats(c.connectionId)}),s}async pickSVCLayer(n,s){Ir(s.spatialLayer,"spatialLayer",[0,1,2,3]),Ir(s.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(n,s)}catch(c){throw R.error("[".concat(this._clientId,"] pick SVC layer failed"),c.toString()),c}}_reset(){var n,s,c;R.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=_o.CancelToken.source(),this._streamFallbackTypeCacheMap=new Ct,this._remoteStreamTypeCacheMap=new Ct,this._configDistribute.stopGetConfigDistribute(),this._defaultStreamFallbackType=this._proxyServer=this._joinInfo=void 0,this._sessionId=null,this._statsCollector.reset(),this._channelName=this._uid=this._appId=this._key=void 0,this._encryptionMode="none",this._encryptionSalt=this._encryptionSecret=null,H(n=this._users).call(n,u=>{u.audioTrack&&(u.audioTrack.stop(),u.audioTrack._isDestroyed=!0),u.videoTrack&&(u.videoTrack.stop(),u.videoTrack._isDestroyed=!0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._highStream&&(this._highStream.closeP2PConnection(!0),this._highStream=void 0),H(s=this._bindEnabledTracks).call(s,u=>{u.off(De.NEED_ADD_TRACK,this._handleLocalTrackEnable),u.off(De.NEED_REMOVE_TRACK,this._handleLocalTrackDisable)}),this._bindEnabledTracks=[],this._lowStream&&(this._lowStream.closeP2PConnection(!0),this._lowStream=void 0),H(c=this._remoteStream).call(c,u=>{u.closeP2PConnection(!0)}),this._remoteStream=new Ct,this._publishMutex=new qo("client-publish"),this._subscribeMutex=new Ct,this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0)}_startSession(n,s){var c,u,h;let p=n||rr(32,"").toUpperCase();n?R.debug(b(c="[".concat(this._clientId,"] new Session ")).call(c,p)):R.debug(b(u=b(h="[".concat(this._clientId,"] renewSession ")).call(h,this._sessionId," => ")).call(u,p)),this._sessionId=p,s?z.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:s.channel,appid:s.appId,mode:this._mode}):this._joinInfo?z.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:this._joinInfo.cname,appid:this._joinInfo.appId,mode:this._mode}):this._gateway.joinInfo&&z.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId,mode:this._mode}),this._joinInfo&&(this._joinInfo.sid=p),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=p)}async _publishHighStream(n){if(!this._joinInfo)throw new L(D.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new L(D.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&re.FORCE_TURN&&!re.TURN_ENABLE_TCP&&!re.TURN_ENABLE_UDP)throw new L(D.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");if(R.debug("[".concat(this._clientId,"] publish high stream")),this._highStream)return await this._highStream.addTracks(n),this._highStream;this._highStream=new LI(this._statsCollector,this._joinInfo,this._codec),this._highStream.on(Oe.P2P_LOST,()=>{this._highStream&&this.emit(Je.P2P_LOST,this._highStream.getUserId())}),await this._highStream.addTracks(n);try{await this._gateway.publish(this._highStream,"high")}catch(s){throw this._highStream=void 0,s}return this._highStream.on(Oe.CONNECTION_STATE_CHANGE,(s,c)=>{this._highStream&&(s==="connected"?this.emit(Je.MEDIA_RECONNECT_END,this._highStream.getUserId()):s==="connecting"&&this.emit(Je.MEDIA_RECONNECT_START,this._highStream.getUserId()))}),this._highStream}async _publishLowStream(n){if(!this._joinInfo)throw new L(D.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new L(D.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(!this._highStream||this._highStream.connectionState!=="connected")throw new L(D.UNEXPECTED_ERROR,"Could not find high stream");if(this._lowStream)return new L(D.UNEXPECTED_ERROR,"[".concat(this._clientId,"] Can't publish low stream when stream already publish")).throw();R.debug("[".concat(this._clientId,"] publish low stream")),this._lowStream=new LI(this._statsCollector,this._joinInfo,this._codec,!0);let s=this._configDistribute.getLowStreamConfigDistribute();s&&s.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&s.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=s.bitrate)),this._lowStream.lowStreamParameter=this._lowStreamParameter,await this._lowStream.addTracks([n]);try{await this._gateway.publish(this._lowStream,"low")}catch(c){throw this._lowStream=void 0,c}this._highStream.lowStreamConnection=this._lowStream}_createLiveStreamingClient(n){if(!this._joinInfo||!this._appId)return new L(D.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();let s=()=>new rN(this._joinInfo,this._config.websocketRetryConfig||Dr,this._config.httpRetryConfig||Dr),c=u=>{u.onLiveStreamError=(h,p)=>{z.reportApiInvoke(this._sessionId,{name:Re.ON_LIVE_STREAM_ERROR,options:[h,p],tag:Te.TRACER}).onSuccess(),this.emit(Je.LIVE_STREAMING_ERROR,h,p)},u.onLiveStreamWarning=(h,p)=>{z.reportApiInvoke(this._sessionId,{name:Re.ON_LIVE_STREAM_WARNING,options:[h,p],tag:Te.TRACER}).onSuccess(),this.emit(Je.LIVE_STREAMING_WARNING,h,p)},u.on($a.REQUEST_WORKER_MANAGER_LIST,(h,p,f)=>{if(!this._joinInfo)return f(new L(D.INVALID_OPERATION,"can not find join info to get worker manager"));vm(h,this._joinInfo,this._axiosCancelSource.token,Dr).then(p).catch(f)})};switch(n){case er.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=s(),c(this._liveRawStreamingClient)),this._liveRawStreamingClient;case er.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=s(),c(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case er.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=s(),this._injectStreamingClient.on($a.REQUEST_WORKER_MANAGER_LIST,(u,h,p)=>{if(!this._joinInfo)return p(new L(D.INVALID_OPERATION,"can not find join info to get worker manager"));vm(u,this._joinInfo,this._axiosCancelSource.token,Dr).then(h).catch(p)}),this._injectStreamingClient.onInjectStatusChange=(u,h,p)=>{this.emit(Je.INJECT_STREAM_STATUS,u,h,p)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){return this._joinInfo?(this._channelMediaRelayClient||(this._channelMediaRelayClient=new iN(this._joinInfo,this._clientId,this._config.websocketRetryConfig||Dr,this._config.httpRetryConfig||Dr),this._channelMediaRelayClient.on("state",n=>{n==="RELAY_STATE_FAILURE"&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.emit(Je.CHANNEL_MEDIA_RELAY_STATE,n)}),this._channelMediaRelayClient.on("event",n=>{this.emit(Je.CHANNEL_MEDIA_RELAY_EVENT,n)})),this._channelMediaRelayClient):new L(D.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw()}_handleGatewayEvents(){this._gateway.on(kr.DISCONNECT_P2P,()=>{var n;R.debug("[".concat(this._clientId,"] start full reconnect")),this._highStream&&this._highStream.connectionState!=="disconnected"&&(R.debug("[".concat(this._clientId,"] ready to reconnect high stream")),this._highStream.readyToReconnectPC()),this._lowStream&&this._lowStream.connectionState!=="disconnected"&&(R.debug("[".concat(this._clientId,"] ready to reconnect low stream")),this._lowStream.readyToReconnectPC()),H(n=this._remoteStream).call(n,(s,c)=>{var u;R.debug(b(u="[".concat(this._clientId,"] ready to reconnect remote stream ")).call(u,c)),s.readyToReconnectPC()})}),this._gateway.on(kr.CONNECTION_STATE_CHANGE,(n,s,c)=>{var u,h;let p=()=>{this.emit(Je.CONNECTION_STATE_CHANGE,n,s,c)};if(R.info(b(u=b(h="[".concat(this._clientId,"] connection state change: ")).call(h,s," -> ")).call(u,n)),n==="DISCONNECTED")return this._reset(),void p();var f,m;if(n==="RECONNECTING")this._highStream&&this._highStream.connectionState==="connecting"&&(R.debug("[".concat(this._clientId,"] ready to reconnect high stream")),this._highStream.readyToReconnectPC()),this._lowStream&&this._lowStream.connectionState==="connecting"&&(R.debug("[".concat(this._clientId,"] ready to reconnect low stream")),this._lowStream.readyToReconnectPC()),H(f=this._remoteStream).call(f,(_,S)=>{var N;_.connectionState==="connecting"&&(R.debug(b(N="[".concat(this._clientId,"] ready to reconnect remote stream ")).call(N,S)),_.readyToReconnectPC())}),H(m=this._users).call(m,_=>{_._trust_in_room_=!1,_._trust_audio_enabled_state_=!1,_._trust_video_enabled_state_=!1,_._trust_audio_mute_state_=!1,_._trust_video_mute_state_=!1,_._trust_stream_added_state_=!1}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._streamRemovedTimeout=this._userOfflineTimeout=void 0;else if(n==="CONNECTED"){var I,E;H(I=this._streamFallbackTypeCacheMap).call(I,(_,S)=>{this._gateway.setStreamFallbackOption(S,_).catch(N=>R.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),N))}),H(E=this._remoteStreamTypeCacheMap).call(E,(_,S)=>{this._gateway.setRemoteVideoStreamType(S,_).catch(N=>R.warning("[".concat(this._clientId,"] auto set remote stream type failed"),N))}),this._highStream&&this._highStream.connectionState==="connecting"?this._highStream.reconnectPC().then(()=>{this._lowStream&&this._lowStream.connectionState==="connecting"&&this._lowStream.reconnectPC().catch(_=>{R.error("[".concat(this._clientId,"] republish low stream error"),_.toString()),this.emit(Je.ERROR,{reason:_})})}).catch(_=>{R.error("[".concat(this._clientId,"] republish high stream error"),_.toString()),this.emit(Je.ERROR,{reason:_})}):this._lowStream&&this._lowStream.connectionState==="connecting"&&this._lowStream.reconnectPC().catch(_=>{R.error("[".concat(this._clientId,"] republish low stream error"),_.toString()),this.emit(Je.ERROR,{reason:_})}),this._userOfflineTimeout=window.setTimeout(()=>{var _;if(this.connectionState==="CONNECTED"){this._userOfflineTimeout=void 0;var S=Qe(_=this._users).call(_,N=>!N._trust_in_room_);H(S).call(S,N=>{var O;R.debug(b(O="[".concat(this._clientId,"] user offline timeout, emit user offline ")).call(O,N.uid)),this._handleUserOffline({uid:N.uid})})}},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{var _;this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,H(_=this._users).call(_,S=>{var N,O,B,Q,q;S._trust_audio_mute_state_||(R.debug(b(N="[".concat(this._clientId,"] auto dispatch audio unmute event ")).call(N,S.uid)),this._handleMuteStream(S.uid,"audio",!1)),S._trust_video_mute_state_||(R.debug(b(O="[".concat(this._clientId,"] auto dispatch video unmute event ")).call(O,S.uid)),this._handleMuteStream(S.uid,"video",!1)),S._trust_audio_enabled_state_||(R.debug(b(B="[".concat(this._clientId,"] auto dispatch enable local audio ")).call(B,S.uid)),this._handleSetStreamLocalEnable("audio",S.uid,!0)),!S._trust_video_enabled_state_&&S._video_enabled_&&(R.debug(b(Q="[".concat(this._clientId,"] auto dispatch enable local video ")).call(Q,S.uid)),this._handleSetStreamLocalEnable("video",S.uid,!0)),S._trust_stream_added_state_||(R.debug(b(q="[".concat(this._clientId,"] auto dispatch stream remove ")).call(q,S.uid)),this._handleRemoveStream({uid:S.uid,uint_id:S._uintid}))}))},1e3)}p()}),this._gateway.on(kr.REQUEST_NEW_GATEWAY_LIST,(n,s)=>{if(!this._joinInfo)return s(new L(D.UNEXPECTED_ERROR,"can not recover, no join info"));Wc(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Dr).then(c=>{var u;this._joinInfo&&(this._joinInfo.apResponse=c.gatewayInfo.res),n(Ie(u=c.gatewayInfo.gatewayAddrs).call(u,h=>{if(this._joinInfo&&this._joinInfo.proxyServer){var p,f;return h=h.split(":"),b(p=b(f="wss://".concat(this._joinInfo.proxyServer,"/ws/?h=")).call(f,h[0],"&p=")).call(p,h[1])}return"wss://".concat(h)}))}).catch(s)}),this._gateway.on(kr.NETWORK_QUALITY,n=>{this._networkQualitySensitivity==="normal"&&this.emit(Je.NETWORK_QUALITY,n)}),this._gateway.on(kr.STREAM_TYPE_CHANGE,(n,s)=>{this.emit(Je.STREAM_TYPE_CHANGED,n,s),z.reportApiInvoke(this._sessionId,{name:Re.STREAM_TYPE_CHANGE,options:[n,s],tag:Te.TRACER}).onSuccess(pe({uid:n,streamType:s}))}),this._gateway.on(kr.IS_P2P_DISCONNECTED,n=>{var s,c,u;let h=[];return this._highStream&&h.push(this._highStream),H(s=this._remoteStream).call(s,p=>h.push(p)),h.length===0||Qe(h).call(h,p=>p.connectionState==="connected").length===0?n(!0):(R.debug(b(c="[".concat(this._clientId,"] ")).call(c,Ie(u=Qe(h).call(h,p=>p.connectionState==="connected")).call(u,p=>p.connectionId)," is connected")),void n(!1))}),this._gateway.on(kr.NEED_RENEW_SESSION,()=>{this._startSession()}),this._gateway.signal.on(mt.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(mt.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(mt.ON_ADD_AUDIO_STREAM,n=>this._handleAddAudioOrVideoStream("audio",n.uid,n.uint_id)),this._gateway.signal.on(mt.ON_ADD_VIDEO_STREAM,n=>this._handleAddAudioOrVideoStream("video",n.uid,n.uint_id)),this._gateway.signal.on(mt.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(mt.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(mt.MUTE_AUDIO,n=>this._handleMuteStream(n.uid,"audio",!0)),this._gateway.signal.on(mt.UNMUTE_AUDIO,n=>this._handleMuteStream(n.uid,"audio",!1)),this._gateway.signal.on(mt.MUTE_VIDEO,n=>this._handleMuteStream(n.uid,"video",!0)),this._gateway.signal.on(mt.UNMUTE_VIDEO,n=>this._handleMuteStream(n.uid,"video",!1)),this._gateway.signal.on(mt.RECEIVE_METADATA,n=>{let s=Qh(n.metadata);this.emit(Je.RECEIVE_METADATA,n.uid,s)}),this._gateway.signal.on(mt.ON_DATA_STREAM,n=>{n.seq&&delete n.seq,n.payload=Qh(n.payload),this.emit(Je.STREAM_MESSAGE,n.uid,n.payload),this.onStreamMessage&&this.onStreamMessage(n)}),this._gateway.signal.on(mt.ON_CRYPT_ERROR,()=>{Kc(()=>{R.warning("[".concat(this._clientId,"] on crypt error")),this.emit(Je.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(mt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(mt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{R.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._reset(),this._gateway.leave(!0),this.emit(Je.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this._gateway.signal.on(mt.ON_STREAM_FALLBACK_UPDATE,n=>{var s,c;R.debug(b(s=b(c="[".concat(this._clientId,"] stream fallback peerId: ")).call(c,n.stream_id,", attr: ")).call(s,n.stream_type)),this.emit(Je.STREAM_FALLBACK,n.stream_id,n.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(mt.ON_PUBLISH_STREAM,n=>{var s;this.uid===this._uid&&(this._highStream&&this._highStream._waitingSuccessResponse&&this._highStream.connectionState==="connected"?(this._highStream.reportPublishEvent(!0,null,pe({proxy:n.proxy})),R.info(b(s="[".concat(this._clientId,"] on publish stream, ")).call(s,pe(n))),n.proxy!==void 0&&this.emit(Je.IS_USING_CLOUD_PROXY,!!n.proxy)):this._lowStream?this._lowStream.reportPublishEvent(!0,null,pe({proxy:n.proxy})):R.warning("get on_publish_stream message but cannot handle"))}),this._gateway.signal.on(mt.ENABLE_LOCAL_VIDEO,n=>{this._handleSetStreamLocalEnable("video",n.uid,!0)}),this._gateway.signal.on(mt.DISABLE_LOCAL_VIDEO,n=>{this._handleSetStreamLocalEnable("video",n.uid,!1)}),this._gateway.signal.on($e.REQUEST_TIMEOUT,(n,s)=>{if(this._joinInfo)switch(n){case wt.PUBLISH:var c;if(!s||(n=s.stream_type==="high"?this._highStream:this._lowStream,!n))break;s.state==="offer"&&z.publish(this._joinInfo.sid,{lts:n.startTime,succ:!1,ec:D.TIMEOUT,audio:s.audio,video:s.video,p2pid:s.p2p_id,publishRequestid:n.ID,screenshare:!(!n.videoTrack||He(c=n.videoTrack._hints).call(c,ro.SCREEN_TRACK)===-1),audioName:n.audioTrack&&(n.audioTrack instanceof cn?n.audioTrack.getSubTrackLabels().join(","):n.audioTrack.getTrackLabel()),videoName:n.videoTrack&&n.videoTrack.getTrackLabel()});break;case wt.SUBSCRIBE:(c=this._remoteStream.get(s.stream_id))&&s&&z.subscribe(this._joinInfo.sid,{lts:c.startTime,succ:!1,ec:D.TIMEOUT,audio:!!s.audio,video:!!s.video,peerid:s.stream_id,subscribeRequestid:c.ID,p2pid:c.pc.ID})}})}}_l([Vc({report:z}),xn("design:type",Function),xn("design:paramtypes",[String]),xn("design:returntype",void 0)],sc.prototype,"setProxyServer",null),_l([Vc(),xn("design:type",Function),xn("design:paramtypes",[Object]),xn("design:returntype",void 0)],sc.prototype,"setTurnServer",null),_l([Vc({report:z}),xn("design:type",Function),xn("design:paramtypes",[Array,String]),xn("design:returntype",void 0)],sc.prototype,"setLocalAccessPoints",null),_l([Vc({report:z}),xn("design:type",Function),xn("design:paramtypes",[String,String,Uint8Array]),xn("design:returntype",void 0)],sc.prototype,"setEncryptionConfig",null),_l([Bh({report:z}),xn("design:type",Function),xn("design:paramtypes",[Object,Object]),xn("design:returntype",se)],sc.prototype,"pickSVCLayer",null);class uN extends l1{constructor(n,s={}){super();this.currentLoopCount=this.pausePlayTime=this.startPlayOffset=this.startPlayTime=0,this._currentState="stopped",this.audioBuffer=n,this.options=s,this.startPlayOffset=this.options.startPlayTime||0}set currentState(n){n!==this._currentState&&(this._currentState=n,this.emit(Qi.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer.duration}get currentTime(){return this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:(this.context.currentTime-this.startPlayTime+this.startPlayOffset)%this.audioBuffer.duration}updateOptions(n){this.currentState==="stopped"?(this.options=n,this.startPlayOffset=this.options.startPlayTime||0):R.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(n){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=n,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=n))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}startSourceNode(){var n;this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=hr(n=this.handleSourceNodeEnded).call(n,this))}createSourceNode(){let n=this.context.createBufferSource();return n.buffer=this.audioBuffer,n.loop=!!this.options.loop,n.connect(this.outputNode),n}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}let QI=new Ct;var dN=Qt.setInterval;let hN=qe().name;class Sl{constructor(n,s){this.id=0,Sl.count+=1,this.id=Sl.count,this.element=n,this.context=s}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=n=>{let s=document.createElement("audio");s.srcObject=new MediaStream([n.track]),s.play(),this.audioPlayerElement=s}}async switchSdp(){if(this.peerPair){var n=async(c,u)=>(u=u==="offer"?await c.createOffer():await c.createAnswer(),await c.setLocalDescription(u),c.iceGatheringState==="complete"?c.localDescription:new se(h=>{c.onicegatheringstatechange=()=>{c.iceGatheringState==="complete"&&h(c.localDescription)}})),s=async(c,u)=>await c.setRemoteDescription(u);try{let c=await n(this.peerPair[0],"offer");await s(this.peerPair[1],c);let u=await n(this.peerPair[1],"answer");await s(this.peerPair[0],u)}catch(c){throw new L(D.LOCAL_AEC_ERROR,c.toString()).print()}}}async getTracksFromMediaElement(n){if(this.audioTrack)return this.audioTrack;let s;try{n instanceof HTMLVideoElement&&(n.captureStream?n.captureStream():n.mozCaptureStream()),s=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(n).connect(s)}catch(c){throw new L(D.LOCAL_AEC_ERROR,c.toString()).print()}if(!s)throw new L(D.LOCAL_AEC_ERROR,"no dest node when local aec").print();return n=s.stream.getAudioTracks()[0],this.audioTrack=n,n}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();let n=await this.getTracksFromMediaElement(this.element);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){var n;R.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&H(n=this.peerPair).call(n,s=>{s.close()}),this.audioPlayerElement=this.peerPair=void 0}}Sl.count=0;var SA=function(i,n){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,n)};let pN=window.AudioContext||window.webkitAudioContext;class xI{constructor(){this.units=[]}processExternalMediaAEC(n){var s;if(!this._doesEnvironmentNeedAEC())return R.debug("the system does not need to process local aec"),-1;this.context||(this.context=new pN);let c=ze(s=this.units).call(s,u=>u&&u.getElement()===n);return c||(c=new Sl(n,this.context),this.units.push(c)),c.startEchoCancellation(),R.debug("start processing local audio echo cancellation, id is",c.id),c.id}_doesEnvironmentNeedAEC(){return qe().name!==Xe.SAFARI}}(function(i,n,s,c){var u,h=arguments.length,p=3>h?n:c===null?c=at(n,s):c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")p=Reflect.decorate(i,n,s,c);else for(var f=i.length-1;0<=f;f--)(u=i[f])&&(p=(3>h?u(p):3<h?u(n,s,p):u(n,s))||p);return 3<h&&p&&dt(n,s,p),p})([Vc({report:z}),SA("design:type",Function),SA("design:paramtypes",[HTMLAudioElement]),SA("design:returntype",Number)],xI.prototype,"processExternalMediaAEC",null);let AN=new xI;var UI,FI,VI,GI;Wr("PROCESS_ID",b(UI=b(FI=b(VI=b(GI="process-".concat(rr(8,""),"-")).call(GI,rr(4,""),"-")).call(VI,rr(4,""),"-")).call(FI,rr(4,""),"-")).call(UI,rr(12,""))),function(){let i=qe();var n=!!(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia);Bt.getDisplayMedia=n,Bt.getStreamFromExtension=i.name===Xe.CHROME&&34<Number(i.version),Bt.supportUnifiedPlan=function(){if(!(window.RTCRtpTransceiver&&"currentDirection"in RTCRtpTransceiver.prototype))return!1;let s=new RTCPeerConnection,c=!1;try{s.addTransceiver("audio"),c=!0}catch{}return s.close(),c}(),Bt.supportMinBitrate=i.name===Xe.CHROME||i.name===Xe.EDGE,Bt.supportSetRtpSenderParameters=function(){let s=qe();return window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters?!!xc()||!(!Fs()&&!go())||s.name===Xe.FIREFOX&&64<=Number(s.version):!1}(),i.name===Xe.SAFARI&&(14<=Number(i.version)?Bt.supportDualStream=!0:Bt.supportDualStream=!1),Bt.webAudioMediaStreamDest=function(){let s=qe();return!(s.name===Xe.SAFARI&&12>Number(s.version))}(),Bt.supportReplaceTrack=window.RTCRtpSender?typeof RTCRtpSender.prototype.replaceTrack=="function":!1,Bt.supportWebGL=typeof WebGLRenderingContext!="undefined",Bt.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,xc()||(Bt.webAudioWithAEC=!0),Bt.supportShareAudio=function(){let s=qe();return(s.os===an.WIN_10||s.os===an.WIN_81||s.os===an.WIN_7||s.os===an.LINUX||s.os===an.MAC_OS)&&s.name===Xe.CHROME&&74<=Number(s.version)}(),Bt.supportDualStreamEncoding=function(){let s=qe();return s.name==="Safari"&&14<=Number(s.version)}(),R.info("browser compatibility",pe(Bt),pe(i))}();let Un={__CLIENT_LIST__:Ko,__TRACK_LIST__:gs,VERSION:Xn,BUILD:"v4.7.2-0-gf83f608b(10/13/2021, 5:32:13 PM)",setParameter:Wr,getParameter:function(i){return re[i]},getSupportedCodec:async function(i){let n=null;return i?(n=new yI({}),n.addStream(i)):n=new _I({}),i=Sm(await n.createOfferSDP()),n.close(),i},checkSystemRequirements:function(){const i=z.reportApiInvoke(null,{name:Re.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Te.TRACER});var n=!1;try{var s=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,c=window.WebSocket;n=!!(window.RTCPeerConnection&&s&&c)}catch(u){return R.error("check system requirement failed: ",u),!1}return s=!1,c=qe(),c.name===Xe.CHROME&&58<=Number(c.version)&&(En.engine.name!=="WebKit"||Us())&&(s=!0),c.name===Xe.FIREFOX&&56<=Number(c.version)&&(s=!0),c.name===Xe.OPERA&&45<=Number(c.version)&&(s=!0),c.name===Xe.SAFARI&&11<=Number(c.version)&&(s=!0),qe().name!==Xe.WECHAT&&qe().name!==Xe.QQ||(s=!0),R.debug("checkSystemRequirements, api:",n,"browser",s),n=n&&s,i.onSuccess(n),n},getDevices:function(i){return Qn.enumerateDevices(!0,!0,i)},getMicrophones:function(i){return Qn.getRecordingDevices(i)},getCameras:function(i){return Qn.getCamerasDevices(i)},getElectronScreenSources:Zg,getPlaybackDevices:function(i){return Qn.getSpeakers(i)},createClient:function(i={codec:"vp8",mode:"rtc"}){const n=z.reportApiInvoke(null,{name:Re.CREATE_CLIENT,options:[i],tag:Te.TRACER});try{Ir(i.codec,"config.codec",["vp8","vp9","av1","h264"]),Ir(i.mode,"config.mode",["rtc","live"]),i.proxyServer!==void 0&&Yr(i.proxyServer,"config.proxyServer",1,1e4),i.turnServer!==void 0&&Wg(i.turnServer),i.httpRetryConfig!==void 0&&Hg(i.httpRetryConfig),i.websocketRetryConfig!==void 0&&Hg(i.websocketRetryConfig)}catch(s){throw n.onError(s),s}return n.onSuccess(),new sc(Ba({forceWaitGatewayResponse:!0},i,{role:i.mode==="rtc"?"host":i.role}))},createCameraVideoTrack:async function(i={encoderConfig:"480p_1"}){const n=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.CREATE_CAM_VIDEO_TRACK,options:[qh({},i)]}),s=jh(i);var c=rr(8,"track-cam-");let u=null;R.info("start create camera video track with config",pe(i),"trackId",c);try{u=(await bi({video:s},c)).getVideoTracks()[0]||null}catch(h){throw n.onError(h),h}return u?(i.optimizationMode&&Jh(c,u,i,i.encoderConfig&&cs(i.encoderConfig)),i=new Il(u,i,s,i.scalabiltyMode?Na(i.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},i.optimizationMode,c),n.onSuccess(i.getTrackId()),R.info("create camera video success, trackId:",c),i):(c=new L(D.UNEXPECTED_ERROR,"can not find track in media stream"),n.onError(c),c.throw())},createCustomVideoTrack:function(i){const n=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.CREATE_CUSTOM_VIDEO_TRACK,options:[i]}),s=new Wt(i.mediaStreamTrack,{bitrateMax:i.bitrateMax,bitrateMin:i.bitrateMin},i.scalabiltyMode?Na(i.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},i.optimizationMode);return n.onSuccess(s.getTrackId()),R.info("create custom video track success with config",i,"trackId",s.getTrackId()),s},createScreenVideoTrack:async function(i={},n="disable"){const s=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.CREATE_SCREEN_VIDEO_TRACK,options:[qh({},i),n]});i.encoderConfig?typeof i.encoderConfig=="string"||i.encoderConfig.width&&i.encoderConfig.height||(i.encoderConfig.width={max:1920},i.encoderConfig.height={max:1080}):i.encoderConfig="1080p_2";var c={};i.screenSourceType&&(c.mediaSource=i.screenSourceType),i.extensionId&&Ji()&&(c.extensionId=i.extensionId),i.electronScreenSourceId&&(c.sourceId=i.electronScreenSourceId);var u=i.encoderConfig?Uc(i.encoderConfig):null;u=(c.mandatory={chromeMediaSource:"desktop",maxWidth:u?u.width:void 0,maxHeight:u?u.height:void 0},u&&u.frameRate&&(typeof u.frameRate=="number"?(c.mandatory.maxFrameRate=u.frameRate,c.mandatory.minFrameRate=u.frameRate):(c.mandatory.maxFrameRate=u.frameRate.max||u.frameRate.ideal||u.frameRate.exact||void 0,c.mandatory.minFrameRate=u.frameRate.min||u.frameRate.ideal||u.frameRate.exact||void 0),c.frameRate=u.frameRate),u&&u.width&&(c.width=u.width),u&&u.height&&(c.height=u.height),c);const h=rr(8,"track-scr");let p=null;c=null;const f=Bt;if(!f.supportShareAudio&&n==="enable")return i=new L(D.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio"),s.onError(i),i.throw();R.info("start create screen video track with config",i,"withAudio",n,"trackId",h);try{const m=await bi({screen:u,screenAudio:n==="auto"?f.supportShareAudio:n==="enable"},h);p=m.getVideoTracks()[0]||null,c=m.getAudioTracks()[0]||null}catch(m){throw s.onError(m),m}return p?!c&&n==="enable"?(p&&p.stop(),i=new L(D.SHARE_AUDIO_NOT_ALLOWED),s.onError(i),i.throw()):(i.optimizationMode||(i.optimizationMode="detail"),i.optimizationMode&&(Jh(h,p,i,i.encoderConfig&&Uc(i.encoderConfig)),i.encoderConfig&&typeof i.encoderConfig!="string"&&(i.encoderConfig.bitrateMin=i.encoderConfig.bitrateMax)),i=new Wt(p,i.encoderConfig?Uc(i.encoderConfig):{},i.scalabiltyMode?Na(i.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},i.optimizationMode,h),i._hints.push(ro.SCREEN_TRACK),c?(n=new Br(c),s.onSuccess([i.getTrackId(),n.getTrackId()]),R.info("create screen video track success","video:",i.getTrackId(),"audio:",n.getTrackId()),[i,n]):(s.onSuccess(i.getTrackId()),R.info("create screen video track success","video:",i.getTrackId()),i)):(i=new L(D.UNEXPECTED_ERROR,"can not find track in media stream"),s.onError(i),i.throw())},createMicrophoneAndCameraTracks:async function(i={},n={encoderConfig:"480p_1"}){var s,c,u;const h=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.CREATE_MIC_AND_CAM_TRACKS,options:[i,n]}),p=jh(n),f=ym(i),m=rr(8,"track-mic-"),I=rr(8,"track-cam-");let E=null,_=null;R.info(b(s=b(c=b(u="start create camera video track(".concat(I,") and microphone audio track(")).call(u,m,") with config, audio: ")).call(c,pe(i),", video: ")).call(s,pe(n)));try{var S;const O=await bi({audio:f,video:p},b(S="".concat(m,"-")).call(S,I));E=O.getAudioTracks()[0],_=O.getVideoTracks()[0]}catch(O){throw h.onError(O),O}if(!E||!_){var N=new L(D.UNEXPECTED_ERROR,"can not find tracks in media stream");return h.onError(N),N.throw()}return n.optimizationMode&&Jh(I,_,n,n.encoderConfig&&cs(n.encoderConfig)),i=new hl(E,i,f,m),n=new Il(_,n,p,n.scalabiltyMode?Na(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,I),h.onSuccess([i.getTrackId(),n.getTrackId()]),R.info(b(N="create camera video track(".concat(I,") and microphone audio track(")).call(N,m,") success")),[i,n]},createMicrophoneAudioTrack:async function(i={}){const n=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.CREATE_MIC_AUDIO_TRACK,options:[i]}),s=ym(i);var c=rr(8,"track-mic-");let u=null;R.info("start create microphone audio track with config",pe(i),"trackId",c);try{u=(await bi({audio:s},c)).getAudioTracks()[0]||null}catch(h){throw n.onError(h),h}return u?(i=new hl(u,i,s,c),n.onSuccess(i.getTrackId()),R.info("create microphone audio track success, trackId:",c),i):(c=new L(D.UNEXPECTED_ERROR,"can not find track in media stream"),n.onError(c),c.throw())},createCustomAudioTrack:function(i){const n=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.CREATE_CUSTOM_AUDIO_TRACK,options:[i]}),s=new Br(i.mediaStreamTrack,i.encoderConfig?Oa(i.encoderConfig):{});return R.info("create custom audio track success with config",i,"trackId",s.getTrackId()),n.onSuccess(s.getTrackId()),s},createBufferSourceAudioTrack:async function(i){const n=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.CREATE_BUFFER_AUDIO_TRACK,options:[i]}),s=rr(8,"track-buf-");R.info("start create buffer source audio track with config",pe(i),"trackId",s);const c=i.source;if(!(i.source instanceof AudioBuffer))try{i.source=await $S(i.source,i.cacheOnlineFile)}catch(h){return n.onError(h),h.throw()}const u=new uN(i.source);return i=new ec(c,u,i.encoderConfig?Oa(i.encoderConfig):{},s),R.info("create buffer source audio track success, trackId:",s),n.onSuccess(i.getTrackId()),i},setLogLevel:function(i){R.setLogLevel(i)},enableLogUpload:function(){R.enableLogUpload()},disableLogUpload:function(){R.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new PI},checkAudioTrackIsActive:async function(i,n=5e3){const s=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[n]});if(!(i instanceof Br||i instanceof yl)){var c=new L(D.INVALID_TRACK,"the parameter is not a audio track");return s.onError(c),c.throw()}n&&1e3>n&&(n=1e3);const u=i instanceof Br?i.getTrackLabel():"remote_track";let h=c=i.getVolumeLevel(),p=c;const f=le();return new se(m=>{const I=dN(()=>{var E=i.getVolumeLevel();h=E>h?E:h,p=E<p?E:p,E=1e-4<h-p;var _=le()-f;if(E||_>n){var S;clearInterval(I),_={duration:_,deviceLabel:u,maxVolumeLevel:h,result:E},R.info(b(S="[track-".concat(i.getTrackId(),"] check audio track active completed. ")).call(S,pe(_))),s.onSuccess(_),m(E)}},200)})},checkVideoTrackIsActive:async function(i,n=5e3){var s;const c=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[n]});if(!(i instanceof Wt||i instanceof Cl))return i=new L(D.INVALID_TRACK,"the parameter is not a video track"),c.onError(i),i.throw();n&&1e3>n&&(n=1e3);var u=i instanceof Wt?i.getTrackLabel():"remote_track",h=i.getMediaStreamTrack(!0);const p=document.createElement("video");p.style.width="1px",p.style.height="1px",p.setAttribute("muted",""),p.muted=!0,p.setAttribute("playsinline",""),p.controls=!1,(Fs()||go())&&(p.style.opacity="0.01",p.style.position="fixed",p.style.left="0",p.style.top="0",document.body.appendChild(p)),p.srcObject=new MediaStream([h]),p.play();const f=document.createElement("canvas");f.width=160,f.height=120;let m=h=0;try{const I=le();h=await function(E,_,S,N){let O,B=0,Q=null;return new se((q,ie)=>{pi(()=>{O&&(O(),q(B))},_),O=Lh(()=>{e:{B>N&&O&&(O(),q(B));var Ae=S.getContext("2d");if(Ae){Ae.drawImage(E,0,0,160,120),Ae=Ae.getImageData(0,0,S.width,S.height);var Be=Math.floor(Ae.data.length/3);if(Q){for(let ke=0;ke<Be;ke+=3)if(Ae.data[ke]!==Q[ke]){B+=1,Q=Ae.data;break e}}Q=Ae.data}else Ae=new L(D.UNEXPECTED_ERROR,"can not get canvas 2d context."),R.error(Ae.toString()),ie(Ae)}},30)})}(p,n,f,4),m=le()-I}catch(I){throw c.onError(I),I}return hN===Xe.SAFARI&&(p.pause(),p.remove()),p.srcObject=null,n=4<h,u={duration:m,changedPicNum:h,deviceLabel:u,result:n},R.info(b(s="[track-".concat(i.getTrackId(),"] check video track active completed. ")).call(s,pe(u))),c.onSuccess(u),n},setArea:function(i){const n=z.reportApiInvoke(null,{name:Re.SET_AREA,options:i,tag:Te.TRACER});try{var s;let c=[];if(typeof i=="string"&&(c=[i]),to(i)&&(H(i).call(i,h=>{if(!gt(WE).call(WE,h))throw new L(D.INVALID_PARAMS,"invalid area code")}),c=i),Object.prototype.toString.call(i)==="[object Object]"){const{areaCode:h,excludedArea:p}=i;if(!h)throw new L(D.INVALID_PARAMS,"area code is needed");i=h,typeof h=="string"&&(i=[h]),c=p?Lw(i,p):i}Wr("AREAS",c);const u=(h=>{const p={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return Ie(h).call(h,f=>{const m=Qp[f];(f=ut(m))&&Ie(f).call(f,I=>{var E;I!=="CODE"&&(p[I]=b(E=p[I]).call(E,m[I]))})}),p})(c);Ie(s=ut(u)).call(s,h=>{h==="LOG_UPLOAD_SERVER"||h==="EVENT_REPORT_DOMAIN"||h==="EVENT_REPORT_BACKUP_DOMAIN"||h==="PROXY_SERVER_TYPE3"?Wr(h,u[h][0]):Wr(h,u[h])}),R.debug("set area success:",c.join(","))}catch(c){throw n.onError(c),c}n.onSuccess()},loadModule:async function(i,n){var s;if(R.debug(b(s="loadModule: ".concat(i.name,", loadOption: ")).call(s,pe(n))),!i.moduleInit)throw R.debug("Invalid Plugin"),new L(D.INVALID_PLUGIN,"invalid plugin");try{await i.moduleInit({logger:R,report:z},n)}catch(c){throw new L(D.UNEXPECTED_ERROR,"unexpected error in loadModule",c)}},processExternalMediaAEC:function(i){AN.processExternalMediaAEC(i)}};return Qn.on(Wo.CAMERA_DEVICE_CHANGED,i=>{R.info("camera device changed",pe(i)),Un.onCameraChanged&&Un.onCameraChanged(i)}),Qn.on(Wo.RECORDING_DEVICE_CHANGED,i=>{R.info("microphone device changed",pe(i)),Un.onMicrophoneChanged&&Un.onMicrophoneChanged(i)}),Qn.on(Wo.PLAYOUT_DEVICE_CHANGED,i=>{R.debug("playout device changed",pe(i)),Un.onPlaybackDeviceChanged&&Un.onPlaybackDeviceChanged(i)}),fi.onAutoplayFailed=()=>{R.info("detect audio element autoplay failed"),Un.onAudioAutoplayFailed&&Un.onAudioAutoplayFailed()},ht.on("autoplay-failed",()=>{R.info("detect webaudio autoplay failed"),Un.onAudioAutoplayFailed&&Un.onAudioAutoplayFailed()}),f1.on("autoplay-failed",()=>{R.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Un.onAutoplayFailed?Un.onAutoplayFailed():Un.onAudioAutoplayFailed?R.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):R.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`)}),window&&(window.__ARTC__=Un),Un})})(MS);var Gg=rO(MS.exports);const QQ={props:{id:{type:String,default:""}},setup(t){const e=t,r=nO();let o=la({});const a=Fn(()=>Object.values(o).filter(U=>U.isShow)),l=la({uid:1,name:"a",hasOpenVideo:!1,hasOpenAudio:!1,videoTrack:null,audioTrack:null,isShow:!0}),d=async U=>{if(U.uid==l.uid){l.isShow=!1;for(const te in C){let P=C[te];P&&(P.stop(),P.close())}return}U.isShow=!1,await v.unsubscribe(U)},A=async U=>{if(U.uid===l.uid){if(!U.audioTrack){await k();return}U.audioTrack.isPlaying?(U.audioTrack.setEnabled(!1),U.hasOpenAudio=!1):(U.audioTrack.setEnabled(!0),U.hasOpenAudio=!0);return}U.hasAudio&&(U.audioTrack.isPlaying?(U.audioTrack.stop(),U.hasOpenAudio=!1):(U.audioTrack.play(),U.hasOpenAudio=!0))},g=async U=>{const te=U.uid;if(te===l.uid){if(!U.videoTrack){await w();return}U.videoTrack.isPlaying?(U.videoTrack.setEnabled(!1),U.hasOpenVideo=!1):(U.videoTrack.setEnabled(!0),U.hasOpenVideo=!0);return}U.hasVideo&&(U.videoTrack.isPlaying?(U.videoTrack.stop(),U.hasOpenVideo=!1):(U.videoTrack.play(`player-${te}`),U.hasOpenVideo=!0))};let v=null,C=la({audioTrack:null,videoTrack:null});pc(async()=>{v=Gg.createClient({codec:"vp8",mode:"rtc"}),v.on("user-published",y),v.on("user-unpublished",F),v.on("user-left",K);const U="0062d9d90feddea4eada2ebb4b318b487bfIADgE9lF3pnJoX1srIC9g1tZwMfeg9UWC6KtN4w1bnW8e5E4kH0AAAAAEAAlZZC81ayGYQEAAQDVrIZh";l.uid=await v.join(r.liveOptions.APPID,e.id,U,null),await w(),await k()}),Sd(async()=>{await J()});async function y(U,te){const P=U.uid;if(o[P]=U,U.isShow=!1,te==="video"&&a.length<2){U.isShow=!0,await TA(),await M(U,te),U.hasOpenVideo=!0;return}te==="audio"&&(await M(U,te),U.hasOpenAudio=!0)}async function w(){C.videoTrack=await Gg.createCameraVideoTrack().catch(U=>{}),C.videoTrack&&(C.videoTrack.play("player-me"),l.hasOpenVideo=!0,l.videoTrack=C.videoTrack,v.publish(C.videoTrack))}async function k(){C.audioTrack=await Gg.createMicrophoneAudioTrack().catch(U=>{}),C.audioTrack&&(l.hasOpenAudio=!0,l.audioTrack=C.audioTrack,v.publish(C.audioTrack))}async function M(U,te){const P=U.uid;await v.subscribe(U,te),te==="video"&&U.videoTrack.play(`player-${P}`),te==="audio"&&U.audioTrack.play()}async function F(U){U.uid,U.hasVideo||(U.isShow=!1)}async function K(U){const te=U.uid;U.isShow=!1,U.audioTrack.stop(),U.videoTrack.stop(),delete o[te]}async function J(){for(const U in C){let te=C[U];te&&(te.stop(),te.close(),C[U]=void 0)}o={},await v.leave()}return(U,te)=>(Xt(),Tn(Ac,null,[(Xt(!0),Tn(Ac,null,qI(Ei(a),(P,he)=>(Xt(),Tn(Ac,{key:P.uid},[P.isShow?(Xt(),wo(LS,{key:0,id:P.uid,"has-video":P.hasOpenVideo,onVideo:ne=>g(P),"has-audio":P.hasOpenAudio,onAudio:ne=>A(P),onClose:ne=>d(P),name:P.uid+"","dom-id":"player-"+P.uid,"class-name":"w-80 h-60 "+(he==0?"bottom-[calc(100vh-19rem)]":"bottom-[calc(100vh-34.6rem)]")},null,8,["id","has-video","onVideo","has-audio","onAudio","onClose","name","dom-id","class-name"])):Tl("",!0)],64))),128)),Ei(l).isShow?(Xt(),wo(LS,{key:0,"has-video":Ei(l).hasVideo,onVideo:te[0]||(te[0]=P=>g(Ei(l))),"has-audio":Ei(l).hasAudio,onAudio:te[1]||(te[1]=P=>A(Ei(l))),onClose:te[2]||(te[2]=P=>d(Ei(l)))},null,8,["has-video","has-audio"])):Tl("",!0)],64))}},xQ=Tt("div",{class:"pt-16 w-screen h-screen overflow-hidden"},null,-1),HQ={props:{id:{type:String,default:""}},setup(t){return(e,r)=>(Xt(),Tn(Ac,null,[nr(RQ),xQ,(Xt(),wo(BN,null,{default:$o(()=>[nr(QQ,{id:t.id},null,8,["id"])]),_:1}))],64))}};export{HQ as default};
