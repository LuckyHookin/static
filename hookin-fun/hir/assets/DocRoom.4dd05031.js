var IO=Object.defineProperty,CO=Object.defineProperties;var _O=Object.getOwnPropertyDescriptors;var Yd=Object.getOwnPropertySymbols;var z_=Object.prototype.hasOwnProperty,X_=Object.prototype.propertyIsEnumerable;var J_=(i,r,s)=>r in i?IO(i,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[r]=s,vt=(i,r)=>{for(var s in r||(r={}))z_.call(r,s)&&J_(i,s,r[s]);if(Yd)for(var s of Yd(r))X_.call(r,s)&&J_(i,s,r[s]);return i},wn=(i,r)=>CO(i,_O(r));var Z_=(i,r)=>{var s={};for(var a in i)z_.call(i,a)&&r.indexOf(a)<0&&(s[a]=i[a]);if(i!=null&&Yd)for(var a of Yd(i))r.indexOf(a)<0&&X_.call(i,a)&&(s[a]=i[a]);return s};import{l as gu,v as Uc,ad as Fg,ai as Vg,ak as Pa,t as th,aB as yO,aC as SO,aD as TO,av as I0,a as Da,aE as RO,ap as wO,r as ah,o as Un,c as Hi,i as Ts,B as Wl,F as $s,y as C0,g as ch,aF as bO,f as uo,z as _0,A as eh,b as pg,ae as NO,af as y0,aG as OO,R as kO,aH as DO,aI as BO,p as LO,e as MO,ac as Qf,aJ as PO,h as xO,aK as UO}from"./vendor.ae917735.js";import{c as QO,i as FO,e as VO,s as GO,f as $_,t as S0,S as T0,h as jO,Y as ys,m as KO,j as ta,k as HO,l as WO,n as YO,o as Yl,p as qO,I as R0,C as JO,q as zO,r as XO,b as Ff,R as Ag,v as fg,u as ZO,w as $O,a as tk,x as ek,y as rk,z as nk,A as ql,B as ty,E as ey,U as ik,F as ok,G as sk,g as ak,d as ck,D as lk,W as uk,T as dk}from"./useRandom.1013bc77.js";import{_ as wh,S as rh,h as hk,a as w0,u as pk}from"./index.f6e7ad10.js";const Ak=i=>class{constructor(s){this._=s}destroy(){i(this._)}},fk=Ak(clearTimeout),gk=(i,r)=>new fk(setTimeout(r,i));function Zn(i){this.content=i}Zn.prototype={constructor:Zn,find:function(i){for(var r=0;r<this.content.length;r+=2)if(this.content[r]===i)return r;return-1},get:function(i){var r=this.find(i);return r==-1?void 0:this.content[r+1]},update:function(i,r,s){var a=s&&s!=i?this.remove(s):this,l=a.find(i),h=a.content.slice();return l==-1?h.push(s||i,r):(h[l+1]=r,s&&(h[l]=s)),new Zn(h)},remove:function(i){var r=this.find(i);if(r==-1)return this;var s=this.content.slice();return s.splice(r,2),new Zn(s)},addToStart:function(i,r){return new Zn([i,r].concat(this.remove(i).content))},addToEnd:function(i,r){var s=this.remove(i).content.slice();return s.push(i,r),new Zn(s)},addBefore:function(i,r,s){var a=this.remove(r),l=a.content.slice(),h=a.find(i);return l.splice(h==-1?l.length:h,0,r,s),new Zn(l)},forEach:function(i){for(var r=0;r<this.content.length;r+=2)i(this.content[r],this.content[r+1])},prepend:function(i){return i=Zn.from(i),i.size?new Zn(i.content.concat(this.subtract(i).content)):this},append:function(i){return i=Zn.from(i),i.size?new Zn(this.subtract(i).content.concat(i.content)):this},subtract:function(i){var r=this;i=Zn.from(i);for(var s=0;s<i.content.length;s+=2)r=r.remove(i.content[s]);return r},get size(){return this.content.length>>1}};Zn.from=function(i){if(i instanceof Zn)return i;var r=[];if(i)for(var s in i)r.push(s,i[s]);return new Zn(r)};var ry=Zn;function b0(i,r,s){for(var a=0;;a++){if(a==i.childCount||a==r.childCount)return i.childCount==r.childCount?null:s;var l=i.child(a),h=r.child(a);if(l==h){s+=l.nodeSize;continue}if(!l.sameMarkup(h))return s;if(l.isText&&l.text!=h.text){for(var A=0;l.text[A]==h.text[A];A++)s++;return s}if(l.content.size||h.content.size){var m=b0(l.content,h.content,s+1);if(m!=null)return m}s+=l.nodeSize}}function N0(i,r,s,a){for(var l=i.childCount,h=r.childCount;;){if(l==0||h==0)return l==h?null:{a:s,b:a};var A=i.child(--l),m=r.child(--h),v=A.nodeSize;if(A==m){s-=v,a-=v;continue}if(!A.sameMarkup(m))return{a:s,b:a};if(A.isText&&A.text!=m.text){for(var C=0,S=Math.min(A.text.length,m.text.length);C<S&&A.text[A.text.length-C-1]==m.text[m.text.length-C-1];)C++,s--,a--;return{a:s,b:a}}if(A.content.size||m.content.size){var b=N0(A.content,m.content,s-1,a-1);if(b)return b}s-=v,a-=v}}var Et=function(r,s){if(this.content=r,this.size=s||0,s==null)for(var a=0;a<r.length;a++)this.size+=r[a].nodeSize},bh={firstChild:{configurable:!0},lastChild:{configurable:!0},childCount:{configurable:!0}};Et.prototype.nodesBetween=function(r,s,a,l,h){l===void 0&&(l=0);for(var A=0,m=0;m<s;A++){var v=this.content[A],C=m+v.nodeSize;if(C>r&&a(v,l+m,h,A)!==!1&&v.content.size){var S=m+1;v.nodesBetween(Math.max(0,r-S),Math.min(v.content.size,s-S),a,l+S)}m=C}};Et.prototype.descendants=function(r){this.nodesBetween(0,this.size,r)};Et.prototype.textBetween=function(r,s,a,l){var h="",A=!0;return this.nodesBetween(r,s,function(m,v){m.isText?(h+=m.text.slice(Math.max(r,v)-v,s-v),A=!a):m.isLeaf&&l?(h+=typeof l=="function"?l(m):l,A=!a):!A&&m.isBlock&&(h+=a,A=!0)},0),h};Et.prototype.append=function(r){if(!r.size)return this;if(!this.size)return r;var s=this.lastChild,a=r.firstChild,l=this.content.slice(),h=0;for(s.isText&&s.sameMarkup(a)&&(l[l.length-1]=s.withText(s.text+a.text),h=1);h<r.content.length;h++)l.push(r.content[h]);return new Et(l,this.size+r.size)};Et.prototype.cut=function(r,s){if(s==null&&(s=this.size),r==0&&s==this.size)return this;var a=[],l=0;if(s>r)for(var h=0,A=0;A<s;h++){var m=this.content[h],v=A+m.nodeSize;v>r&&((A<r||v>s)&&(m.isText?m=m.cut(Math.max(0,r-A),Math.min(m.text.length,s-A)):m=m.cut(Math.max(0,r-A-1),Math.min(m.content.size,s-A-1))),a.push(m),l+=m.nodeSize),A=v}return new Et(a,l)};Et.prototype.cutByIndex=function(r,s){return r==s?Et.empty:r==0&&s==this.content.length?this:new Et(this.content.slice(r,s))};Et.prototype.replaceChild=function(r,s){var a=this.content[r];if(a==s)return this;var l=this.content.slice(),h=this.size+s.nodeSize-a.nodeSize;return l[r]=s,new Et(l,h)};Et.prototype.addToStart=function(r){return new Et([r].concat(this.content),this.size+r.nodeSize)};Et.prototype.addToEnd=function(r){return new Et(this.content.concat(r),this.size+r.nodeSize)};Et.prototype.eq=function(r){if(this.content.length!=r.content.length)return!1;for(var s=0;s<this.content.length;s++)if(!this.content[s].eq(r.content[s]))return!1;return!0};bh.firstChild.get=function(){return this.content.length?this.content[0]:null};bh.lastChild.get=function(){return this.content.length?this.content[this.content.length-1]:null};bh.childCount.get=function(){return this.content.length};Et.prototype.child=function(r){var s=this.content[r];if(!s)throw new RangeError("Index "+r+" out of range for "+this);return s};Et.prototype.maybeChild=function(r){return this.content[r]};Et.prototype.forEach=function(r){for(var s=0,a=0;s<this.content.length;s++){var l=this.content[s];r(l,a,s),a+=l.nodeSize}};Et.prototype.findDiffStart=function(r,s){return s===void 0&&(s=0),b0(this,r,s)};Et.prototype.findDiffEnd=function(r,s,a){return s===void 0&&(s=this.size),a===void 0&&(a=r.size),N0(this,r,s,a)};Et.prototype.findIndex=function(r,s){if(s===void 0&&(s=-1),r==0)return qd(0,r);if(r==this.size)return qd(this.content.length,r);if(r>this.size||r<0)throw new RangeError("Position "+r+" outside of fragment ("+this+")");for(var a=0,l=0;;a++){var h=this.child(a),A=l+h.nodeSize;if(A>=r)return A==r||s>0?qd(a+1,A):qd(a,l);l=A}};Et.prototype.toString=function(){return"<"+this.toStringInner()+">"};Et.prototype.toStringInner=function(){return this.content.join(", ")};Et.prototype.toJSON=function(){return this.content.length?this.content.map(function(r){return r.toJSON()}):null};Et.fromJSON=function(r,s){if(!s)return Et.empty;if(!Array.isArray(s))throw new RangeError("Invalid input for Fragment.fromJSON");return new Et(s.map(r.nodeFromJSON))};Et.fromArray=function(r){if(!r.length)return Et.empty;for(var s,a=0,l=0;l<r.length;l++){var h=r[l];a+=h.nodeSize,l&&h.isText&&r[l-1].sameMarkup(h)?(s||(s=r.slice(0,l)),s[s.length-1]=h.withText(s[s.length-1].text+h.text)):s&&s.push(h)}return new Et(s||r,a)};Et.from=function(r){if(!r)return Et.empty;if(r instanceof Et)return r;if(Array.isArray(r))return this.fromArray(r);if(r.attrs)return new Et([r],r.nodeSize);throw new RangeError("Can not convert "+r+" to a Fragment"+(r.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))};Object.defineProperties(Et.prototype,bh);var Vf={index:0,offset:0};function qd(i,r){return Vf.index=i,Vf.offset=r,Vf}Et.empty=new Et([],0);function lh(i,r){if(i===r)return!0;if(!(i&&typeof i=="object")||!(r&&typeof r=="object"))return!1;var s=Array.isArray(i);if(Array.isArray(r)!=s)return!1;if(s){if(i.length!=r.length)return!1;for(var a=0;a<i.length;a++)if(!lh(i[a],r[a]))return!1}else{for(var l in i)if(!(l in r)||!lh(i[l],r[l]))return!1;for(var h in r)if(!(h in i))return!1}return!0}var Ge=function(r,s){this.type=r,this.attrs=s};Ge.prototype.addToSet=function(r){for(var s,a=!1,l=0;l<r.length;l++){var h=r[l];if(this.eq(h))return r;if(this.type.excludes(h.type))s||(s=r.slice(0,l));else{if(h.type.excludes(this.type))return r;!a&&h.type.rank>this.type.rank&&(s||(s=r.slice(0,l)),s.push(this),a=!0),s&&s.push(h)}}return s||(s=r.slice()),a||s.push(this),s};Ge.prototype.removeFromSet=function(r){for(var s=0;s<r.length;s++)if(this.eq(r[s]))return r.slice(0,s).concat(r.slice(s+1));return r};Ge.prototype.isInSet=function(r){for(var s=0;s<r.length;s++)if(this.eq(r[s]))return!0;return!1};Ge.prototype.eq=function(r){return this==r||this.type==r.type&&lh(this.attrs,r.attrs)};Ge.prototype.toJSON=function(){var r={type:this.type.name};for(var s in this.attrs){r.attrs=this.attrs;break}return r};Ge.fromJSON=function(r,s){if(!s)throw new RangeError("Invalid input for Mark.fromJSON");var a=r.marks[s.type];if(!a)throw new RangeError("There is no mark type "+s.type+" in this schema");return a.create(s.attrs)};Ge.sameSet=function(r,s){if(r==s)return!0;if(r.length!=s.length)return!1;for(var a=0;a<r.length;a++)if(!r[a].eq(s[a]))return!1;return!0};Ge.setFrom=function(r){if(!r||r.length==0)return Ge.none;if(r instanceof Ge)return[r];var s=r.slice();return s.sort(function(a,l){return a.type.rank-l.type.rank}),s};Ge.none=[];function Yo(i){var r=Error.call(this,i);return r.__proto__=Yo.prototype,r}Yo.prototype=Object.create(Error.prototype);Yo.prototype.constructor=Yo;Yo.prototype.name="ReplaceError";var Pt=function(r,s,a){this.content=r,this.openStart=s,this.openEnd=a},O0={size:{configurable:!0}};O0.size.get=function(){return this.content.size-this.openStart-this.openEnd};Pt.prototype.insertAt=function(r,s){var a=D0(this.content,r+this.openStart,s,null);return a&&new Pt(a,this.openStart,this.openEnd)};Pt.prototype.removeBetween=function(r,s){return new Pt(k0(this.content,r+this.openStart,s+this.openStart),this.openStart,this.openEnd)};Pt.prototype.eq=function(r){return this.content.eq(r.content)&&this.openStart==r.openStart&&this.openEnd==r.openEnd};Pt.prototype.toString=function(){return this.content+"("+this.openStart+","+this.openEnd+")"};Pt.prototype.toJSON=function(){if(!this.content.size)return null;var r={content:this.content.toJSON()};return this.openStart>0&&(r.openStart=this.openStart),this.openEnd>0&&(r.openEnd=this.openEnd),r};Pt.fromJSON=function(r,s){if(!s)return Pt.empty;var a=s.openStart||0,l=s.openEnd||0;if(typeof a!="number"||typeof l!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new Pt(Et.fromJSON(r,s.content),a,l)};Pt.maxOpen=function(r,s){s===void 0&&(s=!0);for(var a=0,l=0,h=r.firstChild;h&&!h.isLeaf&&(s||!h.type.spec.isolating);h=h.firstChild)a++;for(var A=r.lastChild;A&&!A.isLeaf&&(s||!A.type.spec.isolating);A=A.lastChild)l++;return new Pt(r,a,l)};Object.defineProperties(Pt.prototype,O0);function k0(i,r,s){var a=i.findIndex(r),l=a.index,h=a.offset,A=i.maybeChild(l),m=i.findIndex(s),v=m.index,C=m.offset;if(h==r||A.isText){if(C!=s&&!i.child(v).isText)throw new RangeError("Removing non-flat range");return i.cut(0,r).append(i.cut(s))}if(l!=v)throw new RangeError("Removing non-flat range");return i.replaceChild(l,A.copy(k0(A.content,r-h-1,s-h-1)))}function D0(i,r,s,a){var l=i.findIndex(r),h=l.index,A=l.offset,m=i.maybeChild(h);if(A==r||m.isText)return a&&!a.canReplace(h,h,s)?null:i.cut(0,r).append(s).append(i.cut(r));var v=D0(m.content,r-A-1,s);return v&&i.replaceChild(h,m.copy(v))}Pt.empty=new Pt(Et.empty,0,0);function mk(i,r,s){if(s.openStart>i.depth)throw new Yo("Inserted content deeper than insertion position");if(i.depth-s.openStart!=r.depth-s.openEnd)throw new Yo("Inconsistent open depths");return B0(i,r,s,0)}function B0(i,r,s,a){var l=i.index(a),h=i.node(a);if(l==r.index(a)&&a<i.depth-s.openStart){var A=B0(i,r,s,a+1);return h.copy(h.content.replaceChild(l,A))}else if(s.content.size)if(!s.openStart&&!s.openEnd&&i.depth==a&&r.depth==a){var m=i.parent,v=m.content;return Ua(m,v.cut(0,i.parentOffset).append(s.content).append(v.cut(r.parentOffset)))}else{var C=Ek(s,i),S=C.start,b=C.end;return Ua(h,M0(i,S,b,r,a))}else return Ua(h,uh(i,r,a))}function L0(i,r){if(!r.type.compatibleContent(i.type))throw new Yo("Cannot join "+r.type.name+" onto "+i.type.name)}function gg(i,r,s){var a=i.node(s);return L0(a,r.node(s)),a}function xa(i,r){var s=r.length-1;s>=0&&i.isText&&i.sameMarkup(r[s])?r[s]=i.withText(r[s].text+i.text):r.push(i)}function Jl(i,r,s,a){var l=(r||i).node(s),h=0,A=r?r.index(s):l.childCount;i&&(h=i.index(s),i.depth>s?h++:i.textOffset&&(xa(i.nodeAfter,a),h++));for(var m=h;m<A;m++)xa(l.child(m),a);r&&r.depth==s&&r.textOffset&&xa(r.nodeBefore,a)}function Ua(i,r){if(!i.type.validContent(r))throw new Yo("Invalid content for node "+i.type.name);return i.copy(r)}function M0(i,r,s,a,l){var h=i.depth>l&&gg(i,r,l+1),A=a.depth>l&&gg(s,a,l+1),m=[];return Jl(null,i,l,m),h&&A&&r.index(l)==s.index(l)?(L0(h,A),xa(Ua(h,M0(i,r,s,a,l+1)),m)):(h&&xa(Ua(h,uh(i,r,l+1)),m),Jl(r,s,l,m),A&&xa(Ua(A,uh(s,a,l+1)),m)),Jl(a,null,l,m),new Et(m)}function uh(i,r,s){var a=[];if(Jl(null,i,s,a),i.depth>s){var l=gg(i,r,s+1);xa(Ua(l,uh(i,r,s+1)),a)}return Jl(r,null,s,a),new Et(a)}function Ek(i,r){for(var s=r.depth-i.openStart,a=r.node(s),l=a.copy(i.content),h=s-1;h>=0;h--)l=r.node(h).copy(Et.from(l));return{start:l.resolveNoCache(i.openStart+s),end:l.resolveNoCache(l.content.size-i.openEnd-s)}}var Nr=function(r,s,a){this.pos=r,this.path=s,this.depth=s.length/3-1,this.parentOffset=a},qc={parent:{configurable:!0},doc:{configurable:!0},textOffset:{configurable:!0},nodeAfter:{configurable:!0},nodeBefore:{configurable:!0}};Nr.prototype.resolveDepth=function(r){return r==null?this.depth:r<0?this.depth+r:r};qc.parent.get=function(){return this.node(this.depth)};qc.doc.get=function(){return this.node(0)};Nr.prototype.node=function(r){return this.path[this.resolveDepth(r)*3]};Nr.prototype.index=function(r){return this.path[this.resolveDepth(r)*3+1]};Nr.prototype.indexAfter=function(r){return r=this.resolveDepth(r),this.index(r)+(r==this.depth&&!this.textOffset?0:1)};Nr.prototype.start=function(r){return r=this.resolveDepth(r),r==0?0:this.path[r*3-1]+1};Nr.prototype.end=function(r){return r=this.resolveDepth(r),this.start(r)+this.node(r).content.size};Nr.prototype.before=function(r){if(r=this.resolveDepth(r),!r)throw new RangeError("There is no position before the top-level node");return r==this.depth+1?this.pos:this.path[r*3-1]};Nr.prototype.after=function(r){if(r=this.resolveDepth(r),!r)throw new RangeError("There is no position after the top-level node");return r==this.depth+1?this.pos:this.path[r*3-1]+this.path[r*3].nodeSize};qc.textOffset.get=function(){return this.pos-this.path[this.path.length-1]};qc.nodeAfter.get=function(){var i=this.parent,r=this.index(this.depth);if(r==i.childCount)return null;var s=this.pos-this.path[this.path.length-1],a=i.child(r);return s?i.child(r).cut(s):a};qc.nodeBefore.get=function(){var i=this.index(this.depth),r=this.pos-this.path[this.path.length-1];return r?this.parent.child(i).cut(0,r):i==0?null:this.parent.child(i-1)};Nr.prototype.posAtIndex=function(r,s){s=this.resolveDepth(s);for(var a=this.path[s*3],l=s==0?0:this.path[s*3-1]+1,h=0;h<r;h++)l+=a.child(h).nodeSize;return l};Nr.prototype.marks=function(){var r=this.parent,s=this.index();if(r.content.size==0)return Ge.none;if(this.textOffset)return r.child(s).marks;var a=r.maybeChild(s-1),l=r.maybeChild(s);if(!a){var h=a;a=l,l=h}for(var A=a.marks,m=0;m<A.length;m++)A[m].type.spec.inclusive===!1&&(!l||!A[m].isInSet(l.marks))&&(A=A[m--].removeFromSet(A));return A};Nr.prototype.marksAcross=function(r){var s=this.parent.maybeChild(this.index());if(!s||!s.isInline)return null;for(var a=s.marks,l=r.parent.maybeChild(r.index()),h=0;h<a.length;h++)a[h].type.spec.inclusive===!1&&(!l||!a[h].isInSet(l.marks))&&(a=a[h--].removeFromSet(a));return a};Nr.prototype.sharedDepth=function(r){for(var s=this.depth;s>0;s--)if(this.start(s)<=r&&this.end(s)>=r)return s;return 0};Nr.prototype.blockRange=function(r,s){if(r===void 0&&(r=this),r.pos<this.pos)return r.blockRange(this);for(var a=this.depth-(this.parent.inlineContent||this.pos==r.pos?1:0);a>=0;a--)if(r.pos<=this.end(a)&&(!s||s(this.node(a))))return new nu(this,r,a)};Nr.prototype.sameParent=function(r){return this.pos-this.parentOffset==r.pos-r.parentOffset};Nr.prototype.max=function(r){return r.pos>this.pos?r:this};Nr.prototype.min=function(r){return r.pos<this.pos?r:this};Nr.prototype.toString=function(){for(var r="",s=1;s<=this.depth;s++)r+=(r?"/":"")+this.node(s).type.name+"_"+this.index(s-1);return r+":"+this.parentOffset};Nr.resolve=function(r,s){if(!(s>=0&&s<=r.content.size))throw new RangeError("Position "+s+" out of range");for(var a=[],l=0,h=s,A=r;;){var m=A.content.findIndex(h),v=m.index,C=m.offset,S=h-C;if(a.push(A,v,l+C),!S||(A=A.child(v),A.isText))break;h=S-1,l+=C+1}return new Nr(s,a,h)};Nr.resolveCached=function(r,s){for(var a=0;a<Gf.length;a++){var l=Gf[a];if(l.pos==s&&l.doc==r)return l}var h=Gf[jf]=Nr.resolve(r,s);return jf=(jf+1)%vk,h};Object.defineProperties(Nr.prototype,qc);var Gf=[],jf=0,vk=12,nu=function(r,s,a){this.$from=r,this.$to=s,this.depth=a},Jc={start:{configurable:!0},end:{configurable:!0},parent:{configurable:!0},startIndex:{configurable:!0},endIndex:{configurable:!0}};Jc.start.get=function(){return this.$from.before(this.depth+1)};Jc.end.get=function(){return this.$to.after(this.depth+1)};Jc.parent.get=function(){return this.$from.node(this.depth)};Jc.startIndex.get=function(){return this.$from.index(this.depth)};Jc.endIndex.get=function(){return this.$to.indexAfter(this.depth)};Object.defineProperties(nu.prototype,Jc);var Ik=Object.create(null),Ye=function(r,s,a,l){this.type=r,this.attrs=s,this.content=a||Et.empty,this.marks=l||Ge.none},Yi={nodeSize:{configurable:!0},childCount:{configurable:!0},textContent:{configurable:!0},firstChild:{configurable:!0},lastChild:{configurable:!0},isBlock:{configurable:!0},isTextblock:{configurable:!0},inlineContent:{configurable:!0},isInline:{configurable:!0},isText:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};Yi.nodeSize.get=function(){return this.isLeaf?1:2+this.content.size};Yi.childCount.get=function(){return this.content.childCount};Ye.prototype.child=function(r){return this.content.child(r)};Ye.prototype.maybeChild=function(r){return this.content.maybeChild(r)};Ye.prototype.forEach=function(r){this.content.forEach(r)};Ye.prototype.nodesBetween=function(r,s,a,l){l===void 0&&(l=0),this.content.nodesBetween(r,s,a,l,this)};Ye.prototype.descendants=function(r){this.nodesBetween(0,this.content.size,r)};Yi.textContent.get=function(){return this.textBetween(0,this.content.size,"")};Ye.prototype.textBetween=function(r,s,a,l){return this.content.textBetween(r,s,a,l)};Yi.firstChild.get=function(){return this.content.firstChild};Yi.lastChild.get=function(){return this.content.lastChild};Ye.prototype.eq=function(r){return this==r||this.sameMarkup(r)&&this.content.eq(r.content)};Ye.prototype.sameMarkup=function(r){return this.hasMarkup(r.type,r.attrs,r.marks)};Ye.prototype.hasMarkup=function(r,s,a){return this.type==r&&lh(this.attrs,s||r.defaultAttrs||Ik)&&Ge.sameSet(this.marks,a||Ge.none)};Ye.prototype.copy=function(r){return r===void 0&&(r=null),r==this.content?this:new this.constructor(this.type,this.attrs,r,this.marks)};Ye.prototype.mark=function(r){return r==this.marks?this:new this.constructor(this.type,this.attrs,this.content,r)};Ye.prototype.cut=function(r,s){return r==0&&s==this.content.size?this:this.copy(this.content.cut(r,s))};Ye.prototype.slice=function(r,s,a){if(s===void 0&&(s=this.content.size),a===void 0&&(a=!1),r==s)return Pt.empty;var l=this.resolve(r),h=this.resolve(s),A=a?0:l.sharedDepth(s),m=l.start(A),v=l.node(A),C=v.content.cut(l.pos-m,h.pos-m);return new Pt(C,l.depth-A,h.depth-A)};Ye.prototype.replace=function(r,s,a){return mk(this.resolve(r),this.resolve(s),a)};Ye.prototype.nodeAt=function(r){for(var s=this;;){var a=s.content.findIndex(r),l=a.index,h=a.offset;if(s=s.maybeChild(l),!s)return null;if(h==r||s.isText)return s;r-=h+1}};Ye.prototype.childAfter=function(r){var s=this.content.findIndex(r),a=s.index,l=s.offset;return{node:this.content.maybeChild(a),index:a,offset:l}};Ye.prototype.childBefore=function(r){if(r==0)return{node:null,index:0,offset:0};var s=this.content.findIndex(r),a=s.index,l=s.offset;if(l<r)return{node:this.content.child(a),index:a,offset:l};var h=this.content.child(a-1);return{node:h,index:a-1,offset:l-h.nodeSize}};Ye.prototype.resolve=function(r){return Nr.resolveCached(this,r)};Ye.prototype.resolveNoCache=function(r){return Nr.resolve(this,r)};Ye.prototype.rangeHasMark=function(r,s,a){var l=!1;return s>r&&this.nodesBetween(r,s,function(h){return a.isInSet(h.marks)&&(l=!0),!l}),l};Yi.isBlock.get=function(){return this.type.isBlock};Yi.isTextblock.get=function(){return this.type.isTextblock};Yi.inlineContent.get=function(){return this.type.inlineContent};Yi.isInline.get=function(){return this.type.isInline};Yi.isText.get=function(){return this.type.isText};Yi.isLeaf.get=function(){return this.type.isLeaf};Yi.isAtom.get=function(){return this.type.isAtom};Ye.prototype.toString=function(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);var r=this.type.name;return this.content.size&&(r+="("+this.content.toStringInner()+")"),P0(this.marks,r)};Ye.prototype.contentMatchAt=function(r){var s=this.type.contentMatch.matchFragment(this.content,0,r);if(!s)throw new Error("Called contentMatchAt on a node with invalid content");return s};Ye.prototype.canReplace=function(r,s,a,l,h){a===void 0&&(a=Et.empty),l===void 0&&(l=0),h===void 0&&(h=a.childCount);var A=this.contentMatchAt(r).matchFragment(a,l,h),m=A&&A.matchFragment(this.content,s);if(!m||!m.validEnd)return!1;for(var v=l;v<h;v++)if(!this.type.allowsMarks(a.child(v).marks))return!1;return!0};Ye.prototype.canReplaceWith=function(r,s,a,l){if(l&&!this.type.allowsMarks(l))return!1;var h=this.contentMatchAt(r).matchType(a),A=h&&h.matchFragment(this.content,s);return A?A.validEnd:!1};Ye.prototype.canAppend=function(r){return r.content.size?this.canReplace(this.childCount,this.childCount,r.content):this.type.compatibleContent(r.type)};Ye.prototype.check=function(){if(!this.type.validContent(this.content))throw new RangeError("Invalid content for node "+this.type.name+": "+this.content.toString().slice(0,50));for(var r=Ge.none,s=0;s<this.marks.length;s++)r=this.marks[s].addToSet(r);if(!Ge.sameSet(r,this.marks))throw new RangeError("Invalid collection of marks for node "+this.type.name+": "+this.marks.map(function(a){return a.type.name}));this.content.forEach(function(a){return a.check()})};Ye.prototype.toJSON=function(){var r={type:this.type.name};for(var s in this.attrs){r.attrs=this.attrs;break}return this.content.size&&(r.content=this.content.toJSON()),this.marks.length&&(r.marks=this.marks.map(function(a){return a.toJSON()})),r};Ye.fromJSON=function(r,s){if(!s)throw new RangeError("Invalid input for Node.fromJSON");var a=null;if(s.marks){if(!Array.isArray(s.marks))throw new RangeError("Invalid mark data for Node.fromJSON");a=s.marks.map(r.markFromJSON)}if(s.type=="text"){if(typeof s.text!="string")throw new RangeError("Invalid text node in JSON");return r.text(s.text,a)}var l=Et.fromJSON(r,s.content);return r.nodeType(s.type).create(s.attrs,l,a)};Object.defineProperties(Ye.prototype,Yi);var Ck=function(i){function r(a,l,h,A){if(i.call(this,a,l,null,A),!h)throw new RangeError("Empty text nodes are not allowed");this.text=h}i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r;var s={textContent:{configurable:!0},nodeSize:{configurable:!0}};return r.prototype.toString=function(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):P0(this.marks,JSON.stringify(this.text))},s.textContent.get=function(){return this.text},r.prototype.textBetween=function(l,h){return this.text.slice(l,h)},s.nodeSize.get=function(){return this.text.length},r.prototype.mark=function(l){return l==this.marks?this:new r(this.type,this.attrs,this.text,l)},r.prototype.withText=function(l){return l==this.text?this:new r(this.type,this.attrs,l,this.marks)},r.prototype.cut=function(l,h){return l===void 0&&(l=0),h===void 0&&(h=this.text.length),l==0&&h==this.text.length?this:this.withText(this.text.slice(l,h))},r.prototype.eq=function(l){return this.sameMarkup(l)&&this.text==l.text},r.prototype.toJSON=function(){var l=i.prototype.toJSON.call(this);return l.text=this.text,l},Object.defineProperties(r.prototype,s),r}(Ye);function P0(i,r){for(var s=i.length-1;s>=0;s--)r=i[s].type.name+"("+r+")";return r}var $n=function(r){this.validEnd=r,this.next=[],this.wrapCache=[]},Nh={inlineContent:{configurable:!0},defaultType:{configurable:!0},edgeCount:{configurable:!0}};$n.parse=function(r,s){var a=new Oh(r,s);if(a.next==null)return $n.empty;var l=U0(a);a.next&&a.err("Unexpected trailing text");var h=bk(wk(l));return Nk(h,a),h};$n.prototype.matchType=function(r){for(var s=0;s<this.next.length;s+=2)if(this.next[s]==r)return this.next[s+1];return null};$n.prototype.matchFragment=function(r,s,a){s===void 0&&(s=0),a===void 0&&(a=r.childCount);for(var l=this,h=s;l&&h<a;h++)l=l.matchType(r.child(h).type);return l};Nh.inlineContent.get=function(){var i=this.next[0];return i?i.isInline:!1};Nh.defaultType.get=function(){for(var i=0;i<this.next.length;i+=2){var r=this.next[i];if(!(r.isText||r.hasRequiredAttrs()))return r}};$n.prototype.compatible=function(r){for(var s=0;s<this.next.length;s+=2)for(var a=0;a<r.next.length;a+=2)if(this.next[s]==r.next[a])return!0;return!1};$n.prototype.fillBefore=function(r,s,a){s===void 0&&(s=!1),a===void 0&&(a=0);var l=[this];function h(A,m){var v=A.matchFragment(r,a);if(v&&(!s||v.validEnd))return Et.from(m.map(function(P){return P.createAndFill()}));for(var C=0;C<A.next.length;C+=2){var S=A.next[C],b=A.next[C+1];if(!(S.isText||S.hasRequiredAttrs())&&l.indexOf(b)==-1){l.push(b);var O=h(b,m.concat(S));if(O)return O}}}return h(this,[])};$n.prototype.findWrapping=function(r){for(var s=0;s<this.wrapCache.length;s+=2)if(this.wrapCache[s]==r)return this.wrapCache[s+1];var a=this.computeWrapping(r);return this.wrapCache.push(r,a),a};$n.prototype.computeWrapping=function(r){for(var s=Object.create(null),a=[{match:this,type:null,via:null}];a.length;){var l=a.shift(),h=l.match;if(h.matchType(r)){for(var A=[],m=l;m.type;m=m.via)A.push(m.type);return A.reverse()}for(var v=0;v<h.next.length;v+=2){var C=h.next[v];!C.isLeaf&&!C.hasRequiredAttrs()&&!(C.name in s)&&(!l.type||h.next[v+1].validEnd)&&(a.push({match:C.contentMatch,type:C,via:l}),s[C.name]=!0)}}};Nh.edgeCount.get=function(){return this.next.length>>1};$n.prototype.edge=function(r){var s=r<<1;if(s>=this.next.length)throw new RangeError("There's no "+r+"th edge in this content match");return{type:this.next[s],next:this.next[s+1]}};$n.prototype.toString=function(){var r=[];function s(a){r.push(a);for(var l=1;l<a.next.length;l+=2)r.indexOf(a.next[l])==-1&&s(a.next[l])}return s(this),r.map(function(a,l){for(var h=l+(a.validEnd?"*":" ")+" ",A=0;A<a.next.length;A+=2)h+=(A?", ":"")+a.next[A].name+"->"+r.indexOf(a.next[A+1]);return h}).join(`
`)};Object.defineProperties($n.prototype,Nh);$n.empty=new $n(!0);var Oh=function(r,s){this.string=r,this.nodeTypes=s,this.inline=null,this.pos=0,this.tokens=r.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()},x0={next:{configurable:!0}};x0.next.get=function(){return this.tokens[this.pos]};Oh.prototype.eat=function(r){return this.next==r&&(this.pos++||!0)};Oh.prototype.err=function(r){throw new SyntaxError(r+" (in content expression '"+this.string+"')")};Object.defineProperties(Oh.prototype,x0);function U0(i){var r=[];do r.push(_k(i));while(i.eat("|"));return r.length==1?r[0]:{type:"choice",exprs:r}}function _k(i){var r=[];do r.push(yk(i));while(i.next&&i.next!=")"&&i.next!="|");return r.length==1?r[0]:{type:"seq",exprs:r}}function yk(i){for(var r=Rk(i);;)if(i.eat("+"))r={type:"plus",expr:r};else if(i.eat("*"))r={type:"star",expr:r};else if(i.eat("?"))r={type:"opt",expr:r};else if(i.eat("{"))r=Sk(i,r);else break;return r}function ny(i){/\D/.test(i.next)&&i.err("Expected number, got '"+i.next+"'");var r=Number(i.next);return i.pos++,r}function Sk(i,r){var s=ny(i),a=s;return i.eat(",")&&(i.next!="}"?a=ny(i):a=-1),i.eat("}")||i.err("Unclosed braced range"),{type:"range",min:s,max:a,expr:r}}function Tk(i,r){var s=i.nodeTypes,a=s[r];if(a)return[a];var l=[];for(var h in s){var A=s[h];A.groups.indexOf(r)>-1&&l.push(A)}return l.length==0&&i.err("No node type or group '"+r+"' found"),l}function Rk(i){if(i.eat("(")){var r=U0(i);return i.eat(")")||i.err("Missing closing paren"),r}else if(/\W/.test(i.next))i.err("Unexpected token '"+i.next+"'");else{var s=Tk(i,i.next).map(function(a){return i.inline==null?i.inline=a.isInline:i.inline!=a.isInline&&i.err("Mixing inline and block content"),{type:"name",value:a}});return i.pos++,s.length==1?s[0]:{type:"choice",exprs:s}}}function wk(i){var r=[[]];return l(h(i,0),s()),r;function s(){return r.push([])-1}function a(A,m,v){var C={term:v,to:m};return r[A].push(C),C}function l(A,m){A.forEach(function(v){return v.to=m})}function h(A,m){if(A.type=="choice")return A.exprs.reduce(function(X,K){return X.concat(h(K,m))},[]);if(A.type=="seq")for(var v=0;;v++){var C=h(A.exprs[v],m);if(v==A.exprs.length-1)return C;l(C,m=s())}else if(A.type=="star"){var S=s();return a(m,S),l(h(A.expr,S),S),[a(S)]}else if(A.type=="plus"){var b=s();return l(h(A.expr,m),b),l(h(A.expr,b),b),[a(b)]}else{if(A.type=="opt")return[a(m)].concat(h(A.expr,m));if(A.type=="range"){for(var O=m,P=0;P<A.min;P++){var F=s();l(h(A.expr,O),F),O=F}if(A.max==-1)l(h(A.expr,O),O);else for(var W=A.min;W<A.max;W++){var $=s();a(O,$),l(h(A.expr,O),$),O=$}return[a(O)]}else if(A.type=="name")return[a(m,null,A.value)]}}}function Q0(i,r){return r-i}function iy(i,r){var s=[];return a(r),s.sort(Q0);function a(l){var h=i[l];if(h.length==1&&!h[0].term)return a(h[0].to);s.push(l);for(var A=0;A<h.length;A++){var m=h[A],v=m.term,C=m.to;!v&&s.indexOf(C)==-1&&a(C)}}}function bk(i){var r=Object.create(null);return s(iy(i,0));function s(a){var l=[];a.forEach(function(v){i[v].forEach(function(C){var S=C.term,b=C.to;if(!!S){var O=l.indexOf(S),P=O>-1&&l[O+1];iy(i,b).forEach(function(F){P||l.push(S,P=[]),P.indexOf(F)==-1&&P.push(F)})}})});for(var h=r[a.join(",")]=new $n(a.indexOf(i.length-1)>-1),A=0;A<l.length;A+=2){var m=l[A+1].sort(Q0);h.next.push(l[A],r[m.join(",")]||s(m))}return h}}function Nk(i,r){for(var s=0,a=[i];s<a.length;s++){for(var l=a[s],h=!l.validEnd,A=[],m=0;m<l.next.length;m+=2){var v=l.next[m],C=l.next[m+1];A.push(v.name),h&&!(v.isText||v.hasRequiredAttrs())&&(h=!1),a.indexOf(C)==-1&&a.push(C)}h&&r.err("Only non-generatable nodes ("+A.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function F0(i){var r=Object.create(null);for(var s in i){var a=i[s];if(!a.hasDefault)return null;r[s]=a.default}return r}function V0(i,r){var s=Object.create(null);for(var a in i){var l=r&&r[a];if(l===void 0){var h=i[a];if(h.hasDefault)l=h.default;else throw new RangeError("No value supplied for attribute "+a)}s[a]=l}return s}function G0(i){var r=Object.create(null);if(i)for(var s in i)r[s]=new j0(i[s]);return r}var fi=function(r,s,a){this.name=r,this.schema=s,this.spec=a,this.groups=a.group?a.group.split(" "):[],this.attrs=G0(a.attrs),this.defaultAttrs=F0(this.attrs),this.contentMatch=null,this.markSet=null,this.inlineContent=null,this.isBlock=!(a.inline||r=="text"),this.isText=r=="text"},zc={isInline:{configurable:!0},isTextblock:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0},whitespace:{configurable:!0}};zc.isInline.get=function(){return!this.isBlock};zc.isTextblock.get=function(){return this.isBlock&&this.inlineContent};zc.isLeaf.get=function(){return this.contentMatch==$n.empty};zc.isAtom.get=function(){return this.isLeaf||this.spec.atom};zc.whitespace.get=function(){return this.spec.whitespace||(this.spec.code?"pre":"normal")};fi.prototype.hasRequiredAttrs=function(){for(var r in this.attrs)if(this.attrs[r].isRequired)return!0;return!1};fi.prototype.compatibleContent=function(r){return this==r||this.contentMatch.compatible(r.contentMatch)};fi.prototype.computeAttrs=function(r){return!r&&this.defaultAttrs?this.defaultAttrs:V0(this.attrs,r)};fi.prototype.create=function(r,s,a){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Ye(this,this.computeAttrs(r),Et.from(s),Ge.setFrom(a))};fi.prototype.createChecked=function(r,s,a){if(s=Et.from(s),!this.validContent(s))throw new RangeError("Invalid content for node "+this.name);return new Ye(this,this.computeAttrs(r),s,Ge.setFrom(a))};fi.prototype.createAndFill=function(r,s,a){if(r=this.computeAttrs(r),s=Et.from(s),s.size){var l=this.contentMatch.fillBefore(s);if(!l)return null;s=l.append(s)}var h=this.contentMatch.matchFragment(s).fillBefore(Et.empty,!0);return h?new Ye(this,r,s.append(h),Ge.setFrom(a)):null};fi.prototype.validContent=function(r){var s=this.contentMatch.matchFragment(r);if(!s||!s.validEnd)return!1;for(var a=0;a<r.childCount;a++)if(!this.allowsMarks(r.child(a).marks))return!1;return!0};fi.prototype.allowsMarkType=function(r){return this.markSet==null||this.markSet.indexOf(r)>-1};fi.prototype.allowsMarks=function(r){if(this.markSet==null)return!0;for(var s=0;s<r.length;s++)if(!this.allowsMarkType(r[s].type))return!1;return!0};fi.prototype.allowedMarks=function(r){if(this.markSet==null)return r;for(var s,a=0;a<r.length;a++)this.allowsMarkType(r[a].type)?s&&s.push(r[a]):s||(s=r.slice(0,a));return s?s.length?s:Ge.empty:r};fi.compile=function(r,s){var a=Object.create(null);r.forEach(function(A,m){return a[A]=new fi(A,s,m)});var l=s.spec.topNode||"doc";if(!a[l])throw new RangeError("Schema is missing its top node type ('"+l+"')");if(!a.text)throw new RangeError("Every schema needs a 'text' type");for(var h in a.text.attrs)throw new RangeError("The text node type should not have attributes");return a};Object.defineProperties(fi.prototype,zc);var j0=function(r){this.hasDefault=Object.prototype.hasOwnProperty.call(r,"default"),this.default=r.default},K0={isRequired:{configurable:!0}};K0.isRequired.get=function(){return!this.hasDefault};Object.defineProperties(j0.prototype,K0);var ra=function(r,s,a,l){this.name=r,this.schema=a,this.spec=l,this.attrs=G0(l.attrs),this.rank=s,this.excluded=null;var h=F0(this.attrs);this.instance=h&&new Ge(this,h)};ra.prototype.create=function(r){return!r&&this.instance?this.instance:new Ge(this,V0(this.attrs,r))};ra.compile=function(r,s){var a=Object.create(null),l=0;return r.forEach(function(h,A){return a[h]=new ra(h,l++,s,A)}),a};ra.prototype.removeFromSet=function(r){for(var s=0;s<r.length;s++)r[s].type==this&&(r=r.slice(0,s).concat(r.slice(s+1)),s--);return r};ra.prototype.isInSet=function(r){for(var s=0;s<r.length;s++)if(r[s].type==this)return r[s]};ra.prototype.excludes=function(r){return this.excluded.indexOf(r)>-1};var Ka=function(r){this.spec={};for(var s in r)this.spec[s]=r[s];this.spec.nodes=ry.from(r.nodes),this.spec.marks=ry.from(r.marks),this.nodes=fi.compile(this.spec.nodes,this),this.marks=ra.compile(this.spec.marks,this);var a=Object.create(null);for(var l in this.nodes){if(l in this.marks)throw new RangeError(l+" can not be both a node and a mark");var h=this.nodes[l],A=h.spec.content||"",m=h.spec.marks;h.contentMatch=a[A]||(a[A]=$n.parse(A,this.nodes)),h.inlineContent=h.contentMatch.inlineContent,h.markSet=m=="_"?null:m?oy(this,m.split(" ")):m==""||!h.inlineContent?[]:null}for(var v in this.marks){var C=this.marks[v],S=C.spec.excludes;C.excluded=S==null?[C]:S==""?[]:oy(this,S.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached=Object.create(null),this.cached.wrappings=Object.create(null)};Ka.prototype.node=function(r,s,a,l){if(typeof r=="string")r=this.nodeType(r);else if(r instanceof fi){if(r.schema!=this)throw new RangeError("Node type from different schema used ("+r.name+")")}else throw new RangeError("Invalid node type: "+r);return r.createChecked(s,a,l)};Ka.prototype.text=function(r,s){var a=this.nodes.text;return new Ck(a,a.defaultAttrs,r,Ge.setFrom(s))};Ka.prototype.mark=function(r,s){return typeof r=="string"&&(r=this.marks[r]),r.create(s)};Ka.prototype.nodeFromJSON=function(r){return Ye.fromJSON(this,r)};Ka.prototype.markFromJSON=function(r){return Ge.fromJSON(this,r)};Ka.prototype.nodeType=function(r){var s=this.nodes[r];if(!s)throw new RangeError("Unknown node type: "+r);return s};function oy(i,r){for(var s=[],a=0;a<r.length;a++){var l=r[a],h=i.marks[l],A=h;if(h)s.push(h);else for(var m in i.marks){var v=i.marks[m];(l=="_"||v.spec.group&&v.spec.group.split(" ").indexOf(l)>-1)&&s.push(A=v)}if(!A)throw new SyntaxError("Unknown mark type: '"+r[a]+"'")}return s}var Oo=function(r,s){var a=this;this.schema=r,this.rules=s,this.tags=[],this.styles=[],s.forEach(function(l){l.tag?a.tags.push(l):l.style&&a.styles.push(l)}),this.normalizeLists=!this.tags.some(function(l){if(!/^(ul|ol)\b/.test(l.tag)||!l.node)return!1;var h=r.nodes[l.node];return h.contentMatch.matchType(h)})};Oo.prototype.parse=function(r,s){s===void 0&&(s={});var a=new Er(this,s,!1);return a.addAll(r,null,s.from,s.to),a.finish()};Oo.prototype.parseSlice=function(r,s){s===void 0&&(s={});var a=new Er(this,s,!0);return a.addAll(r,null,s.from,s.to),Pt.maxOpen(a.finish())};Oo.prototype.matchTag=function(r,s,a){for(var l=a?this.tags.indexOf(a)+1:0;l<this.tags.length;l++){var h=this.tags[l];if(Dk(r,h.tag)&&(h.namespace===void 0||r.namespaceURI==h.namespace)&&(!h.context||s.matchesContext(h.context))){if(h.getAttrs){var A=h.getAttrs(r);if(A===!1)continue;h.attrs=A}return h}}};Oo.prototype.matchStyle=function(r,s,a,l){for(var h=l?this.styles.indexOf(l)+1:0;h<this.styles.length;h++){var A=this.styles[h];if(!(A.style.indexOf(r)!=0||A.context&&!a.matchesContext(A.context)||A.style.length>r.length&&(A.style.charCodeAt(r.length)!=61||A.style.slice(r.length+1)!=s))){if(A.getAttrs){var m=A.getAttrs(s);if(m===!1)continue;A.attrs=m}return A}}};Oo.schemaRules=function(r){var s=[];function a(v){for(var C=v.priority==null?50:v.priority,S=0;S<s.length;S++){var b=s[S],O=b.priority==null?50:b.priority;if(O<C)break}s.splice(S,0,v)}var l=function(v){var C=r.marks[v].spec.parseDOM;C&&C.forEach(function(S){a(S=sy(S)),S.mark=v})};for(var h in r.marks)l(h);var A=function(v){var C=r.nodes[m].spec.parseDOM;C&&C.forEach(function(S){a(S=sy(S)),S.node=m})};for(var m in r.nodes)A();return s};Oo.fromSchema=function(r){return r.cached.domParser||(r.cached.domParser=new Oo(r,Oo.schemaRules(r)))};var Gg={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},Ok={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},H0={ol:!0,ul:!0},dh=1,hh=2,iu=4;function W0(i,r,s){return r!=null?(r?dh:0)|(r==="full"?hh:0):i&&i.whitespace=="pre"?dh|hh:s&~iu}var Rs=function(r,s,a,l,h,A,m){this.type=r,this.attrs=s,this.solid=h,this.match=A||(m&iu?null:r.contentMatch),this.options=m,this.content=[],this.marks=a,this.activeMarks=Ge.none,this.pendingMarks=l,this.stashMarks=[]};Rs.prototype.findWrapping=function(r){if(!this.match){if(!this.type)return[];var s=this.type.contentMatch.fillBefore(Et.from(r));if(s)this.match=this.type.contentMatch.matchFragment(s);else{var a=this.type.contentMatch,l;return(l=a.findWrapping(r.type))?(this.match=a,l):null}}return this.match.findWrapping(r.type)};Rs.prototype.finish=function(r){if(!(this.options&dh)){var s=this.content[this.content.length-1],a;s&&s.isText&&(a=/[ \t\r\n\u000c]+$/.exec(s.text))&&(s.text.length==a[0].length?this.content.pop():this.content[this.content.length-1]=s.withText(s.text.slice(0,s.text.length-a[0].length)))}var l=Et.from(this.content);return!r&&this.match&&(l=l.append(this.match.fillBefore(Et.empty,!0))),this.type?this.type.create(this.attrs,l,this.marks):l};Rs.prototype.popFromStashMark=function(r){for(var s=this.stashMarks.length-1;s>=0;s--)if(r.eq(this.stashMarks[s]))return this.stashMarks.splice(s,1)[0]};Rs.prototype.applyPending=function(r){for(var s=0,a=this.pendingMarks;s<a.length;s++){var l=a[s];(this.type?this.type.allowsMarkType(l.type):Lk(l.type,r))&&!l.isInSet(this.activeMarks)&&(this.activeMarks=l.addToSet(this.activeMarks),this.pendingMarks=l.removeFromSet(this.pendingMarks))}};Rs.prototype.inlineContext=function(r){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:r.parentNode&&!Gg.hasOwnProperty(r.parentNode.nodeName.toLowerCase())};var Er=function(r,s,a){this.parser=r,this.options=s,this.isOpen=a;var l=s.topNode,h,A=W0(null,s.preserveWhitespace,0)|(a?iu:0);l?h=new Rs(l.type,l.attrs,Ge.none,Ge.none,!0,s.topMatch||l.type.contentMatch,A):a?h=new Rs(null,null,Ge.none,Ge.none,!0,null,A):h=new Rs(r.schema.topNodeType,null,Ge.none,Ge.none,!0,null,A),this.nodes=[h],this.open=0,this.find=s.findPositions,this.needsBlock=!1},jg={top:{configurable:!0},currentPos:{configurable:!0}};jg.top.get=function(){return this.nodes[this.open]};Er.prototype.addDOM=function(r){if(r.nodeType==3)this.addTextNode(r);else if(r.nodeType==1){var s=r.getAttribute("style"),a=s?this.readStyles(Bk(s)):null,l=this.top;if(a!=null)for(var h=0;h<a.length;h++)this.addPendingMark(a[h]);if(this.addElement(r),a!=null)for(var A=0;A<a.length;A++)this.removePendingMark(a[A],l)}};Er.prototype.addTextNode=function(r){var s=r.nodeValue,a=this.top;if(a.options&hh||a.inlineContext(r)||/[^ \t\r\n\u000c]/.test(s)){if(a.options&dh)a.options&hh?s=s.replace(/\r\n?/g,`
`):s=s.replace(/\r?\n|\r/g," ");else if(s=s.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(s)&&this.open==this.nodes.length-1){var l=a.content[a.content.length-1],h=r.previousSibling;(!l||h&&h.nodeName=="BR"||l.isText&&/[ \t\r\n\u000c]$/.test(l.text))&&(s=s.slice(1))}s&&this.insertNode(this.parser.schema.text(s)),this.findInText(r)}else this.findInside(r)};Er.prototype.addElement=function(r,s){var a=r.nodeName.toLowerCase(),l;H0.hasOwnProperty(a)&&this.parser.normalizeLists&&kk(r);var h=this.options.ruleFromNode&&this.options.ruleFromNode(r)||(l=this.parser.matchTag(r,this,s));if(h?h.ignore:Ok.hasOwnProperty(a))this.findInside(r),this.ignoreFallback(r);else if(!h||h.skip||h.closeParent){h&&h.closeParent?this.open=Math.max(0,this.open-1):h&&h.skip.nodeType&&(r=h.skip);var A,m=this.top,v=this.needsBlock;if(Gg.hasOwnProperty(a))A=!0,m.type||(this.needsBlock=!0);else if(!r.firstChild){this.leafFallback(r);return}this.addAll(r),A&&this.sync(m),this.needsBlock=v}else this.addElementByRule(r,h,h.consuming===!1?l:null)};Er.prototype.leafFallback=function(r){r.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(r.ownerDocument.createTextNode(`
`))};Er.prototype.ignoreFallback=function(r){r.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"))};Er.prototype.readStyles=function(r){var s=Ge.none;t:for(var a=0;a<r.length;a+=2)for(var l=null;;){var h=this.parser.matchStyle(r[a],r[a+1],this,l);if(!h)continue t;if(h.ignore)return null;if(s=this.parser.schema.marks[h.mark].create(h.attrs).addToSet(s),h.consuming===!1)l=h;else break}return s};Er.prototype.addElementByRule=function(r,s,a){var l=this,h,A,m,v;s.node?(A=this.parser.schema.nodes[s.node],A.isLeaf?this.insertNode(A.create(s.attrs))||this.leafFallback(r):h=this.enter(A,s.attrs,s.preserveWhitespace)):(m=this.parser.schema.marks[s.mark],v=m.create(s.attrs),this.addPendingMark(v));var C=this.top;if(A&&A.isLeaf)this.findInside(r);else if(a)this.addElement(r,a);else if(s.getContent)this.findInside(r),s.getContent(r,this.parser.schema).forEach(function(b){return l.insertNode(b)});else{var S=s.contentElement;typeof S=="string"?S=r.querySelector(S):typeof S=="function"&&(S=S(r)),S||(S=r),this.findAround(r,S,!0),this.addAll(S,h)}h&&(this.sync(C),this.open--),v&&this.removePendingMark(v,C)};Er.prototype.addAll=function(r,s,a,l){for(var h=a||0,A=a?r.childNodes[a]:r.firstChild,m=l==null?null:r.childNodes[l];A!=m;A=A.nextSibling,++h)this.findAtPoint(r,h),this.addDOM(A),s&&Gg.hasOwnProperty(A.nodeName.toLowerCase())&&this.sync(s);this.findAtPoint(r,h)};Er.prototype.findPlace=function(r){for(var s,a,l=this.open;l>=0;l--){var h=this.nodes[l],A=h.findWrapping(r);if(A&&(!s||s.length>A.length)&&(s=A,a=h,!A.length)||h.solid)break}if(!s)return!1;this.sync(a);for(var m=0;m<s.length;m++)this.enterInner(s[m],null,!1);return!0};Er.prototype.insertNode=function(r){if(r.isInline&&this.needsBlock&&!this.top.type){var s=this.textblockFromContext();s&&this.enterInner(s)}if(this.findPlace(r)){this.closeExtra();var a=this.top;a.applyPending(r.type),a.match&&(a.match=a.match.matchType(r.type));for(var l=a.activeMarks,h=0;h<r.marks.length;h++)(!a.type||a.type.allowsMarkType(r.marks[h].type))&&(l=r.marks[h].addToSet(l));return a.content.push(r.mark(l)),!0}return!1};Er.prototype.enter=function(r,s,a){var l=this.findPlace(r.create(s));return l&&this.enterInner(r,s,!0,a),l};Er.prototype.enterInner=function(r,s,a,l){this.closeExtra();var h=this.top;h.applyPending(r),h.match=h.match&&h.match.matchType(r,s);var A=W0(r,l,h.options);h.options&iu&&h.content.length==0&&(A|=iu),this.nodes.push(new Rs(r,s,h.activeMarks,h.pendingMarks,a,null,A)),this.open++};Er.prototype.closeExtra=function(r){var s=this.nodes.length-1;if(s>this.open){for(;s>this.open;s--)this.nodes[s-1].content.push(this.nodes[s].finish(r));this.nodes.length=this.open+1}};Er.prototype.finish=function(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)};Er.prototype.sync=function(r){for(var s=this.open;s>=0;s--)if(this.nodes[s]==r){this.open=s;return}};jg.currentPos.get=function(){this.closeExtra();for(var i=0,r=this.open;r>=0;r--){for(var s=this.nodes[r].content,a=s.length-1;a>=0;a--)i+=s[a].nodeSize;r&&i++}return i};Er.prototype.findAtPoint=function(r,s){if(this.find)for(var a=0;a<this.find.length;a++)this.find[a].node==r&&this.find[a].offset==s&&(this.find[a].pos=this.currentPos)};Er.prototype.findInside=function(r){if(this.find)for(var s=0;s<this.find.length;s++)this.find[s].pos==null&&r.nodeType==1&&r.contains(this.find[s].node)&&(this.find[s].pos=this.currentPos)};Er.prototype.findAround=function(r,s,a){if(r!=s&&this.find){for(var l=0;l<this.find.length;l++)if(this.find[l].pos==null&&r.nodeType==1&&r.contains(this.find[l].node)){var h=s.compareDocumentPosition(this.find[l].node);h&(a?2:4)&&(this.find[l].pos=this.currentPos)}}};Er.prototype.findInText=function(r){if(this.find)for(var s=0;s<this.find.length;s++)this.find[s].node==r&&(this.find[s].pos=this.currentPos-(r.nodeValue.length-this.find[s].offset))};Er.prototype.matchesContext=function(r){var s=this;if(r.indexOf("|")>-1)return r.split(/\s*\|\s*/).some(this.matchesContext,this);var a=r.split("/"),l=this.options.context,h=!this.isOpen&&(!l||l.parent.type==this.nodes[0].type),A=-(l?l.depth+1:0)+(h?0:1),m=function(v,C){for(;v>=0;v--){var S=a[v];if(S==""){if(v==a.length-1||v==0)continue;for(;C>=A;C--)if(m(v-1,C))return!0;return!1}else{var b=C>0||C==0&&h?s.nodes[C].type:l&&C>=A?l.node(C-A).type:null;if(!b||b.name!=S&&b.groups.indexOf(S)==-1)return!1;C--}}return!0};return m(a.length-1,this.open)};Er.prototype.textblockFromContext=function(){var r=this.options.context;if(r)for(var s=r.depth;s>=0;s--){var a=r.node(s).contentMatchAt(r.indexAfter(s)).defaultType;if(a&&a.isTextblock&&a.defaultAttrs)return a}for(var l in this.parser.schema.nodes){var h=this.parser.schema.nodes[l];if(h.isTextblock&&h.defaultAttrs)return h}};Er.prototype.addPendingMark=function(r){var s=Mk(r,this.top.pendingMarks);s&&this.top.stashMarks.push(s),this.top.pendingMarks=r.addToSet(this.top.pendingMarks)};Er.prototype.removePendingMark=function(r,s){for(var a=this.open;a>=0;a--){var l=this.nodes[a],h=l.pendingMarks.lastIndexOf(r);if(h>-1)l.pendingMarks=r.removeFromSet(l.pendingMarks);else{l.activeMarks=r.removeFromSet(l.activeMarks);var A=l.popFromStashMark(r);A&&l.type&&l.type.allowsMarkType(A.type)&&(l.activeMarks=A.addToSet(l.activeMarks))}if(l==s)break}};Object.defineProperties(Er.prototype,jg);function kk(i){for(var r=i.firstChild,s=null;r;r=r.nextSibling){var a=r.nodeType==1?r.nodeName.toLowerCase():null;a&&H0.hasOwnProperty(a)&&s?(s.appendChild(r),r=s):a=="li"?s=r:a&&(s=null)}}function Dk(i,r){return(i.matches||i.msMatchesSelector||i.webkitMatchesSelector||i.mozMatchesSelector).call(i,r)}function Bk(i){for(var r=/\s*([\w-]+)\s*:\s*([^;]+)/g,s,a=[];s=r.exec(i);)a.push(s[1],s[2].trim());return a}function sy(i){var r={};for(var s in i)r[s]=i[s];return r}function Lk(i,r){var s=r.schema.nodes,a=function(A){var m=s[A];if(!!m.allowsMarkType(i)){var v=[],C=function(S){v.push(S);for(var b=0;b<S.edgeCount;b++){var O=S.edge(b),P=O.type,F=O.next;if(P==r||v.indexOf(F)<0&&C(F))return!0}};if(C(m.contentMatch))return{v:!0}}};for(var l in s){var h=a(l);if(h)return h.v}}function Mk(i,r){for(var s=0;s<r.length;s++)if(i.eq(r[s]))return r[s]}var Vn=function(r,s){this.nodes=r||{},this.marks=s||{}};Vn.prototype.serializeFragment=function(r,s,a){var l=this;s===void 0&&(s={}),a||(a=Kg(s).createDocumentFragment());var h=a,A=null;return r.forEach(function(m){if(A||m.marks.length){A||(A=[]);for(var v=0,C=0;v<A.length&&C<m.marks.length;){var S=m.marks[C];if(!l.marks[S.type.name]){C++;continue}if(!S.eq(A[v])||S.type.spec.spanning===!1)break;v+=2,C++}for(;v<A.length;)h=A.pop(),A.pop();for(;C<m.marks.length;){var b=m.marks[C++],O=l.serializeMark(b,m.isInline,s);O&&(A.push(b,h),h.appendChild(O.dom),h=O.contentDOM||O.dom)}}h.appendChild(l.serializeNodeInner(m,s))}),a};Vn.prototype.serializeNodeInner=function(r,s){s===void 0&&(s={});var a=Vn.renderSpec(Kg(s),this.nodes[r.type.name](r)),l=a.dom,h=a.contentDOM;if(h){if(r.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");s.onContent?s.onContent(r,h,s):this.serializeFragment(r.content,s,h)}return l};Vn.prototype.serializeNode=function(r,s){s===void 0&&(s={});for(var a=this.serializeNodeInner(r,s),l=r.marks.length-1;l>=0;l--){var h=this.serializeMark(r.marks[l],r.isInline,s);h&&((h.contentDOM||h.dom).appendChild(a),a=h.dom)}return a};Vn.prototype.serializeMark=function(r,s,a){a===void 0&&(a={});var l=this.marks[r.type.name];return l&&Vn.renderSpec(Kg(a),l(r,s))};Vn.renderSpec=function(r,s,a){if(a===void 0&&(a=null),typeof s=="string")return{dom:r.createTextNode(s)};if(s.nodeType!=null)return{dom:s};if(s.dom&&s.dom.nodeType!=null)return s;var l=s[0],h=l.indexOf(" ");h>0&&(a=l.slice(0,h),l=l.slice(h+1));var A=null,m=a?r.createElementNS(a,l):r.createElement(l),v=s[1],C=1;if(v&&typeof v=="object"&&v.nodeType==null&&!Array.isArray(v)){C=2;for(var S in v)if(v[S]!=null){var b=S.indexOf(" ");b>0?m.setAttributeNS(S.slice(0,b),S.slice(b+1),v[S]):m.setAttribute(S,v[S])}}for(var O=C;O<s.length;O++){var P=s[O];if(P===0){if(O<s.length-1||O>C)throw new RangeError("Content hole must be the only child of its parent node");return{dom:m,contentDOM:m}}else{var F=Vn.renderSpec(r,P,a),W=F.dom,$=F.contentDOM;if(m.appendChild(W),$){if(A)throw new RangeError("Multiple content holes");A=$}}}return{dom:m,contentDOM:A}};Vn.fromSchema=function(r){return r.cached.domSerializer||(r.cached.domSerializer=new Vn(this.nodesFromSchema(r),this.marksFromSchema(r)))};Vn.nodesFromSchema=function(r){var s=Y0(r.nodes);return s.text||(s.text=function(a){return a.text}),s};Vn.marksFromSchema=function(r){return Y0(r.marks)};function Y0(i){var r={};for(var s in i){var a=i[s].spec.toDOM;a&&(r[s]=a)}return r}function Kg(i){return i.document||window.document}var q0=65535,J0=Math.pow(2,16);function Pk(i,r){return i+r*J0}function z0(i){return i&q0}function xk(i){return(i-(i&q0))/J0}var mg=function(r,s,a){s===void 0&&(s=!1),a===void 0&&(a=null),this.pos=r,this.deleted=s,this.recover=a},Qn=function i(r,s){if(s===void 0&&(s=!1),!r.length&&i.empty)return i.empty;this.ranges=r,this.inverted=s};Qn.prototype.recover=function(r){var s=0,a=z0(r);if(!this.inverted)for(var l=0;l<a;l++)s+=this.ranges[l*3+2]-this.ranges[l*3+1];return this.ranges[a*3]+s+xk(r)};Qn.prototype.mapResult=function(r,s){return s===void 0&&(s=1),this._map(r,s,!1)};Qn.prototype.map=function(r,s){return s===void 0&&(s=1),this._map(r,s,!0)};Qn.prototype._map=function(r,s,a){for(var l=0,h=this.inverted?2:1,A=this.inverted?1:2,m=0;m<this.ranges.length;m+=3){var v=this.ranges[m]-(this.inverted?l:0);if(v>r)break;var C=this.ranges[m+h],S=this.ranges[m+A],b=v+C;if(r<=b){var O=C?r==v?-1:r==b?1:s:s,P=v+l+(O<0?0:S);if(a)return P;var F=r==(s<0?v:b)?null:Pk(m/3,r-v);return new mg(P,s<0?r!=v:r!=b,F)}l+=S-C}return a?r+l:new mg(r+l)};Qn.prototype.touches=function(r,s){for(var a=0,l=z0(s),h=this.inverted?2:1,A=this.inverted?1:2,m=0;m<this.ranges.length;m+=3){var v=this.ranges[m]-(this.inverted?a:0);if(v>r)break;var C=this.ranges[m+h],S=v+C;if(r<=S&&m==l*3)return!0;a+=this.ranges[m+A]-C}return!1};Qn.prototype.forEach=function(r){for(var s=this.inverted?2:1,a=this.inverted?1:2,l=0,h=0;l<this.ranges.length;l+=3){var A=this.ranges[l],m=A-(this.inverted?h:0),v=A+(this.inverted?0:h),C=this.ranges[l+s],S=this.ranges[l+a];r(m,m+C,v,v+S),h+=S-C}};Qn.prototype.invert=function(){return new Qn(this.ranges,!this.inverted)};Qn.prototype.toString=function(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)};Qn.offset=function(r){return r==0?Qn.empty:new Qn(r<0?[0,-r,0]:[0,0,r])};Qn.empty=new Qn([]);var ti=function(r,s,a,l){this.maps=r||[],this.from=a||0,this.to=l==null?this.maps.length:l,this.mirror=s};ti.prototype.slice=function(r,s){return r===void 0&&(r=0),s===void 0&&(s=this.maps.length),new ti(this.maps,this.mirror,r,s)};ti.prototype.copy=function(){return new ti(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)};ti.prototype.appendMap=function(r,s){this.to=this.maps.push(r),s!=null&&this.setMirror(this.maps.length-1,s)};ti.prototype.appendMapping=function(r){for(var s=0,a=this.maps.length;s<r.maps.length;s++){var l=r.getMirror(s);this.appendMap(r.maps[s],l!=null&&l<s?a+l:null)}};ti.prototype.getMirror=function(r){if(this.mirror){for(var s=0;s<this.mirror.length;s++)if(this.mirror[s]==r)return this.mirror[s+(s%2?-1:1)]}};ti.prototype.setMirror=function(r,s){this.mirror||(this.mirror=[]),this.mirror.push(r,s)};ti.prototype.appendMappingInverted=function(r){for(var s=r.maps.length-1,a=this.maps.length+r.maps.length;s>=0;s--){var l=r.getMirror(s);this.appendMap(r.maps[s].invert(),l!=null&&l>s?a-l-1:null)}};ti.prototype.invert=function(){var r=new ti;return r.appendMappingInverted(this),r};ti.prototype.map=function(r,s){if(s===void 0&&(s=1),this.mirror)return this._map(r,s,!0);for(var a=this.from;a<this.to;a++)r=this.maps[a].map(r,s);return r};ti.prototype.mapResult=function(r,s){return s===void 0&&(s=1),this._map(r,s,!1)};ti.prototype._map=function(r,s,a){for(var l=!1,h=this.from;h<this.to;h++){var A=this.maps[h],m=A.mapResult(r,s);if(m.recover!=null){var v=this.getMirror(h);if(v!=null&&v>h&&v<this.to){h=v,r=this.maps[v].recover(m.recover);continue}}m.deleted&&(l=!0),r=m.pos}return a?r:new mg(r,l)};function Qc(i){var r=Error.call(this,i);return r.__proto__=Qc.prototype,r}Qc.prototype=Object.create(Error.prototype);Qc.prototype.constructor=Qc;Qc.prototype.name="TransformError";var Jr=function(r){this.doc=r,this.steps=[],this.docs=[],this.mapping=new ti},Hg={before:{configurable:!0},docChanged:{configurable:!0}};Hg.before.get=function(){return this.docs.length?this.docs[0]:this.doc};Jr.prototype.step=function(r){var s=this.maybeStep(r);if(s.failed)throw new Qc(s.failed);return this};Jr.prototype.maybeStep=function(r){var s=r.apply(this.doc);return s.failed||this.addStep(r,s.doc),s};Hg.docChanged.get=function(){return this.steps.length>0};Jr.prototype.addStep=function(r,s){this.docs.push(this.doc),this.steps.push(r),this.mapping.appendMap(r.getMap()),this.doc=s};Object.defineProperties(Jr.prototype,Hg);function kh(){throw new Error("Override me")}var Eg=Object.create(null),ni=function(){};ni.prototype.apply=function(r){return kh()};ni.prototype.getMap=function(){return Qn.empty};ni.prototype.invert=function(r){return kh()};ni.prototype.map=function(r){return kh()};ni.prototype.merge=function(r){return null};ni.prototype.toJSON=function(){return kh()};ni.fromJSON=function(r,s){if(!s||!s.stepType)throw new RangeError("Invalid input for Step.fromJSON");var a=Eg[s.stepType];if(!a)throw new RangeError("No step type "+s.stepType+" defined");return a.fromJSON(r,s)};ni.jsonID=function(r,s){if(r in Eg)throw new RangeError("Duplicate use of step JSON ID "+r);return Eg[r]=s,s.prototype.jsonID=r,s};var Ai=function(r,s){this.doc=r,this.failed=s};Ai.ok=function(r){return new Ai(r,null)};Ai.fail=function(r){return new Ai(null,r)};Ai.fromReplace=function(r,s,a,l){try{return Ai.ok(r.replace(s,a,l))}catch(h){if(h instanceof Yo)return Ai.fail(h.message);throw h}};var Os=function(i){function r(s,a,l,h){i.call(this),this.from=s,this.to=a,this.slice=l,this.structure=!!h}return i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r,r.prototype.apply=function(a){return this.structure&&vg(a,this.from,this.to)?Ai.fail("Structure replace would overwrite content"):Ai.fromReplace(a,this.from,this.to,this.slice)},r.prototype.getMap=function(){return new Qn([this.from,this.to-this.from,this.slice.size])},r.prototype.invert=function(a){return new r(this.from,this.from+this.slice.size,a.slice(this.from,this.to))},r.prototype.map=function(a){var l=a.mapResult(this.from,1),h=a.mapResult(this.to,-1);return l.deleted&&h.deleted?null:new r(l.pos,Math.max(l.pos,h.pos),this.slice)},r.prototype.merge=function(a){if(!(a instanceof r)||a.structure||this.structure)return null;if(this.from+this.slice.size==a.from&&!this.slice.openEnd&&!a.slice.openStart){var l=this.slice.size+a.slice.size==0?Pt.empty:new Pt(this.slice.content.append(a.slice.content),this.slice.openStart,a.slice.openEnd);return new r(this.from,this.to+(a.to-a.from),l,this.structure)}else if(a.to==this.from&&!this.slice.openStart&&!a.slice.openEnd){var h=this.slice.size+a.slice.size==0?Pt.empty:new Pt(a.slice.content.append(this.slice.content),a.slice.openStart,this.slice.openEnd);return new r(a.from,this.to,h,this.structure)}else return null},r.prototype.toJSON=function(){var a={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(a.slice=this.slice.toJSON()),this.structure&&(a.structure=!0),a},r.fromJSON=function(a,l){if(typeof l.from!="number"||typeof l.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new r(l.from,l.to,Pt.fromJSON(a,l.slice),!!l.structure)},r}(ni);ni.jsonID("replace",Os);var Ni=function(i){function r(s,a,l,h,A,m,v){i.call(this),this.from=s,this.to=a,this.gapFrom=l,this.gapTo=h,this.slice=A,this.insert=m,this.structure=!!v}return i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r,r.prototype.apply=function(a){if(this.structure&&(vg(a,this.from,this.gapFrom)||vg(a,this.gapTo,this.to)))return Ai.fail("Structure gap-replace would overwrite content");var l=a.slice(this.gapFrom,this.gapTo);if(l.openStart||l.openEnd)return Ai.fail("Gap is not a flat range");var h=this.slice.insertAt(this.insert,l.content);return h?Ai.fromReplace(a,this.from,this.to,h):Ai.fail("Content does not fit in gap")},r.prototype.getMap=function(){return new Qn([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])},r.prototype.invert=function(a){var l=this.gapTo-this.gapFrom;return new r(this.from,this.from+this.slice.size+l,this.from+this.insert,this.from+this.insert+l,a.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)},r.prototype.map=function(a){var l=a.mapResult(this.from,1),h=a.mapResult(this.to,-1),A=a.map(this.gapFrom,-1),m=a.map(this.gapTo,1);return l.deleted&&h.deleted||A<l.pos||m>h.pos?null:new r(l.pos,h.pos,A,m,this.slice,this.insert,this.structure)},r.prototype.toJSON=function(){var a={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(a.slice=this.slice.toJSON()),this.structure&&(a.structure=!0),a},r.fromJSON=function(a,l){if(typeof l.from!="number"||typeof l.to!="number"||typeof l.gapFrom!="number"||typeof l.gapTo!="number"||typeof l.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new r(l.from,l.to,l.gapFrom,l.gapTo,Pt.fromJSON(a,l.slice),l.insert,!!l.structure)},r}(ni);ni.jsonID("replaceAround",Ni);function vg(i,r,s){for(var a=i.resolve(r),l=s-r,h=a.depth;l>0&&h>0&&a.indexAfter(h)==a.node(h).childCount;)h--,l--;if(l>0)for(var A=a.node(h).maybeChild(a.indexAfter(h));l>0;){if(!A||A.isLeaf)return!0;A=A.firstChild,l--}return!1}function Uk(i,r,s){return(r==0||i.canReplace(r,i.childCount))&&(s==i.childCount||i.canReplace(0,s))}function Xc(i){for(var r=i.parent,s=r.content.cutByIndex(i.startIndex,i.endIndex),a=i.depth;;--a){var l=i.$from.node(a),h=i.$from.index(a),A=i.$to.indexAfter(a);if(a<i.depth&&l.canReplace(h,A,s))return a;if(a==0||l.type.spec.isolating||!Uk(l,h,A))break}}Jr.prototype.lift=function(i,r){for(var s=i.$from,a=i.$to,l=i.depth,h=s.before(l+1),A=a.after(l+1),m=h,v=A,C=Et.empty,S=0,b=l,O=!1;b>r;b--)O||s.index(b)>0?(O=!0,C=Et.from(s.node(b).copy(C)),S++):m--;for(var P=Et.empty,F=0,W=l,$=!1;W>r;W--)$||a.after(W+1)<a.end(W)?($=!0,P=Et.from(a.node(W).copy(P)),F++):v++;return this.step(new Ni(m,v,h,A,new Pt(C.append(P),S,F),C.size-S,!0))};function Wg(i,r,s,a){a===void 0&&(a=i);var l=Qk(i,r),h=l&&Fk(a,r);return h?l.map(ay).concat({type:r,attrs:s}).concat(h.map(ay)):null}function ay(i){return{type:i,attrs:null}}function Qk(i,r){var s=i.parent,a=i.startIndex,l=i.endIndex,h=s.contentMatchAt(a).findWrapping(r);if(!h)return null;var A=h.length?h[0]:r;return s.canReplaceWith(a,l,A)?h:null}function Fk(i,r){var s=i.parent,a=i.startIndex,l=i.endIndex,h=s.child(a),A=r.contentMatch.findWrapping(h.type);if(!A)return null;for(var m=A.length?A[A.length-1]:r,v=m.contentMatch,C=a;v&&C<l;C++)v=v.matchType(s.child(C).type);return!v||!v.validEnd?null:A}Jr.prototype.wrap=function(i,r){for(var s=Et.empty,a=r.length-1;a>=0;a--){if(s.size){var l=r[a].type.contentMatch.matchFragment(s);if(!l||!l.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}s=Et.from(r[a].type.create(r[a].attrs,s))}var h=i.start,A=i.end;return this.step(new Ni(h,A,h,A,new Pt(s,0,0),r.length,!0))};Jr.prototype.setBlockType=function(i,r,s,a){var l=this;if(r===void 0&&(r=i),!s.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");var h=this.steps.length;return this.doc.nodesBetween(i,r,function(A,m){if(A.isTextblock&&!A.hasMarkup(s,a)&&Vk(l.doc,l.mapping.slice(h).map(m),s)){l.clearIncompatible(l.mapping.slice(h).map(m,1),s);var v=l.mapping.slice(h),C=v.map(m,1),S=v.map(m+A.nodeSize,1);return l.step(new Ni(C,S,C+1,S-1,new Pt(Et.from(s.create(a,null,A.marks)),0,0),1,!0)),!1}}),this};function Vk(i,r,s){var a=i.resolve(r),l=a.index();return a.parent.canReplaceWith(l,l+1,s)}Jr.prototype.setNodeMarkup=function(i,r,s,a){var l=this.doc.nodeAt(i);if(!l)throw new RangeError("No node at given position");r||(r=l.type);var h=r.create(s,null,a||l.marks);if(l.isLeaf)return this.replaceWith(i,i+l.nodeSize,h);if(!r.validContent(l.content))throw new RangeError("Invalid content for node type "+r.name);return this.step(new Ni(i,i+l.nodeSize,i+1,i+l.nodeSize-1,new Pt(Et.from(h),0,0),1,!0))};function ws(i,r,s,a){s===void 0&&(s=1);var l=i.resolve(r),h=l.depth-s,A=a&&a[a.length-1]||l.parent;if(h<0||l.parent.type.spec.isolating||!l.parent.canReplace(l.index(),l.parent.childCount)||!A.type.validContent(l.parent.content.cutByIndex(l.index(),l.parent.childCount)))return!1;for(var m=l.depth-1,v=s-2;m>h;m--,v--){var C=l.node(m),S=l.index(m);if(C.type.spec.isolating)return!1;var b=C.content.cutByIndex(S,C.childCount),O=a&&a[v]||C;if(O!=C&&(b=b.replaceChild(0,O.type.create(O.attrs))),!C.canReplace(S+1,C.childCount)||!O.type.validContent(b))return!1}var P=l.indexAfter(h),F=a&&a[0];return l.node(h).canReplaceWith(P,P,F?F.type:l.node(h+1).type)}Jr.prototype.split=function(i,r,s){r===void 0&&(r=1);for(var a=this.doc.resolve(i),l=Et.empty,h=Et.empty,A=a.depth,m=a.depth-r,v=r-1;A>m;A--,v--){l=Et.from(a.node(A).copy(l));var C=s&&s[v];h=Et.from(C?C.type.create(C.attrs,h):a.node(A).copy(h))}return this.step(new Os(i,i,new Pt(l.append(h),r,r),!0))};function mu(i,r){var s=i.resolve(r),a=s.index();return Gk(s.nodeBefore,s.nodeAfter)&&s.parent.canReplace(a,a+1)}function Gk(i,r){return i&&r&&!i.isLeaf&&i.canAppend(r)}Jr.prototype.join=function(i,r){r===void 0&&(r=1);var s=new Os(i-r,i+r,Pt.empty,!0);return this.step(s)};function jk(i,r,s){var a=i.resolve(r);if(a.parent.canReplaceWith(a.index(),a.index(),s))return r;if(a.parentOffset==0)for(var l=a.depth-1;l>=0;l--){var h=a.index(l);if(a.node(l).canReplaceWith(h,h,s))return a.before(l+1);if(h>0)return null}if(a.parentOffset==a.parent.content.size)for(var A=a.depth-1;A>=0;A--){var m=a.indexAfter(A);if(a.node(A).canReplaceWith(m,m,s))return a.after(A+1);if(m<a.node(A).childCount)return null}}function X0(i,r,s){var a=i.resolve(r);if(!s.content.size)return r;for(var l=s.content,h=0;h<s.openStart;h++)l=l.firstChild.content;for(var A=1;A<=(s.openStart==0&&s.size?2:1);A++)for(var m=a.depth;m>=0;m--){var v=m==a.depth?0:a.pos<=(a.start(m+1)+a.end(m+1))/2?-1:1,C=a.index(m)+(v>0?1:0),S=a.node(m),b=!1;if(A==1)b=S.canReplace(C,C,l);else{var O=S.contentMatchAt(C).findWrapping(l.firstChild.type);b=O&&S.canReplaceWith(C,C,O[0])}if(b)return v==0?a.pos:v<0?a.before(m+1):a.after(m+1)}return null}function Yg(i,r,s){for(var a=[],l=0;l<i.childCount;l++){var h=i.child(l);h.content.size&&(h=h.copy(Yg(h.content,r,h))),h.isInline&&(h=r(h,s,l)),a.push(h)}return Et.fromArray(a)}var qg=function(i){function r(s,a,l){i.call(this),this.from=s,this.to=a,this.mark=l}return i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r,r.prototype.apply=function(a){var l=this,h=a.slice(this.from,this.to),A=a.resolve(this.from),m=A.node(A.sharedDepth(this.to)),v=new Pt(Yg(h.content,function(C,S){return!C.isAtom||!S.type.allowsMarkType(l.mark.type)?C:C.mark(l.mark.addToSet(C.marks))},m),h.openStart,h.openEnd);return Ai.fromReplace(a,this.from,this.to,v)},r.prototype.invert=function(){return new Eu(this.from,this.to,this.mark)},r.prototype.map=function(a){var l=a.mapResult(this.from,1),h=a.mapResult(this.to,-1);return l.deleted&&h.deleted||l.pos>=h.pos?null:new r(l.pos,h.pos,this.mark)},r.prototype.merge=function(a){if(a instanceof r&&a.mark.eq(this.mark)&&this.from<=a.to&&this.to>=a.from)return new r(Math.min(this.from,a.from),Math.max(this.to,a.to),this.mark)},r.prototype.toJSON=function(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},r.fromJSON=function(a,l){if(typeof l.from!="number"||typeof l.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new r(l.from,l.to,a.markFromJSON(l.mark))},r}(ni);ni.jsonID("addMark",qg);var Eu=function(i){function r(s,a,l){i.call(this),this.from=s,this.to=a,this.mark=l}return i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r,r.prototype.apply=function(a){var l=this,h=a.slice(this.from,this.to),A=new Pt(Yg(h.content,function(m){return m.mark(l.mark.removeFromSet(m.marks))}),h.openStart,h.openEnd);return Ai.fromReplace(a,this.from,this.to,A)},r.prototype.invert=function(){return new qg(this.from,this.to,this.mark)},r.prototype.map=function(a){var l=a.mapResult(this.from,1),h=a.mapResult(this.to,-1);return l.deleted&&h.deleted||l.pos>=h.pos?null:new r(l.pos,h.pos,this.mark)},r.prototype.merge=function(a){if(a instanceof r&&a.mark.eq(this.mark)&&this.from<=a.to&&this.to>=a.from)return new r(Math.min(this.from,a.from),Math.max(this.to,a.to),this.mark)},r.prototype.toJSON=function(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},r.fromJSON=function(a,l){if(typeof l.from!="number"||typeof l.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new r(l.from,l.to,a.markFromJSON(l.mark))},r}(ni);ni.jsonID("removeMark",Eu);Jr.prototype.addMark=function(i,r,s){var a=this,l=[],h=[],A=null,m=null;return this.doc.nodesBetween(i,r,function(v,C,S){if(!!v.isInline){var b=v.marks;if(!s.isInSet(b)&&S.type.allowsMarkType(s.type)){for(var O=Math.max(C,i),P=Math.min(C+v.nodeSize,r),F=s.addToSet(b),W=0;W<b.length;W++)b[W].isInSet(F)||(A&&A.to==O&&A.mark.eq(b[W])?A.to=P:l.push(A=new Eu(O,P,b[W])));m&&m.to==O?m.to=P:h.push(m=new qg(O,P,s))}}}),l.forEach(function(v){return a.step(v)}),h.forEach(function(v){return a.step(v)}),this};Jr.prototype.removeMark=function(i,r,s){var a=this;s===void 0&&(s=null);var l=[],h=0;return this.doc.nodesBetween(i,r,function(A,m){if(!!A.isInline){h++;var v=null;if(s instanceof ra)for(var C=A.marks,S;S=s.isInSet(C);)(v||(v=[])).push(S),C=S.removeFromSet(C);else s?s.isInSet(A.marks)&&(v=[s]):v=A.marks;if(v&&v.length)for(var b=Math.min(m+A.nodeSize,r),O=0;O<v.length;O++){for(var P=v[O],F=void 0,W=0;W<l.length;W++){var $=l[W];$.step==h-1&&P.eq(l[W].style)&&(F=$)}F?(F.to=b,F.step=h):l.push({style:P,from:Math.max(m,i),to:b,step:h})}}}),l.forEach(function(A){return a.step(new Eu(A.from,A.to,A.style))}),this};Jr.prototype.clearIncompatible=function(i,r,s){s===void 0&&(s=r.contentMatch);for(var a=this.doc.nodeAt(i),l=[],h=i+1,A=0;A<a.childCount;A++){var m=a.child(A),v=h+m.nodeSize,C=s.matchType(m.type,m.attrs);if(!C)l.push(new Os(h,v,Pt.empty));else{s=C;for(var S=0;S<m.marks.length;S++)r.allowsMarkType(m.marks[S].type)||this.step(new Eu(h,v,m.marks[S]))}h=v}if(!s.validEnd){var b=s.fillBefore(Et.empty,!0);this.replace(h,h,new Pt(b,0,0))}for(var O=l.length-1;O>=0;O--)this.step(l[O]);return this};function Jg(i,r,s,a){if(s===void 0&&(s=r),a===void 0&&(a=Pt.empty),r==s&&!a.size)return null;var l=i.resolve(r),h=i.resolve(s);return Z0(l,h,a)?new Os(r,s,a):new go(l,h,a).fit()}Jr.prototype.replace=function(i,r,s){r===void 0&&(r=i),s===void 0&&(s=Pt.empty);var a=Jg(this.doc,i,r,s);return a&&this.step(a),this};Jr.prototype.replaceWith=function(i,r,s){return this.replace(i,r,new Pt(Et.from(s),0,0))};Jr.prototype.delete=function(i,r){return this.replace(i,r,Pt.empty)};Jr.prototype.insert=function(i,r){return this.replaceWith(i,i,r)};function Z0(i,r,s){return!s.openStart&&!s.openEnd&&i.start()==r.start()&&i.parent.canReplace(i.index(),r.index(),s.content)}var go=function(r,s,a){this.$to=s,this.$from=r,this.unplaced=a,this.frontier=[];for(var l=0;l<=r.depth;l++){var h=r.node(l);this.frontier.push({type:h.type,match:h.contentMatchAt(r.indexAfter(l))})}this.placed=Et.empty;for(var A=r.depth;A>0;A--)this.placed=Et.from(r.node(A).copy(this.placed))},$0={depth:{configurable:!0}};$0.depth.get=function(){return this.frontier.length-1};go.prototype.fit=function(){for(;this.unplaced.size;){var r=this.findFittable();r?this.placeNodes(r):this.openMore()||this.dropNode()}var s=this.mustMoveInline(),a=this.placed.size-this.depth-this.$from.depth,l=this.$from,h=this.close(s<0?this.$to:l.doc.resolve(s));if(!h)return null;for(var A=this.placed,m=l.depth,v=h.depth;m&&v&&A.childCount==1;)A=A.firstChild.content,m--,v--;var C=new Pt(A,m,v);if(s>-1)return new Ni(l.pos,s,this.$to.pos,this.$to.end(),C,a);if(C.size||l.pos!=this.$to.pos)return new Os(l.pos,h.pos,C)};go.prototype.findFittable=function(){for(var r=1;r<=2;r++)for(var s=this.unplaced.openStart;s>=0;s--){var a=void 0,l=void 0;s?(l=zg(this.unplaced.content,s-1).firstChild,a=l.content):a=this.unplaced.content;for(var h=a.firstChild,A=this.depth;A>=0;A--){var m=this.frontier[A],v=m.type,C=m.match,S=void 0,b=void 0;if(r==1&&(h?C.matchType(h.type)||(b=C.fillBefore(Et.from(h),!1)):v.compatibleContent(l.type)))return{sliceDepth:s,frontierDepth:A,parent:l,inject:b};if(r==2&&h&&(S=C.findWrapping(h.type)))return{sliceDepth:s,frontierDepth:A,parent:l,wrap:S};if(l&&C.matchType(l.type))break}}};go.prototype.openMore=function(){var r=this.unplaced,s=r.content,a=r.openStart,l=r.openEnd,h=zg(s,a);return!h.childCount||h.firstChild.isLeaf?!1:(this.unplaced=new Pt(s,a+1,Math.max(l,h.size+a>=s.size-l?a+1:0)),!0)};go.prototype.dropNode=function(){var r=this.unplaced,s=r.content,a=r.openStart,l=r.openEnd,h=zg(s,a);if(h.childCount<=1&&a>0){var A=s.size-a<=a+h.size;this.unplaced=new Pt(ou(s,a-1,1),a-1,A?a-1:l)}else this.unplaced=new Pt(ou(s,a,1),a,l)};go.prototype.placeNodes=function(r){for(var s=r.sliceDepth,a=r.frontierDepth,l=r.parent,h=r.inject,A=r.wrap;this.depth>a;)this.closeFrontierNode();if(A)for(var m=0;m<A.length;m++)this.openFrontierNode(A[m]);var v=this.unplaced,C=l?l.content:v.content,S=v.openStart-s,b=0,O=[],P=this.frontier[a],F=P.match,W=P.type;if(h){for(var $=0;$<h.childCount;$++)O.push(h.child($));F=F.matchFragment(h)}for(var X=C.size+s-(v.content.size-v.openEnd);b<C.childCount;){var K=C.child(b),_t=F.matchType(K.type);if(!_t)break;b++,(b>1||S==0||K.content.size)&&(F=_t,O.push(tS(K.mark(W.allowedMarks(K.marks)),b==1?S:0,b==C.childCount?X:-1)))}var H=b==C.childCount;H||(X=-1),this.placed=vu(this.placed,a,Et.from(O)),this.frontier[a].match=F,H&&X<0&&l&&l.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(var ft=0,Tt=C;ft<X;ft++){var $t=Tt.lastChild;this.frontier.push({type:$t.type,match:$t.contentMatchAt($t.childCount)}),Tt=$t.content}this.unplaced=H?s==0?Pt.empty:new Pt(ou(v.content,s-1,1),s-1,X<0?v.openEnd:s-1):new Pt(ou(v.content,s,b),v.openStart,v.openEnd)};go.prototype.mustMoveInline=function(){if(!this.$to.parent.isTextblock||this.$to.end()==this.$to.pos)return-1;var r=this.frontier[this.depth],s;if(!r.type.isTextblock||!Ig(this.$to,this.$to.depth,r.type,r.match,!1)||this.$to.depth==this.depth&&(s=this.findCloseLevel(this.$to))&&s.depth==this.depth)return-1;for(var a=this.$to,l=a.depth,h=this.$to.after(l);l>1&&h==this.$to.end(--l);)++h;return h};go.prototype.findCloseLevel=function(r){t:for(var s=Math.min(this.depth,r.depth);s>=0;s--){var a=this.frontier[s],l=a.match,h=a.type,A=s<r.depth&&r.end(s+1)==r.pos+(r.depth-(s+1)),m=Ig(r,s,h,l,A);if(!!m){for(var v=s-1;v>=0;v--){var C=this.frontier[v],S=C.match,b=C.type,O=Ig(r,v,b,S,!0);if(!O||O.childCount)continue t}return{depth:s,fit:m,move:A?r.doc.resolve(r.after(s+1)):r}}}};go.prototype.close=function(r){var s=this.findCloseLevel(r);if(!s)return null;for(;this.depth>s.depth;)this.closeFrontierNode();s.fit.childCount&&(this.placed=vu(this.placed,s.depth,s.fit)),r=s.move;for(var a=s.depth+1;a<=r.depth;a++){var l=r.node(a),h=l.type.contentMatch.fillBefore(l.content,!0,r.index(a));this.openFrontierNode(l.type,l.attrs,h)}return r};go.prototype.openFrontierNode=function(r,s,a){var l=this.frontier[this.depth];l.match=l.match.matchType(r),this.placed=vu(this.placed,this.depth,Et.from(r.create(s,a))),this.frontier.push({type:r,match:r.contentMatch})};go.prototype.closeFrontierNode=function(){var r=this.frontier.pop(),s=r.match.fillBefore(Et.empty,!0);s.childCount&&(this.placed=vu(this.placed,this.frontier.length,s))};Object.defineProperties(go.prototype,$0);function ou(i,r,s){return r==0?i.cutByIndex(s):i.replaceChild(0,i.firstChild.copy(ou(i.firstChild.content,r-1,s)))}function vu(i,r,s){return r==0?i.append(s):i.replaceChild(i.childCount-1,i.lastChild.copy(vu(i.lastChild.content,r-1,s)))}function zg(i,r){for(var s=0;s<r;s++)i=i.firstChild.content;return i}function tS(i,r,s){if(r<=0)return i;var a=i.content;return r>1&&(a=a.replaceChild(0,tS(a.firstChild,r-1,a.childCount==1?s-1:0))),r>0&&(a=i.type.contentMatch.fillBefore(a).append(a),s<=0&&(a=a.append(i.type.contentMatch.matchFragment(a).fillBefore(Et.empty,!0)))),i.copy(a)}function Ig(i,r,s,a,l){var h=i.node(r),A=l?i.indexAfter(r):i.index(r);if(A==h.childCount&&!s.compatibleContent(h.type))return null;var m=a.fillBefore(h.content,!0,A);return m&&!Kk(s,h.content,A)?m:null}function Kk(i,r,s){for(var a=s;a<r.childCount;a++)if(!i.allowsMarks(r.child(a).marks))return!0;return!1}Jr.prototype.replaceRange=function(i,r,s){if(!s.size)return this.deleteRange(i,r);var a=this.doc.resolve(i),l=this.doc.resolve(r);if(Z0(a,l,s))return this.step(new Os(i,r,s));var h=rS(a,this.doc.resolve(r));h[h.length-1]==0&&h.pop();var A=-(a.depth+1);h.unshift(A);for(var m=a.depth,v=a.pos-1;m>0;m--,v--){var C=a.node(m).type.spec;if(C.defining||C.isolating)break;h.indexOf(m)>-1?A=m:a.before(m)==v&&h.splice(1,0,-m)}for(var S=h.indexOf(A),b=[],O=s.openStart,P=s.content,F=0;;F++){var W=P.firstChild;if(b.push(W),F==s.openStart)break;P=W.content}O>0&&b[O-1].type.spec.defining&&a.node(S).type!=b[O-1].type?O-=1:O>=2&&b[O-1].isTextblock&&b[O-2].type.spec.defining&&a.node(S).type!=b[O-2].type&&(O-=2);for(var $=s.openStart;$>=0;$--){var X=($+O+1)%(s.openStart+1),K=b[X];if(!!K)for(var _t=0;_t<h.length;_t++){var H=h[(_t+S)%h.length],ft=!0;H<0&&(ft=!1,H=-H);var Tt=a.node(H-1),$t=a.index(H-1);if(Tt.canReplaceWith($t,$t,K.type,K.marks))return this.replace(a.before(H),ft?l.after(H):r,new Pt(eS(s.content,0,s.openStart,X),X,s.openEnd))}}for(var ne=this.steps.length,Te=h.length-1;Te>=0&&(this.replace(i,r,s),!(this.steps.length>ne));Te--){var ve=h[Te];ve<0||(i=a.before(ve),r=l.after(ve))}return this};function eS(i,r,s,a,l){if(r<s){var h=i.firstChild;i=i.replaceChild(0,h.copy(eS(h.content,r+1,s,a,h)))}if(r>a){var A=l.contentMatchAt(0),m=A.fillBefore(i).append(i);i=m.append(A.matchFragment(m).fillBefore(Et.empty,!0))}return i}Jr.prototype.replaceRangeWith=function(i,r,s){if(!s.isInline&&i==r&&this.doc.resolve(i).parent.content.size){var a=jk(this.doc,i,s.type);a!=null&&(i=r=a)}return this.replaceRange(i,r,new Pt(Et.from(s),0,0))};Jr.prototype.deleteRange=function(i,r){for(var s=this.doc.resolve(i),a=this.doc.resolve(r),l=rS(s,a),h=0;h<l.length;h++){var A=l[h],m=h==l.length-1;if(m&&A==0||s.node(A).type.contentMatch.validEnd)return this.delete(s.start(A),a.end(A));if(A>0&&(m||s.node(A-1).canReplace(s.index(A-1),a.indexAfter(A-1))))return this.delete(s.before(A),a.after(A))}for(var v=1;v<=s.depth&&v<=a.depth;v++)if(i-s.start(v)==s.depth-v&&r>s.end(v)&&a.end(v)-r!=a.depth-v)return this.delete(s.before(v),r);return this.delete(i,r)};function rS(i,r){for(var s=[],a=Math.min(i.depth,r.depth),l=a;l>=0;l--){var h=i.start(l);if(h<i.pos-(i.depth-l)||r.end(l)>r.pos+(r.depth-l)||i.node(l).type.spec.isolating||r.node(l).type.spec.isolating)break;(h==r.start(l)||l==i.depth&&l==r.depth&&i.parent.inlineContent&&r.parent.inlineContent&&l&&r.start(l-1)==h-1)&&s.push(l)}return s}var Cg=Object.create(null),Ee=function(r,s,a){this.ranges=a||[new Hk(r.min(s),r.max(s))],this.$anchor=r,this.$head=s},sa={anchor:{configurable:!0},head:{configurable:!0},from:{configurable:!0},to:{configurable:!0},$from:{configurable:!0},$to:{configurable:!0},empty:{configurable:!0}};sa.anchor.get=function(){return this.$anchor.pos};sa.head.get=function(){return this.$head.pos};sa.from.get=function(){return this.$from.pos};sa.to.get=function(){return this.$to.pos};sa.$from.get=function(){return this.ranges[0].$from};sa.$to.get=function(){return this.ranges[0].$to};sa.empty.get=function(){for(var i=this.ranges,r=0;r<i.length;r++)if(i[r].$from.pos!=i[r].$to.pos)return!1;return!0};Ee.prototype.content=function(){return this.$from.node(0).slice(this.from,this.to,!0)};Ee.prototype.replace=function(r,s){s===void 0&&(s=Pt.empty);for(var a=s.content.lastChild,l=null,h=0;h<s.openEnd;h++)l=a,a=a.lastChild;for(var A=r.steps.length,m=this.ranges,v=0;v<m.length;v++){var C=m[v],S=C.$from,b=C.$to,O=r.mapping.slice(A);r.replaceRange(O.map(S.pos),O.map(b.pos),v?Pt.empty:s),v==0&&nS(r,A,(a?a.isInline:l&&l.isTextblock)?-1:1)}};Ee.prototype.replaceWith=function(r,s){for(var a=r.steps.length,l=this.ranges,h=0;h<l.length;h++){var A=l[h],m=A.$from,v=A.$to,C=r.mapping.slice(a),S=C.map(m.pos),b=C.map(v.pos);h?r.deleteRange(S,b):(r.replaceRangeWith(S,b,s),nS(r,a,s.isInline?-1:1))}};Ee.findFrom=function(r,s,a){var l=r.parent.inlineContent?new Fe(r):Pc(r.node(0),r.parent,r.pos,r.index(),s,a);if(l)return l;for(var h=r.depth-1;h>=0;h--){var A=s<0?Pc(r.node(0),r.node(h),r.before(h+1),r.index(h),s,a):Pc(r.node(0),r.node(h),r.after(h+1),r.index(h)+1,s,a);if(A)return A}};Ee.near=function(r,s){return s===void 0&&(s=1),this.findFrom(r,s)||this.findFrom(r,-s)||new ks(r.node(0))};Ee.atStart=function(r){return Pc(r,r,0,0,1)||new ks(r)};Ee.atEnd=function(r){return Pc(r,r,r.content.size,r.childCount,-1)||new ks(r)};Ee.fromJSON=function(r,s){if(!s||!s.type)throw new RangeError("Invalid input for Selection.fromJSON");var a=Cg[s.type];if(!a)throw new RangeError("No selection type "+s.type+" defined");return a.fromJSON(r,s)};Ee.jsonID=function(r,s){if(r in Cg)throw new RangeError("Duplicate use of selection JSON ID "+r);return Cg[r]=s,s.prototype.jsonID=r,s};Ee.prototype.getBookmark=function(){return Fe.between(this.$anchor,this.$head).getBookmark()};Object.defineProperties(Ee.prototype,sa);Ee.prototype.visible=!0;var Hk=function(r,s){this.$from=r,this.$to=s},Fe=function(i){function r(a,l){l===void 0&&(l=a),i.call(this,a,l)}i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r;var s={$cursor:{configurable:!0}};return s.$cursor.get=function(){return this.$anchor.pos==this.$head.pos?this.$head:null},r.prototype.map=function(l,h){var A=l.resolve(h.map(this.head));if(!A.parent.inlineContent)return i.near(A);var m=l.resolve(h.map(this.anchor));return new r(m.parent.inlineContent?m:A,A)},r.prototype.replace=function(l,h){if(h===void 0&&(h=Pt.empty),i.prototype.replace.call(this,l,h),h==Pt.empty){var A=this.$from.marksAcross(this.$to);A&&l.ensureMarks(A)}},r.prototype.eq=function(l){return l instanceof r&&l.anchor==this.anchor&&l.head==this.head},r.prototype.getBookmark=function(){return new su(this.anchor,this.head)},r.prototype.toJSON=function(){return{type:"text",anchor:this.anchor,head:this.head}},r.fromJSON=function(l,h){if(typeof h.anchor!="number"||typeof h.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new r(l.resolve(h.anchor),l.resolve(h.head))},r.create=function(l,h,A){A===void 0&&(A=h);var m=l.resolve(h);return new this(m,A==h?m:l.resolve(A))},r.between=function(l,h,A){var m=l.pos-h.pos;if((!A||m)&&(A=m>=0?1:-1),!h.parent.inlineContent){var v=i.findFrom(h,A,!0)||i.findFrom(h,-A,!0);if(v)h=v.$head;else return i.near(h,A)}return l.parent.inlineContent||(m==0?l=h:(l=(i.findFrom(l,-A,!0)||i.findFrom(l,A,!0)).$anchor,l.pos<h.pos!=m<0&&(l=h))),new r(l,h)},Object.defineProperties(r.prototype,s),r}(Ee);Ee.jsonID("text",Fe);var su=function(r,s){this.anchor=r,this.head=s};su.prototype.map=function(r){return new su(r.map(this.anchor),r.map(this.head))};su.prototype.resolve=function(r){return Fe.between(r.resolve(this.anchor),r.resolve(this.head))};var me=function(i){function r(s){var a=s.nodeAfter,l=s.node(0).resolve(s.pos+a.nodeSize);i.call(this,s,l),this.node=a}return i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r,r.prototype.map=function(a,l){var h=l.mapResult(this.anchor),A=h.deleted,m=h.pos,v=a.resolve(m);return A?i.near(v):new r(v)},r.prototype.content=function(){return new Pt(Et.from(this.node),0,0)},r.prototype.eq=function(a){return a instanceof r&&a.anchor==this.anchor},r.prototype.toJSON=function(){return{type:"node",anchor:this.anchor}},r.prototype.getBookmark=function(){return new ph(this.anchor)},r.fromJSON=function(a,l){if(typeof l.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new r(a.resolve(l.anchor))},r.create=function(a,l){return new this(a.resolve(l))},r.isSelectable=function(a){return!a.isText&&a.type.spec.selectable!==!1},r}(Ee);me.prototype.visible=!1;Ee.jsonID("node",me);var ph=function(r){this.anchor=r};ph.prototype.map=function(r){var s=r.mapResult(this.anchor),a=s.deleted,l=s.pos;return a?new su(l,l):new ph(l)};ph.prototype.resolve=function(r){var s=r.resolve(this.anchor),a=s.nodeAfter;return a&&me.isSelectable(a)?new me(s):Ee.near(s)};var ks=function(i){function r(s){i.call(this,s.resolve(0),s.resolve(s.content.size))}return i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r,r.prototype.replace=function(a,l){if(l===void 0&&(l=Pt.empty),l==Pt.empty){a.delete(0,a.doc.content.size);var h=i.atStart(a.doc);h.eq(a.selection)||a.setSelection(h)}else i.prototype.replace.call(this,a,l)},r.prototype.toJSON=function(){return{type:"all"}},r.fromJSON=function(a){return new r(a)},r.prototype.map=function(a){return new r(a)},r.prototype.eq=function(a){return a instanceof r},r.prototype.getBookmark=function(){return Wk},r}(Ee);Ee.jsonID("all",ks);var Wk={map:function(){return this},resolve:function(r){return new ks(r)}};function Pc(i,r,s,a,l,h){if(r.inlineContent)return Fe.create(i,s);for(var A=a-(l>0?0:1);l>0?A<r.childCount:A>=0;A+=l){var m=r.child(A);if(m.isAtom){if(!h&&me.isSelectable(m))return me.create(i,s-(l<0?m.nodeSize:0))}else{var v=Pc(i,m,s+l,l<0?m.childCount:0,l,h);if(v)return v}s+=m.nodeSize*l}}function nS(i,r,s){var a=i.steps.length-1;if(!(a<r)){var l=i.steps[a];if(l instanceof Os||l instanceof Ni){var h=i.mapping.maps[a],A;h.forEach(function(m,v,C,S){A==null&&(A=S)}),i.setSelection(Ee.near(i.doc.resolve(A),s))}}}var cy=1,Jd=2,ly=4,Yk=function(i){function r(a){i.call(this,a.doc),this.time=Date.now(),this.curSelection=a.selection,this.curSelectionFor=0,this.storedMarks=a.storedMarks,this.updated=0,this.meta=Object.create(null)}i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r;var s={selection:{configurable:!0},selectionSet:{configurable:!0},storedMarksSet:{configurable:!0},isGeneric:{configurable:!0},scrolledIntoView:{configurable:!0}};return s.selection.get=function(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection},r.prototype.setSelection=function(l){if(l.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=l,this.curSelectionFor=this.steps.length,this.updated=(this.updated|cy)&~Jd,this.storedMarks=null,this},s.selectionSet.get=function(){return(this.updated&cy)>0},r.prototype.setStoredMarks=function(l){return this.storedMarks=l,this.updated|=Jd,this},r.prototype.ensureMarks=function(l){return Ge.sameSet(this.storedMarks||this.selection.$from.marks(),l)||this.setStoredMarks(l),this},r.prototype.addStoredMark=function(l){return this.ensureMarks(l.addToSet(this.storedMarks||this.selection.$head.marks()))},r.prototype.removeStoredMark=function(l){return this.ensureMarks(l.removeFromSet(this.storedMarks||this.selection.$head.marks()))},s.storedMarksSet.get=function(){return(this.updated&Jd)>0},r.prototype.addStep=function(l,h){i.prototype.addStep.call(this,l,h),this.updated=this.updated&~Jd,this.storedMarks=null},r.prototype.setTime=function(l){return this.time=l,this},r.prototype.replaceSelection=function(l){return this.selection.replace(this,l),this},r.prototype.replaceSelectionWith=function(l,h){var A=this.selection;return h!==!1&&(l=l.mark(this.storedMarks||(A.empty?A.$from.marks():A.$from.marksAcross(A.$to)||Ge.none))),A.replaceWith(this,l),this},r.prototype.deleteSelection=function(){return this.selection.replace(this),this},r.prototype.insertText=function(l,h,A){A===void 0&&(A=h);var m=this.doc.type.schema;if(h==null)return l?this.replaceSelectionWith(m.text(l),!0):this.deleteSelection();if(!l)return this.deleteRange(h,A);var v=this.storedMarks;if(!v){var C=this.doc.resolve(h);v=A==h?C.marks():C.marksAcross(this.doc.resolve(A))}return this.replaceRangeWith(h,A,m.text(l,v)),this.selection.empty||this.setSelection(Ee.near(this.selection.$to)),this},r.prototype.setMeta=function(l,h){return this.meta[typeof l=="string"?l:l.key]=h,this},r.prototype.getMeta=function(l){return this.meta[typeof l=="string"?l:l.key]},s.isGeneric.get=function(){for(var a in this.meta)return!1;return!0},r.prototype.scrollIntoView=function(){return this.updated|=ly,this},s.scrolledIntoView.get=function(){return(this.updated&ly)>0},Object.defineProperties(r.prototype,s),r}(Jr);function uy(i,r){return!r||!i?i:i.bind(r)}var Hl=function(r,s,a){this.name=r,this.init=uy(s.init,a),this.apply=uy(s.apply,a)},qk=[new Hl("doc",{init:function(r){return r.doc||r.schema.topNodeType.createAndFill()},apply:function(r){return r.doc}}),new Hl("selection",{init:function(r,s){return r.selection||Ee.atStart(s.doc)},apply:function(r){return r.selection}}),new Hl("storedMarks",{init:function(r){return r.storedMarks||null},apply:function(r,s,a,l){return l.selection.$cursor?r.storedMarks:null}}),new Hl("scrollToSelection",{init:function(){return 0},apply:function(r,s){return r.scrolledIntoView?s+1:s}})],Xg=function(r,s){var a=this;this.schema=r,this.fields=qk.concat(),this.plugins=[],this.pluginsByKey=Object.create(null),s&&s.forEach(function(l){if(a.pluginsByKey[l.key])throw new RangeError("Adding different instances of a keyed plugin ("+l.key+")");a.plugins.push(l),a.pluginsByKey[l.key]=l,l.spec.state&&a.fields.push(new Hl(l.key,l.spec.state,l))})},ei=function(r){this.config=r},Dh={schema:{configurable:!0},plugins:{configurable:!0},tr:{configurable:!0}};Dh.schema.get=function(){return this.config.schema};Dh.plugins.get=function(){return this.config.plugins};ei.prototype.apply=function(r){return this.applyTransaction(r).state};ei.prototype.filterTransaction=function(r,s){s===void 0&&(s=-1);for(var a=0;a<this.config.plugins.length;a++)if(a!=s){var l=this.config.plugins[a];if(l.spec.filterTransaction&&!l.spec.filterTransaction.call(l,r,this))return!1}return!0};ei.prototype.applyTransaction=function(r){if(!this.filterTransaction(r))return{state:this,transactions:[]};for(var s=[r],a=this.applyInner(r),l=null;;){for(var h=!1,A=0;A<this.config.plugins.length;A++){var m=this.config.plugins[A];if(m.spec.appendTransaction){var v=l?l[A].n:0,C=l?l[A].state:this,S=v<s.length&&m.spec.appendTransaction.call(m,v?s.slice(v):s,C,a);if(S&&a.filterTransaction(S,A)){if(S.setMeta("appendedTransaction",r),!l){l=[];for(var b=0;b<this.config.plugins.length;b++)l.push(b<A?{state:a,n:s.length}:{state:this,n:0})}s.push(S),a=a.applyInner(S),h=!0}l&&(l[A]={state:a,n:s.length})}}if(!h)return{state:a,transactions:s}}};ei.prototype.applyInner=function(r){if(!r.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");for(var s=new ei(this.config),a=this.config.fields,l=0;l<a.length;l++){var h=a[l];s[h.name]=h.apply(r,this[h.name],this,s)}for(var A=0;A<au.length;A++)au[A](this,r,s);return s};Dh.tr.get=function(){return new Yk(this)};ei.create=function(r){for(var s=new Xg(r.doc?r.doc.type.schema:r.schema,r.plugins),a=new ei(s),l=0;l<s.fields.length;l++)a[s.fields[l].name]=s.fields[l].init(r,a);return a};ei.prototype.reconfigure=function(r){for(var s=new Xg(this.schema,r.plugins),a=s.fields,l=new ei(s),h=0;h<a.length;h++){var A=a[h].name;l[A]=this.hasOwnProperty(A)?this[A]:a[h].init(r,l)}return l};ei.prototype.toJSON=function(r){var s={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(s.storedMarks=this.storedMarks.map(function(A){return A.toJSON()})),r&&typeof r=="object")for(var a in r){if(a=="doc"||a=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");var l=r[a],h=l.spec.state;h&&h.toJSON&&(s[a]=h.toJSON.call(l,this[l.key]))}return s};ei.fromJSON=function(r,s,a){if(!s)throw new RangeError("Invalid input for EditorState.fromJSON");if(!r.schema)throw new RangeError("Required config field 'schema' missing");var l=new Xg(r.schema,r.plugins),h=new ei(l);return l.fields.forEach(function(A){if(A.name=="doc")h.doc=Ye.fromJSON(r.schema,s.doc);else if(A.name=="selection")h.selection=Ee.fromJSON(h.doc,s.selection);else if(A.name=="storedMarks")s.storedMarks&&(h.storedMarks=s.storedMarks.map(r.schema.markFromJSON));else{if(a)for(var m in a){var v=a[m],C=v.spec.state;if(v.key==A.name&&C&&C.fromJSON&&Object.prototype.hasOwnProperty.call(s,m)){h[A.name]=C.fromJSON.call(v,r,s[m],h);return}}h[A.name]=A.init(r,h)}}),h};ei.addApplyListener=function(r){au.push(r)};ei.removeApplyListener=function(r){var s=au.indexOf(r);s>-1&&au.splice(s,1)};Object.defineProperties(ei.prototype,Dh);var au=[];function iS(i,r,s){for(var a in i){var l=i[a];l instanceof Function?l=l.bind(r):a=="handleDOMEvents"&&(l=iS(l,r,{})),s[a]=l}return s}var gn=function(r){this.props={},r.props&&iS(r.props,this,this.props),this.spec=r,this.key=r.key?r.key.key:oS("plugin")};gn.prototype.getState=function(r){return r[this.key]};var Kf=Object.create(null);function oS(i){return i in Kf?i+"$"+ ++Kf[i]:(Kf[i]=0,i+"$")}var ii=function(r){r===void 0&&(r="key"),this.key=oS(r)};ii.prototype.get=function(r){return r.config.pluginsByKey[this.key]};ii.prototype.getState=function(r){return r[this.key]};function Zg(i,r){return i.selection.empty?!1:(r&&r(i.tr.deleteSelection().scrollIntoView()),!0)}function sS(i,r,s){var a=i.selection,l=a.$cursor;if(!l||(s?!s.endOfTextblock("backward",i):l.parentOffset>0))return!1;var h=cS(l);if(!h){var A=l.blockRange(),m=A&&Xc(A);return m==null?!1:(r&&r(i.tr.lift(A,m).scrollIntoView()),!0)}var v=h.nodeBefore;if(!v.type.spec.isolating&&gS(i,h,r))return!0;if(l.parent.content.size==0&&(Fc(v,"end")||me.isSelectable(v))){var C=Jg(i.doc,l.before(),l.after(),Pt.empty);if(C.slice.size<C.to-C.from){if(r){var S=i.tr.step(C);S.setSelection(Fc(v,"end")?Ee.findFrom(S.doc.resolve(S.mapping.map(h.pos,-1)),-1):me.create(S.doc,h.pos-v.nodeSize)),r(S.scrollIntoView())}return!0}}return v.isAtom&&h.depth==l.depth-1?(r&&r(i.tr.delete(h.pos-v.nodeSize,h.pos).scrollIntoView()),!0):!1}function Fc(i,r,s){for(;i;i=r=="start"?i.firstChild:i.lastChild){if(i.isTextblock)return!0;if(s&&i.childCount!=1)return!1}return!1}function aS(i,r,s){var a=i.selection,l=a.$head,h=a.empty,A=l;if(!h)return!1;if(l.parent.isTextblock){if(s?!s.endOfTextblock("backward",i):l.parentOffset>0)return!1;A=cS(l)}var m=A&&A.nodeBefore;return!m||!me.isSelectable(m)?!1:(r&&r(i.tr.setSelection(me.create(i.doc,A.pos-m.nodeSize)).scrollIntoView()),!0)}function cS(i){if(!i.parent.type.spec.isolating)for(var r=i.depth-1;r>=0;r--){if(i.index(r)>0)return i.doc.resolve(i.before(r+1));if(i.node(r).type.spec.isolating)break}return null}function lS(i,r,s){var a=i.selection,l=a.$cursor;if(!l||(s?!s.endOfTextblock("forward",i):l.parentOffset<l.parent.content.size))return!1;var h=dS(l);if(!h)return!1;var A=h.nodeAfter;if(gS(i,h,r))return!0;if(l.parent.content.size==0&&(Fc(A,"start")||me.isSelectable(A))){var m=Jg(i.doc,l.before(),l.after(),Pt.empty);if(m.slice.size<m.to-m.from){if(r){var v=i.tr.step(m);v.setSelection(Fc(A,"start")?Ee.findFrom(v.doc.resolve(v.mapping.map(h.pos)),1):me.create(v.doc,v.mapping.map(h.pos))),r(v.scrollIntoView())}return!0}}return A.isAtom&&h.depth==l.depth-1?(r&&r(i.tr.delete(h.pos,h.pos+A.nodeSize).scrollIntoView()),!0):!1}function uS(i,r,s){var a=i.selection,l=a.$head,h=a.empty,A=l;if(!h)return!1;if(l.parent.isTextblock){if(s?!s.endOfTextblock("forward",i):l.parentOffset<l.parent.content.size)return!1;A=dS(l)}var m=A&&A.nodeAfter;return!m||!me.isSelectable(m)?!1:(r&&r(i.tr.setSelection(me.create(i.doc,A.pos)).scrollIntoView()),!0)}function dS(i){if(!i.parent.type.spec.isolating)for(var r=i.depth-1;r>=0;r--){var s=i.node(r);if(i.index(r)+1<s.childCount)return i.doc.resolve(i.after(r+1));if(s.type.spec.isolating)break}return null}function Jk(i,r){var s=i.selection,a=s.$from,l=s.$to,h=a.blockRange(l),A=h&&Xc(h);return A==null?!1:(r&&r(i.tr.lift(h,A).scrollIntoView()),!0)}function hS(i,r){var s=i.selection,a=s.$head,l=s.$anchor;return!a.parent.type.spec.code||!a.sameParent(l)?!1:(r&&r(i.tr.insertText(`
`).scrollIntoView()),!0)}function $g(i){for(var r=0;r<i.edgeCount;r++){var s=i.edge(r),a=s.type;if(a.isTextblock&&!a.hasRequiredAttrs())return a}return null}function pS(i,r){var s=i.selection,a=s.$head,l=s.$anchor;if(!a.parent.type.spec.code||!a.sameParent(l))return!1;var h=a.node(-1),A=a.indexAfter(-1),m=$g(h.contentMatchAt(A));if(!h.canReplaceWith(A,A,m))return!1;if(r){var v=a.after(),C=i.tr.replaceWith(v,v,m.createAndFill());C.setSelection(Ee.near(C.doc.resolve(v),1)),r(C.scrollIntoView())}return!0}function AS(i,r){var s=i.selection,a=s.$from,l=s.$to;if(s instanceof ks||a.parent.inlineContent||l.parent.inlineContent)return!1;var h=$g(l.parent.contentMatchAt(l.indexAfter()));if(!h||!h.isTextblock)return!1;if(r){var A=(!a.parentOffset&&l.index()<l.parent.childCount?a:l).pos,m=i.tr.insert(A,h.createAndFill());m.setSelection(Fe.create(m.doc,A+1)),r(m.scrollIntoView())}return!0}function fS(i,r){var s=i.selection,a=s.$cursor;if(!a||a.parent.content.size)return!1;if(a.depth>1&&a.after()!=a.end(-1)){var l=a.before();if(ws(i.doc,l))return r&&r(i.tr.split(l).scrollIntoView()),!0}var h=a.blockRange(),A=h&&Xc(h);return A==null?!1:(r&&r(i.tr.lift(h,A).scrollIntoView()),!0)}function zk(i,r){var s=i.selection,a=s.$from,l=s.$to;if(i.selection instanceof me&&i.selection.node.isBlock)return!a.parentOffset||!ws(i.doc,a.pos)?!1:(r&&r(i.tr.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;if(r){var h=l.parentOffset==l.parent.content.size,A=i.tr;(i.selection instanceof Fe||i.selection instanceof ks)&&A.deleteSelection();var m=a.depth==0?null:$g(a.node(-1).contentMatchAt(a.indexAfter(-1))),v=h&&m?[{type:m}]:null,C=ws(A.doc,A.mapping.map(a.pos),1,v);if(!v&&!C&&ws(A.doc,A.mapping.map(a.pos),1,m&&[{type:m}])&&(v=[{type:m}],C=!0),C&&(A.split(A.mapping.map(a.pos),1,v),!h&&!a.parentOffset&&a.parent.type!=m)){var S=A.mapping.map(a.before()),b=A.doc.resolve(S);a.node(-1).canReplaceWith(b.index(),b.index()+1,m)&&A.setNodeMarkup(A.mapping.map(a.before()),m)}r(A.scrollIntoView())}return!0}function Xk(i,r){var s=i.selection,a=s.$from,l=s.to,h,A=a.sharedDepth(l);return A==0?!1:(h=a.before(A),r&&r(i.tr.setSelection(me.create(i.doc,h))),!0)}function Zk(i,r){return r&&r(i.tr.setSelection(new ks(i.doc))),!0}function $k(i,r,s){var a=r.nodeBefore,l=r.nodeAfter,h=r.index();return!a||!l||!a.type.compatibleContent(l.type)?!1:!a.content.size&&r.parent.canReplace(h-1,h)?(s&&s(i.tr.delete(r.pos-a.nodeSize,r.pos).scrollIntoView()),!0):!r.parent.canReplace(h,h+1)||!(l.isTextblock||mu(i.doc,r.pos))?!1:(s&&s(i.tr.clearIncompatible(r.pos,a.type,a.contentMatchAt(a.childCount)).join(r.pos).scrollIntoView()),!0)}function gS(i,r,s){var a=r.nodeBefore,l=r.nodeAfter,h,A;if(a.type.spec.isolating||l.type.spec.isolating)return!1;if($k(i,r,s))return!0;var m=r.parent.canReplace(r.index(),r.index()+1);if(m&&(h=(A=a.contentMatchAt(a.childCount)).findWrapping(l.type))&&A.matchType(h[0]||l.type).validEnd){if(s){for(var v=r.pos+l.nodeSize,C=Et.empty,S=h.length-1;S>=0;S--)C=Et.from(h[S].create(null,C));C=Et.from(a.copy(C));var b=i.tr.step(new Ni(r.pos-1,v,r.pos,v,new Pt(C,1,0),h.length,!0)),O=v+2*h.length;mu(b.doc,O)&&b.join(O),s(b.scrollIntoView())}return!0}var P=Ee.findFrom(r,1),F=P&&P.$from.blockRange(P.$to),W=F&&Xc(F);if(W!=null&&W>=r.depth)return s&&s(i.tr.lift(F,W).scrollIntoView()),!0;if(m&&Fc(l,"start",!0)&&Fc(a,"end")){for(var $=a,X=[];X.push($),!$.isTextblock;)$=$.lastChild;for(var K=l,_t=1;!K.isTextblock;K=K.firstChild)_t++;if($.canReplace($.childCount,$.childCount,K.content)){if(s){for(var H=Et.empty,ft=X.length-1;ft>=0;ft--)H=Et.from(X[ft].copy(H));var Tt=i.tr.step(new Ni(r.pos-X.length,r.pos+l.nodeSize,r.pos+_t,r.pos+l.nodeSize-_t,new Pt(H,X.length,0),0,!0));s(Tt.scrollIntoView())}return!0}}return!1}function mS(i){return function(r,s){for(var a=r.selection,l=i<0?a.$from:a.$to,h=l.depth;l.node(h).isInline;){if(!h)return!1;h--}return l.node(h).isTextblock?(s&&s(r.tr.setSelection(Fe.create(r.doc,i<0?l.start(h):l.end(h)))),!0):!1}}var tm=mS(-1),em=mS(1);function tD(i,r){return function(s,a){var l=s.selection,h=l.$from,A=l.$to,m=h.blockRange(A),v=m&&Wg(m,i,r);return v?(a&&a(s.tr.wrap(m,v).scrollIntoView()),!0):!1}}function dy(i,r){return function(s,a){var l=s.selection,h=l.from,A=l.to,m=!1;return s.doc.nodesBetween(h,A,function(v,C){if(m)return!1;if(!(!v.isTextblock||v.hasMarkup(i,r)))if(v.type==i)m=!0;else{var S=s.doc.resolve(C),b=S.index();m=S.parent.canReplaceWith(b,b+1,i)}}),m?(a&&a(s.tr.setBlockType(h,A,i,r).scrollIntoView()),!0):!1}}function rm(){for(var i=[],r=arguments.length;r--;)i[r]=arguments[r];return function(s,a,l){for(var h=0;h<i.length;h++)if(i[h](s,a,l))return!0;return!1}}var Hf=rm(Zg,sS,aS),hy=rm(Zg,lS,uS),Go={Enter:rm(hS,AS,fS,zk),"Mod-Enter":pS,Backspace:Hf,"Mod-Backspace":Hf,"Shift-Backspace":Hf,Delete:hy,"Mod-Delete":hy,"Mod-a":Zk},eD={"Ctrl-h":Go.Backspace,"Alt-Backspace":Go["Mod-Backspace"],"Ctrl-d":Go.Delete,"Ctrl-Alt-Backspace":Go["Mod-Delete"],"Alt-Delete":Go["Mod-Delete"],"Alt-d":Go["Mod-Delete"],"Ctrl-a":tm,"Ctrl-e":em};for(var py in Go)eD[py]=Go[py];Go.Home=tm;Go.End=em;typeof navigator!="undefined"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os!="undefined"&&os.platform()=="darwin";function rD(i,r){return function(s,a){var l=s.selection,h=l.$from,A=l.$to,m=h.blockRange(A),v=!1,C=m;if(!m)return!1;if(m.depth>=2&&h.node(m.depth-1).type.compatibleContent(i)&&m.startIndex==0){if(h.index(m.depth-1)==0)return!1;var S=s.doc.resolve(m.start-2);C=new nu(S,S,m.depth),m.endIndex<m.parent.childCount&&(m=new nu(h,s.doc.resolve(A.end(m.depth)),m.depth)),v=!0}var b=Wg(C,i,r,m);return b?(a&&a(nD(s.tr,m,b,v,i).scrollIntoView()),!0):!1}}function nD(i,r,s,a,l){for(var h=Et.empty,A=s.length-1;A>=0;A--)h=Et.from(s[A].type.create(s[A].attrs,h));i.step(new Ni(r.start-(a?2:0),r.end,r.start,r.end,new Pt(h,0,0),s.length,!0));for(var m=0,v=0;v<s.length;v++)s[v].type==l&&(m=v+1);for(var C=s.length-m,S=r.start+s.length-(a?2:0),b=r.parent,O=r.startIndex,P=r.endIndex,F=!0;O<P;O++,F=!1)!F&&ws(i.doc,S,C)&&(i.split(S,C),S+=2*C),S+=b.child(O).nodeSize;return i}function iD(i){return function(r,s){var a=r.selection,l=a.$from,h=a.$to,A=l.blockRange(h,function(m){return m.childCount&&m.firstChild.type==i});return A?s?l.node(A.depth-1).type==i?oD(r,s,i,A):sD(r,s,A):!0:!1}}function oD(i,r,s,a){var l=i.tr,h=a.end,A=a.$to.end(a.depth);return h<A&&(l.step(new Ni(h-1,A,h,A,new Pt(Et.from(s.create(null,a.parent.copy())),1,0),1,!0)),a=new nu(l.doc.resolve(a.$from.pos),l.doc.resolve(A),a.depth)),r(l.lift(a,Xc(a)).scrollIntoView()),!0}function sD(i,r,s){for(var a=i.tr,l=s.parent,h=s.end,A=s.endIndex-1,m=s.startIndex;A>m;A--)h-=l.child(A).nodeSize,a.delete(h-1,h+1);var v=a.doc.resolve(s.start),C=v.nodeAfter;if(a.mapping.map(s.end)!=s.start+v.nodeAfter.nodeSize)return!1;var S=s.startIndex==0,b=s.endIndex==l.childCount,O=v.node(-1),P=v.index(-1);if(!O.canReplace(P+(S?0:1),P+1,C.content.append(b?Et.empty:Et.from(l))))return!1;var F=v.pos,W=F+C.nodeSize;return a.step(new Ni(F-(S?1:0),W+(b?1:0),F+1,W-1,new Pt((S?Et.empty:Et.from(l.copy(Et.empty))).append(b?Et.empty:Et.from(l.copy(Et.empty))),S?0:1,b?0:1),S?0:1)),r(a.scrollIntoView()),!0}function aD(i){return function(r,s){var a=r.selection,l=a.$from,h=a.$to,A=l.blockRange(h,function(W){return W.childCount&&W.firstChild.type==i});if(!A)return!1;var m=A.startIndex;if(m==0)return!1;var v=A.parent,C=v.child(m-1);if(C.type!=i)return!1;if(s){var S=C.lastChild&&C.lastChild.type==v.type,b=Et.from(S?i.create():null),O=new Pt(Et.from(i.create(null,Et.from(v.type.create(null,b)))),S?3:1,0),P=A.start,F=A.end;s(r.tr.step(new Ni(P-(S?3:1),F,P,F,O,1,!0)).scrollIntoView())}return!0}}var Rt={};if(typeof navigator!="undefined"&&typeof document!="undefined"){var Wf=/Edge\/(\d+)/.exec(navigator.userAgent),Ay=/MSIE \d/.test(navigator.userAgent),Yf=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),qf=Rt.ie=!!(Ay||Yf||Wf);Rt.ie_version=Ay?document.documentMode||6:Yf?+Yf[1]:Wf?+Wf[1]:null,Rt.gecko=!qf&&/gecko\/(\d+)/i.test(navigator.userAgent),Rt.gecko_version=Rt.gecko&&+(/Firefox\/(\d+)/.exec(navigator.userAgent)||[0,0])[1];var Jf=!qf&&/Chrome\/(\d+)/.exec(navigator.userAgent);Rt.chrome=!!Jf,Rt.chrome_version=Jf&&+Jf[1],Rt.safari=!qf&&/Apple Computer/.test(navigator.vendor),Rt.ios=Rt.safari&&(/Mobile\/\w+/.test(navigator.userAgent)||navigator.maxTouchPoints>2),Rt.mac=Rt.ios||/Mac/.test(navigator.platform),Rt.android=/Android \d/.test(navigator.userAgent),Rt.webkit="webkitFontSmoothing"in document.documentElement.style,Rt.webkit_version=Rt.webkit&&+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]}var Wi=function(i){for(var r=0;;r++)if(i=i.previousSibling,!i)return r},nm=function(i){var r=i.assignedSlot||i.parentNode;return r&&r.nodeType==11?r.host:r},fy=null,_s=function(i,r,s){var a=fy||(fy=document.createRange());return a.setEnd(i,s==null?i.nodeValue.length:s),a.setStart(i,r||0),a},cu=function(i,r,s,a){return s&&(gy(i,r,s,a,-1)||gy(i,r,s,a,1))},cD=/^(img|br|input|textarea|hr)$/i;function gy(i,r,s,a,l){for(;;){if(i==s&&r==a)return!0;if(r==(l<0?0:Ko(i))){var h=i.parentNode;if(h.nodeType!=1||uD(i)||cD.test(i.nodeName)||i.contentEditable=="false")return!1;r=Wi(i)+(l<0?0:1),i=h}else if(i.nodeType==1){if(i=i.childNodes[r+(l<0?-1:0)],i.contentEditable=="false")return!1;r=l<0?Ko(i):0}else return!1}}function Ko(i){return i.nodeType==3?i.nodeValue.length:i.childNodes.length}function lD(i,r,s){for(var a=r==0,l=r==Ko(i);a||l;){if(i==s)return!0;var h=Wi(i);if(i=i.parentNode,!i)return!1;a=a&&h==0,l=l&&h==Ko(i)}}function uD(i){for(var r,s=i;s&&!(r=s.pmViewDesc);s=s.parentNode);return r&&r.node&&r.node.isBlock&&(r.dom==i||r.contentDOM==i)}var im=function(i){var r=i.isCollapsed;return r&&Rt.chrome&&i.rangeCount&&!i.getRangeAt(0).collapsed&&(r=!1),r};function Lc(i,r){var s=document.createEvent("Event");return s.initEvent("keydown",!0,!0),s.keyCode=i,s.key=s.code=r,s}function dD(i){return{left:0,right:i.documentElement.clientWidth,top:0,bottom:i.documentElement.clientHeight}}function zs(i,r){return typeof i=="number"?i:i[r]}function hD(i){var r=i.getBoundingClientRect(),s=r.width/i.offsetWidth||1,a=r.height/i.offsetHeight||1;return{left:r.left,right:r.left+i.clientWidth*s,top:r.top,bottom:r.top+i.clientHeight*a}}function my(i,r,s){for(var a=i.someProp("scrollThreshold")||0,l=i.someProp("scrollMargin")||5,h=i.dom.ownerDocument,A=s||i.dom;A;A=nm(A))if(A.nodeType==1){var m=A==h.body||A.nodeType!=1,v=m?dD(h):hD(A),C=0,S=0;if(r.top<v.top+zs(a,"top")?S=-(v.top-r.top+zs(l,"top")):r.bottom>v.bottom-zs(a,"bottom")&&(S=r.bottom-v.bottom+zs(l,"bottom")),r.left<v.left+zs(a,"left")?C=-(v.left-r.left+zs(l,"left")):r.right>v.right-zs(a,"right")&&(C=r.right-v.right+zs(l,"right")),C||S)if(m)h.defaultView.scrollBy(C,S);else{var b=A.scrollLeft,O=A.scrollTop;S&&(A.scrollTop+=S),C&&(A.scrollLeft+=C);var P=A.scrollLeft-b,F=A.scrollTop-O;r={left:r.left-P,top:r.top-F,right:r.right-P,bottom:r.bottom-F}}if(m)break}}function pD(i){for(var r=i.dom.getBoundingClientRect(),s=Math.max(0,r.top),a,l,h=(r.left+r.right)/2,A=s+1;A<Math.min(innerHeight,r.bottom);A+=5){var m=i.root.elementFromPoint(h,A);if(!(m==i.dom||!i.dom.contains(m))){var v=m.getBoundingClientRect();if(v.top>=s-20){a=m,l=v.top;break}}}return{refDOM:a,refTop:l,stack:ES(i.dom)}}function ES(i){for(var r=[],s=i.ownerDocument;i&&(r.push({dom:i,top:i.scrollTop,left:i.scrollLeft}),i!=s);i=nm(i));return r}function AD(i){var r=i.refDOM,s=i.refTop,a=i.stack,l=r?r.getBoundingClientRect().top:0;vS(a,l==0?0:l-s)}function vS(i,r){for(var s=0;s<i.length;s++){var a=i[s],l=a.dom,h=a.top,A=a.left;l.scrollTop!=h+r&&(l.scrollTop=h+r),l.scrollLeft!=A&&(l.scrollLeft=A)}}var Dc=null;function fD(i){if(i.setActive)return i.setActive();if(Dc)return i.focus(Dc);var r=ES(i);i.focus(Dc==null?{get preventScroll(){return Dc={preventScroll:!0},!0}}:void 0),Dc||(Dc=!1,vS(r,0))}function IS(i,r){for(var s,a=2e8,l,h=0,A=r.top,m=r.top,v=i.firstChild,C=0;v;v=v.nextSibling,C++){var S=void 0;if(v.nodeType==1)S=v.getClientRects();else if(v.nodeType==3)S=_s(v).getClientRects();else continue;for(var b=0;b<S.length;b++){var O=S[b];if(O.top<=A&&O.bottom>=m){A=Math.max(O.bottom,A),m=Math.min(O.top,m);var P=O.left>r.left?O.left-r.left:O.right<r.left?r.left-O.right:0;if(P<a){s=v,a=P,l=P&&s.nodeType==3?{left:O.right<r.left?O.right:O.left,top:r.top}:r,v.nodeType==1&&P&&(h=C+(r.left>=(O.left+O.right)/2?1:0));continue}}!s&&(r.left>=O.right&&r.top>=O.top||r.left>=O.left&&r.top>=O.bottom)&&(h=C+1)}}return s&&s.nodeType==3?gD(s,l):!s||a&&s.nodeType==1?{node:i,offset:h}:IS(s,l)}function gD(i,r){for(var s=i.nodeValue.length,a=document.createRange(),l=0;l<s;l++){a.setEnd(i,l+1),a.setStart(i,l);var h=Xs(a,1);if(h.top!=h.bottom&&om(r,h))return{node:i,offset:l+(r.left>=(h.left+h.right)/2?1:0)}}return{node:i,offset:0}}function om(i,r){return i.left>=r.left-1&&i.left<=r.right+1&&i.top>=r.top-1&&i.top<=r.bottom+1}function mD(i,r){var s=i.parentNode;return s&&/^li$/i.test(s.nodeName)&&r.left<i.getBoundingClientRect().left?s:i}function ED(i,r,s){var a=IS(r,s),l=a.node,h=a.offset,A=-1;if(l.nodeType==1&&!l.firstChild){var m=l.getBoundingClientRect();A=m.left!=m.right&&s.left>(m.left+m.right)/2?1:-1}return i.docView.posFromDOM(l,h,A)}function vD(i,r,s,a){for(var l=-1,h=r;h!=i.dom;){var A=i.docView.nearestDesc(h,!0);if(!A)return null;if(A.node.isBlock&&A.parent){var m=A.dom.getBoundingClientRect();if(m.left>a.left||m.top>a.top)l=A.posBefore;else if(m.right<a.left||m.bottom<a.top)l=A.posAfter;else break}h=A.dom.parentNode}return l>-1?l:i.docView.posFromDOM(r,s)}function CS(i,r,s){var a=i.childNodes.length;if(a&&s.top<s.bottom)for(var l=Math.max(0,Math.min(a-1,Math.floor(a*(r.top-s.top)/(s.bottom-s.top))-2)),h=l;;){var A=i.childNodes[h];if(A.nodeType==1)for(var m=A.getClientRects(),v=0;v<m.length;v++){var C=m[v];if(om(r,C))return CS(A,r,C)}if((h=(h+1)%a)==l)break}return i}function ID(i,r){var s,a,l=i.dom.ownerDocument,h,A;if(l.caretPositionFromPoint)try{var m=l.caretPositionFromPoint(r.left,r.top);m&&(s=m,h=s.offsetNode,A=s.offset)}catch{}if(!h&&l.caretRangeFromPoint){var v=l.caretRangeFromPoint(r.left,r.top);v&&(a=v,h=a.startContainer,A=a.startOffset)}var C=(i.root.elementFromPoint?i.root:l).elementFromPoint(r.left,r.top+1),S;if(!C||!i.dom.contains(C.nodeType!=1?C.parentNode:C)){var b=i.dom.getBoundingClientRect();if(!om(r,b)||(C=CS(i.dom,r,b),!C))return null}if(Rt.safari)for(var O=C;h&&O;O=nm(O))O.draggable&&(h=A=null);if(C=mD(C,r),h){if(Rt.gecko&&h.nodeType==1&&(A=Math.min(A,h.childNodes.length),A<h.childNodes.length)){var P=h.childNodes[A],F;P.nodeName=="IMG"&&(F=P.getBoundingClientRect()).right<=r.left&&F.bottom>r.top&&A++}h==i.dom&&A==h.childNodes.length-1&&h.lastChild.nodeType==1&&r.top>h.lastChild.getBoundingClientRect().bottom?S=i.state.doc.content.size:(A==0||h.nodeType!=1||h.childNodes[A-1].nodeName!="BR")&&(S=vD(i,h,A,r))}S==null&&(S=ED(i,C,r));var W=i.docView.nearestDesc(C,!0);return{pos:S,inside:W?W.posAtStart-W.border:-1}}function Xs(i,r){var s=i.getClientRects();return s.length?s[r<0?0:s.length-1]:i.getBoundingClientRect()}var CD=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function _S(i,r,s){var a=i.docView.domFromPos(r,s<0?-1:1),l=a.node,h=a.offset,A=Rt.webkit||Rt.gecko;if(l.nodeType==3)if(A&&(CD.test(l.nodeValue)||(s<0?!h:h==l.nodeValue.length))){var m=Xs(_s(l,h,h),s);if(Rt.gecko&&h&&/\s/.test(l.nodeValue[h-1])&&h<l.nodeValue.length){var v=Xs(_s(l,h-1,h-1),-1);if(v.top==m.top){var C=Xs(_s(l,h,h+1),-1);if(C.top!=m.top)return jl(C,C.left<v.left)}}return m}else{var S=h,b=h,O=s<0?1:-1;return s<0&&!h?(b++,O=-1):s>=0&&h==l.nodeValue.length?(S--,O=1):s<0?S--:b++,jl(Xs(_s(l,S,b),O),O<0)}if(!i.state.doc.resolve(r).parent.inlineContent){if(h&&(s<0||h==Ko(l))){var P=l.childNodes[h-1];if(P.nodeType==1)return zf(P.getBoundingClientRect(),!1)}if(h<Ko(l)){var F=l.childNodes[h];if(F.nodeType==1)return zf(F.getBoundingClientRect(),!0)}return zf(l.getBoundingClientRect(),s>=0)}if(h&&(s<0||h==Ko(l))){var W=l.childNodes[h-1],$=W.nodeType==3?_s(W,Ko(W)-(A?0:1)):W.nodeType==1&&(W.nodeName!="BR"||!W.nextSibling)?W:null;if($)return jl(Xs($,1),!1)}if(h<Ko(l)){for(var X=l.childNodes[h];X.pmViewDesc&&X.pmViewDesc.ignoreForCoords;)X=X.nextSibling;var K=X?X.nodeType==3?_s(X,0,A?0:1):X.nodeType==1?X:null:null;if(K)return jl(Xs(K,-1),!0)}return jl(Xs(l.nodeType==3?_s(l):l,-s),s>=0)}function jl(i,r){if(i.width==0)return i;var s=r?i.left:i.right;return{top:i.top,bottom:i.bottom,left:s,right:s}}function zf(i,r){if(i.height==0)return i;var s=r?i.top:i.bottom;return{top:s,bottom:s,left:i.left,right:i.right}}function yS(i,r,s){var a=i.state,l=i.root.activeElement;a!=r&&i.updateState(r),l!=i.dom&&i.focus();try{return s()}finally{a!=r&&i.updateState(a),l!=i.dom&&l&&l.focus()}}function _D(i,r,s){var a=r.selection,l=s=="up"?a.$from:a.$to;return yS(i,r,function(){for(var h=i.docView.domFromPos(l.pos,s=="up"?-1:1),A=h.node;;){var m=i.docView.nearestDesc(A,!0);if(!m)break;if(m.node.isBlock){A=m.dom;break}A=m.dom.parentNode}for(var v=_S(i,l.pos,1),C=A.firstChild;C;C=C.nextSibling){var S=void 0;if(C.nodeType==1)S=C.getClientRects();else if(C.nodeType==3)S=_s(C,0,C.nodeValue.length).getClientRects();else continue;for(var b=0;b<S.length;b++){var O=S[b];if(O.bottom>O.top+1&&(s=="up"?v.top-O.top>(O.bottom-v.top)*2:O.bottom-v.bottom>(v.bottom-O.top)*2))return!1}}return!0})}var yD=/[\u0590-\u08ac]/;function SD(i,r,s){var a=r.selection,l=a.$head;if(!l.parent.isTextblock)return!1;var h=l.parentOffset,A=!h,m=h==l.parent.content.size,v=i.root.getSelection();return!yD.test(l.parent.textContent)||!v.modify?s=="left"||s=="backward"?A:m:yS(i,r,function(){var C=v.getRangeAt(0),S=v.focusNode,b=v.focusOffset,O=v.caretBidiLevel;v.modify("move",s,"character");var P=l.depth?i.docView.domAfterPos(l.before()):i.dom,F=!P.contains(v.focusNode.nodeType==1?v.focusNode:v.focusNode.parentNode)||S==v.focusNode&&b==v.focusOffset;return v.removeAllRanges(),v.addRange(C),O!=null&&(v.caretBidiLevel=O),F})}var Ey=null,vy=null,Iy=!1;function TD(i,r,s){return Ey==r&&vy==s?Iy:(Ey=r,vy=s,Iy=s=="up"||s=="down"?_D(i,r,s):SD(i,r,s))}var ko=0,SS=1,zl=2,bs=3,pr=function(r,s,a,l){this.parent=r,this.children=s,this.dom=a,a.pmViewDesc=this,this.contentDOM=l,this.dirty=ko},Jo={size:{configurable:!0},border:{configurable:!0},posBefore:{configurable:!0},posAtStart:{configurable:!0},posAfter:{configurable:!0},posAtEnd:{configurable:!0},contentLost:{configurable:!0},domAtom:{configurable:!0},ignoreForCoords:{configurable:!0}};pr.prototype.matchesWidget=function(){return!1};pr.prototype.matchesMark=function(){return!1};pr.prototype.matchesNode=function(){return!1};pr.prototype.matchesHack=function(r){return!1};pr.prototype.parseRule=function(){return null};pr.prototype.stopEvent=function(){return!1};Jo.size.get=function(){for(var i=0,r=0;r<this.children.length;r++)i+=this.children[r].size;return i};Jo.border.get=function(){return 0};pr.prototype.destroy=function(){this.parent=null,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=null);for(var r=0;r<this.children.length;r++)this.children[r].destroy()};pr.prototype.posBeforeChild=function(r){for(var s=0,a=this.posAtStart;s<this.children.length;s++){var l=this.children[s];if(l==r)return a;a+=l.size}};Jo.posBefore.get=function(){return this.parent.posBeforeChild(this)};Jo.posAtStart.get=function(){return this.parent?this.parent.posBeforeChild(this)+this.border:0};Jo.posAfter.get=function(){return this.posBefore+this.size};Jo.posAtEnd.get=function(){return this.posAtStart+this.size-2*this.border};pr.prototype.localPosFromDOM=function(r,s,a){if(this.contentDOM&&this.contentDOM.contains(r.nodeType==1?r:r.parentNode))if(a<0){var l,h;if(r==this.contentDOM)l=r.childNodes[s-1];else{for(;r.parentNode!=this.contentDOM;)r=r.parentNode;l=r.previousSibling}for(;l&&!((h=l.pmViewDesc)&&h.parent==this);)l=l.previousSibling;return l?this.posBeforeChild(h)+h.size:this.posAtStart}else{var A,m;if(r==this.contentDOM)A=r.childNodes[s];else{for(;r.parentNode!=this.contentDOM;)r=r.parentNode;A=r.nextSibling}for(;A&&!((m=A.pmViewDesc)&&m.parent==this);)A=A.nextSibling;return A?this.posBeforeChild(m):this.posAtEnd}var v;if(r==this.dom&&this.contentDOM)v=s>Wi(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))v=r.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(s==0)for(var C=r;;C=C.parentNode){if(C==this.dom){v=!1;break}if(C.parentNode.firstChild!=C)break}if(v==null&&s==r.childNodes.length)for(var S=r;;S=S.parentNode){if(S==this.dom){v=!0;break}if(S.parentNode.lastChild!=S)break}}return(v==null?a>0:v)?this.posAtEnd:this.posAtStart};pr.prototype.nearestDesc=function(r,s){for(var a=!0,l=r;l;l=l.parentNode){var h=this.getDesc(l);if(h&&(!s||h.node))if(a&&h.nodeDOM&&!(h.nodeDOM.nodeType==1?h.nodeDOM.contains(r.nodeType==1?r:r.parentNode):h.nodeDOM==r))a=!1;else return h}};pr.prototype.getDesc=function(r){for(var s=r.pmViewDesc,a=s;a;a=a.parent)if(a==this)return s};pr.prototype.posFromDOM=function(r,s,a){for(var l=r;l;l=l.parentNode){var h=this.getDesc(l);if(h)return h.localPosFromDOM(r,s,a)}return-1};pr.prototype.descAt=function(r){for(var s=0,a=0;s<this.children.length;s++){var l=this.children[s],h=a+l.size;if(a==r&&h!=a){for(;!l.border&&l.children.length;)l=l.children[0];return l}if(r<h)return l.descAt(r-a-l.border);a=h}};pr.prototype.domFromPos=function(r,s){if(!this.contentDOM)return{node:this.dom,offset:0};for(var a=0,l=0,h=0;a<this.children.length;a++){var A=this.children[a],m=h+A.size;if(m>r||A instanceof bS){l=r-h;break}h=m}if(l)return this.children[a].domFromPos(l-this.children[a].border,s);for(var v=void 0;a&&!(v=this.children[a-1]).size&&v instanceof TS&&v.widget.type.side>=0;a--);if(s<=0){for(var C,S=!0;C=a?this.children[a-1]:null,!(!C||C.dom.parentNode==this.contentDOM);a--,S=!1);return C&&s&&S&&!C.border&&!C.domAtom?C.domFromPos(C.size,s):{node:this.contentDOM,offset:C?Wi(C.dom)+1:0}}else{for(var b,O=!0;b=a<this.children.length?this.children[a]:null,!(!b||b.dom.parentNode==this.contentDOM);a++,O=!1);return b&&O&&!b.border&&!b.domAtom?b.domFromPos(0,s):{node:this.contentDOM,offset:b?Wi(b.dom):this.contentDOM.childNodes.length}}};pr.prototype.parseRange=function(r,s,a){if(a===void 0&&(a=0),this.children.length==0)return{node:this.contentDOM,from:r,to:s,fromOffset:0,toOffset:this.contentDOM.childNodes.length};for(var l=-1,h=-1,A=a,m=0;;m++){var v=this.children[m],C=A+v.size;if(l==-1&&r<=C){var S=A+v.border;if(r>=S&&s<=C-v.border&&v.node&&v.contentDOM&&this.contentDOM.contains(v.contentDOM))return v.parseRange(r,s,S);r=A;for(var b=m;b>0;b--){var O=this.children[b-1];if(O.size&&O.dom.parentNode==this.contentDOM&&!O.emptyChildAt(1)){l=Wi(O.dom)+1;break}r-=O.size}l==-1&&(l=0)}if(l>-1&&(C>s||m==this.children.length-1)){s=C;for(var P=m+1;P<this.children.length;P++){var F=this.children[P];if(F.size&&F.dom.parentNode==this.contentDOM&&!F.emptyChildAt(-1)){h=Wi(F.dom);break}s+=F.size}h==-1&&(h=this.contentDOM.childNodes.length);break}A=C}return{node:this.contentDOM,from:r,to:s,fromOffset:l,toOffset:h}};pr.prototype.emptyChildAt=function(r){if(this.border||!this.contentDOM||!this.children.length)return!1;var s=this.children[r<0?0:this.children.length-1];return s.size==0||s.emptyChildAt(r)};pr.prototype.domAfterPos=function(r){var s=this.domFromPos(r,0),a=s.node,l=s.offset;if(a.nodeType!=1||l==a.childNodes.length)throw new RangeError("No node after pos "+r);return a.childNodes[l]};pr.prototype.setSelection=function(r,s,a,l){for(var h=Math.min(r,s),A=Math.max(r,s),m=0,v=0;m<this.children.length;m++){var C=this.children[m],S=v+C.size;if(h>v&&A<S)return C.setSelection(r-v-C.border,s-v-C.border,a,l);v=S}var b=this.domFromPos(r,r?-1:1),O=s==r?b:this.domFromPos(s,s?-1:1),P=a.getSelection(),F=!1;if((Rt.gecko||Rt.safari)&&r==s){var W=b.node,$=b.offset;if(W.nodeType==3){if(F=$&&W.nodeValue[$-1]==`
`,F&&$==W.nodeValue.length)for(var X=W,K=void 0;X;X=X.parentNode){if(K=X.nextSibling){K.nodeName=="BR"&&(b=O={node:K.parentNode,offset:Wi(K)+1});break}var _t=X.pmViewDesc;if(_t&&_t.node&&_t.node.isBlock)break}}else{var H=W.childNodes[$-1];F=H&&(H.nodeName=="BR"||H.contentEditable=="false")}}if(Rt.gecko&&P.focusNode&&P.focusNode!=O.node&&P.focusNode.nodeType==1){var ft=P.focusNode.childNodes[P.focusOffset];ft&&ft.contentEditable=="false"&&(l=!0)}if(!(!(l||F&&Rt.safari)&&cu(b.node,b.offset,P.anchorNode,P.anchorOffset)&&cu(O.node,O.offset,P.focusNode,P.focusOffset))){var Tt=!1;if((P.extend||r==s)&&!F){P.collapse(b.node,b.offset);try{r!=s&&P.extend(O.node,O.offset),Tt=!0}catch(Te){if(!(Te instanceof DOMException))throw Te}}if(!Tt){if(r>s){var $t=b;b=O,O=$t}var ne=document.createRange();ne.setEnd(O.node,O.offset),ne.setStart(b.node,b.offset),P.removeAllRanges(),P.addRange(ne)}}};pr.prototype.ignoreMutation=function(r){return!this.contentDOM&&r.type!="selection"};Jo.contentLost.get=function(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)};pr.prototype.markDirty=function(r,s){for(var a=0,l=0;l<this.children.length;l++){var h=this.children[l],A=a+h.size;if(a==A?r<=A&&s>=a:r<A&&s>a){var m=a+h.border,v=A-h.border;if(r>=m&&s<=v){this.dirty=r==a||s==A?zl:SS,r==m&&s==v&&(h.contentLost||h.dom.parentNode!=this.contentDOM)?h.dirty=bs:h.markDirty(r-m,s-m);return}else h.dirty=h.dom==h.contentDOM&&h.dom.parentNode==this.contentDOM&&!h.children.length?zl:bs}a=A}this.dirty=zl};pr.prototype.markParentsDirty=function(){for(var r=1,s=this.parent;s;s=s.parent,r++){var a=r==1?zl:SS;s.dirty<a&&(s.dirty=a)}};Jo.domAtom.get=function(){return!1};Jo.ignoreForCoords.get=function(){return!1};Object.defineProperties(pr.prototype,Jo);var na=[],TS=function(i){function r(a,l,h,A){var m,v=l.type.toDOM;if(typeof v=="function"&&(v=v(h,function(){if(!m)return A;if(m.parent)return m.parent.posBeforeChild(m)})),!l.type.spec.raw){if(v.nodeType!=1){var C=document.createElement("span");C.appendChild(v),v=C}v.contentEditable=!1,v.classList.add("ProseMirror-widget")}i.call(this,a,na,v,null),this.widget=l,m=this}i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r;var s={domAtom:{configurable:!0}};return r.prototype.matchesWidget=function(l){return this.dirty==ko&&l.type.eq(this.widget.type)},r.prototype.parseRule=function(){return{ignore:!0}},r.prototype.stopEvent=function(l){var h=this.widget.spec.stopEvent;return h?h(l):!1},r.prototype.ignoreMutation=function(l){return l.type!="selection"||this.widget.spec.ignoreSelection},r.prototype.destroy=function(){this.widget.type.destroy(this.dom),i.prototype.destroy.call(this)},s.domAtom.get=function(){return!0},Object.defineProperties(r.prototype,s),r}(pr),RD=function(i){function r(a,l,h,A){i.call(this,a,na,l,null),this.textDOM=h,this.text=A}i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r;var s={size:{configurable:!0}};return s.size.get=function(){return this.text.length},r.prototype.localPosFromDOM=function(l,h){return l!=this.textDOM?this.posAtStart+(h?this.size:0):this.posAtStart+h},r.prototype.domFromPos=function(l){return{node:this.textDOM,offset:l}},r.prototype.ignoreMutation=function(l){return l.type==="characterData"&&l.target.nodeValue==l.oldValue},Object.defineProperties(r.prototype,s),r}(pr),Bh=function(i){function r(s,a,l,h){i.call(this,s,[],l,h),this.mark=a}return i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r,r.create=function(a,l,h,A){var m=A.nodeViews[l.type.name],v=m&&m(l,A,h);return(!v||!v.dom)&&(v=Vn.renderSpec(document,l.type.spec.toDOM(l,h))),new r(a,l,v.dom,v.contentDOM||v.dom)},r.prototype.parseRule=function(){return this.dirty&bs||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}},r.prototype.matchesMark=function(a){return this.dirty!=bs&&this.mark.eq(a)},r.prototype.markDirty=function(a,l){if(i.prototype.markDirty.call(this,a,l),this.dirty!=ko){for(var h=this.parent;!h.node;)h=h.parent;h.dirty<this.dirty&&(h.dirty=this.dirty),this.dirty=ko}},r.prototype.slice=function(a,l,h){var A=r.create(this.parent,this.mark,!0,h),m=this.children,v=this.size;l<v&&(m=Sg(m,l,v,h)),a>0&&(m=Sg(m,0,a,h));for(var C=0;C<m.length;C++)m[C].parent=A;return A.children=m,A},r}(pr),Iu=function(i){function r(a,l,h,A,m,v,C,S,b){i.call(this,a,l.isLeaf?na:[],m,v),this.nodeDOM=C,this.node=l,this.outerDeco=h,this.innerDeco=A,v&&this.updateChildren(S,b)}i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r;var s={size:{configurable:!0},border:{configurable:!0},domAtom:{configurable:!0}};return r.create=function(l,h,A,m,v,C){var S,b=v.nodeViews[h.type.name],O,P=b&&b(h,v,function(){if(!O)return C;if(O.parent)return O.parent.posBeforeChild(O)},A,m),F=P&&P.dom,W=P&&P.contentDOM;if(h.isText){if(!F)F=document.createTextNode(h.text);else if(F.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else F||(S=Vn.renderSpec(document,h.type.spec.toDOM(h)),F=S.dom,W=S.contentDOM);!W&&!h.isText&&F.nodeName!="BR"&&(F.hasAttribute("contenteditable")||(F.contentEditable=!1),h.type.spec.draggable&&(F.draggable=!0));var $=F;return F=kS(F,A,h),P?O=new wD(l,h,A,m,F,W,$,P,v,C+1):h.isText?new wS(l,h,A,m,F,$,v):new r(l,h,A,m,F,W,$,v,C+1)},r.prototype.parseRule=function(){var l=this;if(this.node.type.spec.reparseInView)return null;var h={node:this.node.type.name,attrs:this.node.attrs};return this.node.type.whitespace=="pre"&&(h.preserveWhitespace="full"),this.contentDOM&&!this.contentLost?h.contentElement=this.contentDOM:h.getContent=function(){return l.contentDOM?Et.empty:l.node.content},h},r.prototype.matchesNode=function(l,h,A){return this.dirty==ko&&l.eq(this.node)&&yg(h,this.outerDeco)&&A.eq(this.innerDeco)},s.size.get=function(){return this.node.nodeSize},s.border.get=function(){return this.node.isLeaf?0:1},r.prototype.updateChildren=function(l,h){var A=this,m=this.node.inlineContent,v=h,C=l.composing&&this.localCompositionInfo(l,h),S=C&&C.pos>-1?C:null,b=C&&C.pos<0,O=new mo(this,S&&S.node);kD(this.node,this.innerDeco,function(P,F,W){P.spec.marks?O.syncToMarks(P.spec.marks,m,l):P.type.side>=0&&!W&&O.syncToMarks(F==A.node.childCount?Ge.none:A.node.child(F).marks,m,l),O.placeWidget(P,l,v)},function(P,F,W,$){O.syncToMarks(P.marks,m,l);var X;O.findNodeMatch(P,F,W,$)||b&&l.state.selection.from>v&&l.state.selection.to<v+P.nodeSize&&(X=O.findIndexWithChild(C.node))>-1&&O.updateNodeAt(P,F,W,X,l)||O.updateNextNode(P,F,W,l,$)||O.addNode(P,F,W,l,v),v+=P.nodeSize}),O.syncToMarks(na,m,l),this.node.isTextblock&&O.addTextblockHacks(),O.destroyRest(),(O.changed||this.dirty==zl)&&(S&&this.protectLocalComposition(l,S),NS(this.contentDOM,this.children,l),Rt.ios&&DD(this.dom))},r.prototype.localCompositionInfo=function(l,h){var A=l.state.selection,m=A.from,v=A.to;if(!(!(l.state.selection instanceof Fe)||m<h||v>h+this.node.content.size)){var C=l.root.getSelection(),S=BD(C.focusNode,C.focusOffset);if(!(!S||!this.dom.contains(S.parentNode)))if(this.node.inlineContent){var b=S.nodeValue,O=LD(this.node.content,b,m-h,v-h);return O<0?null:{node:S,pos:O,text:b}}else return{node:S,pos:-1}}},r.prototype.protectLocalComposition=function(l,h){var A=h.node,m=h.pos,v=h.text;if(!this.getDesc(A)){for(var C=A;C.parentNode!=this.contentDOM;C=C.parentNode){for(;C.previousSibling;)C.parentNode.removeChild(C.previousSibling);for(;C.nextSibling;)C.parentNode.removeChild(C.nextSibling);C.pmViewDesc&&(C.pmViewDesc=null)}var S=new RD(this,C,A,v);l.compositionNodes.push(S),this.children=Sg(this.children,m,m+v.length,l,S)}},r.prototype.update=function(l,h,A,m){return this.dirty==bs||!l.sameMarkup(this.node)?!1:(this.updateInner(l,h,A,m),!0)},r.prototype.updateInner=function(l,h,A,m){this.updateOuterDeco(h),this.node=l,this.innerDeco=A,this.contentDOM&&this.updateChildren(m,this.posAtStart),this.dirty=ko},r.prototype.updateOuterDeco=function(l){if(!yg(l,this.outerDeco)){var h=this.nodeDOM.nodeType!=1,A=this.dom;this.dom=OS(this.dom,this.nodeDOM,_g(this.outerDeco,this.node,h),_g(l,this.node,h)),this.dom!=A&&(A.pmViewDesc=null,this.dom.pmViewDesc=this),this.outerDeco=l}},r.prototype.selectNode=function(){this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.dom.draggable=!0)},r.prototype.deselectNode=function(){this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.dom.removeAttribute("draggable")},s.domAtom.get=function(){return this.node.isAtom},Object.defineProperties(r.prototype,s),r}(pr);function RS(i,r,s,a,l){return kS(a,r,i),new Iu(null,i,r,s,a,a,a,l,0)}var wS=function(i){function r(a,l,h,A,m,v,C){i.call(this,a,l,h,A,m,null,v,C)}i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r;var s={domAtom:{configurable:!0}};return r.prototype.parseRule=function(){for(var l=this.nodeDOM.parentNode;l&&l!=this.dom&&!l.pmIsDeco;)l=l.parentNode;return{skip:l||!0}},r.prototype.update=function(l,h,A,m){return this.dirty==bs||this.dirty!=ko&&!this.inParent()||!l.sameMarkup(this.node)?!1:(this.updateOuterDeco(h),(this.dirty!=ko||l.text!=this.node.text)&&l.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=l.text,m.trackWrites==this.nodeDOM&&(m.trackWrites=null)),this.node=l,this.dirty=ko,!0)},r.prototype.inParent=function(){for(var l=this.parent.contentDOM,h=this.nodeDOM;h;h=h.parentNode)if(h==l)return!0;return!1},r.prototype.domFromPos=function(l){return{node:this.nodeDOM,offset:l}},r.prototype.localPosFromDOM=function(l,h,A){return l==this.nodeDOM?this.posAtStart+Math.min(h,this.node.text.length):i.prototype.localPosFromDOM.call(this,l,h,A)},r.prototype.ignoreMutation=function(l){return l.type!="characterData"&&l.type!="selection"},r.prototype.slice=function(l,h,A){var m=this.node.cut(l,h),v=document.createTextNode(m.text);return new r(this.parent,m,this.outerDeco,this.innerDeco,v,v,A)},r.prototype.markDirty=function(l,h){i.prototype.markDirty.call(this,l,h),this.dom!=this.nodeDOM&&(l==0||h==this.nodeDOM.nodeValue.length)&&(this.dirty=bs)},s.domAtom.get=function(){return!1},Object.defineProperties(r.prototype,s),r}(Iu),bS=function(i){function r(){i.apply(this,arguments)}i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r;var s={domAtom:{configurable:!0},ignoreForCoords:{configurable:!0}};return r.prototype.parseRule=function(){return{ignore:!0}},r.prototype.matchesHack=function(l){return this.dirty==ko&&this.dom.nodeName==l},s.domAtom.get=function(){return!0},s.ignoreForCoords.get=function(){return this.dom.nodeName=="IMG"},Object.defineProperties(r.prototype,s),r}(pr),wD=function(i){function r(s,a,l,h,A,m,v,C,S,b){i.call(this,s,a,l,h,A,m,v,S,b),this.spec=C}return i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r,r.prototype.update=function(a,l,h,A){if(this.dirty==bs)return!1;if(this.spec.update){var m=this.spec.update(a,l,h);return m&&this.updateInner(a,l,h,A),m}else return!this.contentDOM&&!a.isLeaf?!1:i.prototype.update.call(this,a,l,h,A)},r.prototype.selectNode=function(){this.spec.selectNode?this.spec.selectNode():i.prototype.selectNode.call(this)},r.prototype.deselectNode=function(){this.spec.deselectNode?this.spec.deselectNode():i.prototype.deselectNode.call(this)},r.prototype.setSelection=function(a,l,h,A){this.spec.setSelection?this.spec.setSelection(a,l,h):i.prototype.setSelection.call(this,a,l,h,A)},r.prototype.destroy=function(){this.spec.destroy&&this.spec.destroy(),i.prototype.destroy.call(this)},r.prototype.stopEvent=function(a){return this.spec.stopEvent?this.spec.stopEvent(a):!1},r.prototype.ignoreMutation=function(a){return this.spec.ignoreMutation?this.spec.ignoreMutation(a):i.prototype.ignoreMutation.call(this,a)},r}(Iu);function NS(i,r,s){for(var a=i.firstChild,l=!1,h=0;h<r.length;h++){var A=r[h],m=A.dom;if(m.parentNode==i){for(;m!=a;)a=Cy(a),l=!0;a=a.nextSibling}else l=!0,i.insertBefore(m,a);if(A instanceof Bh){var v=a?a.previousSibling:i.lastChild;NS(A.contentDOM,A.children,s),a=v?v.nextSibling:i.firstChild}}for(;a;)a=Cy(a),l=!0;l&&s.trackWrites==i&&(s.trackWrites=null)}function Xl(i){i&&(this.nodeName=i)}Xl.prototype=Object.create(null);var Ma=[new Xl];function _g(i,r,s){if(i.length==0)return Ma;for(var a=s?Ma[0]:new Xl,l=[a],h=0;h<i.length;h++){var A=i[h].type.attrs;if(!!A){A.nodeName&&l.push(a=new Xl(A.nodeName));for(var m in A){var v=A[m];v!=null&&(s&&l.length==1&&l.push(a=new Xl(r.isInline?"span":"div")),m=="class"?a.class=(a.class?a.class+" ":"")+v:m=="style"?a.style=(a.style?a.style+";":"")+v:m!="nodeName"&&(a[m]=v))}}}return l}function OS(i,r,s,a){if(s==Ma&&a==Ma)return r;for(var l=r,h=0;h<a.length;h++){var A=a[h],m=s[h];if(h){var v=void 0;m&&m.nodeName==A.nodeName&&l!=i&&(v=l.parentNode)&&v.tagName.toLowerCase()==A.nodeName||(v=document.createElement(A.nodeName),v.pmIsDeco=!0,v.appendChild(l),m=Ma[0]),l=v}bD(l,m||Ma[0],A)}return l}function bD(i,r,s){for(var a in r)a!="class"&&a!="style"&&a!="nodeName"&&!(a in s)&&i.removeAttribute(a);for(var l in s)l!="class"&&l!="style"&&l!="nodeName"&&s[l]!=r[l]&&i.setAttribute(l,s[l]);if(r.class!=s.class){for(var h=r.class?r.class.split(" ").filter(Boolean):na,A=s.class?s.class.split(" ").filter(Boolean):na,m=0;m<h.length;m++)A.indexOf(h[m])==-1&&i.classList.remove(h[m]);for(var v=0;v<A.length;v++)h.indexOf(A[v])==-1&&i.classList.add(A[v]);i.classList.length==0&&i.removeAttribute("class")}if(r.style!=s.style){if(r.style)for(var C=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,S;S=C.exec(r.style);)i.style.removeProperty(S[1]);s.style&&(i.style.cssText+=s.style)}}function kS(i,r,s){return OS(i,i,Ma,_g(r,s,i.nodeType!=1))}function yg(i,r){if(i.length!=r.length)return!1;for(var s=0;s<i.length;s++)if(!i[s].type.eq(r[s].type))return!1;return!0}function Cy(i){var r=i.nextSibling;return i.parentNode.removeChild(i),r}var mo=function(r,s){this.top=r,this.lock=s,this.index=0,this.stack=[],this.changed=!1,this.preMatch=ND(r.node.content,r)};mo.prototype.destroyBetween=function(r,s){if(r!=s){for(var a=r;a<s;a++)this.top.children[a].destroy();this.top.children.splice(r,s-r),this.changed=!0}};mo.prototype.destroyRest=function(){this.destroyBetween(this.index,this.top.children.length)};mo.prototype.syncToMarks=function(r,s,a){for(var l=0,h=this.stack.length>>1,A=Math.min(h,r.length);l<A&&(l==h-1?this.top:this.stack[l+1<<1]).matchesMark(r[l])&&r[l].type.spec.spanning!==!1;)l++;for(;l<h;)this.destroyRest(),this.top.dirty=ko,this.index=this.stack.pop(),this.top=this.stack.pop(),h--;for(;h<r.length;){this.stack.push(this.top,this.index+1);for(var m=-1,v=this.index;v<Math.min(this.index+3,this.top.children.length);v++)if(this.top.children[v].matchesMark(r[h])){m=v;break}if(m>-1)m>this.index&&(this.changed=!0,this.destroyBetween(this.index,m)),this.top=this.top.children[this.index];else{var C=Bh.create(this.top,r[h],s,a);this.top.children.splice(this.index,0,C),this.top=C,this.changed=!0}this.index=0,h++}};mo.prototype.findNodeMatch=function(r,s,a,l){var h=-1,A;if(l>=this.preMatch.index&&(A=this.preMatch.matches[l-this.preMatch.index]).parent==this.top&&A.matchesNode(r,s,a))h=this.top.children.indexOf(A,this.index);else for(var m=this.index,v=Math.min(this.top.children.length,m+5);m<v;m++){var C=this.top.children[m];if(C.matchesNode(r,s,a)&&!this.preMatch.matched.has(C)){h=m;break}}return h<0?!1:(this.destroyBetween(this.index,h),this.index++,!0)};mo.prototype.updateNodeAt=function(r,s,a,l,h){var A=this.top.children[l];return A.update(r,s,a,h)?(this.destroyBetween(this.index,l),this.index=l+1,!0):!1};mo.prototype.findIndexWithChild=function(r){for(;;){var s=r.parentNode;if(!s)return-1;if(s==this.top.contentDOM){var a=r.pmViewDesc;if(a){for(var l=this.index;l<this.top.children.length;l++)if(this.top.children[l]==a)return l}return-1}r=s}};mo.prototype.updateNextNode=function(r,s,a,l,h){for(var A=this.index;A<this.top.children.length;A++){var m=this.top.children[A];if(m instanceof Iu){var v=this.preMatch.matched.get(m);if(v!=null&&v!=h)return!1;var C=m.dom,S=this.lock&&(C==this.lock||C.nodeType==1&&C.contains(this.lock.parentNode))&&!(r.isText&&m.node&&m.node.isText&&m.nodeDOM.nodeValue==r.text&&m.dirty!=bs&&yg(s,m.outerDeco));if(!S&&m.update(r,s,a,l))return this.destroyBetween(this.index,A),m.dom!=C&&(this.changed=!0),this.index++,!0;break}}return!1};mo.prototype.addNode=function(r,s,a,l,h){this.top.children.splice(this.index++,0,Iu.create(this.top,r,s,a,l,h)),this.changed=!0};mo.prototype.placeWidget=function(r,s,a){var l=this.index<this.top.children.length?this.top.children[this.index]:null;if(l&&l.matchesWidget(r)&&(r==l.widget||!l.widget.type.toDOM.parentNode))this.index++;else{var h=new TS(this.top,r,s,a);this.top.children.splice(this.index++,0,h),this.changed=!0}};mo.prototype.addTextblockHacks=function(){for(var r=this.top.children[this.index-1];r instanceof Bh;)r=r.children[r.children.length-1];(!r||!(r instanceof wS)||/\n$/.test(r.node.text))&&((Rt.safari||Rt.chrome)&&r&&r.dom.contentEditable=="false"&&this.addHackNode("IMG"),this.addHackNode("BR"))};mo.prototype.addHackNode=function(r){if(this.index<this.top.children.length&&this.top.children[this.index].matchesHack(r))this.index++;else{var s=document.createElement(r);r=="IMG"&&(s.className="ProseMirror-separator"),r=="BR"&&(s.className="ProseMirror-trailingBreak"),this.top.children.splice(this.index++,0,new bS(this.top,na,s,null)),this.changed=!0}};function ND(i,r){var s=r,a=s.children.length,l=i.childCount,h=new Map,A=[];t:for(;l>0;){for(var m=void 0;;)if(a){var v=s.children[a-1];if(v instanceof Bh)s=v,a=v.children.length;else{m=v,a--;break}}else{if(s==r)break t;a=s.parent.children.indexOf(s),s=s.parent}var C=m.node;if(!!C){if(C!=i.child(l-1))break;--l,h.set(m,l),A.push(m)}}return{index:l,matched:h,matches:A.reverse()}}function OD(i,r){return i.type.side-r.type.side}function kD(i,r,s,a){var l=r.locals(i),h=0;if(l.length==0){for(var A=0;A<i.childCount;A++){var m=i.child(A);a(m,l,r.forChild(h,m),A),h+=m.nodeSize}return}for(var v=0,C=[],S=null,b=0;;){if(v<l.length&&l[v].to==h){for(var O=l[v++],P=void 0;v<l.length&&l[v].to==h;)(P||(P=[O])).push(l[v++]);if(P){P.sort(OD);for(var F=0;F<P.length;F++)s(P[F],b,!!S)}else s(O,b,!!S)}var W=void 0,$=void 0;if(S)$=-1,W=S,S=null;else if(b<i.childCount)$=b,W=i.child(b++);else break;for(var X=0;X<C.length;X++)C[X].to<=h&&C.splice(X--,1);for(;v<l.length&&l[v].from<=h&&l[v].to>h;)C.push(l[v++]);var K=h+W.nodeSize;if(W.isText){var _t=K;v<l.length&&l[v].from<_t&&(_t=l[v].from);for(var H=0;H<C.length;H++)C[H].to<_t&&(_t=C[H].to);_t<K&&(S=W.cut(_t-h),W=W.cut(0,_t-h),K=_t,$=-1)}var ft=C.length?W.isInline&&!W.isLeaf?C.filter(function(Tt){return!Tt.inline}):C.slice():na;a(W,ft,r.forChild(h,W),$),h=K}}function DD(i){if(i.nodeName=="UL"||i.nodeName=="OL"){var r=i.style.cssText;i.style.cssText=r+"; list-style: square !important",window.getComputedStyle(i).listStyle,i.style.cssText=r}}function BD(i,r){for(;;){if(i.nodeType==3)return i;if(i.nodeType==1&&r>0){if(i.childNodes.length>r&&i.childNodes[r].nodeType==3)return i.childNodes[r];i=i.childNodes[r-1],r=Ko(i)}else if(i.nodeType==1&&r<i.childNodes.length)i=i.childNodes[r],r=0;else return null}}function LD(i,r,s,a){for(var l=0,h=0;l<i.childCount&&h<=a;){var A=i.child(l++),m=h;if(h+=A.nodeSize,!!A.isText){for(var v=A.text;l<i.childCount;){var C=i.child(l++);if(h+=C.nodeSize,!C.isText)break;v+=C.text}if(h>=s&&m<a){var S=v.lastIndexOf(r,a-m-1);if(S>=0&&S+r.length+m>=s)return m+S}}}return-1}function Sg(i,r,s,a,l){for(var h=[],A=0,m=0;A<i.length;A++){var v=i[A],C=m,S=m+=v.size;C>=s||S<=r?h.push(v):(C<r&&h.push(v.slice(0,r-C,a)),l&&(h.push(l),l=null),S>s&&h.push(v.slice(s-C,v.size,a)))}return h}function DS(i,r){var s=i.root.getSelection(),a=i.state.doc;if(!s.focusNode)return null;var l=i.docView.nearestDesc(s.focusNode),h=l&&l.size==0,A=i.docView.posFromDOM(s.focusNode,s.focusOffset);if(A<0)return null;var m=a.resolve(A),v,C;if(im(s)){for(v=m;l&&!l.node;)l=l.parent;if(l&&l.node.isAtom&&me.isSelectable(l.node)&&l.parent&&!(l.node.isInline&&lD(s.focusNode,s.focusOffset,l.dom))){var S=l.posBefore;C=new me(A==S?m:a.resolve(S))}}else{var b=i.docView.posFromDOM(s.anchorNode,s.anchorOffset);if(b<0)return null;v=a.resolve(b)}if(!C){var O=r=="pointer"||i.state.selection.head<m.pos&&!h?1:-1;C=sm(i,v,m,O)}return C}function BS(i){return i.editable?i.hasFocus():am(i)&&document.activeElement&&document.activeElement.contains(i.dom)}function aa(i,r){var s=i.state.selection;if(LS(i,s),!!BS(i)){if(!r&&i.mouseDown&&i.mouseDown.allowDefault&&Rt.chrome){var a=i.root.getSelection(),l=i.domObserver.currentSelection;if(a.anchorNode&&cu(a.anchorNode,a.anchorOffset,l.anchorNode,l.anchorOffset)){i.mouseDown.delayedSelectionSync=!0,i.domObserver.setCurSelection();return}}if(i.domObserver.disconnectSelection(),i.cursorWrapper)PD(i);else{var h=s.anchor,A=s.head,m,v;_y&&!(s instanceof Fe)&&(s.$from.parent.inlineContent||(m=yy(i,s.from)),!s.empty&&!s.$from.parent.inlineContent&&(v=yy(i,s.to))),i.docView.setSelection(h,A,i.root,r),_y&&(m&&Sy(m),v&&Sy(v)),s.visible?i.dom.classList.remove("ProseMirror-hideselection"):(i.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&MD(i))}i.domObserver.setCurSelection(),i.domObserver.connectSelection()}}var _y=Rt.safari||Rt.chrome&&Rt.chrome_version<63;function yy(i,r){var s=i.docView.domFromPos(r,0),a=s.node,l=s.offset,h=l<a.childNodes.length?a.childNodes[l]:null,A=l?a.childNodes[l-1]:null;if(Rt.safari&&h&&h.contentEditable=="false")return Xf(h);if((!h||h.contentEditable=="false")&&(!A||A.contentEditable=="false")){if(h)return Xf(h);if(A)return Xf(A)}}function Xf(i){return i.contentEditable="true",Rt.safari&&i.draggable&&(i.draggable=!1,i.wasDraggable=!0),i}function Sy(i){i.contentEditable="false",i.wasDraggable&&(i.draggable=!0,i.wasDraggable=null)}function MD(i){var r=i.dom.ownerDocument;r.removeEventListener("selectionchange",i.hideSelectionGuard);var s=i.root.getSelection(),a=s.anchorNode,l=s.anchorOffset;r.addEventListener("selectionchange",i.hideSelectionGuard=function(){(s.anchorNode!=a||s.anchorOffset!=l)&&(r.removeEventListener("selectionchange",i.hideSelectionGuard),setTimeout(function(){(!BS(i)||i.state.selection.visible)&&i.dom.classList.remove("ProseMirror-hideselection")},20))})}function PD(i){var r=i.root.getSelection(),s=document.createRange(),a=i.cursorWrapper.dom,l=a.nodeName=="IMG";l?s.setEnd(a.parentNode,Wi(a)+1):s.setEnd(a,0),s.collapse(!1),r.removeAllRanges(),r.addRange(s),!l&&!i.state.selection.visible&&Rt.ie&&Rt.ie_version<=11&&(a.disabled=!0,a.disabled=!1)}function LS(i,r){if(r instanceof me){var s=i.docView.descAt(r.from);s!=i.lastSelectedViewDesc&&(Ty(i),s&&s.selectNode(),i.lastSelectedViewDesc=s)}else Ty(i)}function Ty(i){i.lastSelectedViewDesc&&(i.lastSelectedViewDesc.parent&&i.lastSelectedViewDesc.deselectNode(),i.lastSelectedViewDesc=null)}function sm(i,r,s,a){return i.someProp("createSelectionBetween",function(l){return l(i,r,s)})||Fe.between(r,s,a)}function xD(i){return i.editable&&i.root.activeElement!=i.dom?!1:am(i)}function am(i){var r=i.root.getSelection();if(!r.anchorNode)return!1;try{return i.dom.contains(r.anchorNode.nodeType==3?r.anchorNode.parentNode:r.anchorNode)&&(i.editable||i.dom.contains(r.focusNode.nodeType==3?r.focusNode.parentNode:r.focusNode))}catch{return!1}}function UD(i){var r=i.docView.domFromPos(i.state.selection.anchor,0),s=i.root.getSelection();return cu(r.node,r.offset,s.anchorNode,s.anchorOffset)}function Tg(i,r){var s=i.selection,a=s.$anchor,l=s.$head,h=r>0?a.max(l):a.min(l),A=h.parent.inlineContent?h.depth?i.doc.resolve(r>0?h.after():h.before()):null:h;return A&&Ee.findFrom(A,r)}function La(i,r){return i.dispatch(i.state.tr.setSelection(r).scrollIntoView()),!0}function Ry(i,r,s){var a=i.state.selection;if(a instanceof Fe){if(!a.empty||s.indexOf("s")>-1)return!1;if(i.endOfTextblock(r>0?"right":"left")){var l=Tg(i.state,r);return l&&l instanceof me?La(i,l):!1}else if(!(Rt.mac&&s.indexOf("m")>-1)){var h=a.$head,A=h.textOffset?null:r<0?h.nodeBefore:h.nodeAfter,m;if(!A||A.isText)return!1;var v=r<0?h.pos-A.nodeSize:h.pos;return A.isAtom||(m=i.docView.descAt(v))&&!m.contentDOM?me.isSelectable(A)?La(i,new me(r<0?i.state.doc.resolve(h.pos-A.nodeSize):h)):Rt.webkit?La(i,new Fe(i.state.doc.resolve(r<0?v:v+A.nodeSize))):!1:!1}}else{if(a instanceof me&&a.node.isInline)return La(i,new Fe(r>0?a.$to:a.$from));var C=Tg(i.state,r);return C?La(i,C):!1}}function Ah(i){return i.nodeType==3?i.nodeValue.length:i.childNodes.length}function Zl(i){var r=i.pmViewDesc;return r&&r.size==0&&(i.nextSibling||i.nodeName!="BR")}function Zf(i){var r=i.root.getSelection(),s=r.focusNode,a=r.focusOffset;if(!!s){var l,h,A=!1;for(Rt.gecko&&s.nodeType==1&&a<Ah(s)&&Zl(s.childNodes[a])&&(A=!0);;)if(a>0){if(s.nodeType!=1)break;var m=s.childNodes[a-1];if(Zl(m))l=s,h=--a;else if(m.nodeType==3)s=m,a=s.nodeValue.length;else break}else{if(MS(s))break;for(var v=s.previousSibling;v&&Zl(v);)l=s.parentNode,h=Wi(v),v=v.previousSibling;if(v)s=v,a=Ah(s);else{if(s=s.parentNode,s==i.dom)break;a=0}}A?Rg(i,r,s,a):l&&Rg(i,r,l,h)}}function $f(i){var r=i.root.getSelection(),s=r.focusNode,a=r.focusOffset;if(!!s){for(var l=Ah(s),h,A;;)if(a<l){if(s.nodeType!=1)break;var m=s.childNodes[a];if(Zl(m))h=s,A=++a;else break}else{if(MS(s))break;for(var v=s.nextSibling;v&&Zl(v);)h=v.parentNode,A=Wi(v)+1,v=v.nextSibling;if(v)s=v,a=0,l=Ah(s);else{if(s=s.parentNode,s==i.dom)break;a=l=0}}h&&Rg(i,r,h,A)}}function MS(i){var r=i.pmViewDesc;return r&&r.node&&r.node.isBlock}function Rg(i,r,s,a){if(im(r)){var l=document.createRange();l.setEnd(s,a),l.setStart(s,a),r.removeAllRanges(),r.addRange(l)}else r.extend&&r.extend(s,a);i.domObserver.setCurSelection();var h=i.state;setTimeout(function(){i.state==h&&aa(i)},50)}function wy(i,r,s){var a=i.state.selection;if(a instanceof Fe&&!a.empty||s.indexOf("s")>-1||Rt.mac&&s.indexOf("m")>-1)return!1;var l=a.$from,h=a.$to;if(!l.parent.inlineContent||i.endOfTextblock(r<0?"up":"down")){var A=Tg(i.state,r);if(A&&A instanceof me)return La(i,A)}if(!l.parent.inlineContent){var m=r<0?l:h,v=a instanceof ks?Ee.near(m,r):Ee.findFrom(m,r);return v?La(i,v):!1}return!1}function by(i,r){if(!(i.state.selection instanceof Fe))return!0;var s=i.state.selection,a=s.$head,l=s.$anchor,h=s.empty;if(!a.sameParent(l))return!0;if(!h)return!1;if(i.endOfTextblock(r>0?"forward":"backward"))return!0;var A=!a.textOffset&&(r<0?a.nodeBefore:a.nodeAfter);if(A&&!A.isText){var m=i.state.tr;return r<0?m.delete(a.pos-A.nodeSize,a.pos):m.delete(a.pos,a.pos+A.nodeSize),i.dispatch(m),!0}return!1}function Ny(i,r,s){i.domObserver.stop(),r.contentEditable=s,i.domObserver.start()}function QD(i){if(!(!Rt.safari||i.state.selection.$head.parentOffset>0)){var r=i.root.getSelection(),s=r.focusNode,a=r.focusOffset;if(s&&s.nodeType==1&&a==0&&s.firstChild&&s.firstChild.contentEditable=="false"){var l=s.firstChild;Ny(i,l,!0),setTimeout(function(){return Ny(i,l,!1)},20)}}}function FD(i){var r="";return i.ctrlKey&&(r+="c"),i.metaKey&&(r+="m"),i.altKey&&(r+="a"),i.shiftKey&&(r+="s"),r}function VD(i,r){var s=r.keyCode,a=FD(r);return s==8||Rt.mac&&s==72&&a=="c"?by(i,-1)||Zf(i):s==46||Rt.mac&&s==68&&a=="c"?by(i,1)||$f(i):s==13||s==27?!0:s==37?Ry(i,-1,a)||Zf(i):s==39?Ry(i,1,a)||$f(i):s==38?wy(i,-1,a)||Zf(i):s==40?QD(i)||wy(i,1,a)||$f(i):a==(Rt.mac?"m":"c")&&(s==66||s==73||s==89||s==90)}function GD(i,r,s){var a=i.docView.parseRange(r,s),l=a.node,h=a.fromOffset,A=a.toOffset,m=a.from,v=a.to,C=i.root.getSelection(),S=null,b=C.anchorNode;if(b&&i.dom.contains(b.nodeType==1?b:b.parentNode)&&(S=[{node:b,offset:C.anchorOffset}],im(C)||S.push({node:C.focusNode,offset:C.focusOffset})),Rt.chrome&&i.lastKeyCode===8)for(var O=A;O>h;O--){var P=l.childNodes[O-1],F=P.pmViewDesc;if(P.nodeName=="BR"&&!F){A=O;break}if(!F||F.size)break}var W=i.state.doc,$=i.someProp("domParser")||Oo.fromSchema(i.state.schema),X=W.resolve(m),K=null,_t=$.parse(l,{topNode:X.parent,topMatch:X.parent.contentMatchAt(X.index()),topOpen:!0,from:h,to:A,preserveWhitespace:X.parent.type.whitespace=="pre"?"full":!0,editableContent:!0,findPositions:S,ruleFromNode:jD,context:X});if(S&&S[0].pos!=null){var H=S[0].pos,ft=S[1]&&S[1].pos;ft==null&&(ft=H),K={anchor:H+m,head:ft+m}}return{doc:_t,sel:K,from:m,to:v}}function jD(i){var r=i.pmViewDesc;if(r)return r.parseRule();if(i.nodeName=="BR"&&i.parentNode){if(Rt.safari&&/^(ul|ol)$/i.test(i.parentNode.nodeName)){var s=document.createElement("div");return s.appendChild(document.createElement("li")),{skip:s}}else if(i.parentNode.lastChild==i||Rt.safari&&/^(tr|table)$/i.test(i.parentNode.nodeName))return{ignore:!0}}else if(i.nodeName=="IMG"&&i.getAttribute("mark-placeholder"))return{ignore:!0}}function KD(i,r,s,a,l){if(r<0){var h=i.lastSelectionTime>Date.now()-50?i.lastSelectionOrigin:null,A=DS(i,h);if(A&&!i.state.selection.eq(A)){var m=i.state.tr.setSelection(A);h=="pointer"?m.setMeta("pointer",!0):h=="key"&&m.scrollIntoView(),i.dispatch(m)}return}var v=i.state.doc.resolve(r),C=v.sharedDepth(s);r=v.before(C+1),s=i.state.doc.resolve(s).after(C+1);var S=i.state.selection,b=GD(i,r,s);if(Rt.chrome&&i.cursorWrapper&&b.sel&&b.sel.anchor==i.cursorWrapper.deco.from){var O=i.cursorWrapper.deco.type.toDOM.nextSibling,P=O&&O.nodeValue?O.nodeValue.length:1;b.sel={anchor:b.sel.anchor+P,head:b.sel.anchor+P}}var F=i.state.doc,W=F.slice(b.from,b.to),$,X;i.lastKeyCode===8&&Date.now()-100<i.lastKeyCodeTime?($=i.state.selection.to,X="end"):($=i.state.selection.from,X="start"),i.lastKeyCode=null;var K=YD(W.content,b.doc.content,b.from,$,X);if(!K)if(a&&S instanceof Fe&&!S.empty&&S.$head.sameParent(S.$anchor)&&!i.composing&&!(b.sel&&b.sel.anchor!=b.sel.head))K={start:S.from,endA:S.to,endB:S.to};else if((Rt.ios&&i.lastIOSEnter>Date.now()-225||Rt.android)&&l.some(function(Le){return Le.nodeName=="DIV"||Le.nodeName=="P"})&&i.someProp("handleKeyDown",function(Le){return Le(i,Lc(13,"Enter"))})){i.lastIOSEnter=0;return}else{if(b.sel){var _t=Oy(i,i.state.doc,b.sel);_t&&!_t.eq(i.state.selection)&&i.dispatch(i.state.tr.setSelection(_t))}return}i.domChangeCount++,i.state.selection.from<i.state.selection.to&&K.start==K.endB&&i.state.selection instanceof Fe&&(K.start>i.state.selection.from&&K.start<=i.state.selection.from+2?K.start=i.state.selection.from:K.endA<i.state.selection.to&&K.endA>=i.state.selection.to-2&&(K.endB+=i.state.selection.to-K.endA,K.endA=i.state.selection.to)),Rt.ie&&Rt.ie_version<=11&&K.endB==K.start+1&&K.endA==K.start&&K.start>b.from&&b.doc.textBetween(K.start-b.from-1,K.start-b.from+1)==" \xA0"&&(K.start--,K.endA--,K.endB--);var H=b.doc.resolveNoCache(K.start-b.from),ft=b.doc.resolveNoCache(K.endB-b.from),Tt=H.sameParent(ft)&&H.parent.inlineContent,$t;if((Rt.ios&&i.lastIOSEnter>Date.now()-225&&(!Tt||l.some(function(Le){return Le.nodeName=="DIV"||Le.nodeName=="P"}))||!Tt&&H.pos<b.doc.content.size&&($t=Ee.findFrom(b.doc.resolve(H.pos+1),1,!0))&&$t.head==ft.pos)&&i.someProp("handleKeyDown",function(Le){return Le(i,Lc(13,"Enter"))})){i.lastIOSEnter=0;return}if(i.state.selection.anchor>K.start&&WD(F,K.start,K.endA,H,ft)&&i.someProp("handleKeyDown",function(Le){return Le(i,Lc(8,"Backspace"))})){Rt.android&&Rt.chrome&&i.domObserver.suppressSelectionUpdates();return}Rt.chrome&&Rt.android&&K.toB==K.from&&(i.lastAndroidDelete=Date.now()),Rt.android&&!Tt&&H.start()!=ft.start()&&ft.parentOffset==0&&H.depth==ft.depth&&b.sel&&b.sel.anchor==b.sel.head&&b.sel.head==K.endA&&(K.endB-=2,ft=b.doc.resolveNoCache(K.endB-b.from),setTimeout(function(){i.someProp("handleKeyDown",function(Le){return Le(i,Lc(13,"Enter"))})},20));var ne=K.start,Te=K.endA,ve,qe,Xe,je;if(Tt){if(H.pos==ft.pos)Rt.ie&&Rt.ie_version<=11&&H.parentOffset==0&&(i.domObserver.suppressSelectionUpdates(),setTimeout(function(){return aa(i)},20)),ve=i.state.tr.delete(ne,Te),qe=F.resolve(K.start).marksAcross(F.resolve(K.endA));else if(K.endA==K.endB&&(je=F.resolve(K.start))&&(Xe=HD(H.parent.content.cut(H.parentOffset,ft.parentOffset),je.parent.content.cut(je.parentOffset,K.endA-je.start()))))ve=i.state.tr,Xe.type=="add"?ve.addMark(ne,Te,Xe.mark):ve.removeMark(ne,Te,Xe.mark);else if(H.parent.child(H.index()).isText&&H.index()==ft.index()-(ft.textOffset?0:1)){var mn=H.parent.textBetween(H.parentOffset,ft.parentOffset);if(i.someProp("handleTextInput",function(Le){return Le(i,ne,Te,mn)}))return;ve=i.state.tr.insertText(mn,ne,Te)}}if(ve||(ve=i.state.tr.replace(ne,Te,b.doc.slice(K.start-b.from,K.endB-b.from))),b.sel){var sr=Oy(i,ve.doc,b.sel);sr&&!(Rt.chrome&&Rt.android&&i.composing&&sr.empty&&(K.start!=K.endB||i.lastAndroidDelete<Date.now()-100)&&(sr.head==ne||sr.head==ve.mapping.map(Te)-1)||Rt.ie&&sr.empty&&sr.head==ne)&&ve.setSelection(sr)}qe&&ve.ensureMarks(qe),i.dispatch(ve.scrollIntoView())}function Oy(i,r,s){return Math.max(s.anchor,s.head)>r.content.size?null:sm(i,r.resolve(s.anchor),r.resolve(s.head))}function HD(i,r){for(var s=i.firstChild.marks,a=r.firstChild.marks,l=s,h=a,A,m,v,C=0;C<a.length;C++)l=a[C].removeFromSet(l);for(var S=0;S<s.length;S++)h=s[S].removeFromSet(h);if(l.length==1&&h.length==0)m=l[0],A="add",v=function(P){return P.mark(m.addToSet(P.marks))};else if(l.length==0&&h.length==1)m=h[0],A="remove",v=function(P){return P.mark(m.removeFromSet(P.marks))};else return null;for(var b=[],O=0;O<r.childCount;O++)b.push(v(r.child(O)));if(Et.from(b).eq(i))return{mark:m,type:A}}function WD(i,r,s,a,l){if(!a.parent.isTextblock||s-r<=l.pos-a.pos||tg(a,!0,!1)<l.pos)return!1;var h=i.resolve(r);if(h.parentOffset<h.parent.content.size||!h.parent.isTextblock)return!1;var A=i.resolve(tg(h,!0,!0));return!A.parent.isTextblock||A.pos>s||tg(A,!0,!1)<s?!1:a.parent.content.cut(a.parentOffset).eq(A.parent.content)}function tg(i,r,s){for(var a=i.depth,l=r?i.end():i.pos;a>0&&(r||i.indexAfter(a)==i.node(a).childCount);)a--,l++,r=!1;if(s)for(var h=i.node(a).maybeChild(i.indexAfter(a));h&&!h.isLeaf;)h=h.firstChild,l++;return l}function YD(i,r,s,a,l){var h=i.findDiffStart(r,s);if(h==null)return null;var A=i.findDiffEnd(r,s+i.size,s+r.size),m=A.a,v=A.b;if(l=="end"){var C=Math.max(0,h-Math.min(m,v));a-=m+C-h}if(m<h&&i.size<r.size){var S=a<=h&&a>=m?h-a:0;h-=S,v=h+(v-m),m=h}else if(v<h){var b=a<=h&&a>=v?h-a:0;h-=b,m=h+(m-v),v=h}return{start:h,endA:m,endB:v}}function PS(i,r){for(var s=[],a=r.content,l=r.openStart,h=r.openEnd;l>1&&h>1&&a.childCount==1&&a.firstChild.childCount==1;){l--,h--;var A=a.firstChild;s.push(A.type.name,A.attrs!=A.type.defaultAttrs?A.attrs:null),a=A.content}var m=i.someProp("clipboardSerializer")||Vn.fromSchema(i.state.schema),v=GS(),C=v.createElement("div");C.appendChild(m.serializeFragment(a,{document:v}));for(var S=C.firstChild,b;S&&S.nodeType==1&&(b=VS[S.nodeName.toLowerCase()]);){for(var O=b.length-1;O>=0;O--){for(var P=v.createElement(b[O]);C.firstChild;)P.appendChild(C.firstChild);C.appendChild(P),b[O]!="tbody"&&(l++,h++)}S=C.firstChild}S&&S.nodeType==1&&S.setAttribute("data-pm-slice",l+" "+h+" "+JSON.stringify(s));var F=i.someProp("clipboardTextSerializer",function(W){return W(r)})||r.content.textBetween(0,r.content.size,`

`);return{dom:C,text:F}}function xS(i,r,s,a,l){var h,A=l.parent.type.spec.code,m;if(!s&&!r)return null;var v=r&&(a||A||!s);if(v){if(i.someProp("transformPastedText",function(ft){r=ft(r,A||a)}),A)return r?new Pt(Et.from(i.state.schema.text(r.replace(/\r\n?/g,`
`))),0,0):Pt.empty;var C=i.someProp("clipboardTextParser",function(ft){return ft(r,l,a)});if(C)m=C;else{var S=l.marks(),b=i.state,O=b.schema,P=Vn.fromSchema(O);h=document.createElement("div"),r.split(/(?:\r\n?|\n)+/).forEach(function(ft){var Tt=h.appendChild(document.createElement("p"));ft&&Tt.appendChild(P.serializeNode(O.text(ft,S)))})}}else i.someProp("transformPastedHTML",function(ft){s=ft(s)}),h=zD(s),Rt.webkit&&XD(h);var F=h&&h.querySelector("[data-pm-slice]"),W=F&&/^(\d+) (\d+) (.*)/.exec(F.getAttribute("data-pm-slice"));if(!m){var $=i.someProp("clipboardParser")||i.someProp("domParser")||Oo.fromSchema(i.state.schema);m=$.parseSlice(h,{preserveWhitespace:!!(v||W),context:l,ruleFromNode:function(Tt){if(Tt.nodeName=="BR"&&!Tt.nextSibling&&Tt.parentNode&&!qD.test(Tt.parentNode.nodeName))return{ignore:!0}}})}if(W)m=ZD(ky(m,+W[1],+W[2]),W[3]);else if(m=Pt.maxOpen(JD(m.content,l),!0),m.openStart||m.openEnd){for(var X=0,K=0,_t=m.content.firstChild;X<m.openStart&&!_t.type.spec.isolating;X++,_t=_t.firstChild);for(var H=m.content.lastChild;K<m.openEnd&&!H.type.spec.isolating;K++,H=H.lastChild);m=ky(m,X,K)}return i.someProp("transformPasted",function(ft){m=ft(m)}),m}var qD=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function JD(i,r){if(i.childCount<2)return i;for(var s=function(h){var A=r.node(h),m=A.contentMatchAt(r.index(h)),v=void 0,C=[];if(i.forEach(function(S){if(!!C){var b=m.findWrapping(S.type),O;if(!b)return C=null;if(O=C.length&&v.length&&QS(b,v,S,C[C.length-1],0))C[C.length-1]=O;else{C.length&&(C[C.length-1]=FS(C[C.length-1],v.length));var P=US(S,b);C.push(P),m=m.matchType(P.type,P.attrs),v=b}}}),C)return{v:Et.from(C)}},a=r.depth;a>=0;a--){var l=s(a);if(l)return l.v}return i}function US(i,r,s){s===void 0&&(s=0);for(var a=r.length-1;a>=s;a--)i=r[a].create(null,Et.from(i));return i}function QS(i,r,s,a,l){if(l<i.length&&l<r.length&&i[l]==r[l]){var h=QS(i,r,s,a.lastChild,l+1);if(h)return a.copy(a.content.replaceChild(a.childCount-1,h));var A=a.contentMatchAt(a.childCount);if(A.matchType(l==i.length-1?s.type:i[l+1]))return a.copy(a.content.append(Et.from(US(s,i,l+1))))}}function FS(i,r){if(r==0)return i;var s=i.content.replaceChild(i.childCount-1,FS(i.lastChild,r-1)),a=i.contentMatchAt(i.childCount).fillBefore(Et.empty,!0);return i.copy(s.append(a))}function wg(i,r,s,a,l,h){var A=r<0?i.firstChild:i.lastChild,m=A.content;return l<a-1&&(m=wg(m,r,s,a,l+1,h)),l>=s&&(m=r<0?A.contentMatchAt(0).fillBefore(m,i.childCount>1||h<=l).append(m):m.append(A.contentMatchAt(A.childCount).fillBefore(Et.empty,!0))),i.replaceChild(r<0?0:i.childCount-1,A.copy(m))}function ky(i,r,s){return r<i.openStart&&(i=new Pt(wg(i.content,-1,r,i.openStart,0,i.openEnd),r,i.openEnd)),s<i.openEnd&&(i=new Pt(wg(i.content,1,s,i.openEnd,0,0),i.openStart,s)),i}var VS={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]},Dy=null;function GS(){return Dy||(Dy=document.implementation.createHTMLDocument("title"))}function zD(i){var r=/^(\s*<meta [^>]*>)*/.exec(i);r&&(i=i.slice(r[0].length));var s=GS().createElement("div"),a=/<([a-z][^>\s]+)/i.exec(i),l;if((l=a&&VS[a[1].toLowerCase()])&&(i=l.map(function(A){return"<"+A+">"}).join("")+i+l.map(function(A){return"</"+A+">"}).reverse().join("")),s.innerHTML=i,l)for(var h=0;h<l.length;h++)s=s.querySelector(l[h])||s;return s}function XD(i){for(var r=i.querySelectorAll(Rt.chrome?"span:not([class]):not([style])":"span.Apple-converted-space"),s=0;s<r.length;s++){var a=r[s];a.childNodes.length==1&&a.textContent=="\xA0"&&a.parentNode&&a.parentNode.replaceChild(i.ownerDocument.createTextNode(" "),a)}}function ZD(i,r){if(!i.size)return i;var s=i.content.firstChild.type.schema,a;try{a=JSON.parse(r)}catch{return i}for(var l=i.content,h=i.openStart,A=i.openEnd,m=a.length-2;m>=0;m-=2){var v=s.nodes[a[m]];if(!v||v.hasRequiredAttrs())break;l=Et.from(v.create(a[m+1],l)),h++,A++}return new Pt(l,h,A)}var $D={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},cm=Rt.ie&&Rt.ie_version<=11,lm=function(){this.anchorNode=this.anchorOffset=this.focusNode=this.focusOffset=null};lm.prototype.set=function(r){this.anchorNode=r.anchorNode,this.anchorOffset=r.anchorOffset,this.focusNode=r.focusNode,this.focusOffset=r.focusOffset};lm.prototype.eq=function(r){return r.anchorNode==this.anchorNode&&r.anchorOffset==this.anchorOffset&&r.focusNode==this.focusNode&&r.focusOffset==this.focusOffset};var qi=function(r,s){var a=this;this.view=r,this.handleDOMChange=s,this.queue=[],this.flushingSoon=-1,this.observer=window.MutationObserver&&new window.MutationObserver(function(l){for(var h=0;h<l.length;h++)a.queue.push(l[h]);Rt.ie&&Rt.ie_version<=11&&l.some(function(A){return A.type=="childList"&&A.removedNodes.length||A.type=="characterData"&&A.oldValue.length>A.target.nodeValue.length})?a.flushSoon():a.flush()}),this.currentSelection=new lm,cm&&(this.onCharData=function(l){a.queue.push({target:l.target,type:"characterData",oldValue:l.prevValue}),a.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.suppressingSelectionUpdates=!1};qi.prototype.flushSoon=function(){var r=this;this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(function(){r.flushingSoon=-1,r.flush()},20))};qi.prototype.forceFlush=function(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())};qi.prototype.start=function(){this.observer&&this.observer.observe(this.view.dom,$D),cm&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()};qi.prototype.stop=function(){var r=this;if(this.observer){var s=this.observer.takeRecords();if(s.length){for(var a=0;a<s.length;a++)this.queue.push(s[a]);window.setTimeout(function(){return r.flush()},20)}this.observer.disconnect()}cm&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()};qi.prototype.connectSelection=function(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)};qi.prototype.disconnectSelection=function(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)};qi.prototype.suppressSelectionUpdates=function(){var r=this;this.suppressingSelectionUpdates=!0,setTimeout(function(){return r.suppressingSelectionUpdates=!1},50)};qi.prototype.onSelectionChange=function(){if(!!xD(this.view)){if(this.suppressingSelectionUpdates)return aa(this.view);if(Rt.ie&&Rt.ie_version<=11&&!this.view.state.selection.empty){var r=this.view.root.getSelection();if(r.focusNode&&cu(r.focusNode,r.focusOffset,r.anchorNode,r.anchorOffset))return this.flushSoon()}this.flush()}};qi.prototype.setCurSelection=function(){this.currentSelection.set(this.view.root.getSelection())};qi.prototype.ignoreSelectionChange=function(r){if(r.rangeCount==0)return!0;var s=r.getRangeAt(0).commonAncestorContainer,a=this.view.docView.nearestDesc(s);if(a&&a.ignoreMutation({type:"selection",target:s.nodeType==3?s.parentNode:s}))return this.setCurSelection(),!0};qi.prototype.flush=function(){if(!(!this.view.docView||this.flushingSoon>-1)){var r=this.observer?this.observer.takeRecords():[];this.queue.length&&(r=this.queue.concat(r),this.queue.length=0);var s=this.view.root.getSelection(),a=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(s)&&am(this.view)&&!this.ignoreSelectionChange(s),l=-1,h=-1,A=!1,m=[];if(this.view.editable)for(var v=0;v<r.length;v++){var C=this.registerMutation(r[v],m);C&&(l=l<0?C.from:Math.min(C.from,l),h=h<0?C.to:Math.max(C.to,h),C.typeOver&&(A=!0))}if(Rt.gecko&&m.length>1){var S=m.filter(function(P){return P.nodeName=="BR"});if(S.length==2){var b=S[0],O=S[1];b.parentNode&&b.parentNode.parentNode==O.parentNode?O.remove():b.remove()}}(l>-1||a)&&(l>-1&&(this.view.docView.markDirty(l,h),tB(this.view)),this.handleDOMChange(l,h,A,m),this.view.docView.dirty?this.view.updateState(this.view.state):this.currentSelection.eq(s)||aa(this.view),this.currentSelection.set(s))}};qi.prototype.registerMutation=function(r,s){if(s.indexOf(r.target)>-1)return null;var a=this.view.docView.nearestDesc(r.target);if(r.type=="attributes"&&(a==this.view.docView||r.attributeName=="contenteditable"||r.attributeName=="style"&&!r.oldValue&&!r.target.getAttribute("style"))||!a||a.ignoreMutation(r))return null;if(r.type=="childList"){for(var l=0;l<r.addedNodes.length;l++)s.push(r.addedNodes[l]);if(a.contentDOM&&a.contentDOM!=a.dom&&!a.contentDOM.contains(r.target))return{from:a.posBefore,to:a.posAfter};var h=r.previousSibling,A=r.nextSibling;if(Rt.ie&&Rt.ie_version<=11&&r.addedNodes.length)for(var m=0;m<r.addedNodes.length;m++){var v=r.addedNodes[m],C=v.previousSibling,S=v.nextSibling;(!C||Array.prototype.indexOf.call(r.addedNodes,C)<0)&&(h=C),(!S||Array.prototype.indexOf.call(r.addedNodes,S)<0)&&(A=S)}var b=h&&h.parentNode==r.target?Wi(h)+1:0,O=a.localPosFromDOM(r.target,b,-1),P=A&&A.parentNode==r.target?Wi(A):r.target.childNodes.length,F=a.localPosFromDOM(r.target,P,1);return{from:O,to:F}}else return r.type=="attributes"?{from:a.posAtStart-a.border,to:a.posAtEnd+a.border}:{from:a.posAtStart,to:a.posAtEnd,typeOver:r.target.nodeValue==r.oldValue}};var By=!1;function tB(i){By||(By=!0,getComputedStyle(i.dom).whiteSpace=="normal"&&console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."))}var Oi={},gi={};function eB(i){i.shiftKey=!1,i.mouseDown=null,i.lastKeyCode=null,i.lastKeyCodeTime=0,i.lastClick={time:0,x:0,y:0,type:""},i.lastSelectionOrigin=null,i.lastSelectionTime=0,i.lastIOSEnter=0,i.lastIOSEnterFallbackTimeout=null,i.lastAndroidDelete=0,i.composing=!1,i.composingTimeout=null,i.compositionNodes=[],i.compositionEndedAt=-2e8,i.domObserver=new qi(i,function(a,l,h,A){return KD(i,a,l,h,A)}),i.domObserver.start(),i.domChangeCount=0,i.eventHandlers=Object.create(null);var r=function(a){var l=Oi[a];i.dom.addEventListener(a,i.eventHandlers[a]=function(h){nB(i,h)&&!dm(i,h)&&(i.editable||!(h.type in gi))&&l(i,h)})};for(var s in Oi)r(s);Rt.safari&&i.dom.addEventListener("input",function(){return null}),um(i)}function Va(i,r){i.lastSelectionOrigin=r,i.lastSelectionTime=Date.now()}function rB(i){i.domObserver.stop();for(var r in i.eventHandlers)i.dom.removeEventListener(r,i.eventHandlers[r]);clearTimeout(i.composingTimeout),clearTimeout(i.lastIOSEnterFallbackTimeout)}function um(i){i.someProp("handleDOMEvents",function(r){for(var s in r)i.eventHandlers[s]||i.dom.addEventListener(s,i.eventHandlers[s]=function(a){return dm(i,a)})})}function dm(i,r){return i.someProp("handleDOMEvents",function(s){var a=s[r.type];return a?a(i,r)||r.defaultPrevented:!1})}function nB(i,r){if(!r.bubbles)return!0;if(r.defaultPrevented)return!1;for(var s=r.target;s!=i.dom;s=s.parentNode)if(!s||s.nodeType==11||s.pmViewDesc&&s.pmViewDesc.stopEvent(r))return!1;return!0}function iB(i,r){!dm(i,r)&&Oi[r.type]&&(i.editable||!(r.type in gi))&&Oi[r.type](i,r)}gi.keydown=function(i,r){if(i.shiftKey=r.keyCode==16||r.shiftKey,!KS(i,r)&&(i.lastKeyCode=r.keyCode,i.lastKeyCodeTime=Date.now(),!(Rt.android&&Rt.chrome&&r.keyCode==13)))if(r.keyCode!=229&&i.domObserver.forceFlush(),Rt.ios&&r.keyCode==13&&!r.ctrlKey&&!r.altKey&&!r.metaKey){var s=Date.now();i.lastIOSEnter=s,i.lastIOSEnterFallbackTimeout=setTimeout(function(){i.lastIOSEnter==s&&(i.someProp("handleKeyDown",function(a){return a(i,Lc(13,"Enter"))}),i.lastIOSEnter=0)},200)}else i.someProp("handleKeyDown",function(a){return a(i,r)})||VD(i,r)?r.preventDefault():Va(i,"key")};gi.keyup=function(i,r){r.keyCode==16&&(i.shiftKey=!1)};gi.keypress=function(i,r){if(!(KS(i,r)||!r.charCode||r.ctrlKey&&!r.altKey||Rt.mac&&r.metaKey)){if(i.someProp("handleKeyPress",function(l){return l(i,r)})){r.preventDefault();return}var s=i.state.selection;if(!(s instanceof Fe)||!s.$from.sameParent(s.$to)){var a=String.fromCharCode(r.charCode);i.someProp("handleTextInput",function(l){return l(i,s.$from.pos,s.$to.pos,a)})||i.dispatch(i.state.tr.insertText(a).scrollIntoView()),r.preventDefault()}}};function Lh(i){return{left:i.clientX,top:i.clientY}}function oB(i,r){var s=r.x-i.clientX,a=r.y-i.clientY;return s*s+a*a<100}function hm(i,r,s,a,l){if(a==-1)return!1;for(var h=i.state.doc.resolve(a),A=function(C){if(i.someProp(r,function(S){return C>h.depth?S(i,s,h.nodeAfter,h.before(C),l,!0):S(i,s,h.node(C),h.before(C),l,!1)}))return{v:!0}},m=h.depth+1;m>0;m--){var v=A(m);if(v)return v.v}return!1}function xc(i,r,s){i.focused||i.focus();var a=i.state.tr.setSelection(r);s=="pointer"&&a.setMeta("pointer",!0),i.dispatch(a)}function sB(i,r){if(r==-1)return!1;var s=i.state.doc.resolve(r),a=s.nodeAfter;return a&&a.isAtom&&me.isSelectable(a)?(xc(i,new me(s),"pointer"),!0):!1}function aB(i,r){if(r==-1)return!1;var s=i.state.selection,a,l;s instanceof me&&(a=s.node);for(var h=i.state.doc.resolve(r),A=h.depth+1;A>0;A--){var m=A>h.depth?h.nodeAfter:h.node(A);if(me.isSelectable(m)){a&&s.$from.depth>0&&A>=s.$from.depth&&h.before(s.$from.depth+1)==s.$from.pos?l=h.before(s.$from.depth):l=h.before(A);break}}return l!=null?(xc(i,me.create(i.state.doc,l),"pointer"),!0):!1}function cB(i,r,s,a,l){return hm(i,"handleClickOn",r,s,a)||i.someProp("handleClick",function(h){return h(i,r,a)})||(l?aB(i,s):sB(i,s))}function lB(i,r,s,a){return hm(i,"handleDoubleClickOn",r,s,a)||i.someProp("handleDoubleClick",function(l){return l(i,r,a)})}function uB(i,r,s,a){return hm(i,"handleTripleClickOn",r,s,a)||i.someProp("handleTripleClick",function(l){return l(i,r,a)})||dB(i,s,a)}function dB(i,r,s){if(s.button!=0)return!1;var a=i.state.doc;if(r==-1)return a.inlineContent?(xc(i,Fe.create(a,0,a.content.size),"pointer"),!0):!1;for(var l=a.resolve(r),h=l.depth+1;h>0;h--){var A=h>l.depth?l.nodeAfter:l.node(h),m=l.before(h);if(A.inlineContent)xc(i,Fe.create(a,m+1,m+1+A.content.size),"pointer");else if(me.isSelectable(A))xc(i,me.create(a,m),"pointer");else continue;return!0}}function pm(i){return fh(i)}var jS=Rt.mac?"metaKey":"ctrlKey";Oi.mousedown=function(i,r){i.shiftKey=r.shiftKey;var s=pm(i),a=Date.now(),l="singleClick";a-i.lastClick.time<500&&oB(r,i.lastClick)&&!r[jS]&&(i.lastClick.type=="singleClick"?l="doubleClick":i.lastClick.type=="doubleClick"&&(l="tripleClick")),i.lastClick={time:a,x:r.clientX,y:r.clientY,type:l};var h=i.posAtCoords(Lh(r));!h||(l=="singleClick"?(i.mouseDown&&i.mouseDown.done(),i.mouseDown=new Mh(i,h,r,s)):(l=="doubleClick"?lB:uB)(i,h.pos,h.inside,r)?r.preventDefault():Va(i,"pointer"))};var Mh=function(r,s,a,l){var h=this;this.view=r,this.startDoc=r.state.doc,this.pos=s,this.event=a,this.flushed=l,this.selectNode=a[jS],this.allowDefault=a.shiftKey,this.delayedSelectionSync=!1;var A,m;if(s.inside>-1)A=r.state.doc.nodeAt(s.inside),m=s.inside;else{var v=r.state.doc.resolve(s.pos);A=v.parent,m=v.depth?v.before():0}this.mightDrag=null;var C=l?null:a.target,S=C?r.docView.nearestDesc(C,!0):null;this.target=S?S.dom:null;var b=r.state,O=b.selection;(a.button==0&&A.type.spec.draggable&&A.type.spec.selectable!==!1||O instanceof me&&O.from<=m&&O.to>m)&&(this.mightDrag={node:A,pos:m,addAttr:this.target&&!this.target.draggable,setUneditable:this.target&&Rt.gecko&&!this.target.hasAttribute("contentEditable")}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(function(){h.view.mouseDown==h&&h.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),r.root.addEventListener("mouseup",this.up=this.up.bind(this)),r.root.addEventListener("mousemove",this.move=this.move.bind(this)),Va(r,"pointer")};Mh.prototype.done=function(){var r=this;this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(function(){return aa(r.view)}),this.view.mouseDown=null};Mh.prototype.up=function(r){if(this.done(),!!this.view.dom.contains(r.target.nodeType==3?r.target.parentNode:r.target)){var s=this.pos;this.view.state.doc!=this.startDoc&&(s=this.view.posAtCoords(Lh(r))),this.allowDefault||!s?Va(this.view,"pointer"):cB(this.view,s.pos,s.inside,r,this.selectNode)?r.preventDefault():r.button==0&&(this.flushed||Rt.safari&&this.mightDrag&&!this.mightDrag.node.isAtom||Rt.chrome&&!(this.view.state.selection instanceof Fe)&&Math.min(Math.abs(s.pos-this.view.state.selection.from),Math.abs(s.pos-this.view.state.selection.to))<=2)?(xc(this.view,Ee.near(this.view.state.doc.resolve(s.pos)),"pointer"),r.preventDefault()):Va(this.view,"pointer")}};Mh.prototype.move=function(r){!this.allowDefault&&(Math.abs(this.event.x-r.clientX)>4||Math.abs(this.event.y-r.clientY)>4)&&(this.allowDefault=!0),Va(this.view,"pointer"),r.buttons==0&&this.done()};Oi.touchdown=function(i){pm(i),Va(i,"pointer")};Oi.contextmenu=function(i){return pm(i)};function KS(i,r){return i.composing?!0:Rt.safari&&Math.abs(r.timeStamp-i.compositionEndedAt)<500?(i.compositionEndedAt=-2e8,!0):!1}var hB=Rt.android?5e3:-1;gi.compositionstart=gi.compositionupdate=function(i){if(!i.composing){i.domObserver.flush();var r=i.state,s=r.selection.$from;if(r.selection.empty&&(r.storedMarks||!s.textOffset&&s.parentOffset&&s.nodeBefore.marks.some(function(m){return m.type.spec.inclusive===!1})))i.markCursor=i.state.storedMarks||s.marks(),fh(i,!0),i.markCursor=null;else if(fh(i),Rt.gecko&&r.selection.empty&&s.parentOffset&&!s.textOffset&&s.nodeBefore.marks.length)for(var a=i.root.getSelection(),l=a.focusNode,h=a.focusOffset;l&&l.nodeType==1&&h!=0;){var A=h<0?l.lastChild:l.childNodes[h-1];if(!A)break;if(A.nodeType==3){a.collapse(A,A.nodeValue.length);break}else l=A,h=-1}i.composing=!0}HS(i,hB)};gi.compositionend=function(i,r){i.composing&&(i.composing=!1,i.compositionEndedAt=r.timeStamp,HS(i,20))};function HS(i,r){clearTimeout(i.composingTimeout),r>-1&&(i.composingTimeout=setTimeout(function(){return fh(i)},r))}function WS(i){for(i.composing&&(i.composing=!1,i.compositionEndedAt=pB());i.compositionNodes.length>0;)i.compositionNodes.pop().markParentsDirty()}function pB(){var i=document.createEvent("Event");return i.initEvent("event",!0,!0),i.timeStamp}function fh(i,r){if(!(Rt.android&&i.domObserver.flushingSoon>=0)){if(i.domObserver.forceFlush(),WS(i),r||i.docView.dirty){var s=DS(i);return s&&!s.eq(i.state.selection)?i.dispatch(i.state.tr.setSelection(s)):i.updateState(i.state),!0}return!1}}function AB(i,r){if(!!i.dom.parentNode){var s=i.dom.parentNode.appendChild(document.createElement("div"));s.appendChild(r),s.style.cssText="position: fixed; left: -10000px; top: 10px";var a=getSelection(),l=document.createRange();l.selectNodeContents(r),i.dom.blur(),a.removeAllRanges(),a.addRange(l),setTimeout(function(){s.parentNode&&s.parentNode.removeChild(s),i.focus()},50)}}var Vc=Rt.ie&&Rt.ie_version<15||Rt.ios&&Rt.webkit_version<604;Oi.copy=gi.cut=function(i,r){var s=i.state.selection,a=r.type=="cut";if(!s.empty){var l=Vc?null:r.clipboardData,h=s.content(),A=PS(i,h),m=A.dom,v=A.text;l?(r.preventDefault(),l.clearData(),l.setData("text/html",m.innerHTML),l.setData("text/plain",v)):AB(i,m),a&&i.dispatch(i.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))}};function fB(i){return i.openStart==0&&i.openEnd==0&&i.content.childCount==1?i.content.firstChild:null}function gB(i,r){if(!!i.dom.parentNode){var s=i.shiftKey||i.state.selection.$from.parent.type.spec.code,a=i.dom.parentNode.appendChild(document.createElement(s?"textarea":"div"));s||(a.contentEditable="true"),a.style.cssText="position: fixed; left: -10000px; top: 10px",a.focus(),setTimeout(function(){i.focus(),a.parentNode&&a.parentNode.removeChild(a),s?bg(i,a.value,null,r):bg(i,a.textContent,a.innerHTML,r)},50)}}function bg(i,r,s,a){var l=xS(i,r,s,i.shiftKey,i.state.selection.$from);if(i.someProp("handlePaste",function(m){return m(i,a,l||Pt.empty)}))return!0;if(!l)return!1;var h=fB(l),A=h?i.state.tr.replaceSelectionWith(h,i.shiftKey):i.state.tr.replaceSelection(l);return i.dispatch(A.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}gi.paste=function(i,r){if(!(i.composing&&!Rt.android)){var s=Vc?null:r.clipboardData;s&&bg(i,s.getData("text/plain"),s.getData("text/html"),r)?r.preventDefault():gB(i,r)}};var mB=function(r,s){this.slice=r,this.move=s},YS=Rt.mac?"altKey":"ctrlKey";Oi.dragstart=function(i,r){var s=i.mouseDown;if(s&&s.done(),!!r.dataTransfer){var a=i.state.selection,l=a.empty?null:i.posAtCoords(Lh(r));if(!(l&&l.pos>=a.from&&l.pos<=(a instanceof me?a.to-1:a.to))){if(s&&s.mightDrag)i.dispatch(i.state.tr.setSelection(me.create(i.state.doc,s.mightDrag.pos)));else if(r.target&&r.target.nodeType==1){var h=i.docView.nearestDesc(r.target,!0);h&&h.node.type.spec.draggable&&h!=i.docView&&i.dispatch(i.state.tr.setSelection(me.create(i.state.doc,h.posBefore)))}}var A=i.state.selection.content(),m=PS(i,A),v=m.dom,C=m.text;r.dataTransfer.clearData(),r.dataTransfer.setData(Vc?"Text":"text/html",v.innerHTML),r.dataTransfer.effectAllowed="copyMove",Vc||r.dataTransfer.setData("text/plain",C),i.dragging=new mB(A,!r[YS])}};Oi.dragend=function(i){var r=i.dragging;window.setTimeout(function(){i.dragging==r&&(i.dragging=null)},50)};gi.dragover=gi.dragenter=function(i,r){return r.preventDefault()};gi.drop=function(i,r){var s=i.dragging;if(i.dragging=null,!!r.dataTransfer){var a=i.posAtCoords(Lh(r));if(!!a){var l=i.state.doc.resolve(a.pos);if(!!l){var h=s&&s.slice;h?i.someProp("transformPasted",function(F){h=F(h)}):h=xS(i,r.dataTransfer.getData(Vc?"Text":"text/plain"),Vc?null:r.dataTransfer.getData("text/html"),!1,l);var A=s&&!r[YS];if(i.someProp("handleDrop",function(F){return F(i,r,h||Pt.empty,A)})){r.preventDefault();return}if(!!h){r.preventDefault();var m=h?X0(i.state.doc,l.pos,h):l.pos;m==null&&(m=l.pos);var v=i.state.tr;A&&v.deleteSelection();var C=v.mapping.map(m),S=h.openStart==0&&h.openEnd==0&&h.content.childCount==1,b=v.doc;if(S?v.replaceRangeWith(C,C,h.content.firstChild):v.replaceRange(C,C,h),!v.doc.eq(b)){var O=v.doc.resolve(C);if(S&&me.isSelectable(h.content.firstChild)&&O.nodeAfter&&O.nodeAfter.sameMarkup(h.content.firstChild))v.setSelection(new me(O));else{var P=v.mapping.map(m);v.mapping.maps[v.mapping.maps.length-1].forEach(function(F,W,$,X){return P=X}),v.setSelection(sm(i,O,v.doc.resolve(P)))}i.focus(),i.dispatch(v.setMeta("uiEvent","drop"))}}}}}};Oi.focus=function(i){i.focused||(i.domObserver.stop(),i.dom.classList.add("ProseMirror-focused"),i.domObserver.start(),i.focused=!0,setTimeout(function(){i.docView&&i.hasFocus()&&!i.domObserver.currentSelection.eq(i.root.getSelection())&&aa(i)},20))};Oi.blur=function(i,r){i.focused&&(i.domObserver.stop(),i.dom.classList.remove("ProseMirror-focused"),i.domObserver.start(),r.relatedTarget&&i.dom.contains(r.relatedTarget)&&i.domObserver.currentSelection.set({}),i.focused=!1)};Oi.beforeinput=function(i,r){if(Rt.chrome&&Rt.android&&r.inputType=="deleteContentBackward"){i.domObserver.flushSoon();var s=i.domChangeCount;setTimeout(function(){if(i.domChangeCount==s&&(i.dom.blur(),i.focus(),!i.someProp("handleKeyDown",function(h){return h(i,Lc(8,"Backspace"))}))){var a=i.state.selection,l=a.$cursor;l&&l.pos>0&&i.dispatch(i.state.tr.delete(l.pos-1,l.pos).scrollIntoView())}},50)}};for(var Ly in gi)Oi[Ly]=gi[Ly];function lu(i,r){if(i==r)return!0;for(var s in i)if(i[s]!==r[s])return!1;for(var a in r)if(!(a in i))return!1;return!0}var Gc=function(r,s){this.spec=s||Ha,this.side=this.spec.side||0,this.toDOM=r};Gc.prototype.map=function(r,s,a,l){var h=r.mapResult(s.from+l,this.side<0?-1:1),A=h.pos,m=h.deleted;return m?null:new nn(A-a,A-a,this)};Gc.prototype.valid=function(){return!0};Gc.prototype.eq=function(r){return this==r||r instanceof Gc&&(this.spec.key&&this.spec.key==r.spec.key||this.toDOM==r.toDOM&&lu(this.spec,r.spec))};Gc.prototype.destroy=function(r){this.spec.destroy&&this.spec.destroy(r)};var Do=function(r,s){this.spec=s||Ha,this.attrs=r};Do.prototype.map=function(r,s,a,l){var h=r.map(s.from+l,this.spec.inclusiveStart?-1:1)-a,A=r.map(s.to+l,this.spec.inclusiveEnd?1:-1)-a;return h>=A?null:new nn(h,A,this)};Do.prototype.valid=function(r,s){return s.from<s.to};Do.prototype.eq=function(r){return this==r||r instanceof Do&&lu(this.attrs,r.attrs)&&lu(this.spec,r.spec)};Do.is=function(r){return r.type instanceof Do};var uu=function(r,s){this.spec=s||Ha,this.attrs=r};uu.prototype.map=function(r,s,a,l){var h=r.mapResult(s.from+l,1);if(h.deleted)return null;var A=r.mapResult(s.to+l,-1);return A.deleted||A.pos<=h.pos?null:new nn(h.pos-a,A.pos-a,this)};uu.prototype.valid=function(r,s){var a=r.content.findIndex(s.from),l=a.index,h=a.offset,A;return h==s.from&&!(A=r.child(l)).isText&&h+A.nodeSize==s.to};uu.prototype.eq=function(r){return this==r||r instanceof uu&&lu(this.attrs,r.attrs)&&lu(this.spec,r.spec)};var nn=function(r,s,a){this.from=r,this.to=s,this.type=a},Am={spec:{configurable:!0},inline:{configurable:!0}};nn.prototype.copy=function(r,s){return new nn(r,s,this.type)};nn.prototype.eq=function(r,s){return s===void 0&&(s=0),this.type.eq(r.type)&&this.from+s==r.from&&this.to+s==r.to};nn.prototype.map=function(r,s,a){return this.type.map(r,this,s,a)};nn.widget=function(r,s,a){return new nn(r,r,new Gc(s,a))};nn.inline=function(r,s,a,l){return new nn(r,s,new Do(a,l))};nn.node=function(r,s,a,l){return new nn(r,s,new uu(a,l))};Am.spec.get=function(){return this.type.spec};Am.inline.get=function(){return this.type instanceof Do};Object.defineProperties(nn.prototype,Am);var gh=[],Ha={},or=function(r,s){this.local=r&&r.length?r:gh,this.children=s&&s.length?s:gh};or.create=function(r,s){return s.length?Ph(s,r,0,Ha):Gn};or.prototype.find=function(r,s,a){var l=[];return this.findInner(r==null?0:r,s==null?1e9:s,l,0,a),l};or.prototype.findInner=function(r,s,a,l,h){for(var A=0;A<this.local.length;A++){var m=this.local[A];m.from<=s&&m.to>=r&&(!h||h(m.spec))&&a.push(m.copy(m.from+l,m.to+l))}for(var v=0;v<this.children.length;v+=3)if(this.children[v]<s&&this.children[v+1]>r){var C=this.children[v]+1;this.children[v+2].findInner(r-C,s-C,a,l+C,h)}};or.prototype.map=function(r,s,a){return this==Gn||r.maps.length==0?this:this.mapInner(r,s,0,0,a||Ha)};or.prototype.mapInner=function(r,s,a,l,h){for(var A,m=0;m<this.local.length;m++){var v=this.local[m].map(r,a,l);v&&v.type.valid(s,v)?(A||(A=[])).push(v):h.onRemove&&h.onRemove(this.local[m].spec)}return this.children.length?EB(this.children,A,r,s,a,l,h):A?new or(A.sort(Wa)):Gn};or.prototype.add=function(r,s){return s.length?this==Gn?or.create(r,s):this.addInner(r,s,0):this};or.prototype.addInner=function(r,s,a){var l=this,h,A=0;r.forEach(function(C,S){var b=S+a,O;if(!!(O=JS(s,C,b))){for(h||(h=l.children.slice());A<h.length&&h[A]<S;)A+=3;h[A]==S?h[A+2]=h[A+2].addInner(C,O,b+1):h.splice(A,0,S,S+C.nodeSize,Ph(O,C,b+1,Ha)),A+=3}});for(var m=qS(A?zS(s):s,-a),v=0;v<m.length;v++)m[v].type.valid(r,m[v])||m.splice(v--,1);return new or(m.length?this.local.concat(m).sort(Wa):this.local,h||this.children)};or.prototype.remove=function(r){return r.length==0||this==Gn?this:this.removeInner(r,0)};or.prototype.removeInner=function(r,s){for(var a=this.children,l=this.local,h=0;h<a.length;h+=3){for(var A=void 0,m=a[h]+s,v=a[h+1]+s,C=0,S=void 0;C<r.length;C++)(S=r[C])&&S.from>m&&S.to<v&&(r[C]=null,(A||(A=[])).push(S));if(!!A){a==this.children&&(a=this.children.slice());var b=a[h+2].removeInner(A,m+1);b!=Gn?a[h+2]=b:(a.splice(h,3),h-=3)}}if(l.length){for(var O=0,P=void 0;O<r.length;O++)if(P=r[O])for(var F=0;F<l.length;F++)l[F].eq(P,s)&&(l==this.local&&(l=this.local.slice()),l.splice(F--,1))}return a==this.children&&l==this.local?this:l.length||a.length?new or(l,a):Gn};or.prototype.forChild=function(r,s){if(this==Gn)return this;if(s.isLeaf)return or.empty;for(var a,l,h=0;h<this.children.length;h+=3)if(this.children[h]>=r){this.children[h]==r&&(a=this.children[h+2]);break}for(var A=r+1,m=A+s.content.size,v=0;v<this.local.length;v++){var C=this.local[v];if(C.from<m&&C.to>A&&C.type instanceof Do){var S=Math.max(A,C.from)-A,b=Math.min(m,C.to)-A;S<b&&(l||(l=[])).push(C.copy(S,b))}}if(l){var O=new or(l.sort(Wa));return a?new ho([O,a]):O}return a||Gn};or.prototype.eq=function(r){if(this==r)return!0;if(!(r instanceof or)||this.local.length!=r.local.length||this.children.length!=r.children.length)return!1;for(var s=0;s<this.local.length;s++)if(!this.local[s].eq(r.local[s]))return!1;for(var a=0;a<this.children.length;a+=3)if(this.children[a]!=r.children[a]||this.children[a+1]!=r.children[a+1]||!this.children[a+2].eq(r.children[a+2]))return!1;return!0};or.prototype.locals=function(r){return fm(this.localsInner(r))};or.prototype.localsInner=function(r){if(this==Gn)return gh;if(r.inlineContent||!this.local.some(Do.is))return this.local;for(var s=[],a=0;a<this.local.length;a++)this.local[a].type instanceof Do||s.push(this.local[a]);return s};var Gn=new or;or.empty=Gn;or.removeOverlap=fm;var ho=function(r){this.members=r};ho.prototype.map=function(r,s){var a=this.members.map(function(l){return l.map(r,s,Ha)});return ho.from(a)};ho.prototype.forChild=function(r,s){if(s.isLeaf)return or.empty;for(var a=[],l=0;l<this.members.length;l++){var h=this.members[l].forChild(r,s);h!=Gn&&(h instanceof ho?a=a.concat(h.members):a.push(h))}return ho.from(a)};ho.prototype.eq=function(r){if(!(r instanceof ho)||r.members.length!=this.members.length)return!1;for(var s=0;s<this.members.length;s++)if(!this.members[s].eq(r.members[s]))return!1;return!0};ho.prototype.locals=function(r){for(var s,a=!0,l=0;l<this.members.length;l++){var h=this.members[l].localsInner(r);if(!!h.length)if(!s)s=h;else{a&&(s=s.slice(),a=!1);for(var A=0;A<h.length;A++)s.push(h[A])}}return s?fm(a?s:s.sort(Wa)):gh};ho.from=function(r){switch(r.length){case 0:return Gn;case 1:return r[0];default:return new ho(r)}};function EB(i,r,s,a,l,h,A){for(var m=i.slice(),v=function(qe,Xe,je,mn){for(var sr=0;sr<m.length;sr+=3){var Le=m[sr+1],Fr=void 0;Le==-1||qe>Le+h||(Xe>=m[sr]+h?m[sr+1]=-1:je>=l&&(Fr=mn-je-(Xe-qe))&&(m[sr]+=Fr,m[sr+1]+=Fr))}},C=0;C<s.maps.length;C++)s.maps[C].forEach(v);for(var S=!1,b=0;b<m.length;b+=3)if(m[b+1]==-1){var O=s.map(i[b]+h),P=O-l;if(P<0||P>=a.content.size){S=!0;continue}var F=s.map(i[b+1]+h,-1),W=F-l,$=a.content.findIndex(P),X=$.index,K=$.offset,_t=a.maybeChild(X);if(_t&&K==P&&K+_t.nodeSize==W){var H=m[b+2].mapInner(s,_t,O+1,i[b]+h+1,A);H!=Gn?(m[b]=P,m[b+1]=W,m[b+2]=H):(m[b+1]=-2,S=!0)}else S=!0}if(S){var ft=vB(m,i,r||[],s,l,h,A),Tt=Ph(ft,a,0,A);r=Tt.local;for(var $t=0;$t<m.length;$t+=3)m[$t+1]<0&&(m.splice($t,3),$t-=3);for(var ne=0,Te=0;ne<Tt.children.length;ne+=3){for(var ve=Tt.children[ne];Te<m.length&&m[Te]<ve;)Te+=3;m.splice(Te,0,Tt.children[ne],Tt.children[ne+1],Tt.children[ne+2])}}return new or(r&&r.sort(Wa),m)}function qS(i,r){if(!r||!i.length)return i;for(var s=[],a=0;a<i.length;a++){var l=i[a];s.push(new nn(l.from+r,l.to+r,l.type))}return s}function vB(i,r,s,a,l,h,A){function m(C,S){for(var b=0;b<C.local.length;b++){var O=C.local[b].map(a,l,S);O?s.push(O):A.onRemove&&A.onRemove(C.local[b].spec)}for(var P=0;P<C.children.length;P+=3)m(C.children[P+2],C.children[P]+S+1)}for(var v=0;v<i.length;v+=3)i[v+1]==-1&&m(i[v+2],r[v]+h+1);return s}function JS(i,r,s){if(r.isLeaf)return null;for(var a=s+r.nodeSize,l=null,h=0,A=void 0;h<i.length;h++)(A=i[h])&&A.from>s&&A.to<a&&((l||(l=[])).push(A),i[h]=null);return l}function zS(i){for(var r=[],s=0;s<i.length;s++)i[s]!=null&&r.push(i[s]);return r}function Ph(i,r,s,a){var l=[],h=!1;r.forEach(function(v,C){var S=JS(i,v,C+s);if(S){h=!0;var b=Ph(S,v,s+C+1,a);b!=Gn&&l.push(C,C+v.nodeSize,b)}});for(var A=qS(h?zS(i):i,-s).sort(Wa),m=0;m<A.length;m++)A[m].type.valid(r,A[m])||(a.onRemove&&a.onRemove(A[m].spec),A.splice(m--,1));return A.length||l.length?new or(A,l):Gn}function Wa(i,r){return i.from-r.from||i.to-r.to}function fm(i){for(var r=i,s=0;s<r.length-1;s++){var a=r[s];if(a.from!=a.to)for(var l=s+1;l<r.length;l++){var h=r[l];if(h.from==a.from){h.to!=a.to&&(r==i&&(r=i.slice()),r[l]=h.copy(h.from,a.to),My(r,l+1,h.copy(a.to,h.to)));continue}else{h.from<a.to&&(r==i&&(r=i.slice()),r[s]=a.copy(a.from,h.from),My(r,l,a.copy(h.from,a.to)));break}}}return r}function My(i,r,s){for(;r<i.length&&Wa(s,i[r])>0;)r++;i.splice(r,0,s)}function gm(i){var r=[];return i.someProp("decorations",function(s){var a=s(i.state);a&&a!=Gn&&r.push(a)}),i.cursorWrapper&&r.push(or.create(i.state.doc,[i.cursorWrapper.deco])),ho.from(r)}var on=function(r,s){this._props=s,this.state=s.state,this.directPlugins=s.plugins||[],this.directPlugins.forEach(eT),this.dispatch=this.dispatch.bind(this),this._root=null,this.focused=!1,this.trackWrites=null,this.dom=r&&r.mount||document.createElement("div"),r&&(r.appendChild?r.appendChild(this.dom):r.apply?r(this.dom):r.mount&&(this.mounted=!0)),this.editable=$S(this),this.markCursor=null,this.cursorWrapper=null,ZS(this),this.nodeViews=tT(this),this.docView=RS(this.state.doc,XS(this),gm(this),this.dom,this),this.lastSelectedViewDesc=null,this.dragging=null,eB(this),this.prevDirectPlugins=[],this.pluginViews=[],this.updatePluginViews()},xh={props:{configurable:!0},root:{configurable:!0},isDestroyed:{configurable:!0}};xh.props.get=function(){if(this._props.state!=this.state){var i=this._props;this._props={};for(var r in i)this._props[r]=i[r];this._props.state=this.state}return this._props};on.prototype.update=function(r){r.handleDOMEvents!=this._props.handleDOMEvents&&um(this),this._props=r,r.plugins&&(r.plugins.forEach(eT),this.directPlugins=r.plugins),this.updateStateInner(r.state,!0)};on.prototype.setProps=function(r){var s={};for(var a in this._props)s[a]=this._props[a];s.state=this.state;for(var l in r)s[l]=r[l];this.update(s)};on.prototype.updateState=function(r){this.updateStateInner(r,this.state.plugins!=r.plugins)};on.prototype.updateStateInner=function(r,s){var a=this,l=this.state,h=!1,A=!1;if(r.storedMarks&&this.composing&&(WS(this),A=!0),this.state=r,s){var m=tT(this);CB(m,this.nodeViews)&&(this.nodeViews=m,h=!0),um(this)}this.editable=$S(this),ZS(this);var v=gm(this),C=XS(this),S=s?"reset":r.scrollToSelection>l.scrollToSelection?"to selection":"preserve",b=h||!this.docView.matchesNode(r.doc,C,v);(b||!r.selection.eq(l.selection))&&(A=!0);var O=S=="preserve"&&A&&this.dom.style.overflowAnchor==null&&pD(this);if(A){this.domObserver.stop();var P=b&&(Rt.ie||Rt.chrome)&&!this.composing&&!l.selection.empty&&!r.selection.empty&&IB(l.selection,r.selection);if(b){var F=Rt.chrome?this.trackWrites=this.root.getSelection().focusNode:null;(h||!this.docView.update(r.doc,C,v,this))&&(this.docView.updateOuterDeco([]),this.docView.destroy(),this.docView=RS(r.doc,C,v,this.dom,this)),F&&!this.trackWrites&&(P=!0)}P||!(this.mouseDown&&this.domObserver.currentSelection.eq(this.root.getSelection())&&UD(this))?aa(this,P):(LS(this,r.selection),this.domObserver.setCurSelection()),this.domObserver.start()}if(this.updatePluginViews(l),S=="reset")this.dom.scrollTop=0;else if(S=="to selection"){var W=this.root.getSelection().focusNode;this.someProp("handleScrollToSelection",function($){return $(a)})||(r.selection instanceof me?my(this,this.docView.domAfterPos(r.selection.from).getBoundingClientRect(),W):my(this,this.coordsAtPos(r.selection.head,1),W))}else O&&AD(O)};on.prototype.destroyPluginViews=function(){for(var r;r=this.pluginViews.pop();)r.destroy&&r.destroy()};on.prototype.updatePluginViews=function(r){if(!r||r.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(var s=0;s<this.directPlugins.length;s++){var a=this.directPlugins[s];a.spec.view&&this.pluginViews.push(a.spec.view(this))}for(var l=0;l<this.state.plugins.length;l++){var h=this.state.plugins[l];h.spec.view&&this.pluginViews.push(h.spec.view(this))}}else for(var A=0;A<this.pluginViews.length;A++){var m=this.pluginViews[A];m.update&&m.update(this,r)}};on.prototype.someProp=function(r,s){var a=this._props&&this._props[r],l;if(a!=null&&(l=s?s(a):a))return l;for(var h=0;h<this.directPlugins.length;h++){var A=this.directPlugins[h].props[r];if(A!=null&&(l=s?s(A):A))return l}var m=this.state.plugins;if(m)for(var v=0;v<m.length;v++){var C=m[v].props[r];if(C!=null&&(l=s?s(C):C))return l}};on.prototype.hasFocus=function(){return this.root.activeElement==this.dom};on.prototype.focus=function(){this.domObserver.stop(),this.editable&&fD(this.dom),aa(this),this.domObserver.start()};xh.root.get=function(){var i=this._root;if(i==null){for(var r=this.dom.parentNode;r;r=r.parentNode)if(r.nodeType==9||r.nodeType==11&&r.host)return r.getSelection||(Object.getPrototypeOf(r).getSelection=function(){return document.getSelection()}),this._root=r}return i||document};on.prototype.posAtCoords=function(r){return ID(this,r)};on.prototype.coordsAtPos=function(r,s){return s===void 0&&(s=1),_S(this,r,s)};on.prototype.domAtPos=function(r,s){return s===void 0&&(s=0),this.docView.domFromPos(r,s)};on.prototype.nodeDOM=function(r){var s=this.docView.descAt(r);return s?s.nodeDOM:null};on.prototype.posAtDOM=function(r,s,a){a===void 0&&(a=-1);var l=this.docView.posFromDOM(r,s,a);if(l==null)throw new RangeError("DOM position not inside the editor");return l};on.prototype.endOfTextblock=function(r,s){return TD(this,s||this.state,r)};on.prototype.destroy=function(){!this.docView||(rB(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],gm(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null)};xh.isDestroyed.get=function(){return this.docView==null};on.prototype.dispatchEvent=function(r){return iB(this,r)};on.prototype.dispatch=function(r){var s=this._props.dispatchTransaction;s?s.call(this,r):this.updateState(this.state.apply(r))};Object.defineProperties(on.prototype,xh);function XS(i){var r=Object.create(null);return r.class="ProseMirror",r.contenteditable=String(i.editable),r.translate="no",i.someProp("attributes",function(s){if(typeof s=="function"&&(s=s(i.state)),s)for(var a in s)a=="class"&&(r.class+=" "+s[a]),a=="style"?r.style=(r.style?r.style+";":"")+s[a]:!r[a]&&a!="contenteditable"&&a!="nodeName"&&(r[a]=String(s[a]))}),[nn.node(0,i.state.doc.content.size,r)]}function ZS(i){if(i.markCursor){var r=document.createElement("img");r.className="ProseMirror-separator",r.setAttribute("mark-placeholder","true"),i.cursorWrapper={dom:r,deco:nn.widget(i.state.selection.head,r,{raw:!0,marks:i.markCursor})}}else i.cursorWrapper=null}function $S(i){return!i.someProp("editable",function(r){return r(i.state)===!1})}function IB(i,r){var s=Math.min(i.$anchor.sharedDepth(i.head),r.$anchor.sharedDepth(r.head));return i.$anchor.start(s)!=r.$anchor.start(s)}function tT(i){var r={};return i.someProp("nodeViews",function(s){for(var a in s)Object.prototype.hasOwnProperty.call(r,a)||(r[a]=s[a])}),r}function CB(i,r){var s=0,a=0;for(var l in i){if(i[l]!=r[l])return!0;s++}for(var h in r)a++;return s!=a}function eT(i){if(i.spec.state||i.spec.filterTransaction||i.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var ia={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",229:"q"},mh={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"',229:"Q"},Py=typeof navigator!="undefined"&&/Chrome\/(\d+)/.exec(navigator.userAgent),_B=typeof navigator!="undefined"&&/Apple Computer/.test(navigator.vendor),yB=typeof navigator!="undefined"&&/Gecko\/\d+/.test(navigator.userAgent),xy=typeof navigator!="undefined"&&/Mac/.test(navigator.platform),SB=typeof navigator!="undefined"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),TB=Py&&(xy||+Py[1]<57)||yB&&xy;for(var xn=0;xn<10;xn++)ia[48+xn]=ia[96+xn]=String(xn);for(var xn=1;xn<=24;xn++)ia[xn+111]="F"+xn;for(var xn=65;xn<=90;xn++)ia[xn]=String.fromCharCode(xn+32),mh[xn]=String.fromCharCode(xn);for(var eg in ia)mh.hasOwnProperty(eg)||(mh[eg]=ia[eg]);function RB(i){var r=TB&&(i.ctrlKey||i.altKey||i.metaKey)||(_B||SB)&&i.shiftKey&&i.key&&i.key.length==1,s=!r&&i.key||(i.shiftKey?mh:ia)[i.keyCode]||i.key||"Unidentified";return s=="Esc"&&(s="Escape"),s=="Del"&&(s="Delete"),s=="Left"&&(s="ArrowLeft"),s=="Up"&&(s="ArrowUp"),s=="Right"&&(s="ArrowRight"),s=="Down"&&(s="ArrowDown"),s}var wB=typeof navigator!="undefined"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!1;function bB(i){var r=i.split(/-(?!$)/),s=r[r.length-1];s=="Space"&&(s=" ");for(var a,l,h,A,m=0;m<r.length-1;m++){var v=r[m];if(/^(cmd|meta|m)$/i.test(v))A=!0;else if(/^a(lt)?$/i.test(v))a=!0;else if(/^(c|ctrl|control)$/i.test(v))l=!0;else if(/^s(hift)?$/i.test(v))h=!0;else if(/^mod$/i.test(v))wB?A=!0:l=!0;else throw new Error("Unrecognized modifier name: "+v)}return a&&(s="Alt-"+s),l&&(s="Ctrl-"+s),A&&(s="Meta-"+s),h&&(s="Shift-"+s),s}function NB(i){var r=Object.create(null);for(var s in i)r[bB(s)]=i[s];return r}function rg(i,r,s){return r.altKey&&(i="Alt-"+i),r.ctrlKey&&(i="Ctrl-"+i),r.metaKey&&(i="Meta-"+i),s!==!1&&r.shiftKey&&(i="Shift-"+i),i}function OB(i){return new gn({props:{handleKeyDown:rT(i)}})}function rT(i){var r=NB(i);return function(s,a){var l=RB(a),h=l.length==1&&l!=" ",A,m=r[rg(l,a,!h)];if(m&&m(s.state,s.dispatch,s))return!0;if(h&&(a.shiftKey||a.altKey||a.metaKey||l.charCodeAt(0)>127)&&(A=ia[a.keyCode])&&A!=l){var v=r[rg(A,a,!0)];if(v&&v(s.state,s.dispatch,s))return!0}else if(h&&a.shiftKey){var C=r[rg(l,a,!0)];if(C&&C(s.state,s.dispatch,s))return!0}return!1}}function kB(i){return Object.prototype.toString.call(i).slice(8,-1)}function ng(i){return kB(i)!=="Object"?!1:i.constructor===Object&&Object.getPrototypeOf(i)===Object.prototype}function Uh(i,r){const s=vt({},i);return ng(i)&&ng(r)&&Object.keys(r).forEach(a=>{ng(r[a])?a in i?s[a]=Uh(i[a],r[a]):Object.assign(s,{[a]:r[a]}):Object.assign(s,{[a]:r[a]})}),s}function nT(i){return typeof i=="function"}function Oe(i,r=void 0,...s){return nT(i)?r?i.bind(r)(...s):i(...s):i}function Jt(i,r,s){return i.config[r]===void 0&&i.parent?Jt(i.parent,r,s):typeof i.config[r]=="function"?i.config[r].bind(wn(vt({},s),{parent:i.parent?Jt(i.parent,r,s):null})):i.config[r]}class bn{constructor(r={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config=vt(vt({},this.config),r),this.name=this.config.name,r.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=Oe(Jt(this,"addOptions",{name:this.name}))),this.storage=Oe(Jt(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(r={}){return new bn(r)}configure(r={}){const s=this.extend();return s.options=Uh(this.options,r),s.storage=Oe(Jt(s,"addStorage",{name:s.name,options:s.options})),s}extend(r={}){const s=new bn(r);return s.parent=this,this.child=s,s.name=r.name?r.name:s.parent.name,r.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${s.name}".`),s.options=Oe(Jt(s,"addOptions",{name:s.name})),s.storage=Oe(Jt(s,"addStorage",{name:s.name,options:s.options})),s}}function iT(i,r,s){const{from:a,to:l}=r,{blockSeparator:h=`

`,textSerializers:A={}}=s||{};let m="",v=!0;return i.nodesBetween(a,l,(C,S,b,O)=>{var P;const F=A==null?void 0:A[C.type.name];F?(C.isBlock&&!v&&(m+=h,v=!0),m+=F({node:C,pos:S,parent:b,index:O})):C.isText?(m+=(P=C==null?void 0:C.text)===null||P===void 0?void 0:P.slice(Math.max(a,S)-S,l-S),v=!1):C.isBlock&&!v&&(m+=h,v=!0)}),m}function oT(i){return Object.fromEntries(Object.entries(i.nodes).filter(([,r])=>r.spec.toText).map(([r,s])=>[r,s.spec.toText]))}const DB=bn.create({name:"clipboardTextSerializer",addProseMirrorPlugins(){return[new gn({key:new ii("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:i}=this,{state:r,schema:s}=i,{doc:a,selection:l}=r,{ranges:h}=l,A=Math.min(...h.map(S=>S.$from.pos)),m=Math.max(...h.map(S=>S.$to.pos)),v=oT(s);return iT(a,{from:A,to:m},{textSerializers:v})}}})]}}),BB=()=>({editor:i,view:r})=>(requestAnimationFrame(()=>{var s;i.isDestroyed||(r.dom.blur(),(s=window==null?void 0:window.getSelection())===null||s===void 0||s.removeAllRanges())}),!0);var LB=Object.freeze({__proto__:null,blur:BB});const MB=(i=!1)=>({commands:r})=>r.setContent("",i);var PB=Object.freeze({__proto__:null,clearContent:MB});const xB=()=>({state:i,tr:r,dispatch:s})=>{const{selection:a}=r,{ranges:l}=a;return s&&l.forEach(({$from:h,$to:A})=>{i.doc.nodesBetween(h.pos,A.pos,(m,v)=>{if(m.type.isText)return;const{doc:C,mapping:S}=r,b=C.resolve(S.map(v)),O=C.resolve(S.map(v+m.nodeSize)),P=b.blockRange(O);if(!P)return;const F=Xc(P);if(m.type.isTextblock){const{defaultType:W}=b.parent.contentMatchAt(b.index());r.setNodeMarkup(P.start,W)}(F||F===0)&&r.lift(P,F)})}),!0};var UB=Object.freeze({__proto__:null,clearNodes:xB});const QB=i=>r=>i(r);var FB=Object.freeze({__proto__:null,command:QB});const VB=()=>({state:i,dispatch:r})=>AS(i,r);var GB=Object.freeze({__proto__:null,createParagraphNear:VB});function Nn(i,r){if(typeof i=="string"){if(!r.nodes[i])throw Error(`There is no node type named '${i}'. Maybe you forgot to add the extension?`);return r.nodes[i]}return i}const jB=i=>({tr:r,state:s,dispatch:a})=>{const l=Nn(i,s.schema),h=r.selection.$anchor;for(let A=h.depth;A>0;A-=1)if(h.node(A).type===l){if(a){const v=h.before(A),C=h.after(A);r.delete(v,C).scrollIntoView()}return!0}return!1};var KB=Object.freeze({__proto__:null,deleteNode:jB});const HB=i=>({tr:r,dispatch:s})=>{const{from:a,to:l}=i;return s&&r.delete(a,l),!0};var WB=Object.freeze({__proto__:null,deleteRange:HB});const YB=()=>({state:i,dispatch:r})=>Zg(i,r);var qB=Object.freeze({__proto__:null,deleteSelection:YB});const JB=()=>({commands:i})=>i.keyboardShortcut("Enter");var zB=Object.freeze({__proto__:null,enter:JB});const XB=()=>({state:i,dispatch:r})=>pS(i,r);var ZB=Object.freeze({__proto__:null,exitCode:XB});function ca(i,r){if(typeof i=="string"){if(!r.marks[i])throw Error(`There is no mark type named '${i}'. Maybe you forgot to add the extension?`);return r.marks[i]}return i}function mm(i){return Object.prototype.toString.call(i)==="[object RegExp]"}function Eh(i,r,s={strict:!0}){const a=Object.keys(r);return a.length?a.every(l=>s.strict?r[l]===i[l]:mm(r[l])?r[l].test(i[l]):r[l]===i[l]):!0}function Ng(i,r,s={}){return i.find(a=>a.type===r&&Eh(a.attrs,s))}function $B(i,r,s={}){return!!Ng(i,r,s)}function Em(i,r,s={}){if(!i||!r)return;const a=i.parent.childAfter(i.parentOffset);if(!a.node)return;const l=Ng(a.node.marks,r,s);if(!l)return;let h=i.index(),A=i.start()+a.offset,m=h+1,v=A+a.node.nodeSize;for(Ng(a.node.marks,r,s);h>0&&l.isInSet(i.parent.child(h-1).marks);)h-=1,A-=i.parent.child(h).nodeSize;for(;m<i.parent.childCount&&$B(i.parent.child(m).marks,r,s);)v+=i.parent.child(m).nodeSize,m+=1;return{from:A,to:v}}const tL=(i,r={})=>({tr:s,state:a,dispatch:l})=>{const h=ca(i,a.schema),{doc:A,selection:m}=s,{$from:v,from:C,to:S}=m;if(l){const b=Em(v,h,r);if(b&&b.from<=C&&b.to>=S){const O=Fe.create(A,b.from,b.to);s.setSelection(O)}}return!0};var eL=Object.freeze({__proto__:null,extendMarkRange:tL});const rL=i=>r=>{const s=typeof i=="function"?i(r):i;for(let a=0;a<s.length;a+=1)if(s[a](r))return!0;return!1};var nL=Object.freeze({__proto__:null,first:rL});function iL(i){var r;return((r=i.constructor)===null||r===void 0?void 0:r.toString().substring(0,5))==="class"}function sT(i){return i&&typeof i=="object"&&!Array.isArray(i)&&!iL(i)}function aT(i){return sT(i)&&i instanceof Fe}function vm(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}function Ss(i=0,r=0,s=0){return Math.min(Math.max(i,r),s)}function cT(i,r=null){if(!r)return null;const s=Ee.atStart(i),a=Ee.atEnd(i);if(r==="start"||r===!0)return s;if(r==="end")return a;const l=s.from,h=a.to;return r==="all"?Fe.create(i,Ss(0,l,h),Ss(i.content.size,l,h)):Fe.create(i,Ss(r,l,h),Ss(r,l,h))}const oL=(i=null,r)=>({editor:s,view:a,tr:l,dispatch:h})=>{r=vt({scrollIntoView:!0},r);const A=()=>{vm()&&a.dom.focus(),requestAnimationFrame(()=>{s.isDestroyed||(a.focus(),(r==null?void 0:r.scrollIntoView)&&s.commands.scrollIntoView())})};if(a.hasFocus()&&i===null||i===!1)return!0;if(h&&i===null&&!aT(s.state.selection))return A(),!0;const m=cT(s.state.doc,i)||s.state.selection,v=s.state.selection.eq(m);return h&&(v||l.setSelection(m),v&&l.storedMarks&&l.setStoredMarks(l.storedMarks),A()),!0};var sL=Object.freeze({__proto__:null,focus:oL});const aL=(i,r)=>s=>i.every((a,l)=>r(a,wn(vt({},s),{index:l})));var cL=Object.freeze({__proto__:null,forEach:aL});const lL=(i,r)=>({tr:s,commands:a})=>a.insertContentAt({from:s.selection.from,to:s.selection.to},i,r);var uL=Object.freeze({__proto__:null,insertContent:lL});function Uy(i){const r=`<body>${i}</body>`;return new window.DOMParser().parseFromString(r,"text/html").body}function vh(i,r,s){if(s=vt({slice:!0,parseOptions:{}},s),typeof i=="object"&&i!==null)try{return Array.isArray(i)?Et.fromArray(i.map(a=>r.nodeFromJSON(a))):r.nodeFromJSON(i)}catch(a){return console.warn("[tiptap warn]: Invalid content.","Passed value:",i,"Error:",a),vh("",r,s)}if(typeof i=="string"){const a=Oo.fromSchema(r);return s.slice?a.parseSlice(Uy(i),s.parseOptions).content:a.parse(Uy(i),s.parseOptions)}return vh("",r,s)}function dL(i,r,s){const a=i.steps.length-1;if(a<r)return;const l=i.steps[a];if(!(l instanceof Os||l instanceof Ni))return;const h=i.mapping.maps[a];let A=0;h.forEach((m,v,C,S)=>{A===0&&(A=S)}),i.setSelection(Ee.near(i.doc.resolve(A),s))}const hL=i=>i.toString().startsWith("<"),pL=(i,r,s)=>({tr:a,dispatch:l,editor:h})=>{if(l){s=vt({parseOptions:{},updateSelection:!0},s);const A=vh(r,h.schema,{parseOptions:vt({preserveWhitespace:"full"},s.parseOptions)});if(A.toString()==="<>")return!0;let{from:m,to:v}=typeof i=="number"?{from:i,to:i}:i,C=!0,S=!0;if((hL(A)?A:[A]).forEach(O=>{O.check(),C=C?O.isText&&O.marks.length===0:!1,S=S?O.isBlock:!1}),m===v&&S){const{parent:O}=a.doc.resolve(m);O.isTextblock&&!O.type.spec.code&&!O.childCount&&(m-=1,v+=1)}C?a.insertText(r,m,v):a.replaceWith(m,v,A),s.updateSelection&&dL(a,a.steps.length-1,-1)}return!0};var AL=Object.freeze({__proto__:null,insertContentAt:pL});const fL=()=>({state:i,dispatch:r})=>sS(i,r);var gL=Object.freeze({__proto__:null,joinBackward:fL});const mL=()=>({state:i,dispatch:r})=>lS(i,r);var EL=Object.freeze({__proto__:null,joinForward:mL});function lT(){return typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1}function vL(i){const r=i.split(/-(?!$)/);let s=r[r.length-1];s==="Space"&&(s=" ");let a,l,h,A;for(let m=0;m<r.length-1;m+=1){const v=r[m];if(/^(cmd|meta|m)$/i.test(v))A=!0;else if(/^a(lt)?$/i.test(v))a=!0;else if(/^(c|ctrl|control)$/i.test(v))l=!0;else if(/^s(hift)?$/i.test(v))h=!0;else if(/^mod$/i.test(v))vm()||lT()?A=!0:l=!0;else throw new Error(`Unrecognized modifier name: ${v}`)}return a&&(s=`Alt-${s}`),l&&(s=`Ctrl-${s}`),A&&(s=`Meta-${s}`),h&&(s=`Shift-${s}`),s}const IL=i=>({editor:r,view:s,tr:a,dispatch:l})=>{const h=vL(i).split(/-(?!$)/),A=h.find(C=>!["Alt","Ctrl","Meta","Shift"].includes(C)),m=new KeyboardEvent("keydown",{key:A==="Space"?" ":A,altKey:h.includes("Alt"),ctrlKey:h.includes("Ctrl"),metaKey:h.includes("Meta"),shiftKey:h.includes("Shift"),bubbles:!0,cancelable:!0}),v=r.captureTransaction(()=>{s.someProp("handleKeyDown",C=>C(s,m))});return v==null||v.steps.forEach(C=>{const S=C.map(a.mapping);S&&l&&a.maybeStep(S)}),!0};var CL=Object.freeze({__proto__:null,keyboardShortcut:IL});function du(i,r,s={}){const{from:a,to:l,empty:h}=i.selection,A=r?Nn(r,i.schema):null,m=[];i.doc.nodesBetween(a,l,(b,O)=>{if(b.isText)return;const P=Math.max(a,O),F=Math.min(l,O+b.nodeSize);m.push({node:b,from:P,to:F})});const v=l-a,C=m.filter(b=>A?A.name===b.node.type.name:!0).filter(b=>Eh(b.node.attrs,s,{strict:!1}));return h?!!C.length:C.reduce((b,O)=>b+O.to-O.from,0)>=v}const _L=(i,r={})=>({state:s,dispatch:a})=>{const l=Nn(i,s.schema);return du(s,l,r)?Jk(s,a):!1};var yL=Object.freeze({__proto__:null,lift:_L});const SL=()=>({state:i,dispatch:r})=>fS(i,r);var TL=Object.freeze({__proto__:null,liftEmptyBlock:SL});const RL=i=>({state:r,dispatch:s})=>{const a=Nn(i,r.schema);return iD(a)(r,s)};var wL=Object.freeze({__proto__:null,liftListItem:RL});const bL=()=>({state:i,dispatch:r})=>hS(i,r);var NL=Object.freeze({__proto__:null,newlineInCode:bL});function Qh(i,r){return r.nodes[i]?"node":r.marks[i]?"mark":null}function Qy(i,r){const s=typeof r=="string"?[r]:r;return Object.keys(i).reduce((a,l)=>(s.includes(l)||(a[l]=i[l]),a),{})}const OL=(i,r)=>({tr:s,state:a,dispatch:l})=>{let h=null,A=null;const m=Qh(typeof i=="string"?i:i.name,a.schema);return m?(m==="node"&&(h=Nn(i,a.schema)),m==="mark"&&(A=ca(i,a.schema)),l&&s.selection.ranges.forEach(v=>{a.doc.nodesBetween(v.$from.pos,v.$to.pos,(C,S)=>{h&&h===C.type&&s.setNodeMarkup(S,void 0,Qy(C.attrs,r)),A&&C.marks.length&&C.marks.forEach(b=>{A===b.type&&s.addMark(S,S+C.nodeSize,A.create(Qy(b.attrs,r)))})})}),!0):!1};var kL=Object.freeze({__proto__:null,resetAttributes:OL});const DL=()=>({tr:i,dispatch:r})=>(r&&i.scrollIntoView(),!0);var BL=Object.freeze({__proto__:null,scrollIntoView:DL});const LL=()=>({tr:i,commands:r})=>r.setTextSelection({from:0,to:i.doc.content.size});var ML=Object.freeze({__proto__:null,selectAll:LL});const PL=()=>({state:i,dispatch:r})=>aS(i,r);var xL=Object.freeze({__proto__:null,selectNodeBackward:PL});const UL=()=>({state:i,dispatch:r})=>uS(i,r);var QL=Object.freeze({__proto__:null,selectNodeForward:UL});const FL=()=>({state:i,dispatch:r})=>Xk(i,r);var VL=Object.freeze({__proto__:null,selectParentNode:FL});const GL=()=>({state:i,dispatch:r})=>em(i,r);var jL=Object.freeze({__proto__:null,selectTextblockEnd:GL});const KL=()=>({state:i,dispatch:r})=>tm(i,r);var HL=Object.freeze({__proto__:null,selectTextblockStart:KL});function uT(i,r,s={}){return vh(i,r,{slice:!1,parseOptions:s})}const WL=(i,r=!1,s={})=>({tr:a,editor:l,dispatch:h})=>{const{doc:A}=a,m=uT(i,l.schema,s),v=Fe.create(A,0,A.content.size);return h&&a.setSelection(v).replaceSelectionWith(m,!1).setMeta("preventUpdate",!r),!0};var YL=Object.freeze({__proto__:null,setContent:WL});function dT(i,r){const s=ca(r,i.schema),{from:a,to:l,empty:h}=i.selection,A=[];h?(i.storedMarks&&A.push(...i.storedMarks),A.push(...i.selection.$head.marks())):i.doc.nodesBetween(a,l,v=>{A.push(...v.marks)});const m=A.find(v=>v.type.name===s.name);return m?vt({},m.attrs):{}}const qL=(i,r={})=>({tr:s,state:a,dispatch:l})=>{const{selection:h}=s,{empty:A,ranges:m}=h,v=ca(i,a.schema);if(l)if(A){const C=dT(a,v);s.addStoredMark(v.create(vt(vt({},C),r)))}else m.forEach(C=>{const S=C.$from.pos,b=C.$to.pos;a.doc.nodesBetween(S,b,(O,P)=>{const F=Math.max(P,S),W=Math.min(P+O.nodeSize,b);O.marks.find(X=>X.type===v)?O.marks.forEach(X=>{v===X.type&&s.addMark(F,W,v.create(vt(vt({},X.attrs),r)))}):s.addMark(F,W,v.create(r))})});return!0};var JL=Object.freeze({__proto__:null,setMark:qL});const zL=(i,r)=>({tr:s})=>(s.setMeta(i,r),!0);var XL=Object.freeze({__proto__:null,setMeta:zL});const ZL=(i,r={})=>({state:s,dispatch:a,chain:l})=>{const h=Nn(i,s.schema);return h.isTextblock?l().command(({commands:A})=>dy(h,r)(s)?!0:A.clearNodes()).command(({state:A})=>dy(h,r)(A,a)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)};var $L=Object.freeze({__proto__:null,setNode:ZL});const tM=i=>({tr:r,dispatch:s})=>{if(s){const{doc:a}=r,l=Ee.atStart(a).from,h=Ee.atEnd(a).to,A=Ss(i,l,h),m=me.create(a,A);r.setSelection(m)}return!0};var eM=Object.freeze({__proto__:null,setNodeSelection:tM});const rM=i=>({tr:r,dispatch:s})=>{if(s){const{doc:a}=r,{from:l,to:h}=typeof i=="number"?{from:i,to:i}:i,A=Fe.atStart(a).from,m=Fe.atEnd(a).to,v=Ss(l,A,m),C=Ss(h,A,m),S=Fe.create(a,v,C);r.setSelection(S)}return!0};var nM=Object.freeze({__proto__:null,setTextSelection:rM});const iM=i=>({state:r,dispatch:s})=>{const a=Nn(i,r.schema);return aD(a)(r,s)};var oM=Object.freeze({__proto__:null,sinkListItem:iM});function nh(i,r,s){return Object.fromEntries(Object.entries(s).filter(([a])=>{const l=i.find(h=>h.type===r&&h.name===a);return l?l.attribute.keepOnSplit:!1}))}function sM(i){for(let r=0;r<i.edgeCount;r+=1){const{type:s}=i.edge(r);if(s.isTextblock&&!s.hasRequiredAttrs())return s}return null}function Fy(i,r){const s=i.storedMarks||i.selection.$to.parentOffset&&i.selection.$from.marks();if(s){const a=s.filter(l=>r==null?void 0:r.includes(l.type.name));i.tr.ensureMarks(a)}}const aM=({keepMarks:i=!0}={})=>({tr:r,state:s,dispatch:a,editor:l})=>{const{selection:h,doc:A}=r,{$from:m,$to:v}=h,C=l.extensionManager.attributes,S=nh(C,m.node().type.name,m.node().attrs);if(h instanceof me&&h.node.isBlock)return!m.parentOffset||!ws(A,m.pos)?!1:(a&&(i&&Fy(s,l.extensionManager.splittableMarks),r.split(m.pos).scrollIntoView()),!0);if(!m.parent.isBlock)return!1;if(a){const b=v.parentOffset===v.parent.content.size;h instanceof Fe&&r.deleteSelection();const O=m.depth===0?void 0:sM(m.node(-1).contentMatchAt(m.indexAfter(-1)));let P=b&&O?[{type:O,attrs:S}]:void 0,F=ws(r.doc,r.mapping.map(m.pos),1,P);if(!P&&!F&&ws(r.doc,r.mapping.map(m.pos),1,O?[{type:O}]:void 0)&&(F=!0,P=O?[{type:O,attrs:S}]:void 0),F&&(r.split(r.mapping.map(m.pos),1,P),O&&!b&&!m.parentOffset&&m.parent.type!==O)){const W=r.mapping.map(m.before()),$=r.doc.resolve(W);m.node(-1).canReplaceWith($.index(),$.index()+1,O)&&r.setNodeMarkup(r.mapping.map(m.before()),O)}i&&Fy(s,l.extensionManager.splittableMarks),r.scrollIntoView()}return!0};var cM=Object.freeze({__proto__:null,splitBlock:aM});const lM=i=>({tr:r,state:s,dispatch:a,editor:l})=>{var h;const A=Nn(i,s.schema),{$from:m,$to:v}=s.selection,C=s.selection.node;if(C&&C.isBlock||m.depth<2||!m.sameParent(v))return!1;const S=m.node(-1);if(S.type!==A)return!1;const b=l.extensionManager.attributes;if(m.parent.content.size===0&&m.node(-1).childCount===m.indexAfter(-1)){if(m.depth===2||m.node(-3).type!==A||m.index(-2)!==m.node(-2).childCount-1)return!1;if(a){let $=Et.empty;const X=m.index(-1)?1:m.index(-2)?2:3;for(let $t=m.depth-X;$t>=m.depth-3;$t-=1)$=Et.from(m.node($t).copy($));const K=m.indexAfter(-1)<m.node(-2).childCount?1:m.indexAfter(-2)<m.node(-3).childCount?2:3,_t=nh(b,m.node().type.name,m.node().attrs),H=((h=A.contentMatch.defaultType)===null||h===void 0?void 0:h.createAndFill(_t))||void 0;$=$.append(Et.from(A.createAndFill(null,H)||void 0));const ft=m.before(m.depth-(X-1));r.replace(ft,m.after(-K),new Pt($,4-X,0));let Tt=-1;r.doc.nodesBetween(ft,r.doc.content.size,($t,ne)=>{if(Tt>-1)return!1;$t.isTextblock&&$t.content.size===0&&(Tt=ne+1)}),Tt>-1&&r.setSelection(Fe.near(r.doc.resolve(Tt))),r.scrollIntoView()}return!0}const O=v.pos===m.end()?S.contentMatchAt(0).defaultType:null,P=nh(b,S.type.name,S.attrs),F=nh(b,m.node().type.name,m.node().attrs);r.delete(m.pos,v.pos);const W=O?[{type:A,attrs:P},{type:O,attrs:F}]:[{type:A,attrs:P}];return ws(r.doc,m.pos,2)?(a&&r.split(m.pos,2,W).scrollIntoView(),!0):!1};var uM=Object.freeze({__proto__:null,splitListItem:lM});function dM(i,r){for(let s=i.depth;s>0;s-=1){const a=i.node(s);if(r(a))return{pos:s>0?i.before(s):0,start:i.start(s),depth:s,node:a}}}function Im(i){return r=>dM(r.$from,i)}function Fh(i){const r=i.filter(l=>l.type==="extension"),s=i.filter(l=>l.type==="node"),a=i.filter(l=>l.type==="mark");return{baseExtensions:r,nodeExtensions:s,markExtensions:a}}function Vy(i,r){const{nodeExtensions:s}=Fh(r),a=s.find(A=>A.name===i);if(!a)return!1;const l={name:a.name,options:a.options,storage:a.storage},h=Oe(Jt(a,"group",l));return typeof h!="string"?!1:h.split(" ").includes("list")}const Gy=(i,r)=>{const s=Im(A=>A.type===r)(i.selection);if(!s)return!0;const a=i.doc.resolve(Math.max(0,s.pos-1)).before(s.depth);if(a===void 0)return!0;const l=i.doc.nodeAt(a);return s.node.type===(l==null?void 0:l.type)&&mu(i.doc,s.pos)&&i.join(s.pos),!0},jy=(i,r)=>{const s=Im(A=>A.type===r)(i.selection);if(!s)return!0;const a=i.doc.resolve(s.start).after(s.depth);if(a===void 0)return!0;const l=i.doc.nodeAt(a);return s.node.type===(l==null?void 0:l.type)&&mu(i.doc,a)&&i.join(a),!0},hM=(i,r)=>({editor:s,tr:a,state:l,dispatch:h,chain:A,commands:m,can:v})=>{const{extensions:C}=s.extensionManager,S=Nn(i,l.schema),b=Nn(r,l.schema),{selection:O}=l,{$from:P,$to:F}=O,W=P.blockRange(F);if(!W)return!1;const $=Im(X=>Vy(X.type.name,C))(O);if(W.depth>=1&&$&&W.depth-$.depth<=1){if($.node.type===S)return m.liftListItem(b);if(Vy($.node.type.name,C)&&S.validContent($.node.content)&&h)return A().command(()=>(a.setNodeMarkup($.pos,S),!0)).command(()=>Gy(a,S)).command(()=>jy(a,S)).run()}return A().command(()=>v().wrapInList(S)?!0:m.clearNodes()).wrapInList(S).command(()=>Gy(a,S)).command(()=>jy(a,S)).run()};var pM=Object.freeze({__proto__:null,toggleList:hM});function Og(i,r,s={}){const{empty:a,ranges:l}=i.selection,h=r?ca(r,i.schema):null;if(a)return!!(i.storedMarks||i.selection.$from.marks()).filter(b=>h?h.name===b.type.name:!0).find(b=>Eh(b.attrs,s,{strict:!1}));let A=0;const m=[];if(l.forEach(({$from:b,$to:O})=>{const P=b.pos,F=O.pos;i.doc.nodesBetween(P,F,(W,$)=>{if(!W.isText&&!W.marks.length)return;const X=Math.max(P,$),K=Math.min(F,$+W.nodeSize);A+=K-X,m.push(...W.marks.map(H=>({mark:H,from:X,to:K})))})}),A===0)return!1;const v=m.filter(b=>h?h.name===b.mark.type.name:!0).filter(b=>Eh(b.mark.attrs,s,{strict:!1})).reduce((b,O)=>b+O.to-O.from,0),C=m.filter(b=>h?b.mark.type!==h&&b.mark.type.excludes(h):!0).reduce((b,O)=>b+O.to-O.from,0);return(v>0?v+C:v)>=A}const AM=(i,r={},s={})=>({state:a,commands:l})=>{const{extendEmptyMarkRange:h=!1}=s,A=ca(i,a.schema);return Og(a,A,r)?l.unsetMark(A,{extendEmptyMarkRange:h}):l.setMark(A,r)};var fM=Object.freeze({__proto__:null,toggleMark:AM});const gM=(i,r,s={})=>({state:a,commands:l})=>{const h=Nn(i,a.schema),A=Nn(r,a.schema);return du(a,h,s)?l.setNode(A):l.setNode(h,s)};var mM=Object.freeze({__proto__:null,toggleNode:gM});const EM=(i,r={})=>({state:s,commands:a})=>{const l=Nn(i,s.schema);return du(s,l,r)?a.lift(l):a.wrapIn(l,r)};var vM=Object.freeze({__proto__:null,toggleWrap:EM});const IM=()=>({state:i,dispatch:r})=>{const s=i.plugins;for(let a=0;a<s.length;a+=1){const l=s[a];let h;if(l.spec.isInputRules&&(h=l.getState(i))){if(r){const A=i.tr,m=h.transform;for(let v=m.steps.length-1;v>=0;v-=1)A.step(m.steps[v].invert(m.docs[v]));if(h.text){const v=A.doc.resolve(h.from).marks();A.replaceWith(h.from,h.to,i.schema.text(h.text,v))}else A.delete(h.from,h.to)}return!0}}return!1};var CM=Object.freeze({__proto__:null,undoInputRule:IM});const _M=()=>({tr:i,dispatch:r})=>{const{selection:s}=i,{empty:a,ranges:l}=s;return a||r&&l.forEach(h=>{i.removeMark(h.$from.pos,h.$to.pos)}),!0};var yM=Object.freeze({__proto__:null,unsetAllMarks:_M});const SM=(i,r={})=>({tr:s,state:a,dispatch:l})=>{var h;const{extendEmptyMarkRange:A=!1}=r,{selection:m}=s,v=ca(i,a.schema),{$from:C,empty:S,ranges:b}=m;if(!l)return!0;if(S&&A){let{from:O,to:P}=m;const F=(h=C.marks().find($=>$.type===v))===null||h===void 0?void 0:h.attrs,W=Em(C,v,F);W&&(O=W.from,P=W.to),s.removeMark(O,P,v)}else b.forEach(O=>{s.removeMark(O.$from.pos,O.$to.pos,v)});return s.removeStoredMark(v),!0};var TM=Object.freeze({__proto__:null,unsetMark:SM});const RM=(i,r={})=>({tr:s,state:a,dispatch:l})=>{let h=null,A=null;const m=Qh(typeof i=="string"?i:i.name,a.schema);return m?(m==="node"&&(h=Nn(i,a.schema)),m==="mark"&&(A=ca(i,a.schema)),l&&s.selection.ranges.forEach(v=>{const C=v.$from.pos,S=v.$to.pos;a.doc.nodesBetween(C,S,(b,O)=>{h&&h===b.type&&s.setNodeMarkup(O,void 0,vt(vt({},b.attrs),r)),A&&b.marks.length&&b.marks.forEach(P=>{if(A===P.type){const F=Math.max(O,C),W=Math.min(O+b.nodeSize,S);s.addMark(F,W,A.create(vt(vt({},P.attrs),r)))}})})}),!0):!1};var wM=Object.freeze({__proto__:null,updateAttributes:RM});const bM=(i,r={})=>({state:s,dispatch:a})=>{const l=Nn(i,s.schema);return tD(l,r)(s,a)};var NM=Object.freeze({__proto__:null,wrapIn:bM});const OM=(i,r={})=>({state:s,dispatch:a})=>{const l=Nn(i,s.schema);return rD(l,r)(s,a)};var kM=Object.freeze({__proto__:null,wrapInList:OM});const DM=bn.create({name:"commands",addCommands(){return vt(vt(vt(vt(vt(vt(vt(vt(vt(vt(vt(vt(vt(vt(vt(vt(vt(vt(vt(vt(vt(vt(vt(vt(vt(vt(vt(vt(vt(vt(vt(vt(vt(vt(vt(vt(vt(vt(vt(vt(vt(vt(vt(vt(vt(vt(vt(vt(vt(vt({},LB),PB),UB),FB),GB),KB),WB),qB),zB),ZB),eL),nL),sL),cL),uL),AL),gL),EL),CL),yL),TL),wL),NL),kL),BL),ML),xL),QL),VL),jL),HL),YL),JL),XL),$L),eM),nM),oM),cM),uM),pM),fM),mM),vM),CM),yM),TM),wM),NM),kM)}}),BM=bn.create({name:"editable",addProseMirrorPlugins(){return[new gn({key:new ii("editable"),props:{editable:()=>this.editor.options.editable}})]}}),LM=bn.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:i}=this;return[new gn({key:new ii("focusEvents"),props:{handleDOMEvents:{focus:(r,s)=>{i.isFocused=!0;const a=i.state.tr.setMeta("focus",{event:s}).setMeta("addToHistory",!1);return r.dispatch(a),!1},blur:(r,s)=>{i.isFocused=!1;const a=i.state.tr.setMeta("blur",{event:s}).setMeta("addToHistory",!1);return r.dispatch(a),!1}}}})]}});function Vh(i){const{state:r,transaction:s}=i;let{selection:a}=s,{doc:l}=s,{storedMarks:h}=s;return wn(vt({},r),{schema:r.schema,plugins:r.plugins,apply:r.apply.bind(r),applyTransaction:r.applyTransaction.bind(r),reconfigure:r.reconfigure.bind(r),toJSON:r.toJSON.bind(r),get storedMarks(){return h},get selection(){return a},get doc(){return l},get tr(){return a=s.selection,l=s.doc,h=s.storedMarks,s}})}class Gh{constructor(r){this.editor=r.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=r.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:r,editor:s,state:a}=this,{view:l}=s,{tr:h}=a,A=this.buildProps(h);return Object.fromEntries(Object.entries(r).map(([m,v])=>[m,(...S)=>{const b=v(...S)(A);return!h.getMeta("preventDispatch")&&!this.hasCustomState&&l.dispatch(h),b}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(r,s=!0){const{rawCommands:a,editor:l,state:h}=this,{view:A}=l,m=[],v=!!r,C=r||h.tr,S=()=>(!v&&s&&!C.getMeta("preventDispatch")&&!this.hasCustomState&&A.dispatch(C),m.every(O=>O===!0)),b=wn(vt({},Object.fromEntries(Object.entries(a).map(([O,P])=>[O,(...W)=>{const $=this.buildProps(C,s),X=P(...W)($);return m.push(X),b}]))),{run:S});return b}createCan(r){const{rawCommands:s,state:a}=this,l=void 0,h=r||a.tr,A=this.buildProps(h,l),m=Object.fromEntries(Object.entries(s).map(([v,C])=>[v,(...S)=>C(...S)(wn(vt({},A),{dispatch:l}))]));return wn(vt({},m),{chain:()=>this.createChain(h,l)})}buildProps(r,s=!0){const{rawCommands:a,editor:l,state:h}=this,{view:A}=l;h.storedMarks&&r.setStoredMarks(h.storedMarks);const m={tr:r,editor:l,view:A,state:Vh({state:h,transaction:r}),dispatch:s?()=>{}:void 0,chain:()=>this.createChain(r),can:()=>this.createCan(r),get commands(){return Object.fromEntries(Object.entries(a).map(([v,C])=>[v,(...S)=>C(...S)(m)]))}};return m}}const MM=bn.create({name:"keymap",addKeyboardShortcuts(){const i=()=>this.editor.commands.first(({commands:A})=>[()=>A.undoInputRule(),()=>A.command(({tr:m})=>{const{selection:v,doc:C}=m,{empty:S,$anchor:b}=v,{pos:O,parent:P}=b,F=Ee.atStart(C).from===O;return!S||!F||!P.type.isTextblock||P.textContent.length?!1:A.clearNodes()}),()=>A.deleteSelection(),()=>A.joinBackward(),()=>A.selectNodeBackward()]),r=()=>this.editor.commands.first(({commands:A})=>[()=>A.deleteSelection(),()=>A.joinForward(),()=>A.selectNodeForward()]),a={Enter:()=>this.editor.commands.first(({commands:A})=>[()=>A.newlineInCode(),()=>A.createParagraphNear(),()=>A.liftEmptyBlock(),()=>A.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:i,"Mod-Backspace":i,"Shift-Backspace":i,Delete:r,"Mod-Delete":r,"Mod-a":()=>this.editor.commands.selectAll()},l=wn(vt({},a),{Home:()=>this.editor.commands.selectTextblockStart(),End:()=>this.editor.commands.selectTextblockEnd()}),h=wn(vt({},a),{"Ctrl-h":i,"Alt-Backspace":i,"Ctrl-d":r,"Ctrl-Alt-Backspace":r,"Alt-Delete":r,"Alt-d":r,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()});return vm()||lT()?h:l},addProseMirrorPlugins(){return[new gn({key:new ii("clearDocument"),appendTransaction:(i,r,s)=>{if(!(i.some(F=>F.docChanged)&&!r.doc.eq(s.doc)))return;const{empty:l,from:h,to:A}=r.selection,m=Ee.atStart(r.doc).from,v=Ee.atEnd(r.doc).to,C=h===m&&A===v,S=s.doc.textBetween(0,s.doc.content.size," "," ").length===0;if(l||!C||!S)return;const b=s.tr,O=Vh({state:s,transaction:b}),{commands:P}=new Gh({editor:this.editor,state:O});if(P.clearNodes(),!!b.steps.length)return b}})]}}),PM=bn.create({name:"tabindex",addProseMirrorPlugins(){return[new gn({key:new ii("tabindex"),props:{attributes:()=>{if(this.editor.isEditable)return{tabindex:"0"}}}})]}});var xM=Object.freeze({__proto__:null,ClipboardTextSerializer:DB,Commands:DM,Editable:BM,FocusEvents:LM,Keymap:MM,Tabindex:PM});function UM(i,r){const s=Nn(r,i.schema),{from:a,to:l}=i.selection,h=[];i.doc.nodesBetween(a,l,m=>{h.push(m)});const A=h.reverse().find(m=>m.type.name===s.name);return A?vt({},A.attrs):{}}function QM(i,r){const s=Qh(typeof r=="string"?r:r.name,i.schema);return s==="node"?UM(i,r):s==="mark"?dT(i,r):{}}function FM(i,r,s={}){if(!r)return du(i,null,s)||Og(i,null,s);const a=Qh(r,i.schema);return a==="node"?du(i,r,s):a==="mark"?Og(i,r,s):!1}function VM(i,r){const s=Vn.fromSchema(r).serializeFragment(i),l=document.implementation.createHTMLDocument().createElement("div");return l.appendChild(s),l.innerHTML}function GM(i,r){const s={from:0,to:i.content.size};return iT(i,s,r)}function jM(i){var r;const s=(r=i.type.createAndFill())===null||r===void 0?void 0:r.toJSON(),a=i.toJSON();return JSON.stringify(s)===JSON.stringify(a)}function KM(i){const r=document.querySelector("style[data-tiptap-style]");if(r!==null)return r;const s=document.createElement("style");return s.setAttribute("data-tiptap-style",""),s.innerHTML=i,document.getElementsByTagName("head")[0].appendChild(s),s}class jh{constructor(r){this.find=r.find,this.handler=r.handler}}const HM=(i,r)=>{if(mm(r))return r.exec(i);const s=r(i);if(!s)return null;const a=[];return a.push(s.text),a.index=s.index,a.input=i,a.data=s.data,s.replaceWith&&(s.text.includes(s.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),a.push(s.replaceWith)),a};function ig(i){var r;const{editor:s,from:a,to:l,text:h,rules:A,plugin:m}=i,{view:v}=s;if(v.composing)return!1;const C=v.state.doc.resolve(a);if(C.parent.type.spec.code||!!((r=C.nodeBefore||C.nodeAfter)===null||r===void 0?void 0:r.marks.find(P=>P.type.spec.code)))return!1;let S=!1;const b=500,O=C.parent.textBetween(Math.max(0,C.parentOffset-b),C.parentOffset,void 0," ")+h;return A.forEach(P=>{if(S)return;const F=HM(O,P.find);if(!F)return;const W=v.state.tr,$=Vh({state:v.state,transaction:W}),X={from:a-(F[0].length-h.length),to:l},{commands:K,chain:_t,can:H}=new Gh({editor:s,state:$});P.handler({state:$,range:X,match:F,commands:K,chain:_t,can:H})===null||!W.steps.length||(W.setMeta(m,{transform:W,from:a,to:l,text:h}),v.dispatch(W),S=!0)}),S}function WM(i){const{editor:r,rules:s}=i,a=new gn({state:{init(){return null},apply(l,h){const A=l.getMeta(this);return A||(l.selectionSet||l.docChanged?null:h)}},props:{handleTextInput(l,h,A,m){return ig({editor:r,from:h,to:A,text:m,rules:s,plugin:a})},handleDOMEvents:{compositionend:l=>(setTimeout(()=>{const{$cursor:h}=l.state.selection;h&&ig({editor:r,from:h.pos,to:h.pos,text:"",rules:s,plugin:a})}),!1)},handleKeyDown(l,h){if(h.key!=="Enter")return!1;const{$cursor:A}=l.state.selection;return A?ig({editor:r,from:A.pos,to:A.pos,text:`
`,rules:s,plugin:a}):!1}},isInputRules:!0});return a}function YM(i){return typeof i=="number"}class qM{constructor(r){this.find=r.find,this.handler=r.handler}}const JM=(i,r)=>{if(mm(r))return[...i.matchAll(r)];const s=r(i);return s?s.map(a=>{const l=[];return l.push(a.text),l.index=a.index,l.input=i,l.data=a.data,a.replaceWith&&(a.text.includes(a.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),l.push(a.replaceWith)),l}):[]};function zM(i){const{editor:r,state:s,from:a,to:l,rule:h}=i,{commands:A,chain:m,can:v}=new Gh({editor:r,state:s}),C=[];return s.doc.nodesBetween(a,l,(b,O)=>{if(!b.isTextblock||b.type.spec.code)return;const P=Math.max(a,O),F=Math.min(l,O+b.content.size),W=b.textBetween(P-O,F-O,void 0,"\uFFFC");JM(W,h.find).forEach(X=>{if(X.index===void 0)return;const K=P+X.index+1,_t=K+X[0].length,H={from:s.tr.mapping.map(K),to:s.tr.mapping.map(_t)},ft=h.handler({state:s,range:H,match:X,commands:A,chain:m,can:v});C.push(ft)})}),C.every(b=>b!==null)}function XM(i){const{editor:r,rules:s}=i;let a=null,l=!1,h=!1;return s.map(m=>new gn({view(v){const C=S=>{var b;a=((b=v.dom.parentElement)===null||b===void 0?void 0:b.contains(S.target))?v.dom.parentElement:null};return window.addEventListener("dragstart",C),{destroy(){window.removeEventListener("dragstart",C)}}},props:{handleDOMEvents:{drop:v=>(h=a===v.dom.parentElement,!1),paste:(v,C)=>{var S;const b=(S=C.clipboardData)===null||S===void 0?void 0:S.getData("text/html");return l=!!(b==null?void 0:b.includes("data-pm-slice")),!1}}},appendTransaction:(v,C,S)=>{const b=v[0],O=b.getMeta("uiEvent")==="paste"&&!l,P=b.getMeta("uiEvent")==="drop"&&!h;if(!O&&!P)return;const F=C.doc.content.findDiffStart(S.doc.content),W=C.doc.content.findDiffEnd(S.doc.content);if(!YM(F)||!W||F===W.b)return;const $=S.tr,X=Vh({state:S,transaction:$});if(!(!zM({editor:r,state:X,from:Math.max(F-1,0),to:W.b,rule:m})||!$.steps.length))return $}}))}function hT(i){const r=[],{nodeExtensions:s,markExtensions:a}=Fh(i),l=[...s,...a],h={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0};return i.forEach(A=>{const m={name:A.name,options:A.options,storage:A.storage},v=Jt(A,"addGlobalAttributes",m);if(!v)return;v().forEach(S=>{S.types.forEach(b=>{Object.entries(S.attributes).forEach(([O,P])=>{r.push({type:b,name:O,attribute:vt(vt({},h),P)})})})})}),l.forEach(A=>{const m={name:A.name,options:A.options,storage:A.storage},v=Jt(A,"addAttributes",m);if(!v)return;const C=v();Object.entries(C).forEach(([S,b])=>{r.push({type:A.name,name:S,attribute:vt(vt({},h),b)})})}),r}function On(...i){return i.filter(r=>!!r).reduce((r,s)=>{const a=vt({},r);return Object.entries(s).forEach(([l,h])=>{if(!a[l]){a[l]=h;return}l==="class"?a[l]=[a[l],h].join(" "):l==="style"?a[l]=[a[l],h].join("; "):a[l]=h}),a},{})}function kg(i,r){return r.filter(s=>s.attribute.rendered).map(s=>s.attribute.renderHTML?s.attribute.renderHTML(i.attrs)||{}:{[s.name]:i.attrs[s.name]}).reduce((s,a)=>On(s,a),{})}function ZM(i={}){return Object.keys(i).length===0&&i.constructor===Object}function $M(i){return typeof i!="string"?i:i.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(i):i==="true"?!0:i==="false"?!1:i}function Ky(i,r){return i.style?i:wn(vt({},i),{getAttrs:s=>{const a=i.getAttrs?i.getAttrs(s):i.attrs;if(a===!1)return!1;const l=r.reduce((h,A)=>{const m=A.attribute.parseHTML?A.attribute.parseHTML(s):$M(s.getAttribute(A.name));return m==null?h:wn(vt({},h),{[A.name]:m})},{});return vt(vt({},a),l)}})}function Hy(i){return Object.fromEntries(Object.entries(i).filter(([r,s])=>r==="attrs"&&ZM(s)?!1:s!=null))}function tP(i){var r;const s=hT(i),{nodeExtensions:a,markExtensions:l}=Fh(i),h=(r=a.find(v=>Jt(v,"topNode")))===null||r===void 0?void 0:r.name,A=Object.fromEntries(a.map(v=>{const C=s.filter($=>$.type===v.name),S={name:v.name,options:v.options,storage:v.storage},b=i.reduce(($,X)=>{const K=Jt(X,"extendNodeSchema",S);return vt(vt({},$),K?K(v):{})},{}),O=Hy(wn(vt({},b),{content:Oe(Jt(v,"content",S)),marks:Oe(Jt(v,"marks",S)),group:Oe(Jt(v,"group",S)),inline:Oe(Jt(v,"inline",S)),atom:Oe(Jt(v,"atom",S)),selectable:Oe(Jt(v,"selectable",S)),draggable:Oe(Jt(v,"draggable",S)),code:Oe(Jt(v,"code",S)),defining:Oe(Jt(v,"defining",S)),isolating:Oe(Jt(v,"isolating",S)),attrs:Object.fromEntries(C.map($=>{var X;return[$.name,{default:(X=$==null?void 0:$.attribute)===null||X===void 0?void 0:X.default}]}))})),P=Oe(Jt(v,"parseHTML",S));P&&(O.parseDOM=P.map($=>Ky($,C)));const F=Jt(v,"renderHTML",S);F&&(O.toDOM=$=>F({node:$,HTMLAttributes:kg($,C)}));const W=Jt(v,"renderText",S);return W&&(O.toText=W),[v.name,O]})),m=Object.fromEntries(l.map(v=>{const C=s.filter(W=>W.type===v.name),S={name:v.name,options:v.options,storage:v.storage},b=i.reduce((W,$)=>{const X=Jt($,"extendMarkSchema",S);return vt(vt({},W),X?X(v):{})},{}),O=Hy(wn(vt({},b),{inclusive:Oe(Jt(v,"inclusive",S)),excludes:Oe(Jt(v,"excludes",S)),group:Oe(Jt(v,"group",S)),spanning:Oe(Jt(v,"spanning",S)),code:Oe(Jt(v,"code",S)),attrs:Object.fromEntries(C.map(W=>{var $;return[W.name,{default:($=W==null?void 0:W.attribute)===null||$===void 0?void 0:$.default}]}))})),P=Oe(Jt(v,"parseHTML",S));P&&(O.parseDOM=P.map(W=>Ky(W,C)));const F=Jt(v,"renderHTML",S);return F&&(O.toDOM=W=>F({mark:W,HTMLAttributes:kg(W,C)})),[v.name,O]}));return new Ka({topNode:h,nodes:A,marks:m})}function og(i,r){return r.nodes[i]||r.marks[i]||null}function Wy(i,r){return Array.isArray(r)?r.some(s=>(typeof s=="string"?s:s.name)===i.name):r}function eP(i){const r=i.filter((s,a)=>i.indexOf(s)!==a);return[...new Set(r)]}class Mc{constructor(r,s){this.splittableMarks=[],this.editor=s,this.extensions=Mc.resolve(r),this.schema=tP(this.extensions),this.extensions.forEach(a=>{var l;this.editor.extensionStorage[a.name]=a.storage;const h={name:a.name,options:a.options,storage:a.storage,editor:this.editor,type:og(a.name,this.schema)};a.type==="mark"&&((l=Oe(Jt(a,"keepOnSplit",h)))!==null&&l!==void 0?l:!0)&&this.splittableMarks.push(a.name);const A=Jt(a,"onBeforeCreate",h);A&&this.editor.on("beforeCreate",A);const m=Jt(a,"onCreate",h);m&&this.editor.on("create",m);const v=Jt(a,"onUpdate",h);v&&this.editor.on("update",v);const C=Jt(a,"onSelectionUpdate",h);C&&this.editor.on("selectionUpdate",C);const S=Jt(a,"onTransaction",h);S&&this.editor.on("transaction",S);const b=Jt(a,"onFocus",h);b&&this.editor.on("focus",b);const O=Jt(a,"onBlur",h);O&&this.editor.on("blur",O);const P=Jt(a,"onDestroy",h);P&&this.editor.on("destroy",P)})}static resolve(r){const s=Mc.sort(Mc.flatten(r)),a=eP(s.map(l=>l.name));return a.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${a.map(l=>`'${l}'`).join(", ")}]. This can lead to issues.`),s}static flatten(r){return r.map(s=>{const a={name:s.name,options:s.options,storage:s.storage},l=Jt(s,"addExtensions",a);return l?[s,...this.flatten(l())]:s}).flat(10)}static sort(r){return r.sort((a,l)=>{const h=Jt(a,"priority")||100,A=Jt(l,"priority")||100;return h>A?-1:h<A?1:0})}get commands(){return this.extensions.reduce((r,s)=>{const a={name:s.name,options:s.options,storage:s.storage,editor:this.editor,type:og(s.name,this.schema)},l=Jt(s,"addCommands",a);return l?vt(vt({},r),l()):r},{})}get plugins(){const{editor:r}=this,s=Mc.sort([...this.extensions].reverse()),a=[],l=[],h=s.map(A=>{const m={name:A.name,options:A.options,storage:A.storage,editor:r,type:og(A.name,this.schema)},v=[],C=Jt(A,"addKeyboardShortcuts",m);if(C){const P=Object.fromEntries(Object.entries(C()).map(([W,$])=>[W,()=>$({editor:r})])),F=OB(P);v.push(F)}const S=Jt(A,"addInputRules",m);Wy(A,r.options.enableInputRules)&&S&&a.push(...S());const b=Jt(A,"addPasteRules",m);Wy(A,r.options.enablePasteRules)&&b&&l.push(...b());const O=Jt(A,"addProseMirrorPlugins",m);if(O){const P=O();v.push(...P)}return v}).flat();return[WM({editor:r,rules:a}),...XM({editor:r,rules:l}),...h]}get attributes(){return hT(this.extensions)}get nodeViews(){const{editor:r}=this,{nodeExtensions:s}=Fh(this.extensions);return Object.fromEntries(s.filter(a=>!!Jt(a,"addNodeView")).map(a=>{const l=this.attributes.filter(v=>v.type===a.name),h={name:a.name,options:a.options,storage:a.storage,editor:r,type:Nn(a.name,this.schema)},A=Jt(a,"addNodeView",h);if(!A)return[];const m=(v,C,S,b)=>{const O=kg(v,l);return A()({editor:r,node:v,getPos:S,decorations:b,HTMLAttributes:O,extension:a})};return[a.name,m]}))}}class rP{constructor(){this.callbacks={}}on(r,s){return this.callbacks[r]||(this.callbacks[r]=[]),this.callbacks[r].push(s),this}emit(r,...s){const a=this.callbacks[r];return a&&a.forEach(l=>l.apply(this,s)),this}off(r,s){const a=this.callbacks[r];return a&&(s?this.callbacks[r]=a.filter(l=>l!==s):delete this.callbacks[r]),this}removeAllListeners(){this.callbacks={}}}const nP=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 1px !important;
  height: 1px !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}

.tippy-box[data-animation=fade][data-state=hidden] {
  opacity: 0
}`;class iP extends rP{constructor(r={}){super();this.isFocused=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(r),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}))},0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=KM(nP))}setOptions(r={}){this.options=vt(vt({},this.options),r),!(!this.view||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(r){this.setOptions({editable:r})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(r,s){const a=nT(s)?s(r,this.state.plugins):[...this.state.plugins,r],l=this.state.reconfigure({plugins:a});this.view.updateState(l)}unregisterPlugin(r){if(this.isDestroyed)return;const s=typeof r=="string"?`${r}$`:r.key,a=this.state.reconfigure({plugins:this.state.plugins.filter(l=>!l.key.startsWith(s))});this.view.updateState(a)}createExtensionManager(){const s=[...this.options.enableCoreExtensions?Object.values(xM):[],...this.options.extensions].filter(a=>["extension","node","mark"].includes(a==null?void 0:a.type));this.extensionManager=new Mc(s,this)}createCommandManager(){this.commandManager=new Gh({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){const r=uT(this.options.content,this.schema,this.options.parseOptions),s=cT(r,this.options.autofocus);this.view=new on(this.options.element,wn(vt({},this.options.editorProps),{dispatchTransaction:this.dispatchTransaction.bind(this),state:ei.create({doc:r,selection:s})}));const a=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(a),this.createNodeViews();const l=this.view.dom;l.editor=this}createNodeViews(){this.view.setProps({nodeViews:this.extensionManager.nodeViews})}captureTransaction(r){this.isCapturingTransaction=!0,r(),this.isCapturingTransaction=!1;const s=this.capturedTransaction;return this.capturedTransaction=null,s}dispatchTransaction(r){if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=r;return}r.steps.forEach(A=>{var m;return(m=this.capturedTransaction)===null||m===void 0?void 0:m.step(A)});return}const s=this.state.apply(r),a=!this.state.selection.eq(s.selection);this.view.updateState(s),this.emit("transaction",{editor:this,transaction:r}),a&&this.emit("selectionUpdate",{editor:this,transaction:r});const l=r.getMeta("focus"),h=r.getMeta("blur");l&&this.emit("focus",{editor:this,event:l.event,transaction:r}),h&&this.emit("blur",{editor:this,event:h.event,transaction:r}),!(!r.docChanged||r.getMeta("preventUpdate"))&&this.emit("update",{editor:this,transaction:r})}getAttributes(r){return QM(this.state,r)}isActive(r,s){const a=typeof r=="string"?r:null,l=typeof r=="string"?s:r;return FM(this.state,a,l)}getJSON(){return this.state.doc.toJSON()}getHTML(){return VM(this.state.doc.content,this.schema)}getText(r){const{blockSeparator:s=`

`,textSerializers:a={}}=r||{};return GM(this.state.doc,{blockSeparator:s,textSerializers:vt(vt({},a),oT(this.schema))})}get isEmpty(){return jM(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){this.emit("destroy"),this.view&&this.view.destroy(),this.removeAllListeners()}get isDestroyed(){var r;return!((r=this.view)===null||r===void 0?void 0:r.docView)}}class ri{constructor(r={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config=vt(vt({},this.config),r),this.name=this.config.name,r.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=Oe(Jt(this,"addOptions",{name:this.name}))),this.storage=Oe(Jt(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(r={}){return new ri(r)}configure(r={}){const s=this.extend();return s.options=Uh(this.options,r),s.storage=Oe(Jt(s,"addStorage",{name:s.name,options:s.options})),s}extend(r={}){const s=new ri(r);return s.parent=this,this.child=s,s.name=r.name?r.name:s.parent.name,r.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${s.name}".`),s.options=Oe(Jt(s,"addOptions",{name:s.name})),s.storage=Oe(Jt(s,"addStorage",{name:s.name,options:s.options})),s}}class oa{constructor(r={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config=vt(vt({},this.config),r),this.name=this.config.name,r.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=Oe(Jt(this,"addOptions",{name:this.name}))),this.storage=Oe(Jt(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(r={}){return new oa(r)}configure(r={}){const s=this.extend();return s.options=Uh(this.options,r),s.storage=Oe(Jt(s,"addStorage",{name:s.name,options:s.options})),s}extend(r={}){const s=new oa(r);return s.parent=this,this.child=s,s.name=r.name?r.name:s.parent.name,r.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${s.name}".`),s.options=Oe(Jt(s,"addOptions",{name:s.name})),s.storage=Oe(Jt(s,"addStorage",{name:s.name,options:s.options})),s}}function oP(i){return new jh({find:i.find,handler:({state:r,range:s,match:a})=>{const l=Oe(i.getAttributes,void 0,a)||{},{tr:h}=r,A=s.from;let m=s.to;if(a[1]){const v=a[0].lastIndexOf(a[1]);let C=A+v;C>m?C=m:m=C+a[1].length;const S=a[0][a[0].length-1];h.insertText(S,A+a[0].length-1),h.replaceWith(C,m,i.type.create(l))}else a[0]&&h.replaceWith(A,m,i.type.create(l))}})}function pT(i,r,s){const a=[];return i===r?s.resolve(i).marks().forEach(l=>{const h=s.resolve(i-1),A=Em(h,l.type);!A||a.push(vt({mark:l},A))}):s.nodesBetween(i,r,(l,h)=>{a.push(...l.marks.map(A=>({from:h,to:h+l.nodeSize,mark:A})))}),a}function Ga(i){return new jh({find:i.find,handler:({state:r,range:s,match:a})=>{const l=Oe(i.getAttributes,void 0,a);if(l===!1||l===null)return null;const{tr:h}=r,A=a[a.length-1],m=a[0];let v=s.to;if(A){const C=m.search(/\S/),S=s.from+m.indexOf(A),b=S+A.length;if(pT(s.from,s.to,r.doc).filter(P=>P.mark.type.excluded.find(W=>W===i.type&&W!==P.mark.type)).filter(P=>P.to>S).length)return null;b<s.to&&h.delete(b,s.to),S>s.from&&h.delete(s.from+C,S),v=s.from+C+A.length,h.addMark(s.from+C,v,i.type.create(l||{})),h.removeStoredMark(i.type)}}})}function Dg(i){return new jh({find:i.find,handler:({state:r,range:s,match:a})=>{const l=r.doc.resolve(s.from),h=Oe(i.getAttributes,void 0,a)||{};if(!l.node(-1).canReplaceWith(l.index(-1),l.indexAfter(-1),i.type))return null;r.tr.delete(s.from,s.to).setBlockType(s.from,s.from,i.type,h)}})}function Kh(i){return new jh({find:i.find,handler:({state:r,range:s,match:a})=>{const l=Oe(i.getAttributes,void 0,a)||{},h=r.tr.delete(s.from,s.to),m=h.doc.resolve(s.from).blockRange(),v=m&&Wg(m,i.type,l);if(!v)return null;h.wrap(m,v);const C=h.doc.resolve(s.from-1).nodeBefore;C&&C.type===i.type&&mu(h.doc,s.from-1)&&(!i.joinPredicate||i.joinPredicate(a,C))&&h.join(s.from-1)}})}function ja(i){return new qM({find:i.find,handler:({state:r,range:s,match:a})=>{const l=Oe(i.getAttributes,void 0,a);if(l===!1||l===null)return null;const{tr:h}=r,A=a[a.length-1],m=a[0];let v=s.to;if(A){const C=m.search(/\S/),S=s.from+m.indexOf(A),b=S+A.length;if(pT(s.from,s.to,r.doc).filter(P=>P.mark.type.excluded.find(W=>W===i.type&&W!==P.mark.type)).filter(P=>P.to>S).length)return null;b<s.to&&h.delete(b,s.to),S>s.from&&h.delete(s.from+C,S),v=s.from+C+A.length,h.addMark(s.from+C,v,i.type.create(l||{})),h.removeStoredMark(i.type)}}})}function sP(i){return sT(i)&&i instanceof me}function AT(i,r,s){const l=i.state.doc.content.size,h=Ss(r,0,l),A=Ss(s,0,l),m=i.coordsAtPos(h),v=i.coordsAtPos(A,-1),C=Math.min(m.top,v.top),S=Math.max(m.bottom,v.bottom),b=Math.min(m.left,v.left),O=Math.max(m.right,v.right),P=O-b,F=S-C,X={top:C,bottom:S,left:b,right:O,width:P,height:F,x:b,y:C};return wn(vt({},X),{toJSON:()=>X})}var wi="top",Ao="bottom",fo="right",bi="left",Cm="auto",Cu=[wi,Ao,fo,bi],jc="start",hu="end",aP="clippingParents",fT="viewport",Kl="popper",cP="reference",Yy=Cu.reduce(function(i,r){return i.concat([r+"-"+jc,r+"-"+hu])},[]),gT=[].concat(Cu,[Cm]).reduce(function(i,r){return i.concat([r,r+"-"+jc,r+"-"+hu])},[]),lP="beforeRead",uP="read",dP="afterRead",hP="beforeMain",pP="main",AP="afterMain",fP="beforeWrite",gP="write",mP="afterWrite",EP=[lP,uP,dP,hP,pP,AP,fP,gP,mP];function qo(i){return i?(i.nodeName||"").toLowerCase():null}function Lo(i){if(i==null)return window;if(i.toString()!=="[object Window]"){var r=i.ownerDocument;return r&&r.defaultView||window}return i}function Kc(i){var r=Lo(i).Element;return i instanceof r||i instanceof Element}function po(i){var r=Lo(i).HTMLElement;return i instanceof r||i instanceof HTMLElement}function mT(i){if(typeof ShadowRoot=="undefined")return!1;var r=Lo(i).ShadowRoot;return i instanceof r||i instanceof ShadowRoot}function vP(i){var r=i.state;Object.keys(r.elements).forEach(function(s){var a=r.styles[s]||{},l=r.attributes[s]||{},h=r.elements[s];!po(h)||!qo(h)||(Object.assign(h.style,a),Object.keys(l).forEach(function(A){var m=l[A];m===!1?h.removeAttribute(A):h.setAttribute(A,m===!0?"":m)}))})}function IP(i){var r=i.state,s={popper:{position:r.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(r.elements.popper.style,s.popper),r.styles=s,r.elements.arrow&&Object.assign(r.elements.arrow.style,s.arrow),function(){Object.keys(r.elements).forEach(function(a){var l=r.elements[a],h=r.attributes[a]||{},A=Object.keys(r.styles.hasOwnProperty(a)?r.styles[a]:s[a]),m=A.reduce(function(v,C){return v[C]="",v},{});!po(l)||!qo(l)||(Object.assign(l.style,m),Object.keys(h).forEach(function(v){l.removeAttribute(v)}))})}}var ET={name:"applyStyles",enabled:!0,phase:"write",fn:vP,effect:IP,requires:["computeStyles"]};function Ho(i){return i.split("-")[0]}var Qa=Math.max,Ih=Math.min,Hc=Math.round;function Wc(i,r){r===void 0&&(r=!1);var s=i.getBoundingClientRect(),a=1,l=1;if(po(i)&&r){var h=i.offsetHeight,A=i.offsetWidth;A>0&&(a=Hc(s.width)/A||1),h>0&&(l=Hc(s.height)/h||1)}return{width:s.width/a,height:s.height/l,top:s.top/l,right:s.right/a,bottom:s.bottom/l,left:s.left/a,x:s.left/a,y:s.top/l}}function _m(i){var r=Wc(i),s=i.offsetWidth,a=i.offsetHeight;return Math.abs(r.width-s)<=1&&(s=r.width),Math.abs(r.height-a)<=1&&(a=r.height),{x:i.offsetLeft,y:i.offsetTop,width:s,height:a}}function vT(i,r){var s=r.getRootNode&&r.getRootNode();if(i.contains(r))return!0;if(s&&mT(s)){var a=r;do{if(a&&i.isSameNode(a))return!0;a=a.parentNode||a.host}while(a)}return!1}function Ns(i){return Lo(i).getComputedStyle(i)}function CP(i){return["table","td","th"].indexOf(qo(i))>=0}function la(i){return((Kc(i)?i.ownerDocument:i.document)||window.document).documentElement}function Hh(i){return qo(i)==="html"?i:i.assignedSlot||i.parentNode||(mT(i)?i.host:null)||la(i)}function qy(i){return!po(i)||Ns(i).position==="fixed"?null:i.offsetParent}function _P(i){var r=navigator.userAgent.toLowerCase().indexOf("firefox")!==-1,s=navigator.userAgent.indexOf("Trident")!==-1;if(s&&po(i)){var a=Ns(i);if(a.position==="fixed")return null}for(var l=Hh(i);po(l)&&["html","body"].indexOf(qo(l))<0;){var h=Ns(l);if(h.transform!=="none"||h.perspective!=="none"||h.contain==="paint"||["transform","perspective"].indexOf(h.willChange)!==-1||r&&h.willChange==="filter"||r&&h.filter&&h.filter!=="none")return l;l=l.parentNode}return null}function _u(i){for(var r=Lo(i),s=qy(i);s&&CP(s)&&Ns(s).position==="static";)s=qy(s);return s&&(qo(s)==="html"||qo(s)==="body"&&Ns(s).position==="static")?r:s||_P(i)||r}function ym(i){return["top","bottom"].indexOf(i)>=0?"x":"y"}function $l(i,r,s){return Qa(i,Ih(r,s))}function yP(i,r,s){var a=$l(i,r,s);return a>s?s:a}function IT(){return{top:0,right:0,bottom:0,left:0}}function CT(i){return Object.assign({},IT(),i)}function _T(i,r){return r.reduce(function(s,a){return s[a]=i,s},{})}var SP=function(r,s){return r=typeof r=="function"?r(Object.assign({},s.rects,{placement:s.placement})):r,CT(typeof r!="number"?r:_T(r,Cu))};function TP(i){var r,s=i.state,a=i.name,l=i.options,h=s.elements.arrow,A=s.modifiersData.popperOffsets,m=Ho(s.placement),v=ym(m),C=[bi,fo].indexOf(m)>=0,S=C?"height":"width";if(!(!h||!A)){var b=SP(l.padding,s),O=_m(h),P=v==="y"?wi:bi,F=v==="y"?Ao:fo,W=s.rects.reference[S]+s.rects.reference[v]-A[v]-s.rects.popper[S],$=A[v]-s.rects.reference[v],X=_u(h),K=X?v==="y"?X.clientHeight||0:X.clientWidth||0:0,_t=W/2-$/2,H=b[P],ft=K-O[S]-b[F],Tt=K/2-O[S]/2+_t,$t=$l(H,Tt,ft),ne=v;s.modifiersData[a]=(r={},r[ne]=$t,r.centerOffset=$t-Tt,r)}}function RP(i){var r=i.state,s=i.options,a=s.element,l=a===void 0?"[data-popper-arrow]":a;l!=null&&(typeof l=="string"&&(l=r.elements.popper.querySelector(l),!l)||!vT(r.elements.popper,l)||(r.elements.arrow=l))}var wP={name:"arrow",enabled:!0,phase:"main",fn:TP,effect:RP,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Yc(i){return i.split("-")[1]}var bP={top:"auto",right:"auto",bottom:"auto",left:"auto"};function NP(i){var r=i.x,s=i.y,a=window,l=a.devicePixelRatio||1;return{x:Hc(r*l)/l||0,y:Hc(s*l)/l||0}}function Jy(i){var r,s=i.popper,a=i.popperRect,l=i.placement,h=i.variation,A=i.offsets,m=i.position,v=i.gpuAcceleration,C=i.adaptive,S=i.roundOffsets,b=i.isFixed,O=A.x,P=O===void 0?0:O,F=A.y,W=F===void 0?0:F,$=typeof S=="function"?S({x:P,y:W}):{x:P,y:W};P=$.x,W=$.y;var X=A.hasOwnProperty("x"),K=A.hasOwnProperty("y"),_t=bi,H=wi,ft=window;if(C){var Tt=_u(s),$t="clientHeight",ne="clientWidth";if(Tt===Lo(s)&&(Tt=la(s),Ns(Tt).position!=="static"&&m==="absolute"&&($t="scrollHeight",ne="scrollWidth")),Tt=Tt,l===wi||(l===bi||l===fo)&&h===hu){H=Ao;var Te=b&&ft.visualViewport?ft.visualViewport.height:Tt[$t];W-=Te-a.height,W*=v?1:-1}if(l===bi||(l===wi||l===Ao)&&h===hu){_t=fo;var ve=b&&ft.visualViewport?ft.visualViewport.width:Tt[ne];P-=ve-a.width,P*=v?1:-1}}var qe=Object.assign({position:m},C&&bP),Xe=S===!0?NP({x:P,y:W}):{x:P,y:W};if(P=Xe.x,W=Xe.y,v){var je;return Object.assign({},qe,(je={},je[H]=K?"0":"",je[_t]=X?"0":"",je.transform=(ft.devicePixelRatio||1)<=1?"translate("+P+"px, "+W+"px)":"translate3d("+P+"px, "+W+"px, 0)",je))}return Object.assign({},qe,(r={},r[H]=K?W+"px":"",r[_t]=X?P+"px":"",r.transform="",r))}function OP(i){var r=i.state,s=i.options,a=s.gpuAcceleration,l=a===void 0?!0:a,h=s.adaptive,A=h===void 0?!0:h,m=s.roundOffsets,v=m===void 0?!0:m,C={placement:Ho(r.placement),variation:Yc(r.placement),popper:r.elements.popper,popperRect:r.rects.popper,gpuAcceleration:l,isFixed:r.options.strategy==="fixed"};r.modifiersData.popperOffsets!=null&&(r.styles.popper=Object.assign({},r.styles.popper,Jy(Object.assign({},C,{offsets:r.modifiersData.popperOffsets,position:r.options.strategy,adaptive:A,roundOffsets:v})))),r.modifiersData.arrow!=null&&(r.styles.arrow=Object.assign({},r.styles.arrow,Jy(Object.assign({},C,{offsets:r.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:v})))),r.attributes.popper=Object.assign({},r.attributes.popper,{"data-popper-placement":r.placement})}var kP={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:OP,data:{}},zd={passive:!0};function DP(i){var r=i.state,s=i.instance,a=i.options,l=a.scroll,h=l===void 0?!0:l,A=a.resize,m=A===void 0?!0:A,v=Lo(r.elements.popper),C=[].concat(r.scrollParents.reference,r.scrollParents.popper);return h&&C.forEach(function(S){S.addEventListener("scroll",s.update,zd)}),m&&v.addEventListener("resize",s.update,zd),function(){h&&C.forEach(function(S){S.removeEventListener("scroll",s.update,zd)}),m&&v.removeEventListener("resize",s.update,zd)}}var BP={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:DP,data:{}},LP={left:"right",right:"left",bottom:"top",top:"bottom"};function ih(i){return i.replace(/left|right|bottom|top/g,function(r){return LP[r]})}var MP={start:"end",end:"start"};function zy(i){return i.replace(/start|end/g,function(r){return MP[r]})}function Sm(i){var r=Lo(i),s=r.pageXOffset,a=r.pageYOffset;return{scrollLeft:s,scrollTop:a}}function Tm(i){return Wc(la(i)).left+Sm(i).scrollLeft}function PP(i){var r=Lo(i),s=la(i),a=r.visualViewport,l=s.clientWidth,h=s.clientHeight,A=0,m=0;return a&&(l=a.width,h=a.height,/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||(A=a.offsetLeft,m=a.offsetTop)),{width:l,height:h,x:A+Tm(i),y:m}}function xP(i){var r,s=la(i),a=Sm(i),l=(r=i.ownerDocument)==null?void 0:r.body,h=Qa(s.scrollWidth,s.clientWidth,l?l.scrollWidth:0,l?l.clientWidth:0),A=Qa(s.scrollHeight,s.clientHeight,l?l.scrollHeight:0,l?l.clientHeight:0),m=-a.scrollLeft+Tm(i),v=-a.scrollTop;return Ns(l||s).direction==="rtl"&&(m+=Qa(s.clientWidth,l?l.clientWidth:0)-h),{width:h,height:A,x:m,y:v}}function Rm(i){var r=Ns(i),s=r.overflow,a=r.overflowX,l=r.overflowY;return/auto|scroll|overlay|hidden/.test(s+l+a)}function yT(i){return["html","body","#document"].indexOf(qo(i))>=0?i.ownerDocument.body:po(i)&&Rm(i)?i:yT(Hh(i))}function tu(i,r){var s;r===void 0&&(r=[]);var a=yT(i),l=a===((s=i.ownerDocument)==null?void 0:s.body),h=Lo(a),A=l?[h].concat(h.visualViewport||[],Rm(a)?a:[]):a,m=r.concat(A);return l?m:m.concat(tu(Hh(A)))}function Bg(i){return Object.assign({},i,{left:i.x,top:i.y,right:i.x+i.width,bottom:i.y+i.height})}function UP(i){var r=Wc(i);return r.top=r.top+i.clientTop,r.left=r.left+i.clientLeft,r.bottom=r.top+i.clientHeight,r.right=r.left+i.clientWidth,r.width=i.clientWidth,r.height=i.clientHeight,r.x=r.left,r.y=r.top,r}function Xy(i,r){return r===fT?Bg(PP(i)):Kc(r)?UP(r):Bg(xP(la(i)))}function QP(i){var r=tu(Hh(i)),s=["absolute","fixed"].indexOf(Ns(i).position)>=0,a=s&&po(i)?_u(i):i;return Kc(a)?r.filter(function(l){return Kc(l)&&vT(l,a)&&qo(l)!=="body"}):[]}function FP(i,r,s){var a=r==="clippingParents"?QP(i):[].concat(r),l=[].concat(a,[s]),h=l[0],A=l.reduce(function(m,v){var C=Xy(i,v);return m.top=Qa(C.top,m.top),m.right=Ih(C.right,m.right),m.bottom=Ih(C.bottom,m.bottom),m.left=Qa(C.left,m.left),m},Xy(i,h));return A.width=A.right-A.left,A.height=A.bottom-A.top,A.x=A.left,A.y=A.top,A}function ST(i){var r=i.reference,s=i.element,a=i.placement,l=a?Ho(a):null,h=a?Yc(a):null,A=r.x+r.width/2-s.width/2,m=r.y+r.height/2-s.height/2,v;switch(l){case wi:v={x:A,y:r.y-s.height};break;case Ao:v={x:A,y:r.y+r.height};break;case fo:v={x:r.x+r.width,y:m};break;case bi:v={x:r.x-s.width,y:m};break;default:v={x:r.x,y:r.y}}var C=l?ym(l):null;if(C!=null){var S=C==="y"?"height":"width";switch(h){case jc:v[C]=v[C]-(r[S]/2-s[S]/2);break;case hu:v[C]=v[C]+(r[S]/2-s[S]/2);break}}return v}function pu(i,r){r===void 0&&(r={});var s=r,a=s.placement,l=a===void 0?i.placement:a,h=s.boundary,A=h===void 0?aP:h,m=s.rootBoundary,v=m===void 0?fT:m,C=s.elementContext,S=C===void 0?Kl:C,b=s.altBoundary,O=b===void 0?!1:b,P=s.padding,F=P===void 0?0:P,W=CT(typeof F!="number"?F:_T(F,Cu)),$=S===Kl?cP:Kl,X=i.rects.popper,K=i.elements[O?$:S],_t=FP(Kc(K)?K:K.contextElement||la(i.elements.popper),A,v),H=Wc(i.elements.reference),ft=ST({reference:H,element:X,strategy:"absolute",placement:l}),Tt=Bg(Object.assign({},X,ft)),$t=S===Kl?Tt:H,ne={top:_t.top-$t.top+W.top,bottom:$t.bottom-_t.bottom+W.bottom,left:_t.left-$t.left+W.left,right:$t.right-_t.right+W.right},Te=i.modifiersData.offset;if(S===Kl&&Te){var ve=Te[l];Object.keys(ne).forEach(function(qe){var Xe=[fo,Ao].indexOf(qe)>=0?1:-1,je=[wi,Ao].indexOf(qe)>=0?"y":"x";ne[qe]+=ve[je]*Xe})}return ne}function VP(i,r){r===void 0&&(r={});var s=r,a=s.placement,l=s.boundary,h=s.rootBoundary,A=s.padding,m=s.flipVariations,v=s.allowedAutoPlacements,C=v===void 0?gT:v,S=Yc(a),b=S?m?Yy:Yy.filter(function(F){return Yc(F)===S}):Cu,O=b.filter(function(F){return C.indexOf(F)>=0});O.length===0&&(O=b);var P=O.reduce(function(F,W){return F[W]=pu(i,{placement:W,boundary:l,rootBoundary:h,padding:A})[Ho(W)],F},{});return Object.keys(P).sort(function(F,W){return P[F]-P[W]})}function GP(i){if(Ho(i)===Cm)return[];var r=ih(i);return[zy(i),r,zy(r)]}function jP(i){var r=i.state,s=i.options,a=i.name;if(!r.modifiersData[a]._skip){for(var l=s.mainAxis,h=l===void 0?!0:l,A=s.altAxis,m=A===void 0?!0:A,v=s.fallbackPlacements,C=s.padding,S=s.boundary,b=s.rootBoundary,O=s.altBoundary,P=s.flipVariations,F=P===void 0?!0:P,W=s.allowedAutoPlacements,$=r.options.placement,X=Ho($),K=X===$,_t=v||(K||!F?[ih($)]:GP($)),H=[$].concat(_t).reduce(function(kr,yr){return kr.concat(Ho(yr)===Cm?VP(r,{placement:yr,boundary:S,rootBoundary:b,padding:C,flipVariations:F,allowedAutoPlacements:W}):yr)},[]),ft=r.rects.reference,Tt=r.rects.popper,$t=new Map,ne=!0,Te=H[0],ve=0;ve<H.length;ve++){var qe=H[ve],Xe=Ho(qe),je=Yc(qe)===jc,mn=[wi,Ao].indexOf(Xe)>=0,sr=mn?"width":"height",Le=pu(r,{placement:qe,boundary:S,rootBoundary:b,altBoundary:O,padding:C}),Fr=mn?je?fo:bi:je?Ao:wi;ft[sr]>Tt[sr]&&(Fr=ih(Fr));var zr=ih(Fr),le=[];if(h&&le.push(Le[Xe]<=0),m&&le.push(Le[Fr]<=0,Le[zr]<=0),le.every(function(kr){return kr})){Te=qe,ne=!1;break}$t.set(qe,le)}if(ne)for(var Or=F?3:1,Kn=function(yr){var Eo=H.find(function(Ds){var jt=$t.get(Ds);if(jt)return jt.slice(0,yr).every(function(Bs){return Bs})});if(Eo)return Te=Eo,"break"},ar=Or;ar>0;ar--){var Mo=Kn(ar);if(Mo==="break")break}r.placement!==Te&&(r.modifiersData[a]._skip=!0,r.placement=Te,r.reset=!0)}}var KP={name:"flip",enabled:!0,phase:"main",fn:jP,requiresIfExists:["offset"],data:{_skip:!1}};function Zy(i,r,s){return s===void 0&&(s={x:0,y:0}),{top:i.top-r.height-s.y,right:i.right-r.width+s.x,bottom:i.bottom-r.height+s.y,left:i.left-r.width-s.x}}function $y(i){return[wi,fo,Ao,bi].some(function(r){return i[r]>=0})}function HP(i){var r=i.state,s=i.name,a=r.rects.reference,l=r.rects.popper,h=r.modifiersData.preventOverflow,A=pu(r,{elementContext:"reference"}),m=pu(r,{altBoundary:!0}),v=Zy(A,a),C=Zy(m,l,h),S=$y(v),b=$y(C);r.modifiersData[s]={referenceClippingOffsets:v,popperEscapeOffsets:C,isReferenceHidden:S,hasPopperEscaped:b},r.attributes.popper=Object.assign({},r.attributes.popper,{"data-popper-reference-hidden":S,"data-popper-escaped":b})}var WP={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:HP};function YP(i,r,s){var a=Ho(i),l=[bi,wi].indexOf(a)>=0?-1:1,h=typeof s=="function"?s(Object.assign({},r,{placement:i})):s,A=h[0],m=h[1];return A=A||0,m=(m||0)*l,[bi,fo].indexOf(a)>=0?{x:m,y:A}:{x:A,y:m}}function qP(i){var r=i.state,s=i.options,a=i.name,l=s.offset,h=l===void 0?[0,0]:l,A=gT.reduce(function(S,b){return S[b]=YP(b,r.rects,h),S},{}),m=A[r.placement],v=m.x,C=m.y;r.modifiersData.popperOffsets!=null&&(r.modifiersData.popperOffsets.x+=v,r.modifiersData.popperOffsets.y+=C),r.modifiersData[a]=A}var JP={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:qP};function zP(i){var r=i.state,s=i.name;r.modifiersData[s]=ST({reference:r.rects.reference,element:r.rects.popper,strategy:"absolute",placement:r.placement})}var XP={name:"popperOffsets",enabled:!0,phase:"read",fn:zP,data:{}};function ZP(i){return i==="x"?"y":"x"}function $P(i){var r=i.state,s=i.options,a=i.name,l=s.mainAxis,h=l===void 0?!0:l,A=s.altAxis,m=A===void 0?!1:A,v=s.boundary,C=s.rootBoundary,S=s.altBoundary,b=s.padding,O=s.tether,P=O===void 0?!0:O,F=s.tetherOffset,W=F===void 0?0:F,$=pu(r,{boundary:v,rootBoundary:C,padding:b,altBoundary:S}),X=Ho(r.placement),K=Yc(r.placement),_t=!K,H=ym(X),ft=ZP(H),Tt=r.modifiersData.popperOffsets,$t=r.rects.reference,ne=r.rects.popper,Te=typeof W=="function"?W(Object.assign({},r.rects,{placement:r.placement})):W,ve=typeof Te=="number"?{mainAxis:Te,altAxis:Te}:Object.assign({mainAxis:0,altAxis:0},Te),qe=r.modifiersData.offset?r.modifiersData.offset[r.placement]:null,Xe={x:0,y:0};if(!!Tt){if(h){var je,mn=H==="y"?wi:bi,sr=H==="y"?Ao:fo,Le=H==="y"?"height":"width",Fr=Tt[H],zr=Fr+$[mn],le=Fr-$[sr],Or=P?-ne[Le]/2:0,Kn=K===jc?$t[Le]:ne[Le],ar=K===jc?-ne[Le]:-$t[Le],Mo=r.elements.arrow,kr=P&&Mo?_m(Mo):{width:0,height:0},yr=r.modifiersData["arrow#persistent"]?r.modifiersData["arrow#persistent"].padding:IT(),Eo=yr[mn],Ds=yr[sr],jt=$l(0,$t[Le],kr[Le]),Bs=_t?$t[Le]/2-Or-jt-Eo-ve.mainAxis:Kn-jt-Eo-ve.mainAxis,Po=_t?-$t[Le]/2+Or+jt+Ds+ve.mainAxis:ar+jt+Ds+ve.mainAxis,ki=r.elements.arrow&&_u(r.elements.arrow),Ya=ki?H==="y"?ki.clientTop||0:ki.clientLeft||0:0,Xr=(je=qe==null?void 0:qe[H])!=null?je:0,qa=Fr+Bs-Xr-Ya,Ja=Fr+Po-Xr,Di=$l(P?Ih(zr,qa):zr,Fr,P?Qa(le,Ja):le);Tt[H]=Di,Xe[H]=Di-Fr}if(m){var Ls,Ms=H==="x"?wi:bi,vo=H==="x"?Ao:fo,Io=Tt[ft],Co=ft==="y"?"height":"width",xo=Io+$[Ms],Hn=Io-$[vo],Xo=[wi,bi].indexOf(X)!==-1,dr=(Ls=qe==null?void 0:qe[ft])!=null?Ls:0,ua=Xo?xo:Io-$t[Co]-ne[Co]-dr+ve.altAxis,En=Xo?Io+$t[Co]+ne[Co]-dr-ve.altAxis:Hn,Zo=P&&Xo?yP(ua,Io,En):$l(P?ua:xo,Io,P?En:Hn);Tt[ft]=Zo,Xe[ft]=Zo-Io}r.modifiersData[a]=Xe}}var tx={name:"preventOverflow",enabled:!0,phase:"main",fn:$P,requiresIfExists:["offset"]};function ex(i){return{scrollLeft:i.scrollLeft,scrollTop:i.scrollTop}}function rx(i){return i===Lo(i)||!po(i)?Sm(i):ex(i)}function nx(i){var r=i.getBoundingClientRect(),s=Hc(r.width)/i.offsetWidth||1,a=Hc(r.height)/i.offsetHeight||1;return s!==1||a!==1}function ix(i,r,s){s===void 0&&(s=!1);var a=po(r),l=po(r)&&nx(r),h=la(r),A=Wc(i,l),m={scrollLeft:0,scrollTop:0},v={x:0,y:0};return(a||!a&&!s)&&((qo(r)!=="body"||Rm(h))&&(m=rx(r)),po(r)?(v=Wc(r,!0),v.x+=r.clientLeft,v.y+=r.clientTop):h&&(v.x=Tm(h))),{x:A.left+m.scrollLeft-v.x,y:A.top+m.scrollTop-v.y,width:A.width,height:A.height}}function ox(i){var r=new Map,s=new Set,a=[];i.forEach(function(h){r.set(h.name,h)});function l(h){s.add(h.name);var A=[].concat(h.requires||[],h.requiresIfExists||[]);A.forEach(function(m){if(!s.has(m)){var v=r.get(m);v&&l(v)}}),a.push(h)}return i.forEach(function(h){s.has(h.name)||l(h)}),a}function sx(i){var r=ox(i);return EP.reduce(function(s,a){return s.concat(r.filter(function(l){return l.phase===a}))},[])}function ax(i){var r;return function(){return r||(r=new Promise(function(s){Promise.resolve().then(function(){r=void 0,s(i())})})),r}}function cx(i){var r=i.reduce(function(s,a){var l=s[a.name];return s[a.name]=l?Object.assign({},l,a,{options:Object.assign({},l.options,a.options),data:Object.assign({},l.data,a.data)}):a,s},{});return Object.keys(r).map(function(s){return r[s]})}var t0={placement:"bottom",modifiers:[],strategy:"absolute"};function e0(){for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return!r.some(function(a){return!(a&&typeof a.getBoundingClientRect=="function")})}function lx(i){i===void 0&&(i={});var r=i,s=r.defaultModifiers,a=s===void 0?[]:s,l=r.defaultOptions,h=l===void 0?t0:l;return function(m,v,C){C===void 0&&(C=h);var S={placement:"bottom",orderedModifiers:[],options:Object.assign({},t0,h),modifiersData:{},elements:{reference:m,popper:v},attributes:{},styles:{}},b=[],O=!1,P={state:S,setOptions:function(X){var K=typeof X=="function"?X(S.options):X;W(),S.options=Object.assign({},h,S.options,K),S.scrollParents={reference:Kc(m)?tu(m):m.contextElement?tu(m.contextElement):[],popper:tu(v)};var _t=sx(cx([].concat(a,S.options.modifiers)));return S.orderedModifiers=_t.filter(function(H){return H.enabled}),F(),P.update()},forceUpdate:function(){if(!O){var X=S.elements,K=X.reference,_t=X.popper;if(!!e0(K,_t)){S.rects={reference:ix(K,_u(_t),S.options.strategy==="fixed"),popper:_m(_t)},S.reset=!1,S.placement=S.options.placement,S.orderedModifiers.forEach(function(ve){return S.modifiersData[ve.name]=Object.assign({},ve.data)});for(var H=0;H<S.orderedModifiers.length;H++){if(S.reset===!0){S.reset=!1,H=-1;continue}var ft=S.orderedModifiers[H],Tt=ft.fn,$t=ft.options,ne=$t===void 0?{}:$t,Te=ft.name;typeof Tt=="function"&&(S=Tt({state:S,options:ne,name:Te,instance:P})||S)}}}},update:ax(function(){return new Promise(function($){P.forceUpdate(),$(S)})}),destroy:function(){W(),O=!0}};if(!e0(m,v))return P;P.setOptions(C).then(function($){!O&&C.onFirstUpdate&&C.onFirstUpdate($)});function F(){S.orderedModifiers.forEach(function($){var X=$.name,K=$.options,_t=K===void 0?{}:K,H=$.effect;if(typeof H=="function"){var ft=H({state:S,name:X,instance:P,options:_t}),Tt=function(){};b.push(ft||Tt)}})}function W(){b.forEach(function($){return $()}),b=[]}return P}}var ux=[BP,XP,kP,ET,JP,KP,tx,wP,WP],dx=lx({defaultModifiers:ux}),hx="tippy-box",TT="tippy-content",px="tippy-backdrop",RT="tippy-arrow",wT="tippy-svg-arrow",Ba={passive:!0,capture:!0},bT=function(){return document.body};function sg(i,r,s){if(Array.isArray(i)){var a=i[r];return a==null?Array.isArray(s)?s[r]:s:a}return i}function wm(i,r){var s={}.toString.call(i);return s.indexOf("[object")===0&&s.indexOf(r+"]")>-1}function NT(i,r){return typeof i=="function"?i.apply(void 0,r):i}function r0(i,r){if(r===0)return i;var s;return function(a){clearTimeout(s),s=setTimeout(function(){i(a)},r)}}function Ax(i){return i.split(/\s+/).filter(Boolean)}function Bc(i){return[].concat(i)}function n0(i,r){i.indexOf(r)===-1&&i.push(r)}function fx(i){return i.filter(function(r,s){return i.indexOf(r)===s})}function gx(i){return i.split("-")[0]}function Ch(i){return[].slice.call(i)}function i0(i){return Object.keys(i).reduce(function(r,s){return i[s]!==void 0&&(r[s]=i[s]),r},{})}function eu(){return document.createElement("div")}function Wh(i){return["Element","Fragment"].some(function(r){return wm(i,r)})}function mx(i){return wm(i,"NodeList")}function Ex(i){return wm(i,"MouseEvent")}function vx(i){return!!(i&&i._tippy&&i._tippy.reference===i)}function Ix(i){return Wh(i)?[i]:mx(i)?Ch(i):Array.isArray(i)?i:Ch(document.querySelectorAll(i))}function ag(i,r){i.forEach(function(s){s&&(s.style.transitionDuration=r+"ms")})}function o0(i,r){i.forEach(function(s){s&&s.setAttribute("data-state",r)})}function Cx(i){var r,s=Bc(i),a=s[0];return a!=null&&(r=a.ownerDocument)!=null&&r.body?a.ownerDocument:document}function _x(i,r){var s=r.clientX,a=r.clientY;return i.every(function(l){var h=l.popperRect,A=l.popperState,m=l.props,v=m.interactiveBorder,C=gx(A.placement),S=A.modifiersData.offset;if(!S)return!0;var b=C==="bottom"?S.top.y:0,O=C==="top"?S.bottom.y:0,P=C==="right"?S.left.x:0,F=C==="left"?S.right.x:0,W=h.top-a+b>v,$=a-h.bottom-O>v,X=h.left-s+P>v,K=s-h.right-F>v;return W||$||X||K})}function cg(i,r,s){var a=r+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(l){i[a](l,s)})}function s0(i,r){for(var s=r;s;){var a;if(i.contains(s))return!0;s=s.getRootNode==null||(a=s.getRootNode())==null?void 0:a.host}return!1}var jo={isTouch:!1},a0=0;function yx(){jo.isTouch||(jo.isTouch=!0,window.performance&&document.addEventListener("mousemove",OT))}function OT(){var i=performance.now();i-a0<20&&(jo.isTouch=!1,document.removeEventListener("mousemove",OT)),a0=i}function Sx(){var i=document.activeElement;if(vx(i)){var r=i._tippy;i.blur&&!r.state.isVisible&&i.blur()}}function Tx(){document.addEventListener("touchstart",yx,Ba),window.addEventListener("blur",Sx)}var Rx=typeof window!="undefined"&&typeof document!="undefined",wx=Rx?!!window.msCrypto:!1,bx={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},Nx={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},No=Object.assign({appendTo:bT,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},bx,Nx),Ox=Object.keys(No),kx=function(r){var s=Object.keys(r);s.forEach(function(a){No[a]=r[a]})};function kT(i){var r=i.plugins||[],s=r.reduce(function(a,l){var h=l.name,A=l.defaultValue;if(h){var m;a[h]=i[h]!==void 0?i[h]:(m=No[h])!=null?m:A}return a},{});return Object.assign({},i,s)}function Dx(i,r){var s=r?Object.keys(kT(Object.assign({},No,{plugins:r}))):Ox,a=s.reduce(function(l,h){var A=(i.getAttribute("data-tippy-"+h)||"").trim();if(!A)return l;if(h==="content")l[h]=A;else try{l[h]=JSON.parse(A)}catch{l[h]=A}return l},{});return a}function c0(i,r){var s=Object.assign({},r,{content:NT(r.content,[i])},r.ignoreAttributes?{}:Dx(i,r.plugins));return s.aria=Object.assign({},No.aria,s.aria),s.aria={expanded:s.aria.expanded==="auto"?r.interactive:s.aria.expanded,content:s.aria.content==="auto"?r.interactive?null:"describedby":s.aria.content},s}var Bx=function(){return"innerHTML"};function Lg(i,r){i[Bx()]=r}function l0(i){var r=eu();return i===!0?r.className=RT:(r.className=wT,Wh(i)?r.appendChild(i):Lg(r,i)),r}function u0(i,r){Wh(r.content)?(Lg(i,""),i.appendChild(r.content)):typeof r.content!="function"&&(r.allowHTML?Lg(i,r.content):i.textContent=r.content)}function Mg(i){var r=i.firstElementChild,s=Ch(r.children);return{box:r,content:s.find(function(a){return a.classList.contains(TT)}),arrow:s.find(function(a){return a.classList.contains(RT)||a.classList.contains(wT)}),backdrop:s.find(function(a){return a.classList.contains(px)})}}function DT(i){var r=eu(),s=eu();s.className=hx,s.setAttribute("data-state","hidden"),s.setAttribute("tabindex","-1");var a=eu();a.className=TT,a.setAttribute("data-state","hidden"),u0(a,i.props),r.appendChild(s),s.appendChild(a),l(i.props,i.props);function l(h,A){var m=Mg(r),v=m.box,C=m.content,S=m.arrow;A.theme?v.setAttribute("data-theme",A.theme):v.removeAttribute("data-theme"),typeof A.animation=="string"?v.setAttribute("data-animation",A.animation):v.removeAttribute("data-animation"),A.inertia?v.setAttribute("data-inertia",""):v.removeAttribute("data-inertia"),v.style.maxWidth=typeof A.maxWidth=="number"?A.maxWidth+"px":A.maxWidth,A.role?v.setAttribute("role",A.role):v.removeAttribute("role"),(h.content!==A.content||h.allowHTML!==A.allowHTML)&&u0(C,i.props),A.arrow?S?h.arrow!==A.arrow&&(v.removeChild(S),v.appendChild(l0(A.arrow))):v.appendChild(l0(A.arrow)):S&&v.removeChild(S)}return{popper:r,onUpdate:l}}DT.$$tippy=!0;var Lx=1,Xd=[],lg=[];function Mx(i,r){var s=c0(i,Object.assign({},No,kT(i0(r)))),a,l,h,A=!1,m=!1,v=!1,C=!1,S,b,O,P=[],F=r0(qa,s.interactiveDebounce),W,$=Lx++,X=null,K=fx(s.plugins),_t={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},H={id:$,reference:i,popper:eu(),popperInstance:X,props:s,state:_t,plugins:K,clearDelayTimeouts:ua,setProps:En,setContent:Zo,show:qh,hide:yu,hideWithInteractivity:Su,enable:Xo,disable:dr,unmount:Jh,destroy:zh};if(!s.render)return H;var ft=s.render(H),Tt=ft.popper,$t=ft.onUpdate;Tt.setAttribute("data-tippy-root",""),Tt.id="tippy-"+H.id,H.popper=Tt,i._tippy=H,Tt._tippy=H;var ne=K.map(function(pt){return pt.fn(H)}),Te=i.hasAttribute("aria-expanded");return ki(),Or(),Fr(),zr("onCreate",[H]),s.showOnCreate&&xo(),Tt.addEventListener("mouseenter",function(){H.props.interactive&&H.state.isVisible&&H.clearDelayTimeouts()}),Tt.addEventListener("mouseleave",function(){H.props.interactive&&H.props.trigger.indexOf("mouseenter")>=0&&mn().addEventListener("mousemove",F)}),H;function ve(){var pt=H.props.touch;return Array.isArray(pt)?pt:[pt,0]}function qe(){return ve()[0]==="hold"}function Xe(){var pt;return!!((pt=H.props.render)!=null&&pt.$$tippy)}function je(){return W||i}function mn(){var pt=je().parentNode;return pt?Cx(pt):document}function sr(){return Mg(Tt)}function Le(pt){return H.state.isMounted&&!H.state.isVisible||jo.isTouch||S&&S.type==="focus"?0:sg(H.props.delay,pt?0:1,No.delay)}function Fr(pt){pt===void 0&&(pt=!1),Tt.style.pointerEvents=H.props.interactive&&!pt?"":"none",Tt.style.zIndex=""+H.props.zIndex}function zr(pt,Ht,at){if(at===void 0&&(at=!0),ne.forEach(function(ce){ce[pt]&&ce[pt].apply(ce,Ht)}),at){var Me;(Me=H.props)[pt].apply(Me,Ht)}}function le(){var pt=H.props.aria;if(!!pt.content){var Ht="aria-"+pt.content,at=Tt.id,Me=Bc(H.props.triggerTarget||i);Me.forEach(function(ce){var Dr=ce.getAttribute(Ht);if(H.state.isVisible)ce.setAttribute(Ht,Dr?Dr+" "+at:at);else{var oi=Dr&&Dr.replace(at,"").trim();oi?ce.setAttribute(Ht,oi):ce.removeAttribute(Ht)}})}}function Or(){if(!(Te||!H.props.aria.expanded)){var pt=Bc(H.props.triggerTarget||i);pt.forEach(function(Ht){H.props.interactive?Ht.setAttribute("aria-expanded",H.state.isVisible&&Ht===je()?"true":"false"):Ht.removeAttribute("aria-expanded")})}}function Kn(){mn().removeEventListener("mousemove",F),Xd=Xd.filter(function(pt){return pt!==F})}function ar(pt){if(!(jo.isTouch&&(v||pt.type==="mousedown"))){var Ht=pt.composedPath&&pt.composedPath()[0]||pt.target;if(!(H.props.interactive&&s0(Tt,Ht))){if(Bc(H.props.triggerTarget||i).some(function(at){return s0(at,Ht)})){if(jo.isTouch||H.state.isVisible&&H.props.trigger.indexOf("click")>=0)return}else zr("onClickOutside",[H,pt]);H.props.hideOnClick===!0&&(H.clearDelayTimeouts(),H.hide(),m=!0,setTimeout(function(){m=!1}),H.state.isMounted||Eo())}}}function Mo(){v=!0}function kr(){v=!1}function yr(){var pt=mn();pt.addEventListener("mousedown",ar,!0),pt.addEventListener("touchend",ar,Ba),pt.addEventListener("touchstart",kr,Ba),pt.addEventListener("touchmove",Mo,Ba)}function Eo(){var pt=mn();pt.removeEventListener("mousedown",ar,!0),pt.removeEventListener("touchend",ar,Ba),pt.removeEventListener("touchstart",kr,Ba),pt.removeEventListener("touchmove",Mo,Ba)}function Ds(pt,Ht){Bs(pt,function(){!H.state.isVisible&&Tt.parentNode&&Tt.parentNode.contains(Tt)&&Ht()})}function jt(pt,Ht){Bs(pt,Ht)}function Bs(pt,Ht){var at=sr().box;function Me(ce){ce.target===at&&(cg(at,"remove",Me),Ht())}if(pt===0)return Ht();cg(at,"remove",b),cg(at,"add",Me),b=Me}function Po(pt,Ht,at){at===void 0&&(at=!1);var Me=Bc(H.props.triggerTarget||i);Me.forEach(function(ce){ce.addEventListener(pt,Ht,at),P.push({node:ce,eventType:pt,handler:Ht,options:at})})}function ki(){qe()&&(Po("touchstart",Xr,{passive:!0}),Po("touchend",Ja,{passive:!0})),Ax(H.props.trigger).forEach(function(pt){if(pt!=="manual")switch(Po(pt,Xr),pt){case"mouseenter":Po("mouseleave",Ja);break;case"focus":Po(wx?"focusout":"blur",Di);break;case"focusin":Po("focusout",Di);break}})}function Ya(){P.forEach(function(pt){var Ht=pt.node,at=pt.eventType,Me=pt.handler,ce=pt.options;Ht.removeEventListener(at,Me,ce)}),P=[]}function Xr(pt){var Ht,at=!1;if(!(!H.state.isEnabled||Ls(pt)||m)){var Me=((Ht=S)==null?void 0:Ht.type)==="focus";S=pt,W=pt.currentTarget,Or(),!H.state.isVisible&&Ex(pt)&&Xd.forEach(function(ce){return ce(pt)}),pt.type==="click"&&(H.props.trigger.indexOf("mouseenter")<0||A)&&H.props.hideOnClick!==!1&&H.state.isVisible?at=!0:xo(pt),pt.type==="click"&&(A=!at),at&&!Me&&Hn(pt)}}function qa(pt){var Ht=pt.target,at=je().contains(Ht)||Tt.contains(Ht);if(!(pt.type==="mousemove"&&at)){var Me=Co().concat(Tt).map(function(ce){var Dr,oi=ce._tippy,$o=(Dr=oi.popperInstance)==null?void 0:Dr.state;return $o?{popperRect:ce.getBoundingClientRect(),popperState:$o,props:s}:null}).filter(Boolean);_x(Me,pt)&&(Kn(),Hn(pt))}}function Ja(pt){var Ht=Ls(pt)||H.props.trigger.indexOf("click")>=0&&A;if(!Ht){if(H.props.interactive){H.hideWithInteractivity(pt);return}Hn(pt)}}function Di(pt){H.props.trigger.indexOf("focusin")<0&&pt.target!==je()||H.props.interactive&&pt.relatedTarget&&Tt.contains(pt.relatedTarget)||Hn(pt)}function Ls(pt){return jo.isTouch?qe()!==pt.type.indexOf("touch")>=0:!1}function Ms(){vo();var pt=H.props,Ht=pt.popperOptions,at=pt.placement,Me=pt.offset,ce=pt.getReferenceClientRect,Dr=pt.moveTransition,oi=Xe()?Mg(Tt).arrow:null,$o=ce?{getBoundingClientRect:ce,contextElement:ce.contextElement||je()}:i,Ji={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(es){var kn=es.state;if(Xe()){var Tu=sr(),Ps=Tu.box;["placement","reference-hidden","escaped"].forEach(function(xs){xs==="placement"?Ps.setAttribute("data-placement",kn.placement):kn.attributes.popper["data-popper-"+xs]?Ps.setAttribute("data-"+xs,""):Ps.removeAttribute("data-"+xs)}),kn.attributes.popper={}}}},ts=[{name:"offset",options:{offset:Me}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!Dr}},Ji];Xe()&&oi&&ts.push({name:"arrow",options:{element:oi,padding:3}}),ts.push.apply(ts,(Ht==null?void 0:Ht.modifiers)||[]),H.popperInstance=dx($o,Tt,Object.assign({},Ht,{placement:at,onFirstUpdate:O,modifiers:ts}))}function vo(){H.popperInstance&&(H.popperInstance.destroy(),H.popperInstance=null)}function Io(){var pt=H.props.appendTo,Ht,at=je();H.props.interactive&&pt===bT||pt==="parent"?Ht=at.parentNode:Ht=NT(pt,[at]),Ht.contains(Tt)||Ht.appendChild(Tt),H.state.isMounted=!0,Ms()}function Co(){return Ch(Tt.querySelectorAll("[data-tippy-root]"))}function xo(pt){H.clearDelayTimeouts(),pt&&zr("onTrigger",[H,pt]),yr();var Ht=Le(!0),at=ve(),Me=at[0],ce=at[1];jo.isTouch&&Me==="hold"&&ce&&(Ht=ce),Ht?a=setTimeout(function(){H.show()},Ht):H.show()}function Hn(pt){if(H.clearDelayTimeouts(),zr("onUntrigger",[H,pt]),!H.state.isVisible){Eo();return}if(!(H.props.trigger.indexOf("mouseenter")>=0&&H.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(pt.type)>=0&&A)){var Ht=Le(!1);Ht?l=setTimeout(function(){H.state.isVisible&&H.hide()},Ht):h=requestAnimationFrame(function(){H.hide()})}}function Xo(){H.state.isEnabled=!0}function dr(){H.hide(),H.state.isEnabled=!1}function ua(){clearTimeout(a),clearTimeout(l),cancelAnimationFrame(h)}function En(pt){if(!H.state.isDestroyed){zr("onBeforeUpdate",[H,pt]),Ya();var Ht=H.props,at=c0(i,Object.assign({},Ht,i0(pt),{ignoreAttributes:!0}));H.props=at,ki(),Ht.interactiveDebounce!==at.interactiveDebounce&&(Kn(),F=r0(qa,at.interactiveDebounce)),Ht.triggerTarget&&!at.triggerTarget?Bc(Ht.triggerTarget).forEach(function(Me){Me.removeAttribute("aria-expanded")}):at.triggerTarget&&i.removeAttribute("aria-expanded"),Or(),Fr(),$t&&$t(Ht,at),H.popperInstance&&(Ms(),Co().forEach(function(Me){requestAnimationFrame(Me._tippy.popperInstance.forceUpdate)})),zr("onAfterUpdate",[H,pt])}}function Zo(pt){H.setProps({content:pt})}function qh(){var pt=H.state.isVisible,Ht=H.state.isDestroyed,at=!H.state.isEnabled,Me=jo.isTouch&&!H.props.touch,ce=sg(H.props.duration,0,No.duration);if(!(pt||Ht||at||Me)&&!je().hasAttribute("disabled")&&(zr("onShow",[H],!1),H.props.onShow(H)!==!1)){if(H.state.isVisible=!0,Xe()&&(Tt.style.visibility="visible"),Fr(),yr(),H.state.isMounted||(Tt.style.transition="none"),Xe()){var Dr=sr(),oi=Dr.box,$o=Dr.content;ag([oi,$o],0)}O=function(){var ts;if(!(!H.state.isVisible||C)){if(C=!0,Tt.offsetHeight,Tt.style.transition=H.props.moveTransition,Xe()&&H.props.animation){var $c=sr(),es=$c.box,kn=$c.content;ag([es,kn],ce),o0([es,kn],"visible")}le(),Or(),n0(lg,H),(ts=H.popperInstance)==null||ts.forceUpdate(),zr("onMount",[H]),H.props.animation&&Xe()&&jt(ce,function(){H.state.isShown=!0,zr("onShown",[H])})}},Io()}}function yu(){var pt=!H.state.isVisible,Ht=H.state.isDestroyed,at=!H.state.isEnabled,Me=sg(H.props.duration,1,No.duration);if(!(pt||Ht||at)&&(zr("onHide",[H],!1),H.props.onHide(H)!==!1)){if(H.state.isVisible=!1,H.state.isShown=!1,C=!1,A=!1,Xe()&&(Tt.style.visibility="hidden"),Kn(),Eo(),Fr(!0),Xe()){var ce=sr(),Dr=ce.box,oi=ce.content;H.props.animation&&(ag([Dr,oi],Me),o0([Dr,oi],"hidden"))}le(),Or(),H.props.animation?Xe()&&Ds(Me,H.unmount):H.unmount()}}function Su(pt){mn().addEventListener("mousemove",F),n0(Xd,F),F(pt)}function Jh(){H.state.isVisible&&H.hide(),!!H.state.isMounted&&(vo(),Co().forEach(function(pt){pt._tippy.unmount()}),Tt.parentNode&&Tt.parentNode.removeChild(Tt),lg=lg.filter(function(pt){return pt!==H}),H.state.isMounted=!1,zr("onHidden",[H]))}function zh(){H.state.isDestroyed||(H.clearDelayTimeouts(),H.unmount(),Ya(),delete i._tippy,H.state.isDestroyed=!0,zr("onDestroy",[H]))}}function Zc(i,r){r===void 0&&(r={});var s=No.plugins.concat(r.plugins||[]);Tx();var a=Object.assign({},r,{plugins:s}),l=Ix(i),h=l.reduce(function(A,m){var v=m&&Mx(m,a);return v&&A.push(v),A},[]);return Wh(i)?h[0]:h}Zc.defaultProps=No;Zc.setDefaultProps=kx;Zc.currentInput=jo;Object.assign({},ET,{effect:function(r){var s=r.state,a={popper:{position:s.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(s.elements.popper.style,a.popper),s.styles=a,s.elements.arrow&&Object.assign(s.elements.arrow.style,a.arrow)}});Zc.setDefaultProps({render:DT});class Px{constructor({editor:r,element:s,view:a,tippyOptions:l={},shouldShow:h}){this.preventHide=!1,this.shouldShow=({view:A,state:m,from:v,to:C})=>{const{doc:S,selection:b}=m,{empty:O}=b,P=!S.textBetween(v,C).length&&aT(m.selection);return!(!A.hasFocus()||O||P)},this.mousedownHandler=()=>{this.preventHide=!0},this.dragstartHandler=()=>{this.hide()},this.focusHandler=()=>{setTimeout(()=>this.update(this.editor.view))},this.blurHandler=({event:A})=>{var m;if(this.preventHide){this.preventHide=!1;return}(A==null?void 0:A.relatedTarget)&&((m=this.element.parentNode)===null||m===void 0?void 0:m.contains(A.relatedTarget))||this.hide()},this.editor=r,this.element=s,this.view=a,h&&(this.shouldShow=h),this.element.addEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.view.dom.addEventListener("dragstart",this.dragstartHandler),this.editor.on("focus",this.focusHandler),this.editor.on("blur",this.blurHandler),this.tippyOptions=l,this.element.remove(),this.element.style.visibility="visible"}createTooltip(){const{element:r}=this.editor.options,s=!!r.parentElement;this.tippy||!s||(this.tippy=Zc(r,vt({duration:0,getReferenceClientRect:null,content:this.element,interactive:!0,trigger:"manual",placement:"top",hideOnClick:"toggle"},this.tippyOptions)),this.tippy.popper.firstChild&&this.tippy.popper.firstChild.addEventListener("blur",a=>{this.blurHandler({event:a})}))}update(r,s){var a,l;const{state:h,composing:A}=r,{doc:m,selection:v}=h,C=s&&s.doc.eq(m)&&s.selection.eq(v);if(A||C)return;this.createTooltip();const{ranges:S}=v,b=Math.min(...S.map(F=>F.$from.pos)),O=Math.max(...S.map(F=>F.$to.pos));if(!((a=this.shouldShow)===null||a===void 0?void 0:a.call(this,{editor:this.editor,view:r,state:h,oldState:s,from:b,to:O}))){this.hide();return}(l=this.tippy)===null||l===void 0||l.setProps({getReferenceClientRect:()=>{if(sP(h.selection)){const F=r.nodeDOM(b);if(F)return F.getBoundingClientRect()}return AT(r,b,O)}}),this.show()}show(){var r;(r=this.tippy)===null||r===void 0||r.show()}hide(){var r;(r=this.tippy)===null||r===void 0||r.hide()}destroy(){var r;(r=this.tippy)===null||r===void 0||r.destroy(),this.element.removeEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.view.dom.removeEventListener("dragstart",this.dragstartHandler),this.editor.off("focus",this.focusHandler),this.editor.off("blur",this.blurHandler)}}const BT=i=>new gn({key:typeof i.pluginKey=="string"?new ii(i.pluginKey):i.pluginKey,view:r=>new Px(vt({view:r},i))});bn.create({name:"bubbleMenu",addOptions(){return{element:null,tippyOptions:{},pluginKey:"bubbleMenu",shouldShow:null}},addProseMirrorPlugins(){return this.options.element?[BT({pluginKey:this.options.pluginKey,editor:this.editor,element:this.options.element,tippyOptions:this.options.tippyOptions,shouldShow:this.options.shouldShow})]:[]}});class xx{constructor({editor:r,element:s,view:a,tippyOptions:l={},shouldShow:h}){this.preventHide=!1,this.shouldShow=({view:A,state:m})=>{const{selection:v}=m,{$anchor:C,empty:S}=v,b=C.depth===1,O=C.parent.isTextblock&&!C.parent.type.spec.code&&!C.parent.textContent;return!(!A.hasFocus()||!S||!b||!O)},this.mousedownHandler=()=>{this.preventHide=!0},this.focusHandler=()=>{setTimeout(()=>this.update(this.editor.view))},this.blurHandler=({event:A})=>{var m;if(this.preventHide){this.preventHide=!1;return}(A==null?void 0:A.relatedTarget)&&((m=this.element.parentNode)===null||m===void 0?void 0:m.contains(A.relatedTarget))||this.hide()},this.editor=r,this.element=s,this.view=a,h&&(this.shouldShow=h),this.element.addEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.editor.on("focus",this.focusHandler),this.editor.on("blur",this.blurHandler),this.tippyOptions=l,this.element.remove(),this.element.style.visibility="visible"}createTooltip(){const{element:r}=this.editor.options,s=!!r.parentElement;this.tippy||!s||(this.tippy=Zc(r,vt({duration:0,getReferenceClientRect:null,content:this.element,interactive:!0,trigger:"manual",placement:"right",hideOnClick:"toggle"},this.tippyOptions)),this.tippy.popper.firstChild&&this.tippy.popper.firstChild.addEventListener("blur",a=>{this.blurHandler({event:a})}))}update(r,s){var a,l;const{state:h}=r,{doc:A,selection:m}=h,{from:v,to:C}=m;if(s&&s.doc.eq(A)&&s.selection.eq(m))return;if(this.createTooltip(),!((a=this.shouldShow)===null||a===void 0?void 0:a.call(this,{editor:this.editor,view:r,state:h,oldState:s}))){this.hide();return}(l=this.tippy)===null||l===void 0||l.setProps({getReferenceClientRect:()=>AT(r,v,C)}),this.show()}show(){var r;(r=this.tippy)===null||r===void 0||r.show()}hide(){var r;(r=this.tippy)===null||r===void 0||r.hide()}destroy(){var r;(r=this.tippy)===null||r===void 0||r.destroy(),this.element.removeEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.editor.off("focus",this.focusHandler),this.editor.off("blur",this.blurHandler)}}const LT=i=>new gn({key:typeof i.pluginKey=="string"?new ii(i.pluginKey):i.pluginKey,view:r=>new xx(vt({view:r},i))});bn.create({name:"floatingMenu",addOptions(){return{element:null,tippyOptions:{},pluginKey:"floatingMenu",shouldShow:null}},addProseMirrorPlugins(){return this.options.element?[LT({pluginKey:this.options.pluginKey,editor:this.editor,element:this.options.element,tippyOptions:this.options.tippyOptions,shouldShow:this.options.shouldShow})]:[]}});gu({name:"BubbleMenu",props:{pluginKey:{type:null,default:"bubbleMenu"},editor:{type:Object,required:!0},tippyOptions:{type:Object,default:()=>({})},shouldShow:{type:Function,default:null}},setup(i,{slots:r}){const s=Uc(null);return Fg(()=>{const{pluginKey:a,editor:l,tippyOptions:h,shouldShow:A}=i;l.registerPlugin(BT({pluginKey:a,editor:l,element:s.value,tippyOptions:h,shouldShow:A}))}),Vg(()=>{const{pluginKey:a,editor:l}=i;l.unregisterPlugin(a)}),()=>{var a;return Pa("div",{ref:s},(a=r.default)===null||a===void 0?void 0:a.call(r))}}});function d0(i){return yO((r,s)=>({get(){return r(),i},set(a){i=a,requestAnimationFrame(()=>{requestAnimationFrame(()=>{s()})})}}))}class Ux extends iP{constructor(r={}){super(r);return this.vueRenderers=th(new Map),this.contentComponent=null,this.reactiveState=d0(this.view.state),this.reactiveExtensionStorage=d0(this.extensionStorage),this.on("transaction",()=>{this.reactiveState.value=this.view.state,this.reactiveExtensionStorage.value=this.extensionStorage}),SO(this)}get state(){return this.reactiveState?this.reactiveState.value:this.view.state}get storage(){return this.reactiveExtensionStorage?this.reactiveExtensionStorage.value:super.storage}registerPlugin(r,s){super.registerPlugin(r,s),this.reactiveState.value=this.view.state}unregisterPlugin(r){super.unregisterPlugin(r),this.reactiveState.value=this.view.state}}const Qx=gu({name:"EditorContent",props:{editor:{default:null,type:Object}},setup(i){const r=Uc(),s=wO();return TO(()=>{const a=i.editor;a&&a.options.element&&r.value&&I0(()=>{if(!r.value||!a.options.element.firstChild)return;const l=Da(r.value);r.value.append(...a.options.element.childNodes),a.contentComponent=s.ctx._,a.setOptions({element:l}),a.createNodeViews()})}),Vg(()=>{const a=i.editor;if(!a||(a.isDestroyed||a.view.setProps({nodeViews:{}}),a.contentComponent=null,!a.options.element.firstChild))return;const l=document.createElement("div");l.append(...a.options.element.childNodes),a.setOptions({element:l})}),{rootEl:r}},render(){const i=[];return this.editor&&this.editor.vueRenderers.forEach(r=>{const s=Pa(RO,{to:r.teleportElement,key:r.id},Pa(r.component,vt({ref:r.id},r.props)));i.push(s)}),Pa("div",{ref:r=>{this.rootEl=r}},...i)}});gu({name:"FloatingMenu",props:{pluginKey:{type:null,default:"floatingMenu"},editor:{type:Object,required:!0},tippyOptions:{type:Object,default:()=>({})},shouldShow:{type:Function,default:null}},setup(i,{slots:r}){const s=Uc(null);return Fg(()=>{const{pluginKey:a,editor:l,tippyOptions:h,shouldShow:A}=i;l.registerPlugin(LT({pluginKey:a,editor:l,element:s.value,tippyOptions:h,shouldShow:A}))}),Vg(()=>{const{pluginKey:a,editor:l}=i;l.unregisterPlugin(a)}),()=>{var a;return Pa("div",{ref:s},(a=r.default)===null||a===void 0?void 0:a.call(r))}}});gu({props:{as:{type:String,default:"div"}},inject:["onDragStart","decorationClasses"],render(){var i,r;return Pa(this.as,{class:this.decorationClasses.value,style:{whiteSpace:"normal"},"data-node-view-wrapper":"",onDragstart:this.onDragStart},(r=(i=this.$slots).default)===null||r===void 0?void 0:r.call(i))}});gu({props:{as:{type:String,default:"div"}},render(){return Pa(this.as,{style:{whiteSpace:"pre-wrap"},"data-node-view-content":""})}});const Fx=/^\s*>\s$/,Vx=ri.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:i}){return["blockquote",On(this.options.HTMLAttributes,i),0]},addCommands(){return{setBlockquote:()=>({commands:i})=>i.wrapIn(this.name),toggleBlockquote:()=>({commands:i})=>i.toggleWrap(this.name),unsetBlockquote:()=>({commands:i})=>i.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[Kh({find:Fx,type:this.type})]}}),Gx=/(?:^|\s)((?:\*\*)((?:[^*]+))(?:\*\*))$/,jx=/(?:^|\s)((?:\*\*)((?:[^*]+))(?:\*\*))/g,Kx=/(?:^|\s)((?:__)((?:[^__]+))(?:__))$/,Hx=/(?:^|\s)((?:__)((?:[^__]+))(?:__))/g,Wx=oa.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:i=>i.style.fontWeight!=="normal"&&null},{style:"font-weight",getAttrs:i=>/^(bold(er)?|[5-9]\d{2,})$/.test(i)&&null}]},renderHTML({HTMLAttributes:i}){return["strong",On(this.options.HTMLAttributes,i),0]},addCommands(){return{setBold:()=>({commands:i})=>i.setMark(this.name),toggleBold:()=>({commands:i})=>i.toggleMark(this.name),unsetBold:()=>({commands:i})=>i.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[Ga({find:Gx,type:this.type}),Ga({find:Kx,type:this.type})]},addPasteRules(){return[ja({find:jx,type:this.type}),ja({find:Hx,type:this.type})]}}),Yx=/^\s*([-+*])\s$/,qx=ri.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:i}){return["ul",On(this.options.HTMLAttributes,i),0]},addCommands(){return{toggleBulletList:()=>({commands:i})=>i.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){return[Kh({find:Yx,type:this.type})]}}),Jx=/(?:^|\s)((?:`)((?:[^`]+))(?:`))$/,zx=/(?:^|\s)((?:`)((?:[^`]+))(?:`))/g,Xx=oa.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:i}){return["code",On(this.options.HTMLAttributes,i),0]},addCommands(){return{setCode:()=>({commands:i})=>i.setMark(this.name),toggleCode:()=>({commands:i})=>i.toggleMark(this.name),unsetCode:()=>({commands:i})=>i.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[Ga({find:Jx,type:this.type})]},addPasteRules(){return[ja({find:zx,type:this.type})]}}),Zx=/^```([a-z]+)?[\s\n]$/,$x=/^~~~([a-z]+)?[\s\n]$/,t3=ri.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:null,parseHTML:i=>{var r;const{languageClassPrefix:s}=this.options,h=[...((r=i.firstElementChild)===null||r===void 0?void 0:r.classList)||[]].filter(A=>A.startsWith(s)).map(A=>A.replace(s,""))[0];return h||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:i,HTMLAttributes:r}){return["pre",On(this.options.HTMLAttributes,r),["code",{class:i.attrs.language?this.options.languageClassPrefix+i.attrs.language:null},0]]},addCommands(){return{setCodeBlock:i=>({commands:r})=>r.setNode(this.name,i),toggleCodeBlock:i=>({commands:r})=>r.toggleNode(this.name,"paragraph",i)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:i,$anchor:r}=this.editor.state.selection,s=r.pos===1;return!i||r.parent.type.name!==this.name?!1:s||!r.parent.textContent.length?this.editor.commands.clearNodes():!1},Enter:({editor:i})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:r}=i,{selection:s}=r,{$from:a,empty:l}=s;if(!l||a.parent.type!==this.type)return!1;const h=a.parentOffset===a.parent.nodeSize-2,A=a.parent.textContent.endsWith(`

`);return!h||!A?!1:i.chain().command(({tr:m})=>(m.delete(a.pos-2,a.pos),!0)).exitCode().run()},ArrowDown:({editor:i})=>{if(!this.options.exitOnArrowDown)return!1;const{state:r}=i,{selection:s,doc:a}=r,{$from:l,empty:h}=s;if(!h||l.parent.type!==this.type||!(l.parentOffset===l.parent.nodeSize-2))return!1;const m=l.after();return m===void 0||a.nodeAt(m)?!1:i.commands.exitCode()}}},addInputRules(){return[Dg({find:Zx,type:this.type,getAttributes:i=>({language:i[1]})}),Dg({find:$x,type:this.type,getAttributes:i=>({language:i[1]})})]},addProseMirrorPlugins(){return[new gn({key:new ii("codeBlockVSCodeHandler"),props:{handlePaste:(i,r)=>{if(!r.clipboardData||this.editor.isActive(this.type.name))return!1;const s=r.clipboardData.getData("text/plain"),a=r.clipboardData.getData("vscode-editor-data"),l=a?JSON.parse(a):void 0,h=l==null?void 0:l.mode;if(!s||!h)return!1;const{tr:A}=i.state;return A.replaceSelectionWith(this.type.create({language:h})),A.setSelection(Fe.near(A.doc.resolve(Math.max(0,A.selection.from-2)))),A.insertText(s.replace(/\r\n?/g,`
`)),A.setMeta("paste",!0),i.dispatch(A),!0}}})]}}),e3=ri.create({name:"doc",topNode:!0,content:"block+"});function r3(i){return i===void 0&&(i={}),new gn({view:function(s){return new zo(s,i)}})}var zo=function(r,s){var a=this;this.editorView=r,this.width=s.width||1,this.color=s.color||"black",this.class=s.class,this.cursorPos=null,this.element=null,this.timeout=null,this.handlers=["dragover","dragend","drop","dragleave"].map(function(l){var h=function(A){return a[l](A)};return r.dom.addEventListener(l,h),{name:l,handler:h}})};zo.prototype.destroy=function(){var r=this;this.handlers.forEach(function(s){var a=s.name,l=s.handler;return r.editorView.dom.removeEventListener(a,l)})};zo.prototype.update=function(r,s){this.cursorPos!=null&&s.doc!=r.state.doc&&(this.cursorPos>r.state.doc.content.size?this.setCursor(null):this.updateOverlay())};zo.prototype.setCursor=function(r){r!=this.cursorPos&&(this.cursorPos=r,r==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())};zo.prototype.updateOverlay=function(){var r=this.editorView.state.doc.resolve(this.cursorPos),s;if(!r.parent.inlineContent){var a=r.nodeBefore,l=r.nodeAfter;if(a||l){var h=this.editorView.nodeDOM(this.cursorPos-(a?a.nodeSize:0)).getBoundingClientRect(),A=a?h.bottom:h.top;a&&l&&(A=(A+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),s={left:h.left,right:h.right,top:A-this.width/2,bottom:A+this.width/2}}}if(!s){var m=this.editorView.coordsAtPos(this.cursorPos);s={left:m.left-this.width/2,right:m.left+this.width/2,top:m.top,bottom:m.bottom}}var v=this.editorView.dom.offsetParent;this.element||(this.element=v.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none; background-color: "+this.color);var C,S;if(!v||v==document.body&&getComputedStyle(v).position=="static")C=-pageXOffset,S=-pageYOffset;else{var b=v.getBoundingClientRect();C=b.left-v.scrollLeft,S=b.top-v.scrollTop}this.element.style.left=s.left-C+"px",this.element.style.top=s.top-S+"px",this.element.style.width=s.right-s.left+"px",this.element.style.height=s.bottom-s.top+"px"};zo.prototype.scheduleRemoval=function(r){var s=this;clearTimeout(this.timeout),this.timeout=setTimeout(function(){return s.setCursor(null)},r)};zo.prototype.dragover=function(r){if(!!this.editorView.editable){var s=this.editorView.posAtCoords({left:r.clientX,top:r.clientY}),a=s&&s.inside>=0&&this.editorView.state.doc.nodeAt(s.inside),l=a&&a.type.spec.disableDropCursor,h=typeof l=="function"?l(this.editorView,s):l;if(s&&!h){var A=s.pos;if(this.editorView.dragging&&this.editorView.dragging.slice&&(A=X0(this.editorView.state.doc,A,this.editorView.dragging.slice),A==null))return this.setCursor(null);this.setCursor(A),this.scheduleRemoval(5e3)}}};zo.prototype.dragend=function(){this.scheduleRemoval(20)};zo.prototype.drop=function(){this.scheduleRemoval(20)};zo.prototype.dragleave=function(r){(r.target==this.editorView.dom||!this.editorView.dom.contains(r.relatedTarget))&&this.setCursor(null)};const n3=bn.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:null}},addProseMirrorPlugins(){return[r3(this.options)]}});var Bo=function(i){function r(s){i.call(this,s,s)}return i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r,r.prototype.map=function(a,l){var h=a.resolve(l.map(this.head));return r.valid(h)?new r(h):i.near(h)},r.prototype.content=function(){return Pt.empty},r.prototype.eq=function(a){return a instanceof r&&a.head==this.head},r.prototype.toJSON=function(){return{type:"gapcursor",pos:this.head}},r.fromJSON=function(a,l){if(typeof l.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new r(a.resolve(l.pos))},r.prototype.getBookmark=function(){return new _h(this.anchor)},r.valid=function(a){var l=a.parent;if(l.isTextblock||!i3(a)||!o3(a))return!1;var h=l.type.spec.allowGapCursor;if(h!=null)return h;var A=l.contentMatchAt(a.index()).defaultType;return A&&A.isTextblock},r.findFrom=function(a,l,h){t:for(;;){if(!h&&r.valid(a))return a;for(var A=a.pos,m=null,v=a.depth;;v--){var C=a.node(v);if(l>0?a.indexAfter(v)<C.childCount:a.index(v)>0){m=C.child(l>0?a.indexAfter(v):a.index(v)-1);break}else if(v==0)return null;A+=l;var S=a.doc.resolve(A);if(r.valid(S))return S}for(;;){var b=l>0?m.firstChild:m.lastChild;if(!b){if(m.isAtom&&!m.isText&&!me.isSelectable(m)){a=a.doc.resolve(A+m.nodeSize*l),h=!1;continue t}break}m=b,A+=l;var O=a.doc.resolve(A);if(r.valid(O))return O}return null}},r}(Ee);Bo.prototype.visible=!1;Ee.jsonID("gapcursor",Bo);var _h=function(r){this.pos=r};_h.prototype.map=function(r){return new _h(r.map(this.pos))};_h.prototype.resolve=function(r){var s=r.resolve(this.pos);return Bo.valid(s)?new Bo(s):Ee.near(s)};function i3(i){for(var r=i.depth;r>=0;r--){var s=i.index(r),a=i.node(r);if(s==0){if(a.type.spec.isolating)return!0;continue}for(var l=a.child(s-1);;l=l.lastChild){if(l.childCount==0&&!l.inlineContent||l.isAtom||l.type.spec.isolating)return!0;if(l.inlineContent)return!1}}return!0}function o3(i){for(var r=i.depth;r>=0;r--){var s=i.indexAfter(r),a=i.node(r);if(s==a.childCount){if(a.type.spec.isolating)return!0;continue}for(var l=a.child(s);;l=l.firstChild){if(l.childCount==0&&!l.inlineContent||l.isAtom||l.type.spec.isolating)return!0;if(l.inlineContent)return!1}}return!0}var s3=function(){return new gn({props:{decorations:l3,createSelectionBetween:function(r,s,a){if(s.pos==a.pos&&Bo.valid(a))return new Bo(a)},handleClick:c3,handleKeyDown:a3}})},a3=rT({ArrowLeft:Zd("horiz",-1),ArrowRight:Zd("horiz",1),ArrowUp:Zd("vert",-1),ArrowDown:Zd("vert",1)});function Zd(i,r){var s=i=="vert"?r>0?"down":"up":r>0?"right":"left";return function(a,l,h){var A=a.selection,m=r>0?A.$to:A.$from,v=A.empty;if(A instanceof Fe){if(!h.endOfTextblock(s)||m.depth==0)return!1;v=!1,m=a.doc.resolve(r>0?m.after():m.before())}var C=Bo.findFrom(m,r,v);return C?(l&&l(a.tr.setSelection(new Bo(C))),!0):!1}}function c3(i,r,s){if(!i.editable)return!1;var a=i.state.doc.resolve(r);if(!Bo.valid(a))return!1;var l=i.posAtCoords({left:s.clientX,top:s.clientY}),h=l.inside;return h>-1&&me.isSelectable(i.state.doc.nodeAt(h))?!1:(i.dispatch(i.state.tr.setSelection(new Bo(a))),!0)}function l3(i){if(!(i.selection instanceof Bo))return null;var r=document.createElement("div");return r.className="ProseMirror-gapcursor",or.create(i.doc,[nn.widget(i.selection.head,r,{key:"gapcursor"})])}const u3=bn.create({name:"gapCursor",addProseMirrorPlugins(){return[s3()]},extendNodeSchema(i){var r;const s={name:i.name,options:i.options,storage:i.storage};return{allowGapCursor:(r=Oe(Jt(i,"allowGapCursor",s)))!==null&&r!==void 0?r:null}}}),d3=ri.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:i}){return["br",On(this.options.HTMLAttributes,i)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:i,chain:r,state:s,editor:a})=>i.first([()=>i.exitCode(),()=>i.command(()=>{const{selection:l,storedMarks:h}=s;if(l.$from.parent.type.spec.isolating)return!1;const{keepMarks:A}=this.options,{splittableMarks:m}=a.extensionManager,v=h||l.$to.parentOffset&&l.$from.marks();return r().insertContent({type:this.name}).command(({tr:C,dispatch:S})=>{if(S&&v&&A){const b=v.filter(O=>m.includes(O.type.name));C.ensureMarks(b)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),h3=ri.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(i=>({tag:`h${i}`,attrs:{level:i}}))},renderHTML({node:i,HTMLAttributes:r}){return[`h${this.options.levels.includes(i.attrs.level)?i.attrs.level:this.options.levels[0]}`,On(this.options.HTMLAttributes,r),0]},addCommands(){return{setHeading:i=>({commands:r})=>this.options.levels.includes(i.level)?r.setNode(this.name,i):!1,toggleHeading:i=>({commands:r})=>this.options.levels.includes(i.level)?r.toggleNode(this.name,"paragraph",i):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((i,r)=>wn(vt({},i),{[`Mod-Alt-${r}`]:()=>this.editor.commands.toggleHeading({level:r})}),{})},addInputRules(){return this.options.levels.map(i=>Dg({find:new RegExp(`^(#{1,${i}})\\s$`),type:this.type,getAttributes:{level:i}}))}});var yh=200,Fn=function(){};Fn.prototype.append=function(r){return r.length?(r=Fn.from(r),!this.length&&r||r.length<yh&&this.leafAppend(r)||this.length<yh&&r.leafPrepend(this)||this.appendInner(r)):this};Fn.prototype.prepend=function(r){return r.length?Fn.from(r).append(this):this};Fn.prototype.appendInner=function(r){return new p3(this,r)};Fn.prototype.slice=function(r,s){return r===void 0&&(r=0),s===void 0&&(s=this.length),r>=s?Fn.empty:this.sliceInner(Math.max(0,r),Math.min(this.length,s))};Fn.prototype.get=function(r){if(!(r<0||r>=this.length))return this.getInner(r)};Fn.prototype.forEach=function(r,s,a){s===void 0&&(s=0),a===void 0&&(a=this.length),s<=a?this.forEachInner(r,s,a,0):this.forEachInvertedInner(r,s,a,0)};Fn.prototype.map=function(r,s,a){s===void 0&&(s=0),a===void 0&&(a=this.length);var l=[];return this.forEach(function(h,A){return l.push(r(h,A))},s,a),l};Fn.from=function(r){return r instanceof Fn?r:r&&r.length?new MT(r):Fn.empty};var MT=function(i){function r(a){i.call(this),this.values=a}i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r;var s={length:{configurable:!0},depth:{configurable:!0}};return r.prototype.flatten=function(){return this.values},r.prototype.sliceInner=function(l,h){return l==0&&h==this.length?this:new r(this.values.slice(l,h))},r.prototype.getInner=function(l){return this.values[l]},r.prototype.forEachInner=function(l,h,A,m){for(var v=h;v<A;v++)if(l(this.values[v],m+v)===!1)return!1},r.prototype.forEachInvertedInner=function(l,h,A,m){for(var v=h-1;v>=A;v--)if(l(this.values[v],m+v)===!1)return!1},r.prototype.leafAppend=function(l){if(this.length+l.length<=yh)return new r(this.values.concat(l.flatten()))},r.prototype.leafPrepend=function(l){if(this.length+l.length<=yh)return new r(l.flatten().concat(this.values))},s.length.get=function(){return this.values.length},s.depth.get=function(){return 0},Object.defineProperties(r.prototype,s),r}(Fn);Fn.empty=new MT([]);var p3=function(i){function r(s,a){i.call(this),this.left=s,this.right=a,this.length=s.length+a.length,this.depth=Math.max(s.depth,a.depth)+1}return i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r,r.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},r.prototype.getInner=function(a){return a<this.left.length?this.left.get(a):this.right.get(a-this.left.length)},r.prototype.forEachInner=function(a,l,h,A){var m=this.left.length;if(l<m&&this.left.forEachInner(a,l,Math.min(h,m),A)===!1||h>m&&this.right.forEachInner(a,Math.max(l-m,0),Math.min(this.length,h)-m,A+m)===!1)return!1},r.prototype.forEachInvertedInner=function(a,l,h,A){var m=this.left.length;if(l>m&&this.right.forEachInvertedInner(a,l-m,Math.max(h,m)-m,A+m)===!1||h<m&&this.left.forEachInvertedInner(a,Math.min(l,m),h,A)===!1)return!1},r.prototype.sliceInner=function(a,l){if(a==0&&l==this.length)return this;var h=this.left.length;return l<=h?this.left.slice(a,l):a>=h?this.right.slice(a-h,l-h):this.left.slice(a,h).append(this.right.slice(0,l-h))},r.prototype.leafAppend=function(a){var l=this.right.leafAppend(a);if(l)return new r(this.left,l)},r.prototype.leafPrepend=function(a){var l=this.left.leafPrepend(a);if(l)return new r(l,this.right)},r.prototype.appendInner=function(a){return this.left.depth>=Math.max(this.right.depth,a.depth)+1?new r(this.left,new r(this.right,a)):new r(this,a)},r}(Fn),PT=Fn,A3=500,jn=function(r,s){this.items=r,this.eventCount=s};jn.prototype.popEvent=function(r,s){var a=this;if(this.eventCount==0)return null;for(var l=this.items.length;;l--){var h=this.items.get(l-1);if(h.selection){--l;break}}var A,m;s&&(A=this.remapping(l,this.items.length),m=A.maps.length);var v=r.tr,C,S,b=[],O=[];return this.items.forEach(function(P,F){if(!P.step){A||(A=a.remapping(l,F+1),m=A.maps.length),m--,O.push(P);return}if(A){O.push(new Wo(P.map));var W=P.step.map(A.slice(m)),$;W&&v.maybeStep(W).doc&&($=v.mapping.maps[v.mapping.maps.length-1],b.push(new Wo($,null,null,b.length+O.length))),m--,$&&A.appendMap($,m)}else v.maybeStep(P.step);if(P.selection)return C=A?P.selection.map(A.slice(m)):P.selection,S=new jn(a.items.slice(0,l).append(O.reverse().concat(b)),a.eventCount-1),!1},this.items.length,0),{remaining:S,transform:v,selection:C}};jn.prototype.addTransform=function(r,s,a,l){for(var h=[],A=this.eventCount,m=this.items,v=!l&&m.length?m.get(m.length-1):null,C=0;C<r.steps.length;C++){var S=r.steps[C].invert(r.docs[C]),b=new Wo(r.mapping.maps[C],S,s),O=void 0;(O=v&&v.merge(b))&&(b=O,C?h.pop():m=m.slice(0,m.length-1)),h.push(b),s&&(A++,s=null),l||(v=b)}var P=A-a.depth;return P>g3&&(m=f3(m,P),A-=P),new jn(m.append(h),A)};jn.prototype.remapping=function(r,s){var a=new ti;return this.items.forEach(function(l,h){var A=l.mirrorOffset!=null&&h-l.mirrorOffset>=r?a.maps.length-l.mirrorOffset:null;a.appendMap(l.map,A)},r,s),a};jn.prototype.addMaps=function(r){return this.eventCount==0?this:new jn(this.items.append(r.map(function(s){return new Wo(s)})),this.eventCount)};jn.prototype.rebased=function(r,s){if(!this.eventCount)return this;var a=[],l=Math.max(0,this.items.length-s),h=r.mapping,A=r.steps.length,m=this.eventCount;this.items.forEach(function(P){P.selection&&m--},l);var v=s;this.items.forEach(function(P){var F=h.getMirror(--v);if(F!=null){A=Math.min(A,F);var W=h.maps[F];if(P.step){var $=r.steps[F].invert(r.docs[F]),X=P.selection&&P.selection.map(h.slice(v+1,F));X&&m++,a.push(new Wo(W,$,X))}else a.push(new Wo(W))}},l);for(var C=[],S=s;S<A;S++)C.push(new Wo(h.maps[S]));var b=this.items.slice(0,l).append(C).append(a),O=new jn(b,m);return O.emptyItemCount()>A3&&(O=O.compress(this.items.length-a.length)),O};jn.prototype.emptyItemCount=function(){var r=0;return this.items.forEach(function(s){s.step||r++}),r};jn.prototype.compress=function(r){r===void 0&&(r=this.items.length);var s=this.remapping(0,r),a=s.maps.length,l=[],h=0;return this.items.forEach(function(A,m){if(m>=r)l.push(A),A.selection&&h++;else if(A.step){var v=A.step.map(s.slice(a)),C=v&&v.getMap();if(a--,C&&s.appendMap(C,a),v){var S=A.selection&&A.selection.map(s.slice(a));S&&h++;var b=new Wo(C.invert(),v,S),O,P=l.length-1;(O=l.length&&l[P].merge(b))?l[P]=O:l.push(b)}}else A.map&&a--},this.items.length,0),new jn(PT.from(l.reverse()),h)};jn.empty=new jn(PT.empty,0);function f3(i,r){var s;return i.forEach(function(a,l){if(a.selection&&r--==0)return s=l,!1}),i.slice(s)}var Wo=function(r,s,a,l){this.map=r,this.step=s,this.selection=a,this.mirrorOffset=l};Wo.prototype.merge=function(r){if(this.step&&r.step&&!r.selection){var s=r.step.merge(this.step);if(s)return new Wo(s.getMap().invert(),s,this.selection)}};var Zs=function(r,s,a,l){this.done=r,this.undone=s,this.prevRanges=a,this.prevTime=l},g3=20;function m3(i,r,s,a){var l=s.getMeta(ea),h;if(l)return l.historyState;s.getMeta(v3)&&(i=new Zs(i.done,i.undone,null,0));var A=s.getMeta("appendedTransaction");if(s.steps.length==0)return i;if(A&&A.getMeta(ea))return A.getMeta(ea).redo?new Zs(i.done.addTransform(s,null,a,oh(r)),i.undone,h0(s.mapping.maps[s.steps.length-1]),i.prevTime):new Zs(i.done,i.undone.addTransform(s,null,a,oh(r)),null,i.prevTime);if(s.getMeta("addToHistory")!==!1&&!(A&&A.getMeta("addToHistory")===!1)){var m=i.prevTime==0||!A&&(i.prevTime<(s.time||0)-a.newGroupDelay||!E3(s,i.prevRanges)),v=A?ug(i.prevRanges,s.mapping):h0(s.mapping.maps[s.steps.length-1]);return new Zs(i.done.addTransform(s,m?r.selection.getBookmark():null,a,oh(r)),jn.empty,v,s.time)}else return(h=s.getMeta("rebased"))?new Zs(i.done.rebased(s,h),i.undone.rebased(s,h),ug(i.prevRanges,s.mapping),i.prevTime):new Zs(i.done.addMaps(s.mapping.maps),i.undone.addMaps(s.mapping.maps),ug(i.prevRanges,s.mapping),i.prevTime)}function E3(i,r){if(!r)return!1;if(!i.docChanged)return!0;var s=!1;return i.mapping.maps[0].forEach(function(a,l){for(var h=0;h<r.length;h+=2)a<=r[h+1]&&l>=r[h]&&(s=!0)}),s}function h0(i){var r=[];return i.forEach(function(s,a,l,h){return r.push(l,h)}),r}function ug(i,r){if(!i)return null;for(var s=[],a=0;a<i.length;a+=2){var l=r.map(i[a],1),h=r.map(i[a+1],-1);l<=h&&s.push(l,h)}return s}function xT(i,r,s,a){var l=oh(r),h=ea.get(r).spec.config,A=(a?i.undone:i.done).popEvent(r,l);if(!!A){var m=A.selection.resolve(A.transform.doc),v=(a?i.done:i.undone).addTransform(A.transform,r.selection.getBookmark(),h,l),C=new Zs(a?v:A.remaining,a?A.remaining:v,null,0);s(A.transform.setSelection(m).setMeta(ea,{redo:a,historyState:C}).scrollIntoView())}}var dg=!1,p0=null;function oh(i){var r=i.plugins;if(p0!=r){dg=!1,p0=r;for(var s=0;s<r.length;s++)if(r[s].spec.historyPreserveItems){dg=!0;break}}return dg}var ea=new ii("history"),v3=new ii("closeHistory");function I3(i){return i={depth:i&&i.depth||100,newGroupDelay:i&&i.newGroupDelay||500},new gn({key:ea,state:{init:function(){return new Zs(jn.empty,jn.empty,null,0)},apply:function(s,a,l){return m3(a,l,s,i)}},config:i,props:{handleDOMEvents:{beforeinput:function(s,a){var l=a.inputType=="historyUndo"?UT(s.state,s.dispatch):a.inputType=="historyRedo"?QT(s.state,s.dispatch):!1;return l&&a.preventDefault(),l}}}})}function UT(i,r){var s=ea.getState(i);return!s||s.done.eventCount==0?!1:(r&&xT(s,i,r,!1),!0)}function QT(i,r){var s=ea.getState(i);return!s||s.undone.eventCount==0?!1:(r&&xT(s,i,r,!0),!0)}const C3=bn.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:i,dispatch:r})=>UT(i,r),redo:()=>({state:i,dispatch:r})=>QT(i,r)}},addProseMirrorPlugins(){return[I3(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Mod-y":()=>this.editor.commands.redo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-\u044F":()=>this.editor.commands.undo(),"Shift-Mod-\u044F":()=>this.editor.commands.redo()}}}),_3=ri.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:i}){return["hr",On(this.options.HTMLAttributes,i)]},addCommands(){return{setHorizontalRule:()=>({chain:i})=>i().insertContent({type:this.name}).command(({tr:r,dispatch:s})=>{var a;if(s){const{$to:l}=r.selection,h=l.end();if(l.nodeAfter)r.setSelection(Fe.create(r.doc,l.pos));else{const A=(a=l.parent.type.contentMatch.defaultType)===null||a===void 0?void 0:a.create();A&&(r.insert(h,A),r.setSelection(Fe.create(r.doc,h)))}r.scrollIntoView()}return!0}).run()}},addInputRules(){return[oP({find:/^(?:---|—-|___\s|\*\*\*\s)$/,type:this.type})]}}),y3=/(?:^|\s)((?:\*)((?:[^*]+))(?:\*))$/,S3=/(?:^|\s)((?:\*)((?:[^*]+))(?:\*))/g,T3=/(?:^|\s)((?:_)((?:[^_]+))(?:_))$/,R3=/(?:^|\s)((?:_)((?:[^_]+))(?:_))/g,w3=oa.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:i=>i.style.fontStyle!=="normal"&&null},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:i}){return["em",On(this.options.HTMLAttributes,i),0]},addCommands(){return{setItalic:()=>({commands:i})=>i.setMark(this.name),toggleItalic:()=>({commands:i})=>i.toggleMark(this.name),unsetItalic:()=>({commands:i})=>i.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[Ga({find:y3,type:this.type}),Ga({find:T3,type:this.type})]},addPasteRules(){return[ja({find:S3,type:this.type}),ja({find:R3,type:this.type})]}}),b3=ri.create({name:"listItem",addOptions(){return{HTMLAttributes:{}}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:i}){return["li",On(this.options.HTMLAttributes,i),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),N3=/^(\d+)\.\s$/,O3=ri.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:i=>i.hasAttribute("start")?parseInt(i.getAttribute("start")||"",10):1}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:i}){const a=i,{start:r}=a,s=Z_(a,["start"]);return r===1?["ol",On(this.options.HTMLAttributes,s),0]:["ol",On(this.options.HTMLAttributes,i),0]},addCommands(){return{toggleOrderedList:()=>({commands:i})=>i.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){return[Kh({find:N3,type:this.type,getAttributes:i=>({start:+i[1]}),joinPredicate:(i,r)=>r.childCount+r.attrs.start===+i[1]})]}}),k3=ri.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:i}){return["p",On(this.options.HTMLAttributes,i),0]},addCommands(){return{setParagraph:()=>({commands:i})=>i.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),D3=/(?:^|\s)((?:~~)((?:[^~]+))(?:~~))$/,B3=/(?:^|\s)((?:~~)((?:[^~]+))(?:~~))/g,L3=oa.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:i=>i.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:i}){return["s",On(this.options.HTMLAttributes,i),0]},addCommands(){return{setStrike:()=>({commands:i})=>i.setMark(this.name),toggleStrike:()=>({commands:i})=>i.toggleMark(this.name),unsetStrike:()=>({commands:i})=>i.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-x":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[Ga({find:D3,type:this.type})]},addPasteRules(){return[ja({find:B3,type:this.type})]}}),M3=ri.create({name:"text",group:"inline"}),P3=bn.create({name:"starterKit",addExtensions(){var i,r,s,a,l,h,A,m,v,C,S,b,O,P,F,W,$,X;const K=[];return this.options.blockquote!==!1&&K.push(Vx.configure((i=this.options)===null||i===void 0?void 0:i.blockquote)),this.options.bold!==!1&&K.push(Wx.configure((r=this.options)===null||r===void 0?void 0:r.bold)),this.options.bulletList!==!1&&K.push(qx.configure((s=this.options)===null||s===void 0?void 0:s.bulletList)),this.options.code!==!1&&K.push(Xx.configure((a=this.options)===null||a===void 0?void 0:a.code)),this.options.codeBlock!==!1&&K.push(t3.configure((l=this.options)===null||l===void 0?void 0:l.codeBlock)),this.options.document!==!1&&K.push(e3.configure((h=this.options)===null||h===void 0?void 0:h.document)),this.options.dropcursor!==!1&&K.push(n3.configure((A=this.options)===null||A===void 0?void 0:A.dropcursor)),this.options.gapcursor!==!1&&K.push(u3.configure((m=this.options)===null||m===void 0?void 0:m.gapcursor)),this.options.hardBreak!==!1&&K.push(d3.configure((v=this.options)===null||v===void 0?void 0:v.hardBreak)),this.options.heading!==!1&&K.push(h3.configure((C=this.options)===null||C===void 0?void 0:C.heading)),this.options.history!==!1&&K.push(C3.configure((S=this.options)===null||S===void 0?void 0:S.history)),this.options.horizontalRule!==!1&&K.push(_3.configure((b=this.options)===null||b===void 0?void 0:b.horizontalRule)),this.options.italic!==!1&&K.push(w3.configure((O=this.options)===null||O===void 0?void 0:O.italic)),this.options.listItem!==!1&&K.push(b3.configure((P=this.options)===null||P===void 0?void 0:P.listItem)),this.options.orderedList!==!1&&K.push(O3.configure((F=this.options)===null||F===void 0?void 0:F.orderedList)),this.options.paragraph!==!1&&K.push(k3.configure((W=this.options)===null||W===void 0?void 0:W.paragraph)),this.options.strike!==!1&&K.push(L3.configure(($=this.options)===null||$===void 0?void 0:$.strike)),this.options.text!==!1&&K.push(M3.configure((X=this.options)===null||X===void 0?void 0:X.text)),K}}),x3=(i,r)=>{let s=0,a=0;for(;s<i.length&&s<r.length&&i[s]===r[s];)s++;if(s!==i.length||s!==r.length)for(;a+s<i.length&&a+s<r.length&&i[i.length-a-1]===r[r.length-a-1];)a++;return{index:s,remove:i.length-s-a,insert:r.slice(s,r.length-a)}},U3=x3,Wr=new ii("y-sync"),Fa=new ii("y-undo"),$d=new ii("yjs-cursor"),Sh=(i,r)=>r===void 0?!i.deleted:r.sv.has(i.id.client)&&r.sv.get(i.id.client)>i.id.clock&&!jO(r.ds,i.id),Q3=[{light:"#ecd44433",dark:"#ecd444"}],F3=(i,r,s)=>{if(!i.has(s)){if(i.size<r.length){const a=XO();i.forEach(l=>a.add(l)),r=r.filter(l=>!a.has(l))}i.set(s,qO(r))}return i.get(s)},V3=(i,{colors:r=Q3,colorMapping:s=new Map,permanentUserData:a=null}={})=>{let l=!1;const h=new gn({props:{editable:A=>{const m=Wr.getState(A);return m.snapshot==null&&m.prevSnapshot==null}},key:Wr,state:{init:(A,m)=>({type:i,doc:i.doc,binding:null,snapshot:null,prevSnapshot:null,isChangeOrigin:!1,colors:r,colorMapping:s,permanentUserData:a}),apply:(A,m)=>{const v=A.getMeta(Wr);if(v!==void 0){m=Object.assign({},m);for(const C in v)m[C]=v[C]}return m.isChangeOrigin=v!==void 0&&!!v.isChangeOrigin,m.binding!==null&&v!==void 0&&(v.snapshot!=null||v.prevSnapshot!=null)&&setTimeout(()=>{v.restore==null?m.binding._renderSnapshot(v.snapshot,v.prevSnapshot,m):(m.binding._renderSnapshot(v.snapshot,v.snapshot,m),delete m.restore,delete m.snapshot,delete m.prevSnapshot,m.binding._prosemirrorChanged(m.binding.prosemirrorView.state.doc))},0),m}},view:A=>{const m=new j3(i,A);return setTimeout(()=>{m._forceRerender(),A.dispatch(A.state.tr.setMeta(Wr,{binding:m}))},0),{update:()=>{const v=h.getState(A.state);v.snapshot==null&&v.prevSnapshot==null&&(l||A.state.doc.content.findDiffStart(A.state.doc.type.createAndFill().content)!==null)&&(l=!0,m._prosemirrorChanged(A.state.doc))},destroy:()=>{m.destroy()}}}});return h},G3=(i,r,s)=>{if(r!==null&&r.anchor!==null&&r.head!==null){const a=fu(s.doc,s.type,r.anchor,s.mapping),l=fu(s.doc,s.type,r.head,s.mapping);a!==null&&l!==null&&(i=i.setSelection(Fe.create(i.doc,a,l)))}},Pg=(i,r)=>({anchor:Rh(r.selection.anchor,i.type,i.mapping),head:Rh(r.selection.head,i.type,i.mapping)});class j3{constructor(r,s){this.type=r,this.prosemirrorView=s,this.mux=QO(),this.mapping=new Map,this._observeFunction=this._typeChanged.bind(this),this.doc=r.doc,this.beforeTransactionSelection=null,this.beforeAllTransactions=()=>{this.beforeTransactionSelection===null&&(this.beforeTransactionSelection=Pg(this,s.state))},this.afterAllTransactions=()=>{this.beforeTransactionSelection=null},this.doc.on("beforeAllTransactions",this.beforeAllTransactions),this.doc.on("afterAllTransactions",this.afterAllTransactions),r.observeDeep(this._observeFunction),this._domSelectionInView=null}_isLocalCursorInView(){return this.prosemirrorView.hasFocus()?(FO&&this._domSelectionInView===null&&(setTimeout(()=>{this._domSelectionInView=null},0),this._domSelectionInView=this._isDomSelectionInView()),this._domSelectionInView):!1}_isDomSelectionInView(){const r=this.prosemirrorView._root.getSelection(),s=this.prosemirrorView._root.createRange();s.setStart(r.anchorNode,r.anchorOffset),s.setEnd(r.focusNode,r.focusOffset),s.getClientRects().length===0&&s.startContainer&&s.collapsed&&s.selectNodeContents(s.startContainer);const l=s.getBoundingClientRect(),h=VO.documentElement;return l.bottom>=0&&l.right>=0&&l.left<=(window.innerWidth||h.clientWidth||0)&&l.top<=(window.innerHeight||h.clientHeight||0)}renderSnapshot(r,s){s||(s=WO(YO(),new Map)),this.prosemirrorView.dispatch(this.prosemirrorView.state.tr.setMeta(Wr,{snapshot:r,prevSnapshot:s}))}unrenderSnapshot(){this.mapping=new Map,this.mux(()=>{const r=this.type.toArray().map(a=>sh(a,this.prosemirrorView.state.schema,this.mapping)).filter(a=>a!==null),s=this.prosemirrorView.state.tr.replace(0,this.prosemirrorView.state.doc.content.size,new Pt(new Et(r),0,0));s.setMeta(Wr,{snapshot:null,prevSnapshot:null}),this.prosemirrorView.dispatch(s)})}_forceRerender(){this.mapping=new Map,this.mux(()=>{const r=this.type.toArray().map(a=>sh(a,this.prosemirrorView.state.schema,this.mapping)).filter(a=>a!==null),s=this.prosemirrorView.state.tr.replace(0,this.prosemirrorView.state.doc.content.size,new Pt(new Et(r),0,0));this.prosemirrorView.dispatch(s.setMeta(Wr,{isChangeOrigin:!0}))})}_renderSnapshot(r,s,a){r||(r=GO(this.doc)),this.mapping=new Map,this.mux(()=>{this.doc.transact(l=>{const h=a.permanentUserData;h&&h.dss.forEach(C=>{$_(l,C,S=>{})});const A=(C,S)=>{const b=C==="added"?h.getUserByClientId(S.client):h.getUserByDeletedId(S);return{user:b,type:C,color:F3(a.colorMapping,a.colors,b)}},m=S0(this.type,new T0(s.ds,r.sv)).map(C=>!C._item.deleted||Sh(C._item,r)||Sh(C._item,s)?sh(C,this.prosemirrorView.state.schema,new Map,r,s,A):null).filter(C=>C!==null),v=this.prosemirrorView.state.tr.replace(0,this.prosemirrorView.state.doc.content.size,new Pt(new Et(m),0,0));this.prosemirrorView.dispatch(v.setMeta(Wr,{isChangeOrigin:!0}))},Wr)})}_typeChanged(r,s){const a=Wr.getState(this.prosemirrorView.state);if(r.length===0||a.snapshot!=null||a.prevSnapshot!=null){this.renderSnapshot(a.snapshot,a.prevSnapshot);return}this.mux(()=>{const l=(m,v)=>this.mapping.delete(v);$_(s,s.deleteSet,m=>m.constructor===R0&&this.mapping.delete(m.content.type)),s.changed.forEach(l),s.changedParentTypes.forEach(l);const h=this.type.toArray().map(m=>FT(m,this.prosemirrorView.state.schema,this.mapping)).filter(m=>m!==null);let A=this.prosemirrorView.state.tr.replace(0,this.prosemirrorView.state.doc.content.size,new Pt(new Et(h),0,0));G3(A,this.beforeTransactionSelection,this),A=A.setMeta(Wr,{isChangeOrigin:!0}),this.beforeTransactionSelection!==null&&this._isLocalCursorInView()&&A.scrollIntoView(),this.prosemirrorView.dispatch(A)})}_prosemirrorChanged(r){this.mux(()=>{this.doc.transact(()=>{Ug(this.doc,this.type,r,this.mapping),this.beforeTransactionSelection=Pg(this,this.prosemirrorView.state)},Wr)})}destroy(){this.type.unobserveDeep(this._observeFunction),this.doc.off("beforeAllTransactions",this.beforeAllTransactions),this.doc.off("afterAllTransactions",this.afterAllTransactions)}}const FT=(i,r,s,a,l,h)=>{const A=s.get(i);if(A===void 0){if(i instanceof ys)return sh(i,r,s,a,l,h);throw KO()}return A},sh=(i,r,s,a,l,h)=>{const A=[],m=v=>{if(v.constructor===ys){const C=FT(v,r,s,a,l,h);C!==null&&A.push(C)}else{const C=K3(v,r,s,a,l,h);C!==null&&C.forEach(S=>{S!==null&&A.push(S)})}};a===void 0||l===void 0?i.toArray().forEach(m):S0(i,new T0(l.ds,a.sv)).forEach(m);try{const v=i.getAttributes(a);a!==void 0&&(Sh(i._item,a)?Sh(i._item,l)||(v.ychange=h?h("added",i._item.id):{type:"added"}):v.ychange=h?h("removed",i._item.id):{type:"removed"});const C=r.node(i.nodeName,v,A);return s.set(i,C),C}catch{return i.doc.transact(C=>{i._item.delete(C)},Wr),s.delete(i),null}},K3=(i,r,s,a,l,h)=>{const A=[],m=i.toDelta(a,l,h);try{for(let v=0;v<m.length;v++){const C=m[v],S=[];for(const b in C.attributes)S.push(r.mark(b,C.attributes[b]));A.push(r.text(C.insert,S))}}catch{return i.doc.transact(C=>{i._item.delete(C)},Wr),null}return A},H3=(i,r)=>{const s=new ta,a=i.map(l=>({insert:l.text,attributes:GT(l.marks)}));return s.applyDelta(a),r.set(s,i),s},W3=(i,r)=>{const s=new ys(i.type.name);for(const a in i.attrs){const l=i.attrs[a];l!==null&&a!=="ychange"&&s.setAttribute(a,l)}return s.insert(0,Yh(i).map(a=>xg(a,r))),r.set(s,i),s},xg=(i,r)=>i instanceof Array?H3(i,r):W3(i,r),A0=i=>typeof i=="object"&&i!==null,bm=(i,r)=>{const s=Object.keys(i).filter(l=>i[l]!==null);let a=s.length===Object.keys(r).filter(l=>r[l]!==null).length;for(let l=0;l<s.length&&a;l++){const h=s[l],A=i[h],m=r[h];a=h==="ychange"||A===m||A0(A)&&A0(m)&&bm(A,m)}return a},Yh=i=>{const r=i.content.content,s=[];for(let a=0;a<r.length;a++){const l=r[a];if(l.isText){const h=[];for(let A=r[a];a<r.length&&A.isText;A=r[++a])h.push(A);a--,s.push(h)}else s.push(l)}return s},VT=(i,r)=>{const s=i.toDelta();return s.length===r.length&&s.every((a,l)=>a.insert===r[l].text&&HO(a.attributes||{}).length===r[l].marks.length&&r[l].marks.every(h=>bm(a.attributes[h.type.name]||{},h.attrs)))},Au=(i,r)=>{if(i instanceof ys&&!(r instanceof Array)&&Qg(i,r)){const s=Yh(r);return i._length===s.length&&bm(i.getAttributes(),r.attrs)&&i.toArray().every((a,l)=>Au(a,s[l]))}return i instanceof ta&&r instanceof Array&&VT(i,r)},Th=(i,r)=>i===r||i instanceof Array&&r instanceof Array&&i.length===r.length&&i.every((s,a)=>r[a]===s),f0=(i,r,s)=>{const a=i.toArray(),l=Yh(r),h=l.length,A=a.length,m=Yl(A,h);let v=0,C=0,S=!1;for(;v<m;v++){const b=a[v],O=l[v];if(Th(s.get(b),O))S=!0;else if(!Au(b,O))break}for(;v+C<m;C++){const b=a[A-C-1],O=l[h-C-1];if(Th(s.get(b),O))S=!0;else if(!Au(b,O))break}return{equalityFactor:v+C,foundMappedChild:S}},Y3=i=>{let r="",s=i._start;const a={};for(;s!==null;)s.deleted||(s.countable&&s.content instanceof JO?r+=s.content.str:s.content instanceof zO&&(a[s.content.key]=null)),s=s.right;return{str:r,nAttrs:a}},q3=(i,r,s)=>{s.set(i,r);const{nAttrs:a,str:l}=Y3(i),h=r.map(C=>({insert:C.text,attributes:Object.assign({},a,GT(C.marks))})),{insert:A,remove:m,index:v}=U3(l,h.map(C=>C.insert).join(""));i.delete(v,m),i.insert(v,A),i.applyDelta(h.map(C=>({retain:C.insert.length,attributes:C.attributes})))},GT=i=>{const r={};return i.forEach(s=>{s.type.name!=="ychange"&&(r[s.type.name]=s.attrs)}),r},Ug=(i,r,s,a)=>{if(r instanceof ys&&r.nodeName!==s.type.name)throw new Error("node name mismatch!");if(a.set(r,s),r instanceof ys){const b=r.getAttributes(),O=s.attrs;for(const P in O)O[P]!==null?b[P]!==O[P]&&P!=="ychange"&&r.setAttribute(P,O[P]):r.removeAttribute(P);for(const P in b)O[P]===void 0&&r.removeAttribute(P)}const l=Yh(s),h=l.length,A=r.toArray(),m=A.length,v=Yl(h,m);let C=0,S=0;for(;C<v;C++){const b=A[C],O=l[C];if(!Th(a.get(b),O))if(Au(b,O))a.set(b,O);else break}for(;S+C+1<v;S++){const b=A[m-S-1],O=l[h-S-1];if(!Th(a.get(b),O))if(Au(b,O))a.set(b,O);else break}i.transact(()=>{for(;m-C-S>0&&h-C-S>0;){const O=A[C],P=l[C],F=A[m-S-1],W=l[h-S-1];if(O instanceof ta&&P instanceof Array)VT(O,P)||q3(O,P,a),C+=1;else{let $=O instanceof ys&&Qg(O,P),X=F instanceof ys&&Qg(F,W);if($&&X){const K=f0(O,P,a),_t=f0(F,W,a);K.foundMappedChild&&!_t.foundMappedChild?X=!1:!K.foundMappedChild&&_t.foundMappedChild||K.equalityFactor<_t.equalityFactor?$=!1:X=!1}$?(Ug(i,O,P,a),C+=1):X?(Ug(i,F,W,a),S+=1):(r.delete(C,1),r.insert(C,[xg(P,a)]),C+=1)}}const b=m-C-S;if(b>0&&r.delete(C,b),C+S<h){const O=[];for(let P=C;P<h-S;P++)O.push(xg(l[P],a));r.insert(C,O)}},Wr)},Qg=(i,r)=>!(r instanceof Array)&&i.nodeName===r.type.name;let ru=null;const J3=()=>{const i=ru;ru=null,i.forEach((r,s)=>{const a=s.state.tr;r.forEach((l,h)=>{a.setMeta(h,l)}),s.dispatch(a)})},z3=(i,r,s)=>{ru||(ru=new Map,gk(0,J3)),rk(ru,i,nk).set(r,s)},Rh=(i,r,s)=>{if(i===0)return Ff(r,0);let a=r._first===null?null:r._first.content.type;for(;a!==null&&r!==a;){if(a instanceof ta){if(a._length>=i)return Ff(a,i);if(i-=a._length,a._item!==null&&a._item.next!==null)a=a._item.next.content.type;else{do a=a._item===null?null:a._item.parent,i--;while(a!==r&&a!==null&&a._item!==null&&a._item.next===null);a!==null&&a!==r&&(a=a._item===null?null:a._item.next.content.type)}}else{const l=(s.get(a)||{nodeSize:0}).nodeSize;if(a._first!==null&&i<l)a=a._first.content.type,i--;else{if(i===1&&a._length===0&&l>1)return new Ag(a._item===null?null:a._item.id,a._item===null?fg(a):null,null);if(i-=l,a._item!==null&&a._item.next!==null)a=a._item.next.content.type;else{if(i===0)return a=a._item===null?a:a._item.parent,new Ag(a._item===null?null:a._item.id,a._item===null?fg(a):null,null);do a=a._item.parent,i--;while(a!==r&&a._item.next===null);a!==r&&(a=a._item.next.content.type)}}}if(a===null)throw ZO();if(i===0&&a.constructor!==ta&&a!==r)return X3(a._item.parent,a._item)}return Ff(r,r._length)},X3=(i,r)=>{let s=null,a=null;return i._item===null?a=fg(i):s=$O(i._item.id.client,i._item.id.clock),new Ag(s,a,r.id)},fu=(i,r,s,a)=>{const l=tk(s,i);if(l===null||l.type!==r&&!ek(r,l.type._item))return null;let h=l.type,A=0;if(h.constructor===ta)A=l.index;else if(h._item===null||!h._item.deleted){let m=h._first,v=0;for(;v<h._length&&v<l.index&&m!==null;){if(!m.deleted){const C=m.content.type;v++,C instanceof ta?A+=C._length:A+=a.get(C).nodeSize}m=m.right}A+=1}for(;h!==r&&h._item!==null;){const m=h._item.parent;if(m._item===null||!m._item.deleted){A+=1;let v=m._first;for(;v!==null;){const C=v.content.type;if(C===h)break;v.deleted||(C instanceof ta?A+=C._length:A+=a.get(C).nodeSize),v=v.right}}h=m}return A-1},Z3=i=>{const r=document.createElement("span");r.classList.add("ProseMirror-yjs-cursor"),r.setAttribute("style",`border-color: ${i.color}`);const s=document.createElement("div");return s.setAttribute("style",`background-color: ${i.color}`),s.insertBefore(document.createTextNode(i.name),null),r.insertBefore(s,null),r},$3=/^#[0-9a-fA-F]{6}$/,g0=(i,r,s)=>{const a=Wr.getState(i),l=a.doc,h=[];return a.snapshot!=null||a.prevSnapshot!=null||a.binding===null?or.create(i.doc,[]):(r.getStates().forEach((A,m)=>{if(m!==l.clientID&&A.cursor!=null){const v=A.user||{};v.color==null?v.color="#ffa500":$3.test(v.color)||console.warn("A user uses an unsupported color format",v),v.name==null&&(v.name=`User: ${m}`);let C=fu(l,a.type,ql(A.cursor.anchor),a.binding.mapping),S=fu(l,a.type,ql(A.cursor.head),a.binding.mapping);if(C!==null&&S!==null){const b=ty(i.doc.content.size-1,0);C=Yl(C,b),S=Yl(S,b),h.push(nn.widget(S,()=>s(v),{key:m+"",side:10}));const O=Yl(C,S),P=ty(C,S);h.push(nn.inline(O,P,{style:`background-color: ${v.color}70`},{inclusiveEnd:!0,inclusiveStart:!1}))}}}),or.create(i.doc,h))},tU=(i,{cursorBuilder:r=Z3,getSelection:s=l=>l.selection}={},a="cursor")=>new gn({key:$d,state:{init(l,h){return g0(h,i,r)},apply(l,h,A,m){const v=Wr.getState(m),C=l.getMeta($d);return v&&v.isChangeOrigin||C&&C.awarenessUpdated?g0(m,i,r):h.map(l.mapping,l.doc)}},props:{decorations:l=>$d.getState(l)},view:l=>{const h=()=>{l.docView&&z3(l,$d,{awarenessUpdated:!0})},A=()=>{const m=Wr.getState(l.state),v=i.getLocalState()||{};if(m.binding!=null)if(l.hasFocus()){const C=s(l.state),S=Rh(C.anchor,m.type,m.binding.mapping),b=Rh(C.head,m.type,m.binding.mapping);(v.cursor==null||!ey(ql(v.cursor.anchor),S)||!ey(ql(v.cursor.head),b))&&i.setLocalStateField(a,{anchor:S,head:b})}else v.cursor!=null&&fu(m.doc,m.type,ql(v.cursor.anchor),m.binding.mapping)!==null&&i.setLocalStateField(a,null)};return i.on("change",h),l.dom.addEventListener("focusin",A),l.dom.addEventListener("focusout",A),{update:A,destroy:()=>{l.dom.removeEventListener("focusin",A),l.dom.removeEventListener("focusout",A),i.off("change",h),i.setLocalStateField(a,null)}}}}),eU=i=>{const r=Fa.getState(i).undoManager;if(r!=null)return r.undo(),!0},rU=i=>{const r=Fa.getState(i).undoManager;if(r!=null)return r.redo(),!0},nU=new Set(["paragraph"]),iU=(i,r)=>!(i instanceof R0)||!(i.content instanceof ok)||!(i.content.type instanceof sk||i.content.type instanceof ys&&r.has(i.content.type.nodeName))||i.content.type._length===0,oU=({protectedNodes:i=nU,trackedOrigins:r=[],undoManager:s=null}={})=>new gn({key:Fa,state:{init:(a,l)=>{const h=Wr.getState(l),A=s||new ik(h.type,{trackedOrigins:new Set([Wr].concat(r)),deleteFilter:m=>iU(m,i)});return{undoManager:A,prevSel:null,hasUndoOps:A.undoStack.length>0,hasRedoOps:A.redoStack.length>0}},apply:(a,l,h,A)=>{const m=Wr.getState(A).binding,v=l.undoManager,C=v.undoStack.length>0,S=v.redoStack.length>0;return m?{undoManager:v,prevSel:Pg(m,h),hasUndoOps:C,hasRedoOps:S}:C!==l.hasUndoOps||S!==l.hasRedoOps?Object.assign({},l,{hasUndoOps:v.undoStack.length>0,hasRedoOps:v.redoStack.length>0}):l}},view:a=>{const l=Wr.getState(a.state),h=Fa.getState(a.state).undoManager;return h.on("stack-item-added",({stackItem:A})=>{const m=l.binding;m&&A.meta.set(m,Fa.getState(a.state).prevSel)}),h.on("stack-item-popped",({stackItem:A})=>{const m=l.binding;m&&(m.beforeTransactionSelection=A.meta.get(m)||m.beforeTransactionSelection)}),{destroy:()=>{h.destroy()}}}}),sU=bn.create({name:"collaboration",priority:1e3,addOptions(){return{document:null,field:"default",fragment:null}},onCreate(){this.editor.extensionManager.extensions.find(i=>i.name==="history")&&console.warn('[tiptap warn]: "@tiptap/extension-collaboration" comes with its own history support and is not compatible with "@tiptap/extension-history".')},addCommands(){return{undo:()=>({tr:i,state:r,dispatch:s})=>(i.setMeta("preventDispatch",!0),Fa.getState(r).undoManager.undoStack.length===0?!1:s?eU(r):!0),redo:()=>({tr:i,state:r,dispatch:s})=>(i.setMeta("preventDispatch",!0),Fa.getState(r).undoManager.redoStack.length===0?!1:s?rU(r):!0)}},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Mod-y":()=>this.editor.commands.redo(),"Shift-Mod-z":()=>this.editor.commands.redo()}},addProseMirrorPlugins(){const i=this.options.fragment?this.options.fragment:this.options.document.getXmlFragment(this.options.field);return[V3(i),oU()]}}),m0=i=>Array.from(i.entries()).map(([r,s])=>vt({clientId:r},s.user)),E0=()=>null,aU=bn.create({name:"collaborationCursor",addOptions(){return{provider:null,user:{name:null,color:null},render:i=>{const r=document.createElement("span");r.classList.add("collaboration-cursor__caret"),r.setAttribute("style",`border-color: ${i.color}`);const s=document.createElement("div");return s.classList.add("collaboration-cursor__label"),s.setAttribute("style",`background-color: ${i.color}`),s.insertBefore(document.createTextNode(i.name),null),r.insertBefore(s,null),r},onUpdate:E0}},onCreate(){this.options.onUpdate!==E0&&console.warn('[tiptap warn]: DEPRECATED: The "onUpdate" option is deprecated. Please use `editor.storage.collaborationCursor.users` instead. Read more: https://tiptap.dev/api/extensions/collaboration-cursor')},addStorage(){return{users:[]}},addCommands(){return{updateUser:i=>()=>(this.options.user=i,this.options.provider.awareness.setLocalStateField("user",this.options.user),!0),user:i=>({editor:r})=>(console.warn('[tiptap warn]: DEPRECATED: The "user" command is deprecated. Please use "updateUser" instead. Read more: https://tiptap.dev/api/extensions/collaboration-cursor'),r.commands.updateUser(i))}},addProseMirrorPlugins(){return[tU((()=>(this.options.provider.awareness.setLocalStateField("user",this.options.user),this.storage.users=m0(this.options.provider.awareness.states),this.options.provider.awareness.on("update",()=>{this.storage.users=m0(this.options.provider.awareness.states)}),this.options.provider.awareness))(),{cursorBuilder:this.options.render})]}}),cU=ri.create({name:"taskList",addOptions(){return{itemTypeName:"taskItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:i}){return["ul",On(this.options.HTMLAttributes,i,{"data-type":this.name}),0]},addCommands(){return{toggleTaskList:()=>({commands:i})=>i.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}}),lU=/^\s*(\[([ |x])\])\s$/,uU=ri.create({name:"taskItem",addOptions(){return{nested:!1,HTMLAttributes:{}}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:i=>i.getAttribute("data-checked")==="true",renderHTML:i=>({"data-checked":i.checked})}}},parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:i,HTMLAttributes:r}){return["li",On(this.options.HTMLAttributes,r,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:i.attrs.checked?"checked":null}],["span"]],["div",0]]},addKeyboardShortcuts(){const i={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?wn(vt({},i),{Tab:()=>this.editor.commands.sinkListItem(this.name)}):i},addNodeView(){return({node:i,HTMLAttributes:r,getPos:s,editor:a})=>{const l=document.createElement("li"),h=document.createElement("label"),A=document.createElement("span"),m=document.createElement("input"),v=document.createElement("div");return h.contentEditable="false",m.type="checkbox",m.addEventListener("change",C=>{if(!a.isEditable){m.checked=!m.checked;return}const{checked:S}=C.target;a.isEditable&&typeof s=="function"&&a.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:b})=>{const O=s(),P=b.doc.nodeAt(O);return b.setNodeMarkup(O,void 0,wn(vt({},P==null?void 0:P.attrs),{checked:S})),!0}).run()}),Object.entries(this.options.HTMLAttributes).forEach(([C,S])=>{l.setAttribute(C,S)}),l.dataset.checked=i.attrs.checked,i.attrs.checked&&m.setAttribute("checked","checked"),h.append(m,A),l.append(h,v),Object.entries(r).forEach(([C,S])=>{l.setAttribute(C,S)}),{dom:l,contentDOM:v,update:C=>C.type!==this.type?!1:(l.dataset.checked=C.attrs.checked,C.attrs.checked?m.setAttribute("checked","checked"):m.removeAttribute("checked"),!0)}}},addInputRules(){return[Kh({find:lU,type:this.type,getAttributes:i=>({checked:i[i.length-1]==="x"})})]}}),dU=/(?:^|\s)((?:==)((?:[^~=]+))(?:==))$/,hU=/(?:^|\s)((?:==)((?:[^~=]+))(?:==))/g,pU=oa.create({name:"highlight",addOptions(){return{multicolor:!1,HTMLAttributes:{}}},addAttributes(){return this.options.multicolor?{color:{default:null,parseHTML:i=>i.getAttribute("data-color")||i.style.backgroundColor,renderHTML:i=>i.color?{"data-color":i.color,style:`background-color: ${i.color}`}:{}}}:{}},parseHTML(){return[{tag:"mark"}]},renderHTML({HTMLAttributes:i}){return["mark",On(this.options.HTMLAttributes,i),0]},addCommands(){return{setHighlight:i=>({commands:r})=>r.setMark(this.name,i),toggleHighlight:i=>({commands:r})=>r.toggleMark(this.name,i),unsetHighlight:()=>({commands:i})=>i.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-h":()=>this.editor.commands.toggleHighlight()}},addInputRules(){return[Ga({find:dU,type:this.type})]},addPasteRules(){return[ja({find:hU,type:this.type})]}}),AU=bn.create({name:"characterCount",addOptions(){return{limit:null,mode:"textSize"}},addStorage(){return{characters:()=>0,words:()=>0}},onBeforeCreate(){this.storage.characters=i=>{const r=(i==null?void 0:i.node)||this.editor.state.doc;return((i==null?void 0:i.mode)||this.options.mode)==="textSize"?r.textBetween(0,r.content.size,void 0," ").length:r.nodeSize},this.storage.words=i=>{const r=(i==null?void 0:i.node)||this.editor.state.doc;return r.textBetween(0,r.content.size," "," ").split(" ").filter(l=>l!=="").length}},addProseMirrorPlugins(){return[new gn({key:new ii("characterCount"),filterTransaction:(i,r)=>{const s=this.options.limit;if(!i.docChanged||s===0||s===null||s===void 0)return!0;const a=this.storage.characters({node:r.doc}),l=this.storage.characters({node:i.doc});if(l<=s||a>s&&l>s&&l<=a)return!0;if(a>s&&l>s&&l>a||!i.getMeta("paste"))return!1;const A=i.selection.$head.pos,m=l-s,v=A-m,C=A;return i.deleteRange(v,C),!(this.storage.characters({node:i.doc})>s)}})]}});const fU={props:{icon:{type:String,required:!0},title:{type:String,required:!0},action:{type:Function,required:!0},isActive:{type:Function,default:null}},components:{SvgIcon:rh}},gU=["title"];function mU(i,r,s,a,l,h){const A=ah("SvgIcon");return Un(),Hi("button",{class:Wl(["menu-item",{"is-active":s.isActive?s.isActive():null}]),onClick:r[0]||(r[0]=(...m)=>s.action&&s.action(...m)),title:s.title},[Ts(A,{name:"tiptap-"+s.icon},null,8,["name"])],10,gU)}var EU=wh(fU,[["render",mU],["__scopeId","data-v-d2d2a634"]]);const vU={components:{MenuItem:EU},props:{editor:{type:Object,required:!0}},data(){return{items:[{icon:"bold",title:"Bold",action:()=>this.editor.chain().focus().toggleBold().run(),isActive:()=>this.editor.isActive("bold")},{icon:"italic",title:"Italic",action:()=>this.editor.chain().focus().toggleItalic().run(),isActive:()=>this.editor.isActive("italic")},{icon:"strikethrough",title:"Strike",action:()=>this.editor.chain().focus().toggleStrike().run(),isActive:()=>this.editor.isActive("strike")},{icon:"code-view",title:"Code",action:()=>this.editor.chain().focus().toggleCode().run(),isActive:()=>this.editor.isActive("code")},{icon:"mark-pen-line",title:"Highlight",action:()=>this.editor.chain().focus().toggleHighlight().run(),isActive:()=>this.editor.isActive("highlight")},{type:"divider"},{icon:"h-1",title:"Heading 1",action:()=>this.editor.chain().focus().toggleHeading({level:1}).run(),isActive:()=>this.editor.isActive("heading",{level:1})},{icon:"h-2",title:"Heading 2",action:()=>this.editor.chain().focus().toggleHeading({level:2}).run(),isActive:()=>this.editor.isActive("heading",{level:2})},{icon:"paragraph",title:"Paragraph",action:()=>this.editor.chain().focus().setParagraph().run(),isActive:()=>this.editor.isActive("paragraph")},{icon:"list-unordered",title:"Bullet List",action:()=>this.editor.chain().focus().toggleBulletList().run(),isActive:()=>this.editor.isActive("bulletList")},{icon:"list-ordered",title:"Ordered List",action:()=>this.editor.chain().focus().toggleOrderedList().run(),isActive:()=>this.editor.isActive("orderedList")},{icon:"list-check-2",title:"Task List",action:()=>this.editor.chain().focus().toggleTaskList().run(),isActive:()=>this.editor.isActive("taskList")},{icon:"code-box-line",title:"Code Block",action:()=>this.editor.chain().focus().toggleCodeBlock().run(),isActive:()=>this.editor.isActive("codeBlock")},{type:"divider"},{icon:"double-quotes-l",title:"Blockquote",action:()=>this.editor.chain().focus().toggleBlockquote().run(),isActive:()=>this.editor.isActive("blockquote")},{icon:"separator",title:"Horizontal Rule",action:()=>this.editor.chain().focus().setHorizontalRule().run()},{type:"divider"},{icon:"text-wrap",title:"Hard Break",action:()=>this.editor.chain().focus().setHardBreak().run()},{icon:"format-clear",title:"Clear Format",action:()=>this.editor.chain().focus().clearNodes().unsetAllMarks().run()},{type:"divider"},{icon:"arrow-go-back-line",title:"Undo",action:()=>this.editor.chain().focus().undo().run()},{icon:"arrow-go-forward-line",title:"Redo",action:()=>this.editor.chain().focus().redo().run()}]}}};function IU(i,r,s,a,l,h){const A=ah("menu-item");return Un(),Hi("div",null,[(Un(!0),Hi($s,null,C0(l.items,(m,v)=>(Un(),Hi($s,null,[m.type==="divider"?(Un(),Hi("div",{class:"divider",key:`divider${v}`})):(Un(),ch(A,bO({key:1,key:v},m),null,16))],64))),256))])}var CU=wh(vU,[["render",IU],["__scopeId","data-v-1ebce63e"]]);const _U={components:{EditorContent:Qx,MenuBar:CU},data(){return{currentUser:JSON.parse(localStorage.getItem("currentUser"))||{name:ak(),color:ck()},provider:null,editor:null,users:[],status:"connecting"}},mounted(){const i=new lk;this.provider=new uk("wss://ws1.hookin.fun","b4472aac7c67808e4d4659b35bf10d8d",i),this.provider.on("status",r=>{this.status=r.status}),this.editor=new Ux({extensions:[P3.configure({history:!1}),pU,cU,uU,sU.configure({document:i}),aU.configure({provider:this.provider,user:this.currentUser}),AU.configure({limit:1e4})]})},methods:{setName(){const i=(window.prompt("Name")||"").trim().substring(0,32);if(i)return this.updateCurrentUser({name:i})},updateCurrentUser(i){this.currentUser=vt(vt({},this.currentUser),i),this.editor.chain().focus().user(this.currentUser).run(),localStorage.setItem("currentUser",JSON.stringify(this.currentUser))}},beforeUnmount(){this.editor.destroy(),this.provider.destroy()}},yU={key:0,class:"editor"},SU={class:"editor__footer"},TU=_0(" \u8FDE\u63A5\u4E2D\u2026\u2026 "),RU={class:"editor__name"};function wU(i,r,s,a,l,h){const A=ah("menu-bar"),m=ah("editor-content");return l.editor?(Un(),Hi("div",yU,[Ts(A,{class:"editor__header",editor:l.editor},null,8,["editor"]),Ts(m,{class:"editor__content",editor:l.editor},null,8,["editor"]),uo("div",SU,[uo("div",{class:Wl(`editor__status editor__status--${l.status}`)},[l.status==="connected"?(Un(),Hi($s,{key:0},[_0(eh(l.editor.storage.collaborationCursor.users.length)+" user"+eh(l.editor.storage.collaborationCursor.users.length===1?"":"s"),1)],64)):(Un(),Hi($s,{key:1},[TU],64))],2),uo("div",RU,[uo("button",{onClick:r[0]||(r[0]=(...v)=>h.setName&&h.setName(...v))},eh(l.currentUser.name),1)])])])):pg("",!0)}var bU=wh(_U,[["render",wU],["__scopeId","data-v-5d3b1a1e"]]);const NU=i=>(LO("data-v-16c6c8e9"),i=i(),MO(),i),OU={class:"z-10 absolute flex left-0 right-0 group-hover:bg-gray-800 text-white p-1 transition"},kU={class:"sm-btn w-5 bg-indigo-600 text-center overflow-hidden",title:"\u540D\u79F0"},DU=["title"],BU=["title"],LU=NU(()=>uo("div",{class:"flex-1"},null,-1)),MU=["id","onClick"],PU={directives:{drag:{mounted(i){const r=window.getComputedStyle(i,null);i.onmousedown=s=>{const a=s.clientX,l=s.clientY,h=+r.right.replace(/\px/g,""),A=+r.bottom.replace(/\px/g,""),m=+r.width.replace(/\px/g,""),v=+r.height.replace(/\px/g,""),C=window.innerWidth,S=window.innerHeight;document.onmousemove=function(b){const O=b.clientX-a,P=b.clientY-l,F=h-O,W=A-P;F<0||W<0||F>C-m||W>S-v||(i.style.right=F+"px",i.style.bottom=W+"px")},document.onmouseup=function(b){document.onmousemove=null,document.onmouseup=null}}}}}},xU=Object.assign(PU,{props:{name:{type:String,default:"\u6211"},liveUser:{type:Object},className:{type:String,default:"h-[8rem] bottom-2"}},emits:["close","video","audio"],setup(i,{emit:r}){const s=i,a=Uc(null);NO(window,"resize",()=>{const h=window.getComputedStyle(a.value,null),A=+h.left.replace(/\px/g,""),m=+h.top.replace(/\px/g,"");(A<0||m<0)&&(a.value.style.right="8px",a.value.style.bottom="8px")});const l=()=>{};return y0(()=>{}),(h,A)=>{const m=OO("drag");return kO((Un(),Hi("div",{ref_key:"target",ref:a,class:Wl(["fixed cursor-move min-w-[10rem] min-h-[2.5rem] right-2 select-none z-10 bg-gray-100 rounded overflow-hidden border-4 border-indigo-300 shadow-md hover:shadow-lg transition group",i.className]),style:BO(i.liveUser.hasOpenVideo?"":"height:0;")},[uo("div",OU,[uo("div",kU,eh(s.name[0]),1),uo("button",{class:Wl(["sm-btn",i.liveUser.hasOpenVideo?"":"active"]),title:i.liveUser.hasOpenVideo?"\u505C\u6B62\u5F55\u50CF":"\u5F00\u59CB\u5F55\u50CF",onClick:A[0]||(A[0]=v=>h.$emit("video",i.name))},[Ts(rh,{name:"live-camera-off",class:"w-5 h-5"})],10,DU),uo("button",{class:Wl(["sm-btn",i.liveUser.hasOpenAudio?"":"active"]),title:i.liveUser.hasOpenAudio?"\u505C\u6B62\u5F55\u97F3":"\u5F00\u59CB\u5F55\u97F3",onClick:A[1]||(A[1]=v=>h.$emit("audio",i.name))},[Ts(rh,{name:"live-mic-off",class:"w-5 h-5"})],10,BU),LU,uo("button",{class:"close-btn",onClick:A[2]||(A[2]=v=>h.$emit("close",i.name)),title:"\u5173\u95ED"},[Ts(rh,{name:"close",class:"h-5 w-5"})])]),uo("div",{class:"player",id:"player-"+i.liveUser.uid,onClick:DO(l,["stop"])},null,8,MU)],6)),[[m]])}}});var v0=wh(xU,[["__scopeId","data-v-16c6c8e9"]]),jT={exports:{}};(function(i,r){(function(s,a){i.exports=a()})(Qf,function(){var s=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof Qf!="undefined"?Qf:typeof self!="undefined"?self:{};function a(t,e,n){return t(n={path:e,exports:{},require:function(o,c){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(c==null&&n.path)}},n.exports),n.exports}var l=function(t){return t&&t.Math==Math&&t},h=l(typeof globalThis=="object"&&globalThis)||l(typeof window=="object"&&window)||l(typeof self=="object"&&self)||l(typeof s=="object"&&s)||Function("return this")(),A=function(t){try{return!!t()}catch{return!0}},m=!A(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7}),v={}.propertyIsEnumerable,C=Object.getOwnPropertyDescriptor,S={f:C&&!v.call({1:2},1)?function(t){var e=C(this,t);return!!e&&e.enumerable}:v},b=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},O={}.toString,P=function(t){return O.call(t).slice(8,-1)},F="".split,W=A(function(){return!Object("z").propertyIsEnumerable(0)})?function(t){return P(t)=="String"?F.call(t,""):Object(t)}:Object,$=function(t){if(t==null)throw TypeError("Can't call method on "+t);return t},X=function(t){return W($(t))},K=function(t){return typeof t=="object"?t!==null:typeof t=="function"},_t=function(t,e){if(!K(t))return t;var n,o;if(e&&typeof(n=t.toString)=="function"&&!K(o=n.call(t))||typeof(n=t.valueOf)=="function"&&!K(o=n.call(t))||!e&&typeof(n=t.toString)=="function"&&!K(o=n.call(t)))return o;throw TypeError("Can't convert object to primitive value")},H={}.hasOwnProperty,ft=function(t,e){return H.call(t,e)},Tt=h.document,$t=K(Tt)&&K(Tt.createElement),ne=function(t){return $t?Tt.createElement(t):{}},Te=!m&&!A(function(){return Object.defineProperty(ne("div"),"a",{get:function(){return 7}}).a!=7}),ve=Object.getOwnPropertyDescriptor,qe={f:m?ve:function(t,e){if(t=X(t),e=_t(e,!0),Te)try{return ve(t,e)}catch{}if(ft(t,e))return b(!S.f.call(t,e),t[e])}},Xe=/#|\.prototype\./,je=function(t,e){var n=sr[mn(t)];return n==Fr||n!=Le&&(typeof e=="function"?A(e):!!e)},mn=je.normalize=function(t){return String(t).replace(Xe,".").toLowerCase()},sr=je.data={},Le=je.NATIVE="N",Fr=je.POLYFILL="P",zr=je,le={},Or=function(t){if(typeof t!="function")throw TypeError(String(t)+" is not a function");return t},Kn=function(t,e,n){if(Or(t),e===void 0)return t;switch(n){case 0:return function(){return t.call(e)};case 1:return function(o){return t.call(e,o)};case 2:return function(o,c){return t.call(e,o,c)};case 3:return function(o,c,u){return t.call(e,o,c,u)}}return function(){return t.apply(e,arguments)}},ar=function(t){if(!K(t))throw TypeError(String(t)+" is not an object");return t},Mo=Object.defineProperty,kr={f:m?Mo:function(t,e,n){if(ar(t),e=_t(e,!0),ar(n),Te)try{return Mo(t,e,n)}catch{}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},yr=m?function(t,e,n){return kr.f(t,e,b(1,n))}:function(t,e,n){return t[e]=n,t},Eo=qe.f,Ds=function(t){var e=function(n,o,c){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(n);case 2:return new t(n,o)}return new t(n,o,c)}return t.apply(this,arguments)};return e.prototype=t.prototype,e},jt=function(t,e){var n,o,c,u,d,p,f,g,E=t.target,I=t.global,_=t.stat,T=t.proto,R=I?h:_?h[E]:(h[E]||{}).prototype,w=I?le:le[E]||(le[E]={}),k=w.prototype;for(c in e)n=!zr(I?c:E+(_?".":"#")+c,t.forced)&&R&&ft(R,c),d=w[c],n&&(p=t.noTargetGet?(g=Eo(R,c))&&g.value:R[c]),u=n&&p?p:e[c],n&&typeof d==typeof u||(f=t.bind&&n?Kn(u,h):t.wrap&&n?Ds(u):T&&typeof u=="function"?Kn(Function.call,u):u,(t.sham||u&&u.sham||d&&d.sham)&&yr(f,"sham",!0),w[c]=f,T&&(ft(le,o=E+"Prototype")||yr(le,o,{}),le[o][c]=u,t.real&&k&&!k[c]&&yr(k,c,u)))},Bs=Math.ceil,Po=Math.floor,ki=function(t){return isNaN(t=+t)?0:(t>0?Po:Bs)(t)},Ya=Math.min,Xr=function(t){return t>0?Ya(ki(t),9007199254740991):0},qa=Math.max,Ja=Math.min,Di=function(t,e){var n=ki(t);return n<0?qa(n+e,0):Ja(n,e)},Ls=function(t){return function(e,n,o){var c,u=X(e),d=Xr(u.length),p=Di(o,d);if(t&&n!=n){for(;d>p;)if((c=u[p++])!=c)return!0}else for(;d>p;p++)if((t||p in u)&&u[p]===n)return t||p||0;return!t&&-1}},Ms={includes:Ls(!0),indexOf:Ls(!1)},vo={},Io=Ms.indexOf,Co=function(t,e){var n,o=X(t),c=0,u=[];for(n in o)!ft(vo,n)&&ft(o,n)&&u.push(n);for(;e.length>c;)ft(o,n=e[c++])&&(~Io(u,n)||u.push(n));return u},xo=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Hn=Object.keys||function(t){return Co(t,xo)},Xo=m?Object.defineProperties:function(t,e){ar(t);for(var n,o=Hn(e),c=o.length,u=0;c>u;)kr.f(t,n=o[u++],e[n]);return t};jt({target:"Object",stat:!0,forced:!m,sham:!m},{defineProperties:Xo});var dr=a(function(t){var e=le.Object,n=t.exports=function(o,c){return e.defineProperties(o,c)};e.defineProperties.sham&&(n.sham=!0)}),ua=function(t){return typeof t=="function"?t:void 0},En=function(t,e){return arguments.length<2?ua(le[t])||ua(h[t]):le[t]&&le[t][e]||h[t]&&h[t][e]},Zo=En("JSON","stringify"),qh=/[\uD800-\uDFFF]/g,yu=/^[\uD800-\uDBFF]$/,Su=/^[\uDC00-\uDFFF]$/,Jh=function(t,e,n){var o=n.charAt(e-1),c=n.charAt(e+1);return yu.test(t)&&!Su.test(c)||Su.test(t)&&!yu.test(o)?"\\u"+t.charCodeAt(0).toString(16):t},zh=A(function(){return Zo("\uDF06\uD834")!=='"\\udf06\\ud834"'||Zo("\uDEAD")!=='"\\udead"'});Zo&&jt({target:"JSON",stat:!0,forced:zh},{stringify:function(t,e,n){var o=Zo.apply(null,arguments);return typeof o=="string"?o.replace(qh,Jh):o}}),le.JSON||(le.JSON={stringify:JSON.stringify});var pt,Ht,at=function(t,e,n){return le.JSON.stringify.apply(null,arguments)},Me=Array.isArray||function(t){return P(t)=="Array"},ce=function(t){return Object($(t))},Dr=function(t,e,n){var o=_t(e);o in t?kr.f(t,o,b(0,n)):t[o]=n},oi="__core-js_shared__",$o=h[oi]||function(t,e){try{yr(h,t,e)}catch{h[t]=e}return e}(oi,{}),Ji=a(function(t){(t.exports=function(e,n){return $o[e]||($o[e]=n!==void 0?n:{})})("versions",[]).push({version:"3.4.3",mode:"pure",copyright:"\xA9 2019 Denis Pushkarev (zloirock.ru)"})}),ts=0,$c=Math.random(),es=function(t){return"Symbol("+String(t===void 0?"":t)+")_"+(++ts+$c).toString(36)},kn=!!Object.getOwnPropertySymbols&&!A(function(){return!String(Symbol())}),Tu=kn&&!Symbol.sham&&typeof Symbol()=="symbol",Ps=Ji("wks"),xs=h.Symbol,KT=Tu?xs:es,Br=function(t){return ft(Ps,t)||(kn&&ft(xs,t)?Ps[t]=xs[t]:Ps[t]=KT("Symbol."+t)),Ps[t]},HT=Br("species"),Xh=function(t,e){var n;return Me(t)&&(typeof(n=t.constructor)!="function"||n!==Array&&!Me(n.prototype)?K(n)&&(n=n[HT])===null&&(n=void 0):n=void 0),new(n===void 0?Array:n)(e===0?0:e)},za=En("navigator","userAgent")||"",Nm=h.process,Om=Nm&&Nm.versions,km=Om&&Om.v8;km?Ht=(pt=km.split("."))[0]+pt[1]:za&&(!(pt=za.match(/Edge\/(\d+)/))||pt[1]>=74)&&(pt=za.match(/Chrome\/(\d+)/))&&(Ht=pt[1]);var Ru=Ht&&+Ht,WT=Br("species"),tl=function(t){return Ru>=51||!A(function(){var e=[];return(e.constructor={})[WT]=function(){return{foo:1}},e[t](Boolean).foo!==1})},Dm=Br("isConcatSpreadable"),Bm=9007199254740991,Lm="Maximum allowed index exceeded",YT=Ru>=51||!A(function(){var t=[];return t[Dm]=!1,t.concat()[0]!==t}),qT=tl("concat"),JT=function(t){if(!K(t))return!1;var e=t[Dm];return e!==void 0?!!e:Me(t)};jt({target:"Array",proto:!0,forced:!YT||!qT},{concat:function(t){var e,n,o,c,u,d=ce(this),p=Xh(d,0),f=0;for(e=-1,o=arguments.length;e<o;e++)if(JT(u=e===-1?d:arguments[e])){if(f+(c=Xr(u.length))>Bm)throw TypeError(Lm);for(n=0;n<c;n++,f++)n in u&&Dr(p,f,u[n])}else{if(f>=Bm)throw TypeError(Lm);Dr(p,f++,u)}return p.length=f,p}});var vr=function(t){return le[t+"Prototype"]},zT=vr("Array").concat,Mm=Array.prototype,M=function(t){var e=t.concat;return t===Mm||t instanceof Array&&e===Mm.concat?zT:e},XT=Br("match"),Zh=function(t){if(function(e){var n;return K(e)&&((n=e[XT])!==void 0?!!n:P(e)=="RegExp")}(t))throw TypeError("The method doesn't accept regular expressions");return t},ZT=Br("match"),$h=function(t){var e=/./;try{"/./"[t](e)}catch{try{return e[ZT]=!1,"/./"[t](e)}catch{}}return!1},Pm="".endsWith,$T=Math.min,tR=$h("endsWith");jt({target:"String",proto:!0,forced:!tR},{endsWith:function(t){var e=String($(this));Zh(t);var n=arguments.length>1?arguments[1]:void 0,o=Xr(e.length),c=n===void 0?o:$T(Xr(n),o),u=String(t);return Pm?Pm.call(e,u,c):e.slice(c-u.length,c)===u}});var wu,el,bu,eR=vr("String").endsWith,xm=String.prototype,Um=function(t){var e=t.endsWith;return typeof t=="string"||t===xm||t instanceof String&&e===xm.endsWith?eR:e},rs={},rR=Ji("native-function-to-string",Function.toString),Qm=h.WeakMap,Fm=typeof Qm=="function"&&/native code/.test(rR.call(Qm)),Vm=Ji("keys"),Nu=function(t){return Vm[t]||(Vm[t]=es(t))},nR=h.WeakMap;if(Fm){var Xa=new nR,iR=Xa.get,oR=Xa.has,sR=Xa.set;wu=function(t,e){return sR.call(Xa,t,e),e},el=function(t){return iR.call(Xa,t)||{}},bu=function(t){return oR.call(Xa,t)}}else{var rl=Nu("state");vo[rl]=!0,wu=function(t,e){return yr(t,rl,e),e},el=function(t){return ft(t,rl)?t[rl]:{}},bu=function(t){return ft(t,rl)}}var Lr={set:wu,get:el,has:bu,enforce:function(t){return bu(t)?el(t):wu(t,{})},getterFor:function(t){return function(e){var n;if(!K(e)||(n=el(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return n}}},Gm=!A(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),jm=Nu("IE_PROTO"),aR=Object.prototype,Za=Gm?Object.getPrototypeOf:function(t){return t=ce(t),ft(t,jm)?t[jm]:typeof t.constructor=="function"&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?aR:null};Br("iterator");var Ou,Km,Hm,Wm=!1;[].keys&&("next"in(Hm=[].keys())?(Km=Za(Za(Hm)))!==Object.prototype&&(Ou=Km):Wm=!0),Ou==null&&(Ou={});var tp={IteratorPrototype:Ou,BUGGY_SAFARI_ITERATORS:Wm},ep=En("document","documentElement"),Ym=Nu("IE_PROTO"),rp=function(){},ku=function(){var t,e=ne("iframe"),n=xo.length;for(e.style.display="none",ep.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),ku=t.F;n--;)delete ku.prototype[xo[n]];return ku()},ns=Object.create||function(t,e){var n;return t!==null?(rp.prototype=ar(t),n=new rp,rp.prototype=null,n[Ym]=t):n=ku(),e===void 0?n:Xo(n,e)};vo[Ym]=!0;var qm={};qm[Br("toStringTag")]="z";var np=String(qm)==="[object z]",cR=Br("toStringTag"),lR=P(function(){return arguments}())=="Arguments",da=np?P:function(t){var e,n,o;return t===void 0?"Undefined":t===null?"Null":typeof(n=function(c,u){try{return c[u]}catch{}}(e=Object(t),cR))=="string"?n:lR?P(e):(o=P(e))=="Object"&&typeof e.callee=="function"?"Arguments":o},uR=np?{}.toString:function(){return"[object "+da(this)+"]"},dR=kr.f,Jm=Br("toStringTag"),is=function(t,e,n,o){if(t){var c=n?t:t.prototype;ft(c,Jm)||dR(c,Jm,{configurable:!0,value:e}),o&&!np&&yr(c,"toString",uR)}},hR=tp.IteratorPrototype,pR=function(){return this},zm=function(t,e,n){var o=e+" Iterator";return t.prototype=ns(hR,{next:b(1,n)}),is(t,o,!1,!0),rs[o]=pR,t},Xm=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),e=n instanceof Array}catch{}return function(o,c){return ar(o),function(u){if(!K(u)&&u!==null)throw TypeError("Can't set "+String(u)+" as a prototype")}(c),e?t.call(o,c):o.__proto__=c,o}}():void 0),ss=function(t,e,n,o){o&&o.enumerable?t[e]=n:yr(t,e,n)},AR=tp.IteratorPrototype,Du=tp.BUGGY_SAFARI_ITERATORS,ip=Br("iterator"),Zm="keys",Bu="values",$m="entries",fR=function(){return this},op=function(t,e,n,o,c,u,d){zm(n,e,o);var p,f,g,E=function(L){if(L===c&&w)return w;if(!Du&&L in T)return T[L];switch(L){case Zm:case Bu:case $m:return function(){return new n(this,L)}}return function(){return new n(this)}},I=e+" Iterator",_=!1,T=t.prototype,R=T[ip]||T["@@iterator"]||c&&T[c],w=!Du&&R||E(c),k=e=="Array"&&T.entries||R;if(k&&(p=Za(k.call(new t)),AR!==Object.prototype&&p.next&&(is(p,I,!0,!0),rs[I]=fR)),c==Bu&&R&&R.name!==Bu&&(_=!0,w=function(){return R.call(this)}),d&&T[ip]!==w&&yr(T,ip,w),rs[e]=w,c)if(f={values:E(Bu),keys:u?w:E(Zm),entries:E($m)},d)for(g in f)(Du||_||!(g in T))&&ss(T,g,f[g]);else jt({target:e,proto:!0,forced:Du||_},f);return f},tE="Array Iterator",gR=Lr.set,mR=Lr.getterFor(tE);op(Array,"Array",function(t,e){gR(this,{type:tE,target:X(t),index:0,kind:e})},function(){var t=mR(this),e=t.target,n=t.kind,o=t.index++;return!e||o>=e.length?(t.target=void 0,{value:void 0,done:!0}):n=="keys"?{value:o,done:!1}:n=="values"?{value:e[o],done:!1}:{value:[o,e[o]],done:!1}},"values"),rs.Arguments=rs.Array;var eE=Br("toStringTag");for(var sp in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}){var rE=h[sp],ap=rE&&rE.prototype;ap&&!ap[eE]&&yr(ap,eE,sp),rs[sp]=rs.Array}var ER=[].push,ha=function(t){var e=t==1,n=t==2,o=t==3,c=t==4,u=t==6,d=t==5||u;return function(p,f,g,E){for(var I,_,T=ce(p),R=W(T),w=Kn(f,g,3),k=Xr(R.length),L=0,Y=E||Xh,Z=e?Y(p,k):n?Y(p,0):void 0;k>L;L++)if((d||L in R)&&(_=w(I=R[L],L,T),t)){if(e)Z[L]=_;else if(_)switch(t){case 3:return!0;case 5:return I;case 6:return L;case 2:ER.call(Z,I)}else if(c)return!1}return u?-1:o||c?c:Z}},_o={forEach:ha(0),map:ha(1),filter:ha(2),some:ha(3),every:ha(4),find:ha(5),findIndex:ha(6)},pa=function(t,e){var n=[][t];return!n||!A(function(){n.call(null,e||function(){throw 1},1)})},vR=_o.forEach,nE=pa("forEach")?function(t){return vR(this,t,arguments.length>1?arguments[1]:void 0)}:[].forEach;jt({target:"Array",proto:!0,forced:[].forEach!=nE},{forEach:nE});var IR=vr("Array").forEach,iE=Array.prototype,CR={DOMTokenList:!0,NodeList:!0},G=function(t){var e=t.forEach;return t===iE||t instanceof Array&&e===iE.forEach||CR.hasOwnProperty(da(t))?IR:e},nl={f:Object.getOwnPropertySymbols},Lu=Object.assign,il=!Lu||A(function(){var t={},e={},n=Symbol(),o="abcdefghijklmnopqrst";return t[n]=7,o.split("").forEach(function(c){e[c]=c}),Lu({},t)[n]!=7||Hn(Lu({},e)).join("")!=o})?function(t,e){for(var n=ce(t),o=arguments.length,c=1,u=nl.f,d=S.f;o>c;)for(var p,f=W(arguments[c++]),g=u?Hn(f).concat(u(f)):Hn(f),E=g.length,I=0;E>I;)p=g[I++],m&&!d.call(f,p)||(n[p]=f[p]);return n}:Lu;jt({target:"Object",stat:!0,forced:Object.assign!==il},{assign:il});var Ir=le.Object.assign,oE=function(t){return function(e,n,o,c){Or(n);var u=ce(e),d=W(u),p=Xr(u.length),f=t?p-1:0,g=t?-1:1;if(o<2)for(;;){if(f in d){c=d[f],f+=g;break}if(f+=g,t?f<0:p<=f)throw TypeError("Reduce of empty array with no initial value")}for(;t?f>=0:p>f;f+=g)f in d&&(c=n(c,d[f],f,u));return c}},_R={left:oE(!1),right:oE(!0)}.left;jt({target:"Array",proto:!0,forced:pa("reduce")},{reduce:function(t){return _R(this,t,arguments.length,arguments.length>1?arguments[1]:void 0)}});var yR=vr("Array").reduce,sE=Array.prototype,ol=function(t){var e=t.reduce;return t===sE||t instanceof Array&&e===sE.reduce?yR:e};jt({target:"Object",stat:!0,forced:!m,sham:!m},{defineProperty:kr.f});var aE=a(function(t){var e=le.Object,n=t.exports=function(o,c,u){return e.defineProperty(o,c,u)};e.defineProperty.sham&&(n.sham=!0)}),te=aE,SR=A(function(){Hn(1)});jt({target:"Object",stat:!0,forced:SR},{keys:function(t){return Hn(ce(t))}});var ue=le.Object.keys,TR=!A(function(){return Object.isExtensible(Object.preventExtensions({}))}),Mu=a(function(t){var e=kr.f,n=es("meta"),o=0,c=Object.isExtensible||function(){return!0},u=function(p){e(p,n,{value:{objectID:"O"+ ++o,weakData:{}}})},d=t.exports={REQUIRED:!1,fastKey:function(p,f){if(!K(p))return typeof p=="symbol"?p:(typeof p=="string"?"S":"P")+p;if(!ft(p,n)){if(!c(p))return"F";if(!f)return"E";u(p)}return p[n].objectID},getWeakData:function(p,f){if(!ft(p,n)){if(!c(p))return!0;if(!f)return!1;u(p)}return p[n].weakData},onFreeze:function(p){return TR&&d.REQUIRED&&c(p)&&!ft(p,n)&&u(p),p}};vo[n]=!0}),RR=Br("iterator"),wR=Array.prototype,cE=function(t){return t!==void 0&&(rs.Array===t||wR[RR]===t)},bR=Br("iterator"),sl=function(t){if(t!=null)return t[bR]||t["@@iterator"]||rs[da(t)]},lE=function(t,e,n,o){try{return o?e(ar(n)[0],n[1]):e(n)}catch(u){var c=t.return;throw c!==void 0&&ar(c.call(t)),u}},Us=a(function(t){var e=function(n,o){this.stopped=n,this.result=o};(t.exports=function(n,o,c,u,d){var p,f,g,E,I,_,T,R=Kn(o,c,u?2:1);if(d)p=n;else{if(typeof(f=sl(n))!="function")throw TypeError("Target is not iterable");if(cE(f)){for(g=0,E=Xr(n.length);E>g;g++)if((I=u?R(ar(T=n[g])[0],T[1]):R(n[g]))&&I instanceof e)return I;return new e(!1)}p=f.call(n)}for(_=p.next;!(T=_.call(p)).done;)if(typeof(I=lE(p,R,T.value,u))=="object"&&I&&I instanceof e)return I;return new e(!1)}).stop=function(n){return new e(!0,n)}}),$a=function(t,e,n){if(!(t instanceof e))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return t},NR=kr.f,OR=_o.forEach,kR=Lr.set,DR=Lr.getterFor,uE=function(t,e,n){var o,c=t.indexOf("Map")!==-1,u=t.indexOf("Weak")!==-1,d=c?"set":"add",p=h[t],f=p&&p.prototype,g={};if(m&&typeof p=="function"&&(u||f.forEach&&!A(function(){new p().entries().next()}))){o=e(function(I,_){kR($a(I,o,t),{type:t,collection:new p}),_!=null&&Us(_,I[d],I,c)});var E=DR(t);OR(["add","clear","delete","forEach","get","has","set","keys","values","entries"],function(I){var _=I=="add"||I=="set";!(I in f)||u&&I=="clear"||yr(o.prototype,I,function(T,R){var w=E(this).collection;if(!_&&u&&!K(T))return I=="get"&&void 0;var k=w[I](T===0?0:T,R);return _?this:k})}),u||NR(o.prototype,"size",{configurable:!0,get:function(){return E(this).collection.size}})}else o=n.getConstructor(e,t,c,d),Mu.REQUIRED=!0;return is(o,t,!1,!0),g[t]=o,jt({global:!0,forced:!0},g),u||n.setStrong(o,t,c),o},Aa=function(t,e,n){for(var o in e)n&&n.unsafe&&t[o]?t[o]=e[o]:ss(t,o,e[o],n);return t},dE=Br("species"),hE=function(t){var e=En(t),n=kr.f;m&&e&&!e[dE]&&n(e,dE,{configurable:!0,get:function(){return this}})},BR=kr.f,pE=Mu.fastKey,AE=Lr.set,cp=Lr.getterFor;uE("Map",function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}},{getConstructor:function(t,e,n,o){var c=t(function(f,g){$a(f,c,e),AE(f,{type:e,index:ns(null),first:void 0,last:void 0,size:0}),m||(f.size=0),g!=null&&Us(g,f[o],f,n)}),u=cp(e),d=function(f,g,E){var I,_,T=u(f),R=p(f,g);return R?R.value=E:(T.last=R={index:_=pE(g,!0),key:g,value:E,previous:I=T.last,next:void 0,removed:!1},T.first||(T.first=R),I&&(I.next=R),m?T.size++:f.size++,_!=="F"&&(T.index[_]=R)),f},p=function(f,g){var E,I=u(f),_=pE(g);if(_!=="F")return I.index[_];for(E=I.first;E;E=E.next)if(E.key==g)return E};return Aa(c.prototype,{clear:function(){for(var f=u(this),g=f.index,E=f.first;E;)E.removed=!0,E.previous&&(E.previous=E.previous.next=void 0),delete g[E.index],E=E.next;f.first=f.last=void 0,m?f.size=0:this.size=0},delete:function(f){var g=this,E=u(g),I=p(g,f);if(I){var _=I.next,T=I.previous;delete E.index[I.index],I.removed=!0,T&&(T.next=_),_&&(_.previous=T),E.first==I&&(E.first=_),E.last==I&&(E.last=T),m?E.size--:g.size--}return!!I},forEach:function(f){for(var g,E=u(this),I=Kn(f,arguments.length>1?arguments[1]:void 0,3);g=g?g.next:E.first;)for(I(g.value,g.key,this);g&&g.removed;)g=g.previous},has:function(f){return!!p(this,f)}}),Aa(c.prototype,n?{get:function(f){var g=p(this,f);return g&&g.value},set:function(f,g){return d(this,f===0?0:f,g)}}:{add:function(f){return d(this,f=f===0?0:f,f)}}),m&&BR(c.prototype,"size",{get:function(){return u(this).size}}),c},setStrong:function(t,e,n){var o=e+" Iterator",c=cp(e),u=cp(o);op(t,e,function(d,p){AE(this,{type:o,target:d,state:c(d),kind:p,last:void 0})},function(){for(var d=u(this),p=d.kind,f=d.last;f&&f.removed;)f=f.previous;return d.target&&(d.last=f=f?f.next:d.state.first)?p=="keys"?{value:f.key,done:!1}:p=="values"?{value:f.value,done:!1}:{value:[f.key,f.value],done:!1}:(d.target=void 0,{value:void 0,done:!0})},n?"entries":"values",!n,!0),hE(e)}});var fE=function(t){return function(e,n){var o,c,u=String($(e)),d=ki(n),p=u.length;return d<0||d>=p?t?"":void 0:(o=u.charCodeAt(d))<55296||o>56319||d+1===p||(c=u.charCodeAt(d+1))<56320||c>57343?t?u.charAt(d):o:t?u.slice(d,d+2):c-56320+(o-55296<<10)+65536}},gE={codeAt:fE(!1),charAt:fE(!0)},LR=gE.charAt,mE="String Iterator",MR=Lr.set,PR=Lr.getterFor(mE);op(String,"String",function(t){MR(this,{type:mE,string:String(t),index:0})},function(){var t,e=PR(this),n=e.string,o=e.index;return o>=n.length?{value:void 0,done:!0}:(t=LR(n,o),e.index+=t.length,{value:t,done:!1})});var tr=le.Map,tc=`	
\v\f\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF`,Pu="["+tc+"]",xR=RegExp("^"+Pu+Pu+"*"),UR=RegExp(Pu+Pu+"*$"),lp=function(t){return function(e){var n=String($(e));return 1&t&&(n=n.replace(xR,"")),2&t&&(n=n.replace(UR,"")),n}},up={start:lp(1),end:lp(2),trim:lp(3)},QR=up.trim,xu=h.parseInt,FR=/^[+-]?0[Xx]/,EE=xu(tc+"08")!==8||xu(tc+"0x16")!==22?function(t,e){var n=QR(String(t));return xu(n,e>>>0||(FR.test(n)?16:10))}:xu;jt({global:!0,forced:parseInt!=EE},{parseInt:EE});var rr=le.parseInt;let vE=!0,IE=!0;function al(t,e,n){const o=t.match(e);return o&&o.length>=n&&rr(o[n],10)}function ec(t,e,n){if(!t.RTCPeerConnection)return;const o=t.RTCPeerConnection.prototype,c=o.addEventListener;o.addEventListener=function(d,p){if(d!==e)return c.apply(this,arguments);const f=g=>{const E=n(g);E&&(p.handleEvent?p.handleEvent(E):p(E))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new tr),this._eventMap[e].set(p,f),c.apply(this,[d,f])};const u=o.removeEventListener;o.removeEventListener=function(d,p){if(d!==e||!this._eventMap||!this._eventMap[e])return u.apply(this,arguments);if(!this._eventMap[e].has(p))return u.apply(this,arguments);const f=this._eventMap[e].get(p);return this._eventMap[e].delete(p),this._eventMap[e].size===0&&delete this._eventMap[e],ue(this._eventMap).length===0&&delete this._eventMap,u.apply(this,[d,f])},te(o,"on"+e,{get(){return this["_on"+e]},set(d){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),d&&this.addEventListener(e,this["_on"+e]=d)},enumerable:!0,configurable:!0})}function VR(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(vE=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function GR(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(IE=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function dp(){if(typeof window=="object"){if(vE)return;typeof console!="undefined"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Uu(t,e){IE&&console.warn(t+" is deprecated, please use "+e+" instead.")}function CE(t){return Object.prototype.toString.call(t)==="[object Object]"}function _E(t){var e;return CE(t)?ol(e=ue(t)).call(e,function(n,o){const c=CE(t[o]),u=c?_E(t[o]):t[o],d=c&&!ue(u).length;return u===void 0||d?n:Ir(n,{[o]:u})},{}):t}function yE(t,e,n){const o=n?"outbound-rtp":"inbound-rtp",c=new tr;if(e===null)return c;const u=[];return G(t).call(t,d=>{d.type==="track"&&d.trackIdentifier===e.id&&u.push(d)}),G(u).call(u,d=>{G(t).call(t,p=>{p.type===o&&p.trackId===d.id&&function f(g,E,I){var _;E&&!I.has(E.id)&&(I.set(E.id,E),G(_=ue(E)).call(_,T=>{if(Um(T).call(T,"Id"))f(g,g.get(E[T]),I);else if(Um(T).call(T,"Ids")){var R;G(R=E[T]).call(R,w=>{f(g,g.get(w),I)})}}))}(t,p,c)})}),c}var SE=qe.f,jR=A(function(){SE(1)});jt({target:"Object",stat:!0,forced:!m||jR,sham:!m},{getOwnPropertyDescriptor:function(t,e){return SE(X(t),e)}});var zt=a(function(t){var e=le.Object,n=t.exports=function(o,c){return e.getOwnPropertyDescriptor(o,c)};e.getOwnPropertyDescriptor.sham&&(n.sham=!0)}),KR=_o.filter;jt({target:"Array",proto:!0,forced:!tl("filter")},{filter:function(t){return KR(this,t,arguments.length>1?arguments[1]:void 0)}});var HR=vr("Array").filter,TE=Array.prototype,Ot=function(t){var e=t.filter;return t===TE||t instanceof Array&&e===TE.filter?HR:e},WR=h.Promise,RE=Br("iterator"),wE=!1;try{var YR=0,bE={next:function(){return{done:!!YR++}},return:function(){wE=!0}};bE[RE]=function(){return this},Array.from(bE,function(){throw 2})}catch{}var rc,NE,hp,OE=function(t,e){if(!e&&!wE)return!1;var n=!1;try{var o={};o[RE]=function(){return{next:function(){return{done:n=!0}}}},t(o)}catch{}return n},qR=Br("species"),kE=function(t,e){var n,o=ar(t).constructor;return o===void 0||(n=ar(o)[qR])==null?e:Or(n)},DE=/(iphone|ipod|ipad).*applewebkit/i.test(za),BE=h.location,pp=h.setImmediate,Ap=h.clearImmediate,LE=h.process,ME=h.MessageChannel,fp=h.Dispatch,gp=0,cl={},JR="onreadystatechange",mp=function(t){if(cl.hasOwnProperty(t)){var e=cl[t];delete cl[t],e()}},Ep=function(t){return function(){mp(t)}},PE=function(t){mp(t.data)},xE=function(t){h.postMessage(t+"",BE.protocol+"//"+BE.host)};pp&&Ap||(pp=function(t){for(var e=[],n=1;arguments.length>n;)e.push(arguments[n++]);return cl[++gp]=function(){(typeof t=="function"?t:Function(t)).apply(void 0,e)},rc(gp),gp},Ap=function(t){delete cl[t]},P(LE)=="process"?rc=function(t){LE.nextTick(Ep(t))}:fp&&fp.now?rc=function(t){fp.now(Ep(t))}:ME&&!DE?(hp=(NE=new ME).port2,NE.port1.onmessage=PE,rc=Kn(hp.postMessage,hp,1)):!h.addEventListener||typeof postMessage!="function"||h.importScripts||A(xE)?rc=JR in ne("script")?function(t){ep.appendChild(ne("script")).onreadystatechange=function(){ep.removeChild(this),mp(t)}}:function(t){setTimeout(Ep(t),0)}:(rc=xE,h.addEventListener("message",PE,!1)));var ll,fa,ul,nc,vp,Ip,Cp,UE,QE={set:pp,clear:Ap},zR=qe.f,XR=QE.set,FE=h.MutationObserver||h.WebKitMutationObserver,_p=h.process,yp=h.Promise,VE=P(_p)=="process",GE=zR(h,"queueMicrotask"),jE=GE&&GE.value;jE||(ll=function(){var t,e;for(VE&&(t=_p.domain)&&t.exit();fa;){e=fa.fn,fa=fa.next;try{e()}catch(n){throw fa?nc():ul=void 0,n}}ul=void 0,t&&t.enter()},VE?nc=function(){_p.nextTick(ll)}:FE&&!DE?(vp=!0,Ip=document.createTextNode(""),new FE(ll).observe(Ip,{characterData:!0}),nc=function(){Ip.data=vp=!vp}):yp&&yp.resolve?(Cp=yp.resolve(void 0),UE=Cp.then,nc=function(){UE.call(Cp,ll)}):nc=function(){XR.call(h,ll)});var KE=jE||function(t){var e={fn:t,next:void 0};ul&&(ul.next=e),fa||(fa=e,nc()),ul=e},ZR=function(t){var e,n;this.promise=new t(function(o,c){if(e!==void 0||n!==void 0)throw TypeError("Bad Promise constructor");e=o,n=c}),this.resolve=Or(e),this.reject=Or(n)},ic={f:function(t){return new ZR(t)}},Sp=function(t,e){if(ar(t),K(e)&&e.constructor===t)return e;var n=ic.f(t);return(0,n.resolve)(e),n.promise},oc=function(t){try{return{error:!1,value:t()}}catch(e){return{error:!0,value:e}}},HE=QE.set,$R=Br("species"),Uo="Promise",WE=Lr.get,tw=Lr.set,ew=Lr.getterFor(Uo),mi=WR,YE=h.TypeError,Tp=h.document,Qu=h.process,rw=Ji("inspectSource");En("fetch");var Rp,qE,wp,sc=ic.f,nw=sc,dl=P(Qu)=="process",iw=!!(Tp&&Tp.createEvent&&h.dispatchEvent),JE="unhandledrejection",Fu=zr(Uo,function(){if(rw(mi)===String(mi)&&(Ru===66||!dl&&typeof PromiseRejectionEvent!="function")||!mi.prototype.finally)return!0;if(Ru>=51&&/native code/.test(mi))return!1;var t=mi.resolve(1),e=function(n){n(function(){},function(){})};return(t.constructor={})[$R]=e,!(t.then(function(){})instanceof e)}),ow=Fu||!OE(function(t){mi.all(t).catch(function(){})}),zE=function(t){var e;return!(!K(t)||typeof(e=t.then)!="function")&&e},bp=function(t,e,n){if(!e.notified){e.notified=!0;var o=e.reactions;KE(function(){for(var c=e.value,u=e.state==1,d=0;o.length>d;){var p,f,g,E=o[d++],I=u?E.ok:E.fail,_=E.resolve,T=E.reject,R=E.domain;try{I?(u||(e.rejection===2&&aw(t,e),e.rejection=1),I===!0?p=c:(R&&R.enter(),p=I(c),R&&(R.exit(),g=!0)),p===E.promise?T(YE("Promise-chain cycle")):(f=zE(p))?f.call(p,_,T):_(p)):T(c)}catch(w){R&&!g&&R.exit(),T(w)}}e.reactions=[],e.notified=!1,n&&!e.rejection&&sw(t,e)})}},XE=function(t,e,n){var o,c;iw?((o=Tp.createEvent("Event")).promise=e,o.reason=n,o.initEvent(t,!1,!0),h.dispatchEvent(o)):o={promise:e,reason:n},(c=h["on"+t])?c(o):t===JE&&function(u,d){var p=h.console;p&&p.error&&(arguments.length===1?p.error(u):p.error(u,d))}("Unhandled promise rejection",n)},sw=function(t,e){HE.call(h,function(){var n,o=e.value;if(ZE(e)&&(n=oc(function(){dl?Qu.emit("unhandledRejection",o,t):XE(JE,t,o)}),e.rejection=dl||ZE(e)?2:1,n.error))throw n.value})},ZE=function(t){return t.rejection!==1&&!t.parent},aw=function(t,e){HE.call(h,function(){dl?Qu.emit("rejectionHandled",t):XE("rejectionhandled",t,e.value)})},ac=function(t,e,n,o){return function(c){t(e,n,c,o)}},cc=function(t,e,n,o){e.done||(e.done=!0,o&&(e=o),e.value=n,e.state=2,bp(t,e,!0))},Np=function(t,e,n,o){if(!e.done){e.done=!0,o&&(e=o);try{if(t===n)throw YE("Promise can't be resolved itself");var c=zE(n);c?KE(function(){var u={done:!1};try{c.call(n,ac(Np,t,u,e),ac(cc,t,u,e))}catch(d){cc(t,u,d,e)}}):(e.value=n,e.state=1,bp(t,e,!1))}catch(u){cc(t,{done:!1},u,e)}}};Fu&&(mi=function(t){$a(this,mi,Uo),Or(t),Rp.call(this);var e=WE(this);try{t(ac(Np,this,e),ac(cc,this,e))}catch(n){cc(this,e,n)}},(Rp=function(t){tw(this,{type:Uo,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=Aa(mi.prototype,{then:function(t,e){var n=ew(this),o=sc(kE(this,mi));return o.ok=typeof t!="function"||t,o.fail=typeof e=="function"&&e,o.domain=dl?Qu.domain:void 0,n.parent=!0,n.reactions.push(o),n.state!=0&&bp(this,n,!1),o.promise},catch:function(t){return this.then(void 0,t)}}),qE=function(){var t=new Rp,e=WE(t);this.promise=t,this.resolve=ac(Np,t,e),this.reject=ac(cc,t,e)},ic.f=sc=function(t){return t===mi||t===wp?new qE(t):nw(t)}),jt({global:!0,wrap:!0,forced:Fu},{Promise:mi}),is(mi,Uo,!1,!0),hE(Uo),wp=En(Uo),jt({target:Uo,stat:!0,forced:Fu},{reject:function(t){var e=sc(this);return e.reject.call(void 0,t),e.promise}}),jt({target:Uo,stat:!0,forced:!0},{resolve:function(t){return Sp(this===wp?mi:this,t)}}),jt({target:Uo,stat:!0,forced:ow},{all:function(t){var e=this,n=sc(e),o=n.resolve,c=n.reject,u=oc(function(){var d=Or(e.resolve),p=[],f=0,g=1;Us(t,function(E){var I=f++,_=!1;p.push(void 0),g++,d.call(e,E).then(function(T){_||(_=!0,p[I]=T,--g||o(p))},c)}),--g||o(p)});return u.error&&c(u.value),n.promise},race:function(t){var e=this,n=sc(e),o=n.reject,c=oc(function(){var u=Or(e.resolve);Us(t,function(d){u.call(e,d).then(n.resolve,o)})});return c.error&&o(c.value),n.promise}}),jt({target:"Promise",stat:!0},{allSettled:function(t){var e=this,n=ic.f(e),o=n.resolve,c=n.reject,u=oc(function(){var d=Or(e.resolve),p=[],f=0,g=1;Us(t,function(E){var I=f++,_=!1;p.push(void 0),g++,d.call(e,E).then(function(T){_||(_=!0,p[I]={status:"fulfilled",value:T},--g||o(p))},function(T){_||(_=!0,p[I]={status:"rejected",reason:T},--g||o(p))})}),--g||o(p)});return u.error&&c(u.value),n.promise}}),jt({target:"Promise",proto:!0,real:!0},{finally:function(t){var e=kE(this,En("Promise")),n=typeof t=="function";return this.then(n?function(o){return Sp(e,t()).then(function(){return o})}:t,n?function(o){return Sp(e,t()).then(function(){throw o})}:t)}});var $E=le.Promise,ct=$E,cw=_o.map;jt({target:"Array",proto:!0,forced:!tl("map")},{map:function(t){return cw(this,t,arguments.length>1?arguments[1]:void 0)}});var lw=vr("Array").map,tv=Array.prototype,ht=function(t){var e=t.map;return t===tv||t instanceof Array&&e===tv.map?lw:e},uw=Math.max,dw=Math.min,hw=9007199254740991,pw="Maximum allowed length exceeded";jt({target:"Array",proto:!0,forced:!tl("splice")},{splice:function(t,e){var n,o,c,u,d,p,f=ce(this),g=Xr(f.length),E=Di(t,g),I=arguments.length;if(I===0?n=o=0:I===1?(n=0,o=g-E):(n=I-2,o=dw(uw(ki(e),0),g-E)),g+n-o>hw)throw TypeError(pw);for(c=Xh(f,o),u=0;u<o;u++)(d=E+u)in f&&Dr(c,u,f[d]);if(c.length=o,n<o){for(u=E;u<g-o;u++)p=u+n,(d=u+o)in f?f[p]=f[d]:delete f[p];for(u=g;u>g-o+n;u--)delete f[u-1]}else if(n>o)for(u=g-o;u>E;u--)p=u+n-1,(d=u+o-1)in f?f[p]=f[d]:delete f[p];for(u=0;u<n;u++)f[u+E]=arguments[u+2];return f.length=g-o+n,c}});var Aw=vr("Array").splice,ev=Array.prototype,Ze=function(t){var e=t.splice;return t===ev||t instanceof Array&&e===ev.splice?Aw:e},fw=Ms.indexOf,rv=[].indexOf,nv=!!rv&&1/[1].indexOf(1,-0)<0,gw=pa("indexOf");jt({target:"Array",proto:!0,forced:nv||gw},{indexOf:function(t){return nv?rv.apply(this,arguments)||0:fw(this,t,arguments.length>1?arguments[1]:void 0)}});var mw=vr("Array").indexOf,iv=Array.prototype,Ft=function(t){var e=t.indexOf;return t===iv||t instanceof Array&&e===iv.indexOf?mw:e},Ew=Br("species"),vw=[].slice,Iw=Math.max;jt({target:"Array",proto:!0,forced:!tl("slice")},{slice:function(t,e){var n,o,c,u=X(this),d=Xr(u.length),p=Di(t,d),f=Di(e===void 0?d:e,d);if(Me(u)&&(typeof(n=u.constructor)!="function"||n!==Array&&!Me(n.prototype)?K(n)&&(n=n[Ew])===null&&(n=void 0):n=void 0,n===Array||n===void 0))return vw.call(u,p,f);for(o=new(n===void 0?Array:n)(Iw(f-p,0)),c=0;p<f;p++,c++)p in u&&Dr(o,c,u[p]);return o.length=c,o}});var Cw=vr("Array").slice,ov=Array.prototype,Mr=function(t){var e=t.slice;return t===ov||t instanceof Array&&e===ov.slice?Cw:e},_w=_o.find,yw="find",sv=!0;yw in[]&&Array(1).find(function(){sv=!1}),jt({target:"Array",proto:!0,forced:sv},{find:function(t){return _w(this,t,arguments.length>1?arguments[1]:void 0)}});var Sw=vr("Array").find,av=Array.prototype,yt=function(t){var e=t.find;return t===av||t instanceof Array&&e===av.find?Sw:e},cv=[].slice,Op={},Tw=function(t,e,n){if(!(e in Op)){for(var o=[],c=0;c<e;c++)o[c]="a["+c+"]";Op[e]=Function("C,a","return new C("+o.join(",")+")")}return Op[e](t,n)},Rw=Function.bind||function(t){var e=Or(this),n=cv.call(arguments,1),o=function(){var c=n.concat(cv.call(arguments));return this instanceof o?Tw(e,c.length,c):e.apply(t,c)};return K(e.prototype)&&(o.prototype=e.prototype),o};jt({target:"Function",proto:!0},{bind:Rw});var ww=vr("Function").bind,lv=Function.prototype,vn=function(t){var e=t.bind;return t===lv||t instanceof Function&&e===lv.bind?ww:e},bw=Ms.includes;jt({target:"Array",proto:!0},{includes:function(t){return bw(this,t,arguments.length>1?arguments[1]:void 0)}});var Nw=vr("Array").includes;jt({target:"String",proto:!0,forced:!$h("includes")},{includes:function(t){return!!~String($(this)).indexOf(Zh(t),arguments.length>1?arguments[1]:void 0)}});var Ow=vr("String").includes,uv=Array.prototype,dv=String.prototype,Xt=function(t){var e=t.includes;return t===uv||t instanceof Array&&e===uv.includes?Nw:typeof t=="string"||t===dv||t instanceof String&&e===dv.includes?Ow:e},kw=_o.some;jt({target:"Array",proto:!0,forced:pa("some")},{some:function(t){return kw(this,t,arguments.length>1?arguments[1]:void 0)}});var Dw=vr("Array").some,hv=Array.prototype,Bi=function(t){var e=t.some;return t===hv||t instanceof Array&&e===hv.some?Dw:e};const pv=dp;function Av(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const o=function(f){var g;if(typeof f!="object"||f.mandatory||f.optional)return f;const E={};var I;return G(g=ue(f)).call(g,_=>{if(_==="require"||_==="advanced"||_==="mediaSource")return;const T=typeof f[_]=="object"?f[_]:{ideal:f[_]};T.exact!==void 0&&typeof T.exact=="number"&&(T.min=T.max=T.exact);const R=function(k,L){return k?k+L.charAt(0).toUpperCase()+Mr(L).call(L,1):L==="deviceId"?"sourceId":L};if(T.ideal!==void 0){E.optional=E.optional||[];let k={};typeof T.ideal=="number"?(k[R("min",_)]=T.ideal,E.optional.push(k),k={},k[R("max",_)]=T.ideal,E.optional.push(k)):(k[R("",_)]=T.ideal,E.optional.push(k))}var w;T.exact!==void 0&&typeof T.exact!="number"?(E.mandatory=E.mandatory||{},E.mandatory[R("",_)]=T.exact):G(w=["min","max"]).call(w,k=>{T[k]!==void 0&&(E.mandatory=E.mandatory||{},E.mandatory[R(k,_)]=T[k])})}),f.advanced&&(E.optional=M(I=E.optional||[]).call(I,f.advanced)),E},c=function(f,g){if(e.version>=61)return g(f);if((f=JSON.parse(at(f)))&&typeof f.audio=="object"){const E=function(I,_,T){_ in I&&!(T in I)&&(I[T]=I[_],delete I[_])};E((f=JSON.parse(at(f))).audio,"autoGainControl","googAutoGainControl"),E(f.audio,"noiseSuppression","googNoiseSuppression"),f.audio=o(f.audio)}if(f&&typeof f.video=="object"){let E=f.video.facingMode;E=E&&(typeof E=="object"?E:{ideal:E});const I=e.version<66;if(E&&(E.exact==="user"||E.exact==="environment"||E.ideal==="user"||E.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||I)){let _;if(delete f.video.facingMode,E.exact==="environment"||E.ideal==="environment"?_=["back","rear"]:E.exact!=="user"&&E.ideal!=="user"||(_=["front"]),_)return n.mediaDevices.enumerateDevices().then(T=>{T=Ot(T).call(T,w=>w.kind==="videoinput");let R=yt(T).call(T,w=>Bi(_).call(_,k=>{var L;return Xt(L=w.label.toLowerCase()).call(L,k)}));return!R&&T.length&&Xt(_).call(_,"back")&&(R=T[T.length-1]),R&&(f.video.deviceId=E.exact?{exact:R.deviceId}:{ideal:R.deviceId}),f.video=o(f.video),pv("chrome: "+at(f)),g(f)})}f.video=o(f.video)}return pv("chrome: "+at(f)),g(f)},u=function(f){return e.version>=64?f:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[f.name]||f.name,message:f.message,constraint:f.constraint||f.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},d=function(f,g,E){c(f,I=>{n.webkitGetUserMedia(I,g,_=>{E&&E(u(_))})})};if(n.getUserMedia=vn(d).call(d,n),n.mediaDevices.getUserMedia){var p;const f=vn(p=n.mediaDevices.getUserMedia).call(p,n.mediaDevices);n.mediaDevices.getUserMedia=function(g){return c(g,E=>f(E).then(I=>{var _;if(E.audio&&!I.getAudioTracks().length||E.video&&!I.getVideoTracks().length)throw G(_=I.getTracks()).call(_,T=>{T.stop()}),new DOMException("","NotFoundError");return I},I=>ct.reject(u(I))))}}}function fv(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function gv(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){te(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{var o;n.stream.addEventListener("addtrack",c=>{let u;var d;t.RTCPeerConnection.prototype.getReceivers?u=yt(d=this.getReceivers()).call(d,f=>f.track&&f.track.id===c.track.id):u={track:c.track};const p=new Event("track");p.track=c.track,p.receiver=u,p.transceiver={receiver:u},p.streams=[n.stream],this.dispatchEvent(p)}),G(o=n.stream.getTracks()).call(o,c=>{let u;var d;t.RTCPeerConnection.prototype.getReceivers?u=yt(d=this.getReceivers()).call(d,f=>f.track&&f.track.id===c.id):u={track:c};const p=new Event("track");p.track=c,p.receiver=u,p.transceiver={receiver:u},p.streams=[n.stream],this.dispatchEvent(p)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else ec(t,"track",e=>(e.transceiver||te(e,"transceiver",{value:{receiver:e.receiver}}),e))}function mv(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(c,u){return{track:u,get dtmf(){return this._dtmf===void 0&&(u.kind==="audio"?this._dtmf=c.createDTMFSender(u):this._dtmf=null),this._dtmf},_pc:c}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){var d;return this._senders=this._senders||[],Mr(d=this._senders).call(d)};const c=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(d,p){let f=c.apply(this,arguments);return f||(f=e(this,d),this._senders.push(f)),f};const u=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(d){var p;u.apply(this,arguments);const f=Ft(p=this._senders).call(p,d);var g;f!==-1&&Ze(g=this._senders).call(g,f,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(c){var u;this._senders=this._senders||[],n.apply(this,[c]),G(u=c.getTracks()).call(u,d=>{this._senders.push(e(this,d))})};const o=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(c){var u;this._senders=this._senders||[],o.apply(this,[c]),G(u=c.getTracks()).call(u,d=>{var p;const f=yt(p=this._senders).call(p,I=>I.track===d);var g,E;f&&Ze(g=this._senders).call(g,Ft(E=this._senders).call(E,f),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const n=e.apply(this,[]);return G(n).call(n,o=>o._pc=this),n},te(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Ev(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[n,o,c]=arguments;if(arguments.length>0&&typeof n=="function")return e.apply(this,arguments);if(e.length===0&&(arguments.length===0||typeof n!="function"))return e.apply(this,[]);const u=function(p){const f={},g=p.result();return G(g).call(g,E=>{var I;const _={id:E.id,timestamp:E.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[E.type]||E.type};G(I=E.names()).call(I,T=>{_[T]=E.stat(T)}),f[_.id]=_}),f},d=function(p){var f;return new tr(ht(f=ue(p)).call(f,g=>[g,p[g]]))};if(arguments.length>=2){const p=function(f){o(d(u(f)))};return e.apply(this,[p,n])}return new ct((p,f)=>{e.apply(this,[function(g){p(d(u(g)))},f])}).then(o,c)}}function vv(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const c=n.apply(this,[]);return G(c).call(c,u=>u._pc=this),c});const o=t.RTCPeerConnection.prototype.addTrack;o&&(t.RTCPeerConnection.prototype.addTrack=function(){const c=o.apply(this,arguments);return c._pc=this,c}),t.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then(u=>yE(u,c.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const o=n.apply(this,[]);return G(o).call(o,c=>c._pc=this),o}),ec(t,"track",o=>(o.receiver._pc=o.srcElement,o)),t.RTCRtpReceiver.prototype.getStats=function(){const o=this;return this._pc.getStats().then(c=>yE(c,o.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype)||!("getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){var n,o;const c=arguments[0];let u,d,p;return G(n=this.getSenders()).call(n,f=>{f.track===c&&(u?p=!0:u=f)}),G(o=this.getReceivers()).call(o,f=>(f.track===c&&(d?p=!0:d=f),f.track===c)),p||u&&d?ct.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):u?u.getStats():d?d.getStats():ct.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function Iv(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){var u;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},ht(u=ue(this._shimmedLocalStreams)).call(u,d=>this._shimmedLocalStreams[d][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(u,d){var p;if(!d)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const f=e.apply(this,arguments);return this._shimmedLocalStreams[d.id]?Ft(p=this._shimmedLocalStreams[d.id]).call(p,f)===-1&&this._shimmedLocalStreams[d.id].push(f):this._shimmedLocalStreams[d.id]=[d,f],f};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){var d,p,f;this._shimmedLocalStreams=this._shimmedLocalStreams||{},G(d=u.getTracks()).call(d,I=>{var _;if(yt(_=this.getSenders()).call(_,T=>T.track===I))throw new DOMException("Track already exists.","InvalidAccessError")});const g=this.getSenders();n.apply(this,arguments);const E=Ot(p=this.getSenders()).call(p,I=>Ft(g).call(g,I)===-1);this._shimmedLocalStreams[u.id]=M(f=[u]).call(f,E)};const o=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[u.id],o.apply(this,arguments)};const c=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(u){var d;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},u&&G(d=ue(this._shimmedLocalStreams)).call(d,p=>{var f;const g=Ft(f=this._shimmedLocalStreams[p]).call(f,u);var E;g!==-1&&Ze(E=this._shimmedLocalStreams[p]).call(E,g,1),this._shimmedLocalStreams[p].length===1&&delete this._shimmedLocalStreams[p]}),c.apply(this,arguments)}}function Cv(t,e){var n;if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return Iv(t);const o=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const E=o.apply(this);return this._reverseStreams=this._reverseStreams||{},ht(E).call(E,I=>this._reverseStreams[I.id])};const c=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(E){var I;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},G(I=E.getTracks()).call(I,_=>{var T;if(yt(T=this.getSenders()).call(T,R=>R.track===_))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[E.id]){const _=new t.MediaStream(E.getTracks());this._streams[E.id]=_,this._reverseStreams[_.id]=E,E=_}c.apply(this,[E])};const u=t.RTCPeerConnection.prototype.removeStream;function d(E,I){var _;let T=I.sdp;return G(_=ue(E._reverseStreams||[])).call(_,R=>{const w=E._reverseStreams[R],k=E._streams[w.id];T=T.replace(new RegExp(k.id,"g"),w.id)}),new RTCSessionDescription({type:I.type,sdp:T})}function p(E,I){var _;let T=I.sdp;return G(_=ue(E._reverseStreams||[])).call(_,R=>{const w=E._reverseStreams[R],k=E._streams[w.id];T=T.replace(new RegExp(w.id,"g"),k.id)}),new RTCSessionDescription({type:I.type,sdp:T})}t.RTCPeerConnection.prototype.removeStream=function(E){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.apply(this,[this._streams[E.id]||E]),delete this._reverseStreams[this._streams[E.id]?this._streams[E.id].id:E.id],delete this._streams[E.id]},t.RTCPeerConnection.prototype.addTrack=function(E,I){var _,T,R;if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const w=Mr([]).call(arguments,1);if(w.length!==1||!yt(_=w[0].getTracks()).call(_,Y=>Y===E))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(yt(T=this.getSenders()).call(T,Y=>Y.track===E))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const L=this._streams[I.id];if(L)L.addTrack(E),ct.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const Y=new t.MediaStream([E]);this._streams[I.id]=Y,this._reverseStreams[Y.id]=I,this.addStream(Y)}return yt(R=this.getSenders()).call(R,Y=>Y.track===E)},G(n=["createOffer","createAnswer"]).call(n,function(E){const I=t.RTCPeerConnection.prototype[E],_={[E](){const T=arguments;return arguments.length&&typeof arguments[0]=="function"?I.apply(this,[R=>{const w=d(this,R);T[0].apply(null,[w])},R=>{T[1]&&T[1].apply(null,R)},arguments[2]]):I.apply(this,arguments).then(R=>d(this,R))}};t.RTCPeerConnection.prototype[E]=_[E]});const f=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=p(this,arguments[0]),f.apply(this,arguments)):f.apply(this,arguments)};const g=zt(t.RTCPeerConnection.prototype,"localDescription");te(t.RTCPeerConnection.prototype,"localDescription",{get(){const E=g.get.apply(this);return E.type===""?E:d(this,E)}}),t.RTCPeerConnection.prototype.removeTrack=function(E){var I;if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!E._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(E._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let _;this._streams=this._streams||{},G(I=ue(this._streams)).call(I,T=>{var R;yt(R=this._streams[T].getTracks()).call(R,w=>E.track===w)&&(_=this._streams[T])}),_&&(_.getTracks().length===1?this.removeStream(this._reverseStreams[_.id]):_.removeTrack(E.track),this.dispatchEvent(new Event("negotiationneeded")))}}function kp(t,e){var n;!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&G(n=["setLocalDescription","setRemoteDescription","addIceCandidate"]).call(n,function(o){const c=t.RTCPeerConnection.prototype[o],u={[o](){return arguments[0]=new(o==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),c.apply(this,arguments)}};t.RTCPeerConnection.prototype[o]=u[o]})}function _v(t,e){ec(t,"negotiationneeded",n=>{const o=n.target;if(!(e.version<72||o.getConfiguration&&o.getConfiguration().sdpSemantics==="plan-b")||o.signalingState==="stable")return n})}var yv=Object.freeze({__proto__:null,shimMediaStream:fv,shimOnTrack:gv,shimGetSendersWithDtmf:mv,shimGetStats:Ev,shimSenderReceiverGetStats:vv,shimAddTrackRemoveTrackWithNative:Iv,shimAddTrackRemoveTrack:Cv,shimPeerConnection:kp,fixNegotiationNeeded:_v,shimGetUserMedia:Av,shimGetDisplayMedia:function(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(typeof e=="function"?t.navigator.mediaDevices.getDisplayMedia=function(n){return e(n).then(o=>{const c=n.video&&n.video.width,u=n.video&&n.video.height,d=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:o,maxFrameRate:d||3}},c&&(n.video.mandatory.maxWidth=c),u&&(n.video.mandatory.maxHeight=u),t.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}}),Sv="".startsWith,Bw=Math.min,Lw=$h("startsWith");jt({target:"String",proto:!0,forced:!Lw},{startsWith:function(t){var e=String($(this));Zh(t);var n=Xr(Bw(arguments.length>1?arguments[1]:void 0,e.length)),o=String(t);return Sv?Sv.call(e,o,n):e.slice(n,n+o.length)===o}});var Mw=vr("String").startsWith,Tv=String.prototype,hl=function(t){var e=t.startsWith;return typeof t=="string"||t===Tv||t instanceof String&&e===Tv.startsWith?Mw:e},se=a(function(t){var e={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(function(o){return o.trim()})},e.splitSections=function(n){return n.split(`
m=`).map(function(o,c){return(c>0?"m="+o:o).trim()+`\r
`})},e.getDescription=function(n){var o=e.splitSections(n);return o&&o[0]},e.getMediaSections=function(n){var o=e.splitSections(n);return o.shift(),o},e.matchPrefix=function(n,o){return e.splitLines(n).filter(function(c){return c.indexOf(o)===0})},e.parseCandidate=function(n){for(var o,c={foundation:(o=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" "))[0],component:parseInt(o[1],10),protocol:o[2].toLowerCase(),priority:parseInt(o[3],10),ip:o[4],address:o[4],port:parseInt(o[5],10),type:o[7]},u=8;u<o.length;u+=2)switch(o[u]){case"raddr":c.relatedAddress=o[u+1];break;case"rport":c.relatedPort=parseInt(o[u+1],10);break;case"tcptype":c.tcpType=o[u+1];break;case"ufrag":c.ufrag=o[u+1],c.usernameFragment=o[u+1];break;default:c[o[u]]=o[u+1]}return c},e.writeCandidate=function(n){var o=[];o.push(n.foundation),o.push(n.component),o.push(n.protocol.toUpperCase()),o.push(n.priority),o.push(n.address||n.ip),o.push(n.port);var c=n.type;return o.push("typ"),o.push(c),c!=="host"&&n.relatedAddress&&n.relatedPort&&(o.push("raddr"),o.push(n.relatedAddress),o.push("rport"),o.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(o.push("tcptype"),o.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(o.push("ufrag"),o.push(n.usernameFragment||n.ufrag)),"candidate:"+o.join(" ")},e.parseIceOptions=function(n){return n.substr(14).split(" ")},e.parseRtpMap=function(n){var o=n.substr(9).split(" "),c={payloadType:parseInt(o.shift(),10)};return o=o[0].split("/"),c.name=o[0],c.clockRate=parseInt(o[1],10),c.channels=o.length===3?parseInt(o[2],10):1,c.numChannels=c.channels,c},e.writeRtpMap=function(n){var o=n.payloadType;n.preferredPayloadType!==void 0&&(o=n.preferredPayloadType);var c=n.channels||n.numChannels||1;return"a=rtpmap:"+o+" "+n.name+"/"+n.clockRate+(c!==1?"/"+c:"")+`\r
`},e.parseExtmap=function(n){var o=n.substr(9).split(" ");return{id:parseInt(o[0],10),direction:o[0].indexOf("/")>0?o[0].split("/")[1]:"sendrecv",uri:o[1]}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+`\r
`},e.parseFmtp=function(n){for(var o,c={},u=n.substr(n.indexOf(" ")+1).split(";"),d=0;d<u.length;d++)c[(o=u[d].trim().split("="))[0].trim()]=o[1];return c},e.writeFmtp=function(n){var o="",c=n.payloadType;if(n.preferredPayloadType!==void 0&&(c=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){var u=[];Object.keys(n.parameters).forEach(function(d){n.parameters[d]?u.push(d+"="+n.parameters[d]):u.push(d)}),o+="a=fmtp:"+c+" "+u.join(";")+`\r
`}return o},e.parseRtcpFb=function(n){var o=n.substr(n.indexOf(" ")+1).split(" ");return{type:o.shift(),parameter:o.join(" ")}},e.writeRtcpFb=function(n){var o="",c=n.payloadType;return n.preferredPayloadType!==void 0&&(c=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(function(u){o+="a=rtcp-fb:"+c+" "+u.type+(u.parameter&&u.parameter.length?" "+u.parameter:"")+`\r
`}),o},e.parseSsrcMedia=function(n){var o=n.indexOf(" "),c={ssrc:parseInt(n.substr(7,o-7),10)},u=n.indexOf(":",o);return u>-1?(c.attribute=n.substr(o+1,u-o-1),c.value=n.substr(u+1)):c.attribute=n.substr(o+1),c},e.parseSsrcGroup=function(n){var o=n.substr(13).split(" ");return{semantics:o.shift(),ssrcs:o.map(function(c){return parseInt(c,10)})}},e.getMid=function(n){var o=e.matchPrefix(n,"a=mid:")[0];if(o)return o.substr(6)},e.parseFingerprint=function(n){var o=n.substr(14).split(" ");return{algorithm:o[0].toLowerCase(),value:o[1]}},e.getDtlsParameters=function(n,o){return{role:"auto",fingerprints:e.matchPrefix(n+o,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,o){var c="a=setup:"+o+`\r
`;return n.fingerprints.forEach(function(u){c+="a=fingerprint:"+u.algorithm+" "+u.value+`\r
`}),c},e.getIceParameters=function(n,o){var c=e.splitLines(n);return{usernameFragment:(c=c.concat(e.splitLines(o))).filter(function(u){return u.indexOf("a=ice-ufrag:")===0})[0].substr(12),password:c.filter(function(u){return u.indexOf("a=ice-pwd:")===0})[0].substr(10)}},e.writeIceParameters=function(n){return"a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`},e.parseRtpParameters=function(n){for(var o={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=e.splitLines(n)[0].split(" "),u=3;u<c.length;u++){var d=c[u],p=e.matchPrefix(n,"a=rtpmap:"+d+" ")[0];if(p){var f=e.parseRtpMap(p),g=e.matchPrefix(n,"a=fmtp:"+d+" ");switch(f.parameters=g.length?e.parseFmtp(g[0]):{},f.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+d+" ").map(e.parseRtcpFb),o.codecs.push(f),f.name.toUpperCase()){case"RED":case"ULPFEC":o.fecMechanisms.push(f.name.toUpperCase())}}}return e.matchPrefix(n,"a=extmap:").forEach(function(E){o.headerExtensions.push(e.parseExtmap(E))}),o},e.writeRtpDescription=function(n,o){var c="";c+="m="+n+" ",c+=o.codecs.length>0?"9":"0",c+=" UDP/TLS/RTP/SAVPF ",c+=o.codecs.map(function(d){return d.preferredPayloadType!==void 0?d.preferredPayloadType:d.payloadType}).join(" ")+`\r
`,c+=`c=IN IP4 0.0.0.0\r
`,c+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,o.codecs.forEach(function(d){c+=e.writeRtpMap(d),c+=e.writeFmtp(d),c+=e.writeRtcpFb(d)});var u=0;return o.codecs.forEach(function(d){d.maxptime>u&&(u=d.maxptime)}),u>0&&(c+="a=maxptime:"+u+`\r
`),c+=`a=rtcp-mux\r
`,o.headerExtensions&&o.headerExtensions.forEach(function(d){c+=e.writeExtmap(d)}),c},e.parseRtpEncodingParameters=function(n){var o,c=[],u=e.parseRtpParameters(n),d=u.fecMechanisms.indexOf("RED")!==-1,p=u.fecMechanisms.indexOf("ULPFEC")!==-1,f=e.matchPrefix(n,"a=ssrc:").map(function(_){return e.parseSsrcMedia(_)}).filter(function(_){return _.attribute==="cname"}),g=f.length>0&&f[0].ssrc,E=e.matchPrefix(n,"a=ssrc-group:FID").map(function(_){return _.substr(17).split(" ").map(function(T){return parseInt(T,10)})});E.length>0&&E[0].length>1&&E[0][0]===g&&(o=E[0][1]),u.codecs.forEach(function(_){if(_.name.toUpperCase()==="RTX"&&_.parameters.apt){var T={ssrc:g,codecPayloadType:parseInt(_.parameters.apt,10)};g&&o&&(T.rtx={ssrc:o}),c.push(T),d&&((T=JSON.parse(JSON.stringify(T))).fec={ssrc:g,mechanism:p?"red+ulpfec":"red"},c.push(T))}}),c.length===0&&g&&c.push({ssrc:g});var I=e.matchPrefix(n,"b=");return I.length&&(I=I[0].indexOf("b=TIAS:")===0?parseInt(I[0].substr(7),10):I[0].indexOf("b=AS:")===0?1e3*parseInt(I[0].substr(5),10)*.95-16e3:void 0,c.forEach(function(_){_.maxBitrate=I})),c},e.parseRtcpParameters=function(n){var o={},c=e.matchPrefix(n,"a=ssrc:").map(function(p){return e.parseSsrcMedia(p)}).filter(function(p){return p.attribute==="cname"})[0];c&&(o.cname=c.value,o.ssrc=c.ssrc);var u=e.matchPrefix(n,"a=rtcp-rsize");o.reducedSize=u.length>0,o.compound=u.length===0;var d=e.matchPrefix(n,"a=rtcp-mux");return o.mux=d.length>0,o},e.parseMsid=function(n){var o,c=e.matchPrefix(n,"a=msid:");if(c.length===1)return{stream:(o=c[0].substr(7).split(" "))[0],track:o[1]};var u=e.matchPrefix(n,"a=ssrc:").map(function(d){return e.parseSsrcMedia(d)}).filter(function(d){return d.attribute==="msid"});return u.length>0?{stream:(o=u[0].value.split(" "))[0],track:o[1]}:void 0},e.generateSessionId=function(){return Math.random().toString().substr(2,21)},e.writeSessionBoilerplate=function(n,o,c){var u=o!==void 0?o:2;return`v=0\r
o=`+(c||"thisisadapterortc")+" "+(n||e.generateSessionId())+" "+u+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.writeMediaSection=function(n,o,c,u){var d=e.writeRtpDescription(n.kind,o);if(d+=e.writeIceParameters(n.iceGatherer.getLocalParameters()),d+=e.writeDtlsParameters(n.dtlsTransport.getLocalParameters(),c==="offer"?"actpass":"active"),d+="a=mid:"+n.mid+`\r
`,n.direction?d+="a="+n.direction+`\r
`:n.rtpSender&&n.rtpReceiver?d+=`a=sendrecv\r
`:n.rtpSender?d+=`a=sendonly\r
`:n.rtpReceiver?d+=`a=recvonly\r
`:d+=`a=inactive\r
`,n.rtpSender){var p="msid:"+u.id+" "+n.rtpSender.track.id+`\r
`;d+="a="+p,d+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" "+p,n.sendEncodingParameters[0].rtx&&(d+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" "+p,d+="a=ssrc-group:FID "+n.sendEncodingParameters[0].ssrc+" "+n.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return d+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" cname:"+e.localCName+`\r
`,n.rtpSender&&n.sendEncodingParameters[0].rtx&&(d+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" cname:"+e.localCName+`\r
`),d},e.getDirection=function(n,o){for(var c=e.splitLines(n),u=0;u<c.length;u++)switch(c[u]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[u].substr(2)}return o?e.getDirection(o):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substr(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){var o=e.splitLines(n)[0].substr(2).split(" ");return{kind:o[0],port:parseInt(o[1],10),protocol:o[2],fmt:o.slice(3).join(" ")}},e.parseOLine=function(n){var o=e.matchPrefix(n,"o=")[0].substr(2).split(" ");return{username:o[0],sessionId:o[1],sessionVersion:parseInt(o[2],10),netType:o[3],addressType:o[4],address:o[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;for(var o=e.splitLines(n),c=0;c<o.length;c++)if(o[c].length<2||o[c].charAt(1)!=="=")return!1;return!0},t.exports=e});function Rv(t,e,n,o,c){var u=se.writeRtpDescription(t.kind,e);if(u+=se.writeIceParameters(t.iceGatherer.getLocalParameters()),u+=se.writeDtlsParameters(t.dtlsTransport.getLocalParameters(),n==="offer"?"actpass":c||"active"),u+="a=mid:"+t.mid+`\r
`,t.rtpSender&&t.rtpReceiver?u+=`a=sendrecv\r
`:t.rtpSender?u+=`a=sendonly\r
`:t.rtpReceiver?u+=`a=recvonly\r
`:u+=`a=inactive\r
`,t.rtpSender){var d=t.rtpSender._initialTrackId||t.rtpSender.track.id;t.rtpSender._initialTrackId=d;var p="msid:"+(o?o.id:"-")+" "+d+`\r
`;u+="a="+p,u+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" "+p,t.sendEncodingParameters[0].rtx&&(u+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" "+p,u+="a=ssrc-group:FID "+t.sendEncodingParameters[0].ssrc+" "+t.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return u+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" cname:"+se.localCName+`\r
`,t.rtpSender&&t.sendEncodingParameters[0].rtx&&(u+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" cname:"+se.localCName+`\r
`),u}function Vu(t,e){var n={codecs:[],headerExtensions:[],fecMechanisms:[]},o=function(u,d){u=parseInt(u,10);for(var p=0;p<d.length;p++)if(d[p].payloadType===u||d[p].preferredPayloadType===u)return d[p]},c=function(u,d,p,f){var g=o(u.parameters.apt,p),E=o(d.parameters.apt,f);return g&&E&&g.name.toLowerCase()===E.name.toLowerCase()};return t.codecs.forEach(function(u){for(var d=0;d<e.codecs.length;d++){var p=e.codecs[d];if(u.name.toLowerCase()===p.name.toLowerCase()&&u.clockRate===p.clockRate){if(u.name.toLowerCase()==="rtx"&&u.parameters&&p.parameters.apt&&!c(u,p,t.codecs,e.codecs))continue;(p=JSON.parse(JSON.stringify(p))).numChannels=Math.min(u.numChannels,p.numChannels),n.codecs.push(p),p.rtcpFeedback=p.rtcpFeedback.filter(function(f){for(var g=0;g<u.rtcpFeedback.length;g++)if(u.rtcpFeedback[g].type===f.type&&u.rtcpFeedback[g].parameter===f.parameter)return!0;return!1});break}}}),t.headerExtensions.forEach(function(u){for(var d=0;d<e.headerExtensions.length;d++){var p=e.headerExtensions[d];if(u.uri===p.uri){n.headerExtensions.push(p);break}}}),n}function wv(t,e,n){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[e][t].indexOf(n)!==-1}function Dp(t,e){var n=t.getRemoteCandidates().find(function(o){return e.foundation===o.foundation&&e.ip===o.ip&&e.port===o.port&&e.priority===o.priority&&e.protocol===o.protocol&&e.type===o.type});return n||t.addRemoteCandidate(e),!n}function Wn(t,e){var n=new Error(e);return n.name=t,n.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[t],n}var Pw=function(t,e){function n(d,p){p.addTrack(d),p.dispatchEvent(new t.MediaStreamTrackEvent("addtrack",{track:d}))}function o(d,p,f,g){var E=new Event("track");E.track=p,E.receiver=f,E.transceiver={receiver:f},E.streams=g,t.setTimeout(function(){d._dispatchEvent("track",E)})}var c=function(d){var p=this,f=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(E){p[E]=f[E].bind(f)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",d=JSON.parse(JSON.stringify(d||{})),this.usingBundle=d.bundlePolicy==="max-bundle",d.rtcpMuxPolicy==="negotiate")throw Wn("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(d.rtcpMuxPolicy||(d.rtcpMuxPolicy="require"),d.iceTransportPolicy){case"all":case"relay":break;default:d.iceTransportPolicy="all"}switch(d.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:d.bundlePolicy="balanced"}if(d.iceServers=function(E,I){var _=!1;return(E=JSON.parse(JSON.stringify(E))).filter(function(T){if(T&&(T.urls||T.url)){var R=T.urls||T.url;T.url&&!T.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var w=typeof R=="string";return w&&(R=[R]),R=R.filter(function(k){return k.indexOf("turn:")!==0||k.indexOf("transport=udp")===-1||k.indexOf("turn:[")!==-1||_?k.indexOf("stun:")===0&&I>=14393&&k.indexOf("?transport=udp")===-1:(_=!0,!0)}),delete T.url,T.urls=w?R[0]:R,!!R.length}})}(d.iceServers||[],e),this._iceGatherers=[],d.iceCandidatePoolSize)for(var g=d.iceCandidatePoolSize;g>0;g--)this._iceGatherers.push(new t.RTCIceGatherer({iceServers:d.iceServers,gatherPolicy:d.iceTransportPolicy}));else d.iceCandidatePoolSize=0;this._config=d,this.transceivers=[],this._sdpSessionId=se.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(c.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(c.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),c.prototype.onicecandidate=null,c.prototype.onaddstream=null,c.prototype.ontrack=null,c.prototype.onremovestream=null,c.prototype.onsignalingstatechange=null,c.prototype.oniceconnectionstatechange=null,c.prototype.onconnectionstatechange=null,c.prototype.onicegatheringstatechange=null,c.prototype.onnegotiationneeded=null,c.prototype.ondatachannel=null,c.prototype._dispatchEvent=function(d,p){this._isClosed||(this.dispatchEvent(p),typeof this["on"+d]=="function"&&this["on"+d](p))},c.prototype._emitGatheringStateChange=function(){var d=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",d)},c.prototype.getConfiguration=function(){return this._config},c.prototype.getLocalStreams=function(){return this.localStreams},c.prototype.getRemoteStreams=function(){return this.remoteStreams},c.prototype._createTransceiver=function(d,p){var f=this.transceivers.length>0,g={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:d,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&f)g.iceTransport=this.transceivers[0].iceTransport,g.dtlsTransport=this.transceivers[0].dtlsTransport;else{var E=this._createIceAndDtlsTransports();g.iceTransport=E.iceTransport,g.dtlsTransport=E.dtlsTransport}return p||this.transceivers.push(g),g},c.prototype.addTrack=function(d,p){if(this._isClosed)throw Wn("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var f;if(this.transceivers.find(function(E){return E.track===d}))throw Wn("InvalidAccessError","Track already exists.");for(var g=0;g<this.transceivers.length;g++)this.transceivers[g].track||this.transceivers[g].kind!==d.kind||(f=this.transceivers[g]);return f||(f=this._createTransceiver(d.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(p)===-1&&this.localStreams.push(p),f.track=d,f.stream=p,f.rtpSender=new t.RTCRtpSender(d,f.dtlsTransport),f.rtpSender},c.prototype.addStream=function(d){var p=this;if(e>=15025)d.getTracks().forEach(function(g){p.addTrack(g,d)});else{var f=d.clone();d.getTracks().forEach(function(g,E){var I=f.getTracks()[E];g.addEventListener("enabled",function(_){I.enabled=_.enabled})}),f.getTracks().forEach(function(g){p.addTrack(g,f)})}},c.prototype.removeTrack=function(d){if(this._isClosed)throw Wn("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(d instanceof t.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var p=this.transceivers.find(function(g){return g.rtpSender===d});if(!p)throw Wn("InvalidAccessError","Sender was not created by this connection.");var f=p.stream;p.rtpSender.stop(),p.rtpSender=null,p.track=null,p.stream=null,this.transceivers.map(function(g){return g.stream}).indexOf(f)===-1&&this.localStreams.indexOf(f)>-1&&this.localStreams.splice(this.localStreams.indexOf(f),1),this._maybeFireNegotiationNeeded()},c.prototype.removeStream=function(d){var p=this;d.getTracks().forEach(function(f){var g=p.getSenders().find(function(E){return E.track===f});g&&p.removeTrack(g)})},c.prototype.getSenders=function(){return this.transceivers.filter(function(d){return!!d.rtpSender}).map(function(d){return d.rtpSender})},c.prototype.getReceivers=function(){return this.transceivers.filter(function(d){return!!d.rtpReceiver}).map(function(d){return d.rtpReceiver})},c.prototype._createIceGatherer=function(d,p){var f=this;if(p&&d>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var g=new t.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(g,"state",{value:"new",writable:!0}),this.transceivers[d].bufferedCandidateEvents=[],this.transceivers[d].bufferCandidates=function(E){var I=!E.candidate||Object.keys(E.candidate).length===0;g.state=I?"completed":"gathering",f.transceivers[d].bufferedCandidateEvents!==null&&f.transceivers[d].bufferedCandidateEvents.push(E)},g.addEventListener("localcandidate",this.transceivers[d].bufferCandidates),g},c.prototype._gather=function(d,p){var f=this,g=this.transceivers[p].iceGatherer;if(!g.onlocalcandidate){var E=this.transceivers[p].bufferedCandidateEvents;this.transceivers[p].bufferedCandidateEvents=null,g.removeEventListener("localcandidate",this.transceivers[p].bufferCandidates),g.onlocalcandidate=function(I){if(!(f.usingBundle&&p>0)){var _=new Event("icecandidate");_.candidate={sdpMid:d,sdpMLineIndex:p};var T=I.candidate,R=!T||Object.keys(T).length===0;if(R)g.state!=="new"&&g.state!=="gathering"||(g.state="completed");else{g.state==="new"&&(g.state="gathering"),T.component=1,T.ufrag=g.getLocalParameters().usernameFragment;var w=se.writeCandidate(T);_.candidate=Object.assign(_.candidate,se.parseCandidate(w)),_.candidate.candidate=w,_.candidate.toJSON=function(){return{candidate:_.candidate.candidate,sdpMid:_.candidate.sdpMid,sdpMLineIndex:_.candidate.sdpMLineIndex,usernameFragment:_.candidate.usernameFragment}}}var k=se.getMediaSections(f._localDescription.sdp);k[_.candidate.sdpMLineIndex]+=R?`a=end-of-candidates\r
`:"a="+_.candidate.candidate+`\r
`,f._localDescription.sdp=se.getDescription(f._localDescription.sdp)+k.join("");var L=f.transceivers.every(function(Y){return Y.iceGatherer&&Y.iceGatherer.state==="completed"});f.iceGatheringState!=="gathering"&&(f.iceGatheringState="gathering",f._emitGatheringStateChange()),R||f._dispatchEvent("icecandidate",_),L&&(f._dispatchEvent("icecandidate",new Event("icecandidate")),f.iceGatheringState="complete",f._emitGatheringStateChange())}},t.setTimeout(function(){E.forEach(function(I){g.onlocalcandidate(I)})},0)}},c.prototype._createIceAndDtlsTransports=function(){var d=this,p=new t.RTCIceTransport(null);p.onicestatechange=function(){d._updateIceConnectionState(),d._updateConnectionState()};var f=new t.RTCDtlsTransport(p);return f.ondtlsstatechange=function(){d._updateConnectionState()},f.onerror=function(){Object.defineProperty(f,"state",{value:"failed",writable:!0}),d._updateConnectionState()},{iceTransport:p,dtlsTransport:f}},c.prototype._disposeIceAndDtlsTransports=function(d){var p=this.transceivers[d].iceGatherer;p&&(delete p.onlocalcandidate,delete this.transceivers[d].iceGatherer);var f=this.transceivers[d].iceTransport;f&&(delete f.onicestatechange,delete this.transceivers[d].iceTransport);var g=this.transceivers[d].dtlsTransport;g&&(delete g.ondtlsstatechange,delete g.onerror,delete this.transceivers[d].dtlsTransport)},c.prototype._transceive=function(d,p,f){var g=Vu(d.localCapabilities,d.remoteCapabilities);p&&d.rtpSender&&(g.encodings=d.sendEncodingParameters,g.rtcp={cname:se.localCName,compound:d.rtcpParameters.compound},d.recvEncodingParameters.length&&(g.rtcp.ssrc=d.recvEncodingParameters[0].ssrc),d.rtpSender.send(g)),f&&d.rtpReceiver&&g.codecs.length>0&&(d.kind==="video"&&d.recvEncodingParameters&&e<15019&&d.recvEncodingParameters.forEach(function(E){delete E.rtx}),d.recvEncodingParameters.length?g.encodings=d.recvEncodingParameters:g.encodings=[{}],g.rtcp={compound:d.rtcpParameters.compound},d.rtcpParameters.cname&&(g.rtcp.cname=d.rtcpParameters.cname),d.sendEncodingParameters.length&&(g.rtcp.ssrc=d.sendEncodingParameters[0].ssrc),d.rtpReceiver.receive(g))},c.prototype.setLocalDescription=function(d){var p,f,g=this;if(["offer","answer"].indexOf(d.type)===-1)return Promise.reject(Wn("TypeError",'Unsupported type "'+d.type+'"'));if(!wv("setLocalDescription",d.type,g.signalingState)||g._isClosed)return Promise.reject(Wn("InvalidStateError","Can not set local "+d.type+" in state "+g.signalingState));if(d.type==="offer")p=se.splitSections(d.sdp),f=p.shift(),p.forEach(function(I,_){var T=se.parseRtpParameters(I);g.transceivers[_].localCapabilities=T}),g.transceivers.forEach(function(I,_){g._gather(I.mid,_)});else if(d.type==="answer"){p=se.splitSections(g._remoteDescription.sdp),f=p.shift();var E=se.matchPrefix(f,"a=ice-lite").length>0;p.forEach(function(I,_){var T=g.transceivers[_],R=T.iceGatherer,w=T.iceTransport,k=T.dtlsTransport,L=T.localCapabilities,Y=T.remoteCapabilities;if(!(se.isRejected(I)&&se.matchPrefix(I,"a=bundle-only").length===0)&&!T.rejected){var Z=se.getIceParameters(I,f),rt=se.getDtlsParameters(I,f);E&&(rt.role="server"),g.usingBundle&&_!==0||(g._gather(T.mid,_),w.state==="new"&&w.start(R,Z,E?"controlling":"controlled"),k.state==="new"&&k.start(rt));var ut=Vu(L,Y);g._transceive(T,ut.codecs.length>0,!1)}})}return g._localDescription={type:d.type,sdp:d.sdp},d.type==="offer"?g._updateSignalingState("have-local-offer"):g._updateSignalingState("stable"),Promise.resolve()},c.prototype.setRemoteDescription=function(d){var p=this;if(["offer","answer"].indexOf(d.type)===-1)return Promise.reject(Wn("TypeError",'Unsupported type "'+d.type+'"'));if(!wv("setRemoteDescription",d.type,p.signalingState)||p._isClosed)return Promise.reject(Wn("InvalidStateError","Can not set remote "+d.type+" in state "+p.signalingState));var f={};p.remoteStreams.forEach(function(w){f[w.id]=w});var g=[],E=se.splitSections(d.sdp),I=E.shift(),_=se.matchPrefix(I,"a=ice-lite").length>0,T=se.matchPrefix(I,"a=group:BUNDLE ").length>0;p.usingBundle=T;var R=se.matchPrefix(I,"a=ice-options:")[0];return p.canTrickleIceCandidates=!!R&&R.substr(14).split(" ").indexOf("trickle")>=0,E.forEach(function(w,k){var L=se.splitLines(w),Y=se.getKind(w),Z=se.isRejected(w)&&se.matchPrefix(w,"a=bundle-only").length===0,rt=L[0].substr(2).split(" ")[2],ut=se.getDirection(w,I),At=se.parseMsid(w),Ct=se.getMid(w)||se.generateIdentifier();if(Z||Y==="application"&&(rt==="DTLS/SCTP"||rt==="UDP/DTLS/SCTP"))p.transceivers[k]={mid:Ct,kind:Y,protocol:rt,rejected:!0};else{var lt,Gt,wt,Qt,xt,ae,ge,re,wr;!Z&&p.transceivers[k]&&p.transceivers[k].rejected&&(p.transceivers[k]=p._createTransceiver(Y,!0));var z,nt,gt=se.parseRtpParameters(w);Z||(z=se.getIceParameters(w,I),(nt=se.getDtlsParameters(w,I)).role="client"),ge=se.parseRtpEncodingParameters(w);var It=se.parseRtcpParameters(w),Mt=se.matchPrefix(w,"a=end-of-candidates",I).length>0,tt=se.matchPrefix(w,"a=candidate:").map(function(x){return se.parseCandidate(x)}).filter(function(x){return x.component===1});if((d.type==="offer"||d.type==="answer")&&!Z&&T&&k>0&&p.transceivers[k]&&(p._disposeIceAndDtlsTransports(k),p.transceivers[k].iceGatherer=p.transceivers[0].iceGatherer,p.transceivers[k].iceTransport=p.transceivers[0].iceTransport,p.transceivers[k].dtlsTransport=p.transceivers[0].dtlsTransport,p.transceivers[k].rtpSender&&p.transceivers[k].rtpSender.setTransport(p.transceivers[0].dtlsTransport),p.transceivers[k].rtpReceiver&&p.transceivers[k].rtpReceiver.setTransport(p.transceivers[0].dtlsTransport)),d.type!=="offer"||Z)d.type==="answer"&&!Z&&(Gt=(lt=p.transceivers[k]).iceGatherer,wt=lt.iceTransport,Qt=lt.dtlsTransport,xt=lt.rtpReceiver,ae=lt.sendEncodingParameters,re=lt.localCapabilities,p.transceivers[k].recvEncodingParameters=ge,p.transceivers[k].remoteCapabilities=gt,p.transceivers[k].rtcpParameters=It,tt.length&&wt.state==="new"&&(!_&&!Mt||T&&k!==0?tt.forEach(function(x){Dp(lt.iceTransport,x)}):wt.setRemoteCandidates(tt)),T&&k!==0||(wt.state==="new"&&wt.start(Gt,z,"controlling"),Qt.state==="new"&&Qt.start(nt)),!Vu(lt.localCapabilities,lt.remoteCapabilities).codecs.filter(function(x){return x.name.toLowerCase()==="rtx"}).length&&lt.sendEncodingParameters[0].rtx&&delete lt.sendEncodingParameters[0].rtx,p._transceive(lt,ut==="sendrecv"||ut==="recvonly",ut==="sendrecv"||ut==="sendonly"),!xt||ut!=="sendrecv"&&ut!=="sendonly"?delete lt.rtpReceiver:(wr=xt.track,At?(f[At.stream]||(f[At.stream]=new t.MediaStream),n(wr,f[At.stream]),g.push([wr,xt,f[At.stream]])):(f.default||(f.default=new t.MediaStream),n(wr,f.default),g.push([wr,xt,f.default]))));else{(lt=p.transceivers[k]||p._createTransceiver(Y)).mid=Ct,lt.iceGatherer||(lt.iceGatherer=p._createIceGatherer(k,T)),tt.length&&lt.iceTransport.state==="new"&&(!Mt||T&&k!==0?tt.forEach(function(x){Dp(lt.iceTransport,x)}):lt.iceTransport.setRemoteCandidates(tt)),re=t.RTCRtpReceiver.getCapabilities(Y),e<15019&&(re.codecs=re.codecs.filter(function(x){return x.name!=="rtx"})),ae=lt.sendEncodingParameters||[{ssrc:1001*(2*k+2)}];var y,D=!1;ut==="sendrecv"||ut==="sendonly"?(D=!lt.rtpReceiver,xt=lt.rtpReceiver||new t.RTCRtpReceiver(lt.dtlsTransport,Y),D&&(wr=xt.track,At&&At.stream==="-"||(At?(f[At.stream]||(f[At.stream]=new t.MediaStream,Object.defineProperty(f[At.stream],"id",{get:function(){return At.stream}})),Object.defineProperty(wr,"id",{get:function(){return At.track}}),y=f[At.stream]):(f.default||(f.default=new t.MediaStream),y=f.default)),y&&(n(wr,y),lt.associatedRemoteMediaStreams.push(y)),g.push([wr,xt,y]))):lt.rtpReceiver&&lt.rtpReceiver.track&&(lt.associatedRemoteMediaStreams.forEach(function(x){var et=x.getTracks().find(function(Dt){return Dt.id===lt.rtpReceiver.track.id});et&&function(Dt,Se){Se.removeTrack(Dt),Se.dispatchEvent(new t.MediaStreamTrackEvent("removetrack",{track:Dt}))}(et,x)}),lt.associatedRemoteMediaStreams=[]),lt.localCapabilities=re,lt.remoteCapabilities=gt,lt.rtpReceiver=xt,lt.rtcpParameters=It,lt.sendEncodingParameters=ae,lt.recvEncodingParameters=ge,p._transceive(p.transceivers[k],!1,D)}}}),p._dtlsRole===void 0&&(p._dtlsRole=d.type==="offer"?"active":"passive"),p._remoteDescription={type:d.type,sdp:d.sdp},d.type==="offer"?p._updateSignalingState("have-remote-offer"):p._updateSignalingState("stable"),Object.keys(f).forEach(function(w){var k=f[w];if(k.getTracks().length){if(p.remoteStreams.indexOf(k)===-1){p.remoteStreams.push(k);var L=new Event("addstream");L.stream=k,t.setTimeout(function(){p._dispatchEvent("addstream",L)})}g.forEach(function(Y){var Z=Y[0],rt=Y[1];k.id===Y[2].id&&o(p,Z,rt,[k])})}}),g.forEach(function(w){w[2]||o(p,w[0],w[1],[])}),t.setTimeout(function(){p&&p.transceivers&&p.transceivers.forEach(function(w){w.iceTransport&&w.iceTransport.state==="new"&&w.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),w.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},c.prototype.close=function(){this.transceivers.forEach(function(d){d.iceTransport&&d.iceTransport.stop(),d.dtlsTransport&&d.dtlsTransport.stop(),d.rtpSender&&d.rtpSender.stop(),d.rtpReceiver&&d.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},c.prototype._updateSignalingState=function(d){this.signalingState=d;var p=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",p)},c.prototype._maybeFireNegotiationNeeded=function(){var d=this;this.signalingState==="stable"&&this.needNegotiation!==!0&&(this.needNegotiation=!0,t.setTimeout(function(){if(d.needNegotiation){d.needNegotiation=!1;var p=new Event("negotiationneeded");d._dispatchEvent("negotiationneeded",p)}},0))},c.prototype._updateIceConnectionState=function(){var d,p={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(g){g.iceTransport&&!g.rejected&&p[g.iceTransport.state]++}),d="new",p.failed>0?d="failed":p.checking>0?d="checking":p.disconnected>0?d="disconnected":p.new>0?d="new":p.connected>0?d="connected":p.completed>0&&(d="completed"),d!==this.iceConnectionState){this.iceConnectionState=d;var f=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",f)}},c.prototype._updateConnectionState=function(){var d,p={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(g){g.iceTransport&&g.dtlsTransport&&!g.rejected&&(p[g.iceTransport.state]++,p[g.dtlsTransport.state]++)}),p.connected+=p.completed,d="new",p.failed>0?d="failed":p.connecting>0?d="connecting":p.disconnected>0?d="disconnected":p.new>0?d="new":p.connected>0&&(d="connected"),d!==this.connectionState){this.connectionState=d;var f=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",f)}},c.prototype.createOffer=function(){var d=this;if(d._isClosed)return Promise.reject(Wn("InvalidStateError","Can not call createOffer after close"));var p=d.transceivers.filter(function(_){return _.kind==="audio"}).length,f=d.transceivers.filter(function(_){return _.kind==="video"}).length,g=arguments[0];if(g){if(g.mandatory||g.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");g.offerToReceiveAudio!==void 0&&(p=g.offerToReceiveAudio===!0?1:g.offerToReceiveAudio===!1?0:g.offerToReceiveAudio),g.offerToReceiveVideo!==void 0&&(f=g.offerToReceiveVideo===!0?1:g.offerToReceiveVideo===!1?0:g.offerToReceiveVideo)}for(d.transceivers.forEach(function(_){_.kind==="audio"?--p<0&&(_.wantReceive=!1):_.kind==="video"&&--f<0&&(_.wantReceive=!1)});p>0||f>0;)p>0&&(d._createTransceiver("audio"),p--),f>0&&(d._createTransceiver("video"),f--);var E=se.writeSessionBoilerplate(d._sdpSessionId,d._sdpSessionVersion++);d.transceivers.forEach(function(_,T){var R=_.track,w=_.kind,k=_.mid||se.generateIdentifier();_.mid=k,_.iceGatherer||(_.iceGatherer=d._createIceGatherer(T,d.usingBundle));var L=t.RTCRtpSender.getCapabilities(w);e<15019&&(L.codecs=L.codecs.filter(function(Z){return Z.name!=="rtx"})),L.codecs.forEach(function(Z){Z.name==="H264"&&Z.parameters["level-asymmetry-allowed"]===void 0&&(Z.parameters["level-asymmetry-allowed"]="1"),_.remoteCapabilities&&_.remoteCapabilities.codecs&&_.remoteCapabilities.codecs.forEach(function(rt){Z.name.toLowerCase()===rt.name.toLowerCase()&&Z.clockRate===rt.clockRate&&(Z.preferredPayloadType=rt.payloadType)})}),L.headerExtensions.forEach(function(Z){(_.remoteCapabilities&&_.remoteCapabilities.headerExtensions||[]).forEach(function(rt){Z.uri===rt.uri&&(Z.id=rt.id)})});var Y=_.sendEncodingParameters||[{ssrc:1001*(2*T+1)}];R&&e>=15019&&w==="video"&&!Y[0].rtx&&(Y[0].rtx={ssrc:Y[0].ssrc+1}),_.wantReceive&&(_.rtpReceiver=new t.RTCRtpReceiver(_.dtlsTransport,w)),_.localCapabilities=L,_.sendEncodingParameters=Y}),d._config.bundlePolicy!=="max-compat"&&(E+="a=group:BUNDLE "+d.transceivers.map(function(_){return _.mid}).join(" ")+`\r
`),E+=`a=ice-options:trickle\r
`,d.transceivers.forEach(function(_,T){E+=Rv(_,_.localCapabilities,"offer",_.stream,d._dtlsRole),E+=`a=rtcp-rsize\r
`,!_.iceGatherer||d.iceGatheringState==="new"||T!==0&&d.usingBundle||(_.iceGatherer.getLocalCandidates().forEach(function(R){R.component=1,E+="a="+se.writeCandidate(R)+`\r
`}),_.iceGatherer.state==="completed"&&(E+=`a=end-of-candidates\r
`))});var I=new t.RTCSessionDescription({type:"offer",sdp:E});return Promise.resolve(I)},c.prototype.createAnswer=function(){var d=this;if(d._isClosed)return Promise.reject(Wn("InvalidStateError","Can not call createAnswer after close"));if(d.signalingState!=="have-remote-offer"&&d.signalingState!=="have-local-pranswer")return Promise.reject(Wn("InvalidStateError","Can not call createAnswer in signalingState "+d.signalingState));var p=se.writeSessionBoilerplate(d._sdpSessionId,d._sdpSessionVersion++);d.usingBundle&&(p+="a=group:BUNDLE "+d.transceivers.map(function(E){return E.mid}).join(" ")+`\r
`),p+=`a=ice-options:trickle\r
`;var f=se.getMediaSections(d._remoteDescription.sdp).length;d.transceivers.forEach(function(E,I){if(!(I+1>f)){if(E.rejected)return E.kind==="application"?E.protocol==="DTLS/SCTP"?p+=`m=application 0 DTLS/SCTP 5000\r
`:p+="m=application 0 "+E.protocol+` webrtc-datachannel\r
`:E.kind==="audio"?p+=`m=audio 0 UDP/TLS/RTP/SAVPF 0\r
a=rtpmap:0 PCMU/8000\r
`:E.kind==="video"&&(p+=`m=video 0 UDP/TLS/RTP/SAVPF 120\r
a=rtpmap:120 VP8/90000\r
`),void(p+=`c=IN IP4 0.0.0.0\r
a=inactive\r
a=mid:`+E.mid+`\r
`);var _;E.stream&&(E.kind==="audio"?_=E.stream.getAudioTracks()[0]:E.kind==="video"&&(_=E.stream.getVideoTracks()[0]),_&&e>=15019&&E.kind==="video"&&!E.sendEncodingParameters[0].rtx&&(E.sendEncodingParameters[0].rtx={ssrc:E.sendEncodingParameters[0].ssrc+1}));var T=Vu(E.localCapabilities,E.remoteCapabilities);!T.codecs.filter(function(R){return R.name.toLowerCase()==="rtx"}).length&&E.sendEncodingParameters[0].rtx&&delete E.sendEncodingParameters[0].rtx,p+=Rv(E,T,"answer",E.stream,d._dtlsRole),E.rtcpParameters&&E.rtcpParameters.reducedSize&&(p+=`a=rtcp-rsize\r
`)}});var g=new t.RTCSessionDescription({type:"answer",sdp:p});return Promise.resolve(g)},c.prototype.addIceCandidate=function(d){var p,f=this;return d&&d.sdpMLineIndex===void 0&&!d.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(g,E){if(!f._remoteDescription)return E(Wn("InvalidStateError","Can not add ICE candidate without a remote description"));if(d&&d.candidate!==""){var I=d.sdpMLineIndex;if(d.sdpMid){for(var _=0;_<f.transceivers.length;_++)if(f.transceivers[_].mid===d.sdpMid){I=_;break}}var T=f.transceivers[I];if(!T)return E(Wn("OperationError","Can not add ICE candidate"));if(T.rejected)return g();var R=Object.keys(d.candidate).length>0?se.parseCandidate(d.candidate):{};if(R.protocol==="tcp"&&(R.port===0||R.port===9)||R.component&&R.component!==1)return g();if((I===0||I>0&&T.iceTransport!==f.transceivers[0].iceTransport)&&!Dp(T.iceTransport,R))return E(Wn("OperationError","Can not add ICE candidate"));var w=d.candidate.trim();w.indexOf("a=")===0&&(w=w.substr(2)),(p=se.getMediaSections(f._remoteDescription.sdp))[I]+="a="+(R.type?w:"end-of-candidates")+`\r
`,f._remoteDescription.sdp=se.getDescription(f._remoteDescription.sdp)+p.join("")}else for(var k=0;k<f.transceivers.length&&(f.transceivers[k].rejected||(f.transceivers[k].iceTransport.addRemoteCandidate({}),(p=se.getMediaSections(f._remoteDescription.sdp))[k]+=`a=end-of-candidates\r
`,f._remoteDescription.sdp=se.getDescription(f._remoteDescription.sdp)+p.join(""),!f.usingBundle));k++);g()})},c.prototype.getStats=function(d){if(d&&d instanceof t.MediaStreamTrack){var p=null;if(this.transceivers.forEach(function(g){g.rtpSender&&g.rtpSender.track===d?p=g.rtpSender:g.rtpReceiver&&g.rtpReceiver.track===d&&(p=g.rtpReceiver)}),!p)throw Wn("InvalidAccessError","Invalid selector.");return p.getStats()}var f=[];return this.transceivers.forEach(function(g){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(E){g[E]&&f.push(g[E].getStats())})}),Promise.all(f).then(function(g){var E=new Map;return g.forEach(function(I){I.forEach(function(_){E.set(_.id,_)})}),E})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(d){var p=t[d];if(p&&p.prototype&&p.prototype.getStats){var f=p.prototype.getStats;p.prototype.getStats=function(){return f.apply(this).then(function(g){var E=new Map;return Object.keys(g).forEach(function(I){var _;g[I].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(_=g[I]).type]||_.type,E.set(I,g[I])}),E})}}});var u=["createOffer","createAnswer"];return u.forEach(function(d){var p=c.prototype[d];c.prototype[d]=function(){var f=arguments;return typeof f[0]=="function"||typeof f[1]=="function"?p.apply(this,[arguments[2]]).then(function(g){typeof f[0]=="function"&&f[0].apply(null,[g])},function(g){typeof f[1]=="function"&&f[1].apply(null,[g])}):p.apply(this,arguments)}}),(u=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(d){var p=c.prototype[d];c.prototype[d]=function(){var f=arguments;return typeof f[1]=="function"||typeof f[2]=="function"?p.apply(this,arguments).then(function(){typeof f[1]=="function"&&f[1].apply(null)},function(g){typeof f[2]=="function"&&f[2].apply(null,[g])}):p.apply(this,arguments)}}),["getStats"].forEach(function(d){var p=c.prototype[d];c.prototype[d]=function(){var f=arguments;return typeof f[1]=="function"?p.apply(this,arguments).then(function(){typeof f[1]=="function"&&f[1].apply(null)}):p.apply(this,arguments)}}),c};function bv(t){var e;const n=t&&t.navigator,o=vn(e=n.mediaDevices.getUserMedia).call(e,n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return o(c).catch(u=>ct.reject(function(d){return{name:{PermissionDeniedError:"NotAllowedError"}[d.name]||d.name,message:d.message,constraint:d.constraint,toString(){return this.name}}}(u)))}}function Nv(t){var e;"getDisplayMedia"in t.navigator&&t.navigator.mediaDevices&&(t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||(t.navigator.mediaDevices.getDisplayMedia=vn(e=t.navigator.getDisplayMedia).call(e,t.navigator)))}function Bp(t,e){if(t.RTCIceGatherer&&(t.RTCIceCandidate||(t.RTCIceCandidate=function(o){return o}),t.RTCSessionDescription||(t.RTCSessionDescription=function(o){return o}),e.version<15025)){const o=zt(t.MediaStreamTrack.prototype,"enabled");te(t.MediaStreamTrack.prototype,"enabled",{set(c){o.set.call(this,c);const u=new Event("enabled");u.enabled=c,this.dispatchEvent(u)}})}t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)&&te(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=new t.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}}),t.RTCDtmfSender&&!t.RTCDTMFSender&&(t.RTCDTMFSender=t.RTCDtmfSender);const n=Pw(t,e.version);t.RTCPeerConnection=function(o){return o&&o.iceServers&&(o.iceServers=function(c,u){let d=!1;return c=JSON.parse(at(c)),Ot(c).call(c,p=>{if(p&&(p.urls||p.url)){let f=p.urls||p.url;p.url&&!p.urls&&Uu("RTCIceServer.url","RTCIceServer.urls");const g=typeof f=="string";return g&&(f=[f]),f=Ot(f).call(f,E=>{if(Ft(E).call(E,"stun:")===0)return!1;const I=hl(E).call(E,"turn")&&!hl(E).call(E,"turn:[")&&Xt(E).call(E,"transport=udp");return I&&!d?(d=!0,!0):I&&!d}),delete p.url,p.urls=g?f[0]:f,!!f.length}})}(o.iceServers,e.version),dp("ICE servers after filtering:",o.iceServers)),new n(o)},t.RTCPeerConnection.prototype=n.prototype}function Ov(t){t.RTCRtpSender&&!("replaceTrack"in t.RTCRtpSender.prototype)&&(t.RTCRtpSender.prototype.replaceTrack=t.RTCRtpSender.prototype.setTrack)}var kv=Object.freeze({__proto__:null,shimPeerConnection:Bp,shimReplaceTrack:Ov,shimGetUserMedia:bv,shimGetDisplayMedia:Nv}),xw=up.trim,Lp=h.parseFloat,Dv=1/Lp(tc+"-0")!=-1/0?function(t){var e=xw(String(t)),n=Lp(e);return n===0&&e.charAt(0)=="-"?-0:n}:Lp;jt({global:!0,forced:parseFloat!=Dv},{parseFloat:Dv});var Bv=le.parseFloat;function Lv(t,e){const n=t&&t.navigator,o=t&&t.MediaStreamTrack;if(n.getUserMedia=function(u,d,p){Uu("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(u).then(d,p)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){var c;const u=function(p,f,g){f in p&&!(g in p)&&(p[g]=p[f],delete p[f])},d=vn(c=n.mediaDevices.getUserMedia).call(c,n.mediaDevices);if(n.mediaDevices.getUserMedia=function(p){return typeof p=="object"&&typeof p.audio=="object"&&(p=JSON.parse(at(p)),u(p.audio,"autoGainControl","mozAutoGainControl"),u(p.audio,"noiseSuppression","mozNoiseSuppression")),d(p)},o&&o.prototype.getSettings){const p=o.prototype.getSettings;o.prototype.getSettings=function(){const f=p.apply(this,arguments);return u(f,"mozAutoGainControl","autoGainControl"),u(f,"mozNoiseSuppression","noiseSuppression"),f}}if(o&&o.prototype.applyConstraints){const p=o.prototype.applyConstraints;o.prototype.applyConstraints=function(f){return this.kind==="audio"&&typeof f=="object"&&(f=JSON.parse(at(f)),u(f,"autoGainControl","mozAutoGainControl"),u(f,"noiseSuppression","mozNoiseSuppression")),p.apply(this,[f])}}}}function Mv(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&te(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Mp(t,e){if(typeof t!="object"||!t.RTCPeerConnection&&!t.mozRTCPeerConnection)return;var n;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&G(n=["setLocalDescription","setRemoteDescription","addIceCandidate"]).call(n,function(u){const d=t.RTCPeerConnection.prototype[u],p={[u](){return arguments[0]=new(u==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),d.apply(this,arguments)}};t.RTCPeerConnection.prototype[u]=p[u]});const o={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},c=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[u,d,p]=arguments;return c.apply(this,[u||null]).then(f=>{if(e.version<53&&!d)try{G(f).call(f,g=>{g.type=o[g.type]||g.type})}catch(g){if(g.name!=="TypeError")throw g;G(f).call(f,(E,I)=>{f.set(I,Ir({},E,{type:o[E.type]||E.type}))})}return f}).then(d,p)}}function Pv(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const o=e.apply(this,[]);return G(o).call(o,c=>c._pc=this),o});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const o=n.apply(this,arguments);return o._pc=this,o}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):ct.resolve(new tr)}}function xv(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const n=e.apply(this,[]);return G(n).call(n,o=>o._pc=this),n}),ec(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Uv(t){t.RTCPeerConnection&&!("removeStream"in t.RTCPeerConnection.prototype)&&(t.RTCPeerConnection.prototype.removeStream=function(e){var n;Uu("removeStream","removeTrack"),G(n=this.getSenders()).call(n,o=>{var c;o.track&&Xt(c=e.getTracks()).call(c,o.track)&&this.removeTrack(o)})})}function Qv(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function Fv(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const n=arguments[1],o=n&&"sendEncodings"in n;var c;o&&G(c=n.sendEncodings).call(c,d=>{if("rid"in d&&!/^[a-z0-9]{0,16}$/i.test(d.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in d&&!(Bv(d.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in d&&!(Bv(d.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const u=e.apply(this,arguments);if(o){const{sender:d}=u,p=d.getParameters();(!("encodings"in p)||p.encodings.length===1&&ue(p.encodings[0]).length===0)&&(p.encodings=n.sendEncodings,d.sendEncodings=n.sendEncodings,this.setParametersPromises.push(d.setParameters(p).then(()=>{delete d.sendEncodings}).catch(()=>{delete d.sendEncodings})))}return u})}function Vv(t){if(typeof t!="object"||!t.RTCRtpSender)return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const n=e.apply(this,arguments);var o;return"encodings"in n||(n.encodings=M(o=[]).call(o,this.sendEncodings||[{}])),n})}function Gv(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ct.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function jv(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ct.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var Kv=Object.freeze({__proto__:null,shimOnTrack:Mv,shimPeerConnection:Mp,shimSenderGetStats:Pv,shimReceiverGetStats:xv,shimRemoveStream:Uv,shimRTCDataChannel:Qv,shimAddTransceiver:Fv,shimGetParameters:Vv,shimCreateOffer:Gv,shimCreateAnswer:jv,shimGetUserMedia:Lv,shimGetDisplayMedia:function(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const o=new DOMException("getDisplayMedia without video constraints is undefined");return o.name="NotFoundError",o.code=8,ct.reject(o)}return n.video===!0?n.video={mediaSource:e}:n.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(n)})}});function Hv(t){if(typeof t=="object"&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(n){var o,c,u;this._localStreams||(this._localStreams=[]),Xt(o=this._localStreams).call(o,n)||this._localStreams.push(n),G(c=n.getAudioTracks()).call(c,d=>e.call(this,d,n)),G(u=n.getVideoTracks()).call(u,d=>e.call(this,d,n))},t.RTCPeerConnection.prototype.addTrack=function(n,...o){return o&&G(o).call(o,c=>{var u;this._localStreams?Xt(u=this._localStreams).call(u,c)||this._localStreams.push(c):this._localStreams=[c]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(e){var n,o,c;this._localStreams||(this._localStreams=[]);const u=Ft(n=this._localStreams).call(n,e);if(u===-1)return;Ze(o=this._localStreams).call(o,u,1);const d=e.getTracks();G(c=this.getSenders()).call(c,p=>{Xt(d).call(d,p.track)&&this.removeTrack(p)})})}}function Wv(t){if(typeof t=="object"&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){te(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=o=>{var c;G(c=o.streams).call(c,u=>{var d;if(this._remoteStreams||(this._remoteStreams=[]),Xt(d=this._remoteStreams).call(d,u))return;this._remoteStreams.push(u);const p=new Event("addstream");p.stream=u,this.dispatchEvent(p)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(o){var c;G(c=o.streams).call(c,u=>{var d;if(n._remoteStreams||(n._remoteStreams=[]),Ft(d=n._remoteStreams).call(d,u)>=0)return;n._remoteStreams.push(u);const p=new Event("addstream");p.stream=u,n.dispatchEvent(p)})}),e.apply(n,arguments)}}}function Yv(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,o=e.createAnswer,c=e.setLocalDescription,u=e.setRemoteDescription,d=e.addIceCandidate;e.createOffer=function(f,g){const E=arguments.length>=2?arguments[2]:arguments[0],I=n.apply(this,[E]);return g?(I.then(f,g),ct.resolve()):I},e.createAnswer=function(f,g){const E=arguments.length>=2?arguments[2]:arguments[0],I=o.apply(this,[E]);return g?(I.then(f,g),ct.resolve()):I};let p=function(f,g,E){const I=c.apply(this,[f]);return E?(I.then(g,E),ct.resolve()):I};e.setLocalDescription=p,p=function(f,g,E){const I=u.apply(this,[f]);return E?(I.then(g,E),ct.resolve()):I},e.setRemoteDescription=p,p=function(f,g,E){const I=d.apply(this,[f]);return E?(I.then(g,E),ct.resolve()):I},e.addIceCandidate=p}function qv(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){var n;const c=e.mediaDevices,u=vn(n=c.getUserMedia).call(n,c);e.mediaDevices.getUserMedia=d=>u(Jv(d))}var o;!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=vn(o=function(c,u,d){e.mediaDevices.getUserMedia(c).then(u,d)}).call(o,e))}function Jv(t){return t&&t.video!==void 0?Ir({},t,{video:_E(t.video)}):t}function zv(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(n,o){if(n&&n.iceServers){const c=[];for(let u=0;u<n.iceServers.length;u++){let d=n.iceServers[u];!d.hasOwnProperty("urls")&&d.hasOwnProperty("url")?(Uu("RTCIceServer.url","RTCIceServer.urls"),d=JSON.parse(at(d)),d.urls=d.url,delete d.url,c.push(d)):c.push(n.iceServers[u])}n.iceServers=c}return new e(n,o)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&te(t.RTCPeerConnection,"generateCertificate",{get:()=>e.generateCertificate})}function Xv(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&te(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Zv(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(n){if(n){var o,c;n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const u=yt(o=this.getTransceivers()).call(o,p=>p.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&u?u.direction==="sendrecv"?u.setDirection?u.setDirection("sendonly"):u.direction="sendonly":u.direction==="recvonly"&&(u.setDirection?u.setDirection("inactive"):u.direction="inactive"):n.offerToReceiveAudio!==!0||u||this.addTransceiver("audio"),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const d=yt(c=this.getTransceivers()).call(c,p=>p.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&d?d.direction==="sendrecv"?d.setDirection?d.setDirection("sendonly"):d.direction="sendonly":d.direction==="recvonly"&&(d.setDirection?d.setDirection("inactive"):d.direction="inactive"):n.offerToReceiveVideo!==!0||d||this.addTransceiver("video")}return e.apply(this,arguments)}}function $v(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var pl,tI=Object.freeze({__proto__:null,shimLocalStreamsAPI:Hv,shimRemoteStreamsAPI:Wv,shimCallbacksAPI:Yv,shimGetUserMedia:qv,shimConstraints:Jv,shimRTCIceServerUrls:zv,shimTrackEventTransceiver:Xv,shimCreateOfferLegacy:Zv,shimAudioContext:$v}),Uw=up.trim;jt({target:"String",proto:!0,forced:(pl="trim",A(function(){return!!tc[pl]()||"\u200B\x85\u180E"[pl]()!="\u200B\x85\u180E"||tc[pl].name!==pl}))},{trim:function(){return Uw(this)}});var Qw=vr("String").trim,eI=String.prototype,ga=function(t){var e=t.trim;return typeof t=="string"||t===eI||t instanceof String&&e===eI.trim?Qw:e},Gu=a(function(t){var e={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};e.localCName=e.generateIdentifier(),e.splitLines=function(n){var o;return ht(o=ga(n).call(n).split(`
`)).call(o,function(c){return ga(c).call(c)})},e.splitSections=function(n){var o=n.split(`
m=`);return ht(o).call(o,function(c,u){var d;return ga(d=u>0?"m="+c:c).call(d)+`\r
`})},e.getDescription=function(n){var o=e.splitSections(n);return o&&o[0]},e.getMediaSections=function(n){var o=e.splitSections(n);return o.shift(),o},e.matchPrefix=function(n,o){var c;return Ot(c=e.splitLines(n)).call(c,function(u){return Ft(u).call(u,o)===0})},e.parseCandidate=function(n){for(var o,c={foundation:(o=Ft(n).call(n,"a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" "))[0],component:rr(o[1],10),protocol:o[2].toLowerCase(),priority:rr(o[3],10),ip:o[4],address:o[4],port:rr(o[5],10),type:o[7]},u=8;u<o.length;u+=2)switch(o[u]){case"raddr":c.relatedAddress=o[u+1];break;case"rport":c.relatedPort=rr(o[u+1],10);break;case"tcptype":c.tcpType=o[u+1];break;case"ufrag":c.ufrag=o[u+1],c.usernameFragment=o[u+1];break;default:c[o[u]]=o[u+1]}return c},e.writeCandidate=function(n){var o=[];o.push(n.foundation),o.push(n.component),o.push(n.protocol.toUpperCase()),o.push(n.priority),o.push(n.address||n.ip),o.push(n.port);var c=n.type;return o.push("typ"),o.push(c),c!=="host"&&n.relatedAddress&&n.relatedPort&&(o.push("raddr"),o.push(n.relatedAddress),o.push("rport"),o.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(o.push("tcptype"),o.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(o.push("ufrag"),o.push(n.usernameFragment||n.ufrag)),"candidate:"+o.join(" ")},e.parseIceOptions=function(n){return n.substr(14).split(" ")},e.parseRtpMap=function(n){var o=n.substr(9).split(" "),c={payloadType:rr(o.shift(),10)};return o=o[0].split("/"),c.name=o[0],c.clockRate=rr(o[1],10),c.channels=o.length===3?rr(o[2],10):1,c.numChannels=c.channels,c},e.writeRtpMap=function(n){var o=n.payloadType;n.preferredPayloadType!==void 0&&(o=n.preferredPayloadType);var c=n.channels||n.numChannels||1;return"a=rtpmap:"+o+" "+n.name+"/"+n.clockRate+(c!==1?"/"+c:"")+`\r
`},e.parseExtmap=function(n){var o,c=n.substr(9).split(" ");return{id:rr(c[0],10),direction:Ft(o=c[0]).call(o,"/")>0?c[0].split("/")[1]:"sendrecv",uri:c[1]}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+`\r
`},e.parseFmtp=function(n){for(var o,c={},u=n.substr(Ft(n).call(n," ")+1).split(";"),d=0;d<u.length;d++){var p,f;o=ga(p=u[d]).call(p).split("="),c[ga(f=o[0]).call(f)]=o[1]}return c},e.writeFmtp=function(n){var o="",c=n.payloadType;if(n.preferredPayloadType!==void 0&&(c=n.preferredPayloadType),n.parameters&&ue(n.parameters).length){var u,d=[];G(u=ue(n.parameters)).call(u,function(p){n.parameters[p]?d.push(p+"="+n.parameters[p]):d.push(p)}),o+="a=fmtp:"+c+" "+d.join(";")+`\r
`}return o},e.parseRtcpFb=function(n){var o=n.substr(Ft(n).call(n," ")+1).split(" ");return{type:o.shift(),parameter:o.join(" ")}},e.writeRtcpFb=function(n){var o,c="",u=n.payloadType;return n.preferredPayloadType!==void 0&&(u=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&G(o=n.rtcpFeedback).call(o,function(d){c+="a=rtcp-fb:"+u+" "+d.type+(d.parameter&&d.parameter.length?" "+d.parameter:"")+`\r
`}),c},e.parseSsrcMedia=function(n){var o=Ft(n).call(n," "),c={ssrc:rr(n.substr(7,o-7),10)},u=Ft(n).call(n,":",o);return u>-1?(c.attribute=n.substr(o+1,u-o-1),c.value=n.substr(u+1)):c.attribute=n.substr(o+1),c},e.parseSsrcGroup=function(n){var o=n.substr(13).split(" ");return{semantics:o.shift(),ssrcs:ht(o).call(o,function(c){return rr(c,10)})}},e.getMid=function(n){var o=e.matchPrefix(n,"a=mid:")[0];if(o)return o.substr(6)},e.parseFingerprint=function(n){var o=n.substr(14).split(" ");return{algorithm:o[0].toLowerCase(),value:o[1]}},e.getDtlsParameters=function(n,o){var c=e.matchPrefix(n+o,"a=fingerprint:");return{role:"auto",fingerprints:ht(c).call(c,e.parseFingerprint)}},e.writeDtlsParameters=function(n,o){var c,u="a=setup:"+o+`\r
`;return G(c=n.fingerprints).call(c,function(d){u+="a=fingerprint:"+d.algorithm+" "+d.value+`\r
`}),u},e.parseCryptoLine=function(n){var o=n.substr(9).split(" ");return{tag:rr(o[0],10),cryptoSuite:o[1],keyParams:o[2],sessionParams:Mr(o).call(o,3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(Ft(n).call(n,"inline:")!==0)return null;var o=n.substr(7).split("|");return{keyMethod:"inline",keySalt:o[0],lifeTime:o[1],mkiValue:o[2]?o[2].split(":")[0]:void 0,mkiLength:o[2]?o[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,o){var c=e.matchPrefix(n+o,"a=crypto:");return ht(c).call(c,e.parseCryptoLine)},e.getIceParameters=function(n,o){var c=e.matchPrefix(n+o,"a=ice-ufrag:")[0],u=e.matchPrefix(n+o,"a=ice-pwd:")[0];return c&&u?{usernameFragment:c.substr(12),password:u.substr(10)}:null},e.writeIceParameters=function(n){return"a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`},e.parseRtpParameters=function(n){for(var o,c={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},u=e.splitLines(n)[0].split(" "),d=3;d<u.length;d++){var p=u[d],f=e.matchPrefix(n,"a=rtpmap:"+p+" ")[0];if(f){var g,E=e.parseRtpMap(f),I=e.matchPrefix(n,"a=fmtp:"+p+" ");switch(E.parameters=I.length?e.parseFmtp(I[0]):{},E.rtcpFeedback=ht(g=e.matchPrefix(n,"a=rtcp-fb:"+p+" ")).call(g,e.parseRtcpFb),c.codecs.push(E),E.name.toUpperCase()){case"RED":case"ULPFEC":c.fecMechanisms.push(E.name.toUpperCase())}}}return G(o=e.matchPrefix(n,"a=extmap:")).call(o,function(_){c.headerExtensions.push(e.parseExtmap(_))}),c},e.writeRtpDescription=function(n,o){var c,u,d,p="";p+="m="+n+" ",p+=o.codecs.length>0?"9":"0",p+=" UDP/TLS/RTP/SAVPF ",p+=ht(c=o.codecs).call(c,function(E){return E.preferredPayloadType!==void 0?E.preferredPayloadType:E.payloadType}).join(" ")+`\r
`,p+=`c=IN IP4 0.0.0.0\r
`,p+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,G(u=o.codecs).call(u,function(E){p+=e.writeRtpMap(E),p+=e.writeFmtp(E),p+=e.writeRtcpFb(E)});var f,g=0;return G(d=o.codecs).call(d,function(E){E.maxptime>g&&(g=E.maxptime)}),g>0&&(p+="a=maxptime:"+g+`\r
`),p+=`a=rtcp-mux\r
`,o.headerExtensions&&G(f=o.headerExtensions).call(f,function(E){p+=e.writeExtmap(E)}),p},e.parseRtpEncodingParameters=function(n){var o,c,u,d,p,f,g,E=[],I=e.parseRtpParameters(n),_=Ft(o=I.fecMechanisms).call(o,"RED")!==-1,T=Ft(c=I.fecMechanisms).call(c,"ULPFEC")!==-1,R=Ot(u=ht(d=e.matchPrefix(n,"a=ssrc:")).call(d,function(rt){return e.parseSsrcMedia(rt)})).call(u,function(rt){return rt.attribute==="cname"}),w=R.length>0&&R[0].ssrc,k=ht(p=e.matchPrefix(n,"a=ssrc-group:FID")).call(p,function(rt){var ut=rt.substr(17).split(" ");return ht(ut).call(ut,function(At){return rr(At,10)})});k.length>0&&k[0].length>1&&k[0][0]===w&&(g=k[0][1]),G(f=I.codecs).call(f,function(rt){if(rt.name.toUpperCase()==="RTX"&&rt.parameters.apt){var ut={ssrc:w,codecPayloadType:rr(rt.parameters.apt,10)};w&&g&&(ut.rtx={ssrc:g}),E.push(ut),_&&((ut=JSON.parse(at(ut))).fec={ssrc:w,mechanism:T?"red+ulpfec":"red"},E.push(ut))}}),E.length===0&&w&&E.push({ssrc:w});var L,Y,Z=e.matchPrefix(n,"b=");return Z.length&&(Z=Ft(L=Z[0]).call(L,"b=TIAS:")===0?rr(Z[0].substr(7),10):Ft(Y=Z[0]).call(Y,"b=AS:")===0?1e3*rr(Z[0].substr(5),10)*.95-16e3:void 0,G(E).call(E,function(rt){rt.maxBitrate=Z})),E},e.parseRtcpParameters=function(n){var o,c,u={},d=Ot(o=ht(c=e.matchPrefix(n,"a=ssrc:")).call(c,function(g){return e.parseSsrcMedia(g)})).call(o,function(g){return g.attribute==="cname"})[0];d&&(u.cname=d.value,u.ssrc=d.ssrc);var p=e.matchPrefix(n,"a=rtcp-rsize");u.reducedSize=p.length>0,u.compound=p.length===0;var f=e.matchPrefix(n,"a=rtcp-mux");return u.mux=f.length>0,u},e.parseMsid=function(n){var o,c,u,d=e.matchPrefix(n,"a=msid:");if(d.length===1)return{stream:(u=d[0].substr(7).split(" "))[0],track:u[1]};var p=Ot(o=ht(c=e.matchPrefix(n,"a=ssrc:")).call(c,function(f){return e.parseSsrcMedia(f)})).call(o,function(f){return f.attribute==="msid"});return p.length>0?{stream:(u=p[0].value.split(" "))[0],track:u[1]}:void 0},e.parseSctpDescription=function(n){var o,c=e.parseMLine(n),u=e.matchPrefix(n,"a=max-message-size:");u.length>0&&(o=rr(u[0].substr(19),10)),isNaN(o)&&(o=65536);var d=e.matchPrefix(n,"a=sctp-port:");if(d.length>0)return{port:rr(d[0].substr(12),10),protocol:c.fmt,maxMessageSize:o};if(e.matchPrefix(n,"a=sctpmap:").length>0){var p=e.matchPrefix(n,"a=sctpmap:")[0].substr(10).split(" ");return{port:rr(p[0],10),protocol:p[1],maxMessageSize:o}}},e.writeSctpDescription=function(n,o){var c=[];return c=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+o.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+o.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+o.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+o.port+" "+o.protocol+` 65535\r
`],o.maxMessageSize!==void 0&&c.push("a=max-message-size:"+o.maxMessageSize+`\r
`),c.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,21)},e.writeSessionBoilerplate=function(n,o,c){var u=o!==void 0?o:2;return`v=0\r
o=`+(c||"thisisadapterortc")+" "+(n||e.generateSessionId())+" "+u+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.writeMediaSection=function(n,o,c,u){var d=e.writeRtpDescription(n.kind,o);if(d+=e.writeIceParameters(n.iceGatherer.getLocalParameters()),d+=e.writeDtlsParameters(n.dtlsTransport.getLocalParameters(),c==="offer"?"actpass":"active"),d+="a=mid:"+n.mid+`\r
`,n.direction?d+="a="+n.direction+`\r
`:n.rtpSender&&n.rtpReceiver?d+=`a=sendrecv\r
`:n.rtpSender?d+=`a=sendonly\r
`:n.rtpReceiver?d+=`a=recvonly\r
`:d+=`a=inactive\r
`,n.rtpSender){var p="msid:"+u.id+" "+n.rtpSender.track.id+`\r
`;d+="a="+p,d+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" "+p,n.sendEncodingParameters[0].rtx&&(d+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" "+p,d+="a=ssrc-group:FID "+n.sendEncodingParameters[0].ssrc+" "+n.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return d+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" cname:"+e.localCName+`\r
`,n.rtpSender&&n.sendEncodingParameters[0].rtx&&(d+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" cname:"+e.localCName+`\r
`),d},e.getDirection=function(n,o){for(var c=e.splitLines(n),u=0;u<c.length;u++)switch(c[u]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[u].substr(2)}return o?e.getDirection(o):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substr(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){var o=e.splitLines(n)[0].substr(2).split(" ");return{kind:o[0],port:rr(o[1],10),protocol:o[2],fmt:Mr(o).call(o,3).join(" ")}},e.parseOLine=function(n){var o=e.matchPrefix(n,"o=")[0].substr(2).split(" ");return{username:o[0],sessionId:o[1],sessionVersion:rr(o[2],10),netType:o[3],addressType:o[4],address:o[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;for(var o=e.splitLines(n),c=0;c<o.length;c++)if(o[c].length<2||o[c].charAt(1)!=="=")return!1;return!0},t.exports=e});function ju(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(n){var o;if(typeof n=="object"&&n.candidate&&Ft(o=n.candidate).call(o,"a=")===0&&((n=JSON.parse(at(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const c=new e(n),u=Gu.parseCandidate(n.candidate),d=Ir(c,u);return d.toJSON=function(){return{candidate:d.candidate,sdpMid:d.sdpMid,sdpMLineIndex:d.sdpMLineIndex,usernameFragment:d.usernameFragment}},d}return new e(n)},t.RTCIceCandidate.prototype=e.prototype,ec(t,"icecandidate",n=>(n.candidate&&te(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function Al(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||te(t.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n=function(p){if(!p||!p.sdp)return!1;const f=Gu.splitSections(p.sdp);return f.shift(),Bi(f).call(f,g=>{var E;const I=Gu.parseMLine(g);return I&&I.kind==="application"&&Ft(E=I.protocol).call(E,"SCTP")!==-1})},o=function(p){const f=p.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(f===null||f.length<2)return-1;const g=rr(f[1],10);return g!=g?-1:g},c=function(p){let f=65536;return e.browser==="firefox"&&(f=e.version<57?p===-1?16384:2147483637:e.version<60?e.version===57?65535:65536:2147483637),f},u=function(p,f){let g=65536;e.browser==="firefox"&&e.version===57&&(g=65535);const E=Gu.matchPrefix(p.sdp,"a=max-message-size:");return E.length>0?g=rr(E[0].substr(19),10):e.browser==="firefox"&&f!==-1&&(g=2147483637),g},d=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:p}=this.getConfiguration();p==="plan-b"&&te(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const p=o(arguments[0]),f=c(p),g=u(arguments[0],p);let E;E=f===0&&g===0?Number.POSITIVE_INFINITY:f===0||g===0?Math.max(f,g):Math.min(f,g);const I={};te(I,"maxMessageSize",{get:()=>E}),this._sctp=I}return d.apply(this,arguments)}}function fl(t){if(!t.RTCPeerConnection||!("createDataChannel"in t.RTCPeerConnection.prototype))return;function e(o,c){const u=o.send;o.send=function(){const d=arguments[0],p=d.length||d.size||d.byteLength;if(o.readyState==="open"&&c.sctp&&p>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return u.apply(o,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const o=n.apply(this,arguments);return e(o,this),o},ec(t,"datachannel",o=>(e(o.channel,o.target),o))}function Pp(t){var e;if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const n=t.RTCPeerConnection.prototype;te(n,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),te(n,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(o){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),o&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=o)},enumerable:!0,configurable:!0}),G(e=["setLocalDescription","setRemoteDescription"]).call(e,o=>{const c=n[o];n[o]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=u=>{const d=u.target;if(d._lastConnectionState!==d.connectionState){d._lastConnectionState=d.connectionState;const p=new Event("connectionstatechange",u);d.dispatchEvent(p)}return u},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),c.apply(this,arguments)}})}function xp(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(o){var c;if(o&&o.sdp&&Ft(c=o.sdp).call(c,`
a=extmap-allow-mixed`)!==-1){var u;const d=Ot(u=o.sdp.split(`
`)).call(u,p=>ga(p).call(p)!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&o instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:o.type,sdp:d}):o.sdp=d}return n.apply(this,arguments)}}function Ku(t,e){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const n=t.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?ct.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),ct.resolve())})}var Zr,be,Fw=Object.freeze({__proto__:null,shimRTCIceCandidate:ju,shimMaxMessageSize:Al,shimSendThrowTypeError:fl,shimConnectionState:Pp,removeExtmapAllowMixed:xp,shimAddIceCandidateNullOrEmpty:Ku});(function({window:t}={},e={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){const n=dp,o=function(u){const d={browser:null,version:null};if(u===void 0||!u.navigator)return d.browser="Not a browser.",d;const{navigator:p}=u;if(p.mozGetUserMedia)d.browser="firefox",d.version=al(p.userAgent,/Firefox\/(\d+)\./,1);else if(p.webkitGetUserMedia||u.isSecureContext===!1&&u.webkitRTCPeerConnection&&!u.RTCIceGatherer)d.browser="chrome",d.version=al(p.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(p.mediaDevices&&p.userAgent.match(/Edge\/(\d+).(\d+)$/))d.browser="edge",d.version=al(p.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!u.RTCPeerConnection||!p.userAgent.match(/AppleWebKit\/(\d+)\./))return d.browser="Not a supported browser.",d;d.browser="safari",d.version=al(p.userAgent,/AppleWebKit\/(\d+)\./,1),d.supportsUnifiedPlan=u.RTCRtpTransceiver&&"currentDirection"in u.RTCRtpTransceiver.prototype}return d}(t),c={browserDetails:o,commonShim:Fw,extractVersion:al,disableLog:VR,disableWarnings:GR};switch(o.browser){case"chrome":if(!yv||!kp||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),c;if(o.version===null)return n("Chrome shim can not determine version, not shimming."),c;n("adapter.js shimming chrome."),c.browserShim=yv,Ku(t,o),Av(t,o),fv(t),kp(t,o),gv(t),Cv(t,o),mv(t),Ev(t),vv(t),_v(t,o),ju(t),Pp(t),Al(t,o),fl(t),xp(t,o);break;case"firefox":if(!Kv||!Mp||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),c;n("adapter.js shimming firefox."),c.browserShim=Kv,Ku(t,o),Lv(t,o),Mp(t,o),Mv(t),Uv(t),Pv(t),xv(t),Qv(t),Fv(t),Vv(t),Gv(t),jv(t),ju(t),Pp(t),Al(t,o),fl(t);break;case"edge":if(!kv||!Bp||!e.shimEdge)return n("MS edge shim is not included in this adapter release."),c;n("adapter.js shimming edge."),c.browserShim=kv,bv(t),Nv(t),Bp(t,o),Ov(t),Al(t,o),fl(t);break;case"safari":if(!tI||!e.shimSafari)return n("Safari shim is not included in this adapter release."),c;n("adapter.js shimming safari."),c.browserShim=tI,Ku(t,o),zv(t),Zv(t),Yv(t),Hv(t),Wv(t),Xv(t),qv(t),$v(t),ju(t),Al(t,o),fl(t),xp(t,o);break;default:n("Unsupported browser!")}})({window:typeof window=="undefined"?void 0:window}),function(t){t.WIN_10="Windows 10",t.WIN_81="Windows 8.1",t.WIN_8="Windows 8",t.WIN_7="Windows 7",t.WIN_VISTA="Windows Vista",t.WIN_SERVER_2003="Windows Server 2003",t.WIN_XP="Windows XP",t.WIN_2000="Windows 2000",t.ANDROID="Android",t.OPEN_BSD="Open BSD",t.SUN_OS="Sun OS",t.LINUX="Linux",t.IOS="iOS",t.MAC_OS="Mac OS",t.QNX="QNX",t.UNIX="UNIX",t.BEOS="BeOS",t.OS_2="OS/2",t.SEARCH_BOT="Search Bot"}(Zr||(Zr={})),function(t){t.CHROME="Chrome",t.SAFARI="Safari",t.EDGE="Edge",t.FIREFOX="Firefox",t.OPERA="OPR",t.QQ="QQBrowser",t.WECHAT="MicroMessenger"}(be||(be={}));const Up=new(a(function(t,e){/*!@license
	 * UAParser.js v0.7.28
	 * Lightweight JavaScript-based User-Agent string parser
	 * https://github.com/faisalman/ua-parser-js
	 *
	 * Copyright © 2012-2021 Faisal Salman <f@faisalman.com>
	 * Licensed under MIT License
	 */(function(n,o){var c="function",u="object",d="string",p="model",f="name",g="type",E="vendor",I="version",_="architecture",T="console",R="mobile",w="tablet",k="smarttv",L="wearable",Y="embedded",Z={extend:function(wt,Qt){var xt={};for(var ae in wt)Qt[ae]&&Qt[ae].length%2==0?xt[ae]=Qt[ae].concat(wt[ae]):xt[ae]=wt[ae];return xt},has:function(wt,Qt){return typeof wt===d&&Qt.toLowerCase().indexOf(wt.toLowerCase())!==-1},lowerize:function(wt){return wt.toLowerCase()},major:function(wt){return typeof wt===d?wt.replace(/[^\d\.]/g,"").split(".")[0]:o},trim:function(wt,Qt){return wt=wt.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),Qt===void 0?wt:wt.substring(0,255)}},rt={rgx:function(wt,Qt){for(var xt,ae,ge,re,wr,z,nt=0;nt<Qt.length&&!wr;){var gt=Qt[nt],It=Qt[nt+1];for(xt=ae=0;xt<gt.length&&!wr;)if(wr=gt[xt++].exec(wt))for(ge=0;ge<It.length;ge++)z=wr[++ae],typeof(re=It[ge])===u&&re.length>0?re.length==2?typeof re[1]==c?this[re[0]]=re[1].call(this,z):this[re[0]]=re[1]:re.length==3?typeof re[1]!==c||re[1].exec&&re[1].test?this[re[0]]=z?z.replace(re[1],re[2]):o:this[re[0]]=z?re[1].call(this,z,re[2]):o:re.length==4&&(this[re[0]]=z?re[3].call(this,z.replace(re[1],re[2])):o):this[re]=z||o;nt+=2}},str:function(wt,Qt){for(var xt in Qt)if(typeof Qt[xt]===u&&Qt[xt].length>0){for(var ae=0;ae<Qt[xt].length;ae++)if(Z.has(Qt[xt][ae],wt))return xt==="?"?o:xt}else if(Z.has(Qt[xt],wt))return xt==="?"?o:xt;return wt}},ut={browser:{oldSafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}},oldEdge:{version:{.1:"12.",21:"13.",31:"14.",39:"15.",41:"16.",42:"17.",44:"18."}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},At={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[I,[f,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[I,[f,"Edge"]],[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]{3,6})\b.+version\/([\w\.-]+)/i,/(opera)(?:.+version\/|[\/\s]+)([\w\.]+)/i],[f,I],[/opios[\/\s]+([\w\.]+)/i],[I,[f,"Opera Mini"]],[/\sopr\/([\w\.]+)/i],[I,[f,"Opera"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]*)/i,/(avant\s|iemobile|slim)(?:browser)?[\/\s]?([\w\.]*)/i,/(ba?idubrowser)[\/\s]?([\w\.]+)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon)\/([\w\.-]+)/i,/(rekonq|puffin|brave|whale|qqbrowserlite|qq)\/([\w\.]+)/i,/(weibo)__([\d\.]+)/i],[f,I],[/(?:[\s\/]uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],[I,[f,"UCBrowser"]],[/(?:windowswechat)?\sqbcore\/([\w\.]+)\b.*(?:windowswechat)?/i],[I,[f,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[I,[f,"WeChat"]],[/konqueror\/([\w\.]+)/i],[I,[f,"Konqueror"]],[/trident.+rv[:\s]([\w\.]{1,9})\b.+like\sgecko/i],[I,[f,"IE"]],[/yabrowser\/([\w\.]+)/i],[I,[f,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[f,/(.+)/,"$1 Secure Browser"],I],[/focus\/([\w\.]+)/i],[I,[f,"Firefox Focus"]],[/opt\/([\w\.]+)/i],[I,[f,"Opera Touch"]],[/coc_coc_browser\/([\w\.]+)/i],[I,[f,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[I,[f,"Dolphin"]],[/coast\/([\w\.]+)/i],[I,[f,"Opera Coast"]],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[I,[f,"MIUI Browser"]],[/fxios\/([\w\.-]+)/i],[I,[f,"Firefox"]],[/(qihu|qhbrowser|qihoobrowser|360browser)/i],[[f,"360 Browser"]],[/(oculus|samsung|sailfish)browser\/([\w\.]+)/i],[[f,/(.+)/,"$1 Browser"],I],[/(comodo_dragon)\/([\w\.]+)/i],[[f,/_/g," "],I],[/\s(electron)\/([\w\.]+)\ssafari/i,/(tesla)(?:\sqtcarbrowser|\/(20[12]\d\.[\w\.-]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/\s]?([\w\.]+)/i],[f,I],[/(MetaSr)[\/\s]?([\w\.]+)/i,/(LBBROWSER)/i],[f],[/;fbav\/([\w\.]+);/i],[I,[f,"Facebook"]],[/FBAN\/FBIOS|FB_IAB\/FB4A/i],[[f,"Facebook"]],[/safari\s(line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/\s]([\w\.-]+)/i],[f,I],[/\bgsa\/([\w\.]+)\s.*safari\//i],[I,[f,"GSA"]],[/headlesschrome(?:\/([\w\.]+)|\s)/i],[I,[f,"Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[f,"Chrome WebView"],I],[/droid.+\sversion\/([\w\.]+)\b.+(?:mobile\ssafari|safari)/i],[I,[f,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],[f,I],[/version\/([\w\.]+)\s.*mobile\/\w+\s(safari)/i],[I,[f,"Mobile Safari"]],[/version\/([\w\.]+)\s.*(mobile\s?safari|safari)/i],[I,f],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[f,[I,rt.str,ut.browser.oldSafari.version]],[/(webkit|khtml)\/([\w\.]+)/i],[f,I],[/(navigator|netscape)\/([\w\.-]+)/i],[[f,"Netscape"],I],[/ile\svr;\srv:([\w\.]+)\).+firefox/i],[I,[f,"Firefox Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([\w\.-]+)$/i,/(firefox)\/([\w\.]+)\s[\w\s\-]+\/[\w\.]+$/i,/(mozilla)\/([\w\.]+)\s.+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]*)/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[f,I]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[_,"amd64"]],[/(ia32(?=;))/i],[[_,Z.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[_,"ia32"]],[/\b(aarch64|armv?8e?l?)\b/i],[[_,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[_,"armhf"]],[/windows\s(ce|mobile);\sppc;/i],[[_,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[_,/ower/,"",Z.lowerize]],[/(sun4\w)[;\)]/i],[[_,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?:64|(?=v(?:[1-7]|[5-7]1)l?|;|eabi))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[_,Z.lowerize]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[pt]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus\s10)/i],[p,[E,"Samsung"],[g,w]],[/\b((?:s[cgp]h|gt|sm)-\w+|galaxy\snexus)/i,/\ssamsung[\s-]([\w-]+)/i,/sec-(sgh\w+)/i],[p,[E,"Samsung"],[g,R]],[/\((ip(?:hone|od)[\s\w]*);/i],[p,[E,"Apple"],[g,R]],[/\((ipad);[\w\s\),;-]+apple/i,/applecoremedia\/[\w\.]+\s\((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[p,[E,"Apple"],[g,w]],[/\b((?:agr|ags[23]|bah2?|sht?)-a?[lw]\d{2})/i],[p,[E,"Huawei"],[g,w]],[/d\/huawei([\w\s-]+)[;\)]/i,/\b(nexus\s6p|vog-[at]?l\d\d|ane-[at]?l[x\d]\d|eml-a?l\d\da?|lya-[at]?l\d[\dc]|clt-a?l\d\di?|ele-l\d\d)/i,/\b(\w{2,4}-[atu][ln][01259][019])[;\)\s]/i],[p,[E,"Huawei"],[g,R]],[/\b(poco[\s\w]+)(?:\sbuild|\))/i,/\b;\s(\w+)\sbuild\/hm\1/i,/\b(hm[\s\-_]?note?[\s_]?(?:\d\w)?)\sbuild/i,/\b(redmi[\s\-_]?(?:note|k)?[\w\s_]+)(?:\sbuild|\))/i,/\b(mi[\s\-_]?(?:a\d|one|one[\s_]plus|note lte)?[\s_]?(?:\d?\w?)[\s_]?(?:plus)?)\sbuild/i],[[p,/_/g," "],[E,"Xiaomi"],[g,R]],[/\b(mi[\s\-_]?(?:pad)(?:[\w\s_]+))(?:\sbuild|\))/i],[[p,/_/g," "],[E,"Xiaomi"],[g,w]],[/;\s(\w+)\sbuild.+\soppo/i,/\s(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007)\b/i],[p,[E,"OPPO"],[g,R]],[/\svivo\s(\w+)(?:\sbuild|\))/i,/\s(v[12]\d{3}\w?[at])(?:\sbuild|;)/i],[p,[E,"Vivo"],[g,R]],[/\s(rmx[12]\d{3})(?:\sbuild|;)/i],[p,[E,"Realme"],[g,R]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?:?(\s4g)?)\b[\w\s]+build\//i,/\smot(?:orola)?[\s-](\w*)/i,/((?:moto[\s\w\(\)]+|xt\d{3,4}|nexus\s6)(?=\sbuild|\)))/i],[p,[E,"Motorola"],[g,R]],[/\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[p,[E,"Motorola"],[g,w]],[/((?=lg)?[vl]k\-?\d{3})\sbuild|\s3\.[\s\w;-]{10}lg?-([06cv9]{3,4})/i],[p,[E,"LG"],[g,w]],[/(lm-?f100[nv]?|nexus\s[45])/i,/lg[e;\s\/-]+((?!browser|netcast)\w+)/i,/\blg(\-?[\d\w]+)\sbuild/i],[p,[E,"LG"],[g,R]],[/(ideatab[\w\-\s]+)/i,/lenovo\s?(s(?:5000|6000)(?:[\w-]+)|tab(?:[\s\w]+)|yt[\d\w-]{6}|tb[\d\w-]{6})/i],[p,[E,"Lenovo"],[g,w]],[/(?:maemo|nokia).*(n900|lumia\s\d+)/i,/nokia[\s_-]?([\w\.-]*)/i],[[p,/_/g," "],[E,"Nokia"],[g,R]],[/droid.+;\s(pixel\sc)[\s)]/i],[p,[E,"Google"],[g,w]],[/droid.+;\s(pixel[\s\daxl]{0,6})(?:\sbuild|\))/i],[p,[E,"Google"],[g,R]],[/droid.+\s([c-g]\d{4}|so[-l]\w+|xq-a\w[4-7][12])(?=\sbuild\/|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[p,[E,"Sony"],[g,R]],[/sony\stablet\s[ps]\sbuild\//i,/(?:sony)?sgp\w+(?:\sbuild\/|\))/i],[[p,"Xperia Tablet"],[E,"Sony"],[g,w]],[/\s(kb2005|in20[12]5|be20[12][59])\b/i,/\ba000(1)\sbuild/i,/\boneplus\s(a\d{4})[\s)]/i],[p,[E,"OnePlus"],[g,R]],[/(alexa)webm/i,/(kf[a-z]{2}wi)(\sbuild\/|\))/i,/(kf[a-z]+)(\sbuild\/|\)).+silk\//i],[p,[E,"Amazon"],[g,w]],[/(sd|kf)[0349hijorstuw]+(\sbuild\/|\)).+silk\//i],[[p,"Fire Phone"],[E,"Amazon"],[g,R]],[/\((playbook);[\w\s\),;-]+(rim)/i],[p,E,[g,w]],[/((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10;\s(\w+)/i],[p,[E,"BlackBerry"],[g,R]],[/(?:\b|asus_)(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus\s7|padfone|p00[cj])/i],[p,[E,"ASUS"],[g,w]],[/\s(z[es]6[027][01][km][ls]|zenfone\s\d\w?)\b/i],[p,[E,"ASUS"],[g,R]],[/(nexus\s9)/i],[p,[E,"HTC"],[g,w]],[/(htc)[;_\s-]{1,2}([\w\s]+(?=\)|\sbuild)|\w+)/i,/(zte)-(\w*)/i,/(alcatel|geeksphone|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]*)/i],[E,[p,/_/g," "],[g,R]],[/droid[x\d\.\s;]+\s([ab][1-7]\-?[0178a]\d\d?)/i],[p,[E,"Acer"],[g,w]],[/droid.+;\s(m[1-5]\snote)\sbuild/i,/\bmz-([\w-]{2,})/i],[p,[E,"Meizu"],[g,R]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]*)/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i,/(microsoft);\s(lumia[\s\w]+)/i,/(lenovo)[_\s-]?([\w-]+)/i,/linux;.+(jolla);/i,/droid.+;\s(oppo)\s?([\w\s]+)\sbuild/i],[E,p,[g,R]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i,/[;\/]\s?(le[\s\-]+pan)[\s\-]+(\w{1,9})\sbuild/i,/[;\/]\s?(trinity)[\-\s]*(t\d{3})\sbuild/i,/\b(gigaset)[\s\-]+(q\w{1,9})\sbuild/i,/\b(vodafone)\s([\w\s]+)(?:\)|\sbuild)/i],[E,p,[g,w]],[/\s(surface\sduo)\s/i],[p,[E,"Microsoft"],[g,w]],[/droid\s[\d\.]+;\s(fp\du?)\sbuild/i],[p,[E,"Fairphone"],[g,R]],[/\s(u304aa)\sbuild/i],[p,[E,"AT&T"],[g,R]],[/sie-(\w*)/i],[p,[E,"Siemens"],[g,R]],[/[;\/]\s?(rct\w+)\sbuild/i],[p,[E,"RCA"],[g,w]],[/[;\/\s](venue[\d\s]{2,7})\sbuild/i],[p,[E,"Dell"],[g,w]],[/[;\/]\s?(q(?:mv|ta)\w+)\sbuild/i],[p,[E,"Verizon"],[g,w]],[/[;\/]\s(?:barnes[&\s]+noble\s|bn[rt])([\w\s\+]*)\sbuild/i],[p,[E,"Barnes & Noble"],[g,w]],[/[;\/]\s(tm\d{3}\w+)\sbuild/i],[p,[E,"NuVision"],[g,w]],[/;\s(k88)\sbuild/i],[p,[E,"ZTE"],[g,w]],[/;\s(nx\d{3}j)\sbuild/i],[p,[E,"ZTE"],[g,R]],[/[;\/]\s?(gen\d{3})\sbuild.*49h/i],[p,[E,"Swiss"],[g,R]],[/[;\/]\s?(zur\d{3})\sbuild/i],[p,[E,"Swiss"],[g,w]],[/[;\/]\s?((zeki)?tb.*\b)\sbuild/i],[p,[E,"Zeki"],[g,w]],[/[;\/]\s([yr]\d{2})\sbuild/i,/[;\/]\s(dragon[\-\s]+touch\s|dt)(\w{5})\sbuild/i],[[E,"Dragon Touch"],p,[g,w]],[/[;\/]\s?(ns-?\w{0,9})\sbuild/i],[p,[E,"Insignia"],[g,w]],[/[;\/]\s?((nxa|Next)-?\w{0,9})\sbuild/i],[p,[E,"NextBook"],[g,w]],[/[;\/]\s?(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05]))\sbuild/i],[[E,"Voice"],p,[g,R]],[/[;\/]\s?(lvtel\-)?(v1[12])\sbuild/i],[[E,"LvTel"],p,[g,R]],[/;\s(ph-1)\s/i],[p,[E,"Essential"],[g,R]],[/[;\/]\s?(v(100md|700na|7011|917g).*\b)\sbuild/i],[p,[E,"Envizen"],[g,w]],[/[;\/]\s?(trio[\s\w\-\.]+)\sbuild/i],[p,[E,"MachSpeed"],[g,w]],[/[;\/]\s?tu_(1491)\sbuild/i],[p,[E,"Rotor"],[g,w]],[/(shield[\w\s]+)\sbuild/i],[p,[E,"Nvidia"],[g,w]],[/(sprint)\s(\w+)/i],[E,p,[g,R]],[/(kin\.[onetw]{3})/i],[[p,/\./g," "],[E,"Microsoft"],[g,R]],[/droid\s[\d\.]+;\s(cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[p,[E,"Zebra"],[g,w]],[/droid\s[\d\.]+;\s(ec30|ps20|tc[2-8]\d[kx])\)/i],[p,[E,"Zebra"],[g,R]],[/\s(ouya)\s/i,/(nintendo)\s([wids3utch]+)/i],[E,p,[g,T]],[/droid.+;\s(shield)\sbuild/i],[p,[E,"Nvidia"],[g,T]],[/(playstation\s[345portablevi]+)/i],[p,[E,"Sony"],[g,T]],[/[\s\(;](xbox(?:\sone)?(?!;\sxbox))[\s\);]/i],[p,[E,"Microsoft"],[g,T]],[/smart-tv.+(samsung)/i],[E,[g,k]],[/hbbtv.+maple;(\d+)/i],[[p,/^/,"SmartTV"],[E,"Samsung"],[g,k]],[/(?:linux;\snetcast.+smarttv|lg\snetcast\.tv-201\d)/i],[[E,"LG"],[g,k]],[/(apple)\s?tv/i],[E,[p,"Apple TV"],[g,k]],[/crkey/i],[[p,"Chromecast"],[E,"Google"],[g,k]],[/droid.+aft([\w])(\sbuild\/|\))/i],[p,[E,"Amazon"],[g,k]],[/\(dtv[\);].+(aquos)/i],[p,[E,"Sharp"],[g,k]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[E,Z.trim],[p,Z.trim],[g,k]],[/[\s\/\(](android\s|smart[-\s]?|opera\s)tv[;\)\s]/i],[[g,k]],[/((pebble))app\/[\d\.]+\s/i],[E,p,[g,L]],[/droid.+;\s(glass)\s\d/i],[p,[E,"Google"],[g,L]],[/droid\s[\d\.]+;\s(wt63?0{2,3})\)/i],[p,[E,"Zebra"],[g,L]],[/(tesla)(?:\sqtcarbrowser|\/20[12]\d\.[\w\.-]+)/i],[E,[g,Y]],[/droid .+?; ([^;]+?)(?: build|\) applewebkit).+? mobile safari/i],[p,[g,R]],[/droid .+?;\s([^;]+?)(?: build|\) applewebkit).+?(?! mobile) safari/i],[p,[g,w]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[g,Z.lowerize]],[/(android[\w\.\s\-]{0,9});.+build/i],[p,[E,"Generic"]],[/(phone)/i],[[g,R]]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[I,[f,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[I,[f,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[f,I],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[I,f]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[f,I],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s\w]*)/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)(?!.+xbox)/i],[f,[I,rt.str,ut.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[f,"Windows"],[I,rt.str,ut.os.windows.version]],[/ip[honead]{2,4}\b(?:.*os\s([\w]+)\slike\smac|;\sopera)/i,/cfnetwork\/.+darwin/i],[[I,/_/g,"."],[f,"iOS"]],[/(mac\sos\sx)\s?([\w\s\.]*)/i,/(macintosh|mac(?=_powerpc)\s)(?!.+haiku)/i],[[f,"Mac OS"],[I,/_/g,"."]],[/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|sailfish|contiki)[\/\s-]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/\s]([\w\.]+)/i,/\((series40);/i],[f,I],[/\(bb(10);/i],[I,[f,"BlackBerry"]],[/(?:symbian\s?os|symbos|s60(?=;)|series60)[\/\s-]?([\w\.]*)/i],[I,[f,"Symbian"]],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[f,"Firefox OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[I,[f,"webOS"]],[/crkey\/([\d\.]+)/i],[I,[f,"Chromecast"]],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[f,"Chromium OS"],I],[/(nintendo|playstation)\s([wids345portablevuch]+)/i,/(xbox);\s+xbox\s([^\);]+)/i,/(mint)[\/\s\(\)]?(\w*)/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?=\slinux)|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus|raspbian)(?:\sgnu\/linux)?(?:\slinux)?[\/\s-]?(?!chrom|package)([\w\.-]*)/i,/(hurd|linux)\s?([\w\.]*)/i,/(gnu)\s?([\w\.]*)/i,/\s([frentopc-]{0,4}bsd|dragonfly)\s?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku)\s(\w+)/i],[f,I],[/(sunos)\s?([\w\.\d]*)/i],[[f,"Solaris"],I],[/((?:open)?solaris)[\/\s-]?([\w\.]*)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.])*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms|fuchsia)/i,/(unix)\s?([\w\.]*)/i],[f,I]]},Ct=function(wt,Qt){if(typeof wt=="object"&&(Qt=wt,wt=o),!(this instanceof Ct))return new Ct(wt,Qt).getResult();var xt=wt||(n!==void 0&&n.navigator&&n.navigator.userAgent?n.navigator.userAgent:""),ae=Qt?Z.extend(At,Qt):At;return this.getBrowser=function(){var ge={name:o,version:o};return rt.rgx.call(ge,xt,ae.browser),ge.major=Z.major(ge.version),ge},this.getCPU=function(){var ge={architecture:o};return rt.rgx.call(ge,xt,ae.cpu),ge},this.getDevice=function(){var ge={vendor:o,model:o,type:o};return rt.rgx.call(ge,xt,ae.device),ge},this.getEngine=function(){var ge={name:o,version:o};return rt.rgx.call(ge,xt,ae.engine),ge},this.getOS=function(){var ge={name:o,version:o};return rt.rgx.call(ge,xt,ae.os),ge},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return xt},this.setUA=function(ge){return xt=typeof ge===d&&ge.length>255?Z.trim(ge,255):ge,this},this.setUA(xt),this};Ct.VERSION="0.7.28",Ct.BROWSER={NAME:f,MAJOR:"major",VERSION:I},Ct.CPU={ARCHITECTURE:_},Ct.DEVICE={MODEL:p,VENDOR:E,TYPE:g,CONSOLE:T,MOBILE:R,SMARTTV:k,TABLET:w,WEARABLE:L,EMBEDDED:Y},Ct.ENGINE={NAME:f,VERSION:I},Ct.OS={NAME:f,VERSION:I},t.exports&&(e=t.exports=Ct),e.UAParser=Ct;var lt=n!==void 0&&(n.jQuery||n.Zepto);if(lt&&!lt.ua){var Gt=new Ct;lt.ua=Gt.getResult(),lt.ua.get=function(){return Gt.getUA()},lt.ua.set=function(wt){Gt.setUA(wt);var Qt=Gt.getResult();for(var xt in Qt)lt.ua[xt]=Qt[xt]}}})(typeof window=="object"?window:s)}));let as=Up.getResult();function Ke(t){return t&&Up.setUA(t),as=Up.getResult(),{name:Vw(as),version:Gw(as),os:jw(as),osVersion:as.os.version}}function Vw(t){if(t.engine.name==="Blink"&&t.browser.name!=="WeChat")return be.CHROME;switch(t.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return be.CHROME;case"Safari":case"Mobile Safari":return be.SAFARI;case"Edge":return be.EDGE;case"Firefox":return be.FIREFOX;case"QQBrowser":return be.QQ;case"Opera":return be.OPERA;case"WeChat":return be.WECHAT;default:return t.browser.name||""}}function Gw(t){let e;return e=t.engine.name==="Blink"?t.engine.version||"":t.browser.version||"",e.split(".")[0]}function jw(t){switch(t.os.name){case"Windows":return t.os.version?t.os.name+" "+t.os.version:t.os.name;default:return t.os.name||""}}function rI(){return Ke().os}function Hu(){const t=Ke();return!!(as.engine.name==="WebKit"&&t.os===Zr.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&t.name!==be.SAFARI||vi()&&t.name!==be.SAFARI)}function Kw(){const t=Ke();if(Hu()){if(t.os===Zr.MAC_OS)return!0;if(t.os===Zr.IOS){const e=as.os.version&&as.os.version.split(".");if(e&&Number(e[0])===14&&e[1]&&Number(e[1])>=3||e&&Number(e[0])>14)return!0}}return!1}function Hw(){return as.engine.name==="WebKit"}function Wu(){return Ke().name===be.CHROME}function Ei(){return Ke().name===be.SAFARI}function si(){return Ke().name===be.FIREFOX}function vi(){return Ke().os===Zr.IOS}function lc(){const t=Ke();if(t.os!==Zr.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===15}function nI(){const t=Ke();if(t.os!==Zr.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===15&&Number(e[1])===0}function iI(){const t=Ke();if(t.os!==Zr.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===15&&Number(e[1])>=1}function Qp(){const t=Ke();if(t.os!==Zr.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===15&&Number(e[1])>=2}function cs(){return Ei()&&navigator.maxTouchPoints>0}function oI(){return Ke().name===be.WECHAT}function sI(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function uc(){const t=Ke();return t.name===be.EDGE||t.name===be.SAFARI?!1:!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function aI(){return Ke().os===Zr.ANDROID}jt({target:"Date",stat:!0},{now:function(){return new Date().getTime()}});var kt=le.Date.now,Ww=[].slice,Yw=/MSIE .\./.test(za),cI=function(t){return function(e,n){var o=arguments.length>2,c=o?Ww.call(arguments,2):void 0;return t(o?function(){(typeof e=="function"?e:Function(e)).apply(this,c)}:e,n)}};jt({global:!0,bind:!0,forced:Yw},{setTimeout:cI(h.setTimeout),setInterval:cI(h.setInterval)});var Vr=le.setTimeout,lI=function(t,e){return function(){for(var n=new Array(arguments.length),o=0;o<n.length;o++)n[o]=arguments[o];return t.apply(e,n)}},dc=Object.prototype.toString;function uI(t){return dc.call(t)==="[object Array]"}function dI(t){return t!==null&&typeof t=="object"}function hI(t){return dc.call(t)==="[object Function]"}function Yu(t,e){if(t!=null)if(typeof t!="object"&&(t=[t]),uI(t))for(var n=0,o=t.length;n<o;n++)e.call(null,t[n],n,t);else for(var c in t)Object.prototype.hasOwnProperty.call(t,c)&&e.call(null,t[c],c,t)}var ie={isArray:uI,isArrayBuffer:function(t){return dc.call(t)==="[object ArrayBuffer]"},isBuffer:function(t){return t!=null&&t.constructor!=null&&typeof t.constructor.isBuffer=="function"&&t.constructor.isBuffer(t)},isFormData:function(t){return typeof FormData!="undefined"&&t instanceof FormData},isArrayBufferView:function(t){return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&t.buffer instanceof ArrayBuffer},isString:function(t){return typeof t=="string"},isNumber:function(t){return typeof t=="number"},isObject:dI,isUndefined:function(t){return t===void 0},isDate:function(t){return dc.call(t)==="[object Date]"},isFile:function(t){return dc.call(t)==="[object File]"},isBlob:function(t){return dc.call(t)==="[object Blob]"},isFunction:hI,isStream:function(t){return dI(t)&&hI(t.pipe)},isURLSearchParams:function(t){return typeof URLSearchParams!="undefined"&&t instanceof URLSearchParams},isStandardBrowserEnv:function(){return(typeof navigator=="undefined"||navigator.product!=="ReactNative"&&navigator.product!=="NativeScript"&&navigator.product!=="NS")&&typeof window!="undefined"&&typeof document!="undefined"},forEach:Yu,merge:function t(){var e={};function n(u,d){typeof e[d]=="object"&&typeof u=="object"?e[d]=t(e[d],u):e[d]=u}for(var o=0,c=arguments.length;o<c;o++)Yu(arguments[o],n);return e},deepMerge:function t(){var e={};function n(u,d){typeof e[d]=="object"&&typeof u=="object"?e[d]=t(e[d],u):e[d]=typeof u=="object"?t({},u):u}for(var o=0,c=arguments.length;o<c;o++)Yu(arguments[o],n);return e},extend:function(t,e,n){return Yu(e,function(o,c){t[c]=n&&typeof o=="function"?lI(o,n):o}),t},trim:function(t){return t.replace(/^\s*/,"").replace(/\s*$/,"")}};function pI(t){return encodeURIComponent(t).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var AI=function(t,e,n){if(!e)return t;var o;if(n)o=n(e);else if(ie.isURLSearchParams(e))o=e.toString();else{var c=[];ie.forEach(e,function(d,p){d!=null&&(ie.isArray(d)?p+="[]":d=[d],ie.forEach(d,function(f){ie.isDate(f)?f=f.toISOString():ie.isObject(f)&&(f=JSON.stringify(f)),c.push(pI(p)+"="+pI(f))}))}),o=c.join("&")}if(o){var u=t.indexOf("#");u!==-1&&(t=t.slice(0,u)),t+=(t.indexOf("?")===-1?"?":"&")+o}return t};function qu(){this.handlers=[]}qu.prototype.use=function(t,e){return this.handlers.push({fulfilled:t,rejected:e}),this.handlers.length-1},qu.prototype.eject=function(t){this.handlers[t]&&(this.handlers[t]=null)},qu.prototype.forEach=function(t){ie.forEach(this.handlers,function(e){e!==null&&t(e)})};var fI=qu,Fp=function(t,e,n){return ie.forEach(n,function(o){t=o(t,e)}),t},gI=function(t){return!(!t||!t.__CANCEL__)},mI=function(t,e){ie.forEach(t,function(n,o){o!==e&&o.toUpperCase()===e.toUpperCase()&&(t[e]=n,delete t[o])})},Ju=function(t,e,n,o,c){return function(u,d,p,f,g){return u.config=d,p&&(u.code=p),u.request=f,u.response=g,u.isAxiosError=!0,u.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},u}(new Error(t),e,n,o,c)},qw=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],Jw=ie.isStandardBrowserEnv()?function(){var t,e=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function o(c){var u=c;return e&&(n.setAttribute("href",u),u=n.href),n.setAttribute("href",u),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:n.pathname.charAt(0)==="/"?n.pathname:"/"+n.pathname}}return t=o(window.location.href),function(c){var u=ie.isString(c)?o(c):c;return u.protocol===t.protocol&&u.host===t.host}}():function(){return!0},zw=ie.isStandardBrowserEnv()?{write:function(t,e,n,o,c,u){var d=[];d.push(t+"="+encodeURIComponent(e)),ie.isNumber(n)&&d.push("expires="+new Date(n).toGMTString()),ie.isString(o)&&d.push("path="+o),ie.isString(c)&&d.push("domain="+c),u===!0&&d.push("secure"),document.cookie=d.join("; ")},read:function(t){var e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},Xw=function(t){return new Promise(function(e,n){var o=t.data,c=t.headers;ie.isFormData(o)&&delete c["Content-Type"];var u=new XMLHttpRequest;if(t.auth){var d=t.auth.username||"",p=t.auth.password||"";c.Authorization="Basic "+btoa(d+":"+p)}if(u.open(t.method.toUpperCase(),AI(t.url,t.params,t.paramsSerializer),!0),u.timeout=t.timeout,u.onreadystatechange=function(){if(u&&u.readyState===4&&(u.status!==0||u.responseURL&&u.responseURL.indexOf("file:")===0)){var E,I,_,T,R,w="getAllResponseHeaders"in u?(E=u.getAllResponseHeaders(),R={},E&&ie.forEach(E.split(`
`),function(L){if(T=L.indexOf(":"),I=ie.trim(L.substr(0,T)).toLowerCase(),_=ie.trim(L.substr(T+1)),I){if(R[I]&&qw.indexOf(I)>=0)return;R[I]=I==="set-cookie"?(R[I]?R[I]:[]).concat([_]):R[I]?R[I]+", "+_:_}}),R):null,k={data:t.responseType&&t.responseType!=="text"?u.response:u.responseText,status:u.status,statusText:u.statusText,headers:w,config:t,request:u};(function(L,Y,Z){var rt=Z.config.validateStatus;!rt||rt(Z.status)?L(Z):Y(Ju("Request failed with status code "+Z.status,Z.config,null,Z.request,Z))})(e,n,k),u=null}},u.onabort=function(){u&&(n(Ju("Request aborted",t,"ECONNABORTED",u)),u=null)},u.onerror=function(){n(Ju("Network Error",t,null,u)),u=null},u.ontimeout=function(){n(Ju("timeout of "+t.timeout+"ms exceeded",t,"ECONNABORTED",u)),u=null},ie.isStandardBrowserEnv()){var f=zw,g=(t.withCredentials||Jw(t.url))&&t.xsrfCookieName?f.read(t.xsrfCookieName):void 0;g&&(c[t.xsrfHeaderName]=g)}if("setRequestHeader"in u&&ie.forEach(c,function(E,I){o===void 0&&I.toLowerCase()==="content-type"?delete c[I]:u.setRequestHeader(I,E)}),t.withCredentials&&(u.withCredentials=!0),t.responseType)try{u.responseType=t.responseType}catch(E){if(t.responseType!=="json")throw E}typeof t.onDownloadProgress=="function"&&u.addEventListener("progress",t.onDownloadProgress),typeof t.onUploadProgress=="function"&&u.upload&&u.upload.addEventListener("progress",t.onUploadProgress),t.cancelToken&&t.cancelToken.promise.then(function(E){u&&(u.abort(),n(E),u=null)}),o===void 0&&(o=null),u.send(o)})},Zw={"Content-Type":"application/x-www-form-urlencoded"};function EI(t,e){!ie.isUndefined(t)&&ie.isUndefined(t["Content-Type"])&&(t["Content-Type"]=e)}var vI,zu={adapter:((typeof process!="undefined"&&Object.prototype.toString.call(process)==="[object process]"||typeof XMLHttpRequest!="undefined")&&(vI=Xw),vI),transformRequest:[function(t,e){return mI(e,"Accept"),mI(e,"Content-Type"),ie.isFormData(t)||ie.isArrayBuffer(t)||ie.isBuffer(t)||ie.isStream(t)||ie.isFile(t)||ie.isBlob(t)?t:ie.isArrayBufferView(t)?t.buffer:ie.isURLSearchParams(t)?(EI(e,"application/x-www-form-urlencoded;charset=utf-8"),t.toString()):ie.isObject(t)?(EI(e,"application/json;charset=utf-8"),JSON.stringify(t)):t}],transformResponse:[function(t){if(typeof t=="string")try{t=JSON.parse(t)}catch{}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(t){return t>=200&&t<300}};zu.headers={common:{Accept:"application/json, text/plain, */*"}},ie.forEach(["delete","get","head"],function(t){zu.headers[t]={}}),ie.forEach(["post","put","patch"],function(t){zu.headers[t]=ie.merge(Zw)});var II=zu;function Vp(t){t.cancelToken&&t.cancelToken.throwIfRequested()}var $w=function(t){var e,n;return Vp(t),t.baseURL&&!function(o){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(o)}(t.url)&&(t.url=(e=t.baseURL,(n=t.url)?e.replace(/\/+$/,"")+"/"+n.replace(/^\/+/,""):e)),t.headers=t.headers||{},t.data=Fp(t.data,t.headers,t.transformRequest),t.headers=ie.merge(t.headers.common||{},t.headers[t.method]||{},t.headers||{}),ie.forEach(["delete","get","head","post","put","patch","common"],function(o){delete t.headers[o]}),(t.adapter||II.adapter)(t).then(function(o){return Vp(t),o.data=Fp(o.data,o.headers,t.transformResponse),o},function(o){return gI(o)||(Vp(t),o&&o.response&&(o.response.data=Fp(o.response.data,o.response.headers,t.transformResponse))),Promise.reject(o)})},Gp=function(t,e){e=e||{};var n={};return ie.forEach(["url","method","params","data"],function(o){e[o]!==void 0&&(n[o]=e[o])}),ie.forEach(["headers","auth","proxy"],function(o){ie.isObject(e[o])?n[o]=ie.deepMerge(t[o],e[o]):e[o]!==void 0?n[o]=e[o]:ie.isObject(t[o])?n[o]=ie.deepMerge(t[o]):t[o]!==void 0&&(n[o]=t[o])}),ie.forEach(["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","maxContentLength","validateStatus","maxRedirects","httpAgent","httpsAgent","cancelToken","socketPath"],function(o){e[o]!==void 0?n[o]=e[o]:t[o]!==void 0&&(n[o]=t[o])}),n};function gl(t){this.defaults=t,this.interceptors={request:new fI,response:new fI}}gl.prototype.request=function(t){typeof t=="string"?(t=arguments[1]||{}).url=arguments[0]:t=t||{},(t=Gp(this.defaults,t)).method=t.method?t.method.toLowerCase():"get";var e=[$w,void 0],n=Promise.resolve(t);for(this.interceptors.request.forEach(function(o){e.unshift(o.fulfilled,o.rejected)}),this.interceptors.response.forEach(function(o){e.push(o.fulfilled,o.rejected)});e.length;)n=n.then(e.shift(),e.shift());return n},gl.prototype.getUri=function(t){return t=Gp(this.defaults,t),AI(t.url,t.params,t.paramsSerializer).replace(/^\?/,"")},ie.forEach(["delete","get","head","options"],function(t){gl.prototype[t]=function(e,n){return this.request(ie.merge(n||{},{method:t,url:e}))}}),ie.forEach(["post","put","patch"],function(t){gl.prototype[t]=function(e,n,o){return this.request(ie.merge(o||{},{method:t,url:e,data:n}))}});var Xu=gl;function jp(t){this.message=t}jp.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},jp.prototype.__CANCEL__=!0;var CI=jp;function Zu(t){if(typeof t!="function")throw new TypeError("executor must be a function.");var e;this.promise=new Promise(function(o){e=o});var n=this;t(function(o){n.reason||(n.reason=new CI(o),e(n.reason))})}Zu.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},Zu.source=function(){var t;return{token:new Zu(function(e){t=e}),cancel:t}};var t2=Zu;function _I(t){var e=new Xu(t),n=lI(Xu.prototype.request,e);return ie.extend(n,Xu.prototype,e),ie.extend(n,e),n}var Qo=_I(II);Qo.Axios=Xu,Qo.create=function(t){return _I(Gp(Qo.defaults,t))},Qo.Cancel=CI,Qo.CancelToken=t2,Qo.isCancel=gI,Qo.all=function(t){return Promise.all(t)},Qo.spread=function(t){return function(e){return t.apply(null,e)}};var yI=Qo,e2=Qo;yI.default=e2;var yo=yI;class r2{constructor(e){this.prefixLists=[],this.logger=e}debug(...e){this.logger.debug(...this.prefixLists,...e)}info(...e){this.logger.info(...this.prefixLists,...e)}warning(...e){this.logger.warning(...this.prefixLists,...e)}error(...e){this.logger.error(...this.prefixLists,...e)}prefix(e){return this.prefixLists.push(e),this}popPrefix(){return this.prefixLists.pop(),this}}class Gr{constructor(){this._events={},this.addListener=this.on}getListeners(e){var n;return this._events[e]?ht(n=this._events[e]).call(n,o=>o.listener):[]}on(e,n){this._events[e]||(this._events[e]=[]);const o=this._events[e];this._indexOfListener(o,n)===-1&&o.push({listener:n,once:!1})}once(e,n){this._events[e]||(this._events[e]=[]);const o=this._events[e];this._indexOfListener(o,n)===-1&&o.push({listener:n,once:!0})}off(e,n){if(!this._events[e])return;const o=this._events[e],c=this._indexOfListener(o,n);c!==-1&&Ze(o).call(o,c,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e,...n){var o;this._events[e]||(this._events[e]=[]);const c=ht(o=this._events[e]).call(o,u=>u);for(let u=0;u<c.length;u+=1){const d=c[u];d.once&&this.off(e,d.listener),d.listener.apply(this,n||[])}}_indexOfListener(e,n){let o=e.length;for(;o--;)if(e[o].listener===n)return o;return-1}}const $u=new class extends Gr{reportLogUploadError(t){this.emit("REPORT_LOG_UPLOAD",t)}};var U;(function(t){t.UNEXPECTED_ERROR="UNEXPECTED_ERROR",t.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",t.TIMEOUT="TIMEOUT",t.INVALID_PARAMS="INVALID_PARAMS",t.NOT_READABLE="NOT_READABLE",t.NOT_SUPPORTED="NOT_SUPPORTED",t.INVALID_OPERATION="INVALID_OPERATION",t.OPERATION_ABORTED="OPERATION_ABORTED",t.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",t.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",t.NETWORK_ERROR="NETWORK_ERROR",t.NETWORK_TIMEOUT="NETWORK_TIMEOUT",t.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",t.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",t.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",t.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",t.ELECTRON_IS_NULL="ELECTRON_IS_NULL",t.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",t.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",t.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",t.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",t.PERMISSION_DENIED="PERMISSION_DENIED",t.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",t.TRACK_IS_DISABLED="TRACK_IS_DISABLED",t.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",t.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",t.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",t.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",t.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",t.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",t.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",t.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",t.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",t.UID_CONFLICT="UID_CONFLICT",t.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",t.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",t.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",t.INVALID_TRACK="INVALID_TRACK",t.SENDER_NOT_FOUND="SENDER_NOT_FOUND",t.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",t.SET_ANSWER_FAILED="SET_ANSWER_FAILED",t.ICE_FAILED="ICE_FAILED",t.PC_CLOSED="PC_CLOSED",t.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",t.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",t.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",t.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",t.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",t.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",t.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",t.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",t.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",t.INVALID_REMOTE_USER="INVALID_REMOTE_USER",t.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",t.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",t.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",t.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",t.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",t.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",t.WS_ABORT="WS_ABORT",t.WS_DISCONNECT="WS_DISCONNECT",t.WS_ERR="WS_ERR",t.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",t.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",t.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",t.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",t.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",t.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",t.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",t.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",t.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",t.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",t.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",t.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",t.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",t.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",t.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",t.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",t.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",t.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",t.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",t.INVALID_PLUGIN="INVALID_PLUGIN",t.DISCONNECT_P2P="DISCONNECT_P2P",t.INIT_WEBSOCKET_TIMEOUT="INIT_WEBSOCKET_TIMEOUT"})(U||(U={}));class Q extends Error{constructor(e,n="",o){var c;super(n),this.name="AgoraRTCException",this.code=e,this.message=M(c="AgoraRTCError ".concat(this.code,": ")).call(c,n),this.data=o}toString(){var e;return this.data?M(e="data: ".concat(at(this.data),`
`)).call(e,this.stack):"".concat(this.stack)}print(e="error"){return e==="error"&&N.error(this.toString()),e==="warning"&&N.warning(this.toString()),this}throw(){throw this.print(),this}}const Cr={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function Kp(t,e){const n=e.timeout*Math.pow(e.timeoutFactor,t);return Math.min(e.maxRetryTimeout,n)}function Li(t,e,n,o){const c=Ir({},Cr,o);let u=c.timeout;const d=async()=>{await function(g){return new ct(E=>{window.setTimeout(E,g)})}(u),u*=c.timeoutFactor,u=Math.min(c.maxRetryTimeout,u)};let p=!1;const f=new ct(async(g,E)=>{e=e||(()=>!1),n=n||(()=>!0);for(let I=0;I<c.maxRetryCount;I+=1){if(p)return E(new Q(U.OPERATION_ABORTED));try{const _=await t();if(!e(_,I)||I+1===c.maxRetryCount)return g(_);await d()}catch(_){if(!n(_,I)||I+1===c.maxRetryCount)return E(_);await d()}}});return f.cancel=()=>p=!0,f}function Hp(){const t=new Date;return t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}const Mi={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},td=kt(),Wp=t=>{for(const e in Mi)if(Object.prototype.hasOwnProperty.call(Mi,e)&&Mi[e]===t)return e;return"DEFAULT"},N=new class{constructor(){this.logLevel=Mi.DEBUG,this.uploadState="collecting",this.uploadLogWaitingList=[],this.uploadLogUploadingList=[],this.uploadErrorCount=0,this.currentLogID=0}debug(...t){var e;const n=M(e=[Mi.DEBUG]).call(e,t);this.log.apply(this,n)}info(...t){var e;const n=M(e=[Mi.INFO]).call(e,t);this.log.apply(this,n)}warning(...t){var e;const n=M(e=[Mi.WARNING]).call(e,t);this.log.apply(this,n)}error(...t){var e;const n=M(e=[Mi.ERROR]).call(e,t);this.log.apply(this,n)}upload(...t){var e;const n=M(e=[Mi.DEBUG]).call(e,t);this.uploadLog.apply(this,n)}setLogLevel(t){t=Math.min(Math.max(0,t),4),this.logLevel=t}enableLogUpload(){In("UPLOAD_LOG",!0)}disableLogUpload(){In("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(t){this.proxyServerURL=t}prefix(t){return new r2(this).prefix(t)}log(...t){var e,n,o,c;if(kt()-td<100)return void Vr(()=>{this.log(...t)},kt()-td);const u=Math.max(0,Math.min(4,t[0]));if(t[0]=Hp()+" Agora-SDK [".concat(Wp(u),"]:"),this.appendLogToWaitingList(u,t),u<this.logLevel)return;const d=Hp()+" %cAgora-SDK [".concat(Wp(u),"]:");let p=[];if(!ot("USE_NEW_LOG"))switch(u){case Mi.DEBUG:p=M(e=[d,"color: #64B5F6;"]).call(e,Mr(t).call(t,1)),console.log.apply(console,p);break;case Mi.INFO:p=M(n=[d,"color: #1E88E5; font-weight: bold;"]).call(n,Mr(t).call(t,1)),console.log.apply(console,p);break;case Mi.WARNING:p=M(o=[d,"color: #FB8C00; font-weight: bold;"]).call(o,Mr(t).call(t,1)),console.warn.apply(console,p);break;case Mi.ERROR:p=M(c=[d,"color: #B00020; font-weight: bold;"]).call(c,Mr(t).call(t,1)),console.error.apply(console,p)}}uploadLog(...t){if(kt()-td<100)return void Vr(()=>{this.uploadLog(...t)},kt()-td);const e=Math.max(0,Math.min(4,t[0]));t[0]=Hp()+" Agora-SDK [".concat(Wp(e),"]:"),this.appendLogToWaitingList(e,t)}appendLogToWaitingList(t,...e){if(!ot("UPLOAD_LOG"))return;let n="";G(e).call(e,o=>{typeof o=="object"&&(o=at(o)),n+="".concat(o," ")}),this.uploadLogWaitingList.push({payload_str:n,log_level:t,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const t=this.uploadLogUploadingList,e={sdk_version:Yn,process_id:ot("PROCESS_ID"),payload:at(t)};return Li(async()=>{var n;const o=await yo.post(this.url||(this.proxyServerURL?M(n="https://".concat(this.proxyServerURL,"/ls/?h=")).call(n,ot("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(ot("LOG_UPLOAD_SERVER"),"/upload/v1")),e,{responseType:"text"});if(o.data!=="OK"){const c=new Error("unexpected upload log response");throw c.response=o,c}},()=>(this.uploadLogUploadingList=[],!1),n=>(n.response?$u.reportLogUploadError({status:n.response.status,data:n.response.data,headers:n.response.headers,message:n.message}):n.request?$u.reportLogUploadError({status:n.request.status,message:n.message}):$u.reportLogUploadError({status:-1,message:n.message}),!0),{timeout:2e3,maxRetryTimeout:2e4})}uploadLogInterval(){if(this.uploadLogUploadingList.length!==0||this.uploadLogWaitingList.length!==0){var t;this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=Ze(t=this.uploadLogWaitingList).call(t,0,10)),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),3e3)}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),200):window.setTimeout(()=>this.uploadLogInterval(),1e3)})}}};jt({target:"Array",stat:!0},{isArray:Me});var sn=le.Array.isArray;const ed={debug:console.log,info:console.log,warning:console.warn,error:console.error},rd={debug:"color: #64B5F6;",info:"color: #1E88E5; font-weight: bold;",warning:"color: #FB8C00; font-weight: bold;",error:"color: #B00020; font-weight: bold;"},n2={debug:0,info:1,warning:2,error:3},hc=[];let Yp,SI=0,TI=0,RI=!1;function nd(){const t=new Date;return[t.getTime(),t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()]}function id(t){if(!ot("UPLOAD_LOG"))return;let e;switch(t.type){case Ve.MISC:e=[t.timestamp,t.level,t.type,t.module,t.instanceId,[t.msg]];break;case Ve.INTERNAL_EVENT:case Ve.PUBLIC_EVENT:case Ve.WEB_EVENT:e=[t.timestamp,t.level,t.type,t.module,t.instanceId,[t.event,t.msg]];break;case Ve.INTERNAL_API:case Ve.PUBLIC_API:case Ve.WEB_API:e=[t.timestamp,t.level,t.type,t.module,t.instanceId,[t.api,t.args,t.result]]}hc.push(e)}function wI(t,e){var n;const[o,c]=nd(),u="warning",d=M(n="".concat(c," %cAgora-SDK [")).call(n,u,"] [INTERNAL API]:"),p={[Ve.WEB_API]:"logWebAPI",[Ve.PUBLIC_API]:"logPublicAPI",[Ve.INTERNAL_API]:"logInternalAPI",[Ve.WEB_EVENT]:"logWebEvent",[Ve.PUBLIC_EVENT]:"logPublicEvent",[Ve.INTERNAL_EVENT]:"logInternalEvent",[Ve.MISC]:"logMisc"}[t],f=[d,rd.warning,"Log.".concat(p),e];ot("USE_NEW_LOG")&&(od(u)&&ed.warning.apply(console,f),id({timestamp:o,level:u,module:"Log",instanceId:void 0,type:Ve.INTERNAL_API,api:p,args:void 0,result:e.toString()}))}function qp(t){if(sn(t)){let[o,c]=t;return o||(o="Global"),{module:o,instanceId:c}}let e,n;if(typeof t.__moduleName!="string")throw new Error("Cannot get __moduleName from log instance.");e=t.__moduleName;try{n=t.__instanceId}catch{throw new Error("Cannot get __instanceId from log instance.")}return{module:e,instanceId:n}}function od(t){return n2[t]>=TI}function Jp(t,e,n,o,c,u){if(t===Ve.PUBLIC_API||t===Ve.WEB_API||t===Ve.INTERNAL_API)try{var d,p,f,g;const{module:E,instanceId:I}=qp(n);c=c&&at(c),u=u instanceof Error?u.toString():u&&at(u);const[_,T]=nd(),R=[M(d=M(p="".concat(T," %cAgora-SDK [")).call(p,e,"] [")).call(d,{[Ve.PUBLIC_API]:"PUBLIC API",[Ve.WEB_API]:"WEB API",[Ve.INTERNAL_API]:"INTERNAL API"}[t],"]:"),rd[e],M(f=M(g="".concat(E)).call(g,I?"<".concat(I,">"):"",".")).call(f,o),c,u];ot("USE_NEW_LOG")&&(od(e)&&ed[e].apply(console,R),id({timestamp:_,level:e,module:E,instanceId:I,type:t,api:o,args:c,result:u}))}catch(E){wI(t,E)}}function zp(t,e,n,o,c){if(t===Ve.WEB_EVENT||t===Ve.INTERNAL_EVENT||t===Ve.PUBLIC_EVENT)try{var u,d,p,f;const{module:g,instanceId:E}=qp(n);typeof c!="string"&&(c=c instanceof Error?c.toString():at(c));const[I,_]=nd(),T=[M(u=M(d="".concat(_," %cAgora-SDK [")).call(d,e,"] [")).call(u,{[Ve.WEB_EVENT]:"WEB EVENT",[Ve.PUBLIC_EVENT]:"PUBLIC EVENT",[Ve.INTERNAL_EVENT]:"INTERNAL EVENT"}[t],"]:"),rd[e],M(p=M(f="".concat(g)).call(f,E?"<".concat(E,">"):"",".on(")).call(p,o,")"),c||""];ot("USE_NEW_LOG")&&(od(e)&&ed[e].apply(console,T),id({timestamp:I,level:e,module:g,instanceId:E,type:t,event:o,msg:c}))}catch(g){wI(t,g)}}function pc(t){Yp=t}function Lt(t,e,n){try{var o,c;const{module:u,instanceId:d}=qp(e),[p,f]=nd(),g=[M(o="".concat(f," %cAgora-SDK [")).call(o,t,"] [MISC]:"),rd[t],M(c="".concat(u)).call(c,d?"<".concat(d,">"):""),'"'.concat(n,'"')];ot("USE_NEW_LOG")&&(od(t)&&ed[t].apply(console,g),id({timestamp:p,level:t,module:u,instanceId:d,type:Ve.MISC,msg:n}))}catch(u){st("warning",["log"],"logMisc",void 0,u)}}function nr(t,e,n,o){zp(Ve.INTERNAL_EVENT,t,e,n,o)}function zi(t,e,n,o){zp(Ve.PUBLIC_EVENT,t,e,n,o)}function ls(t,e,n,o){zp(Ve.WEB_EVENT,t,e,n,o)}function st(t,e,n,o,c){Jp(Ve.INTERNAL_API,t,e,n,o,c)}function Ac(t,e,n,o,c){Jp(Ve.WEB_API,t,e,n,o,c)}function Wt(t,e,n,o,c){Jp(Ve.PUBLIC_API,t,e,n,o,c)}function an(t,e){return function(n){return class extends n{get __moduleName(){return t}get __instanceId(){if(e){if(typeof this[e]=="function")return this[e]();{const o=e.split(".");return o.length>0?ol(o).call(o,(c,u)=>{try{return c&&c[u]}catch{return}},this):this[e]}}}}}}async function sd(t){if(!t&&RI)return;if(RI=!0,!ot("UPLOAD_LOG"))return void Vr(()=>sd(!0),5e3);if(hc.length===0)return void Vr(()=>sd(!0),3e3);const e=Mr(hc).call(hc,0,10),n={sdk_version:Yn,log_version:ot("LOG_VERSION"),process_id:ot("PROCESS_ID"),index:SI,logs:at(e)};await Li(async()=>{const o=await yo.post(Yp?M(c="https://".concat(Yp,"/ls/?h=")).call(c,ot("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(ot("LOG_UPLOAD_SERVER"),"/upload/v1"),n,{responseType:"text"});var c;if(o.data!=="OK")throw new Error("Log service response error ".concat(o.data));return o},void 0,void 0,{timeout:3e3,maxRetryTimeout:1e4}),Ze(hc).call(hc,0,10),SI+=e.length,Vr(()=>sd(!0),3e3)}const ad="v4.9.0-0-g1ba70da9-dirty(2/17/2022, 9:34:37 PM)",Yn=function(t){if(t.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return t;const e=t.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(e&&e[1]&&e[2]){var n;const u=e[1],d=e[2];return M(n="".concat(u,".")).call(n,d)}const o=t.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(o&&o[1]&&o[2]){var c;const u=o[1],d=o[2];return M(c="".concat(u,".")).call(c,100*(Number(d)+1))}return"4.0.0.999"}("4.9.0"),Xp=function(){try{return JSON.parse("true")===!0}catch{return!0}}(),Pr={username:"test",password:"111111",turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1},i2={"90p":oe(160,90),"90p_1":oe(160,90),"120p":oe(160,120,15,30,65),"120p_1":oe(160,120,15,30,65),"120p_3":oe(120,120,15,30,50),"120p_4":oe(212,120),"180p":oe(320,180,15,30,140),"180p_1":oe(320,180,15,30,140),"180p_3":oe(180,180,15,30,100),"180p_4":oe(240,180,15,30,120),"240p":oe(320,240,15,40,200),"240p_1":oe(320,240,15,40,200),"240p_3":oe(240,240,15,40,140),"240p_4":oe(424,240,15,40,220),"360p":oe(640,360,15,80,400),"360p_1":oe(640,360,15,80,400),"360p_3":oe(360,360,15,80,260),"360p_4":oe(640,360,30,80,600),"360p_6":oe(360,360,30,80,400),"360p_7":oe(480,360,15,80,320),"360p_8":oe(480,360,30,80,490),"360p_9":oe(640,360,15,80,800),"360p_10":oe(640,360,24,80,800),"360p_11":oe(640,360,24,80,1e3),"480p":oe(640,480,15,100,500),"480p_1":oe(640,480,15,100,500),"480p_2":oe(640,480,30,100,1e3),"480p_3":oe(480,480,15,100,400),"480p_4":oe(640,480,30,100,750),"480p_6":oe(480,480,30,100,600),"480p_8":oe(848,480,15,100,610),"480p_9":oe(848,480,30,100,930),"480p_10":oe(640,480,10,100,400),"720p":oe(1280,720,15,120,1130),"720p_1":oe(1280,720,15,120,1130),"720p_2":oe(1280,720,30,120,2e3),"720p_3":oe(1280,720,30,120,1710),"720p_5":oe(960,720,15,120,910),"720p_6":oe(960,720,30,120,1380),"1080p":oe(1920,1080,15,120,2080),"1080p_1":oe(1920,1080,15,120,2080),"1080p_2":oe(1920,1080,30,120,3e3),"1080p_3":oe(1920,1080,30,120,3150),"1080p_5":oe(1920,1080,60,120,4780),"1440p":oe(2560,1440,30,120,4850),"1440p_1":oe(2560,1440,30,120,4850),"1440p_2":oe(2560,1440,60,120,7350),"4k":oe(3840,2160,30,120,8910),"4k_1":oe(3840,2160,30,120,8910),"4k_3":oe(3840,2160,60,120,13500)},o2={"480p":Xi(640,480,5),"480p_1":Xi(640,480,5),"480p_2":Xi(640,480,30),"480p_3":Xi(640,480,15),"720p":Xi(1280,720,5),"720p_1":Xi(1280,720,5),"720p_2":Xi(1280,720,30),"720p_3":Xi(1280,720,15),"1080p":Xi(1920,1080,5),"1080p_1":Xi(1920,1080,5),"1080p_2":Xi(1920,1080,30),"1080p_3":Xi(1920,1080,15)},s2={"1SL1TL":tA(1,1),"3SL3TL":tA(3,3),"2SL3TL":tA(2,3)};function fc(t){return typeof t=="string"?Ir({},i2[t]):t}function Zp(t){return typeof t=="string"?Ir({},o2[t]):t}function cd(t){return typeof t=="string"?Ir({},s2[t]):t}const a2={speech_low_quality:gc(16e3,!1),speech_standard:gc(32e3,!1,18),music_standard:gc(48e3,!1),standard_stereo:gc(48e3,!0,56),high_quality:gc(48e3,!1,128),high_quality_stereo:gc(48e3,!0,192)};function ld(t){return typeof t=="string"?Ir({},a2[t]):t}function In(t,e,n){var o,c;Xt(o=ue(qn)).call(o,t)&&(!n&&Xt(c=ue($p)).call(c,t)||(qn[t]=e))}function ot(t){return qn[t]}const qn={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],SUBSCRIBE_TCC:!0,PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,USE_RTX:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!0,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!1,JOIN_WITH_FALLBACK_MEDIA_PROXY:!1,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_WITH_FALLBACK_PROXY_PENDING_DURATION:2e3,USE_TURN_SERVER_OF_GATEWAY:!0,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!0,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0}},$p={};function gc(t,e,n){return{sampleRate:t,stereo:e,bitrate:n}}function oe(t,e,n,o,c){return{width:t,height:e,frameRate:n,bitrateMin:o,bitrateMax:c}}function Xi(t,e,n,o,c){return{width:{max:t},height:{max:e},frameRate:n,bitrateMin:o,bitrateMax:c}}function tA(t,e){return{numSpatialLayers:t,numTemporalLayers:e}}Xp||(qn.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],qn.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],qn.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],qn.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],qn.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],qn.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],qn.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",qn.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",qn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",qn.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",qn.AREAS=["NORTH_AMERICA","OVERSEA"]);const c2=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],us=[],Qs=[];var eA=[],bI=eA.sort,l2=A(function(){eA.sort(void 0)}),u2=A(function(){eA.sort(null)}),d2=pa("sort");jt({target:"Array",proto:!0,forced:l2||!u2||d2},{sort:function(t){return t===void 0?bI.call(ce(this)):bI.call(ce(this),Or(t))}});var NI,Ve,cn,h2=vr("Array").sort,OI=Array.prototype,rA=function(t){var e=t.sort;return t===OI||t instanceof Array&&e===OI.sort?h2:e};function ud(t,e){if(typeof t!="boolean")throw new Q(U.INVALID_PARAMS,"Invalid ".concat(e,": The value is of the boolean type."))}function Cn(t,e,n){var o;if(!Xt(n).call(n,t))throw new Q(U.INVALID_PARAMS,M(o="".concat(e," can only be set as ")).call(o,at(n)))}function He(t,e,n=1,o=1e4,c=!0){if(t<n||t>o||c&&!function(p){return typeof p=="number"&&p%1==0}(t)){var u,d;throw new Q(U.INVALID_PARAMS,M(u=M(d="invalid ".concat(e,": the value range is [")).call(d,n,", ")).call(u,o,"]. integer only"))}}function _n(t,e,n=1,o=255,c=!0){if(t==null)throw new Q(U.INVALID_PARAMS,"".concat(e||"param"," cannot be empty"));var u,d,p;if(!kI(t,n,o,c))throw new Q(U.INVALID_PARAMS,M(u=M(d=M(p="Invalid ".concat(e||"string param",": Length of the string: [")).call(p,n,",")).call(d,o,"].")).call(u,c?" ASCII characters only.":""))}function nA(t,e){if(!sn(t))throw new Q(U.INVALID_PARAMS,"".concat(e," should be an array"))}function iA(t){if(typeof t!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(t))throw N.error("Invalid Channel Name ".concat(t)),new Q(U.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function oA(t){var e,n;if(n=t,!(typeof n=="number"&&Math.floor(n)===n&&0<=n&&n<=4294967295||kI(t,1,255)))throw N.error(M(e="Invalid UID ".concat(t," ")).call(e,typeof t)),new Q(U.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");typeof t=="string"&&N.warning("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}function ze(t){return t==null}function kI(t,e=1,n=255,o=!0){return typeof t=="string"&&t.length<=n&&t.length>=e&&(!o||function(c){if(typeof c!="string")return!1;for(let u=0;u<c.length;u+=1){const d=c.charCodeAt(u);if(d<0||d>255)return!1}return!0}(t))}(function(t){t.FREE="free",t.UPLOADING="uploading"})(NI||(NI={})),function(t){t[t.MISC=0]="MISC",t[t.INTERNAL_EVENT=1]="INTERNAL_EVENT",t[t.PUBLIC_EVENT=2]="PUBLIC_EVENT",t[t.WEB_EVENT=3]="WEB_EVENT",t[t.INTERNAL_API=4]="INTERNAL_API",t[t.WEB_API=5]="WEB_API",t[t.PUBLIC_API=6]="PUBLIC_API"}(Ve||(Ve={})),function(t){t.NONE="none",t.INIT="init",t.CANPLAY="canplay",t.PLAYING="playing",t.PAUSED="paused",t.SUSPEND="suspend",t.STALLED="stalled",t.WAITING="waiting",t.ERROR="error",t.DESTROYED="destroyed",t.ABORT="abort",t.ENDED="ended",t.EMPTIED="emptied",t.LOADEDDATA="loadeddata"}(cn||(cn={}));const sA={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};jt({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991}),jt({target:"Number",stat:!0},{MIN_SAFE_INTEGER:-9007199254740991});function p2(t){return _n(t.reportId,"params.reportId",0,100,!1),_n(t.category,"params.category",0,100,!1),_n(t.event,"params.event",0,100,!1),_n(t.label,"params.label",0,100,!1),He(t.value,"params.value",-9007199254740991,9007199254740991,!1),!0}const A2={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};var ln,ur,DI,Vt,Ut,ma,ds,mc,ml,Ii,$r,Yt,aA,un,Ie,Dn,jr,de,Ae,Pi,Pe,BI,Zi;function LI(t){return He(t.timeout,"config.timeout",0,1e5),He(t.timeoutFactor,"config.timeoutFactor",0,100,!1),He(t.maxRetryCount,"config.maxRetryConfig",0,1/0),He(t.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}function cA(t){if(!sn(t)||t.length<1)return!1;try{G(t).call(t,e=>{if(!e.urls)throw Error()})}catch{return!1}return!0}function MI(t){return _n(t.turnServerURL,"turnServerURL"),_n(t.username,"username"),_n(t.password,"password"),t.udpport&&He(t.udpport,"udpport",1,99999,!0),t.forceturn&&ud(t.forceturn,"forceturn"),t.security&&ud(t.security,"security"),t.tcpport&&He(t.tcpport,"tcpport",1,99999,!0),!0}function PI(t){return t.level!==void 0&&Cn(t.level,"level",[1,2,3]),!0}(function(t){t.PUBLISH="publish",t.SUBSCRIBE="subscribe",t.WS_COMPRESSOR_INIT="ws_compressor_init",t.SESSION_INIT="session_init",t.JOIN_CHOOSE_SERVER="join_choose_server",t.REQ_USER_ACCOUNT="req_user_account",t.JOIN_GATEWAY="join_gateway",t.STREAM_SWITCH="stream_switch",t.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",t.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",t.FIRST_VIDEO_RECEIVED="first_video_received",t.FIRST_AUDIO_RECEIVED="first_audio_received",t.FIRST_VIDEO_DECODE="first_video_decode",t.FIRST_AUDIO_DECODE="first_audio_decode",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_UPDATE_STREAM="on_update_stream",t.ON_REMOVE_STREAM="on_remove_stream",t.USER_ANALYTICS="req_user_analytics"})(ln||(ln={})),function(t){t.SESSION="io.agora.pb.Wrtc.Session",t.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",t.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",t.JOIN_GATEWAT="io.agora.pb.Wrtc.JoinGateway",t.PUBLISH="io.agora.pb.Wrtc.Publish",t.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",t.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",t.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",t.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",t.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",t.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",t.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",t.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",t.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",t.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",t.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",t.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",t.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",t.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",t.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",t.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",t.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",t.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",t.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",t.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",t.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",t.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",t.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",t.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed"}(ur||(ur={})),function(t){t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}(DI||(DI={})),function(t){t.CREATE_CLIENT="createClient",t.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",t.SET_AREA="setArea",t.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",t.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",t.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",t.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",t.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",t.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",t.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",t.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",t.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",t.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",t.START_PROXY_SERVER="Client.startProxyServer",t.STOP_PROXY_SERVER="Client.stopProxyServer",t.SET_PROXY_SERVER="Client.setProxyServer",t.SET_TURN_SERVER="Client.setTurnServer",t.SET_CLIENT_ROLE="Client.setClientRole",t.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",t.ENABLE_DUAL_STREAM="Client.enableDualStream",t.DISABLE_DUAL_STREAM="Client.disableDualStream",t.JOIN="Client.join",t.LEAVE="Client.leave",t.PUBLISH="Client.publish",t.UNPUBLISH="Client.unpublish",t.SUBSCRIBE="Client.subscribe",t.UNSUBSCRIBE="Client.unsubscribe",t.RENEW_TOKEN="Client.renewToken",t.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",t.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",t.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",t.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",t.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",t.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",t.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",t.START_LIVE_STREAMING="Client.startLiveStreaming",t.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",t.STOP_LIVE_STREAMING="Client.stopLiveStreaming",t.ADD_INJECT_STREAM_URL="Client.addInjectStreamUrl",t.REMOVE_INJECT_STREAM_URL="Client.removeInjectStreamUrl",t.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",t.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",t.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",t.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",t.SET_CONFIG_DISTRIBUTE="_configDistribute",t.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",t.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",t.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",t.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",t.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",t.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",t.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",t.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",t.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",t.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",t.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",t.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",t.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",t.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",t.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",t.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",t.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",t.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",t.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",t.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",t.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",t.STREAM_TYPE_CHANGE="streamTypeChange",t.CONNECTION_STATE_CHANGE="connectionStateChange",t.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage"}(Vt||(Vt={})),function(t){t.TRACER="tracer"}(Ut||(Ut={})),function(t){t.IDLE="IDLE",t.INITING="INITING",t.INITEND="INITEND"}(ma||(ma={})),function(t){t.STATE_CHANGE="state_change",t.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",t.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",t.CAMERA_DEVICE_CHANGED="cameraDeviceChanged"}(ds||(ds={})),function(t){t[t.ACCESS_POINT=101]="ACCESS_POINT",t[t.UNILBS=201]="UNILBS",t[t.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR"}(mc||(mc={})),function(t){t[t.IIIEGAL_APPID=1]="IIIEGAL_APPID",t[t.IIIEGAL_UID=2]="IIIEGAL_UID",t[t.INTERNAL_ERROR=3]="INTERNAL_ERROR"}(ml||(ml={})),function(t){t[t.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",t[t.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",t[t.INTERNAL_ERROR=8]="INTERNAL_ERROR",t[t.NO_AUTHORIZED=9]="NO_AUTHORIZED",t[t.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",t[t.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",t[t.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",t[t.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",t[t.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",t[t.USER_OVERLOAD=16]="USER_OVERLOAD",t[t.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",t[t.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND"}(Ii||(Ii={})),function(t){t[t.NO_FLAG_SET=100]="NO_FLAG_SET",t[t.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",t[t.INVALID_FALG_SET=102]="INVALID_FALG_SET",t[t.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",t[t.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",t[t.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",t[t.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",t[t.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",t[t.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",t[t.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",t[t.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",t[t.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",t[t.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",t[t.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",t[t.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",t[t.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",t[t.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",t[t.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",t[t.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV"}($r||($r={})),function(t){t[t.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",t[t.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",t[t.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",t[t.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",t[t.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",t[t.K_TICKET_INVALID=7]="K_TICKET_INVALID",t[t.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",t[t.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",t[t.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",t[t.K_UID_BANNED=14]="K_UID_BANNED",t[t.K_IP_BANNED=15]="K_IP_BANNED",t[t.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",t[t.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",t[t.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",t[t.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",t[t.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",t[t.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",t[t.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",t[t.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",t[t.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",t[t.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",t[t.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",t[t.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",t[t.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",t[t.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",t[t.ERR_INVALID_UID=117]="ERR_INVALID_UID",t[t.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",t[t.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",t[t.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",t[t.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",t[t.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",t[t.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",t[t.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",t[t.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",t[t.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",t[t.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",t[t.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",t[t.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",t[t.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",t[t.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",t[t.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",t[t.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",t[t.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",t[t.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",t[t.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",t[t.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",t[t.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",t[t.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",t[t.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",t[t.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",t[t.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",t[t.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",t[t.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",t[t.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",t[t.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",t[t.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY"}(Yt||(Yt={})),function(t){t[t.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",t[t.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",t[t.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY"}(aA||(aA={})),function(t){t.LEAVE="LEAVE",t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.UID_BANNED="UID_BANNED",t.IP_BANNED="IP_BANNED",t.CHANNEL_BANNED="CHANNEL_BANNED",t.FALLBACK="FALLBACK"}(un||(un={})),function(t){t.CONNECTION_STATE_CHANGE="connection-state-change",t.MEDIA_RECONNECT_START="media-reconnect-start",t.MEDIA_RECONNECT_END="media-reconnect-end",t.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",t.USER_JOINED="user-joined",t.USER_LEAVED="user-left",t.USER_PUBLISHED="user-published",t.USER_UNPUBLISHED="user-unpublished",t.USER_INFO_UPDATED="user-info-updated",t.CLIENT_BANNED="client-banned",t.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",t.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",t.VOLUME_INDICATOR="volume-indicator",t.CRYPT_ERROR="crypt-error",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGED="stream-type-changed",t.STREAM_FALLBACK="stream-fallback",t.RECEIVE_METADATA="receive-metadata",t.STREAM_MESSAGE="stream-message",t.LIVE_STREAMING_ERROR="live-streaming-error",t.LIVE_STREAMING_WARNING="live-streaming-warning",t.INJECT_STREAM_STATUS="stream-inject-status",t.EXCEPTION="exception",t.ERROR="error",t.P2P_LOST="p2p_lost",t.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy"}(Ie||(Ie={})),function(t){t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.MULTI_IP="MULTI_IP",t.TIMEOUT="TIMEOUT",t.OFFLINE="OFFLINE",t.LEAVE="LEAVE",t.P2P_FAILED="P2P_FAILED",t.FALLBACK="FALLBACK"}(Dn||(Dn={})),function(t){t.CONNECTING="connecting",t.CONNECTED="connected",t.RECONNECTING="reconnecting",t.CLOSED="closed"}(jr||(jr={})),function(t){t.WS_CONNECTED="ws_connected",t.WS_RECONNECTING="ws_reconnecting",t.WS_CLOSED="ws_closed",t.ON_BINARY_DATA="on_binary_data",t.REQUEST_RECOVER="request_recover",t.REQUEST_JOIN_INFO="request_join_info",t.REQUEST_REJOIN_INFO="req_rejoin_info",t.IS_P2P_DISCONNECTED="is_p2p_dis",t.DISCONNECT_P2P="dis_p2p",t.NEED_RENEW_SESSION="need-sid",t.REPORT_JOIN_GATEWAY="report_join_gateway",t.REQUEST_TIMEOUT="request_timeout",t.REQUEST_SUCCESS="request_success",t.JOIN_RESPONSE="join_response"}(de||(de={})),function(t){t.PING="ping",t.PING_BACK="ping_back",t.JOIN="join_v3",t.REJOIN="rejoin_v3",t.LEAVE="leave",t.SET_CLIENT_ROLE="set_client_role",t.PUBLISH="publish",t.UNPUBLISH="unpublish",t.SUBSCRIBE="subscribe",t.UNSUBSCRIBE="unsubscribe",t.SUBSCRIBE_CHANGE="subscribe_change",t.TRAFFIC_STATS="traffic_stats",t.RENEW_TOKEN="renew_token",t.SWITCH_VIDEO_STREAM="switch_video_stream",t.DEFAULT_VIDEO_STREAM="default_video_stream",t.SET_FALLBACK_OPTION="set_fallback_option",t.GATEWAY_INFO="gateway_info",t.CONTROL="control",t.SEND_METADATA="send_metadata",t.DATA_STREAM="data_stream",t.PICK_SVC_LAYER="pick_svc_layer",t.RESTART_ICE="restart_ice",t.CONNECT_PC="connect_pc",t.SET_VIDEO_PROFILE="set_video_profile"}(Ae||(Ae={})),function(t){t.PUBLISH_STATS="publish_stats",t.PUBLISH_RELATED_STATS="publish_related_stats",t.SUBSCRIBE_STATS="subscribe_stats",t.SUBSCRIBE_RELATED_STATS="subscribe_related_stats",t.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",t.DENOISER_STATS="denoiser_stats"}(Pi||(Pi={})),function(t){t.ON_USER_ONLINE="on_user_online",t.ON_USER_OFFLINE="on_user_offline",t.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",t.ON_PUBLISH_STREAM="on_publish_stream",t.ON_UPLINK_STATS="on_uplink_stats",t.ON_P2P_LOST="on_p2p_lost",t.ON_REMOVE_STREAM="on_remove_stream",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",t.ON_USER_BANNED="on_user_banned",t.ON_NOTIFICATION="on_notification",t.ON_CRYPT_ERROR="on_crypt_error",t.MUTE_AUDIO="mute_audio",t.MUTE_VIDEO="mute_video",t.UNMUTE_AUDIO="unmute_audio",t.UNMUTE_VIDEO="unmute_video",t.ON_P2P_OK="on_p2p_ok",t.RECEIVE_METADATA="receive_metadata",t.ON_DATA_STREAM="on_data_stream",t.ENABLE_LOCAL_VIDEO="enable_local_video",t.DISABLE_LOCAL_VIDEO="disable_local_video",t.ENABLE_LOCAL_AUDIO="enable_local_audio",t.DISABLE_LOCAL_AUDIO="disable_local_audio"}(Pe||(Pe={})),function(t){t.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",t.NEED_ANSWER="NEED_ANSWER",t.NEED_RENEGOTIATE="NEED_RENEGOTIATE",t.P2P_LOST="P2P_LOST",t.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",t.NEED_UNPUB="NEED_UNPUB",t.NEED_UNSUB="NEED_UNSUB",t.NEED_UPLOAD="NEED_UPLOAD",t.NEED_CONTROL="NEED_CONTROL",t.START_RECONNECT="START_RECONNECT",t.END_RECONNECT="END_RECONNECT",t.NEED_SIGNAL_RTT="NEED_SIGNAL_RTT"}(BI||(BI={})),function(t){t.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",t.RECEIVE_TRACK_BUFFER="receive_track_buffer",t.ON_AUDIO_BUFFER="on_audio_buffer"}(Zi||(Zi={}));const lA={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,currentPacketLossRate:0},uA={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},xI={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},f2={uplinkNetworkQuality:0,downlinkNetworkQuality:0},UI={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};var Be,Ar,Fs;(function(t){t.CONNECTED="websocket:connected",t.RECONNECTING="websocket:reconnecting",t.WILL_RECONNECT="websocket:will_reconnect",t.CLOSED="websocket:closed",t.FAILED="websocket:failed",t.ON_MESSAGE="websocket:on_message",t.REQUEST_NEW_URLS="websocket:request_new_urls"})(Be||(Be={})),function(t){t.TRANSCODE="mix_streaming",t.RAW="raw_streaming",t.INJECT="inject_streaming"}(Ar||(Ar={})),function(t){t[t.INJECT_STREAM_STATUS_START_SUCCESS=0]="INJECT_STREAM_STATUS_START_SUCCESS",t[t.INJECT_STREAM_STATUS_START_ALREADY_EXISTS=1]="INJECT_STREAM_STATUS_START_ALREADY_EXISTS",t[t.INJECT_STREAM_STATUS_START_UNAUTHORIZED=2]="INJECT_STREAM_STATUS_START_UNAUTHORIZED",t[t.INJECT_STREAM_STATUS_START_TIMEOUT=3]="INJECT_STREAM_STATUS_START_TIMEOUT",t[t.INJECT_STREAM_STATUS_START_FAILED=4]="INJECT_STREAM_STATUS_START_FAILED",t[t.INJECT_STREAM_STATUS_STOP_SUCCESS=5]="INJECT_STREAM_STATUS_STOP_SUCCESS",t[t.INJECT_STREAM_STATUS_STOP_NOT_FOUND=6]="INJECT_STREAM_STATUS_STOP_NOT_FOUND",t[t.INJECT_STREAM_STATUS_STOP_UNAUTHORIZED=7]="INJECT_STREAM_STATUS_STOP_UNAUTHORIZED",t[t.INJECT_STREAM_STATUS_STOP_TIMEOUT=8]="INJECT_STREAM_STATUS_STOP_TIMEOUT",t[t.INJECT_STREAM_STATUS_STOP_FAILED=9]="INJECT_STREAM_STATUS_STOP_FAILED",t[t.INJECT_STREAM_STATUS_BROKEN=10]="INJECT_STREAM_STATUS_BROKEN"}(Fs||(Fs={}));const g2={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},dA={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function hA(t,e){_n(t.url,"".concat(e,".url"),1,1e3,!1),ze(t.x)||He(t.x,"".concat(e,".x"),0,1e4),ze(t.y)||He(t.y,"".concat(e,".y"),0,1e4),ze(t.width)||He(t.width,"".concat(e,".width"),0,1e4),ze(t.height)||He(t.height,"".concat(e,".height"),0,1e4),ze(t.zOrder)||He(t.zOrder,"".concat(e,".zOrder"),0,255),ze(t.alpha)||He(t.alpha,"".concat(e,".alpha"),0,1,!1)}const m2={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},E2={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};var $i,Ec,cr,QI,yn,So,Bn,Vs,fr,_r,Kt,dn,pA,AA,hs,vc,Ne;function FI(t){if(!t.channelName)throw new Q(U.INVALID_PARAMS,"invalid channelName in info");if(!t.uid||typeof t.uid!="number")throw new Q(U.INVALID_PARAMS,"invalid uid in info, uid must be a number");return t.token&&_n(t.token,"info.token",1,2047),oA(t.uid),iA(t.channelName),!0}function VI(t){return Cn(t,"mediaSource",["screen","window","application"]),!0}(function(t){t.WARNING="@live_uap-warning",t.ERROR="@line_uap-error",t.PUBLISH_STREAM_STATUS="@live_uap-publish-status",t.INJECT_STREAM_STATUS="@live_uap-inject-status",t.WORKER_STATUS="@live_uap-worker-status",t.REQUEST_NEW_ADDRESS="@live_uap-request-address"})($i||($i={})),function(t){t.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager"}(Ec||(Ec={})),function(t){t[t.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",t[t.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",t[t.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",t[t.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",t[t.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",t[t.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",t[t.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",t[t.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",t[t.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",t[t.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",t[t.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",t[t.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",t[t.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",t[t.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",t[t.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",t[t.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(cr||(cr={})),function(t){t.CONNECT_FAILED="connect failed",t.CONNECT_TIMEOUT="connect timeout",t.WS_DISCONNECTED="websocket disconnected",t.REQUEST_TIMEOUT="request timeout",t.REQUEST_FAILED="request failed",t.WAIT_STATUS_TIMEOUT="wait status timeout",t.WAIT_STATUS_ERROR="wait status error",t.BAD_STATE="bad state",t.WS_ABORT="ws abort",t.AP_REQUEST_TIMEOUT="AP request timeout",t.AP_JSON_PARSE_ERROR="AP json parse error",t.AP_REQUEST_ERROR="AP request error",t.AP_REQUEST_ABORT="AP request abort"}(QI||(QI={})),function(t){t[t.SetSdkProfile=0]="SetSdkProfile",t[t.SetSourceChannel=1]="SetSourceChannel",t[t.SetSourceUserId=2]="SetSourceUserId",t[t.SetDestChannel=3]="SetDestChannel",t[t.StartPacketTransfer=4]="StartPacketTransfer",t[t.StopPacketTransfer=5]="StopPacketTransfer",t[t.UpdateDestChannel=6]="UpdateDestChannel",t[t.Reconnect=7]="Reconnect",t[t.SetVideoProfile=8]="SetVideoProfile"}(yn||(yn={})),function(t){t.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",t.NETWORK_CONNECTED="NETWORK_CONNECTED",t.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",t.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",t.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",t.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",t.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",t.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",t.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",t.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE"}(So||(So={})),function(t){t.RELAY_STATE_IDLE="RELAY_STATE_IDLE",t.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",t.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",t.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE"}(Bn||(Bn={})),function(t){t.RELAY_OK="RELAY_OK",t.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",t.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",t.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED"}(Vs||(Vs={})),function(t){t.High="high",t.Low="low",t.Audio="audio",t.Screen="screen",t.ScreenLow="screen_low"}(fr||(fr={})),function(t){t.DISCONNECT="disconnect",t.CONNECTION_STATE_CHANGE="connection-state-change",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGE="stream-type-change",t.IS_P2P_DISCONNECTED="is-p2p-dis",t.DISCONNECT_P2P="dis-p2p",t.REQUEST_NEW_GATEWAY_LIST="req-gate-url",t.NEED_RENEW_SESSION="need-sid",t.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",t.JOIN_RESPONSE="join-response"}(_r||(_r={})),function(t){t.NEED_RENEGOTIATE="@need_renegotiate",t.NEED_REPLACE_TRACK="@need_replace_track",t.NEED_CLOSE="@need_close",t.NEED_ENABLE_TRACK="@need_enable_track",t.NEED_DISABLE_TRACK="@need_disable_track",t.NEED_SESSION_ID="@need_sid",t.SET_OPTIMIZATION_MODE="@set_optimization_mode",t.GET_STATS="@get_stats",t.GET_LOW_VIDEO_TRACK="@get_low_video_track",t.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",t.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",t.NEED_MUTE_TRACK="@need_mute_track",t.NEED_UNMUTE_TRACK="@need_unmute_track"}(Kt||(Kt={})),function(t){t.SCREEN_TRACK="screen_track",t.LOW_STREAM="low_stream"}(dn||(dn={})),function(t){t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM"}(pA||(pA={})),function(t){t[t.DISABLE=0]="DISABLE",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.AUDIO_ONLY=2]="AUDIO_ONLY"}(AA||(AA={})),function(t){t.SOURCE_STATE_CHANGE="source-state-change",t.TRACK_ENDED="track-ended",t.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.CLOSED="closed"}(hs||(hs={})),function(t){t.FIRST_FRAME_DECODED="first-frame-decoded",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status"}(vc||(vc={})),function(t){t.CHINA="CHINA",t.ASIA="ASIA",t.NORTH_AMERICA="NORTH_AMERICA",t.EUROPE="EUROPE",t.JAPAN="JAPAN",t.INDIA="INDIA",t.KOREA="KOREA",t.OCEANIA="OCEANIA",t.SOUTH_AMERICA="SOUTH_AMERICA",t.AFRICA="AFRICA",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL"}(Ne||(Ne={}));const GI=[Ne.AFRICA,Ne.ASIA,Ne.CHINA,Ne.EUROPE,Ne.GLOBAL,Ne.INDIA,Ne.JAPAN,Ne.NORTH_AMERICA,Ne.OCEANIA,Ne.OVERSEA,Ne.SOUTH_AMERICA];var Yr;(function(t){t.CHINA="CN",t.ASIA="AS",t.NORTH_AMERICA="NA",t.EUROPE="EU",t.JAPAN="JP",t.INDIA="IN",t.KOREA="KR",t.OCEANIA="OC",t.SOUTH_AMERICA="SA",t.AFRICA="AF",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL"})(Yr||(Yr={}));const fA={CHINA:{},ASIA:{CODE:Yr.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Yr.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Yr.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Yr.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","	uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Yr.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Yr.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Yr.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Yr.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Yr.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Yr.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Yr.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]}};var El,jI,xe,bt,Ci,Re,xi,Ic;Xp&&(fA.CHINA={CODE:Yr.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),function(t){t.UPDATE_BITRATE_LIMIT="update_bitrate_limit"}(El||(El={}));class KI extends Gr{constructor(e,n){super()}}(function(t){t.SEND="sendonly",t.RECV="recvonly",t.SENDRECV="sendrecv",t.INACTIVE="inactive"})(jI||(jI={})),function(t){t.VIDEO="video",t.AUDIO="audio"}(xe||(xe={})),function(t){t.LocalVideoTrack="videoTrack",t.LocalAudioTrack="audioTrack",t.LocalVideoLowTrack="videoLowTrack"}(bt||(bt={})),function(t){t.New="new",t.Connected="connected",t.Reconnecting="reconnecting",t.Disconnected="disconnected"}(Ci||(Ci={})),function(t){t.StateChange="stateChange",t.IceConnectionStateChange="iceConnectionStateChange",t.RequestMuteLocal="requestMuteLocal",t.RequestUnmuteLocal="requestUnmuteLocal",t.RequestRePublish="requestRePublish",t.RequestReSubscribe="requestReSubscribe",t.RequestUploadStats="requestUploadStats",t.MediaReconnectStart="MediaReconnectStart",t.MediaReconnectEnd="MediaReconnectEnd",t.NeedSignalRTT="NeedSignalRTT",t.RequestRestartICE="RequestRestartIce",t.PeerConnectionStateChange="PeerConnectionStateChange",t.RequestReconnect="RequestReconnect",t.RequestReconnectPC="RequestReconnectPC",t.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",t.P2PLost="P2PLost",t.UpdateVideoEncoder="UpdateVideoEncoder"}(Re||(Re={})),function(t){t.ONLINE="ONLINE",t.OFFLINE="OFFLINE"}(xi||(xi={})),function(t){t.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",t.ONLINE="ONLINE",t.OFFLINE="OFFLINE"}(Ic||(Ic={}));const v2={join:["startJoin","startRequestAp","startJoinGateway","finishJoin"],publish:["startPublish"]},Ln={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1};function Mn(){return Ln}var I2=xo.concat("length","prototype"),gA={f:Object.getOwnPropertyNames||function(t){return Co(t,I2)}},C2=En("Reflect","ownKeys")||function(t){var e=gA.f(ar(t)),n=nl.f;return n?e.concat(n(t)):e};jt({target:"Object",stat:!0,sham:!m},{getOwnPropertyDescriptors:function(t){for(var e,n,o=X(t),c=qe.f,u=C2(o),d={},p=0;u.length>p;)(n=c(o,e=u[p++]))!==void 0&&Dr(d,e,n);return d}});var Ce=le.Object.getOwnPropertyDescriptors,HI=gA.f,_2={}.toString,WI=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],YI={f:function(t){return WI&&_2.call(t)=="[object Window]"?function(e){try{return HI(e)}catch{return WI.slice()}}(t):HI(X(t))}},dd={f:Br},y2=kr.f,hn=function(t){var e=le.Symbol||(le.Symbol={});ft(e,t)||y2(e,t,{value:dd.f(t)})},hd=_o.forEach,_i=Nu("hidden"),pd="Symbol",qI=Br("toPrimitive"),S2=Lr.set,JI=Lr.getterFor(pd),To=Object.prototype,Ui=h.Symbol,vl=En("JSON","stringify"),zI=qe.f,Gs=kr.f,XI=YI.f,T2=S.f,ps=Ji("symbols"),Il=Ji("op-symbols"),mA=Ji("string-to-symbol-registry"),EA=Ji("symbol-to-string-registry"),R2=Ji("wks"),vA=h.QObject,IA=!vA||!vA.prototype||!vA.prototype.findChild,CA=m&&A(function(){return ns(Gs({},"a",{get:function(){return Gs(this,"a",{value:7}).a}})).a!=7})?function(t,e,n){var o=zI(To,e);o&&delete To[e],Gs(t,e,n),o&&t!==To&&Gs(To,e,o)}:Gs,ZI=function(t,e){var n=ps[t]=ns(Ui.prototype);return S2(n,{type:pd,tag:t,description:e}),m||(n.description=e),n},_A=kn&&typeof Ui.iterator=="symbol"?function(t){return typeof t=="symbol"}:function(t){return Object(t)instanceof Ui},Ad=function(t,e,n){t===To&&Ad(Il,e,n),ar(t);var o=_t(e,!0);return ar(n),ft(ps,o)?(n.enumerable?(ft(t,_i)&&t[_i][o]&&(t[_i][o]=!1),n=ns(n,{enumerable:b(0,!1)})):(ft(t,_i)||Gs(t,_i,b(1,{})),t[_i][o]=!0),CA(t,o,n)):Gs(t,o,n)},$I=function(t,e){ar(t);var n=X(e),o=Hn(n).concat(yA(n));return hd(o,function(c){m&&!t1.call(n,c)||Ad(t,c,n[c])}),t},t1=function(t){var e=_t(t,!0),n=T2.call(this,e);return!(this===To&&ft(ps,e)&&!ft(Il,e))&&(!(n||!ft(this,e)||!ft(ps,e)||ft(this,_i)&&this[_i][e])||n)},e1=function(t,e){var n=X(t),o=_t(e,!0);if(n!==To||!ft(ps,o)||ft(Il,o)){var c=zI(n,o);return!c||!ft(ps,o)||ft(n,_i)&&n[_i][o]||(c.enumerable=!0),c}},r1=function(t){var e=XI(X(t)),n=[];return hd(e,function(o){ft(ps,o)||ft(vo,o)||n.push(o)}),n},yA=function(t){var e=t===To,n=XI(e?Il:X(t)),o=[];return hd(n,function(c){!ft(ps,c)||e&&!ft(To,c)||o.push(ps[c])}),o};if(kn||(ss((Ui=function(){if(this instanceof Ui)throw TypeError("Symbol is not a constructor");var t=arguments.length&&arguments[0]!==void 0?String(arguments[0]):void 0,e=es(t),n=function(o){this===To&&n.call(Il,o),ft(this,_i)&&ft(this[_i],e)&&(this[_i][e]=!1),CA(this,e,b(1,o))};return m&&IA&&CA(To,e,{configurable:!0,set:n}),ZI(e,t)}).prototype,"toString",function(){return JI(this).tag}),S.f=t1,kr.f=Ad,qe.f=e1,gA.f=YI.f=r1,nl.f=yA,m&&Gs(Ui.prototype,"description",{configurable:!0,get:function(){return JI(this).description}})),Tu||(dd.f=function(t){return ZI(Br(t),t)}),jt({global:!0,wrap:!0,forced:!kn,sham:!kn},{Symbol:Ui}),hd(Hn(R2),function(t){hn(t)}),jt({target:pd,stat:!0,forced:!kn},{for:function(t){var e=String(t);if(ft(mA,e))return mA[e];var n=Ui(e);return mA[e]=n,EA[n]=e,n},keyFor:function(t){if(!_A(t))throw TypeError(t+" is not a symbol");if(ft(EA,t))return EA[t]},useSetter:function(){IA=!0},useSimple:function(){IA=!1}}),jt({target:"Object",stat:!0,forced:!kn,sham:!m},{create:function(t,e){return e===void 0?ns(t):$I(ns(t),e)},defineProperty:Ad,defineProperties:$I,getOwnPropertyDescriptor:e1}),jt({target:"Object",stat:!0,forced:!kn},{getOwnPropertyNames:r1,getOwnPropertySymbols:yA}),jt({target:"Object",stat:!0,forced:A(function(){nl.f(1)})},{getOwnPropertySymbols:function(t){return nl.f(ce(t))}}),vl){var w2=!kn||A(function(){var t=Ui();return vl([t])!="[null]"||vl({a:t})!="{}"||vl(Object(t))!="{}"});jt({target:"JSON",stat:!0,forced:w2},{stringify:function(t,e,n){for(var o,c=[t],u=1;arguments.length>u;)c.push(arguments[u++]);if(o=e,(K(e)||t!==void 0)&&!_A(t))return Me(e)||(e=function(d,p){if(typeof o=="function"&&(p=o.call(this,d,p)),!_A(p))return p}),c[1]=e,vl.apply(null,c)}})}Ui.prototype[qI]||yr(Ui.prototype,qI,Ui.prototype.valueOf),is(Ui,pd),vo[_i]=!0;var _e=le.Object.getOwnPropertySymbols,b2=aE,Sr,qr=function(t,e,n){return e in t?b2(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t};(function(t){t[t.CHOOSE_SERVER=11]="CHOOSE_SERVER",t[t.CLOUD_PROXY=18]="CLOUD_PROXY",t[t.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",t[t.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK"})(Sr||(Sr={}));var N2=vr("Array").entries,n1=Array.prototype,O2={DOMTokenList:!0,NodeList:!0},Tr=function(t){var e=t.entries;return t===n1||t instanceof Array&&e===n1.entries||O2.hasOwnProperty(da(t))?N2:e},Ea=function(t){var e,n,o,c,u,d=ce(t),p=typeof this=="function"?this:Array,f=arguments.length,g=f>1?arguments[1]:void 0,E=g!==void 0,I=0,_=sl(d);if(E&&(g=Kn(g,f>2?arguments[2]:void 0,2)),_==null||p==Array&&cE(_))for(n=new p(e=Xr(d.length));e>I;I++)Dr(n,I,E?g(d[I],I):d[I]);else for(u=(c=_.call(d)).next,n=new p;!(o=u.call(c)).done;I++)Dr(n,I,E?lE(c,g,[o.value,I],!0):o.value);return n.length=I,n},k2=!OE(function(t){Array.from(t)});jt({target:"Array",stat:!0,forced:k2},{from:Ea});var Ue=le.Array.from,D2=vr("Array").keys,i1=Array.prototype,B2={DOMTokenList:!0,NodeList:!0},va=function(t){var e=t.keys;return t===i1||t instanceof Array&&e===i1.keys||B2.hasOwnProperty(da(t))?D2:e};function o1(t,e){var n=ue(t);if(_e){var o=_e(t);e&&(o=Ot(o).call(o,function(c){return zt(t,c).enumerable})),n.push.apply(n,o)}return n}let fd=0,SA=0;function to(t,e,n){return new ct((o,c)=>{e.timeout=e.timeout||ot("HTTP_CONNECT_TIMEOUT"),e.responseType=e.responseType||"json",e.data&&!n?(e.data=at(e.data),fd+=yc(e.data)):n&&(e.data.size?fd+=e.data.size:e.data instanceof FormData?fd+=function(u){let d=0;return/DingTalk/i.test(navigator.userAgent)&&u.realFormData&&(u=u.realFormData),G(u).call(u,p=>{d+=typeof p=="string"?yc(p):p.size}),d+138}(e.data):fd+=yc(at(e.data))),e.headers=e.headers||{},e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.method="POST",e.url=t,yo.request(e).then(u=>{typeof u.data=="string"?SA+=yc(u.data):u.data instanceof ArrayBuffer||u.data instanceof Uint8Array?SA+=u.data.byteLength:SA+=yc(at(u.data)),o(u.data)}).catch(u=>{yo.isCancel(u)?c(new Q(U.OPERATION_ABORTED,"cancel token canceled")):u.code==="ECONNABORTED"?c(new Q(U.NETWORK_TIMEOUT,u.message)):u.response?c(new Q(U.NETWORK_RESPONSE_ERROR,u.response.status)):c(new Q(U.NETWORK_ERROR,u.message))})})}async function L2(t,e){const n=new Blob([e.data],{type:"buffer"});return await to(t,function(o){for(var c=1;c<arguments.length;c++){var u,d=arguments[c]!=null?arguments[c]:{};if(c%2)G(u=o1(Object(d),!0)).call(u,function(f){qr(o,f,d[f])});else if(Ce)dr(o,Ce(d));else{var p;G(p=o1(Object(d))).call(p,function(f){te(o,f,zt(d,f))})}}return o}({},e,{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const tn=new class extends Gr{constructor(){super(),this._moduleName="network-indicator",this._networkState=xi.ONLINE,window.addEventListener("online",()=>{this.networkState=xi.ONLINE}),window.addEventListener("offline",()=>{this.networkState=xi.OFFLINE})}set networkState(t){N.info("[".concat(this._moduleName,"]")+"network state changed, "+this._networkState+" -> "+t),this.emit(Ic.NETWORK_STATE_CHANGE,t,this._networkState),t===xi.ONLINE?this.emit(Ic.ONLINE):t===xi.OFFLINE&&(this.onlineWaiter=new ct(e=>{this.once(Ic.ONLINE,()=>{this.onlineWaiter=void 0,e(xi.ONLINE)})}),this.emit(Ic.OFFLINE)),this._networkState=t}get networkState(){return this._networkState}};let TA=!1;const yi=new class extends Gr{};function s1(){const t=Ke();if(!TA){const e=n=>{n.preventDefault(),TA=!1,t.os!=="Android"||t.name!=="Chrome"&&t.name!==be.WECHAT?(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0)):document.body.removeEventListener("click",e,!0)};TA=!0,t.os!=="Android"||t.name!=="Chrome"&&t.name!==be.WECHAT?(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)):document.body.addEventListener("click",e,!0),N.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),yi.onAutoplayFailed?yi.onAutoplayFailed():yi.onAudioAutoplayFailed?N.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):N.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),yi.emit("autoplay-failed")}}function a1(t,e){var n=ue(t);if(_e){var o=_e(t);e&&(o=Ot(o).call(o,function(c){return zt(t,c).enumerable})),n.push.apply(n,o)}return n}function xr(t){for(var e=1;e<arguments.length;e++){var n,o=arguments[e]!=null?arguments[e]:{};if(e%2)G(n=a1(Object(o),!0)).call(n,function(u){qr(t,u,o[u])});else if(Ce)dr(t,Ce(o));else{var c;G(c=a1(Object(o))).call(c,function(u){te(t,u,zt(o,u))})}}return t}var M2=function(t,e,n,o){var c,u=arguments.length,d=u<3?e:o===null?o=zt(e,n):o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(t,e,n,o);else for(var p=t.length-1;p>=0;p--)(c=t[p])&&(d=(u<3?c(d):u>3?c(e,n,d):c(e,n))||d);return u>3&&d&&te(e,n,d),d},P2=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};let RA=class{constructor(){var t,e;this.baseInfoMap=new tr,this.clientList=us,this.keyEventUploadPendingItems=[],this.normalEventUploadPendingItems=[],this.apiInvokeUploadPendingItems=[],this.apiInvokeCount=0,this.ltsList=[],this.lastSendNormalEventTime=kt(),this.customReportCount=0,this.eventUploadTimer=window.setInterval(vn(t=this.doSend).call(t,this),ot("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(vn(e=this.appendSessionId).call(e,this),ot("EVENT_REPORT_SEND_INTERVAL"))}reportApiInvoke(t,e,n){e.timeout=e.timeout||6e4,e.reportResult=e.reportResult===void 0||e.reportResult;const o=kt();this.apiInvokeCount+=1;const c=this.apiInvokeCount,u=()=>({tag:e.tag,invokeId:c,sid:t,name:e.name,apiInvokeTime:o,options:e.options,states:e.states||null}),d=!!ot("SHOW_REPORT_INVOKER_LOG");d&&N.info("".concat(e.name," start"),e.options);let p=!1;pn(e.timeout).then(()=>{p||(this.sendApiInvoke(xr({},u(),{error:U.API_INVOKE_TIMEOUT,success:!1})),N.debug("".concat(e.name," timeout")))});const f=new Q(U.UNEXPECTED_ERROR,"".concat(e.name,": this api invoke is end"));return{onSuccess:g=>{const E=()=>{if(p)throw f;return p=!0,this.sendApiInvoke(xr({},u(),{success:!0},e.reportResult&&{result:g})),d&&N.info("".concat(e.name," onSuccess")),g};return n?F1(E,e.name+"Success",n,()=>p=!0):E()},onError:g=>{const E=()=>{if(p)throw g;p=!0,this.sendApiInvoke(xr({},u(),{success:!1,error:g.toString()})),d&&N.info("".concat(e.name," onFailure"),g.toString())};return n?F1(E,e.name+"Error",n,()=>p=!0):E()}}}sessionInit(t,e){if(this.baseInfoMap.has(t))return;const n=kt(),o=this.createBaseInfo(t,n);o.cname=e.cname;const c=Ir({},{willUploadConsoleLog:ot("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:Xp?"global":"oversea",areas:ot("AREAS")&&ot("AREAS").join(",")},e.extend),u=kt(),d=xr({},o,{eventType:ln.SESSION_INIT,appid:e.appid,browser:navigator.userAgent,build:ad,lts:u,elapse:u-n,extend:at(c),mode:e.mode,process:ot("PROCESS_ID"),success:!0,version:Yn});this.send({type:ur.SESSION,data:d},!0)}joinChooseServer(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const o=n.info,c=kt(),u=xr({},o,{eventType:ln.JOIN_CHOOSE_SERVER,lts:c,eventElapse:c-e.lts,chooseServerAddr:e.csAddr,errorCode:e.ec,elapse:c-n.startTime,success:e.succ,chooseServerAddrList:at(e.serverList),uid:e.uid?rr(e.uid):null,cid:e.cid?rr(e.cid):null,chooseServerIp:e.csIp||"",opid:e.opid,unilbsServerIds:e.unilbsServerIds,extend:e.extend||void 0});this.send({type:ur.JOIN_CHOOSE_SERVER,data:u},!0)}reqUserAccount(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const o=n.info,c=kt(),u=xr({},o,{eventType:ln.REQ_USER_ACCOUNT,lts:c,success:e.success,serverAddress:e.serverAddr,stringUid:e.stringUid,uid:e.uid,errorCode:e.errorCode,elapse:c-n.startTime,eventElapse:c-e.lts,extend:at(e.extend)});this.send({type:ur.REQ_USER_ACCOUNT,data:u},!0)}joinGateway(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const o=n.info;e.vid&&(o.vid=e.vid),o.uid=e.uid,o.cid=e.cid;const c=kt(),u=xr({},o,{eventType:ln.JOIN_GATEWAY,lts:c,gatewayAddr:e.addr,success:e.succ,errorCode:e.ec,elapse:c-n.startTime,eventElapse:c-e.lts,firstSuccess:e.firstSuccess});e.succ&&(n.lastJoinSuccessTime=c),this.send({type:ur.JOIN_GATEWAT,data:u},!0)}joinChannelTimeout(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const o=kt(),c=xr({},n.info,{lts:o,timeout:e,elapse:o-n.startTime});this.send({type:ur.JOIN_CHANNEL_TIMEOUT,data:c},!0)}publish(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const o=n.info,c=kt(),u=xr({},o,{eventType:ln.PUBLISH,lts:c,eventElapse:e.eventElapse,elapse:c-n.startTime,success:e.succ,errorCode:e.ec,videoName:e.videoName,audioName:e.audioName,screenName:e.screenName,screenshare:e.screenshare,audio:e.audio,video:e.video,p2pid:e.p2pid,publishRequestid:e.publishRequestid});this.send({type:ur.PUBLISH,data:u},!0)}subscribe(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const o=n.info,c=kt(),u=xr({},o,{eventType:ln.SUBSCRIBE,lts:c,eventElapse:e.eventElapse,elapse:c-n.startTime,success:e.succ,errorCode:e.ec,video:e.video,audio:e.audio,subscribeRequestid:e.subscribeRequestid,p2pid:e.p2pid});typeof e.peerid=="string"?u.peerSuid=e.peerid:u.peer=e.peerid,this.send({type:ur.SUBSCRIBE,data:u},!0)}wsCompressorInit(t){var e;const n=[...va(e=this.baseInfoMap).call(e)],o=n.length?n[0]:"UnableToGetSid",c=this.baseInfoMap.get(o);if(!c)return;const u=c.info,d=kt(),p=xr({},u,{eventType:ln.WS_COMPRESSOR_INIT,lts:d,eventElapse:t.eventElapse,elapse:d-c.startTime,status:t.status?1:2});this.send({type:ur.WS_COMPRESSOR_INIT,data:p},!0)}firstRemoteFrame(t,e,n,o){const c=this.baseInfoMap.get(t);if(!c)return;const u=c.info,d=kt(),p=xr({},u,{},o,{elapse:d-c.startTime,eventType:e,lts:d});this.send({type:n,data:p},!0)}onGatewayStream(t,e,n,o){const c=this.baseInfoMap.get(t);if(!c)return;const u=xr({},c.info,{},o,{eventType:e,lts:kt()});this.send({type:n,data:u},!0)}streamSwitch(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const o=n.info,c=kt(),u=xr({},o,{eventType:ln.STREAM_SWITCH,lts:c,isDual:e.isdual,elapse:c-n.startTime,success:e.succ});this.send({type:ur.STREAM_SWITCH,data:u},!0)}requestProxyAppCenter(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const o=n.info,c=kt(),u=xr({},o,{eventType:ln.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-e.lts,elapse:c-n.startTime,APAddr:e.APAddr,workerManagerList:e.workerManagerList,response:e.response,errorCode:e.ec,success:e.succ});this.send({type:ur.REQUEST_PROXY_APPCENTER,data:u},!0)}requestProxyWorkerManager(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const o=n.info,c=kt(),u=xr({},o,{eventType:ln.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-e.lts,elapse:c-n.startTime,workerManagerAddr:e.workerManagerAddr,response:e.response,errorCode:e.ec,success:e.succ});this.send({type:ur.REQUEST_PROXY_WORKER_MANAGER,data:u},!0)}setProxyServer(t){this.proxyServer=t,t?N.debug("reportProxyServerurl: ".concat(t)):N.debug("disable reportProxyServerurl: ".concat(t)),st("debug",this,"setProxyServer",t)}peerPublishStatus(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const o=n.info,c=kt(),u=xr({},o,{subscribeElapse:e.subscribeElapse,peer:e.peer,peerPublishDuration:Math.max(e.audioPublishDuration,e.videoPublishDuration),audiotag:e.audioPublishDuration>0?1:-1,videotag:e.videoPublishDuration>0?1:-1,lts:c,elapse:c-n.startTime,joinChannelSuccessElapse:c-(n.lastJoinSuccessTime||c)});this.send({type:ur.PEER_PUBLISH_STATUS,data:u},!0)}workerEvent(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const o=n.info,c=kt(),u=function(d,p,f){const g=d[p];if(!g||typeof g!="string")return[d];d[p]="";const E=yc(at(d));let I=0;const _=[];let T=0;for(let R=0;R<g.length;R++)T+=g.charCodeAt(R)<=127?1:3,T<=f-E||(_[_.length]=Cd({},d,{[p]:g.substring(I,R)}),I=R,T=g.charCodeAt(R)<=127?1:3);return I!==g.length-1&&(_[_.length]=Cd({},d,{[p]:g.substring(I)})),_}(xr({},o,{},e,{elapse:c-n.startTime,lts:c,productType:"WebRTC"}),"payload",1300);G(u).call(u,d=>this.send({type:ur.WORKER_EVENT,data:d},!0))}apworkerEvent(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const o=n.info,c=kt(),u=xr({},o,{},e,{elapse:c-n.startTime,lts:c});this.send({type:ur.AP_WORKER_EVENT,data:u},!0)}joinWebProxyAP(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const o=n.info,c=kt(),u=xr({},o,{},e,{elapse:c-n.startTime,lts:c,extend:e.extend||void 0});this.send({type:ur.JOIN_WEB_PROXY_AP,data:u},!0)}WebSocketQuit(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const o=n.info,c=kt(),u=xr({},o,{},e,{elapse:c-n.startTime,lts:c});this.send({type:ur.WEBSOCKET_QUIT,data:u},!0)}async sendCustomReportMessage(t,e){if(this.customReportCount+=e.length,this.customReportCount>ot("CUSTOM_REPORT_LIMIT"))throw new Q(U.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const n=ht(e).call(e,c=>({type:ur.USER_ANALYTICS,data:xr({sid:t},c)})),o={msgType:"EventMessages",sentTs:Math.round(kt()/1e3),payloads:ht(n).call(n,c=>at(c))};try{await this.postDataToStatsCollector(o)}catch(c){throw N.error("send custom report message failed",c.toString()),new Q(U.CUSTOM_REPORT_SEND_FAILED,c.message)}}autoplayFailed(t,e,n,o){if(!t)return;const c=this.baseInfoMap.get(t);if(!c)return;const u=c.info,d=kt(),p=xr({},u,{vid:u.vid===void 0?0:Number(u.vid),lts:d,elapse:d-c.startTime,cbRegistered:yi.onAutoplayFailed||yi.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:e,trackId:o,extend:void 0});this.send({type:ur.AUTOPLAY_FAILED,data:p},!0)}sendApiInvoke(t){const e=ot("NOT_REPORT_EVENT");if(t.tag&&Xt(e)&&Xt(e).call(e,t.tag))return!1;if(t.sid===null)return this.apiInvokeUploadPendingItems.push(t),!1;const n=this.baseInfoMap.get(t.sid);if(!n)return this.apiInvokeUploadPendingItems.push(t),!1;const{cname:o,uid:c,cid:u}=n.info;t.lts=t.lts||kt();const d={invokeId:t.invokeId,sid:t.sid,cname:o,cid:u,uid:c,lts:t.lts,success:t.success,elapse:t.lts-n.startTime,execElapse:t.lts-t.apiInvokeTime,apiName:t.name,options:t.options?at(t.options):void 0,execStates:t.states?at(t.states):void 0,execResult:t.result?at(t.result):void 0,errorCode:t.error?at(t.error):void 0};return this.send({type:ur.API_INVOKE,data:d},!1),!0}appendSessionId(){var t;G(t=this.clientList).call(t,e=>{if(e._sessionId){const n=this.apiInvokeUploadPendingItems.length;for(let o=0;o<n;o++){const c=this.apiInvokeUploadPendingItems.shift();c&&(c.sid=e._sessionId,this.sendApiInvoke(Ir({},c)))}}})}send(t,e){if(e)return this.keyEventUploadPendingItems.push(t),void this.sendItems(this.keyEventUploadPendingItems,!0);var n;this.normalEventUploadPendingItems.push(t),this.normalEventUploadPendingItems.length>ot("NORMAL_EVENT_QUEUE_CAPACITY")&&Ze(n=this.normalEventUploadPendingItems).call(n,0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&kt()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t,e){const n=[],o=[];for(;t.length;){const p=t.shift();n.length<20?n.push(p):o.push(p)}t.push(...o);for(const p of[...n]){var c,u;Ft(c=this.ltsList).call(c,p.data.lts)!==-1?(p.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(p.data.lts)):(this.ltsList.push(p.data.lts),rA(u=this.ltsList).call(u,(f,g)=>f-g))}e||(this.lastSendNormalEventTime=kt());const d={msgType:"EventMessages",sentTs:Math.round(kt()/1e3),payloads:ht(n).call(n,p=>at(p)),vid:(p=>{const f=p&&p.data.sid&&this.baseInfoMap.get(p.data.sid);return f&&f.info.vid&&+f.info.vid||0})(n[0])};return n.length&&this.postDataToStatsCollector(d).catch((p=>f=>{var g,E,I;ot("EVENT_REPORT_RETRY")&&(e?this.keyEventUploadPendingItems=M(g=this.keyEventUploadPendingItems).call(g,p):(this.normalEventUploadPendingItems=M(E=this.normalEventUploadPendingItems).call(E,p),this.normalEventUploadPendingItems.length>ot("NORMAL_EVENT_QUEUE_CAPACITY")&&(Ze(I=this.normalEventUploadPendingItems).call(I,0,this.normalEventUploadPendingItems.length-ot("NORMAL_EVENT_QUEUE_CAPACITY")),N.warning("report: drop normal events"))))})(n)),t}async postDataToStatsCollector(t,e=!1){var n,o,c;tn.networkState===xi.OFFLINE&&await ct.race([tn.onlineWaiter,pn(2*Cr.maxRetryTimeout)]);const u=e?"/events/proto-raws":"/events/messages";let d=this.url||(this.proxyServer?M(n=M(o="https://".concat(this.proxyServer,"/rs/?h=")).call(o,ot("EVENT_REPORT_DOMAIN"),"&p=6443&d=")).call(n,u):M(c="https://".concat(ot("EVENT_REPORT_DOMAIN"),":6443")).call(c,u));for(let E=0;E<2;E+=1){var p,f,g;E===1&&(d=this.backupUrl||(this.proxyServer?M(p=M(f="https://".concat(this.proxyServer,"/rs/?h=")).call(f,ot("EVENT_REPORT_BACKUP_DOMAIN"),"&p=6443&d=")).call(p,u):M(g="https://".concat(ot("EVENT_REPORT_BACKUP_DOMAIN"),":6443")).call(g,u)));try{e?await L2(d,{timeout:1e4,data:t}):await to(d,{timeout:1e4,data:t})}catch(I){if(E===1)throw I;continue}return}}createBaseInfo(t,e){const n=Ir({},A2);return n.sid=t,this.baseInfoMap.set(t,{info:n,startTime:e}),n}reportResourceTiming(t,e){const n=performance.getEntriesByName(t),o=n[n.length-1];o&&this.reportApiInvoke(e,{name:"Client.resourceTiming",options:o,tag:Ut.TRACER}).onSuccess()}};function Cl(t={report:it}){return function(e,n,o){const c=e[n];if(typeof c=="function"){const u=e.constructor.name==="AgoraRTCClient"?"Client":e.constructor.name;o.value=function(...d){var p;const f=t.report.reportApiInvoke(this._sessionId||null,{name:M(p="".concat(u,".")).call(p,n),options:d,tag:Ut.TRACER});try{const g=c.apply(this,d);return f.onSuccess(),g}catch(g){throw f.onError(g),g}}}return o}}function gd(t={report:it}){return function(e,n,o){const c=e[n];if(typeof c=="function"){const u=e.constructor.name==="AgoraRTCClient"?"Client":e.constructor.name;o.value=async function(...d){var p;const f=t.report.reportApiInvoke(this._sessionId||null,{name:M(p="".concat(u,".")).call(p,n),options:d,tag:Ut.TRACER});try{const g=await c.apply(this,d);return f.onSuccess(),g}catch(g){throw f.onError(g),g}}}return o}}RA=M2([an("AgoraRTCEventReport"),P2("design:paramtypes",[])],RA);const it=new RA;$u.on("REPORT_LOG_UPLOAD",t=>{t.networkState=tn.networkState,it.reportApiInvoke(null,{name:"logUploadError",options:t,tag:Ut.TRACER})});class c1 extends Gr{constructor(e,n){super(),this._hints=[],this._isClosed=!1,this._external={},this._ID=n||gr(8,"track-"),this._originMediaStreamTrack=e,this._mediaStreamTrack=e,function(o){Xt(Qs).call(Qs,o)||Qs.push(o)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e){if(!e){const n=it.reportApiInvoke(null,{name:Vt.GET_MEDIA_STREAM_TRACK,options:[],tag:Ut.TRACER});this._mediaStreamTrack&&typeof this._mediaStreamTrack.label=="string"?n.onSuccess(this._mediaStreamTrack.label):n.onSuccess("")}return this._mediaStreamTrack}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,function(e){const n=Ft(Qs).call(Qs,e);n!==-1&&Ze(Qs).call(Qs,n,1)}(this),this.emit(hs.CLOSED)}}let x2=1;class Qi{constructor(e){var n;this.lockingPromise=ct.resolve(),this.locks=0,this.name="",this.lockId=x2++,e&&(this.name=e),N.debug(M(n="[lock-".concat(this.name,"-")).call(n,this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(e){var n,o,c;let u;this.locks+=1,N.debug(M(n=M(o=M(c="[lock-".concat(this.name,"-")).call(c,this.lockId,"] is locked, current queue ")).call(o,this.locks,". ")).call(n,typeof e=="string"?e:""));const d=new ct(f=>{u=()=>{var g,E,I;this.locks-=1,N.debug(M(g=M(E=M(I="[lock-".concat(this.name,"-")).call(I,this.lockId,"] is not locked, current queue ")).call(E,this.locks,". ")).call(g,typeof e=="string"?e:"")),f()}}),p=this.lockingPromise.then(()=>u);return this.lockingPromise=this.lockingPromise.then(()=>d),p}}function Cc(t,e){return function(n,o,c){const u=n[o];if(typeof u!="function")throw new Error("Cannot use mutex on object property.");return c.value=async function(...d){var p;const f=this[e];var g;if(!f)throw new Error(M(g="mutex property key ".concat(e," doesn't exist on ")).call(g,t));const E=await f.lock(M(p="From ".concat(t,".")).call(p,o));try{return await u.apply(this,d)}finally{E()}},c}}class As extends c1{constructor(e,n){super(e,n),this._enabled=!0,this._muted=!1,this._isClosed=!1,this._trackProcessors=[],this._handleTrackEnded=()=>{this.onTrackEnded()},this._enabledMutex=new Qi("".concat(n)),e.addEventListener("ended",this._handleTrackEnded)}get muted(){return this._muted}get enabled(){return this._enabled}getTrackLabel(){return this._originMediaStreamTrack.label}close(){var e;this._isClosed||(this.stop(),G(e=this._trackProcessors).call(e,n=>n.destroy()),this._trackProcessors=[],this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,N.debug("[".concat(this.getTrackId(),"] close")),st("debug",this,"close"),this.emit(Kt.NEED_CLOSE),super.close())}async _registerTrackProcessor(e){var n;if(Ft(n=this._trackProcessors).call(n,e)!==-1)return;const o=this._trackProcessors[this._trackProcessors.length-1];this._trackProcessors.push(e),e.onOutputChange=async()=>{const c=e.output||this._originMediaStreamTrack;this._mediaStreamTrack=c,this._updatePlayerSource(),await Kr(this,Kt.NEED_REPLACE_TRACK,this)},o?(o.onOutputChange=async()=>{o.output&&await e.setInput(o.output)},await e.setInput(o.output||o.input||this._originMediaStreamTrack)):await e.setInput(this._originMediaStreamTrack)}_getOutputFromProcessors(){if(this._trackProcessors.length===0)return this._originMediaStreamTrack;const e=this._trackProcessors[this._trackProcessors.length-1];return e.output||e.input||this._originMediaStreamTrack}async _updateOriginMediaStreamTrack(e,n){if(e!==this._originMediaStreamTrack){if(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop(),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._trackProcessors.length>0){await this._trackProcessors[0].setInput(e);const o=this._getOutputFromProcessors();this._mediaStreamTrack=o}else this._mediaStreamTrack=this._originMediaStreamTrack;this._updatePlayerSource(),await Kr(this,Kt.NEED_REPLACE_TRACK,this)}}_getDefaultPlayerConfig(){return{}}onTrackEnded(){N.debug("[".concat(this.getTrackId(),"] track ended")),ls("debug",["MediaStreamTrack",this.getTrackId()],"ended"),this.emit(hs.TRACK_ENDED)}stateCheck(e,n){var o,c,u;if(N.debug(M(o=M(c=M(u="check track state, [muted: ".concat(this._muted,", enabled: ")).call(u,this._enabled,"] to [")).call(c,e,": ")).call(o,n,"]")),st("debug",this,"stateCheck",{stateName:e,state:n,muted:this._muted,enabled:this._enabled}),ud(n,e),this._enabled&&this._muted&&e==="enabled"&&n===!1)throw new Q(U.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print();if(!this._enabled&&!this._muted&&e==="muted"&&n===!0)throw new Q(U.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print()}}var Rr,wA,l1;(function(t){t.IOS_15_INTERRUPTION_START="ios15-interruption-start",t.IOS_15_INTERRUPTION_END="ios15-interruption-end",t.IOS_INTERRUPTION_START="ios-interruption-start",t.IOS_INTERRUPTION_END="ios-interruption-end",t.STATE_CHANGE="state-change"})(Rr||(Rr={})),function(t){t.AUDIO_CONTEXT_CREATED="audio_context_created"}(wA||(wA={})),function(t){t.AIDenoiser="AIDenoiser"}(l1||(l1={}));const bA={audioContextInitOptions:{}},md=new class extends Gr{constructor(){super(),this.registeredPlugins=[]}setOptions(t,e){bA[t]&&(bA[t]=e)}getOptions(t){return bA[t]}installPlugin(t){t instanceof Object&&t.name&&this.registeredPlugins.push(t.name)}},u1=window.AudioContext||window.webkitAudioContext;let Fi=null;const he=new class extends Gr{constructor(){super(...arguments),this.onLocalAudioTrackMute=()=>{N.info("ios15-interruption-start"),nr("info",["WebAudio"],"ios15-interruption-start"),this.emit(Rr.IOS_15_INTERRUPTION_START)},this.onLocalAudioTrackUnmute=async()=>{N.info("ios15-interruption-end"),nr("info",["WebAudio"],"ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?N.info("ios15-interruption-end-canceled"):(Fi&&await Fi.suspend(),this.emit(Rr.IOS_15_INTERRUPTION_END))}}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(t){N.debug("webaudio bindInterruptDetectorTrack ".concat(t.getTrackId())),st("debug",["WebAudio"],"bindInterruptDetectorTrack",t.getTrackId()),this.interruptDetectorTrack||(this.interruptDetectorTrack=t,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(t){N.debug("webaudio unbindInterruptDetectorTrack ".concat(t.getTrackId())),st("debug",["WebAudio"],"unbindInterruptDetectorTrack",t.getTrackId()),this.interruptDetectorTrack&&this.interruptDetectorTrack===t&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function U2(){if(!u1)return N.error("your browser is not support web audio"),void Lt("error",["WebAudio"],"your browser is not support web audio");N.info("create audio context"),Ac("info",["WebAudio"],"WebAudioContext");const t=md.getOptions("audioContextInitOptions");N.debug("audio content init option:",at(t)),Fi=new u1(t),md.emit(wA.AUDIO_CONTEXT_CREATED,Fi),he.curState=Fi.state,Fi.onstatechange=()=>{var e,n;he.prevState=he.curState,he.curState=Fi?Fi.state:void 0,(vi()||cs())&&he.prevState==="running"&&he.curState==="interrupted"&&(N.info("ios-interruption-start"),nr("info",["AudioState"],"ios-interruption-start"),he.emit(Rr.IOS_INTERRUPTION_START)),(vi()||cs())&&he.prevState==="interrupted"&&he.curState==="running"&&(N.info("ios-interruption-end"),nr("info",["AudioState"],"ios-interruption-end"),he.emit(Rr.IOS_INTERRUPTION_END)),he.prevState!==he.curState&&(N.debug("AudioContext State Change",M(e="".concat(he.prevState,"=>")).call(e,he.curState)),ls("debug",["AudioContext",void 0],"statechange",M(n="".concat(he.prevState,"=>")).call(n,he.curState)),he.emit(Rr.STATE_CHANGE))},async function(e){const n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let o,c=!1,u=!1,d=!1;function p(k){e.state==="running"?f(!1):vi()||cs()?e.state==="suspended"&&(f(!0),k&&e.resume().then(E,E)):e.state!=="closed"&&(f(!0),k&&e.resume().then(E,E))}function f(k){if(c!==k){c=k;for(let L=0,Y=n;L<Y.length;L+=1){const Z=Y[L];k?window.addEventListener(Z,I,{capture:!0,passive:!0}):window.removeEventListener(Z,I,{capture:!0,passive:!0})}}}function g(){p(!0)}function E(){p(!1)}function I(){p(!0)}function _(k){if(!d)if(o.paused)if(k){T(!1),d=!0;let L;try{L=o.play(),L?L.then(R,R):(o.addEventListener("playing",R),o.addEventListener("abort",R),o.addEventListener("error",R))}catch{R()}}else T(!0);else T(!1)}function T(k){if(u!==k){u=k;for(let L=0,Y=n;L<Y.length;L++){const Z=Y[L];k?window.addEventListener(Z,w,{capture:!0,passive:!0}):window.removeEventListener(Z,w,{capture:!0,passive:!0})}}}function R(){o.removeEventListener("playing",R),o.removeEventListener("abort",R),o.removeEventListener("error",R),d=!1,_(!1)}function w(){_(!0)}if(vi()){const k=e.createMediaStreamDestination(),L=document.createElement("div");L.innerHTML="<audio x-webkit-airplay='deny'></audio>",o=L.children.item(0),o.controls=!1,o.disableRemotePlayback=!0,o.preload="auto",o.srcObject=k.stream,_(!0)}he.on(Rr.STATE_CHANGE,g),p(!1)}(Fi)}function _l(){if(!Fi){if(U2(),!Fi)throw new Q(U.NOT_SUPPORTED,"can not create audio context");return Fi}return Fi}function yl(t){if(function(){if(NA!==null)return NA;const o=_l(),c=o.createBufferSource(),u=o.createGain(),d=o.createGain();c.connect(u),c.connect(d),c.disconnect(u);let p=!1;try{c.disconnect(u)}catch{p=!0}return c.disconnect(),NA=p,p}())return;st("debug",["WebAudio"],"polyfillAudioNode");const e=t.connect,n=t.disconnect;t.connect=(o,c,u)=>{var d;return t._inputNodes||(t._inputNodes=[]),Xt(d=t._inputNodes).call(d,o)||(o instanceof AudioNode?(t._inputNodes.push(o),e.call(t,o,c,u)):e.call(t,o,c)),t},t.disconnect=(o,c,u)=>{n.call(t),o?MA(t._inputNodes,o):t._inputNodes=[];for(const d of t._inputNodes)e.call(t,d)}}let NA=null;function OA(t,e){const n=1/e,o=_l();let c=o.createGain();c.gain.value=0,c.connect(o.destination);let u=!1;const d=()=>{if(u)return void(c=null);const p=o.createOscillator();p.onended=d,p.connect(c),p.start(0),p.stop(o.currentTime+n),t(o.currentTime)};return d(),()=>{u=!0}}const js=N.prefix("[inject-node]");class Q2{constructor(){this.nodeLists=[]}get firstNode(){return this.nodeLists[0]}get lastNode(){return this.nodeLists[this.nodeLists.length-1]}get isActive(){return!!this.nodeLists.length}get isConnected(){return!(!this.prevNode||!this.nextNode)}connect(e,n){var o;js.debug("connect audio node, current list:"+this.nodeLists.length),this.nodeLists.length?(this.prevNode&&this.prevNode.disconnect(),e.connect(this.firstNode),this.nextNode&&this.lastNode&&this.lastNode.disconnect(),this.lastNode.connect(n),G(o=this.nodeLists).call(o,(c,u)=>{const d=this.nodeLists[u+1];d&&c.connect(d)})):e.connect(n),this.nextNode=n,this.prevNode=e}disconnect(){var e,n;js.debug("disconnect audio node, current list:"+this.nodeLists.length),G(e=this.nodeLists).call(e,o=>{o.disconnect()}),(n=this.prevNode)===null||n===void 0||n.disconnect(),this.prevNode=void 0,this.nextNode=void 0}addNode(e){js.debug("add node in inject node, current list:",this.nodeLists.length),this.prevNode&&this.nextNode?(this.firstNode||(js.debug("new node is the first node"),this.prevNode.disconnect(),this.prevNode.connect(e),e.connect(this.nextNode)),this.nextNode&&this.lastNode&&(this.lastNode.disconnect(this.nextNode),this.lastNode.connect(e),e.connect(this.nextNode)),this.nodeLists.push(e)):js.debug("add node is called before inject node connected")}removeNode(e){var n;js.debug("remove node in inject node, current list:",this.nodeLists.length);const o=Ft(n=this.nodeLists).call(n,e);if(o===-1)return void js.debug("$[inject-node] cannot find the node to be removed");const c=this.nodeLists[o+1],u=this.nodeLists[o-1];o===0&&this.prevNode&&this.nextNode&&(this.prevNode.disconnect(e),c?this.prevNode.connect(c):this.prevNode.connect(this.nextNode)),o===this.nodeLists.length-1&&this.nextNode&&u&&(u.disconnect(e),u.connect(this.nextNode)),o!==0&&o!==this.nodeLists.length-1&&(u.disconnect(e),u.connect(c)),js.debug("remove node in inject node success, current list:",this.nodeLists.length)}}class d1 extends Gr{constructor(){super(),this.isPlayed=!1,this.audioOutputLevel=0,this.isDestroyed=!1,this.isNoAudioInput=!1,this._noAudioInputCount=0,this.context=_l(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),yl(this.outputNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.smoothingTimeConstant=.4,this.analyserNode.fftSize=2048,this.injectNode=new Q2}startGetAudioBuffer(e){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(Zi.ON_AUDIO_BUFFER,function(o){for(let c=0;c<o.outputBuffer.numberOfChannels;c+=1){const u=o.outputBuffer.getChannelData(c);for(let d=0;d<u.length;d+=1)u[d]=0}return o.inputBuffer}(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Mn().webAudioMediaStreamDest)throw new Q(U.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e){this.context.state!=="running"&&Gi(()=>{he.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){if(!this.context||vi()||cs()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode)return 0;const e=new Uint8Array(this.analyserNode.frequencyBinCount);this.analyserNode.getByteFrequencyData(e);let n=0;for(let o=0;o<e.length;o++)n+=o<64?Math.abs(10*e[o]):Math.abs(6*e[o]/15);return n/e.length/255}async checkHasAudioInput(e=0){if(e>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;if(vi()||cs()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume(),!this.analyserNode)return!1;const n=new Uint8Array(this.analyserNode.frequencyBinCount);this.analyserNode.getByteFrequencyData(n);let o=!1;for(let c=0;c<n.length;c++)n[c]!==0&&(o=!0);return o?(this.isNoAudioInput=!1,!0):(await pn(200),await this.checkHasAudioInput(e?e+1:1)&&o)}getAudioVolume(){return this.outputNode.gain.value}setVolume(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}setMute(e){e?(this.disconnect(),this.audioOutputLevel=0):this.connect()}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}injectAudioNode(e){this.injectNode.addNode(e)}removeAudioNode(e){this.injectNode.removeNode(e)}disconnect(){this.sourceNode&&this.sourceNode.disconnect(),this.injectNode.isConnected&&this.injectNode.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){this.sourceNode&&this.injectNode.connect(this.sourceNode,this.outputNode),this.outputNode.connect(this.analyserNode)}}class h1 extends d1{constructor(e,n){var o;if(super(),this.isCurrentTrackCloned=!1,this.isRemoteTrack=!1,this.rebuildWebAudio=async()=>{if(N.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void N.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>N.info("resume success")),N.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const d=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?d.stop():this.isCurrentTrackCloned=!0;const p=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(p),yl(this.sourceNode),this.analyserNode=this.context.createAnalyser();const f=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(f,this.context.currentTime),yl(this.outputNode),this.connect(),this.audioElement.srcObject=p,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()},e.kind!=="audio")throw new Q(U.UNEXPECTED_ERROR);this.track=e;const c=new MediaStream([this.track]);this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(c),yl(this.sourceNode),this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=c;const u=Ke();n&&u.os===Zr.IOS&&Number((o=u.osVersion)===null||o===void 0?void 0:o.split(".")[0])<15&&(he.on(Rr.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(d=>{d||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}get isFreeze(){return!1}updateTrack(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1;const n=new MediaStream([e]);this.sourceNode=this.context.createMediaStreamSource(n),yl(this.sourceNode),this.injectNode.connect(this.sourceNode,this.outputNode),this.audioElement.srcObject=n}destroy(){this.audioElement.srcObject=null,this.audioElement.remove(),he.off("state-change",this.rebuildWebAudio),super.destroy()}}async function p1(t,e){const n=(c,u)=>c?typeof c!="number"?c.max||c.exact||c.ideal||c.min||u:c:u,o={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxHeight:n(e.height,1080),maxWidth:n(e.width,1920)}}};return e.frameRate&&typeof e.frameRate!="number"?(o.video.mandatory.maxFrameRate=e.frameRate.max,o.video.mandatory.minFrameRate=e.frameRate.min):typeof e.frameRate=="number"&&(o.video.mandatory.maxFrameRate=e.frameRate),await navigator.mediaDevices.getUserMedia(o)}async function F2(t){const e=await A1(t.mediaSource),n=await function(o){return new ct((c,u)=>{const d=document.createElement("div");d.innerText="share screen",d.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const p=document.createElement("div");p.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const f=document.createElement("div");f.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",f.setAttribute("style","height: 12%;");const g=document.createElement("div");g.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const E=document.createElement("div");E.setAttribute("style","text-align: right; padding: 16px 0;");const I=document.createElement("button");I.innerHTML="cancel",I.setAttribute("style","width: 85px;"),I.onclick=()=>{document.body.removeChild(_);const T=new Error("NotAllowedError");T.name="NotAllowedError",u(T)},E.appendChild(I),p.appendChild(f),p.appendChild(g),p.appendChild(E);const _=document.createElement("div");_.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),_.appendChild(d),_.appendChild(p),document.body.appendChild(_),ht(o).call(o,T=>{if(T.id){const R=document.createElement("div");R.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let w=T.thumbnail;const{width:k}=w.getSize();k>1920&&(w=w.resize({width:1920})),R.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+w.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+(T.name.replace(/[\u00A0-\u9999<>\&]/g,function(L){return"&#"+L.charCodeAt(0)+";"})+"</span>"),R.onclick=()=>{document.body.removeChild(_),c(T.id)},g.appendChild(R)}})})}(e);return await p1(n,t)}async function A1(t){let e=["window","screen"];t!=="application"&&t!=="window"||(e=["window"]),t==="screen"&&(e=["screen"]);const n=f1();if(!n)throw new Q(U.ELECTRON_IS_NULL);let o=null;try{o=n.desktopCapturer.getSources({types:e})}catch{o=null}o&&o.then||(o=new ct((c,u)=>{n.desktopCapturer.getSources({types:e},(d,p)=>{d?u(d):c(p)})}));try{return await o}catch(c){throw new Q(U.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,c.toString())}}let Ed=null;function f1(){if(Ed)return Ed;try{return Ed=window.require("electron"),Ed}catch{return null}}const kA=new Qi("safari");let g1=!1,m1=!1;async function eo(t,e){let n=0,o=null;for(;n<2;)try{o=await V2(t,e,n>0);break}catch(d){var c,u;if(d instanceof Q)throw N.error(M(u="[".concat(e,"] ")).call(u,d.toString())),st("error",[],"getLocalStream",{config:t,id:e},d.toString()),d;const p=vd(d.name||d.code||d,d.message);if(p.code===U.MEDIA_OPTION_INVALID){N.debug("[".concat(e,"] detect media option invalid, retry")),Lt("debug",[],"[".concat(e,"] detect media option invalid, retry")),n+=1,await pn(500);continue}throw N.error(M(c="[".concat(e,"] ")).call(c,p.toString())),st("error",[],"getLocalStream",{config:t,id:e},p.toString()),p}if(!o)throw new Q(U.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return o}async function V2(t,e,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Q(U.NOT_SUPPORTED,"can not find getUserMedia");n&&(t.video&&(delete t.video.width,delete t.video.height),t.screen&&(delete t.screen.width,delete t.screen.height));const o=Mn(),c=new MediaStream;if(t.audioSource&&c.addTrack(t.audioSource),t.videoSource&&c.addTrack(t.videoSource),!t.audio&&!t.video&&!t.screen)return N.debug("Using Video Source/ Audio Source"),Lt("debug",[],"Using Video Source/ Audio Source"),c;if(t.screen)if(f1())t.screen.sourceId?_c(c,await p1(t.screen.sourceId,t.screen)):_c(c,await F2(t.screen));else if(Wu()&&t.screen.extensionId&&t.screen.mandatory){if(!o.getStreamFromExtension)throw new Q(U.NOT_SUPPORTED,"This browser does not support screen sharing");N.debug("[".concat(e,'] Screen access on chrome stable, looking for extension"')),Lt("debug",[],"[".concat(e,'] Screen access on chrome stable, looking for extension"'));const _=await(d=t.screen.extensionId,p=e,new ct((T,R)=>{try{chrome.runtime.sendMessage(d,{getStream:!0},L=>{if(!L||!L.streamId)return N.error("[".concat(p,"] No response from Chrome Plugin. Plugin not installed properly"),L),st("error",[],"getSourceIdFromExtension",{extensionId:d,streamId:p},"No response from Chrome Plugin. Plugin not installed properly, ".concat(L)),void R(new Q(U.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));T(L.streamId)})}catch(L){var w,k;N.error(M(w="[".concat(p,"] AgoraRTC screensharing plugin is not accessible(")).call(w,d,")"),L.toString()),st("error",[],"getSourceIdFromExtension",{extensionId:d,streamId:p},M(k="AgoraRTC screensharing plugin is not accessible(".concat(d,"), ")).call(k,L.toString())),R(new Q(U.CHROME_PLUGIN_NOT_INSTALL))}}));t.screen.mandatory.chromeMediaSourceId=_,_c(c,await navigator.mediaDevices.getUserMedia({video:{mandatory:t.screen.mandatory}}))}else if(o.getDisplayMedia){t.screen.mediaSource&&VI(t.screen.mediaSource);const _={width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate,displaySurface:t.screen.mediaSource==="screen"?"monitor":t.screen.mediaSource};N.debug("[".concat(e,"] getDisplayMedia:"),at({video:_,audio:!!t.screenAudio})),Ac("debug",["mediaDevices",e],"getDisplayMedia",{video:_,audio:!!t.screenAudio,trackId:e}),_c(c,await navigator.mediaDevices.getDisplayMedia({video:_,audio:!!t.screenAudio}))}else{if(!si())throw N.error("[".concat(e,"] This browser does not support screenSharing")),new Q(U.NOT_SUPPORTED,"This browser does not support screen sharing");{var u;t.screen.mediaSource&&VI(t.screen.mediaSource);const _={video:{mediaSource:t.screen.mediaSource,width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate}};N.debug(M(u="[".concat(e,"] getUserMedia: ")).call(u,at(_))),Ac("debug",["mediaDevices",e],"getUserMedia",_),_c(c,await navigator.mediaDevices.getUserMedia(_))}}var d,p;if(!t.video&&!t.audio)return c;let f={video:t.video,audio:t.audio},g=ot("MEDIA_DEVICE_CONSTRAINTS");if(g)try{typeof g=="string"&&(g=JSON.parse(g)),f=function _(T,R){if(!V1(T)||!V1(R)||sn(T)&&!sn(R)||!sn(T)&&sn(R))return R;if(sn(R)&&sn(T)){const w=[...T];for(let k=0;k<R.length;k++)w[k]=_(T[k],R[k]);return w}{const w=Cd({},T);for(const k in R)Object.prototype.hasOwnProperty.call(R,k)&&(Object.prototype.hasOwnProperty.call(T,k)?w[k]=_(T[k],R[k]):w[k]=R[k]);return w}}(f,g),Lt("debug",["mediaDevices",e],"merge configConstraints ".concat(at(g)))}catch{}N.debug("[".concat(e,"] GetUserMedia"),at(f)),Ac("debug",["mediaDevices",e],"getUserMedia",f),Ke();let E,I=null;(Ei()||vi()||Hu())&&(I=await kA.lock());try{E=await navigator.mediaDevices.getUserMedia(f)}catch(_){throw I&&I(),_}return f.audio&&(g1=!0),f.video&&(m1=!0),_c(c,E),I&&I(),c}function vd(t,e){switch(t){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":var n;return new Q(U.MEDIA_OPTION_INVALID,M(n="".concat(t,": ")).call(n,e));case"NotFoundError":case"DevicesNotFoundError":var o;return new Q(U.DEVICE_NOT_FOUND,M(o="".concat(t,": ")).call(o,e));case"NotSupportedError":var c;return new Q(U.NOT_SUPPORTED,M(c="".concat(t,": ")).call(c,e));case"NotReadableError":var u;return new Q(U.NOT_READABLE,M(u="".concat(t,": ")).call(u,e));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":var d;return new Q(U.PERMISSION_DENIED,M(d="".concat(t,": ")).call(d,e));case"ConstraintNotSatisfiedError":var p;return new Q(U.CONSTRAINT_NOT_SATISFIED,M(p="".concat(t,": ")).call(p,e));default:var f;return N.error("getUserMedia unexpected error",t),st("error",[],"handleGetUserMediaError",void 0,t),new Q(U.UNEXPECTED_ERROR,M(f="".concat(t,": ")).call(f,e))}}function _c(t,e){const n=t.getVideoTracks()[0],o=t.getAudioTracks()[0],c=e.getVideoTracks()[0],u=e.getAudioTracks()[0];u&&(o&&t.removeTrack(o),t.addTrack(u)),c&&(n&&t.removeTrack(n),t.addTrack(c))}const ai=new class extends Gr{constructor(){super(),this._state=ma.IDLE,this.isAccessMicrophonePermission=!1,this.isAccessCameraPermission=!1,this.lastAccessMicrophonePermission=!1,this.lastAccessCameraPermission=!1,this.checkdeviceMatched=!1,this.deviceInfoMap=new tr,this.init().then(()=>{var t;navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",vn(t=this.updateDevicesInfo).call(t,this)),window.setInterval(()=>{(ot("ENUMERATE_DEVICES_INTERVAL")||aI()&&uc())&&this.updateDevicesInfo()},ot("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(t=>N.error(t.toString()))}get state(){return this._state}set state(t){t!==this._state&&(this.emit(ds.STATE_CHANGE,t),this._state=t)}async enumerateDevices(t,e,n=!1){if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Q(U.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const o=await navigator.mediaDevices.enumerateDevices(),c=this.checkMediaDeviceInfoIsOk(o);let u=!this.isAccessMicrophonePermission&&t,d=!this.isAccessCameraPermission&&e;c.audio&&(u=!1),c.video&&(d=!1);let p=null,f=null,g=null;if(!n&&(u||d)){if(kA.isLocked&&(N.debug("[device manager] wait GUM lock"),(await kA.lock())(),N.debug("[device manager] GUM unlock")),g1&&(u=!1,this.isAccessMicrophonePermission=!0),m1&&(d=!1,this.isAccessCameraPermission=!0),N.debug("[device manager] check media device permissions",t,e,u,d),u&&d){try{g=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(k){const L=vd(k.name||k.code||k,k.message);if(L.code===U.PERMISSION_DENIED)throw L;N.warning("getUserMedia failed in getDevices",L)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(u){try{p=await navigator.mediaDevices.getUserMedia({audio:t})}catch(k){const L=vd(k.name||k.code||k,k.message);if(L.code===U.PERMISSION_DENIED)throw L;N.warning("getUserMedia failed in getDevices",L)}this.isAccessMicrophonePermission=!0}else if(d){try{f=await navigator.mediaDevices.getUserMedia({video:e})}catch(k){const L=vd(k.name||k.code||k,k.message);if(L.code===U.PERMISSION_DENIED)throw L;N.warning("getUserMedia failed in getDevices",L)}this.isAccessCameraPermission=!0}N.debug("[device manager] mic permission",t,"cam permission",e)}try{var E,I,_;const k=await navigator.mediaDevices.enumerateDevices();return p&&G(E=p.getTracks()).call(E,L=>L.stop()),f&&G(I=f.getTracks()).call(I,L=>L.stop()),g&&G(_=g.getTracks()).call(_,L=>L.stop()),p=null,f=null,g=null,k}catch(k){var T,R,w;return p&&G(T=p.getTracks()).call(T,L=>L.stop()),f&&G(R=f.getTracks()).call(R,L=>L.stop()),g&&G(w=g.getTracks()).call(w,L=>L.stop()),p=null,f=null,g=null,new Q(U.ENUMERATE_DEVICES_FAILED,k.toString()).throw()}}async getRecordingDevices(t=!1){const e=await this.enumerateDevices(!0,!1,t);return Ot(e).call(e,n=>n.kind==="audioinput")}async getCamerasDevices(t=!1){const e=await this.enumerateDevices(!1,!0,t);return Ot(e).call(e,n=>n.kind==="videoinput")}async getSpeakers(t=!1){const e=await this.enumerateDevices(!0,!1,t);return Ot(e).call(e,n=>n.kind==="audiooutput")}searchDeviceIdByName(t){var e;let n=null;return G(e=this.deviceInfoMap).call(e,o=>{o.device.label===t&&(n=o.device.deviceId)}),n}async getDeviceById(t){const e=await this.enumerateDevices(!0,!0,!0),n=yt(e).call(e,o=>o.deviceId===t);if(!n)throw new Q(U.DEVICE_NOT_FOUND,"deviceId: ".concat(t));return n}async init(){this.state=ma.INITING;try{await this.updateDevicesInfo(),this.state=ma.INITEND}catch(t){throw N.warning("Device Detection functionality cannot start properly.",t.toString()),this.state=ma.IDLE,!function(){return typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1"}()&&new Q(U.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),t}}async updateDevicesInfo(){var t;const e=await this.enumerateDevices(!0,!0,!0),n=kt(),o=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const p=yt(e).call(e,g=>g.kind==="audioinput"&&g.deviceId==="default"),f=yt(e).call(e,g=>g.kind==="audiooutput"&&g.deviceId==="default");if(p&&f)if(f.groupId===p.groupId){var c;N.debug(M(c="[device-check] default input ".concat(p.label," and output ")).call(c,f.label," is the same group"))}else{var u;N.warning(M(u="[device-check] default input ".concat(p.label," and output ")).call(u,f.label," is not the same group"))}else N.debug("[device-check] default input or output not found")}const d=this.checkMediaDeviceInfoIsOk(e);if(G(e).call(e,p=>{var f;if(!p.deviceId)return;const g=this.deviceInfoMap.get(M(f="".concat(p.kind,"_")).call(f,p.deviceId));if((g?g.state:"INACTIVE")!=="ACTIVE"){var E;const I={initAt:n,updateAt:n,device:p,state:"ACTIVE"};this.deviceInfoMap.set(M(E="".concat(p.kind,"_")).call(E,p.deviceId),I),o.push(I)}g&&(g.updateAt=n)}),G(t=this.deviceInfoMap).call(t,(p,f)=>{p.state==="ACTIVE"&&p.updateAt!==n&&(p.state="INACTIVE",o.push(p))}),this.state!==ma.INITEND)return d.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(d.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));G(o).call(o,p=>{switch(p.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(ds.RECORDING_DEVICE_CHANGED,p);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(ds.CAMERA_DEVICE_CHANGED,p);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(ds.PLAYOUT_DEVICE_CHANGED,p)}}),d.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),d.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(t){const e=Ot(t).call(t,c=>c.kind==="audioinput"),n=Ot(t).call(t,c=>c.kind==="videoinput"),o={audio:!1,video:!1};for(const c of e)if(c.label&&c.deviceId){o.audio=!0;break}for(const c of n)if(c.label&&c.deviceId){o.video=!0;break}return o}};class E1 extends d1{constructor(e,n={}){super(),this.startPlayTime=0,this.startPlayOffset=0,this.pausePlayTime=0,this.currentLoopCount=0,this._currentState="stopped",this.audioBuffer=e,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}set currentState(e){e!==this._currentState&&(this._currentState=e,this.emit(Zi.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer.duration}get currentTime(){return this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:(this.context.currentTime-this.startPlayTime+this.startPlayOffset)%this.audioBuffer.duration}updateOptions(e){this.currentState==="stopped"?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):N.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=e,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=e))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}startSourceNode(){var e;this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=vn(e=this.handleSourceNodeEnded).call(e,this))}createSourceNode(){const e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const v1=new tr;async function G2(t,e){let n=null;if(typeof t=="string"){const c=v1.get(t);if(c)return N.debug("use cached audio resource: ",t),c;try{n=(await Li(()=>yo.get(t,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(u){throw new Q(U.FETCH_AUDIO_FILE_FAILED,u.toString())}}else n=await new ct((u,d)=>{const p=new FileReader;p.onload=f=>{f.target?u(f.target.result):d(new Q(U.READ_LOCAL_AUDIO_FILE_ERROR))},p.onerror=()=>{d(new Q(U.READ_LOCAL_AUDIO_FILE_ERROR))},p.readAsArrayBuffer(t)});const o=await function(c){const u=_l();return new ct((d,p)=>{u.decodeAudioData(c,f=>{d(f)},f=>{p(new Q(U.DECODE_AUDIO_FILE_FAILED,f.toString()))})})}(n);return typeof t=="string"&&e&&v1.set(t,o),o}var j2=function(t,e,n,o){var c,u=arguments.length,d=u<3?e:o===null?o=zt(e,n):o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(t,e,n,o);else for(var p=t.length-1;p>=0;p--)(c=t[p])&&(d=(u<3?c(d):u>3?c(e,n,d):c(e,n))||d);return u>3&&d&&te(e,n,d),d},K2=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};let DA=class{constructor(){this.elementMap=new tr,this.elementStateMap=new tr,this.elementsNeedToResume=[],this.sinkIdMap=new tr,this.autoResumeAfterInterruption=()=>{var t,e;G(t=Ue(Tr(e=this.elementMap).call(e))).call(t,([n,o])=>{const c=this.elementStateMap.get(n),u=o.srcObject.getAudioTracks()[0];lc()?u&&u.readyState==="live"&&he.curState==="running"&&(N.debug("auto resume after interruption for iOS 15"),Lt("debug",["AudioElementPlayCenter",n],"auto resume after interruption for iOS15"),o.pause(),o.play()):c&&c==="paused"&&u&&u.readyState==="live"&&he.curState==="running"&&(N.debug("auto resume after interruption for iOS"),Lt("debug",["AudioElementPlayCenter",n],"auto resume after interruption for iOS"),o.play())})},this.autoResumeAfterInterruptionOnIOS15=()=>{var t,e;G(t=Ue(Tr(e=this.elementMap).call(e))).call(t,([n,o])=>{const c=o.srcObject.getAudioTracks()[0];c&&c.readyState==="live"&&(N.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),st("debug",["AudioElementPlayCenter",n],"autoResumeAfterInterruptionOnIOS15"),o.pause(),o.play())})},this.autoResumeAudioElement(),he.on(Rr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),he.on(Rr.IOS_15_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15),he.on(Rr.STATE_CHANGE,()=>{vi()&&he.prevState==="suspended"&&he.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(t,e){const n=this.elementMap.get(t);if(this.sinkIdMap.set(t,e),n)try{await n.setSinkId(e)}catch(o){throw new Q(U.PERMISSION_DENIED,"can not set sink id: "+o.toString())}}play(t,e,n,o){if(this.elementMap.has(e))return;const c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([t]),this.bindAudioElementEvents(e,c),this.elementMap.set(e,c),this.elementStateMap.set(e,cn.INIT),this.setVolume(e,n);const u=this.sinkIdMap.get(e);if(u)try{c.setSinkId(u).catch(p=>{N.warning("[".concat(e,"] set sink id failed"),p.toString()),Ac("warning",["HTMLAudioElement",e],"setSinkId",p.toString())})}catch(p){N.warning("[".concat(e,"] set sink id failed"),p.toString())}const d=c.play();d&&d.then&&d.catch(p=>{o&&it.autoplayFailed(o,"audio",p.message,e),N.warning("audio element play warning",p.toString()),Ac("warning",["HTMLAudioElement",e],"play",p.toString()),this.elementMap.has(e)&&p.name==="NotAllowedError"&&(N.warning("detected audio element autoplay failed"),st("warning",["AudioElementPlayCenter",e],"play",p.toString()),this.elementsNeedToResume.push(c),Gi(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),s1()}))})}updateTrack(t,e){const n=this.elementMap.get(t);n&&(n.srcObject=new MediaStream([e]))}isPlaying(t){return this.elementMap.has(t)}setVolume(t,e){const n=this.elementMap.get(t);n&&(e=Math.max(0,Math.min(100,e)),n.volume=e/100)}stop(t){var e,n;const o=this.elementMap.get(t);if(this.sinkIdMap.delete(t),!o)return;const c=Ft(e=this.elementsNeedToResume).call(e,o);Ze(n=this.elementsNeedToResume).call(n,c,1),o.srcObject=null,o.remove(),this.elementMap.delete(t),this.elementStateMap.delete(t)}bindAudioElementEvents(t,e){G(I1).call(I1,n=>{e.addEventListener(n,o=>{var c,u,d;const p=this.elementStateMap.get(t),f=o.type==="pause"?"paused":o.type;N.debug(M(c=M(u="[".concat(t,"] audio-element-status change ")).call(u,p," => ")).call(c,f)),ls("debug",["HTMLAudioElement",t],"statusChange",M(d="".concat(p," => ")).call(d,f)),this.elementStateMap.set(t,f)})})}getPlayerState(t){return this.elementStateMap.get(t)||"uninit"}autoResumeAudioElement(){const t=()=>{var e;G(e=this.elementsNeedToResume).call(e,n=>{n.play().then(o=>{N.debug("Auto resume audio element success"),st("debug",["AudioElementPlayCenter"],"autoResumeAudioElement")}).catch(o=>{N.warning("Auto resume audio element failed!",o),st("warning",["AudioElementPlayCenter"],"autoResumeAudioElement",o.toString())})}),this.elementsNeedToResume=[]};new ct(e=>{document.body?e():window.addEventListener("load",()=>e())}).then(()=>{const e=Ke();e.os!=="Android"||e.name!=="Chrome"&&e.name!==be.WECHAT?(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)):document.body.addEventListener("click",t,!0)})}};DA=j2([an("AudioElementPlayCenter"),K2("design:paramtypes",[])],DA);const I1=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended"],ci=new DA;function hr(){return function(t,e,n){const o=t[e];typeof o=="function"&&(n.value=function(...c){this._isClosed&&new Q(U.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning");const u=o.apply(this,c);return u instanceof ct?new ct((d,p)=>{u.then(d).catch(p)}):u})}}function C1(t,e){var n=ue(t);if(_e){var o=_e(t);e&&(o=Ot(o).call(o,function(c){return zt(t,c).enumerable})),n.push.apply(n,o)}return n}function Id(t){for(var e=1;e<arguments.length;e++){var n,o=arguments[e]!=null?arguments[e]:{};if(e%2)G(n=C1(Object(o),!0)).call(n,function(u){qr(t,u,o[u])});else if(Ce)dr(t,Ce(o));else{var c;G(c=C1(Object(o))).call(c,function(u){te(t,u,zt(o,u))})}}return t}var Sn=function(t,e,n,o){var c,u=arguments.length,d=u<3?e:o===null?o=zt(e,n):o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(t,e,n,o);else for(var p=t.length-1;p>=0;p--)(c=t[p])&&(d=(u<3?c(d):u>3?c(e,n,d):c(e,n))||d);return u>3&&d&&te(e,n,d),d},pe=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};let lr=class extends As{constructor(t,e,n){super(t,n),this.trackMediaType="audio",this._enabled=!0,this._volume=100,this._useAudioElement=!1,this._bypassWebAudio=!1,this._encoderConfig=e,this._source=new h1(t),ot("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0)}get isPlaying(){return this._useAudioElement?ci.isPlaying(this.getTrackId()):this._source.isPlayed}setVolume(t){He(t,"volume",0,1e3);const e=it.reportApiInvoke(null,{tag:Ut.TRACER,name:Vt.LOCAL_AUDIO_TRACK_SET_VOLUME,options:[this.getTrackId(),t]},300);this._volume=t,this._source.setVolume(t/100),this._useAudioElement&&ci.setVolume(this.getTrackId(),t);try{if(this._bypassWebAudio)return N.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio.")),void e.onSuccess();const n=this._source.createOutputTrack();this._mediaStreamTrack!==n&&(this._mediaStreamTrack=n,Kr(this,Kt.NEED_REPLACE_TRACK,this).then(()=>{N.debug("[".concat(this.getTrackId(),"] replace web audio track success")),Lt("debug",this,"replace web audio track success")}).catch(o=>{N.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),o),Lt("warning",this,"replace web audio track failed ".concat(o.toString()))}))}catch{}e.onSuccess()}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}async setPlaybackDevice(t){const e=it.reportApiInvoke(null,{tag:Ut.TRACER,name:Vt.REMOTE_AUDIO_SET_OUTPUT_DEVICE,options:[this.getTrackId(),t]});if(!this._useAudioElement)throw new Q(U.NOT_SUPPORTED,"your browser does not support setting the audio output device");try{await ci.setSinkID(this.getTrackId(),t)}catch(n){throw e.onError(n),n}e.onSuccess()}async setEnabled(t,e,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(N.info("[".concat(this.getTrackId(),"] start setEnabled"),t),st("info",this,"setEnabled",t),t){this._originMediaStreamTrack.enabled=!0;try{var o;n||(this._enabled=!0),await Kr(this,Kt.NEED_ENABLE_TRACK,this),N.info(M(o="[".concat(this.getTrackId(),"] setEnabled to ")).call(o,t," success")),st("info",this,"setEnabled",t,"success")}catch(c){throw n||(this._enabled=!1),N.error("[".concat(this.getTrackId(),"] setEnabled to true error"),c.toString()),st("error",this,"setEnabled",t,c.toString()),c}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await Kr(this,Kt.NEED_DISABLE_TRACK,this)}catch(c){throw n||(this._enabled=!0),N.error("[".concat(this.getTrackId(),"] setEnabled to false error"),c.toString()),st("info",this,"setEnabled",t,c.toString()),c}}}async setMuted(t){var e;t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._mediaStreamTrack.enabled=!t,N.debug(M(e="[".concat(this.getTrackId(),"] start set muted: ")).call(e,t)),st("debug",this,"setMuted",t),t?await Kr(this,Kt.NEED_MUTE_TRACK,this):await Kr(this,Kt.NEED_UNMUTE_TRACK,this))}getStats(){return Sl(()=>{N.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead"),Lt("warning",this,"LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),ya(this,Kt.GET_STATS)||Id({},lA)}setAudioFrameCallback(t,e=4096){if(!t)return this._source.removeAllListeners(Zi.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(Zi.ON_AUDIO_BUFFER),this._source.on(Zi.ON_AUDIO_BUFFER,n=>t(n))}play(){const t=it.reportApiInvoke(null,{tag:Ut.TRACER,name:Vt.LOCAL_AUDIO_TRACK_PLAY,options:[this.getTrackId()]});N.debug("[".concat(this.getTrackId(),"] start audio playback")),st("debug",this,"play"),this._useAudioElement?(N.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Lt("debug",this,"start audio playback in element"),ci.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play(),t.onSuccess()}stop(){const t=it.reportApiInvoke(null,{tag:Ut.TRACER,name:Vt.LOCAL_AUDIO_TRACK_STOP,options:[this.getTrackId()]});N.debug("[".concat(this.getTrackId(),"] stop audio playback")),st("debug",this,"stop"),this._useAudioElement?ci.stop(this.getTrackId()):this._source.stop(),t.onSuccess()}close(){super.close(),this._source.destroy()}_updatePlayerSource(){N.debug("[".concat(this.getTrackId(),"] update player source track")),st("debug",this,"_updatePlayerSource"),this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&ci.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(t,e){this._originMediaStreamTrack!==t&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t.addEventListener("ended",this._handleTrackEnded),e&&this._originMediaStreamTrack.stop(),this._originMediaStreamTrack=t,this._source.updateTrack(this._originMediaStreamTrack),this._mediaStreamTrack!==this._source.outputTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Kr(this,Kt.NEED_REPLACE_TRACK,this)))}renewMediaStreamTrack(){return ct.resolve(void 0)}};Sn([hr(),pe("design:type",Function),pe("design:paramtypes",[String]),pe("design:returntype",ct)],lr.prototype,"setPlaybackDevice",null),Sn([Cc("LocalAudioTrack","_enabledMutex"),hr(),pe("design:type",Function),pe("design:paramtypes",[Boolean,Object,Boolean]),pe("design:returntype",ct)],lr.prototype,"setEnabled",null),Sn([Cc("LocalAudioTrack","_enabledMutex"),hr(),gd({report:it}),pe("design:type",Function),pe("design:paramtypes",[Boolean]),pe("design:returntype",ct)],lr.prototype,"setMuted",null),Sn([hr(),pe("design:type",Function),pe("design:paramtypes",[]),pe("design:returntype",Object)],lr.prototype,"getStats",null),Sn([hr(),pe("design:type",Function),pe("design:paramtypes",[Object,Number]),pe("design:returntype",void 0)],lr.prototype,"setAudioFrameCallback",null),Sn([hr(),pe("design:type",Function),pe("design:paramtypes",[]),pe("design:returntype",void 0)],lr.prototype,"play",null),Sn([hr(),pe("design:type",Function),pe("design:paramtypes",[]),pe("design:returntype",void 0)],lr.prototype,"stop",null),lr=Sn([an("LocalAudioTrack","getTrackId"),pe("design:paramtypes",[MediaStreamTrack,Object,String])],lr);let Ks=class extends lr{constructor(t,e,n,o){super(t,e.encoderConfig?ld(e.encoderConfig):{},o),this._deviceName="default",this._enabled=!0,Wt("info",this,"constructor",{trackId:o,deviceId:t.label,constraints:n}),this._config=e,this._constraints=n,this._deviceName=t.label,typeof e.bypassWebAudio=="boolean"&&(this._bypassWebAudio=e.bypassWebAudio),lc()&&he.bindInterruptDetectorTrack(this)}async setDevice(t){var e,n;const o=it.reportApiInvoke(null,{tag:Ut.TRACER,name:Vt.MIC_AUDIO_TRACK_SET_DEVICE,options:[this.getTrackId(),t]});if(N.info(M(e="[".concat(this.getTrackId(),"] start set device to ")).call(e,t)),st("info",this,"setDevice",t),this._enabled)try{const c=await ai.getDeviceById(t),u={};u.audio=Id({},this._constraints),u.audio.deviceId={exact:t},this._originMediaStreamTrack.stop();let d=null;try{d=await eo(u,this.getTrackId())}catch(p){throw N.error("[".concat(this.getTrackId(),"] setDevice failed"),p.toString()),st("error",this,"setDevice",t,p.toString()),d=await eo({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(d.getAudioTracks()[0],!1),p}await this._updateOriginMediaStreamTrack(d.getAudioTracks()[0],!1),this._deviceName=c.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(c){throw o.onError(c),N.error("[".concat(this.getTrackId(),"] setDevice error"),c.toString()),st("error",this,"setDevice",t,c.toString()),c}else try{const c=await ai.getDeviceById(t);this._deviceName=c.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(c){throw o.onError(c),N.error("[".concat(this.getTrackId(),"] setDevice error"),c.toString()),st("error",this,"setDevice",t,c.toString()),c}o.onSuccess(),N.info(M(n="[".concat(this.getTrackId(),"] set device to ")).call(n,t," success")),st("info",this,"setDevice",t,"success")}async setEnabled(t,e,n){if(e)return N.debug("[".concat(this.getTrackId,"] setEnabled false (do not close microphone)")),Lt("debug",this,"setEnabled false (do not close microphone)"),await super.setEnabled(t);if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(N.info("[".concat(this.getTrackId(),"] start setEnabled"),t),st("info",this,"setEnabled",t),!t){this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),n||(this._enabled=!1);try{await Kr(this,Kt.NEED_DISABLE_TRACK,this)}catch(u){throw N.error("[".concat(this.getTrackId(),"] setEnabled false failed"),u.toString()),st("error",this,"setEnabled",t,u.toString()),u}return}const o=Id({},this._constraints),c=ai.searchDeviceIdByName(this._deviceName);c&&!o.deviceId&&(o.deviceId=c);try{n||(this._enabled=!0);const u=await eo({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(u.getAudioTracks()[0],!1),await Kr(this,Kt.NEED_ENABLE_TRACK,this)}catch(u){throw n||(this._enabled=!1),N.error("[".concat(this.getTrackId(),"] setEnabled true failed"),u.toString()),st("error",this,"setEnabled",t,u.toString()),u}N.info("[".concat(this.getTrackId(),"] setEnabled success")),st("info",this,"setEnabled",t,"success")}close(){super.close(),lc()&&he.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((vi()||cs())&&this._enabled&&!this._isClosed&&he.duringInterruption){const t=async()=>{he.off(Rr.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(N.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),Lt("debug",this,"try capture microphone media device for interrupted iOS device"),await this.setEnabled(!1),await this.setEnabled(!0))};he.on(Rr.IOS_INTERRUPTION_END,t)}else N.debug("[".concat(this.getTrackId(),"] track ended")),ls("debug",["MediaStreamTrack",this.getTrackId()],"ended"),this.emit(hs.TRACK_ENDED)}async renewMediaStreamTrack(){const t=Id({},this._constraints),e=ai.searchDeviceIdByName(this._deviceName);e&&!t.deviceId&&(t.deviceId=e);const n=await eo({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(n.getAudioTracks()[0],!0)}};Sn([hr(),pe("design:type",Function),pe("design:paramtypes",[String]),pe("design:returntype",ct)],Ks.prototype,"setDevice",null),Sn([Cc("MicrophoneAudioTrack","_enabledMutex"),hr(),pe("design:type",Function),pe("design:paramtypes",[Boolean,Boolean,Boolean]),pe("design:returntype",ct)],Ks.prototype,"setEnabled",null),Ks=Sn([an("MicrophoneAudioTrack","getTrackId"),pe("design:paramtypes",[MediaStreamTrack,Object,Object,String])],Ks);let Hs=class extends lr{constructor(t,e,n,o){super(e.createOutputTrack(),n,o),Wt("info",this,"constructor",{trackId:o}),this.source=t,this._bufferSource=e,this._bufferSource.on(Zi.AUDIO_SOURCE_STATE_CHANGE,c=>{this.emit(hs.SOURCE_STATE_CHANGE,c)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(t){const e=it.reportApiInvoke(null,{tag:Ut.TRACER,name:Vt.BUFFER_AUDIO_TRACK_START,options:[this.getTrackId(),t,this.duration]});t&&this._bufferSource.updateOptions(t),this._bufferSource.startProcessAudioBuffer(),e.onSuccess()}pauseProcessAudioBuffer(){const t=it.reportApiInvoke(null,{tag:Ut.TRACER,name:Vt.BUFFER_AUDIO_TRACK_PAUSE,options:[this.getTrackId()]});this._bufferSource.pauseProcessAudioBuffer(),t.onSuccess()}seekAudioBuffer(t){const e=it.reportApiInvoke(null,{tag:Ut.TRACER,name:Vt.BUFFER_AUDIO_TRACK_SEEK,options:[this.getTrackId()]});this._bufferSource.seekAudioBuffer(t),e.onSuccess()}resumeProcessAudioBuffer(){const t=it.reportApiInvoke(null,{tag:Ut.TRACER,name:Vt.BUFFER_AUDIO_TRACK_RESUME,options:[this.getTrackId()]});this._bufferSource.resumeProcessAudioBuffer(),t.onSuccess()}stopProcessAudioBuffer(){const t=it.reportApiInvoke(null,{tag:Ut.TRACER,name:Vt.BUFFER_AUDIO_TRACK_STOP,options:[this.getTrackId()]});this._bufferSource.stopProcessAudioBuffer(),t.onSuccess()}};Sn([hr(),pe("design:type",Function),pe("design:paramtypes",[Object]),pe("design:returntype",void 0)],Hs.prototype,"startProcessAudioBuffer",null),Sn([hr(),pe("design:type",Function),pe("design:paramtypes",[]),pe("design:returntype",void 0)],Hs.prototype,"pauseProcessAudioBuffer",null),Sn([hr(),pe("design:type",Function),pe("design:paramtypes",[Number]),pe("design:returntype",void 0)],Hs.prototype,"seekAudioBuffer",null),Sn([hr(),pe("design:type",Function),pe("design:paramtypes",[]),pe("design:returntype",void 0)],Hs.prototype,"resumeProcessAudioBuffer",null),Sn([hr(),pe("design:type",Function),pe("design:paramtypes",[]),pe("design:returntype",void 0)],Hs.prototype,"stopProcessAudioBuffer",null),Hs=Sn([an("BufferSourceAudioTrack","getTrackId"),pe("design:paramtypes",[Object,E1,Object,String])],Hs);let li=class extends lr{constructor(){const t=_l().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,gr(8,"track-mix-"));try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}hasAudioTrack(t){var e;return Ft(e=this.trackList).call(e,t)!==-1}addAudioTrack(t){var e;if(Ft(e=this.trackList).call(e,t)!==-1)return N.debug("track ".concat(t.getTrackId()," is already added")),void Lt("debug",this,"track already added");N.debug("add ".concat(t.getTrackId()," to mixing track")),st("debug",this,"addAudioTrack",t.getTrackId()),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()}removeAudioTrack(t){var e;if(Ft(e=this.trackList).call(e,t)!==-1){N.debug("remove ".concat(t.getTrackId()," from mixing track")),st("debug",this,"removeAudioTrack",t.getTrackId());try{t._source.outputNode.disconnect(this.destNode)}catch{}MA(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){var t;const e={};G(t=this.trackList).call(t,n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(e.bitrate||0)&&(e.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(e.sampleRate||0)&&(e.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(e.sampleSize||0)&&(e.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(e.stereo=!0))}),this._encoderConfig=e}};li=Sn([an("MixingAudioTrack","getTrackId"),pe("design:paramtypes",[])],li);class H2 extends Gr{constructor(){super(...arguments),this.resultStorage=new tr}setLocalAudioStats(e,n,o){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(o,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(o,n))}setLocalVideoStats(e,n,o){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(o,n)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(o,n)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(o))}setRemoteAudioStats(e,n){const o=e.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",o,this.checkAudioOutputLevel(n))}setRemoteVideoStats(e,n){const o=e.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",o,this.checkVideoDecode(n))}record(e,n,o){this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});const c=this.resultStorage.get(e);if(c&&(c.result.push(o),c.result.length>=5)){var u;const d=Xt(u=c.result).call(u,!0);c.isPrevNormal&&!d&&this.emit("exception",_1[e],e,n),!c.isPrevNormal&&d&&this.emit("exception",_1[e]+2e3,e+"_RECOVER",n),c.isPrevNormal=d,c.result=[]}}checkAudioOutputLevel(e){return!(e.receiveBitrate>0&&e.receiveLevel===0)}checkAudioInputLevel(e,n){return n instanceof li&&!n.isActive||!!n.muted||e.sendVolumeLevel!==0}checkFramerateInput(e,n){let o=null;n._encoderConfig&&n._encoderConfig.frameRate&&(o=Ws(n._encoderConfig.frameRate));const c=e.captureFrameRate;return!o||!c||!(o>10&&c<5||o<10&&o>=5&&c<=1)}checkFramerateSent(e){return!(e.captureFrameRate&&e.sendFrameRate&&e.captureFrameRate>5&&e.sendFrameRate<=1)}checkSendVideoBitrate(e,n){return!!n.muted||e.sendBitrate!==0}checkSendAudioBitrate(e,n){return n instanceof li&&!n.isActive||!!n.muted||e.sendBitrate!==0}checkVideoDecode(e){return e.receiveBitrate===0||e.decodeFrameRate!==0}}const _1={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Vi=new class{markSubscribeStart(t,e){var n;performance.mark(M(n="agora-web-sdk/".concat(t,"/subscribe-")).call(n,e))}markPublishStart(t,e){var n;performance.mark(M(n="agora-web-sdk/".concat(t,"/publish-")).call(n,e))}measureFromSubscribeStart(t,e){var n;const o=performance.getEntriesByName(M(n="agora-web-sdk/".concat(t,"/subscribe-")).call(n,e));if(o.length>0){const c=o[o.length-1];return performance.now()-c.startTime}return 0}measureFromPublishStart(t,e){var n;const o=performance.getEntriesByName(M(n="agora-web-sdk/".concat(t,"/publish-")).call(n,e));if(o.length>0){const c=o[o.length-1];return Math.round(performance.now()-c.startTime)}return 0}};function y1(t,e){var n=ue(t);if(_e){var o=_e(t);e&&(o=Ot(o).call(o,function(c){return zt(t,c).enumerable})),n.push.apply(n,o)}return n}function Ia(t){for(var e=1;e<arguments.length;e++){var n,o=arguments[e]!=null?arguments[e]:{};if(e%2)G(n=y1(Object(o),!0)).call(n,function(u){qr(t,u,o[u])});else if(Ce)dr(t,Ce(o));else{var c;G(c=y1(Object(o))).call(c,function(u){te(t,u,zt(o,u))})}}return t}class Ca{constructor(e){this.localStats=new tr,this.remoteStats=new tr,this.trafficStatsPeerList=[],this.updateStats=()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))},this.store=e,this.updateStatsInterval=window.setInterval(this.updateStats,1e3),this.exceptionMonitor=new H2,this.exceptionMonitor.on("exception",(n,o,c)=>{this.onStatsException&&this.onStatsException(n,o,c)})}reset(){this.localStats=new tr,this.remoteStats=new tr,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(bt.LocalAudioTrack)||Ia({},lA)}getLocalVideoTrackStats(){return this.localStats.get(bt.LocalVideoTrack)||Ia({},uA)}getRemoteAudioTrackStats(e){const n=(p,f)=>{var g;if(!this.trafficStats)return f;const E=yt(g=this.trafficStats.peer_delay).call(g,I=>I.peer_uid===p);return E&&(f.publishDuration=E.B_ppad+(kt()-this.trafficStats.timestamp)),f},o={};if(e){var c;const p=(c=this.remoteStats.get(e))===null||c===void 0?void 0:c.audioStats;p&&(o[e]=n(e,p))}else{var u,d;G(u=Ue(Tr(d=this.remoteStats).call(d))).call(u,([p,{audioStats:f}])=>{f&&(o[p]=n(p,f))})}return o}getRemoteNetworkQualityStats(e){const n={};if(e){var o;const d=(o=this.remoteStats.get(e))===null||o===void 0?void 0:o.networkStats;d&&(n[e]=d)}else{var c,u;G(c=Ue(Tr(u=this.remoteStats).call(u))).call(c,([d,{networkStats:p}])=>{p&&(n[d]=p)})}return n}getRemoteVideoTrackStats(e){const n=(p,f)=>{var g;if(!this.trafficStats)return f;const E=yt(g=this.trafficStats.peer_delay).call(g,I=>I.peer_uid===p);return E&&(f.publishDuration=E.B_ppvd+(kt()-this.trafficStats.timestamp)),f},o={};if(e){var c;const p=(c=this.remoteStats.get(e))===null||c===void 0?void 0:c.videoStats;p&&(o[e]=n(e,p))}else{var u,d;G(u=Ue(Tr(d=this.remoteStats).call(d))).call(u,([p,{videoStats:f}])=>{f&&(o[p]=n(p,f))})}return o}getRTCStats(){var e;let n=0,o=0,c=0,u=0;const d=this.localStats.get(bt.LocalAudioTrack);d&&(n+=d.sendBytes,o+=d.sendBitrate);const p=this.localStats.get(bt.LocalVideoTrack);p&&(n+=p.sendBytes,o+=p.sendBitrate);const f=this.localStats.get(bt.LocalVideoLowTrack);f&&(n+=f.sendBytes,o+=f.sendBitrate),G(e=this.remoteStats).call(e,({audioStats:E,videoStats:I})=>{E&&(c+=E.receiveBytes,u+=E.receiveBitrate),I&&(c+=I.receiveBytes,u+=I.receiveBitrate)});let g=1;return this.trafficStats&&(g+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:g,SendBitrate:o,SendBytes:n,RecvBytes:c,RecvBitrate:u,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(e){this.localStats.set(e,void 0)}removeLocalStats(e){e?this.localStats.delete(e):this.localStats.clear()}addRemoteStats(e){this.remoteStats.set(e,{})}removeRemoteStats(e){e?this.remoteStats.delete(e):this.remoteStats.clear()}addP2PChannel(e){this.p2pChannel=e}updateTrafficStats(e){var n,o;e.peer_delay=Ot(n=e.peer_delay).call(n,u=>u.B_ppad!==void 0||u.B_ppvd!==void 0);const c=Ot(o=e.peer_delay).call(o,u=>{var d;return Ft(d=this.trafficStatsPeerList).call(d,u.peer_uid)===-1});G(c).call(c,u=>{var d;const p=(d=this.p2pChannel)===null||d===void 0?void 0:d.getRemoteMedia(u.peer_uid),f=p!=null&&p.videoSSRC?Vi.measureFromSubscribeStart(this.store.clientId,p.videoSSRC):0,g=p!=null&&p.audioSSRC?Vi.measureFromSubscribeStart(this.store.clientId,p.audioSSRC):0;u.B_ppad!==void 0&&u.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(u.peer_uid,u.B_ppad,u.B_ppvd,f>g?f:g),this.trafficStatsPeerList.push(u.peer_uid))}),this.trafficStats=e}updateUplinkStats(e){var n;this.uplinkStats&&this.uplinkStats.B_fir!==e.B_fir&&N.debug(M(n="[".concat(this.store.clientId,"]: Period fir changes to ")).call(n,e.B_fir)),this.uplinkStats=e}static isRemoteVideoFreeze(e,n,o){if(!e)return!1;const c=!!o&&n.framesDecodeFreezeTime>o.framesDecodeFreezeTime,u=!o||n.framesDecodeCount>o.framesDecodeCount;return c||!u}static isRemoteAudioFreeze(e){return!!e&&e._isFreeze()}isLocalVideoFreeze(e){return!(!e.inputFrame||!e.sentFrame)&&e.inputFrame.frameRate>5&&e.sentFrame.frameRate<3}updateLocalStats(e){var n,o;G(n=Ue(Tr(o=this.localStats).call(o))).call(n,([c,u])=>{switch(c){case bt.LocalVideoTrack:case bt.LocalVideoLowTrack:{const f=u,g=Ia({},uA),E=e.getStats(),I=e.getLocalMedia(c);if(E){var d;const _=yt(d=E.videoSend).call(d,T=>T.ssrc===(I==null?void 0:I.ssrcs[0].ssrcId));if(_){const T=e.getLocalVideoSize(),R=e.getEncoderConfig(bt.LocalVideoTrack);_.codec!=="H264"&&_.codec!=="VP8"&&_.codec!=="VP9"&&_.codec!=="AV1X"&&_.codec!=="AV1"||(g.codecType=_.codec),g.sendBytes=_.bytes,g.sendBitrate=f?8*Math.max(0,g.sendBytes-f.sendBytes):0,_.inputFrame?(g.captureFrameRate=_.inputFrame.frameRate,g.captureResolutionHeight=_.inputFrame.height,g.captureResolutionWidth=_.inputFrame.width):T&&(g.captureResolutionWidth=T.width,g.captureResolutionHeight=T.height),_.sentFrame?(g.sendFrameRate=_.sentFrame.frameRate,g.sendResolutionHeight=_.sentFrame.height,g.sendResolutionWidth=_.sentFrame.width):T&&(g.sendResolutionWidth=T.width,g.sendResolutionHeight=T.height),_.avgEncodeMs&&(g.encodeDelay=_.avgEncodeMs),R&&R.bitrateMax&&(g.targetSendBitrate=1e3*R.bitrateMax),g.sendPackets=_.packets,g.sendPacketsLost=_.packetsLost,g.totalDuration=f?f.totalDuration+1:1,g.totalFreezeTime=f?f.totalFreezeTime:0,this.isLocalVideoFreeze(_)&&(g.totalFreezeTime+=1)}this.trafficStats&&(g.sendPacketsLost=this.trafficStats.B_pvlr4/100)}this.localStats.set(c,g),g&&I&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,I.track,g);break}case bt.LocalAudioTrack:{const f=u,g=Ia({},lA),E=e.getStats(),I=e.getLocalMedia(c);if(E){var p;const _=yt(p=E.audioSend).call(p,T=>T.ssrc===(I==null?void 0:I.ssrcs[0].ssrcId));if(_){if(_.codec!=="opus"&&_.codec!=="aac"&&_.codec!=="PCMU"&&_.codec!=="PCMA"&&_.codec!=="G722"||(g.codecType=_.codec),_.inputLevel)g.sendVolumeLevel=Math.round(32767*_.inputLevel);else{const T=e.getLocalAudioVolume();T&&(g.sendVolumeLevel=Math.round(32767*T))}g.sendBytes=_.bytes,g.sendPackets=_.packets,g.sendPacketsLost=_.packetsLost,g.sendBitrate=f?8*Math.max(0,g.sendBytes-f.sendBytes):0}}this.trafficStats&&(g.sendPacketsLost=this.trafficStats.B_pvlr4/100),this.localStats.set(bt.LocalAudioTrack,g),g&&I&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,I.track,g);break}}})}updateRemoteStats(e){var n,o;G(n=Ue(Tr(o=this.remoteStats).call(o))).call(n,([c,{videoStats:u,audioStats:d,videoPcStats:p}])=>{var f,g,E;const I=d,_=u,T=p,R=Ia({},xI),w=Ia({},UI),k=Ia({},f2),{audioTrack:L,videoTrack:Y,audioSSRC:Z,videoSSRC:rt}=e.getRemoteMedia(c),ut=e.getStats(),At=ut==null?void 0:yt(f=ut.audioRecv).call(f,Gt=>Gt.ssrc===Z),Ct=ut==null?void 0:yt(g=ut.videoRecv).call(g,Gt=>Gt.ssrc===rt),lt=this.trafficStats&&yt(E=this.trafficStats.peer_delay).call(E,Gt=>Gt.peer_uid===c);if(At&&(At.codec!=="opus"&&At.codec!=="aac"&&At.codec!=="PCMU"&&At.codec!=="PCMA"&&At.codec!=="G722"||(R.codecType=At.codec),At.outputLevel?R.receiveLevel=Math.round(32767*At.outputLevel):L&&(R.receiveLevel=Math.round(32767*L.getVolumeLevel())),R.receiveBytes=At.bytes,R.receivePackets=At.packets,R.receivePacketsLost=At.packetsLost,R.packetLossRate=R.receivePacketsLost/(R.receivePackets+R.receivePacketsLost),R.receiveBitrate=I?8*Math.max(0,R.receiveBytes-I.receiveBytes):0,R.totalDuration=I?I.totalDuration+1:1,R.totalFreezeTime=I?I.totalFreezeTime:0,R.freezeRate=R.totalFreezeTime/R.totalDuration,R.receiveDelay=At.jitterBufferMs,R.totalDuration>10&&Ca.isRemoteAudioFreeze(L)&&(R.totalFreezeTime+=1)),Ct){Ct.codec!=="H264"&&Ct.codec!=="VP8"&&Ct.codec!=="VP9"&&Ct.codec!=="AV1X"&&Ct.codec!=="AV1"||(w.codecType=Ct.codec),w.receiveBytes=Ct.bytes,w.receiveBitrate=_?8*Math.max(0,w.receiveBytes-_.receiveBytes):0,w.decodeFrameRate=Ct.decodeFrameRate<0?0:Ct.decodeFrameRate,w.renderFrameRate=Ct.decodeFrameRate<0?0:Ct.decodeFrameRate,Ct.outputFrame&&(w.renderFrameRate=Ct.outputFrame.frameRate),Ct.receivedFrame?(w.receiveFrameRate=Ct.receivedFrame.frameRate,w.receiveResolutionHeight=Ct.receivedFrame.height,w.receiveResolutionWidth=Ct.receivedFrame.width):Y&&(w.receiveResolutionHeight=Y._videoHeight||0,w.receiveResolutionWidth=Y._videoWidth||0),Ct.framesRateFirefox!==void 0&&(w.receiveFrameRate=Math.round(Ct.framesRateFirefox)),w.receivePackets=Ct.packets,w.receivePacketsLost=Ct.packetsLost,w.packetLossRate=w.receivePacketsLost/(w.receivePackets+w.receivePacketsLost),w.totalDuration=_?_.totalDuration+1:1,w.totalFreezeTime=_?_.totalFreezeTime:0,w.receiveDelay=Ct.jitterBufferMs||0;const Gt=!!rt&&e.getRemoteVideoIsReady(rt);Y&&Gt&&Ca.isRemoteVideoFreeze(Y,Ct,T)&&(w.totalFreezeTime+=1),w.freezeRate=w.totalFreezeTime/w.totalDuration}lt&&(R.end2EndDelay=lt.B_ad,w.end2EndDelay=lt.B_vd,R.transportDelay=lt.B_ed,w.transportDelay=lt.B_ed,R.currentPacketLossRate=lt.B_ealr4/100,w.currentPacketLossRate=lt.B_evlr4/100,k.uplinkNetworkQuality=lt.B_punq?lt.B_punq:0,k.downlinkNetworkQuality=lt.B_pdnq?lt.B_pdnq:0),this.remoteStats.set(c,{audioStats:R,videoStats:w,videoPcStats:Ct,networkStats:k}),L&&this.exceptionMonitor.setRemoteAudioStats(L,R),Y&&this.exceptionMonitor.setRemoteVideoStats(Y,w)})}}var W2="".repeat||function(t){var e=String($(this)),n="",o=ki(t);if(o<0||o==1/0)throw RangeError("Wrong number of repetitions");for(;o>0;(o>>>=1)&&(e+=e))1&o&&(n+=e);return n},Y2=Math.ceil,S1=function(t){return function(e,n,o){var c,u,d=String($(e)),p=d.length,f=o===void 0?" ":String(o),g=Xr(n);return g<=p||f==""?d:(c=g-p,(u=W2.call(f,Y2(c/f.length))).length>c&&(u=u.slice(0,c)),t?d+u:u+d)}},q2={start:S1(!1),end:S1(!0)},J2=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(za),z2=q2.start;jt({target:"String",proto:!0,forced:J2},{padStart:function(t){return z2(this,t,arguments.length>1?arguments[1]:void 0)}});var X2=vr("String").padStart,T1=String.prototype,Z2=function(t){var e=t.padStart;return typeof t=="string"||t===T1||t instanceof String&&e===T1.padStart?X2:e};function R1(t){return new TextEncoder().encode(t)}const $2=async t=>function(e,n){let o="";const c=new Uint8Array(e);return G(c).call(c,u=>{var d;o+=Z2(d=u.toString(n)).call(d,2,"0")}),o}(await crypto.subtle.digest("SHA-256",R1(t)),16);function w1(t,e){var n=ue(t);if(_e){var o=_e(t);e&&(o=Ot(o).call(o,function(c){return zt(t,c).enumerable})),n.push.apply(n,o)}return n}function b1(t){for(var e=1;e<arguments.length;e++){var n,o=arguments[e]!=null?arguments[e]:{};if(e%2)G(n=w1(Object(o),!0)).call(n,function(u){qr(t,u,o[u])});else if(Ce)dr(t,Ce(o));else{var c;G(c=w1(Object(o))).call(c,function(u){te(t,u,zt(o,u))})}}return t}function tb(t){if(!t.address||!t.tcp)throw new Q(U.UNEXPECTED_RESPONSE,"Invalid address format ".concat(t));return t.address.match(/^[\.\:\d]+$/)?"".concat(t.address.replace(/[^\d]/g,"-"),".edge.agora.io"):(N.info("Cannot recognized as IP address ".concat(t.address,". Used As Host instead")),M(e="".concat(t.address,":")).call(e,t.tcp));var e}function BA(t){var e;return t.match(/^[\.\:\d]+$/)?M(e="".concat(t.replace(/[^\d]/g,"-"),".")).call(e,ot("TURN_DOMAIN")):(N.info("Cannot recognized as IP address ".concat(t,". Used As Host instead")),t)}function N1(t,e){var n;const o=ot("GATEWAY_DOMAINS");let c=o[1]&&Ft(e).call(e,o[1])!==-1?1:0;return t.addresses=t.addresses||[],{gatewayAddrs:ht(n=t.addresses).call(n,u=>{var d,p,f,g,E;return u.domain_prefix?{address:M(d=M(p="".concat(u.domain_prefix,".")).call(p,o[c++%o.length],":")).call(d,u.port)}:u.ip.match(/^[\.\:\d]+$/)?{ip:u.ip,port:u.port,address:M(f=M(g="".concat(u.ip.replace(/[^\d]/g,"-"),".")).call(g,o[c++%o.length],":")).call(f,u.port)}:(N.info("Cannot recognized as IP address ".concat(u.ip,". Used As Host instead")),{ip:u.ip,port:u.port,address:M(E="".concat(u.ip,":")).call(E,u.port)})}),uid:t.uid,cid:t.cid,vid:t.detail&&t.detail[8],uni_lbs_ip:t.detail&&t.detail[1],res:t,csIp:t.detail&&t.detail[502]}}function Ws(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function O1(t){var e;const n=t._encoderConfig;if(!n)return{};const o={resolution:n.width&&n.height?M(e="".concat(Ws(n.width),"x")).call(e,Ws(n.height)):void 0,maxVideoBW:n.bitrateMax,minVideoBW:n.bitrateMin};return typeof n.frameRate=="number"?(o.maxFrameRate=n.frameRate,o.minFrameRate=n.frameRate):n.frameRate&&(o.maxFrameRate=n.frameRate.max||n.frameRate.ideal||n.frameRate.exact||n.frameRate.min,o.minFrameRate=n.frameRate.min||n.frameRate.ideal||n.frameRate.exact||n.frameRate.max),o}function k1(t,e,n){var o,c,u;const d=yt(o=e.videoSend).call(o,g=>g.ssrc===t);if(!d)return null;const p=n==null||(c=yt(u=n.videoSend).call(u,g=>g.ssrc===t))===null||c===void 0?void 0:c.inputFrame,f={id:gr(10,""),timestamp:new Date(e.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:d.ssrc.toString()};return d.inputFrame&&(p&&d.inputFrame.height===p.height||(f.A_fhi=d.inputFrame.height?d.inputFrame.height.toString():"0"),p&&d.inputFrame.width===p.width||(f.A_fwi=d.inputFrame.width?d.inputFrame.width.toString():"0"),p&&d.inputFrame.frameRate===p.frameRate||(f.A_fri=d.inputFrame.frameRate?d.inputFrame.frameRate.toString():"0")),f}function D1(t){return t>=0&&t<.17?1:t>=.17&&t<.36?2:t>=.36&&t<.59?3:t>=.59&&t<=1?4:t>1?5:0}function LA(t,e){var n;let o,c,u;switch(e){case Sr.CHOOSE_SERVER:o=4096,c="choose server";break;case Sr.CLOUD_PROXY:o=1048576,c="proxy";break;case Sr.CLOUD_PROXY_5:o=4194304,c="proxy5";break;case Sr.CLOUD_PROXY_FALLBACK:o=4194310,c="proxy fallback";break;default:throw new Q(U.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:t.detail&&t.detail[502],retry:!1})}if(G(n=t.response_body).call(n,d=>{var p;d.buffer&&d.buffer.flag===o&&(u={code:d.buffer.code,addresses:ht(p=d.buffer.edges_services).call(p,f=>b1({},f,{ticket:d.buffer.cert})),server_ts:t.enter_ts,uid:d.buffer.uid,cid:d.buffer.cid,cname:d.buffer.cname,detail:b1({},d.buffer.detail,{},t.detail),flag:d.buffer.flag,opid:t.opid})}),!u)throw new Q(U.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:t.detail&&t.detail[502]});return u}async function eb(t,e){var n;return await ct.all(ht(n=t.addresses).call(n,async o=>({address:BA(o.ip),tcpport:o.port,udpport:o.port,username:e&&ot("ENCRYPT_PROXY_USERNAME_AND_PSW")?e.toString():Pr.username,password:e&&ot("ENCRYPT_PROXY_USERNAME_AND_PSW")?await $2(e.toString()):Pr.password})))}function rb(t,e){const n=e._videoHeight||e.getMediaStreamTrack(!0).getSettings().height;return n?n/Ws(t.height):4}var B1;function L1(t,e){var n=ue(t);if(_e){var o=_e(t);e&&(o=Ot(o).call(o,function(c){return zt(t,c).enumerable})),n.push.apply(n,o)}return n}function Cd(t){for(var e=1;e<arguments.length;e++){var n,o=arguments[e]!=null?arguments[e]:{};if(e%2)G(n=L1(Object(o),!0)).call(n,function(u){qr(t,u,o[u])});else if(Ce)dr(t,Ce(o));else{var c;G(c=L1(Object(o))).call(c,function(u){te(t,u,zt(o,u))})}}return t}function yc(t){return window.TextEncoder?new TextEncoder().encode(t).length:t.length}function pn(t){return new ct(e=>{window.setTimeout(e,t)})}function nb(t){const e=new Q(U.TIMEOUT,"timeout");return new ct((n,o)=>{window.setTimeout(()=>o(e),t)})}function gr(t=7,e){var n,o;const c=Math.random().toString(16).substr(2,t).toLowerCase();return c.length===t?M(n="".concat(e)).call(n,c):M(o="".concat(e)).call(o,c)+gr(t-c.length,"")}function M1(){return gr(32,"").toUpperCase()}const _d=()=>{};function P1(t){return new ct((e,n)=>{let o=!1;const c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);const u=vi()?"canplay":"playing";c.addEventListener(u,()=>{const d=c.videoWidth,p=c.videoHeight;!d&&si()||(o=!0,c.srcObject=null,c.remove(),e([d,p]))}),c.srcObject=new MediaStream([t]),c.play().catch(_d),Vr(()=>{o||(c.srcObject=null,c.remove(),e([c.videoWidth,c.videoHeight]))},4e3)})}function _a(t){return ct.all(ht(t).call(t,e=>e.then(n=>{throw n},n=>n))).then(e=>{throw e},e=>e)}function ro(t,e,...n){return t.getListeners(e).length===0?ct.reject(new Q(U.UNEXPECTED_ERROR,"can not emit promise")):new ct((o,c)=>{t.emit(e,...n,o,c)})}function Kr(t,e,...n){return t.getListeners(e).length===0?ct.resolve():ro(t,e,...n)}function ya(t,e,...n){return t.getListeners(e).length===0?null:yd(t,e,...n)}function yd(t,e,...n){let o=null,c=null;if(t.emit(e,...n,u=>{o=u},u=>{c=u}),c!==null)throw c;if(o===null)throw new Q(U.UNEXPECTED_ERROR,"handler is not sync");return o}function MA(t,e){const n=Ft(t).call(t,e);n!==-1&&Ze(t).call(t,n,1)}function x1(t){const e=[];return G(t).call(t,n=>{Ft(e).call(e,n)===-1&&e.push(n)}),e}function Gi(t){ct.resolve().then(t)}function en(t){return JSON.parse(at(t))}const U1={};function Sl(t,e){U1[e]||(U1[e]=!0,t())}function PA(t){const e=window.atob(t),n=new Uint8Array(new ArrayBuffer(e.length));for(let o=0;o<e.length;o+=1)n[o]=e.charCodeAt(o);return n}function Sd(t){let e="";for(let n=0;n<t.length;n+=1)e+=String.fromCharCode(t[n]);return window.btoa(e)}const Q1=new class{constructor(){this.fnMap=new tr}throttleByKey(t,e,n,o,...c){if(this.fnMap.has(e)){const u=this.fnMap.get(e);if(u.threshold!==n){u.fn(...u.args),clearTimeout(u.timer);const d=window.setTimeout(()=>{const p=this.fnMap.get(e);p&&p.fn(...p.args),this.fnMap.delete(e)},n);this.fnMap.set(e,{fn:t,threshold:n,timer:d,args:c,skipFn:o})}else u.skipFn&&u.skipFn(...u.args),this.fnMap.set(e,Cd({},u,{fn:t,args:c,skipFn:o}))}else{const u=window.setTimeout(()=>{const d=this.fnMap.get(e);d&&d.fn(...d.args),this.fnMap.delete(e)},n);this.fnMap.set(e,{fn:t,threshold:n,timer:u,args:c,skipFn:o})}}},F1=vn(B1=Q1.throttleByKey).call(B1,Q1),Sa=async({fragementLength:t,referenceList:e,asyncMapHandler:n,allFailedhandler:o,promisesCollector:c})=>{let u=0;const d=t;let p,f=0;const g=async()=>{const E=(()=>{const I=u*d,_=I+d,T=Mr(e).call(e,I,_);return ht(T).call(T,n)})();c&&c.push(...E);try{p=await _a(E)}catch(I){if(f+=d,u++,!(f>=e.length))return void await g();o(I)}G(E).call(E,I=>I.cancel())};return await g(),p};function V1(t){return typeof t=="object"&&t!==null&&!(t instanceof RegExp)}var ib=vr("Array").values,G1=Array.prototype,ob={DOMTokenList:!0,NodeList:!0},Tl=function(t){var e=t.values;return t===G1||t instanceof Array&&e===G1.values||ob.hasOwnProperty(da(t))?ib:e},sb=Br("iterator"),xA=!A(function(){var t=new URL("b?a=1&b=2&c=3","http://a"),e=t.searchParams,n="";return t.pathname="c%20d",e.forEach(function(o,c){e.delete("b"),n+=c+o}),!t.toJSON||!e.sort||t.href!=="http://a/c%20d?a=1&c=3"||e.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!e[sb]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://\u0442\u0435\u0441\u0442").host!=="xn--e1aybc"||new URL("http://a#\u0431").hash!=="#%D0%B1"||n!=="a1c3"||new URL("http://x",void 0).host!=="x"}),UA=2147483647,ab=/[^\0-\u007E]/,cb=/[.\u3002\uFF0E\uFF61]/g,j1="Overflow: input needs wider integers to process",Sc=Math.floor,QA=String.fromCharCode,K1=function(t){return t+22+75*(t<26)},lb=function(t,e,n){var o=0;for(t=n?Sc(t/700):t>>1,t+=Sc(t/e);t>455;o+=36)t=Sc(t/35);return Sc(o+36*t/(t+38))},ub=function(t){var e,n,o=[],c=(t=function(L){for(var Y=[],Z=0,rt=L.length;Z<rt;){var ut=L.charCodeAt(Z++);if(ut>=55296&&ut<=56319&&Z<rt){var At=L.charCodeAt(Z++);(64512&At)==56320?Y.push(((1023&ut)<<10)+(1023&At)+65536):(Y.push(ut),Z--)}else Y.push(ut)}return Y}(t)).length,u=128,d=0,p=72;for(e=0;e<t.length;e++)(n=t[e])<128&&o.push(QA(n));var f=o.length,g=f;for(f&&o.push("-");g<c;){var E=UA;for(e=0;e<t.length;e++)(n=t[e])>=u&&n<E&&(E=n);var I=g+1;if(E-u>Sc((UA-d)/I))throw RangeError(j1);for(d+=(E-u)*I,u=E,e=0;e<t.length;e++){if((n=t[e])<u&&++d>UA)throw RangeError(j1);if(n==u){for(var _=d,T=36;;T+=36){var R=T<=p?1:T>=p+26?26:T-p;if(_<R)break;var w=_-R,k=36-R;o.push(QA(K1(R+w%k))),_=Sc(w/k)}o.push(QA(K1(_))),p=lb(d,I,g==f),d=0,++g}}++d,++u}return o.join("")},H1=function(t){var e=sl(t);if(typeof e!="function")throw TypeError(String(t)+" is not iterable");return ar(e.call(t))},W1=En("fetch"),FA=En("Headers"),db=Br("iterator"),Rl="URLSearchParams",Y1="URLSearchParamsIterator",q1=Lr.set,Ro=Lr.getterFor(Rl),hb=Lr.getterFor(Y1),pb=/\+/g,J1=Array(4),Ab=function(t){return J1[t-1]||(J1[t-1]=RegExp("((?:%[\\da-f]{2}){"+t+"})","gi"))},fb=function(t){try{return decodeURIComponent(t)}catch{return t}},z1=function(t){var e=t.replace(pb," "),n=4;try{return decodeURIComponent(e)}catch{for(;n;)e=e.replace(Ab(n--),fb);return e}},gb=/[!'()~]|%20/g,mb={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},Eb=function(t){return mb[t]},X1=function(t){return encodeURIComponent(t).replace(gb,Eb)},Z1=function(t,e){if(e)for(var n,o,c=e.split("&"),u=0;u<c.length;)(n=c[u++]).length&&(o=n.split("="),t.push({key:z1(o.shift()),value:z1(o.join("="))}))},vb=function(t){this.entries.length=0,Z1(this.entries,t)},Tc=function(t,e){if(t<e)throw TypeError("Not enough arguments")},VA=zm(function(t,e){q1(this,{type:Y1,iterator:H1(Ro(t).entries),kind:e})},"Iterator",function(){var t=hb(this),e=t.kind,n=t.iterator.next(),o=n.value;return n.done||(n.value=e==="keys"?o.key:e==="values"?o.value:[o.key,o.value]),n}),wl=function(){$a(this,wl,Rl);var t,e,n,o,c,u,d,p,f,g=arguments.length>0?arguments[0]:void 0,E=this,I=[];if(q1(E,{type:Rl,entries:I,updateURL:function(){},updateSearchParams:vb}),g!==void 0)if(K(g))if(typeof(t=sl(g))=="function")for(n=(e=t.call(g)).next;!(o=n.call(e)).done;){if((d=(u=(c=H1(ar(o.value))).next).call(c)).done||(p=u.call(c)).done||!u.call(c).done)throw TypeError("Expected sequence with length 2");I.push({key:d.value+"",value:p.value+""})}else for(f in g)ft(g,f)&&I.push({key:f,value:g[f]+""});else Z1(I,typeof g=="string"?g.charAt(0)==="?"?g.slice(1):g:g+"")},Td=wl.prototype;Aa(Td,{append:function(t,e){Tc(arguments.length,2);var n=Ro(this);n.entries.push({key:t+"",value:e+""}),n.updateURL()},delete:function(t){Tc(arguments.length,1);for(var e=Ro(this),n=e.entries,o=t+"",c=0;c<n.length;)n[c].key===o?n.splice(c,1):c++;e.updateURL()},get:function(t){Tc(arguments.length,1);for(var e=Ro(this).entries,n=t+"",o=0;o<e.length;o++)if(e[o].key===n)return e[o].value;return null},getAll:function(t){Tc(arguments.length,1);for(var e=Ro(this).entries,n=t+"",o=[],c=0;c<e.length;c++)e[c].key===n&&o.push(e[c].value);return o},has:function(t){Tc(arguments.length,1);for(var e=Ro(this).entries,n=t+"",o=0;o<e.length;)if(e[o++].key===n)return!0;return!1},set:function(t,e){Tc(arguments.length,1);for(var n,o=Ro(this),c=o.entries,u=!1,d=t+"",p=e+"",f=0;f<c.length;f++)(n=c[f]).key===d&&(u?c.splice(f--,1):(u=!0,n.value=p));u||c.push({key:d,value:p}),o.updateURL()},sort:function(){var t,e,n,o=Ro(this),c=o.entries,u=c.slice();for(c.length=0,n=0;n<u.length;n++){for(t=u[n],e=0;e<n;e++)if(c[e].key>t.key){c.splice(e,0,t);break}e===n&&c.push(t)}o.updateURL()},forEach:function(t){for(var e,n=Ro(this).entries,o=Kn(t,arguments.length>1?arguments[1]:void 0,3),c=0;c<n.length;)o((e=n[c++]).value,e.key,this)},keys:function(){return new VA(this,"keys")},values:function(){return new VA(this,"values")},entries:function(){return new VA(this,"entries")}},{enumerable:!0}),ss(Td,db,Td.entries),ss(Td,"toString",function(){for(var t,e=Ro(this).entries,n=[],o=0;o<e.length;)t=e[o++],n.push(X1(t.key)+"="+X1(t.value));return n.join("&")},{enumerable:!0}),is(wl,Rl),jt({global:!0,forced:!xA},{URLSearchParams:wl}),xA||typeof W1!="function"||typeof FA!="function"||jt({global:!0,enumerable:!0,forced:!0},{fetch:function(t){var e,n,o,c=[t];return arguments.length>1&&(K(e=arguments[1])&&(n=e.body,da(n)===Rl&&((o=e.headers?new FA(e.headers):new FA).has("content-type")||o.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),e=ns(e,{body:b(0,String(n)),headers:b(0,o)}))),c.push(e)),W1.apply(this,c)}});var no,$1={URLSearchParams:wl,getState:Ro},Ib=gE.codeAt,bl=h.URL,Cb=$1.URLSearchParams,GA=$1.getState,_b=Lr.set,Ur=Lr.getterFor("URL"),yb=Math.floor,tC=Math.pow,jA="Invalid scheme",Ta="Invalid host",eC="Invalid port",rC=/[A-Za-z]/,Sb=/[\d+\-.A-Za-z]/,KA=/\d/,Tb=/^(0x|0X)/,Rb=/^[0-7]+$/,wb=/^\d+$/,nC=/^[\dA-Fa-f]+$/,bb=/[\u0000\u0009\u000A\u000D #%/:?@[\\]]/,Nb=/[\u0000\u0009\u000A\u000D #/:?@[\\]]/,Ob=/^[\u0000-\u001F ]+|[\u0000-\u001F ]+$/g,kb=/[\u0009\u000A\u000D]/g,HA=function(t,e){var n,o,c;if(e.charAt(0)=="["){if(e.charAt(e.length-1)!="]"||!(n=Bb(e.slice(1,-1))))return Ta;t.host=n}else if(Tn(t)){if(e=function(u){var d,p,f=[],g=u.toLowerCase().replace(cb,".").split(".");for(d=0;d<g.length;d++)p=g[d],f.push(ab.test(p)?"xn--"+ub(p):p);return f.join(".")}(e),bb.test(e)||(n=Db(e))===null)return Ta;t.host=n}else{if(Nb.test(e))return Ta;for(n="",o=Ea(e),c=0;c<o.length;c++)n+=Ys(o[c],Rd);t.host=n}},Db=function(t){var e,n,o,c,u,d,p,f=t.split(".");if(f.length&&f[f.length-1]==""&&f.pop(),(e=f.length)>4)return t;for(n=[],o=0;o<e;o++){if((c=f[o])=="")return t;if(u=10,c.length>1&&c.charAt(0)=="0"&&(u=Tb.test(c)?16:8,c=c.slice(u==8?1:2)),c==="")d=0;else{if(!(u==10?wb:u==8?Rb:nC).test(c))return t;d=parseInt(c,u)}n.push(d)}for(o=0;o<e;o++)if(d=n[o],o==e-1){if(d>=tC(256,5-e))return null}else if(d>255)return null;for(p=n.pop(),o=0;o<n.length;o++)p+=n[o]*tC(256,3-o);return p},Bb=function(t){var e,n,o,c,u,d,p,f=[0,0,0,0,0,0,0,0],g=0,E=null,I=0,_=function(){return t.charAt(I)};if(_()==":"){if(t.charAt(1)!=":")return;I+=2,E=++g}for(;_();){if(g==8)return;if(_()!=":"){for(e=n=0;n<4&&nC.test(_());)e=16*e+parseInt(_(),16),I++,n++;if(_()=="."){if(n==0||(I-=n,g>6))return;for(o=0;_();){if(c=null,o>0){if(!(_()=="."&&o<4))return;I++}if(!KA.test(_()))return;for(;KA.test(_());){if(u=parseInt(_(),10),c===null)c=u;else{if(c==0)return;c=10*c+u}if(c>255)return;I++}f[g]=256*f[g]+c,++o!=2&&o!=4||g++}if(o!=4)return;break}if(_()==":"){if(I++,!_())return}else if(_())return;f[g++]=e}else{if(E!==null)return;I++,E=++g}}if(E!==null)for(d=g-E,g=7;g!=0&&d>0;)p=f[g],f[g--]=f[E+d-1],f[E+--d]=p;else if(g!=8)return;return f},Nl=function(t){var e,n,o,c;if(typeof t=="number"){for(e=[],n=0;n<4;n++)e.unshift(t%256),t=yb(t/256);return e.join(".")}if(typeof t=="object"){for(e="",o=function(u){for(var d=null,p=1,f=null,g=0,E=0;E<8;E++)u[E]!==0?(g>p&&(d=f,p=g),f=null,g=0):(f===null&&(f=E),++g);return g>p&&(d=f,p=g),d}(t),n=0;n<8;n++)c&&t[n]===0||(c&&(c=!1),o===n?(e+=n?":":"::",c=!0):(e+=t[n].toString(16),n<7&&(e+=":")));return"["+e+"]"}return t},Rd={},iC=il({},Rd,{" ":1,'"':1,"<":1,">":1,"`":1}),oC=il({},iC,{"#":1,"?":1,"{":1,"}":1}),WA=il({},oC,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Ys=function(t,e){var n=Ib(t,0);return n>32&&n<127&&!ft(e,t)?t:encodeURIComponent(t)},wd={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Tn=function(t){return ft(wd,t.scheme)},YA=function(t){return t.username!=""||t.password!=""},qA=function(t){return!t.host||t.cannotBeABaseURL||t.scheme=="file"},Ol=function(t,e){var n;return t.length==2&&rC.test(t.charAt(0))&&((n=t.charAt(1))==":"||!e&&n=="|")},sC=function(t){var e;return t.length>1&&Ol(t.slice(0,2))&&(t.length==2||(e=t.charAt(2))==="/"||e==="\\"||e==="?"||e==="#")},aC=function(t){var e=t.path,n=e.length;!n||t.scheme=="file"&&n==1&&Ol(e[0],!0)||e.pop()},Lb=function(t){return t==="."||t.toLowerCase()==="%2e"},JA={},cC={},zA={},lC={},uC={},XA={},dC={},hC={},bd={},Nd={},ZA={},$A={},tf={},ef={},pC={},rf={},Rc={},Fo={},AC={},Ra={},fs={},Vo=function(t,e,n,o){var c,u,d,p,f,g=n||JA,E=0,I="",_=!1,T=!1,R=!1;for(n||(t.scheme="",t.username="",t.password="",t.host=null,t.port=null,t.path=[],t.query=null,t.fragment=null,t.cannotBeABaseURL=!1,e=e.replace(Ob,"")),e=e.replace(kb,""),c=Ea(e);E<=c.length;){switch(u=c[E],g){case JA:if(!u||!rC.test(u)){if(n)return jA;g=zA;continue}I+=u.toLowerCase(),g=cC;break;case cC:if(u&&(Sb.test(u)||u=="+"||u=="-"||u=="."))I+=u.toLowerCase();else{if(u!=":"){if(n)return jA;I="",g=zA,E=0;continue}if(n&&(Tn(t)!=ft(wd,I)||I=="file"&&(YA(t)||t.port!==null)||t.scheme=="file"&&!t.host))return;if(t.scheme=I,n)return void(Tn(t)&&wd[t.scheme]==t.port&&(t.port=null));I="",t.scheme=="file"?g=ef:Tn(t)&&o&&o.scheme==t.scheme?g=lC:Tn(t)?g=hC:c[E+1]=="/"?(g=uC,E++):(t.cannotBeABaseURL=!0,t.path.push(""),g=AC)}break;case zA:if(!o||o.cannotBeABaseURL&&u!="#")return jA;if(o.cannotBeABaseURL&&u=="#"){t.scheme=o.scheme,t.path=o.path.slice(),t.query=o.query,t.fragment="",t.cannotBeABaseURL=!0,g=fs;break}g=o.scheme=="file"?ef:XA;continue;case lC:if(u!="/"||c[E+1]!="/"){g=XA;continue}g=bd,E++;break;case uC:if(u=="/"){g=Nd;break}g=Fo;continue;case XA:if(t.scheme=o.scheme,u==no)t.username=o.username,t.password=o.password,t.host=o.host,t.port=o.port,t.path=o.path.slice(),t.query=o.query;else if(u=="/"||u=="\\"&&Tn(t))g=dC;else if(u=="?")t.username=o.username,t.password=o.password,t.host=o.host,t.port=o.port,t.path=o.path.slice(),t.query="",g=Ra;else{if(u!="#"){t.username=o.username,t.password=o.password,t.host=o.host,t.port=o.port,t.path=o.path.slice(),t.path.pop(),g=Fo;continue}t.username=o.username,t.password=o.password,t.host=o.host,t.port=o.port,t.path=o.path.slice(),t.query=o.query,t.fragment="",g=fs}break;case dC:if(!Tn(t)||u!="/"&&u!="\\"){if(u!="/"){t.username=o.username,t.password=o.password,t.host=o.host,t.port=o.port,g=Fo;continue}g=Nd}else g=bd;break;case hC:if(g=bd,u!="/"||I.charAt(E+1)!="/")continue;E++;break;case bd:if(u!="/"&&u!="\\"){g=Nd;continue}break;case Nd:if(u=="@"){_&&(I="%40"+I),_=!0,d=Ea(I);for(var w=0;w<d.length;w++){var k=d[w];if(k!=":"||R){var L=Ys(k,WA);R?t.password+=L:t.username+=L}else R=!0}I=""}else if(u==no||u=="/"||u=="?"||u=="#"||u=="\\"&&Tn(t)){if(_&&I=="")return"Invalid authority";E-=Ea(I).length+1,I="",g=ZA}else I+=u;break;case ZA:case $A:if(n&&t.scheme=="file"){g=rf;continue}if(u!=":"||T){if(u==no||u=="/"||u=="?"||u=="#"||u=="\\"&&Tn(t)){if(Tn(t)&&I=="")return Ta;if(n&&I==""&&(YA(t)||t.port!==null))return;if(p=HA(t,I))return p;if(I="",g=Rc,n)return;continue}u=="["?T=!0:u=="]"&&(T=!1),I+=u}else{if(I=="")return Ta;if(p=HA(t,I))return p;if(I="",g=tf,n==$A)return}break;case tf:if(!KA.test(u)){if(u==no||u=="/"||u=="?"||u=="#"||u=="\\"&&Tn(t)||n){if(I!=""){var Y=parseInt(I,10);if(Y>65535)return eC;t.port=Tn(t)&&Y===wd[t.scheme]?null:Y,I=""}if(n)return;g=Rc;continue}return eC}I+=u;break;case ef:if(t.scheme="file",u=="/"||u=="\\")g=pC;else{if(!o||o.scheme!="file"){g=Fo;continue}if(u==no)t.host=o.host,t.path=o.path.slice(),t.query=o.query;else if(u=="?")t.host=o.host,t.path=o.path.slice(),t.query="",g=Ra;else{if(u!="#"){sC(c.slice(E).join(""))||(t.host=o.host,t.path=o.path.slice(),aC(t)),g=Fo;continue}t.host=o.host,t.path=o.path.slice(),t.query=o.query,t.fragment="",g=fs}}break;case pC:if(u=="/"||u=="\\"){g=rf;break}o&&o.scheme=="file"&&!sC(c.slice(E).join(""))&&(Ol(o.path[0],!0)?t.path.push(o.path[0]):t.host=o.host),g=Fo;continue;case rf:if(u==no||u=="/"||u=="\\"||u=="?"||u=="#"){if(!n&&Ol(I))g=Fo;else if(I==""){if(t.host="",n)return;g=Rc}else{if(p=HA(t,I))return p;if(t.host=="localhost"&&(t.host=""),n)return;I="",g=Rc}continue}I+=u;break;case Rc:if(Tn(t)){if(g=Fo,u!="/"&&u!="\\")continue}else if(n||u!="?")if(n||u!="#"){if(u!=no&&(g=Fo,u!="/"))continue}else t.fragment="",g=fs;else t.query="",g=Ra;break;case Fo:if(u==no||u=="/"||u=="\\"&&Tn(t)||!n&&(u=="?"||u=="#")){if((f=(f=I).toLowerCase())===".."||f==="%2e."||f===".%2e"||f==="%2e%2e"?(aC(t),u=="/"||u=="\\"&&Tn(t)||t.path.push("")):Lb(I)?u=="/"||u=="\\"&&Tn(t)||t.path.push(""):(t.scheme=="file"&&!t.path.length&&Ol(I)&&(t.host&&(t.host=""),I=I.charAt(0)+":"),t.path.push(I)),I="",t.scheme=="file"&&(u==no||u=="?"||u=="#"))for(;t.path.length>1&&t.path[0]==="";)t.path.shift();u=="?"?(t.query="",g=Ra):u=="#"&&(t.fragment="",g=fs)}else I+=Ys(u,oC);break;case AC:u=="?"?(t.query="",g=Ra):u=="#"?(t.fragment="",g=fs):u!=no&&(t.path[0]+=Ys(u,Rd));break;case Ra:n||u!="#"?u!=no&&(u=="'"&&Tn(t)?t.query+="%27":t.query+=u=="#"?"%23":Ys(u,Rd)):(t.fragment="",g=fs);break;case fs:u!=no&&(t.fragment+=Ys(u,iC))}E++}},wa=function(t){var e,n,o=$a(this,wa,"URL"),c=arguments.length>1?arguments[1]:void 0,u=String(t),d=_b(o,{type:"URL"});if(c!==void 0){if(c instanceof wa)e=Ur(c);else if(n=Vo(e={},String(c)))throw TypeError(n)}if(n=Vo(d,u,null,e))throw TypeError(n);var p=d.searchParams=new Cb,f=GA(p);f.updateSearchParams(d.query),f.updateURL=function(){d.query=String(p)||null},m||(o.href=Od.call(o),o.origin=fC.call(o),o.protocol=gC.call(o),o.username=mC.call(o),o.password=EC.call(o),o.host=vC.call(o),o.hostname=IC.call(o),o.port=CC.call(o),o.pathname=_C.call(o),o.search=yC.call(o),o.searchParams=SC.call(o),o.hash=TC.call(o))},nf=wa.prototype,Od=function(){var t=Ur(this),e=t.scheme,n=t.username,o=t.password,c=t.host,u=t.port,d=t.path,p=t.query,f=t.fragment,g=e+":";return c!==null?(g+="//",YA(t)&&(g+=n+(o?":"+o:"")+"@"),g+=Nl(c),u!==null&&(g+=":"+u)):e=="file"&&(g+="//"),g+=t.cannotBeABaseURL?d[0]:d.length?"/"+d.join("/"):"",p!==null&&(g+="?"+p),f!==null&&(g+="#"+f),g},fC=function(){var t=Ur(this),e=t.scheme,n=t.port;if(e=="blob")try{return new URL(e.path[0]).origin}catch{return"null"}return e!="file"&&Tn(t)?e+"://"+Nl(t.host)+(n!==null?":"+n:""):"null"},gC=function(){return Ur(this).scheme+":"},mC=function(){return Ur(this).username},EC=function(){return Ur(this).password},vC=function(){var t=Ur(this),e=t.host,n=t.port;return e===null?"":n===null?Nl(e):Nl(e)+":"+n},IC=function(){var t=Ur(this).host;return t===null?"":Nl(t)},CC=function(){var t=Ur(this).port;return t===null?"":String(t)},_C=function(){var t=Ur(this),e=t.path;return t.cannotBeABaseURL?e[0]:e.length?"/"+e.join("/"):""},yC=function(){var t=Ur(this).query;return t?"?"+t:""},SC=function(){return Ur(this).searchParams},TC=function(){var t=Ur(this).fragment;return t?"#"+t:""},io=function(t,e){return{get:t,set:e,configurable:!0,enumerable:!0}};if(m&&Xo(nf,{href:io(Od,function(t){var e=Ur(this),n=String(t),o=Vo(e,n);if(o)throw TypeError(o);GA(e.searchParams).updateSearchParams(e.query)}),origin:io(fC),protocol:io(gC,function(t){var e=Ur(this);Vo(e,String(t)+":",JA)}),username:io(mC,function(t){var e=Ur(this),n=Ea(String(t));if(!qA(e)){e.username="";for(var o=0;o<n.length;o++)e.username+=Ys(n[o],WA)}}),password:io(EC,function(t){var e=Ur(this),n=Ea(String(t));if(!qA(e)){e.password="";for(var o=0;o<n.length;o++)e.password+=Ys(n[o],WA)}}),host:io(vC,function(t){var e=Ur(this);e.cannotBeABaseURL||Vo(e,String(t),ZA)}),hostname:io(IC,function(t){var e=Ur(this);e.cannotBeABaseURL||Vo(e,String(t),$A)}),port:io(CC,function(t){var e=Ur(this);qA(e)||((t=String(t))==""?e.port=null:Vo(e,t,tf))}),pathname:io(_C,function(t){var e=Ur(this);e.cannotBeABaseURL||(e.path=[],Vo(e,t+"",Rc))}),search:io(yC,function(t){var e=Ur(this);(t=String(t))==""?e.query=null:(t.charAt(0)=="?"&&(t=t.slice(1)),e.query="",Vo(e,t,Ra)),GA(e.searchParams).updateSearchParams(e.query)}),searchParams:io(SC),hash:io(TC,function(t){var e=Ur(this);(t=String(t))!=""?(t.charAt(0)=="#"&&(t=t.slice(1)),e.fragment="",Vo(e,t,fs)):e.fragment=null})}),ss(nf,"toJSON",function(){return Od.call(this)},{enumerable:!0}),ss(nf,"toString",function(){return Od.call(this)},{enumerable:!0}),bl){var RC=bl.createObjectURL,wC=bl.revokeObjectURL;RC&&ss(wa,"createObjectURL",function(t){return RC.apply(bl,arguments)}),wC&&ss(wa,"revokeObjectURL",function(t){return wC.apply(bl,arguments)})}is(wa,"URL"),jt({global:!0,forced:!xA,sham:!m},{URL:wa});var bC=le.URL;const Mb={[mc.ACCESS_POINT]:{[$r.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[$r.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[$r.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[$r.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[$r.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[$r.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[$r.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[$r.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voice service available",retry:!0},[$r.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[$r.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[$r.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[$r.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[$r.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[$r.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[$r.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[$r.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[$r.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[$r.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[mc.UNILBS]:{[Ii.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Ii.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Ii.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Ii.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Ii.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Ii.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Ii.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Ii.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Ii.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Ii.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Ii.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Ii.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[mc.STRING_UID_ALLOCATOR]:{[ml.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[ml.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[ml.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function kl(t){const e=Mb[Math.floor(t/1e4)];if(!e)return{desc:"unkonw error",retry:!1};const n=e[t%1e4];if(!n){if(Math.floor(t/1e4)===mc.ACCESS_POINT){const o=t%1e4;if(o.toString()[0]==="1")return{desc:t.toString(),retry:!1};if(o.toString()[0]==="2")return{desc:t.toString(),retry:!0}}return{desc:"unkonw error",retry:!1}}return n}const Pb={[Yt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Yt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Yt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Yt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Yt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Yt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Yt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Yt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Yt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Yt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Yt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Yt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Yt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Yt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Yt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Yt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Yt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Yt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Yt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Yt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Yt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Yt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Yt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Yt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Yt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Yt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Yt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Yt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Yt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Yt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Yt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Yt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Yt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Yt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Yt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Yt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Yt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Yt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Yt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Yt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Yt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Yt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Yt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Yt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Yt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Yt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Yt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Yt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Yt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Yt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Yt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Yt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Yt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Yt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Yt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Yt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Yt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"}};function NC(t){return Pb[t]||{desc:"UNKNOW_ERROR_".concat(t),action:"failed"}}var xb=a(function(t,e){t.exports=function(){var n={d:function(j,B){for(var V in B)n.o(B,V)&&!n.o(j,V)&&Object.defineProperty(j,V,{enumerable:!0,get:B[V]})},o:function(j,B){return Object.prototype.hasOwnProperty.call(j,B)},r:function(j){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(j,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(j,"__esModule",{value:!0})}},o={};n.r(o),n.d(o,{DataViewIndexOutOfBoundsError:function(){return et},DecodeError:function(){return rt},Decoder:function(){return ir},EXT_TIMESTAMP:function(){return ut},Encoder:function(){return re},ExtData:function(){return Y},ExtensionCodec:function(){return xt},decode:function(){return Rn},decodeArrayStream:function(){return Xn},decodeAsync:function(){return mr},decodeMulti:function(){return wo},decodeMultiStream:function(){return bo},decodeStream:function(){return Cs},decodeTimestampExtension:function(){return wt},decodeTimestampToTimeSpec:function(){return Gt},encode:function(){return z},encodeDateToTimeSpec:function(){return Ct},encodeTimeSpecToTimestamp:function(){return At},encodeTimestampExtension:function(){return lt}});var c=4294967295;function u(j,B,V){var J=Math.floor(V/4294967296),q=V;j.setUint32(B,J),j.setUint32(B+4,q)}function d(j,B){return 4294967296*j.getInt32(B)+j.getUint32(B+4)}var p=function(j,B){var V=typeof Symbol=="function"&&j[Symbol.iterator];if(!V)return j;var J,q,mt=V.call(j),dt=[];try{for(;(B===void 0||B-- >0)&&!(J=mt.next()).done;)dt.push(J.value)}catch(Nt){q={error:Nt}}finally{try{J&&!J.done&&(V=mt.return)&&V.call(mt)}finally{if(q)throw q.error}}return dt},f=function(j,B){for(var V=0,J=B.length,q=j.length;V<J;V++,q++)j[q]=B[V];return j},g=typeof TextEncoder!="undefined"&&typeof TextDecoder!="undefined";function E(j){for(var B=j.length,V=0,J=0;J<B;){var q=j.charCodeAt(J++);if((4294967168&q)!=0)if((4294965248&q)==0)V+=2;else{if(q>=55296&&q<=56319&&J<B){var mt=j.charCodeAt(J);(64512&mt)==56320&&(++J,q=((1023&q)<<10)+(1023&mt)+65536)}V+=(4294901760&q)==0?3:4}else V++}return V}var I=g?new TextEncoder:void 0,_=g?typeof process!="undefined"?200:0:c,T=(I==null?void 0:I.encodeInto)?function(j,B,V){I.encodeInto(j,B.subarray(V))}:function(j,B,V){B.set(I.encode(j),V)};function R(j,B,V){for(var J=B,q=J+V,mt=[],dt="";J<q;){var Nt=j[J++];if((128&Nt)==0)mt.push(Nt);else if((224&Nt)==192){var Zt=63&j[J++];mt.push((31&Nt)<<6|Zt)}else if((240&Nt)==224){Zt=63&j[J++];var ee=63&j[J++];mt.push((31&Nt)<<12|Zt<<6|ee)}else if((248&Nt)==240){var St=(7&Nt)<<18|(Zt=63&j[J++])<<12|(ee=63&j[J++])<<6|63&j[J++];St>65535&&(St-=65536,mt.push(St>>>10&1023|55296),St=56320|1023&St),mt.push(St)}else mt.push(Nt);mt.length>=4096&&(dt+=String.fromCharCode.apply(String,f([],p(mt))),mt.length=0)}return mt.length>0&&(dt+=String.fromCharCode.apply(String,f([],p(mt)))),dt}var w,k=g?new TextDecoder:null,L=g?typeof process!="undefined"?200:0:c,Y=function(j,B){this.type=j,this.data=B},Z=(w=function(j,B){return(w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(V,J){V.__proto__=J}||function(V,J){for(var q in J)Object.prototype.hasOwnProperty.call(J,q)&&(V[q]=J[q])})(j,B)},function(j,B){if(typeof B!="function"&&B!==null)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function V(){this.constructor=j}w(j,B),j.prototype=B===null?Object.create(B):(V.prototype=B.prototype,new V)}),rt=function(j){function B(V){var J=j.call(this,V)||this,q=Object.create(B.prototype);return Object.setPrototypeOf(J,q),Object.defineProperty(J,"name",{configurable:!0,enumerable:!1,value:B.name}),J}return Z(B,j),B}(Error),ut=-1;function At(j){var B,V=j.sec,J=j.nsec;if(V>=0&&J>=0&&V<=17179869183){if(J===0&&V<=4294967295){var q=new Uint8Array(4);return(B=new DataView(q.buffer)).setUint32(0,V),q}var mt=V/4294967296,dt=4294967295&V;return q=new Uint8Array(8),(B=new DataView(q.buffer)).setUint32(0,J<<2|3&mt),B.setUint32(4,dt),q}return q=new Uint8Array(12),(B=new DataView(q.buffer)).setUint32(0,J),u(B,4,V),q}function Ct(j){var B=j.getTime(),V=Math.floor(B/1e3),J=1e6*(B-1e3*V),q=Math.floor(J/1e9);return{sec:V+q,nsec:J-1e9*q}}function lt(j){return j instanceof Date?At(Ct(j)):null}function Gt(j){var B=new DataView(j.buffer,j.byteOffset,j.byteLength);switch(j.byteLength){case 4:return{sec:B.getUint32(0),nsec:0};case 8:var V=B.getUint32(0);return{sec:4294967296*(3&V)+B.getUint32(4),nsec:V>>>2};case 12:return{sec:d(B,4),nsec:B.getUint32(0)};default:throw new rt("Unrecognized data size for timestamp (expected 4, 8, or 12): "+j.length)}}function wt(j){var B=Gt(j);return new Date(1e3*B.sec+B.nsec/1e6)}var Qt={type:ut,encode:lt,decode:wt},xt=function(){function j(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(Qt)}return j.prototype.register=function(B){var V=B.type,J=B.encode,q=B.decode;if(V>=0)this.encoders[V]=J,this.decoders[V]=q;else{var mt=1+V;this.builtInEncoders[mt]=J,this.builtInDecoders[mt]=q}},j.prototype.tryToEncode=function(B,V){for(var J=0;J<this.builtInEncoders.length;J++)if((q=this.builtInEncoders[J])!=null&&(mt=q(B,V))!=null)return new Y(-1-J,mt);for(J=0;J<this.encoders.length;J++){var q,mt;if((q=this.encoders[J])!=null&&(mt=q(B,V))!=null)return new Y(J,mt)}return B instanceof Y?B:null},j.prototype.decode=function(B,V,J){var q=V<0?this.builtInDecoders[-1-V]:this.decoders[V];return q?q(B,V,J):new Y(V,B)},j.defaultCodec=new j,j}();function ae(j){return j instanceof Uint8Array?j:ArrayBuffer.isView(j)?new Uint8Array(j.buffer,j.byteOffset,j.byteLength):j instanceof ArrayBuffer?new Uint8Array(j):Uint8Array.from(j)}var ge=function(j){var B=typeof Symbol=="function"&&Symbol.iterator,V=B&&j[B],J=0;if(V)return V.call(j);if(j&&typeof j.length=="number")return{next:function(){return j&&J>=j.length&&(j=void 0),{value:j&&j[J++],done:!j}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")},re=function(){function j(B,V,J,q,mt,dt,Nt,Zt){B===void 0&&(B=xt.defaultCodec),V===void 0&&(V=void 0),J===void 0&&(J=100),q===void 0&&(q=2048),mt===void 0&&(mt=!1),dt===void 0&&(dt=!1),Nt===void 0&&(Nt=!1),Zt===void 0&&(Zt=!1),this.extensionCodec=B,this.context=V,this.maxDepth=J,this.initialBufferSize=q,this.sortKeys=mt,this.forceFloat32=dt,this.ignoreUndefined=Nt,this.forceIntegerToFloat=Zt,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}return j.prototype.getUint8Array=function(){return this.bytes.subarray(0,this.pos)},j.prototype.reinitializeState=function(){this.pos=0},j.prototype.encode=function(B){return this.reinitializeState(),this.doEncode(B,1),this.getUint8Array()},j.prototype.doEncode=function(B,V){if(V>this.maxDepth)throw new Error("Too deep objects in depth "+V);B==null?this.encodeNil():typeof B=="boolean"?this.encodeBoolean(B):typeof B=="number"?this.encodeNumber(B):typeof B=="string"?this.encodeString(B):this.encodeObject(B,V)},j.prototype.ensureBufferSizeToWrite=function(B){var V=this.pos+B;this.view.byteLength<V&&this.resizeBuffer(2*V)},j.prototype.resizeBuffer=function(B){var V=new ArrayBuffer(B),J=new Uint8Array(V),q=new DataView(V);J.set(this.bytes),this.view=q,this.bytes=J},j.prototype.encodeNil=function(){this.writeU8(192)},j.prototype.encodeBoolean=function(B){B===!1?this.writeU8(194):this.writeU8(195)},j.prototype.encodeNumber=function(B){Number.isSafeInteger(B)&&!this.forceIntegerToFloat?B>=0?B<128?this.writeU8(B):B<256?(this.writeU8(204),this.writeU8(B)):B<65536?(this.writeU8(205),this.writeU16(B)):B<4294967296?(this.writeU8(206),this.writeU32(B)):(this.writeU8(207),this.writeU64(B)):B>=-32?this.writeU8(224|B+32):B>=-128?(this.writeU8(208),this.writeI8(B)):B>=-32768?(this.writeU8(209),this.writeI16(B)):B>=-2147483648?(this.writeU8(210),this.writeI32(B)):(this.writeU8(211),this.writeI64(B)):this.forceFloat32?(this.writeU8(202),this.writeF32(B)):(this.writeU8(203),this.writeF64(B))},j.prototype.writeStringHeader=function(B){if(B<32)this.writeU8(160+B);else if(B<256)this.writeU8(217),this.writeU8(B);else if(B<65536)this.writeU8(218),this.writeU16(B);else{if(!(B<4294967296))throw new Error("Too long string: "+B+" bytes in UTF-8");this.writeU8(219),this.writeU32(B)}},j.prototype.encodeString=function(B){if(B.length>_){var V=E(B);this.ensureBufferSizeToWrite(5+V),this.writeStringHeader(V),T(B,this.bytes,this.pos),this.pos+=V}else V=E(B),this.ensureBufferSizeToWrite(5+V),this.writeStringHeader(V),function(J,q,mt){for(var dt=J.length,Nt=mt,Zt=0;Zt<dt;){var ee=J.charCodeAt(Zt++);if((4294967168&ee)!=0){if((4294965248&ee)==0)q[Nt++]=ee>>6&31|192;else{if(ee>=55296&&ee<=56319&&Zt<dt){var St=J.charCodeAt(Zt);(64512&St)==56320&&(++Zt,ee=((1023&ee)<<10)+(1023&St)+65536)}(4294901760&ee)==0?(q[Nt++]=ee>>12&15|224,q[Nt++]=ee>>6&63|128):(q[Nt++]=ee>>18&7|240,q[Nt++]=ee>>12&63|128,q[Nt++]=ee>>6&63|128)}q[Nt++]=63&ee|128}else q[Nt++]=ee}}(B,this.bytes,this.pos),this.pos+=V},j.prototype.encodeObject=function(B,V){var J=this.extensionCodec.tryToEncode(B,this.context);if(J!=null)this.encodeExtension(J);else if(Array.isArray(B))this.encodeArray(B,V);else if(ArrayBuffer.isView(B))this.encodeBinary(B);else{if(typeof B!="object")throw new Error("Unrecognized object: "+Object.prototype.toString.apply(B));this.encodeMap(B,V)}},j.prototype.encodeBinary=function(B){var V=B.byteLength;if(V<256)this.writeU8(196),this.writeU8(V);else if(V<65536)this.writeU8(197),this.writeU16(V);else{if(!(V<4294967296))throw new Error("Too large binary: "+V);this.writeU8(198),this.writeU32(V)}var J=ae(B);this.writeU8a(J)},j.prototype.encodeArray=function(B,V){var J,q,mt=B.length;if(mt<16)this.writeU8(144+mt);else if(mt<65536)this.writeU8(220),this.writeU16(mt);else{if(!(mt<4294967296))throw new Error("Too large array: "+mt);this.writeU8(221),this.writeU32(mt)}try{for(var dt=ge(B),Nt=dt.next();!Nt.done;Nt=dt.next()){var Zt=Nt.value;this.doEncode(Zt,V+1)}}catch(ee){J={error:ee}}finally{try{Nt&&!Nt.done&&(q=dt.return)&&q.call(dt)}finally{if(J)throw J.error}}},j.prototype.countWithoutUndefined=function(B,V){var J,q,mt=0;try{for(var dt=ge(V),Nt=dt.next();!Nt.done;Nt=dt.next())B[Nt.value]!==void 0&&mt++}catch(Zt){J={error:Zt}}finally{try{Nt&&!Nt.done&&(q=dt.return)&&q.call(dt)}finally{if(J)throw J.error}}return mt},j.prototype.encodeMap=function(B,V){var J,q,mt=Object.keys(B);this.sortKeys&&mt.sort();var dt=this.ignoreUndefined?this.countWithoutUndefined(B,mt):mt.length;if(dt<16)this.writeU8(128+dt);else if(dt<65536)this.writeU8(222),this.writeU16(dt);else{if(!(dt<4294967296))throw new Error("Too large map object: "+dt);this.writeU8(223),this.writeU32(dt)}try{for(var Nt=ge(mt),Zt=Nt.next();!Zt.done;Zt=Nt.next()){var ee=Zt.value,St=B[ee];this.ignoreUndefined&&St===void 0||(this.encodeString(ee),this.doEncode(St,V+1))}}catch(Bt){J={error:Bt}}finally{try{Zt&&!Zt.done&&(q=Nt.return)&&q.call(Nt)}finally{if(J)throw J.error}}},j.prototype.encodeExtension=function(B){var V=B.data.length;if(V===1)this.writeU8(212);else if(V===2)this.writeU8(213);else if(V===4)this.writeU8(214);else if(V===8)this.writeU8(215);else if(V===16)this.writeU8(216);else if(V<256)this.writeU8(199),this.writeU8(V);else if(V<65536)this.writeU8(200),this.writeU16(V);else{if(!(V<4294967296))throw new Error("Too large extension object: "+V);this.writeU8(201),this.writeU32(V)}this.writeI8(B.type),this.writeU8a(B.data)},j.prototype.writeU8=function(B){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,B),this.pos++},j.prototype.writeU8a=function(B){var V=B.length;this.ensureBufferSizeToWrite(V),this.bytes.set(B,this.pos),this.pos+=V},j.prototype.writeI8=function(B){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,B),this.pos++},j.prototype.writeU16=function(B){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,B),this.pos+=2},j.prototype.writeI16=function(B){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,B),this.pos+=2},j.prototype.writeU32=function(B){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,B),this.pos+=4},j.prototype.writeI32=function(B){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,B),this.pos+=4},j.prototype.writeF32=function(B){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,B),this.pos+=4},j.prototype.writeF64=function(B){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,B),this.pos+=8},j.prototype.writeU64=function(B){this.ensureBufferSizeToWrite(8),function(V,J,q){var mt=q/4294967296,dt=q;V.setUint32(J,mt),V.setUint32(J+4,dt)}(this.view,this.pos,B),this.pos+=8},j.prototype.writeI64=function(B){this.ensureBufferSizeToWrite(8),u(this.view,this.pos,B),this.pos+=8},j}(),wr={};function z(j,B){return B===void 0&&(B=wr),new re(B.extensionCodec,B.context,B.maxDepth,B.initialBufferSize,B.sortKeys,B.forceFloat32,B.ignoreUndefined,B.forceIntegerToFloat).encode(j)}function nt(j){return(j<0?"-":"")+"0x"+Math.abs(j).toString(16).padStart(2,"0")}var gt=function(){function j(B,V){B===void 0&&(B=16),V===void 0&&(V=16),this.maxKeyLength=B,this.maxLengthPerKey=V,this.hit=0,this.miss=0,this.caches=[];for(var J=0;J<this.maxKeyLength;J++)this.caches.push([])}return j.prototype.canBeCached=function(B){return B>0&&B<=this.maxKeyLength},j.prototype.find=function(B,V,J){var q,mt,dt=this.caches[J-1];try{t:for(var Nt=function(qt){var De=typeof Symbol=="function"&&Symbol.iterator,Hr=De&&qt[De],pi=0;if(Hr)return Hr.call(qt);if(qt&&typeof qt.length=="number")return{next:function(){return qt&&pi>=qt.length&&(qt=void 0),{value:qt&&qt[pi++],done:!qt}}};throw new TypeError(De?"Object is not iterable.":"Symbol.iterator is not defined.")}(dt),Zt=Nt.next();!Zt.done;Zt=Nt.next()){for(var ee=Zt.value,St=ee.bytes,Bt=0;Bt<J;Bt++)if(St[Bt]!==B[V+Bt])continue t;return ee.str}}catch(qt){q={error:qt}}finally{try{Zt&&!Zt.done&&(mt=Nt.return)&&mt.call(Nt)}finally{if(q)throw q.error}}return null},j.prototype.store=function(B,V){var J=this.caches[B.length-1],q={bytes:B,str:V};J.length>=this.maxLengthPerKey?J[Math.random()*J.length|0]=q:J.push(q)},j.prototype.decode=function(B,V,J){var q=this.find(B,V,J);if(q!=null)return this.hit++,q;this.miss++;var mt=R(B,V,J),dt=Uint8Array.prototype.slice.call(B,V,V+J);return this.store(dt,mt),mt},j}(),It=function(j,B){var V,J,q,mt,dt={label:0,sent:function(){if(1&q[0])throw q[1];return q[1]},trys:[],ops:[]};return mt={next:Nt(0),throw:Nt(1),return:Nt(2)},typeof Symbol=="function"&&(mt[Symbol.iterator]=function(){return this}),mt;function Nt(Zt){return function(ee){return function(St){if(V)throw new TypeError("Generator is already executing.");for(;dt;)try{if(V=1,J&&(q=2&St[0]?J.return:St[0]?J.throw||((q=J.return)&&q.call(J),0):J.next)&&!(q=q.call(J,St[1])).done)return q;switch(J=0,q&&(St=[2&St[0],q.value]),St[0]){case 0:case 1:q=St;break;case 4:return dt.label++,{value:St[1],done:!1};case 5:dt.label++,J=St[1],St=[0];continue;case 7:St=dt.ops.pop(),dt.trys.pop();continue;default:if(!((q=(q=dt.trys).length>0&&q[q.length-1])||St[0]!==6&&St[0]!==2)){dt=0;continue}if(St[0]===3&&(!q||St[1]>q[0]&&St[1]<q[3])){dt.label=St[1];break}if(St[0]===6&&dt.label<q[1]){dt.label=q[1],q=St;break}if(q&&dt.label<q[2]){dt.label=q[2],dt.ops.push(St);break}q[2]&&dt.ops.pop(),dt.trys.pop();continue}St=B.call(j,dt)}catch(Bt){St=[6,Bt],J=0}finally{V=q=0}if(5&St[0])throw St[1];return{value:St[0]?St[1]:void 0,done:!0}}([Zt,ee])}}},Mt=function(j){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var B,V=j[Symbol.asyncIterator];return V?V.call(j):(j=typeof __values=="function"?__values(j):j[Symbol.iterator](),B={},J("next"),J("throw"),J("return"),B[Symbol.asyncIterator]=function(){return this},B);function J(q){B[q]=j[q]&&function(mt){return new Promise(function(dt,Nt){(function(Zt,ee,St,Bt){Promise.resolve(Bt).then(function(qt){Zt({value:qt,done:St})},ee)})(dt,Nt,(mt=j[q](mt)).done,mt.value)})}}},tt=function(j){return this instanceof tt?(this.v=j,this):new tt(j)},y=function(j,B,V){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var J,q=V.apply(j,B||[]),mt=[];return J={},dt("next"),dt("throw"),dt("return"),J[Symbol.asyncIterator]=function(){return this},J;function dt(Bt){q[Bt]&&(J[Bt]=function(qt){return new Promise(function(De,Hr){mt.push([Bt,qt,De,Hr])>1||Nt(Bt,qt)})})}function Nt(Bt,qt){try{(De=q[Bt](qt)).value instanceof tt?Promise.resolve(De.value.v).then(Zt,ee):St(mt[0][2],De)}catch(Hr){St(mt[0][3],Hr)}var De}function Zt(Bt){Nt("next",Bt)}function ee(Bt){Nt("throw",Bt)}function St(Bt,qt){Bt(qt),mt.shift(),mt.length&&Nt(mt[0][0],mt[0][1])}},D=new DataView(new ArrayBuffer(0)),x=new Uint8Array(D.buffer),et=function(){try{D.getInt8(0)}catch(j){return j.constructor}throw new Error("never reached")}(),Dt=new et("Insufficient data"),Se=new gt,ir=function(){function j(B,V,J,q,mt,dt,Nt,Zt){B===void 0&&(B=xt.defaultCodec),V===void 0&&(V=void 0),J===void 0&&(J=c),q===void 0&&(q=c),mt===void 0&&(mt=c),dt===void 0&&(dt=c),Nt===void 0&&(Nt=c),Zt===void 0&&(Zt=Se),this.extensionCodec=B,this.context=V,this.maxStrLength=J,this.maxBinLength=q,this.maxArrayLength=mt,this.maxMapLength=dt,this.maxExtLength=Nt,this.keyDecoder=Zt,this.totalPos=0,this.pos=0,this.view=D,this.bytes=x,this.headByte=-1,this.stack=[]}return j.prototype.reinitializeState=function(){this.totalPos=0,this.headByte=-1,this.stack.length=0},j.prototype.setBuffer=function(B){this.bytes=ae(B),this.view=function(V){if(V instanceof ArrayBuffer)return new DataView(V);var J=ae(V);return new DataView(J.buffer,J.byteOffset,J.byteLength)}(this.bytes),this.pos=0},j.prototype.appendBuffer=function(B){if(this.headByte!==-1||this.hasRemaining(1)){var V=this.bytes.subarray(this.pos),J=ae(B),q=new Uint8Array(V.length+J.length);q.set(V),q.set(J,V.length),this.setBuffer(q)}else this.setBuffer(B)},j.prototype.hasRemaining=function(B){return this.view.byteLength-this.pos>=B},j.prototype.createExtraByteError=function(B){var V=this.view,J=this.pos;return new RangeError("Extra "+(V.byteLength-J)+" of "+V.byteLength+" byte(s) found at buffer["+B+"]")},j.prototype.decode=function(B){this.reinitializeState(),this.setBuffer(B);var V=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return V},j.prototype.decodeMulti=function(B){return It(this,function(V){switch(V.label){case 0:this.reinitializeState(),this.setBuffer(B),V.label=1;case 1:return this.hasRemaining(1)?[4,this.doDecodeSync()]:[3,3];case 2:return V.sent(),[3,1];case 3:return[2]}})},j.prototype.decodeAsync=function(B){var V,J,q,mt,dt,Nt,Zt,ee;return dt=this,Nt=void 0,ee=function(){var St,Bt,qt,De,Hr,pi,Ki,er;return It(this,function(lo){switch(lo.label){case 0:St=!1,lo.label=1;case 1:lo.trys.push([1,6,7,12]),V=Mt(B),lo.label=2;case 2:return[4,V.next()];case 3:if((J=lo.sent()).done)return[3,5];if(qt=J.value,St)throw this.createExtraByteError(this.totalPos);this.appendBuffer(qt);try{Bt=this.doDecodeSync(),St=!0}catch(q_){if(!(q_ instanceof et))throw q_}this.totalPos+=this.pos,lo.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return De=lo.sent(),q={error:De},[3,12];case 7:return lo.trys.push([7,,10,11]),J&&!J.done&&(mt=V.return)?[4,mt.call(V)]:[3,9];case 8:lo.sent(),lo.label=9;case 9:return[3,11];case 10:if(q)throw q.error;return[7];case 11:return[7];case 12:if(St){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return[2,Bt]}throw pi=(Hr=this).headByte,Ki=Hr.pos,er=Hr.totalPos,new RangeError("Insufficient data in parsing "+nt(pi)+" at "+er+" ("+Ki+" in the current buffer)")}})},new((Zt=void 0)||(Zt=Promise))(function(St,Bt){function qt(pi){try{Hr(ee.next(pi))}catch(Ki){Bt(Ki)}}function De(pi){try{Hr(ee.throw(pi))}catch(Ki){Bt(Ki)}}function Hr(pi){var Ki;pi.done?St(pi.value):(Ki=pi.value,Ki instanceof Zt?Ki:new Zt(function(er){er(Ki)})).then(qt,De)}Hr((ee=ee.apply(dt,Nt||[])).next())})},j.prototype.decodeArrayStream=function(B){return this.decodeMultiAsync(B,!0)},j.prototype.decodeStream=function(B){return this.decodeMultiAsync(B,!1)},j.prototype.decodeMultiAsync=function(B,V){return y(this,arguments,function(){var J,q,mt,dt,Nt,Zt,ee,St,Bt;return It(this,function(qt){switch(qt.label){case 0:J=V,q=-1,qt.label=1;case 1:qt.trys.push([1,13,14,19]),mt=Mt(B),qt.label=2;case 2:return[4,tt(mt.next())];case 3:if((dt=qt.sent()).done)return[3,12];if(Nt=dt.value,V&&q===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(Nt),J&&(q=this.readArraySize(),J=!1,this.complete()),qt.label=4;case 4:qt.trys.push([4,9,,10]),qt.label=5;case 5:return[4,tt(this.doDecodeSync())];case 6:return[4,qt.sent()];case 7:return qt.sent(),--q==0?[3,8]:[3,5];case 8:return[3,10];case 9:if(!((Zt=qt.sent())instanceof et))throw Zt;return[3,10];case 10:this.totalPos+=this.pos,qt.label=11;case 11:return[3,2];case 12:return[3,19];case 13:return ee=qt.sent(),St={error:ee},[3,19];case 14:return qt.trys.push([14,,17,18]),dt&&!dt.done&&(Bt=mt.return)?[4,tt(Bt.call(mt))]:[3,16];case 15:qt.sent(),qt.label=16;case 16:return[3,18];case 17:if(St)throw St.error;return[7];case 18:return[7];case 19:return[2]}})})},j.prototype.doDecodeSync=function(){t:for(;;){var B=this.readHeadByte(),V=void 0;if(B>=224)V=B-256;else if(B<192)if(B<128)V=B;else if(B<144){if((q=B-128)!=0){this.pushMapState(q),this.complete();continue t}V={}}else if(B<160){if((q=B-144)!=0){this.pushArrayState(q),this.complete();continue t}V=[]}else{var J=B-160;V=this.decodeUtf8String(J,0)}else if(B===192)V=null;else if(B===194)V=!1;else if(B===195)V=!0;else if(B===202)V=this.readF32();else if(B===203)V=this.readF64();else if(B===204)V=this.readU8();else if(B===205)V=this.readU16();else if(B===206)V=this.readU32();else if(B===207)V=this.readU64();else if(B===208)V=this.readI8();else if(B===209)V=this.readI16();else if(B===210)V=this.readI32();else if(B===211)V=this.readI64();else if(B===217)J=this.lookU8(),V=this.decodeUtf8String(J,1);else if(B===218)J=this.lookU16(),V=this.decodeUtf8String(J,2);else if(B===219)J=this.lookU32(),V=this.decodeUtf8String(J,4);else if(B===220){if((q=this.readU16())!==0){this.pushArrayState(q),this.complete();continue t}V=[]}else if(B===221){if((q=this.readU32())!==0){this.pushArrayState(q),this.complete();continue t}V=[]}else if(B===222){if((q=this.readU16())!==0){this.pushMapState(q),this.complete();continue t}V={}}else if(B===223){if((q=this.readU32())!==0){this.pushMapState(q),this.complete();continue t}V={}}else if(B===196){var q=this.lookU8();V=this.decodeBinary(q,1)}else if(B===197)q=this.lookU16(),V=this.decodeBinary(q,2);else if(B===198)q=this.lookU32(),V=this.decodeBinary(q,4);else if(B===212)V=this.decodeExtension(1,0);else if(B===213)V=this.decodeExtension(2,0);else if(B===214)V=this.decodeExtension(4,0);else if(B===215)V=this.decodeExtension(8,0);else if(B===216)V=this.decodeExtension(16,0);else if(B===199)q=this.lookU8(),V=this.decodeExtension(q,1);else if(B===200)q=this.lookU16(),V=this.decodeExtension(q,2);else{if(B!==201)throw new rt("Unrecognized type byte: "+nt(B));q=this.lookU32(),V=this.decodeExtension(q,4)}this.complete();for(var mt=this.stack;mt.length>0;){var dt=mt[mt.length-1];if(dt.type===0){if(dt.array[dt.position]=V,dt.position++,dt.position!==dt.size)continue t;mt.pop(),V=dt.array}else{if(dt.type===1){if((Nt=typeof V)!="string"&&Nt!=="number")throw new rt("The type of key must be string or number but "+typeof V);if(V==="__proto__")throw new rt("The key __proto__ is not allowed");dt.key=V,dt.type=2;continue t}if(dt.map[dt.key]=V,dt.readCount++,dt.readCount!==dt.size){dt.key=null,dt.type=1;continue t}mt.pop(),V=dt.map}}return V}var Nt},j.prototype.readHeadByte=function(){return this.headByte===-1&&(this.headByte=this.readU8()),this.headByte},j.prototype.complete=function(){this.headByte=-1},j.prototype.readArraySize=function(){var B=this.readHeadByte();switch(B){case 220:return this.readU16();case 221:return this.readU32();default:if(B<160)return B-144;throw new rt("Unrecognized array type byte: "+nt(B))}},j.prototype.pushMapState=function(B){if(B>this.maxMapLength)throw new rt("Max length exceeded: map length ("+B+") > maxMapLengthLength ("+this.maxMapLength+")");this.stack.push({type:1,size:B,key:null,readCount:0,map:{}})},j.prototype.pushArrayState=function(B){if(B>this.maxArrayLength)throw new rt("Max length exceeded: array length ("+B+") > maxArrayLength ("+this.maxArrayLength+")");this.stack.push({type:0,size:B,array:new Array(B),position:0})},j.prototype.decodeUtf8String=function(B,V){var J;if(B>this.maxStrLength)throw new rt("Max length exceeded: UTF-8 byte length ("+B+") > maxStrLength ("+this.maxStrLength+")");if(this.bytes.byteLength<this.pos+V+B)throw Dt;var q,mt=this.pos+V;return q=this.stateIsMapKey()&&((J=this.keyDecoder)===null||J===void 0?void 0:J.canBeCached(B))?this.keyDecoder.decode(this.bytes,mt,B):B>L?function(dt,Nt,Zt){var ee=dt.subarray(Nt,Nt+Zt);return k.decode(ee)}(this.bytes,mt,B):R(this.bytes,mt,B),this.pos+=V+B,q},j.prototype.stateIsMapKey=function(){return this.stack.length>0&&this.stack[this.stack.length-1].type===1},j.prototype.decodeBinary=function(B,V){if(B>this.maxBinLength)throw new rt("Max length exceeded: bin length ("+B+") > maxBinLength ("+this.maxBinLength+")");if(!this.hasRemaining(B+V))throw Dt;var J=this.pos+V,q=this.bytes.subarray(J,J+B);return this.pos+=V+B,q},j.prototype.decodeExtension=function(B,V){if(B>this.maxExtLength)throw new rt("Max length exceeded: ext length ("+B+") > maxExtLength ("+this.maxExtLength+")");var J=this.view.getInt8(this.pos+V),q=this.decodeBinary(B,V+1);return this.extensionCodec.decode(q,J,this.context)},j.prototype.lookU8=function(){return this.view.getUint8(this.pos)},j.prototype.lookU16=function(){return this.view.getUint16(this.pos)},j.prototype.lookU32=function(){return this.view.getUint32(this.pos)},j.prototype.readU8=function(){var B=this.view.getUint8(this.pos);return this.pos++,B},j.prototype.readI8=function(){var B=this.view.getInt8(this.pos);return this.pos++,B},j.prototype.readU16=function(){var B=this.view.getUint16(this.pos);return this.pos+=2,B},j.prototype.readI16=function(){var B=this.view.getInt16(this.pos);return this.pos+=2,B},j.prototype.readU32=function(){var B=this.view.getUint32(this.pos);return this.pos+=4,B},j.prototype.readI32=function(){var B=this.view.getInt32(this.pos);return this.pos+=4,B},j.prototype.readU64=function(){var B,V,J=(B=this.view,V=this.pos,4294967296*B.getUint32(V)+B.getUint32(V+4));return this.pos+=8,J},j.prototype.readI64=function(){var B=d(this.view,this.pos);return this.pos+=8,B},j.prototype.readF32=function(){var B=this.view.getFloat32(this.pos);return this.pos+=4,B},j.prototype.readF64=function(){var B=this.view.getFloat64(this.pos);return this.pos+=8,B},j}(),ke={};function Rn(j,B){return B===void 0&&(B=ke),new ir(B.extensionCodec,B.context,B.maxStrLength,B.maxBinLength,B.maxArrayLength,B.maxMapLength,B.maxExtLength).decode(j)}function wo(j,B){return B===void 0&&(B=ke),new ir(B.extensionCodec,B.context,B.maxStrLength,B.maxBinLength,B.maxArrayLength,B.maxMapLength,B.maxExtLength).decodeMulti(j)}var zn=function(j,B){var V,J,q,mt,dt={label:0,sent:function(){if(1&q[0])throw q[1];return q[1]},trys:[],ops:[]};return mt={next:Nt(0),throw:Nt(1),return:Nt(2)},typeof Symbol=="function"&&(mt[Symbol.iterator]=function(){return this}),mt;function Nt(Zt){return function(ee){return function(St){if(V)throw new TypeError("Generator is already executing.");for(;dt;)try{if(V=1,J&&(q=2&St[0]?J.return:St[0]?J.throw||((q=J.return)&&q.call(J),0):J.next)&&!(q=q.call(J,St[1])).done)return q;switch(J=0,q&&(St=[2&St[0],q.value]),St[0]){case 0:case 1:q=St;break;case 4:return dt.label++,{value:St[1],done:!1};case 5:dt.label++,J=St[1],St=[0];continue;case 7:St=dt.ops.pop(),dt.trys.pop();continue;default:if(!((q=(q=dt.trys).length>0&&q[q.length-1])||St[0]!==6&&St[0]!==2)){dt=0;continue}if(St[0]===3&&(!q||St[1]>q[0]&&St[1]<q[3])){dt.label=St[1];break}if(St[0]===6&&dt.label<q[1]){dt.label=q[1],q=St;break}if(q&&dt.label<q[2]){dt.label=q[2],dt.ops.push(St);break}q[2]&&dt.ops.pop(),dt.trys.pop();continue}St=B.call(j,dt)}catch(Bt){St=[6,Bt],J=0}finally{V=q=0}if(5&St[0])throw St[1];return{value:St[0]?St[1]:void 0,done:!0}}([Zt,ee])}}},rn=function(j){return this instanceof rn?(this.v=j,this):new rn(j)},ka=function(j,B,V){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var J,q=V.apply(j,B||[]),mt=[];return J={},dt("next"),dt("throw"),dt("return"),J[Symbol.asyncIterator]=function(){return this},J;function dt(Bt){q[Bt]&&(J[Bt]=function(qt){return new Promise(function(De,Hr){mt.push([Bt,qt,De,Hr])>1||Nt(Bt,qt)})})}function Nt(Bt,qt){try{(De=q[Bt](qt)).value instanceof rn?Promise.resolve(De.value.v).then(Zt,ee):St(mt[0][2],De)}catch(Hr){St(mt[0][3],Hr)}var De}function Zt(Bt){Nt("next",Bt)}function ee(Bt){Nt("throw",Bt)}function St(Bt,qt){Bt(qt),mt.shift(),mt.length&&Nt(mt[0][0],mt[0][1])}};function Is(j){if(j==null)throw new Error("Assertion Failure: value must not be null nor undefined")}function br(j){return j[Symbol.asyncIterator]!=null?j:function(B){return ka(this,arguments,function(){var V,J,q,mt;return zn(this,function(dt){switch(dt.label){case 0:V=B.getReader(),dt.label=1;case 1:dt.trys.push([1,,9,10]),dt.label=2;case 2:return[4,rn(V.read())];case 3:return J=dt.sent(),q=J.done,mt=J.value,q?[4,rn(void 0)]:[3,5];case 4:return[2,dt.sent()];case 5:return Is(mt),[4,rn(mt)];case 6:return[4,dt.sent()];case 7:return dt.sent(),[3,2];case 8:return[3,10];case 9:return V.releaseLock(),[7];case 10:return[2]}})})}(j)}function mr(j,B){return B===void 0&&(B=ke),V=this,J=void 0,mt=function(){var dt;return function(Nt,Zt){var ee,St,Bt,qt,De={label:0,sent:function(){if(1&Bt[0])throw Bt[1];return Bt[1]},trys:[],ops:[]};return qt={next:Hr(0),throw:Hr(1),return:Hr(2)},typeof Symbol=="function"&&(qt[Symbol.iterator]=function(){return this}),qt;function Hr(pi){return function(Ki){return function(er){if(ee)throw new TypeError("Generator is already executing.");for(;De;)try{if(ee=1,St&&(Bt=2&er[0]?St.return:er[0]?St.throw||((Bt=St.return)&&Bt.call(St),0):St.next)&&!(Bt=Bt.call(St,er[1])).done)return Bt;switch(St=0,Bt&&(er=[2&er[0],Bt.value]),er[0]){case 0:case 1:Bt=er;break;case 4:return De.label++,{value:er[1],done:!1};case 5:De.label++,St=er[1],er=[0];continue;case 7:er=De.ops.pop(),De.trys.pop();continue;default:if(!((Bt=(Bt=De.trys).length>0&&Bt[Bt.length-1])||er[0]!==6&&er[0]!==2)){De=0;continue}if(er[0]===3&&(!Bt||er[1]>Bt[0]&&er[1]<Bt[3])){De.label=er[1];break}if(er[0]===6&&De.label<Bt[1]){De.label=Bt[1],Bt=er;break}if(Bt&&De.label<Bt[2]){De.label=Bt[2],De.ops.push(er);break}Bt[2]&&De.ops.pop(),De.trys.pop();continue}er=Zt.call(Nt,De)}catch(lo){er=[6,lo],St=0}finally{ee=Bt=0}if(5&er[0])throw er[1];return{value:er[0]?er[1]:void 0,done:!0}}([pi,Ki])}}}(this,function(Nt){return dt=br(j),[2,new ir(B.extensionCodec,B.context,B.maxStrLength,B.maxBinLength,B.maxArrayLength,B.maxMapLength,B.maxExtLength).decodeAsync(dt)]})},new((q=void 0)||(q=Promise))(function(dt,Nt){function Zt(Bt){try{St(mt.next(Bt))}catch(qt){Nt(qt)}}function ee(Bt){try{St(mt.throw(Bt))}catch(qt){Nt(qt)}}function St(Bt){var qt;Bt.done?dt(Bt.value):(qt=Bt.value,qt instanceof q?qt:new q(function(De){De(qt)})).then(Zt,ee)}St((mt=mt.apply(V,J||[])).next())});var V,J,q,mt}function Xn(j,B){B===void 0&&(B=ke);var V=br(j);return new ir(B.extensionCodec,B.context,B.maxStrLength,B.maxBinLength,B.maxArrayLength,B.maxMapLength,B.maxExtLength).decodeArrayStream(V)}function bo(j,B){B===void 0&&(B=ke);var V=br(j);return new ir(B.extensionCodec,B.context,B.maxStrLength,B.maxBinLength,B.maxArrayLength,B.maxMapLength,B.maxExtLength).decodeStream(V)}function Cs(j,B){return B===void 0&&(B=ke),bo(j,B)}return o}()}),Ub=Math.min;jt({target:"Array",proto:!0},{copyWithin:[].copyWithin||function(t,e){var n=ce(this),o=Xr(n.length),c=Di(t,o),u=Di(e,o),d=arguments.length>2?arguments[2]:void 0,p=Ub((d===void 0?o:Di(d,o))-u,o-c),f=1;for(u<c&&c<u+p&&(f=-1,u+=p-1,c+=p-1);p-- >0;)u in n?n[c]=n[u]:delete n[c],c+=f,u+=f;return n}});var Qb=vr("Array").copyWithin,OC=Array.prototype,Fb=function(t){var e=t.copyWithin;return t===OC||t instanceof Array&&e===OC.copyWithin?Qb:e},Vb=_o.every;jt({target:"Array",proto:!0,forced:pa("every")},{every:function(t){return Vb(this,t,arguments.length>1?arguments[1]:void 0)}});var Gb=vr("Array").every,kC=Array.prototype,jb=function(t){var e=t.every;return t===kC||t instanceof Array&&e===kC.every?Gb:e},kd=Mu.getWeakData,Kb=Lr.set,Hb=Lr.getterFor,Wb=_o.find,Yb=_o.findIndex,qb=0,Dd=function(t){return t.frozen||(t.frozen=new DC)},DC=function(){this.entries=[]},of=function(t,e){return Wb(t.entries,function(n){return n[0]===e})};DC.prototype={get:function(t){var e=of(this,t);if(e)return e[1]},has:function(t){return!!of(this,t)},set:function(t,e){var n=of(this,t);n?n[1]=e:this.entries.push([t,e])},delete:function(t){var e=Yb(this.entries,function(n){return n[0]===t});return~e&&this.entries.splice(e,1),!!~e}};var BC={getConstructor:function(t,e,n,o){var c=t(function(p,f){$a(p,c,e),Kb(p,{type:e,id:qb++,frozen:void 0}),f!=null&&Us(f,p[o],p,n)}),u=Hb(e),d=function(p,f,g){var E=u(p),I=kd(ar(f),!0);return I===!0?Dd(E).set(f,g):I[E.id]=g,p};return Aa(c.prototype,{delete:function(p){var f=u(this);if(!K(p))return!1;var g=kd(p);return g===!0?Dd(f).delete(p):g&&ft(g,f.id)&&delete g[f.id]},has:function(p){var f=u(this);if(!K(p))return!1;var g=kd(p);return g===!0?Dd(f).has(p):g&&ft(g,f.id)}}),Aa(c.prototype,n?{get:function(p){var f=u(this);if(K(p)){var g=kd(p);return g===!0?Dd(f).get(p):g?g[f.id]:void 0}},set:function(p,f){return d(this,p,f)}}:{add:function(p){return d(this,p,!0)}}),c}};a(function(t){var e,n=Lr.enforce,o=!h.ActiveXObject&&"ActiveXObject"in h,c=Object.isExtensible,u=function(_){return function(){return _(this,arguments.length?arguments[0]:void 0)}},d=t.exports=uE("WeakMap",u,BC);if(Fm&&o){e=BC.getConstructor(u,"WeakMap",!0),Mu.REQUIRED=!0;var p=d.prototype,f=p.delete,g=p.has,E=p.get,I=p.set;Aa(p,{delete:function(_){if(K(_)&&!c(_)){var T=n(this);return T.frozen||(T.frozen=new e),f.call(this,_)||T.frozen.delete(_)}return f.call(this,_)},has:function(_){if(K(_)&&!c(_)){var T=n(this);return T.frozen||(T.frozen=new e),g.call(this,_)||T.frozen.has(_)}return g.call(this,_)},get:function(_){if(K(_)&&!c(_)){var T=n(this);return T.frozen||(T.frozen=new e),g.call(this,_)?E.call(this,_):T.frozen.get(_)}return E.call(this,_)},set:function(_,T){if(K(_)&&!c(_)){var R=n(this);R.frozen||(R.frozen=new e),g.call(this,_)?I.call(this,_,T):R.frozen.set(_,T)}else I.call(this,_,T);return this}})}}),le.WeakMap;var Jb=Math.min,sf=[].lastIndexOf,LC=!!sf&&1/[1].lastIndexOf(1,-0)<0,zb=pa("lastIndexOf"),MC=LC||zb?function(t){if(LC)return sf.apply(this,arguments)||0;var e=X(this),n=Xr(e.length),o=n-1;for(arguments.length>1&&(o=Jb(o,ki(arguments[1]))),o<0&&(o=n+o);o>=0;o--)if(o in e&&e[o]===t)return o||0;return-1}:sf;jt({target:"Array",proto:!0,forced:MC!==[].lastIndexOf},{lastIndexOf:MC});var Xb=vr("Array").lastIndexOf,PC=Array.prototype,Zb=function(t){var e=t.lastIndexOf;return t===PC||t instanceof Array&&e===PC.lastIndexOf?Xb:e};const $b=()=>function(t){var e;const n=ht(e=window.atob(t).split("")).call(e,o=>o.charCodeAt(0));return new Uint8Array(n,0,n.length/Uint8Array.BYTES_PER_ELEMENT)}("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AAA2AkAgACgCKCABKAJMQQIgACgCIBEAACECIAFBADYCwC0gASACNgJEIAFBgAg2ApwtIAEgACgCKEGACEEEIAAoAiARAAAiAjYCCCABIAEoApwtIgNBAnQ2AgwCQAJAIAEoAjhFDQAgASgCQEUNACACRQ0AIAEoAkQNAQsgAUGaBTYCBCAAQbjfACgCADYCGCAAEAgPCyABQQA2AogBIAFBCTYChAEgAUEIOgAkIAEgAiADQQNsajYCmC0gASACIANBfnFqNgKkLSAAEAkNACAAKAIcIgAgACgCLEEBdDYCPCAAKAJEIgEgACgCTEEBdEECayIDakEAOwEAIAEgAxAgIABBADYCtC0gAEKAgICAIDcCdCAAQgA3AmggAEKAgICAIDcCXCAAQQA2AkggACAAKAKEAUEMbCIBQYTIAGovAQA2ApABIAAgAUGAyABqLwEANgKMASAAIAFBgsgAai8BADYCgAEgACABQYbIAGovAQA2AnwLC6kCAQN/AkAgAEUNACAAKAIgRQ0AIAAoAiQiA0UNACAAKAIcIgFFDQAgASgCACAARw0AAkACQCABKAIEIgJBOWsOOQECAgICAgICAgICAgECAgIBAgICAgICAgICAgICAgICAgIBAgICAgICAgICAgIBAgICAgICAgICAQALIAJBmgVGDQAgAkEqRw0BCwJ/An8CfyABKAIIIgIEQCAAKAIoIAIgAxECACAAKAIcIQELIAEoAkQiAgsEQCAAKAIoIAIgACgCJBECACAAKAIcIQELIAEoAkAiAgsEQCAAKAIoIAIgACgCJBECACAAKAIcIQELIAEoAjgiAgsEQCAAKAIoIAIgACgCJBECACAAKAIcIQELIAAoAiggASAAKAIkEQIAIABBADYCHAsLlgIBA39BfiECAkAgAEUNACAAKAIgRQ0AIAAoAiRFDQAgACgCHCIBRQ0AIAEoAgAgAEcNAAJAAkAgASgCBCIDQTlrDjkBAgICAgICAgICAgIBAgICAQICAgICAgICAgICAgICAgICAQICAgICAgICAgICAQICAgICAgICAgEACyADQZoFRg0AIANBKkcNAQsgAEECNgIsIABBADYCCCAAQgA3AhQgAUEANgIUIAEgASgCCDYCECABKAIYIgJBf0wEQCABQQAgAmsiAjYCGAsgAUE5QSpB8QAgAhsgAkECRhs2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KAIIaiACQR9wIAJyQR9zOgAAIAEoAmwEQCAAKAIwIQIgASABKAIUIgNBAWo2AhQgAyABKAIIaiACQRh2OgAAIAEgASgCFCIDQQFqNgIUIAMgASgCCGogAkEQdjoAACAAKAIwIQIgASABKAIUIgNBAWo2AhQgAyABKAIIaiACQQh2OgAAIAEgASgCFCIDQQFqNgIUIAMgASgCCGogAjoAAAsgAEEAQQBBABAENgIwIAFB8QA2AgQgACgCHCICEBMCQCAAKAIQIgMgAigCFCIEIAMgBEkbIgNFDQAgACgCDCACKAIQIAMQHxogACAAKAIMIANqNgIMIAIgAigCECADajYCECAAIAAoAhQgA2o2AhQgACAAKAIQIANrNgIQIAIgAigCFCADayIDNgIUIAMNACACIAIoAgg2AhALIAEoAhQNBCABKAIEIQMLAkACQAJAAkACQAJAAkAgA0E5RgR/IABBAEEAQQAQBjYCMCABIAEoAhQiAkEBajYCFCACIAEoAghqQR86AAAgASABKAIUIgJBAWo2AhQgAiABKAIIakGLAToAACABIAEoAhQiAkEBajYCFCACIAEoAghqQQg6AAAgASgCHCICDQIgASABKAIUIgJBAWo2AhQgAiABKAIIakEAOgAAIAEgASgCFCICQQFqNgIUIAIgASgCCGpBADoAACABIAEoAhQiAkEBajYCFCACIAEoAghqQQA6AAAgASABKAIUIgJBAWo2AhQgAiABKAIIakEAOgAAIAEgASgCFCICQQFqNgIUIAIgASgCCGpBADoAAEECIQIgASgChAEiA0EJRwRAQQQgASgCiAFBAUpBAnQgA0ECSBshAgsgASABKAIUIgNBAWo2AhQgAyABKAIIaiACOgAAIAEgASgCFCICQQFqNgIUIAIgASgCCGpBAzoAACABQfEANgIEIAAoAhwiAhATAkAgACgCECIDIAIoAhQiBCADIARJGyIDRQ0AIAAoAgwgAigCECADEB8aIAAgACgCDCADajYCDCACIAIoAhAgA2o2AhAgACAAKAIUIANqNgIUIAAgACgCECADazYCECACIAIoAhQgA2siAzYCFCADDQAgAiACKAIINgIQCyABKAIUDQEgASgCBAUgAwtBxQBrDiMCBgYGAwYGBgYGBgYGBgYGBgYGBgYGBAYGBgYGBgYGBgYGBQYLIAFBfzYCKA8LIAIoAiQhAyACKAIcIQQgAigCECEFIAIoAiwhBiACKAIAIQggASABKAIUIgdBAWo2AhRBAiECIAcgASgCCGogBkEAR0EBdCAIQQBHciAFQQBHQQJ0ciAEQQBHQQN0ciADQQBHQQR0cjoAACABKAIcKAIEIQMgASABKAIUIgRBAWo2AhQgBCABKAIIaiADOgAAIAEoAhwoAgQhAyABIAEoAhQiBEEBajYCFCAEIAEoAghqIANBCHY6AAAgASgCHC8BBiEDIAEgASgCFCIEQQFqNgIUIAQgASgCCGogAzoAACABKAIcLQAHIQMgASABKAIUIgRBAWo2AhQgBCABKAIIaiADOgAAIAEoAoQBIgNBCUcEQEEEIAEoAogBQQFKQQJ0IANBAkgbIQILIAEgASgCFCIDQQFqNgIUIAMgASgCCGogAjoAACABKAIcKAIMIQIgASABKAIUIgNBAWo2AhQgAyABKAIIaiACOgAAIAEoAhwiAigCEAR/IAIoAhQhAiABIAEoAhQiA0EBajYCFCADIAEoAghqIAI6AAAgASgCHCgCFCECIAEgASgCFCIDQQFqNgIUIAMgASgCCGogAkEIdjoAACABKAIcBSACCygCLARAIAAgACgCMCABKAIIIAEoAhQQBjYCMAsgAUHFADYCBCABQQA2AiALIAEoAhwiBCgCECIDBEAgASgCFCICIAQvARQgASgCICIGayIFaiABKAIMIgRLBEADQCABKAIIIAJqIAMgBmogBCACayIEEB8aIAEgASgCDCIDNgIUAkAgAiADTw0AIAEoAhwoAixFDQAgACAAKAIwIAEoAgggAmogAyACaxAGNgIwCyABIAEoAiAgBGo2AiAgACgCHCICEBMCQCAAKAIQIgMgAigCFCIGIAMgBkkbIgNFDQAgACgCDCACKAIQIAMQHxogACAAKAIMIANqNgIMIAIgAigCECADajYCECAAIAAoAhQgA2o2AhQgACAAKAIQIANrNgIQIAIgAigCFCADayIDNgIUIAMNACACIAIoAgg2AhALIAEoAhQEQCABQX82AigPCyABKAIgIQYgASgCHCgCECEDQQAhAiAFIARrIgUgASgCDCIESw0ACwsgASgCCCACaiADIAZqIAUQHxogASABKAIUIAVqIgM2AhQCQCACIANPDQAgASgCHCgCLEUNACAAIAAoAjAgASgCCCACaiADIAJrEAY2AjALIAFBADYCIAsgAUHJADYCBAsgASgCHCgCHARAIAEoAhQiAiEFA0ACQCACIAEoAgxHDQACQCACIAVNDQAgASgCHCgCLEUNACAAIAAoAjAgASgCCCAFaiACIAVrEAY2AjALIAAoAhwiAhATAkAgACgCECIDIAIoAhQiBCADIARJGyIDRQ0AIAAoAgwgAigCECADEB8aIAAgACgCDCADajYCDCACIAIoAhAgA2o2AhAgACAAKAIUIANqNgIUIAAgACgCECADazYCECACIAIoAhQgA2siAzYCFCADDQAgAiACKAIINgIQC0EAIQJBACEFIAEoAhRFDQAgAUF/NgIoDwsgASgCHCgCHCEDIAEgASgCICIEQQFqNgIgIAMgBGotAAAhAyABIAJBAWo2AhQgASgCCCACaiADOgAAIAMEQCABKAIUIQIMAQsLAkAgASgCHCgCLEUNACABKAIUIgIgBU0NACAAIAAoAjAgASgCCCAFaiACIAVrEAY2AjALIAFBADYCIAsgAUHbADYCBAsCQCABKAIcKAIkRQ0AIAEoAhQiAiEFA0ACQCACIAEoAgxHDQACQCACIAVNDQAgASgCHCgCLEUNACAAIAAoAjAgASgCCCAFaiACIAVrEAY2AjALIAAoAhwiAhATAkAgACgCECIDIAIoAhQiBCADIARJGyIDRQ0AIAAoAgwgAigCECADEB8aIAAgACgCDCADajYCDCACIAIoAhAgA2o2AhAgACAAKAIUIANqNgIUIAAgACgCECADazYCECACIAIoAhQgA2siAzYCFCADDQAgAiACKAIINgIQC0EAIQJBACEFIAEoAhRFDQAgAUF/NgIoDwsgASgCHCgCJCEDIAEgASgCICIEQQFqNgIgIAMgBGotAAAhAyABIAJBAWo2AhQgASgCCCACaiADOgAAIAMEQCABKAIUIQIMAQsLIAEoAhwoAixFDQAgASgCFCICIAVNDQAgACAAKAIwIAEoAgggBWogAiAFaxAGNgIwCyABQecANgIECyABKAIcKAIsBEAgASgCDCABKAIUIgJBAmpJBEAgACgCHCICEBMCQCAAKAIQIgMgAigCFCIEIAMgBEkbIgNFDQAgACgCDCACKAIQIAMQHxogACAAKAIMIANqNgIMIAIgAigCECADajYCECAAIAAoAhQgA2o2AhQgACAAKAIQIANrNgIQIAIgAigCFCADayIDNgIUIAMNACACIAIoAgg2AhALIAEoAhQNBUEAIQILIAAoAjAhAyABIAJBAWo2AhQgASgCCCACaiADOgAAIAAoAjAhAiABIAEoAhQiA0EBajYCFCADIAEoAghqIAJBCHY6AAAgAEEAQQBBABAGNgIwCyABQfEANgIEIAAoAhwiAhATAkAgACgCECIDIAIoAhQiBCADIARJGyIDRQ0AIAAoAgwgAigCECADEB8aIAAgACgCDCADajYCDCACIAIoAhAgA2o2AhAgACAAKAIUIANqNgIUIAAgACgCECADazYCECACIAIoAhQgA2siAzYCFCADDQAgAiACKAIINgIQCyABKAIURQ0AIAFBfzYCKA8LIAAoAgQNAQsgASgCdA0AIAEoAgRBmgVGDQgLIAEoAoQBIgJFBEAgAUEDEAwMBAsCQAJAIAEoAogBQQJrDgIAAQQLA0ACQAJAIAEoAnQNACABEAogASgCdA0AIAFBADYCtC0MAQsgAUEANgJgIAEoAjggASgCbGotAAAhAiABKAKkLSABKAKgLSIDQQF0akEAOwEAIAEgA0EBajYCoC0gAyABKAKYLWogAjoAACABIAJBAnRqQZQBaiICIAIvAQBBAWo7AQAgASABKAJ0QQFrNgJ0IAEgASgCbEEBaiICNgJsIAEoAqAtIAEoApwtQQFrRw0BIAEgASgCXCIEQQBOBH8gASgCOCAEagVBAAsgAiAEa0EAEBQgASABKAJsNgJcIAEoAgAiAigCHCIDEBMCQCACKAIQIgQgAygCFCIFIAQgBUkbIgRFDQAgAigCDCADKAIQIAQQHxogAiACKAIMIARqNgIMIAMgAygCECAEajYCECACIAIoAhQgBGo2AhQgAiACKAIQIARrNgIQIAMgAygCFCAEayICNgIUIAINACADIAMoAgg2AhALIAEoAgAoAhANAQwHCwsgASgCoC1FDQcgASABKAJcIgNBAE4EfyABKAI4IANqBUEACyABKAJsIANrQQAQFCABIAEoAmw2AlwgASgCACICKAIcIgMQEwJAIAIoAhAiBCADKAIUIgUgBCAFSRsiBEUNACACKAIMIAMoAhAgBBAfGiACIAIoAgwgBGo2AgwgAyADKAIQIARqNgIQIAIgAigCFCAEajYCFCACIAIoAhAgBGs2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CAC2AAgAdgAIAPYACAAOAAgAjgAIAE4ACADOAAgALgAIAK4ACABuAAgA7gAIAB4ACACeAAgAXgAIAN4ACAA+AAgAvgAIAH4ACAD+AAgAAQAIAIEACABBAAgAwQAIACEACAChAAgAYQAIAOEACAARAAgAkQAIAFEACADRAAgAMQAIALEACABxAAgA8QAIAAkACACJAAgASQAIAMkACAApAAgAqQAIAGkACADpAAgAGQAIAJkACABZAAgA2QAIADkACAC5AAgAeQAIAPkACAAFAAgAhQAIAEUACADFAAgAJQAIAKUACABlAAgA5QAIABUACACVAAgAVQAIANUACAA1AAgAtQAIAHUACAD1AAgADQAIAI0ACABNAAgAzQAIAC0ACACtAAgAbQAIAO0ACAAdAAgAnQAIAF0ACADdAAgAPQAIAL0ACAB9AAgA/QAIABMACQATAQkAkwAJAJMBCQBTAAkAUwEJANMACQDTAQkAMwAJADMBCQCzAAkAswEJAHMACQBzAQkA8wAJAPMBCQALAAkACwEJAIsACQCLAQkASwAJAEsBCQDLAAkAywEJACsACQArAQkAqwAJAKsBCQBrAAkAawEJAOsACQDrAQkAGwAJABsBCQCbAAkAmwEJAFsACQBbAQkA2wAJANsBCQA7AAkAOwEJALsACQC7AQkAewAJAHsBCQD7AAkA+wEJAAcACQAHAQkAhwAJAIcBCQBHAAkARwEJAMcACQDHAQkAJwAJACcBCQCnAAkApwEJAGcACQBnAQkA5wAJAOcBCQAXAAkAFwEJAJcACQCXAQkAVwAJAFcBCQDXAAkA1wEJADcACQA3AQkAtwAJALcBCQB3AAkAdwEJAPcACQD3AQkADwAJAA8BCQCPAAkAjwEJAE8ACQBPAQkAzwAJAM8BCQAvAAkALwEJAK8ACQCvAQkAbwAJAG8BCQDvAAkA7wEJAB8ACQAfAQkAnwAJAJ8BCQBfAAkAXwEJAN8ACQDfAQkAPwAJAD8BCQC/AAkAvwEJAH8ACQB/AQkA/wAJAP8BCQAAAAcAQAAHACAABwBgAAcAEAAHAFAABwAwAAcAcAAHAAgABwBIAAcAKAAHAGgABwAYAAcAWAAHADgABwB4AAcABAAHAEQABwAkAAcAZAAHABQABwBUAAcANAAHAHQABwADAAgAgwAIAEMACADDAAgAIwAIAKMACABjAAgA4wAIAAAABQAQAAUACAAFABgABQAEAAUAFAAFAAwABQAcAAUAAgAFABIABQAKAAUAGgAFAAYABQAWAAUADgAFAB4ABQABAAUAEQAFAAkABQAZAAUABQAFABUABQANAAUAHQAFAAMABQATAAUACwAFABsABQAHAAUAFwAFAEHg2QALTQEAAAABAAAAAQAAAAEAAAACAAAAAgAAAAIAAAACAAAAAwAAAAMAAAADAAAAAwAAAAQAAAAEAAAABAAAAAQAAAAFAAAABQAAAAUAAAAFAEHQ2gALZQEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAUAAAAGAAAABgAAAAcAAAAHAAAACAAAAAgAAAAJAAAACQAAAAoAAAAKAAAACwAAAAsAAAAMAAAADAAAAA0AAAANAEGA3AALIwIAAAADAAAABwAAAAAAAAAQERIACAcJBgoFCwQMAw0CDgEPAEG03AALaQEAAAACAAAAAwAAAAQAAAAFAAAABgAAAAcAAAAIAAAACgAAAAwAAAAOAAAAEAAAABQAAAAYAAAAHAAAACAAAAAoAAAAMAAAADgAAABAAAAAUAAAAGAAAABwAAAAgAAAAKAAAADAAAAA4ABBtN0AC5oCAQAAAAIAAAADAAAABAAAAAYAAAAIAAAADAAAABAAAAAYAAAAIAAAADAAAABAAAAAYAAAAIAAAADAAAAAAAEAAIABAAAAAgAAAAMAAAAEAAAABgAAAAgAAAAMAAAAEAAAABgAAAAgAAAAMAAAAEAAAABgAABuZWVkIGRpY3Rpb25hcnkAc3RyZWFtIGVuZAAAZmlsZSBlcnJvcgBzdHJlYW0gZXJyb3IAZGF0YSBlcnJvcgBpbnN1ZmZpY2llbnQgbWVtb3J5AGJ1ZmZlciBlcnJvcgBpbmNvbXBhdGlibGUgdmVyc2lvbgAAAAAoLwAAOC8AAEMvAABELwAATy8AAFwvAABnLwAAey8AAIgvAABDLwAAMS4yLjExAEHQ3wALA9AxUA==");let af,gs;async function tN(){var t,e;if(af)return af;const n={};let o,c={};for(o in n)Object.prototype.hasOwnProperty.call(n,o)&&(c[o]=n[o]);let u=!1,d=!1;u=typeof window=="object",d=typeof importScripts=="function",typeof process=="object"&&typeof process.versions=="object"&&process.versions.node;let p="";(u||d)&&(d?p=self.location.href:typeof document!="undefined"&&document.currentScript&&(p=document.currentScript.src),p=Ft(p).call(p,"blob:")!==0?p.substr(0,Zb(p).call(p,"/")+1):""),n.print||vn(t=console.log).call(t,console);const f=n.printErr||vn(e=console.warn).call(e,console);for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(n[o]=c[o]);let g;c=null,n.arguments,n.thisProgram,n.quit,n.wasmBinary,n.noExitRuntime,typeof WebAssembly!="object"&&Ct("no native wasm support detected");let E=!1;function I(It){const Mt=n["_"+It];var tt;return tt="Cannot call unknown function "+It+", make sure it is exported",Mt||Ct("Assertion failed: "+tt),Mt}function _(It,Mt,tt,y,D){const x={string:function(ke){let Rn=0;if(ke!=null&&ke!==0){const wo=1+(ke.length<<2);Rn=nt(wo),function(zn,rn,ka){(function(Is,br,mr,Xn){if(!(Xn>0))return 0;const bo=mr+Xn-1;for(let Cs=0;Cs<Is.length;++Cs){let j=Is.charCodeAt(Cs);if(j>=55296&&j<=57343&&(j=65536+((1023&j)<<10)|1023&Is.charCodeAt(++Cs)),j<=127){if(mr>=bo)break;br[mr++]=j}else if(j<=2047){if(mr+1>=bo)break;br[mr++]=192|j>>6,br[mr++]=128|63&j}else if(j<=65535){if(mr+2>=bo)break;br[mr++]=224|j>>12,br[mr++]=128|j>>6&63,br[mr++]=128|63&j}else{if(mr+3>=bo)break;br[mr++]=240|j>>18,br[mr++]=128|j>>12&63,br[mr++]=128|j>>6&63,br[mr++]=128|63&j}}br[mr]=0})(zn,w,rn,ka)}(ke,Rn,wo)}return Rn},array:function(ke){const Rn=nt(ke.length);var wo,zn;return wo=ke,zn=Rn,R.set(wo,zn),Rn}},et=I(It),Dt=[];let Se=0;if(y)for(let ke=0;ke<y.length;ke++){const Rn=x[tt[ke]];Rn?(Se===0&&(Se=wr()),Dt[ke]=Rn(y[ke])):Dt[ke]=y[ke]}let ir=et.apply(null,Dt);return ir=function(ke){return Mt==="string"?(Rn=ke)?function(zn,rn,ka){const Is=rn+ka;let br=rn,mr="";for(;zn[br]&&!(br>=Is);)++br;if(br-rn>16&&zn.subarray&&T)return T.decode(zn.subarray(rn,br));for(;rn<br;){let Xn=zn[rn++];if(!(128&Xn)){mr+=String.fromCharCode(Xn);continue}const bo=63&zn[rn++];if((224&Xn)==192){mr+=String.fromCharCode((31&Xn)<<6|bo);continue}const Cs=63&zn[rn++];if(Xn=(240&Xn)==224?(15&Xn)<<12|bo<<6|Cs:(7&Xn)<<18|bo<<12|Cs<<6|63&zn[rn++],Xn<65536)mr+=String.fromCharCode(Xn);else{const j=Xn-65536;mr+=String.fromCharCode(55296|j>>10,56320|1023&j)}}return mr}(w,Rn,wo):"":Mt==="boolean"?Boolean(ke):ke;var Rn,wo}(ir),Se!==0&&z(Se),ir}const T=typeof TextDecoder!="undefined"?new TextDecoder("utf8"):void 0;let R,w,k;typeof TextDecoder!="undefined"&&new TextDecoder("utf-16le"),n.INITIAL_MEMORY;const L=[],Y=[],Z=[],rt=[];Y.push({func:function(){ae()}});let ut=0,At=null;function Ct(It){throw n.onAbort&&n.onAbort(It),f(It+=""),E=!0,It="abort("+It+"). Build with -s ASSERTIONS=1 for more info.",new WebAssembly.RuntimeError(It)}n.preloadedImages={},n.preloadedAudios={};let lt="deflate.wasm";var Gt,wt;function Qt(It){for(;It.length>0;){const Mt=It.shift();if(typeof Mt=="function"){Mt(n);continue}const tt=Mt.func;typeof tt=="number"?Mt.arg===void 0?k.get(tt)():k.get(tt)(Mt.arg):tt(Mt.arg===void 0?null:Mt.arg)}}wt="data:application/octet-stream;base64,",hl(Gt=lt).call(Gt,wt)||(lt=function(It){return n.locateFile?n.locateFile(It,p):p+It}(lt));const xt={emscripten_memcpy_big:function(It,Mt,tt){Fb(w).call(w,It,Mt,Mt+tt)},emscripten_resize_heap:function(It){Ct("OOM")}};await async function(){const It={env:xt,wasi_snapshot_preview1:xt};function Mt(D,x){const et=D.exports;var Dt;n.asm=et,g=n.asm.memory,Dt=g.buffer,n.HEAP8=R=new Int8Array(Dt),n.HEAP16=new Int16Array(Dt),n.HEAP32=new Int32Array(Dt),n.HEAPU8=w=new Uint8Array(Dt),n.HEAPU16=new Uint16Array(Dt),n.HEAPU32=new Uint32Array(Dt),n.HEAPF32=new Float32Array(Dt),n.HEAPF64=new Float64Array(Dt),k=n.asm.__indirect_function_table,function(Se){if(ut--,n.monitorRunDependencies&&n.monitorRunDependencies(ut),ut==0&&At){const ir=At;At=null,ir()}}()}function tt(D){Mt(D.instance)}function y(D){return new ct((x,et)=>{x($b().buffer)}).then(function(x){return WebAssembly.instantiate(x,It)}).then(D,function(x){f("failed to asynchronously prepare wasm: "+x),Ct(x)})}if(ut++,n.monitorRunDependencies&&n.monitorRunDependencies(ut),n.instantiateWasm)try{return n.instantiateWasm(It,Mt)}catch(D){return f("Module.instantiateWasm callback failed with error: "+D),!1}return await y(tt),{}}();let ae=n.___wasm_call_ctors=function(){return(ae=n.___wasm_call_ctors=n.asm.__wasm_call_ctors).apply(null,arguments)},ge=n._malloc=function(){return(ge=n._malloc=n.asm.malloc).apply(null,arguments)};n._free=function(){return(n._free=n.asm.free).apply(null,arguments)},n.___errno_location=function(){return(n.___errno_location=n.asm.__errno_location).apply(null,arguments)},n._zlibCompress=function(){return(n._zlibCompress=n.asm.zlibCompress).apply(null,arguments)};let re,wr=n.stackSave=function(){return(wr=n.stackSave=n.asm.stackSave).apply(null,arguments)},z=n.stackRestore=function(){return(z=n.stackRestore=n.asm.stackRestore).apply(null,arguments)},nt=n.stackAlloc=function(){return(nt=n.stackAlloc=n.asm.stackAlloc).apply(null,arguments)};function gt(It){function Mt(){re||(re=!0,n.calledRun=!0,E||(Qt(Y),Qt(Z),n.onRuntimeInitialized&&n.onRuntimeInitialized(),function(){if(n.postRun)for(typeof n.postRun=="function"&&(n.postRun=[n.postRun]);n.postRun.length;)tt=n.postRun.shift(),rt.unshift(tt);var tt;Qt(rt)}()))}ut>0||(function(){if(n.preRun)for(typeof n.preRun=="function"&&(n.preRun=[n.preRun]);n.preRun.length;)tt=n.preRun.shift(),L.unshift(tt);var tt;Qt(L)}(),ut>0||(n.setStatus?(n.setStatus("Running..."),Vr(function(){Vr(function(){n.setStatus("")},1),Mt()},1)):Mt()))}if(n.ccall=_,n.cwrap=function(It,Mt,tt,y){const D=jb(tt=tt||[]).call(tt,function(x){return x==="number"});return Mt!=="string"&&D&&!y?I(It):function(){return _(It,Mt,tt,arguments)}},n.allocate=function(It,Mt){let tt;return tt=Mt==1?nt(It.length):ge(It.length),It.subarray||Mr(It)?w.set(It,tt):w.set(new Uint8Array(It),tt),tt},At=function It(){re||gt(),re||(At=It)},n.run=gt,n.preInit)for(typeof n.preInit=="function"&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.pop()();return gt(),af=n,n}const xC=Uint8Array.BYTES_PER_ELEMENT,eN={bytesReceived:"br",frameDropped:"fd",frameReceived:"fr",googJitterReceived:"jr",isAudioMute:"am",isFreeze:"fz",mediaType:"mt",packetsLost:"pl",packetsReceived:"pr",peerId:"pid",id:"id",ssrc:"ssrc",timestamp:"ts",type:"tp",frameRateInput:"fi",frameRateSent:"fs",googRtt:"rt",isVideoMute:"vm"},rN={stats:"sts",state:"st",stream_id:"stid",session_id:"seid",stream_type:"stt",app_id:"aid",channel_key:"ck",channel_name:"cn",sdk_version:"sv",browser:"b",process_id:"pcid",mode:"m",codec:"c",role:"r",has_changed_gateway:"hcg",ap_response:"ar",extends:"es",details:"d",features:"ft",p2p_id:"ppid",sdp:"sdp",audio:"a",video:"v",attributes:"at",hq:"h",lq:"l",stereo:"str",speech:"spe",extend:"e",pingpongElapse:"ppe"},nN={_message:"m",_type:"t",_id:"id"},iN={join_v2:"j2",publish:"pub",publish_related_stats:"prs",ping:"pi",traffic_stats:"ts",ping_back:"pib",publish_stats:"pubs"};let cf;class oN{constructor(){}async init(){cf||(cf=(await(async()=>(gs||(gs=await tN()),{zlibCompress:n=>{var o;const c=new Uint8Array(n),u=xC*c.byteLength,d=gs._malloc(u),p=gs._malloc(3*u);for(let E=0;E<u;E++)gs.HEAP8[d/xC+E]=c[E];const f=gs._zlibCompress(d,u,p),g=new Uint8Array(Mr(o=gs.HEAP8).call(o,p,p+f));return gs._free(d),gs._free(p),g}}))()).zlibCompress),this.zlibCompress=cf}msgPackCompress(e){return xb.encode(e)}compress(e){const n=kt(),o=this.compressKeyAndValue(JSON.parse(at(e))),c=this.msgPackCompress(o),u=this.zlibCompress(c),d=new Uint8Array([49,49,49,50,...Ue(u)]);return{origin:Ir({},e),originLength:at(e).length,shortKeyAndValue:o,msgpackSer:c,compressed:d,compressedLength:d.length,time:kt()-n}}compressKeyAndValue(e){return this._ObjectKeyCompress(this._typeCompress(e))}_typeCompress(e){const n=e._type;if(!n)return e;const o=iN[n];return e._type=o||n,e}_ObjectKeyCompress(e){const n=e._message;if(n){const o=n.stats;o&&(n.stats=this._statsCompress(o)),e._message=this._messageCompress(n)}return this._reportCompress(e)}_statsCompress(e){return this._keyCompress(e,eN)}_messageCompress(e){return this._keyCompress(e,rN)}_reportCompress(e){return this._keyCompress(e,nN)}_keyCompress(e,n){const o={},c=ue(e);return ol(c).call(c,(u,d)=>{const p=e[d];return n[d]?o[n[d]]=p:o[d]=p,o},o),o}}class sN extends Gr{constructor(e){super(),this.lowPriorityQueue=[],this.highPriorityQueue=[],this.AgoraWebSocketManager=e}get queue(){return[...this.highPriorityQueue,...this.lowPriorityQueue]}reset(){this.lowPriorityQueue=[],this.highPriorityQueue=[]}pushMessage(e,n=!1){n?this.highPriorityQueue.push(e):this.lowPriorityQueue.push(e),this.sendMessage()}sendMessage(){const e=this.queue.length;let n=0;n=e<5?15*e:60+3*(e-4),Vr(()=>{this._sendMessage()},n)}_sendMessage(){var e;if(!this.queue.length)return;const n=this.AgoraWebSocketManager.getConnection();if(!n||n.readyState!==1)return;const o=this.queue.shift();return Xt(e=this.lowPriorityQueue).call(e,o)?this.lowPriorityQueue.shift():this.highPriorityQueue.shift(),n.send(o.compressed),o}}var aN=function(t,e,n,o){var c,u=arguments.length,d=u<3?e:o===null?o=zt(e,n):o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(t,e,n,o);else for(var p=t.length-1;p>=0;p--)(c=t[p])&&(d=(u<3?c(d):u>3?c(e,n,d):c(e,n))||d);return u>3&&d&&te(e,n,d),d},cN=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};let Dl=class extends Gr{constructor(t,e,n=!1,o=!1){super(),this.connectionID=0,this.currentURLIndex=0,this.reconnectMode="tryNext",this._initMutex=new Qi("websocket"),this._state="closed",this.reconnectCount=0,this.isCompressorInitSuccess=!1,this.tryDoubleDomain=!1,this.wsInflateLength=0,this.wsDeflateLength=0,this.closeEstablishingWs=()=>{},this.name=t,this.retryConfig=e,this.useCompress=n,this.tryDoubleDomain=o}get url(){return this.websocket?this.websocket.url:null}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(Be.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Be.CONNECTED):this._state==="closed"?this.emit(Be.CLOSED):this._state==="failed"&&this.emit(Be.FAILED))}getConnection(){return this.websocket||void 0}init(t){const e=(n,o)=>{this.urls=t;const c=this.urls[this.currentURLIndex];this.state="connecting",this.messageSender=new sN(this),this.createWebSocketConnection(c).then(n).catch(o),this.once(Be.CLOSED,()=>o(new Q(U.WS_DISCONNECT))),this.once(Be.CONNECTED,()=>n())};return this._initMutex.lock().then(n=>new ct((o,c)=>{this.compressor=new oN,this.compressor.init().then(()=>{var u;N.debug("websocket compressor initialized successfully"),st("debug",this,"compressor",void 0,"success"),it.wsCompressorInit({status:!0,ec:null,eventElapse:1}),this.isCompressorInitSuccess=!0,this.compress=vn(u=this.compressor.compress).call(u,this.compressor),e(o,c)}).catch(u=>{e(o,c),N.debug("websocket compressor failed to initialize"),st("debug",this,"compressor",void 0,"error"),it.wsCompressorInit({status:!1,ec:u?u.message||u.toString():"Empty Error",eventElapse:1})})}).finally(()=>{n()}))}close(t,e){if(this.currentURLIndex=0,this.reconnectCount=0,this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const n=this.websocket;e?Vr(()=>n.close(),500):n.close(),this.websocket=void 0}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,e){if(!this.websocket)return N.warning("[".concat(this.name,"] can not reconnect, no websocket")),void st("warning",this,"reconnect","can not reconnect, no websocket");t!==void 0&&(this.reconnectMode=t),N.debug("[".concat(this.name,"] reconnect is triggered initiative")),st("debug",this,"reconnect");const n=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),n&&vn(n).call(n,this.websocket)({code:9999,reason:e})}sendMessage(t,e=!1){if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Q(U.WS_ABORT,"websocket is not ready");try{let n=null;if(this.isCompressorInitSuccess&&this.useCompress&&ot("WEBSOCKET_COMPRESS"))n=this.compress(t),this.setWsInflateData(n);else{if(this.isCompressorInitSuccess&&this.useCompress){const c=this.compress(t);this.setWsInflateData(c)}const o=at(t);n={compressed:o,compressedLength:o.length,origin:t}}e?this.websocket.send(n.compressed):this.messageSender.pushMessage(n)}catch(n){throw new Q(U.WS_ERR,"send websocket message error"+n.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,e=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:e}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t,e){return this.connectionID+=1,this.connectionID,new ct((n,o)=>{var c,u;const d=()=>{N.debug("[".concat(this.name,"] websocket opened:"),t),ls("debug",["WebSocket",this.connectionID],"open",t),this.reconnectMode="retry",this.state="connected",this.reconnectCount=0,n()},p=async g=>{var E,I,_,T;if(N.debug(M(E=M(I=M(_=M(T="[".concat(this.name,"] websocket close ")).call(T,this.websocket&&this.websocket.url,", code: ")).call(_,g.code,", reason: ")).call(I,g.reason,", current mode: ")).call(E,this.reconnectMode)),ls("debug",["WebSocket",this.connectionID],"close",{code:g.code,reason:g.reason,url:this.websocket&&this.websocket.url,reconnectMode:this.reconnectMode}),this.reconnectCount<this.retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=g.reason,this.state="reconnecting");const R=ya(this,Be.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,w=await this.reconnectWithAction(R);if(this.state==="closed")return N.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect")),void Lt("debug",this,"ws is closed, no need to reconnect");if(!w)return o(new Q(U.WS_DISCONNECT,"websocket reconnect failed: ".concat(g.code))),void this.close(!0);n()}else o(new Q(U.WS_DISCONNECT,"websocket close: ".concat(g.code))),this.close()},f=g=>{this.emit(Be.ON_MESSAGE,g)};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),ot("GATEWAY_WSS_ADDRESS")&&hl(c=this.name).call(c,"gateway")&&(t=ot("GATEWAY_WSS_ADDRESS")),N.debug(M(u="[".concat(this.name,"] start connect, url: ")).call(u,t)),Lt("debug",this,"start connect, url: ".concat(t)),this.chooseBestWebsocketConnection(t,!!e).then(g=>{this.websocket=g,d&&d(),g.onclose=p,g.onmessage=f}).catch(g=>{if(this.state!=="closed"){if(g instanceof Q&&g.code===U.WS_ERR){var E;const I=new Q(U.WS_ERR,"init websocket failed! Error: ".concat(g.toString()));return N.error(M(E="[".concat(this.name,"]")).call(E,I)),st("error",this,"chooseBestWebsocketConnection",void 0,g.toString()),void o(I)}p&&p(g)}else o(new Q(U.WS_DISCONNECT,"websocket is closed: ".concat(g.toString())))})})}async reconnectWithAction(t,e){var n,o;if(!e&&this.reconnectCount>=this.retryConfig.maxRetryCount||!this.urls||this.state==="closed")return!1;this.onlineReconnectListener||tn.networkState!==xi.OFFLINE||(this.onlineReconnectListener=tn.onlineWaiter&&tn.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));const c=Kp(this.reconnectCount,this.retryConfig);if(N.debug(M(n=M(o="[".concat(this.name,"] wait ")).call(o,c,"ms to reconnect websocket, mode: ")).call(n,t)),st("debug",this,"reconnectWithAction",{timeout:c,action:t}),await ct.race([pn(c),this.onlineReconnectListener||new ct(()=>{})]),this.state==="closed")return!1;this.reconnectCount+=1;try{if(t==="retry"){const f=this.urls[this.currentURLIndex];await this.createWebSocketConnection(f)}else if(t==="tryNext"){var u,d,p;if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return await this.reconnectWithAction("recover");N.debug(M(u=M(d="[".concat(this.name,"] websocket url length: ")).call(d,this.urls.length," current index: ")).call(u,this.currentURLIndex)),Lt("debug",this,M(p="websocket url length: ".concat(this.urls.length," current index: ")).call(p,this.currentURLIndex));const f=this.urls[this.currentURLIndex];await this.createWebSocketConnection(f)}else if(t==="recover"){N.debug("[".concat(this.name,"] request new urls")),Lt("debug",this,"request new urls"),this.urls=await ro(this,Be.REQUEST_NEW_URLS),this.currentURLIndex=0;const f=this.urls[this.currentURLIndex];await this.createWebSocketConnection(f)}return!0}catch(f){return N.error("[".concat(this.name,"] reconnect failed"),f.toString()),st("error",this,"reconnectWithAction",void 0,f.toString()),await this.reconnectWithAction(t)}}async chooseBestWebsocketConnection(t,e){return new ct((n,o)=>{let c=!1;const u=[];this.closeEstablishingWs=()=>{N.debug("[choose-best-ws] close establishing websockets"),G(u).call(u,_=>{_.onclose=null,_.onopen=null,_.onmessage=null,_.close()}),o(new Q(U.WS_ABORT,"choose best websocket aborted"))};const d=ot("GATEWAY_DOMAINS");let p;const f=Ft(t).call(t,"?h="),g=yt(d).call(d,_=>f!==-1?Xt(t).call(t,_,f):Xt(t).call(t,_));N.debug("[choose-best-ws] currentDomain: ",g,", domains: ",d),st("debug",this,"chooseBestWebsocketConnection",{currentDomain:g,domains:d});let E=!this.tryDoubleDomain||e||!g;if(!E&&g){try{G(d).call(d,_=>{const T=f===-1?t.replace(g,_):t.substr(0,f)+t.substr(f).replace(g,_),R=new WebSocket(T);R.binaryType="arraybuffer",u.push(R),N.debug("[choose-best-ws] ws is connecting:",R.url),Lt("debug",this,"ws is connecting: ".concat(R.url))})}catch{for(N.debug("[choose-best-ws] ws create failed, fallback to single url"),Lt("debug",this,"ws create failed, fallback to single url"),G(u).call(u,T=>T.close());u.length;)u.pop();E=!0}G(u).call(u,_=>{_.onopen=()=>{var T;c||(G(T=Ot(u).call(u,R=>R!==_)).call(T,R=>{N.debug("[choose-best-ws]close backup websocket: ".concat(R.url)),Lt("debug",this,"close backup websocket: ".concat(R.url)),R.close()}),c=!0,n(_))},_.onclose=T=>{p=T,!c&&(yt(u).call(u,R=>!(R.readyState===WebSocket.CLOSED||R.readyState===WebSocket.CLOSING))||(N.debug("[choose-best-ws] all websocket is closed"),Lt("debug",this,"all websocket is closed"),c=!0,o(p)))},_.onmessage=T=>{var R,w;N.debug(M(R="[choose-best-ws]".concat(_.url," onmessage: ")).call(R,T.data)),Lt("debug",this,M(w="".concat(_.url," onmessage: ")).call(w,T.data))}}),pn(5e3).then(()=>{G(u).call(u,_=>{_.readyState!==WebSocket.OPEN&&_.close()})})}if(E){let _;N.debug("[choose-best-ws] use single url: ",t),Lt("debug",this,"use single url: ".concat(t));try{_=new WebSocket(t),u.push(_),_.binaryType="arraybuffer"}catch(T){var I;const R=new Q(U.WS_ERR,"init websocket failed! Error: ".concat(T.toString()));return N.error(M(I="[".concat(this.name,"]")).call(I,R)),st("error",this,"chooseBestWebsocketConnection",void 0,T.toString()),void o(R)}_.onopen=()=>{n(_)},_.onclose=T=>{o(T)},_.onmessage=T=>{var R,w;N.debug(M(R="[choose-best-ws]".concat(_.url," onmessage: ")).call(R,T.data)),Lt("debug",this,M(w="".concat(_.url," onmessage: ")).call(w,T.data))},pn(5e3).then(()=>{_&&_.readyState!==WebSocket.OPEN&&_.close()})}}).then(n=>(this.closeEstablishingWs=void 0,n)).catch(n=>{throw this.closeEstablishingWs=void 0,n})}};Dl=aN([an("AgoraWebSocketManager","connectionID"),cN("design:paramtypes",[String,Object,Object,Object])],Dl);class lN{constructor(e){this.input=[],this.size=e}add(e){var n;this.input.push(e),this.input.length>this.size&&Ze(n=this.input).call(n,0,1)}mean(){var e;return this.input.length===0?0:ol(e=this.input).call(e,(n,o)=>n+o)/this.input.length}}var uN=function(t,e,n,o){var c,u=arguments.length,d=u<3?e:o===null?o=zt(e,n):o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(t,e,n,o);else for(var p=t.length-1;p>=0;p--)(c=t[p])&&(d=(u<3?c(d):u>3?c(e,n,d):c(e,n))||d);return u>3&&d&&te(e,n,d),d},dN=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};let lf=class extends Gr{constructor(t){super(),this._connectionState=jr.CLOSED,this.lastMsgTime=kt(),this.uploadCache=[],this.rttRolling=new lN(5),this.pingpongTimeoutCount=0,this.onWebsocketMessage=e=>{if(e.data instanceof ArrayBuffer)return void this.emit(de.ON_BINARY_DATA,e.data);const n=JSON.parse(e.data);if(this.lastMsgTime=kt(),Object.prototype.hasOwnProperty.call(n,"_id")){const o="res-@".concat(n._id);this.emit(o,n._result,n._message)}else if(Object.prototype.hasOwnProperty.call(n,"_type")&&(this.emit(n._type,n._message),n._type===Pe.ON_NOTIFICATION&&this.handleNotification(n._message),n._type===Pe.ON_USER_BANNED))switch(n._message.error_code){case 14:this.close(un.UID_BANNED);break;case 15:this.close(un.IP_BANNED);break;case 16:this.close(un.CHANNEL_BANNED)}},this.clientId=t.clientId,this.spec=t,this.websocket=new Dl("gateway-".concat(this.clientId),this.spec.retryConfig,!0,!0),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===jr.CONNECTED&&this.reconnect("retry",Dn.OFFLINE)})}get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===jr.CONNECTED?this.emit(de.WS_CONNECTED):t===jr.RECONNECTING?this.emit(de.WS_RECONNECTING,this._websocketReconnectReason):t===jr.CLOSED&&this.emit(de.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}async request(t,e,n,o){var c,u,d,p,f,g,E,I;const _=gr(6,""),T={_id:_,_type:t,_message:e},R=this.websocket.connectionID,w=()=>new ct((ut,At)=>{if(this.connectionState===jr.CONNECTED)return ut();const Ct=()=>{this.off(de.WS_CLOSED,lt),ut()},lt=()=>{this.off(de.WS_CONNECTED,Ct),At(new Q(U.WS_ABORT))};this.once(de.WS_CONNECTED,Ct),this.once(de.WS_CLOSED,lt),t!==Ae.PUBLISH&&t!==Ae.SUBSCRIBE&&t!==Ae.UNSUBSCRIBE&&t!==Ae.UNPUBLISH&&t!==Ae.CONTROL||this.once(de.DISCONNECT_P2P,()=>{At(new Q(U.DISCONNECT_P2P))})});if(this.connectionState!==jr.CONNECTING&&this.connectionState!==jr.RECONNECTING||t===Ae.JOIN||t===Ae.REJOIN||await w(),this.websocket.sendMessage(T,!0),o)return;const k=new ct((ut,At)=>{let Ct=!1;const lt=(wt,Qt)=>{Ct=!0,ut({isSuccess:wt==="success",message:Qt||{}}),this.off(de.WS_CLOSED,Gt),this.off(de.WS_RECONNECTING,Gt),this.emit(de.REQUEST_SUCCESS,t,e)};this.once("res-@".concat(_),lt);const Gt=()=>{At(new Q(U.WS_ABORT,"type: ".concat(t))),this.off(de.WS_CLOSED,Gt),this.off(de.WS_RECONNECTING,Gt),this.off("res-@".concat(_),lt)};this.once(de.WS_CLOSED,Gt),this.once(de.WS_RECONNECTING,Gt),pn(ot("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==R||Ct||(N.warning("ws request timeout, type: ".concat(t)),Lt("warning",this,"ws request timeout, type: ".concat(t)),this.emit(de.REQUEST_TIMEOUT,t,e))})});let L=null;try{L=await k}catch(ut){if(this.connectionState===jr.CLOSED||t===Ae.LEAVE)throw new Q(U.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n?ut.throw():t===Ae.JOIN||t===Ae.REJOIN?null:(await w(),await this.request(t,e))}if(L.isSuccess)return L.message;const Y=Number(L.message.error_code||L.message.code),Z=NC(Y),rt=new Q(U.UNEXPECTED_RESPONSE,M(c="".concat(Z.desc,": ")).call(c,L.message.error_str),{code:Y,data:L.message});return Z.action==="success"?L.message:(N.warning(M(u=M(d=M(p=M(f="[".concat(this.websocket.connectionID,"] unexpected response from type ")).call(f,t,", error_code: ")).call(p,Y,", message: ")).call(d,Z.desc,", action: ")).call(u,Z.action)),Lt("warning",this,M(g=M(E=M(I="unexpected response from type ".concat(t,", error_code: ")).call(I,Y,", message: ")).call(E,Z.desc,", action: ")).call(g,Z.action)),Y===Yt.ERR_TOO_MANY_BROADCASTERS?((t===Ae.JOIN||t===Ae.REJOIN)&&(this.initError=rt,this.close()),rt.throw()):Z.action==="failed"?rt.throw():Z.action==="quit"?(this.initError=rt,this.close(),rt.throw()):(Y===Yt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=L.message.option,N.warning("[".concat(this.clientId,"] detect multi ip, recover")),Lt("warning",this,"detect multi ip, recover"),this.reconnect("recover",Dn.MULTI_IP)):this.reconnect(Z.action,Dn.SERVER_ERROR),t===Ae.JOIN||t===Ae.REJOIN?null:await this.request(t,e)))}waitMessage(t,e){return new ct(n=>{const o=c=>{(!e||e(c))&&(this.off(t,o),n(c))};this.on(t,o)})}upload(t,e){const n={_type:t,_message:e};try{this.websocket.sendMessage(n)}catch{const u=ot("MAX_UPLOAD_CACHE")||50;var o;this.uploadCache.push(n),this.uploadCache.length>u&&Ze(o=this.uploadCache).call(o,0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{var d;if(this.connectionState!==jr.CONNECTED)return;const p=Ze(d=this.uploadCache).call(d,0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(p._type,p._message)},ot("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,e){const n={_type:t,_message:e};this.websocket.sendMessage(n)}init(t,e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ct((n,o)=>{this.once(de.WS_CONNECTED,()=>n(this.joinResponse)),this.once(de.WS_CLOSED,()=>o(this.initError||new Q(U.WS_ABORT))),this.connectionState=jr.CONNECTING,this.websocket.init(t).catch(o),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4),Vr(()=>{e&&this.openConnectionTime===void 0&&(N.debug("[".concat(this.clientId,"] init websocket timeout while join with fallback to proxy")),o(new Q(U.INIT_WEBSOCKET_TIMEOUT)))},ot("JOIN_WITH_FALLBACK_PROXY_PENDING_DURATION"))})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||un.LEAVE,this.connectionState=jr.CLOSED,N.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){var t;if(!this.joinResponse){const e=await ro(this,de.REQUEST_JOIN_INFO),n=await this.request(Ae.JOIN,e);if(!n)return this.emit(de.REPORT_JOIN_GATEWAY,U.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(de.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=jr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(vn(t=this.handlePingPong).call(t,this),3e3),!0}async rejoin(){var t,e;if(!this.reconnectToken)throw new Q(U.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const n=yd(this,de.REQUEST_REJOIN_INFO);n.token=this.reconnectToken;const o=await this.request(Ae.REJOIN,n);return!!o&&(this.connectionState=jr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(vn(t=this.handlePingPong).call(t,this),3e3),o.peers&&G(e=o.peers).call(e,c=>{this.emit(Pe.ON_USER_ONLINE,{uid:c.uid}),c.audio_mute?this.emit(Pe.MUTE_AUDIO,{uid:c.uid}):this.emit(Pe.UNMUTE_AUDIO,{uid:c.uid}),c.video_mute?this.emit(Pe.MUTE_VIDEO,{uid:c.uid}):this.emit(Pe.UNMUTE_VIDEO,{uid:c.uid}),c.audio_enable_local?this.emit(Pe.ENABLE_LOCAL_AUDIO,{uid:c.uid}):this.emit(Pe.DISABLE_LOCAL_AUDIO,{uid:c.uid}),c.video_enable_local?this.emit(Pe.ENABLE_LOCAL_VIDEO,{uid:c.uid}):this.emit(Pe.DISABLE_LOCAL_VIDEO,{uid:c.uid}),c.audio||c.video||this.emit(Pe.ON_REMOVE_STREAM,{uid:c.uid,uint_id:c.uint_id}),c.audio&&this.emit(Pe.ON_ADD_AUDIO_STREAM,{uid:c.uid,uint_id:c.uint_id,audio:!0}),c.video&&this.emit(Pe.ON_ADD_VIDEO_STREAM,{uid:c.uid,uint_id:c.uint_id,video:!0})}),!0)}reconnect(t,e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,e)}handleNotification(t){N.debug("[".concat(this.clientId,"] receive notification: "),t),st("debug",this,"handleNotification",t);const e=NC(t.code);if(e.action!=="success")return e.action==="failed"?(N.error("[".concat(this.clientId,"] ignore error: "),e.desc),void Lt("error",this,"ignore error: ".concat(e.desc))):e.action==="quit"?(e.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(un.UID_BANNED),void this.close()):void this.reconnect(e.action,Dn.SERVER_ERROR)}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=ot("PING_PONG_TIME_OUT"),e=kt();this.pingpongTimeoutCount>=t&&(N.warning("PINGPONG Timeout. Last Socket Message: ".concat(e-this.lastMsgTime,"ms")),Lt("warning",this,"PINGPONG Timeout. Last Socket Message: ".concat(e-this.lastMsgTime,"ms")),e-this.lastMsgTime>ot("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Dn.TIMEOUT):this.request(Ae.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const n=kt()-e;this.rttRolling.add(n),ot("REPORT_STATS")&&this.send(Ae.PING_BACK,{pingpongElapse:n})}).catch(n=>{})}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:e}=this.websocket.getWsInflateData();t!==0&&e!==0&&this.upload(Pi.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:e,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(Be.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Be.CLOSED,()=>{this.connectionState=jr.CLOSED}),this.websocket.on(Be.FAILED,()=>{this._disconnectedReason=un.NETWORK_ERROR,this.connectionState=jr.CLOSED}),this.websocket.on(Be.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===jr.CONNECTED?this.connectionState=jr.RECONNECTING:this.connectionState=jr.CONNECTING}),this.websocket.on(Be.WILL_RECONNECT,(t,e)=>{if(yd(this,de.IS_P2P_DISCONNECTED)&&t==="retry")return this.reconnectToken=void 0,this.emit(de.NEED_RENEW_SESSION),this.emit(de.DISCONNECT_P2P),e("tryNext");t!=="retry"&&(this.reconnectToken=void 0,this.emit(de.NEED_RENEW_SESSION),this.emit(de.DISCONNECT_P2P)),e(t)}),this.websocket.on(Be.CONNECTED,()=>{this.openConnectionTime=kt(),this.reconnectToken?this.rejoin().catch(t=>{var e;N.warning(M(e="[".concat(this.clientId,"] rejoin failed ")).call(e,t)),st("warning",this,"rejoin",void 0,t.toString()),this.reconnect("tryNext",Dn.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(de.REPORT_JOIN_GATEWAY,t.message||t.code,this.url||""),t instanceof Q&&t.code===U.UNEXPECTED_RESPONSE&&t.data.code===Yt.ERR_NO_AUTHORIZED)return N.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),Lt("warning",this,"reconnect no authorized, recover"),void this.reconnect("recover",Dn.SERVER_ERROR);N.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),st("error",this,"join",void 0,t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Dn.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(Be.REQUEST_NEW_URLS,(t,e)=>{ro(this,de.REQUEST_RECOVER,this.multiIpOption).then(t).catch(e)})}};lf=uN([an("AgoraRTCSignal","websocket.connectionID"),dN("design:paramtypes",[Object])],lf);var hN=_o.findIndex,pN="findIndex",UC=!0;pN in[]&&Array(1).findIndex(function(){UC=!1}),jt({target:"Array",proto:!0,forced:UC},{findIndex:function(t){return hN(this,t,arguments.length>1?arguments[1]:void 0)}});var AN=vr("Array").findIndex,QC=Array.prototype,Jn=function(t){var e=t.findIndex;return t===QC||t instanceof Array&&e===QC.findIndex?AN:e},fN=A(function(){Za(1)});jt({target:"Object",stat:!0,forced:fN,sham:!Gm},{getPrototypeOf:function(t){return Za(ce(t))}});var uf=le.Object.getPrototypeOf;hn("asyncIterator"),hn("hasInstance"),hn("isConcatSpreadable"),hn("iterator"),hn("match"),hn("matchAll"),hn("replace"),hn("search"),hn("species"),hn("split"),hn("toPrimitive"),hn("toStringTag"),hn("unscopables"),is(Math,"Math",!0),is(h.JSON,"JSON",!0);var df=le.Symbol;function oo(t){return"Minified Redux error #"+t+"; visit https://redux.js.org/Errors?code="+t+" for the full message or use the non-minified dev environment for full errors. "}var $e,FC=typeof df=="function"&&df.observable||"@@observable",hf=function(){return Math.random().toString(36).substring(7).split("").join(".")},VC={INIT:"@@redux/INIT"+hf(),REPLACE:"@@redux/REPLACE"+hf(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+hf()}};function gN(t){if(typeof t!="object"||t===null)return!1;for(var e=t;uf(e)!==null;)e=uf(e);return uf(t)===e}function GC(t,e,n){var o;if(typeof e=="function"&&typeof n=="function"||typeof n=="function"&&typeof arguments[3]=="function")throw new Error(oo(0));if(typeof e=="function"&&n===void 0&&(n=e,e=void 0),n!==void 0){if(typeof n!="function")throw new Error(oo(1));return n(GC)(t,e)}if(typeof t!="function")throw new Error(oo(2));var c=t,u=e,d=[],p=d,f=!1;function g(){p===d&&(p=Mr(d).call(d))}function E(){if(f)throw new Error(oo(3));return u}function I(w){if(typeof w!="function")throw new Error(oo(4));if(f)throw new Error(oo(5));var k=!0;return g(),p.push(w),function(){if(k){if(f)throw new Error(oo(6));k=!1,g();var L=Ft(p).call(p,w);Ze(p).call(p,L,1),d=null}}}function _(w){if(!gN(w))throw new Error(oo(7));if(w.type===void 0)throw new Error(oo(8));if(f)throw new Error(oo(9));try{f=!0,u=c(u,w)}finally{f=!1}for(var k=d=p,L=0;L<k.length;L++)(0,k[L])();return w}function T(w){if(typeof w!="function")throw new Error(oo(10));c=w,_({type:VC.REPLACE})}function R(){var w,k=I;return(w={subscribe:function(L){if(typeof L!="object"||L===null)throw new Error(oo(11));function Y(){L.next&&L.next(E())}return Y(),{unsubscribe:k(Y)}}})[FC]=function(){return this},w}return _({type:VC.INIT}),(o={dispatch:_,subscribe:I,getState:E,replaceReducer:T})[FC]=R,o}function jC(t,e){var n=ue(t);if(_e){var o=_e(t);e&&(o=Ot(o).call(o,function(c){return zt(t,c).enumerable})),n.push.apply(n,o)}return n}function Je(t){for(var e=1;e<arguments.length;e++){var n,o=arguments[e]!=null?arguments[e]:{};if(e%2)G(n=jC(Object(o),!0)).call(n,function(u){qr(t,u,o[u])});else if(Ce)dr(t,Ce(o));else{var c;G(c=jC(Object(o))).call(c,function(u){te(t,u,zt(o,u))})}}return t}(function(t){t.SET_SESSION_ID="SET_SESSION_ID",t.SET_P2P_ID="SET_P2P_id",t.SET_UID="SET_UID",t.SET_PUB_ID="SET_PUB_ID",t.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",t.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",t.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",t.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",t.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",t.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",t.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",t.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",t.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",t.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",t.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE"})($e||($e={}));class wc{constructor(e,n,o,c){const u={codec:e,audioCodec:n,mode:o,clientId:c,sessionId:null,p2pId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[]}};this.reducer=function(d=u,p){switch(p.type){case $e.SET_SESSION_ID:return Je({},d,{sessionId:p.sessionId});case $e.SET_P2P_ID:return Je({},d,{p2pId:p.p2pId});case $e.SET_UID:return Je({},d,{uid:p.uid});case $e.SET_PUB_ID:return Je({},d,{pubId:p.pubId});case $e.KEY_METRIC_CLIENT_CREATED:return Je({},d,{keyMetrics:Je({},d.keyMetrics,{clientCreated:p.metric})});case $e.KEY_METRIC_JOIN_START:return Je({},d,{keyMetrics:Je({},d.keyMetrics,{joinStart:p.metric})});case $e.KEY_METRIC_JOIN_END:return Je({},d,{keyMetrics:Je({},d.keyMetrics,{joinEnd:p.metric})});case $e.KEY_METRIC_REQUEST_AP_START:return Je({},d,{keyMetrics:Je({},d.keyMetrics,{requestAPStart:p.metric})});case $e.KEY_METRIC_REQUEST_AP_END:return Je({},d,{keyMetrics:Je({},d.keyMetrics,{requestAPEnd:p.metric})});case $e.KEY_METRIC_JOIN_GATEWAY_START:return Je({},d,{keyMetrics:Je({},d.keyMetrics,{joinGatewayStart:p.metric})});case $e.KEY_METRIC_JOIN_GATEWAY_END:return Je({},d,{keyMetrics:Je({},d.keyMetrics,{joinGatewayEnd:p.metric})});case $e.KEY_METRIC_PEER_CONNECTION_START:return Je({},d,{keyMetrics:Je({},d.keyMetrics,{peerConnectionStart:p.metric})});case $e.KEY_METRIC_PEER_CONNECTION_END:return Je({},d,{keyMetrics:Je({},d.keyMetrics,{peerConnectionEnd:p.metric})});case $e.KEY_METRIC_PUBLISH:{const f=d.keyMetrics.publish,g=Jn(f).call(f,E=>E.trackId===p.metric.trackId);return g!==-1?(f[g]=Je({},f[g],{},p.metric),Je({},d,{keyMetrics:Je({},d.keyMetrics,{publish:[...f]})})):Je({},d,{keyMetrics:Je({},d.keyMetrics,{publish:[...d.keyMetrics.publish,p.metric]})})}case $e.KEY_METRIC_SUBSCRIBE:{const f=d.keyMetrics.subscribe,g=Jn(f).call(f,E=>E.userId===p.metric.userId&&E.type===p.metric.type);return g!==-1?(f[g]=Je({},f[g],{},p.metric),Je({},d,{keyMetrics:Je({},d.keyMetrics,{subscribe:[...f]})})):Je({},d,{keyMetrics:Je({},d.keyMetrics,{subscribe:[...d.keyMetrics.subscribe,p.metric]})})}default:return d}},this.store=GC(this.reducer)}set sessionId(e){this.store.dispatch({type:$e.SET_SESSION_ID,sessionId:e})}get sessionId(){return this.store.getState().sessionId}get codec(){return this.store.getState().codec}get audioCodec(){return this.store.getState().audioCodec}get clientId(){return this.store.getState().clientId}set p2pId(e){this.store.dispatch({type:$e.SET_P2P_ID,p2pId:e})}get p2pId(){return this.store.getState().p2pId}set uid(e){this.store.dispatch({type:$e.SET_UID,uid:e})}get uid(){return this.store.getState().uid}set pubId(e){this.store.dispatch({type:$e.SET_PUB_ID,pubId:e})}get pubId(){return this.store.getState().pubId}clientCreated(){this.store.dispatch({type:$e.KEY_METRIC_CLIENT_CREATED,metric:performance.now()})}joinStart(){this.store.dispatch({type:$e.KEY_METRIC_JOIN_START,metric:performance.now()})}joinEnd(){this.store.dispatch({type:$e.KEY_METRIC_JOIN_END,metric:performance.now()})}requestAPStart(){this.store.dispatch({type:$e.KEY_METRIC_REQUEST_AP_START,metric:performance.now()})}requestAPEnd(){this.store.dispatch({type:$e.KEY_METRIC_REQUEST_AP_END,metric:performance.now()})}joinGatewayStart(){this.store.dispatch({type:$e.KEY_METRIC_JOIN_GATEWAY_START,metric:performance.now()})}joinGatewayEnd(){this.store.dispatch({type:$e.KEY_METRIC_JOIN_GATEWAY_END,metric:performance.now()})}peerConnectionStart(){this.store.dispatch({type:$e.KEY_METRIC_PEER_CONNECTION_START,metric:performance.now()})}peerConnectionEnd(){this.store.dispatch({type:$e.KEY_METRIC_PEER_CONNECTION_END,metric:performance.now()})}publish(e,n,o,c){this.store.dispatch({type:$e.KEY_METRIC_PUBLISH,metric:Je({trackId:e,type:n},o&&{publishStart:o},{},c&&{publishEnd:c})})}subscribe(e,n,o,c,u){this.store.dispatch({type:$e.KEY_METRIC_SUBSCRIBE,metric:Je({userId:e,type:n},o&&{subscribeStart:o},{},c&&{subscribeEnd:c},{},u&&{firstFrame:u})})}get keyMetrics(){return this.store.getState().keyMetrics}}function KC(t,e){var n=ue(t);if(_e){var o=_e(t);e&&(o=Ot(o).call(o,function(c){return zt(t,c).enumerable})),n.push.apply(n,o)}return n}function Bd(t){for(var e=1;e<arguments.length;e++){var n,o=arguments[e]!=null?arguments[e]:{};if(e%2)G(n=KC(Object(o),!0)).call(n,function(u){qr(t,u,o[u])});else if(Ce)dr(t,Ce(o));else{var c;G(c=KC(Object(o))).call(c,function(u){te(t,u,zt(o,u))})}}return t}var mN=function(t,e,n,o){var c,u=arguments.length,d=u<3?e:o===null?o=zt(e,n):o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(t,e,n,o);else for(var p=t.length-1;p>=0;p--)(c=t[p])&&(d=(u<3?c(d):u>3?c(e,n,d):c(e,n))||d);return u>3&&d&&te(e,n,d),d},EN=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};const pf=new tr;let Af=class extends Gr{constructor(t,e){super(),this.inChannelInfo={joinAt:null,duration:0},this._state="DISCONNECTED",this.isSignalRecover=!1,this.hasChangeBGPAddress=!1,this.joinGatewayStartTime=0,this._signalTimeout=!1,this._isProactiveJoin=!1,this.store=t,this.spec=e,this.signal=new lf(Bd({},e,{retryConfig:e.websocketRetryConfig})),this._statsCollector=e.statsCollector,this.role=e.role||"audience",this._clientRoleOptions=e.clientRoleOptions,this.handleSignalEvents()}get state(){return this._state}set state(t){if(t===this._state)return;const e=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(_r.CONNECTION_STATE_CHANGE,t,e,this._disconnectedReason):this.emit(_r.CONNECTION_STATE_CHANGE,t,e)}async join(t,e,n){var o,c;this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const u=kt();let d=pf.get(t.cname);if(d||(d=new tr,pf.set(t.cname,d)),this._isProactiveJoin=!0,d.has(t.uid)){const g=new Q(U.UID_CONFLICT);throw it.joinGateway(t.sid,{lts:u,succ:!1,ec:g.message,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin}),this._isProactiveJoin=!1,g}d.set(t.uid,!0),this.joinInfo=t,this.key=e;const p=t.proxyServer?ht(o=t.gatewayAddrs).call(o,g=>{var E,I;const _=g.address.split(":");return M(E=M(I="wss://".concat(t.proxyServer,"/ws/?h=")).call(I,_[0],"&p=")).call(E,_[1])}):ht(c=t.gatewayAddrs).call(c,g=>"wss://".concat(g.address));let f=0;this.joinGatewayStartTime=u,N.debug("[".concat(this.store.clientId,"] joinGatewayStartTime"),u);try{f=(await this.signal.init(p,n)).uid}catch(g){throw g&&g.code===U.INIT_WEBSOCKET_TIMEOUT?(N.warning("[".concat(this.store.clientId,"] User join failed"),g.toString()),g):(N.error("[".concat(this.store.clientId,"] User join failed"),g.toString()),st("error",this,"join",void 0,g.toString()),it.joinGateway(t.sid,{lts:u,succ:!1,ec:g.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin}),this._isProactiveJoin=!1,d.delete(t.uid),this.signal.close(),g)}return this.state="CONNECTED",this.inChannelInfo.joinAt=kt(),N.debug("[".concat(this.store.clientId,"] Connected to gateway server")),st("debug",this,"join",void 0,"success"),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(g=>{N.warning("[".concat(this.store.clientId,"] get traffic stats error"),g.toString()),st("warning",this,"trafficStatsInterval",void 0,g.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(_r.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(_r.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(_r.NETWORK_QUALITY,{uplinkNetworkQuality:D1(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:D1(this._statsCollector.trafficStats.B_dnq)}):this.emit(_r.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),f}async leave(t=!1,e){if(this.state!=="DISCONNECTED"){e!==un.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==jr.CONNECTED||await function(n,o){return o===1/0?n:ct.race([n,nb(o)])}(this.signal.request(Ae.LEAVE,void 0,!0),3e3)}catch(n){N.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),n),Lt("warning",this,"leave request failed, ignore, ".concat(n.toString()))}this.signal.close(e),this.state="DISCONNECTED",this.reset()}}async publish(t,e,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Q(U.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const o={state:"offer",p2p_id:this.store.p2pId,ortc:e,mode:this.spec.mode,extend:ot("PUB_EXTEND")};try{return(await this.signal.request(Ae.PUBLISH,o,!0))._message}catch(c){if(n&&c.data&&c.data.code===Yt.ERR_PUBLISH_REQUEST_INVALID)return N.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),c.toString()),Lt("warning",this,"receive publish error code, retry, ".concat(c.toString())),await this.tryUnpubBeforeRepub(t,e),this.publish(t,e,!1);throw c}}async unpublish(t,e){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Q(U.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Ae.UNPUBLISH,{stream_id:e,ortc:t},!0)}catch(n){N.warning("unpublish warning: ",n),st("warning",this,"unpublish",void 0,n.toString())}}async subscribe(t,e,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Q(U.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const o={stream_id:t,stream_type:e.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,tcc:!!ot("SUBSCRIBE_TCC"),extend:ot("SUB_EXTEND"),ssrcId:e.ssrcId};try{return(await this.signal.request(Ae.SUBSCRIBE,o,!0))._message}catch(c){if(n&&c.data&&c.data.code===Yt.ERR_SUBSCRIBE_REQUEST_INVALID)return N.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),c.toString()),Lt("warning",this,"receiver subscribe error code, retry"),await this.tryUnsubBeforeResub(t,e),await this.subscribe(t,e,!1);throw c}}async setVideoProfile(t){const e=function(n){if(!(n.bitrateMax&&n.bitrateMin&&n.frameRate&&n.height&&n.width))return;let o=n.frameRate,c=n.width,u=n.height,d=!0;return typeof o!="number"&&(o=o.exact||o.ideal||o.max||o.min||0,o||(d=!1)),typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(d=!1)),typeof u!="number"&&(u=u.exact||u.ideal||u.max||u.min||0,o||(d=!1)),d?{stream_type:0,width:c,height:u,fps:o,start_bps:1e3*n.bitrateMax,min_bps:1e3*n.bitrateMin,target_bps:1e3*n.bitrateMax}:void 0}(t);return e?this.signal.request(Ae.SET_VIDEO_PROFILE,e):(N.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway")),void Lt("debug",this,"encoder config is not complete, do not report to gateway"))}async unsubscribe(t,e){try{await this.signal.request(Ae.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:e},!0)}catch(n){N.warning("unsubscribe warning: ",n),st("warning",this,"unsubscribe",void 0,n.toString())}}async reconnectPC(t){const{iceParameters:e,dtlsParameters:n,rtpCapabilities:o}=t,c=await this.signal.request(Ae.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:e,dtlsParameters:n,rtpCapabilities:o}},!0),u=this.getGatewayIpPort();return{gatewayEstablishParams:c,gatewayIP:u==null?void 0:u.ip,gatewayPort:u==null?void 0:u.port}}getGatewayInfo(){return this.signal.request(Ae.GATEWAY_INFO)}renewToken(t){return this.signal.request(Ae.RENEW_TOKEN,t)}async setClientRole(t,e){if(e&&(this._clientRoleOptions=Ir({},e)),this.state!=="CONNECTED")return void(this.role=t);let n;n=t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:0,await this.signal.request(Ae.SET_CLIENT_ROLE,{role:t,level:n}),this.role=t}async setRemoteVideoStreamType(t,e){await this.signal.request(Ae.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:e})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(Ae.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,e){await this.signal.request(Ae.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:e})}async pickSVCLayer(t,e){await this.signal.request(Ae.PICK_SVC_LAYER,{stream_id:t,spatial_layer:e.spatialLayer,temporal_layer:e.temporalLayer})}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=kt()-this.inChannelInfo.joinAt),Bd({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Ae.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=kt()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=pf.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=function(e){const n=e.match(/(wss\:\/\/)?([^:]+):(\d+)/);return n?{username:Pr.username,password:Pr.password,turnServerURL:n[2],tcpport:rr(n[3])+30,udpport:rr(n[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Bd({},Pr,{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){var t;if(this.state!=="CONNECTED")return;const e=await this.signal.request(Ae.TRAFFIC_STATS,void 0,!0);e.timestamp=kt(),G(t=e.peer_delay).call(t,n=>{var o;const c=this._statsCollector.trafficStats&&yt(o=this._statsCollector.trafficStats.peer_delay).call(o,u=>u.peer_uid===n.peer_uid);c&&c.B_st!==n.B_st&&Gi(()=>{this.emit(_r.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)})}),this._statsCollector.updateTrafficStats(e)}getJoinMessage(t){if(!this.joinInfo||!this.key)throw new Q(U.UNEXPECTED_ERROR,"can not generate join message, no join info");const e=Ir({},this.joinInfo.apResponse);let n=ot("REPORT_APP_SCENARIO");if(typeof n!="string")try{n=at(n)}catch{n=void 0}n&&n.length>128&&(n=void 0);const o=Bd({p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Yn,browser:navigator.userAgent,process_id:ot("PROCESS_ID"),mode:this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:e,extend:ot("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:n},t);return this.joinInfo.stringUid&&(o.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(o.aes_mode=this.joinInfo.aesmode,ot("ENCRYPT_AES")?(o.aes_secret=this.joinInfo.aespassword,o.aes_encrypt=!0):o.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(o.aes_salt=this.joinInfo.aessalt)),e.addresses[this.signal.websocket.currentURLIndex]&&(o.ap_response.ticket=e.addresses[this.signal.websocket.currentURLIndex].ticket,delete e.addresses),this.joinInfo.defaultVideoStream!==void 0&&(o.default_video_stream=this.joinInfo.defaultVideoStream),o}getRejoinMessage(){if(!this.joinInfo)throw new Q(U.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(de.WS_RECONNECTING,t=>{this.joinInfo&&it.WebSocketQuit(this.joinInfo.sid,{lts:kt(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||Dn.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",it.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode}),this.isSignalRecover=!1,this.joinGatewayStartTime=kt())}),this.signal.on(de.WS_CLOSED,t=>{let e;switch(t){case un.LEAVE:e=Dn.LEAVE;break;case un.UID_BANNED:case un.IP_BANNED:case un.CHANNEL_BANNED:case un.SERVER_ERROR:e=Dn.SERVER_ERROR;break;case un.FALLBACK:e=Dn.FALLBACK;break;default:e=Dn.NETWORK_ERROR}N.debug("[signal] websocket closed, reason: ".concat(e||"undefined -> "+Dn.NETWORK_ERROR)),nr("debug",this,"ws_closed","reason: ".concat(t)),this.joinInfo&&it.WebSocketQuit(this.joinInfo.sid,{lts:kt(),succ:t===un.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e}),this._disconnectedReason=t,this.state="DISCONNECTED",this.reset()}),this.signal.on(de.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){var t,e,n,o,c;if(this.role==="audience"&&this._clientRoleOptions&&this._clientRoleOptions.level&&(N.debug(M(t=M(e=M(n="[".concat(this.store.clientId,"] patch to send set client role, role: ")).call(n,this.role,", mode: ")).call(e,this.spec.mode,", level: ")).call(t,this._clientRoleOptions&&this._clientRoleOptions.level)),Lt("debug",this,M(o=M(c="patch to send set client role, role: ".concat(this.role,", mode: ")).call(c,this.spec.mode,", level: ")).call(o,this._clientRoleOptions&&this._clientRoleOptions.level)),this.setClientRole(this.role,this._clientRoleOptions)),it.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint){const d=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);var u;if(!d)return N.error(M(u="[".concat(this.store.clientId,"] set local access point after joined failed: ")).call(u,d)),void Lt("error",this,"set local access point after joined failed: ".concat(d));In("EVENT_REPORT_DOMAIN",d[1]),In("EVENT_REPORT_BACKUP_DOMAIN",d[1]),In("LOG_UPLOAD_SERVER","".concat(d[1],":6444"))}}}),this.signal.on(Pe.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(de.REQUEST_RECOVER,(t,e,n)=>{if(!this.joinInfo)return n(new Q(U.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,ro(this,_r.REQUEST_NEW_GATEWAY_LIST).then(e).catch(n)}),this.signal.on(de.REQUEST_JOIN_INFO,async t=>{var e;this.updateTurnConfigFromSignal();const{iceParameters:n,dtlsParameters:o,rtpCapabilities:c}=await ro(this,_r.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:(e=this.joinInfo)===null||e===void 0?void 0:e.turnServer});t(this.getJoinMessage({ortc:{iceParameters:n,dtlsParameters:o,rtpCapabilities:c,version:"2"}}))}),this.signal.on(de.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(de.REPORT_JOIN_GATEWAY,(t,e)=>{this.joinInfo&&(it.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:t,addr:e,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin}),this._isProactiveJoin=!1)}),this.signal.on(de.IS_P2P_DISCONNECTED,t=>{t(yd(this,_r.IS_P2P_DISCONNECTED))}),this.signal.on(de.DISCONNECT_P2P,()=>{this.emit(_r.DISCONNECT_P2P)}),this.signal.on(de.NEED_RENEW_SESSION,()=>{this.emit(_r.NEED_RENEW_SESSION)}),this.signal.on(de.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(de.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(de.JOIN_RESPONSE,t=>{const e=this.getGatewayIpPort();e?this.emit(_r.JOIN_RESPONSE,t,e.ip,e.port):this.emit(_r.JOIN_RESPONSE,t)})}async tryUnsubBeforeResub(t,e){try{await this.signal.request(Ae.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[e]},!0)}catch(n){throw N.warning("unsubscribe warning",n),st("warning",this,"tryUnsubBeforeResub",t,n.toString()),n}}async tryUnpubBeforeRepub(t,e){try{await this.signal.request(Ae.UNPUBLISH,{stream_id:t,ortc:e},!0)}catch(n){throw N.warning("unpublish warning: ",n),st("warning",this,"tryUnpubBeforeRepub",t,n.toString()),n}}async muteLocal(t,e){const n={action:yt(t).call(t,o=>o.stream_type===fr.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:e};try{await this.signal.request(Ae.CONTROL,n,!0,!0)}catch(o){throw N.warning("gateway unmuteLocal warning: ",o),st("warning",this,"muteLocal",e,o.toString()),o}}async unmuteLocal(t,e){const n={action:yt(t).call(t,o=>o.stream_type===fr.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:e};try{await this.signal.request(Ae.CONTROL,n,!0,!0)}catch(o){throw N.warning("gateway muteLocal warning: ",o),st("warning",this,"unmuteLocal",e,o.toString()),o}}uploadStats(t,e){this.signal.upload(t,e)}getSignalRTT(){return this.signal.rtt}async restartICE(t){const e={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{const n=await this.signal.request(Ae.RESTART_ICE,e,!0),o=this.getGatewayIpPort();return{restartICEResponse:n,gatewayIP:o==null?void 0:o.ip,gatewayPort:o==null?void 0:o.port}}catch(n){throw N.warning("P2PChannel.restartICE warning: ",n),st("warning",this,"restartICE",void 0,n.toString()),n}}reconnect(){this.state==="CONNECTED"&&this.signal.reconnect(void 0,Dn.P2P_FAILED)}getGatewayIpPort(){var t;if(!ot("GATEWAY_WSS_ADDRESS")&&(t=this.joinInfo)!==null&&t!==void 0&&t.gatewayAddrs){const e=this.joinInfo.gatewayAddrs[this.signal.currentURLIndex];return(e.ip||e.ip6)&&e.port?e.ip6?{ip:e.ip6,port:e.port}:{ip:e.ip,port:e.port}:void 0}}};function HC(t,e){var n=ue(t);if(_e){var o=_e(t);e&&(o=Ot(o).call(o,function(c){return zt(t,c).enumerable})),n.push.apply(n,o)}return n}Af=mN([an("AgoraRTCGateway","store.clientId"),EN("design:paramtypes",[wc,Object])],Af),function(){var t;function e(z){var nt=0;return function(){return nt<z.length?{done:!1,value:z[nt++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(z,nt,gt){return z==Array.prototype||z==Object.prototype||(z[nt]=gt.value),z},o,c=function(z){z=[typeof globalThis=="object"&&globalThis,z,typeof window=="object"&&window,typeof self=="object"&&self,typeof s=="object"&&s];for(var nt=0;nt<z.length;++nt){var gt=z[nt];if(gt&&gt.Math==Math)return gt}throw Error("Cannot find global object")}(this);function u(z,nt){if(nt)t:{var gt=c;z=z.split(".");for(var It=0;It<z.length-1;It++){var Mt=z[It];if(!(Mt in gt))break t;gt=gt[Mt]}(nt=nt(It=gt[z=z[z.length-1]]))!=It&&nt!=null&&n(gt,z,{configurable:!0,writable:!0,value:nt})}}function d(z){return(z={next:z})[Symbol.iterator]=function(){return this},z}function p(z){var nt=typeof Symbol!="undefined"&&Symbol.iterator&&z[Symbol.iterator];return nt?nt.call(z):{next:e(z)}}if(u("Symbol",function(z){function nt(Mt,tt){this.A=Mt,n(this,"description",{configurable:!0,writable:!0,value:tt})}if(z)return z;nt.prototype.toString=function(){return this.A};var gt="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",It=0;return function Mt(tt){if(this instanceof Mt)throw new TypeError("Symbol is not a constructor");return new nt(gt+(tt||"")+"_"+It++,tt)}}),u("Symbol.iterator",function(z){if(z)return z;z=Symbol("Symbol.iterator");for(var nt="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),gt=0;gt<nt.length;gt++){var It=c[nt[gt]];typeof It=="function"&&typeof It.prototype[z]!="function"&&n(It.prototype,z,{configurable:!0,writable:!0,value:function(){return d(e(this))}})}return z}),typeof Object.setPrototypeOf=="function")o=Object.setPrototypeOf;else{var f;t:{var g={};try{g.__proto__={a:!0},f=g.a;break t}catch{}f=!1}o=f?function(z,nt){if(z.__proto__=nt,z.__proto__!==nt)throw new TypeError(z+" is not extensible");return z}:null}var E=o;function I(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function _(z){if(z.m)throw new TypeError("Generator is already running");z.m=!0}function T(z,nt){return z.h=3,{value:nt}}function R(z){this.g=new I,this.G=z}function w(z,nt,gt,It){try{var Mt=nt.call(z.g.j,gt);if(!(Mt instanceof Object))throw new TypeError("Iterator result "+Mt+" is not an object");if(!Mt.done)return z.g.m=!1,Mt;var tt=Mt.value}catch(y){return z.g.j=null,z.g.s(y),k(z)}return z.g.j=null,It.call(z.g,tt),k(z)}function k(z){for(;z.g.h;)try{var nt=z.G(z.g);if(nt)return z.g.m=!1,{value:nt.value,done:!1}}catch(gt){z.g.v=void 0,z.g.s(gt)}if(z.g.m=!1,z.g.l){if(nt=z.g.l,z.g.l=null,nt.F)throw nt.D;return{value:nt.return,done:!0}}return{value:void 0,done:!0}}function L(z){this.next=function(nt){return z.o(nt)},this.throw=function(nt){return z.s(nt)},this.return=function(nt){return function(gt,It){_(gt.g);var Mt=gt.g.j;return Mt?w(gt,"return"in Mt?Mt.return:function(tt){return{value:tt,done:!0}},It,gt.g.return):(gt.g.return(It),k(gt))}(z,nt)},this[Symbol.iterator]=function(){return this}}function Y(z,nt){return nt=new L(new R(nt)),E&&z.prototype&&E(nt,z.prototype),nt}if(I.prototype.o=function(z){this.v=z},I.prototype.s=function(z){this.l={D:z,F:!0},this.h=this.C||this.u},I.prototype.return=function(z){this.l={return:z},this.h=this.u},R.prototype.o=function(z){return _(this.g),this.g.j?w(this,this.g.j.next,z,this.g.o):(this.g.o(z),k(this))},R.prototype.s=function(z){return _(this.g),this.g.j?w(this,this.g.j.throw,z,this.g.o):(this.g.s(z),k(this))},u("Array.prototype.entries",function(z){return z||function(){return function(nt,gt){nt instanceof String&&(nt+="");var It=0,Mt=!1,tt={next:function(){if(!Mt&&It<nt.length){var y=It++;return{value:gt(y,nt[y]),done:!1}}return Mt=!0,{done:!0,value:void 0}}};return tt[Symbol.iterator]=function(){return tt},tt}(this,function(nt,gt){return[nt,gt]})}}),typeof Blob!="undefined"&&(typeof FormData=="undefined"||!FormData.prototype.keys)){var Z=function(z,nt){for(var gt=0;gt<z.length;gt++)nt(z[gt])},rt=function(z){return z.replace(/\r?\n|\r/g,`\r
`)},ut=function(z,nt,gt){return nt instanceof Blob?(gt=gt!==void 0?String(gt+""):typeof nt.name=="string"?nt.name:"blob",nt.name===gt&&Object.prototype.toString.call(nt)!=="[object Blob]"||(nt=new File([nt],gt)),[String(z),nt]):[String(z),String(nt)]},At=function(z,nt){if(z.length<nt)throw new TypeError(nt+" argument required, but only "+z.length+" present.")},Ct=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,lt=Ct.FormData,Gt=Ct.XMLHttpRequest&&Ct.XMLHttpRequest.prototype.send,wt=Ct.Request&&Ct.fetch,Qt=Ct.navigator&&Ct.navigator.sendBeacon,xt=Ct.Element&&Ct.Element.prototype,ae=Ct.Symbol&&Symbol.toStringTag;ae&&(Blob.prototype[ae]||(Blob.prototype[ae]="Blob"),"File"in Ct&&!File.prototype[ae]&&(File.prototype[ae]="File"));try{new File([],"")}catch{Ct.File=function(nt,gt,It){return nt=new Blob(nt,It||{}),Object.defineProperties(nt,{name:{value:gt},lastModified:{value:+(It&&It.lastModified!==void 0?new Date(It.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),ae&&Object.defineProperty(nt,ae,{value:"File"}),nt}}var ge=function(z){return z.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},re=function(z){this.i=[];var nt=this;z&&Z(z.elements,function(gt){if(gt.name&&!gt.disabled&&gt.type!=="submit"&&gt.type!=="button"&&!gt.matches("form fieldset[disabled] *"))if(gt.type==="file"){var It=gt.files&&gt.files.length?gt.files:[new File([],"",{type:"application/octet-stream"})];Z(It,function(Mt){nt.append(gt.name,Mt)})}else gt.type==="select-multiple"||gt.type==="select-one"?Z(gt.options,function(Mt){!Mt.disabled&&Mt.selected&&nt.append(gt.name,Mt.value)}):gt.type==="checkbox"||gt.type==="radio"?gt.checked&&nt.append(gt.name,gt.value):(It=gt.type==="textarea"?rt(gt.value):gt.value,nt.append(gt.name,It))})};if((t=re.prototype).append=function(z,nt,gt){At(arguments,2),this.i.push(ut(z,nt,gt))},t.delete=function(z){At(arguments,1);var nt=[];z=String(z),Z(this.i,function(gt){gt[0]!==z&&nt.push(gt)}),this.i=nt},t.entries=function z(){var nt,gt=this;return Y(z,function(It){if(It.h==1&&(nt=0),It.h!=3)return nt<gt.i.length?It=T(It,gt.i[nt]):(It.h=0,It=void 0),It;nt++,It.h=2})},t.forEach=function(z,nt){At(arguments,1);for(var gt=p(this),It=gt.next();!It.done;It=gt.next()){var Mt=p(It.value);It=Mt.next().value,Mt=Mt.next().value,z.call(nt,Mt,It,this)}},t.get=function(z){At(arguments,1);var nt=this.i;z=String(z);for(var gt=0;gt<nt.length;gt++)if(nt[gt][0]===z)return nt[gt][1];return null},t.getAll=function(z){At(arguments,1);var nt=[];return z=String(z),Z(this.i,function(gt){gt[0]===z&&nt.push(gt[1])}),nt},t.has=function(z){At(arguments,1),z=String(z);for(var nt=0;nt<this.i.length;nt++)if(this.i[nt][0]===z)return!0;return!1},t.keys=function z(){var nt,gt,It,Mt,tt=this;return Y(z,function(y){if(y.h==1&&(nt=p(tt),gt=nt.next()),y.h!=3)return gt.done?void(y.h=0):(It=gt.value,Mt=p(It),T(y,Mt.next().value));gt=nt.next(),y.h=2})},t.set=function(z,nt,gt){At(arguments,2),z=String(z);var It=[],Mt=ut(z,nt,gt),tt=!0;Z(this.i,function(y){y[0]===z?tt&&(tt=!It.push(Mt)):It.push(y)}),tt&&It.push(Mt),this.i=It},t.values=function z(){var nt,gt,It,Mt,tt=this;return Y(z,function(y){if(y.h==1&&(nt=p(tt),gt=nt.next()),y.h!=3)return gt.done?void(y.h=0):(It=gt.value,(Mt=p(It)).next(),T(y,Mt.next().value));gt=nt.next(),y.h=2})},re.prototype._asNative=function(){for(var z=new lt,nt=p(this),gt=nt.next();!gt.done;gt=nt.next()){var It=p(gt.value);gt=It.next().value,It=It.next().value,z.append(gt,It)}return z},re.prototype._blob=function(){var z="----formdata-polyfill-"+Math.random(),nt=[],gt="--"+z+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(It,Mt){return typeof It=="string"?nt.push(gt+ge(rt(Mt))+`"\r
\r
`+rt(It)+`\r
`):nt.push(gt+ge(rt(Mt))+'"; filename="'+ge(It.name)+`"\r
Content-Type: `+(It.type||"application/octet-stream")+`\r
\r
`,It,`\r
`)}),nt.push("--"+z+"--"),new Blob(nt,{type:"multipart/form-data; boundary="+z})},re.prototype[Symbol.iterator]=function(){return this.entries()},re.prototype.toString=function(){return"[object FormData]"},xt&&!xt.matches&&(xt.matches=xt.matchesSelector||xt.mozMatchesSelector||xt.msMatchesSelector||xt.oMatchesSelector||xt.webkitMatchesSelector||function(z){for(var nt=(z=(this.document||this.ownerDocument).querySelectorAll(z)).length;0<=--nt&&z.item(nt)!==this;);return-1<nt}),ae&&(re.prototype[ae]="FormData"),Gt){var wr=Ct.XMLHttpRequest.prototype.setRequestHeader;Ct.XMLHttpRequest.prototype.setRequestHeader=function(z,nt){wr.call(this,z,nt),z.toLowerCase()==="content-type"&&(this.B=!0)},Ct.XMLHttpRequest.prototype.send=function(z){z instanceof re?(z=z._blob(),this.B||this.setRequestHeader("Content-Type",z.type),Gt.call(this,z)):Gt.call(this,z)}}wt&&(Ct.fetch=function(z,nt){return nt&&nt.body&&nt.body instanceof re&&(nt.body=nt.body._blob()),wt.call(this,z,nt)}),Qt&&(Ct.navigator.sendBeacon=function(z,nt){return nt instanceof re&&(nt=nt._asNative()),Qt.call(this,z,nt)}),Ct.FormData=re}}();let ff=1;function vN(t,e,n,o,c){ff+=1;const u={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(kt()/1e3),seq:ff,requestId:ff,version:Yn,cname:n.cname},d={service_name:e,json_body:at(u)};let p,f,g=t[0];return Li(async()=>{p=kt();const E=await to(g,{data:d,cancelToken:o,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(f=kt()-p,E.code!==0){const R=new Q(U.UNEXPECTED_RESPONSE,"live streaming ap error, code"+E.code,{retry:!0,responseTime:f});throw N.error(R.toString()),st("error",["AjaxAPI"],"requestLiveStreamingWorkerManager",void 0,R.toString()),R}const I=JSON.parse(E.json_body);if(I.code!==200){var _;const R=new Q(U.UNEXPECTED_RESPONSE,M(_="live streaming app center error, code: ".concat(I.code,", reason: ")).call(_,I.reason),{code:I.code,responseTime:f});throw N.error(R.toString()),st("error",["AjaxAPI"],"requestLiveStreamingWorkerManager",void 0,R.toString()),R}if(!I.servers||I.servers.length===0){const R=new Q(U.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:I.code,responseTime:f});throw N.error(R.toString()),st("error",["AjaxAPI"],"requestLiveStreamingWorkerManager",void 0,R.toString()),R}const T=function(R,w){var k;return{addressList:ht(k=R.servers).call(k,L=>{var Y,Z,rt;return M(Y=M(Z=M(rt="wss://".concat(L.address.replace(/\./g,"-"),".")).call(rt,ot("WORKER_DOMAIN"),":")).call(Z,L.wss,"?serviceName=")).call(Y,encodeURIComponent(w))}),workerToken:R.workerToken,vid:R.vid}}(I,e);return ot("LIVE_STREAMING_ADDRESS")&&(T.addressList=ot("LIVE_STREAMING_ADDRESS")instanceof Array?ot("LIVE_STREAMING_ADDRESS"):[ot("LIVE_STREAMING_ADDRESS")]),function(R){for(var w=1;w<arguments.length;w++){var k,L=arguments[w]!=null?arguments[w]:{};if(w%2)G(k=HC(Object(L),!0)).call(k,function(Z){qr(R,Z,L[Z])});else if(Ce)dr(R,Ce(L));else{var Y;G(Y=HC(Object(L))).call(Y,function(Z){te(R,Z,zt(L,Z))})}}return R}({},T,{responseTime:f})},(E,I)=>(it.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:e,responseDetail:at(E.addressList),firstSuccess:I===0,responseTime:f,serverIp:t[I%t.length]}),!1),(E,I)=>(it.apworkerEvent(n.sid,{success:!1,sc:E.data&&E.data.code||200,serviceName:e,responseTime:f,serverIp:t[I%t.length]}),!!(E.code!==U.OPERATION_ABORTED&&E.code!==U.UNEXPECTED_RESPONSE||E.data&&E.data.retry)&&(g=t[(I+1)%t.length],!0)),c)}let gf=1;function WC({url:t,areaCode:e},n,o,c){st("debug",["AjaxAPI",n.clientId],"requestChooseServer",{url:t,areaCode:e});const u=kt(),[d,p]=zC(n,e,[Sr.CHOOSE_SERVER]);let f=tn.networkState;return Li(async()=>{f&&tn.networkState===xi.OFFLINE&&tn.onlineWaiter&&await ct.race([tn.onlineWaiter,pn(c&&c.maxRetryTimeout||Cr.maxRetryTimeout)]),f=tn.networkState;const g=await to(t,{data:d,cancelToken:o,headers:{"Content-Type":"multipart/form-data;"}},!0);it.reportResourceTiming(t,n.sid),qC(g,t,n,u,[Sr.CHOOSE_SERVER]);const E=LA(g,Sr.CHOOSE_SERVER);return JC(E),N1(E,t)},g=>{var E;return g&&it.joinChooseServer(n.sid,{lts:u,succ:!0,csAddr:t,opid:p,serverList:ht(E=g.gatewayAddrs).call(E,I=>I.address),ec:null,cid:g.cid.toString(),uid:g.uid.toString(),csIp:g.csIp,unilbsServerIds:[Sr.CHOOSE_SERVER].toString()}),!1},g=>g.code!==U.OPERATION_ABORTED&&(g.code===U.CAN_NOT_GET_GATEWAY_SERVER?g.data.retry:(it.joinChooseServer(n.sid,{lts:u,succ:!1,csAddr:t,serverList:null,opid:p,ec:g.code,csIp:g.data&&g.data.csIp,unilbsServerIds:[Sr.CHOOSE_SERVER].toString(),extend:at({networkState:f})}),N.warning("[".concat(n.clientId,"] Choose server network error, retry"),g),Lt("warning",["AjaxAPI",n.clientId],"Choose server network error, retry, ".concat(g)),!0)),c)}function YC({url:t,areaCode:e,serviceIds:n},o,c,u){st("debug",["AjaxAPI",o.clientId],"requestMultiUnilbs",{url:t,areaCode:e,serviceIds:n});const d=kt(),[p,f]=zC(o,e,n);let g;return Li(async()=>{g&&tn.networkState===xi.OFFLINE&&tn.onlineWaiter&&await ct.race([tn.onlineWaiter,pn(u&&u.maxRetryTimeout||Cr.maxRetryTimeout)]),g=tn.networkState;const E=await to(t,{data:p,cancelToken:c,headers:{"Content-Type":"multipart/form-data;"}},!0);it.reportResourceTiming(t,o.sid),qC(E,t,o,d,n);const I=LA(E,Sr.CHOOSE_SERVER),_=LA(E,o.cloudProxyServer==="disabled"?Sr.CLOUD_PROXY_FALLBACK:o.cloudProxyServer==="proxy5"?Sr.CLOUD_PROXY_5:Sr.CLOUD_PROXY);return JC(I),{gatewayInfo:N1(I,t),proxyInfo:_,url:t}},E=>{var I,_;return E.gatewayInfo&&it.joinChooseServer(o.sid,{lts:d,succ:!0,csAddr:t,serverList:ht(I=E.gatewayInfo.gatewayAddrs).call(I,T=>T.address),ec:null,opid:f,cid:E.gatewayInfo.cid.toString(),uid:E.gatewayInfo.uid.toString(),csIp:E.gatewayInfo.csIp,unilbsServerIds:n.toString()}),E.proxyInfo&&it.joinWebProxyAP(o.sid,{lts:d,sucess:1,apServerAddr:t,turnServerAddrList:ht(_=E.proxyInfo.addresses).call(_,T=>T.ip).join(","),errorCode:null,eventType:o.cloudProxyServer,unilbsServerIds:n.toString()}),!1},E=>E.code!==U.OPERATION_ABORTED&&(E.code===U.CAN_NOT_GET_GATEWAY_SERVER?E.data.retry:(it.joinWebProxyAP(o.sid,{lts:d,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:E.code,eventType:o.cloudProxyServer,unilbsServerIds:n.toString(),extend:at({networkState:g})}),N.warning("[".concat(o.clientId,"] multi unilbs network error, retry"),E),Lt("warning",["AjaxAPI",o.clientId],"multi unilbs network error, retry, ".concat(E)),!0)),u)}const qC=(t,e,n,o,c)=>{var u,d,p;const f=[],g=E=>{E.flag===4096?it.joinChooseServer(n.sid,{lts:o,succ:!1,csAddr:e,opid:t.opid,serverList:null,ec:E.error.message,csIp:E.error.data&&E.error.data.csIp,unilbsServerIds:c.toString()}):E.flag!==1048576&&E.flag!==4194304&&E.flag!==4194310||it.joinWebProxyAP(n.sid,{lts:o,sucess:0,apServerAddr:e,turnServerAddrList:null,errorCode:E.error.code,eventType:n.cloudProxyServer,unilbsServerIds:c.toString()})};if(G(u=t.response_body).call(u,E=>{const I=E.buffer.code;if(E.uri===23&&I===0&&!E.buffer.edges_services)if(E.buffer.flag===4194310)N.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),E.buffer.edges_services=[];else{const _={error:new Q(U.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:t.detail[502]}),flag:E.buffer.flag};f.push(_),g(_)}if(I!==0){const _=kl(I),T={error:new Q(U.CAN_NOT_GET_GATEWAY_SERVER,_.desc,{retry:_.retry,csIp:t.detail[502]}),flag:E.buffer.flag};E.buffer.flag===4194310?N.warning(T.error.toString()):f.push(T),g(T)}}),f.length)throw N.warning(M(d=M(p="[".concat(n.clientId,"] multi unilbs ")).call(p,e," failed, ")).call(d,ht(f).call(f,E=>{var I,_;return M(I=M(_="flag: ".concat(E.flag,", message: ")).call(_,E.error.message,", retry: ")).call(I,E.error.data.retry)}).join(" | "))),st("warning",["AjaxAPI",n.clientId],"checkMultiUnilbsResponseValid",{url:e},ht(f).call(f,E=>({flag:E.flag,message:E.error.message,retry:E.error.data.retry}))),new Q(U.CAN_NOT_GET_GATEWAY_SERVER,ht(f).call(f,E=>{var I;return M(I="flag: ".concat(E.flag,", message: ")).call(I,E.error.message)}).join(" | "),{retry:!!yt(f).call(f,E=>E.error.data.retry),csIp:t.detail[502]})},JC=t=>{if(t.addresses&&t.addresses.length===0&&t.code===0)throw new Q(U.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:t.detail&&t.detail[502]});if(ot("GATEWAY_ADDRESS")&&ot("GATEWAY_ADDRESS").length>0){var e;N.debug("assign gateway address to",ot("GATEWAY_ADDRESS")),Lt("debug",["AjaxAPI"],"assign gateway address to ".concat(at(ot("GATEWAY_ADDRESS"))));const n=ht(e=ot("GATEWAY_ADDRESS")).call(e,o=>({ip:o.ip,port:o.port,ticket:t.addresses[0]&&t.addresses[0].ticket}));t.addresses=n}},IN=(t,e)=>{if(t.response_body&&t.response_body.length){const o=t.response_body[0];if(o.buffer.code!==0){var n;const c=kl(o.buffer.code);throw new Q(U.UPDATE_TICKET_FAILED,M(n="[".concat(o.buffer.code,"]: ")).call(n,c.desc),{retry:c.retry})}return o.buffer.ticket}throw N.debug("update ticket request received ap response without response body:",e),Lt("debug",["AjaxAPI"],"update ticket request received ap response without response body: ".concat(e)),new Q(U.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},zC=(t,e,n)=>{var o;const c=Math.floor(Math.random()*1e12),u={appid:t.appId,client_ts:kt(),opid:c,sid:t.sid,request_bodies:[{uri:22,buffer:{cname:t.cname,detail:{6:t.stringUid,11:e,12:ot("USE_NEW_TOKEN")?"1":void 0},key:t.token,service_ids:n,uid:t.uid||0}}]};G(o=u.request_bodies).call(o,p=>{t.multiIP&&t.multiIP.gateway_ip&&(p.buffer.detail[5]=at({vocs_ip:[t.multiIP.uni_lbs_ip],vos_ip:[t.multiIP.gateway_ip]}))});const d=new FormData;return d.append("request",at(u)),[d,c]},CN=(t,e)=>{var n;const o=Math.floor(Math.random()*1e12),c={appid:t.appId,client_ts:kt(),opid:o,sid:t.sid,request_bodies:[{uri:28,buffer:{cname:t.cname,detail:{1:"",12:"1"},token:t.token,service_ids:e,uid:t.uid||0,edges_services:ht(n=t.apResponse.addresses).call(n,d=>({ip:d.ip,port:d.port}))}}]},u=new FormData;return u.append("request",at(c)),[u,o]},Bl=()=>{const t=ot("AREAS");return t.length===0&&t.push(Ne.GLOBAL),ol(t).call(t,(e,n,o)=>{const c=_N(n);var u;return c?o===0?c:M(u="".concat(e,",")).call(u,c):e},"")},_N=t=>{var e,n,o,c,u;return t===Ne.OVERSEA?M(e=M(n=M(o=M(c=M(u="".concat(Yr.ASIA,",")).call(u,Yr.EUROPE,",")).call(c,Yr.AFRICA,",")).call(o,Yr.NORTH_AMERICA,",")).call(n,Yr.SOUTH_AMERICA,",")).call(e,Yr.OCEANIA):Yr[t]},Ld={GLOBAL:{ASIA:[Ne.CHINA,Ne.JAPAN,Ne.INDIA,Ne.KOREA],EUROPE:[],NORTH_AMERICA:[],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},bc=ue(Ld[Ne.GLOBAL]),Md=[Ne.CHINA,Ne.NORTH_AMERICA,Ne.EUROPE,Ne.ASIA,Ne.JAPAN,Ne.INDIA,Ne.OCEANIA,Ne.SOUTH_AMERICA,Ne.AFRICA,Ne.KOREA],yN=function(t,e){let n=[];if(Xt(t).call(t,Ne.GLOBAL)){const u=[Ne.GLOBAL,Ne.OVERSEA],d=ue(fA);if(e===Ne.GLOBAL)throw new Q(U.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(e===Ne.CHINA)n=[Ne.OVERSEA];else if(c=e,Xt(bc).call(bc,c)){const p=(o=e,Ld[Ne.GLOBAL][o]||[]),f=[...u,e,...p];n=Ot(d).call(d,g=>!Xt(f).call(f,g))}else if(function(p){let f=!1;return G(bc).call(bc,g=>{var E;Xt(E=Ld[Ne.GLOBAL][g]).call(E,p)&&(f=!0)}),f}(e)){const p=function(g){let E;return G(bc).call(bc,I=>{var _;Xt(_=Ld[Ne.GLOBAL][I]).call(_,g)&&(E=I)}),E}(e),f=[...u,p,e];n=Ot(d).call(d,g=>!Xt(f).call(f,g))}else n=t;n=function(p){const f=[];return G(Md).call(Md,g=>{Xt(p).call(p,g)&&f.push(g)}),M(f).call(f,Ot(p).call(p,g=>!Xt(Md).call(Md,g)))}(n)}else n=t;var o,c;return n};async function Ll(t,e,n){return{gatewayInfo:await async function(c,u,d){var p,f;console.log("Agora getGatewayInfo");const g=ht(p=Mr(f=ot("WEBCS_DOMAIN")).call(f,0,ot("AJAX_REQUEST_CONCURRENT"))).call(p,R=>{var w;return{url:c.proxyServer?M(w="https://".concat(c.proxyServer,"/ap/?url=")).call(w,R+"/api/v2/transpond/webrtc?v=2"):"https://".concat(R,"/api/v2/transpond/webrtc?v=2"),areaCode:Bl()}});let E=null;const I=[],_=async()=>await Sa({fragementLength:ot("FRAGEMENT_LENGTH"),referenceList:g,asyncMapHandler:R=>(N.debug("[".concat(c.clientId,"] Connect to choose_server:"),R.url),WC(R,c,u,d)),allFailedhandler:R=>{throw R[0]},promisesCollector:I}),T=async()=>{var R;if(await pn(1e3),E!==null)return E;const w=ht(R=ot("WEBCS_DOMAIN_BACKUP_LIST")).call(R,k=>{var L;return{url:c.proxyServer?M(L="https://".concat(c.proxyServer,"/ap/?url=")).call(L,k+"/api/v2/transpond/webrtc?v=2"):"https://".concat(k,"/api/v2/transpond/webrtc?v=2"),areaCode:Bl()}});return await Sa({fragementLength:ot("FRAGEMENT_LENGTH"),referenceList:w,asyncMapHandler:k=>(N.debug("[".concat(c.clientId,"] Connect to backup choose_server:"),k.url),WC(k,c,u,d)),allFailedhandler:k=>{throw k[0]},promisesCollector:I})};try{return E=await _a([_(),T()]),I.length&&G(I).call(I,R=>R.cancel&&typeof R.cancel=="function"&&R.cancel()),E}catch(R){throw R[0]}}(t,e,n)}}async function mf(t,e,n,o){var c,u;if(t.cloudProxyServer==="disabled"){if(!o)return;if(t.useLocalAccessPoint)return await Ll(t,e,n);const{gatewayInfo:f,proxyInfo:g}=await XC(t,e,n);return t.turnServer&&t.turnServer.mode!=="auto"?(Lt("debug",["Server",t.clientId],"do not set fallback turn because of already having turnserver"),{gatewayInfo:f}):(ot("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&(t.turnServer={mode:"manual",servers:ht(g).call(g,E=>({turnServerURL:E.address,tcpport:E.tcpport||Pr.tcpport,udpport:E.udpport||Pr.udpport,username:E.username||Pr.username,password:E.password||Pr.password,forceturn:ot("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE"),security:!0}))}),{gatewayInfo:f})}let d;if(t.cloudProxyServer==="443only"||t.cloudProxyServer==="normal"){var p;let f;o?t.cloudProxyServer!=="normal"?[f,d]=await ct.all([Pd(t,e,n),Ll(t,e,n)]):(f=await Pd(t,e,n),t.proxyServer=f.addresses[0],it.setProxyServer(t.proxyServer),N.setProxyServer(t.proxyServer),pc(t.proxyServer),d=await Ll(t,e,n)):(d=void 0,t.cloudProxyServer!=="normal"?f=await Pd(t,e,n):(f=await Pd(t,e,n),t.proxyServer=f.addresses[0],it.setProxyServer(t.proxyServer),N.setProxyServer(t.proxyServer),pc(t.proxyServer))),t.turnServer={mode:"manual",servers:ht(p=f.addresses).call(p,g=>({turnServerURL:g,tcpport:t.cloudProxyServer==="proxy3"?void 0:f.serverResponse.tcpport?f.serverResponse.tcpport:Pr.tcpport,udpport:t.cloudProxyServer==="proxy4"?void 0:f.serverResponse.udpport?f.serverResponse.udpport:Pr.udpport,username:f.serverResponse.username||Pr.username,password:f.serverResponse.password||Pr.password,forceturn:t.cloudProxyServer!=="proxy4",security:t.cloudProxyServer==="proxy5"}))}}else{const{proxyInfo:f,gatewayInfo:g}=await XC(t,e,n);d={gatewayInfo:g},t.turnServer={mode:"manual",servers:ht(f).call(f,E=>({turnServerURL:E.address,tcpport:t.cloudProxyServer==="proxy3"?void 0:E.tcpport?E.tcpport:Pr.tcpport,udpport:t.cloudProxyServer==="proxy4"?void 0:E.udpport?E.udpport:Pr.udpport,username:E.username||Pr.username,password:E.password||Pr.password,forceturn:t.cloudProxyServer!=="proxy4",security:t.cloudProxyServer==="proxy5"}))}}return N.debug(M(c=M(u="[".concat(t.clientId,"] set proxy server: ")).call(u,t.proxyServer,", mode: ")).call(c,t.cloudProxyServer)),st("debug",["Server",t.clientId],"setCloudProxyServerAndGetServerInfo",{proxyServer:t.proxyServer,mode:t.cloudProxyServer}),d}async function Ef(t,e,n,o){var c;const u=Mr(c=ot("ACCOUNT_REGISTER")).call(c,0,ot("AJAX_REQUEST_CONCURRENT"));let d=[];return d=e.proxyServer?ht(u).call(u,p=>{var f;return M(f="https://".concat(e.proxyServer,"/ap/?url=")).call(f,p+"/api/v1")}):ht(u).call(u,p=>"https://".concat(p,"/api/v1")),(await async function(p,f,g,E,I){const _=kt(),T={sid:g.sid,opid:10,appid:g.appId,string_uid:f};let R=p[0];const w=await Li(()=>to(R+"".concat(Ft(R).call(R,"?")===-1?"?":"&","action=stringuid"),{data:T,cancelToken:E,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(k,L)=>{if(k.code===0){var Y,Z,rt;if(k.uid<=0||k.uid>=Math.pow(2,32))throw N.error(M(Y="Invalid Uint Uid ".concat(f," => ")).call(Y,k.uid),k),st("error",["AjaxAPI"],"requestUserAccount",M(Z=M(rt="Invalid Uint Uid ".concat(f," => ")).call(rt,k.uid,", ")).call(Z,k)),it.reqUserAccount(T.sid,{lts:_,success:!1,serverAddr:R,stringUid:T.string_uid,uid:k.uid,errorCode:U.INVALID_UINT_UID_FROM_STRING_UID,extend:T}),new Q(U.INVALID_UINT_UID_FROM_STRING_UID);return it.reqUserAccount(T.sid,{lts:_,success:!0,serverAddr:R,stringUid:T.string_uid,uid:k.uid,errorCode:null,extend:T}),!1}const ut=kl(k.code);return ut.retry&&(R=p[(L+1)%p.length]),it.reqUserAccount(T.sid,{lts:_,success:!1,serverAddr:R,stringUid:T.string_uid,uid:k.uid,errorCode:ut.desc,extend:T}),ut.retry},(k,L)=>k.code!==U.OPERATION_ABORTED&&(it.reqUserAccount(T.sid,{lts:_,success:!1,serverAddr:R,stringUid:T.string_uid,uid:null,errorCode:k.code,extend:T}),R=p[(L+1)%p.length],!0),I);if(w.code!==0){const k=kl(w.code);throw new Q(U.UNEXPECTED_RESPONSE,k.desc)}return w}(d,t,e,n,o)).uid}async function Pd(t,e,n){var o,c;let u=kt();const d=ht(o=ot(t.cloudProxyServer==="normal"?"PROXY_CS":"WEBCS_DOMAIN")).call(o,T=>{var R;return t.proxyServer?M(R="https://".concat(t.proxyServer,"/ap/?url=")).call(R,T+"/api/v1"):"https://".concat(T,"/api/v1")});if(t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"||t.cloudProxyServer==="proxy5"){var p;const T=ht(d).call(d,k=>({url:k,areaCode:Bl()}));let R=null;R=await Sa({fragementLength:ot("FRAGEMENT_LENGTH"),referenceList:T,asyncMapHandler:k=>function({url:L,areaCode:Y},Z,rt,ut){const At=kt(),Ct={opid:133,flag:Z.cloudProxyServer==="proxy5"?4194304:1048576,ts:+new Date,key:Z.token,cname:Z.cname,sid:Z.sid,detail:{6:Z.stringUid,11:Y},uid:Z.uid||0};return Li(async()=>await to(L,{data:Ct,cancelToken:rt,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":69}}),lt=>{var Gt;if(lt.code===0)return it.joinWebProxyAP(Z.sid,{lts:At,sucess:1,apServerAddr:L,turnServerAddrList:ht(Gt=lt.addresses).call(Gt,Qt=>Qt.ip).join(","),errorCode:null,eventType:Z.cloudProxyServer}),!1;const wt=kl(lt.code);throw new Q(U.CAN_NOT_GET_GATEWAY_SERVER,wt.desc,{retry:wt.retry})},lt=>{return lt.code!==U.OPERATION_ABORTED&&(lt.code===U.CAN_NOT_GET_GATEWAY_SERVER?(it.joinWebProxyAP(Ct.sid,{lts:At,sucess:0,apServerAddr:L,turnServerAddrList:null,errorCode:lt.code,eventType:Z.cloudProxyServer}),N.warning(M(Gt=M(wt=M(Qt="[".concat(Z.clientId,"] proxy ap server ")).call(Qt,L," failed, message: ")).call(wt,lt.message,", retry: ")).call(Gt,lt.data.retry)),Lt("warning",["AjaxAPI",Z.clientId],M(xt=M(ae="proxy ap server ".concat(L," failed, message: ")).call(ae,lt.message,", retry: ")).call(xt,lt.data.retry)),lt.data.retry):(it.joinWebProxyAP(Ct.sid,{lts:At,sucess:0,apServerAddr:L,turnServerAddrList:null,errorCode:lt.code,eventType:Z.cloudProxyServer}),!0));var Gt,wt,Qt,xt,ae},ut)}(k,t,e,n),allFailedhandler:()=>{throw N.error("[".concat(t.clientId,"] can not get proxy server after trying several times")),new Q(U.CAN_NOT_GET_PROXY_SERVER)}});const w=R.addresses;if(!w||w.length===0)throw N.error("[".concat(t.clientId,"] can not get proxy server, empty proxy server list")),new Q(U.CAN_NOT_GET_PROXY_SERVER,"empty proxy server list");return{addresses:ht(p=ht(w).call(w,k=>k.ip)).call(p,BA),serverResponse:{tcpport:w[0].port||443,udpport:w[0].port||Pr.udpport,username:Pr.username,password:Pr.password}}}let f=null;f=await Sa({fragementLength:ot("FRAGEMENT_LENGTH"),referenceList:d,asyncMapHandler:T=>function(R,w,k,L){const Y=kt(),Z={command:"convergeAllocateEdge",sid:w.sid,appId:w.appId,token:w.token,uid:w.uid,cname:w.cname,ts:Math.floor(kt()/1e3),version:Yn,seq:0,requestId:1};return Li(async()=>({res:await to(R,{data:{service_name:"webrtc_proxy",json_body:at(Z)},cancelToken:k,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}}),url:R}),rt=>{if(!rt.res.json_body)throw N.debug("[".concat(w.clientId,"] Get proxy server failed: no json_body")),st("error",["AjaxAPI",w.clientId],"requestProxyServerList","Get proxy server failed: no json_body"),new Q(U.UNEXPECTED_RESPONSE,at(rt.res));const ut=JSON.parse(rt.res.json_body);var At,Ct,lt;if(ut.code!==200)throw N.debug(M(At=M(Ct="[".concat(w.clientId,"] Get proxy server failed: response code [")).call(Ct,ut.code,"], reason [")).call(At,ut.reason,"]")),st("error",["AjaxAPI",w.clientId],"requestProxyServerList",M(lt="Get proxy server failed: response code [".concat(ut.code,"], reason [")).call(lt,ut.reason,"]")),new Q(U.UNEXPECTED_RESPONSE,at(rt.res));return N.debug("[".concat(w.clientId,"] App return server length"),ut.servers.length),st("debug",["AjaxAPI",w.clientId],"requestProxyServerList","",{length:ut.servers.length}),!1},rt=>rt.code!==U.OPERATION_ABORTED&&(it.requestProxyAppCenter(Z.sid,{lts:Y,succ:!1,APAddr:R,workerManagerList:null,ec:rt.code,response:rt.message}),!0),L)}(T,t,e,n),allFailedhandler:()=>{throw N.error("[".concat(t.clientId,"] can not get proxy server after trying several times")),new Q(U.CAN_NOT_GET_PROXY_SERVER)}});const g=JSON.parse(f.res.json_body),E=ht(c=g.servers).call(c,tb);if(t.cloudProxyServer==="443only")return{addresses:E,serverResponse:{tcpport:443,udpport:Pr.udpport,username:Pr.username,password:Pr.password}};it.requestProxyAppCenter(t.sid,{lts:u,succ:!0,APAddr:f.url,workerManagerList:at(E),ec:null,response:at(f.res)}),u=kt();const I=ht(E).call(E,T=>function(R,w,k,L){const Y=kt();let Z=R;hl(R).call(R,"http")||(Z="https://".concat(R,":4000/v2/machine"));const rt={command:"request",gatewayType:"http",appId:w.appId,cname:w.cname,uid:(w.uid||"").toString(),sdkVersion:"2.3.1",sid:w.sid,seq:1,ts:kt(),requestId:3,clientRequest:{appId:w.appId,cname:w.cname,uid:(w.uid||"").toString(),sid:w.sid}};return Li(async()=>({res:await to(Z,{data:rt,cancelToken:k}),url:R}),ut=>{if(!ut.res.serverResponse)throw new Q(U.UNEXPECTED_RESPONSE,"requeet worker manager server failed: serverResponse is undefined");return!1},ut=>ut.code!==U.OPERATION_ABORTED&&(it.requestProxyWorkerManager(rt.sid,{lts:Y,succ:!1,workerManagerAddr:R,ec:ut.code,response:ut.message}),!0),L)}(T,t,e,n));let _=null;try{_=await _a(I)}catch{throw N.error("[".concat(t.clientId,"] can not get worker manager after trying several times")),new Q(U.CAN_NOT_GET_PROXY_SERVER)}return G(I).call(I,T=>T.cancel()),it.requestProxyWorkerManager(t.sid,{lts:u,succ:!0,workerManagerAddr:_.url,ec:null,response:at(_.res)}),{addresses:[_.url],serverResponse:_.res.serverResponse}}async function SN(t,e,n){var o,c;const u=ht(o=Mr(c=ot("CDS_AP")).call(c,0,ot("AJAX_REQUEST_CONCURRENT"))).call(o,E=>{var I;return t.proxyServer?M(I="https://".concat(t.proxyServer,"/ap/?url=")).call(I,E+"/api/v1"):"https://".concat(E,"/api/v1?action=config")}),d=ht(u).call(u,E=>function(I,_,T,R){const w=Ke(),k={flag:64,cipher_method:0,features:{device:w.name,system:w.os,system_general:navigator.userAgent,vendor:_.appId,version:Yn,cname:_.cname,sid:_.sid,session_id:_.sid,detail:"",proxyServer:_.proxyServer}};return Li(()=>to(I,{data:k,timeout:1e3,cancelToken:T,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,L=>L.code!==U.OPERATION_ABORTED,R)}(E,t,e,n));let p=null,f=null,g={};try{p=await _a(d)}catch(E){if(E.code===U.OPERATION_ABORTED)throw E;f=E}if(G(d).call(d,E=>E.cancel()),it.reportApiInvoke(t.sid,{name:Vt.REQUEST_CONFIG_DISTRIBUTE,options:{error:f,res:p}}).onSuccess(),p&&p.test_tags)try{g=function(E){if(!E.test_tags)return{};const I=E.test_tags,_=ue(I),T={};return G(_).call(_,R=>{var w;const k=ga(w=Mr(R).call(R,4)).call(w),L=JSON.parse(I[R])[1];T[k]=L}),T}(p)}catch{}return g}async function XC(t,e,n){var o,c;console.log("Agora getProxyInfoAndGatewayInfo");const u=ot("PROXY_SERVER_TYPE3"),d=(w,k)=>{var L;let Y=u;return sn(Y)&&(Y=k%2==0?u[1]:u[0]),M(L="https://".concat(Y,"/ap/?url=")).call(L,w)},p=ht(o=Mr(c=ot("WEBCS_DOMAIN")).call(c,0,ot("AJAX_REQUEST_CONCURRENT"))).call(o,(w,k)=>({url:t.cloudProxyServer==="disabled"?"https://".concat(w,"/api/v2/transpond/webrtc?v=2"):d("".concat(w,"/api/v2/transpond/webrtc?v=2"),k),areaCode:Bl(),serviceIds:[Sr.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?Sr.CLOUD_PROXY_5:t.cloudProxyServer==="disabled"?Sr.CLOUD_PROXY_FALLBACK:Sr.CLOUD_PROXY]}));let f=null;const g=[],E=async()=>await Sa({fragementLength:ot("FRAGEMENT_LENGTH"),referenceList:p,asyncMapHandler:w=>(N.debug("[".concat(t.clientId,"] Connect to choose_server:"),w.url),YC(w,t,e,n)),allFailedhandler:w=>{throw w[0]},promisesCollector:g}),I=async()=>{var w;if(await pn(1e3),f!==null)return f;const k=ht(w=ot("WEBCS_DOMAIN_BACKUP_LIST")).call(w,(L,Y)=>({url:t.cloudProxyServer==="disabled"?"https://".concat(L,"/api/v2/transpond/webrtc?v=2"):d("".concat(L,"/api/v2/transpond/webrtc?v=2"),Y),areaCode:Bl(),serviceIds:[Sr.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?Sr.CLOUD_PROXY_5:t.cloudProxyServer==="disabled"?Sr.CLOUD_PROXY_FALLBACK:Sr.CLOUD_PROXY]}));return await Sa({fragementLength:ot("FRAGEMENT_LENGTH"),referenceList:k,asyncMapHandler:L=>(N.debug("[".concat(t.clientId,"] Connect to backup choose_server:"),L.url),YC(L,t,e,n)),allFailedhandler:L=>{throw L[0]},promisesCollector:g})};let _,T,R;try{({gatewayInfo:_,proxyInfo:T,url:R}=await _a([E(),I()]))}catch(w){throw w[0]}if(g.length&&G(g).call(g,w=>w.cancel&&typeof w.cancel=="function"&&w.cancel()),!_||!T)throw new Q(U.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(t.apUrl=R,t.cloudProxyServer!=="disabled"&&sn(u)&&R){const w=new bC(R).host;Xt(u).call(u,w)&&(t.proxyServer=w,N.setProxyServer(w),it.setProxyServer(w),pc(w))}return f={gatewayInfo:_,proxyInfo:await eb(T,_.uid)},f}async function ZC(t,e,n,o){var c,u;const d=ht(c=Mr(u=ot("UAP_AP")).call(u,0,ot("AJAX_REQUEST_CONCURRENT"))).call(c,p=>{var f;return e.proxyServer?M(f="https://".concat(e.proxyServer,"/ap/?url=")).call(f,p+"/api/v1?action=uap"):"https://".concat(p,"/api/v1?action=uap")});return await vN(d,t,e,n,o)}async function TN(t,e,n){var o,c;const u=ht(o=Mr(c=ot("UAP_AP")).call(c,0,ot("AJAX_REQUEST_CONCURRENT"))).call(o,p=>{var f;return t.proxyServer?M(f="https://".concat(t.proxyServer,"/ap/?url=")).call(f,p+"/api/v1?action=uap"):"https://".concat(p,"/api/v1?action=uap")}),d=ht(u).call(u,p=>function(f,g,E,I){const _={command:"convergeAllocateEdge",sid:g.sid,appId:g.appId,token:g.token,ts:kt(),version:Yn,cname:g.cname,uid:g.uid.toString(),requestId:gf,seq:gf};gf+=1;const T={service_name:"tele_channel",json_body:at(_)};return Li(async()=>{var R;const w=await to(f,{data:T,cancelToken:E,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(w.code!==0){const Y=new Q(U.UNEXPECTED_RESPONSE,"cross channel ap error, code"+w.code,{retry:!0});throw N.error(Y.toString()),st("error",["AjaxAPI"],"requestChannelMediaRelayWorkerManager",void 0,Y.toString()),Y}const k=JSON.parse(w.json_body);if(k.code!==200){var L;const Y=new Q(U.UNEXPECTED_RESPONSE,M(L="cross channel app center error, code: ".concat(k.code,", reason: ")).call(L,k.reason));throw N.error(Y.toString()),st("error",["AjaxAPI"],"requestChannelMediaRelayWorkerManager",void 0,Y.toString()),Y}if(!k.servers||k.servers.length===0){const Y=new Q(U.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw N.error(Y.toString()),st("error",["AjaxAPI"],"requestChannelMediaRelayWorkerManager",void 0,Y.toString()),Y}return{vid:k.vid,workerToken:k.workerToken,addressList:ht(R=k.servers).call(R,Y=>{var Z,rt;return M(Z=M(rt="wss://".concat(Y.address.replace(/\./g,"-"),".")).call(rt,ot("WORKER_DOMAIN"),":")).call(Z,Y.wss)})}},void 0,R=>!!(R.code!==U.OPERATION_ABORTED&&R.code!==U.UNEXPECTED_RESPONSE||R.data&&R.data.retry),I)}(p,t,e,n));try{const p=await _a(d);return G(d).call(d,f=>f.cancel()),p}catch(p){throw p[0]}}async function RN(t,e,n){let o=null;const c=[],u=async d=>{var p;const f=ht(p=ot(d?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN")).call(p,g=>{var E;return t.proxyServer?M(E="https://".concat(t.proxyServer,"/ap/?url=")).call(E,g+"/api/v2/transpond/webrtc?v=2"):"https://".concat(g,"/api/v2/transpond/webrtc?v=2")});return d&&(await pn(1e3),o!==null)?o:await Sa({fragementLength:ot("FRAGEMENT_LENGTH"),referenceList:f,asyncMapHandler:g=>{var E;return N.debug(M(E="[".concat(t.clientId,"] update ticket, Connect to ")).call(E,d?"backup":""," choose_server:"),g),function(I,_,T,R){const[w]=CN(_,[Sr.CHOOSE_SERVER]);let k=tn.networkState;return Li(async()=>{k&&tn.networkState===xi.OFFLINE&&tn.onlineWaiter&&await ct.race([tn.onlineWaiter,pn(R&&R.maxRetryTimeout||Cr.maxRetryTimeout)]),k=tn.networkState;const L=await to(I,{data:w,cancelToken:T,headers:{"Content-Type":"multipart/form-data;"}},!0);return IN(L,I)},()=>!1,L=>L.code!==U.OPERATION_ABORTED&&(L.code===U.UPDATE_TICKET_FAILED?L.data.retry:(N.warning("[".concat(_.clientId,"] update ticket network error, retry"),L),Lt("warning",["AjaxAPI",_.clientId],"update ticket network error, retry, ".concat(L)),!0)),R)}(g,t,e,n)},allFailedhandler:g=>{throw g[0]},promisesCollector:c})};try{return o=await _a([u(!1),u(!0)]),c.length&&G(c).call(c,d=>d.cancel&&typeof d.cancel=="function"&&d.cancel()),o}catch(d){throw d[0]}}function $C(t,e){var n=ue(t);if(_e){var o=_e(t);e&&(o=Ot(o).call(o,function(c){return zt(t,c).enumerable})),n.push.apply(n,o)}return n}function t_(t){for(var e=1;e<arguments.length;e++){var n,o=arguments[e]!=null?arguments[e]:{};if(e%2)G(n=$C(Object(o),!0)).call(n,function(u){qr(t,u,o[u])});else if(Ce)dr(t,Ce(o));else{var c;G(c=$C(Object(o))).call(c,function(u){te(t,u,zt(o,u))})}}return t}var wN=function(t,e,n,o){var c,u=arguments.length,d=u<3?e:o===null?o=zt(e,n):o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(t,e,n,o);else for(var p=t.length-1;p>=0;p--)(c=t[p])&&(d=(u<3?c(d):u>3?c(e,n,d):c(e,n))||d);return u>3&&d&&te(e,n,d),d},bN=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};let vf=class extends Gr{constructor(){super(),this.retryConfig={timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4},this.mutex=new Qi("config-distribute"),this.mutableParamsRead=!1}startGetConfigDistribute(t,e){this.joinInfo=t,this.cancelToken=e,this.interval&&this.stopGetConfigDistribute(),this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},ot("CONFIG_DISTRIBUTE_INTERVAL"))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){!this.mutex.isLocked||(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,it.reportApiInvoke(null,{options:void 0,name:Vt.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Ut.TRACER}).onSuccess(at($p))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return N.debug("[config-distribute] get config distribute interrupted have no joininfo"),void st("debug",this,"updateConfigDistribute",void 0,"get config distribute interrupted have no joininfo");let t;const e=await this.mutex.lock();try{t=await SN(this.joinInfo,this.cancelToken,this.retryConfig),N.debug("[config-distribute] get config distribute",at(t)),st("debug",this,"updateConfigDistribute",t),t.limit_bitrate&&this.handleBitrateLimit(t.limit_bitrate),this.cacheGlobalParameterConfig(t),this.configs=t}catch(n){const o=new Q(U.NETWORK_RESPONSE_ERROR,n);N.warning("[config-distribute] ".concat(o.toString())),st("warning",this,"updateConfigDistribute",void 0,n.toString())}finally{e()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(t){var e;(e=t)&&e.uplink&&e.id&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==t.id&&this.emit(El.UPDATE_BITRATE_LIMIT,t):this.emit(El.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&t_({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(t){var e,n;const o=rA(e=Ot(n=ue(t)).call(n,u=>/^webrtc_ng_global_parameter/.test(u))).call(e);for(let u=0;u<o.length;u++)for(let d=o.length-1;d>u;d--){const p=o[d];if(typeof t[p].__priority=="number"){const f=t[p].__priority,g=o[d-1];if(typeof t[g].__priority=="number"){if(!(f>t[g].__priority))continue;{const E=p;o[d]=o[d-1],o[d-1]=E}}else{const E=p;o[d]=o[d-1],o[d-1]=E}}}const c={};G(o).call(o,u=>{var d;const p=t[u],f=p.__expires;G(d=ue(p)).call(d,g=>{g==="__priority"||g==="__expires"||Object.prototype.hasOwnProperty.call(c,g)||(c[g]=t_({value:p[g]},f&&{expires:f}))})});try{const u=at(c),d=window.btoa(u);window.localStorage.setItem("websdk_ng_global_parameter",d),N.debug("Caching global parameters ".concat(u)),st("debug",this,"cacheGlobalParameterConfig",u)}catch(u){N.error("Error caching global parameters:",u.message),st("error",this,"cacheGlobalParameterConfig",void 0,u.message)}}};function e_(t,e){var n=ue(t);if(_e){var o=_e(t);e&&(o=Ot(o).call(o,function(c){return zt(t,c).enumerable})),n.push.apply(n,o)}return n}function If(t){for(var e=1;e<arguments.length;e++){var n,o=arguments[e]!=null?arguments[e]:{};if(e%2)G(n=e_(Object(o),!0)).call(n,function(u){qr(t,u,o[u])});else if(Ce)dr(t,Ce(o));else{var c;G(c=e_(Object(o))).call(c,function(u){te(t,u,zt(o,u))})}}return t}vf=wN([an("ConfigDistributeManager"),bN("design:paramtypes",[])],vf);class NN extends Gr{constructor(e,n,o,c){super(),this.reconnectMode="retry",this.reqId=0,this.commandReqId=0,this.handleWebSocketOpen=()=>{this.reconnectMode="retry",this.startPingPong()},this.handleWebSocketMessage=u=>{if(!u.data)return;const d=JSON.parse(u.data);var p;d.requestId?this.emit(M(p="@".concat(d.requestId,"-")).call(p,d.sid),d):this.serviceMode===Ar.INJECT?this.emit($i.INJECT_STREAM_STATUS,d):(it.workerEvent(this.spec.sid,{actionType:"status",serverCode:d.code,workerType:this.serviceMode===Ar.TRANSCODE?1:2}),this.emit($i.PUBLISH_STREAM_STATUS,d))},this.spec=n,this.token=e,this.serviceMode=c,this.websocket=new Dl("live-streaming",o),this.websocket.on(Be.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Be.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Be.REQUEST_NEW_URLS,(u,d)=>{ro(this,$i.REQUEST_NEW_ADDRESS).then(u).catch(d)}),this.websocket.on(Be.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(e){return this.websocket.init(e)}async request(e,n,o,c){this.reqId+=1,e==="request"&&(this.commandReqId+=1);const u=this.commandReqId,d=this.reqId;if(!d||!this.websocket)throw new Q(U.UNEXPECTED_ERROR);const p=If({command:e,sdkVersion:Yn==="4.9.0"?"0.0.1":Yn,seq:d,requestId:d,allocate:o,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(kt()/1e3)},n);if(this.websocket.state==="closed")throw new Q(U.WS_DISCONNECT);const f=()=>new ct((_,T)=>{this.websocket.once(Be.CLOSED,()=>T(new Q(U.WS_ABORT))),this.websocket.once(Be.CONNECTED,_)});this.websocket.state!=="connected"&&await f(),p.clientRequest&&(p.clientRequest.workerToken=this.token);const g=new ct((_,T)=>{var R;const w=()=>{T(new Q(U.WS_ABORT))};this.websocket.once(Be.RECONNECTING,w),this.websocket.once(Be.CLOSED,w),this.once(M(R="@".concat(d,"-")).call(R,this.spec.sid),k=>{_(k)})});c&&it.workerEvent(this.spec.sid,If({},c,{requestId:u,actionType:"request",payload:at(n.clientRequest),serverCode:0,code:0}));const E=kt();this.websocket.sendMessage(p);let I=null;try{I=await g}catch(_){if(this.websocket.state==="closed")throw _;return await f(),await this.request(e,n,o)}return c&&it.workerEvent(this.spec.sid,If({},c,{requestId:u,actionType:"response",payload:at(I.serverResponse),serverCode:I.code,success:I.code===200,responseTime:kt()-E})),I.code!==200&&this.handleResponseError(I),I}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const e=Yn==="4.9.0"?"0.0.1":Yn;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(kt()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e){switch(e.code){case cr.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void N.warning("live stream response already exists stream");case cr.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case cr.LIVE_STREAM_RESPONSE_BAD_STREAM:case cr.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new Q(U.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case cr.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(e.serverResponse.command==="UnpublishStream"||e.serverResponse.command==="UninjectStream")return;throw new Q(U.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case cr.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new Q(U.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case cr.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new Q(U.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit($i.WARNING,n,e.serverResponse.url)}case cr.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new Q(U.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit($i.WARNING,n,e.serverResponse.url)}case cr.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new Q(U.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case cr.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new Q(U.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case cr.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new Q(U.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit($i.WARNING,n,e.serverResponse.url)}case cr.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new Q(U.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case cr.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new Q(U.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case cr.LIVE_STREAM_RESPONSE_WORKER_LOST:case cr.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(e.serverResponse.command==="UnpublishStream"||e.serverResponse.command==="UninjectStream")return;throw new Q(U.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case cr.ERROR_FAIL_SEND_MESSAGE:if(e.serverResponse.command==="UnpublishStream"||e.serverResponse.command==="UninjectStream")return;if(e.serverResponse.command==="UpdateTranscoding"||e.serverResponse.command==="ControlStream")return new Q(U.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new Q(U.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case cr.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case cr.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case cr.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case cr.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new Q(U.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(_d)},6e3)}}function r_(t,e){var n=ue(t);if(_e){var o=_e(t);e&&(o=Ot(o).call(o,function(c){return zt(t,c).enumerable})),n.push.apply(n,o)}return n}function qs(t){for(var e=1;e<arguments.length;e++){var n,o=arguments[e]!=null?arguments[e]:{};if(e%2)G(n=r_(Object(o),!0)).call(n,function(u){qr(t,u,o[u])});else if(Ce)dr(t,Ce(o));else{var c;G(c=r_(Object(o))).call(c,function(u){te(t,u,zt(o,u))})}}return t}class ON extends Gr{constructor(e,n=Cr,o=Cr){super(),this.retryTimeout=1e4,this.streamingTasks=new tr,this.isStartingStreamingTask=!1,this.taskMutex=new Qi("live-streaming"),this.cancelToken=yo.CancelToken.source(),this.injectConfig=qs({},E2),this.injectLoopTimes=0,this.lastTaskId=1,this.statusError=new tr,this.spec=e,this.httpRetryConfig=o,this.wsRetryConfig=n}async setTranscodingConfig(e){var n;const o=qs({},m2,{},e);var c,u;o.videoCodecProfile!==66&&o.videoCodecProfile!==77&&o.videoCodecProfile!==100&&(N.debug(M(c="[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ")).call(c,o.videoCodecProfile," -> 100")),o.videoCodecProfile=100),o.transcodingUsers||(o.transcodingUsers=o.userConfigs),o.transcodingUsers&&(o.transcodingUsers=ht(u=o.transcodingUsers).call(u,w=>qs({},g2,{},w,{zOrder:w.zOrder?w.zOrder+1:1}))),function(w){var k,L;ze(w.width)||He(w.width,"config.width",0,1e4),ze(w.height)||He(w.height,"config.height",0,1e4),ze(w.videoBitrate)||He(w.videoBitrate,"config.videoBitrate",1,1e6),ze(w.videoFrameRate)||He(w.videoFrameRate,"config.videoFrameRate"),ze(w.lowLatency)||ud(w.lowLatency,"config.lowLatency"),ze(w.audioSampleRate)||Cn(w.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),ze(w.audioBitrate)||He(w.audioBitrate,"config.audioBitrate",1,128),ze(w.audioChannels)||Cn(w.audioChannels,"config.audioChannels",[1,2,3,4,5]),ze(w.videoGop)||He(w.videoGop,"config.videoGop"),ze(w.videoCodecProfile)||Cn(w.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),ze(w.userCount)||He(w.userCount,"config.userCount",0,17),ze(w.backgroundColor)||He(w.backgroundColor,"config.backgroundColor",0,16777215),ze(w.userConfigExtraInfo)||_n(w.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),w.transcodingUsers&&!ze(w.transcodingUsers)&&(nA(w.transcodingUsers,"config.transcodingUsers"),G(k=w.transcodingUsers).call(k,(Y,Z)=>{oA(Y.uid),ze(Y.x)||He(Y.x,"transcodingUser[".concat(Z,"].x"),0,1e4),ze(Y.y)||He(Y.y,"transcodingUser[".concat(Z,"].y"),0,1e4),ze(Y.width)||He(Y.width,"transcodingUser[".concat(Z,"].width"),0,1e4),ze(Y.height)||He(Y.height,"transcodingUser[".concat(Z,"].height"),0,1e4),ze(Y.zOrder)||He(Y.zOrder-1,"transcodingUser[".concat(Z,"].zOrder"),0,100),ze(Y.alpha)||He(Y.alpha,"transcodingUser[".concat(Z,"].alpha"),0,1,!1)})),ze(w.watermark)||hA(w.watermark,"watermark"),ze(w.backgroundImage)||hA(w.backgroundImage,"backgroundImage"),w.images&&!ze(w.images)&&(nA(w.images,"config.images"),G(L=w.images).call(L,(Y,Z)=>{hA(Y,"images[".concat(Z,"]"))}))}(o);const d=[];var p,f;o.images&&d.push(...ht(p=o.images).call(p,w=>qs({},dA,{},w,{zOrder:255}))),o.backgroundImage&&(d.push(qs({},dA,{},o.backgroundImage,{zOrder:0})),delete o.backgroundImage),o.watermark&&(d.push(qs({},dA,{},o.watermark,{zOrder:255})),delete o.watermark),o.images=d,o.transcodingUsers&&(o.userConfigs=ht(f=o.transcodingUsers).call(f,w=>qs({},w)),o.userCount=o.transcodingUsers.length,delete o.transcodingUsers);const g=ht(n=o.userConfigs||[]).call(n,w=>typeof w.uid=="number"?ct.resolve(w.uid):Ef(w.uid,this.spec,this.cancelToken.token,this.httpRetryConfig)),E=await ct.all(g);if(G(E).call(E,(w,k)=>{o.userConfigs&&o.userConfigs[k]&&(o.userConfigs[k].uid=w)}),this.transcodingConfig=o,this.connection)try{var I,_,T;const w=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:ht(I=Ue(Tl(_=this.streamingTasks).call(_))).call(I,k=>k.taskId).join("#")});N.debug(M(T="[".concat(this.spec.clientId,"] update live transcoding config success, code: ")).call(T,w.code,", config:"),at(this.transcodingConfig))}catch(w){var R;if(!w.data||!w.data.retry)throw w;w.data.changeAddress&&this.connection.tryNextAddress(),G(R=this.streamingTasks).call(R,k=>{N.warning("[".concat(this.spec.clientId,"] live streaming receive error"),w.toString(),"try to republish",k.url),this.startLiveStreamingTask(k.url,k.mode,w).then(()=>{var L;N.debug(M(L="[".concat(this.spec.clientId,"] live streaming republish ")).call(L,k.url," success"))}).catch(L=>{N.error("[".concat(this.spec.clientId,"] live streaming republish failed"),k.url,L.toString()),this.onLiveStreamError&&this.onLiveStreamError(k.url,L)})})}}setInjectStreamConfig(e,n){this.injectConfig=Ir({},this.injectConfig,e),this.injectLoopTimes=n}async startLiveStreamingTask(e,n,o){var c,u,d,p;if(yt(c=Ue(Tl(u=this.streamingTasks).call(u))).call(c,_=>_.mode===Ar.INJECT)&&n===Ar.INJECT)return new Q(U.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!this.transcodingConfig&&n===Ar.TRANSCODE)throw new Q(U.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let f={command:"PublishStream",ts:kt(),url:e,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};N.debug(M(d=M(p="[".concat(this.spec.clientId,"] start live streaming ")).call(p,e,", mode: ")).call(d,n));const g=await this.taskMutex.lock();if(!this.connection&&o)return void g();if(this.streamingTasks.get(e)&&!o)return g(),new Q(U.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(_){throw g(),_}switch(n){case Ar.TRANSCODE:f.transcodingConfig=qs({},this.transcodingConfig);break;case Ar.RAW:break;case Ar.INJECT:f={cname:this.spec.cname,command:"InjectStream",sid:this.spec.sid,transcodingConfig:this.injectConfig,ts:kt(),url:e,loopTimes:this.injectLoopTimes}}this.uapResponse&&this.uapResponse.vid&&(f.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const E=this.lastTaskId++;try{var I;const _=new ct((R,w)=>{pn(this.retryTimeout).then(()=>{if(o)return w(o);const k=this.statusError.get(e);return k?(this.statusError.delete(e),w(k)):void 0})}),T=await ct.race([this.connection.request("request",{clientRequest:f},!0,{url:e,command:"PublishStream",workerType:n===Ar.TRANSCODE?1:2,requestByUser:!o,tid:E.toString()}),_]);this.isStartingStreamingTask=!1,N.debug(M(I="[".concat(this.spec.clientId,"] live streaming started, code: ")).call(I,T.code)),this.streamingTasks.set(e,{clientRequest:f,mode:n,url:e,taskId:E}),g()}catch(_){if(g(),this.isStartingStreamingTask=!1,!_.data||!_.data.retry||o)throw _;return _.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(e,n,_)):await this.startLiveStreamingTask(e,n,_)}}stopLiveStreamingTask(e){return new ct((n,o)=>{const c=this.streamingTasks.get(e);if(!c||!this.connection)return new Q(U.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const u=c.mode;c.abortTask=()=>{N.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e),n()},this.connection.request("request",{clientRequest:{command:u===Ar.INJECT?"UninjectStream":"UnpublishStream",url:c.url}},!1,{url:e,command:"UnPublishStream",workerType:u===Ar.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(d=>{var p;N.debug(M(p="[".concat(this.spec.clientId,"] stop live streaming success, code: ")).call(p,d.code)),this.streamingTasks.delete(e),this.streamingTasks.size===0&&u!==Ar.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),n(),u===Ar.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(Fs.INJECT_STREAM_STATUS_STOP_SUCCESS,this.spec.uid,e)}).catch(o)})}async controlInjectStream(e,n,o,c){const u=this.streamingTasks.get(e);if(!u||!this.connection||u.mode!==Ar.INJECT)throw new Q(U.INVALID_OPERATION,"can not find inject stream task to control");return(await this.connection.request("request",{clientRequest:{command:"ControlStream",url:e,control:n,audioVolume:o,position:c}})).serverResponse}resetAllTask(){var e;const n=Ue(Tl(e=this.streamingTasks).call(e));this.terminate();for(const o of n)this.startLiveStreamingTask(o.url,o.mode).catch(c=>{this.onLiveStreamError&&this.onLiveStreamError(o.url,c)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new tr,this.isStartingStreamingTask=!1,this.statusError=new tr,this.cancelToken=yo.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(e){if(this.connection)throw new Q(U.UNEXPECTED_ERROR,"live streaming connection has already connected");const n=await ro(this,Ec.REQUEST_WORKER_MANAGER_LIST,e);return this.uapResponse=n,this.connection=new NN(n.workerToken,this.spec,this.wsRetryConfig,e),this.connection.on($i.WARNING,(o,c)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(c,o)),this.connection.on($i.PUBLISH_STREAM_STATUS,o=>this.handlePublishStreamServer(o)),this.connection.on($i.INJECT_STREAM_STATUS,o=>this.handleInjectStreamServerStatus(o)),this.connection.on($i.REQUEST_NEW_ADDRESS,(o,c)=>{if(!this.connection)return c(new Q(U.UNEXPECTED_ERROR,"can not get new live streaming address list"));ro(this,Ec.REQUEST_WORKER_MANAGER_LIST,e).then(u=>{this.uapResponse=u,o(u.addressList)}).catch(c)}),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(e){const n=e.serverStatus&&e.serverStatus.url||"empty_url",o=this.streamingTasks.get(n),c=e.reason;switch(e.code){case cr.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case cr.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case cr.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case cr.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const d=new Q(U.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(o)return N.error(d.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,d);if(!this.isStartingStreamingTask)return;this.statusError.set(n,d)}case cr.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const d=new Q(U.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,d)}case cr.LIVE_STREAM_RESPONSE_WORKER_LOST:case cr.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var u;if(!this.connection)return;this.connection.tryNextAddress();const d=Ue(Tl(u=this.streamingTasks).call(u));for(const p of d)p.abortTask?p.abortTask():(N.warning("[".concat(this.spec.clientId,"] publish stream status code"),e.code,"try to republish",p.url),this.startLiveStreamingTask(p.url,p.mode,new Q(U.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then(()=>{N.debug("[".concat(this.spec.clientId,"] republish live stream success"),p.url)}).catch(f=>{N.error(f.toString()),this.onLiveStreamError&&this.onLiveStreamError(p.url,f)}));return}}}handleInjectStreamServerStatus(e){const n=Number(e.uid),o=e.serverStatus&&e.serverStatus.url;switch(e.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(Fs.INJECT_STREAM_STATUS_START_SUCCESS,n,o));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(Fs.INJECT_STREAM_STATUS_START_ALREADY_EXISTS,n,o),void this.streamingTasks.delete(o);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(Fs.INJECT_STREAM_STATUS_START_UNAUTHORIZED,n,o),void this.streamingTasks.delete(o);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(Fs.INJECT_STREAM_STATUS_BROKEN,n,o),void this.streamingTasks.delete(o);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(Fs.INJECT_STREAM_STATUS_START_TIMEOUT,n,o),void this.streamingTasks.delete(o);default:return void N.debug("inject stream server status",e)}}hasUrl(e){return this.streamingTasks.has(e)}}class n_{constructor(){this.destChannelMediaInfos=new tr}setSrcChannelInfo(e){FI(e),this.srcChannelMediaInfo=e}addDestChannelInfo(e){FI(e),this.destChannelMediaInfos.set(e.channelName,e)}removeDestChannelInfo(e){iA(e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function i_(t){if(!(t instanceof n_))return new Q(U.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const e=t.getSrcChannelMediaInfo(),n=t.getDestChannelMediaInfo();if(!e)return new Q(U.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new Q(U.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class kN extends Gr{constructor(e,n,o){super(),this.requestId=1,this.onOpen=()=>{this.emit("open"),this.startHeartBeatCheck()},this.onClose=c=>{this.emit("close"),this.dispose()},this.onMessage=c=>{const u=JSON.parse(c.data);if(!u||u.command!=="serverResponse"||!u.requestId)return u&&u.command==="serverStatus"&&u.serverStatus&&u.serverStatus.command?(this.emit("status",u.serverStatus),void this.emit(u.serverStatus.command,u.serverStatus)):void 0;this.emit("req_".concat(u.requestId),u)},this.joinInfo=e,this.clientId=n,this.ws=new Dl("cross-channel-".concat(this.clientId),o),this.ws.on(Be.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Be.CONNECTED,this.onOpen),this.ws.on(Be.ON_MESSAGE,this.onMessage),this.ws.on(Be.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(e){const n=this.requestId++;return e.requestId=n,e.seq=n,this.ws.sendMessage(e),n}waitStatus(e){return new ct((n,o)=>{const c=window.setTimeout(()=>{o(new Q(U.TIMEOUT,"wait status timeout, status: ".concat(e)))},5e3);this.once(e,u=>{window.clearTimeout(c),u.state&&u.state!==0?o(new Q(U.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(c),o(new Q(U.WS_ABORT))})})}async request(e){if(this.ws.state==="closed")throw new Q(U.WS_DISCONNECT);const n=()=>new ct((d,p)=>{this.ws.once(Be.CLOSED,()=>p(new Q(U.WS_ABORT))),this.ws.once(Be.CONNECTED,d)});this.ws.state!=="connected"&&await n();const o=this.sendMessage(e),c=new ct((d,p)=>{const f=()=>{p(new Q(U.WS_ABORT))};this.ws.once(Be.RECONNECTING,f),this.ws.once(Be.CLOSED,f),this.once("req_".concat(o),d),pn(3e3).then(()=>{this.removeAllListeners("req_".concat(o)),this.ws.off(Be.RECONNECTING,f),this.ws.off(Be.CLOSED,f),p(new Q(U.TIMEOUT,"cross channel ws request timeout"))})}),u=await c;if(!u||u.code!==200)throw new Q(U.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(at(u)));return u}async connect(e){this.ws.removeAllListeners(Be.REQUEST_NEW_URLS),this.ws.on(Be.REQUEST_NEW_URLS,n=>{n(e)}),await this.ws.init(e)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e){const n=this.requestId++;return e.requestId=n,this.ws.sendMessage(e),n}startHeartBeatCheck(){this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class DN extends Gr{constructor(e,n,o,c){super(),this.cancelToken=yo.CancelToken.source(),this.requestId=0,this._state=Bn.RELAY_STATE_IDLE,this.errorCode=Vs.RELAY_OK,this.onStatus=u=>{var d;N.debug(M(d="[".concat(this.clientId,"] ChannelMediaStatus: ")).call(d,at(u))),u&&u.command&&(u.command==="onAudioPacketReceived"&&this.emit("event",So.PACKET_RECEIVED_AUDIO_FROM_SRC),u.command==="onVideoPacketReceived"&&this.emit("event",So.PACKET_RECEIVED_VIDEO_FROM_SRC),u.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=Vs.SRC_TOKEN_EXPIRED,this.state=Bn.RELAY_STATE_FAILURE),u.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=Vs.DEST_TOKEN_EXPIRED,this.state=Bn.RELAY_STATE_FAILURE))},this.onReconnect=async()=>{N.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",So.NETWORK_DISCONNECTED),this.state=Bn.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(u=>{this.state!==Bn.RELAY_STATE_IDLE&&(N.error("auto restart channel media relay failed",u.toString()),this.errorCode=Vs.SERVER_CONNECTION_LOST,this.state=Bn.RELAY_STATE_FAILURE)})},this.joinInfo=e,this.clientId=n,this.signal=new kN(this.joinInfo,this.clientId,o),this.httpRetryConfig=c}set state(e){e!==this._state&&(e!==Bn.RELAY_STATE_FAILURE&&(this.errorCode=Vs.RELAY_OK),this.emit("state",e,this.errorCode),this._state=e)}get state(){return this._state}async startChannelMediaRelay(e){if(this.state!==Bn.RELAY_STATE_IDLE)throw new Q(U.INVALID_OPERATION);this.state=Bn.RELAY_STATE_CONNECTING,await this.connect(),N.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(e)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new Q(U.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new Q(U.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new Q(U.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=e}async updateChannelMediaRelay(e){if(this.state!==Bn.RELAY_STATE_RUNNING)throw new Q(U.INVALID_OPERATION);await this.sendUpdateMessage(e),this.prevChannelMediaConfig=e}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),N.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Bn.RELAY_STATE_IDLE,this.dispose()}dispose(){N.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=yo.CancelToken.source(),this.state=Bn.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const e=await TN(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=e.workerToken,await this.signal.connect(e.addressList),this.emit("event",So.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(e){const n=this.genMessage(yn.StopPacketTransfer);await this.signal.request(n),await this.signal.waitStatus("Normal Quit"),N.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const o=this.genMessage(yn.SetSdkProfile,e);await this.signal.request(o),N.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const c=this.genMessage(yn.SetSourceChannel,e);await this.signal.request(c),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",So.PACKET_JOINED_SRC_CHANNEL),N.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const u=this.genMessage(yn.SetSourceUserId,e);await this.signal.request(u),N.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const d=this.genMessage(yn.SetDestChannel,e);await this.signal.request(d),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",So.PACKET_JOINED_DEST_CHANNEL),N.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const p=this.genMessage(yn.StartPacketTransfer,e);await this.signal.request(p),this.emit("event",So.PACKET_SENT_TO_DEST_CHANNEL),this.state=Bn.RELAY_STATE_RUNNING,N.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success"))}async sendUpdateMessage(e){const n=this.genMessage(yn.UpdateDestChannel,e);await this.signal.request(n),this.emit("event",So.PACKET_UPDATE_DEST_CHANNEL),N.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const e=this.genMessage(yn.StopPacketTransfer);await this.signal.request(e),N.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(e,n){const o=[],c=[],u=[];this.requestId+=1;const d={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Yn,sid:this.joinInfo.sid,ts:kt(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};d.sdkVersion==="4.9.0"&&(d.sdkVersion="0.0.1");let p=null,f=null;switch(e){case yn.SetSdkProfile:return d.clientRequest={command:"SetSdkProfile",type:"multi_channel"},d;case yn.SetSourceChannel:if(f=n&&n.getSrcChannelMediaInfo(),!f)throw new Q(U.UNEXPECTED_ERROR,"can not find source config");return d.clientRequest={command:"SetSourceChannel",uid:"0",channelName:f.channelName,token:f.token||this.joinInfo.appId},d;case yn.SetSourceUserId:if(f=n&&n.getSrcChannelMediaInfo(),!f)throw new Q(U.UNEXPECTED_ERROR,"can not find source config");return d.clientRequest={command:"SetSourceUserId",uid:f.uid+""},d;case yn.SetDestChannel:if(p=n&&n.getDestChannelMediaInfo(),!p)throw new Q(U.UNEXPECTED_ERROR,"can not find dest config");return G(p).call(p,g=>{o.push(g.channelName),c.push(g.uid+""),u.push(g.token||this.joinInfo.appId)}),d.clientRequest={command:"SetDestChannel",channelName:o,uid:c,token:u},d;case yn.StartPacketTransfer:return d.clientRequest={command:"StartPacketTransfer"},d;case yn.Reconnect:return d.clientRequest={command:"Reconnect"},d;case yn.StopPacketTransfer:return d.clientRequest={command:"StopPacketTransfer"},d;case yn.UpdateDestChannel:if(p=n&&n.getDestChannelMediaInfo(),!p)throw new Q(U.UNEXPECTED_ERROR,"can not find dest config");return G(p).call(p,g=>{o.push(g.channelName),c.push(g.uid+""),u.push(g.token||this.joinInfo.appId)}),d.clientRequest={command:"UpdateDestChannel",channelName:o,uid:c,token:u},d}return d}}var BN=function(t,e,n,o){var c,u=arguments.length,d=u<3?e:o===null?o=zt(e,n):o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(t,e,n,o);else for(var p=t.length-1;p>=0;p--)(c=t[p])&&(d=(u<3?c(d):u>3?c(e,n,d):c(e,n))||d);return u>3&&d&&te(e,n,d),d},LN=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};let xd=class{constructor(t){this.freezeTimeCounterList=[],this.timeUpdatedCount=0,this.freezeTime=0,this.playbackTime=0,this.lastTimeUpdatedTime=0,this._videoElementStatus=cn.NONE,this.isGettingVideoDimensions=!1,this.handleVideoEvents=e=>{switch(e.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=cn.PLAYING;break;case"loadeddata":this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded();break;case"canplay":this.videoElementStatus=cn.CANPLAY;break;case"stalled":this.videoElementStatus=cn.STALLED;break;case"suspend":this.videoElementStatus=cn.SUSPEND;break;case"pause":this.videoElementStatus=cn.PAUSED,!vi()&&!cs()&&this.videoElement&&this.videoTrack&&this.videoTrack.readyState==="live"&&(N.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),Lt("debug",this,"video element paused, auto resume"),this.videoElement.play());break;case"waiting":this.videoElementStatus=cn.WAITING;break;case"abort":this.videoElementStatus=cn.ABORT;break;case"ended":this.videoElementStatus=cn.ENDED;break;case"emptied":this.videoElementStatus=cn.EMPTIED;break;case"timeupdate":{const n=kt();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=n);const o=n-this.lastTimeUpdatedTime;for(this.lastTimeUpdatedTime=n,o>500&&(this.freezeTime+=o),this.playbackTime+=o;this.playbackTime>=6e3;)this.playbackTime-=6e3,this.freezeTimeCounterList.push(Math.min(6e3,this.freezeTime)),this.freezeTime=Math.max(0,this.freezeTime-6e3);break}}},this.startGetVideoDimensions=()=>{const e=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement&&this.videoElement.videoWidth*this.videoElement.videoHeight>4)return N.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),st("debug",this,"startGetVideoDimensions",{videoWidth:this.videoElement.videoWidth,videoHeight:this.videoElement.videoHeight}),void(this.isGettingVideoDimensions=!1);Vr(e,500)};!this.isGettingVideoDimensions&&e()},this.autoResumeAfterInterruption=()=>{this.videoElement&&this.videoTrack&&this.videoTrack.readyState==="live"&&he.curState==="running"&&(Qp()?(N.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15.2")),this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):iI()?(N.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15.1")),this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):nI()&&(N.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15.0")),this.videoElement.pause(),this.videoElement.play()))},this.autoResumeAfterInterruptionOnIOS15=()=>{this.videoElement&&this.videoTrack&&this.videoTrack.readyState==="live"&&(Qp()?(N.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15.2")),this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):iI()?(N.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15.1")),this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):nI()&&(N.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15.0")),this.videoElement.pause(),this.videoElement.play()))},this.slot=t.element,this.trackId=t.trackId,this.updateConfig(t),he.on(Rr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),he.on(Rr.IOS_15_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15)}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(t){var e,n,o;t!==this._videoElementStatus&&(N.debug(M(e=M(n="[".concat(this.trackId,"] video-element-status change ")).call(n,this._videoElementStatus," => ")).call(e,t)),ls("debug",["HTMLVideoElement",this.trackId],"statusChange",M(o="".concat(this._videoElementStatus," => ")).call(o,t)),this._videoElementStatus=t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const e=t.element;e!==this.slot&&(this.destroy(),this.slot=e),this.createElements()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){if(this.videoElement){const e=this.videoElement.play();e&&e.catch&&e.catch(o=>{t&&it.autoplayFailed(t,"video",o.message,this.trackId),st("warning",this,"play",o.toString(),"error"),o.name==="NotAllowedError"?(N.warning("detected video element autoplay failed",o),this.handleAutoPlayFailed()):N.warning("[".concat(this.trackId,"] play warning: "),o)});const n=Ke();if((n.name==="Safari"&&Number(n.version)===15||lc())&&e&&e.then&&e.catch){const o=()=>{this.config.mirror&&this.videoElement&&(this.videoElement.style.transform="rotateY(180deg)")};e.then(o).catch(o)}}}getCurrentFrame(){if(!this.videoElement)return new ImageData(2,2);const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const e=t.getContext("2d");if(!e)return N.error("create canvas context failed!"),st("error",this,"getCurrentFrame","create canvas context failed!","error"),new ImageData(2,2);e.drawImage(this.videoElement,0,0,t.width,t.height);const n=e.getImageData(0,0,t.width,t.height);return t.remove(),n}destroy(){if(he.off(Rr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),he.off(Rr.IOS_15_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15),this.videoElement&&(this.videoElement.srcObject=null,this.videoElement.remove(),this.videoElement=void 0),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}this.freezeTimeCounterList=[]}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",this.createVideoElement(),this.container.appendChild(this.videoElement)):this.removeVideoElement(),this.slot.appendChild(this.container)}createVideoElement(){this.videoElement||(this.videoElementStatus=cn.INIT,this.videoElement=document.createElement("video"),this.videoElement.onerror=()=>this.videoElementStatus=cn.ERROR,this.container&&this.container.appendChild(this.videoElement),G(Ud).call(Ud,n=>{this.videoElement&&this.videoElement.addEventListener(n,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{!document.getElementById("video_".concat(this.trackId))&&this.videoElement&&(this.videoElementStatus=cn.DESTROYED)},1e3)),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),this.videoElement.style.left="0",this.videoElement.style.top="0";const t=Ke();t.name==="Safari"&&Number(t.version)===15||lc()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,si()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,si()&&this.videoElement.load());const e=this.videoElement.play();e!==void 0&&e.catch(n=>{N.debug("[".concat(this.trackId,"] playback interrupted"),n.toString()),Lt("debug",this,"play back interrupted: ".concat(n.toString()))})}removeVideoElement(){if(this.videoElement){G(Ud).call(Ud,t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0);try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=void 0,this.videoElementStatus=cn.NONE}}handleAutoPlayFailed(){const t=Ke();if(this.videoElement){const e=n=>{n.preventDefault(),this.videoElement&&(this.videoElement.play().then(()=>{var o;N.debug(M(o="[".concat(this.trackId,"] Video element for trackId:")).call(o,this.trackId," autoplay resumed.")),Lt("debug",this,"video element autoplay resumed")}).catch(o=>{N.error(o)}),t.os!=="Android"||t.name!=="Chrome"&&t.name!==be.WECHAT?(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0)):document.body.removeEventListener("click",e,!0))};t.os!=="Android"||t.name!=="Chrome"&&t.name!==be.WECHAT?(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)):document.body.addEventListener("click",e,!0),s1()}}getVideoElement(){return this.videoElement}getContainerElement(){return this.container}};xd=BN([an("AgoraRTCPlayer","trackId"),LN("design:paramtypes",[Object])],xd);const Ud=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate"];function MN(t,e,n){const o=t.createShader(n);if(!o)return new Q(U.WEBGL_INTERNAL_ERROR,"can not create shader").throw();if(t.shaderSource(o,e),t.compileShader(o),!t.getShaderParameter(o,t.COMPILE_STATUS)){const c=t.getShaderInfoLog(o);return t.deleteShader(o),new Q(U.WEBGL_INTERNAL_ERROR,"error compiling shader:"+c).throw()}return o}function PN(t,e,n,o){const c=[];for(let u=0;u<e.length;++u){const d=u===0?t.VERTEX_SHADER:t.FRAGMENT_SHADER;c.push(MN(t,e[u],d))}return function(u,d,p,f){const g=u.createProgram();if(!g)throw new Q(U.WEBGL_INTERNAL_ERROR,"can not create webgl program");if(G(d).call(d,E=>{u.attachShader(g,E)}),p&&G(p).call(p,(E,I)=>{u.bindAttribLocation(g,f?f[I]:I,E)}),u.linkProgram(g),!u.getProgramParameter(g,u.LINK_STATUS)){const E=u.getProgramInfoLog(g);throw u.deleteProgram(g),new Q(U.WEBGL_INTERNAL_ERROR,"error in program linking:"+E)}return g}(t,c,n,o)}var o_;!document.documentMode&&!!window.StyleMedia&&(HTMLCanvasElement.prototype.getContext=(o_=HTMLCanvasElement.prototype.getContext,function(){let t=arguments;return t[0]==="webgl"&&(t=Mr([]).call(arguments),t[0]="experimental-webgl"),o_.apply(null,t)}));const xN=[31,222,239,159,192,236,164,81,54,227,176,149,2,247,75,141,183,54,213,216,158,92,111,49,228,111,150,6,135,79,35,212,4,155,200,168,37,107,243,110,144,179,51,81,55,78,223,242,191,211,74,119,203,151,142,62,31,41,132,22,35,155,87,123,119,117,216,57,201,53,228,67,201,40,106,24,80,176,187,253,60,63,136,100,20,12,177,99,64,38,101,143,111,176,251,211,145,136,34,23,79,136,202,95,105,199,125,67,180,44,210,179,228,4,85,160,188,64,26,46,6,61,201,103,248,18,97,254,140,36,115,106,48,124,102,216,155,120,36,227,165,217,7,227,191,128,212,157,80,37,117,175,24,214,47,221,183,211,51,174,251,223,159,167,152,53,36,107,199,223,91,62,46,194,11,80,121,188,219,2,99,99,232,229,173,234,21,30,236,177,243,142,97,48,108,56,62,172,56,216,3,42,79,138,23,88,182,39,5,118,68,135,178,56,9,94,189,44,104,9,238,231,174,122,85,247,231,86,74,8,189,147,218,180,58,76,227,17,46,90,194,100,51,178,72,163,151,243,166,130,85,1,223,130,152,242,85,255,28,173,97,252,119,215,177,119,86,104,136,82,40,72,53,11,18,26,240,188,76,110,39,31,189];function s_(t){const e=new Uint8Array([99,114,121,112,116,105,105]),n=e.length,o=t,c=o.length,u=new Uint8Array(c),d=new Uint8Array(256);for(let I=0;I<256;I++)d[I]=I;let p=0;for(let I=0;I<256;I++)p=(p+d[I]+e[I%n])%256,[d[I],d[p]]=[d[p],d[I]];let f,g=0;p=0;for(let I=0;I<0+c;I++)g=(g+1)%256,p=(p+d[g])%256,[d[g],d[p]]=[d[p],d[g]],f=d[(d[g]+d[p])%256],I>=0&&(u[I-0]=o[I-0]^f);const E=String.fromCharCode.apply(null,Ue(u));return Function("var winSize = 5; return `"+E+"`")()}const UN=[11,196,242,139,198,252,188,5,59,170,161,152,17,229,24,141,133,54,214,206,133,26,66,126,255,11,245,10,146,92,52,134,108,152,221,191,124,116,248,106,130,251,59,105,43,91,135,199,181,223,10,51,134,194,240,46,9,3,141,22,35,146,76,23,109,117,208,41,201,45,218,76,203,105,51,58,97,154,145,236,49,18,183,127,27,12,210,122,73,42,37,143,36,207,251,211,145,191,56,10,88,222,181,125,22,238,123,71,177,107,218,254,173,28,34,253,249,67,83,97,73,111,219,43,181,82,38,230,136,109,22,67];class a_{constructor(e,n){this.gl=e,this.kernel=n||UN,this.program=function(o,c){const u=s_(c),d=PN(o,[s_(xN),u]);{const p=o.getAttribLocation(d,"a_position"),f=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,f),o.bufferData(o.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),o.STATIC_DRAW),o.enableVertexAttribArray(p);const g=2,E=o.FLOAT,I=!1,_=0,T=0;o.vertexAttribPointer(p,g,E,I,_,T)}{const p=o.getAttribLocation(d,"a_texCoord"),f=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,f),o.bufferData(o.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),o.STATIC_DRAW),o.enableVertexAttribArray(p);const g=2,E=o.FLOAT,I=!1,_=0,T=0;o.vertexAttribPointer(p,g,E,I,_,T)}return d}(this.gl,this.kernel)}setUniforms(){const e=this.gl.getUniformLocation(this.program,"u_flipY");this.gl.uniform1f(e,1)}}class ms extends a_{constructor(e,n,o,c){super(e,n),this.denoiseLevel=5,this.xOffset=1/o,this.yOffset=1/c}setUniforms(){const e=this.gl.getUniformLocation(this.program,"u_flipY"),n=this.gl.getUniformLocation(this.program,"u_singleStepOffset"),o=this.gl.getUniformLocation(this.program,"u_denoiseLevel");this.gl.uniform2f(n,this.xOffset,this.yOffset),this.gl.uniform1f(o,this.denoiseLevel),this.gl.uniform1f(e,1)}setParameters(e){e.denoiseLevel!==void 0&&(this.denoiseLevel=e.denoiseLevel)}setSize(e,n){this.xOffset=1/e,this.yOffset=1/n}}const QN=[11,196,242,139,198,252,188,5,59,170,161,152,17,229,24,141,133,54,214,206,133,26,66,126,255,11,245,10,146,92,52,134,108,155,210,164,99,114,228,96,130,251,59,105,43,91,135,199,181,223,10,51,133,194,247,34,31,39,142,28,2,130,18,109,84,124,223,62,140,52,128,47,208,47,115,39,4,200,220,171,53,36,150,101,10,75,247,121,74,36,35,143,108,176,235,211,135,164,36,11,88,160,148,35,6,221,41,32,166,109,205,171,228,4,26,169,244,82,119,102,86,61,201,103,248,18,97,242,182,34,121,70,28,71,126,197,223,126,14,244,149,192,12,176,187,149,212,156,22,44,36,133,10,216,63,198,213,154,116,230,253,154,154,249,215,55,60,34,196,229,76,50,44,135,22,77,113,247,142,94,60,23,172,145,175,218,81,86,162,239,180,205,63,118,3,110,123,224,127,158,124,15,127,157,27,66,176,33,24,51,53,194,178,56,6,74,191,111,51,78,174,157,229,17,22,178,231,92,25,23,191,157,137,188,54,64,176,13,22,81,207,45,108,203,83,186,130,237,186,153,110,8,196,168,152,161,28,238,46,184,36,185,20,203,183,98,95,41,149,93,105,37,116,91,68,105,164,217,30,42,60,53,173,213,177,216,195,53,204,173,128,243,42,122,205,65,97,129,194,68,218,91,141,11,224,124,132,138,119,36,220,161,39,214,146,183,193,225,23,177,201,243,128,160,33,75,86,126,139,254,232,14,13,85,2,112,17,150,36,180,86,226,225,126,197,17,228,225,142,245,37,170,39,96,187,190,2,35,85,237,11,189,1,79,237,2,1,114,246,109,190,66,54,153,43,218,204,70,6,204,162,247,18,130,123,30,60,165,130,142,210,133,91,127,117,71,38,145,172,7,5,16,220,222,111,98,141,239,208,125,26,238,28,0,216,89,13,7,119,134,194,75,41,67,174,1,217,80,101,40,26,59,28,59,46,108,138,38,157,167,28,234,73,177,42,42,102,108,26,181,27,178,42,43,52,28,110,117,198,173,176,178,101,225,150,36,139,108,105,10,237,222,3,143,126,18,144,115,74,56,114,134,231,159,212,62,126,80,173,216,167,4,81,18,52,17,144,218,32,139,207,104,128,229,99,84,120,31,87,227,154,91,196,63,123,111,125,36,52,57,168,113,150,189,204,24,104,196,237,86,163,68,197,202,170,212,191,81,193,111,255,162,181,202,156,146,196,96,16,118,117,55,71,156,31,163,242,204,239,11,150,27,126,115,154,107,247,134,158,125,255,146,35,183,209,36,116,87,215,172,5,251,133,114,254,141,195,6,145,4,111,182,167,74,154,152,68,18,146,88,106,200,154,15,176,94,86,66,178,101,219,35,188,129,66,28,41,110,174,53,88,174,64,191,206,127,48,126,214,216,93,119,2,166,99,181,222,29,218,28,195,219,125,44,50,16,99,174,225,51,133,120,184,159,168,75,242,162,124,255,81,25,153,109,69,220,176,4,237,196,233,19,8,240,160,39,122,81,29,188,144,249,170,174,137,30,10,93,133,151,199,248,175,38,41,144,229,245,149,25,240,138,179,114,182,84,50,103,95,31,199,31,87,208,203,199,135,49,211,43,52,36,74,59,37,22,136,171,244,126,18,251,39,159,241,66,206,127,149,159,182,143,232,199,136,46,150,32,51,221,74,22,102,93,22,44,132,140,199,43,69,249,77,75,140,70,4,252,98,235,77,190,125,18,56,21,10,244,42,2,246,62,127,241,123,137,22,247,219,177,160,84,18,10,84,97,251,127,102,16,209,181,100,94,56,238,209,207,76,189,95,15,165,139,143,189,96,225,55,112,178,27,218,198,223,251,52,123,94,130,220,142,216,116,237,18,254,49,59,128,41,29,15,179,164,85,76,167,166,151,39,221,2,190,68,167,26,177,114,141,4,67,25,69,182,38,166,160,27,151,148,108,48,227,60,112,48,22,159,76,127,251,63,254,177,113,217,197,95,179,109,128,138,99,27,249,10,174,155,129,80,39,165,252,85,60,131,183,98,107,68,207,19,233,231,55,225,126,77,49,53,145,203,113,29,208,64,237,182,229,165,7,11,169,106,253,116,141,200,62,16,38,121,55,148,91,83,160,140,126,121,12,79,189,72,172,31,243,240,209,229,32,220,91,229,81,94,247,121,153,151,232,182,171,198,50,31,152,245,172,151,130,55,62,125,38,155,229,78,207,148,201,2,78,63,119,107,168,78,139,141,163,177,191,239,141,39,182,174,40,76,226,62,125,209,6,6,34,37,147,85,204,103,51,191,36,248,17,175,20,1,53,16,35,143,237,177,125,86,29,219,235,20,121,205,59,5,250,107,109,32,224,30,152,143,113,151,95,85,19,254,164,135,124,68,136,199,29,31,244,91,10,84,127,101,210,70,226,195,140,70,166,54,217,165,84,42,165,175,100,234,124,121,105,53,101,118,174,101,220,147,68,161,37,0,182,220,142,221,155,230,115,164,10,214,208,120,91,152,66,27,81,184,48,84,70,7,128,153,217,218,249,226,70,130,200,156,61,227,21,164,137,193,221,119,10,134,204,23,20,17,90,94,105,204,39,99,1,64,153,45,213,19,247,97,194,49,35,125,255,195,139,63,209,175,208,147,189,244,204,24,211,99,142,18,92,130,254,182,231,235,93,10,127,175,87,35,62,110,137,184,39,114,200,150,11,190,40,162,168,223,203,110,242,192,234,26,11,54,155,38,48,79,109,101,119,165,187,223,5,20,168,171,241,20,243,108,199,3,155,69,244,149,0,187,110,12,233,42,151,189,139,133,104,3,30,16,200,69,4,123,103,144,12,106,182,1,127,91,125,158,12,144,238,232,209,101,159,56,163,240,179,50,169,120,219,176,87,77,45,247,153,190,82,132,50,137,209,97,19,35,247,161,62,77,16,71,152,72,61,50,99,157,154,56,58,175,27,73,121,229,195,228,132,69,233,169,100,21,123,17,3,164,6,146,106,196,29,3,250,217,164,23,171,203,14,242,239,249,169,116,138,209,98,113,181,122,35,162,216,46,230,4,155,142,118,216,232,229,28,12,158,153,126,149,171,172,231,99,211,57,114,136,183,114,74,35,233,115,127,253,157,38,49,136,141,25,161,255,232,110,101,208,166,186,226,12,185,19,155,53,93,155,39,161,7,124,213,52,223,125,211,242,253,22,13,131,115,167,198,188,90,209,63,224,92,112,118,220,165,31,164,43,58,197,77,17,247,77,164,74,77,218,18,187,41,76,189,127,98,18,226,231,71,115,236,68,183,111,50,168,88,247,9,123,65,180,88,74,44,101,101,173,11];class FN extends ms{constructor(e,n,o){super(e,QN,n,o)}}const VN=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,165,108,122,254,125,130,229,55,109,113,11,210,238,163,213,86,116,156,248,215,63,20,48,173,31,55,133,18,105,32,16,204,35,128,38,212,87,200,97,114,40,12,210,193,171,59,33,158,108,14,75,228,74,65,32,57,192,112,156,234,250,140,189,40,20,6,230,135,52,17,200,123,68,183,44,215,187,234,2,13,169,234,94,115,60,6,107,224,118,254,88,2,235,134,36,120,5,85,94,126,222,223,101,105,227,147,199,64,185,246,143,183,210,30,37,127,226,79,156,118,147,208,131,51,248,232,217,206,181,218,58,61,112,244,227,68,45,41,206,69,12,45,163,205,75,6,23,167,145,250,237,92,84,164,240,253,216,54,85,7,108,62,255,42,217,3,27,0,196,94,28,241,120,80,92,89,135,228,125,2,3,242,39,116,64,248,216,177,122,66,178,180,9,7,33,186,208,213,188,59,78,243,95,123,28,142,45,99,130,7,167,194,156,238,199,10,71,141,251,221,158,16,255,38,181,36,184,20,136,240,55,27,51,191,82,105,55,97,78,74,121,191,161,91,126,105,103,174,139,223,145,150,120,156,240,252,182,105,104,205,65,97,129,194,68,218,91,141,11,224,124,132,138,119,36,201,211,39,203,146,225,246,252,21,161,250,188,137,190,42,4,90,126,211,171,240,113,67,28,92,57,77,200,125,224,19,178,142,112,202,5,233,229,128,235,105,239,102,52,179,224,87,45,68,211,10,187,9,38,190,86,25,43,175,56,231,11,108,220,36,129,131,19,93,163,239,169,118,205,50,77,121,139,139,141,197,170,20,44,39,19,97,205,228,8,106,67,210,135,111,127,141,185,175,123,26,226,42,29,217,16,99,9,46,157,232,22,3,105,174,73,144,23,110,55,84,46,4,116,39,113,205,58,158,242,7,208,75,162,55,115,35,52,124,235,114,178,55,43,98,17,100,33,134,237,190,230,60,184,192,104,146,52,58,79,174,180,81,155,114,0,153,113,90,51,86,150,254,136,205,104,39,11,190,187,233,80,81,81,56,18,222,148,116,155,156,33,132,226,127,84,34,83,28,249,153,18,197,10,116,102,125,45,47,36,235,46,212,166,209,3,125,132,237,124,163,68,197,202,232,152,234,75,235,103,248,160,241,213,151,144,130,37,23,51,48,55,12,227,31,163,242,251,245,22,129,77,20,35,150,20,181,203,138,69,233,215,109,178,209,52,85,96,221,179,56,249,138,111,250,141,134,95,152,92,109,183,174,104,151,156,31,66,211,10,57,141,167,18,177,27,126,74,252,29,143,121,173,203,8,27,44,123,148,57,88,163,68,228,158,62,98,121,192,228,94,92,72,241,33,230,173,0,197,1,194,144,111,91,60,0,106,181,203,51,133,120,250,158,184,93,216,184,126,253,21,22,155,99,80,205,227,69,231,141,165,71,70,252,223,105,51,93,22,165,135,233,177,164,139,53,5,85,151,134,214,165,249,100,24,186,207,245,149,68,218,204,252,32,190,90,48,76,57,31,201,15,52,130,135,152,206,63,198,100,126,36,2,104,116,0,160,163,186,2,91,165,57,149,163,12,239,121,152,209,224,136,248,135,136,46,150,32,51,154,6,105,0,71,30,44,175,147,139,34,91,184,78,31,145,18,3,250,122,166,47,252,109,19,40,10,123,163,99,76,133,119,37,180,38,207,79,171,185,188];class GN extends ms{constructor(e,n,o){super(e,VN,n,o)}}const jN=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,160,96,121,255,120,207,227,114,120,38,72,149,145,165,227,75,122,158,250,232,46,34,52,135,9,30,144,17,110,126,110,130,71,156,46,210,67,202,51,119,97,3,211,214,227,45,109,151,97,21,10,229,53,80,26,51,202,119,128,230,197,140,135,40,14,88,128,202,95,21,208,96,83,185,98,216,242,224,15,25,224,233,86,96,46,80,120,220,48,187,86,30,240,140,46,95,81,48,90,117,140,177,51,107,235,158,137,5,241,191,154,149,219,30,126,85,175,10,216,63,139,216,151,122,251,224,202,220,227,221,53,122,34,213,224,94,45,14,200,68,31,61,175,208,17,120,82,244,138,208,165,21,19,236,232,180,217,50,74,70,126,114,227,62,192,124,9,85,148,33,77,255,117,75,102,87,151,255,87,74,74,181,111,108,9,249,220,174,59,80,254,168,29,30,94,171,133,133,195,105,64,254,68,65,18,158,54,73,203,65,175,151,170,236,138,17,119,128,237,214,189,28,250,38,149,97,242,81,212,254,57,18,120,155,64,96,108,75,78,74,121,191,243,30,42,60,103,165,196,160,195,216,99,182,173,214,182,105,53,231,3,45,212,144,101,217,65,141,44,230,125,151,154,123,57,134,223,98,133,156,238,137,181,80,175,230,167,131,180,13,69,77,44,156,165,252,14,27,85,71,1,82,196,64,243,26,167,146,98,201,6,195,247,200,224,44,177,104,109,187,231,83,118,28,159,92,179,28,14,162,81,84,21,168,34,156,21,127,215,88,218,208,11,92,161,239,239,82,221,59,86,83,201,199,216,151,139,23,54,39,52,103,204,247,24,102,94,157,138,42,49,131,183,208,50,95,236,54,6,211,26,68,72,56,212,134,24,91,114,132,1,217,80,38,47,29,47,0,107,102,99,129,33,140,243,74,251,89,247,103,12,114,58,113,240,72,188,39,48,72,89,45,102,206,245,247,231,56,167,129,122,222,47,40,78,227,159,64,206,34,127,203,127,87,40,108,152,238,147,231,46,104,89,182,180,232,86,89,91,57,10,222,202,59,199,135,60,199,189,40,84,125,28,84,162,210,91,143,34,106,117,118,3,125,126,237,60,131,173,153,69,49,212,204,117,163,31,239,202,232,152,234,3,162,32,176,184,184,196,154,131,144,115,6,53,122,55,69,166,19,230,183,175,244,1,156,11,37,121,134,121,152,142,158,125,229,150,44,183,216,109,7,65,222,169,56,222,140,110,233,157,138,66,208,6,111,166,188,76,208,222,4,104,211,10,57,141,243,65,228,86,85,88,169,91,237,56,249,133,77,21,32,37,230,55,0,184,110,228,158,62,98,45,147,177,19,119,89,164,103,132,239,84,139,68,204,157,49,41,50,89,113,159,203,51,133,120,184,210,237,15,249,187,100,253,50,16,154,112,64,193,254,10,235,200,253,84,31,169,171,39,122,70,46,186,139,212,162,173,158,41,23,86,148,172,196,237,242,58,102,180,150,238,191,25,240,204,252,125,148,29,124,51,95,10,196,55,49,159,138,144,255,126,205,43,49,42,17,59,60,77,139,177,239,64,36,224,98,205,234,70,199,103,139,218,206,207,178,217,255,32,134,59,25,221,74,22,102,82,19,20,170,142,134,42,106,249,64,80,222,28,21,169,50,235,4,237,56,81,87,76,32,251,42,6,173,105,54,191,8,136,5,245,206,239,176,9,116,24];class KN extends ms{constructor(e,n,o){super(e,jN,n,o)}}const HN=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,190,100,112,230,97,199,225,96,74,99,94,248,222,162,213,95,122,158,212,233,42,22,37,217,115,36,152,30,123,116,104,212,109,129,41,220,77,213,97,124,45,4,219,197,171,40,18,149,104,20,4,248,102,64,9,50,217,124,131,180,188,159,170,63,1,84,130,150,117,14,212,118,67,165,97,207,242,251,15,30,187,188,77,79,122,67,101,252,109,244,82,37,191,227,35,114,87,57,71,99,218,155,54,101,239,138,197,13,226,228,176,157,158,87,98,55,251,79,150,64,138,200,135,40,132,135,207,146,252,222,57,58,111,151,225,78,59,36,210,70,29,121,160,210,31,109,67,167,194,177,236,91,108,164,229,130,211,59,66,93,18,107,226,54,210,51,8,77,217,19,73,187,33,30,59,9,135,162,49,5,11,225,111,119,11,247,218,129,115,83,205,170,21,4,69,210,133,134,245,109,15,177,9,81,81,203,105,42,158,12,255,151,165,230,205,5,92,196,251,211,187,27,214,43,186,91,233,85,192,229,15,71,38,220,20,38,101,44,78,7,60,251,186,75,103,108,53,166,220,186,208,194,120,207,230,159,248,22,32,142,124,96,157,222,60,191,65,145,6,239,125,151,147,50,58,130,207,110,131,223,231,137,238,28,182,216,167,198,191,37,67,76,1,144,232,218,79,72,28,65,101,43,216,64,253,16,173,179,123,140,27,233,245,199,230,36,181,102,114,247,162,18,34,20,212,25,171,24,28,143,80,94,40,167,34,209,61,117,130,1,198,196,7,21,252,180,255,92,128,119,9,48,156,138,136,151,143,23,44,52,3,40,197,228,31,123,67,163,140,32,54,204,187,149,80,19,255,82,120,195,12,110,65,56,212,143,22,78,44,234,72,140,29,118,103,18,36,7,122,50,37,139,47,142,243,25,208,88,237,126,50,103,127,19,183,29,169,29,1,55,23,100,32,129,239,243,160,61,178,197,117,199,45,57,26,165,135,92,218,59,0,197,54,13,96,40,141,212,221,131,103,46,22,228,191,167,73,20,86,62,11,147,217,116,205,203,110,134,249,51,6,123,23,86,231,157,8,144,83,126,115,118,35,96,36,229,36,220,228,143,71,45,223,129,48,236,5,145,202,188,208,184,70,241,104,255,188,181,146,210,206,144,53,77,101,120,38,8,245,80,230,165,160,183,83,202,79,127,57,214,126,242,150,208,40,239,148,35,163,201,97,74,70,214,181,63,240,147,33,253,149,140,77,197,82,126,189,231,7,196,212,80,14,151,24,57,144,243,81,234,66,24,19,236,2,137,121,246,129,65,7,99,110,174,54,74,182,81,234,142,37,72,110,220,255,64,119,10,188,111,191,228,1,205,9,204,143,56,62,125,84,106,225,131,97,192,43,240,157,161,75,168,247,44,175,65,81,192,48,21,157,167,80,191,130,161,75,85,186,174,42,117,1,68,252,204,138,254,203,152,21,13,64,144,195,207,238,229,54,103,247,159,245,211,85,191,141,168,32,234,85,46,118,12,5,199,4,19,217,203,202,156,33,143,114,116,60,66,40,58,77,208,237,171,26,72,175,114,205,248,87,137,62,210,143,151,197,167,210,241,122,150,104,122,154,2,70,102,83,19,36,141,136,199,42,79,229,71,86,194,109,31,236,80,166,17,230,109,1,40,28,46,224,56,20,230,47,100,254,116,208,76,169,157,241,175,3,70,85,31,38,245,58,33,80,145,237,8,22,71,224,158,156,31,249,81,87,247,230,199,237,96,167,123,63,243,79,156,206,203,160,54,124,68,253,215,132,235,57,185,92,238,55,59,210,104,71,26,183,180,71,12,255,224,192,65,154,72,244,8,164,10,248,46,207,30,92,1,80,244,31,189,138,88,216,218,63,100,227,116,57,119,94,135,5,126,255,32,191,163,61,209,194,88,248,112,139,173,43,69,134,3,160,151,137,25,98,239,166,19,123,208,180,31,120,30,191,75,183,179,126,180,125,92,107,105,206,138,28,67,139,3,188,230,184,255,121,13,181,45,160,114,202,194,123,87,55,124,97,164,82,95,232,216,117,62,5,90,176,82,167,52,160,153,174,168,105,146,91,248,81,79,249,97,138,133,170,245,229,132,61,5,149,224,246,194,213,61,12,109,44,136,235,95,219,133,220,27,93,36,93,124,180,81,141,152,220,170,163,229,197,124,171,232,48,70,251,106,119,150,20,16,49,119,247,42,132,36,76,254,124,177,66,175,9,1,39,92,127,195,171,198,34,2,64,144,179,72,40,151,110,89,229,42,125,33,238,16,220,228,51,203,8,1,68,145,253,133,118,93,163,129,22,13,248,65,12,4,63,101,210,70,170,138,203,14,246,54,194,195,27,107,241,175,35,171,49,52,106,121,45,36,152,85,215,132,78,167,34,18,167,245,152,133,134,170,120,182,10,146,191,37,2,205,47,125,20,203,44,88,81,32,150,223,220,218,238,254,30,212,167,221,115,156,82,226,137,220,221,97,3,139,202,33,9,27,26,126,40,215,25,126,9,82,208,49,217,14,161,81,196,61,60,87,254,213,194,81,216,161,151,209,166,222,230,24,128,117,140,92,4,203,254,170,253,249,88,90,112,226,18,44,122,39,158,158,56,69,204,159,5,179,51,197,233,139,216,102,226,206,248,15,78,112,214,126,67,28,40,38,98,190,178,206,67,94,245,254,160,101,176,32,157,26,132,83,252,228,87,242,32,127,160,112,210,224,133,149,115,41,30,16,200,69,89,81,77,144,12,106,182,73,54,28,53,195,28,216,179,179,136,35,141,102,234,177,240,34,186,106,145,245,3,84,48,251,157,245,11,217,111,227,138,42,67,114,211,177,37,103,16,71,152,72,117,123,36,213,202,56,124,227,84,8,45,229,149,165,214,69,244,169,55,68,62,94,104,228,74,205,123,222,17,7,172,158,227,74,206,149,67,175,171,251,185,121,151,223,63,35,229,32,49,190,209,120,137,69,213,214,19,150,187,177,28,12,158,153,126,149,171,167,234,120,129,109,32,157,180,75,66,56,233,115,127,230,157,32,34,143,156,31,230,168,174,125,118,195,249,243,165,81,246,10,144,15,103,139,55,173,7,59,136,69,172,54,132,165,140,78,77,230,33,169,129,188,71,209,109,161,8,57,57,199,143,31,164,43,58,130,1,110,145,31,229,13,46,149,94,244,106,76,238,105,107,1,183,177,10,61,225,94,185,116,58,183,95,225,22,119,19,248,28,13,123,125,108,158,64,184,77,245,153,162,217,227,208,41,185,211,235,41,153,181,54,166,165,11,154,55,21,184,209,192,249,44,164,160,29,229,159,82,156,198,241,183,114,83,137,186,151,148,31,21,197,216,145,32,13,50,22,241,137,39,71,28,142,160,215,107,221,45,202,104,227,110,186,12,150,145,240,51,49,44,196,115,224,238,149,189,134,99,67,241,62,157,240,114,247,195,26,200,141,97,147,249,23,150,174,10,13,219,81,73,58,242,96,250,243,15,49,218,58,230,104,252,175,150,123,86,185,84,90,198,6,36,0,99,72,28,166,238,115,231,171,249,179,71,174,68,156,227,17,198,79,73,142,99,144,20,80,62,80,191,142,46,71,9,243,6,8,214,116,72,190,106,161,19,185,100,9,187,64,94,86,203,174,156,245,222,95,54,30,148,19,11,50,112,96,61,237,159,173,7,154,127,175,79,48,97,89,78,126,66,171,204,158,195,27,226,205,222,157,89,251,90,125,37,212,27,97,3,141,247,175,50,121,7,187,68,196,181,202,167,189,57,84,81,222,23,27,84,130,176,98,66,240,207,18,23,28,163,163,194,45,37,129,202,170,97,189,0,81,238,0,39,199,163,35,211,206,247,65,29,116,242,67,102,235,13,136,232,230,114,146,187,7,254,142,26,121,16,237,5,160,201,114,94,178,199,95,212,241,45,112,180,188,72,86,114,189,155,149,149,163,210,112,101,12,69,225,75,202,223,28,242,90,215,156,169,224,245,135,128,92,148,217,131,208,255,25,135,117,136,5,104,185,249,161,228,214,16,105,204,9,182,135,153,220,101,244,160,207,58,182,118,185,240,57,245,123,13,112,182,106,229,220,90,29,86,215,96,147,232,2,55,131,225,137,68,245,89,141,252,97,3,129,155,216,223,98,116,45,78,85,141,161,74,215,7,150,171,225,59,78,221,152,236,14,117,100,208,158,86,13,185,124,87,157,111,40,187,182,124,173,71,173,23,199,52,155,190,134,11,23,64,25,215,39,115,231,173,77,72,114,54,252,116,178,59,221,106,241,119,254,30,226,241,204,233,113,197,96,146,0,41,67,3,231,126,12,218,202,22,171,114,249,176,134,160,19,216,31,229,118,226,62,242,126,126,42,127,130,68,218,218,81,202,106,217,191,25,177,82,97,81,36,232,137,58,90,216,190,117,235,20,194,144,76,178,27,213,13,208,18,29,118,126,49,98,203,179,128,237,100,32,242,189,212,6,210,210,188,161,205,13,124,119,13,215,112,41,183,176,215,168,210,182,111,1,115,2,239,141,8,177,124,112,48,197,2,239,11,99,4,36,77,69,47,244,19,153,61,19,2,96,176,7,112,122,131,169,25,189,116,171,49,12,121,162,79,154,74,251,50,233,182,63,180,224,118,49,253,21,20,16,31,144,184,93,174,231,244,183,13,49,225,189,211,73,185,49,110,142,25,226,45,176,233,204,74,33,16,205,88,131,92,157,170,175,68,170,61,53,116,165,16,27,182,160,181,87,241,15,151,85,107,76,167,129,25,172,127,184,138,153,222,228,125,64,44,45,32,12,227,148,106,152,83,240,166,54,235,32,190,12,242,164,123,189,53,194,141,104,43,202,110,4,168,119,245,232,179,178,198,1,224,87,86,160,31,19,140,233,102,191,204,4,98,138,163,191,106,24,213,47,208,82,137,132,131,16,253,84,25,144,90,159,148,16,196,84,166,61,160,101,229,227,93,118,59,87,66,16,128,59,96,131,250,20,184,150,205,91,227,201,62,35,79,180,172,173,85,197,106,153,238,229,60,204,65,193,230,94,101,177,134,6,165,53,171,142,208,155,2,11,4,202,127,54,17,142,117,227,121,128,204,192,147,147,92,189,5,224,148,72,18,83,101,126,124,228,153,242,123,229,247,92,221,6,73,227,250,87,167,194,129,187,73,38,185,109,217,240,193,88,50,178,180,151,54,197,187,137,190,166,233,1,103,204,88,31,127,185,29,65,1,29,254,223,14,83,167,215,114,248,30,173,89,173,187,69,5,105,117,15,106,94,173,63,227,25,230,190,136,168,177,175,107,91,126,254,34,188,25,118,48,12,226,130,153,162,57,47,181,212,79,160,97,64,157,246,90,53,43,149,76,102,15,195,107,58,242,84,172,29,81,198,113,81,251,138,182,154,111,30,171,129,56,17,45,214,153,112,117,203,174,40,38,234,236,32,4,112,225,26,187,195,246,252,9,218,69,160,223,178,54,148,81,8,134,151,75,248,63,224,240,48,75,250,221,85,46,100,50,3,70,64,102,111,160,155,233,59,147,184,57,61,6,126,79,176,16,185,94,166,33,135,78,42,75,140,208,140,44,153,187,64,103,119,160,236,16,239,74,218,219,212,207,110,53,30,76,248,40,111,98,44,20,113,204,233,109,135,96,107,39,163,203,125,45,157,152,71,239,175,174,159,147,80,111,93,38,253,228,154,225,181,101,12,241,127,65,49,189,5,85,151,237,213,143,14,104,138,54,52,27,4,132,67,35,156,86,157,73,16,229,222,245,110,79,165,179,56,179,53,218,229,100,58,87,149,48,231,64,63,115,67,3,172,6,186,115,154,60,53,214,152,149,89,234,37,143,82,255,64,28,183,93,112,39,70,185,57,0,199,9,61,175,219,41,76,37,176,82,125,65,53,160,214,105,62,153,244,222,96,205,6,178,85,41,240,113,0,96,149,38,3,195,18,152,41,246,3,103,29,110,134,30,101,75,46,103,199,184,20,230,8,55,120,4,229,168,35,43,7,28,161,143,87,27,87,79,255,186,44,195,158,155,181,119,81,172,217,107,95,98,55,243,186,66,105,48,224,123,232,84,156,20,10,156,208,204,52,34,228,136,97,242,200,246,211,67,202,40,241,91,92,253,9,54,72,131,221,106,178,32,44,182,4,225,193,37,20,249,249,231,10,206,18,71,254,221,187,172,88,204,6,127,138,102,7,208,75,147,219,199,177,79,36,170,101,207,177,109,95,143,217,41,199,80,183,201,2,254,12,55,23,198,14,255,69,245,138,155,129,227,167,168,130,156,135,14,96,93,48,99,143,107,126,92,117,143,112,108,193,228,84,13,41,186,27,172,92,201,149,116,19,112,197,116,209,128,102,1,55,152,177,28,37,34,50,83,41,199,74,178,59,111,67,118,35,252,36,33,87,28,170,17,215,47,90,154,124,137,15,14,211,59,75,59,30,77,0,49,37,225,191,87,101,127,214,227,160,99,174,234,82,148,235,16,241,219,147,170,127,221,250,116,39,218,156,72,227,172,55,0,79,188,76,51,222,232,24,36,62,94,154,3,61,230,146,114,253,0,128,58,253,90,72,211,242,38,39,133,153,161,119,105,195,152,225,208,105,140,80,217,186,196,157,21,116,230,116,139,25,159,143,118,128,77,201,238,247,228,15,168,4,133,148,21,148,12,44,241,7,115,17,129,176,202,46,130,122,129,235,141,223,85,21,199,65,181,169,52,174,161,153,62,25,164,115,213,89,138,199,103,79,200,165,135,249,244,27,209,178,240,129,211,61,9,111,157,147,119,36,119,255,110,130,84,49,210,225,247,100,26,121,127,163,160,26,79,99,24,77,65,32,178,109,36,27,253,173,110,183,11,14,211,57,130,254,124,104,165,219,31,70,97,14,194,39,61,26,141,125,228,126,194,184,101,160,204,106,128,144,106,103,171,18,246,129,220,85,172,151,123,5,73,155,192,175,91,157,239,61,237,116,170,65,233,56,19,49,114,168,190,3,214,53,250,90,213,244,88,101,30,229,248,124,15,71,141,27,172,235,21,129,211,72,61,172,112,170,128,135,96,196,221,255,27,176,105,188,183,121,33,37,149,53,131,226,233,29,167,234,218,109,53,185,152,36,248,53,61,235,78,21,201,214,210,163,12,251,187,45,188,137,126,127,237,92,234,91,240,225,38,194,57,213,251,237,171,30,99,52,14,49,84,101,252,237,7,166,122,114,32,107,32,207,239,136,168,178,12,11,241,233,230,146,132,18,83,233,41,172,17,6,161,42,113,87,40,255,185,1,146,128,5,240,126,131,71,42,54,124,205,2,122,71,30,222,229,40,134,142,102,97,239,151,177,1,230,231,49,123,219,28,129,91,152,112,13,154,81,197,226,255,112,158,178,177,55,181,108,138,185,245,29,186,21,73,188,209,154,200,89,116,235,198,144,36,87,248,22,7,200,122,7,148,44,42,87,140,238,204,95,231,252,0,136,0,22,39,70,123,125,165,113,227,172,146,163,128,158,36,52,91,19,36,245,27,150,138,141,11,67,239,224,65,24,116,101,7,39,46,142,172,164,243,148,0,33,226,59,47,203,137,156,241,66,250,157,30,204,101,143,134,98,238,155,226,25,184,136,219,89,100,193,11,143,71,139,243,230,151,0,249,1,78,26,32,93,104,157,67,97,164,248,86,124,146,93,74,222,228,167,55,53,100,135,216,109,13,64,37,106,177,200,200,182,92,251,69,31,243,89,80,198,14,132,203,72,103,28,104,217,24,97,223,113,11,29,178,191,210,46,162,255,68,99,8,237,213,162,152,193,183,121,203,19,108,182,29,86,26,192,103,220,103,205,154,179,197,9,22,73,127,175,146,38,119,210,0,24,180,21,245,215,204,91,186,119,138,183,239,15,155,231,248,133,39,24,101,144,236,10,230,54,174,227,73,21,110,10,160,241,232,131,14,212,127,232,59,122,65,146,54,163,9,189,190,121,88,170,62,194,14,204,152,245,38,131,37,91,81,72,114,29,115,239,182,56,44,156,159,177,180,82,160,93,97,86,183,236,50,95,85,39,71,181,225,152,143,63,123,117,34,44,109,160,166,229,240,91,138,102,54,180,173,44,50,80,42,124,7,50,124,211,239,21,94,197,185,239,213,107,142,64,95,124,125,17,180,97,189,101,52,48,19,112,12,70,9,212,177,54,118,66,84,147,236,248,26,124,95,103,135,254,124,49,112,186,99,120,90,8,194,191,88,57,242,65,61,10,104,246,197,252,19,159,58,194,75,173,242,103,8,115,84,69,238,149,26,15,159,182,141,132,119,70,29,53,20,143,46,163,204,6,236,59,45,185,172,89,119,83,38,144,36,222,96,151,26,99,195,163,170,133,92,159,214,53,150,116,90,176,69,145,130,15,172,140,217,215,101,163,115,161,65,101,8,7,183,113,213,134,58,175,130,251,143,173,248,168,135,60,159,30,194,68,208,119,120,2,40,178,227,247,161,77,47,136,46,244,163,72,65,158,25,225,195,61,132,182,204,177,186,200,81,2,65,105,212,72,94,203,232,217,182,123,251,228,160,1,161,204,123,20,37,1,77,208,179,45,149,181,122,102,190,123,213,164,231,41,216,130,234,248,208,251,252,220,84,209,67,47,61,220,5,142,162,26,236,121,142,248,132,255,65,122,203,196,102,191,187,2,195,127,255,193,92,49,91,186,154,39,156,29,211,172,49,104,245,114,153,223,211,199,249,35,130,160,128,0,152,176,183,20,236,113,193,108,26,255,11,237,102,133,245,94,115,114,10,89,229,214,221,99,149,30,99,37,246,10,26,26,39,92,123,170,73,211,127,227,54,30,86,133,159,112,225,91,148,100,174,149,75,143,14,140,20,44,64,212,5,243,8,116,63,30,97,42,123,20,73,212,85,207,83,122,27,251,233,84,10,17,236,232,83,200,127,119,143,163,204,220,167,59,231,20,106,186,222,191,8,40,234,21,25,180,13,116,250,152,224,174,75,3,205,38,173,215,236,151,185,121,254,244,154,239,17,53,106,164,61,49,116,216,118,94,150,35,181,26,238,66,49,211,221,132,146,166,115,39,136,36,205,230,179,31,197,51,148,165,109,38,70,37,148,52,44,209,250,98,58,246,225,103,198,101,26,25,196,207,8,166,21,88,252,175,253,10,88,107,157,19,225,61,12,246,221,37,239,186,167,137,142,135,222,128,174,62,95,216,38,141,157,45,232,97,217,173,203,234,116,129,69,206,189,94,221,12,54,139,186,247,184,16,200,121,244,104,8,7,35,111,47,188,10,140,92,73,143,206,203,72,122,184,20,102,197,130,64,150,63,96,239,8,132,111,217,84,91,198,32,43,100,138,241,15,160,42,190,253,193,184,164,124,29,210,96,67,224,221,182,29,218,129,149,29,128,174,98,88,88,125,56,40,255,120,5,0,87,174,42,150,90,112,201,183,169,19,57,195,191,12,58,244,235,132,25,145,72,146,214,8,125,100,135,12,5,102,97,248,174,24,159,90,33,43,187,6,61,212,241,225,190,219,252,197,123,129,164,108,123,55,230,4,153,166,105,234,15,85,216,23,56,32,3,41,110,68,146,172,133,202,98,41,7,47,152,35,255,168,106,241,226,222,77,244,52,185,65,252,227,32,66,38,11,172,60,28,28,103,84,1,1,205,182,190,28,189,102,253,43,1,191,148,116,10,227,18,81,93,80,239,157,232,215,180,163,165,161,109,177,71,150,244,144,208,160,110,22,174,60,206,43,103,121,55,103,114,115,173,238,13,10,227,251,41,176,216,158,229,216,55,234,128,128,20,167,106,181,86,163,130,215,110,149,191,10,227,215,8,214,154,178,181,15,19,0,247,250,97,74,43,157,55,94,174,41,41,9,199,97,20,91,32,18,10,43,98,240,247,203,20,250,117,160,44,229,202,187,64,54,124,15,184,169,129,27,160,240,26,61,255,60,166,60,144,209,84,55,187,186,168,13,124,125,29,17,100,249,227,62,205,78,179,163,168,139,168,21,38,83,239,151,74,43,66,2,92,72,71,94,216,134,238,20,45,158,213,164,73,57,80,47,198,184,130,223,227,71,132,133,235,177,85,174,142,124,172,200,54,229,40,126,60,76,92,216,153,56,241,174,66,141,90,226,3,30,68,234,71,187,163,112,146,255,22,143,170,204,3,127,179,81,139,160,37,77,246,128,220,196,158,153,73,177,65,199,119,29,197,144,130,248,206,155,253,108,213,124,7,223,221,162,146,134,242,65,99,162,107,120,247,214,207,96,150,169,131,208,218,221,28,24,112,208,23,1,130,142,232,56,104,45,33,158,95,255,123,31,74,76,120,178,155,213,6,195,164,8,8,69,241,197,127,83,169,21,167,19,94,143,252,33,159,248,241,170,153,147,1,149,199,201,131,170,79,236,212,209,143,107,98,24,123,56,33,193,85,247,64,225,135,210,78,145,57,16,145,71,170,20,133,87,235,4,166,239,100,82,235,81,50,223,9,193,52,49,86,129,190,196,82,165,107,63,115,161,98,33,20,193,29,42,151,205,252,124,72,245,48,181,67,7,13,21,127,59,226,188,144,129,112,244,192,121,213,80,42,196,1,13,107,108,78,0,40,121,225,148,237,234,209,216,238,9,147,226,254,96,89,212,72,193,106,75,135,74,227,67,255,92,191,81,188,124,226,149,152,142,15,159,195,238,114,55,255,166,157,230,59,148,170,166,151,65,213,104,253,253,112,150,82,147,137,27,214,100,247,65,81,92,47,86,217,7,45,120,81,130,31,236,243,76,78,3,45,105,172,220,71,48,220,94,196,249,163,193,133,50,236,205,20,55,2,63,14,127,69,113,212,204,12,58,79,89,86,29,61,199,201,64,149,6,144,182,150,129,31,18,167,120,248,82,107,25,143,128,27,161,28,25,153,183,217,238,78,186,106,92,27,202,219,165,96,0,216,234,169,73,101,39,182,113,217,240,170,116,172,221,250,233,48,49,242,83,227,92,181,184,72,230,180,21,15,108,135,25,38,153,25,124,227,26,149,73,236,39,211,244,149,58,183,132,26,223,219,174,144,117,233,219,165,205,157,159,222,184,52,47,241,201,123,65,24,44,55,215,177,168,250,179,115,190,227,123,158,163,179,224,69,196,66,207,254,243,101,221,193,140,250,4,28,222,52,96,138,160,33,218,64,118,214,234,201,152,148,91,178,111,107,144,142,6,182,102,72,188,34,213,181,26,223,58,255,103,81,17,47,169,11,245,224,123,148,215,237,186,107,75,152,90,202,166,22,149,197,5,246,238,78,76,229,106,199,94,127,195,0,45,82,6,159,103,96,138,231,71,46,107,59,216,39,43,12,221,27,214,56,155,145,66,187,169,250,235,78,211,179,239,183,198,163,93,5,196,24,174,143,225,106,139,89,98,13,127,207,184,194,30,1,165,198,169,8,197,118,86,163,221,138,23,209,61,116,79,99,233,43,130,60,244,85,229,243,172,123,148,200,120,192,127,211,52,11,159,41,95,212,230,188,169,156,137,29,212,12,148,168,148,133,243,44,241,139,127,24,246,220,227,125,209,97,60,52,162,192,146,49,161,92,138,112,189,128,59,126,125,46,207,60,79,231,174,152,209,68,223,205,2,38,14,91,116,159,255,28,27,178,248,164,104,158,79,69,214,234,157,12,75,163,83,253,245,202,61,213,176,6,197,230,29,208,166,253,194,254,235,29,141,241,70,249,15,62,0,148,163,135,52,122,40,96,87,31,179,152,51,216,133,184,122,198,203,60,115,218,191,193,16,178,25,148,252,112,104,103,252,36,92,221,28,179,43,199,198,151,128,100,252,217,161,249,34,201,172,118,52,180,252,104,7,223,44,116,102,212,21,40,224,184,55,163,210,21,207,161,239,51,54,155,41,133,18,67,48,3,165,130,251,4,79,214,57,72,130,157,212,144],WN=[0,1,3,4,6,7,9,10,12,13,15,16,18,19,21,22,24,26,29,31,34,36,39,41,44,46,49,51,54,56,59,61,64,65,66,67,68,69,70,72,73,74,75,76,77,79,80,81,82,83,84,85,87,88,89,90,91,92,94,95,96,97,98,99,101,102,103,104,105,106,107,109,110,111,112,113,114,116,117,118,119,120,121,123,124,125,126,127,128,129,131,132,133,134,135,136,138,139,140,141,142,143,145,146,147,148,149,150,151,153,154,155,156,157,158,160,161,162,163,164,165,166,168,169,170,171,172,173,175,176,177,178,179,180,182,183,184,185,186,187,188,190,191,192,193,194,195,197,198,199,200,201,202,204,205,206,207,208,209,210,212,213,214,215,216,217,219,220,221,222,223,224,226,226,226,227,227,227,228,228,228,229,229,229,230,230,231,231,231,232,232,232,233,233,233,234,234,235,235,235,236,236,236,237,237,237,238,238,239,239,239,240,240,240,241,241,241,242,242,243,243,243,244,244,244,245,245,245,246,246,246,247,247,247,248,248,248,249,249,249,250,250,250,251,251,251,252,252,252,253,253,253,254,254,254,255],c_=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,32,33,35,36,37,39,40,42,43,44,46,47,49,50,51,53,54,56,57,58,59,61,62,63,64,66,67,68,69,71,72,73,74,76,77,78,79,81,82,83,84,86,87,88,90,91,92,93,95,96,97,98,100,101,102,103,105,106,107,108,110,111,112,113,115,116,117,118,120,121,122,124,125,126,127,129,130,131,132,134,135,136,137,139,140,141,142,144,145,146,147,149,150,151,152,154,155,156,158,159,160,161,163,164,165,166,168,169,170,171,173,174,175,176,178,179,180,181,183,184,185,186,188,189,190,192,193,194,195,197,198,199,200,202,203,204,205,207,208,209,210,212,213,214,215,217,218,219,220,222,223,224,226,226,226,227,227,228,228,229,229,230,230,231,231,232,232,233,233,234,234,234,235,235,236,236,237,237,238,238,239,239,240,240,241,241,242,242,243,243,243,244,244,244,245,245,245,246,246,246,247,247,247,248,248,248,249,249,249,250,250,250,251,251,251,252,252,252,253,253,253,254,254,254,255],YN=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,35,36,37,38,39,40,41,43,44,45,46,47,48,50,51,52,53,54,55,56,58,59,60,61,62,63,65,66,67,68,69,70,72,73,74,76,77,78,80,81,83,84,85,87,88,89,91,92,94,95,96,98,99,100,102,103,105,106,107,109,110,111,113,114,116,117,118,120,121,122,124,125,127,128,129,131,132,133,135,136,138,139,140,142,143,144,146,147,149,150,151,153,154,155,157,158,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,192,193,193,194,195,195,196,197,197,198,199,199,200,201,201,202,203,203,204,205,205,206,207,207,208,209,209,210,211,211,212,213,213,214,215,215,216,217,217,218,219,219,220,221,221,222,223,223,224,225,225,226,227,227,228,229,229,230,231,231,232,233,233,234,235,235,236,237,237,238,239,239,240,241,241,242,243,243,244,245,245,246,247,247,248,249,249,250,251,251,252,253,253,254,255];class qN extends ms{constructor(e,n,o,c){super(e,HN,o,c),this.lightLevel=.1,this.rednessLevel=.5,this.mskin_he_max=175/180*3.141593,this.mskin_he_min=115/180*3.141593,this.mskin_hc_max=173/180*3.141593,this.mskin_hc_min=116/180*3.141593,this.mskin_hc_axis=2.04203545,this.mfacts_rotate_c=0,this.mfacts_rotate_le=0,this.mfacts_rotate_ge=0,this.tab_addr=null,this.lutTextures=[],this.inputTexture=n,this.init()}setUniforms(){const e=this.gl.getUniformLocation(this.program,"u_flipY"),n=this.gl.getUniformLocation(this.program,"u_denoiseLevel");this.gl.uniform1f(n,this.denoiseLevel),this.gl.uniform1f(e,1);const o=this.gl.getUniformLocation(this.program,"light");this.gl.uniform1f(o,this.lightLevel);const c=this.gl.getUniformLocation(this.program,"redness");this.gl.uniform1f(c,this.rednessLevel);const u=this.gl.getUniformLocation(this.program,"skin_he_max"),d=this.gl.getUniformLocation(this.program,"skin_he_min"),p=this.gl.getUniformLocation(this.program,"skin_hc_max"),f=this.gl.getUniformLocation(this.program,"skin_hc_min"),g=this.gl.getUniformLocation(this.program,"skin_hc_axis"),E=this.gl.getUniformLocation(this.program,"facts_rotate_c"),I=this.gl.getUniformLocation(this.program,"facts_rotate_le"),_=this.gl.getUniformLocation(this.program,"facts_rotate_ge");this.gl.uniform1f(u,this.mskin_he_max),this.gl.uniform1f(d,this.mskin_he_min),this.gl.uniform1f(p,this.mskin_hc_max),this.gl.uniform1f(f,this.mskin_hc_min),this.gl.uniform1f(g,this.mskin_hc_axis),this.gl.uniform1f(E,this.mfacts_rotate_c),this.gl.uniform1f(I,this.mfacts_rotate_le),this.gl.uniform1f(_,this.mfacts_rotate_ge);const T=this.gl.getUniformLocation(this.program,"u_originImage");this.gl.activeTexture(this.gl.TEXTURE2),this.gl.bindTexture(this.gl.TEXTURE_2D,this.inputTexture),this.gl.uniform1i(T,2);const R=["lighten_lut"],w=[this.gl.TEXTURE3];for(let k=0;k<R.length;k++){const L=this.gl.getUniformLocation(this.program,R[k]);this.gl.activeTexture(w[k]),this.gl.bindTexture(this.gl.TEXTURE_2D,this.lutTextures[k]),this.gl.uniform1i(L,k+3)}}setParameters(e){e.denoiseLevel!==void 0&&(this.denoiseLevel=e.denoiseLevel),e.lightLevel!==void 0&&(this.lightLevel=e.lightLevel),e.rednessLevel!==void 0&&(this.rednessLevel=e.rednessLevel,this.updateRedness(this.rednessLevel)),e.lighteningContrastLevel&&this.updateLut(e.lighteningContrastLevel)}init(){this.tab_addr=new Uint8Array(c_);const e=[this.tab_addr],n=[256],o=[1];for(let c=0;c<e.length;c++){const u=this.gl.createTexture();if(!u)throw new Q(U.WEBGL_INTERNAL_ERROR,"create lut texture failed");this.gl.bindTexture(this.gl.TEXTURE_2D,u),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.LUMINANCE,n[c],o[c],0,this.gl.LUMINANCE,this.gl.UNSIGNED_BYTE,e[c]),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.lutTextures.push(u)}}updateRedness(e){let o,c,u=e,d=u;u>1&&(u=1),u<0&&(u=0),d>1&&(d=1),d<0&&(d=0),this.mfacts_rotate_c=.8*u,d<.8&&(d=0),this.mskin_he_max=175/180*3.141593,this.mskin_hc_max=173/180*3.141593,this.mskin_he_min=(115-4*d)/180*3.141593,this.mskin_hc_min=(116-4*d)/180*3.141593,this.mskin_hc_axis=(117-4*d)/180*3.141593,this.mskin_hc_axis<this.mskin_hc_min&&(this.mskin_hc_axis=this.mskin_hc_min),this.mskin_hc_min<3.141593/2&&(this.mskin_hc_min=3.141593/2),this.mskin_hc_axis<3.141593/2&&(this.mskin_hc_axis=3.141593/2),this.mskin_he_min<3.141593/2&&(this.mskin_he_min=3.141593/2),this.mskin_hc_max>3.141593&&(this.mskin_hc_max=3.141593),this.mskin_hc_axis>3.141593&&(this.mskin_hc_axis=3.141593),this.mskin_he_max>3.141593&&(this.mskin_he_max=3.141593),o=this.mskin_he_max-this.mskin_hc_max,c=this.mskin_hc_max-this.mskin_hc_axis,this.mfacts_rotate_ge=o>.01?this.mfacts_rotate_c*c/o:this.mfacts_rotate_c,o=this.mskin_hc_min-this.mskin_he_min,c=this.mskin_hc_axis-this.mskin_hc_min,this.mfacts_rotate_le=o>.01?this.mfacts_rotate_c*c/o:this.mfacts_rotate_c}updateLut(e){let n=null;if(e===0&&(n=c_),e===1&&(n=YN),e===2&&(n=WN),!n)throw new Q(U.WEBGL_INTERNAL_ERROR,"invalid ylut_table value:"+e);this.tab_addr=new Uint8Array(n);const o=[this.tab_addr],c=[256],u=[1];for(let d=0;d<o.length;d++)this.gl.bindTexture(this.gl.TEXTURE_2D,this.lutTextures[d]),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.LUMINANCE,c[d],u[d],0,this.gl.LUMINANCE,this.gl.UNSIGNED_BYTE,o[d])}}class JN{constructor(){this.gl=null,this.canvas=null,this.programs=[],this.commonProgram=null,this.inputTexture=null,this.outputTextures=[],this.fbos=[],this.originalFrameWidth=0,this.originalFrameHeight=0,this.enableBeauty=!1,this.denoiseLevel=5,this.lightLevel=.35,this.rednessLevel=.5,this.lighteningContrastLevel=1}setEnableBeauty(e){this.enableBeauty=!!e}init(e,n,o){if(!Mn().supportWebGL)throw new Q(U.NOT_SUPPORTED,"your browser is not support webGL");if(this.gl=o.getContext("webgl"),!this.gl)throw new Q(U.WEBGL_INTERNAL_ERROR,"can not get webgl context");if(this.initGL(e,n),!this.inputTexture)throw new Q(U.WEBGL_INTERNAL_ERROR,"can not find input texture");this.canvas=o,this.programs.push(new a_(this.gl)),this.programs.push(new FN(this.gl,e,n)),this.programs.push(new GN(this.gl,e,n)),this.programs.push(new KN(this.gl,e,n)),this.programs.push(new qN(this.gl,this.inputTexture,e,n)),this.commonProgram=this.programs[0].program,this.setDenoiseLevel(this.denoiseLevel),this.setLightLevel(this.lightLevel),this.setRednessLevel(this.rednessLevel),this.setContrastLevel(this.lighteningContrastLevel)}render(e){if(!this.gl||!this.commonProgram||!this.canvas)return void N.warning("video effect manager is not init!");let n=0;if(this.originalFrameHeight===e.videoWidth&&this.originalFrameWidth===e.videoHeight)n=2;else if(this.originalFrameHeight!==e.videoHeight||this.originalFrameWidth!==e.videoWidth){var o,c,u;if(N.debug(M(o=M(c=M(u="beauty effect: resolution changed ".concat(this.originalFrameWidth,"x")).call(u,this.originalFrameHeight," -> ")).call(c,e.videoWidth,"x")).call(o,e.videoHeight)),e.videoHeight===0||e.videoWidth===0)return void N.debug("beauty effect: skip 0 resolution frame");this.canvas.width=e.videoWidth,this.canvas.height=e.videoHeight,e.setAttribute("width",e.videoWidth.toString()),e.setAttribute("height",e.videoHeight.toString()),this.release(),this.init(e.videoWidth,e.videoHeight,this.canvas)}this.gl.viewport(0,0,e.videoWidth,e.videoHeight),this.gl.bindTexture(this.gl.TEXTURE_2D,this.inputTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e);const d=this.enableBeauty?this.programs.length-1:0;for(let f=0;f<=d;f++){const g=this.programs[f].program;this.gl.useProgram(g);const E=this.gl.getUniformLocation(g,"u_image");this.programs[f].setUniforms(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.fbos[n+f%2]),this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.drawArrays(this.gl.TRIANGLES,0,6),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.outputTextures[n+f%2]),this.gl.uniform1i(E,0)}this.gl.useProgram(this.commonProgram);const p=this.gl.getUniformLocation(this.commonProgram,"u_flipY");this.gl.uniform1f(p,-1),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.drawArrays(this.gl.TRIANGLES,0,6)}setDenoiseLevel(e){var n;G(n=this.programs).call(n,o=>{o instanceof ms&&o.setParameters({denoiseLevel:e})}),this.denoiseLevel=e}setLightLevel(e){var n;G(n=this.programs).call(n,o=>{o instanceof ms&&o.setParameters({lightLevel:e})}),this.lightLevel=e}setRednessLevel(e){var n;G(n=this.programs).call(n,o=>{o instanceof ms&&o.setParameters({rednessLevel:e})}),this.rednessLevel=e}setContrastLevel(e){var n;G(n=this.programs).call(n,o=>{o instanceof ms&&o.setParameters({lighteningContrastLevel:e})}),this.lighteningContrastLevel=e}setSize(e,n){var o;G(o=this.programs).call(o,c=>{c instanceof ms&&c.setSize(e,n)})}release(){this.gl=null,this.commonProgram=null,this.inputTexture=null,this.programs=[],this.outputTextures=[],this.fbos=[]}initGL(e,n){if(!this.gl)throw new Q(U.WEBGL_INTERNAL_ERROR,"can not find webgl context");this.inputTexture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.inputTexture),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR);for(let o=0;o<4;o++){const c=this.gl.createTexture();if(!c)throw new Q(U.WEBGL_INTERNAL_ERROR,"create texture failed");this.gl.bindTexture(this.gl.TEXTURE_2D,c),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),o<2?this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,e,n,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null):this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,n,e,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null);const u=this.gl.createFramebuffer();if(!u)throw new Q(U.WEBGL_INTERNAL_ERROR,"create frame buffer failed");this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,u),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,c,0),this.outputTextures.push(c),this.fbos.push(u)}this.gl.viewport(0,0,e,n),this.originalFrameWidth=e,this.originalFrameHeight=n}}class zN{constructor(){this.targetFrameRate=0,this.recordedFrameCount=0,this.recordingTime=2}async startRecordBeautyEffectOutput(e,n=4){if(this.recordID)throw new Q(U.UNEXPECTED_ERROR,"another beauty effect recording is in progress");const o=gr(6,"");return this.recordID=o,this.targetFrameRate=e,this.recordedFrameCount=0,this.recordingTime=n,await pn(1e3*this.recordingTime),this.recordID!==o?(this.recordID=void 0,!0):(this.recordID=void 0,this.recordedFrameCount<this.targetFrameRate*this.recordingTime/2?(N.warning("detect beauty effect overload, current framerate",this.recordedFrameCount/2),!1):(N.debug("beauty effect current framerate",this.recordedFrameCount/2),!0))}stopRecordBeautyEffectOutput(){this.targetFrameRate=0,this.recordedFrameCount=0,this.recordID=void 0}addFrame(){this.recordID&&(this.recordedFrameCount+=1)}}class XN extends class{get output(){return this._output}async setInput(e){if(e!==this.input){if(e.kind!==this.kind)throw new Q(U.UNEXPECTED_ERROR);this.input&&this.removeInput(),this.input=e,await this._setInput(e)}}removeInput(){this.input=void 0,this._removeInput()}async updateOutput(e){this.output!==e&&(this._output=e,this.onOutputChange&&await this.onOutputChange())}replaceOriginMediaStream(e,n){var o,c;const u=yt(o=e.getTracks()).call(o,p=>p.kind===this.kind);u&&e.removeTrack(u);const d=yt(c=n.getTracks()).call(c,p=>p.kind===this.kind);this.output===void 0&&d&&e.addTrack(d),this.output&&(N.debug("replace ".concat(this.output.kind," track to origin media stream")),e.addTrack(this.output))}}{constructor(){super(),this.kind="video",this.fps=15,this.overloadDetector=new zN,this.enabled=!1,this.stopChromeBackgroundLoop=null,this.lastRenderTime=0,this.fps=30,this.manager=new JN}async setBeautyEffectOptions(e,n){if(function(o){o.smoothnessLevel!==void 0&&He(o.smoothnessLevel,"options.smoothnessLevel",0,1,!1),o.lighteningLevel!==void 0&&He(o.lighteningLevel,"options.lighteningLevel",0,1,!1),o.rednessLevel!==void 0&&He(o.rednessLevel,"options.rednessLevel",0,1,!1),o.lighteningContrastLevel!==void 0&&Cn(o.lighteningContrastLevel,"options.lighteningContrastLevel",[0,1,2])}(n),n.smoothnessLevel!==void 0){const o=Math.max(.1,10*n.smoothnessLevel);this.manager.setDenoiseLevel(o)}if(n.lighteningLevel!==void 0){const o=Math.max(.1,n.lighteningLevel/2);this.manager.setLightLevel(o)}if(n.rednessLevel!==void 0){const o=Math.max(.01,n.rednessLevel);this.manager.setRednessLevel(o)}if(n.lighteningContrastLevel!==void 0){const o=n.lighteningContrastLevel;this.manager.setContrastLevel(o)}this.enabled!==e&&(this.manager.setEnableBeauty(e),this.enabled=e,e?this.input&&await this.startEffect():await this.stopEffect())}destroy(){this.onOutputChange=void 0,this.stopEffect(),this.enabled=!1}async startEffect(){const e=Ke();if(!this.input)return void N.warning("video track is null, fail to start video effect!");if(this.input&&this.output&&this.input!==this.output)return void N.warning("video effect is already enabled");const n=await this.renderWithWebGL();await this.updateOutput(n),N.info("start video effect, output:",this.output),this.overloadDetector.startRecordBeautyEffectOutput(this.fps).then(c=>{c||this.onOverload&&this.onOverload()});const o=()=>{this.enabled&&requestAnimationFrame(o);const c=kt(),u=1e3/this.fps,d=this.lastRenderTime?c-this.lastRenderTime:u;d<u||(this.lastRenderTime=c-(d-u),this.video&&this.video.paused&&this.video.play(),this.enabled&&this.video&&(this.manager.render(this.video),this.output&&this.output.requestFrame&&this.output.requestFrame(),this.overloadDetector.addFrame()))};requestAnimationFrame(o),e.name===be.CHROME&&document.addEventListener("visibilitychange",()=>{document.hidden?this.stopChromeBackgroundLoop=OA(()=>{this.enabled&&this.video&&this.manager.render(this.video),this.output&&this.output.requestFrame&&this.output.requestFrame(),this.overloadDetector.addFrame()},this.fps):this.stopChromeBackgroundLoop&&(this.stopChromeBackgroundLoop(),this.stopChromeBackgroundLoop=null)},!1)}async stopEffect(){N.info("stop video effect"),this.overloadDetector.stopRecordBeautyEffectOutput(),this.manager.release(),this.canvas&&this.canvas.remove(),this.video&&this.video.remove(),this.canvas=void 0,this.video=void 0,await this.updateOutput(this.input)}async _setInput(e){this.enabled&&!this.video&&await this.startEffect()}_removeInput(){this.stopEffect()}async renderWithWebGL(){var e;if(!this.input)throw new Q(U.BEAUTY_PROCESSOR_INTERNAL_ERROR,"can not renderWithWebGL, no input");this.canvas&&(this.canvas.remove(),this.canvas=void 0),this.video&&(this.video.remove(),this.video=void 0),this.canvas=document.createElement("canvas"),this.video=document.createElement("video"),this.video.setAttribute("autoplay",""),this.video.setAttribute("muted",""),this.video.muted=!0,this.video.setAttribute("playsinline",""),this.video.setAttribute("style","display:none"),this.video.srcObject=new MediaStream([this.input]);const n=new ct(p=>{const f=()=>{this.video&&this.video.removeEventListener("playing",f),p(void 0)};this.video&&this.video.addEventListener("playing",f)});this.video.play(),await n;const o=this.input.getSettings(),c=o.width||this.video.videoWidth,u=o.height||this.video.videoHeight;if(o.frameRate&&this.fps!==o.frameRate&&(this.fps=o.frameRate,N.debug("beauty video processor: set fps to",this.fps)),N.debug(M(e="beauty video processor: width ".concat(c," height ")).call(e,u)),!c||!u)throw new Q(U.BEAUTY_PROCESSOR_INTERNAL_ERROR,"can not get track resolution");this.canvas.width=c,this.canvas.height=u,this.video.setAttribute("width",c.toString()),this.video.setAttribute("height",u.toString()),this.manager.init(c,u,this.canvas);const d=Mn();return this.canvas.captureStream(d.supportRequestFrame?0:this.fps).getVideoTracks()[0]}}function Cf(t){const e={};if(t.facingMode&&(e.facingMode=t.facingMode),t.cameraId&&(e.deviceId={exact:t.cameraId}),!t.encoderConfig)return e;const n=fc(t.encoderConfig);return e.width=n.width,e.height=n.height,!sI()&&n.frameRate&&(e.frameRate=n.frameRate),Ke().name===be.EDGE&&typeof e.frameRate=="object"&&(e.frameRate.max=60),si()&&(e.frameRate={ideal:30,max:30}),e}function l_(t){const e={};if(sI()||(t.AGC!==void 0&&(e.autoGainControl=t.AGC),t.AEC!==void 0&&(e.echoCancellation=t.AEC),t.ANS!==void 0&&(e.noiseSuppression=t.ANS,Wu()&&t.ANS&&(e.googHighpassFilter=t.ANS))),t.encoderConfig){const n=ld(t.encoderConfig);e.channelCount=n.stereo?2:1,e.sampleRate=n.sampleRate,e.sampleSize=n.sampleSize}return t.microphoneId&&(e.deviceId={exact:t.microphoneId}),Wu()&&e.channelCount===2&&(e.echoCancellation=!1,e.googHighpassFilter=!1),aI()&&(e.sampleRate=void 0),e}var Nc,Qd;(function(t){t.COVERED="COVERED",t.POSITION="POSITION",t.SIZE="SIZE",t.STYLE="STYLE"})(Nc||(Nc={})),function(t){t.UNMOUNTED="UNMOUNTED",t.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT"}(Qd||(Qd={}));var u_=new class{constructor(){this._clientSize=null,this.getClientWidth=()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth,this.getClientHeight=()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight,this.getStyle=t=>window.getComputedStyle(t,null),this.checkCssVisibleProperty=t=>{var e;let n=!0;const o=this.getStyle(t),{display:c,visibility:u,opacity:d,filter:p}=o;if((c==="none"||Xt(e=["hidden","collapse"]).call(e,u)||Number(d)<.1)&&(n=!1),!n)return!1;if(p){var f;const g=Ot(f=p.split(" ")).call(f,I=>{var _;const T=I.split("(")[0];return Xt(_=["brightness","blur","opacity"]).call(_,T)}),E=ht(g).call(g,I=>{const[_,T]=I.split(/\(|\)/);return[_,Number(T.match(/^[0-9\.]+/))]});G(E).call(E,I=>{const[_,T]=I;switch(_){case"brightness":(T<.1||T>3)&&(n=!1);break;case"blur":T>3&&(n=!1);break;case"opacity":T<.1&&(n=!1)}})}return n},this.checkPropertyUpToAllParentNodes=(t,e)=>{let n=!0,o=!0;const c=d=>e(d);let u=t;for(;u&&o;)c(u)||(n=!1,o=!1),u=u.parentElement,u||(o=!1);return n},this.checkActualCssVisibleIncludeInherit=t=>this.checkPropertyUpToAllParentNodes(t,this.checkCssVisibleProperty),this.getSizeAboutClient=t=>{const{width:e,height:n,left:o,right:c,top:u,bottom:d}=t.getBoundingClientRect(),p=this.getClientWidth(),f=this.getClientHeight();return{width:e,height:n,left:o,right:c,top:u,bottom:d,clientWidth:p,clientHeight:f,clientMin:Math.min(p,f)}},this.checkActualSize=()=>{const{width:t,height:e,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(t,e,n)},this.elementFromPoint=(t,e)=>document.elementFromPoint?document.elementFromPoint(t,e):null,this.checkCoverForAPoint=(t,e,n)=>{const o=this.elementFromPoint(t,e);return o!==null&&o!==n},this.getPointPositionList=()=>{const{width:t,height:e,left:n,top:o}=this._clientSize,c=t/6,u=e/6,d=[],p=10**6;for(let f=0;f<5;f++)for(let g=0;g<5;g++){const E=(n*p+(f===0?.1:f===4?(c*f*p-1e5)/p:c*f)*p)/p,I=(o*p+(g===0?.1:g===4?(u*g*p-1e5)/p:u*g)*p)/p;d.push({x:E,y:I})}return[...d]},this.checkElementCover=t=>{var e;const n=this.getPointPositionList();return Ot(e=ht(n).call(n,o=>this.checkCoverForAPoint(o.x,o.y,t))).call(e,o=>!!o).length>6},this.checkSizeIsVisible=(t,e,n)=>(t>50||n/t<=10)&&(e>50||n/e<=10),this.checkSizeOfPartInClient=()=>{const{left:t,right:e,top:n,bottom:o,clientHeight:c,clientWidth:u,clientMin:d}=this._clientSize;let p,f,g,E;if(t<0)p=0;else{if(!(t<u))return!1;p=t}if(e<0)return!1;if(f=e<u?e:u,n<0)g=0;else{if(!(n<c))return!1;g=n}if(o<0)return!1;E=o<c?o:c;const I=f-p,_=E-g;return this.checkSizeIsVisible(I,_,d)},this.returnHiddenResult=t=>(this._clientSize=null,{visible:!1,reason:t}),this.checkOneElementVisible=t=>{if(t instanceof HTMLElement){if(this.checkElementIsMountedOnDom(t)){if(this.checkActualCssVisibleIncludeInherit(t)){if(this._clientSize=this.getSizeAboutClient(t),this.checkElementCover(t))return this.returnHiddenResult(Nc.COVERED);{const e=this.checkActualSize(),n=this.checkSizeOfPartInClient();return e&&!n?this.returnHiddenResult(Nc.POSITION):e?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Nc.SIZE)}}return this.returnHiddenResult(Nc.STYLE)}return this.returnHiddenResult(Qd.UNMOUNTED)}return this.returnHiddenResult(Qd.INVALID_HTML_ELEMENT)},this.checkElementIsMountedOnDom=t=>this.checkPropertyUpToAllParentNodes(t,e=>e.nodeName.toUpperCase()!=="HTML"?e.parentElement!==null:!!document.documentElement)}};function d_(t,e){var n=ue(t);if(_e){var o=_e(t);e&&(o=Ot(o).call(o,function(c){return zt(t,c).enumerable})),n.push.apply(n,o)}return n}function Ml(t){for(var e=1;e<arguments.length;e++){var n,o=arguments[e]!=null?arguments[e]:{};if(e%2)G(n=d_(Object(o),!0)).call(n,function(u){qr(t,u,o[u])});else if(Ce)dr(t,Ce(o));else{var c;G(c=d_(Object(o))).call(c,function(u){te(t,u,zt(o,u))})}}return t}var _f,ui=function(t,e,n,o){var c,u=arguments.length,d=u<3?e:o===null?o=zt(e,n):o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(t,e,n,o);else for(var p=t.length-1;p>=0;p--)(c=t[p])&&(d=(u<3?c(d):u>3?c(e,n,d):c(e,n))||d);return u>3&&d&&te(e,n,d),d},we=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};let We=_f=class extends As{constructor(t,e,n,o,c,u){var d;super(t,c),this.trackMediaType="video",this._videoVisibleTimer=null,this._previousVideoVisibleStatus=void 0,this._clearPreviousVideoVisibleStatus=()=>this._previousVideoVisibleStatus=void 0,this._scalabiltyMode={numSpatialLayers:1,numTemporalLayers:1},this._enabled=!0,this.updateMediaStreamTrackResolution(),this._encoderConfig=e,this._scalabiltyMode=n,this._optimizationMode=o,this._hints=u||[],Ft(d=this._hints).call(d,dn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile()}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==cn.PLAYING)}play(t,e={}){const n=it.reportApiInvoke(null,{tag:Ut.TRACER,name:Vt.LOCAL_VIDEO_TRACK_PLAY,options:[this.getTrackId(),typeof t=="string"?t:"HTMLElement",e]});if(typeof t=="string"){const u=document.getElementById(t);var o;u?t=u:(N.warning(M(o="[".concat(this.getTrackId(),'] can not find "#')).call(o,t,'" element, use document.body')),Lt("warning",this,'can not find "#'.concat(t,'" element, use document.body')),t=document.body)}N.debug("[".concat(this.getTrackId(),"] start video playback"),at(e)),st("debug",this,"play",e);const c=Ml({},this._getDefaultPlayerConfig(),{},e,{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(c):(this._player=new xd(c),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const u=this.getVideoElementVisibleStatus();this.emit(hs.VIDEO_ELEMENT_VISIBLE_STATUS,u)}catch{}},ot("CHECK_VIDEO_VISIBLE_INTERVAL")),n.onSuccess()}stop(){const t=it.reportApiInvoke(null,{tag:Ut.TRACER,name:Vt.LOCAL_VIDEO_TRACK_STOP,options:[this.getTrackId()]});if(!this._player)return t.onSuccess();this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,N.debug("[".concat(this.getTrackId(),"] stop video playback")),st("debug",this,"stop"),t.onSuccess()}async setEnabled(t,e){if(!e){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(N.info("[".concat(this.getTrackId(),"] start setEnabled"),t),st("info",this,"setEnabled",t),!t){this._originMediaStreamTrack.enabled=!1;try{await Kr(this,Kt.NEED_DISABLE_TRACK,this)}catch(n){throw N.error("[".concat(this.getTrackId(),"] setEnabled to false error"),n.toString()),st("error",this,"setEnabled",t,n.toString()),n}return e||(this._enabled=!1),N.info("[".concat(this.getTrackId(),"] setEnabled to false success")),void st("info",this,"setEnabled",t,"success")}this._originMediaStreamTrack.enabled=!0;try{await Kr(this,Kt.NEED_ENABLE_TRACK,this)}catch(n){throw N.error("[".concat(this.getTrackId(),"] setEnabled to true error"),n.toString()),st("error",this,"setEnabled",t,n.toString()),n}N.info("[".concat(this.getTrackId(),"] setEnabled to true success")),st("info",this,"setEnabled",t,"success"),e||(this._enabled=!0)}async setMuted(t){var e;t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._mediaStreamTrack.enabled=!t,N.debug(M(e="[".concat(this.getTrackId(),"] start set muted: ")).call(e,t)),st("debug",this,"setMuted",t),t?await Kr(this,Kt.NEED_MUTE_TRACK,this):await Kr(this,Kt.NEED_UNMUTE_TRACK,this))}getStats(){return Sl(()=>{N.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead"),Lt("warning",this,"[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),ya(this,Kt.GET_STATS)||Ml({},uA)}async setBeautyEffect(t,e={}){const n=it.reportApiInvoke(null,{tag:Ut.TRACER,name:Vt.LOCAL_VIDEO_TRACK_BEAUTY,options:[this.getTrackId(),t,e]});if(t||this._videoBeautyProcessor){if(rI()===Zr.IOS||rI()===Zr.ANDROID){const o=new Q(U.INVALID_OPERATION,"can not enable beauty effect on mobile device");throw n.onError(o),o}if(!this._enabled&&t){const o=new Q(U.TRACK_IS_DISABLED,"can not enable beauty effect when track is disabled");throw n.onError(o),o}N.info("[".concat(this.getTrackId(),"] start setBeautyEffect"),t,at(e)),st("info",this,"setBeautyEffect",[t,e]);try{this._videoBeautyProcessor?await this._videoBeautyProcessor.setBeautyEffectOptions(t,e):(this._videoBeautyProcessor=new XN,this._videoBeautyProcessor.onOverload=()=>{Gi(()=>this.emit(hs.BEAUTY_EFFECT_OVERLOAD))},await this._videoBeautyProcessor.setBeautyEffectOptions(t,e),await this._registerTrackProcessor(this._videoBeautyProcessor))}catch(o){throw N.error("[".concat(this.getTrackId(),"] setBeautyEffect error"),o.toString()),st("info",this,"setBeautyEffect",[t,e]),n.onError(o),o}N.info("[".concat(this.getTrackId(),"] setBeautyEffect success")),st("info",this,"setBeautyEffect",[t,e],"success"),n.onSuccess()}}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}clone(t,e,n,o){const c=this._mediaStreamTrack.clone();return new _f(c,t,e,n,o)}async setBitrateLimit(t){var e;if(N.debug(M(e="[".concat(this.getTrackId(),"] set bitrate limit, ")).call(e,at(t))),st("debug",this,"setBitrateLimit",t),t){this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate);try{await Kr(this,Kt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw()}}}async setOptimizationMode(t){var e;if(t!=="motion"&&t!=="detail"&&t!=="balanced")return N.error(U.INVALID_PARAMS,"optimization mode must be motion, detail or balanced"),void st("error",this,"setOptimizationMode",t,U.INVALID_PARAMS);const n=this._optimizationMode;try{this._optimizationMode=t,await Kr(this,Kt.SET_OPTIMIZATION_MODE,this)}catch(o){throw this._optimizationMode=n,N.error("[".concat(this.getTrackId(),"] set optimization mode failed"),o.toString()),st("error",this,"setOptimizationMode",t,o.toString()),o}N.info(M(e="[".concat(this.getTrackId(),"] set optimization mode success (")).call(e,t,")")),st("info",this,"setOptimizationMode",t,"success")}setScalabiltyMode(t){var e;if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return N.error(U.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),st("error",this,"setScalabiltyMode",t,U.INVALID_PARAMS),void(this._scalabiltyMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabiltyMode=t,N.info(M(e="[".concat(this.getTrackId(),"] set scalability mode success (")).call(e,t,")")),st("info",this,"setScalabiltyMode",t,"success")}updateMediaStreamTrackResolution(){P1(this._originMediaStreamTrack).then(([t,e])=>{this._videoHeight=e,this._videoWidth=t}).catch(_d)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:t,height:e,frameRate:n}=this.getMediaStreamTrackSettings();if(!t||!e||!n)return;const[o,c]=function(R,w,k){const L=ot("BITRATE_ADAPTER_TYPE");let Y;const Z=200*Math.pow(k/15,.6)*Math.pow(R*w/640/360,.75),rt=Z;if(L==="STANDARD_BITRATE")Y=4*Z;else{if(L!=="COMPATIABLE_BITRATE")return;Y=2*Z}return[Math.floor(Y),Math.floor(rt)]}(t,e,n)||[void 0,void 0];var u,d,p,f,g,E,I,_,T;this._encoderConfig.bitrateMin||this._encoderConfig.bitrateMax||(this._encoderConfig.bitrateMin=c,this._encoderConfig.bitrateMax=o,N.debug(M(u=M(d=M(p=M(f=M(g="[".concat(this.getTrackId(),"] update bitrate from profile, [w: ")).call(g,t,", h: ")).call(f,e,", fps: ")).call(p,n,"] => [brMax: ")).call(d,o,", brMin: ")).call(u,c,"]")),st("debug",this,"updateBitrateFromProfile",void 0,M(E=M(I=M(_=M(T="[w: ".concat(t,", h: ")).call(T,e,", fps: ")).call(_,n,"] => [brMax: ")).call(I,o,", brMin: ")).call(E,c,"]")))}getVideoElementVisibleStatus(){try{var t,e;const n=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),o={track:this,element:this==null||(e=this._player)===null||e===void 0?void 0:e.getVideoElement(),slot:n==null?void 0:n.parentElement},{element:c,slot:u}=o;if(this.isPlaying&&c instanceof HTMLVideoElement&&u instanceof HTMLElement){const d=u_.checkOneElementVisible(c),p=Ir({},d);if(p.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=p.visible;const f=it.reportApiInvoke(null,{tag:Ut.TRACER,name:Vt.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});p.visible?f.onSuccess("Video is visible"):f.onSuccess("Invisible because of ".concat(p.reason))}return p}return}catch(n){throw new Q(U.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}async renewMediaStreamTrack(){}};ui([hr(),we("design:type",Function),we("design:paramtypes",[Object,Object]),we("design:returntype",void 0)],We.prototype,"play",null),ui([Cc("LocalVideoTrack","_enabledMutex"),hr(),we("design:type",Function),we("design:paramtypes",[Boolean,Boolean]),we("design:returntype",ct)],We.prototype,"setEnabled",null),ui([Cc("LocalVideoTrack","_enabledMutex"),hr(),gd({report:it}),we("design:type",Function),we("design:paramtypes",[Boolean]),we("design:returntype",ct)],We.prototype,"setMuted",null),ui([hr(),we("design:type",Function),we("design:paramtypes",[]),we("design:returntype",Object)],We.prototype,"getStats",null),ui([hr(),we("design:type",Function),we("design:paramtypes",[Boolean,Object]),we("design:returntype",ct)],We.prototype,"setBeautyEffect",null),ui([hr(),we("design:type",Function),we("design:paramtypes",[]),we("design:returntype",ImageData)],We.prototype,"getCurrentFrameData",null),ui([hr(),we("design:type",Function),we("design:paramtypes",[Object]),we("design:returntype",ct)],We.prototype,"setBitrateLimit",null),ui([hr(),we("design:type",Function),we("design:paramtypes",[String]),we("design:returntype",ct)],We.prototype,"setOptimizationMode",null),ui([hr(),we("design:type",Function),we("design:paramtypes",[Object]),we("design:returntype",void 0)],We.prototype,"setScalabiltyMode",null),ui([hr(),we("design:type",Function),we("design:paramtypes",[]),we("design:returntype",void 0)],We.prototype,"updateMediaStreamTrackResolution",null),We=_f=ui([an("LocalVideoTrack","getTrackId"),we("design:paramtypes",[MediaStreamTrack,Object,Object,String,String,Array])],We);let ba=class extends We{constructor(t,e,n,o,c,u){super(t,e.encoderConfig?fc(e.encoderConfig):{},o,c,u),this._enabled=!0,this._deviceName="default",this.tryResumeVideoForIOS15WeChat=async()=>{lc()&&!Qp()&&oI()&&this._enabled&&!this._isClosed&&(N.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())},Wt("info",this,"constructor",{trackId:u,deviceId:t.label,constraints:n,config:e}),this._config=e,this._constraints=n,this._deviceName=t.label,this._config.encoderConfig&&(this._encoderConfig=fc(this._config.encoderConfig)),he.on(Rr.IOS_15_INTERRUPTION_END,this.tryResumeVideoForIOS15WeChat),he.on(Rr.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15WeChat)}async setDevice(t){var e;const n=it.reportApiInvoke(null,{tag:Ut.TRACER,name:Vt.CAM_VIDEO_TRACK_SET_DEVICE,options:[this.getTrackId(),t]});if(N.info(M(e="[".concat(this.getTrackId(),"] set device to ")).call(e,t)),st("info",this,"setDevice",t),this._enabled)try{const o=await ai.getDeviceById(t),c={};c.video=Ml({},this._constraints),c.video.deviceId={exact:t},c.video.facingMode=void 0,this._originMediaStreamTrack.stop();let u=null;try{u=await eo(c,this.getTrackId())}catch(d){throw N.error("[".concat(this.getTrackId(),"] setDevice failed"),d.toString()),st("error",this,"setDevice",t,d.toString()),u=await eo({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(u.getVideoTracks()[0],!1),d}await this._updateOriginMediaStreamTrack(u.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=o.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(o){throw n.onError(o),N.error("[".concat(this.getTrackId(),"] setDevice error"),o.toString()),st("error",this,"setDevice",t,o.toString()),o}else try{const o=await ai.getDeviceById(t);this._deviceName=o.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(o){throw n.onError(o),N.error("[".concat(this.getTrackId(),"] setDevice error"),o.toString()),st("error",this,"setDevice",t,o.toString()),o}N.info("[".concat(this.getTrackId(),"] setDevice success")),st("info",this,"setDevice",t,"success"),n.onSuccess()}async setEnabled(t,e){if(!e){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(N.info("[".concat(this.getTrackId(),"] start setEnabled"),t),st("info",this,"setEnabled",t),!t){this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),e||(this._enabled=!1);try{await Kr(this,Kt.NEED_DISABLE_TRACK,this)}catch(c){throw N.error("[".concat(this.getTrackId(),"] setEnabled to false error"),c.toString()),st("error",this,"setEnabled",t,c.toString()),c}return N.info("[".concat(this.getTrackId(),"] setEnabled to false success")),void st("info",this,"setEnabled",t,"success")}const n=Ml({},this._constraints),o=ai.searchDeviceIdByName(this._deviceName);o&&!n.deviceId&&(n.deviceId={exact:o});try{const c=await eo({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),await Kr(this,Kt.NEED_ENABLE_TRACK,this)}catch(c){throw N.error("[".concat(this.getTrackId(),"] setEnabled true error"),c.toString()),st("error",this,"setEnabled",t,c.toString()),c}this.updateMediaStreamTrackResolution(),N.info("[".concat(this.getTrackId(),"] setEnabled to true success")),st("info",this,"setEnabled",t,"success"),e||(this._enabled=!0)}async setEncoderConfiguration(t,e){var n;const o=it.reportApiInvoke(null,{tag:Ut.TRACER,name:Vt.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG,options:[this.getTrackId(),t]});if(!this._enabled){const d=new Q(U.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");throw o.onError(d),d}t=fc(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin);const c=en(this._config);c.encoderConfig=t;const u=Cf(c);(Ei()||vi()||cs())&&(u.deviceId=void 0),N.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),at(t),at(u)),st("debug",this,"setEncoderConfiguration",t);try{await this._originMediaStreamTrack.applyConstraints(u),this.updateMediaStreamTrackResolution()}catch(d){const p=new Q(U.UNEXPECTED_ERROR,d.toString());throw N.error("[".concat(this.getTrackId(),"] applyConstraints error"),p.toString()),st("error",this,"setEncoderConfiguration",d.toString()),o.onError(p),p}this._config=c,this._constraints=u,this._encoderConfig=t,Ft(n=this._hints).call(n,dn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Kr(this,Kt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(d){return o.onError(d),d.throw()}o.onSuccess()}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((vi()||cs())&&this._enabled&&!this._isClosed&&he.duringInterruption){const t=async()=>{he.off(Rr.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(N.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),Lt("debug",this,"try capture camera media device for interrupted iOS device."),await this.setEnabled(!1),await this.setEnabled(!0))};he.on(Rr.IOS_INTERRUPTION_END,t)}else N.debug("[".concat(this.getTrackId(),"] track ended")),ls("debug",["MediaStreamTrack",this.getTrackId()],"ended"),this.emit(hs.TRACK_ENDED)}async renewMediaStreamTrack(){const t=Ml({},this._constraints),e=ai.searchDeviceIdByName(this._deviceName);e&&!t.deviceId&&(t.deviceId={exact:e});const n=await eo({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(n.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}close(){super.close(),he.off(Rr.IOS_15_INTERRUPTION_END,this.tryResumeVideoForIOS15WeChat),he.off(Rr.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15WeChat)}};ui([hr(),we("design:type",Function),we("design:paramtypes",[String]),we("design:returntype",ct)],ba.prototype,"setDevice",null),ui([Cc("CameraVideoTrack","_enabledMutex"),hr(),we("design:type",Function),we("design:paramtypes",[Boolean,Boolean]),we("design:returntype",ct)],ba.prototype,"setEnabled",null),ui([hr(),we("design:type",Function),we("design:paramtypes",[Object,Boolean]),we("design:returntype",ct)],ba.prototype,"setEncoderConfiguration",null),ba=ui([an("CameraVideoTrack","getTrackId"),we("design:paramtypes",[MediaStreamTrack,Object,Object,Object,String,String])],ba);class Na{constructor(e,n){this._trust_in_room_=!0,this._trust_audio_enabled_state_=!0,this._trust_video_enabled_state_=!0,this._trust_audio_mute_state_=!0,this._trust_video_mute_state_=!0,this._trust_stream_added_state_=!0,this._audio_muted_=!1,this._video_muted_=!1,this._audio_enabled_=!0,this._video_enabled_=!0,this._audio_added_=!1,this._video_added_=!1,this.uid=e,this._uintid=n}get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio)return this._audioTrack}get videoTrack(){if(this.hasVideo)return this._videoTrack}}var Fd=dd.f("asyncIterator");hn("asyncDispose"),hn("dispose"),hn("observable"),hn("patternMatch"),hn("replaceAll");var yf=df,ZN=Lr.set,$N=Lr.getterFor("AggregateError"),Oc=function(t,e){var n=this;if(!(n instanceof Oc))return new Oc(t,e);Xm&&(n=Xm(new Error(e),Za(n)));var o=[];return Us(t,o.push,o),m?ZN(n,{errors:o,type:"AggregateError"}):n.errors=o,e!==void 0&&yr(n,"message",String(e)),n};Oc.prototype=ns(Error.prototype,{constructor:b(5,Oc),message:b(5,""),name:b(5,"AggregateError")}),m&&kr.f(Oc.prototype,"errors",{get:function(){return $N(this).errors},configurable:!0}),jt({global:!0},{AggregateError:Oc}),jt({target:"Promise",stat:!0},{try:function(t){var e=ic.f(this),n=oc(t);return(n.error?e.reject:e.resolve)(n.value),e.promise}});var h_="No one promise resolved";jt({target:"Promise",stat:!0},{any:function(t){var e=this,n=ic.f(e),o=n.resolve,c=n.reject,u=oc(function(){var d=Or(e.resolve),p=[],f=0,g=1,E=!1;Us(t,function(I){var _=f++,T=!1;p.push(void 0),g++,d.call(e,I).then(function(R){T||E||(E=!0,o(R))},function(R){T||E||(T=!0,p[_]=R,--g||c(new(En("AggregateError"))(p,h_)))})}),--g||c(new(En("AggregateError"))(p,h_))});return u.error&&c(u.value),n.promise}});var Sf=$E,p_=function(t){this.wrapped=t};function Pl(t){var e,n;function o(u,d){try{var p=t[u](d),f=p.value,g=f instanceof p_;Sf.resolve(g?f.wrapped:f).then(function(E){g?o(u==="return"?"return":"next",E):c(p.done?"return":"normal",E)},function(E){o("throw",E)})}catch(E){c("throw",E)}}function c(u,d){switch(u){case"return":e.resolve({value:d,done:!0});break;case"throw":e.reject(d);break;default:e.resolve({value:d,done:!1})}(e=e.next)?o(e.key,e.arg):n=null}this._invoke=function(u,d){return new Sf(function(p,f){var g={key:u,arg:d,resolve:p,reject:f,next:null};n?n=n.next=g:(e=n=g,o(u,d))})},typeof t.return!="function"&&(this.return=void 0)}typeof yf=="function"&&Fd&&(Pl.prototype[Fd]=function(){return this}),Pl.prototype.next=function(t){return this._invoke("next",t)},Pl.prototype.throw=function(t){return this._invoke("throw",t)},Pl.prototype.return=function(t){return this._invoke("return",t)};var tO=Pl,xl=function(t){return function(){return new tO(t.apply(this,arguments))}},Qr=function(t){return new p_(t)},eO=sl,Tf=dd.f("iterator"),A_=function(t){var e;if(yf!==void 0&&(Fd&&(e=t[Fd])!=null||Tf&&(e=eO(t))!=null))return e.call(t);throw new TypeError("Object is not async iterable")},f_=function(t,e){var n={},o=!1;function c(u,d){return o=!0,d=new Sf(function(p){p(t[u](d))}),{done:!1,value:e(d)}}return typeof yf=="function"&&Tf&&(n[Tf]=function(){return this}),n.next=function(u){return o?(o=!1,u):c("next",u)},typeof t.throw=="function"&&(n.throw=function(u){if(o)throw o=!1,u;return c("throw",u)}),typeof t.return=="function"&&(n.return=function(u){return o?(o=!1,u):c("return",u)}),n},so=a(function(t,e){t.exports=(()=>{var n={8:(u,d,p)=>{p.r(d),p.d(d,{Parser:()=>Qt,Printer:()=>wr,parse:()=>It,print:()=>Mt});const f=`
`,g="".concat("\r").concat(f),E=" ";let I;function _(tt){return tt>="0"&&tt<="9"}function T(tt){return tt>="!"&&tt<="~"}function R(tt){return T(tt)||tt>="\x80"&&tt<="\xFF"}function w(tt){return tt==="!"||tt>="#"&&tt<="'"||tt>="*"&&tt<="+"||tt>="-"&&tt<="."||tt>="0"&&tt<="9"||tt>="A"&&tt<="Z"||tt>="^"&&tt<="~"}function k(tt){return tt>="1"&&tt<="9"}function L(tt){return tt>="A"&&tt<="Z"||tt>="a"&&tt<="z"}function Y(tt){return tt==="d"||tt==="h"||tt==="m"||tt==="s"}function Z(tt){return tt>""&&tt<"	"||tt>"\v"&&tt<"\f"||tt>""&&tt<"\xFF"}function rt(tt){return L(tt)||_(tt)||tt==="+"||tt==="/"}function ut(tt){return _(tt)||L(tt)||tt==="+"||tt==="/"||tt==="-"||tt==="_"}function At(tt){return L(tt)||_(tt)||tt==="+"||tt==="/"}function Ct(tt,y){var D=Object.keys(tt);if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(tt);y&&(x=x.filter(function(et){return Object.getOwnPropertyDescriptor(tt,et).enumerable})),D.push.apply(D,x)}return D}function lt(tt){for(var y=1;y<arguments.length;y++){var D=arguments[y]!=null?arguments[y]:{};y%2?Ct(Object(D),!0).forEach(function(x){Gt(tt,x,D[x])}):Object.getOwnPropertyDescriptors?Object.defineProperties(tt,Object.getOwnPropertyDescriptors(D)):Ct(Object(D)).forEach(function(x){Object.defineProperty(tt,x,Object.getOwnPropertyDescriptor(D,x))})}return tt}function Gt(tt,y,D){return y in tt?Object.defineProperty(tt,y,{value:D,enumerable:!0,configurable:!0,writable:!0}):tt[y]=D,tt}(function(tt){tt.VERSION="v",tt.ORIGIN="o",tt.SESSION_NAME="s",tt.INFORMATION="i",tt.URI="u",tt.EMAIL="e",tt.PHONE="p",tt.CONNECTION="c",tt.BANDWIDTH="b",tt.TIME="t",tt.REPEAT="r",tt.ZONE_ADJUSTMENTS="z",tt.KEY="k",tt.ATTRIBUTE="a",tt.MEDIA="m"})(I||(I={}));class wt{consumeText(y,D){let x=D;for(;x<y.length;){const et=y[x];if(et==="\0"||et==="\r"||et===f)break;x+=1}if(x-D==0)throw new Error("Invalid text, at ".concat(y));return x}consumeUnicastAddress(y,D,x){return this.consumeTill(y,D,E)}consumeOneOrMore(y,D,x){let et=D;for(;x(y[et]);)et++;if(et-D==0)throw new Error("Invalid rule at ".concat(D,"."));return et}consumeSpace(y,D){if(y[D]===E)return D+1;throw new Error("Invalid space at ".concat(D,"."))}consumeIP4Address(y,D){let x=D;for(let et=0;et<4;et++)if(x=this.consumeDecimalUChar(y,x),et!==3){if(y[x]!==".")throw new Error("Invalid IP4 address.");x++}return x}consumeDecimalUChar(y,D){let x=D;for(let Dt=0;Dt<3&&_(y[x]);Dt++,x++);if(x-D==0)throw new Error("Invalid decimal uchar.");const et=parseInt(y.slice(D,x));if(et>=0&&et<=255)return x;throw new Error("Invalid decimal uchar")}consumeIP6Address(y,D){let x=this.consumeHexpart(y,D);return y[x]===":"&&(x+=1,x=this.consumeIP4Address(y,x)),x}consumeHexpart(y,D){let x=D;if(y[x]===":"&&y[x+1]===":"){x+=2;try{x=this.consumeHexseq(y,x)}catch{}return x}if(x=this.consumeHexseq(y,x),y[x]===":"&&y[x+1]===":"){x+=2;try{x=this.consumeHexseq(y,x)}catch{}return x}return x}consumeHexseq(y,D){let x=D;for(;x=this.consumeHex4(y,x),y[x]===":"&&y[x+1]!==":";)x+=1;return x}consumeHex4(y,D){let x=0;for(;x<4;x++)if(!((et=y[D+x])>="0"&&et<="9"||et>="a"&&et<="f"||et>="A"&&et<="F")){if(x===0)throw new Error("Invalid hex 4");break}var et;return D+x}consumeFQDN(y,D){let x=D;for(;_(y[x])||L(y[x])||y[x]==="-"||y[x]===".";)x+=1;if(x-D<4)throw new Error("Invalid FQDN");return x}consumeExtnAddr(y,D){return this.consumeOneOrMore(y,D,R)}consumeMulticastAddress(y,D,x){switch(x){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(y,D);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(y,D);default:try{return this.consumeFQDN(y,D)}catch{return this.consumeExtnAddr(y,D)}}}consumeIP6MulticastAddress(y,D){const x=this.consumeHexpart(y,D);return y[x]==="/"?this.consumeInteger(y,x+1):x}consumeIP4MulticastAddress(y,D){let x=D+3;const et=y.slice(D,x),Dt=parseInt(et);if(Dt<224||Dt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let Se=0;Se<3;Se++){if(y[x]!==".")throw new Error("Invalid IP4 multicast address.");x+=1,x=this.consumeDecimalUChar(y,x)}return y[x]==="/"&&(x+=1),x=this.consumeTTL(y,x),y[x]==="/"&&(x=this.consumeInteger(y,x)),x}consumeInteger(y,D){if(!k(y[D]))throw new Error("Invalid integer.");for(D+=1;_(y[D]);)D+=1;return D}consumeTTL(y,D){if(y[D]==="0")return D+1;if(!k(y[D]))throw new Error("Invalid TTL.");D+=1;for(let x=0;x<2&&_(y[D]);x++)D+=1;return D}consumeToken(y,D){return this.consumeOneOrMore(y,D,w)}consumeTime(y,D){let x=D;if(y[x]==="0")return x+1;for(k(y[x])&&(x+=1);_(y[x]);)x++;if(x-D<10)throw new Error("Invalid time");return x}consumeAddress(y,D){return this.consumeTill(y,D,E)}consumeTypedTime(y,D){let x=D;return x=this.consumeOneOrMore(y,x,_),Y(y[x])?x+1:x}consumeRepeatInterval(y,D){if(!k(y[D]))throw new Error("Invalid repeat interval");for(D+=1;_(y[D]);)D+=1;return Y(y[D])&&(D+=1),D}consumePort(y,D){return this.consumeOneOrMore(y,D,_)}consume(y,D,x){for(let et=0;et<x.length;et++){if(D+et>=y.length)throw new Error("consume exceeding value length");if(y[D+et]!==x[et])throw new Error("consume ".concat(x," failed at ").concat(et))}return D+x.length}consumeTill(y,D,x){let et=D;for(;et<y.length&&(typeof x!="string"||y[et]!==x)&&(typeof x!="function"||!x(y[et]));)et++;return et}}class Qt extends wt{constructor(){super(),Gt(this,"records",[]),Gt(this,"currentLine",0)}parse(y){const D=this.probeEOL(y);this.records=y.split(D).filter(mr=>!!mr.trim()).map(this.parseLine),this.currentLine=0;const x=this.parseVersion(),et=this.parseOrigin(),Dt=this.parseSessionName(),Se=this.parseInformation(),ir=this.parseUri(),ke=this.parseEmail(),Rn=this.parsePhone(),wo=this.parseConnection(),zn=this.parseBandWidth(),rn=this.parseTimeFields(),ka=this.parseKey(),Is=this.parseSessionAttribute(),br=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:x,origin:et,sessionName:Dt,information:Se,uri:ir,emails:ke,phones:Rn,connection:wo,bandwidths:zn,timeFields:rn,key:ka,attributes:Is,mediaDescriptions:br}}getCurrentRecord(){const y=this.records[this.currentLine];if(!y)throw new Error("Record doesn't exit.");return y}probeEOL(y){for(let D=0;D<y.length;D++)if(y[D]===f)return y[D-1]==="\r"?g:f;throw new Error("Invalid newline character.")}parseLine(y,D){if(y.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const x=y[0];if(y[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:x,value:y.slice(2),line:D,cur:0}}parseSessionAttribute(){const y=new ae;for(;this.currentLine<this.records.length;){const D=this.getCurrentRecord();if(D.type!==I.ATTRIBUTE)break;const x={attField:this.extractOneOrMore(D,et=>w(et)&&et!==":"),_cur:0};D.value[D.cur]===":"&&(D.cur+=1,x.attValue=this.extractOneOrMore(D,Z)),y.parse(x),this.currentLine++}return y.digest()}parseMediaAttributes(y){const D=new ge(y);for(;this.currentLine<this.records.length;){const x=this.getCurrentRecord();if(x.type!==I.ATTRIBUTE)break;const et={attField:this.extractOneOrMore(x,Dt=>w(Dt)&&Dt!==":"),_cur:0};x.value[x.cur]===":"&&(x.cur+=1,et.attValue=this.extractOneOrMore(x,Z)),D.parse(et),this.currentLine++}return D.digest()}parseKey(){const y=this.getCurrentRecord();if(y.type===I.KEY){if(y.value==="prompt"||y.value==="clear:"||y.value==="base64:"||y.value==="uri:")return y.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const y=this.getCurrentRecord();if(y.type===I.ZONE_ADJUSTMENTS){const D=[];for(;;)try{const x=this.extract(y,this.consumeTime);this.consumeSpaceForRecord(y);let et=!1;y.value[y.cur]==="-"&&(et=!0,y.cur+=1);const Dt=this.extract(y,this.consumeTypedTime);D.push({time:x,typedTime:Dt,back:et})}catch{break}if(D.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,D}return[]}parseRepeat(){const y=[];for(;;){const D=this.getCurrentRecord();if(D.type!==I.REPEAT)break;{const x=this.extract(D,this.consumeRepeatInterval),et=this.parseTypedTime(D);y.push({repeatInterval:x,typedTimes:et}),this.currentLine++}}return y}parseTypedTime(y){const D=[];for(;;)try{this.consumeSpaceForRecord(y),D.push(this.extract(y,this.consumeTypedTime))}catch{break}if(D.length===0)throw new Error("Invalid typed time.");return D}parseTime(){const y=this.getCurrentRecord(),D=this.extract(y,this.consumeTime);this.consumeSpaceForRecord(y);const x=this.extract(y,this.consumeTime);return this.currentLine++,{startTime:D,stopTime:x}}parseBandWidth(){const y=[];for(;this.currentLine<this.records.length;){const D=this.getCurrentRecord();if(D.type!==I.BANDWIDTH)break;{const x=this.extractOneOrMore(D,w);if(D.value[D.cur]!==":")throw new Error("Invalid bandwidth field.");D.cur++;const et=this.extractOneOrMore(D,_);y.push({bwtype:x,bandwidth:et}),this.currentLine++}}return y}parseVersion(){const y=this.getCurrentRecord();if(y.type!==I.VERSION)throw new Error("first sdp record must be version");const D=y.value.slice(0,this.consumeOneOrMore(y.value,0,_));if(D.length!==y.value.length)throw new Error('invalid proto version, "v='.concat(y.value,'"'));return this.currentLine++,D}parseOrigin(){const y=this.getCurrentRecord();if(y.type!==I.ORIGIN)throw new Error("second line of sdp must be origin");const D=this.extractOneOrMore(y,R);this.consumeSpaceForRecord(y);const x=this.extractOneOrMore(y,_);this.consumeSpaceForRecord(y);const et=this.extractOneOrMore(y,_);this.consumeSpaceForRecord(y);const Dt=this.extractOneOrMore(y,w);this.consumeSpaceForRecord(y);const Se=this.extractOneOrMore(y,w);this.consumeSpaceForRecord(y);const ir=this.extract(y,this.consumeUnicastAddress);return this.currentLine++,{username:D,sessId:x,sessVersion:et,nettype:Dt,addrtype:Se,unicastAddress:ir}}parseSessionName(){const y=this.getCurrentRecord();if(y.type===I.SESSION_NAME){const D=this.extract(y,this.consumeText);return this.currentLine++,D}}parseInformation(){const y=this.getCurrentRecord();if(y.type!==I.INFORMATION)return;const D=this.extract(y,this.consumeText);return this.currentLine++,D}parseUri(){const y=this.getCurrentRecord();if(y.type===I.URI)return this.currentLine++,y.value}parseEmail(){const y=[];for(;;){const D=this.getCurrentRecord();if(D.type!==I.EMAIL)break;y.push(D.value),this.currentLine++}return y}parsePhone(){const y=[];for(;;){const D=this.getCurrentRecord();if(D.type!==I.PHONE)break;y.push(D.value),this.currentLine++}return y}parseConnection(){const y=this.getCurrentRecord();if(y.type===I.CONNECTION){const D=this.extractOneOrMore(y,w);this.consumeSpaceForRecord(y);const x=this.extractOneOrMore(y,w);this.consumeSpaceForRecord(y);const et=this.extract(y,this.consumeAddress);return this.currentLine++,{nettype:D,addrtype:x,address:et}}}parseMedia(){const y=this.getCurrentRecord(),D=this.extract(y,this.consumeToken);this.consumeSpaceForRecord(y);let x=this.extract(y,this.consumePort);y.value[y.cur]==="/"&&(y.cur+=1,x+=this.extract(y,this.consumeInteger)),this.consumeSpaceForRecord(y);const et=[];for(et.push(this.extract(y,this.consumeToken));y.value[y.cur]==="/";)y.cur+=1,et.push(this.extract(y,this.consumeToken));if(et.length===0)throw new Error("Invalid proto");const Dt=this.parseFmt(y);return this.currentLine++,{mediaType:D,port:x,protos:et,fmts:Dt}}parseTimeFields(){const y=[];for(;this.getCurrentRecord().type===I.TIME;){const D=this.parseTime(),x=this.parseRepeat(),et=this.parseZone();y.push({time:D,repeats:x,zones:et})}return y}parseMediaDescription(){const y=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===I.MEDIA;){const D=this.parseMedia(),x=this.parseInformation(),et=this.parseConnections(),Dt=this.parseBandWidth(),Se=this.parseKey(),ir=this.parseMediaAttributes(D);y.push({media:D,information:x,connections:et,bandwidths:Dt,key:Se,attributes:ir})}return y}parseConnections(){const y=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===I.CONNECTION;)y.push(this.parseConnection());return y}parseFmt(y){const D=[];for(;;)try{this.consumeSpaceForRecord(y),D.push(this.extract(y,this.consumeToken))}catch{break}if(D.length===0)throw new Error("Invalid fmts");return D}extract(y,D,...x){const et=D.call(this,y.value,y.cur,...x),Dt=y.value.slice(y.cur,et);return y.cur=et,Dt}extractOneOrMore(y,D){const x=this.consumeOneOrMore(y.value,y.cur,D),et=y.value.slice(y.cur,x);return y.cur=x,et}consumeSpaceForRecord(y){if(y.value[y.cur]!==E)throw new Error("Invalid space at ".concat(y.cur,"."));y.cur+=1}}class xt extends wt{constructor(...y){super(...y),Gt(this,"attributes",void 0),Gt(this,"digested",!1)}extractOneOrMore(y,D,x){const et=this.consumeOneOrMore(y.attValue,y._cur,D),Dt=y.attValue.slice(y._cur,et),[Se,ir]=x||[];if(typeof Se=="number"&&Dt.length<Se)throw new Error("error in length, should be more or equal than ".concat(Se," characters."));if(typeof ir=="number"&&Dt.length>ir)throw new Error("error in length, should be less or equal than ".concat(ir," characters."));return y._cur=et,Dt}consumeAttributeSpace(y){if(y.attValue[y._cur]!==E)throw new Error("Invalid space at ".concat(y._cur,"."));y._cur+=1}extract(y,D,...x){if(!y.attValue)throw new Error("Nothing to extract from attValue.");const et=D.call(this,y.attValue,y._cur,...x),Dt=y.attValue.slice(y._cur,et);return y._cur=et,Dt}atEnd(y){if(!y.attValue)throw new Error;return y._cur>=y.attValue.length}peekChar(y){if(!y.attValue)throw new Error;return y.attValue[y._cur]}peek(y,D){if(!y.attValue)throw new Error;for(let x=0;x<D.length;x++)if(D[x]!==y.attValue[y._cur+x])return!1;return!0}parseIceUfrag(y){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(y,rt,[4,256])}parseIcePwd(y){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(y,rt,[22,256])}parseIceOptions(y){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const D=[];for(;!this.atEnd(y);){D.push(this.extractOneOrMore(y,rt));try{this.consumeAttributeSpace(y)}catch(x){if(this.atEnd(y))break;throw x}}this.attributes.iceOptions=D}parseFingerprint(y){const D=this.extract(y,this.consumeToken);this.consumeAttributeSpace(y);const x=this.extract(y,this.consumeTill);this.attributes.fingerprints.push({hashFunction:D,fingerprint:x})}parseExtmap(y){const D=this.extractOneOrMore(y,_);let x;this.peekChar(y)==="/"&&(this.extract(y,this.consume,"/"),x=this.extract(y,this.consumeToken)),this.consumeAttributeSpace(y);const et=this.extract(y,this.consumeTill,E),Dt=lt(lt({entry:parseInt(D,10)},x&&{direction:x}),{},{extensionName:et});this.peekChar(y)===E&&(this.consumeAttributeSpace(y),Dt.extensionAttributes=this.extract(y,this.consumeTill)),this.attributes.extmaps.push(Dt)}parseSetup(y){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const D=this.extract(y,this.consumeTill);if(D!=="active"&&D!=="passive"&&D!=="actpass"&&D!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=D}}class ae extends xt{constructor(...y){super(...y),Gt(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(y){if(this.digested)throw new Error("already digested");try{switch(y.attField){case"group":this.parseGroup(y);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(y);break;case"ice-pwd":this.parseIcePwd(y);break;case"ice-options":this.parseIceOptions(y);break;case"fingerprint":this.parseFingerprint(y);break;case"setup":this.parseSetup(y);break;case"tls-id":this.parseTlsId(y);break;case"identity":this.parseIdentity(y);break;case"extmap":this.parseExtmap(y);break;case"msid-semantic":this.parseMsidSemantic(y);break;default:y.ignored=!0,this.attributes.unrecognized.push(y)}}catch(D){throw console.error("parsing session attribute ".concat(y.attField,' error, "a=').concat(y.attField,":").concat(y.attValue,'"')),D}if(!y.ignored&&y.attValue&&!this.atEnd(y))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(y){const D=this.extract(y,this.consumeToken),x=[];for(;!this.atEnd(y)&&this.peekChar(y)===E;)this.consumeAttributeSpace(y),x.push(this.extract(y,this.consumeToken));this.attributes.groups.push({semantic:D,identificationTag:x})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(y){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(y,ut)}parseIdentity(y){const D=this.extractOneOrMore(y,At),x=[];for(;!this.atEnd(y)&&this.peekChar(y)===E;){this.consumeAttributeSpace(y);const et=this.extract(y,this.consumeToken);this.extract(y,this.consume,"=");const Dt=this.extractOneOrMore(y,Se=>Se!==E&&Z(Se));x.push({name:et,value:Dt})}this.attributes.identities.push({assertionValue:D,extensions:x})}parseMsidSemantic(y){this.peekChar(y)===E&&this.consumeAttributeSpace(y);const D={semantic:this.extract(y,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(y)}catch{break}if(this.peekChar(y)==="*"){this.extract(y,this.consume,"*"),D.applyForAll=!0;break}{const x=this.extract(y,this.consumeTill,E);D.identifierList.push(x)}}this.attributes.msidSemantic=D}}class ge extends xt{constructor(y){super(),Gt(this,"attributes",void 0),y.protos.indexOf("RTP")!==-1||y.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(y){if(this.digested)throw new Error("already digested");try{switch(y.attField){case"extmap":this.parseExtmap(y);break;case"setup":this.parseSetup(y);break;case"ice-ufrag":this.parseIceUfrag(y);break;case"ice-pwd":this.parseIcePwd(y);break;case"ice-options":this.parseIceOptions(y);break;case"candidate":this.parseCandidate(y);break;case"remote-candidate":this.parseRemoteCandidate(y);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(y);break;case"rtpmap":this.parseRtpmap(y);break;case"ptime":this.parsePtime(y);break;case"maxptime":this.parseMaxPtime(y);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(y);break;case"ssrc":this.parseSSRC(y);break;case"fmtp":this.parseFmtp(y);break;case"rtcp-fb":this.parseRtcpFb(y);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(y);break;case"mid":this.parseMid(y);break;case"msid":this.parseMsid(y);break;case"imageattr":this.parseImageAttr(y);break;case"rid":this.parseRid(y);break;case"simulcast":this.parseSimulcast(y);break;case"sctp-port":this.parseSctpPort(y);break;case"max-message-size":this.parseMaxMessageSize(y);break;case"ssrc-group":this.parseSSRCGroup(y);break;default:y.ignored=!0,this.attributes.unrecognized.push(y)}}catch(D){throw console.error("parsing media attribute ".concat(y.attField,' error, "a=').concat(y.attField,":").concat(y.attValue,'"')),D}if(!y.ignored&&y.attValue&&!this.atEnd(y))throw new Error("attribute parsing error")}parseCandidate(y){const D=this.extractOneOrMore(y,rt,[1,32]);this.consumeAttributeSpace(y);const x=this.extractOneOrMore(y,_,[1,5]);this.consumeAttributeSpace(y);const et=this.extract(y,this.consumeToken);this.consumeAttributeSpace(y);const Dt=this.extractOneOrMore(y,_,[1,10]);this.consumeAttributeSpace(y);const Se=this.extract(y,this.consumeAddress);this.consumeAttributeSpace(y);const ir=this.extract(y,this.consumePort);this.consumeAttributeSpace(y),this.extract(y,this.consume,"typ"),this.consumeAttributeSpace(y);const ke={foundation:D,componentId:x,transport:et,priority:Dt,connectionAddress:Se,port:ir,type:this.extract(y,this.consumeToken),extension:{}};for(this.peek(y," raddr")&&(this.extract(y,this.consume," raddr"),this.consumeAttributeSpace(y),ke.relAddr=this.extract(y,this.consumeAddress)),this.peek(y," rport")&&(this.extract(y,this.consume," rport"),this.consumeAttributeSpace(y),ke.relPort=this.extract(y,this.consumePort));this.peekChar(y)===E;){this.consumeAttributeSpace(y);const Rn=this.extract(y,this.consumeToken);this.consumeAttributeSpace(y),ke.extension[Rn]=this.extractOneOrMore(y,T)}this.attributes.candidates.push(ke)}parseRemoteCandidate(y){const D=[];for(;;){const x=this.extractOneOrMore(y,_,[1,5]);this.consumeAttributeSpace(y);const et=this.extract(y,this.consumeAddress);this.consumeAttributeSpace(y);const Dt=this.extract(y,this.consumePort);D.push({componentId:x,connectionAddress:et,port:Dt});try{this.consumeAttributeSpace(y)}catch{break}}this.attributes.remoteCandidatesList.push(D)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(y){const D=this.extract(y,this.consumeToken);this.consumeAttributeSpace(y);const x=this.extract(y,this.consumeTill,"/");this.extract(y,this.consume,"/");const et={encodingName:x,clockRate:this.extractOneOrMore(y,_)};this.atEnd(y)||this.peekChar(y)!=="/"||(this.extract(y,this.consume,"/"),et.encodingParameters=parseInt(this.extract(y,this.consumeTill),10));const Dt=this.attributes.payloads.find(Se=>Se.payloadType===parseInt(D,10));Dt?Dt.rtpMap=et:this.attributes.payloads.push({payloadType:parseInt(D,10),rtpMap:et,rtcpFeedbacks:[]})}parsePtime(y){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(y,this.consumeTill)}parseMaxPtime(y){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(y,this.consumeTill)}parseDirection(y){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=y.attField}parseSSRC(y){const D=this.extractOneOrMore(y,_);this.consumeAttributeSpace(y);const x=this.extract(y,this.consumeTill,":");let et;this.peekChar(y)===":"&&(this.extract(y,this.consume,":"),et=this.extract(y,this.consumeTill));const Dt=this.attributes.ssrcs.find(Se=>Se.ssrcId===parseInt(D,10));Dt?Dt.attributes[x]=et:this.attributes.ssrcs.push({ssrcId:parseInt(D,10),attributes:{[x]:et}})}parseFmtp(y){const D=this.extract(y,this.consumeTill,E);this.consumeAttributeSpace(y);const x=this.extract(y,this.consumeTill),et={};x.split(";").forEach(Se=>{let[ir,ke]=Se.split("=");ir=ir.trim(),ke=typeof ke=="string"?ke.trim():ke,typeof ir=="string"&&ir.length>0&&(et[ir]=ke)});const Dt=this.attributes.payloads.find(Se=>Se.payloadType===parseInt(D,10));Dt?Dt.fmtp={parameters:et}:this.attributes.payloads.push({payloadType:parseInt(D,10),rtcpFeedbacks:[],fmtp:{parameters:et}})}parseFmtParameters(y){const D={},x=this.extract(y,this.consumeTill,"=");y._cur++;const et=this.extract(y,this.consumeTill,";");for(D[x]=et;y.attValue[y._cur]===";";){const Dt=this.extract(y,this.consumeTill,"=");y._cur++;const Se=this.extract(y,this.consumeTill,";");D[Dt]=Se}return D}parseRtcpFb(y){let D="";D=this.peekChar(y)==="*"?this.extract(y,this.consume,"*"):this.extract(y,this.consumeTill,E),this.consumeAttributeSpace(y);const x=this.extract(y,this.consumeTill,E);let et;switch(x){case"trr-int":et={type:x,interval:this.extract(y,this.consumeTill)};break;case"ack":case"nack":default:{const Dt={type:x};this.peekChar(y)===E&&(this.consumeAttributeSpace(y),Dt.parameter=this.extract(y,this.consumeToken),this.peekChar(y)===E&&(Dt.additional=this.extract(y,this.consumeTill))),et=Dt}}if(D==="*")this.attributes.rtcpFeedbackWildcards.push(et);else{const Dt=this.attributes.payloads.find(Se=>Se.payloadType===parseInt(D,10));Dt?Dt.rtcpFeedbacks.push(et):this.attributes.payloads.push({payloadType:parseInt(D,10),rtcpFeedbacks:[et]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(y){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const D={port:this.extract(y,this.consumePort)};this.peekChar(y)===E&&(this.consumeAttributeSpace(y),D.netType=this.extractOneOrMore(y,w),this.consumeAttributeSpace(y),D.addressType=this.extractOneOrMore(y,w),this.consumeAttributeSpace(y),D.address=this.extract(y,this.consumeAddress)),this.attributes.rtcp=D}parseMsid(y){const D={id:this.extractOneOrMore(y,w,[1,64])};this.peekChar(y)===E&&(this.consumeAttributeSpace(y),D.appdata=this.extractOneOrMore(y,w,[1,64])),this.attributes.msids.push(D)}parseImageAttr(y){this.attributes.imageattr.push(y.attValue)}parseRid(y){const D=this.extractOneOrMore(y,et=>L(et)||_(et)||et==="_"||et==="-");this.consumeAttributeSpace(y);const x={id:D,direction:this.extract(y,this.consumeToken),params:[]};if(this.peekChar(y)===E){if(this.consumeAttributeSpace(y),this.peek(y,"pt=")){this.extract(y,this.consume,"pt=");const et=[];for(;;){const Dt=this.extract(y,this.consumeToken);et.push(Dt);try{this.extract(y,this.consume,",")}catch{break}}x.payloads=et,this.peekChar(y)===E&&this.extract(y,this.consume,E)}for(;;){const et=this.extract(y,this.consumeToken);switch(et){case"depend":{const Dt={type:et,rids:this.extract(y,this.consume,"=").split(",")};x.params.push(Dt);break}case"max-width":case"height-width":case"max-fps":case"max-fs":case"max-br":case"max-pps":case"max-bpp":default:{const Dt={type:et};this.peekChar(y)==="="&&(this.extract(y,this.consume,"="),Dt.val=this.extract(y,this.consumeTill,";")),x.params.push(Dt)}}try{this.extract(y,this.consume,";")}catch{break}}}this.attributes.rids.push(x)}parseSimulcast(y){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=y.attValue,this.extract(y,this.consumeTill)}parseSctpPort(y){this.attributes.sctpPort=this.extractOneOrMore(y,_,[1,5])}parseMaxMessageSize(y){this.attributes.maxMessageSize=this.extractOneOrMore(y,_,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(y){this.attributes.mid=this.extract(y,this.consumeToken)}parseSSRCGroup(y){const D=this.extract(y,this.consumeToken),x=[];for(;;)try{this.consumeAttributeSpace(y);const et=this.extract(y,this.consumeInteger);x.push(parseInt(et,10))}catch{break}this.attributes.ssrcGroups.push({semantic:D,ssrcIds:x})}}function re(tt,y,D){return y in tt?Object.defineProperty(tt,y,{value:D,enumerable:!0,configurable:!0,writable:!0}):tt[y]=D,tt}class wr{constructor(){re(this,"eol",g)}print(y,D){let x="";return D&&(this.eol=D),x+=this.printVersion(y.version),x+=this.printOrigin(y.origin),x+=this.printSessionName(y.sessionName),x+=this.printInformation(y.information),x+=this.printUri(y.uri),x+=this.printEmail(y.emails),x+=this.printPhone(y.phones),x+=this.printConnection(y.connection),x+=this.printBandwidth(y.bandwidths),x+=this.printTimeFields(y.timeFields),x+=this.printKey(y.key),x+=this.printSessionAttributes(y.attributes),x+=this.printMediaDescription(y.mediaDescriptions),x}printVersion(y){return"v=".concat(y).concat(this.eol)}printOrigin(y){return"o=".concat(y.username," ").concat(y.sessId," ").concat(y.sessVersion," ").concat(y.nettype," ").concat(y.addrtype," ").concat(y.unicastAddress).concat(this.eol)}printSessionName(y){return y?"s=".concat(y).concat(this.eol):""}printInformation(y){return y?"i=".concat(y).concat(this.eol):""}printUri(y){return y?"u=".concat(y).concat(this.eol):""}printEmail(y){let D="";for(const x of y)D+="e=".concat(x).concat(this.eol);return D}printPhone(y){let D="";for(const x of y)D+="e=".concat(x).concat(this.eol);return D}printConnection(y){return y?"c=".concat(y.nettype," ").concat(y.addrtype," ").concat(y.address).concat(this.eol):""}printBandwidth(y){let D="";for(const x of y)D+="b=".concat(x.bwtype,":").concat(x.bandwidth).concat(this.eol);return D}printTimeFields(y){let D="";for(const x of y){D+="t=".concat(x.time.startTime," ").concat(x.time.startTime).concat(this.eol);for(const et of x.repeats)D+="r=".concat(et.repeatInterval," ").concat(et.typedTimes.join(" ")).concat(this.eol);x.zoneAdjustments&&(D+="z=",D+="z=".concat(x.zoneAdjustments.map(et=>"".concat(et.time," ").concat(et.back?"-":""," ").concat(et.typedTime)).join(" ")).concat(this.eol),D+=this.eol)}return D}printKey(y){return y?"k=".concat(y).concat(this.eol):""}printAttributes(y){let D="";for(const x of y)D+="a=".concat(x.attField).concat(x.attValue?":".concat(x.attValue):"").concat(this.eol);return D}printMediaDescription(y){let D="";for(const x of y)D+=this.printMedia(x.media),D+=this.printInformation(x.information),D+=this.printConnections(x.connections),D+=this.printBandwidth(x.bandwidths),D+=this.printKey(x.key),D+=this.printMediaAttributes(x);return D}printConnections(y){let D="";for(const x of y)D+=this.printConnection(x);return D}printMedia(y){return"m=".concat(y.mediaType," ").concat(y.port," ").concat(y.protos.join("/")," ").concat(y.fmts.join(" ")).concat(this.eol)}printSessionAttributes(y){return new nt(this.eol).print(y)}printMediaAttributes(y){return new gt(this.eol).print(y)}}class z{constructor(y){re(this,"eol",void 0),this.eol=y}printIceUfrag(y){return y===void 0?"":"a=ice-ufrag:".concat(y).concat(this.eol)}printIcePwd(y){return y===void 0?"":"a=ice-pwd:".concat(y).concat(this.eol)}printIceOptions(y){return y===void 0?"":"a=ice-options:".concat(y.join(E)).concat(this.eol)}printFingerprints(y){return y.length>0?y.map(D=>"a=fingerprint:".concat(D.hashFunction).concat(E).concat(D.fingerprint)).join(this.eol)+this.eol:""}printExtmap(y){return y.map(D=>"a=extmap:".concat(D.entry).concat(D.direction?"/".concat(D.direction):"").concat(E).concat(D.extensionName).concat(D.extensionAttributes?"".concat(E).concat(D.extensionAttributes):"").concat(this.eol)).join("")}printSetup(y){return y===void 0?"":"a=setup:".concat(y).concat(this.eol)}printUnrecognized(y){return y.map(D=>"a=".concat(D.attField).concat(D.attValue?":".concat(D.attValue):"").concat(this.eol)).join("")}}class nt extends z{print(y){let D="";return D+=this.printGroups(y.groups),D+=this.printMsidSemantic(y.msidSemantic),D+=this.printIceLite(y.iceLite),D+=this.printIceUfrag(y.iceUfrag),D+=this.printIcePwd(y.icePwd),D+=this.printIceOptions(y.iceOptions),D+=this.printFingerprints(y.fingerprints),D+=this.printSetup(y.setup),D+=this.printTlsId(y.tlsId),D+=this.printIdentity(y.identities),D+=this.printExtmap(y.extmaps),D+=this.printUnrecognized(y.unrecognized),D}printGroups(y){let D="";return y.length>0&&(D+=y.map(x=>"a=group:".concat(x.semantic).concat(x.identificationTag.map(et=>"".concat(E).concat(et)).join("")).concat(this.eol)).join("")),D}printIceLite(y){return y===void 0?"":"a=ice-lite"+this.eol}printTlsId(y){return y?"a=tls-id:".concat(y).concat(this.eol):""}printIdentity(y){return y.length===0?"":y.map(D=>"a=identity:".concat(D.assertionValue).concat(D.extensions.map(x=>"".concat(E).concat(x.name).concat(x.value?"=".concat(x.value):"")))).join(this.eol)+this.eol}printMsidSemantic(y){if(!y)return"";let D="a=msid-semantic:".concat(y.semantic);return y.applyForAll?D+="".concat(E,"*"):y.identifierList.length>0&&(D+=y.identifierList.map(x=>"".concat(E).concat(x))),D+this.eol}}class gt extends z{print(y){const D=y.attributes;let x="";return x+=this.printRTCP(D.rtcp),x+=this.printIceUfrag(D.iceUfrag),x+=this.printIcePwd(D.icePwd),x+=this.printIceOptions(D.iceOptions),x+=this.printCandidates(D.candidates),x+=this.printRemoteCandidatesList(D.remoteCandidatesList),x+=this.printEndOfCandidates(D.endOfCandidates),x+=this.printFingerprints(D.fingerprints),x+=this.printSetup(D.setup),x+=this.printMid(D.mid),x+=this.printExtmap(D.extmaps),x+=this.printRTPRelated(D),x+=this.printPtime(D.ptime),x+=this.printMaxPtime(D.maxPtime),x+=this.printDirection(D.direction),x+=this.printSSRCGroups(D.ssrcGroups),x+=this.printSSRC(D.ssrcs),x+=this.printRTCPMux(D.rtcpMux),x+=this.printRTCPMuxOnly(D.rtcpMuxOnly),x+=this.printRTCPRsize(D.rtcpRsize),x+=this.printMSId(D.msids),x+=this.printImageattr(D.imageattr),x+=this.printRid(D.rids),x+=this.printSimulcast(D.simulcast),x+=this.printSCRPPort(D.sctpPort),x+=this.printMaxMessageSize(D.maxMessageSize),x+=this.printUnrecognized(D.unrecognized),x}printCandidates(y){return y.map(D=>"a=candidate:".concat(D.foundation).concat(E).concat(D.componentId).concat(E).concat(D.transport).concat(E).concat(D.priority).concat(E).concat(D.connectionAddress).concat(E).concat(D.port).concat(E,"typ").concat(E).concat(D.type).concat(D.relAddr?"".concat(E,"raddr").concat(E).concat(D.relAddr):"").concat(D.relPort?"".concat(E,"rport").concat(E).concat(D.relPort):"").concat(Object.keys(D.extension).map(x=>"".concat(E).concat(x).concat(E).concat(D.extension[x])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(y){return y.map(D=>"a=remote-candidates:".concat(D.join(E)).concat(this.eol)).join("")}printEndOfCandidates(y){return y===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(y){if(!y.payloads)return"";const D=y.payloads;let x="";x+=y.rtcpFeedbackWildcards.map(et=>this.printRTCPFeedback("*",et)).join("");for(const et of D)x+=this.printRtpMap(et.payloadType,et.rtpMap),x+=this.printFmtp(et.payloadType,et.fmtp),x+=et.rtcpFeedbacks.map(Dt=>this.printRTCPFeedback(et.payloadType,Dt)).join("");return x}printFmtp(y,D){if(!D)return"";const x=Object.keys(D.parameters);return x.length===1&&D.parameters[x[0]]===void 0?"a=fmtp:".concat(y).concat(E).concat(x[0]).concat(this.eol):"a=fmtp:".concat(y).concat(E).concat(Object.keys(D.parameters).map(et=>"".concat(et,"=").concat(D.parameters[et])).join(";")).concat(this.eol)}printRtpMap(y,D){return D?"a=rtpmap:".concat(y).concat(E).concat(D.encodingName,"/").concat(D.clockRate).concat(D.encodingParameters?"/".concat(D.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(y,D){let x="a=rtcp-fb:".concat(y).concat(E),et=D;switch(et.type){case"trr-int":x+="ttr-int".concat(E).concat(et.interval);break;case"ack":case"nack":default:et=et,x+="".concat(et.type),et.parameter&&(x+="".concat(E).concat(et.parameter),et.additional&&(x+="".concat(E).concat(et.additional)))}return x+this.eol}printPtime(y){return y===void 0?"":"a=ptime:".concat(y).concat(this.eol)}printMaxPtime(y){return y===void 0?"":"a=maxptime:".concat(y).concat(this.eol)}printDirection(y){return y===void 0?"":"a=".concat(y).concat(this.eol)}printSSRC(y){return y.map(D=>Object.keys(D.attributes).map(x=>"a=ssrc:".concat(D.ssrcId.toString(10)).concat(E).concat(x).concat(D.attributes[x]?":".concat(D.attributes[x]):"").concat(this.eol)).join("")).join("")}printRTCPMux(y){return y===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(y){return y===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(y){return y===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(y){if(y===void 0)return"";let D="a=rtcp:".concat(y.port);return y.netType&&(D+="".concat(E).concat(y.netType)),y.addressType&&(D+="".concat(E).concat(y.addressType)),y.address&&(D+="".concat(E).concat(y.address)),D+this.eol}printMSId(y){return y.map(D=>"a=msid:".concat(D.id).concat(D.appdata?"".concat(E).concat(D.appdata):"").concat(this.eol)).join("")}printImageattr(y){return y.map(D=>"a=imageattr:".concat(D).concat(this.eol)).join("")}printRid(y){return y.map(D=>{let x="a=rid:".concat(D.id).concat(E).concat(D.direction);return D.payloads&&(x+="".concat(E,"pt=").concat(D.payloads.join(","))),D.params.length>0&&(x+="".concat(E).concat(D.params.map(et=>et.type==="depend"?"depend=".concat(et.rids.join(",")):"".concat(et.type,"=").concat(et.val)).join(";"))),x+this.eol}).join("")}printSimulcast(y){return y===void 0?"":"a=simulcast:".concat(y).concat(this.eol)}printSCRPPort(y){return y===void 0?"":"a=sctp-port:".concat(y).concat(this.eol)}printMaxMessageSize(y){return y===void 0?"":"a=max-message-size:".concat(y)}printMid(y){return y===void 0?"":"a=mid:".concat(y).concat(this.eol)}printSSRCGroups(y){return y.map(D=>"a=ssrc-group:".concat(D.semantic).concat(D.ssrcIds.map(x=>"".concat(E).concat(x.toString(10))).join("")).concat(this.eol)).join("")}}function It(tt){return new Qt().parse(tt)}function Mt(tt,y){return new wr().print(tt,y)}}},o={};function c(u){if(o[u])return o[u].exports;var d=o[u]={exports:{}};return n[u](d,d.exports,c),d.exports}return c.d=(u,d)=>{for(var p in d)c.o(d,p)&&!c.o(u,p)&&Object.defineProperty(u,p,{enumerable:!0,get:d[p]})},c.o=(u,d)=>Object.prototype.hasOwnProperty.call(u,d),c.r=u=>{typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(u,"__esModule",{value:!0})},c(8)})()});function g_(t,e){var n=ue(t);if(_e){var o=_e(t);e&&(o=Ot(o).call(o,function(c){return zt(t,c).enumerable})),n.push.apply(n,o)}return n}function m_(t){for(var e=1;e<arguments.length;e++){var n,o=arguments[e]!=null?arguments[e]:{};if(e%2)G(n=g_(Object(o),!0)).call(n,function(u){qr(t,u,o[u])});else if(Ce)dr(t,Ce(o));else{var c;G(c=g_(Object(o))).call(c,function(u){te(t,u,zt(o,u))})}}return t}function Rf(t,e,n,o,c,u){var d;let p=[],f=[],g=[],E=[],I=!1,_=!1;const T=so.parse(t);if(G(d=T.mediaDescriptions).call(d,R=>{u&&u!==R.attributes.direction||(R.media.mediaType!=="video"||I||(f=R.attributes.payloads,E=R.attributes.extmaps,I=!0),R.media.mediaType!=="audio"||_||(p=R.attributes.payloads,g=R.attributes.extmaps,_=!0))}),!E||f.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!g||p.length===0)throw new Error("Cannot get audio capabilities from SDP.");return G(f).call(f,R=>{var w;(w=R.rtpMap)!==null&&w!==void 0&&w.clockRate&&(R.rtpMap.clockRate=rr(R.rtpMap.clockRate))}),G(p).call(p,R=>{var w;(w=R.rtpMap)!==null&&w!==void 0&&w.clockRate&&(R.rtpMap.clockRate=rr(R.rtpMap.clockRate))}),e&&(p=Ot(p).call(p,R=>{var w;return((w=R.rtpMap)===null||w===void 0?void 0:w.encodingName.toLowerCase())!=="rtx"}),f=Ot(f).call(f,R=>{var w;return((w=R.rtpMap)===null||w===void 0?void 0:w.encodingName.toLowerCase())!=="rtx"})),n&&(f=Ot(f).call(f,R=>{var w;return!/(red)|(ulpfec)|(flexfec)/i.test(((w=R.rtpMap)===null||w===void 0?void 0:w.encodingName)||"")})),o&&(o==null?void 0:o.length)>0&&(p=Ot(p).call(p,R=>{var w;return Xt(o).call(o,((w=R.rtpMap)===null||w===void 0?void 0:w.encodingName.toLowerCase())||"")})),c&&(c==null?void 0:c.length)>0&&(f=Ot(f).call(f,R=>{var w;return Xt(c).call(c,((w=R.rtpMap)===null||w===void 0?void 0:w.encodingName.toLowerCase())||"")})),{audioCodecs:p,videoCodecs:f,audioExtensions:g,videoExtensions:E}}function Vd(t){const e=so.parse(t);let n,o;for(const c of e.mediaDescriptions){if(!n){const u=c.attributes.iceUfrag,d=c.attributes.icePwd;if(!u||!d)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:u,icePwd:d}}if(!o){const u=c.attributes.fingerprints;u.length>0&&(o={fingerprints:u})}}if(!o&&e.attributes.fingerprints.length>0&&(o={fingerprints:e.attributes.fingerprints}),!o||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:o}}function E_(t,e,n){var o;const{cname:c}=t;let u;var d,p,f;e!==void 0&&n!==void 0?(u=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e,port:n.toString(),type:"host",extension:{}}],N.debug(M(d="Using remote candidate from AP ".concat(e,":")).call(d,n)),Lt("debug",[],M(p="Using remote candidate from AP ".concat(e,":")).call(p,n))):u=ht(f=t.iceParameters.candidates).call(f,_=>({foundation:_.foundation,componentId:"1",transport:_.protocol,priority:_.priority.toString(),connectionAddress:_.ip,port:_.port.toString(),type:_.type,extension:{}}));const g={fingerprints:ht(o=t.dtlsParameters.fingerprints).call(o,_=>({hashFunction:_.algorithm,fingerprint:_.fingerprint}))},E={iceUfrag:t.iceParameters.iceUfrag,icePwd:t.iceParameters.icePwd};let I;switch(t.dtlsParameters.role){case"server":I="passive";break;case"client":I="active";break;case"auto":I="actpass"}return{dtlsParameters:g,iceParameters:E,candidates:u,rtpCapabilities:__(t.rtpCapabilities),setup:I,cname:c}}function kc(t,e,n){const o=[],c=[];return G(t).call(t,({ssrcId:u,rtx:d})=>{var p;const f=gr(8,"track-"),g={ssrcId:u,attributes:m_({label:f,mslabel:n=n||gr(10,""),msid:M(p="".concat(n," ")).call(p,f)},e&&{cname:e})};if(o.push(g),d!==void 0){var E;const I={ssrcId:d,attributes:m_({label:f,mslabel:n,msid:M(E="".concat(n," ")).call(E,f)},e&&{cname:e})};o.push(I),c.push({semantic:"FID",ssrcIds:[u,d]})}}),t.length>1&&c.push({semantic:"SIM",ssrcIds:ht(t).call(t,({ssrcId:u})=>u)}),{ssrcs:o,ssrcGroups:c}}function Gd(t,e){var n;e instanceof lr&&G(n=t.attributes.payloads).call(n,o=>{var c,u;const d=(c=o.rtpMap)===null||c===void 0?void 0:c.encodingName.toLowerCase();if(!d||Ft(u=["opus","pcmu","pcma","g722"]).call(u,d)===-1)return;o.fmtp||(o.fmtp={parameters:{}}),o.fmtp.parameters.minptime="10",o.fmtp.parameters.useinbandfec="1";const p=e._encoderConfig;p&&(d!=="pcmu"&&d!=="pcma"&&d!=="g722"&&(p.bitrate&&!si()&&(o.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*p.bitrate))),p.sampleRate&&(o.fmtp.parameters.maxplaybackrate="".concat(p.sampleRate),o.fmtp.parameters["sprop-maxcapturerate"]="".concat(p.sampleRate))),p.stereo&&(o.fmtp.parameters.stereo="1",o.fmtp.parameters["sprop-stereo"]="1"))})}function v_(t){var e;const n=Jn(e=t.attributes.unrecognized).call(e,c=>c.attField==="x-google-flag"&&c.attValue==="conference");var o;n!==-1&&Ze(o=t.attributes.unrecognized).call(o,n,1)}function I_(t,e){var n,o;if(!(e instanceof We&&e._encoderConfig&&Ft(n=e._hints).call(n,dn.SCREEN_TRACK)===-1))return;const c=e._encoderConfig;var u,d;Mn().supportMinBitrate&&c.bitrateMin&&G(u=t.attributes.payloads).call(u,p=>{var f,g;Xt(f=["h264","vp8","vp9","av1"]).call(f,((g=p.rtpMap)===null||g===void 0?void 0:g.encodingName.toLowerCase())||"")&&(p.fmtp||(p.fmtp={parameters:{}}),p.fmtp.parameters["x-google-min-bitrate"]="".concat(c.bitrateMin))}),Mn().supportMinBitrate&&!Xt(o=e._hints).call(o,dn.LOW_STREAM)&&c.bitrateMax&&G(d=t.attributes.payloads).call(d,p=>{var f,g;Xt(f=["h264","vp8","vp9","av1"]).call(f,((g=p.rtpMap)===null||g===void 0?void 0:g.encodingName.toLowerCase())||"")&&(p.fmtp||(p.fmtp={parameters:{}}),p.fmtp.parameters["x-google-start-bitrate"]="".concat(Math.floor(c.bitrateMax)))})}function C_(t,e,n){if(!e)return;let o,c;if(t.media.mediaType==="video"?(o=n.videoExtensions,c=n.videoCodecs):(o=n.audioExtensions,c=n.audioCodecs),e.tcc===!0){const T=yt(o).call(o,R=>R.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");if(T){var u;yt(u=t.attributes.extmaps).call(u,w=>w.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")||t.attributes.extmaps.push({entry:T.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"});const R=function(w,k){return Ot(k).call(k,L=>!!yt(w).call(w,Y=>{var Z;return Y.payloadType===L.payloadType&&!!yt(Z=Y.rtcpFeedbacks).call(Z,rt=>rt.type==="transport-cc")}))}(c,t.attributes.payloads);G(R).call(R,w=>{var k;yt(k=w.rtcpFeedbacks).call(k,L=>L.type==="transport-cc")||w.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(e.tcc===!1){var d,p;const T=Jn(d=t.attributes.extmaps).call(d,R=>R.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");var f;T!==-1&&Ze(f=t.attributes.extmaps).call(f,T,1),G(p=t.attributes.payloads).call(p,R=>{var w;const k=Jn(w=R.rtcpFeedbacks).call(w,Y=>Y.type==="transport-cc");var L;k!==-1&&Ze(L=R.rtcpFeedbacks).call(L,k,1)})}if(e.remb===!0){const T=yt(o).call(o,R=>R.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");if(T){var g;yt(g=t.attributes.extmaps).call(g,w=>w.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time")||t.attributes.extmaps.push({entry:T.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"});const R=function(w,k){return Ot(k).call(k,L=>!!yt(w).call(w,Y=>{var Z;return Y.payloadType===L.payloadType&&!!yt(Z=Y.rtcpFeedbacks).call(Z,rt=>rt.type==="goog-remb")}))}(c,t.attributes.payloads);G(R).call(R,w=>{var k;yt(k=w.rtcpFeedbacks).call(k,L=>L.type==="goog-remb")||w.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(e.remb===!1){var E,I;const T=Jn(E=t.attributes.extmaps).call(E,R=>R.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");var _;T!==-1&&Ze(_=t.attributes.extmaps).call(_,T,1),G(I=t.attributes.payloads).call(I,R=>{var w;const k=Jn(w=R.rtcpFeedbacks).call(w,Y=>Y.type==="goog-remb");var L;k!==-1&&Ze(L=R.rtcpFeedbacks).call(L,k,1)})}}function jd(t,e,n,o,c,u){if(n==="videoExtensions"||n==="audioExtensions"){var d,p;const E=[];return G(d=t[n]).call(d,I=>{var _;Bi(_=e[n]).call(_,(T,R)=>{if(I.entry===T.entry&&I.extensionName===T.extensionName)return E.push(R),!0})?u[n].push(I):o[n].push(I)}),void G(p=e[n]).call(p,(I,_)=>{Ft(E).call(E,_)===-1&&c[n].push(I)})}if(n==="videoCodecs"||n==="audioCodecs"){var f,g;const E=[];return G(f=t[n]).call(f,I=>{var _;Bi(_=e[n]).call(_,(T,R)=>{if(I.payloadType===T.payloadType&&at(I)===at(T))return E.push(R),!0})?u[n].push(I):o[n].push(I)}),void G(g=e[n]).call(g,(I,_)=>{Ft(E).call(E,_)===-1&&c[n].push(I)})}}function __(t){const{send:e,recv:n,sendrecv:o}=t;if(!o){if(!e||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:e,recv:n}}let c,u;return e?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...e.audioCodecs,...o.audioCodecs],c.videoCodecs=[...e.videoCodecs,...o.videoCodecs],c.audioExtensions=[...e.audioExtensions,...o.audioExtensions],c.videoExtensions=[...e.videoExtensions,...o.videoExtensions]):c=o,n?(u={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},u.audioCodecs=[...n.audioCodecs,...o.audioCodecs],u.videoCodecs=[...n.videoCodecs,...o.videoCodecs],u.audioExtensions=[...n.audioExtensions,...o.audioExtensions],u.videoExtensions=[...n.videoExtensions,...o.videoExtensions]):u=o,{send:c,recv:u}}class rO{constructor(e){e=en(e);const{remoteIceParameters:n,remoteDtlsParameters:o,candidates:c,remoteRTPCapabilities:u,remoteSetup:d,localCapabilities:p,sdkCodec:f,cname:g}=e,E=so.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=u,this.candidates=c,this.iceParameters=n,this.dtlsParameters=o,this.setup=d,this.localCapabilities=p,this.cname=g;for(let R=0;R<E.mediaDescriptions.length;R++){const w=E.mediaDescriptions[R];if(w.attributes.iceUfrag=n.iceUfrag,w.attributes.icePwd=n.icePwd,w.attributes.fingerprints=o.fingerprints,w.attributes.candidates=c,w.attributes.setup=d,w.media.mediaType==="video"){var I,_;w.media.fmts=ht(I=u.videoCodecs).call(I,L=>L.payloadType.toString(10));const k=Ot(_=u.videoCodecs).call(_,L=>{var Y,Z;return(Y=L.rtpMap)===null||Y===void 0?void 0:Xt(Z=Y.encodingName.toLowerCase()).call(Z,f)});if(k.length===0)throw new Error("Codec ".concat(f," not supported by remote SDP."));w.attributes.payloads=k,w.attributes.extmaps=u.videoExtensions}var T;w.media.mediaType==="audio"&&(w.media.fmts=ht(T=u.audioCodecs).call(T,k=>k.payloadType.toString(10)),w.attributes.payloads=u.audioCodecs,w.attributes.extmaps=u.audioExtensions),E.mediaDescriptions[R]=this.mungMediaDesc(w)}this.sessionDesc=E,this.currentMidIndex=E.mediaDescriptions.length-1}toString(){return so.print(this.sessionDesc)}send(e,n,o){var c,u,d;const{ssrcs:p,ssrcGroups:f}=kc(n,this.cname),g=yt(c=this.sessionDesc.mediaDescriptions).call(c,_=>e===xe.VIDEO?_.media.mediaType==="video":_.media.mediaType==="audio"),E=p[0].attributes.label,I=p[0].attributes.mslabel;return g.attributes.ssrcs=M(u=g.attributes.ssrcs).call(u,p),g.attributes.ssrcGroups=M(d=g.attributes.ssrcGroups).call(d,f),{id:E,mslabel:I}}stopSending(e){var n;G(n=this.sessionDesc.mediaDescriptions).call(n,o=>{var c,u;const d=[],p=[],f=[];G(c=o.attributes.ssrcs).call(c,g=>{Xt(e).call(e,g.attributes.label||"")?f.push(g):d.push(g)}),G(u=o.attributes.ssrcGroups).call(u,g=>{var E;Xt(E=ht(f).call(f,I=>I.ssrcId)).call(E,g.ssrcIds[0])||p.push(g)}),o.attributes.ssrcs=d,o.attributes.ssrcGroups=p})}mute(e){var n;const o=yt(n=this.sessionDesc.mediaDescriptions).call(n,c=>c.attributes.mid===e);if(!o)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));o.attributes.direction="inactive"}unmute(e){var n;const o=yt(n=this.sessionDesc.mediaDescriptions).call(n,c=>c.attributes.mid===e);if(!o)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));o.attributes.direction="sendonly"}receive(e,n,o){G(e).call(e,(c,u)=>{var d;const p=c._mediaStreamTrack,f=Jn(d=this.sessionDesc.mediaDescriptions).call(d,E=>E.attributes.mid===p.kind),g=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[f],c);this.sessionDesc.mediaDescriptions[f]=g})}stopReceiving(e){}restartICE(e,n){var o;e=en(e),n=en(n),this.iceParameters=e,this.candidates=n,G(o=this.sessionDesc.mediaDescriptions).call(o,c=>{c.attributes.iceUfrag=e.iceUfrag,c.attributes.icePwd=e.icePwd,c.attributes.candidates=this.candidates})}predictReceivingMids(e){const n=[];for(let o=0;o<e;o++)n.push((this.currentMidIndex+o+1).toString(10));return n}mungRecvMediaDsec(e,n){const o=en(e);return Gd(o,n),I_(o,n),o}updateRecvMedia(e,n){var o;const c=Jn(o=this.sessionDesc.mediaDescriptions).call(o,u=>u.attributes.mid===e);if(c!==-1){const u=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[c],n);this.sessionDesc.mediaDescriptions[c]=u}}bumpMid(e){this.currentMidIndex+=e}updateTrackLabel(e,n,o){var c;const u=yt(c=this.sessionDesc.mediaDescriptions).call(c,f=>e===xe.VIDEO?f.attributes.mid==="video":f.attributes.mid==="audio");if(u){var d;const f=yt(d=u.attributes.ssrcs).call(d,g=>g.attributes.label===n);var p;f&&(f.attributes.label=o,(p=f.attributes.msid)===null||p===void 0||p.replace(n,o))}}mungMediaDesc(e){const n=en(e);return v_(n),function(o){var c,u;const d=yt(c=o.attributes.extmaps).call(c,g=>g.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");var p,f;d&&Ze(p=o.attributes.extmaps).call(p,Ft(f=o.attributes.extmaps).call(f,d),1),G(u=o.attributes.payloads).call(u,g=>{var E;const I=Jn(E=g.rtcpFeedbacks).call(E,T=>T.type==="transport-cc");var _;I!==-1&&Ze(_=g.rtcpFeedbacks).call(_,I,1)})}(n),n}}function ao(t){if(Array.isArray(t))return t.map(function(o){return o});if(!y_(t))return t;var e={};for(var n in t)y_(t[n])||Array.isArray(t[n])?e[n]=ao(t[n]):e[n]=t[n];return e}function y_(t){return!(typeof t!="object"||Array.isArray(t)||!t)}var wf=function(){function t(e){this.input=[],this.size=e}return t.prototype.add=function(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)},t.prototype.diffMean=function(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length},t}(),S_=function(t,e){return(S_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var c in o)o.hasOwnProperty(c)&&(n[c]=o[c])})(t,e)};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation. All rights reserved.
	Licensed under the Apache License, Version 2.0 (the "License"); you may not use
	this file except in compliance with the License. You may obtain a copy of the
	License at http://www.apache.org/licenses/LICENSE-2.0

	THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
	KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
	WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
	MERCHANTABLITY OR NON-INFRINGEMENT.

	See the Apache Version 2.0 License for specific language governing permissions
	and limitations under the License.
	***************************************************************************** */function bf(t,e){function n(){this.constructor=t}S_(t,e),t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var Nf=function(){return(Nf=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var c in e=arguments[n])Object.prototype.hasOwnProperty.call(e,c)&&(t[c]=e[c]);return t}).apply(this,arguments)};function Of(t,e,n,o){return new(n||(n=Promise))(function(c,u){function d(g){try{f(o.next(g))}catch(E){u(E)}}function p(g){try{f(o.throw(g))}catch(E){u(E)}}function f(g){g.done?c(g.value):new n(function(E){E(g.value)}).then(d,p)}f((o=o.apply(t,e||[])).next())})}function kf(t,e){var n,o,c,u,d={label:0,sent:function(){if(1&c[0])throw c[1];return c[1]},trys:[],ops:[]};return u={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function p(f){return function(g){return function(E){if(n)throw new TypeError("Generator is already executing.");for(;d;)try{if(n=1,o&&(c=2&E[0]?o.return:E[0]?o.throw||((c=o.return)&&c.call(o),0):o.next)&&!(c=c.call(o,E[1])).done)return c;switch(o=0,c&&(E=[2&E[0],c.value]),E[0]){case 0:case 1:c=E;break;case 4:return d.label++,{value:E[1],done:!1};case 5:d.label++,o=E[1],E=[0];continue;case 7:E=d.ops.pop(),d.trys.pop();continue;default:if(c=d.trys,!((c=c.length>0&&c[c.length-1])||E[0]!==6&&E[0]!==2)){d=0;continue}if(E[0]===3&&(!c||E[1]>c[0]&&E[1]<c[3])){d.label=E[1];break}if(E[0]===6&&d.label<c[1]){d.label=c[1],c=E;break}if(c&&d.label<c[2]){d.label=c[2],d.ops.push(E);break}c[2]&&d.ops.pop(),d.trys.pop();continue}E=e.call(t,d)}catch(I){E=[6,I],o=0}finally{n=c=0}if(5&E[0])throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}([f,g])}}}var Js,Ul={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[]},T_={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0},R_={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0},w_={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0},b_={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0},Df=function(){function t(e,n){var o=this;this.videoIsReady=!1,this.videoIsReady2={},this.stats=ao(Ul),this.isFirstVideoReceived={},this.isFirstVideoDecoded={},this.isFirstAudioReceived={},this.isFirstAudioDecoded={},this.lossRateWindowStats=[],this.pc=e,this.options=n,this.intervalTimer=window.setInterval(function(){return Of(o,void 0,void 0,function(){return kf(this,function(c){return this.updateStats(),[2]})})},this.options.updateInterval)}return t.prototype.getStats=function(){return this.stats},t.prototype.setVideoIsReady=function(e){this.videoIsReady=e},t.prototype.setVideoIsReady2=function(e,n){this.videoIsReady2[e]=n},t.prototype.getVideoIsReady=function(e){return this.videoIsReady2[e]||!1},t.prototype.setIsFirstAudioDecoded=function(e){},t.prototype.destroy=function(){window.clearInterval(this.intervalTimer),this.pc=void 0},t.prototype.calcLossRate=function(e){var n=this;this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);for(var o=this.lossRateWindowStats.length,c=0,u=0,d=0,p=0,f=function(I){e[I].forEach(function(_,T){if(n.lossRateWindowStats[o-1][I][T]&&n.lossRateWindowStats[0][I][T]){var R=n.lossRateWindowStats[o-1][I][T].packets-n.lossRateWindowStats[0][I][T].packets,w=n.lossRateWindowStats[o-1][I][T].packetsLost-n.lossRateWindowStats[0][I][T].packetsLost;I==="videoSend"||I==="audioSend"?(c+=R,d+=w):(u+=R,p+=w),Number.isNaN(R)||Number.isNaN(R)?_.packetLostRate=0:_.packetLostRate=R<=0||w<=0?0:w/(R+w)}})},g=0,E=["videoSend","audioSend","videoRecv","audioRecv"];g<E.length;g++)f(E[g]);e.sendPacketLossRate=c<=0||d<=0?0:d/(c+d),e.recvPacketLossRate=u<=0||p<=0?0:p/(u+p)},t}(),nO=function(t){function e(){var n=t!==null&&t.apply(this,arguments)||this;return n._stats=Ul,n.lastDecodeVideoReceiverStats=new Map,n}return bf(e,t),e.prototype.updateStats=function(){return Of(this,void 0,void 0,function(){var n,o,c,u;return kf(this,function(d){switch(d.label){case 0:return[4,this._getStats()];case 1:return n=d.sent(),o=this.statsResponsesToObjects(n),this._stats=ao(Ul),c=o.filter(function(p){return p.type==="ssrc"}),this.processSSRCStats(c),(u=o.find(function(p){return p.type==="VideoBwe"}))&&this.processBandwidthStats(u),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats,[2]}})})},e.prototype.processBandwidthStats=function(n){this._stats.bitrate={actualEncoded:Number(n.googActualEncBitrate),targetEncoded:Number(n.googTargetEncBitrate),retransmit:Number(n.googRetransmitBitrate),transmit:Number(n.googTransmitBitrate)},this._stats.sendBandwidth=Number(n.googAvailableSendBandwidth)},e.prototype.processSSRCStats=function(n){var o=this;n.forEach(function(c){var u=c.id.includes("send");switch(c.mediaType+"_"+(u?"send":"recv")){case"video_send":var d=ao(R_);d.codec=c.googCodecName,d.adaptionChangeReason="none",c.googCpuLimitedResolution&&(d.adaptionChangeReason="cpu"),c.googBandwidthLimitedResolution&&(d.adaptionChangeReason="bandwidth"),d.avgEncodeMs=Number(c.googAvgEncodeMs),d.inputFrame={width:Number(c.googFrameWidthInput)||Number(c.googFrameWidthSent),height:Number(c.googFrameHeightInput)||Number(c.googFrameHeightSent),frameRate:Number(c.googFrameRateInput)},d.sentFrame={width:Number(c.googFrameWidthSent),height:Number(c.googFrameHeightSent),frameRate:Number(c.googFrameRateInput)},d.firsCount=Number(c.googFirReceived),d.nacksCount=Number(c.googNacksReceived),d.plisCount=Number(c.googPlisReceived),d.frameCount=Number(c.framesEncoded),d.bytes=Number(c.bytesSent),d.packets=Number(c.packetsSent),d.packetsLost=Number(c.packetsLost),d.ssrc=Number(c.ssrc),d.rttMs=Number(c.googRtt||0),o._stats.videoSend.push(d),o._stats.rtt=d.rttMs;break;case"video_recv":var p=ao(T_),f=o.lastDecodeVideoReceiverStats.get(Number(c.ssrc));if(p.codec=c.googCodecName,p.targetDelayMs=Number(c.googTargetDelayMs),p.renderDelayMs=Number(c.googRenderDelayMs),p.currentDelayMs=Number(c.googCurrentDelayMs),p.minPlayoutDelayMs=Number(c.googMinPlayoutDelayMs),p.decodeMs=Number(c.googDecodeMs),p.maxDecodeMs=Number(c.googMaxDecodeMs),p.receivedFrame={width:Number(c.googFrameWidthReceived),height:Number(c.googFrameHeightReceived),frameRate:Number(c.googFrameRateReceived)},p.decodedFrame={width:Number(c.googFrameWidthReceived),height:Number(c.googFrameHeightReceived),frameRate:Number(c.googFrameRateDecoded)},p.outputFrame={width:Number(c.googFrameWidthReceived),height:Number(c.googFrameHeightReceived),frameRate:Number(c.googFrameRateOutput)},p.jitterBufferMs=Number(c.googJitterBufferMs),p.firsCount=Number(c.googFirsSent),p.nacksCount=Number(c.googNacksSent),p.plisCount=Number(c.googPlisSent),p.framesDecodeCount=Number(c.framesDecoded),p.bytes=Number(c.bytesReceived),p.packets=Number(c.packetsReceived),p.packetsLost=Number(c.packetsLost),p.ssrc=Number(c.ssrc),p.packets>0&&!o.isFirstVideoReceived[p.ssrc]&&(o.onFirstVideoReceived&&o.onFirstVideoReceived(p.ssrc),o.isFirstVideoReceived[p.ssrc]=!0),p.framesDecodeCount>0&&!o.isFirstVideoDecoded[p.ssrc]&&(o.onFirstVideoDecoded&&o.onFirstVideoDecoded(p.ssrc,p.decodedFrame.width,p.decodedFrame.height),o.isFirstVideoDecoded[p.ssrc]=!0),f){var g=f.stats,E=Date.now()-f.lts;p.framesDecodeFreezeTime=g.framesDecodeFreezeTime,p.framesDecodeInterval=g.framesDecodeInterval,p.framesDecodeCount>g.framesDecodeCount&&o.isFirstVideoDecoded?(f.lts=Date.now(),p.framesDecodeInterval=E,p.framesDecodeInterval>=o.options.freezeRateLimit&&(o.getVideoIsReady(parseInt(c.ssrc,10))?p.framesDecodeFreezeTime+=p.framesDecodeInterval:o.setVideoIsReady2(parseInt(c.ssrc,10),!0))):p.framesDecodeCount<f.stats.framesDecodeCount&&(p.framesDecodeInterval=0)}o.lastDecodeVideoReceiverStats.set(p.ssrc,{stats:Nf({},p),lts:Date.now()}),o._stats.videoRecv.push(p);break;case"audio_recv":var I=ao(b_);I.codec=c.googCodecName,I.outputLevel=Math.abs(Number(c.audioOutputLevel))/32767,I.decodingCNG=Number(c.googDecodingCNG),I.decodingCTN=Number(c.googDecodingCTN),I.decodingCTSG=Number(c.googDecodingCTSG),I.decodingNormal=Number(c.googDecodingNormal),I.decodingPLC=Number(c.googDecodingPLC),I.decodingPLCCNG=Number(c.googDecodingPLCCNG),I.expandRate=Number(c.googExpandRate),I.accelerateRate=Number(c.googAccelerateRate),I.preemptiveExpandRate=Number(c.googPreemptiveExpandRate),I.secondaryDecodedRate=Number(c.googSecondaryDecodedRate),I.speechExpandRate=Number(c.googSpeechExpandRate),I.preferredJitterBufferMs=Number(c.googPreferredJitterBufferMs),I.jitterBufferMs=Number(c.googJitterBufferMs),I.jitterMs=Number(c.googJitterReceived),I.bytes=Number(c.bytesReceived),I.packets=Number(c.packetsReceived),I.packetsLost=Number(c.packetsLost),I.ssrc=Number(c.ssrc),I.receivedFrames=Number(c.googDecodingCTN)||Number(c.packetsReceived),I.droppedFrames=Number(c.googDecodingPLC)+Number(c.googDecodingPLCCNG)||Number(c.packetsLost),I.receivedFrames>0&&!o.isFirstAudioReceived[I.ssrc]&&(o.onFirstAudioReceived&&o.onFirstAudioReceived(I.ssrc),o.isFirstAudioReceived[I.ssrc]=!0),I.decodingNormal>0&&!o.isFirstAudioDecoded[I.ssrc]&&(o.onFirstAudioDecoded&&o.onFirstAudioDecoded(I.ssrc),o.isFirstAudioDecoded[I.ssrc]=!0),o._stats.audioRecv.push(I);break;case"audio_send":var _=ao(w_);_.codec=c.googCodecName,_.inputLevel=Math.abs(Number(c.audioInputLevel))/32767,_.aecReturnLoss=Number(c.googEchoCancellationReturnLoss||0),_.aecReturnLossEnhancement=Number(c.googEchoCancellationReturnLossEnhancement||0),_.residualEchoLikelihood=Number(c.googResidualEchoLikelihood||0),_.residualEchoLikelihoodRecentMax=Number(c.googResidualEchoLikelihoodRecentMax||0),_.bytes=Number(c.bytesSent),_.packets=Number(c.packetsSent),_.packetsLost=Number(c.packetsLost),_.ssrc=Number(c.ssrc),_.rttMs=Number(c.googRtt||0),o._stats.rtt=_.rttMs,o._stats.audioSend.push(_)}})},e.prototype._getStats=function(){var n=this;return new Promise(function(o,c){n.pc.getStats(o,c)})},e.prototype.statsResponsesToObjects=function(n){var o=[];return n.result().forEach(function(c){var u={id:c.id,timestamp:c.timestamp.valueOf().toString(),type:c.type};c.names().forEach(function(d){u[d]=c.stat(d)}),o.push(u)}),o},e}(Df);(function(t){t.CERTIFICATE="certificate",t.CODEC="codec",t.CANDIDATE_PAIR="candidate-pair",t.LOCAL_CANDIDATE="local-candidate",t.REMOTE_CANDIDATE="remote-candidate",t.INBOUND="inbound-rtp",t.TRACK="track",t.OUTBOUND="outbound-rtp",t.PC="peer-connection",t.REMOTE_INBOUND="remote-inbound-rtp",t.REMOTE_OUTBOUND="remote-outbound-rtp",t.TRANSPORT="transport",t.CSRC="csrc",t.DATA_CHANNEL="data-channel",t.STREAM="stream",t.SENDER="sender",t.RECEIVER="receiver"})(Js||(Js={}));var N_=function(t){function e(){var n=t!==null&&t.apply(this,arguments)||this;return n._stats=Ul,n.lastDecodeVideoReceiverStats=new Map,n.lastVideoFramesRecv=new Map,n.lastVideoFramesSent=new Map,n.lastVideoFramesDecode=new Map,n.lastVideoJBDelay=new Map,n.lastAudioJBDelay=new Map,n.mediaBytesSent=new Map,n.mediaBytesRetransmit=new Map,n.mediaBytesTargetEncode=new Map,n.lastEncoderMs=new Map,n}return bf(e,t),e.prototype.updateStats=function(){return Of(this,void 0,void 0,function(){var n,o=this;return kf(this,function(c){switch(c.label){case 0:return n=this,[4,this.pc.getStats()];case 1:return n.report=c.sent(),this._stats=ao(Ul),this.report.forEach(function(u){switch(u.type){case Js.OUTBOUND:u.mediaType==="audio"?o.processAudioOutboundStats(u):u.mediaType==="video"&&o.processVideoOutboundStats(u);break;case Js.INBOUND:u.mediaType==="audio"?o.processAudioInboundStats(u):u.mediaType==="video"&&o.processVideoInboundStats(u);break;case Js.TRANSPORT:var d=o.report.get(u.selectedCandidatePairId);d&&o.processCandidatePairStats(d);break;case Js.CANDIDATE_PAIR:u.selected&&o.processCandidatePairStats(u)}}),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats,[2]}})})},e.prototype.processCandidatePairStats=function(n){this._stats.sendBandwidth=n.availableOutgoingBitrate||0,n.currentRoundTripTime&&(this._stats.rtt=1e3*n.currentRoundTripTime),this._stats.videoSend.forEach(function(o){!o.rttMs&&n.currentRoundTripTime&&(o.rttMs=1e3*n.currentRoundTripTime)}),this._stats.audioSend.forEach(function(o){!o.rttMs&&n.currentRoundTripTime&&(o.rttMs=1e3*n.currentRoundTripTime)})},e.prototype.processAudioInboundStats=function(n){var o=this._stats.audioRecv.find(function(c){return c.ssrc===n.ssrc});o||(o=ao(b_),this._stats.audioRecv.push(o)),o.ssrc=n.ssrc,o.packets=n.packetsReceived,o.packetsLost=n.packetsLost,o.bytes=n.bytesReceived,o.jitterMs=1e3*n.jitter,n.trackId&&this.processAudioTrackReceiverStats(n.trackId,o),n.codecId&&(o.codec=this.getCodecFromCodecStats(n.codecId)),o.receivedFrames||(o.receivedFrames=n.packetsReceived),o.droppedFrames||(o.droppedFrames=n.packetsLost),o.receivedFrames>0&&!this.isFirstAudioReceived[o.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(o.ssrc),this.isFirstAudioReceived[o.ssrc]=!0),o.outputLevel&&o.outputLevel>0&&!this.isFirstAudioDecoded[o.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(o.ssrc),this.isFirstAudioDecoded[o.ssrc]=!0)},e.prototype.processVideoInboundStats=function(n){var o=this._stats.videoRecv.find(function(I){return I.ssrc===n.ssrc});o||(o=ao(T_),this._stats.videoRecv.push(o)),o.ssrc=n.ssrc,o.packets=n.packetsReceived,o.packetsLost=n.packetsLost,o.bytes=n.bytesReceived,o.firsCount=n.firCount,o.nacksCount=n.nackCount,o.plisCount=n.pliCount,o.framesDecodeCount=n.framesDecoded;var c=this.lastDecodeVideoReceiverStats.get(o.ssrc),u=this.lastVideoFramesDecode.get(o.ssrc),d=Date.now();if(o.framesDecodeCount>0&&!this.isFirstVideoDecoded[o.ssrc]){var p=o.decodedFrame?o.decodedFrame.width:0,f=o.decodedFrame?o.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(o.ssrc,p,f),this.isFirstVideoDecoded[o.ssrc]=!0}if(c){var g=c.stats,E=d-c.lts;o.framesDecodeFreezeTime=g.framesDecodeFreezeTime,o.framesDecodeInterval=g.framesDecodeInterval,o.framesDecodeCount>g.framesDecodeCount&&this.isFirstVideoDecoded?(c.lts=Date.now(),o.framesDecodeInterval=E,o.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(n.ssrc))?o.framesDecodeFreezeTime+=o.framesDecodeInterval:this.setVideoIsReady2(parseInt(n.ssrc,10),!0))):o.framesDecodeCount<g.framesDecodeCount&&(o.framesDecodeInterval=0)}u&&d-u.lts>=800?(o.decodeFrameRate=Math.round((o.framesDecodeCount-u.count)/((d-u.lts)/1e3)),this.lastVideoFramesDecode.set(o.ssrc,{count:o.framesDecodeCount,lts:d,rate:o.decodeFrameRate})):u?o.decodeFrameRate=u.rate:this.lastVideoFramesDecode.set(o.ssrc,{count:o.framesDecodeCount,lts:d,rate:0}),n.totalDecodeTime&&(o.decodeMs=1e3*n.totalDecodeTime),n.trackId&&this.processVideoTrackReceiverStats(n.trackId,o),n.codecId&&(o.codec=this.getCodecFromCodecStats(n.codecId)),n.framerateMean&&(o.framesRateFirefox=n.framerateMean),o.packets>0&&!this.isFirstVideoReceived[o.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(o.ssrc),this.isFirstVideoReceived[o.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(o.ssrc,{stats:Nf({},o),lts:c?c.lts:Date.now()})},e.prototype.processVideoOutboundStats=function(n){var o=this._stats.videoSend.find(function(_){return _.ssrc===n.ssrc});o||(o=ao(R_),this._stats.videoSend.push(o));var c=this.mediaBytesSent.get(n.ssrc);if(c?c.add(n.bytesSent):((d=new wf(10)).add(n.bytesSent),this.mediaBytesSent.set(n.ssrc,d)),n.retransmittedBytesSent!==void 0){var u=this.mediaBytesRetransmit.get(n.ssrc);u?u.add(n.retransmittedBytesSent):((d=new wf(10)).add(n.retransmittedBytesSent),this.mediaBytesRetransmit.set(n.ssrc,d))}if(n.totalEncodedBytesTarget){var d,p=this.mediaBytesTargetEncode.get(n.ssrc);p?p.add(n.totalEncodedBytesTarget):((d=new wf(10)).add(n.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(n.ssrc,d))}if(o.ssrc=n.ssrc,o.bytes=n.bytesSent,o.packets=n.packetsSent,o.firsCount=n.firCount,o.nacksCount=n.nackCount,o.plisCount=n.pliCount,o.frameCount=n.framesEncoded,o.adaptionChangeReason=n.qualityLimitationReason,n.totalEncodeTime&&n.framesEncoded){var f=this.lastEncoderMs.get(n.ssrc);if(!f||f.lastFrameCount>n.framesEncoded)o.avgEncodeMs=1e3*n.totalEncodeTime/n.framesEncoded;else{var g=n.framesEncoded-f.lastFrameCount,E=n.totalEncodeTime-f.lastEncoderTime;o.avgEncodeMs=1e3*E/g}this.lastEncoderMs.set(n.ssrc,{lastFrameCount:n.framesEncoded,lastEncoderTime:n.totalEncodeTime,lts:Date.now()})}if(n.codecId&&(o.codec=this.getCodecFromCodecStats(n.codecId)),n.mediaSourceId&&this.processVideoMediaSource(n.mediaSourceId,o),n.trackId&&this.processVideoTrackSenderStats(n.trackId,o),n.remoteId)this.processRemoteInboundStats(n.remoteId,o);else{var I=this.findRemoteStatsId(n.ssrc,Js.REMOTE_INBOUND);I&&this.processRemoteInboundStats(I,o)}},e.prototype.processAudioOutboundStats=function(n){var o=this._stats.audioSend.find(function(u){return u.ssrc===n.ssrc});if(o||(o=ao(w_),this._stats.audioSend.push(o)),o.ssrc=n.ssrc,o.packets=n.packetsSent,o.bytes=n.bytesSent,n.mediaSourceId&&this.processAudioMediaSource(n.mediaSourceId,o),n.codecId&&(o.codec=this.getCodecFromCodecStats(n.codecId)),n.trackId&&this.processAudioTrackSenderStats(n.trackId,o),n.remoteId)this.processRemoteInboundStats(n.remoteId,o);else{var c=this.findRemoteStatsId(n.ssrc,Js.REMOTE_INBOUND);c&&this.processRemoteInboundStats(c,o)}},e.prototype.findRemoteStatsId=function(n,o){var c=Array.from(this.report.values()).find(function(u){return u.type===o&&u.ssrc===n});return c?c.id:null},e.prototype.processVideoMediaSource=function(n,o){var c=this.report.get(n);c&&c.width&&c.height&&c.framesPerSecond&&(o.inputFrame={width:c.width,height:c.height,frameRate:c.framesPerSecond})},e.prototype.processAudioMediaSource=function(n,o){var c=this.report.get(n);c&&(o.inputLevel=c.audioLevel)},e.prototype.processVideoTrackSenderStats=function(n,o){var c=this.report.get(n);if(c){var u=0,d=Date.now(),p=this.lastVideoFramesSent.get(o.ssrc);p&&d-p.lts>=800?(u=Math.round((c.framesSent-p.count)/((d-p.lts)/1e3)),this.lastVideoFramesSent.set(o.ssrc,{count:c.framesSent,lts:d,rate:u})):p?u=p.rate:this.lastVideoFramesSent.set(o.ssrc,{count:c.framesSent,lts:d,rate:0}),o.sentFrame={width:c.frameWidth,height:c.frameHeight,frameRate:u}}},e.prototype.processVideoTrackReceiverStats=function(n,o){var c=this.report.get(n);if(c){var u=this.lastVideoFramesRecv.get(o.ssrc),d=Date.now();o.framesReceivedCount=c.framesReceived;var p=0;if(u&&d-u.lts>=800?(p=Math.round((c.framesReceived-u.count)/((d-u.lts)/1e3)),this.lastVideoFramesRecv.set(o.ssrc,{count:c.framesReceived,lts:d,rate:p})):u?p=u.rate:this.lastVideoFramesRecv.set(o.ssrc,{count:c.framesReceived,lts:d,rate:0}),o.receivedFrame={width:c.frameWidth||0,height:c.frameHeight||0,frameRate:p||0},o.decodedFrame={width:c.frameWidth||0,height:c.frameHeight||0,frameRate:o.decodeFrameRate||0},o.outputFrame={width:c.frameWidth||0,height:c.frameHeight||0,frameRate:o.decodeFrameRate||0},c.jitterBufferDelay&&c.jitterBufferEmittedCount){var f=this.lastVideoJBDelay.get(o.ssrc);this.lastVideoJBDelay.set(o.ssrc,{jitterBufferDelay:c.jitterBufferDelay,jitterBufferEmittedCount:c.jitterBufferEmittedCount}),f||(f={jitterBufferDelay:0,jitterBufferEmittedCount:0});var g=1e3*(c.jitterBufferDelay-f.jitterBufferDelay)/(c.jitterBufferEmittedCount-f.jitterBufferEmittedCount);o.jitterBufferMs=g,o.currentDelayMs=Math.round(g)}}},e.prototype.processAudioTrackSenderStats=function(n,o){var c=this.report.get(n);c&&(o.aecReturnLoss=c.echoReturnLoss||0,o.aecReturnLossEnhancement=c.echoReturnLossEnhancement||0)},e.prototype.processAudioTrackReceiverStats=function(n,o){var c=this.report.get(n);if(c){if(c.removedSamplesForAcceleration&&c.totalSamplesReceived&&(o.accelerateRate=c.removedSamplesForAcceleration/c.totalSamplesReceived),c.jitterBufferDelay&&c.jitterBufferEmittedCount){var u=this.lastAudioJBDelay.get(o.ssrc);this.lastAudioJBDelay.set(o.ssrc,{jitterBufferDelay:c.jitterBufferDelay,jitterBufferEmittedCount:c.jitterBufferEmittedCount}),u||(u={jitterBufferDelay:0,jitterBufferEmittedCount:0});var d=1e3*(c.jitterBufferDelay-u.jitterBufferDelay)/(c.jitterBufferEmittedCount-u.jitterBufferEmittedCount);o.jitterBufferMs=Math.round(d)}o.outputLevel=c.audioLevel;var p=1920;c.totalSamplesDuration&&c.totalSamplesReceived&&(p=c.totalSamplesReceived/c.totalSamplesDuration/50,o.receivedFrames=Math.round(c.totalSamplesReceived/p)),c.concealedSamples&&(o.droppedFrames=Math.round(c.concealedSamples/p))}},e.prototype.processRemoteInboundStats=function(n,o){var c=this.report.get(n);c&&(o.packetsLost=c.packetsLost,c.roundTripTime&&(o.rttMs=1e3*c.roundTripTime))},e.prototype.getCodecFromCodecStats=function(n){var o=this.report.get(n);if(!o)return"";var c=o.mimeType.match(/\/(.*)$/);return c&&c[1]?c[1]:""},e.prototype.updateSendBitrate=function(){var n=0,o=null,c=null;this.mediaBytesSent.forEach(function(d){n+=d.diffMean()}),this.mediaBytesRetransmit.forEach(function(d){o=o===null?d.diffMean():o+d.diffMean()}),this.mediaBytesTargetEncode.forEach(function(d){c=c===null?d.diffMean():c+d.diffMean()});var u=o!==null?n-o:n;this._stats.bitrate={actualEncoded:8*u/(this.options.updateInterval/1e3),transmit:8*n/(this.options.updateInterval/1e3)},o!==null&&(this._stats.bitrate.retransmit=8*o/(this.options.updateInterval/1e3)),c!==null&&(this._stats.bitrate.targetEncoded=8*c/(this.options.updateInterval/1e3))},e}(Df),iO=function(t){function e(){return t!==null&&t.apply(this,arguments)||this}return bf(e,t),e.prototype.updateStats=function(){return Promise.resolve()},e}(Df);function O_(t,e,n,o){e===void 0&&(e=250),n===void 0&&(n=8),o===void 0&&(o=500);var c,u=(c=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i))&&c[0]?Number(c[0].split("/")[1]):null;return u?u<76?new nO(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:o}):new N_(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:o}):function(d){return!!window.RTCStatsReport&&d.getStats()instanceof Promise}(t)?new N_(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:o}):new iO(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:o})}function k_(t,e){var n=ue(t);if(_e){var o=_e(t);e&&(o=Ot(o).call(o,function(c){return zt(t,c).enumerable})),n.push.apply(n,o)}return n}var Si=function(t,e,n,o){var c,u=arguments.length,d=u<3?e:o===null?o=zt(e,n):o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(t,e,n,o);else for(var p=t.length-1;p>=0;p--)(c=t[p])&&(d=(u<3?c(d):u>3?c(e,n,d):c(e,n))||d);return u>3&&d&&te(e,n,d),d},ye=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};class An extends KI{constructor(e,n){super(e,n),this.useRTX=!1,this.localCandidateCount=0,this.allCandidatesReceived=!1,this.mutex=new Qi("P2PConnection-mutex"),this.store=n,this.peerConnection=new RTCPeerConnection(An.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.statsFilter=O_(this.peerConnection,void 0,void 0,si()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}async establish(){try{const e=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=Vd(e.sdp),o=Rf(e.sdp,!this.useRTX,!1,["opus"]);return this.localCapabilities=o,this.initialOffer=e,function(c){for(var u=1;u<arguments.length;u++){var d,p=arguments[u]!=null?arguments[u]:{};if(u%2)G(d=k_(Object(p),!0)).call(d,function(g){qr(c,g,p[g])});else if(Ce)dr(c,Ce(p));else{var f;G(f=k_(Object(p))).call(f,function(g){te(c,g,zt(p,g))})}}return c}({},n,{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:o},offerSDP:e.sdp})}catch(e){throw new Q(U.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async connect(e,n,o,c,u,d){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new rO({remoteIceParameters:e,remoteDtlsParameters:n,candidates:o,remoteRTPCapabilities:c.send,remoteSetup:u,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec,cname:d});const p=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:p})}catch(p){throw new Q(U.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(p.toString()))}}send(e,n){var o=this;return xl(function*(){const c=yield Qr(o.mutex.lock());try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const u=ht(e).call(e,_=>o.peerConnection.addTrack(_._mediaStreamTrack)),d=yield Qr(o.peerConnection.createOffer()),p=so.parse(d.sdp),f=ht(e).call(e,_=>{var T;const R=_._mediaStreamTrack,w=yt(T=p.mediaDescriptions).call(T,k=>k.attributes.mid===R.kind);if(!w)throw new Error("Cannot extract ssrc from mediaDescription.");return function(k,L,Y){var Z;const rt=Ot(Z=k.attributes.ssrcs).call(Z,At=>At.attributes.label===L),ut=k.attributes.ssrcGroups;if(rt.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(ut&&rt.length>1){const At=yt(ut).call(ut,Ct=>{var lt;return Ft(lt=Ct.ssrcIds).call(lt,rt[0].ssrcId)!==-1});return At?[{ssrcId:At.ssrcIds[0],rtx:Y?At.ssrcIds[1]:void 0}]:[{ssrcId:rt[0].ssrcId}]}return[{ssrcId:rt[0].ssrcId}]}(w,R.id,o.useRTX)});let g;try{g=yield f}catch(_){throw G(u).call(u,T=>{Ei()&&T.replaceTrack(null),o.peerConnection.removeTrack(T)}),_}const E=o.mungSendOfferSDP(d.sdp,e);o.remoteSDP.receive(e,n,g);const I=o.remoteSDP.toString();return yield Qr(o.peerConnection.setLocalDescription({type:"offer",sdp:E})),yield Qr(o.applySendEncodings(u,e)),yield Qr(o.peerConnection.setRemoteDescription({type:"answer",sdp:I})),ht(e).call(e,(_,T)=>{const R=_._mediaStreamTrack.id;return{localSSRC:f[T],id:R}})}catch(u){throw new Q(U.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(u.toString()))}finally{c()}})()}async stopSending(e){try{var n;if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const o=Ot(n=this.peerConnection.getSenders()).call(n,d=>{var p;return Ft(e).call(e,((p=d.track)===null||p===void 0?void 0:p.id)||"")!==-1});if(o.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");ht(o).call(o,d=>{Ei()&&d.replaceTrack(null),this.peerConnection.removeTrack(d)});const c=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(c),this.remoteSDP.stopReceiving(e);const u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Q(U.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(o.toString()))}}async receive(e,n,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{id:u,mslabel:d}=this.remoteSDP.send(e,n,c),p=new ct((E,I)=>{const _=Vr(()=>{I(new Error("Cannot receive track, id: ".concat(u)))},1e4),T=R=>{const w=Ke();if(w.name==="Safari"&&Number(w.version)===11&&R.track.id!==u&&R.streams[0].id===d){var k;const L=R.streams[0].getTracks()[0];return(k=this.remoteSDP)===null||k===void 0||k.updateTrackLabel(e,u,R.track.id),this.peerConnection.removeEventListener("track",T),clearTimeout(_),void E(L)}if(R.track.id===u)return this.peerConnection.removeEventListener("track",T),clearTimeout(_),void E(R.track)};this.peerConnection.addEventListener("track",T)}),f=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:f});const g=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(g),{track:await p,id:u}}catch(u){throw new Q(U.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(o)}catch(n){throw new Q(U.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(e){}async unmuteRemote(e){}async muteLocal(e){try{var n;if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const o=Ot(n=this.peerConnection.getSenders()).call(n,c=>{var u;return Ft(e).call(e,((u=c.track)===null||u===void 0?void 0:u.id)||"")!==-1});if(o.length!==e.length)throw new Error("sender' length doesn't match mids' length.");ht(o).call(o,c=>{if(Ei()&&c.track)c.track.enabled=!1;else{var u;const d=c.getParameters();G(u=d.encodings).call(u,p=>p.active=!1),c.setParameters(d)}})}catch(o){throw new Q(U.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(o.toString()))}}async unmuteLocal(e){try{var n;if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const o=Ot(n=this.peerConnection.getSenders()).call(n,d=>{var p;return Ft(e).call(e,((p=d.track)===null||p===void 0?void 0:p.id)||"")!==-1});if(o.length!==e.length)throw new Error("Senders' length doesn't match mids' length.");ht(o).call(o,async d=>{if(Ei()&&d.track)d.track.enabled=!0;else{var p;const f=d.getParameters();G(p=f.encodings).call(p,g=>g.active=!0),await d.setParameters(f)}});const c=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(c);const u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Q(U.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(o.toString()))}}async reEstablish(){const e=await this.peerConnection.createOffer({iceRestart:!0});if(!e.sdp)throw new Error("Cannot get SDP from restart offer.");return{iceParameters:Vd(e.sdp).iceParameters,restartICE:async(n,o)=>this.restartICE(e,n,o),restartOfferSDP:e.sdp}}close(){var e;this.peerConnection.close(),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const u=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Q(U.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(e,n){var o;const c=Ot(o=this.peerConnection.getSenders()).call(o,u=>{var d;return((d=u.track)===null||d===void 0?void 0:d.id)===e});c.length===1&&await this.applySendEncodings(c,[n])}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){var o;const c=yt(o=this.peerConnection.getSenders()).call(o,u=>{var d;return((d=u.track)===null||d===void 0?void 0:d.id)===n});c&&await c.replaceTrack(e._mediaStreamTrack)}async restartICE(e,n,o){try{if(!this.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");this.remoteSDP.restartICE(n,o);const c=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(e),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(c){throw new Q(U.EXCHANGE_SDP_FAILED,"P2PConnection.restartICE failed; ".concat(c.toString()))}}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;(e=this.onICEConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,N.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},Vr(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,N.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},ot("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){const n={iceServers:[],sdpSemantics:"plan-b"};var o,c;return e.iceServers?n.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(cA(e.turnServer.servers)?n.iceServers=e.turnServer.servers:(n.iceServers&&n.iceServers.push(...An.turnServerConfigToIceServers(e.turnServer.servers)),ot("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&e.turnServer.serversFromGateway&&n.iceServers.push(...An.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),G(o=M(c=e.turnServer.servers).call(c,e.turnServer.serversFromGateway||[])).call(o,u=>{u.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(e){const n=[];return G(e).call(e,o=>{if(o.security){var c;o.tcpport&&n.push({username:o.username,credential:o.password,credentialType:"password",urls:M(c="turns:".concat(o.turnServerURL,":")).call(c,o.tcpport,"?transport=tcp")})}else{var u,d;o.udpport&&n.push({username:o.username,credential:o.password,credentialType:"password",urls:M(u="turn:".concat(o.turnServerURL,":")).call(u,o.udpport,"?transport=udp")}),o.tcpport&&n.push({username:o.username,credential:o.password,credentialType:"password",urls:M(d="turn:".concat(o.turnServerURL,":")).call(d,o.tcpport,"?transport=tcp")})}}),n}async applySendEncodings(e,n){try{if(!Mn().supportSetRtpSenderParameters||e.length!==n.length)return;for(let u=0;u<e.length;u++){var o;const d=e[u],p=n[u];if(!p)continue;const f={},g={};if(p instanceof We)switch(p._optimizationMode){case"motion":f.degradationPreference="maintain-framerate";break;case"detail":f.degradationPreference="maintain-resolution";break;default:f.degradationPreference="balanced"}if(ot("DSCP_TYPE")&&uc()){var c;const _=ot("DSCP_TYPE");Xt(c=["very-low","low","medium","high"]).call(c,_)&&(g.networkPriority=_)}const E=d.getParameters(),I=(o=E.encodings)===null||o===void 0?void 0:o[0];I&&Ir(I,g),Ir(E,f),await d.setParameters(E)}}catch{N.debug("Apply RTPSendEncodings failed.")}}mungSendOfferSDP(e,n){const o=so.parse(e);return G(n).call(n,(c,u)=>{var d;const p=c._mediaStreamTrack,f=yt(d=o.mediaDescriptions).call(d,g=>g.attributes.mid===p.kind);f&&Gd(f,c)}),so.print(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,e,n,o)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0}}function Ti(t,e,n){const o=t[e];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(...c){const u=this.mutex,d=await u.lock("Locking from P2PConnection.".concat(e));try{return await o.apply(this,c)}finally{d()}},n}Si([Ti,ye("design:type",Function),ye("design:paramtypes",[Object,Object,Array,Object,String,String]),ye("design:returntype",ct)],An.prototype,"connect",null),Si([Ti,ye("design:type",Function),ye("design:paramtypes",[Array]),ye("design:returntype",ct)],An.prototype,"stopSending",null),Si([Ti,ye("design:type",Function),ye("design:paramtypes",[String,Array,String,Object]),ye("design:returntype",ct)],An.prototype,"receive",null),Si([Ti,ye("design:type",Function),ye("design:paramtypes",[Array]),ye("design:returntype",ct)],An.prototype,"stopReceiving",null),Si([Ti,ye("design:type",Function),ye("design:paramtypes",[String]),ye("design:returntype",ct)],An.prototype,"muteRemote",null),Si([Ti,ye("design:type",Function),ye("design:paramtypes",[String]),ye("design:returntype",ct)],An.prototype,"unmuteRemote",null),Si([Ti,ye("design:type",Function),ye("design:paramtypes",[Array]),ye("design:returntype",ct)],An.prototype,"muteLocal",null),Si([Ti,ye("design:type",Function),ye("design:paramtypes",[Array]),ye("design:returntype",ct)],An.prototype,"unmuteLocal",null),Si([Ti,ye("design:type",Function),ye("design:paramtypes",[]),ye("design:returntype",ct)],An.prototype,"reEstablish",null),Si([Ti,ye("design:type",Function),ye("design:paramtypes",[]),ye("design:returntype",void 0)],An.prototype,"close",null),Si([Ti,ye("design:type",Function),ye("design:paramtypes",[String,As]),ye("design:returntype",ct)],An.prototype,"updateEncoderConfig",null),Si([Ti,ye("design:type",Function),ye("design:paramtypes",[String,As]),ye("design:returntype",ct)],An.prototype,"updateSendParameters",null),Si([Ti,ye("design:type",Function),ye("design:paramtypes",[As,String]),ye("design:returntype",ct)],An.prototype,"replaceTrack",null),Si([Ti,ye("design:type",Function),ye("design:paramtypes",[Object,Object,Array]),ye("design:returntype",ct)],An.prototype,"restartICE",null);var oO=function(t,e,n,o){var c,u=arguments.length,d=u<3?e:o===null?o=zt(e,n):o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(t,e,n,o);else for(var p=t.length-1;p>=0;p--)(c=t[p])&&(d=(u<3?c(d):u>3?c(e,n,d):c(e,n))||d);return u>3&&d&&te(e,n,d),d},sO=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};const Kd="9",D_=4e4;let Bf=class{constructor(t){t=en(t);const{remoteIceParameters:e,remoteDtlsParameters:n,candidates:o,remoteRTPCapabilities:c,remoteSetup:u,localCapabilities:d,cname:p}=t,f=so.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`);this._rtpCapabilities=c,this._candidates=o,this._iceParameters=e,this._dtlsParameters=n,this._localCapabilities=d,this.setup=u,this.cname=p;const g=this.rtpCapabilities.send;for(const _ of f.mediaDescriptions){var E,I;if(_.attributes.iceUfrag=e.iceUfrag,_.attributes.icePwd=e.icePwd,_.attributes.fingerprints=n.fingerprints,_.attributes.candidates=o,_.attributes.setup=u,_.media.mediaType==="video"&&(_.media.fmts=ht(E=g.videoCodecs).call(E,T=>T.payloadType.toString(10)),_.attributes.payloads=g.videoCodecs,_.attributes.extmaps=g.videoExtensions,ot("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:T,ssrcGroups:R}=kc([{ssrcId:D_,rtx:ot("USE_RTX")?40001:void 0}],this.cname);_.attributes.ssrcs=T,_.attributes.ssrcGroups=R}if(_.media.mediaType==="audio"&&(_.media.fmts=ht(I=g.audioCodecs).call(I,T=>T.payloadType.toString(10)),_.attributes.payloads=g.audioCodecs,_.attributes.extmaps=g.audioExtensions,ot("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:T,ssrcGroups:R}=kc([{ssrcId:2e4}],this.cname);_.attributes.ssrcs=T,_.attributes.ssrcGroups=R}}this.sessionDesc=f,this.currentMidIndex=f.mediaDescriptions.length-1}get localCapabilities(){return en(this._localCapabilities)}get rtpCapabilities(){return en(this._rtpCapabilities)}get candidates(){return en(this._candidates)}get iceParameters(){return en(this._iceParameters)}get dtlsParameters(){return en(this._dtlsParameters)}preloadRemoteMedia(){const t=ot("PRELOAD_MEDIA_COUNT");st("debug",this,"preloadRemoteMedia",t),this.rtpCapabilities;const e=this.candidates,n=this.dtlsParameters,o=this.iceParameters,c=this.rtpCapabilities.send;for(let p=1;p<t;p++){var u,d;const f=2*p+2e4,g=2*p+D_,{ssrcs:E,ssrcGroups:I}=kc([{ssrcId:f}],this.cname),{ssrcs:_,ssrcGroups:T}=kc([{ssrcId:g,rtx:ot("USE_RTX")?g+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:Kd,protos:["UDP","TLS","RTP","SAVPF"],fmts:ht(u=c.videoCodecs).call(u,R=>R.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:o.iceUfrag,icePwd:o.icePwd,unrecognized:[],candidates:e,extmaps:c.videoExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:_,ssrcGroups:T,rtcpFeedbackWildcards:[],payloads:c.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*p)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:Kd,protos:["UDP","TLS","RTP","SAVPF"],fmts:ht(d=c.audioCodecs).call(d,R=>R.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:o.iceUfrag,icePwd:o.icePwd,unrecognized:[],candidates:e,extmaps:c.audioExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:E,ssrcGroups:I,rtcpFeedbackWildcards:[],payloads:c.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*p+1)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return so.print(this.sessionDesc)}send(t,e,n,o){const{ssrcs:c,ssrcGroups:u}=kc(e,this.cname,n),d=this.findPreloadMediaDesc(c);if(d){if(o&&(o.tcc||o.remb)){var p;const f=Ft(p=this.sessionDesc.mediaDescriptions).call(p,d);return this.sessionDesc.mediaDescriptions[f]=this.mungSendMediaDesc(d,o),{mid:d.attributes.mid,needExchangeSDP:!0}}return{mid:d.attributes.mid,needExchangeSDP:!1}}{const f=this.findAvailableMediaIndex(t);if(Ei()){if(f!==-1&&f!==1){const g=en(this.sessionDesc.mediaDescriptions[f]);return g.attributes.direction="sendonly",g.attributes.ssrcs=c,g.attributes.ssrcGroups=u,this.sessionDesc.mediaDescriptions[f]=this.mungSendMediaDesc(g,o),{mid:g.attributes.mid,needExchangeSDP:!0}}{const g=this.createOrRecycleSendMedia(t,c,u,"sendonly",o);return this.updateBundleMids(),{mid:g.attributes.mid,needExchangeSDP:!0}}}if(f!==-1){const g=en(this.sessionDesc.mediaDescriptions[f]);return g.attributes.direction="sendonly",g.attributes.ssrcs=c,g.attributes.ssrcGroups=u,this.sessionDesc.mediaDescriptions[f]=this.mungSendMediaDesc(g,o),{mid:g.attributes.mid,needExchangeSDP:!0}}{const g=this.createOrRecycleSendMedia(t,c,u,"sendonly",o);return this.updateBundleMids(),{mid:g.attributes.mid,needExchangeSDP:!0}}}}stopSending(t){var e;const n=Ot(e=this.sessionDesc.mediaDescriptions).call(e,o=>o.attributes.mid&&Ft(t).call(t,o.attributes.mid)!==-1);if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");G(n).call(n,o=>{o.attributes.mid==="0"||si()||Ei()?o.attributes.ssrcs=[]:(o.attributes.ssrcs=[],o.attributes.direction="inactive",o.media.port="0")}),this.updateBundleMids()}mute(t){var e;const n=yt(e=this.sessionDesc.mediaDescriptions).call(e,o=>o.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(t){var e;const n=yt(e=this.sessionDesc.mediaDescriptions).call(e,o=>o.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}muteRemote(t){var e;const n=Ot(e=this.sessionDesc.mediaDescriptions).call(e,o=>Xt(t).call(t,o.attributes.mid||""));if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");G(n).call(n,o=>{o.attributes.direction="inactive"})}unmuteRemote(t){var e;const n=Ot(e=this.sessionDesc.mediaDescriptions).call(e,o=>Xt(t).call(t,o.attributes.mid||""));if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");G(n).call(n,o=>{o.attributes.direction="recvonly"})}receive(t,e,n,o){G(t).call(t,(c,u)=>{this.createOrRecycleRecvMedia(c,[],"recvonly",e,n,o[u])}),this.updateBundleMids()}stopReceiving(t){var e;const n=Ot(e=this.sessionDesc.mediaDescriptions).call(e,o=>Ft(t).call(t,o.attributes.mid)!==-1);if(n.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");G(n).call(n,o=>{o.media.port="0",o.attributes.direction="inactive"}),this.updateBundleMids()}restartICE(t,e){var n;t=en(t),e=en(e),this._iceParameters=t,this._candidates=e,G(n=this.sessionDesc.mediaDescriptions).call(n,o=>{o.attributes.iceUfrag=t.iceUfrag,o.attributes.icePwd=t.icePwd,o.attributes.candidates=this.candidates})}predictReceivingMids(t){const e=[];for(let n=0;n<t;n++)e.push((this.currentMidIndex+n+1).toString(10));return e}findAvailableMediaIndex(t){var e;return Jn(e=this.sessionDesc.mediaDescriptions).call(e,n=>n.media.mediaType===t&&n.media.port!=="0"&&(n.attributes.direction==="sendonly"||n.attributes.direction==="sendrecv")&&n.attributes.ssrcs.length===0)}createOrRecycleRecvMedia(t,e,n,o,c,u){const d=t._mediaStreamTrack.kind,p=this.rtpCapabilities.recv,f=this.localCapabilities.send;let g=[];if(d===xe.VIDEO){var E,I,_,T;if(ot("H264_PROFILE_LEVEL_ID")&&o==="h264"&&(g=Ot(I=p.videoCodecs).call(I,lt=>{var Gt,wt,Qt;return Xt(Gt=((wt=lt.rtpMap)===null||wt===void 0?void 0:wt.encodingName.toLowerCase())||"").call(Gt,o)&&(lt==null||(Qt=lt.fmtp)===null||Qt===void 0?void 0:Qt.parameters["profile-level-id"])===ot("H264_PROFILE_LEVEL_ID")})),!g||((E=g)===null||E===void 0?void 0:E.length)===0){var R;const lt=Ot(R=f.videoCodecs).call(R,Gt=>{var wt,Qt;return Xt(wt=((Qt=Gt.rtpMap)===null||Qt===void 0?void 0:Qt.encodingName.toLowerCase())||"").call(wt,o)});var w;lt.length!==0&&(g=Ot(w=p.videoCodecs).call(w,Gt=>Bi(lt).call(lt,wt=>wt.payloadType===Gt.payloadType)))}if(ot("USE_RTX")){var k;const lt=ht(g).call(g,wt=>wt.payloadType.toString()),Gt=Ot(k=p.videoCodecs).call(k,wt=>{var Qt,xt;return((Qt=wt.rtpMap)===null||Qt===void 0?void 0:Qt.encodingName)==="rtx"&&Xt(lt).call(lt,((xt=wt.fmtp)===null||xt===void 0?void 0:xt.parameters.apt)||"")});g=[...g,...Gt]}g.length===0&&(N.warning(M(_="codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ")).call(_,(T=p.videoCodecs[0].rtpMap)===null||T===void 0?void 0:T.encodingName)),g=p.videoCodecs)}else{var L,Y;g=Ot(L=p.audioCodecs).call(L,lt=>{var Gt,wt;return Xt(Gt=((wt=lt.rtpMap)===null||wt===void 0?void 0:wt.encodingName.toLowerCase())||"").call(Gt,c)}),g.length===0&&(N.warning("codec ".concat(c," not included in rtpCapabilities, fallback to opus")),g=Ot(Y=p.audioCodecs).call(Y,lt=>{var Gt,wt;return Xt(Gt=((wt=lt.rtpMap)===null||wt===void 0?void 0:wt.encodingName.toLowerCase())||"").call(Gt,"opus")}))}const Z=d===xe.VIDEO?p.videoExtensions:p.audioExtensions;this.currentMidIndex+=1;const rt="".concat(this.currentMidIndex);let ut={media:{mediaType:d,port:Kd,protos:["UDP","TLS","RTP","SAVPF"],fmts:ht(g).call(g,lt=>lt.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:Z,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:g,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(rt)}};ut=this.mungRecvMediaDsec(ut,t,u);const At=this.findFirstClosedMedia(d);if(At){var Ct;const lt=Ft(Ct=this.sessionDesc.mediaDescriptions).call(Ct,At);this.sessionDesc.mediaDescriptions[lt]=ut}else this.sessionDesc.mediaDescriptions.push(ut);return ut}createOrRecycleSendMedia(t,e,n,o,c){const u=this.rtpCapabilities.send,d=t===xe.VIDEO?u.videoCodecs:u.audioCodecs,p=t===xe.VIDEO?u.videoExtensions:u.audioExtensions;this.currentMidIndex+=1;const f="".concat(this.currentMidIndex);let g={media:{mediaType:t,port:Kd,protos:["UDP","TLS","RTP","SAVPF"],fmts:ht(d).call(d,_=>_.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:p,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:d,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(f)}};g=this.mungSendMediaDesc(g,c);const E=this.findFirstClosedMedia(t);if(E){var I;const _=Ft(I=this.sessionDesc.mediaDescriptions).call(I,E);this.sessionDesc.mediaDescriptions[_]=g}else this.sessionDesc.mediaDescriptions.push(g);return g}updateBundleMids(){var t,e;this.sessionDesc.attributes.groups[0].identificationTag=ht(t=Ot(e=this.sessionDesc.mediaDescriptions).call(e,n=>n.media.port!=="0")).call(t,n=>n.attributes.mid)}mungRecvMediaDsec(t,e,n){const o=en(t);return v_(o),Gd(o,e),I_(o,e),function(c){var u;if(c.media.mediaType!=="video")return;const d=Ke();if(d.name!==be.SAFARI&&d.os!==Zr.IOS)return;const p=Jn(u=c.attributes.extmaps).call(u,g=>/video-orientation/g.test(g.extensionName));var f;p!==-1&&Ze(f=c.attributes.extmaps).call(f,p,1)}(o),C_(o,n,this.localCapabilities.send),o}mungSendMediaDesc(t,e){const n=en(t);return C_(n,e,this.localCapabilities.recv),n}updateRecvMedia(t,e){var n;const o=Jn(n=this.sessionDesc.mediaDescriptions).call(n,c=>c.attributes.mid===t);if(o!==-1){const c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[o],e);this.sessionDesc.mediaDescriptions[o]=c}}bumpMid(t){this.currentMidIndex+=t}findFirstClosedMedia(t){var e;return yt(e=this.sessionDesc.mediaDescriptions).call(e,n=>si()?n.media.port==="0"&&n.media.mediaType===t:n.media.port==="0")}findPreloadMediaDesc(t){var e;return yt(e=this.sessionDesc.mediaDescriptions).call(e,n=>{var o,c;return((o=n.attributes)===null||o===void 0||(c=o.ssrcs[0])===null||c===void 0?void 0:c.ssrcId)===t[0].ssrcId})}};function B_(t,e){var n=ue(t);if(_e){var o=_e(t);e&&(o=Ot(o).call(o,function(c){return zt(t,c).enumerable})),n.push.apply(n,o)}return n}Bf=oO([an("RemoteSDP"),sO("design:paramtypes",[Object])],Bf);var Ql,di=function(t,e,n,o){var c,u=arguments.length,d=u<3?e:o===null?o=zt(e,n):o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(t,e,n,o);else for(var p=t.length-1;p>=0;p--)(c=t[p])&&(d=(u<3?c(d):u>3?c(e,n,d):c(e,n))||d);return u>3&&d&&te(e,n,d),d},fe=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};let Pn=Ql=class extends KI{constructor(t,e){super(t,e),this.useRTX=ot("USE_RTX"),this.localCandidateCount=0,this.allCandidatesReceived=!1,this.mutex=new Qi("P2PConnection-mutex"),this.store=e,this.peerConnection=new RTCPeerConnection(Ql.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=O_(this.peerConnection,void 0,void 0,si()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const t=await this.peerConnection.createOffer();if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const e=Vd(t.sdp),n=await async function(o,c,u,d){const p=new RTCPeerConnection;p.addTransceiver("video",{direction:"sendonly"}),p.addTransceiver("audio",{direction:"sendonly"}),p.addTransceiver("video",{direction:"recvonly"}),p.addTransceiver("audio",{direction:"recvonly"});const f=(await p.createOffer()).sdp,g=Rf(f,o,c,u,d,"sendonly"),E=Rf(f,o,c,u,d,"recvonly"),I={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},_={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},T={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(jd(g,E,"videoExtensions",I,_,T),jd(g,E,"videoCodecs",I,_,T),jd(g,E,"audioExtensions",I,_,T),jd(g,E,"audioCodecs",I,_,T),ot("RAISE_H264_BASELINE_PRIORITY")){var R;const Z=Jn(R=T.videoCodecs).call(R,rt=>{var ut,At;return((ut=rt.rtpMap)===null||ut===void 0?void 0:ut.encodingName.toLocaleLowerCase())==="h264"&&((At=rt.fmtp)===null||At===void 0?void 0:At.parameters["profile-level-id"])==="42001f"});if(Z!==-1){var w;const rt=Jn(w=T.videoCodecs).call(w,ut=>{var At;return((At=ut.rtpMap)===null||At===void 0?void 0:At.encodingName.toLocaleLowerCase())==="h264"});if(rt<Z){var k,L;N.debug("raising H264 baseline profile priority");const ut=T.videoCodecs[Z];Ze(k=T.videoCodecs).call(k,Z,1),Ze(L=T.videoCodecs).call(L,rt,0,ut)}var Y;rt!==-1&&(_.videoCodecs=Ot(Y=_.videoCodecs).call(Y,ut=>{var At,Ct;return!(((At=ut.rtpMap)===null||At===void 0?void 0:At.encodingName.toLocaleLowerCase())==="h264"&&((Ct=ut.fmtp)===null||Ct===void 0?void 0:Ct.parameters["profile-level-id"])!=="42001f")}))}}try{p.close()}catch{}return{send:I,recv:_,sendrecv:T}}(!this.useRTX,!1);return this.localCapabilities=__(n),this.initialOffer=t,function(o){for(var c=1;c<arguments.length;c++){var u,d=arguments[c]!=null?arguments[c]:{};if(c%2)G(u=B_(Object(d),!0)).call(u,function(f){qr(o,f,d[f])});else if(Ce)dr(o,Ce(d));else{var p;G(p=B_(Object(d))).call(p,function(f){te(o,f,zt(d,f))})}}return o}({},e,{rtpCapabilities:n,offerSDP:t.sdp})}catch(t){throw new Q(U.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(t,e,n,o,c,u){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new Bf({remoteIceParameters:t,remoteDtlsParameters:e,candidates:n,remoteRTPCapabilities:o,remoteSetup:c,localCapabilities:this.localCapabilities,cname:u});const d=this.remoteSDP.toString(),p=this.logSDPExchange(this.initialOffer.sdp||"","offer","local","connect");await this.peerConnection.setLocalDescription(this.initialOffer),p==null||p(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d});const f=this.peerConnection.getTransceivers()[0];if(f!=null&&f.receiver&&this.tryBindTransportEvents(f.receiver),ot("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia();const g=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:g});const E=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(E)}}catch(d){throw new Q(U.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(d.toString()))}}send(t,e,n){var o=this;return xl(function*(){const c=yield Qr(o.mutex.lock());try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const u=[];G(t).call(t,R=>{const w=o.peerConnection.addTransceiver(R._mediaStreamTrack,{direction:"sendonly"});u.push(w)}),si()&&ot("SIMULCAST")===!0&&(Lt("debug",o,"apply simulcast for firefox"),yield Qr(o.applySimulcastForFirefox(u,t)));const d=yield Qr(o.peerConnection.createOffer()),p=o.remoteSDP.predictReceivingMids(t.length),f=o.mungSendOfferSDP(d.sdp,t,p),g=so.parse(f),E=ht(p).call(p,R=>{var w;const k=yt(w=g.mediaDescriptions).call(w,L=>L.attributes.mid===R);if(!k)throw new Error("Cannot extract ssrc from mediaDescription.");return function(L,Y){var Z,rt;const ut=[],At=Ot(Z=L.attributes.ssrcGroups).call(Z,wt=>wt.semantic==="FID"),Ct=yt(rt=L.attributes.ssrcGroups).call(rt,wt=>wt.semantic==="SIM"),lt=L.attributes.ssrcs;var Gt;if(Ct)G(Gt=Ct.ssrcIds).call(Gt,wt=>{var Qt;const xt=(Qt=yt(At).call(At,ae=>ae.ssrcIds[0]===wt))===null||Qt===void 0?void 0:Qt.ssrcIds[1];ut.push({ssrcId:wt,rtx:Y?xt:void 0})});else if(At.length>0){const wt=At[0].ssrcIds[0],Qt=At[0].ssrcIds[1];ut.push({ssrcId:wt,rtx:Y?Qt:void 0})}else{if(lt.length===0)throw new Error("No ssrcs found on local media description.");ut.push({ssrcId:lt[0].ssrcId})}return ut}(k,o.useRTX)});let I;try{I=yield E}catch(R){throw G(u).call(u,w=>{var k;return(k=w.stop)===null||k===void 0?void 0:k.call(w)}),o.remoteSDP.bumpMid(u.length),R}o.remoteSDP.receive(t,e,n,I);const _=o.remoteSDP.toString(),T=o.logSDPExchange(f,"offer","local","send");return yield Qr(o.peerConnection.setLocalDescription({type:"offer",sdp:f})),yield Qr(o.applySimulcastEncodings(u,t)),yield Qr(o.applySendEncodings(u,t)),T==null||T(_),yield Qr(o.peerConnection.setRemoteDescription({type:"answer",sdp:_})),ht(u).call(u,(R,w)=>{const k=p[w];return{localSSRC:E[w],id:k,transceiver:R}})}catch(u){throw new Q(U.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(u.toString()))}finally{c()}})()}async stopSending(t){try{var e;if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const n=Ot(e=this.peerConnection.getTransceivers()).call(e,d=>Ft(t).call(t,d.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");ht(n).call(n,d=>{var p;d.direction="inactive",(p=d.stop)===null||p===void 0||p.call(d)});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(t);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(n){throw new Q(U.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}}async receive(t,e,n,o){try{var c;if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:u,needExchangeSDP:d}=this.remoteSDP.send(t,e,n,o);if(d){const f=this.remoteSDP.toString(),g=this.logSDPExchange(f,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:f});const E=await this.peerConnection.createAnswer();g==null||g(E.sdp||""),await this.peerConnection.setLocalDescription(E),N.debug("[P2PConnection] receive ".concat(t," by exchanging SDP."))}else N.debug("[P2PConnection] receive ".concat(t," no need to exchange SDP."));const p=yt(c=this.peerConnection.getTransceivers()).call(c,f=>f.mid===u);if(!p)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:p.receiver.track,id:u}}catch(u){throw new Q(U.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const e=this.remoteSDP.toString(),n=this.logSDPExchange(e,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const o=await this.peerConnection.createAnswer();n==null||n(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(e){throw new Q(U.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const e=this.remoteSDP.toString(),n=this.logSDPExchange(e,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const o=await this.peerConnection.createAnswer();n==null||n(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(e){throw new Q(U.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(e.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const e=this.remoteSDP.toString(),n=this.logSDPExchange(e,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const o=await this.peerConnection.createAnswer();n==null||n(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(e){throw new Q(U.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(e.toString()))}}async muteLocal(t){try{var e;if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=Ot(e=this.peerConnection.getTransceivers()).call(e,d=>d.mid&&Ft(t).call(t,d.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");ht(n).call(n,d=>{d.direction="inactive"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(t);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(n){throw new Q(U.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{var e;if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=Ot(e=this.peerConnection.getTransceivers()).call(e,d=>d.mid&&Ft(t).call(t,d.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");ht(n).call(n,async(d,p)=>{d.direction="sendonly"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(t);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(n){throw new Q(U.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}async reEstablish(){const t=await this.peerConnection.createOffer({iceRestart:!0});if(!t.sdp)throw new Error("Cannot get SDP from restart offer.");return{iceParameters:Vd(t.sdp).iceParameters,restartICE:async(e,n)=>this.restartICE(t,e,n),restartOfferSDP:t.sdp}}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const n=await this.peerConnection.createOffer(),o=this.mungSendOfferSDP(n.sdp,[e],[t]);this.remoteSDP.updateRecvMedia(t,e);const c=this.remoteSDP.toString(),u=this.logSDPExchange(o,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),u==null||u(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(n){throw new Q(U.EXCHANGE_SDP_FAILED,n.toString())}}async updateSendParameters(t,e){var n;const o=Ot(n=this.peerConnection.getTransceivers()).call(n,c=>c.mid===t);o.length===1&&(this.isVP8Simulcast(e)?si()||await this.applySimulcastEncodings(o,[e]):await this.applySendEncodings(o,[e]))}setStatsRemoteVideoIsReady(t,e){this.statsFilter.setVideoIsReady2(t,e)}async replaceTrack(t,e){var n;const o=yt(n=this.peerConnection.getTransceivers()).call(n,c=>c.mid===e);o&&await o.sender.replaceTrack(t._mediaStreamTrack)}async restartICE(t,e,n){try{if(!this.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");this.remoteSDP.restartICE(e,n);const o=this.remoteSDP.toString(),c=this.logSDPExchange(t.sdp||"","offer","local","restartICE");await this.peerConnection.setLocalDescription(t),c==null||c(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(o){throw new Q(U.EXCHANGE_SDP_FAILED,"P2PConnection.restartICE failed; ".concat(o.toString()))}}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,N.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},Vr(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,N.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},ot("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const e={iceServers:[]};var n,o;return t.iceServers?e.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(cA(t.turnServer.servers)?e.iceServers=t.turnServer.servers:(e.iceServers&&e.iceServers.push(...Ql.turnServerConfigToIceServers(t.turnServer.servers)),ot("USE_TURN_SERVER_OF_GATEWAY")&&e.iceServers&&t.turnServer.serversFromGateway&&e.iceServers.push(...Ql.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),G(n=M(o=t.turnServer.servers).call(o,t.turnServer.serversFromGateway||[])).call(n,c=>{c.forceturn&&(e.iceTransportPolicy="relay")}))),e}static turnServerConfigToIceServers(t){const e=[];return G(t).call(t,n=>{if(n.security){var o;n.tcpport&&e.push({username:n.username,credential:n.password,credentialType:"password",urls:M(o="turns:".concat(BA(n.turnServerURL),":")).call(o,n.tcpport,"?transport=tcp")})}else{var c,u;n.udpport&&e.push({username:n.username,credential:n.password,credentialType:"password",urls:M(c="turn:".concat(n.turnServerURL,":")).call(c,n.udpport,"?transport=udp")}),n.tcpport&&e.push({username:n.username,credential:n.password,credentialType:"password",urls:M(u="turn:".concat(n.turnServerURL,":")).call(u,n.tcpport,"?transport=tcp")})}}),e}tryBindTransportEvents(t){t.transport&&(this.transportEventReceiver=t,t.transport.onstatechange=()=>{var e,n;(e=t.transport)!==null&&e!==void 0&&e.state&&((n=this.onDTLSTransportStateChange)===null||n===void 0||n.call(this,t.transport.state))},t.transport.onerror=e=>{var n;(n=this.onDTLSTransportError)===null||n===void 0||n.call(this,e.error)},t.transport.iceTransport&&(t.transport.iceTransport.onstatechange=()=>{var e,n,o;(e=t.transport)!==null&&e!==void 0&&e.iceTransport.state&&((n=this.onICETransportStateChange)===null||n===void 0||n.call(this,(o=t.transport)===null||o===void 0?void 0:o.iceTransport.state))}))}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async applySendEncodings(t,e){try{if(!Mn().supportSetRtpSenderParameters||t.length!==e.length)return;for(let E=0;E<t.length;E++){const I=t[E],_=e[E];if(_&&_ instanceof We){var n,o,c;if(this.isVP8Simulcast(_))continue;const T={},R={};switch(_._optimizationMode){case"motion":T.degradationPreference="maintain-framerate";break;case"detail":T.degradationPreference="maintain-resolution";break;default:T.degradationPreference="balanced"}var u,d,p,f;if((n=_._encoderConfig)!==null&&n!==void 0&&n.bitrateMax&&(R.maxBitrate=1e3*((u=_._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)),Xt(o=_._hints).call(o,dn.LOW_STREAM)&&((d=_._encoderConfig)!==null&&d!==void 0&&d.frameRate&&(R.maxFramerate=Ws(_._encoderConfig.frameRate)),(p=_._encoderConfig)!==null&&p!==void 0&&p.scaleResolutionDownBy&&((f=_._encoderConfig)===null||f===void 0?void 0:f.scaleResolutionDownBy)>1&&(R.scaleResolutionDownBy=_._encoderConfig.scaleResolutionDownBy)),ot("DSCP_TYPE")&&uc()){var g;const L=ot("DSCP_TYPE");Xt(g=["very-low","low","medium","high"]).call(g,L)&&(R.networkPriority=L)}const w=I.sender.getParameters(),k=(c=w.encodings)===null||c===void 0?void 0:c[0];si()&&!k&&(T.encodings=[R]),k&&Ir(k,R),Ir(w,T),await I.sender.setParameters(w)}}}catch{N.debug("Apply RTPSendEncodings failed.")}}mungSendOfferSDP(t,e,n){const o=so.parse(t);return G(e).call(e,(c,u)=>{var d;const p=n[u],f=yt(d=o.mediaDescriptions).call(d,g=>g.attributes.mid===p);f&&(Gd(f,c),function(g,E,I){var _;if(si()||g.media.mediaType!=="video"||!(E instanceof We)||I!=="vp9"&&I!=="vp8"||I==="vp8"&&!ot("SIMULCAST")||E._scalabiltyMode===void 0||E._scalabiltyMode.numSpatialLayers<=1)return;const T=I==="vp8"?2:E._scalabiltyMode.numSpatialLayers,R=g.attributes.ssrcs[0],w=yt(_=g.attributes.ssrcGroups).call(_,L=>L.semantic==="FID"&&L.ssrcIds[0]===R.ssrcId),k={semantic:"SIM",ssrcIds:[R.ssrcId]};for(let L=1;L<T;L++)g.attributes.ssrcs.push({ssrcId:R.ssrcId+L,attributes:en(R.attributes)}),k.ssrcIds.push(R.ssrcId+L),w&&(g.attributes.ssrcs.push({ssrcId:w.ssrcIds[1]+L,attributes:en(R.attributes)}),g.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[R.ssrcId+L,w.ssrcIds[1]+L]}));g.attributes.ssrcGroups.unshift(k)}(f,c,this.store.codec))}),so.print(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var e;(e=this.onFirstAudioReceived)===null||e===void 0||e.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var e;(e=this.onFirstVideoReceived)===null||e===void 0||e.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var e;(e=this.onFirstAudioDecoded)===null||e===void 0||e.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,e,n)=>{var o;(o=this.onFirstVideoDecoded)===null||o===void 0||o.call(this,t,e,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0}async applySimulcastForFirefox(t,e){if(t.length===e.length)for(let p=0;p<t.length;p++){var n,o,c,u,d;const f=t[p],g=e[p];if(g instanceof We&&!Xt(n=g._hints).call(n,dn.LOW_STREAM)&&(o=g._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=g._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=g._scalabiltyMode)!==null&&u!==void 0&&u.numSpatialLayers&&((d=g._scalabiltyMode)===null||d===void 0?void 0:d.numSpatialLayers)>1&&this.store.codec==="vp8"){const E={},I={high:1e3*(g._encoderConfig.bitrateMax-50),medium:5e4};E.encodings=[{rid:"m",active:!0,maxBitrate:I.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:I.high}];const _=f.sender.getParameters();await f.sender.setParameters(Ir(_,E))}}}async applySimulcastEncodings(t,e){if(!si()&&t.length===e.length)for(let n=0;n<t.length;n++){const o=e[n];if(o instanceof We&&this.isVP8Simulcast(o)){const c=t[n],u={},d={high:1e3*(o._encoderConfig.bitrateMax-50),medium:5e4};u.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:d.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:d.medium,scaleResolutionDownBy:4}];const p=c.sender.getParameters();await c.sender.setParameters(Ir(p,u))}}}isVP8Simulcast(t){var e,n,o,c,u;return t instanceof We&&ot("SIMULCAST")&&this.store.codec==="vp8"&&!Xt(e=t._hints).call(e,dn.LOW_STREAM)&&((n=t._encoderConfig)===null||n===void 0?void 0:n.bitrateMax)&&((o=t._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&((c=t._scalabiltyMode)===null||c===void 0?void 0:c.numSpatialLayers)&&((u=t._scalabiltyMode)===null||u===void 0?void 0:u.numSpatialLayers)>1}logSDPExchange(t,e,n,o){var c,u;if(ot("SDP_LOGGING"))return N.upload(M(c=M(u="exchanging ".concat(n," ")).call(u,e," SDP during P2PConnection.")).call(c,o,`
`),t),e==="offer"?d=>{this.logSDPExchange(d,"answer",n==="local"?"remote":"local",o)}:void 0}};function Ri(t,e,n){const o=t[e];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(...c){const u=this.mutex,d=await u.lock("Locking from P2PConnection.".concat(e));try{return await o.apply(this,c)}finally{d()}},n}function aO(t,e){let n=document.createElement("video"),o=document.createElement("canvas");n.setAttribute("style","display:none"),o.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),o.width=Ws(e.width),o.height=Ws(e.height);const c=Ws(e.framerate||15);document.body.append(n),document.body.append(o);let u=t._mediaStreamTrack;n.srcObject=new MediaStream([u]),n.play();const d=o.getContext("2d");if(!d)throw new Q(U.UNEXPECTED_ERROR,"can not get canvas context");const p=Mn(),f=o.captureStream(p.supportRequestFrame?0:c).getVideoTracks()[0],g=OA(()=>(()=>{if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const R=n.videoWidth,w=n.videoHeight/R,k=o.width*w;var I,_,T;Math.abs(k-o.height)>=2&&(N.debug("adjust low stream resolution",M(I=M(_=M(T="".concat(o.width,"x")).call(T,o.height," -> ")).call(_,o.width,"x")).call(I,k)),o.height=k)}d.drawImage(n,0,0,o.width,o.height),f.requestFrame&&f.requestFrame(),u!==t._mediaStreamTrack&&(u=t._mediaStreamTrack,n.srcObject=new MediaStream([u]))})(),c),E=f.stop;return f.stop=()=>{E.call(f),g(),n.remove(),o.width=0,o.remove(),o=null,n=null,N.debug("clean low stream renderer")},f}function L_(t,e){var n=ue(t);if(_e){var o=_e(t);e&&(o=Ot(o).call(o,function(c){return zt(t,c).enumerable})),n.push.apply(n,o)}return n}function Lf(t){for(var e=1;e<arguments.length;e++){var n,o=arguments[e]!=null?arguments[e]:{};if(e%2)G(n=L_(Object(o),!0)).call(n,function(u){qr(t,u,o[u])});else if(Ce)dr(t,Ce(o));else{var c;G(c=L_(Object(o))).call(c,function(u){te(t,u,zt(o,u))})}}return t}di([Ri,fe("design:type",Function),fe("design:paramtypes",[Object,Object,Array,Object,String,String]),fe("design:returntype",ct)],Pn.prototype,"connect",null),di([Ri,fe("design:type",Function),fe("design:paramtypes",[Array]),fe("design:returntype",ct)],Pn.prototype,"stopSending",null),di([Ri,fe("design:type",Function),fe("design:paramtypes",[String,Array,String,Object]),fe("design:returntype",ct)],Pn.prototype,"receive",null),di([Ri,fe("design:type",Function),fe("design:paramtypes",[Array]),fe("design:returntype",ct)],Pn.prototype,"stopReceiving",null),di([Ri,fe("design:type",Function),fe("design:paramtypes",[String]),fe("design:returntype",ct)],Pn.prototype,"muteRemote",null),di([Ri,fe("design:type",Function),fe("design:paramtypes",[String]),fe("design:returntype",ct)],Pn.prototype,"unmuteRemote",null),di([Ri,fe("design:type",Function),fe("design:paramtypes",[Array]),fe("design:returntype",ct)],Pn.prototype,"muteLocal",null),di([Ri,fe("design:type",Function),fe("design:paramtypes",[Array]),fe("design:returntype",ct)],Pn.prototype,"unmuteLocal",null),di([Ri,fe("design:type",Function),fe("design:paramtypes",[]),fe("design:returntype",ct)],Pn.prototype,"reEstablish",null),di([Ri,fe("design:type",Function),fe("design:paramtypes",[]),fe("design:returntype",void 0)],Pn.prototype,"close",null),di([Ri,fe("design:type",Function),fe("design:paramtypes",[String,As]),fe("design:returntype",ct)],Pn.prototype,"updateEncoderConfig",null),di([Ri,fe("design:type",Function),fe("design:paramtypes",[String,As]),fe("design:returntype",ct)],Pn.prototype,"updateSendParameters",null),di([Ri,fe("design:type",Function),fe("design:paramtypes",[As,String]),fe("design:returntype",ct)],Pn.prototype,"replaceTrack",null),di([Ri,fe("design:type",Function),fe("design:paramtypes",[Object,Object,Array]),fe("design:returntype",ct)],Pn.prototype,"restartICE",null),Pn=Ql=di([an("P2PConnection","store.p2pId"),fe("design:paramtypes",[Object,wc])],Pn);var M_=function(t,e,n,o){var c,u=arguments.length,d=u<3?e:o===null?o=zt(e,n):o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(t,e,n,o);else for(var p=t.length-1;p>=0;p--)(c=t[p])&&(d=(u<3?c(d):u>3?c(e,n,d):c(e,n))||d);return u>3&&d&&te(e,n,d),d},P_=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};class x_ extends c1{constructor(e,n,o,c){var u,d,p;super(e,M(u=M(d=M(p="track-".concat(e.kind,"-")).call(p,n,"-")).call(d,c.clientId,"_")).call(u,gr(5,""))),this._isDestroyed=!1,this._userId=n,this._uintId=o,this.store=c}getUserId(){return this._userId}_updateOriginMediaStreamTrack(e){this._originMediaStreamTrack=e,this._mediaStreamTrack=e,this._updatePlayerSource()}_destroy(){this._isDestroyed=!0,N.info("[".concat(this.getTrackId(),"] is destroyed")),st("info",this,"_destroy"),this.stop(),super.close()}}let Fl=class extends x_{constructor(t,e,n,o){super(t,e,n,o),this._videoVisibleTimer=null,this._previousVideoVisibleStatus=void 0,this._clearPreviousVideoVisibleStatus=()=>this._previousVideoVisibleStatus=void 0,this.trackMediaType="video",st("info",this,"constructor",{userId:e}),this.updateMediaStreamTrackResolution()}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==cn.PLAYING)}getStats(){return Sl(()=>{N.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead"),Lt("warning",this,"[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),ya(this,Kt.GET_STATS)||Lf({},UI)}play(t,e={}){const n=it.reportApiInvoke(null,{tag:Ut.TRACER,name:Vt.REMOTE_VIDEO_TRACK_PLAY,options:[this.getTrackId(),typeof t=="string"?t:"HTMLElement",e]});if(typeof t=="string"){const u=document.getElementById(t);var o;u?t=u:(N.warning(M(o="[".concat(this.getTrackId(),'] can not find "#')).call(o,t,'" element, use document.body')),Lt("warning",this,'can not find "#'.concat(t,'" element, use document.body')),t=document.body)}N.debug("[".concat(this.getTrackId(),"] start video playback"),at(e)),st("debug",this,"play",e);const c=Lf({fit:"cover"},e,{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(c):(this._player=new xd(c),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,performance.now()),this.emit(vc.FIRST_FRAME_DECODED)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const u=this.getVideoElementVisibleStatus();this.emit(vc.VIDEO_ELEMENT_VISIBLE_STATUS,u)}catch{}},ot("CHECK_VIDEO_VISIBLE_INTERVAL")),n.onSuccess()}stop(){const t=it.reportApiInvoke(null,{tag:Ut.TRACER,name:Vt.REMOTE_VIDEO_TRACK_STOP,options:[this.getTrackId()]});if(!this._player)return t.onSuccess();this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,N.debug("[".concat(this.getTrackId(),"] stop video playback")),st("debug",this,"stop"),t.onSuccess()}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){P1(this._originMediaStreamTrack).then(([t,e])=>{this._videoHeight=e,this._videoWidth=t}).catch(_d)}_updatePlayerSource(){N.debug("[".concat(this.getTrackId(),"] update player source track")),st("debug",this,"_updatePlayerSource"),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var t,e;const n=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),o={track:this,element:this==null||(e=this._player)===null||e===void 0?void 0:e.getVideoElement(),slot:n==null?void 0:n.parentElement},{element:c,slot:u}=o;if(this.isPlaying&&c instanceof HTMLVideoElement&&u instanceof HTMLElement){const d=u_.checkOneElementVisible(c),p=Ir({},d);if(p.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=p.visible;const f=it.reportApiInvoke(null,{tag:Ut.TRACER,name:Vt.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});p.visible?f.onSuccess("Video is visible"):f.onSuccess("Invisible because of ".concat(p.reason))}return p}return}catch(n){throw new Q(U.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}};Fl=M_([an("RemoteVideoTrack","getTrackId"),P_("design:paramtypes",[MediaStreamTrack,Object,Number,wc])],Fl);let Vl=class extends x_{constructor(t,e,n,o){super(t,e,n,o),this.trackMediaType="audio",this._useAudioElement=!0,this._volume=100,st("info",this,"constructor",{userId:e}),ot("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),this._source=new h1(t,!0),this._source.once(Zi.RECEIVE_TRACK_BUFFER,()=>{this.emit(vc.FIRST_FRAME_DECODED)})}get isPlaying(){return this._useAudioElement?ci.isPlaying(this.getTrackId()):this._source.isPlayed}setAudioFrameCallback(t,e=4096){if(!t)return this._source.removeAllListeners(Zi.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(Zi.ON_AUDIO_BUFFER),this._source.on(Zi.ON_AUDIO_BUFFER,n=>t(n))}setVolume(t){const e=it.reportApiInvoke(null,{tag:Ut.TRACER,name:Vt.REMOTE_AUDIO_SET_VOLUME,options:[this.getTrackId(),t]},300);this._volume=t,this._useAudioElement?ci.setVolume(this.getTrackId(),t):this._source.setVolume(t/100),e.onSuccess()}async setPlaybackDevice(t){const e=it.reportApiInvoke(null,{tag:Ut.TRACER,name:Vt.REMOTE_AUDIO_SET_OUTPUT_DEVICE,options:[this.getTrackId(),t]});if(!this._useAudioElement)throw new Q(U.NOT_SUPPORTED,"your browser does not support setting the audio output device");try{await ci.setSinkID(this.getTrackId(),t)}catch(n){throw e.onError(n),n}e.onSuccess()}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Sl(()=>{N.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead"),Lt("warning",this,"[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),ya(this,Kt.GET_STATS)||Lf({},xI)}play(){const t=it.reportApiInvoke(null,{tag:Ut.TRACER,name:Vt.REMOTE_AUDIO_TRACK_PLAY,options:[this.getTrackId()]});N.debug("[".concat(this.getTrackId(),"] start audio playback")),st("debug",this,"play"),this._useAudioElement?(N.debug("[".concat(this.getTrackId(),"] use audio element to play")),Lt("debug",this,"use audio element to play"),ci.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play(),t.onSuccess()}stop(){const t=it.reportApiInvoke(null,{tag:Ut.TRACER,name:Vt.REMOTE_AUDIO_TRACK_STOP,options:[this.getTrackId()]});N.debug("[".concat(this.getTrackId(),"] stop audio playback")),st("debug",this,"stop"),this._useAudioElement?ci.stop(this.getTrackId()):this._source.stop(),t.onSuccess()}_destroy(){super._destroy(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){N.debug("[".concat(this.getTrackId(),"] update player source track")),st("debug",this,"_updatePlayerSource"),this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&ci.updateTrack(this.getTrackId(),this._mediaStreamTrack)}};function U_(t,e){var n=ue(t);if(_e){var o=_e(t);e&&(o=Ot(o).call(o,function(c){return zt(t,c).enumerable})),n.push.apply(n,o)}return n}function cO(t){for(var e=1;e<arguments.length;e++){var n,o=arguments[e]!=null?arguments[e]:{};if(e%2)G(n=U_(Object(o),!0)).call(n,function(u){qr(t,u,o[u])});else if(Ce)dr(t,Ce(o));else{var c;G(c=U_(Object(o))).call(c,function(u){te(t,u,zt(o,u))})}}return t}Vl=M_([an("RemoteAudioTrack","getTrackId"),P_("design:paramtypes",[MediaStreamTrack,Object,Number,wc])],Vl);class lO extends Gr{constructor(){super(),this.uploadUnplinkStarted=!1,this.uploadDownlinkStarted=!1}startUploadUplinkStats(){this.uploadUnplinkStarted||(this.uploadUnplinkStarted=!0,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkStatsUploadInterval=window.setInterval(()=>{var e;const n=(e=this.requestStats)===null||e===void 0?void 0:e.call(this);n&&(this.uploadUplinkStats(n,this.lastStats),this.lastStats=n)},3e3),this.uplinkStatsUploadSlowInterval&&window.clearInterval(this.uplinkStatsUploadSlowInterval),this.uplinkStatsUploadSlowInterval=window.setInterval(()=>{var e;const n=(e=this.requestStats)===null||e===void 0?void 0:e.call(this);n&&this.uploadSlowUplinkStats(n)},6e4),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkRelatedStatsUploadInterval=window.setInterval(()=>{var e;const n=(e=this.requestStats)===null||e===void 0?void 0:e.call(this);n&&this.uploadRelatedUplinkStats(n,this.lastStats),this.lastStats=n},1e3),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval=window.setInterval(()=>{var e;const n=(e=this.requestAllTracks)===null||e===void 0?void 0:e.call(this);n&&this.uploadDenoiserStats(n)},2e3))}uploadUplinkStats(e,n){var o;const c=((o=this.requestLocalMedia)===null||o===void 0?void 0:o.call(this))||[];G(c).call(c,([u,{track:d,ssrcs:p}])=>{switch(u){case bt.LocalVideoLowTrack:case bt.LocalVideoTrack:{const g=function(I,_,T){var R,w;const k=yt(R=_.videoSend).call(R,Y=>Y.ssrc===I);if(!k)return null;const L={id:gr(10,""),timestamp:new Date(_.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:k.ssrc.toString()};switch(L.A_vstd=T._originMediaStreamTrack&&!T._originMediaStreamTrack.enabled||!T._mediaStreamTrack.enabled?"1":"0",k.sentFrame&&(L.A_fhs=k.sentFrame.height.toString(),L.A_frs=k.sentFrame.frameRate.toString(),L.A_fws=k.sentFrame.width.toString()),k.adaptionChangeReason){case"none":L.A_ac="0";break;case"cpu":L.A_ac="1";break;case"bandwidth":L.A_ac="2";break;case"other":L.A_ac="3"}return L.A_lvps=sA[T._player?T._player.videoElementStatus:"uninit"].toString(),L.A_nr=(w=k.nacksCount)===null||w===void 0?void 0:w.toString(),k.avgEncodeMs&&(L.A_aem=k.avgEncodeMs.toFixed(0).toString()),L}(p[0].ssrcId,e,d),E=k1(p[0].ssrcId,e,n);g&&Gi(()=>{var I;return(I=this.requestUpload)===null||I===void 0?void 0:I.call(this,Pi.PUBLISH_STATS,{stream_type:u===bt.LocalVideoLowTrack?"low":"high",stats:cO({},g,{},E)})});break}case bt.LocalAudioTrack:{const g=function(E,I,_){var T;const R=yt(T=I.audioSend).call(T,k=>k.ssrc===E);if(!R)return null;const w={id:gr(10,""),timestamp:new Date(I.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:R.ssrc.toString()};return w.A_astd=_._originMediaStreamTrack.enabled&&_._mediaStreamTrack.enabled?"0":"1",R.inputLevel?w.A_ail=Math.round(100*R.inputLevel).toString():w.A_ail=Math.round(100*_._source.getAccurateVolumeLevel()).toString(),w.A_apil=Math.round(100*_._source.getAccurateVolumeLevel()).toString(),w}(p[0].ssrcId,e,d);g&&Gi(()=>{var E;return(E=this.requestUpload)===null||E===void 0?void 0:E.call(this,Pi.PUBLISH_STATS,{stream_type:"high",stats:g})});break}}const f=function(g){const E={id:"bweforvideo",timestamp:new Date(g.timestamp).toISOString(),type:"VideoBwe"};return g.bitrate.retransmit&&(E.A_rb=g.bitrate.retransmit.toString()),g.bitrate.targetEncoded&&(E.A_teb=g.bitrate.targetEncoded.toString()),E.A_aeb=g.bitrate.actualEncoded.toString(),E.A_tb=g.bitrate.transmit.toString(),g.sendBandwidth!==void 0&&(E.A_asb=g.sendBandwidth.toString()),E}(e);f&&Gi(()=>{var g;return(g=this.requestUpload)===null||g===void 0?void 0:g.call(this,Pi.PUBLISH_STATS,{stream_type:u===bt.LocalVideoLowTrack?"low":"high",stats:f})})})}uploadSlowUplinkStats(e){var n,o;const c=Ot(n=((o=this.requestLocalMedia)===null||o===void 0?void 0:o.call(this))||[]).call(n,([u])=>u===bt.LocalVideoLowTrack||u===bt.LocalVideoTrack);G(c).call(c,([u,{ssrcs:d}])=>{const p=k1(d[0].ssrcId,e);p&&Gi(()=>{var f;return(f=this.requestUpload)===null||f===void 0?void 0:f.call(this,Pi.PUBLISH_STATS,{stream_type:u===bt.LocalVideoLowTrack?"low":"high",stats:p})})})}uploadRelatedUplinkStats(e,n){var o,c;const u=Ot(o=((c=this.requestLocalMedia)===null||c===void 0?void 0:c.call(this))||[]).call(o,([d])=>d===bt.LocalVideoLowTrack||d===bt.LocalVideoTrack);G(u).call(u,([d,{ssrcs:p}])=>{const f=function(g,E){var I;const _=yt(I=E.videoSend).call(I,T=>T.ssrc===g);return _?{mediaType:"video",isVideoMute:!1,frameRateInput:_.inputFrame&&_.inputFrame.frameRate.toString(),frameRateSent:_.sentFrame&&_.sentFrame.frameRate.toString(),googRtt:_.rttMs.toString()}:null}(p[0].ssrcId,e);f&&Gi(()=>{var g;(g=this.requestUpload)===null||g===void 0||g.call(this,Pi.PUBLISH_RELATED_STATS,{stream_type:d===bt.LocalVideoLowTrack?"low":"high",stats:f})})})}uploadDenoiserStats(e){for(let u=0;u<e.length;u++){const d=e[u];if(d instanceof Ks){var n,o,c;const p=(n=(o=d._external).getDenoiserStats)===null||n===void 0?void 0:n.call(o);return void(p&&((c=this.requestUpload)===null||c===void 0||c.call(this,Pi.DENOISER_STATS,p)))}}}stopUploadUplinkStats(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkStatsUploadInterval=void 0,this.uplinkRelatedStatsUploadInterval=void 0,this.uplinkDenoiserStatsUploadInterval=void 0)}startUploadDownlinkStats(){this.uploadDownlinkStarted||(this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval),this.downlinkStatsUploadInterval=window.setInterval(()=>{var e;const n=(e=this.requestStats)===null||e===void 0?void 0:e.call(this);n&&(this.uploadDownlinkStats(n,this.lastStats),this.lastStats=n)},3e3),this.downlinkStatsUploadSlowInterval&&window.clearInterval(this.downlinkStatsUploadSlowInterval),this.downlinkStatsUploadSlowInterval=window.setInterval(()=>{var e;const n=(e=this.requestStats)===null||e===void 0?void 0:e.call(this);n&&this.uploadSlowDownlinkStats(n)},6e4),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkRelatedStatsUploadInterval=window.setInterval(()=>{var e;const n=(e=this.requestStats)===null||e===void 0?void 0:e.call(this);n&&(this.uploadRelatedDownlinkStats(n,this.lastStats),this.lastStats=n)},1e3))}uploadDownlinkStats(e,n){var o;const c=((o=this.requestRemoteMedia)===null||o===void 0?void 0:o.call(this))||[];G(c).call(c,([u,d])=>{if(d.has(xe.VIDEO)&&u.videoTrack){const p=u.videoTrack?function(f,g,E){var I;const _=yt(I=g.videoRecv).call(I,L=>L.ssrc===f);if(!_)return null;const T={id:gr(10,""),timestamp:new Date(g.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:_.ssrc.toString()};var R,w,k;return T.bytesReceived=_.bytes.toString(),T.packetsLost=_.packetsLost.toString(),T.packetsReceived=_.packets.toString(),_.framesRateFirefox&&(T.A_frr=_.framesRateFirefox.toString()),_.receivedFrame?(T.A_frr=_.receivedFrame.frameRate.toString(),T.A_fhr=_.receivedFrame.height.toString(),T.A_fwr=_.receivedFrame.width.toString()):(T.A_fhr=(R=E._videoHeight)===null||R===void 0?void 0:R.toString(),T.A_fwr=(w=E._videoWidth)===null||w===void 0?void 0:w.toString()),T.A_frd=_.decodeFrameRate.toString(),_.outputFrame&&(T.A_fro=_.outputFrame.frameRate.toString()),_.jitterBufferMs!==void 0&&(T.A_jbm=Math.floor(_.jitterBufferMs).toString()),_.currentDelayMs!==void 0&&(T.A_cdm=Math.floor(_.currentDelayMs).toString()),T.A_fs=_.firsCount.toString(),T.A_ns=_.nacksCount.toString(),T.A_ps=_.plisCount.toString(),E&&(T.A_vrtd=E._originMediaStreamTrack.enabled&&E._mediaStreamTrack.enabled?"0":"1"),E._player&&E._player.freezeTimeCounterList.length>0&&(T.A_vrft=Ze(k=E._player.freezeTimeCounterList).call(k,0,1)[0].toString()),T.A_rvps=sA[E._player?E._player.videoElementStatus:"uninit"].toString(),T}(u._videoSSRC,e,u.videoTrack):void 0;p&&Gi(()=>{var f;return(f=this.requestUpload)===null||f===void 0?void 0:f.call(this,Pi.SUBSCRIBE_STATS,{stream_id:u.uid,stats:p})})}if(d.has(xe.AUDIO)&&u.audioTrack){const p=u.audioTrack?function(f,g,E){var I;const _=yt(I=g.audioRecv).call(I,R=>R.ssrc===f);if(!_)return null;const T={id:gr(10,""),timestamp:new Date(g.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:_.ssrc.toString()};return T.bytesReceived=_.bytes.toString(),T.packetsLost=_.packetsLost.toString(),T.packetsReceived=_.packets.toString(),_.outputLevel?T.A_aol=Math.round(100*_.outputLevel).toString():T.A_aol=Math.round(100*E._source.getAccurateVolumeLevel()).toString(),T.A_apol=Math.round(100*E._source.getAccurateVolumeLevel()).toString(),E&&(T.A_artd=E._originMediaStreamTrack.enabled&&E._mediaStreamTrack.enabled?"0":"1"),T.A_jr=_.jitterMs.toString(),T.A_jbm=Math.floor(_.jitterBufferMs).toString(),T.A_cdm=Math.floor(_.jitterBufferMs).toString(),T.A_raps=sA[ci.getPlayerState(E.getTrackId())].toString(),T}(u._audioSSRC,e,u.audioTrack):void 0;p&&Gi(()=>{var f;return(f=this.requestUpload)===null||f===void 0?void 0:f.call(this,Pi.SUBSCRIBE_STATS,{stream_id:u.uid,stats:p})})}})}uploadSlowDownlinkStats(e){}uploadRelatedDownlinkStats(e,n){var o;const c=((o=this.requestRemoteMedia)===null||o===void 0?void 0:o.call(this))||[];G(c).call(c,([u,d])=>{if(d.has(xe.VIDEO)&&u.videoTrack){var p;const f=(u._videoSSRC&&((p=this.requestVideoIsReady)===null||p===void 0?void 0:p.call(this,u._videoSSRC))||!1)===!0,g=function(E,I,_,T,R,w){var k,L;const Y=yt(k=_.videoRecv).call(k,At=>At.ssrc===E),Z=R?yt(L=R.videoRecv).call(L,At=>At.ssrc===E):void 0;if(!Y)return null;const rt=Ca.isRemoteVideoFreeze(w,Y,Z)&&I,ut={mediaType:"video",isVideoMute:!1,peerId:T,frameRateReceived:Y.receivedFrame&&Y.receivedFrame.frameRate.toString(),frameRateDecoded:Y.decodedFrame&&Y.decodedFrame.frameRate.toString(),isFreeze:rt,bytesReceived:Y.bytes.toString(),packetsReceived:Y.packets.toString(),packetsLost:Y.packetsLost.toString()};return Y.framesRateFirefox&&(ut.frameRateDecoded=Y.framesRateFirefox.toString(),ut.frameRateReceived=Y.framesRateFirefox.toString()),ut}(u._videoSSRC,f,e,u.uid,n,u.videoTrack);g&&Gi(()=>{var E;(E=this.requestUpload)===null||E===void 0||E.call(this,Pi.SUBSCRIBE_RELATED_STATS,{stream_id:u.uid,stats:g})})}if(d.has(xe.AUDIO)&&u.audioTrack){const f=function(g,E,I,_){var T;const R=yt(T=E.audioRecv).call(T,k=>k.ssrc===g);if(!R)return null;const w=Ca.isRemoteAudioFreeze(_);return{mediaType:"audio",isAudioMute:!1,peerId:I,googJitterReceived:R.jitterMs.toString(),isFreeze:w,bytesReceived:R.bytes.toString(),packetsReceived:R.packets.toString(),packetsLost:R.packetsLost.toString(),frameReceived:R.receivedFrames.toString(),frameDropped:R.droppedFrames.toString()}}(u._audioSSRC,e,u.uid,u.audioTrack);f&&Gi(()=>{var g;(g=this.requestUpload)===null||g===void 0||g.call(this,Pi.SUBSCRIBE_RELATED_STATS,{stream_id:u.uid,stats:f})})}})}stopUploadDownlinkStats(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkStatsUploadInterval=void 0,this.downlinkRelatedStatsUploadInterval=void 0)}}function Q_(t,e){var n=ue(t);if(_e){var o=_e(t);e&&(o=Ot(o).call(o,function(c){return zt(t,c).enumerable})),n.push.apply(n,o)}return n}function Hd(t){for(var e=1;e<arguments.length;e++){var n,o=arguments[e]!=null?arguments[e]:{};if(e%2)G(n=Q_(Object(o),!0)).call(n,function(u){qr(t,u,o[u])});else if(Ce)dr(t,Ce(o));else{var c;G(c=Q_(Object(o))).call(c,function(u){te(t,u,zt(o,u))})}}return t}var ji=function(t,e,n,o){var c,u=arguments.length,d=u<3?e:o===null?o=zt(e,n):o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(t,e,n,o);else for(var p=t.length-1;p>=0;p--)(c=t[p])&&(d=(u<3?c(d):u>3?c(e,n,d):c(e,n))||d);return u>3&&d&&te(e,n,d),d},Qe=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};let hi=class extends Gr{constructor(t,e){super(),this.localTrackMap=new tr,this.remoteUserMap=new tr,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.isPlanB=!1,this.iceFailedCount=0,this.dtlsFailedCount=0,this.mutex=new Qi("P2PChannel-mutex"),this._state=Ci.Disconnected,this.handleMuteLocalTrack=async(n,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection)return void c(new Q(U.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));st("debug",this,"handleMuteLocalTrack",n.getTrackId()),await this.waitTillConnected();const d=this.filterTobeMutedTracks(n);if(d.length===0)return void o();await this.connection.muteLocal(ht(d).call(d,([,{id:f}])=>f));const p=this.createMuteMessage(d);await Kr(this,Re.RequestMuteLocal,p),o()}catch(d){c(d)}finally{u()}},this.handleUnmuteLocalTrack=async(n,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection)return void c(new Q(U.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));st("debug",this,"handleUnmuteLocalTrack",n.getTrackId()),await this.waitTillConnected();const d=this.filterTobeUnmutedTracks(n);if(d.length===0)return void o();await this.connection.unmuteLocal(ht(d).call(d,([,{id:f}])=>f));const p=this.createUnmuteMessage(d);await Kr(this,Re.RequestUnmuteLocal,p),o()}catch(d){c(d)}finally{u()}},this.handleUpdateVideoEncoder=async(n,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const d=this.localTrackMap.get(bt.LocalVideoTrack);if(!this.connection||!d||d.track!==n)return void o();await this.waitTillConnected();const{id:p,track:f}=d;await this.connection.updateSendParameters(p,f),await this.connection.updateEncoderConfig(p,f),this.emit(Re.UpdateVideoEncoder,f),o()}catch(d){c(d)}finally{u()}},this.handleSetOptimizationMode=async(n,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleSetOptimizationMode");try{const d=this.localTrackMap.get(bt.LocalVideoTrack);if(!this.connection||!d||d.track!==n)return;await this.waitTillConnected();const{id:p,track:f}=d;await this.connection.updateSendParameters(p,f),o()}catch(d){c(d)}finally{u()}},this.handleReplaceTrack=async(n,o,c)=>{try{var u,d;const p=yt(u=Ue(Tr(d=this.localTrackMap).call(d))).call(u,([,{track:f}])=>n===f);if(!this.connection||!p)return void o();if(await this.waitTillConnected(),await this.connection.replaceTrack(n,p[1].id),this.isPlanB){const f=p[1];f.id=n._mediaStreamTrack.id,this.localTrackMap.set(p[0],f)}if(p[0]===bt.LocalVideoTrack&&Mn().supportDualStreamEncoding){const f=this.localTrackMap.get(bt.LocalVideoLowTrack);if(f){const g=n._mediaStreamTrack.clone();f.track._originMediaStreamTrack.stop(),f.track._mediaStreamTrack=g,f.track._originMediaStreamTrack=g,await new ct((E,I)=>{this.handleReplaceTrack(f.track,E,I)})}}o()}catch(p){c(p)}},this.handleGetLocalVideoStats=n=>{n(this.statsCollector.getLocalVideoTrackStats())},this.handleGetLocalAudioStats=n=>{n(this.statsCollector.getLocalAudioTrackStats())},this.handleGetRemoteVideoStats=n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid],this.handleGetRemoteAudioStats=n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid],this.store=t,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new lO,this.bindStatsUploaderEvents(),this.isPlanB=!Mn().supportUnifiedPlan||ot("CHROME_FORCE_PLAN_B")&&uc()}get state(){return this._state}set state(t){const e=this._state;this._state=t,this.emit(Re.StateChange,e,this._state)}async startP2PConnection(t){return this.state=Ci.New,this.connection=this.isPlanB?new An(t,this.store):new Pn(t,this.store),this.bindConnectionEvents(this.connection),this.store.peerConnectionStart(),this.connection.establish()}async connect(t,e,n,o,c,u){if(!this.connection)throw new Q(U.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");await this.connection.connect(t,e,n,o,c,u),this.state=Ci.Connected}publish(t,e,n){var o=this;return xl(function*(){const c=yield Qr(o.mutex.lock("From P2PChannel.publish"));try{if(!o.connection){var u;if(o.state===Ci.Disconnected)throw new Q(U.UNEXPECTED_ERROR,"PeerConnection already disconnected.");o.throwIfTrackTypeNotMatch(t);const p=Ot(t).call(t,f=>{var g;return Ft(g=o.pendingLocalTracks).call(g,f)===-1});return void(o.pendingLocalTracks=M(u=o.pendingLocalTracks).call(u,p))}o.store.pubId=o.store.pubId+1,Vi.markPublishStart(o.store.clientId,o.store.pubId),yield Qr(o.waitTillConnected());const d=o.filterTobePublishedTracks(t,e,n);if(d.length===0)return void(yield Qr(o.tryToUnmuteAudio(t)));yield*f_(A_(o.doPublish(o.connection,d)),Qr)}finally{c()}})()}doPublish(t,e){var n=this;return xl(function*(){G(e).call(e,({track:g,type:E})=>{const I=performance.now();n.store.publish(g.getTrackId(),E===bt.LocalAudioTrack?"audio":"video",I)});const o=yield Qr(t.send(ht(e).call(e,({track:g})=>g),n.store.codec,n.store.audioCodec)),c=(yield Qr(o.next())).value,u=n.createGatewayPublishMessage(e,c);let d;try{d=yield u}catch(g){throw Lt("error",n,"doPublish yield error: ".concat(g.toString())),o.throw(g),(g==null?void 0:g.code)===U.WS_ABORT&&G(e).call(e,({track:E})=>{var I;Ft(I=n.pendingLocalTracks).call(I,E)===-1&&n.pendingLocalTracks.push(E)}),g}const p=n.mapPubResToRemoteConfig(u,d);st("debug",n,"doPublish",{remoteConfigs:p,tracks:ht(e).call(e,({track:g})=>g.getTrackId()),pubMsg:u,pubAns:d});const f=(yield Qr(o.next(p))).value;G(e).call(e,({type:g})=>{n.statsCollector.addLocalStats(g)}),n.bindLocalTrackEvents(e),n.assignLocalTracks(e,f),n.statsUploader.startUploadUplinkStats(),G(e).call(e,({track:g,type:E})=>{const I=performance.now();n.store.publish(g.getTrackId(),E===bt.LocalAudioTrack?"audio":"video",void 0,I)})})()}publishLowStream(t){var e=this;return xl(function*(){if(!e.connection)return;st("debug",e,"publishLowStream",t);const n=yield Qr(e.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const c=e.localTrackMap.get(bt.LocalVideoTrack);if(!c)throw new Q(U.UNEXPECTED_ERROR,"Could not find high stream");if(e.localTrackMap.has(bt.LocalVideoLowTrack))throw new Q(U.UNEXPECTED_ERROR,"[".concat(e.store.clientId,"] Can't publish low stream when stream already publish"));yield Qr(e.waitTillConnected());const u=[{track:e.getLowVideoTrack(c.track,t),type:bt.LocalVideoLowTrack}];if(yield*f_(A_(e.doPublish(e.connection,u)),Qr),c.track.muted||!c.track.enabled){var o;const d=(o=e.localTrackMap.get(bt.LocalVideoLowTrack))===null||o===void 0?void 0:o.id;d!==void 0&&(yield Qr(e.connection.muteLocal([d])))}}finally{n()}})()}async republish(){var t;this.pendingLocalTracks.length>0&&(N.debug("Emit P2PChannelEvents.RequestRePublish to republish tracks."),st("debug",this,"republish",ht(t=this.pendingLocalTracks).call(t,e=>e.getTrackId())),await ro(this,Re.RequestRePublish,this.pendingLocalTracks),this.emit(Re.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async reSubscribe(t){var e,n;st("debug",this,"reSubscribe",ht(e=this.pendingRemoteTracks).call(e,({user:c})=>c.uid));for(let c=this.pendingRemoteTracks.length-1;c>=0;c--){const{user:u,kind:d}=this.pendingRemoteTracks[c];var o;(d!==xe.AUDIO||u._audio_added_&&u._audioSSRC)&&(d!==xe.VIDEO||u._video_added_&&u._videoSSRC)||Ze(o=this.pendingRemoteTracks).call(o,c,1)}if(t)await ro(this,Re.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:c,kind:u}of this.pendingRemoteTracks)await this.subscribe(c,u,u===xe.VIDEO?c._videoSSRC:c._audioSSRC);G(n=this.pendingRemoteTracks).call(n,({user:c})=>{this.emit(Re.MediaReconnectEnd,c.uid)}),this.pendingRemoteTracks=[]}async unpublish(t){if(!this.connection)return void G(t).call(t,n=>{var o;const c=Ft(o=this.pendingLocalTracks).call(o,n);var u;c!==-1&&Ze(u=this.pendingLocalTracks).call(u,c,1)});await this.waitTillConnected();const e=this.filterTobeUnpublishedTracks(t);return e.length!==0?(st("debug",this,"unpublish"),this.doUnpublish(this.connection,e)):void 0}async unpublishLowStream(){if(!this.connection)return;st("debug",this,"unpublishLowStream");const t=this.localTrackMap.get(bt.LocalVideoLowTrack);if(!t)return;await this.waitTillConnected();const e=[[bt.LocalVideoLowTrack,t]];return this.doUnpublish(this.connection,e)}async doUnpublish(t,e){const n=this.createGatewayUnpublishMessage(e);return await t.stopSending(ht(e).call(e,([,{id:o}])=>o)),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e),G(e).call(e,([o])=>{this.statsCollector.removeLocalStats(o)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadUplinkStats(),n}async subscribe(t,e,n,o,c){var u,d;if(!this.connection)throw new Q(U.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if(st("debug",this,"subscribe",{uid:t.uid,mediaType:e,ssrcId:n}),(u=this.remoteUserMap.get(t))!==null&&u!==void 0&&u.has(e))return;let p,f;if(await this.waitTillConnected(),c){const k=yt(c).call(c,({stream_type:Y})=>Y===e);var g,E;if(!k)throw new Q(U.UNEXPECTED_ERROR,M(g=M(E="Cannot subscribe to remote ".concat(e," for user: ")).call(E,t.uid," because subscribe answer from gateway does not contain stream_type: ")).call(g,e,"."));const L=await this.connection.receive(e,k.ssrcs,String(t.uid),k.attributes);p=L.track,f=L.id}else{const k=await this.connection.receive(e,[{ssrcId:n,rtx:o}],String(t.uid),void 0);p=k.track,f=k.id}if(e===xe.AUDIO){var I;t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(p):(t._audioTrack=new Vl(p,t.uid,t._uintid,this.store),N.info(M(I="[".concat(this.store.p2pId,"] create remote audio track: ")).call(I,t._audioTrack.getTrackId()))),this.bindRemoteTrackEvents(t,t._audioTrack)}else{var _;t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(p):(t._videoTrack=new Fl(p,t.uid,t._uintid,this.store),N.info(M(_="[".concat(this.store.p2pId,"] create remote video track: ")).call(_,t._videoTrack.getTrackId()))),this.bindRemoteTrackEvents(t,t._videoTrack)}const T=this.remoteUserMap.get(t);T?T.set(e,f):this.remoteUserMap.set(t,new tr([[e,f]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadDownlinkStats();const R=Jn(d=this.pendingRemoteTracks).call(d,({user:k,kind:L})=>k.uid===t.uid&&e===L);var w;R!==-1&&(Ze(w=this.pendingRemoteTracks).call(w,R,1),this.emit(Re.MediaReconnectEnd,t.uid))}async unsubscribe(t,e){var n;const o=Ot(n=this.pendingRemoteTracks).call(n,({user:d,kind:p})=>e!==void 0?d.uid===t.uid&&e===p:d.uid===t.uid);if(G(o).call(o,d=>{var p,f;const g=Ft(p=this.pendingRemoteTracks).call(p,d);Ze(f=this.pendingRemoteTracks).call(f,g,1)}),!this.connection)return void G(o).call(o,({kind:d})=>{var p;if(d===xe.AUDIO)(p=t._audioTrack)===null||p===void 0||p._destroy(),t._audioTrack=void 0;else if(d===xe.VIDEO){var f;(f=t._videoTrack)===null||f===void 0||f._destroy(),t._videoTrack=void 0}});st("debug",this,"unsubscribe",{uid:t.uid,mediaType:e});const c=this.filterTobeUnSubscribedTracks(t,e);if(c.length===0)return;await this.connection.stopReceiving(ht(c).call(c,([,{id:d}])=>d));const u=this.createUnsubscribeMessage(c);return this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&this.statsUploader.stopUploadDownlinkStats(),G(c).call(c,([d,{kind:p}])=>{var f,g;if(p===xe.VIDEO&&d._videoSSRC&&((f=this.connection)===null||f===void 0||f.setStatsRemoteVideoIsReady(d._videoSSRC,!1)),p===xe.VIDEO)this.unbindRemoteTrackEvents(d._videoTrack),(g=d._videoTrack)===null||g===void 0||g._destroy(),d._videoTrack=void 0;else if(p===xe.AUDIO){var E;this.unbindRemoteTrackEvents(d._audioTrack),(E=d._audioTrack)===null||E===void 0||E._destroy(),d._audioTrack=void 0}}),u}async muteRemote(t,e){if(!this.connection)return;st("debug",this,"muteRemote",{uid:t.uid,kind:e});const n=this.remoteUserMap.get(t);if(!n)return N.warning("P2PChannel.unmuteRemote has no remote user ".concat(t.uid,".")),void Lt("warning",this,"P2PChannel.unmuteRemote has no remote user ".concat(t.uid,"."));const o=n.get(e);var c,u;if(!o)return N.warning(M(c="P2PChannel.unmuteRemote has no remote user ".concat(t.uid," media type ")).call(c,e,".")),void Lt("warning",this,M(u="P2PChannel.unmuteRemote has no remote user ".concat(t.uid," media type ")).call(u,e,"."));const d=e===xe.VIDEO?t._videoSSRC:t._audioSSRC;d!==void 0&&this.connection.setStatsRemoteVideoIsReady(d,!1),await this.connection.muteRemote(o)}async unmuteRemote(t,e){if(!this.connection)return;st("debug",this,"unmuteRemote",{uid:t.uid,kind:e});const n=this.remoteUserMap.get(t);if(!n)return N.warning("P2PChannel.unmuteRemote has no remote user ".concat(t.uid,".")),void Lt("warning",this,"unmuteRemote has no remote user ".concat(t.uid));const o=n.get(e);var c,u;if(!o)return N.warning(M(c="P2PChannel.unmuteRemote has no remote user ".concat(t.uid," media type ")).call(c,e,".")),void Lt("warning",this,M(u="unmuteRemote has no remote user ".concat(t.uid," media type ")).call(u,e));await this.connection.unmuteRemote(o)}getAllTracks(t){const e=this.localTrackMap.get(bt.LocalAudioTrack);if((e==null?void 0:e.track)instanceof li){var n,o,c,u,d;const E=e.track;return M(n=ht(o=Ot(c=Ot(u=Ue(Tr(d=this.localTrackMap).call(d))).call(u,([I])=>I!==bt.LocalAudioTrack)).call(c,([I])=>!(t&&I===bt.LocalVideoLowTrack))).call(o,([,{track:I}])=>I)).call(n,E.trackList)}var p,f,g;return ht(p=Ot(f=Ue(Tr(g=this.localTrackMap).call(g))).call(f,([E])=>!(t&&E===bt.LocalVideoLowTrack))).call(p,([,{track:E}])=>E)}reportPublishEvent(t,e,n,o,c){if(t){var u;const f=this.localTrackMap.get(bt.LocalAudioTrack),g=o?this.localTrackMap.get(bt.LocalVideoLowTrack):this.localTrackMap.get(bt.LocalVideoTrack);it.publish(this.store.sessionId,{eventElapse:Vi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:f==null?void 0:f.track.getTrackLabel(),videoName:g==null?void 0:g.track.getTrackLabel(),screenshare:(g==null?void 0:Ft(u=g.track._hints).call(u,dn.SCREEN_TRACK))!==-1,audio:!!f,video:!!g,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var d,p;n||(n=[]);const f=yt(n).call(n,E=>E instanceof lr),g=o?(d=this.localTrackMap.get(bt.LocalVideoTrack))===null||d===void 0?void 0:d.track:yt(n).call(n,E=>E instanceof We);it.publish(this.store.sessionId,{eventElapse:Vi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:f==null?void 0:f.getTrackLabel(),videoName:g==null?void 0:g.getTrackLabel(),screenshare:(g==null?void 0:Ft(p=g._hints).call(p,dn.SCREEN_TRACK))!==-1,audio:!!f,video:!!g,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(t,e,n,o){const c=o===xe.VIDEO?n._videoSSRC:n._audioSSRC;c&&it.subscribe(this.store.sessionId,{succ:t,ec:e,video:o===xe.VIDEO,audio:o===xe.AUDIO,peerid:n.uid,subscribeRequestid:o===xe.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:Vi.measureFromSubscribeStart(this.store.clientId,c)})}reset(){N.debug("P2PChannel.reset"),this.mutex=new Qi("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.state=Ci.Disconnected}getStats(){var t;return(t=this.connection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(t){var e;return((e=this.connection)===null||e===void 0?void 0:e.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(bt.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(bt.LocalVideoTrack);if(t)return{width:t.track._videoWidth||0,height:t.track._videoHeight||0}}getEncoderConfig(t){const e=this.localTrackMap.get(t);return e&&e.track instanceof We||e&&e.track instanceof lr?e.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}async hasRemoteMediaWithLock(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}getRemoteMedia(t){var e,n;const o=yt(e=Ue(va(n=this.remoteUserMap).call(n))).call(e,c=>c.uid===t);return o?{audioTrack:o.audioTrack,audioSSRC:o._audioSSRC,videoTrack:o.videoTrack,videoSSRC:o._videoSSRC}:{}}getAudioLevels(){var t,e;let n=ht(t=Ue(Tr(e=this.remoteUserMap).call(e))).call(t,([c])=>({uid:c.uid,level:c.audioTrack?100*c.audioTrack._source.getAccurateVolumeLevel():0}));const o=this.localTrackMap.get(bt.LocalAudioTrack);return o&&n.push({level:100*o.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),n=rA(n).call(n,(c,u)=>c.level-u.level),n}async disconnectForReconnect(){if(this.connection){var t,e,n,o;st("debug",this,"disconnectForReconnect"),N.debug("P2PChannel.disconnectForReconnect closing P2PConnection"),this.state=Ci.Reconnecting,this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.localTrackMap.size!==0&&(G(t=Ue(Tr(e=this.localTrackMap).call(e))).call(t,([c,{track:u}])=>{var d;switch(c){case bt.LocalVideoTrack:Xt(d=u._hints).call(d,dn.LOW_STREAM)?u.close():this.pendingLocalTracks.push(u);break;case bt.LocalAudioTrack:var p;u instanceof li?this.pendingLocalTracks=M(p=this.pendingLocalTracks).call(p,u.trackList):this.pendingLocalTracks.push(u);break;case bt.LocalVideoLowTrack:}}),this.emit(Re.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&G(n=Ue(Tr(o=this.remoteUserMap).call(o))).call(n,([c,u])=>{var d;G(d=Ue(va(u).call(u))).call(d,p=>{this.setPendingRemoteMedia(c,p)}),this.emit(Re.MediaReconnectStart,c.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),N.debug("P2PChannel disconnected, waiting to reconnect.")}}hasPendingRemoteMedia(t,e){for(const n of this.pendingRemoteTracks){const{user:o,kind:c}=n;if((t instanceof Na?t.uid:t)===o.uid&&e===c)return!0}return!1}setPendingRemoteMedia(t,e){this.hasPendingRemoteMedia(t,e)||this.pendingRemoteTracks.push({user:t,kind:e})}async reEstablish(){if(this.connection)return this.connection.reEstablish()}getUplinkNetworkQuality(){var t,e,n;if(!this.connection)return 0;const o=this.connection.getStats(),c=this.localTrackMap.get(bt.LocalVideoTrack),u=this.localTrackMap.get(bt.LocalAudioTrack),d=yt(t=o.videoSend).call(t,k=>k.ssrc===(c==null?void 0:c.ssrcs[0].ssrcId)),p=yt(e=o.audioSend).call(e,k=>k.ssrc===(u==null?void 0:u.ssrcs[0].ssrcId));if(!d||!p)return 1;const f=ya(this,Re.NeedSignalRTT),g=d?d.rttMs:void 0,E=p?p.rttMs:void 0,I=g&&E?(g+E)/2:g||E,_=(I&&f?(I+f)/2:I||f)||0,T=100*o.sendPacketLossRate*.7/50+.3*_/1500,R=T<.17?1:T<.36?2:T<.59?3:T<.1?4:5,w=c==null?void 0:c.track;if(w&&w._encoderConfig&&Ft(n=w._hints).call(n,dn.SCREEN_TRACK)===-1){const k=w._encoderConfig.bitrateMax,L=o.bitrate.actualEncoded;if(k&&L){const Y=(1e3*k-L)/(1e3*k);return c2[Y<.15?0:Y<.3?1:Y<.45?2:Y<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){var t,e;if(!this.connection)return 0;const n=this.connection.getStats();let o=0;return G(t=Ue(Tr(e=this.remoteUserMap).call(e))).call(t,([c])=>{var u,d;const p=c._audioSSRC,f=c._videoSSRC,g=yt(u=n.audioRecv).call(u,L=>L.ssrc===p),E=yt(d=n.videoRecv).call(d,L=>L.ssrc===f);if(!g&&!E)return void(o+=1);const I=ya(this,Re.NeedSignalRTT),_=n.rtt,T=(_&&I?(_+I)/2:_||I)||0,R=g?g.jitterMs:void 0,w=n.recvPacketLossRate;let k=.7*w*100/50+.3*T/1500;R&&(k=.6*w*100/50+.2*T/1500+.2*R/400),o+=k<.1?1:k<.17?2:k<.36?3:k<.59?4:5}),this.remoteUserMap.size>0?Math.round(o/this.remoteUserMap.size):o}async muteLocalTrack(t){return new ct((e,n)=>{this.handleMuteLocalTrack(t,e,n)})}filterTobePublishedTracks(t,e,n){const o=[],c=Mn(),u=this.getAllTracks();t=x1(t=Ot(t).call(t,f=>Ft(u).call(u,f)===-1));let d=!1,p=!1;for(const f of t){if(f instanceof We&&(this.localTrackMap.has(bt.LocalVideoTrack)||d?new Q(U.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:f,type:bt.LocalVideoTrack}),d=!0),e)){const g=this.getLowVideoTrack(f,n);o.push({track:g,type:bt.LocalVideoLowTrack})}if(f instanceof lr){const g=this.localTrackMap.get(bt.LocalAudioTrack);if(g){if(!(g.track instanceof li))throw new Q(U.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(f._bypassWebAudio)throw new Q(U.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");g.track.addAudioTrack(f),this.bindLocalAudioTrackEvents(f,!0)}else if(p){const E=yt(o).call(o,({type:I})=>I===bt.LocalAudioTrack);if(!(E.track instanceof li))throw new Q(U.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(f._bypassWebAudio)throw new Q(U.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");E.track.addAudioTrack(f)}else{if(!c.webAudioMediaStreamDest||f instanceof li||f._bypassWebAudio)o.push({track:f,type:bt.LocalAudioTrack});else{const E=new li;E.addAudioTrack(f),o.push({track:E,type:bt.LocalAudioTrack})}p=!0}}}return o}filterTobeUnpublishedTracks(t){const e=[],n=this.getAllTracks();t=x1(t=Ot(t).call(t,o=>Ft(n).call(n,o)!==-1));for(const o of t){if(o instanceof lr){const c=this.localTrackMap.get(bt.LocalAudioTrack);if(!c)continue;c.track instanceof li?(c.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),c.track.trackList.length===0&&(e.push([bt.LocalAudioTrack,c]),c.track.close())):e.push([bt.LocalAudioTrack,c])}if(o instanceof We){const c=this.localTrackMap.get(bt.LocalVideoTrack);if(!c)continue;e.push([bt.LocalVideoTrack,c]);const u=this.localTrackMap.get(bt.LocalVideoLowTrack);u&&e.push([bt.LocalVideoLowTrack,u])}}return e}bindLocalTrackEvents(t){G(t).call(t,({track:e,type:n})=>{switch(n){case bt.LocalVideoTrack:e.addListener(Kt.GET_STATS,this.handleGetLocalVideoStats),e.addListener(Kt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Kt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Kt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),e.addListener(Kt.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),e.addListener(Kt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(Kt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Kt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case bt.LocalAudioTrack:this.bindLocalAudioTrackEvents(e);break;case bt.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,e){var n;t instanceof li?G(n=t.trackList).call(n,o=>{o.addListener(Kt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),o.addListener(Kt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),o.addListener(Kt.GET_STATS,this.handleGetLocalAudioStats),o.addListener(Kt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),o.addListener(Kt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(Kt.GET_STATS,this.handleGetLocalAudioStats),t.addListener(Kt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(Kt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(Kt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(Kt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||t.addListener(Kt.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t){var e;t||(t=Ue(Tr(e=this.localTrackMap).call(e))),G(t).call(t,([n,{track:o}])=>{switch(n){case bt.LocalVideoTrack:o.off(Kt.GET_STATS,this.handleGetLocalVideoStats),o.off(Kt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),o.off(Kt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),o.off(Kt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),o.off(Kt.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),o.off(Kt.NEED_REPLACE_TRACK,this.handleReplaceTrack),o.off(Kt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),o.off(Kt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case bt.LocalAudioTrack:this.unbindLocalAudioTrackEvents(o);break;case bt.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){var e;t instanceof li?G(e=t.trackList).call(e,n=>{n.off(Kt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Kt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Kt.GET_STATS,this.handleGetLocalAudioStats),n.off(Kt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Kt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(Kt.GET_STATS,this.handleGetLocalAudioStats),t.off(Kt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Kt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Kt.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(Kt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Kt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,e){e instanceof Fl&&e.addListener(Kt.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(t))}),e instanceof Vl&&e.addListener(Kt.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(Kt.GET_STATS)}unbindAllRemoteTrackEvents(){var t,e;G(t=Ue(Tr(e=this.remoteUserMap).call(e))).call(t,([n,o])=>{o.has(xe.AUDIO)&&this.unbindRemoteTrackEvents(n._audioTrack),o.has(xe.VIDEO)&&this.unbindRemoteTrackEvents(n._videoTrack)})}createGatewayPublishMessage(t,e){return ht(t).call(t,({track:n,type:o},c)=>{var u;let d,p;switch(o){case bt.LocalAudioTrack:d=fr.Audio,p={dtx:n instanceof Ks&&n._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case bt.LocalVideoTrack:d=Xt(u=n._hints).call(u,dn.SCREEN_TRACK)?fr.Screen:fr.High,p=Hd({},O1(n),{codec:this.store.codec});break;case bt.LocalVideoLowTrack:d=fr.Low,p=Hd({},O1(n),{codec:this.store.codec})}return{stream_type:d,attributes:p,ssrcs:e[c]}})}createGatewayUnpublishMessage(t){return ht(t).call(t,([e,{track:n,ssrcs:o,id:c}])=>{var u;let d;switch(e){case bt.LocalVideoTrack:d=Xt(u=n._hints).call(u,dn.SCREEN_TRACK)?fr.Screen:fr.High;break;case bt.LocalAudioTrack:d=fr.Audio;break;case bt.LocalVideoLowTrack:d=fr.Low}return{stream_type:d,ssrcs:o,mid:c}})}assignLocalTracks(t,e){G(t).call(t,({track:n,type:o},c)=>{this.localTrackMap.set(o,{track:n,id:e[c].id,ssrcs:e[c].localSSRC})})}withdrawLocalTracks(t){G(t).call(t,([e])=>{this.localTrackMap.delete(e)})}async waitTillConnected(){return new ct((t,e)=>{switch(this.state){case Ci.New:case Ci.Reconnecting:{const n=(o,c)=>c===Ci.Disconnected?(this.off(Re.StateChange,n),void e(new Q(U.UNEXPECTED_ERROR,"PeerConnection already disconnected."))):c===Ci.Connected?(this.off(Re.StateChange,n),void t(void 0)):void 0;this.on(Re.StateChange,n);break}case Ci.Connected:t(void 0);break;case Ci.Disconnected:e(new Q(U.UNEXPECTED_ERROR,"PeerConnection already disconnected."))}})}bindConnectionEvents(t){t.onConnectionStateChange=async e=>{var n;N.info(M(n="[p2pId: ".concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(")).call(n,e,")")),nr("info",this,"connectionStateChange",e),this.emit(Re.PeerConnectionStateChange,e),e!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),e==="failed"&&(t.iceConnectionState==="failed"?(Vr(()=>this.emit(Re.P2PLost),0),this.iceFailedCount+=1,await pn(Kp(this.iceFailedCount,Cr)),this.emit(Re.RequestRestartICE)):await this.requestReconnect())},t.onICEConnectionStateChange=e=>{var n;N.info(M(n="[p2pId: ".concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(")).call(n,e,")")),nr("info",this,"iceConnectionStateChange",e),it.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:Ut.TRACER}).onSuccess(),this.emit(Re.IceConnectionStateChange,e)},t.onICETransportStateChange=e=>{var n;N.info(M(n="[p2pId: ".concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(")).call(n,e,")")),nr("info",this,"ICETransportStateChange",e)},t.onDTLSTransportStateChange=e=>{var n;N.info(M(n="[p2pId: ".concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(")).call(n,e,")")),nr("info",this,"DTLSTransportStateChange",e)},t.onDTLSTransportError=e=>{var n;N.info(M(n="[p2pId: ".concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(")).call(n,e,")")),nr("info",this,"DTLSTransportError",e)},t.onFirstAudioDecoded=e=>{var n,o;const c=yt(n=Ue(va(o=this.remoteUserMap).call(o))).call(n,d=>d._audioSSRC===e);var u;c&&((u=c.audioTrack)===null||u===void 0||u.emit(vc.FIRST_FRAME_DECODED),it.firstRemoteFrame(this.store.sessionId,ln.FIRST_AUDIO_DECODE,ur.FIRST_AUDIO_DECODE,{peer:c._uintid,subscribeElapse:Vi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=e=>{var n,o;const c=yt(n=Ue(va(o=this.remoteUserMap).call(o))).call(n,u=>u._audioSSRC===e);c&&it.firstRemoteFrame(this.store.sessionId,ln.FIRST_AUDIO_RECEIVED,ur.FIRST_AUDIO_RECEIVED,{peer:c._uintid,subscribeElapse:Vi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(e,n,o)=>{var c,u;const d=yt(c=Ue(va(u=this.remoteUserMap).call(u))).call(c,p=>p._videoSSRC===e);d&&it.firstRemoteFrame(this.store.sessionId,ln.FIRST_VIDEO_DECODE,ur.FIRST_VIDEO_DECODE,{peer:d._uintid,videowidth:n,videoheight:o,subscribeElapse:Vi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onFirstVideoReceived=e=>{var n,o;const c=yt(n=Ue(va(o=this.remoteUserMap).call(o))).call(n,u=>u._videoSSRC===e);c&&it.firstRemoteFrame(this.store.sessionId,ln.FIRST_VIDEO_RECEIVED,ur.FIRST_VIDEO_RECEIVED,{peer:c._uintid,subscribeElapse:Vi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0}filterTobeMutedTracks(t){var e,n;const o=[],c=this.getAllTracks();if(Ft(c).call(c,t)===-1)return o;const u=this.localTrackMap.get(bt.LocalAudioTrack);if(t instanceof lr&&(u==null?void 0:u.track)instanceof li)return u.track.isActive||o.push([bt.LocalAudioTrack,u]),o;const d=yt(e=Ue(Tr(n=this.localTrackMap).call(n))).call(e,([,{track:p}])=>t===p);if(d&&(o.push(d),d[0]===bt.LocalVideoTrack)){const p=this.localTrackMap.get(bt.LocalVideoLowTrack);p&&o.push([bt.LocalVideoLowTrack,p])}return o}filterTobeUnmutedTracks(t){var e,n;const o=[],c=this.localTrackMap.get(bt.LocalAudioTrack);if(t instanceof lr&&(c==null?void 0:c.track)instanceof li)return c.track.isActive&&o.push([bt.LocalAudioTrack,c]),o;const u=yt(e=Ue(Tr(n=this.localTrackMap).call(n))).call(e,([,{track:d}])=>t===d);if(u)if(u[0]===bt.LocalVideoTrack){o.push(u);const d=this.localTrackMap.get(bt.LocalVideoLowTrack);d&&o.push([bt.LocalVideoLowTrack,d])}else o.push(u);return o}createMuteMessage(t){return ht(t).call(t,([e,{track:n,ssrcs:o,id:c}])=>{var u;let d;switch(e){case bt.LocalAudioTrack:d=fr.Audio;break;case bt.LocalVideoTrack:d=Xt(u=n._hints).call(u,dn.SCREEN_TRACK)?fr.Screen:fr.High;break;case bt.LocalVideoLowTrack:d=fr.Low}return{stream_type:d,ssrcs:o,mid:c}})}createUnmuteMessage(t){return ht(t).call(t,([e,{track:n,ssrcs:o,id:c}])=>{var u;let d;switch(e){case bt.LocalAudioTrack:d=fr.Audio;break;case bt.LocalVideoTrack:d=Xt(u=n._hints).call(u,dn.SCREEN_TRACK)?fr.Screen:fr.High;break;case bt.LocalVideoLowTrack:d=fr.Low}return{stream_type:d,ssrcs:o,mid:c}})}filterTobeUnSubscribedTracks(t,e){const n=[],o=this.remoteUserMap.get(t);if(!o)return n;if(e){const u=o.get(e);if(!u)return n;n.push([t,{kind:e,id:u}])}else{var c;G(c=Ue(Tr(o).call(o))).call(c,([u,d])=>{n.push([t,{kind:u,id:d}])})}return n}createUnsubscribeMessage(t){const e=[];return G(t).call(t,([n,{kind:o,id:c}])=>{switch(o){case xe.VIDEO:return void(n._videoSSRC&&e.push({stream_type:xe.VIDEO,ssrcId:n._videoSSRC}));case xe.AUDIO:return void(n._audioSSRC&&e.push({stream_type:xe.AUDIO,ssrcId:n._audioSSRC}))}}),e}withdrawRemoteTracks(t){G(t).call(t,([e,{kind:n}])=>{const o=this.remoteUserMap.get(e);o&&(o.delete(n),Ue(Tr(o).call(o)).length===0&&this.remoteUserMap.delete(e))})}async updateBitrateLimit(t){const e=this.localTrackMap.get(bt.LocalVideoTrack),n=this.localTrackMap.get(bt.LocalVideoLowTrack);e&&await e.track.setBitrateLimit(t.uplink),n&&t.low_stream_uplink&&await n.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(t,e){return ht(t).call(t,({stream_type:n},o)=>{var c;return(c=yt(e).call(e,({stream_type:u})=>n===u))===null||c===void 0?void 0:c.attributes})}async tryToUnmuteAudio(t){for(let n=0;n<t.length;n++)if(t[n]instanceof lr){var e;const o=this.filterTobeUnmutedTracks(t[n]);if(o.length===0)continue;await((e=this.connection)===null||e===void 0?void 0:e.unmuteLocal(ht(o).call(o,([,{id:u}])=>u)));const c=this.createUnmuteMessage(o);return void await Kr(this,Re.RequestUnmuteLocal,c)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>{var t;return Ue(Tr(t=this.localTrackMap).call(t))},this.statsUploader.requestRemoteMedia=()=>{var t;return Ue(Tr(t=this.remoteUserMap).call(t))},this.statsUploader.requestVideoIsReady=t=>{var e;return!((e=this.connection)===null||e===void 0||!e.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,e)=>this.emit(Re.RequestUploadStats,t,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await pn(Kp(this.dtlsFailedCount,Cr)),this.emit(Re.RequestReconnect)}async reconnectP2P(){var t,e;const n=Ue(Tr(t=this.localTrackMap).call(t)),o=this.createGatewayUnpublishMessage(n);Ue(Tr(e=this.remoteUserMap).call(e)),o.length>0&&await ro(this,Re.RequestUnpublishForReconnectPC,o),this.disconnectForReconnect(),this.emit(Re.RequestReconnectPC)}canPublishLowStream(){var t;return this.localTrackMap.has(bt.LocalVideoTrack)||Bi(t=this.pendingLocalTracks).call(t,e=>e instanceof We)}throwIfTrackTypeNotMatch(t){if(Ot(t).call(t,c=>c instanceof We).length>1)throw new Q(U.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(Ot(t).call(t,c=>c instanceof lr).length>1&&(Bi(t).call(t,c=>c instanceof lr&&c._bypassWebAudio)||!Mn().webAudioMediaStreamDest))throw new Q(U.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const c of t){var e,n,o;if(c instanceof We&&Bi(e=this.pendingLocalTracks).call(e,u=>u instanceof We))throw new Q(U.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(c instanceof lr&&Bi(n=this.pendingLocalTracks).call(n,u=>u instanceof lr)&&(!Mn().webAudioMediaStreamDest||c._bypassWebAudio||Bi(o=this.pendingLocalTracks).call(o,u=>u instanceof lr&&u._bypassWebAudio)))throw new Q(U.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,e){const n=Mn().supportDualStreamEncoding,o=Hd({},{width:160,height:120,framerate:15,bitrate:50},{},e);let c;c=n?t._mediaStreamTrack.clone():aO(t,o);const u=new We(c,Hd({},n&&{scaleResolutionDownBy:rb(o,t)},{frameRate:o.framerate,bitrateMax:o.bitrate,bitrateMin:o.bitrate}));return u._hints.push(dn.LOW_STREAM),u}};ji([co,Qe("design:type",Function),Qe("design:paramtypes",[Object]),Qe("design:returntype",ct)],hi.prototype,"startP2PConnection",null),ji([co,Qe("design:type",Function),Qe("design:paramtypes",[Object,Object,Array,Object,String,String]),Qe("design:returntype",ct)],hi.prototype,"connect",null),ji([co,Qe("design:type",Function),Qe("design:paramtypes",[Array]),Qe("design:returntype",ct)],hi.prototype,"unpublish",null),ji([co,Qe("design:type",Function),Qe("design:paramtypes",[]),Qe("design:returntype",ct)],hi.prototype,"unpublishLowStream",null),ji([co,Qe("design:type",Function),Qe("design:paramtypes",[Na,String,Number,Number,Array]),Qe("design:returntype",ct)],hi.prototype,"subscribe",null),ji([co,Qe("design:type",Function),Qe("design:paramtypes",[Na,String]),Qe("design:returntype",ct)],hi.prototype,"unsubscribe",null),ji([co,Qe("design:type",Function),Qe("design:paramtypes",[Na,String]),Qe("design:returntype",ct)],hi.prototype,"muteRemote",null),ji([co,Qe("design:type",Function),Qe("design:paramtypes",[Na,String]),Qe("design:returntype",ct)],hi.prototype,"unmuteRemote",null),ji([co,Qe("design:type",Function),Qe("design:paramtypes",[Na,String]),Qe("design:returntype",ct)],hi.prototype,"hasRemoteMediaWithLock",null),ji([co,Qe("design:type",Function),Qe("design:paramtypes",[]),Qe("design:returntype",ct)],hi.prototype,"disconnectForReconnect",null),ji([co,Qe("design:type",Function),Qe("design:paramtypes",[]),Qe("design:returntype",ct)],hi.prototype,"reEstablish",null),ji([co,Qe("design:type",Function),Qe("design:paramtypes",[Object]),Qe("design:returntype",ct)],hi.prototype,"updateBitrateLimit",null),hi=ji([an("P2PChannel","store.p2pId"),Qe("design:paramtypes",[wc,Ca])],hi);var uO=hi;function co(t,e,n){const o=t[e];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(...c){const u=this.mutex,d=await u.lock("From P2PChannel.".concat(e));try{return await o.apply(this,c)}finally{d()}},n}let Wd;const dO=()=>(Wd||Wd||(Wd=(window.location.protocol.split(":")[0]||"").toUpperCase(),Wd))==="HTTPS",F_=()=>window.isSecureContext!==void 0;class hO{constructor(e,n){var o;this.name=e,this.time=performance.now(),this.sequence=Ft(o=v2[n]).call(o,e)}setElapse(e){this.elapse=e}}const pO=new tr;class AO{constructor(e,n){this.records=[],this._id=e,this._group=n,this._localTimeStamp=kt(),this._performanceTimeStamp=performance.now()}checkPoint(e){var n;const o=new hO(e,this._group);o.sequence===-1&&N.warning("[".concat(this._id,"] check point record failed, cannot get the sequence")),this.records.push(o);const c=yt(n=this.records).call(n,u=>u.sequence===o.sequence-1);c&&o.setElapse(o.time-c.time)}getRecord(e){var n;return yt(n=this.records).call(n,o=>o&&o.name===e)}resetRecords(){this.records.length=0}}function V_(t,e){var n=ue(t);if(_e){var o=_e(t);e&&(o=Ot(o).call(o,function(c){return zt(t,c).enumerable})),n.push.apply(n,o)}return n}function Mf(t){for(var e=1;e<arguments.length;e++){var n,o=arguments[e]!=null?arguments[e]:{};if(e%2)G(n=V_(Object(o),!0)).call(n,function(u){qr(t,u,o[u])});else if(Ce)dr(t,Ce(o));else{var c;G(c=V_(Object(o))).call(c,function(u){te(t,u,zt(o,u))})}}return t}var Oa=function(t,e,n,o){var c,u=arguments.length,d=u<3?e:o===null?o=zt(e,n):o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(t,e,n,o);else for(var p=t.length-1;p>=0;p--)(c=t[p])&&(d=(u<3?c(d):u>3?c(e,n,d):c(e,n))||d);return u>3&&d&&te(e,n,d),d},fn=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};let Es=class extends Gr{constructor(t){var e,n,o,c;let u;if(super(),this._users=[],this._sessionId=null,this._leaveMutex=new Qi("client-leave"),this._publishMutex=new Qi("client-publish"),this._renewTokenMutex=new Qi("client-renewtoken"),this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._turnServer={servers:[],mode:"auto"},this._cloudProxyServerMode="disabled",this._isDualStreamEnabled=!1,this._streamFallbackTypeCacheMap=new tr,this._remoteStreamTypeCacheMap=new tr,this._axiosCancelSource=yo.CancelToken.source(),this._networkQualitySensitivity="normal",this._useLocalAccessPoint=!1,this._joinAndNotLeaveYet=!1,this._numberOfJoinCount=0,this._remoteDefaultVideoStreamType=void 0,this._handleLocalTrackEnable=(p,f,g)=>{this.publish(p,!1).then(f).catch(g)},this._handleLocalTrackDisable=(p,f,g)=>{this.unpublish(p).then(f).catch(g)},this._handleUserOnline=p=>{var f;this.isStringUID&&typeof p.uid!="string"&&(N.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID")),Lt("error",this,"StringUID is Mixed with UintUID"));const g=yt(f=this._users).call(f,E=>E.uid===p.uid);if(g)g._trust_in_room_=!0;else{const E=new Na(p.uid,p.uint_id||p.uid);this._users.push(E),N.debug("[".concat(this._clientId,"] user online"),p.uid),zi("info",this,"user-joined",{uid:p.uid}),this.emit(Ie.USER_JOINED,E)}},this._handleUserOffline=p=>{var f;const g=yt(f=this._users).call(f,E=>E.uid===p.uid);g&&(this._handleRemoveStream(p),MA(this._users,g),this._remoteStreamTypeCacheMap.delete(g.uid),this._streamFallbackTypeCacheMap.delete(g.uid),N.debug("[".concat(this._clientId,"] user offline"),p.uid,"reason:",p.reason),zi("info",this,"user-left",{reason:p.reason,uid:p.uid}),this.emit(Ie.USER_LEAVED,g,p.reason))},this._handleAddAudioOrVideoStream=(p,f,g,E,I,_,T)=>{var R,w,k;const L=yt(R=this._users).call(R,At=>At.uid===f);if(!L)return N.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)")),void nr("error",["AgoraRTCGateway",this._clientId],"add_".concat(p,"_stream"),"can not find target user!");N.debug(M(w=M(k="[".concat(this._clientId,"] stream added with uid ")).call(k,f,", type ")).call(w,p)),nr("debug",["AgoraRTCGateway",this._clientId],"add_".concat(p,"_stream"),{uid:f,mediaType:p});const Y=p==="audio"?L.hasAudio:L.hasVideo;var Z,rt,ut;L._uintid||(L._uintid=I||f),L._trust_stream_added_state_=!0,p==="audio"?(L._audio_added_=!0,g!==void 0&&(L._audioSSRC=g),E!==void 0&&(L._cname=E),_&&(L._audioOrtc=_)):(L._video_added_=!0,g!==void 0&&(L._videoSSRC=g),E!==void 0&&(L._cname=E),T!==void 0&&(L._rtxSsrcId=T),_&&(L._videoOrtc=_)),(p==="audio"?L.hasAudio:L.hasVideo)&&!Y&&(N.info(M(Z=M(rt="[".concat(this._clientId,"] remote user ")).call(rt,L.uid," published ")).call(Z,p)),Lt("info",this,M(ut="remote user ".concat(L.uid," published ")).call(ut,p)),zi("info",this,"user-published",{uid:L.uid,mediaType:p}),this.emit(Ie.USER_PUBLISHED,L,p)),p==="video"?it.onGatewayStream(this._sessionId,ln.ON_ADD_VIDEO_STREAM,ur.ON_ADD_VIDEO_STREAM,{peer:I||f}):it.onGatewayStream(this._sessionId,ln.ON_ADD_AUDIO_STREAM,ur.ON_ADD_AUDIO_STREAM,{peer:I||f}),this._p2pChannel.hasPendingRemoteMedia(L,p)&&this.subscribe(L,p).catch(At=>{N.error("[".concat(this._clientId,"] resubscribe error"),At.toString()),Lt("error",this,"resubscribe error: ".concat(At.toString()))})},this._handleRemoveStream=async p=>{var f,g;const E=yt(f=this._users).call(f,T=>T.uid===p.uid);if(!E)return N.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)")),void nr("warning",["AgoraRTCGateway",this._clientId],"remove_stream",{uid:p.uid,info:"can not find target user!"});N.debug(M(g="[".concat(this._clientId,"] stream removed with uid ")).call(g,p.uid)),nr("debug",["AgoraRTCGateway",this._clientId],"remove_stream",{uid:p.uid});let I=()=>{};E.hasAudio&&E.hasVideo?I=()=>{var T,R;N.info(M(T="[".concat(this._clientId,"] remote user ")).call(T,E.uid," unpublished audio track")),zi("info",this,"user-unpublished",{uid:E.uid,mediaType:"audio"}),this.emit(Ie.USER_UNPUBLISHED,E,"audio"),N.info(M(R="[".concat(this._clientId,"] remote user ")).call(R,E.uid," unpublished video track")),zi("info",this,"user-unpublished",{uid:E.uid,mediaType:"video"}),this.emit(Ie.USER_UNPUBLISHED,E,"video")}:E.hasVideo?I=()=>{var T;N.info(M(T="[".concat(this._clientId,"] remote user ")).call(T,E.uid," unpublished video track")),zi("info",this,"user-unpublished",{uid:E.uid,mediaType:"video"}),this.emit(Ie.USER_UNPUBLISHED,E,"video")}:E.hasAudio&&(I=()=>{var T;N.info(M(T="[".concat(this._clientId,"] remote user ")).call(T,E.uid," unpublished audio track")),zi("info",this,"user-unpublished",{uid:E.uid,mediaType:"audio"}),this.emit(Ie.USER_UNPUBLISHED,E,"audio")}),E._trust_stream_added_state_=!0,E._audio_added_=!1,E._video_added_=!1;const _=await this._p2pChannel.unsubscribe(E);_&&await this._gateway.unsubscribe(_,E.uid),E._audioSSRC=void 0,E._videoSSRC=void 0,E._audioOrtc=void 0,E._videoOrtc=void 0,E._rtxSsrcId=void 0,it.onGatewayStream(this._sessionId,ln.ON_REMOVE_STREAM,ur.ON_REMOVE_STREAM,{peer:p.uint_id||p.uid}),I()},this._handleSetStreamLocalEnable=async(p,f,g)=>{var E,I,_,T,R,w;const k=yt(E=this._users).call(E,Qt=>Qt.uid===f);if(!k)return N.error("[".concat(this._clientId,"] can not find target user!(disable_local)")),void nr("error",this,"disable_local_video","can not find target user!(disable_local)");N.debug(M(I=M(_=M(T="[".concat(this._clientId,"] local ")).call(T,p," ")).call(_,g?"enabled":"disabled"," with uid ")).call(I,f)),nr("debug",this,"disable_local_video",M(R=M(w="local ".concat(p," ")).call(w,g?"enabled":"disabled"," with uid ")).call(R,f));const L=p==="audio"?k.hasAudio:k.hasVideo;if(p==="audio"){k._trust_audio_enabled_state_=!0;const Qt=k._audio_enabled_;if(k._audio_enabled_=g,k._audio_enabled_===Qt)return;{var Y,Z;const xt=k._audio_enabled_?"enable-local-audio":"disable-local-audio";N.debug(M(Y=M(Z="[".concat(this._clientId,"] user-info-updated, uid: ")).call(Z,f,", msg: ")).call(Y,xt)),Wt("debug",this,"user-info-updated",{uid:f,msg:xt}),this.emit(Ie.USER_INFO_UPDATED,f,xt)}}else{k._trust_video_enabled_state_=!0;const Qt=k._video_enabled_;if(k._video_enabled_=g,k._video_enabled_===Qt)return;{var rt,ut;const xt=k._video_enabled_?"enable-local-video":"disable-local-video";N.debug(M(rt=M(ut="[".concat(this._clientId,"] user-info-update, uid: ")).call(ut,f,", msg: ")).call(rt,xt)),Wt("debug",this,"user-info-updated",{uid:f,msg:xt}),this.emit(Ie.USER_INFO_UPDATED,f,xt)}}const At=p==="audio"?k.hasAudio:k.hasVideo;var Ct,lt,Gt,wt;return L!==At?!L&&At?(N.info(M(Ct=M(lt="[".concat(this._clientId,"] remote user ")).call(lt,f," published ")).call(Ct,p)),zi("info",this,"user-published",{uid:f,mediaType:p}),void this.emit(Ie.USER_PUBLISHED,k,p)):(p==="video"&&k._videoTrack&&k._videoTrack._destroy(),p==="audio"&&k._audioTrack,await this._p2pChannel.muteRemote(k,p),N.info(M(Gt=M(wt="[".concat(this._clientId,"] remote user ")).call(wt,f," unpublished ")).call(Gt,p)),zi("info",this,"user-unpublished",{uid:f,mediaType:p}),void this.emit(Ie.USER_UNPUBLISHED,k,p)):void 0},this._handleMuteStream=async(p,f,g)=>{var E;N.debug("[".concat(this._clientId,"] receive mute message"),p,f,g),nr("debug",this,"mute_".concat(f),g);const I=yt(E=this._users).call(E,Ct=>Ct.uid===p);var _;if(!I)return N.warning(M(_="[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ")).call(_,p)),void nr("warning",this,"mute_".concat(f),"can not find remote user, ignore mute event, uid: ".concat(p));const T=f==="audio"?I.hasAudio:I.hasVideo;if(f==="audio"){I._trust_audio_mute_state_=!0;const Ct=I._audio_muted_;if(I._audio_muted_=g,I._audio_muted_===Ct)return;{var R,w;const lt=I._audio_muted_?"mute-audio":"unmute-audio";N.debug(M(R=M(w="[".concat(this._clientId,"] user-info-update, uid: ")).call(w,p,", msg: ")).call(R,lt)),Wt("debug",this,"user-info-updated",{uid:p,msg:lt}),this.emit(Ie.USER_INFO_UPDATED,p,lt)}}else{I._trust_video_mute_state_=!0;const Ct=I._video_muted_;if(I._video_muted_=g,I._video_muted_===Ct)return;{var k,L;const lt=I._video_muted_?"mute-video":"unmute-video";N.debug(M(k=M(L="[".concat(this._clientId,"] user-info-update, uid: ")).call(L,p,", msg: ")).call(k,lt)),Wt("debug",this,"user-info-updated",{uid:p,msg:lt}),this.emit(Ie.USER_INFO_UPDATED,p,lt)}}const Y=f==="audio"?I.hasAudio:I.hasVideo;var Z,rt,ut,At;return T!==Y?!T&&Y?(N.info(M(Z=M(rt="[".concat(this._clientId,"] remote user ")).call(rt,p," published ")).call(Z,f)),zi("info",this,"user-published",{uid:I.uid,mediaType:f}),void this.emit(Ie.USER_PUBLISHED,I,f)):(f==="video"&&I._videoTrack&&I._videoTrack._destroy(),f==="audio"&&I._audioTrack,await this._p2pChannel.muteRemote(I,f),N.info(M(ut=M(At="[".concat(this._clientId,"] remote user ")).call(At,p," unpublished ")).call(ut,f)),zi("info",this,"user-unpublished",{uid:p,mediaType:f}),void this.emit(Ie.USER_UNPUBLISHED,I,f)):void 0},this._handleP2PLost=async p=>{if(N.debug("[".concat(this._clientId,"] receive p2p lost"),p),nr("debug",this,"p2p_lost",p),rr(p.p2pid,10)!==this.store.p2pId)return N.warning("P2PLost stream not found",p),void nr("warning",this,"p2p_lost","P2PLost stream not found, ".concat(p));await this._p2pChannel.requestReconnect()},this._handleTokenWillExpire=()=>{N.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),nr("debug",this,"token_privilege_will_expire"),this.emit(Ie.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)},this._handleBeforeUnload=p=>{p.type==="beforeunload"&&p.returnValue!==void 0&&p.returnValue!==""||(this.leave(),N.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")),ls("info",["window",this.store.clientId],Ei()?"beforeunload":"pagehide"))},this._handleUpdateNetworkQuality=()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.emit(Ie.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const p={downlinkNetworkQuality:0,uplinkNetworkQuality:0};p.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),p.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.emit(Ie.NETWORK_QUALITY,p)},this._codec=t.codec,this._mode=t.mode,this._clientId=gr(5,"client-"),this.store=new wc(t.codec,t.audioCodec,t.mode,this._clientId),this.store.clientCreated(),t.proxyServer&&this.setProxyServer(t.proxyServer,!0),t.turnServer&&this.setTurnServer(t.turnServer,!0),N.info(M(e=M(n=M(o=M(c="[".concat(this._clientId,"] Initializing AgoraRTC client v")).call(c,Yn," build: ")).call(o,ad,", mode: ")).call(n,this._mode,", codec: ")).call(e,this._codec)),Wt("info",this,"constructor",{version:Yn,build:ad,mode:this._mode,codec:this._codec}),this._performanceRecorder=function(p,f){const g=new AO(p,f);return pO.set(p,g),g}(this._clientId,"join"),t.clientRoleOptions)try{PI(t.clientRoleOptions),u=Ir({},t.clientRoleOptions)}catch(p){var d;N.warning(M(d="[".concat(this._clientId,"] ")).call(d,p.toString())),Lt("warning",this,p.toString())}this._statsCollector=new Ca(this.store),this._statsCollector.onStatsException=(p,f,g)=>{var E,I,_;N.debug(M(E=M(I=M(_="[".concat(this._clientId,"] receive exception msg, code: ")).call(_,p,", msg: ")).call(I,f,", uid: ")).call(E,g)),zi("debug",this,Ie.EXCEPTION,{code:p,message:f,uid:g}),this.emit(Ie.EXCEPTION,{code:p,msg:f,uid:g})},this._statsCollector.onUploadPublishDuration=(p,f,g,E)=>{var I;const _=yt(I=this._users).call(I,T=>T.uid===p);_&&it.peerPublishStatus(this._sessionId,{subscribeElapse:E,audioPublishDuration:f,videoPublishDuration:g,peer:_._uintid})},this._gateway=new Af(this.store,{clientId:this._clientId,mode:this._mode,codec:this._codec,websocketRetryConfig:t.websocketRetryConfig||Cr,httpRetryConfig:t.httpRetryConfig||Cr,forceWaitGatewayResponse:t.forceWaitGatewayResponse===void 0||t.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:t.role,clientRoleOptions:u}),this._config=t,this._configDistribute=new vf,this._p2pChannel=new uO(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents()}get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}async join(t,e,n,o,c){var u,d;const p=++this._numberOfJoinCount;this._performanceRecorder.checkPoint("startJoin"),this.store.joinStart();const f=dO(),g=F_()?window.isSecureContext:"Browser Not Support";if(!F_()&&!f||!window.isSecureContext){const rt="The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser";N.warning(rt),st("warning",this,rt)}const E=it.reportApiInvoke(this._sessionId,{name:Vt.JOIN,options:[t,e,n,o],states:{isHttps:f,isSecureContext:g},tag:Ut.TRACER});try{if(!n&&n!==null)throw new Q(U.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&_n(n,"token",1,2047),_n(t,"appid",1,2047),iA(e),o&&oA(o),c&&_n(c,"optionalInfo",1,2047)}catch(rt){throw E.onError(rt),rt}if(N.info(M(u=M(d="[".concat(this._clientId,"] start join channel ")).call(d,e,", join number: ")).call(u,p)),Wt("info",this,"join",{channel:e}),this._leaveMutex.isLocked&&(N.debug("[".concat(this._clientId,"] join: waiting leave operation")),Lt("debug",this,"join: waiting leave operation"),(await this._leaveMutex.lock())(),N.debug("[".concat(this._clientId,"] join: continue")),Lt("debug",this,"join: continue")),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const rt=new Q(U.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw E.onError(rt),rt}this._sessionId||(this._sessionId=M1(),this.store.sessionId=this._sessionId),this._gateway.state="CONNECTING";const I=Mf({clientId:this._clientId,appId:t,sid:this._sessionId,cname:e,uid:typeof o!="string"?o:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:c,useLocalAccessPoint:this._useLocalAccessPoint},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType});if(typeof o=="string"&&(I.stringUid=o,this._uintUid?(I.uid=this._uintUid,this._uintUid=void 0):I.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(I.aesmode=this._encryptionMode,I.aespassword=await(async rt=>{const ut=PA(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),At=await window.crypto.subtle.importKey("spki",ut,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),Ct=R1(rt),lt=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},At,Ct);return Sd(new Uint8Array(lt))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new Q(U.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(I.aessalt=this._encryptionSalt)}this._startSession(this._sessionId,{channel:e,appId:t});const _=this._sessionId;Vr(()=>{this.connectionState==="CONNECTING"&&_===this._sessionId&&it.joinChannelTimeout(this._sessionId,5)},5e3);try{var T;let rt;if(I.cloudProxyServer==="443only")I.proxyServer=ot("PROXY_SERVER_TYPE2");else if(I.cloudProxyServer==="proxy3"||I.cloudProxyServer==="proxy4"||I.cloudProxyServer==="proxy5"){const At=ot("PROXY_SERVER_TYPE3");sn(At)?I.proxyServer=At[0]:I.proxyServer=At}if(it.setProxyServer(I.proxyServer),N.setProxyServer(I.proxyServer),pc(I.proxyServer),this._performanceRecorder.checkPoint("startRequestAp"),this.store.requestAPStart(),I.stringUid&&!I.uid&&I.cloudProxyServer==="normal"){var R,w;await mf(I,this._axiosCancelSource.token,this._config.httpRetryConfig||Cr,!1);const At=await Ef(I.stringUid,I,this._axiosCancelSource.token,this._config.httpRetryConfig||Cr);N.debug(M(R="getUserAccount Success ".concat(I.stringUid," => ")).call(R,At)),Lt("debug",this,M(w="getUserAccount Success ".concat(I.stringUid," => ")).call(w,At)),I.uid=At,rt=await Ll(I,this._axiosCancelSource.token,this._config.httpRetryConfig||Cr)}else if(I.stringUid&&!I.uid){var k,L;const At=await Ef(I.stringUid,I,this._axiosCancelSource.token,this._config.httpRetryConfig||Cr);N.debug(M(k="getUserAccount Success ".concat(I.stringUid," => ")).call(k,At)),Lt("debug",this,M(L="getUserAccount Success ".concat(I.stringUid," => ")).call(L,At)),I.uid=At,rt=await mf(I,this._axiosCancelSource.token,this._config.httpRetryConfig||Cr,!0)}else rt=await mf(I,this._axiosCancelSource.token,this._config.httpRetryConfig||Cr,!0);if(!this._joinAndNotLeaveYet)throw new Q(U.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this.store.requestAPEnd(),this._performanceRecorder.checkPoint("startJoinGateway"),Vr(()=>{this._configDistribute.startGetConfigDistribute(I,this._axiosCancelSource.token),this._configDistribute.on(El.UPDATE_BITRATE_LIMIT,At=>{this._p2pChannel.updateBitrateLimit(At)})},0),this._key=n||t,this._joinInfo=Mf({},I,{cid:rt.gatewayInfo.cid,uid:I.uid?I.uid:rt.gatewayInfo.uid,vid:rt.gatewayInfo.vid,apResponse:rt.gatewayInfo.res,uni_lbs_ip:rt.gatewayInfo.uni_lbs_ip,gatewayAddrs:rt.gatewayInfo.gatewayAddrs});const ut=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new Q(U.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));return E.onSuccess(ut),this._appId=t,this._channelName=I.cname,this._uid=ut,this.store.uid=ut,Vr(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Ei()?"beforeunload":"pagehide",this._handleBeforeUnload)},0),N.info(M(T="[".concat(this._clientId,"] Joining channel success: ")).call(T,e)),Wt("info",this,"join",e,"success"),Vr(()=>{ot("USE_NEW_LOG")?sd():N.startUpload()},5e3),this._performanceRecorder.checkPoint("finishJoin"),this.store.joinEnd(),Z=this,Xt(us).call(us,Z)||us.push(Z),ut}catch(rt){var Y;const ut=sn(rt)?rt[0]:rt;throw N.error(M(Y="[".concat(this._clientId,"] join number: ")).call(Y,p,", Joining channel failed, rollback"),ut),Wt("error",this,"join",e,ut.toString()),ut.code!==U.OPERATION_ABORTED&&this._numberOfJoinCount===p&&(this._gateway.state="DISCONNECTED",this._reset()),E.onError(ut),ut}var Z}_joinGateway(){if(!this._joinInfo||!this._key)throw new Q(U.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||!ot("JOIN_WITH_FALLBACK_SIGNAL_PROXY"))).then(t=>t).catch(t=>{if(t.code===U.INIT_WEBSOCKET_TIMEOUT)return this._gateway.leave(!0,un.FALLBACK);throw t}).then(t=>{if(t)return t;if(N.info("[".concat(this._clientId,"] join timeout, fallback to proxy")),!this._joinInfo||!this._key)throw new Q(U.INVALID_OPERATION);this._joinInfo.cloudProxyServer="fallback",this._cloudProxyServerMode="fallback";const e=ot("PROXY_SERVER_TYPE3");if(sn(e))if(this._joinInfo.apUrl){const n=new bC(this._joinInfo.apUrl).host.split("."),o=Mr(n).call(n,n.length-2).join(".");G(e).call(e,c=>{this._joinInfo&&Xt(c).call(c,o)&&(this._joinInfo.proxyServer=c)}),this._joinInfo.proxyServer||(this._joinInfo.proxyServer=e[0])}else this._joinInfo.proxyServer=e[0];else this._joinInfo.proxyServer=e;return it.reportApiInvoke(this._sessionId,{name:Vt.JOIN_FALLBACK_TO_PROXY,options:[this._joinInfo.proxyServer],tag:Ut.TRACER}).onSuccess(),this.emit(Ie.JOIN_FALLBACK_TO_PROXY,this._joinInfo.proxyServer),this._gateway.join(this._joinInfo,this._key)}).then(t=>t)}async leave(){const t=it.reportApiInvoke(this._sessionId,{name:Vt.LEAVE,options:[],tag:Ut.TRACER});N.info("[".concat(this._clientId,"] Leaving channel")),Wt("info",this,"leave"),window.removeEventListener(Ei()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(n){const o=Ft(us).call(us,n);o!==-1&&Ze(us).call(us,o,1)}(this);const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return N.info("[".concat(this._clientId,"] Leaving channel repeated, success")),e(),t.onSuccess();await this._gateway.leave(this.connectionState!=="CONNECTED"),N.info("[".concat(this._clientId,"] Leaving channel success")),Wt("info",this,"leave",void 0,"success"),this._joinAndNotLeaveYet=!1,e(),t.onSuccess()}async publish(t,e=!0){var n;sn(t)||(t=[t]);const o=it.reportApiInvoke(this._sessionId,{name:Vt.PUBLISH,options:ht(t).call(t,d=>d?Object(d).toString():"null"),tag:Ut.TRACER});if(t.length===0){const d=new Q(U.INVALID_PARAMS,"track list is empty");return o.onError(d),d.throw()}if(this._gateway.role==="audience"){const d=new Q(U.INVALID_OPERATION,"audience can not publish stream");return o.onError(d),d.throw()}for(const d of t){if(!(d instanceof As)){const p=new Q(U.INVALID_PARAMS,"parameter is not local track");return o.onError(p),p.throw()}if(!d._enabled&&e){const p=new Q(U.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(d.getTrackId()));return o.onError(p),p.throw()}}N.info(M(n="[".concat(this._clientId,"] Publishing tracks, id ")).call(n,ht(t).call(t,d=>"".concat(d.getTrackId()," ")))),Wt("info",this,"publish",ht(t).call(t,d=>"".concat(d.getTrackId()))),await this._configDistribute.awaitConfigDistributeComplete(),e&&G(t).call(t,d=>{const p=this._configDistribute.getBitrateLimit();d instanceof We&&p&&d.setBitrateLimit(p.uplink)});const c=await this._publishMutex.lock();try{var u;await this._publishHighStream(t),o.onSuccess(ht(t).call(t,d=>d.trackMediaType+":"+d.getTrackLabel()).toString()),N.info(M(u="[".concat(this._clientId,"] Publish success, id ")).call(u,ht(t).call(t,d=>"".concat(d.getTrackId()," ")))),Wt("info",this,"publish",ht(t).call(t,d=>"".concat(d.getTrackId())),"success")}catch(d){throw o.onError(d),N.error("[".concat(this._clientId,"] publish error"),d.toString()),Wt("error",this,"publish",void 0,d.toString()),d}finally{c()}}async unpublish(t){var e;if(!this._joinInfo||this._uid===void 0)throw new Q(U.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");t?sn(t)||(t=[t]):t=this._p2pChannel.getAllTracks();const n=it.reportApiInvoke(this._sessionId,{name:Vt.UNPUBLISH,options:ht(t).call(t,u=>u.getTrackId()),tag:Ut.TRACER});N.info(M(e="[".concat(this._clientId,"] Unpublish tracks, tracks ")).call(e,ht(t).call(t,u=>"".concat(u.getTrackId()," "))," ")),Wt("info",this,"unpublish",ht(t).call(t,u=>"".concat(u.getTrackId())));const o=await this._publishMutex.lock();try{var c;const u=await this._p2pChannel.unpublish(t);u&&await this._gateway.unpublish(u,this._uid),N.info(M(c="[".concat(this._clientId,"] Unpublish success,tracks ")).call(c,ht(t).call(t,d=>"".concat(d.getTrackId())))),Wt("info",this,"unpublish",ht(t).call(t,d=>"".concat(d.getTrackId())),"success"),n.onSuccess()}catch(u){throw n.onError(u),N.error("[".concat(this._clientId,"] unpublish error"),u.toString()),Wt("error",this,"unpublish",void 0,u.toString()),u}finally{o&&o()}}async subscribe(t,e){var n,o,c;Cn(e,"mediaType",["audio","video"]);const u=it.reportApiInvoke(this._sessionId,{name:Vt.SUBSCRIBE,options:[t.uid,e],tag:Ut.TRACER});if(!this._joinInfo){const L=new Q(U.INVALID_OPERATION,"Can't subscribe stream, not joined");throw u.onError(L),L}if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING"){const L=new Q(U.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));throw u.onError(L),L}if(!yt(n=this._users).call(n,L=>L===t)){var d;const L=new Q(U.INVALID_REMOTE_USER,"user is not in the channel");throw N.error(M(d="[".concat(this._clientId,"] can not subscribe ")).call(d,t.uid,", this user is not in the channel")),Wt("error",this,"subscribe",t.uid,"this user is not in the channel"),u.onError(L),L}if(!t.hasAudio&&!t.hasVideo){var p;const L=new Q(U.INVALID_REMOTE_USER,"user is not published");throw N.error(M(p="[".concat(this._clientId,"] can not subscribe ")).call(p,t.uid,", user is not published")),Wt("error",this,"subscribe",t.uid,"this user is not published"),u.onError(L),L}if(e==="audio"&&(!t.hasAudio||t._audioSSRC===void 0)||e==="video"&&(!t.hasVideo||t._videoSSRC===void 0)){var f,g;const L=new Q(U.REMOTE_USER_IS_NOT_PUBLISHED);throw N.error(M(f=M(g="[".concat(this._clientId,"] can not subscribe ")).call(g,t.uid," with mediaType ")).call(f,e,", remote track is not published")),Wt("error",this,"subscribe",t.uid,"mediaType ".concat(e,", remote track is not published")),u.onError(L),L}const E=e==="audio"?t._audioSSRC:t._videoSSRC,I=e==="audio"?t._audioOrtc:t._videoOrtc,_=e==="video"?t._rtxSsrcId:void 0,T={stream_type:e==="audio"?xe.AUDIO:xe.VIDEO,ssrcId:E};N.info(M(o=M(c="[".concat(this._clientId,"] subscribe user ")).call(c,t.uid,", mediaType: ")).call(o,e)),Wt("info",this,"subscribe",{uid:t.uid,mediaType:e});try{var R,w;if(await this._p2pChannel.hasRemoteMediaWithLock(t,e))await this._p2pChannel.unmuteRemote(t,e);else try{Vi.markSubscribeStart(this.store.clientId,E),this.store.subscribe(t.uid,e,performance.now()),await this._p2pChannel.subscribe(t,e,E,_,I),await this._gateway.subscribe(t.uid,T,!0),this.store.subscribe(t.uid,e,void 0,performance.now()),this._p2pChannel.reportSubscribeEvent(!0,null,t,e)}catch(Y){if(this._p2pChannel.reportSubscribeEvent(!1,Y==null?void 0:Y.code,t,e),(Y==null?void 0:Y.code)!==U.WS_ABORT)throw Y;this._p2pChannel.setPendingRemoteMedia(t,e)}N.info(M(R=M(w="[".concat(this._clientId,"] subscribe success user ")).call(w,t.uid,", mediaType: ")).call(R,e)),Wt("info",this,"subscribe",{uid:t.uid,mediaType:e},"success"),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(Y=>{N.warning("[".concat(this._clientId,"] auto set fallback failed"),Y),Lt("warning",this,"auto set fallback failed, ".concat(Y.toString()))});const L=e==="audio"?t._audioTrack:t._videoTrack;if(!L){const Y=new Q(U.UNEXPECTED_ERROR,"can not find remote track in user object");return u.onError(Y),Y.throw()}return u.onSuccess(L.getTrackId()),L}catch(L){var k;throw u.onError(L),N.error(M(k="[".concat(this._clientId,"] subscribe user ")).call(k,t.uid," error"),L),Wt("error",this,"subscribe",{uid:t.uid,mediaType:e},L.toString()),L}}async unsubscribe(t,e){var n,o,c;if(e&&Cn(e,"mediaType",["audio","video"]),!this._joinInfo)throw new Q(U.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");const u=it.reportApiInvoke(this._sessionId,{name:Vt.UNSUBSCRIBE,options:[t.uid,e],tag:Ut.TRACER});if(!yt(n=this._users).call(n,E=>E===t)){var d;const E=new Q(U.INVALID_REMOTE_USER,"user is not in the channel");throw N.error(M(d="[".concat(this._clientId,"] can not subscribe ")).call(d,t.uid,", user is not in the channel")),Wt("error",this,"unsubscribe",{uid:t.uid,mediaType:e},"user is not in the channel"),u.onError(E),E}N.info(M(o=M(c="[".concat(this._clientId,"] unsubscribe uid: ")).call(c,t.uid,", mediaType: ")).call(o,e)),Wt("info",this,"unsubscribe",{uid:t.uid,mediaType:e});try{var p,f;const E=await this._p2pChannel.unsubscribe(t,e);E&&await this._gateway.unsubscribe(E,t.uid),N.info(M(p=M(f="[".concat(this._clientId,"] unsubscribe success uid: ")).call(f,t.uid,", mediaType: ")).call(p,e)),Wt("info",this,"unsubscribe",{uid:t.uid,mediaType:e},"success"),u.onSuccess()}catch(E){if(E.code===U.DISCONNECT_P2P)return void N.warning("disconnecting p2p, abort unsubscribe request.");var g;throw N.error(M(g="[".concat(this._clientId,"] unsubscribe user ")).call(g,t.uid," error"),E.toString()),Wt("error",this,"unsubscribe",{uid:t.uid,mediaType:e},E.toString()),E}}setLowStreamParameter(t){(function(o){if(!o)throw new Q(U.INVALID_PARAMS);ze(o.width)||He(o.width,"streamParameter.width"),ze(o.height)||He(o.height,"streamParameter.height"),ze(o.framerate)||He(o.framerate,"streamParameter.framerate"),ze(o.bitrate)||He(o.bitrate,"streamParameter.bitrate")})(t);const e=it.reportApiInvoke(this._sessionId,{name:Vt.SET_LOW_STREAM_PARAMETER,options:[t],tag:Ut.TRACER});(!t.width&&t.height||t.width&&!t.height)&&(N.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),Lt("warning",this,"The width and height parameters take effect only when both are set")),N.info("[".concat(this._clientId,"] set low stream parameter to"),at(t)),Wt("info",this,"setLowStreamParameter",t);const n=this._configDistribute.getLowStreamConfigDistribute();n&&n.bitrate&&t.bitrate&&n.bitrate<t.bitrate&&(t.bitrate=n.bitrate),this._lowStreamParameter=t,e.onSuccess()}async enableDualStream(){const t=it.reportApiInvoke(this._sessionId,{name:Vt.ENABLE_DUAL_STREAM,options:[],tag:Ut.TRACER});if(!Mn().supportDualStream){it.streamSwitch(this._sessionId,{lts:kt(),isdual:!0,succ:!1});const e=new Q(U.NOT_SUPPORTED,"Your browser is not support dual stream");throw t.onError(e),e}if(this._isDualStreamEnabled){const e=new Q(U.INVALID_OPERATION,"Dual stream is already enabled");throw t.onError(e),e}if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw it.streamSwitch(this._sessionId,{lts:kt(),isdual:!0,succ:!1}),t.onError(e),e}this._isDualStreamEnabled=!0,it.streamSwitch(this._sessionId,{lts:kt(),isdual:!0,succ:!0}),N.info("[".concat(this._clientId,"] enable dual stream")),Wt("info",this,"enableDualStream"),t.onSuccess()}async disableDualStream(){if(!this._isDualStreamEnabled)return;if(!this._joinInfo)throw new Q(U.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");const t=it.reportApiInvoke(this._sessionId,{name:Vt.DISABLE_DUAL_STREAM,options:[],tag:Ut.TRACER});if(this._p2pChannel.getLocalMedia(bt.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw it.streamSwitch(this._sessionId,{lts:kt(),isdual:!1,succ:!1}),t.onError(e),e}this._isDualStreamEnabled=!1,it.streamSwitch(this._sessionId,{lts:kt(),isdual:!1,succ:!0}),N.info("[".concat(this._clientId,"] disable dual stream")),Wt("info",this,"disableDualStream"),t.onSuccess()}async setClientRole(t,e){(function(u){Cn(u,"role",["audience","host"])})(t),e&&PI(e);const n=it.reportApiInvoke(this._sessionId,{name:Vt.SET_CLIENT_ROLE,options:[t,e],tag:Ut.TRACER});if(this._mode==="rtc"){N.warning("[".concat(this._clientId,"]rtc mode can not use setClientRole")),Wt("warning",this,"setClientRole",t,"rtc mode can not use setClientRole");const u=new Q(U.INVALID_OPERATION,"rtc mode can not use setClientRole");return n.onError(u),u.throw()}if(e&&e.level&&t==="host"){const u=new Q(U.INVALID_OPERATION,"host mode can not set audience latency level");return n.onError(u),u.throw()}try{var o,c;if(t==="audience"&&this._p2pChannel.hasLocalMedia()){const u=new Q(U.INVALID_OPERATION,"can not set client role to audience when publishing stream");return n.onError(u),u.throw()}await this._gateway.setClientRole(t,e),N.info(M(o=M(c="[".concat(this._clientId,"] set client role to ")).call(c,t,", level: ")).call(o,e&&e.level)),Wt("info",this,"setClientRole",{role:t,level:e&&e.level}),n.onSuccess()}catch(u){throw n.onError(u),u}}setProxyServer(t,e){var n;if(_n(t,"proxyServer"),!e){if(this.connectionState!=="DISCONNECTED")throw new Q(U.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Q(U.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=t,it.setProxyServer(this._proxyServer),N.setProxyServer(this._proxyServer),pc(this._proxyServer),N.info(M(n="[".concat(this._clientId,"] Set proxy server ")).call(n,e?"by initialize call":""," success.")),Wt("info",this,"setProxyServer",[...arguments],"success")}setTurnServer(t,e){var n,o,c;if(sn(t)||(t=[t]),!e){if(this.connectionState!=="DISCONNECTED")throw new Q(U.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Q(U.INVALID_OPERATION,"You have already set the proxy")}if(cA(t))return this._turnServer={servers:t,mode:"original-manual"},N.info(M(o=M(c="[".concat(this._clientId,"] Set original turnserver ")).call(c,e?"by initialize call":""," success: ")).call(o,ht(t).call(t,u=>u.urls).join(","),".")),void Wt("info",this,"setOriginalTurnServer",[...arguments],"success");G(t).call(t,u=>MI(u)),this._turnServer={servers:t,mode:"manual"},N.info(M(n="[".concat(this._clientId,"] Set turnserver ")).call(n,e?"by initialize call":""," success.")),Wt("info",this,"setTurnServer",[...arguments],"success")}startProxyServer(t){const e=it.reportApiInvoke(this._sessionId,{name:Vt.START_PROXY_SERVER,options:[],tag:Ut.TRACER});if(this.connectionState!=="DISCONNECTED"){const o=new Q(U.INVALID_OPERATION,"Start proxy server before join channel");throw e.onError(o),o}if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint){const o=new Q(U.INVALID_OPERATION,"You have already set the proxy");throw e.onError(o),o}const n=[1,2,3,4,5];switch(t===void 0&&(t=1),t){case 1:this._cloudProxyServerMode="normal";break;case 2:this._cloudProxyServerMode="443only";break;case 3:this._cloudProxyServerMode="proxy3";break;case 4:this._cloudProxyServerMode="proxy4";break;case 5:this._cloudProxyServerMode="proxy5";break;default:{const o=new Q(U.INVALID_PARAMS,"proxy server mode must be ".concat(n.join("|")));throw e.onError(o),o}}N.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),Wt("info",this,"startProxyServer",this._cloudProxyServerMode),e.onSuccess()}stopProxyServer(){const t=it.reportApiInvoke(this._sessionId,{name:Vt.STOP_PROXY_SERVER,options:[],tag:Ut.TRACER});if(this.connectionState!=="DISCONNECTED")throw new Q(U.INVALID_OPERATION,"Stop proxy server after leave channel");it.setProxyServer(),N.setProxyServer(),pc(),this._cloudProxyServerMode="disabled",N.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),Wt("info",this,"stopProxyServer",this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]},t.onSuccess()}setLocalAccessPoints(t,e){if(nA(t,"serverList"),_n(e,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Q(U.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;t=ht(t).call(t,o=>{var c;return n.test(o)?M(c="".concat(o.replace(/\./g,"-"),".")).call(c,e):o}),this._useLocalAccessPoint=!0,In("WEBCS_DOMAIN",t),In("WEBCS_DOMAIN_BACKUP_LIST",t),In("GATEWAY_DOMAINS",[e]),In("EVENT_REPORT_DOMAIN",t[0]),In("EVENT_REPORT_BACKUP_DOMAIN",t[1]||t[0]),In("LOG_UPLOAD_SERVER","".concat(t[0],":6444")),N.info("set local access point success"),Wt("info",this,"setLocalAccessPoints")}async setRemoteDefaultVideoStreamType(t){if(Cn(t,"streamType",[0,1]),this._remoteDefaultVideoStreamType=t,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(t),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(e){throw N.error("[".concat(this._clientId,"] set default remote video stream type error"),e.toString()),e}else N.debug("haven't joined yet, cache remoteDefaultVideoStreamType ".concat(t))}async setRemoteVideoStreamType(t,e){var n,o;Cn(e,"streamType",[0,1]);const c=it.reportApiInvoke(this._sessionId,{name:Vt.SET_REMOTE_VIDEO_STREAM_TYPE,options:[t,e],tag:Ut.TRACER});try{await this._gateway.setRemoteVideoStreamType(t,e),Vr(()=>{var u;const d=yt(u=this._users).call(u,p=>p.uid===t);d&&d.videoTrack&&d.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(u){throw c.onError(u),N.error("[".concat(this._clientId,"] set remote video stream type error"),u.toString()),Wt("error",this,"setRemoteVideoStreamType",void 0,u.toString()),u}N.info(M(n=M(o="[".concat(this._clientId,"] set remote ")).call(o,t," video stream type to ")).call(n,e)),Wt("info",this,"setRemoteVideoStreamType",{uid:t,streamType:e}),this._remoteStreamTypeCacheMap.set(t,e),c.onSuccess()}async setStreamFallbackOption(t,e){var n,o;Cn(e,"fallbackType",[0,1,2]);const c=it.reportApiInvoke(this._sessionId,{name:Vt.SET_STREAM_FALLBACK_OPTION,options:["too long to show",e],tag:Ut.TRACER});try{await this._gateway.setStreamFallbackOption(t,e)}catch(u){throw c.onError(u),N.error("[".concat(this._clientId,"] set stream fallback option"),u.toString()),Wt("error",this,"setStreamFallbackOption",void 0,u.toString()),u}N.info(M(n=M(o="[".concat(this._clientId,"] set remote ")).call(o,t," stream fallback type to ")).call(n,e)),Wt("info",this,"setStreamFallbackOption",{uid:t,fallbackType:e}),this._streamFallbackTypeCacheMap.set(t,e),c.onSuccess()}setEncryptionConfig(t,e,n){(function(c){Cn(c,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(t),_n(e,"secret");const o=["aes-128-gcm2","aes-256-gcm2"];if(Xt(o).call(o,t)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new Q(U.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new Q(U.INVALID_PARAMS,"current encrypt mode does not need salt");new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(e)||(N.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),Lt("warning",this,`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `)),this._encryptionMode=t,this._encryptionSecret=e,n&&(this._encryptionSalt=Sd(n))}async renewToken(t){_n(t,"token",1,2047);const e=it.reportApiInvoke(this._sessionId,{name:Vt.RENEW_TOKEN,options:[t],tag:Ut.TRACER});if(!this._key||!this._joinInfo){const c=new Q(U.INVALID_OPERATION,"renewToken should not be called before user join");return e.onError(c),c.throw()}const n=this._key;this._key=t,this._joinInfo&&(this._joinInfo.token=t);const o=await this._renewTokenMutex.lock();try{if(ot("USE_NEW_TOKEN")){N.debug("start renew token with ticket from unilbs"),Wt("debug",this,"renewToken","unilbs");const c=await RN(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Cr);N.debug("[".concat(this._clientId,"] get ticket from unilbs success")),Wt("debug",this,"renewToken","unilbs","success"),await this._gateway.renewToken({token:t,ticket:c})}else N.debug("start renew token without ticket"),Wt("debug",this,"renewToken"),await this._gateway.renewToken({token:t});N.debug("[".concat(this._clientId,"] renewToken success")),Wt("debug",this,"renewToken",void 0,"success"),e.onSuccess()}catch(c){throw this._key=n,this._joinInfo.token=n,e.onError(c),N.error("[".concat(this._clientId,"] renewToken failed"),c.toString()),Wt("error",this,"renewToken",void 0,c.toString()),c}finally{o()}}enableAudioVolumeIndicator(){const t=it.reportApiInvoke(this._sessionId,{name:Vt.ENABLE_AUDIO_VOLUME_INDICATOR,options:[],tag:Ut.TRACER});if(this._audioVolumeIndicationInterval)return N.warning("you have already enabled audio volume indicator!"),Wt("warning",this,"enableAudioVolumeIndicator","you have already enabled audio volume indicator!"),t.onSuccess();this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.emit(Ie.VOLUME_INDICATOR,e)},ot("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3),t.onSuccess()}getRTCStats(){const t=this._statsCollector.getRTCStats(),e=this._gateway.getInChannelInfo();return t.Duration=Math.round(e.duration/1e3),t}startLiveStreaming(t,e){const n=it.reportApiInvoke(this._sessionId,{name:Vt.START_LIVE_STREAMING,options:[t,e],tag:Ut.TRACER});if(!e){if(this._codec!=="h264"){const c=new Q(U.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");return n.onError(c),ct.reject(c)}if(!this._p2pChannel.hasLocalMedia()){const c=new Q(U.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming");return n.onError(c),ct.reject(c)}}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t)){const c=new Q(U.LIVE_STREAMING_TASK_CONFLICT);return n.onError(c),ct.reject(c)}const o=e?Ar.TRANSCODE:Ar.RAW;return this._createLiveStreamingClient(o).startLiveStreamingTask(t,o).then(()=>n.onSuccess()).catch(c=>{throw n.onError(c),c})}setLiveTranscoding(t){const e=it.reportApiInvoke(this._sessionId,{name:Vt.SET_LIVE_TRANSCODING,options:[t],tag:Ut.TRACER});return this._createLiveStreamingClient(Ar.TRANSCODE).setTranscodingConfig(t).then(()=>e.onSuccess()).catch(n=>{throw e.onError(n),n})}stopLiveStreaming(t){var e;const n=it.reportApiInvoke(this._sessionId,{name:Vt.STOP_LIVE_STREAMING,options:[t],tag:Ut.TRACER}),o=Ot(e=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient]).call(e,c=>c&&c.hasUrl(t));if(!o.length){const c=new Q(U.INVALID_PARAMS,"can not find live streaming url to stop");return n.onError(c),ct.reject(c)}return ct.all(ht(o).call(o,c=>c&&c.stopLiveStreamingTask(t))).then(()=>n.onSuccess()).catch(c=>{throw n.onError(c),c})}async addInjectStreamUrl(t,e){const n=it.reportApiInvoke(this._sessionId,{name:Vt.ADD_INJECT_STREAM_URL,options:[t,e],tag:Ut.TRACER});try{if(!this._joinInfo)throw new Q(U.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");const o=this._createLiveStreamingClient(Ar.INJECT);o.setInjectStreamConfig(e,0),await o.startLiveStreamingTask(t,Ar.INJECT)}catch(o){throw n.onError(o),o}n.onSuccess()}async removeInjectStreamUrl(){const t=it.reportApiInvoke(this._sessionId,{name:Vt.REMOVE_INJECT_STREAM_URL,options:[],tag:Ut.TRACER});try{var e,n;const o=this._createLiveStreamingClient(Ar.INJECT),c=yt(e=Ue(Tl(n=o.streamingTasks).call(n))).call(e,u=>u.mode===Ar.INJECT);if(!this._joinInfo||!c)throw new Q(U.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");await o.stopLiveStreamingTask(c.url)}catch(o){throw t.onError(o),o}t.onSuccess()}async startChannelMediaRelay(t){const e=it.reportApiInvoke(this._sessionId,{name:Vt.START_CHANNEL_MEDIA_RELAY,options:[t],tag:Ut.TRACER});try{i_(t),await this._createChannelMediaRelayClient().startChannelMediaRelay(t)}catch(n){return e.onError(n),n.throw()}e.onSuccess()}async updateChannelMediaRelay(t){const e=it.reportApiInvoke(this._sessionId,{name:Vt.UPDATE_CHANNEL_MEDIA_RELAY,options:[t],tag:Ut.TRACER});try{i_(t),await this._createChannelMediaRelayClient().updateChannelMediaRelay(t)}catch(n){return e.onError(n),n.throw()}e.onSuccess()}async stopChannelMediaRelay(){const t=it.reportApiInvoke(this._sessionId,{name:Vt.STOP_CHANNEL_MEDIA_RELAY,options:[],tag:Ut.TRACER});try{await this._createChannelMediaRelayClient().stopChannelMediaRelay()}catch(e){return t.onError(e),e.throw()}t.onSuccess()}sendStreamMessage(t,e=!0){if(!this._joinInfo)throw new Q(U.INVALID_OPERATION,"can not send data stream, not joined");if(typeof t=="string"&&(t=new TextEncoder().encode(t)),new Blob([t]).size>1024)throw new Q(U.INVALID_PARAMS,"stream message out of range.");return this._gateway.signal.request(Ae.DATA_STREAM,{payload:Sd(t)},!e)}sendMetadata(t){if(!this._joinInfo)throw new Q(U.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([t]).size>1024)throw new Q(U.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Ae.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Sd(t)})}async sendCustomReportMessage(t){sn(t)||(t=[t]),G(t).call(t,p2);const e=it.reportApiInvoke(this._sessionId,{name:Vt.SEND_CUSTOM_REPORT_MESSAGE,options:[at(t)],tag:Ut.TRACER});if(!this._joinInfo){const n=new Q(U.INVALID_OPERATION,"can not send custom report, not joined");return e.onError(n),n.throw()}await it.sendCustomReportMessage(this._joinInfo.sid,t),e.onSuccess()}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(t,e){Cn(e.spatialLayer,"spatialLayer",[0,1,2,3]),Cn(e.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(t,e)}catch(n){throw N.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),st("error",this,"pickSVCLayer",e,n.toString()),n}}_reset(){var t;N.debug("[".concat(this._clientId,"] reset client")),st("debug",this,"_reset"),this._axiosCancelSource.cancel(),this._axiosCancelSource=yo.CancelToken.source(),this._streamFallbackTypeCacheMap=new tr,this._remoteStreamTypeCacheMap=new tr,this._configDistribute.stopGetConfigDistribute(),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,G(t=this._users).call(t,e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy()}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._p2pChannel.reset(),this._publishMutex=new Qi("client-publish"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0)}_startSession(t,e){var n,o,c;const u=t||M1();t?N.debug(M(n="[".concat(this._clientId,"] new Session ")).call(n,u)):N.debug(M(o=M(c="[".concat(this._clientId,"] renewSession ")).call(c,this._sessionId," => ")).call(o,u)),st("debug",this,"_startSession",{newSid:u,sid:this._sessionId}),this._sessionId=u,this.store.sessionId=u,e?it.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:e.channel,appid:e.appId,mode:this._mode}):this._joinInfo?it.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:this._joinInfo.cname,appid:this._joinInfo.appId,mode:this._mode}):this._gateway.joinInfo&&it.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId,mode:this._mode}),this._joinInfo&&(this._joinInfo.sid=u),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=u)}async _publishHighStream(t){if(!this._joinInfo||this._uid===void 0)throw new Q(U.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Q(U.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&ot("FORCE_TURN")&&!ot("TURN_ENABLE_TCP")&&!ot("TURN_ENABLE_UDP"))throw new Q(U.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");N.debug("[".concat(this._clientId,"] publish high stream")),st("debug",this,"_publishHighStream");try{const n=await this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter),o=(await n.next()).value;if(o){var e;let c;try{c=await this._gateway.publish(this._uid,o,!0)}catch(u){if(u.code!==U.DISCONNECT_P2P)throw n.throw(u),u}await n.next(((e=c)===null||e===void 0?void 0:e.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const c of t)c instanceof We&&c._encoderConfig&&this._gateway.setVideoProfile(c._encoderConfig),!c.muted&&c.enabled||await this._p2pChannel.muteLocalTrack(c)}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,t),(n==null?void 0:n.code)===U.WS_ABORT)return;throw n}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new Q(U.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Q(U.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));N.debug("[".concat(this._clientId,"] publish low stream")),st("debug",this,"_publishLowStream");const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t.bitrate));try{const n=await this._p2pChannel.publishLowStream(this._lowStreamParameter),o=(await n.next()).value;if(o){var e;let c;try{c=await this._gateway.publish(this._uid,o,!0)}catch(u){if(u.code!==U.DISCONNECT_P2P)throw n.throw(u),u}n.next(((e=c)===null||e===void 0?void 0:e.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,void 0,!0),(n==null?void 0:n.code)===U.WS_ABORT)return;throw n}}_createLiveStreamingClient(t){if(!this._joinInfo||!this._appId)return new Q(U.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const e=()=>new ON(this._joinInfo,this._config.websocketRetryConfig||Cr,this._config.httpRetryConfig||Cr),n=o=>{o.onLiveStreamError=(c,u)=>{it.reportApiInvoke(this._sessionId,{name:Vt.ON_LIVE_STREAM_ERROR,options:[c,u],tag:Ut.TRACER}).onSuccess(),this.emit(Ie.LIVE_STREAMING_ERROR,c,u)},o.onLiveStreamWarning=(c,u)=>{it.reportApiInvoke(this._sessionId,{name:Vt.ON_LIVE_STREAM_WARNING,options:[c,u],tag:Ut.TRACER}).onSuccess(),this.emit(Ie.LIVE_STREAMING_WARNING,c,u)},o.on(Ec.REQUEST_WORKER_MANAGER_LIST,(c,u,d)=>{if(!this._joinInfo)return d(new Q(U.INVALID_OPERATION,"can not find join info to get worker manager"));ZC(c,this._joinInfo,this._axiosCancelSource.token,Cr).then(u).catch(d)})};switch(t){case Ar.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=e(),n(this._liveRawStreamingClient)),this._liveRawStreamingClient;case Ar.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=e(),n(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case Ar.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=e(),this._injectStreamingClient.on(Ec.REQUEST_WORKER_MANAGER_LIST,(o,c,u)=>{if(!this._joinInfo)return u(new Q(U.INVALID_OPERATION,"can not find join info to get worker manager"));ZC(o,this._joinInfo,this._axiosCancelSource.token,Cr).then(c).catch(u)}),this._injectStreamingClient.onInjectStatusChange=(o,c,u)=>{this.emit(Ie.INJECT_STREAM_STATUS,o,c,u)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){return this._joinInfo?(this._channelMediaRelayClient||(this._channelMediaRelayClient=new DN(this._joinInfo,this._clientId,this._config.websocketRetryConfig||Cr,this._config.httpRetryConfig||Cr),this._channelMediaRelayClient.on("state",t=>{t===Bn.RELAY_STATE_FAILURE&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.emit(Ie.CHANNEL_MEDIA_RELAY_STATE,t)}),this._channelMediaRelayClient.on("event",t=>{this.emit(Ie.CHANNEL_MEDIA_RELAY_EVENT,t)})),this._channelMediaRelayClient):new Q(U.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw()}_handleGatewayEvents(){this._gateway.on(_r.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(_r.CONNECTION_STATE_CHANGE,(t,e,n)=>{var o,c,u,d;if(n===un.FALLBACK)return;const p=()=>{this.emit(Ie.CONNECTION_STATE_CHANGE,t,e,n)};if(it.reportApiInvoke(this._sessionId||((o=this._gateway.joinInfo)===null||o===void 0?void 0:o.sid)||null,{name:Vt.CONNECTION_STATE_CHANGE,options:[t,e,n],tag:Ut.TRACER}).onSuccess(at({cur:t,prev:e,reason:n})),N.info(M(c=M(u="[".concat(this._clientId,"] connection state change: ")).call(u,e," -> ")).call(c,t)),nr("info",this,"connection-state-change",M(d="".concat(e," -> ")).call(d,t)),t==="DISCONNECTED")return this._reset(),void p();var f;if(t==="RECONNECTING")G(f=this._users).call(f,_=>{_._trust_in_room_=!1,_._trust_audio_enabled_state_=!1,_._trust_video_enabled_state_=!1,_._trust_audio_mute_state_=!1,_._trust_video_mute_state_=!1,_._trust_stream_added_state_=!1}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(t==="CONNECTED"){var g,E,I;G(g=this._streamFallbackTypeCacheMap).call(g,(_,T)=>{this._gateway.setStreamFallbackOption(T,_).catch(R=>{N.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),R),Lt("warning",this,"auto set stream fallback option failed, ".concat(R.toString()))})}),G(E=this._remoteStreamTypeCacheMap).call(E,(_,T)=>{this._gateway.setRemoteVideoStreamType(T,_).catch(R=>{N.warning("[".concat(this._clientId,"] auto set remote stream type failed"),R),Lt("warning",this,"auto set remote stream type failed, ".concat(R.toString()))})}),this._remoteDefaultVideoStreamType!==void 0&&((I=this._joinInfo)===null||I===void 0?void 0:I.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{N.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(_=>{var T;N.error(M(T="[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ")).call(T,_))}),this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{var _;if(this.connectionState!=="CONNECTED")return;this._userOfflineTimeout=void 0;const T=Ot(_=this._users).call(_,R=>!R._trust_in_room_);G(T).call(T,R=>{var w;N.debug(M(w="[".concat(this._clientId,"] user offline timeout, emit user offline ")).call(w,R.uid)),Lt("debug",this,"user offline timeout, emit user offline ".concat(R.uid)),this._handleUserOffline({uid:R.uid})})},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{var _;this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,G(_=this._users).call(_,T=>{var R,w,k,L,Y;T._trust_audio_mute_state_||(N.debug(M(R="[".concat(this._clientId,"] auto dispatch audio unmute event ")).call(R,T.uid)),Lt("debug",this,"auto dispatch audio unmute event ".concat(T.uid)),this._handleMuteStream(T.uid,"audio",!1)),T._trust_video_mute_state_||(N.debug(M(w="[".concat(this._clientId,"] auto dispatch video unmute event ")).call(w,T.uid)),Lt("debug",this,"auto dispatch video unmute event ".concat(T.uid)),this._handleMuteStream(T.uid,"video",!1)),T._trust_audio_enabled_state_||(N.debug(M(k="[".concat(this._clientId,"] auto dispatch enable local audio ")).call(k,T.uid)),Lt("debug",this,"auto dispatch enable local audio ".concat(T.uid)),this._handleSetStreamLocalEnable("audio",T.uid,!0)),!T._trust_video_enabled_state_&&T._video_enabled_&&(N.debug(M(L="[".concat(this._clientId,"] auto dispatch enable local video ")).call(L,T.uid)),Lt("debug",this,"auto dispatch enable local video ".concat(T.uid)),this._handleSetStreamLocalEnable("video",T.uid,!0)),T._trust_stream_added_state_||(N.debug(M(Y="[".concat(this._clientId,"] auto dispatch stream remove ")).call(Y,T.uid)),Lt("debug",this,"auto dispatch stream remove ".concat(T.uid)),this._handleRemoveStream({uid:T.uid,uint_id:T._uintid}))}))},1e3)}p()}),this._gateway.on(_r.REQUEST_NEW_GATEWAY_LIST,(t,e)=>{if(!this._joinInfo)return e(new Q(U.UNEXPECTED_ERROR,"can not recover, no join info"));Ll(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Cr).then(n=>{var o;this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip),t(ht(o=n.gatewayInfo.gatewayAddrs).call(o,c=>{if(this._joinInfo&&this._joinInfo.proxyServer){var u,d;const p=c.address.split(":");return M(u=M(d="wss://".concat(this._joinInfo.proxyServer,"/ws/?h=")).call(d,p[0],"&p=")).call(u,p[1])}return"wss://".concat(c.address)}))}).catch(e)}),this._gateway.on(_r.NETWORK_QUALITY,t=>{this._networkQualitySensitivity==="normal"&&this.emit(Ie.NETWORK_QUALITY,t)}),this._gateway.on(_r.STREAM_TYPE_CHANGE,(t,e)=>{this.emit(Ie.STREAM_TYPE_CHANGED,t,e),it.reportApiInvoke(this._sessionId,{name:Vt.STREAM_TYPE_CHANGE,options:[t,e],tag:Ut.TRACER}).onSuccess(at({uid:t,streamType:e}))}),this._gateway.on(_r.IS_P2P_DISCONNECTED,t=>{this._p2pChannel.isP2PDisconnected()?t(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?t(!1):t(!0)}),this._gateway.on(_r.NEED_RENEW_SESSION,()=>{this._startSession()}),this._gateway.on(_r.REQUEST_P2P_CONNECTION_PARAMS,async(t,e,n)=>{try{e(await this._p2pChannel.startP2PConnection(t))}catch(o){n(o)}}),this._gateway.on(_r.JOIN_RESPONSE,(t,e,n)=>{const{dtlsParameters:o,iceParameters:c,candidates:u,rtpCapabilities:d,setup:p,cname:f}=E_(t.ortc,e,n);this._p2pChannel.connect(c,o,u,d,p,f)}),this._gateway.signal.on(Pe.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Pe.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Pe.ON_ADD_AUDIO_STREAM,t=>this._handleAddAudioOrVideoStream("audio",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc)),this._gateway.signal.on(Pe.ON_ADD_VIDEO_STREAM,t=>this._handleAddAudioOrVideoStream("video",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc,t.rtxSsrcId)),this._gateway.signal.on(Pe.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Pe.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Pe.MUTE_AUDIO,t=>(nr("debug",["AgoraRTCGateway",this._clientId],"mute_audio",{uid:t.uid}),this._handleMuteStream(t.uid,"audio",!0))),this._gateway.signal.on(Pe.UNMUTE_AUDIO,t=>(nr("debug",["AgoraRTCGateway",this._clientId],"unmute_audio",{uid:t.uid}),this._handleMuteStream(t.uid,"audio",!1))),this._gateway.signal.on(Pe.MUTE_VIDEO,t=>(nr("debug",["AgoraRTCGateway",this._clientId],"mute_video",{uid:t.uid}),this._handleMuteStream(t.uid,"video",!0))),this._gateway.signal.on(Pe.UNMUTE_VIDEO,t=>(nr("debug",["AgoraRTCGateway",this._clientId],"unmute_video",{uid:t.uid}),this._handleMuteStream(t.uid,"video",!1))),this._gateway.signal.on(Pe.RECEIVE_METADATA,t=>{const e=PA(t.metadata);this.emit(Ie.RECEIVE_METADATA,t.uid,e)}),this._gateway.signal.on(Pe.ON_DATA_STREAM,t=>{t.seq&&delete t.seq,t.payload=PA(t.payload),this.emit(Ie.STREAM_MESSAGE,t.uid,t.payload),this.onStreamMessage&&this.onStreamMessage(t)}),this._gateway.signal.on(Pe.ON_CRYPT_ERROR,()=>{Sl(()=>{N.warning("[".concat(this._clientId,"] on crypt error")),nr("warning",this,"crypt_error"),this.emit(Ie.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Pe.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Pe.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{N.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),nr("warning",this,"token_privilege_did_expire"),this._gateway.leave(!0),this.emit(Ie.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Pe.ON_STREAM_FALLBACK_UPDATE,t=>{var e,n;N.debug(M(e=M(n="[".concat(this._clientId,"] stream fallback peerId: ")).call(n,t.stream_id,", attr: ")).call(e,t.stream_type)),nr("debug",this,"stream_fallback_update",{peerId:t.stream_id,attr:t.stream_type}),this.emit(Ie.STREAM_FALLBACK,t.stream_id,t.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(Pe.ON_PUBLISH_STREAM,t=>{var e;this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,at({proxy:t.proxy})),N.info(M(e="[".concat(this._clientId,"] on publish stream, ")).call(e,at(t))),nr("info",this,"publish_stream",t),t.proxy!==void 0&&this.emit(Ie.IS_USING_CLOUD_PROXY,!!t.proxy))}),this._gateway.signal.on(Pe.ENABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!0)}),this._gateway.signal.on(Pe.DISABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!1)}),this._gateway.signal.on(de.REQUEST_TIMEOUT,(t,e)=>{if(this._joinInfo)switch(t){case Ae.PUBLISH:{if(!e)return;const d=(e=e).ortc;if(d){var n,o,c,u;const p=Bi(d).call(d,({stream_type:E})=>E===fr.Audio),f=Bi(d).call(d,({stream_type:E})=>E!==fr.Audio),g=Bi(d).call(d,({stream_type:E})=>E===fr.Screen||E===fr.ScreenLow);e.state==="offer"&&it.publish(this._joinInfo.sid,{eventElapse:Vi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:U.TIMEOUT,audio:p,video:f,p2pid:e.p2p_id,publishRequestid:this.store.pubId,screenshare:g,audioName:p?(n=yt(d).call(d,({stream_type:E})=>E===fr.Audio))===null||n===void 0||(o=n.ssrcs[0])===null||o===void 0?void 0:o.ssrcId.toString():void 0,videoName:f?(c=yt(d).call(d,({stream_type:E})=>E!==fr.Audio))===null||c===void 0||(u=c.ssrcs[0])===null||u===void 0?void 0:u.ssrcId.toString():void 0})}break}case Ae.SUBSCRIBE:(e=e)&&it.subscribe(this._joinInfo.sid,{succ:!1,ec:U.TIMEOUT,audio:e.stream_type===xe.AUDIO,video:e.stream_type===xe.VIDEO,peerid:e.stream_id,subscribeRequestid:e.ssrcId,p2pid:this.store.p2pId,eventElapse:Vi.measureFromSubscribeStart(this.store.clientId,e.ssrcId)})}}),this._gateway.signal.on(Pe.ON_P2P_OK,t=>{this.uid===this._uid&&t.proxy!==void 0&&this.emit(Ie.IS_USING_CLOUD_PROXY,!!t.proxy)})}_handleP2PChannelEvents(){this._p2pChannel.on(Re.RequestMuteLocal,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(o){o.code===U.DISCONNECT_P2P?e():n(o)}else e()}),this._p2pChannel.on(Re.RequestUnmuteLocal,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(o){o.code===U.DISCONNECT_P2P?e():n(o)}else e()}),this._p2pChannel.on(Re.RequestRePublish,(t,e,n)=>{this.publish(t,!1).then(e).catch(n)}),this._p2pChannel.on(Re.RequestReSubscribe,async(t,e,n)=>{try{for(const{user:o,kind:c}of t)c===xe.VIDEO?await this.subscribe(o,"video"):await this.subscribe(o,"audio");e()}catch(o){n(o)}}),this._p2pChannel.on(Re.RequestUploadStats,(t,e)=>{this._gateway.uploadStats(t,e)}),this._p2pChannel.on(Re.MediaReconnectStart,t=>{this.emit(Ie.MEDIA_RECONNECT_START,t)}),this._p2pChannel.on(Re.MediaReconnectEnd,t=>{this.emit(Ie.MEDIA_RECONNECT_END,t)}),this._p2pChannel.on(Re.NeedSignalRTT,t=>{t(this._gateway.getSignalRTT())}),this._p2pChannel.on(Re.RequestRestartICE,async()=>{const t=await this._p2pChannel.reEstablish();if(t){const{restartICEResponse:e,gatewayIP:n,gatewayPort:o}=await this._gateway.restartICE({iceParameters:t.iceParameters}),{candidates:c,iceParameters:u}=function(d,p,f){const g=d.ice;let E;var I,_,T;return p!==void 0&&f!==void 0?(E=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:p,port:f.toString(),type:"host",extension:{}}],N.debug(M(I="Using remote candidate from AP ".concat(p,":")).call(I,f)),Lt("debug",[],M(_="Using remote candidate from AP ".concat(p,":")).call(_,f))):E=ht(T=g.candidates).call(T,R=>({foundation:R.foundation,componentId:"1",transport:R.protocol,priority:R.priority.toString(),connectionAddress:R.ip,port:R.port.toString(),type:R.type,extension:{}})),{candidates:E,iceParameters:{iceUfrag:g.iceUfrag,icePwd:g.icePwd}}}(e,n,o);await t.restartICE(u,c)}}),this._p2pChannel.on(Re.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Re.RequestReconnectPC,async()=>{var t;const{iceParameters:e,dtlsParameters:n,rtpCapabilities:o}=await this._p2pChannel.startP2PConnection({turnServer:(t=this._joinInfo)===null||t===void 0?void 0:t.turnServer}),{gatewayEstablishParams:c,gatewayIP:u,gatewayPort:d}=await this._gateway.reconnectPC({iceParameters:e,dtlsParameters:n,rtpCapabilities:o}),{dtlsParameters:p,iceParameters:f,candidates:g,rtpCapabilities:E,setup:I,cname:_}=E_(c,u,d);await this._p2pChannel.connect(f,p,g,E,I,_),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Re.RequestUnpublishForReconnectPC,async(t,e,n)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(t,this._uid),e()):n()}),this._p2pChannel.on(Re.P2PLost,()=>{this.emit(Ie.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Re.UpdateVideoEncoder,t=>{t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig)})}getKeyMetrics(){return this.store.keyMetrics}};function G_(t,e){var n=ue(t);if(_e){var o=_e(t);e&&(o=Ot(o).call(o,function(c){return zt(t,c).enumerable})),n.push.apply(n,o)}return n}function Pf(t){for(var e=1;e<arguments.length;e++){var n,o=arguments[e]!=null?arguments[e]:{};if(e%2)G(n=G_(Object(o),!0)).call(n,function(u){qr(t,u,o[u])});else if(Ce)dr(t,Ce(o));else{var c;G(c=G_(Object(o))).call(c,function(u){te(t,u,zt(o,u))})}}return t}function xf(t,e,n,o){n.optimizationMode&&(o&&o.width&&o.height?(n.encoderConfig=Pf({},o,{bitrateMin:o.bitrateMin,bitrateMax:o.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(e.contentHint=n.optimizationMode,e.contentHint===n.optimizationMode?(N.debug("[".concat(t,"] set content hint to"),n.optimizationMode),Wt("debug",["AgoraRTC"],"videoTrackOptimizationModeProcess",[t,n,o])):(N.debug("[".concat(t,"] set content hint failed")),Wt("warning",["AgoraRTC"],"videoTrackOptimizationModeProcess",[t,n,o],"failed")))):(N.warning("[".concat(t,"] can not apply optimization mode bitrate config, no encoderConfig")),Lt("warning",["AgoraRTC"],"[".concat(t,"] can not apply optimization mode bitrate config, no encoderConfig"))))}Oa([Cl({report:it}),fn("design:type",Function),fn("design:paramtypes",[String,Boolean]),fn("design:returntype",void 0)],Es.prototype,"setProxyServer",null),Oa([Cl(),fn("design:type",Function),fn("design:paramtypes",[Object,Boolean]),fn("design:returntype",void 0)],Es.prototype,"setTurnServer",null),Oa([Cl({report:it}),fn("design:type",Function),fn("design:paramtypes",[Array,String]),fn("design:returntype",void 0)],Es.prototype,"setLocalAccessPoints",null),Oa([gd(),fn("design:type",Function),fn("design:paramtypes",[Number]),fn("design:returntype",ct)],Es.prototype,"setRemoteDefaultVideoStreamType",null),Oa([Cl({report:it}),fn("design:type",Function),fn("design:paramtypes",[String,String,Uint8Array]),fn("design:returntype",void 0)],Es.prototype,"setEncryptionConfig",null),Oa([gd({report:it}),fn("design:type",Function),fn("design:paramtypes",[Object,Object]),fn("design:returntype",ct)],Es.prototype,"pickSVCLayer",null),Es=Oa([an("AgoraRTCClient","store.clientId"),fn("design:paramtypes",[Object])],Es);var fO=le.setInterval;const gO=Ke().name;class Gl{constructor(e,n){this.id=0,Gl.count+=1,this.id=Gl.count,this.element=e,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=e=>{const n=document.createElement("audio");n.srcObject=new MediaStream([e.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;const e=async(o,c)=>{const u=c==="offer"?await o.createOffer():await o.createAnswer();return await o.setLocalDescription(u),o.iceGatheringState==="complete"?o.localDescription:new ct(d=>{o.onicegatheringstatechange=()=>{o.iceGatheringState==="complete"&&d(o.localDescription)}})},n=async(o,c)=>await o.setRemoteDescription(c);try{const o=await e(this.peerPair[0],"offer");await n(this.peerPair[1],o);const c=await e(this.peerPair[1],"answer");await n(this.peerPair[0],c)}catch(o){throw new Q(U.LOCAL_AEC_ERROR,o.toString()).print()}}async getTracksFromMediaElement(e){if(this.audioTrack)return this.audioTrack;let n;try{e instanceof HTMLVideoElement&&(e.captureStream?e.captureStream():e.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(e).connect(n)}catch(c){throw new Q(U.LOCAL_AEC_ERROR,c.toString()).print()}if(!n)throw new Q(U.LOCAL_AEC_ERROR,"no dest node when local aec").print();const o=n.stream.getAudioTracks()[0];return this.audioTrack=o,o}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const e=this.element,n=await this.getTracksFromMediaElement(e);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){var e;N.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&G(e=this.peerPair).call(e,n=>{n.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}Gl.count=0;var mO=function(t,e,n,o){var c,u=arguments.length,d=u<3?e:o===null?o=zt(e,n):o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(t,e,n,o);else for(var p=t.length-1;p>=0;p--)(c=t[p])&&(d=(u<3?c(d):u>3?c(e,n,d):c(e,n))||d);return u>3&&d&&te(e,n,d),d},Uf=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};const EO=window.AudioContext||window.webkitAudioContext;class j_{constructor(){this.units=[]}processExternalMediaAEC(e){var n;if(!this._doesEnvironmentNeedAEC())return N.debug("the system does not need to process local aec"),-1;this.context||(this.context=new EO);let o=yt(n=this.units).call(n,c=>c&&c.getElement()===e);return o||(o=new Gl(e,this.context),this.units.push(o)),o.startEchoCancellation(),N.debug("start processing local audio echo cancellation, id is",o.id),o.id}_doesEnvironmentNeedAEC(){return Ke().name!==be.SAFARI}}mO([Cl({report:it}),Uf("design:type",Function),Uf("design:paramtypes",[HTMLAudioElement]),Uf("design:returntype",Number)],j_.prototype,"processExternalMediaAEC",null);const vO=new j_;var K_,H_,W_,Y_;In("PROCESS_ID",M(K_=M(H_=M(W_=M(Y_="process-".concat(gr(8,""),"-")).call(Y_,gr(4,""),"-")).call(W_,gr(4,""),"-")).call(H_,gr(4,""),"-")).call(K_,gr(12,""))),function(){const t=Ke();Ln.getDisplayMedia=function(e){return!!(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)}(),Ln.getStreamFromExtension=t.name===be.CHROME&&Number(t.version)>34,Ln.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const e=new RTCPeerConnection;let n=!1;try{e.addTransceiver("audio"),n=!0}catch{}return e.close(),n}(),Ln.supportMinBitrate=t.name===be.CHROME||t.name===be.EDGE,Ln.supportSetRtpSenderParameters=function(){const e=Ke();return!window.RTCRtpSender||!window.RTCRtpSender.prototype.setParameters||!window.RTCRtpSender.prototype.getParameters?!1:!!uc()||!(!Ei()&&!Hu())||e.name===be.FIREFOX&&Number(e.version)>=64}(),t.name===be.SAFARI&&(Number(t.version)>=14?Ln.supportDualStream=!0:Ln.supportDualStream=!1),Ln.webAudioMediaStreamDest=function(){const e=Ke();return!(e.name===be.SAFARI&&Number(e.version)<12)}(),Ln.supportReplaceTrack=function(){return window.RTCRtpSender?typeof RTCRtpSender.prototype.replaceTrack=="function":!1}(),Ln.supportWebGL=typeof WebGLRenderingContext!="undefined",Ln.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,uc()||(Ln.webAudioWithAEC=!0),Ln.supportShareAudio=function(){const e=Ke();return(e.os===Zr.WIN_10||e.os===Zr.WIN_81||e.os===Zr.WIN_7||e.os===Zr.LINUX||e.os===Zr.MAC_OS)&&e.name===be.CHROME&&Number(e.version)>=74}(),Ln.supportDualStreamEncoding=function(){const e=Ke();return e.name==="Safari"&&Number(e.version)>=14}(),N.info("browser compatibility",at(Ln),at(t)),st("info",[],"updateAgoraRTCCompatibility",{browserCompatibility:Ln,browserInfo:t})}(),function(){const t=window.localStorage.getItem("websdk_ng_global_parameter");if(t)try{var e;const n=JSON.parse(window.atob(t)),o=kt();N.debug("Loading global parameters from cache",n),st("debug",[],"loadConfigFromLocalStorage",n),G(e=ue(n)).call(e,c=>{if(Object.prototype.hasOwnProperty.call(qn,c)){const{value:u,expires:d}=n[c];if(d&&d<=o)return;$p[c]=u,qn[c]=u}})}catch(n){N.error("Error loading mutableParamsCache: ".concat(t),n.message)}}();const vs={__CLIENT_LIST__:us,__TRACK_LIST__:Qs,VERSION:Yn,BUILD:ad,setParameter:In,getParameter:ot,getSupportedCodec:async function(){let t={audio:[],video:[]};try{let e=new RTCPeerConnection;e.addTransceiver("video",{direction:"recvonly"}),e.addTransceiver("audio",{direction:"recvonly"});const n=(await e.createOffer()).sdp;if(!n)return t;e.close(),e=null,t=function(o){const c={video:[],audio:[]};return o.match(/ VP8/i)&&c.video.push("VP8"),o.match(/ VP9/i)&&c.video.push("VP9"),o.match(/ AV1/i)&&c.video.push("AV1"),o.match(/ H264/i)&&c.video.push("H264"),o.match(/ opus/i)&&c.audio.push("OPUS"),o.match(/ PCMU/i)&&c.audio.push("PCMU"),o.match(/ PCMA/i)&&c.audio.push("PCMA"),o.match(/ G722/i)&&c.audio.push("G722"),c}(n)}catch(e){throw new Q(U.CREATE_OFFER_FAILED,e.toString&&e.toString()).print()}return t},checkSystemRequirements:function(){const t=it.reportApiInvoke(null,{name:Vt.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Ut.TRACER});let e=!1;try{const u=window.RTCPeerConnection,d=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,p=window.WebSocket;e=!!(u&&d&&p)}catch(u){return N.error("check system requirement failed: ",u),!1}let n=!1;const o=Ke();o.name===be.CHROME&&Number(o.version)>=58&&(!Hw()||Kw())&&(n=!0),o.name===be.FIREFOX&&Number(o.version)>=56&&(n=!0),o.name===be.OPERA&&Number(o.version)>=45&&(n=!0),o.name===be.SAFARI&&Number(o.version)>=11&&(n=!0),(oI()||Ke().name===be.QQ)&&(n=!0),N.debug("checkSystemRequirements, api:",e,"browser",n);const c=e&&n;return t.onSuccess(c),c},getDevices:function(t){return ai.enumerateDevices(!0,!0,t)},getMicrophones:function(t){return ai.getRecordingDevices(t)},getCameras:function(t){return ai.getCamerasDevices(t)},getElectronScreenSources:A1,getPlaybackDevices:function(t){return ai.getSpeakers(t)},createClient:function(t={codec:"vp8",audioCodec:"opus",mode:"rtc"}){const e=it.reportApiInvoke(null,{name:Vt.CREATE_CLIENT,options:[t],tag:Ut.TRACER});try{(function(n){Cn(n.codec,"config.codec",["vp8","vp9","av1","h264"]),Cn(n.mode,"config.mode",["rtc","live"]),n.audioCodec!==void 0&&Cn(n.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),n.proxyServer!==void 0&&_n(n.proxyServer,"config.proxyServer",1,1e4),n.turnServer!==void 0&&MI(n.turnServer),n.httpRetryConfig!==void 0&&LI(n.httpRetryConfig),n.websocketRetryConfig!==void 0&&LI(n.websocketRetryConfig)})(t)}catch(n){throw e.onError(n),n}return t.audioCodec===void 0&&(t.audioCodec="opus"),e.onSuccess(),new Es(Mf({forceWaitGatewayResponse:!0},t,{role:t.mode==="rtc"?"host":t.role}))},createCameraVideoTrack:async function(t={encoderConfig:"480p_1"}){const e=it.reportApiInvoke(null,{tag:Ut.TRACER,name:Vt.CREATE_CAM_VIDEO_TRACK,options:[Pf({},t)]}),n=Cf(t),o=gr(8,"track-cam-");let c=null;N.info("start create camera video track with config",at(t),"trackId",o),Wt("info",["AgoraRTC"],"createCameraVideoTrack",t);try{c=(await eo({video:n},o)).getVideoTracks()[0]||null}catch(d){throw e.onError(d),d}if(!c){const d=new Q(U.UNEXPECTED_ERROR,"can not find track in media stream");return e.onError(d),d.throw()}t.optimizationMode&&xf(o,c,t,t.encoderConfig&&fc(t.encoderConfig));const u=new ba(c,t,n,t.scalabiltyMode?cd(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,o);return e.onSuccess(u.getTrackId()),N.info("create camera video success, trackId:",o),Wt("info",["AgoraRTC"],"createCameraVideoTrack",void 0,o),u},createCustomVideoTrack:function(t){const e=it.reportApiInvoke(null,{tag:Ut.TRACER,name:Vt.CREATE_CUSTOM_VIDEO_TRACK,options:[t]}),n=new We(t.mediaStreamTrack,{bitrateMax:t.bitrateMax,bitrateMin:t.bitrateMin},t.scalabiltyMode?cd(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode);return e.onSuccess(n.getTrackId()),N.info("create custom video track success with config",t,"trackId",n.getTrackId()),Wt("info",["AgoraRTC"],"createCustomVideoTrack",t,n.getTrackId()),n},createScreenVideoTrack:async function(t={},e="disable"){const n=it.reportApiInvoke(null,{tag:Ut.TRACER,name:Vt.CREATE_SCREEN_VIDEO_TRACK,options:[Pf({},t),e]});t.encoderConfig?typeof t.encoderConfig=="string"||t.encoderConfig.width&&t.encoderConfig.height||(t.encoderConfig.width={max:1920},t.encoderConfig.height={max:1080}):t.encoderConfig="1080p_2";const o=function(E){const I={};E.screenSourceType&&(I.mediaSource=E.screenSourceType),E.extensionId&&Wu()&&(I.extensionId=E.extensionId),E.electronScreenSourceId&&(I.sourceId=E.electronScreenSourceId);const _=E.encoderConfig?Zp(E.encoderConfig):null;return I.mandatory={chromeMediaSource:"desktop",maxWidth:_?_.width:void 0,maxHeight:_?_.height:void 0},_&&_.frameRate&&(typeof _.frameRate=="number"?(I.mandatory.maxFrameRate=_.frameRate,I.mandatory.minFrameRate=_.frameRate):(I.mandatory.maxFrameRate=_.frameRate.max||_.frameRate.ideal||_.frameRate.exact||void 0,I.mandatory.minFrameRate=_.frameRate.min||_.frameRate.ideal||_.frameRate.exact||void 0),I.frameRate=_.frameRate),_&&_.width&&(I.width=_.width),_&&_.height&&(I.height=_.height),I}(t),c=gr(8,"track-scr");let u=null,d=null;const p=Mn();if(!p.supportShareAudio&&e==="enable"){const E=new Q(U.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return n.onError(E),E.throw()}N.info("start create screen video track with config",t,"withAudio",e,"trackId",c),Wt("info",["AgoraRTC"],"createScreenVideoTrack",[t,e]);try{const E=await eo({screen:o,screenAudio:e==="auto"?p.supportShareAudio:e==="enable"},c);u=E.getVideoTracks()[0]||null,d=E.getAudioTracks()[0]||null}catch(E){throw n.onError(E),E}if(!u){const E=new Q(U.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(E),E.throw()}if(!d&&e==="enable"){u&&u.stop();const E=new Q(U.SHARE_AUDIO_NOT_ALLOWED);return n.onError(E),E.throw()}t.optimizationMode||(t.optimizationMode="detail"),t.optimizationMode&&(xf(c,u,t,t.encoderConfig&&Zp(t.encoderConfig)),t.encoderConfig&&typeof t.encoderConfig!="string"&&(t.encoderConfig.bitrateMin=t.encoderConfig.bitrateMax));const f=new We(u,t.encoderConfig?Zp(t.encoderConfig):{},t.scalabiltyMode?cd(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,c,[dn.SCREEN_TRACK]);if(!d)return n.onSuccess(f.getTrackId()),N.info("create screen video track success","video:",f.getTrackId()),Wt("info",["AgoraRTC"],"createScreenVideoTrack",void 0,{videoTrack:f.getTrackId()}),f;const g=new lr(d);return n.onSuccess([f.getTrackId(),g.getTrackId()]),N.info("create screen video track success","video:",f.getTrackId(),"audio:",g.getTrackId()),Wt("info",["AgoraRTC"],"createScreenVideoTrack",void 0,{videoTrack:f.getTrackId(),audioTrack:g.getTrackId()}),[f,g]},createMicrophoneAndCameraTracks:async function(t={},e={encoderConfig:"480p_1"}){var n,o,c,u;const d=it.reportApiInvoke(null,{tag:Ut.TRACER,name:Vt.CREATE_MIC_AND_CAM_TRACKS,options:[t,e]}),p=Cf(e),f=l_(t),g=gr(8,"track-mic-"),E=gr(8,"track-cam-");let I=null,_=null;N.info(M(n=M(o=M(c="start create camera video track(".concat(E,") and microphone audio track(")).call(c,g,") with config, audio: ")).call(o,at(t),", video: ")).call(n,at(e))),Wt("info",["AgoraRTC"],"createMicrophoneAndCameraTracks",{videoConfig:e,audioConfig:t});try{var T;const k=await eo({audio:f,video:p},M(T="".concat(g,"-")).call(T,E));I=k.getAudioTracks()[0],_=k.getVideoTracks()[0]}catch(k){throw d.onError(k),k}if(!I||!_){const k=new Q(U.UNEXPECTED_ERROR,"can not find tracks in media stream");return d.onError(k),k.throw()}e.optimizationMode&&xf(E,_,e,e.encoderConfig&&fc(e.encoderConfig));const R=new Ks(I,t,f,g),w=new ba(_,e,p,e.scalabiltyMode?cd(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,E);return d.onSuccess([R.getTrackId(),w.getTrackId()]),N.info(M(u="create camera video track(".concat(E,") and microphone audio track(")).call(u,g,") success")),Wt("info",["AgoraRTC"],"createMicrophoneAndCameraTracks",void 0,{videoTrackId:E,audioTrackId:g}),[R,w]},createMicrophoneAudioTrack:async function(t={}){const e=it.reportApiInvoke(null,{tag:Ut.TRACER,name:Vt.CREATE_MIC_AUDIO_TRACK,options:[t]}),n=l_(t),o=gr(8,"track-mic-");let c=null;N.info("start create microphone audio track with config",at(t),"trackId",o),Wt("info",["AgoraRTC"],"createMicrophoneAudioTrack",t);try{c=(await eo({audio:n},o)).getAudioTracks()[0]||null}catch(d){throw e.onError(d),d}if(!c){const d=new Q(U.UNEXPECTED_ERROR,"can not find track in media stream");return e.onError(d),d.throw()}const u=new Ks(c,t,n,o);return e.onSuccess(u.getTrackId()),N.info("create microphone audio track success, trackId:",o),Wt("info",["AgoraRTC"],"createMicrophoneAudioTrack",t,o),u},createCustomAudioTrack:function(t){const e=it.reportApiInvoke(null,{tag:Ut.TRACER,name:Vt.CREATE_CUSTOM_AUDIO_TRACK,options:[t]}),n=new lr(t.mediaStreamTrack,t.encoderConfig?ld(t.encoderConfig):{});return N.info("create custom audio track success with config",t,"trackId",n.getTrackId()),Wt("info",["AgoraRTC"],"createCustomAudioTrack",t,n.getTrackId()),e.onSuccess(n.getTrackId()),n},createBufferSourceAudioTrack:async function(t){const e=it.reportApiInvoke(null,{tag:Ut.TRACER,name:Vt.CREATE_BUFFER_AUDIO_TRACK,options:[t]}),n=gr(8,"track-buf-");N.info("start create buffer source audio track with config",at(t),"trackId",n),Wt("info",[],"createBufferSourceAudioTrack",t);const o=t.source;if(!(t.source instanceof AudioBuffer))try{t.source=await G2(t.source,t.cacheOnlineFile)}catch(d){return e.onError(d),d.throw()}const c=new E1(t.source),u=new Hs(o,c,t.encoderConfig?ld(t.encoderConfig):{},n);return N.info("create buffer source audio track success, trackId:",n),Wt("info",["AgoraRTC"],"createBufferSourceAudioTrack",void 0,n),e.onSuccess(u.getTrackId()),u},setLogLevel:function(t){ot("USE_NEW_LOG")?function(e){e=Math.min(Math.max(0,e),4),TI=e}(t):N.setLogLevel(t)},enableLogUpload:function(){ot("USE_NEW_LOG")?In("UPLOAD_LOG",!0):N.enableLogUpload()},disableLogUpload:function(){ot("USE_NEW_LOG")?In("UPLOAD_LOG",!1):N.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new n_},checkAudioTrackIsActive:async function(t,e=5e3){const n=it.reportApiInvoke(null,{tag:Ut.TRACER,name:Vt.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[e]});if(!(t instanceof lr||t instanceof Vl)){const f=new Q(U.INVALID_TRACK,"the parameter is not a audio track");return n.onError(f),f.throw()}e&&e<1e3&&(e=1e3);const o=t instanceof lr?t.getTrackLabel():"remote_track",c=t.getVolumeLevel();let u=c,d=c;const p=kt();return new ct(f=>{const g=fO(()=>{const E=t.getVolumeLevel();u=E>u?E:u,d=E<d?E:d;const I=u-d>1e-4,_=kt()-p;if(I||_>e){var T;clearInterval(g);const R=I,w={duration:_,deviceLabel:o,maxVolumeLevel:u,result:R};N.info(M(T="[track-".concat(t.getTrackId(),"] check audio track active completed. ")).call(T,at(w))),n.onSuccess(w),f(R)}},200)})},checkVideoTrackIsActive:async function(t,e=5e3){var n;const o=it.reportApiInvoke(null,{tag:Ut.TRACER,name:Vt.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[e]});if(!(t instanceof We||t instanceof Fl)){const _=new Q(U.INVALID_TRACK,"the parameter is not a video track");return o.onError(_),_.throw()}e&&e<1e3&&(e=1e3);const c=t instanceof We?t.getTrackLabel():"remote_track",u=t.getMediaStreamTrack(!0),d=document.createElement("video");d.style.width="1px",d.style.height="1px",d.setAttribute("muted",""),d.muted=!0,d.setAttribute("playsinline",""),d.controls=!1,(Ei()||Hu())&&(d.style.opacity="0.01",d.style.position="fixed",d.style.left="0",d.style.top="0",document.body.appendChild(d)),d.srcObject=new MediaStream([u]),d.play();const p=document.createElement("canvas");p.width=160,p.height=120;let f=0,g=0;try{const _=kt();f=await function(T,R,w,k){let L,Y=0,Z=null;return new ct((rt,ut)=>{function At(){Y>k&&L&&(L(),rt(Y));const Ct=w.getContext("2d");if(!Ct){const wt=new Q(U.UNEXPECTED_ERROR,"can not get canvas 2d context.");return N.error(wt.toString()),void ut(wt)}Ct.drawImage(T,0,0,160,120);const lt=Ct.getImageData(0,0,w.width,w.height),Gt=Math.floor(lt.data.length/3);if(Z){for(let wt=0;wt<Gt;wt+=3)if(lt.data[wt]!==Z[wt])return Y+=1,void(Z=lt.data);Z=lt.data}else Z=lt.data}Vr(()=>{L&&(L(),rt(Y))},R),L=OA(()=>{At()},30)})}(d,e,p,4),g=kt()-_}catch(_){throw o.onError(_),_}gO===be.SAFARI&&(d.pause(),d.remove()),d.srcObject=null;const E=f>4,I={duration:g,changedPicNum:f,deviceLabel:c,result:E};return N.info(M(n="[track-".concat(t.getTrackId(),"] check video track active completed. ")).call(n,at(I))),o.onSuccess(I),E},setArea:function(t){const e=it.reportApiInvoke(null,{name:Vt.SET_AREA,options:t,tag:Ut.TRACER});try{var n;let o=[];if(typeof t=="string"&&(o=[t]),sn(t)&&(G(t).call(t,u=>{if(!Xt(GI).call(GI,u))throw new Q(U.INVALID_PARAMS,"invalid area code")}),o=t),Object.prototype.toString.call(t)==="[object Object]"){const{areaCode:u,excludedArea:d}=t;if(!u)throw new Q(U.INVALID_PARAMS,"area code is needed");let p=u;typeof u=="string"&&(p=[u]),o=d?yN(p,d):p}In("AREAS",o);const c=(u=>{const d={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return ht(u).call(u,p=>{const f=fA[p],g=ue(f);g&&ht(g).call(g,E=>{var I;E!=="CODE"&&(d[E]=M(I=d[E]).call(I,f[E]))})}),d})(o);ht(n=ue(c)).call(n,u=>{u==="LOG_UPLOAD_SERVER"||u==="EVENT_REPORT_DOMAIN"||u==="EVENT_REPORT_BACKUP_DOMAIN"||u==="PROXY_SERVER_TYPE3"?In(u,c[u][0]):In(u,c[u])}),N.debug("set area success:",o.join(","))}catch(o){throw e.onError(o),o}e.onSuccess()},loadModule:async function(t,e){var n;if(N.debug(M(n="loadModule: ".concat(t.name,", loadOption: ")).call(n,at(e))),!t.moduleInit)throw N.debug("Invalid Plugin"),new Q(U.INVALID_PLUGIN,"invalid plugin");try{md.installPlugin(t),await t.moduleInit({logger:N,report:it,pluginCenter:md,getParameter:ot},e)}catch(o){throw new Q(U.UNEXPECTED_ERROR,"unexpected error in loadModule",o)}},audioElementPlayCenter:ci,processExternalMediaAEC:function(t){vO.processExternalMediaAEC(t)},ChannelMediaRelayError:Vs,ChannelMediaRelayEvent:So,ChannelMediaRelayState:Bn,RemoteStreamFallbackType:AA,RemoteStreamType:pA,ConnectionDisconnectedReason:un,AudienceLatencyLevelType:aA,AREAS:Ne};return dr(vs,{onAudioAutoplayFailed:{get:()=>yi.onAudioAutoplayFailed,set:t=>{yi.onAudioAutoplayFailed=t}},onAutoplayFailed:{get:()=>yi.onAutoplayFailed,set:t=>{yi.onAutoplayFailed=t}}}),ai.on(ds.CAMERA_DEVICE_CHANGED,t=>{N.info("camera device changed",at(t)),vs.onCameraChanged&&vs.onCameraChanged(t)}),ai.on(ds.RECORDING_DEVICE_CHANGED,t=>{N.info("microphone device changed",at(t)),vs.onMicrophoneChanged&&vs.onMicrophoneChanged(t)}),ai.on(ds.PLAYOUT_DEVICE_CHANGED,t=>{N.debug("playout device changed",at(t)),vs.onPlaybackDeviceChanged&&vs.onPlaybackDeviceChanged(t)}),ci.onAutoplayFailed=()=>{N.info("detect audio element autoplay failed"),yi.onAudioAutoplayFailed&&yi.onAudioAutoplayFailed()},he.on("autoplay-failed",()=>{N.info("detect webaudio autoplay failed"),yi.onAudioAutoplayFailed&&yi.onAudioAutoplayFailed()}),window&&(window.__ARTC__=vs),vs})})(jT);var hg=PO(jT.exports);const UU=(i={token:null,channelName:null})=>{const r=w0(),s=i.token||r.token;return hk.request({url:"client/user/pub/videoToken",params:{uni_id_token:s,channelName:i.channelName}})},QU={props:{id:{type:String,default:""}},setup(i){const r=i,s=pk();w0();let a=th({});const l=th({uid:1,name:"a",hasOpenVideo:Uc(!1),hasOpenAudio:Uc(!1),videoTrack:null,audioTrack:null,isShow:!0}),h=async X=>{X.isShow=!1,X.hasOpenVideo&&X.videoTrack&&(X.videoTrack.stop(),X.videoTrack.close(),X.uid===l.uid&&v.unpublish(l.videoTrack)),X.hasOpenAudio&&X.audioTrack&&(X.audioTrack.stop(),X.audioTrack.close(),X.uid===l.uid&&v.unpublish(l.audioTrack))},A=async X=>{const K=X.uid;if(K===l.uid){if(!l.audioTrack){await O();return}l.hasOpenAudio?(l.audioTrack.setEnabled(!1),l.hasOpenAudio=!1):(l.audioTrack.setEnabled(!0),l.hasOpenAudio=!0);return}a[K].hasAudio?a[K].hasOpenAudio?(a[K].audioTrack.stop(),a[K].hasOpenAudio=!1):(a[K].audioTrack.play(),a[K].hasOpenAudio=!0):a[K].hasOpenAudio=!1},m=async X=>{const K=X.uid;if(K===l.uid){if(!l.videoTrack){await b();return}l.hasOpenVideo?(l.videoTrack.setEnabled(!1),l.hasOpenVideo=!1):(l.videoTrack.setEnabled(!0),l.hasOpenVideo=!0);return}a[K].hasVideo&&(a[K].hasOpenVideo?(a[K].videoTrack.stop(),a[K].hasOpenVideo=!1):(a[K].videoTrack.play(`player-${K}`),a[K].hasOpenVideo=!0))};let v=null,C=th({audioTrack:null,videoTrack:null});Fg(async()=>{v=hg.createClient({codec:"vp8",mode:"rtc"}),v.on("user-published",S),v.on("user-unpublished",F),v.on("user-left",W);const X=await UU({channelName:r.id}),{token:K,uid:_t}=X.data;l.uid=await v.join(s.liveOptions.APPID,r.id,K,_t),await b(),await O()}),y0(async()=>{await $()});async function S(X,K){const _t=X.uid;a[_t]||(a[_t]=X),P(X,K)}async function b(){C.videoTrack=await hg.createCameraVideoTrack().catch(X=>{}),C.videoTrack&&(l.hasOpenVideo=!0,l.isShow=!0,C.videoTrack.play("player-"+l.uid),l.videoTrack=C.videoTrack,v.publish(C.videoTrack))}async function O(){C.audioTrack=await hg.createMicrophoneAudioTrack().catch(X=>{}),C.audioTrack&&(l.hasOpenAudio=!0,l.audioTrack=C.audioTrack,v.publish(C.audioTrack))}async function P(X,K){const _t=X.uid;await v.subscribe(X,K),K==="video"&&(a[_t].isShow=!0,await I0(),a[_t].videoTrack.play(`player-${_t}`),a[_t].hasOpenVideo=!0),K==="audio"&&(a[_t].audioTrack.play(),a[_t].hasOpenAudio=!0)}async function F(X){const K=X.uid;a[K].hasVideo?a[K].hasAudio||(a[K].hasOpenAudio=!1):a[K].isShow=!1}async function W(X){const K=X.uid;a[K].isShow=!1,a[K].hasOpenVideo&&a[K].videoTrack&&a[K].videoTrack.stop(),a[K].hasOpenAudio&&a[K].audioTrack&&a[K].audioTrack.stop(),delete a[K];for(const _t in a)if(Object.hasOwnProperty.call(a,_t)){const H=a[_t];if(H.hasVideo){P(H,"video");break}}}async function $(){for(const X in C){let K=C[X];K&&(K.stop(),K.close(),C[X]=void 0)}a={},await v.leave()}return(X,K)=>(Un(),Hi($s,null,[(Un(!0),Hi($s,null,C0(Da(a),(_t,H,ft)=>(Un(),Hi($s,{key:_t.uid},[_t.isShow?(Un(),ch(v0,{key:0,"live-user":_t,onVideo:Tt=>m(_t),onAudio:Tt=>A(_t),onClose:Tt=>h(_t),name:_t.uid+"","class-name":"w-80 h-60 "+(ft==0?"bottom-[calc(100vh-19rem)]":"bottom-[calc(100vh-34.6rem)]")},null,8,["live-user","onVideo","onAudio","onClose","name","class-name"])):pg("",!0)],64))),128)),Da(l).isShow?(Un(),ch(v0,{key:0,"live-user":Da(l),onVideo:K[0]||(K[0]=_t=>m(Da(l))),onAudio:K[1]||(K[1]=_t=>A(Da(l))),onClose:K[2]||(K[2]=_t=>h(Da(l)))},null,8,["live-user"])):pg("",!0)],64))}},FU={class:"pt-16 w-screen h-screen overflow-hidden"},WU={props:{id:{type:String,default:""}},setup(i){return(r,s)=>(Un(),Hi($s,null,[Ts(dk),uo("div",FU,[Ts(bU,{class:"h-full"})]),(Un(),ch(UO,null,{default:xO(()=>[Ts(QU,{id:i.id},null,8,["id"])]),_:1}))],64))}};export{WU as default};
