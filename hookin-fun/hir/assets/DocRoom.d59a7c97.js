var xw=Object.defineProperty,Uw=Object.defineProperties;var Fw=Object.getOwnPropertyDescriptors;var gd=Object.getOwnPropertySymbols;var NI=Object.prototype.hasOwnProperty,kI=Object.prototype.propertyIsEnumerable;var OI=(n,e,t)=>e in n?xw(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,ie=(n,e)=>{for(var t in e||(e={}))NI.call(e,t)&&OI(n,t,e[t]);if(gd)for(var t of gd(e))kI.call(e,t)&&OI(n,t,e[t]);return n},On=(n,e)=>Uw(n,Fw(e));var bI=(n,e)=>{var t={};for(var o in n)NI.call(n,o)&&e.indexOf(o)<0&&(t[o]=n[o]);if(n!=null&&gd)for(var o of gd(n))e.indexOf(o)<0&&kI.call(n,o)&&(t[o]=n[o]);return t};import{h as Sl,n as ta,_ as fA,a1 as gA,a2 as ra,w as Vw,a3 as DI,a as Bi,a4 as Gw,a5 as jw,m as Tl,a6 as Hw,a7 as Kw,r as md,o as vr,c as bn,g as Dn,z as uc,F as Ko,t as mA,s as dc,a8 as Ww,f as Qt,x as BI,y as Rl,b as vA,v as hc,a9 as Yw,aa as qw,ab as Jw,ac as zw,p as MI,e as LI,P as Xw,$ as Zw,a0 as PI,ad as $w,J as eN,ae as tN,af as rN,Z as EA,ag as nN,ah as iN}from"./vendor.7d5dc9bc.js";import{c as oN,i as sN,d as aN,s as cN,e as QI,t as xI,S as UI,f as lN,Y as Wo,m as uN,g as ps,k as dN,h as hN,j as pN,l as wl,o as AN,I as FI,C as fN,n as gN,p as mN,b as IA,R as CA,q as yA,u as vN,r as EN,a as IN,v as CN,w as yN,x as _N,y as Nl,z as VI,A as GI,U as SN,B as TN,E as RN,D as wN,W as NN}from"./y-websocket.27d58116.js";import{_ as kl,S as na,a as _A,h as kN,u as ON}from"./index.ae500a61.js";const bN=n=>class{constructor(t){this._=t}destroy(){n(this._)}},DN=bN(clearTimeout),BN=(n,e)=>new DN(setTimeout(e,n));function mn(n){this.content=n}mn.prototype={constructor:mn,find:function(n){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===n)return e;return-1},get:function(n){var e=this.find(n);return e==-1?void 0:this.content[e+1]},update:function(n,e,t){var o=t&&t!=n?this.remove(t):this,a=o.find(n),l=o.content.slice();return a==-1?l.push(t||n,e):(l[a+1]=e,t&&(l[a]=t)),new mn(l)},remove:function(n){var e=this.find(n);if(e==-1)return this;var t=this.content.slice();return t.splice(e,2),new mn(t)},addToStart:function(n,e){return new mn([n,e].concat(this.remove(n).content))},addToEnd:function(n,e){var t=this.remove(n).content.slice();return t.push(n,e),new mn(t)},addBefore:function(n,e,t){var o=this.remove(e),a=o.content.slice(),l=o.find(n);return a.splice(l==-1?a.length:l,0,e,t),new mn(a)},forEach:function(n){for(var e=0;e<this.content.length;e+=2)n(this.content[e],this.content[e+1])},prepend:function(n){return n=mn.from(n),n.size?new mn(n.content.concat(this.subtract(n).content)):this},append:function(n){return n=mn.from(n),n.size?new mn(this.subtract(n).content.concat(n.content)):this},subtract:function(n){var e=this;n=mn.from(n);for(var t=0;t<n.content.length;t+=2)e=e.remove(n.content[t]);return e},get size(){return this.content.length>>1}};mn.from=function(n){if(n instanceof mn)return n;var e=[];if(n)for(var t in n)e.push(t,n[t]);return new mn(e)};var jI=mn;function HI(n,e,t){for(var o=0;;o++){if(o==n.childCount||o==e.childCount)return n.childCount==e.childCount?null:t;var a=n.child(o),l=e.child(o);if(a==l){t+=a.nodeSize;continue}if(!a.sameMarkup(l))return t;if(a.isText&&a.text!=l.text){for(var d=0;a.text[d]==l.text[d];d++)t++;return t}if(a.content.size||l.content.size){var p=HI(a.content,l.content,t+1);if(p!=null)return p}t+=a.nodeSize}}function KI(n,e,t,o){for(var a=n.childCount,l=e.childCount;;){if(a==0||l==0)return a==l?null:{a:t,b:o};var d=n.child(--a),p=e.child(--l),g=d.nodeSize;if(d==p){t-=g,o-=g;continue}if(!d.sameMarkup(p))return{a:t,b:o};if(d.isText&&d.text!=p.text){for(var v=0,C=Math.min(d.text.length,p.text.length);v<C&&d.text[d.text.length-v-1]==p.text[p.text.length-v-1];)v++,t--,o--;return{a:t,b:o}}if(d.content.size||p.content.size){var y=KI(d.content,p.content,t-1,o-1);if(y)return y}t-=g,o-=g}}var ee=function(e,t){if(this.content=e,this.size=t||0,t==null)for(var o=0;o<e.length;o++)this.size+=e[o].nodeSize},vd={firstChild:{configurable:!0},lastChild:{configurable:!0},childCount:{configurable:!0}};ee.prototype.nodesBetween=function(e,t,o,a,l){a===void 0&&(a=0);for(var d=0,p=0;p<t;d++){var g=this.content[d],v=p+g.nodeSize;if(v>e&&o(g,a+p,l,d)!==!1&&g.content.size){var C=p+1;g.nodesBetween(Math.max(0,e-C),Math.min(g.content.size,t-C),o,a+C)}p=v}};ee.prototype.descendants=function(e){this.nodesBetween(0,this.size,e)};ee.prototype.textBetween=function(e,t,o,a){var l="",d=!0;return this.nodesBetween(e,t,function(p,g){p.isText?(l+=p.text.slice(Math.max(e,g)-g,t-g),d=!o):p.isLeaf&&a?(l+=typeof a=="function"?a(p):a,d=!o):!d&&p.isBlock&&(l+=o,d=!0)},0),l};ee.prototype.append=function(e){if(!e.size)return this;if(!this.size)return e;var t=this.lastChild,o=e.firstChild,a=this.content.slice(),l=0;for(t.isText&&t.sameMarkup(o)&&(a[a.length-1]=t.withText(t.text+o.text),l=1);l<e.content.length;l++)a.push(e.content[l]);return new ee(a,this.size+e.size)};ee.prototype.cut=function(e,t){if(t==null&&(t=this.size),e==0&&t==this.size)return this;var o=[],a=0;if(t>e)for(var l=0,d=0;d<t;l++){var p=this.content[l],g=d+p.nodeSize;g>e&&((d<e||g>t)&&(p.isText?p=p.cut(Math.max(0,e-d),Math.min(p.text.length,t-d)):p=p.cut(Math.max(0,e-d-1),Math.min(p.content.size,t-d-1))),o.push(p),a+=p.nodeSize),d=g}return new ee(o,a)};ee.prototype.cutByIndex=function(e,t){return e==t?ee.empty:e==0&&t==this.content.length?this:new ee(this.content.slice(e,t))};ee.prototype.replaceChild=function(e,t){var o=this.content[e];if(o==t)return this;var a=this.content.slice(),l=this.size+t.nodeSize-o.nodeSize;return a[e]=t,new ee(a,l)};ee.prototype.addToStart=function(e){return new ee([e].concat(this.content),this.size+e.nodeSize)};ee.prototype.addToEnd=function(e){return new ee(this.content.concat(e),this.size+e.nodeSize)};ee.prototype.eq=function(e){if(this.content.length!=e.content.length)return!1;for(var t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0};vd.firstChild.get=function(){return this.content.length?this.content[0]:null};vd.lastChild.get=function(){return this.content.length?this.content[this.content.length-1]:null};vd.childCount.get=function(){return this.content.length};ee.prototype.child=function(e){var t=this.content[e];if(!t)throw new RangeError("Index "+e+" out of range for "+this);return t};ee.prototype.maybeChild=function(e){return this.content[e]};ee.prototype.forEach=function(e){for(var t=0,o=0;t<this.content.length;t++){var a=this.content[t];e(a,o,t),o+=a.nodeSize}};ee.prototype.findDiffStart=function(e,t){return t===void 0&&(t=0),HI(this,e,t)};ee.prototype.findDiffEnd=function(e,t,o){return t===void 0&&(t=this.size),o===void 0&&(o=e.size),KI(this,e,t,o)};ee.prototype.findIndex=function(e,t){if(t===void 0&&(t=-1),e==0)return Ed(0,e);if(e==this.size)return Ed(this.content.length,e);if(e>this.size||e<0)throw new RangeError("Position "+e+" outside of fragment ("+this+")");for(var o=0,a=0;;o++){var l=this.child(o),d=a+l.nodeSize;if(d>=e)return d==e||t>0?Ed(o+1,d):Ed(o,a);a=d}};ee.prototype.toString=function(){return"<"+this.toStringInner()+">"};ee.prototype.toStringInner=function(){return this.content.join(", ")};ee.prototype.toJSON=function(){return this.content.length?this.content.map(function(e){return e.toJSON()}):null};ee.fromJSON=function(e,t){if(!t)return ee.empty;if(!Array.isArray(t))throw new RangeError("Invalid input for Fragment.fromJSON");return new ee(t.map(e.nodeFromJSON))};ee.fromArray=function(e){if(!e.length)return ee.empty;for(var t,o=0,a=0;a<e.length;a++){var l=e[a];o+=l.nodeSize,a&&l.isText&&e[a-1].sameMarkup(l)?(t||(t=e.slice(0,a)),t[t.length-1]=l.withText(t[t.length-1].text+l.text)):t&&t.push(l)}return new ee(t||e,o)};ee.from=function(e){if(!e)return ee.empty;if(e instanceof ee)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new ee([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))};Object.defineProperties(ee.prototype,vd);var SA={index:0,offset:0};function Ed(n,e){return SA.index=n,SA.offset=e,SA}ee.empty=new ee([],0);function Id(n,e){if(n===e)return!0;if(!(n&&typeof n=="object")||!(e&&typeof e=="object"))return!1;var t=Array.isArray(n);if(Array.isArray(e)!=t)return!1;if(t){if(n.length!=e.length)return!1;for(var o=0;o<n.length;o++)if(!Id(n[o],e[o]))return!1}else{for(var a in n)if(!(a in e)||!Id(n[a],e[a]))return!1;for(var l in e)if(!(l in n))return!1}return!0}var Et=function(e,t){this.type=e,this.attrs=t};Et.prototype.addToSet=function(e){for(var t,o=!1,a=0;a<e.length;a++){var l=e[a];if(this.eq(l))return e;if(this.type.excludes(l.type))t||(t=e.slice(0,a));else{if(l.type.excludes(this.type))return e;!o&&l.type.rank>this.type.rank&&(t||(t=e.slice(0,a)),t.push(this),o=!0),t&&t.push(l)}}return t||(t=e.slice()),o||t.push(this),t};Et.prototype.removeFromSet=function(e){for(var t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e};Et.prototype.isInSet=function(e){for(var t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1};Et.prototype.eq=function(e){return this==e||this.type==e.type&&Id(this.attrs,e.attrs)};Et.prototype.toJSON=function(){var e={type:this.type.name};for(var t in this.attrs){e.attrs=this.attrs;break}return e};Et.fromJSON=function(e,t){if(!t)throw new RangeError("Invalid input for Mark.fromJSON");var o=e.marks[t.type];if(!o)throw new RangeError("There is no mark type "+t.type+" in this schema");return o.create(t.attrs)};Et.sameSet=function(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(var o=0;o<e.length;o++)if(!e[o].eq(t[o]))return!1;return!0};Et.setFrom=function(e){if(!e||e.length==0)return Et.none;if(e instanceof Et)return[e];var t=e.slice();return t.sort(function(o,a){return o.type.rank-a.type.rank}),t};Et.none=[];function Co(n){var e=Error.call(this,n);return e.__proto__=Co.prototype,e}Co.prototype=Object.create(Error.prototype);Co.prototype.constructor=Co;Co.prototype.name="ReplaceError";var ye=function(e,t,o){this.content=e,this.openStart=t,this.openEnd=o},WI={size:{configurable:!0}};WI.size.get=function(){return this.content.size-this.openStart-this.openEnd};ye.prototype.insertAt=function(e,t){var o=qI(this.content,e+this.openStart,t,null);return o&&new ye(o,this.openStart,this.openEnd)};ye.prototype.removeBetween=function(e,t){return new ye(YI(this.content,e+this.openStart,t+this.openStart),this.openStart,this.openEnd)};ye.prototype.eq=function(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd};ye.prototype.toString=function(){return this.content+"("+this.openStart+","+this.openEnd+")"};ye.prototype.toJSON=function(){if(!this.content.size)return null;var e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e};ye.fromJSON=function(e,t){if(!t)return ye.empty;var o=t.openStart||0,a=t.openEnd||0;if(typeof o!="number"||typeof a!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new ye(ee.fromJSON(e,t.content),o,a)};ye.maxOpen=function(e,t){t===void 0&&(t=!0);for(var o=0,a=0,l=e.firstChild;l&&!l.isLeaf&&(t||!l.type.spec.isolating);l=l.firstChild)o++;for(var d=e.lastChild;d&&!d.isLeaf&&(t||!d.type.spec.isolating);d=d.lastChild)a++;return new ye(e,o,a)};Object.defineProperties(ye.prototype,WI);function YI(n,e,t){var o=n.findIndex(e),a=o.index,l=o.offset,d=n.maybeChild(a),p=n.findIndex(t),g=p.index,v=p.offset;if(l==e||d.isText){if(v!=t&&!n.child(g).isText)throw new RangeError("Removing non-flat range");return n.cut(0,e).append(n.cut(t))}if(a!=g)throw new RangeError("Removing non-flat range");return n.replaceChild(a,d.copy(YI(d.content,e-l-1,t-l-1)))}function qI(n,e,t,o){var a=n.findIndex(e),l=a.index,d=a.offset,p=n.maybeChild(l);if(d==e||p.isText)return o&&!o.canReplace(l,l,t)?null:n.cut(0,e).append(t).append(n.cut(e));var g=qI(p.content,e-d-1,t);return g&&n.replaceChild(l,p.copy(g))}ye.empty=new ye(ee.empty,0,0);function MN(n,e,t){if(t.openStart>n.depth)throw new Co("Inserted content deeper than insertion position");if(n.depth-t.openStart!=e.depth-t.openEnd)throw new Co("Inconsistent open depths");return JI(n,e,t,0)}function JI(n,e,t,o){var a=n.index(o),l=n.node(o);if(a==e.index(o)&&o<n.depth-t.openStart){var d=JI(n,e,t,o+1);return l.copy(l.content.replaceChild(a,d))}else if(t.content.size)if(!t.openStart&&!t.openEnd&&n.depth==o&&e.depth==o){var p=n.parent,g=p.content;return oa(p,g.cut(0,n.parentOffset).append(t.content).append(g.cut(e.parentOffset)))}else{var v=LN(t,n),C=v.start,y=v.end;return oa(l,XI(n,C,y,e,o))}else return oa(l,Cd(n,e,o))}function zI(n,e){if(!e.type.compatibleContent(n.type))throw new Co("Cannot join "+e.type.name+" onto "+n.type.name)}function TA(n,e,t){var o=n.node(t);return zI(o,e.node(t)),o}function ia(n,e){var t=e.length-1;t>=0&&n.isText&&n.sameMarkup(e[t])?e[t]=n.withText(e[t].text+n.text):e.push(n)}function Ol(n,e,t,o){var a=(e||n).node(t),l=0,d=e?e.index(t):a.childCount;n&&(l=n.index(t),n.depth>t?l++:n.textOffset&&(ia(n.nodeAfter,o),l++));for(var p=l;p<d;p++)ia(a.child(p),o);e&&e.depth==t&&e.textOffset&&ia(e.nodeBefore,o)}function oa(n,e){if(!n.type.validContent(e))throw new Co("Invalid content for node "+n.type.name);return n.copy(e)}function XI(n,e,t,o,a){var l=n.depth>a&&TA(n,e,a+1),d=o.depth>a&&TA(t,o,a+1),p=[];return Ol(null,n,a,p),l&&d&&e.index(a)==t.index(a)?(zI(l,d),ia(oa(l,XI(n,e,t,o,a+1)),p)):(l&&ia(oa(l,Cd(n,e,a+1)),p),Ol(e,t,a,p),d&&ia(oa(d,Cd(t,o,a+1)),p)),Ol(o,null,a,p),new ee(p)}function Cd(n,e,t){var o=[];if(Ol(null,n,t,o),n.depth>t){var a=TA(n,e,t+1);ia(oa(a,Cd(n,e,t+1)),o)}return Ol(e,null,t,o),new ee(o)}function LN(n,e){for(var t=e.depth-n.openStart,o=e.node(t),a=o.copy(n.content),l=t-1;l>=0;l--)a=e.node(l).copy(ee.from(a));return{start:a.resolveNoCache(n.openStart+t),end:a.resolveNoCache(a.content.size-n.openEnd-t)}}var tr=function(e,t,o){this.pos=e,this.path=t,this.depth=t.length/3-1,this.parentOffset=o},pc={parent:{configurable:!0},doc:{configurable:!0},textOffset:{configurable:!0},nodeAfter:{configurable:!0},nodeBefore:{configurable:!0}};tr.prototype.resolveDepth=function(e){return e==null?this.depth:e<0?this.depth+e:e};pc.parent.get=function(){return this.node(this.depth)};pc.doc.get=function(){return this.node(0)};tr.prototype.node=function(e){return this.path[this.resolveDepth(e)*3]};tr.prototype.index=function(e){return this.path[this.resolveDepth(e)*3+1]};tr.prototype.indexAfter=function(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)};tr.prototype.start=function(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1};tr.prototype.end=function(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size};tr.prototype.before=function(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]};tr.prototype.after=function(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize};pc.textOffset.get=function(){return this.pos-this.path[this.path.length-1]};pc.nodeAfter.get=function(){var n=this.parent,e=this.index(this.depth);if(e==n.childCount)return null;var t=this.pos-this.path[this.path.length-1],o=n.child(e);return t?n.child(e).cut(t):o};pc.nodeBefore.get=function(){var n=this.index(this.depth),e=this.pos-this.path[this.path.length-1];return e?this.parent.child(n).cut(0,e):n==0?null:this.parent.child(n-1)};tr.prototype.posAtIndex=function(e,t){t=this.resolveDepth(t);for(var o=this.path[t*3],a=t==0?0:this.path[t*3-1]+1,l=0;l<e;l++)a+=o.child(l).nodeSize;return a};tr.prototype.marks=function(){var e=this.parent,t=this.index();if(e.content.size==0)return Et.none;if(this.textOffset)return e.child(t).marks;var o=e.maybeChild(t-1),a=e.maybeChild(t);if(!o){var l=o;o=a,a=l}for(var d=o.marks,p=0;p<d.length;p++)d[p].type.spec.inclusive===!1&&(!a||!d[p].isInSet(a.marks))&&(d=d[p--].removeFromSet(d));return d};tr.prototype.marksAcross=function(e){var t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;for(var o=t.marks,a=e.parent.maybeChild(e.index()),l=0;l<o.length;l++)o[l].type.spec.inclusive===!1&&(!a||!o[l].isInSet(a.marks))&&(o=o[l--].removeFromSet(o));return o};tr.prototype.sharedDepth=function(e){for(var t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0};tr.prototype.blockRange=function(e,t){if(e===void 0&&(e=this),e.pos<this.pos)return e.blockRange(this);for(var o=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);o>=0;o--)if(e.pos<=this.end(o)&&(!t||t(this.node(o))))return new bl(this,e,o)};tr.prototype.sameParent=function(e){return this.pos-this.parentOffset==e.pos-e.parentOffset};tr.prototype.max=function(e){return e.pos>this.pos?e:this};tr.prototype.min=function(e){return e.pos<this.pos?e:this};tr.prototype.toString=function(){for(var e="",t=1;t<=this.depth;t++)e+=(e?"/":"")+this.node(t).type.name+"_"+this.index(t-1);return e+":"+this.parentOffset};tr.resolve=function(e,t){if(!(t>=0&&t<=e.content.size))throw new RangeError("Position "+t+" out of range");for(var o=[],a=0,l=t,d=e;;){var p=d.content.findIndex(l),g=p.index,v=p.offset,C=l-v;if(o.push(d,g,a+v),!C||(d=d.child(g),d.isText))break;l=C-1,a+=v+1}return new tr(t,o,l)};tr.resolveCached=function(e,t){for(var o=0;o<RA.length;o++){var a=RA[o];if(a.pos==t&&a.doc==e)return a}var l=RA[wA]=tr.resolve(e,t);return wA=(wA+1)%PN,l};Object.defineProperties(tr.prototype,pc);var RA=[],wA=0,PN=12,bl=function(e,t,o){this.$from=e,this.$to=t,this.depth=o},Ac={start:{configurable:!0},end:{configurable:!0},parent:{configurable:!0},startIndex:{configurable:!0},endIndex:{configurable:!0}};Ac.start.get=function(){return this.$from.before(this.depth+1)};Ac.end.get=function(){return this.$to.after(this.depth+1)};Ac.parent.get=function(){return this.$from.node(this.depth)};Ac.startIndex.get=function(){return this.$from.index(this.depth)};Ac.endIndex.get=function(){return this.$to.indexAfter(this.depth)};Object.defineProperties(bl.prototype,Ac);var QN=Object.create(null),_t=function(e,t,o,a){this.type=e,this.attrs=t,this.content=o||ee.empty,this.marks=a||Et.none},pi={nodeSize:{configurable:!0},childCount:{configurable:!0},textContent:{configurable:!0},firstChild:{configurable:!0},lastChild:{configurable:!0},isBlock:{configurable:!0},isTextblock:{configurable:!0},inlineContent:{configurable:!0},isInline:{configurable:!0},isText:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};pi.nodeSize.get=function(){return this.isLeaf?1:2+this.content.size};pi.childCount.get=function(){return this.content.childCount};_t.prototype.child=function(e){return this.content.child(e)};_t.prototype.maybeChild=function(e){return this.content.maybeChild(e)};_t.prototype.forEach=function(e){this.content.forEach(e)};_t.prototype.nodesBetween=function(e,t,o,a){a===void 0&&(a=0),this.content.nodesBetween(e,t,o,a,this)};_t.prototype.descendants=function(e){this.nodesBetween(0,this.content.size,e)};pi.textContent.get=function(){return this.textBetween(0,this.content.size,"")};_t.prototype.textBetween=function(e,t,o,a){return this.content.textBetween(e,t,o,a)};pi.firstChild.get=function(){return this.content.firstChild};pi.lastChild.get=function(){return this.content.lastChild};_t.prototype.eq=function(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)};_t.prototype.sameMarkup=function(e){return this.hasMarkup(e.type,e.attrs,e.marks)};_t.prototype.hasMarkup=function(e,t,o){return this.type==e&&Id(this.attrs,t||e.defaultAttrs||QN)&&Et.sameSet(this.marks,o||Et.none)};_t.prototype.copy=function(e){return e===void 0&&(e=null),e==this.content?this:new this.constructor(this.type,this.attrs,e,this.marks)};_t.prototype.mark=function(e){return e==this.marks?this:new this.constructor(this.type,this.attrs,this.content,e)};_t.prototype.cut=function(e,t){return e==0&&t==this.content.size?this:this.copy(this.content.cut(e,t))};_t.prototype.slice=function(e,t,o){if(t===void 0&&(t=this.content.size),o===void 0&&(o=!1),e==t)return ye.empty;var a=this.resolve(e),l=this.resolve(t),d=o?0:a.sharedDepth(t),p=a.start(d),g=a.node(d),v=g.content.cut(a.pos-p,l.pos-p);return new ye(v,a.depth-d,l.depth-d)};_t.prototype.replace=function(e,t,o){return MN(this.resolve(e),this.resolve(t),o)};_t.prototype.nodeAt=function(e){for(var t=this;;){var o=t.content.findIndex(e),a=o.index,l=o.offset;if(t=t.maybeChild(a),!t)return null;if(l==e||t.isText)return t;e-=l+1}};_t.prototype.childAfter=function(e){var t=this.content.findIndex(e),o=t.index,a=t.offset;return{node:this.content.maybeChild(o),index:o,offset:a}};_t.prototype.childBefore=function(e){if(e==0)return{node:null,index:0,offset:0};var t=this.content.findIndex(e),o=t.index,a=t.offset;if(a<e)return{node:this.content.child(o),index:o,offset:a};var l=this.content.child(o-1);return{node:l,index:o-1,offset:a-l.nodeSize}};_t.prototype.resolve=function(e){return tr.resolveCached(this,e)};_t.prototype.resolveNoCache=function(e){return tr.resolve(this,e)};_t.prototype.rangeHasMark=function(e,t,o){var a=!1;return t>e&&this.nodesBetween(e,t,function(l){return o.isInSet(l.marks)&&(a=!0),!a}),a};pi.isBlock.get=function(){return this.type.isBlock};pi.isTextblock.get=function(){return this.type.isTextblock};pi.inlineContent.get=function(){return this.type.inlineContent};pi.isInline.get=function(){return this.type.isInline};pi.isText.get=function(){return this.type.isText};pi.isLeaf.get=function(){return this.type.isLeaf};pi.isAtom.get=function(){return this.type.isAtom};_t.prototype.toString=function(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);var e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),ZI(this.marks,e)};_t.prototype.contentMatchAt=function(e){var t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw new Error("Called contentMatchAt on a node with invalid content");return t};_t.prototype.canReplace=function(e,t,o,a,l){o===void 0&&(o=ee.empty),a===void 0&&(a=0),l===void 0&&(l=o.childCount);var d=this.contentMatchAt(e).matchFragment(o,a,l),p=d&&d.matchFragment(this.content,t);if(!p||!p.validEnd)return!1;for(var g=a;g<l;g++)if(!this.type.allowsMarks(o.child(g).marks))return!1;return!0};_t.prototype.canReplaceWith=function(e,t,o,a){if(a&&!this.type.allowsMarks(a))return!1;var l=this.contentMatchAt(e).matchType(o),d=l&&l.matchFragment(this.content,t);return d?d.validEnd:!1};_t.prototype.canAppend=function(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)};_t.prototype.check=function(){if(!this.type.validContent(this.content))throw new RangeError("Invalid content for node "+this.type.name+": "+this.content.toString().slice(0,50));for(var e=Et.none,t=0;t<this.marks.length;t++)e=this.marks[t].addToSet(e);if(!Et.sameSet(e,this.marks))throw new RangeError("Invalid collection of marks for node "+this.type.name+": "+this.marks.map(function(o){return o.type.name}));this.content.forEach(function(o){return o.check()})};_t.prototype.toJSON=function(){var e={type:this.type.name};for(var t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(function(o){return o.toJSON()})),e};_t.fromJSON=function(e,t){if(!t)throw new RangeError("Invalid input for Node.fromJSON");var o=null;if(t.marks){if(!Array.isArray(t.marks))throw new RangeError("Invalid mark data for Node.fromJSON");o=t.marks.map(e.markFromJSON)}if(t.type=="text"){if(typeof t.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(t.text,o)}var a=ee.fromJSON(e,t.content);return e.nodeType(t.type).create(t.attrs,a,o)};Object.defineProperties(_t.prototype,pi);var xN=function(n){function e(o,a,l,d){if(n.call(this,o,a,null,d),!l)throw new RangeError("Empty text nodes are not allowed");this.text=l}n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e;var t={textContent:{configurable:!0},nodeSize:{configurable:!0}};return e.prototype.toString=function(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):ZI(this.marks,JSON.stringify(this.text))},t.textContent.get=function(){return this.text},e.prototype.textBetween=function(a,l){return this.text.slice(a,l)},t.nodeSize.get=function(){return this.text.length},e.prototype.mark=function(a){return a==this.marks?this:new e(this.type,this.attrs,this.text,a)},e.prototype.withText=function(a){return a==this.text?this:new e(this.type,this.attrs,a,this.marks)},e.prototype.cut=function(a,l){return a===void 0&&(a=0),l===void 0&&(l=this.text.length),a==0&&l==this.text.length?this:this.withText(this.text.slice(a,l))},e.prototype.eq=function(a){return this.sameMarkup(a)&&this.text==a.text},e.prototype.toJSON=function(){var a=n.prototype.toJSON.call(this);return a.text=this.text,a},Object.defineProperties(e.prototype,t),e}(_t);function ZI(n,e){for(var t=n.length-1;t>=0;t--)e=n[t].type.name+"("+e+")";return e}var vn=function(e){this.validEnd=e,this.next=[],this.wrapCache=[]},yd={inlineContent:{configurable:!0},defaultType:{configurable:!0},edgeCount:{configurable:!0}};vn.parse=function(e,t){var o=new _d(e,t);if(o.next==null)return vn.empty;var a=eC(o);o.next&&o.err("Unexpected trailing text");var l=KN(HN(a));return WN(l,o),l};vn.prototype.matchType=function(e){for(var t=0;t<this.next.length;t+=2)if(this.next[t]==e)return this.next[t+1];return null};vn.prototype.matchFragment=function(e,t,o){t===void 0&&(t=0),o===void 0&&(o=e.childCount);for(var a=this,l=t;a&&l<o;l++)a=a.matchType(e.child(l).type);return a};yd.inlineContent.get=function(){var n=this.next[0];return n?n.isInline:!1};yd.defaultType.get=function(){for(var n=0;n<this.next.length;n+=2){var e=this.next[n];if(!(e.isText||e.hasRequiredAttrs()))return e}};vn.prototype.compatible=function(e){for(var t=0;t<this.next.length;t+=2)for(var o=0;o<e.next.length;o+=2)if(this.next[t]==e.next[o])return!0;return!1};vn.prototype.fillBefore=function(e,t,o){t===void 0&&(t=!1),o===void 0&&(o=0);var a=[this];function l(d,p){var g=d.matchFragment(e,o);if(g&&(!t||g.validEnd))return ee.from(p.map(function(O){return O.createAndFill()}));for(var v=0;v<d.next.length;v+=2){var C=d.next[v],y=d.next[v+1];if(!(C.isText||C.hasRequiredAttrs())&&a.indexOf(y)==-1){a.push(y);var w=l(y,p.concat(C));if(w)return w}}}return l(this,[])};vn.prototype.findWrapping=function(e){for(var t=0;t<this.wrapCache.length;t+=2)if(this.wrapCache[t]==e)return this.wrapCache[t+1];var o=this.computeWrapping(e);return this.wrapCache.push(e,o),o};vn.prototype.computeWrapping=function(e){for(var t=Object.create(null),o=[{match:this,type:null,via:null}];o.length;){var a=o.shift(),l=a.match;if(l.matchType(e)){for(var d=[],p=a;p.type;p=p.via)d.push(p.type);return d.reverse()}for(var g=0;g<l.next.length;g+=2){var v=l.next[g];!v.isLeaf&&!v.hasRequiredAttrs()&&!(v.name in t)&&(!a.type||l.next[g+1].validEnd)&&(o.push({match:v.contentMatch,type:v,via:a}),t[v.name]=!0)}}};yd.edgeCount.get=function(){return this.next.length>>1};vn.prototype.edge=function(e){var t=e<<1;if(t>=this.next.length)throw new RangeError("There's no "+e+"th edge in this content match");return{type:this.next[t],next:this.next[t+1]}};vn.prototype.toString=function(){var e=[];function t(o){e.push(o);for(var a=1;a<o.next.length;a+=2)e.indexOf(o.next[a])==-1&&t(o.next[a])}return t(this),e.map(function(o,a){for(var l=a+(o.validEnd?"*":" ")+" ",d=0;d<o.next.length;d+=2)l+=(d?", ":"")+o.next[d].name+"->"+e.indexOf(o.next[d+1]);return l}).join(`
`)};Object.defineProperties(vn.prototype,yd);vn.empty=new vn(!0);var _d=function(e,t){this.string=e,this.nodeTypes=t,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()},$I={next:{configurable:!0}};$I.next.get=function(){return this.tokens[this.pos]};_d.prototype.eat=function(e){return this.next==e&&(this.pos++||!0)};_d.prototype.err=function(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")};Object.defineProperties(_d.prototype,$I);function eC(n){var e=[];do e.push(UN(n));while(n.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function UN(n){var e=[];do e.push(FN(n));while(n.next&&n.next!=")"&&n.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function FN(n){for(var e=jN(n);;)if(n.eat("+"))e={type:"plus",expr:e};else if(n.eat("*"))e={type:"star",expr:e};else if(n.eat("?"))e={type:"opt",expr:e};else if(n.eat("{"))e=VN(n,e);else break;return e}function tC(n){/\D/.test(n.next)&&n.err("Expected number, got '"+n.next+"'");var e=Number(n.next);return n.pos++,e}function VN(n,e){var t=tC(n),o=t;return n.eat(",")&&(n.next!="}"?o=tC(n):o=-1),n.eat("}")||n.err("Unclosed braced range"),{type:"range",min:t,max:o,expr:e}}function GN(n,e){var t=n.nodeTypes,o=t[e];if(o)return[o];var a=[];for(var l in t){var d=t[l];d.groups.indexOf(e)>-1&&a.push(d)}return a.length==0&&n.err("No node type or group '"+e+"' found"),a}function jN(n){if(n.eat("(")){var e=eC(n);return n.eat(")")||n.err("Missing closing paren"),e}else if(/\W/.test(n.next))n.err("Unexpected token '"+n.next+"'");else{var t=GN(n,n.next).map(function(o){return n.inline==null?n.inline=o.isInline:n.inline!=o.isInline&&n.err("Mixing inline and block content"),{type:"name",value:o}});return n.pos++,t.length==1?t[0]:{type:"choice",exprs:t}}}function HN(n){var e=[[]];return a(l(n,0),t()),e;function t(){return e.push([])-1}function o(d,p,g){var v={term:g,to:p};return e[d].push(v),v}function a(d,p){d.forEach(function(g){return g.to=p})}function l(d,p){if(d.type=="choice")return d.exprs.reduce(function(K,F){return K.concat(l(F,p))},[]);if(d.type=="seq")for(var g=0;;g++){var v=l(d.exprs[g],p);if(g==d.exprs.length-1)return v;a(v,p=t())}else if(d.type=="star"){var C=t();return o(p,C),a(l(d.expr,C),C),[o(C)]}else if(d.type=="plus"){var y=t();return a(l(d.expr,p),y),a(l(d.expr,y),y),[o(y)]}else{if(d.type=="opt")return[o(p)].concat(l(d.expr,p));if(d.type=="range"){for(var w=p,O=0;O<d.min;O++){var M=t();a(l(d.expr,w),M),w=M}if(d.max==-1)a(l(d.expr,w),w);else for(var x=d.min;x<d.max;x++){var G=t();o(w,G),a(l(d.expr,w),G),w=G}return[o(w)]}else if(d.type=="name")return[o(p,null,d.value)]}}}function rC(n,e){return e-n}function nC(n,e){var t=[];return o(e),t.sort(rC);function o(a){var l=n[a];if(l.length==1&&!l[0].term)return o(l[0].to);t.push(a);for(var d=0;d<l.length;d++){var p=l[d],g=p.term,v=p.to;!g&&t.indexOf(v)==-1&&o(v)}}}function KN(n){var e=Object.create(null);return t(nC(n,0));function t(o){var a=[];o.forEach(function(g){n[g].forEach(function(v){var C=v.term,y=v.to;if(!!C){var w=a.indexOf(C),O=w>-1&&a[w+1];nC(n,y).forEach(function(M){O||a.push(C,O=[]),O.indexOf(M)==-1&&O.push(M)})}})});for(var l=e[o.join(",")]=new vn(o.indexOf(n.length-1)>-1),d=0;d<a.length;d+=2){var p=a[d+1].sort(rC);l.next.push(a[d],e[p.join(",")]||t(p))}return l}}function WN(n,e){for(var t=0,o=[n];t<o.length;t++){for(var a=o[t],l=!a.validEnd,d=[],p=0;p<a.next.length;p+=2){var g=a.next[p],v=a.next[p+1];d.push(g.name),l&&!(g.isText||g.hasRequiredAttrs())&&(l=!1),o.indexOf(v)==-1&&o.push(v)}l&&e.err("Only non-generatable nodes ("+d.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function iC(n){var e=Object.create(null);for(var t in n){var o=n[t];if(!o.hasDefault)return null;e[t]=o.default}return e}function oC(n,e){var t=Object.create(null);for(var o in n){var a=e&&e[o];if(a===void 0){var l=n[o];if(l.hasDefault)a=l.default;else throw new RangeError("No value supplied for attribute "+o)}t[o]=a}return t}function sC(n){var e=Object.create(null);if(n)for(var t in n)e[t]=new aC(n[t]);return e}var Bn=function(e,t,o){this.name=e,this.schema=t,this.spec=o,this.groups=o.group?o.group.split(" "):[],this.attrs=sC(o.attrs),this.defaultAttrs=iC(this.attrs),this.contentMatch=null,this.markSet=null,this.inlineContent=null,this.isBlock=!(o.inline||e=="text"),this.isText=e=="text"},Dl={isInline:{configurable:!0},isTextblock:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};Dl.isInline.get=function(){return!this.isBlock};Dl.isTextblock.get=function(){return this.isBlock&&this.inlineContent};Dl.isLeaf.get=function(){return this.contentMatch==vn.empty};Dl.isAtom.get=function(){return this.isLeaf||this.spec.atom};Bn.prototype.hasRequiredAttrs=function(){for(var e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1};Bn.prototype.compatibleContent=function(e){return this==e||this.contentMatch.compatible(e.contentMatch)};Bn.prototype.computeAttrs=function(e){return!e&&this.defaultAttrs?this.defaultAttrs:oC(this.attrs,e)};Bn.prototype.create=function(e,t,o){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new _t(this,this.computeAttrs(e),ee.from(t),Et.setFrom(o))};Bn.prototype.createChecked=function(e,t,o){if(t=ee.from(t),!this.validContent(t))throw new RangeError("Invalid content for node "+this.name);return new _t(this,this.computeAttrs(e),t,Et.setFrom(o))};Bn.prototype.createAndFill=function(e,t,o){if(e=this.computeAttrs(e),t=ee.from(t),t.size){var a=this.contentMatch.fillBefore(t);if(!a)return null;t=a.append(t)}var l=this.contentMatch.matchFragment(t).fillBefore(ee.empty,!0);return l?new _t(this,e,t.append(l),Et.setFrom(o)):null};Bn.prototype.validContent=function(e){var t=this.contentMatch.matchFragment(e);if(!t||!t.validEnd)return!1;for(var o=0;o<e.childCount;o++)if(!this.allowsMarks(e.child(o).marks))return!1;return!0};Bn.prototype.allowsMarkType=function(e){return this.markSet==null||this.markSet.indexOf(e)>-1};Bn.prototype.allowsMarks=function(e){if(this.markSet==null)return!0;for(var t=0;t<e.length;t++)if(!this.allowsMarkType(e[t].type))return!1;return!0};Bn.prototype.allowedMarks=function(e){if(this.markSet==null)return e;for(var t,o=0;o<e.length;o++)this.allowsMarkType(e[o].type)?t&&t.push(e[o]):t||(t=e.slice(0,o));return t?t.length?t:Et.empty:e};Bn.compile=function(e,t){var o=Object.create(null);e.forEach(function(d,p){return o[d]=new Bn(d,t,p)});var a=t.spec.topNode||"doc";if(!o[a])throw new RangeError("Schema is missing its top node type ('"+a+"')");if(!o.text)throw new RangeError("Every schema needs a 'text' type");for(var l in o.text.attrs)throw new RangeError("The text node type should not have attributes");return o};Object.defineProperties(Bn.prototype,Dl);var aC=function(e){this.hasDefault=Object.prototype.hasOwnProperty.call(e,"default"),this.default=e.default},cC={isRequired:{configurable:!0}};cC.isRequired.get=function(){return!this.hasDefault};Object.defineProperties(aC.prototype,cC);var As=function(e,t,o,a){this.name=e,this.schema=o,this.spec=a,this.attrs=sC(a.attrs),this.rank=t,this.excluded=null;var l=iC(this.attrs);this.instance=l&&new Et(this,l)};As.prototype.create=function(e){return!e&&this.instance?this.instance:new Et(this,oC(this.attrs,e))};As.compile=function(e,t){var o=Object.create(null),a=0;return e.forEach(function(l,d){return o[l]=new As(l,a++,t,d)}),o};As.prototype.removeFromSet=function(e){for(var t=0;t<e.length;t++)e[t].type==this&&(e=e.slice(0,t).concat(e.slice(t+1)),t--);return e};As.prototype.isInSet=function(e){for(var t=0;t<e.length;t++)if(e[t].type==this)return e[t]};As.prototype.excludes=function(e){return this.excluded.indexOf(e)>-1};var sa=function(e){this.spec={};for(var t in e)this.spec[t]=e[t];this.spec.nodes=jI.from(e.nodes),this.spec.marks=jI.from(e.marks),this.nodes=Bn.compile(this.spec.nodes,this),this.marks=As.compile(this.spec.marks,this);var o=Object.create(null);for(var a in this.nodes){if(a in this.marks)throw new RangeError(a+" can not be both a node and a mark");var l=this.nodes[a],d=l.spec.content||"",p=l.spec.marks;l.contentMatch=o[d]||(o[d]=vn.parse(d,this.nodes)),l.inlineContent=l.contentMatch.inlineContent,l.markSet=p=="_"?null:p?lC(this,p.split(" ")):p==""||!l.inlineContent?[]:null}for(var g in this.marks){var v=this.marks[g],C=v.spec.excludes;v.excluded=C==null?[v]:C==""?[]:lC(this,C.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached=Object.create(null),this.cached.wrappings=Object.create(null)};sa.prototype.node=function(e,t,o,a){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof Bn){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(t,o,a)};sa.prototype.text=function(e,t){var o=this.nodes.text;return new xN(o,o.defaultAttrs,e,Et.setFrom(t))};sa.prototype.mark=function(e,t){return typeof e=="string"&&(e=this.marks[e]),e.create(t)};sa.prototype.nodeFromJSON=function(e){return _t.fromJSON(this,e)};sa.prototype.markFromJSON=function(e){return Et.fromJSON(this,e)};sa.prototype.nodeType=function(e){var t=this.nodes[e];if(!t)throw new RangeError("Unknown node type: "+e);return t};function lC(n,e){for(var t=[],o=0;o<e.length;o++){var a=e[o],l=n.marks[a],d=l;if(l)t.push(l);else for(var p in n.marks){var g=n.marks[p];(a=="_"||g.spec.group&&g.spec.group.split(" ").indexOf(a)>-1)&&t.push(d=g)}if(!d)throw new SyntaxError("Unknown mark type: '"+e[o]+"'")}return t}var Zi=function(e,t){var o=this;this.schema=e,this.rules=t,this.tags=[],this.styles=[],t.forEach(function(a){a.tag?o.tags.push(a):a.style&&o.styles.push(a)}),this.normalizeLists=!this.tags.some(function(a){if(!/^(ul|ol)\b/.test(a.tag)||!a.node)return!1;var l=e.nodes[a.node];return l.contentMatch.matchType(l)})};Zi.prototype.parse=function(e,t){t===void 0&&(t={});var o=new zt(this,t,!1);return o.addAll(e,null,t.from,t.to),o.finish()};Zi.prototype.parseSlice=function(e,t){t===void 0&&(t={});var o=new zt(this,t,!0);return o.addAll(e,null,t.from,t.to),ye.maxOpen(o.finish())};Zi.prototype.matchTag=function(e,t,o){for(var a=o?this.tags.indexOf(o)+1:0;a<this.tags.length;a++){var l=this.tags[a];if(JN(e,l.tag)&&(l.namespace===void 0||e.namespaceURI==l.namespace)&&(!l.context||t.matchesContext(l.context))){if(l.getAttrs){var d=l.getAttrs(e);if(d===!1)continue;l.attrs=d}return l}}};Zi.prototype.matchStyle=function(e,t,o,a){for(var l=a?this.styles.indexOf(a)+1:0;l<this.styles.length;l++){var d=this.styles[l];if(!(d.style.indexOf(e)!=0||d.context&&!o.matchesContext(d.context)||d.style.length>e.length&&(d.style.charCodeAt(e.length)!=61||d.style.slice(e.length+1)!=t))){if(d.getAttrs){var p=d.getAttrs(t);if(p===!1)continue;d.attrs=p}return d}}};Zi.schemaRules=function(e){var t=[];function o(g){for(var v=g.priority==null?50:g.priority,C=0;C<t.length;C++){var y=t[C],w=y.priority==null?50:y.priority;if(w<v)break}t.splice(C,0,g)}var a=function(g){var v=e.marks[g].spec.parseDOM;v&&v.forEach(function(C){o(C=hC(C)),C.mark=g})};for(var l in e.marks)a(l);var d=function(g){var v=e.nodes[p].spec.parseDOM;v&&v.forEach(function(C){o(C=hC(C)),C.node=p})};for(var p in e.nodes)d();return t};Zi.fromSchema=function(e){return e.cached.domParser||(e.cached.domParser=new Zi(e,Zi.schemaRules(e)))};var NA={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},YN={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},uC={ol:!0,ul:!0},kA=1,OA=2,Bl=4;function dC(n){return(n?kA:0)|(n==="full"?OA:0)}var Yo=function(e,t,o,a,l,d,p){this.type=e,this.attrs=t,this.solid=l,this.match=d||(p&Bl?null:e.contentMatch),this.options=p,this.content=[],this.marks=o,this.activeMarks=Et.none,this.pendingMarks=a,this.stashMarks=[]};Yo.prototype.findWrapping=function(e){if(!this.match){if(!this.type)return[];var t=this.type.contentMatch.fillBefore(ee.from(e));if(t)this.match=this.type.contentMatch.matchFragment(t);else{var o=this.type.contentMatch,a;return(a=o.findWrapping(e.type))?(this.match=o,a):null}}return this.match.findWrapping(e.type)};Yo.prototype.finish=function(e){if(!(this.options&kA)){var t=this.content[this.content.length-1],o;t&&t.isText&&(o=/[ \t\r\n\u000c]+$/.exec(t.text))&&(t.text.length==o[0].length?this.content.pop():this.content[this.content.length-1]=t.withText(t.text.slice(0,t.text.length-o[0].length)))}var a=ee.from(this.content);return!e&&this.match&&(a=a.append(this.match.fillBefore(ee.empty,!0))),this.type?this.type.create(this.attrs,a,this.marks):a};Yo.prototype.popFromStashMark=function(e){for(var t=this.stashMarks.length-1;t>=0;t--)if(e.eq(this.stashMarks[t]))return this.stashMarks.splice(t,1)[0]};Yo.prototype.applyPending=function(e){for(var t=0,o=this.pendingMarks;t<o.length;t++){var a=o[t];(this.type?this.type.allowsMarkType(a.type):XN(a.type,e))&&!a.isInSet(this.activeMarks)&&(this.activeMarks=a.addToSet(this.activeMarks),this.pendingMarks=a.removeFromSet(this.pendingMarks))}};Yo.prototype.inlineContext=function(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!NA.hasOwnProperty(e.parentNode.nodeName.toLowerCase())};var zt=function(e,t,o){this.parser=e,this.options=t,this.isOpen=o;var a=t.topNode,l,d=dC(t.preserveWhitespace)|(o?Bl:0);a?l=new Yo(a.type,a.attrs,Et.none,Et.none,!0,t.topMatch||a.type.contentMatch,d):o?l=new Yo(null,null,Et.none,Et.none,!0,null,d):l=new Yo(e.schema.topNodeType,null,Et.none,Et.none,!0,null,d),this.nodes=[l],this.open=0,this.find=t.findPositions,this.needsBlock=!1},bA={top:{configurable:!0},currentPos:{configurable:!0}};bA.top.get=function(){return this.nodes[this.open]};zt.prototype.addDOM=function(e){if(e.nodeType==3)this.addTextNode(e);else if(e.nodeType==1){var t=e.getAttribute("style"),o=t?this.readStyles(zN(t)):null,a=this.top;if(o!=null)for(var l=0;l<o.length;l++)this.addPendingMark(o[l]);if(this.addElement(e),o!=null)for(var d=0;d<o.length;d++)this.removePendingMark(o[d],a)}};zt.prototype.addTextNode=function(e){var t=e.nodeValue,o=this.top;if(o.options&OA||o.inlineContext(e)||/[^ \t\r\n\u000c]/.test(t)){if(o.options&kA)o.options&OA?t=t.replace(/\r\n?/g,`
`):t=t.replace(/\r?\n|\r/g," ");else if(t=t.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(t)&&this.open==this.nodes.length-1){var a=o.content[o.content.length-1],l=e.previousSibling;(!a||l&&l.nodeName=="BR"||a.isText&&/[ \t\r\n\u000c]$/.test(a.text))&&(t=t.slice(1))}t&&this.insertNode(this.parser.schema.text(t)),this.findInText(e)}else this.findInside(e)};zt.prototype.addElement=function(e,t){var o=e.nodeName.toLowerCase(),a;uC.hasOwnProperty(o)&&this.parser.normalizeLists&&qN(e);var l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(a=this.parser.matchTag(e,this,t));if(l?l.ignore:YN.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);var d,p=this.top,g=this.needsBlock;if(NA.hasOwnProperty(o))d=!0,p.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e);return}this.addAll(e),d&&this.sync(p),this.needsBlock=g}else this.addElementByRule(e,l,l.consuming===!1?a:null)};zt.prototype.leafFallback=function(e){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`))};zt.prototype.ignoreFallback=function(e){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"))};zt.prototype.readStyles=function(e){var t=Et.none;e:for(var o=0;o<e.length;o+=2)for(var a=null;;){var l=this.parser.matchStyle(e[o],e[o+1],this,a);if(!l)continue e;if(l.ignore)return null;if(t=this.parser.schema.marks[l.mark].create(l.attrs).addToSet(t),l.consuming===!1)a=l;else break}return t};zt.prototype.addElementByRule=function(e,t,o){var a=this,l,d,p,g;t.node?(d=this.parser.schema.nodes[t.node],d.isLeaf?this.insertNode(d.create(t.attrs))||this.leafFallback(e):l=this.enter(d,t.attrs,t.preserveWhitespace)):(p=this.parser.schema.marks[t.mark],g=p.create(t.attrs),this.addPendingMark(g));var v=this.top;if(d&&d.isLeaf)this.findInside(e);else if(o)this.addElement(e,o);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach(function(y){return a.insertNode(y)});else{var C=t.contentElement;typeof C=="string"?C=e.querySelector(C):typeof C=="function"&&(C=C(e)),C||(C=e),this.findAround(e,C,!0),this.addAll(C,l)}l&&(this.sync(v),this.open--),g&&this.removePendingMark(g,v)};zt.prototype.addAll=function(e,t,o,a){for(var l=o||0,d=o?e.childNodes[o]:e.firstChild,p=a==null?null:e.childNodes[a];d!=p;d=d.nextSibling,++l)this.findAtPoint(e,l),this.addDOM(d),t&&NA.hasOwnProperty(d.nodeName.toLowerCase())&&this.sync(t);this.findAtPoint(e,l)};zt.prototype.findPlace=function(e){for(var t,o,a=this.open;a>=0;a--){var l=this.nodes[a],d=l.findWrapping(e);if(d&&(!t||t.length>d.length)&&(t=d,o=l,!d.length)||l.solid)break}if(!t)return!1;this.sync(o);for(var p=0;p<t.length;p++)this.enterInner(t[p],null,!1);return!0};zt.prototype.insertNode=function(e){if(e.isInline&&this.needsBlock&&!this.top.type){var t=this.textblockFromContext();t&&this.enterInner(t)}if(this.findPlace(e)){this.closeExtra();var o=this.top;o.applyPending(e.type),o.match&&(o.match=o.match.matchType(e.type));for(var a=o.activeMarks,l=0;l<e.marks.length;l++)(!o.type||o.type.allowsMarkType(e.marks[l].type))&&(a=e.marks[l].addToSet(a));return o.content.push(e.mark(a)),!0}return!1};zt.prototype.enter=function(e,t,o){var a=this.findPlace(e.create(t));return a&&this.enterInner(e,t,!0,o),a};zt.prototype.enterInner=function(e,t,o,a){this.closeExtra();var l=this.top;l.applyPending(e),l.match=l.match&&l.match.matchType(e,t);var d=a==null?l.options&~Bl:dC(a);l.options&Bl&&l.content.length==0&&(d|=Bl),this.nodes.push(new Yo(e,t,l.activeMarks,l.pendingMarks,o,null,d)),this.open++};zt.prototype.closeExtra=function(e){var t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}};zt.prototype.finish=function(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)};zt.prototype.sync=function(e){for(var t=this.open;t>=0;t--)if(this.nodes[t]==e){this.open=t;return}};bA.currentPos.get=function(){this.closeExtra();for(var n=0,e=this.open;e>=0;e--){for(var t=this.nodes[e].content,o=t.length-1;o>=0;o--)n+=t[o].nodeSize;e&&n++}return n};zt.prototype.findAtPoint=function(e,t){if(this.find)for(var o=0;o<this.find.length;o++)this.find[o].node==e&&this.find[o].offset==t&&(this.find[o].pos=this.currentPos)};zt.prototype.findInside=function(e){if(this.find)for(var t=0;t<this.find.length;t++)this.find[t].pos==null&&e.nodeType==1&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)};zt.prototype.findAround=function(e,t,o){if(e!=t&&this.find){for(var a=0;a<this.find.length;a++)if(this.find[a].pos==null&&e.nodeType==1&&e.contains(this.find[a].node)){var l=t.compareDocumentPosition(this.find[a].node);l&(o?2:4)&&(this.find[a].pos=this.currentPos)}}};zt.prototype.findInText=function(e){if(this.find)for(var t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))};zt.prototype.matchesContext=function(e){var t=this;if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);var o=e.split("/"),a=this.options.context,l=!this.isOpen&&(!a||a.parent.type==this.nodes[0].type),d=-(a?a.depth+1:0)+(l?0:1),p=function(g,v){for(;g>=0;g--){var C=o[g];if(C==""){if(g==o.length-1||g==0)continue;for(;v>=d;v--)if(p(g-1,v))return!0;return!1}else{var y=v>0||v==0&&l?t.nodes[v].type:a&&v>=d?a.node(v-d).type:null;if(!y||y.name!=C&&y.groups.indexOf(C)==-1)return!1;v--}}return!0};return p(o.length-1,this.open)};zt.prototype.textblockFromContext=function(){var e=this.options.context;if(e)for(var t=e.depth;t>=0;t--){var o=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(o&&o.isTextblock&&o.defaultAttrs)return o}for(var a in this.parser.schema.nodes){var l=this.parser.schema.nodes[a];if(l.isTextblock&&l.defaultAttrs)return l}};zt.prototype.addPendingMark=function(e){var t=ZN(e,this.top.pendingMarks);t&&this.top.stashMarks.push(t),this.top.pendingMarks=e.addToSet(this.top.pendingMarks)};zt.prototype.removePendingMark=function(e,t){for(var o=this.open;o>=0;o--){var a=this.nodes[o],l=a.pendingMarks.lastIndexOf(e);if(l>-1)a.pendingMarks=e.removeFromSet(a.pendingMarks);else{a.activeMarks=e.removeFromSet(a.activeMarks);var d=a.popFromStashMark(e);d&&a.type&&a.type.allowsMarkType(d.type)&&(a.activeMarks=d.addToSet(a.activeMarks))}if(a==t)break}};Object.defineProperties(zt.prototype,bA);function qN(n){for(var e=n.firstChild,t=null;e;e=e.nextSibling){var o=e.nodeType==1?e.nodeName.toLowerCase():null;o&&uC.hasOwnProperty(o)&&t?(t.appendChild(e),e=t):o=="li"?t=e:o&&(t=null)}}function JN(n,e){return(n.matches||n.msMatchesSelector||n.webkitMatchesSelector||n.mozMatchesSelector).call(n,e)}function zN(n){for(var e=/\s*([\w-]+)\s*:\s*([^;]+)/g,t,o=[];t=e.exec(n);)o.push(t[1],t[2].trim());return o}function hC(n){var e={};for(var t in n)e[t]=n[t];return e}function XN(n,e){var t=e.schema.nodes,o=function(d){var p=t[d];if(!!p.allowsMarkType(n)){var g=[],v=function(C){g.push(C);for(var y=0;y<C.edgeCount;y++){var w=C.edge(y),O=w.type,M=w.next;if(O==e||g.indexOf(M)<0&&v(M))return!0}};if(v(p.contentMatch))return{v:!0}}};for(var a in t){var l=o(a);if(l)return l.v}}function ZN(n,e){for(var t=0;t<e.length;t++)if(n.eq(e[t]))return e[t]}var tn=function(e,t){this.nodes=e||{},this.marks=t||{}};tn.prototype.serializeFragment=function(e,t,o){var a=this;t===void 0&&(t={}),o||(o=DA(t).createDocumentFragment());var l=o,d=null;return e.forEach(function(p){if(d||p.marks.length){d||(d=[]);for(var g=0,v=0;g<d.length&&v<p.marks.length;){var C=p.marks[v];if(!a.marks[C.type.name]){v++;continue}if(!C.eq(d[g])||C.type.spec.spanning===!1)break;g+=2,v++}for(;g<d.length;)l=d.pop(),d.pop();for(;v<p.marks.length;){var y=p.marks[v++],w=a.serializeMark(y,p.isInline,t);w&&(d.push(y,l),l.appendChild(w.dom),l=w.contentDOM||w.dom)}}l.appendChild(a.serializeNodeInner(p,t))}),o};tn.prototype.serializeNodeInner=function(e,t){t===void 0&&(t={});var o=tn.renderSpec(DA(t),this.nodes[e.type.name](e)),a=o.dom,l=o.contentDOM;if(l){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");t.onContent?t.onContent(e,l,t):this.serializeFragment(e.content,t,l)}return a};tn.prototype.serializeNode=function(e,t){t===void 0&&(t={});for(var o=this.serializeNodeInner(e,t),a=e.marks.length-1;a>=0;a--){var l=this.serializeMark(e.marks[a],e.isInline,t);l&&((l.contentDOM||l.dom).appendChild(o),o=l.dom)}return o};tn.prototype.serializeMark=function(e,t,o){o===void 0&&(o={});var a=this.marks[e.type.name];return a&&tn.renderSpec(DA(o),a(e,t))};tn.renderSpec=function(e,t,o){if(o===void 0&&(o=null),typeof t=="string")return{dom:e.createTextNode(t)};if(t.nodeType!=null)return{dom:t};if(t.dom&&t.dom.nodeType!=null)return t;var a=t[0],l=a.indexOf(" ");l>0&&(o=a.slice(0,l),a=a.slice(l+1));var d=null,p=o?e.createElementNS(o,a):e.createElement(a),g=t[1],v=1;if(g&&typeof g=="object"&&g.nodeType==null&&!Array.isArray(g)){v=2;for(var C in g)if(g[C]!=null){var y=C.indexOf(" ");y>0?p.setAttributeNS(C.slice(0,y),C.slice(y+1),g[C]):p.setAttribute(C,g[C])}}for(var w=v;w<t.length;w++){var O=t[w];if(O===0){if(w<t.length-1||w>v)throw new RangeError("Content hole must be the only child of its parent node");return{dom:p,contentDOM:p}}else{var M=tn.renderSpec(e,O,o),x=M.dom,G=M.contentDOM;if(p.appendChild(x),G){if(d)throw new RangeError("Multiple content holes");d=G}}}return{dom:p,contentDOM:d}};tn.fromSchema=function(e){return e.cached.domSerializer||(e.cached.domSerializer=new tn(this.nodesFromSchema(e),this.marksFromSchema(e)))};tn.nodesFromSchema=function(e){var t=pC(e.nodes);return t.text||(t.text=function(o){return o.text}),t};tn.marksFromSchema=function(e){return pC(e.marks)};function pC(n){var e={};for(var t in n){var o=n[t].spec.toDOM;o&&(e[t]=o)}return e}function DA(n){return n.document||window.document}var AC=65535,fC=Math.pow(2,16);function $N(n,e){return n+e*fC}function gC(n){return n&AC}function ek(n){return(n-(n&AC))/fC}var BA=function(e,t,o){t===void 0&&(t=!1),o===void 0&&(o=null),this.pos=e,this.deleted=t,this.recover=o},rn=function(e,t){t===void 0&&(t=!1),this.ranges=e,this.inverted=t};rn.prototype.recover=function(e){var t=0,o=gC(e);if(!this.inverted)for(var a=0;a<o;a++)t+=this.ranges[a*3+2]-this.ranges[a*3+1];return this.ranges[o*3]+t+ek(e)};rn.prototype.mapResult=function(e,t){return t===void 0&&(t=1),this._map(e,t,!1)};rn.prototype.map=function(e,t){return t===void 0&&(t=1),this._map(e,t,!0)};rn.prototype._map=function(e,t,o){for(var a=0,l=this.inverted?2:1,d=this.inverted?1:2,p=0;p<this.ranges.length;p+=3){var g=this.ranges[p]-(this.inverted?a:0);if(g>e)break;var v=this.ranges[p+l],C=this.ranges[p+d],y=g+v;if(e<=y){var w=v?e==g?-1:e==y?1:t:t,O=g+a+(w<0?0:C);if(o)return O;var M=e==(t<0?g:y)?null:$N(p/3,e-g);return new BA(O,t<0?e!=g:e!=y,M)}a+=C-v}return o?e+a:new BA(e+a)};rn.prototype.touches=function(e,t){for(var o=0,a=gC(t),l=this.inverted?2:1,d=this.inverted?1:2,p=0;p<this.ranges.length;p+=3){var g=this.ranges[p]-(this.inverted?o:0);if(g>e)break;var v=this.ranges[p+l],C=g+v;if(e<=C&&p==a*3)return!0;o+=this.ranges[p+d]-v}return!1};rn.prototype.forEach=function(e){for(var t=this.inverted?2:1,o=this.inverted?1:2,a=0,l=0;a<this.ranges.length;a+=3){var d=this.ranges[a],p=d-(this.inverted?l:0),g=d+(this.inverted?0:l),v=this.ranges[a+t],C=this.ranges[a+o];e(p,p+v,g,g+C),l+=C-v}};rn.prototype.invert=function(){return new rn(this.ranges,!this.inverted)};rn.prototype.toString=function(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)};rn.offset=function(e){return e==0?rn.empty:new rn(e<0?[0,-e,0]:[0,0,e])};rn.empty=new rn([]);var En=function(e,t,o,a){this.maps=e||[],this.from=o||0,this.to=a==null?this.maps.length:a,this.mirror=t};En.prototype.slice=function(e,t){return e===void 0&&(e=0),t===void 0&&(t=this.maps.length),new En(this.maps,this.mirror,e,t)};En.prototype.copy=function(){return new En(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)};En.prototype.appendMap=function(e,t){this.to=this.maps.push(e),t!=null&&this.setMirror(this.maps.length-1,t)};En.prototype.appendMapping=function(e){for(var t=0,o=this.maps.length;t<e.maps.length;t++){var a=e.getMirror(t);this.appendMap(e.maps[t],a!=null&&a<t?o+a:null)}};En.prototype.getMirror=function(e){if(this.mirror){for(var t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}};En.prototype.setMirror=function(e,t){this.mirror||(this.mirror=[]),this.mirror.push(e,t)};En.prototype.appendMappingInverted=function(e){for(var t=e.maps.length-1,o=this.maps.length+e.maps.length;t>=0;t--){var a=e.getMirror(t);this.appendMap(e.maps[t].invert(),a!=null&&a>t?o-a-1:null)}};En.prototype.invert=function(){var e=new En;return e.appendMappingInverted(this),e};En.prototype.map=function(e,t){if(t===void 0&&(t=1),this.mirror)return this._map(e,t,!0);for(var o=this.from;o<this.to;o++)e=this.maps[o].map(e,t);return e};En.prototype.mapResult=function(e,t){return t===void 0&&(t=1),this._map(e,t,!1)};En.prototype._map=function(e,t,o){for(var a=!1,l=this.from;l<this.to;l++){var d=this.maps[l],p=d.mapResult(e,t);if(p.recover!=null){var g=this.getMirror(l);if(g!=null&&g>l&&g<this.to){l=g,e=this.maps[g].recover(p.recover);continue}}p.deleted&&(a=!0),e=p.pos}return o?e:new BA(e,a)};function fc(n){var e=Error.call(this,n);return e.__proto__=fc.prototype,e}fc.prototype=Object.create(Error.prototype);fc.prototype.constructor=fc;fc.prototype.name="TransformError";var Er=function(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new En},MA={before:{configurable:!0},docChanged:{configurable:!0}};MA.before.get=function(){return this.docs.length?this.docs[0]:this.doc};Er.prototype.step=function(e){var t=this.maybeStep(e);if(t.failed)throw new fc(t.failed);return this};Er.prototype.maybeStep=function(e){var t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t};MA.docChanged.get=function(){return this.steps.length>0};Er.prototype.addStep=function(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t};Object.defineProperties(Er.prototype,MA);function Sd(){throw new Error("Override me")}var LA=Object.create(null),In=function(){};In.prototype.apply=function(e){return Sd()};In.prototype.getMap=function(){return rn.empty};In.prototype.invert=function(e){return Sd()};In.prototype.map=function(e){return Sd()};In.prototype.merge=function(e){return null};In.prototype.toJSON=function(){return Sd()};In.fromJSON=function(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");var o=LA[t.stepType];if(!o)throw new RangeError("No step type "+t.stepType+" defined");return o.fromJSON(e,t)};In.jsonID=function(e,t){if(e in LA)throw new RangeError("Duplicate use of step JSON ID "+e);return LA[e]=t,t.prototype.jsonID=e,t};var Mn=function(e,t){this.doc=e,this.failed=t};Mn.ok=function(e){return new Mn(e,null)};Mn.fail=function(e){return new Mn(null,e)};Mn.fromReplace=function(e,t,o,a){try{return Mn.ok(e.replace(t,o,a))}catch(l){if(l instanceof Co)return Mn.fail(l.message);throw l}};var qo=function(n){function e(t,o,a,l){n.call(this),this.from=t,this.to=o,this.slice=a,this.structure=!!l}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.apply=function(o){return this.structure&&PA(o,this.from,this.to)?Mn.fail("Structure replace would overwrite content"):Mn.fromReplace(o,this.from,this.to,this.slice)},e.prototype.getMap=function(){return new rn([this.from,this.to-this.from,this.slice.size])},e.prototype.invert=function(o){return new e(this.from,this.from+this.slice.size,o.slice(this.from,this.to))},e.prototype.map=function(o){var a=o.mapResult(this.from,1),l=o.mapResult(this.to,-1);return a.deleted&&l.deleted?null:new e(a.pos,Math.max(a.pos,l.pos),this.slice)},e.prototype.merge=function(o){if(!(o instanceof e)||o.structure||this.structure)return null;if(this.from+this.slice.size==o.from&&!this.slice.openEnd&&!o.slice.openStart){var a=this.slice.size+o.slice.size==0?ye.empty:new ye(this.slice.content.append(o.slice.content),this.slice.openStart,o.slice.openEnd);return new e(this.from,this.to+(o.to-o.from),a,this.structure)}else if(o.to==this.from&&!this.slice.openStart&&!o.slice.openEnd){var l=this.slice.size+o.slice.size==0?ye.empty:new ye(o.slice.content.append(this.slice.content),o.slice.openStart,this.slice.openEnd);return new e(o.from,this.to,l,this.structure)}else return null},e.prototype.toJSON=function(){var o={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(o.slice=this.slice.toJSON()),this.structure&&(o.structure=!0),o},e.fromJSON=function(o,a){if(typeof a.from!="number"||typeof a.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new e(a.from,a.to,ye.fromJSON(o,a.slice),!!a.structure)},e}(In);In.jsonID("replace",qo);var Jn=function(n){function e(t,o,a,l,d,p,g){n.call(this),this.from=t,this.to=o,this.gapFrom=a,this.gapTo=l,this.slice=d,this.insert=p,this.structure=!!g}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.apply=function(o){if(this.structure&&(PA(o,this.from,this.gapFrom)||PA(o,this.gapTo,this.to)))return Mn.fail("Structure gap-replace would overwrite content");var a=o.slice(this.gapFrom,this.gapTo);if(a.openStart||a.openEnd)return Mn.fail("Gap is not a flat range");var l=this.slice.insertAt(this.insert,a.content);return l?Mn.fromReplace(o,this.from,this.to,l):Mn.fail("Content does not fit in gap")},e.prototype.getMap=function(){return new rn([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])},e.prototype.invert=function(o){var a=this.gapTo-this.gapFrom;return new e(this.from,this.from+this.slice.size+a,this.from+this.insert,this.from+this.insert+a,o.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)},e.prototype.map=function(o){var a=o.mapResult(this.from,1),l=o.mapResult(this.to,-1),d=o.map(this.gapFrom,-1),p=o.map(this.gapTo,1);return a.deleted&&l.deleted||d<a.pos||p>l.pos?null:new e(a.pos,l.pos,d,p,this.slice,this.insert,this.structure)},e.prototype.toJSON=function(){var o={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(o.slice=this.slice.toJSON()),this.structure&&(o.structure=!0),o},e.fromJSON=function(o,a){if(typeof a.from!="number"||typeof a.to!="number"||typeof a.gapFrom!="number"||typeof a.gapTo!="number"||typeof a.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new e(a.from,a.to,a.gapFrom,a.gapTo,ye.fromJSON(o,a.slice),a.insert,!!a.structure)},e}(In);In.jsonID("replaceAround",Jn);function PA(n,e,t){for(var o=n.resolve(e),a=t-e,l=o.depth;a>0&&l>0&&o.indexAfter(l)==o.node(l).childCount;)l--,a--;if(a>0)for(var d=o.node(l).maybeChild(o.indexAfter(l));a>0;){if(!d||d.isLeaf)return!0;d=d.firstChild,a--}return!1}function tk(n,e,t){return(e==0||n.canReplace(e,n.childCount))&&(t==n.childCount||n.canReplace(0,t))}function gc(n){for(var e=n.parent,t=e.content.cutByIndex(n.startIndex,n.endIndex),o=n.depth;;--o){var a=n.$from.node(o),l=n.$from.index(o),d=n.$to.indexAfter(o);if(o<n.depth&&a.canReplace(l,d,t))return o;if(o==0||a.type.spec.isolating||!tk(a,l,d))break}}Er.prototype.lift=function(n,e){for(var t=n.$from,o=n.$to,a=n.depth,l=t.before(a+1),d=o.after(a+1),p=l,g=d,v=ee.empty,C=0,y=a,w=!1;y>e;y--)w||t.index(y)>0?(w=!0,v=ee.from(t.node(y).copy(v)),C++):p--;for(var O=ee.empty,M=0,x=a,G=!1;x>e;x--)G||o.after(x+1)<o.end(x)?(G=!0,O=ee.from(o.node(x).copy(O)),M++):g++;return this.step(new Jn(p,g,l,d,new ye(v.append(O),C,M),v.size-C,!0))};function QA(n,e,t,o){o===void 0&&(o=n);var a=rk(n,e),l=a&&nk(o,e);return l?a.map(mC).concat({type:e,attrs:t}).concat(l.map(mC)):null}function mC(n){return{type:n,attrs:null}}function rk(n,e){var t=n.parent,o=n.startIndex,a=n.endIndex,l=t.contentMatchAt(o).findWrapping(e);if(!l)return null;var d=l.length?l[0]:e;return t.canReplaceWith(o,a,d)?l:null}function nk(n,e){var t=n.parent,o=n.startIndex,a=n.endIndex,l=t.child(o),d=e.contentMatch.findWrapping(l.type);if(!d)return null;for(var p=d.length?d[d.length-1]:e,g=p.contentMatch,v=o;g&&v<a;v++)g=g.matchType(t.child(v).type);return!g||!g.validEnd?null:d}Er.prototype.wrap=function(n,e){for(var t=ee.empty,o=e.length-1;o>=0;o--)t=ee.from(e[o].type.create(e[o].attrs,t));var a=n.start,l=n.end;return this.step(new Jn(a,l,a,l,new ye(t,0,0),e.length,!0))};Er.prototype.setBlockType=function(n,e,t,o){var a=this;if(e===void 0&&(e=n),!t.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");var l=this.steps.length;return this.doc.nodesBetween(n,e,function(d,p){if(d.isTextblock&&!d.hasMarkup(t,o)&&ik(a.doc,a.mapping.slice(l).map(p),t)){a.clearIncompatible(a.mapping.slice(l).map(p,1),t);var g=a.mapping.slice(l),v=g.map(p,1),C=g.map(p+d.nodeSize,1);return a.step(new Jn(v,C,v+1,C-1,new ye(ee.from(t.create(o,null,d.marks)),0,0),1,!0)),!1}}),this};function ik(n,e,t){var o=n.resolve(e),a=o.index();return o.parent.canReplaceWith(a,a+1,t)}Er.prototype.setNodeMarkup=function(n,e,t,o){var a=this.doc.nodeAt(n);if(!a)throw new RangeError("No node at given position");e||(e=a.type);var l=e.create(t,null,o||a.marks);if(a.isLeaf)return this.replaceWith(n,n+a.nodeSize,l);if(!e.validContent(a.content))throw new RangeError("Invalid content for node type "+e.name);return this.step(new Jn(n,n+a.nodeSize,n+1,n+a.nodeSize-1,new ye(ee.from(l),0,0),1,!0))};function Jo(n,e,t,o){t===void 0&&(t=1);var a=n.resolve(e),l=a.depth-t,d=o&&o[o.length-1]||a.parent;if(l<0||a.parent.type.spec.isolating||!a.parent.canReplace(a.index(),a.parent.childCount)||!d.type.validContent(a.parent.content.cutByIndex(a.index(),a.parent.childCount)))return!1;for(var p=a.depth-1,g=t-2;p>l;p--,g--){var v=a.node(p),C=a.index(p);if(v.type.spec.isolating)return!1;var y=v.content.cutByIndex(C,v.childCount),w=o&&o[g]||v;if(w!=v&&(y=y.replaceChild(0,w.type.create(w.attrs))),!v.canReplace(C+1,v.childCount)||!w.type.validContent(y))return!1}var O=a.indexAfter(l),M=o&&o[0];return a.node(l).canReplaceWith(O,O,M?M.type:a.node(l+1).type)}Er.prototype.split=function(n,e,t){e===void 0&&(e=1);for(var o=this.doc.resolve(n),a=ee.empty,l=ee.empty,d=o.depth,p=o.depth-e,g=e-1;d>p;d--,g--){a=ee.from(o.node(d).copy(a));var v=t&&t[g];l=ee.from(v?v.type.create(v.attrs,l):o.node(d).copy(l))}return this.step(new qo(n,n,new ye(a.append(l),e,e),!0))};function xA(n,e){var t=n.resolve(e),o=t.index();return ok(t.nodeBefore,t.nodeAfter)&&t.parent.canReplace(o,o+1)}function ok(n,e){return n&&e&&!n.isLeaf&&n.canAppend(e)}Er.prototype.join=function(n,e){e===void 0&&(e=1);var t=new qo(n-e,n+e,ye.empty,!0);return this.step(t)};function sk(n,e,t){var o=n.resolve(e);if(o.parent.canReplaceWith(o.index(),o.index(),t))return e;if(o.parentOffset==0)for(var a=o.depth-1;a>=0;a--){var l=o.index(a);if(o.node(a).canReplaceWith(l,l,t))return o.before(a+1);if(l>0)return null}if(o.parentOffset==o.parent.content.size)for(var d=o.depth-1;d>=0;d--){var p=o.indexAfter(d);if(o.node(d).canReplaceWith(p,p,t))return o.after(d+1);if(p<o.node(d).childCount)return null}}function vC(n,e,t){var o=n.resolve(e);if(!t.content.size)return e;for(var a=t.content,l=0;l<t.openStart;l++)a=a.firstChild.content;for(var d=1;d<=(t.openStart==0&&t.size?2:1);d++)for(var p=o.depth;p>=0;p--){var g=p==o.depth?0:o.pos<=(o.start(p+1)+o.end(p+1))/2?-1:1,v=o.index(p)+(g>0?1:0),C=o.node(p),y=!1;if(d==1)y=C.canReplace(v,v,a);else{var w=C.contentMatchAt(v).findWrapping(a.firstChild.type);y=w&&C.canReplaceWith(v,v,w[0])}if(y)return g==0?o.pos:g<0?o.before(p+1):o.after(p+1)}return null}function UA(n,e,t){for(var o=[],a=0;a<n.childCount;a++){var l=n.child(a);l.content.size&&(l=l.copy(UA(l.content,e,l))),l.isInline&&(l=e(l,t,a)),o.push(l)}return ee.fromArray(o)}var FA=function(n){function e(t,o,a){n.call(this),this.from=t,this.to=o,this.mark=a}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.apply=function(o){var a=this,l=o.slice(this.from,this.to),d=o.resolve(this.from),p=d.node(d.sharedDepth(this.to)),g=new ye(UA(l.content,function(v,C){return!v.isAtom||!C.type.allowsMarkType(a.mark.type)?v:v.mark(a.mark.addToSet(v.marks))},p),l.openStart,l.openEnd);return Mn.fromReplace(o,this.from,this.to,g)},e.prototype.invert=function(){return new Ml(this.from,this.to,this.mark)},e.prototype.map=function(o){var a=o.mapResult(this.from,1),l=o.mapResult(this.to,-1);return a.deleted&&l.deleted||a.pos>=l.pos?null:new e(a.pos,l.pos,this.mark)},e.prototype.merge=function(o){if(o instanceof e&&o.mark.eq(this.mark)&&this.from<=o.to&&this.to>=o.from)return new e(Math.min(this.from,o.from),Math.max(this.to,o.to),this.mark)},e.prototype.toJSON=function(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},e.fromJSON=function(o,a){if(typeof a.from!="number"||typeof a.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new e(a.from,a.to,o.markFromJSON(a.mark))},e}(In);In.jsonID("addMark",FA);var Ml=function(n){function e(t,o,a){n.call(this),this.from=t,this.to=o,this.mark=a}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.apply=function(o){var a=this,l=o.slice(this.from,this.to),d=new ye(UA(l.content,function(p){return p.mark(a.mark.removeFromSet(p.marks))}),l.openStart,l.openEnd);return Mn.fromReplace(o,this.from,this.to,d)},e.prototype.invert=function(){return new FA(this.from,this.to,this.mark)},e.prototype.map=function(o){var a=o.mapResult(this.from,1),l=o.mapResult(this.to,-1);return a.deleted&&l.deleted||a.pos>=l.pos?null:new e(a.pos,l.pos,this.mark)},e.prototype.merge=function(o){if(o instanceof e&&o.mark.eq(this.mark)&&this.from<=o.to&&this.to>=o.from)return new e(Math.min(this.from,o.from),Math.max(this.to,o.to),this.mark)},e.prototype.toJSON=function(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},e.fromJSON=function(o,a){if(typeof a.from!="number"||typeof a.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new e(a.from,a.to,o.markFromJSON(a.mark))},e}(In);In.jsonID("removeMark",Ml);Er.prototype.addMark=function(n,e,t){var o=this,a=[],l=[],d=null,p=null;return this.doc.nodesBetween(n,e,function(g,v,C){if(!!g.isInline){var y=g.marks;if(!t.isInSet(y)&&C.type.allowsMarkType(t.type)){for(var w=Math.max(v,n),O=Math.min(v+g.nodeSize,e),M=t.addToSet(y),x=0;x<y.length;x++)y[x].isInSet(M)||(d&&d.to==w&&d.mark.eq(y[x])?d.to=O:a.push(d=new Ml(w,O,y[x])));p&&p.to==w?p.to=O:l.push(p=new FA(w,O,t))}}}),a.forEach(function(g){return o.step(g)}),l.forEach(function(g){return o.step(g)}),this};Er.prototype.removeMark=function(n,e,t){var o=this;t===void 0&&(t=null);var a=[],l=0;return this.doc.nodesBetween(n,e,function(d,p){if(!!d.isInline){l++;var g=null;if(t instanceof As)for(var v=d.marks,C;C=t.isInSet(v);)(g||(g=[])).push(C),v=C.removeFromSet(v);else t?t.isInSet(d.marks)&&(g=[t]):g=d.marks;if(g&&g.length)for(var y=Math.min(p+d.nodeSize,e),w=0;w<g.length;w++){for(var O=g[w],M=void 0,x=0;x<a.length;x++){var G=a[x];G.step==l-1&&O.eq(a[x].style)&&(M=G)}M?(M.to=y,M.step=l):a.push({style:O,from:Math.max(p,n),to:y,step:l})}}}),a.forEach(function(d){return o.step(new Ml(d.from,d.to,d.style))}),this};Er.prototype.clearIncompatible=function(n,e,t){t===void 0&&(t=e.contentMatch);for(var o=this.doc.nodeAt(n),a=[],l=n+1,d=0;d<o.childCount;d++){var p=o.child(d),g=l+p.nodeSize,v=t.matchType(p.type,p.attrs);if(!v)a.push(new qo(l,g,ye.empty));else{t=v;for(var C=0;C<p.marks.length;C++)e.allowsMarkType(p.marks[C].type)||this.step(new Ml(l,g,p.marks[C]))}l=g}if(!t.validEnd){var y=t.fillBefore(ee.empty,!0);this.replace(l,l,new ye(y,0,0))}for(var w=a.length-1;w>=0;w--)this.step(a[w]);return this};function ak(n,e,t,o){if(t===void 0&&(t=e),o===void 0&&(o=ye.empty),e==t&&!o.size)return null;var a=n.resolve(e),l=n.resolve(t);return EC(a,l,o)?new qo(e,t,o):new Mi(a,l,o).fit()}Er.prototype.replace=function(n,e,t){e===void 0&&(e=n),t===void 0&&(t=ye.empty);var o=ak(this.doc,n,e,t);return o&&this.step(o),this};Er.prototype.replaceWith=function(n,e,t){return this.replace(n,e,new ye(ee.from(t),0,0))};Er.prototype.delete=function(n,e){return this.replace(n,e,ye.empty)};Er.prototype.insert=function(n,e){return this.replaceWith(n,n,e)};function EC(n,e,t){return!t.openStart&&!t.openEnd&&n.start()==e.start()&&n.parent.canReplace(n.index(),e.index(),t.content)}var Mi=function(e,t,o){this.$to=t,this.$from=e,this.unplaced=o,this.frontier=[];for(var a=0;a<=e.depth;a++){var l=e.node(a);this.frontier.push({type:l.type,match:l.contentMatchAt(e.indexAfter(a))})}this.placed=ee.empty;for(var d=e.depth;d>0;d--)this.placed=ee.from(e.node(d).copy(this.placed))},IC={depth:{configurable:!0}};IC.depth.get=function(){return this.frontier.length-1};Mi.prototype.fit=function(){for(;this.unplaced.size;){var e=this.findFittable();e?this.placeNodes(e):this.openMore()||this.dropNode()}var t=this.mustMoveInline(),o=this.placed.size-this.depth-this.$from.depth,a=this.$from,l=this.close(t<0?this.$to:a.doc.resolve(t));if(!l)return null;for(var d=this.placed,p=a.depth,g=l.depth;p&&g&&d.childCount==1;)d=d.firstChild.content,p--,g--;var v=new ye(d,p,g);if(t>-1)return new Jn(a.pos,t,this.$to.pos,this.$to.end(),v,o);if(v.size||a.pos!=this.$to.pos)return new qo(a.pos,l.pos,v)};Mi.prototype.findFittable=function(){for(var e=1;e<=2;e++)for(var t=this.unplaced.openStart;t>=0;t--){var o=void 0,a=void 0;t?(a=VA(this.unplaced.content,t-1).firstChild,o=a.content):o=this.unplaced.content;for(var l=o.firstChild,d=this.depth;d>=0;d--){var p=this.frontier[d],g=p.type,v=p.match,C=void 0,y=void 0;if(e==1&&(l?v.matchType(l.type)||(y=v.fillBefore(ee.from(l),!1)):g.compatibleContent(a.type)))return{sliceDepth:t,frontierDepth:d,parent:a,inject:y};if(e==2&&l&&(C=v.findWrapping(l.type)))return{sliceDepth:t,frontierDepth:d,parent:a,wrap:C};if(a&&v.matchType(a.type))break}}};Mi.prototype.openMore=function(){var e=this.unplaced,t=e.content,o=e.openStart,a=e.openEnd,l=VA(t,o);return!l.childCount||l.firstChild.isLeaf?!1:(this.unplaced=new ye(t,o+1,Math.max(a,l.size+o>=t.size-a?o+1:0)),!0)};Mi.prototype.dropNode=function(){var e=this.unplaced,t=e.content,o=e.openStart,a=e.openEnd,l=VA(t,o);if(l.childCount<=1&&o>0){var d=t.size-o<=o+l.size;this.unplaced=new ye(Ll(t,o-1,1),o-1,d?o-1:a)}else this.unplaced=new ye(Ll(t,o,1),o,a)};Mi.prototype.placeNodes=function(e){for(var t=e.sliceDepth,o=e.frontierDepth,a=e.parent,l=e.inject,d=e.wrap;this.depth>o;)this.closeFrontierNode();if(d)for(var p=0;p<d.length;p++)this.openFrontierNode(d[p]);var g=this.unplaced,v=a?a.content:g.content,C=g.openStart-t,y=0,w=[],O=this.frontier[o],M=O.match,x=O.type;if(l){for(var G=0;G<l.childCount;G++)w.push(l.child(G));M=M.matchFragment(l)}for(var K=v.size+t-(g.content.size-g.openEnd);y<v.childCount;){var F=v.child(y),re=M.matchType(F.type);if(!re)break;y++,(y>1||C==0||F.content.size)&&(M=re,w.push(CC(F.mark(x.allowedMarks(F.marks)),y==1?C:0,y==v.childCount?K:-1)))}var Q=y==v.childCount;Q||(K=-1),this.placed=Pl(this.placed,o,ee.from(w)),this.frontier[o].match=M,Q&&K<0&&a&&a.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(var Ae=0,oe=v;Ae<K;Ae++){var Te=oe.lastChild;this.frontier.push({type:Te.type,match:Te.contentMatchAt(Te.childCount)}),oe=Te.content}this.unplaced=Q?t==0?ye.empty:new ye(Ll(g.content,t-1,1),t-1,K<0?g.openEnd:t-1):new ye(Ll(g.content,t,y),g.openStart,g.openEnd)};Mi.prototype.mustMoveInline=function(){if(!this.$to.parent.isTextblock||this.$to.end()==this.$to.pos)return-1;var e=this.frontier[this.depth],t;if(!e.type.isTextblock||!GA(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;for(var o=this.$to,a=o.depth,l=this.$to.after(a);a>1&&l==this.$to.end(--a);)++l;return l};Mi.prototype.findCloseLevel=function(e){e:for(var t=Math.min(this.depth,e.depth);t>=0;t--){var o=this.frontier[t],a=o.match,l=o.type,d=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),p=GA(e,t,l,a,d);if(!!p){for(var g=t-1;g>=0;g--){var v=this.frontier[g],C=v.match,y=v.type,w=GA(e,g,y,C,!0);if(!w||w.childCount)continue e}return{depth:t,fit:p,move:d?e.doc.resolve(e.after(t+1)):e}}}};Mi.prototype.close=function(e){var t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=Pl(this.placed,t.depth,t.fit)),e=t.move;for(var o=t.depth+1;o<=e.depth;o++){var a=e.node(o),l=a.type.contentMatch.fillBefore(a.content,!0,e.index(o));this.openFrontierNode(a.type,a.attrs,l)}return e};Mi.prototype.openFrontierNode=function(e,t,o){var a=this.frontier[this.depth];a.match=a.match.matchType(e),this.placed=Pl(this.placed,this.depth,ee.from(e.create(t,o))),this.frontier.push({type:e,match:e.contentMatch})};Mi.prototype.closeFrontierNode=function(){var e=this.frontier.pop(),t=e.match.fillBefore(ee.empty,!0);t.childCount&&(this.placed=Pl(this.placed,this.frontier.length,t))};Object.defineProperties(Mi.prototype,IC);function Ll(n,e,t){return e==0?n.cutByIndex(t):n.replaceChild(0,n.firstChild.copy(Ll(n.firstChild.content,e-1,t)))}function Pl(n,e,t){return e==0?n.append(t):n.replaceChild(n.childCount-1,n.lastChild.copy(Pl(n.lastChild.content,e-1,t)))}function VA(n,e){for(var t=0;t<e;t++)n=n.firstChild.content;return n}function CC(n,e,t){if(e<=0)return n;var o=n.content;return e>1&&(o=o.replaceChild(0,CC(o.firstChild,e-1,o.childCount==1?t-1:0))),e>0&&(o=n.type.contentMatch.fillBefore(o).append(o),t<=0&&(o=o.append(n.type.contentMatch.matchFragment(o).fillBefore(ee.empty,!0)))),n.copy(o)}function GA(n,e,t,o,a){var l=n.node(e),d=a?n.indexAfter(e):n.index(e);if(d==l.childCount&&!t.compatibleContent(l.type))return null;var p=o.fillBefore(l.content,!0,d);return p&&!ck(t,l.content,d)?p:null}function ck(n,e,t){for(var o=t;o<e.childCount;o++)if(!n.allowsMarks(e.child(o).marks))return!0;return!1}Er.prototype.replaceRange=function(n,e,t){if(!t.size)return this.deleteRange(n,e);var o=this.doc.resolve(n),a=this.doc.resolve(e);if(EC(o,a,t))return this.step(new qo(n,e,t));var l=_C(o,this.doc.resolve(e));l[l.length-1]==0&&l.pop();var d=-(o.depth+1);l.unshift(d);for(var p=o.depth,g=o.pos-1;p>0;p--,g--){var v=o.node(p).type.spec;if(v.defining||v.isolating)break;l.indexOf(p)>-1?d=p:o.before(p)==g&&l.splice(1,0,-p)}for(var C=l.indexOf(d),y=[],w=t.openStart,O=t.content,M=0;;M++){var x=O.firstChild;if(y.push(x),M==t.openStart)break;O=x.content}w>0&&y[w-1].type.spec.defining&&o.node(C).type!=y[w-1].type?w-=1:w>=2&&y[w-1].isTextblock&&y[w-2].type.spec.defining&&o.node(C).type!=y[w-2].type&&(w-=2);for(var G=t.openStart;G>=0;G--){var K=(G+w+1)%(t.openStart+1),F=y[K];if(!!F)for(var re=0;re<l.length;re++){var Q=l[(re+C)%l.length],Ae=!0;Q<0&&(Ae=!1,Q=-Q);var oe=o.node(Q-1),Te=o.index(Q-1);if(oe.canReplaceWith(Te,Te,F.type,F.marks))return this.replace(o.before(Q),Ae?a.after(Q):e,new ye(yC(t.content,0,t.openStart,K),K,t.openEnd))}}for(var je=this.steps.length,We=l.length-1;We>=0&&(this.replace(n,e,t),!(this.steps.length>je));We--){var Oe=l[We];Oe<0||(n=o.before(Oe),e=a.after(Oe))}return this};function yC(n,e,t,o,a){if(e<t){var l=n.firstChild;n=n.replaceChild(0,l.copy(yC(l.content,e+1,t,o,l)))}if(e>o){var d=a.contentMatchAt(0),p=d.fillBefore(n).append(n);n=p.append(d.matchFragment(p).fillBefore(ee.empty,!0))}return n}Er.prototype.replaceRangeWith=function(n,e,t){if(!t.isInline&&n==e&&this.doc.resolve(n).parent.content.size){var o=sk(this.doc,n,t.type);o!=null&&(n=e=o)}return this.replaceRange(n,e,new ye(ee.from(t),0,0))};Er.prototype.deleteRange=function(n,e){for(var t=this.doc.resolve(n),o=this.doc.resolve(e),a=_C(t,o),l=0;l<a.length;l++){var d=a[l],p=l==a.length-1;if(p&&d==0||t.node(d).type.contentMatch.validEnd)return this.delete(t.start(d),o.end(d));if(d>0&&(p||t.node(d-1).canReplace(t.index(d-1),o.indexAfter(d-1))))return this.delete(t.before(d),o.after(d))}for(var g=1;g<=t.depth&&g<=o.depth;g++)if(n-t.start(g)==t.depth-g&&e>t.end(g)&&o.end(g)-e!=o.depth-g)return this.delete(t.before(g),e);return this.delete(n,e)};function _C(n,e){for(var t=[],o=Math.min(n.depth,e.depth),a=o;a>=0;a--){var l=n.start(a);if(l<n.pos-(n.depth-a)||e.end(a)>e.pos+(e.depth-a)||n.node(a).type.spec.isolating||e.node(a).type.spec.isolating)break;(l==e.start(a)||a==n.depth&&a==e.depth&&n.parent.inlineContent&&e.parent.inlineContent&&a&&e.start(a-1)==l-1)&&t.push(a)}return t}var jA=Object.create(null),rt=function(e,t,o){this.ranges=o||[new lk(e.min(t),e.max(t))],this.$anchor=e,this.$head=t},fs={anchor:{configurable:!0},head:{configurable:!0},from:{configurable:!0},to:{configurable:!0},$from:{configurable:!0},$to:{configurable:!0},empty:{configurable:!0}};fs.anchor.get=function(){return this.$anchor.pos};fs.head.get=function(){return this.$head.pos};fs.from.get=function(){return this.$from.pos};fs.to.get=function(){return this.$to.pos};fs.$from.get=function(){return this.ranges[0].$from};fs.$to.get=function(){return this.ranges[0].$to};fs.empty.get=function(){for(var n=this.ranges,e=0;e<n.length;e++)if(n[e].$from.pos!=n[e].$to.pos)return!1;return!0};rt.prototype.content=function(){return this.$from.node(0).slice(this.from,this.to,!0)};rt.prototype.replace=function(e,t){t===void 0&&(t=ye.empty);for(var o=t.content.lastChild,a=null,l=0;l<t.openEnd;l++)a=o,o=o.lastChild;for(var d=e.steps.length,p=this.ranges,g=0;g<p.length;g++){var v=p[g],C=v.$from,y=v.$to,w=e.mapping.slice(d);e.replaceRange(w.map(C.pos),w.map(y.pos),g?ye.empty:t),g==0&&SC(e,d,(o?o.isInline:a&&a.isTextblock)?-1:1)}};rt.prototype.replaceWith=function(e,t){for(var o=e.steps.length,a=this.ranges,l=0;l<a.length;l++){var d=a[l],p=d.$from,g=d.$to,v=e.mapping.slice(o),C=v.map(p.pos),y=v.map(g.pos);l?e.deleteRange(C,y):(e.replaceRangeWith(C,y,t),SC(e,o,t.isInline?-1:1))}};rt.findFrom=function(e,t,o){var a=e.parent.inlineContent?new Rt(e):mc(e.node(0),e.parent,e.pos,e.index(),t,o);if(a)return a;for(var l=e.depth-1;l>=0;l--){var d=t<0?mc(e.node(0),e.node(l),e.before(l+1),e.index(l),t,o):mc(e.node(0),e.node(l),e.after(l+1),e.index(l)+1,t,o);if(d)return d}};rt.near=function(e,t){return t===void 0&&(t=1),this.findFrom(e,t)||this.findFrom(e,-t)||new zo(e.node(0))};rt.atStart=function(e){return mc(e,e,0,0,1)||new zo(e)};rt.atEnd=function(e){return mc(e,e,e.content.size,e.childCount,-1)||new zo(e)};rt.fromJSON=function(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");var o=jA[t.type];if(!o)throw new RangeError("No selection type "+t.type+" defined");return o.fromJSON(e,t)};rt.jsonID=function(e,t){if(e in jA)throw new RangeError("Duplicate use of selection JSON ID "+e);return jA[e]=t,t.prototype.jsonID=e,t};rt.prototype.getBookmark=function(){return Rt.between(this.$anchor,this.$head).getBookmark()};Object.defineProperties(rt.prototype,fs);rt.prototype.visible=!0;var lk=function(e,t){this.$from=e,this.$to=t},Rt=function(n){function e(o,a){a===void 0&&(a=o),n.call(this,o,a)}n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e;var t={$cursor:{configurable:!0}};return t.$cursor.get=function(){return this.$anchor.pos==this.$head.pos?this.$head:null},e.prototype.map=function(a,l){var d=a.resolve(l.map(this.head));if(!d.parent.inlineContent)return n.near(d);var p=a.resolve(l.map(this.anchor));return new e(p.parent.inlineContent?p:d,d)},e.prototype.replace=function(a,l){if(l===void 0&&(l=ye.empty),n.prototype.replace.call(this,a,l),l==ye.empty){var d=this.$from.marksAcross(this.$to);d&&a.ensureMarks(d)}},e.prototype.eq=function(a){return a instanceof e&&a.anchor==this.anchor&&a.head==this.head},e.prototype.getBookmark=function(){return new Ql(this.anchor,this.head)},e.prototype.toJSON=function(){return{type:"text",anchor:this.anchor,head:this.head}},e.fromJSON=function(a,l){if(typeof l.anchor!="number"||typeof l.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new e(a.resolve(l.anchor),a.resolve(l.head))},e.create=function(a,l,d){d===void 0&&(d=l);var p=a.resolve(l);return new this(p,d==l?p:a.resolve(d))},e.between=function(a,l,d){var p=a.pos-l.pos;if((!d||p)&&(d=p>=0?1:-1),!l.parent.inlineContent){var g=n.findFrom(l,d,!0)||n.findFrom(l,-d,!0);if(g)l=g.$head;else return n.near(l,d)}return a.parent.inlineContent||(p==0?a=l:(a=(n.findFrom(a,-d,!0)||n.findFrom(a,d,!0)).$anchor,a.pos<l.pos!=p<0&&(a=l))),new e(a,l)},Object.defineProperties(e.prototype,t),e}(rt);rt.jsonID("text",Rt);var Ql=function(e,t){this.anchor=e,this.head=t};Ql.prototype.map=function(e){return new Ql(e.map(this.anchor),e.map(this.head))};Ql.prototype.resolve=function(e){return Rt.between(e.resolve(this.anchor),e.resolve(this.head))};var $e=function(n){function e(t){var o=t.nodeAfter,a=t.node(0).resolve(t.pos+o.nodeSize);n.call(this,t,a),this.node=o}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.map=function(o,a){var l=a.mapResult(this.anchor),d=l.deleted,p=l.pos,g=o.resolve(p);return d?n.near(g):new e(g)},e.prototype.content=function(){return new ye(ee.from(this.node),0,0)},e.prototype.eq=function(o){return o instanceof e&&o.anchor==this.anchor},e.prototype.toJSON=function(){return{type:"node",anchor:this.anchor}},e.prototype.getBookmark=function(){return new Td(this.anchor)},e.fromJSON=function(o,a){if(typeof a.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new e(o.resolve(a.anchor))},e.create=function(o,a){return new this(o.resolve(a))},e.isSelectable=function(o){return!o.isText&&o.type.spec.selectable!==!1},e}(rt);$e.prototype.visible=!1;rt.jsonID("node",$e);var Td=function(e){this.anchor=e};Td.prototype.map=function(e){var t=e.mapResult(this.anchor),o=t.deleted,a=t.pos;return o?new Ql(a,a):new Td(a)};Td.prototype.resolve=function(e){var t=e.resolve(this.anchor),o=t.nodeAfter;return o&&$e.isSelectable(o)?new $e(t):rt.near(t)};var zo=function(n){function e(t){n.call(this,t.resolve(0),t.resolve(t.content.size))}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.replace=function(o,a){if(a===void 0&&(a=ye.empty),a==ye.empty){o.delete(0,o.doc.content.size);var l=n.atStart(o.doc);l.eq(o.selection)||o.setSelection(l)}else n.prototype.replace.call(this,o,a)},e.prototype.toJSON=function(){return{type:"all"}},e.fromJSON=function(o){return new e(o)},e.prototype.map=function(o){return new e(o)},e.prototype.eq=function(o){return o instanceof e},e.prototype.getBookmark=function(){return uk},e}(rt);rt.jsonID("all",zo);var uk={map:function(){return this},resolve:function(e){return new zo(e)}};function mc(n,e,t,o,a,l){if(e.inlineContent)return Rt.create(n,t);for(var d=o-(a>0?0:1);a>0?d<e.childCount:d>=0;d+=a){var p=e.child(d);if(p.isAtom){if(!l&&$e.isSelectable(p))return $e.create(n,t-(a<0?p.nodeSize:0))}else{var g=mc(n,p,t+a,a<0?p.childCount:0,a,l);if(g)return g}t+=p.nodeSize*a}}function SC(n,e,t){var o=n.steps.length-1;if(!(o<e)){var a=n.steps[o];if(a instanceof qo||a instanceof Jn){var l=n.mapping.maps[o],d;l.forEach(function(p,g,v,C){d==null&&(d=C)}),n.setSelection(rt.near(n.doc.resolve(d),t))}}}var TC=1,Rd=2,RC=4,dk=function(n){function e(o){n.call(this,o.doc),this.time=Date.now(),this.curSelection=o.selection,this.curSelectionFor=0,this.storedMarks=o.storedMarks,this.updated=0,this.meta=Object.create(null)}n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e;var t={selection:{configurable:!0},selectionSet:{configurable:!0},storedMarksSet:{configurable:!0},isGeneric:{configurable:!0},scrolledIntoView:{configurable:!0}};return t.selection.get=function(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection},e.prototype.setSelection=function(a){if(a.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=a,this.curSelectionFor=this.steps.length,this.updated=(this.updated|TC)&~Rd,this.storedMarks=null,this},t.selectionSet.get=function(){return(this.updated&TC)>0},e.prototype.setStoredMarks=function(a){return this.storedMarks=a,this.updated|=Rd,this},e.prototype.ensureMarks=function(a){return Et.sameSet(this.storedMarks||this.selection.$from.marks(),a)||this.setStoredMarks(a),this},e.prototype.addStoredMark=function(a){return this.ensureMarks(a.addToSet(this.storedMarks||this.selection.$head.marks()))},e.prototype.removeStoredMark=function(a){return this.ensureMarks(a.removeFromSet(this.storedMarks||this.selection.$head.marks()))},t.storedMarksSet.get=function(){return(this.updated&Rd)>0},e.prototype.addStep=function(a,l){n.prototype.addStep.call(this,a,l),this.updated=this.updated&~Rd,this.storedMarks=null},e.prototype.setTime=function(a){return this.time=a,this},e.prototype.replaceSelection=function(a){return this.selection.replace(this,a),this},e.prototype.replaceSelectionWith=function(a,l){var d=this.selection;return l!==!1&&(a=a.mark(this.storedMarks||(d.empty?d.$from.marks():d.$from.marksAcross(d.$to)||Et.none))),d.replaceWith(this,a),this},e.prototype.deleteSelection=function(){return this.selection.replace(this),this},e.prototype.insertText=function(a,l,d){d===void 0&&(d=l);var p=this.doc.type.schema;if(l==null)return a?this.replaceSelectionWith(p.text(a),!0):this.deleteSelection();if(!a)return this.deleteRange(l,d);var g=this.storedMarks;if(!g){var v=this.doc.resolve(l);g=d==l?v.marks():v.marksAcross(this.doc.resolve(d))}return this.replaceRangeWith(l,d,p.text(a,g)),this.selection.empty||this.setSelection(rt.near(this.selection.$to)),this},e.prototype.setMeta=function(a,l){return this.meta[typeof a=="string"?a:a.key]=l,this},e.prototype.getMeta=function(a){return this.meta[typeof a=="string"?a:a.key]},t.isGeneric.get=function(){for(var o in this.meta)return!1;return!0},e.prototype.scrollIntoView=function(){return this.updated|=RC,this},t.scrolledIntoView.get=function(){return(this.updated&RC)>0},Object.defineProperties(e.prototype,t),e}(Er);function wC(n,e){return!e||!n?n:n.bind(e)}var xl=function(e,t,o){this.name=e,this.init=wC(t.init,o),this.apply=wC(t.apply,o)},hk=[new xl("doc",{init:function(e){return e.doc||e.schema.topNodeType.createAndFill()},apply:function(e){return e.doc}}),new xl("selection",{init:function(e,t){return e.selection||rt.atStart(t.doc)},apply:function(e){return e.selection}}),new xl("storedMarks",{init:function(e){return e.storedMarks||null},apply:function(e,t,o,a){return a.selection.$cursor?e.storedMarks:null}}),new xl("scrollToSelection",{init:function(){return 0},apply:function(e,t){return e.scrolledIntoView?t+1:t}})],HA=function(e,t){var o=this;this.schema=e,this.fields=hk.concat(),this.plugins=[],this.pluginsByKey=Object.create(null),t&&t.forEach(function(a){if(o.pluginsByKey[a.key])throw new RangeError("Adding different instances of a keyed plugin ("+a.key+")");o.plugins.push(a),o.pluginsByKey[a.key]=a,a.spec.state&&o.fields.push(new xl(a.key,a.spec.state,a))})},Cn=function(e){this.config=e},wd={schema:{configurable:!0},plugins:{configurable:!0},tr:{configurable:!0}};wd.schema.get=function(){return this.config.schema};wd.plugins.get=function(){return this.config.plugins};Cn.prototype.apply=function(e){return this.applyTransaction(e).state};Cn.prototype.filterTransaction=function(e,t){t===void 0&&(t=-1);for(var o=0;o<this.config.plugins.length;o++)if(o!=t){var a=this.config.plugins[o];if(a.spec.filterTransaction&&!a.spec.filterTransaction.call(a,e,this))return!1}return!0};Cn.prototype.applyTransaction=function(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};for(var t=[e],o=this.applyInner(e),a=null;;){for(var l=!1,d=0;d<this.config.plugins.length;d++){var p=this.config.plugins[d];if(p.spec.appendTransaction){var g=a?a[d].n:0,v=a?a[d].state:this,C=g<t.length&&p.spec.appendTransaction.call(p,g?t.slice(g):t,v,o);if(C&&o.filterTransaction(C,d)){if(C.setMeta("appendedTransaction",e),!a){a=[];for(var y=0;y<this.config.plugins.length;y++)a.push(y<d?{state:o,n:t.length}:{state:this,n:0})}t.push(C),o=o.applyInner(C),l=!0}a&&(a[d]={state:o,n:t.length})}}if(!l)return{state:o,transactions:t}}};Cn.prototype.applyInner=function(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");for(var t=new Cn(this.config),o=this.config.fields,a=0;a<o.length;a++){var l=o[a];t[l.name]=l.apply(e,this[l.name],this,t)}for(var d=0;d<Ul.length;d++)Ul[d](this,e,t);return t};wd.tr.get=function(){return new dk(this)};Cn.create=function(e){for(var t=new HA(e.doc?e.doc.type.schema:e.schema,e.plugins),o=new Cn(t),a=0;a<t.fields.length;a++)o[t.fields[a].name]=t.fields[a].init(e,o);return o};Cn.prototype.reconfigure=function(e){for(var t=new HA(this.schema,e.plugins),o=t.fields,a=new Cn(t),l=0;l<o.length;l++){var d=o[l].name;a[d]=this.hasOwnProperty(d)?this[d]:o[l].init(e,a)}return a};Cn.prototype.toJSON=function(e){var t={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(t.storedMarks=this.storedMarks.map(function(d){return d.toJSON()})),e&&typeof e=="object")for(var o in e){if(o=="doc"||o=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");var a=e[o],l=a.spec.state;l&&l.toJSON&&(t[o]=l.toJSON.call(a,this[a.key]))}return t};Cn.fromJSON=function(e,t,o){if(!t)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");var a=new HA(e.schema,e.plugins),l=new Cn(a);return a.fields.forEach(function(d){if(d.name=="doc")l.doc=_t.fromJSON(e.schema,t.doc);else if(d.name=="selection")l.selection=rt.fromJSON(l.doc,t.selection);else if(d.name=="storedMarks")t.storedMarks&&(l.storedMarks=t.storedMarks.map(e.schema.markFromJSON));else{if(o)for(var p in o){var g=o[p],v=g.spec.state;if(g.key==d.name&&v&&v.fromJSON&&Object.prototype.hasOwnProperty.call(t,p)){l[d.name]=v.fromJSON.call(g,e,t[p],l);return}}l[d.name]=d.init(e,l)}}),l};Cn.addApplyListener=function(e){Ul.push(e)};Cn.removeApplyListener=function(e){var t=Ul.indexOf(e);t>-1&&Ul.splice(t,1)};Object.defineProperties(Cn.prototype,wd);var Ul=[];function NC(n,e,t){for(var o in n){var a=n[o];a instanceof Function?a=a.bind(e):o=="handleDOMEvents"&&(a=NC(a,e,{})),t[o]=a}return t}var nn=function(e){this.props={},e.props&&NC(e.props,this,this.props),this.spec=e,this.key=e.key?e.key.key:kC("plugin")};nn.prototype.getState=function(e){return e[this.key]};var KA=Object.create(null);function kC(n){return n in KA?n+"$"+ ++KA[n]:(KA[n]=0,n+"$")}var zn=function(e){e===void 0&&(e="key"),this.key=kC(e)};zn.prototype.get=function(e){return e.config.pluginsByKey[this.key]};zn.prototype.getState=function(e){return e[this.key]};function WA(n,e){return n.selection.empty?!1:(e&&e(n.tr.deleteSelection().scrollIntoView()),!0)}function OC(n,e,t){var o=n.selection,a=o.$cursor;if(!a||(t?!t.endOfTextblock("backward",n):a.parentOffset>0))return!1;var l=DC(a);if(!l){var d=a.blockRange(),p=d&&gc(d);return p==null?!1:(e&&e(n.tr.lift(d,p).scrollIntoView()),!0)}var g=l.nodeBefore;if(!g.type.spec.isolating&&VC(n,l,e))return!0;if(a.parent.content.size==0&&(vc(g,"end")||$e.isSelectable(g))){if(e){var v=n.tr.deleteRange(a.before(),a.after());v.setSelection(vc(g,"end")?rt.findFrom(v.doc.resolve(v.mapping.map(l.pos,-1)),-1):$e.create(v.doc,l.pos-g.nodeSize)),e(v.scrollIntoView())}return!0}return g.isAtom&&l.depth==a.depth-1?(e&&e(n.tr.delete(l.pos-g.nodeSize,l.pos).scrollIntoView()),!0):!1}function vc(n,e,t){for(;n;n=e=="start"?n.firstChild:n.lastChild){if(n.isTextblock)return!0;if(t&&n.childCount!=1)return!1}return!1}function bC(n,e,t){var o=n.selection,a=o.$head,l=o.empty,d=a;if(!l)return!1;if(a.parent.isTextblock){if(t?!t.endOfTextblock("backward",n):a.parentOffset>0)return!1;d=DC(a)}var p=d&&d.nodeBefore;return!p||!$e.isSelectable(p)?!1:(e&&e(n.tr.setSelection($e.create(n.doc,d.pos-p.nodeSize)).scrollIntoView()),!0)}function DC(n){if(!n.parent.type.spec.isolating)for(var e=n.depth-1;e>=0;e--){if(n.index(e)>0)return n.doc.resolve(n.before(e+1));if(n.node(e).type.spec.isolating)break}return null}function BC(n,e,t){var o=n.selection,a=o.$cursor;if(!a||(t?!t.endOfTextblock("forward",n):a.parentOffset<a.parent.content.size))return!1;var l=LC(a);if(!l)return!1;var d=l.nodeAfter;if(VC(n,l,e))return!0;if(a.parent.content.size==0&&(vc(d,"start")||$e.isSelectable(d))){if(e){var p=n.tr.deleteRange(a.before(),a.after());p.setSelection(vc(d,"start")?rt.findFrom(p.doc.resolve(p.mapping.map(l.pos)),1):$e.create(p.doc,p.mapping.map(l.pos))),e(p.scrollIntoView())}return!0}return d.isAtom&&l.depth==a.depth-1?(e&&e(n.tr.delete(l.pos,l.pos+d.nodeSize).scrollIntoView()),!0):!1}function MC(n,e,t){var o=n.selection,a=o.$head,l=o.empty,d=a;if(!l)return!1;if(a.parent.isTextblock){if(t?!t.endOfTextblock("forward",n):a.parentOffset<a.parent.content.size)return!1;d=LC(a)}var p=d&&d.nodeAfter;return!p||!$e.isSelectable(p)?!1:(e&&e(n.tr.setSelection($e.create(n.doc,d.pos)).scrollIntoView()),!0)}function LC(n){if(!n.parent.type.spec.isolating)for(var e=n.depth-1;e>=0;e--){var t=n.node(e);if(n.index(e)+1<t.childCount)return n.doc.resolve(n.after(e+1));if(t.type.spec.isolating)break}return null}function PC(n,e){var t=n.selection,o=t.$from,a=t.$to,l=o.blockRange(a),d=l&&gc(l);return d==null?!1:(e&&e(n.tr.lift(l,d).scrollIntoView()),!0)}function QC(n,e){var t=n.selection,o=t.$head,a=t.$anchor;return!o.parent.type.spec.code||!o.sameParent(a)?!1:(e&&e(n.tr.insertText(`
`).scrollIntoView()),!0)}function YA(n){for(var e=0;e<n.edgeCount;e++){var t=n.edge(e),o=t.type;if(o.isTextblock&&!o.hasRequiredAttrs())return o}return null}function xC(n,e){var t=n.selection,o=t.$head,a=t.$anchor;if(!o.parent.type.spec.code||!o.sameParent(a))return!1;var l=o.node(-1),d=o.indexAfter(-1),p=YA(l.contentMatchAt(d));if(!l.canReplaceWith(d,d,p))return!1;if(e){var g=o.after(),v=n.tr.replaceWith(g,g,p.createAndFill());v.setSelection(rt.near(v.doc.resolve(g),1)),e(v.scrollIntoView())}return!0}function UC(n,e){var t=n.selection,o=t.$from,a=t.$to;if(t instanceof zo||o.parent.inlineContent||a.parent.inlineContent)return!1;var l=YA(a.parent.contentMatchAt(a.indexAfter()));if(!l||!l.isTextblock)return!1;if(e){var d=(!o.parentOffset&&a.index()<a.parent.childCount?o:a).pos,p=n.tr.insert(d,l.createAndFill());p.setSelection(Rt.create(p.doc,d+1)),e(p.scrollIntoView())}return!0}function FC(n,e){var t=n.selection,o=t.$cursor;if(!o||o.parent.content.size)return!1;if(o.depth>1&&o.after()!=o.end(-1)){var a=o.before();if(Jo(n.doc,a))return e&&e(n.tr.split(a).scrollIntoView()),!0}var l=o.blockRange(),d=l&&gc(l);return d==null?!1:(e&&e(n.tr.lift(l,d).scrollIntoView()),!0)}function pk(n,e){var t=n.selection,o=t.$from,a=t.$to;if(n.selection instanceof $e&&n.selection.node.isBlock)return!o.parentOffset||!Jo(n.doc,o.pos)?!1:(e&&e(n.tr.split(o.pos).scrollIntoView()),!0);if(!o.parent.isBlock)return!1;if(e){var l=a.parentOffset==a.parent.content.size,d=n.tr;(n.selection instanceof Rt||n.selection instanceof zo)&&d.deleteSelection();var p=o.depth==0?null:YA(o.node(-1).contentMatchAt(o.indexAfter(-1))),g=l&&p?[{type:p}]:null,v=Jo(d.doc,d.mapping.map(o.pos),1,g);if(!g&&!v&&Jo(d.doc,d.mapping.map(o.pos),1,p&&[{type:p}])&&(g=[{type:p}],v=!0),v&&(d.split(d.mapping.map(o.pos),1,g),!l&&!o.parentOffset&&o.parent.type!=p)){var C=d.mapping.map(o.before()),y=d.doc.resolve(C);o.node(-1).canReplaceWith(y.index(),y.index()+1,p)&&d.setNodeMarkup(d.mapping.map(o.before()),p)}e(d.scrollIntoView())}return!0}function Ak(n,e){var t=n.selection,o=t.$from,a=t.to,l,d=o.sharedDepth(a);return d==0?!1:(l=o.before(d),e&&e(n.tr.setSelection($e.create(n.doc,l))),!0)}function fk(n,e){return e&&e(n.tr.setSelection(new zo(n.doc))),!0}function gk(n,e,t){var o=e.nodeBefore,a=e.nodeAfter,l=e.index();return!o||!a||!o.type.compatibleContent(a.type)?!1:!o.content.size&&e.parent.canReplace(l-1,l)?(t&&t(n.tr.delete(e.pos-o.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(l,l+1)||!(a.isTextblock||xA(n.doc,e.pos))?!1:(t&&t(n.tr.clearIncompatible(e.pos,o.type,o.contentMatchAt(o.childCount)).join(e.pos).scrollIntoView()),!0)}function VC(n,e,t){var o=e.nodeBefore,a=e.nodeAfter,l,d;if(o.type.spec.isolating||a.type.spec.isolating)return!1;if(gk(n,e,t))return!0;var p=e.parent.canReplace(e.index(),e.index()+1);if(p&&(l=(d=o.contentMatchAt(o.childCount)).findWrapping(a.type))&&d.matchType(l[0]||a.type).validEnd){if(t){for(var g=e.pos+a.nodeSize,v=ee.empty,C=l.length-1;C>=0;C--)v=ee.from(l[C].create(null,v));v=ee.from(o.copy(v));var y=n.tr.step(new Jn(e.pos-1,g,e.pos,g,new ye(v,1,0),l.length,!0)),w=g+2*l.length;xA(y.doc,w)&&y.join(w),t(y.scrollIntoView())}return!0}var O=rt.findFrom(e,1),M=O&&O.$from.blockRange(O.$to),x=M&&gc(M);if(x!=null&&x>=e.depth)return t&&t(n.tr.lift(M,x).scrollIntoView()),!0;if(p&&vc(a,"start",!0)&&vc(o,"end")){for(var G=o,K=[];K.push(G),!G.isTextblock;)G=G.lastChild;for(var F=a,re=1;!F.isTextblock;F=F.firstChild)re++;if(G.canReplace(G.childCount,G.childCount,F.content)){if(t){for(var Q=ee.empty,Ae=K.length-1;Ae>=0;Ae--)Q=ee.from(K[Ae].copy(Q));var oe=n.tr.step(new Jn(e.pos-K.length,e.pos+a.nodeSize,e.pos+re,e.pos+a.nodeSize-re,new ye(Q,K.length,0),0,!0));t(oe.scrollIntoView())}return!0}}return!1}function GC(n,e){return function(t,o){var a=t.selection,l=a.$from,d=a.$to,p=l.blockRange(d),g=p&&QA(p,n,e);return g?(o&&o(t.tr.wrap(p,g).scrollIntoView()),!0):!1}}function mk(n,e){return function(t,o){var a=t.selection,l=a.from,d=a.to,p=!1;return t.doc.nodesBetween(l,d,function(g,v){if(p)return!1;if(!(!g.isTextblock||g.hasMarkup(n,e)))if(g.type==n)p=!0;else{var C=t.doc.resolve(v),y=C.index();p=C.parent.canReplaceWith(y,y+1,n)}}),p?(o&&o(t.tr.setBlockType(l,d,n,e).scrollIntoView()),!0):!1}}function qA(){for(var n=[],e=arguments.length;e--;)n[e]=arguments[e];return function(t,o,a){for(var l=0;l<n.length;l++)if(n[l](t,o,a))return!0;return!1}}var JA=qA(WA,OC,bC),jC=qA(WA,BC,MC),gs={Enter:qA(QC,UC,FC,pk),"Mod-Enter":xC,Backspace:JA,"Mod-Backspace":JA,"Shift-Backspace":JA,Delete:jC,"Mod-Delete":jC,"Mod-a":fk},vk={"Ctrl-h":gs.Backspace,"Alt-Backspace":gs["Mod-Backspace"],"Ctrl-d":gs.Delete,"Ctrl-Alt-Backspace":gs["Mod-Delete"],"Alt-Delete":gs["Mod-Delete"],"Alt-d":gs["Mod-Delete"]};for(var HC in gs)vk[HC]=gs[HC];typeof navigator!="undefined"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os!="undefined"&&os.platform()=="darwin";function Ek(n,e){return function(t,o){var a=t.selection,l=a.$from,d=a.$to,p=l.blockRange(d),g=!1,v=p;if(!p)return!1;if(p.depth>=2&&l.node(p.depth-1).type.compatibleContent(n)&&p.startIndex==0){if(l.index(p.depth-1)==0)return!1;var C=t.doc.resolve(p.start-2);v=new bl(C,C,p.depth),p.endIndex<p.parent.childCount&&(p=new bl(l,t.doc.resolve(d.end(p.depth)),p.depth)),g=!0}var y=QA(v,n,e,p);return y?(o&&o(Ik(t.tr,p,y,g,n).scrollIntoView()),!0):!1}}function Ik(n,e,t,o,a){for(var l=ee.empty,d=t.length-1;d>=0;d--)l=ee.from(t[d].type.create(t[d].attrs,l));n.step(new Jn(e.start-(o?2:0),e.end,e.start,e.end,new ye(l,0,0),t.length,!0));for(var p=0,g=0;g<t.length;g++)t[g].type==a&&(p=g+1);for(var v=t.length-p,C=e.start+t.length-(o?2:0),y=e.parent,w=e.startIndex,O=e.endIndex,M=!0;w<O;w++,M=!1)!M&&Jo(n.doc,C,v)&&(n.split(C,v),C+=2*v),C+=y.child(w).nodeSize;return n}function Ck(n){return function(e,t){var o=e.selection,a=o.$from,l=o.$to,d=a.blockRange(l,function(p){return p.childCount&&p.firstChild.type==n});return d?t?a.node(d.depth-1).type==n?yk(e,t,n,d):_k(e,t,d):!0:!1}}function yk(n,e,t,o){var a=n.tr,l=o.end,d=o.$to.end(o.depth);return l<d&&(a.step(new Jn(l-1,d,l,d,new ye(ee.from(t.create(null,o.parent.copy())),1,0),1,!0)),o=new bl(a.doc.resolve(o.$from.pos),a.doc.resolve(d),o.depth)),e(a.lift(o,gc(o)).scrollIntoView()),!0}function _k(n,e,t){for(var o=n.tr,a=t.parent,l=t.end,d=t.endIndex-1,p=t.startIndex;d>p;d--)l-=a.child(d).nodeSize,o.delete(l-1,l+1);var g=o.doc.resolve(t.start),v=g.nodeAfter;if(o.mapping.map(t.end)!=t.start+g.nodeAfter.nodeSize)return!1;var C=t.startIndex==0,y=t.endIndex==a.childCount,w=g.node(-1),O=g.index(-1);if(!w.canReplace(O+(C?0:1),O+1,v.content.append(y?ee.empty:ee.from(a))))return!1;var M=g.pos,x=M+v.nodeSize;return o.step(new Jn(M-(C?1:0),x+(y?1:0),M+1,x-1,new ye((C?ee.empty:ee.from(a.copy(ee.empty))).append(y?ee.empty:ee.from(a.copy(ee.empty))),C?0:1,y?0:1),C?0:1)),e(o.scrollIntoView()),!0}function Sk(n){return function(e,t){var o=e.selection,a=o.$from,l=o.$to,d=a.blockRange(l,function(x){return x.childCount&&x.firstChild.type==n});if(!d)return!1;var p=d.startIndex;if(p==0)return!1;var g=d.parent,v=g.child(p-1);if(v.type!=n)return!1;if(t){var C=v.lastChild&&v.lastChild.type==g.type,y=ee.from(C?n.create():null),w=new ye(ee.from(n.create(null,ee.from(g.type.create(null,y)))),C?3:1,0),O=d.start,M=d.end;t(e.tr.step(new Jn(O-(C?3:1),M,O,M,w,1,!0)).scrollIntoView())}return!0}}var ue={};if(typeof navigator!="undefined"&&typeof document!="undefined"){var zA=/Edge\/(\d+)/.exec(navigator.userAgent),KC=/MSIE \d/.test(navigator.userAgent),XA=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),ZA=ue.ie=!!(KC||XA||zA);ue.ie_version=KC?document.documentMode||6:XA?+XA[1]:zA?+zA[1]:null,ue.gecko=!ZA&&/gecko\/(\d+)/i.test(navigator.userAgent),ue.gecko_version=ue.gecko&&+(/Firefox\/(\d+)/.exec(navigator.userAgent)||[0,0])[1];var $A=!ZA&&/Chrome\/(\d+)/.exec(navigator.userAgent);ue.chrome=!!$A,ue.chrome_version=$A&&+$A[1],ue.safari=!ZA&&/Apple Computer/.test(navigator.vendor),ue.ios=ue.safari&&(/Mobile\/\w+/.test(navigator.userAgent)||navigator.maxTouchPoints>2),ue.mac=ue.ios||/Mac/.test(navigator.platform),ue.android=/Android \d/.test(navigator.userAgent),ue.webkit="webkitFontSmoothing"in document.documentElement.style,ue.webkit_version=ue.webkit&&+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]}var Ai=function(n){for(var e=0;;e++)if(n=n.previousSibling,!n)return e},ef=function(n){var e=n.assignedSlot||n.parentNode;return e&&e.nodeType==11?e.host:e},WC=null,Xo=function(n,e,t){var o=WC||(WC=document.createRange());return o.setEnd(n,t==null?n.nodeValue.length:t),o.setStart(n,e||0),o},Nd=function(n,e,t,o){return t&&(YC(n,e,t,o,-1)||YC(n,e,t,o,1))},Tk=/^(img|br|input|textarea|hr)$/i;function YC(n,e,t,o,a){for(;;){if(n==t&&e==o)return!0;if(e==(a<0?0:yo(n))){var l=n.parentNode;if(l.nodeType!=1||wk(n)||Tk.test(n.nodeName)||n.contentEditable=="false")return!1;e=Ai(n)+(a<0?0:1),n=l}else if(n.nodeType==1){if(n=n.childNodes[e+(a<0?-1:0)],n.contentEditable=="false")return!1;e=a<0?yo(n):0}else return!1}}function yo(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}function Rk(n,e,t){for(var o=e==0,a=e==yo(n);o||a;){if(n==t)return!0;var l=Ai(n);if(n=n.parentNode,!n)return!1;o=o&&l==0,a=a&&l==yo(n)}}function wk(n){for(var e,t=n;t&&!(e=t.pmViewDesc);t=t.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==n||e.contentDOM==n)}var tf=function(n){var e=n.isCollapsed;return e&&ue.chrome&&n.rangeCount&&!n.getRangeAt(0).collapsed&&(e=!1),e};function Ec(n,e){var t=document.createEvent("Event");return t.initEvent("keydown",!0,!0),t.keyCode=n,t.key=t.code=e,t}function Nk(n){return{left:0,right:n.documentElement.clientWidth,top:0,bottom:n.documentElement.clientHeight}}function ms(n,e){return typeof n=="number"?n:n[e]}function kk(n){var e=n.getBoundingClientRect(),t=e.width/n.offsetWidth||1,o=e.height/n.offsetHeight||1;return{left:e.left,right:e.left+n.clientWidth*t,top:e.top,bottom:e.top+n.clientHeight*o}}function qC(n,e,t){for(var o=n.someProp("scrollThreshold")||0,a=n.someProp("scrollMargin")||5,l=n.dom.ownerDocument,d=t||n.dom;d;d=ef(d))if(d.nodeType==1){var p=d==l.body||d.nodeType!=1,g=p?Nk(l):kk(d),v=0,C=0;if(e.top<g.top+ms(o,"top")?C=-(g.top-e.top+ms(a,"top")):e.bottom>g.bottom-ms(o,"bottom")&&(C=e.bottom-g.bottom+ms(a,"bottom")),e.left<g.left+ms(o,"left")?v=-(g.left-e.left+ms(a,"left")):e.right>g.right-ms(o,"right")&&(v=e.right-g.right+ms(a,"right")),v||C)if(p)l.defaultView.scrollBy(v,C);else{var y=d.scrollLeft,w=d.scrollTop;C&&(d.scrollTop+=C),v&&(d.scrollLeft+=v);var O=d.scrollLeft-y,M=d.scrollTop-w;e={left:e.left-O,top:e.top-M,right:e.right-O,bottom:e.bottom-M}}if(p)break}}function Ok(n){for(var e=n.dom.getBoundingClientRect(),t=Math.max(0,e.top),o,a,l=(e.left+e.right)/2,d=t+1;d<Math.min(innerHeight,e.bottom);d+=5){var p=n.root.elementFromPoint(l,d);if(!(p==n.dom||!n.dom.contains(p))){var g=p.getBoundingClientRect();if(g.top>=t-20){o=p,a=g.top;break}}}return{refDOM:o,refTop:a,stack:JC(n.dom)}}function JC(n){for(var e=[],t=n.ownerDocument;n&&(e.push({dom:n,top:n.scrollTop,left:n.scrollLeft}),n!=t);n=ef(n));return e}function bk(n){var e=n.refDOM,t=n.refTop,o=n.stack,a=e?e.getBoundingClientRect().top:0;zC(o,a==0?0:a-t)}function zC(n,e){for(var t=0;t<n.length;t++){var o=n[t],a=o.dom,l=o.top,d=o.left;a.scrollTop!=l+e&&(a.scrollTop=l+e),a.scrollLeft!=d&&(a.scrollLeft=d)}}var Ic=null;function Dk(n){if(n.setActive)return n.setActive();if(Ic)return n.focus(Ic);var e=JC(n);n.focus(Ic==null?{get preventScroll(){return Ic={preventScroll:!0},!0}}:void 0),Ic||(Ic=!1,zC(e,0))}function XC(n,e){for(var t,o=2e8,a,l=0,d=e.top,p=e.top,g=n.firstChild,v=0;g;g=g.nextSibling,v++){var C=void 0;if(g.nodeType==1)C=g.getClientRects();else if(g.nodeType==3)C=Xo(g).getClientRects();else continue;for(var y=0;y<C.length;y++){var w=C[y];if(w.top<=d&&w.bottom>=p){d=Math.max(w.bottom,d),p=Math.min(w.top,p);var O=w.left>e.left?w.left-e.left:w.right<e.left?e.left-w.right:0;if(O<o){t=g,o=O,a=O&&t.nodeType==3?{left:w.right<e.left?w.right:w.left,top:e.top}:e,g.nodeType==1&&O&&(l=v+(e.left>=(w.left+w.right)/2?1:0));continue}}!t&&(e.left>=w.right&&e.top>=w.top||e.left>=w.left&&e.top>=w.bottom)&&(l=v+1)}}return t&&t.nodeType==3?Bk(t,a):!t||o&&t.nodeType==1?{node:n,offset:l}:XC(t,a)}function Bk(n,e){for(var t=n.nodeValue.length,o=document.createRange(),a=0;a<t;a++){o.setEnd(n,a+1),o.setStart(n,a);var l=vs(o,1);if(l.top!=l.bottom&&rf(e,l))return{node:n,offset:a+(e.left>=(l.left+l.right)/2?1:0)}}return{node:n,offset:0}}function rf(n,e){return n.left>=e.left-1&&n.left<=e.right+1&&n.top>=e.top-1&&n.top<=e.bottom+1}function Mk(n,e){var t=n.parentNode;return t&&/^li$/i.test(t.nodeName)&&e.left<n.getBoundingClientRect().left?t:n}function Lk(n,e,t){var o=XC(e,t),a=o.node,l=o.offset,d=-1;if(a.nodeType==1&&!a.firstChild){var p=a.getBoundingClientRect();d=p.left!=p.right&&t.left>(p.left+p.right)/2?1:-1}return n.docView.posFromDOM(a,l,d)}function Pk(n,e,t,o){for(var a=-1,l=e;l!=n.dom;){var d=n.docView.nearestDesc(l,!0);if(!d)return null;if(d.node.isBlock&&d.parent){var p=d.dom.getBoundingClientRect();if(p.left>o.left||p.top>o.top)a=d.posBefore;else if(p.right<o.left||p.bottom<o.top)a=d.posAfter;else break}l=d.dom.parentNode}return a>-1?a:n.docView.posFromDOM(e,t)}function ZC(n,e,t){var o=n.childNodes.length;if(o&&t.top<t.bottom)for(var a=Math.max(0,Math.min(o-1,Math.floor(o*(e.top-t.top)/(t.bottom-t.top))-2)),l=a;;){var d=n.childNodes[l];if(d.nodeType==1)for(var p=d.getClientRects(),g=0;g<p.length;g++){var v=p[g];if(rf(e,v))return ZC(d,e,v)}if((l=(l+1)%o)==a)break}return n}function Qk(n,e){var t,o,a=n.dom.ownerDocument,l,d;if(a.caretPositionFromPoint)try{var p=a.caretPositionFromPoint(e.left,e.top);p&&(t=p,l=t.offsetNode,d=t.offset)}catch{}if(!l&&a.caretRangeFromPoint){var g=a.caretRangeFromPoint(e.left,e.top);g&&(o=g,l=o.startContainer,d=o.startOffset)}var v=(n.root.elementFromPoint?n.root:a).elementFromPoint(e.left,e.top+1),C;if(!v||!n.dom.contains(v.nodeType!=1?v.parentNode:v)){var y=n.dom.getBoundingClientRect();if(!rf(e,y)||(v=ZC(n.dom,e,y),!v))return null}if(ue.safari)for(var w=v;l&&w;w=ef(w))w.draggable&&(l=d=null);if(v=Mk(v,e),l){if(ue.gecko&&l.nodeType==1&&(d=Math.min(d,l.childNodes.length),d<l.childNodes.length)){var O=l.childNodes[d],M;O.nodeName=="IMG"&&(M=O.getBoundingClientRect()).right<=e.left&&M.bottom>e.top&&d++}l==n.dom&&d==l.childNodes.length-1&&l.lastChild.nodeType==1&&e.top>l.lastChild.getBoundingClientRect().bottom?C=n.state.doc.content.size:(d==0||l.nodeType!=1||l.childNodes[d-1].nodeName!="BR")&&(C=Pk(n,l,d,e))}C==null&&(C=Lk(n,v,e));var x=n.docView.nearestDesc(v,!0);return{pos:C,inside:x?x.posAtStart-x.border:-1}}function vs(n,e){var t=n.getClientRects();return t.length?t[e<0?0:t.length-1]:n.getBoundingClientRect()}var xk=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function $C(n,e,t){var o=n.docView.domFromPos(e,t<0?-1:1),a=o.node,l=o.offset,d=ue.webkit||ue.gecko;if(a.nodeType==3)if(d&&(xk.test(a.nodeValue)||(t<0?!l:l==a.nodeValue.length))){var p=vs(Xo(a,l,l),t);if(ue.gecko&&l&&/\s/.test(a.nodeValue[l-1])&&l<a.nodeValue.length){var g=vs(Xo(a,l-1,l-1),-1);if(g.top==p.top){var v=vs(Xo(a,l,l+1),-1);if(v.top!=p.top)return Fl(v,v.left<g.left)}}return p}else{var C=l,y=l,w=t<0?1:-1;return t<0&&!l?(y++,w=-1):t>=0&&l==a.nodeValue.length?(C--,w=1):t<0?C--:y++,Fl(vs(Xo(a,C,y),w),w<0)}if(!n.state.doc.resolve(e).parent.inlineContent){if(l&&(t<0||l==yo(a))){var O=a.childNodes[l-1];if(O.nodeType==1)return nf(O.getBoundingClientRect(),!1)}if(l<yo(a)){var M=a.childNodes[l];if(M.nodeType==1)return nf(M.getBoundingClientRect(),!0)}return nf(a.getBoundingClientRect(),t>=0)}if(l&&(t<0||l==yo(a))){var x=a.childNodes[l-1],G=x.nodeType==3?Xo(x,yo(x)-(d?0:1)):x.nodeType==1&&(x.nodeName!="BR"||!x.nextSibling)?x:null;if(G)return Fl(vs(G,1),!1)}if(l<yo(a)){for(var K=a.childNodes[l];K.pmViewDesc&&K.pmViewDesc.ignoreForCoords;)K=K.nextSibling;var F=K?K.nodeType==3?Xo(K,0,d?0:1):K.nodeType==1?K:null:null;if(F)return Fl(vs(F,-1),!0)}return Fl(vs(a.nodeType==3?Xo(a):a,-t),t>=0)}function Fl(n,e){if(n.width==0)return n;var t=e?n.left:n.right;return{top:n.top,bottom:n.bottom,left:t,right:t}}function nf(n,e){if(n.height==0)return n;var t=e?n.top:n.bottom;return{top:t,bottom:t,left:n.left,right:n.right}}function ey(n,e,t){var o=n.state,a=n.root.activeElement;o!=e&&n.updateState(e),a!=n.dom&&n.focus();try{return t()}finally{o!=e&&n.updateState(o),a!=n.dom&&a&&a.focus()}}function Uk(n,e,t){var o=e.selection,a=t=="up"?o.$from:o.$to;return ey(n,e,function(){for(var l=n.docView.domFromPos(a.pos,t=="up"?-1:1),d=l.node;;){var p=n.docView.nearestDesc(d,!0);if(!p)break;if(p.node.isBlock){d=p.dom;break}d=p.dom.parentNode}for(var g=$C(n,a.pos,1),v=d.firstChild;v;v=v.nextSibling){var C=void 0;if(v.nodeType==1)C=v.getClientRects();else if(v.nodeType==3)C=Xo(v,0,v.nodeValue.length).getClientRects();else continue;for(var y=0;y<C.length;y++){var w=C[y];if(w.bottom>w.top+1&&(t=="up"?g.top-w.top>(w.bottom-g.top)*2:w.bottom-g.bottom>(g.bottom-w.top)*2))return!1}}return!0})}var Fk=/[\u0590-\u08ac]/;function Vk(n,e,t){var o=e.selection,a=o.$head;if(!a.parent.isTextblock)return!1;var l=a.parentOffset,d=!l,p=l==a.parent.content.size,g=n.root.getSelection();return!Fk.test(a.parent.textContent)||!g.modify?t=="left"||t=="backward"?d:p:ey(n,e,function(){var v=g.getRangeAt(0),C=g.focusNode,y=g.focusOffset,w=g.caretBidiLevel;g.modify("move",t,"character");var O=a.depth?n.docView.domAfterPos(a.before()):n.dom,M=!O.contains(g.focusNode.nodeType==1?g.focusNode:g.focusNode.parentNode)||C==g.focusNode&&y==g.focusOffset;return g.removeAllRanges(),g.addRange(v),w!=null&&(g.caretBidiLevel=w),M})}var ty=null,ry=null,ny=!1;function Gk(n,e,t){return ty==e&&ry==t?ny:(ty=e,ry=t,ny=t=="up"||t=="down"?Uk(n,e,t):Vk(n,e,t))}var $i=0,iy=1,Vl=2,Es=3,qt=function(e,t,o,a){this.parent=e,this.children=t,this.dom=o,o.pmViewDesc=this,this.contentDOM=a,this.dirty=$i},_o={size:{configurable:!0},border:{configurable:!0},posBefore:{configurable:!0},posAtStart:{configurable:!0},posAfter:{configurable:!0},posAtEnd:{configurable:!0},contentLost:{configurable:!0},domAtom:{configurable:!0},ignoreForCoords:{configurable:!0}};qt.prototype.matchesWidget=function(){return!1};qt.prototype.matchesMark=function(){return!1};qt.prototype.matchesNode=function(){return!1};qt.prototype.matchesHack=function(e){return!1};qt.prototype.parseRule=function(){return null};qt.prototype.stopEvent=function(){return!1};_o.size.get=function(){for(var n=0,e=0;e<this.children.length;e++)n+=this.children[e].size;return n};_o.border.get=function(){return 0};qt.prototype.destroy=function(){this.parent=null,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=null);for(var e=0;e<this.children.length;e++)this.children[e].destroy()};qt.prototype.posBeforeChild=function(e){for(var t=0,o=this.posAtStart;t<this.children.length;t++){var a=this.children[t];if(a==e)return o;o+=a.size}};_o.posBefore.get=function(){return this.parent.posBeforeChild(this)};_o.posAtStart.get=function(){return this.parent?this.parent.posBeforeChild(this)+this.border:0};_o.posAfter.get=function(){return this.posBefore+this.size};_o.posAtEnd.get=function(){return this.posAtStart+this.size-2*this.border};qt.prototype.localPosFromDOM=function(e,t,o){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(o<0){var a,l;if(e==this.contentDOM)a=e.childNodes[t-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;a=e.previousSibling}for(;a&&!((l=a.pmViewDesc)&&l.parent==this);)a=a.previousSibling;return a?this.posBeforeChild(l)+l.size:this.posAtStart}else{var d,p;if(e==this.contentDOM)d=e.childNodes[t];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;d=e.nextSibling}for(;d&&!((p=d.pmViewDesc)&&p.parent==this);)d=d.nextSibling;return d?this.posBeforeChild(p):this.posAtEnd}var g;if(e==this.dom&&this.contentDOM)g=t>Ai(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))g=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(t==0)for(var v=e;;v=v.parentNode){if(v==this.dom){g=!1;break}if(v.parentNode.firstChild!=v)break}if(g==null&&t==e.childNodes.length)for(var C=e;;C=C.parentNode){if(C==this.dom){g=!0;break}if(C.parentNode.lastChild!=C)break}}return(g==null?o>0:g)?this.posAtEnd:this.posAtStart};qt.prototype.nearestDesc=function(e,t){for(var o=!0,a=e;a;a=a.parentNode){var l=this.getDesc(a);if(l&&(!t||l.node))if(o&&l.nodeDOM&&!(l.nodeDOM.nodeType==1?l.nodeDOM.contains(e.nodeType==1?e:e.parentNode):l.nodeDOM==e))o=!1;else return l}};qt.prototype.getDesc=function(e){for(var t=e.pmViewDesc,o=t;o;o=o.parent)if(o==this)return t};qt.prototype.posFromDOM=function(e,t,o){for(var a=e;a;a=a.parentNode){var l=this.getDesc(a);if(l)return l.localPosFromDOM(e,t,o)}return-1};qt.prototype.descAt=function(e){for(var t=0,o=0;t<this.children.length;t++){var a=this.children[t],l=o+a.size;if(o==e&&l!=o){for(;!a.border&&a.children.length;)a=a.children[0];return a}if(e<l)return a.descAt(e-o-a.border);o=l}};qt.prototype.domFromPos=function(e,t){if(!this.contentDOM)return{node:this.dom,offset:0};for(var o=0,a=0,l=0;o<this.children.length;o++){var d=this.children[o],p=l+d.size;if(p>e||d instanceof cy){a=e-l;break}l=p}if(a)return this.children[o].domFromPos(a-this.children[o].border,t);for(var g=void 0;o&&!(g=this.children[o-1]).size&&g instanceof oy&&g.widget.type.side>=0;o--);if(t<=0){for(var v,C=!0;v=o?this.children[o-1]:null,!(!v||v.dom.parentNode==this.contentDOM);o--,C=!1);return v&&t&&C&&!v.border&&!v.domAtom?v.domFromPos(v.size,t):{node:this.contentDOM,offset:v?Ai(v.dom)+1:0}}else{for(var y,w=!0;y=o<this.children.length?this.children[o]:null,!(!y||y.dom.parentNode==this.contentDOM);o++,w=!1);return y&&w&&!y.border&&!y.domAtom?y.domFromPos(0,t):{node:this.contentDOM,offset:y?Ai(y.dom):this.contentDOM.childNodes.length}}};qt.prototype.parseRange=function(e,t,o){if(o===void 0&&(o=0),this.children.length==0)return{node:this.contentDOM,from:e,to:t,fromOffset:0,toOffset:this.contentDOM.childNodes.length};for(var a=-1,l=-1,d=o,p=0;;p++){var g=this.children[p],v=d+g.size;if(a==-1&&e<=v){var C=d+g.border;if(e>=C&&t<=v-g.border&&g.node&&g.contentDOM&&this.contentDOM.contains(g.contentDOM))return g.parseRange(e,t,C);e=d;for(var y=p;y>0;y--){var w=this.children[y-1];if(w.size&&w.dom.parentNode==this.contentDOM&&!w.emptyChildAt(1)){a=Ai(w.dom)+1;break}e-=w.size}a==-1&&(a=0)}if(a>-1&&(v>t||p==this.children.length-1)){t=v;for(var O=p+1;O<this.children.length;O++){var M=this.children[O];if(M.size&&M.dom.parentNode==this.contentDOM&&!M.emptyChildAt(-1)){l=Ai(M.dom);break}t+=M.size}l==-1&&(l=this.contentDOM.childNodes.length);break}d=v}return{node:this.contentDOM,from:e,to:t,fromOffset:a,toOffset:l}};qt.prototype.emptyChildAt=function(e){if(this.border||!this.contentDOM||!this.children.length)return!1;var t=this.children[e<0?0:this.children.length-1];return t.size==0||t.emptyChildAt(e)};qt.prototype.domAfterPos=function(e){var t=this.domFromPos(e,0),o=t.node,a=t.offset;if(o.nodeType!=1||a==o.childNodes.length)throw new RangeError("No node after pos "+e);return o.childNodes[a]};qt.prototype.setSelection=function(e,t,o,a){for(var l=Math.min(e,t),d=Math.max(e,t),p=0,g=0;p<this.children.length;p++){var v=this.children[p],C=g+v.size;if(l>g&&d<C)return v.setSelection(e-g-v.border,t-g-v.border,o,a);g=C}var y=this.domFromPos(e,e?-1:1),w=t==e?y:this.domFromPos(t,t?-1:1),O=o.getSelection(),M=!1;if((ue.gecko||ue.safari)&&e==t){var x=y.node,G=y.offset;if(x.nodeType==3){if(M=G&&x.nodeValue[G-1]==`
`,M&&G==x.nodeValue.length)for(var K=x,F=void 0;K;K=K.parentNode){if(F=K.nextSibling){F.nodeName=="BR"&&(y=w={node:F.parentNode,offset:Ai(F)+1});break}var re=K.pmViewDesc;if(re&&re.node&&re.node.isBlock)break}}else{var Q=x.childNodes[G-1];M=Q&&(Q.nodeName=="BR"||Q.contentEditable=="false")}}if(ue.gecko&&O.focusNode&&O.focusNode!=w.node&&O.focusNode.nodeType==1){var Ae=O.focusNode.childNodes[O.focusOffset];Ae&&Ae.contentEditable=="false"&&(a=!0)}if(!(!(a||M&&ue.safari)&&Nd(y.node,y.offset,O.anchorNode,O.anchorOffset)&&Nd(w.node,w.offset,O.focusNode,O.focusOffset))){var oe=!1;if((O.extend||e==t)&&!M){O.collapse(y.node,y.offset);try{e!=t&&O.extend(w.node,w.offset),oe=!0}catch(We){if(!(We instanceof DOMException))throw We}}if(!oe){if(e>t){var Te=y;y=w,w=Te}var je=document.createRange();je.setEnd(w.node,w.offset),je.setStart(y.node,y.offset),O.removeAllRanges(),O.addRange(je)}}};qt.prototype.ignoreMutation=function(e){return!this.contentDOM&&e.type!="selection"};_o.contentLost.get=function(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)};qt.prototype.markDirty=function(e,t){for(var o=0,a=0;a<this.children.length;a++){var l=this.children[a],d=o+l.size;if(o==d?e<=d&&t>=o:e<d&&t>o){var p=o+l.border,g=d-l.border;if(e>=p&&t<=g){this.dirty=e==o||t==d?Vl:iy,e==p&&t==g&&(l.contentLost||l.dom.parentNode!=this.contentDOM)?l.dirty=Es:l.markDirty(e-p,t-p);return}else l.dirty=l.dom==l.contentDOM&&l.dom.parentNode==this.contentDOM?Vl:Es}o=d}this.dirty=Vl};qt.prototype.markParentsDirty=function(){for(var e=1,t=this.parent;t;t=t.parent,e++){var o=e==1?Vl:iy;t.dirty<o&&(t.dirty=o)}};_o.domAtom.get=function(){return!1};_o.ignoreForCoords.get=function(){return!1};Object.defineProperties(qt.prototype,_o);var Is=[],oy=function(n){function e(o,a,l,d){var p,g=a.type.toDOM;if(typeof g=="function"&&(g=g(l,function(){if(!p)return d;if(p.parent)return p.parent.posBeforeChild(p)})),!a.type.spec.raw){if(g.nodeType!=1){var v=document.createElement("span");v.appendChild(g),g=v}g.contentEditable=!1,g.classList.add("ProseMirror-widget")}n.call(this,o,Is,g,null),this.widget=a,p=this}n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e;var t={domAtom:{configurable:!0}};return e.prototype.matchesWidget=function(a){return this.dirty==$i&&a.type.eq(this.widget.type)},e.prototype.parseRule=function(){return{ignore:!0}},e.prototype.stopEvent=function(a){var l=this.widget.spec.stopEvent;return l?l(a):!1},e.prototype.ignoreMutation=function(a){return a.type!="selection"||this.widget.spec.ignoreSelection},e.prototype.destroy=function(){this.widget.type.destroy(this.dom),n.prototype.destroy.call(this)},t.domAtom.get=function(){return!0},Object.defineProperties(e.prototype,t),e}(qt),jk=function(n){function e(o,a,l,d){n.call(this,o,Is,a,null),this.textDOM=l,this.text=d}n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e;var t={size:{configurable:!0}};return t.size.get=function(){return this.text.length},e.prototype.localPosFromDOM=function(a,l){return a!=this.textDOM?this.posAtStart+(l?this.size:0):this.posAtStart+l},e.prototype.domFromPos=function(a){return{node:this.textDOM,offset:a}},e.prototype.ignoreMutation=function(a){return a.type==="characterData"&&a.target.nodeValue==a.oldValue},Object.defineProperties(e.prototype,t),e}(qt),kd=function(n){function e(t,o,a,l){n.call(this,t,[],a,l),this.mark=o}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.create=function(o,a,l,d){var p=d.nodeViews[a.type.name],g=p&&p(a,d,l);return(!g||!g.dom)&&(g=tn.renderSpec(document,a.type.spec.toDOM(a,l))),new e(o,a,g.dom,g.contentDOM||g.dom)},e.prototype.parseRule=function(){return{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}},e.prototype.matchesMark=function(o){return this.dirty!=Es&&this.mark.eq(o)},e.prototype.markDirty=function(o,a){if(n.prototype.markDirty.call(this,o,a),this.dirty!=$i){for(var l=this.parent;!l.node;)l=l.parent;l.dirty<this.dirty&&(l.dirty=this.dirty),this.dirty=$i}},e.prototype.slice=function(o,a,l){var d=e.create(this.parent,this.mark,!0,l),p=this.children,g=this.size;a<g&&(p=af(p,a,g,l)),o>0&&(p=af(p,0,o,l));for(var v=0;v<p.length;v++)p[v].parent=d;return d.children=p,d},e}(qt),Gl=function(n){function e(o,a,l,d,p,g,v,C,y){n.call(this,o,a.isLeaf?Is:[],p,g),this.nodeDOM=v,this.node=a,this.outerDeco=l,this.innerDeco=d,g&&this.updateChildren(C,y)}n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e;var t={size:{configurable:!0},border:{configurable:!0},domAtom:{configurable:!0}};return e.create=function(a,l,d,p,g,v){var C,y=g.nodeViews[l.type.name],w,O=y&&y(l,g,function(){if(!w)return v;if(w.parent)return w.parent.posBeforeChild(w)},d,p),M=O&&O.dom,x=O&&O.contentDOM;if(l.isText){if(!M)M=document.createTextNode(l.text);else if(M.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else M||(C=tn.renderSpec(document,l.type.spec.toDOM(l)),M=C.dom,x=C.contentDOM);!x&&!l.isText&&M.nodeName!="BR"&&(M.hasAttribute("contenteditable")||(M.contentEditable=!1),l.type.spec.draggable&&(M.draggable=!0));var G=M;return M=dy(M,d,l),O?w=new Hk(a,l,d,p,M,x,G,O,g,v+1):l.isText?new ay(a,l,d,p,M,G,g):new e(a,l,d,p,M,x,G,g,v+1)},e.prototype.parseRule=function(){var a=this;if(this.node.type.spec.reparseInView)return null;var l={node:this.node.type.name,attrs:this.node.attrs};return this.node.type.spec.code&&(l.preserveWhitespace="full"),this.contentDOM&&!this.contentLost?l.contentElement=this.contentDOM:l.getContent=function(){return a.contentDOM?ee.empty:a.node.content},l},e.prototype.matchesNode=function(a,l,d){return this.dirty==$i&&a.eq(this.node)&&sf(l,this.outerDeco)&&d.eq(this.innerDeco)},t.size.get=function(){return this.node.nodeSize},t.border.get=function(){return this.node.isLeaf?0:1},e.prototype.updateChildren=function(a,l){var d=this,p=this.node.inlineContent,g=l,v=a.composing&&this.localCompositionInfo(a,l),C=v&&v.pos>-1?v:null,y=v&&v.pos<0,w=new Li(this,C&&C.node);qk(this.node,this.innerDeco,function(O,M,x){O.spec.marks?w.syncToMarks(O.spec.marks,p,a):O.type.side>=0&&!x&&w.syncToMarks(M==d.node.childCount?Et.none:d.node.child(M).marks,p,a),w.placeWidget(O,a,g)},function(O,M,x,G){w.syncToMarks(O.marks,p,a);var K;w.findNodeMatch(O,M,x,G)||y&&a.state.selection.from>g&&a.state.selection.to<g+O.nodeSize&&(K=w.findIndexWithChild(v.node))>-1&&w.updateNodeAt(O,M,x,K,a)||w.updateNextNode(O,M,x,a,G)||w.addNode(O,M,x,a,g),g+=O.nodeSize}),w.syncToMarks(Is,p,a),this.node.isTextblock&&w.addTextblockHacks(),w.destroyRest(),(w.changed||this.dirty==Vl)&&(C&&this.protectLocalComposition(a,C),ly(this.contentDOM,this.children,a),ue.ios&&Jk(this.dom))},e.prototype.localCompositionInfo=function(a,l){var d=a.state.selection,p=d.from,g=d.to;if(!(!(a.state.selection instanceof Rt)||p<l||g>l+this.node.content.size)){var v=a.root.getSelection(),C=zk(v.focusNode,v.focusOffset);if(!(!C||!this.dom.contains(C.parentNode)))if(this.node.inlineContent){var y=C.nodeValue,w=Xk(this.node.content,y,p-l,g-l);return w<0?null:{node:C,pos:w,text:y}}else return{node:C,pos:-1}}},e.prototype.protectLocalComposition=function(a,l){var d=l.node,p=l.pos,g=l.text;if(!this.getDesc(d)){for(var v=d;v.parentNode!=this.contentDOM;v=v.parentNode){for(;v.previousSibling;)v.parentNode.removeChild(v.previousSibling);for(;v.nextSibling;)v.parentNode.removeChild(v.nextSibling);v.pmViewDesc&&(v.pmViewDesc=null)}var C=new jk(this,v,d,g);a.compositionNodes.push(C),this.children=af(this.children,p,p+g.length,a,C)}},e.prototype.update=function(a,l,d,p){return this.dirty==Es||!a.sameMarkup(this.node)?!1:(this.updateInner(a,l,d,p),!0)},e.prototype.updateInner=function(a,l,d,p){this.updateOuterDeco(l),this.node=a,this.innerDeco=d,this.contentDOM&&this.updateChildren(p,this.posAtStart),this.dirty=$i},e.prototype.updateOuterDeco=function(a){if(!sf(a,this.outerDeco)){var l=this.nodeDOM.nodeType!=1,d=this.dom;this.dom=uy(this.dom,this.nodeDOM,of(this.outerDeco,this.node,l),of(a,this.node,l)),this.dom!=d&&(d.pmViewDesc=null,this.dom.pmViewDesc=this),this.outerDeco=a}},e.prototype.selectNode=function(){this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.dom.draggable=!0)},e.prototype.deselectNode=function(){this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.dom.removeAttribute("draggable")},t.domAtom.get=function(){return this.node.isAtom},Object.defineProperties(e.prototype,t),e}(qt);function sy(n,e,t,o,a){return dy(o,e,n),new Gl(null,n,e,t,o,o,o,a,0)}var ay=function(n){function e(o,a,l,d,p,g,v){n.call(this,o,a,l,d,p,null,g,v)}n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e;var t={domAtom:{configurable:!0}};return e.prototype.parseRule=function(){for(var a=this.nodeDOM.parentNode;a&&a!=this.dom&&!a.pmIsDeco;)a=a.parentNode;return{skip:a||!0}},e.prototype.update=function(a,l,d,p){return this.dirty==Es||this.dirty!=$i&&!this.inParent()||!a.sameMarkup(this.node)?!1:(this.updateOuterDeco(l),(this.dirty!=$i||a.text!=this.node.text)&&a.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=a.text,p.trackWrites==this.nodeDOM&&(p.trackWrites=null)),this.node=a,this.dirty=$i,!0)},e.prototype.inParent=function(){for(var a=this.parent.contentDOM,l=this.nodeDOM;l;l=l.parentNode)if(l==a)return!0;return!1},e.prototype.domFromPos=function(a){return{node:this.nodeDOM,offset:a}},e.prototype.localPosFromDOM=function(a,l,d){return a==this.nodeDOM?this.posAtStart+Math.min(l,this.node.text.length):n.prototype.localPosFromDOM.call(this,a,l,d)},e.prototype.ignoreMutation=function(a){return a.type!="characterData"&&a.type!="selection"},e.prototype.slice=function(a,l,d){var p=this.node.cut(a,l),g=document.createTextNode(p.text);return new e(this.parent,p,this.outerDeco,this.innerDeco,g,g,d)},e.prototype.markDirty=function(a,l){n.prototype.markDirty.call(this,a,l),this.dom!=this.nodeDOM&&(a==0||l==this.nodeDOM.nodeValue.length)&&(this.dirty=Es)},t.domAtom.get=function(){return!1},Object.defineProperties(e.prototype,t),e}(Gl),cy=function(n){function e(){n.apply(this,arguments)}n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e;var t={domAtom:{configurable:!0},ignoreForCoords:{configurable:!0}};return e.prototype.parseRule=function(){return{ignore:!0}},e.prototype.matchesHack=function(a){return this.dirty==$i&&this.dom.nodeName==a},t.domAtom.get=function(){return!0},t.ignoreForCoords.get=function(){return this.dom.nodeName=="IMG"},Object.defineProperties(e.prototype,t),e}(qt),Hk=function(n){function e(t,o,a,l,d,p,g,v,C,y){n.call(this,t,o,a,l,d,p,g,C,y),this.spec=v}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.update=function(o,a,l,d){if(this.dirty==Es)return!1;if(this.spec.update){var p=this.spec.update(o,a,l);return p&&this.updateInner(o,a,l,d),p}else return!this.contentDOM&&!o.isLeaf?!1:n.prototype.update.call(this,o,a,l,d)},e.prototype.selectNode=function(){this.spec.selectNode?this.spec.selectNode():n.prototype.selectNode.call(this)},e.prototype.deselectNode=function(){this.spec.deselectNode?this.spec.deselectNode():n.prototype.deselectNode.call(this)},e.prototype.setSelection=function(o,a,l,d){this.spec.setSelection?this.spec.setSelection(o,a,l):n.prototype.setSelection.call(this,o,a,l,d)},e.prototype.destroy=function(){this.spec.destroy&&this.spec.destroy(),n.prototype.destroy.call(this)},e.prototype.stopEvent=function(o){return this.spec.stopEvent?this.spec.stopEvent(o):!1},e.prototype.ignoreMutation=function(o){return this.spec.ignoreMutation?this.spec.ignoreMutation(o):n.prototype.ignoreMutation.call(this,o)},e}(Gl);function ly(n,e,t){for(var o=n.firstChild,a=!1,l=0;l<e.length;l++){var d=e[l],p=d.dom;if(p.parentNode==n){for(;p!=o;)o=hy(o),a=!0;o=o.nextSibling}else a=!0,n.insertBefore(p,o);if(d instanceof kd){var g=o?o.previousSibling:n.lastChild;ly(d.contentDOM,d.children,t),o=g?g.nextSibling:n.firstChild}}for(;o;)o=hy(o),a=!0;a&&t.trackWrites==n&&(t.trackWrites=null)}function jl(n){n&&(this.nodeName=n)}jl.prototype=Object.create(null);var aa=[new jl];function of(n,e,t){if(n.length==0)return aa;for(var o=t?aa[0]:new jl,a=[o],l=0;l<n.length;l++){var d=n[l].type.attrs;if(!!d){d.nodeName&&a.push(o=new jl(d.nodeName));for(var p in d){var g=d[p];g!=null&&(t&&a.length==1&&a.push(o=new jl(e.isInline?"span":"div")),p=="class"?o.class=(o.class?o.class+" ":"")+g:p=="style"?o.style=(o.style?o.style+";":"")+g:p!="nodeName"&&(o[p]=g))}}}return a}function uy(n,e,t,o){if(t==aa&&o==aa)return e;for(var a=e,l=0;l<o.length;l++){var d=o[l],p=t[l];if(l){var g=void 0;p&&p.nodeName==d.nodeName&&a!=n&&(g=a.parentNode)&&g.tagName.toLowerCase()==d.nodeName||(g=document.createElement(d.nodeName),g.pmIsDeco=!0,g.appendChild(a),p=aa[0]),a=g}Kk(a,p||aa[0],d)}return a}function Kk(n,e,t){for(var o in e)o!="class"&&o!="style"&&o!="nodeName"&&!(o in t)&&n.removeAttribute(o);for(var a in t)a!="class"&&a!="style"&&a!="nodeName"&&t[a]!=e[a]&&n.setAttribute(a,t[a]);if(e.class!=t.class){for(var l=e.class?e.class.split(" ").filter(Boolean):Is,d=t.class?t.class.split(" ").filter(Boolean):Is,p=0;p<l.length;p++)d.indexOf(l[p])==-1&&n.classList.remove(l[p]);for(var g=0;g<d.length;g++)l.indexOf(d[g])==-1&&n.classList.add(d[g]);n.classList.length==0&&n.removeAttribute("class")}if(e.style!=t.style){if(e.style)for(var v=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,C;C=v.exec(e.style);)n.style.removeProperty(C[1]);t.style&&(n.style.cssText+=t.style)}}function dy(n,e,t){return uy(n,n,aa,of(e,t,n.nodeType!=1))}function sf(n,e){if(n.length!=e.length)return!1;for(var t=0;t<n.length;t++)if(!n[t].type.eq(e[t].type))return!1;return!0}function hy(n){var e=n.nextSibling;return n.parentNode.removeChild(n),e}var Li=function(e,t){this.top=e,this.lock=t,this.index=0,this.stack=[],this.changed=!1,this.preMatch=Wk(e.node.content,e)};Li.prototype.destroyBetween=function(e,t){if(e!=t){for(var o=e;o<t;o++)this.top.children[o].destroy();this.top.children.splice(e,t-e),this.changed=!0}};Li.prototype.destroyRest=function(){this.destroyBetween(this.index,this.top.children.length)};Li.prototype.syncToMarks=function(e,t,o){for(var a=0,l=this.stack.length>>1,d=Math.min(l,e.length);a<d&&(a==l-1?this.top:this.stack[a+1<<1]).matchesMark(e[a])&&e[a].type.spec.spanning!==!1;)a++;for(;a<l;)this.destroyRest(),this.top.dirty=$i,this.index=this.stack.pop(),this.top=this.stack.pop(),l--;for(;l<e.length;){this.stack.push(this.top,this.index+1);for(var p=-1,g=this.index;g<Math.min(this.index+3,this.top.children.length);g++)if(this.top.children[g].matchesMark(e[l])){p=g;break}if(p>-1)p>this.index&&(this.changed=!0,this.destroyBetween(this.index,p)),this.top=this.top.children[this.index];else{var v=kd.create(this.top,e[l],t,o);this.top.children.splice(this.index,0,v),this.top=v,this.changed=!0}this.index=0,l++}};Li.prototype.findNodeMatch=function(e,t,o,a){var l=-1,d;if(a>=this.preMatch.index&&(d=this.preMatch.matches[a-this.preMatch.index]).parent==this.top&&d.matchesNode(e,t,o))l=this.top.children.indexOf(d,this.index);else for(var p=this.index,g=Math.min(this.top.children.length,p+5);p<g;p++){var v=this.top.children[p];if(v.matchesNode(e,t,o)&&!this.preMatch.matched.has(v)){l=p;break}}return l<0?!1:(this.destroyBetween(this.index,l),this.index++,!0)};Li.prototype.updateNodeAt=function(e,t,o,a,l){var d=this.top.children[a];return d.update(e,t,o,l)?(this.destroyBetween(this.index,a),this.index=a+1,!0):!1};Li.prototype.findIndexWithChild=function(e){for(;;){var t=e.parentNode;if(!t)return-1;if(t==this.top.contentDOM){var o=e.pmViewDesc;if(o){for(var a=this.index;a<this.top.children.length;a++)if(this.top.children[a]==o)return a}return-1}e=t}};Li.prototype.updateNextNode=function(e,t,o,a,l){for(var d=this.index;d<this.top.children.length;d++){var p=this.top.children[d];if(p instanceof Gl){var g=this.preMatch.matched.get(p);if(g!=null&&g!=l)return!1;var v=p.dom,C=this.lock&&(v==this.lock||v.nodeType==1&&v.contains(this.lock.parentNode))&&!(e.isText&&p.node&&p.node.isText&&p.nodeDOM.nodeValue==e.text&&p.dirty!=Es&&sf(t,p.outerDeco));if(!C&&p.update(e,t,o,a))return this.destroyBetween(this.index,d),p.dom!=v&&(this.changed=!0),this.index++,!0;break}}return!1};Li.prototype.addNode=function(e,t,o,a,l){this.top.children.splice(this.index++,0,Gl.create(this.top,e,t,o,a,l)),this.changed=!0};Li.prototype.placeWidget=function(e,t,o){var a=this.index<this.top.children.length?this.top.children[this.index]:null;if(a&&a.matchesWidget(e)&&(e==a.widget||!a.widget.type.toDOM.parentNode))this.index++;else{var l=new oy(this.top,e,t,o);this.top.children.splice(this.index++,0,l),this.changed=!0}};Li.prototype.addTextblockHacks=function(){for(var e=this.top.children[this.index-1];e instanceof kd;)e=e.children[e.children.length-1];(!e||!(e instanceof ay)||/\n$/.test(e.node.text))&&((ue.safari||ue.chrome)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG"),this.addHackNode("BR"))};Li.prototype.addHackNode=function(e){if(this.index<this.top.children.length&&this.top.children[this.index].matchesHack(e))this.index++;else{var t=document.createElement(e);e=="IMG"&&(t.className="ProseMirror-separator"),e=="BR"&&(t.className="ProseMirror-trailingBreak"),this.top.children.splice(this.index++,0,new cy(this.top,Is,t,null)),this.changed=!0}};function Wk(n,e){var t=e,o=t.children.length,a=n.childCount,l=new Map,d=[];e:for(;a>0;){for(var p=void 0;;)if(o){var g=t.children[o-1];if(g instanceof kd)t=g,o=g.children.length;else{p=g,o--;break}}else{if(t==e)break e;o=t.parent.children.indexOf(t),t=t.parent}var v=p.node;if(!!v){if(v!=n.child(a-1))break;--a,l.set(p,a),d.push(p)}}return{index:a,matched:l,matches:d.reverse()}}function Yk(n,e){return n.type.side-e.type.side}function qk(n,e,t,o){var a=e.locals(n),l=0;if(a.length==0){for(var d=0;d<n.childCount;d++){var p=n.child(d);o(p,a,e.forChild(l,p),d),l+=p.nodeSize}return}for(var g=0,v=[],C=null,y=0;;){if(g<a.length&&a[g].to==l){for(var w=a[g++],O=void 0;g<a.length&&a[g].to==l;)(O||(O=[w])).push(a[g++]);if(O){O.sort(Yk);for(var M=0;M<O.length;M++)t(O[M],y,!!C)}else t(w,y,!!C)}var x=void 0,G=void 0;if(C)G=-1,x=C,C=null;else if(y<n.childCount)G=y,x=n.child(y++);else break;for(var K=0;K<v.length;K++)v[K].to<=l&&v.splice(K--,1);for(;g<a.length&&a[g].from<=l&&a[g].to>l;)v.push(a[g++]);var F=l+x.nodeSize;if(x.isText){var re=F;g<a.length&&a[g].from<re&&(re=a[g].from);for(var Q=0;Q<v.length;Q++)v[Q].to<re&&(re=v[Q].to);re<F&&(C=x.cut(re-l),x=x.cut(0,re-l),F=re,G=-1)}var Ae=v.length?x.isInline&&!x.isLeaf?v.filter(function(oe){return!oe.inline}):v.slice():Is;o(x,Ae,e.forChild(l,x),G),l=F}}function Jk(n){if(n.nodeName=="UL"||n.nodeName=="OL"){var e=n.style.cssText;n.style.cssText=e+"; list-style: square !important",window.getComputedStyle(n).listStyle,n.style.cssText=e}}function zk(n,e){for(;;){if(n.nodeType==3)return n;if(n.nodeType==1&&e>0){if(n.childNodes.length>e&&n.childNodes[e].nodeType==3)return n.childNodes[e];n=n.childNodes[e-1],e=yo(n)}else if(n.nodeType==1&&e<n.childNodes.length)n=n.childNodes[e],e=0;else return null}}function Xk(n,e,t,o){for(var a=0,l=0;a<n.childCount&&l<=o;){var d=n.child(a++),p=l;if(l+=d.nodeSize,!!d.isText){for(var g=d.text;a<n.childCount;){var v=n.child(a++);if(l+=v.nodeSize,!v.isText)break;g+=v.text}if(l>=t){var C=g.lastIndexOf(e,o-p);if(C>=0&&C+e.length+p>=t)return p+C}}}return-1}function af(n,e,t,o,a){for(var l=[],d=0,p=0;d<n.length;d++){var g=n[d],v=p,C=p+=g.size;v>=t||C<=e?l.push(g):(v<e&&l.push(g.slice(0,e-v,o)),a&&(l.push(a),a=null),C>t&&l.push(g.slice(t-v,g.size,o)))}return l}function py(n,e){var t=n.root.getSelection(),o=n.state.doc;if(!t.focusNode)return null;var a=n.docView.nearestDesc(t.focusNode),l=a&&a.size==0,d=n.docView.posFromDOM(t.focusNode,t.focusOffset);if(d<0)return null;var p=o.resolve(d),g,v;if(tf(t)){for(g=p;a&&!a.node;)a=a.parent;if(a&&a.node.isAtom&&$e.isSelectable(a.node)&&a.parent&&!(a.node.isInline&&Rk(t.focusNode,t.focusOffset,a.dom))){var C=a.posBefore;v=new $e(d==C?p:o.resolve(C))}}else{var y=n.docView.posFromDOM(t.anchorNode,t.anchorOffset);if(y<0)return null;g=o.resolve(y)}if(!v){var w=e=="pointer"||n.state.selection.head<p.pos&&!l?1:-1;v=lf(n,g,p,w)}return v}function Ay(n){return n.editable?n.hasFocus():uf(n)&&document.activeElement&&document.activeElement.contains(n.dom)}function Cs(n,e){var t=n.state.selection;if(vy(n,t),!!Ay(n)){if(!e&&n.mouseDown&&n.mouseDown.allowDefault){n.mouseDown.delayedSelectionSync=!0,n.domObserver.setCurSelection();return}if(n.domObserver.disconnectSelection(),n.cursorWrapper)$k(n);else{var o=t.anchor,a=t.head,l,d;fy&&!(t instanceof Rt)&&(t.$from.parent.inlineContent||(l=gy(n,t.from)),!t.empty&&!t.$from.parent.inlineContent&&(d=gy(n,t.to))),n.docView.setSelection(o,a,n.root,e),fy&&(l&&my(l),d&&my(d)),t.visible?n.dom.classList.remove("ProseMirror-hideselection"):(n.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&Zk(n))}n.domObserver.setCurSelection(),n.domObserver.connectSelection()}}var fy=ue.safari||ue.chrome&&ue.chrome_version<63;function gy(n,e){var t=n.docView.domFromPos(e,0),o=t.node,a=t.offset,l=a<o.childNodes.length?o.childNodes[a]:null,d=a?o.childNodes[a-1]:null;if(ue.safari&&l&&l.contentEditable=="false")return cf(l);if((!l||l.contentEditable=="false")&&(!d||d.contentEditable=="false")){if(l)return cf(l);if(d)return cf(d)}}function cf(n){return n.contentEditable="true",ue.safari&&n.draggable&&(n.draggable=!1,n.wasDraggable=!0),n}function my(n){n.contentEditable="false",n.wasDraggable&&(n.draggable=!0,n.wasDraggable=null)}function Zk(n){var e=n.dom.ownerDocument;e.removeEventListener("selectionchange",n.hideSelectionGuard);var t=n.root.getSelection(),o=t.anchorNode,a=t.anchorOffset;e.addEventListener("selectionchange",n.hideSelectionGuard=function(){(t.anchorNode!=o||t.anchorOffset!=a)&&(e.removeEventListener("selectionchange",n.hideSelectionGuard),setTimeout(function(){(!Ay(n)||n.state.selection.visible)&&n.dom.classList.remove("ProseMirror-hideselection")},20))})}function $k(n){var e=n.root.getSelection(),t=document.createRange(),o=n.cursorWrapper.dom,a=o.nodeName=="IMG";a?t.setEnd(o.parentNode,Ai(o)+1):t.setEnd(o,0),t.collapse(!1),e.removeAllRanges(),e.addRange(t),!a&&!n.state.selection.visible&&ue.ie&&ue.ie_version<=11&&(o.disabled=!0,o.disabled=!1)}function vy(n,e){if(e instanceof $e){var t=n.docView.descAt(e.from);t!=n.lastSelectedViewDesc&&(Ey(n),t&&t.selectNode(),n.lastSelectedViewDesc=t)}else Ey(n)}function Ey(n){n.lastSelectedViewDesc&&(n.lastSelectedViewDesc.parent&&n.lastSelectedViewDesc.deselectNode(),n.lastSelectedViewDesc=null)}function lf(n,e,t,o){return n.someProp("createSelectionBetween",function(a){return a(n,e,t)})||Rt.between(e,t,o)}function eO(n){return n.editable&&n.root.activeElement!=n.dom?!1:uf(n)}function uf(n){var e=n.root.getSelection();if(!e.anchorNode)return!1;try{return n.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(n.editable||n.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function tO(n){var e=n.docView.domFromPos(n.state.selection.anchor,0),t=n.root.getSelection();return Nd(e.node,e.offset,t.anchorNode,t.anchorOffset)}function df(n,e){var t=n.selection,o=t.$anchor,a=t.$head,l=e>0?o.max(a):o.min(a),d=l.parent.inlineContent?l.depth?n.doc.resolve(e>0?l.after():l.before()):null:l;return d&&rt.findFrom(d,e)}function ca(n,e){return n.dispatch(n.state.tr.setSelection(e).scrollIntoView()),!0}function Iy(n,e,t){var o=n.state.selection;if(o instanceof Rt){if(!o.empty||t.indexOf("s")>-1)return!1;if(n.endOfTextblock(e>0?"right":"left")){var a=df(n.state,e);return a&&a instanceof $e?ca(n,a):!1}else if(!(ue.mac&&t.indexOf("m")>-1)){var l=o.$head,d=l.textOffset?null:e<0?l.nodeBefore:l.nodeAfter,p;if(!d||d.isText)return!1;var g=e<0?l.pos-d.nodeSize:l.pos;return d.isAtom||(p=n.docView.descAt(g))&&!p.contentDOM?$e.isSelectable(d)?ca(n,new $e(e<0?n.state.doc.resolve(l.pos-d.nodeSize):l)):ue.webkit?ca(n,new Rt(n.state.doc.resolve(e<0?g:g+d.nodeSize))):!1:!1}}else{if(o instanceof $e&&o.node.isInline)return ca(n,new Rt(e>0?o.$to:o.$from));var v=df(n.state,e);return v?ca(n,v):!1}}function Od(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}function Hl(n){var e=n.pmViewDesc;return e&&e.size==0&&(n.nextSibling||n.nodeName!="BR")}function hf(n){var e=n.root.getSelection(),t=e.focusNode,o=e.focusOffset;if(!!t){var a,l,d=!1;for(ue.gecko&&t.nodeType==1&&o<Od(t)&&Hl(t.childNodes[o])&&(d=!0);;)if(o>0){if(t.nodeType!=1)break;var p=t.childNodes[o-1];if(Hl(p))a=t,l=--o;else if(p.nodeType==3)t=p,o=t.nodeValue.length;else break}else{if(Cy(t))break;for(var g=t.previousSibling;g&&Hl(g);)a=t.parentNode,l=Ai(g),g=g.previousSibling;if(g)t=g,o=Od(t);else{if(t=t.parentNode,t==n.dom)break;o=0}}d?Af(n,e,t,o):a&&Af(n,e,a,l)}}function pf(n){var e=n.root.getSelection(),t=e.focusNode,o=e.focusOffset;if(!!t){for(var a=Od(t),l,d;;)if(o<a){if(t.nodeType!=1)break;var p=t.childNodes[o];if(Hl(p))l=t,d=++o;else break}else{if(Cy(t))break;for(var g=t.nextSibling;g&&Hl(g);)l=g.parentNode,d=Ai(g)+1,g=g.nextSibling;if(g)t=g,o=0,a=Od(t);else{if(t=t.parentNode,t==n.dom)break;o=a=0}}l&&Af(n,e,l,d)}}function Cy(n){var e=n.pmViewDesc;return e&&e.node&&e.node.isBlock}function Af(n,e,t,o){if(tf(e)){var a=document.createRange();a.setEnd(t,o),a.setStart(t,o),e.removeAllRanges(),e.addRange(a)}else e.extend&&e.extend(t,o);n.domObserver.setCurSelection();var l=n.state;setTimeout(function(){n.state==l&&Cs(n)},50)}function yy(n,e,t){var o=n.state.selection;if(o instanceof Rt&&!o.empty||t.indexOf("s")>-1||ue.mac&&t.indexOf("m")>-1)return!1;var a=o.$from,l=o.$to;if(!a.parent.inlineContent||n.endOfTextblock(e<0?"up":"down")){var d=df(n.state,e);if(d&&d instanceof $e)return ca(n,d)}if(!a.parent.inlineContent){var p=e<0?a:l,g=o instanceof zo?rt.near(p,e):rt.findFrom(p,e);return g?ca(n,g):!1}return!1}function _y(n,e){if(!(n.state.selection instanceof Rt))return!0;var t=n.state.selection,o=t.$head,a=t.$anchor,l=t.empty;if(!o.sameParent(a))return!0;if(!l)return!1;if(n.endOfTextblock(e>0?"forward":"backward"))return!0;var d=!o.textOffset&&(e<0?o.nodeBefore:o.nodeAfter);if(d&&!d.isText){var p=n.state.tr;return e<0?p.delete(o.pos-d.nodeSize,o.pos):p.delete(o.pos,o.pos+d.nodeSize),n.dispatch(p),!0}return!1}function Sy(n,e,t){n.domObserver.stop(),e.contentEditable=t,n.domObserver.start()}function rO(n){if(!(!ue.safari||n.state.selection.$head.parentOffset>0)){var e=n.root.getSelection(),t=e.focusNode,o=e.focusOffset;if(t&&t.nodeType==1&&o==0&&t.firstChild&&t.firstChild.contentEditable=="false"){var a=t.firstChild;Sy(n,a,!0),setTimeout(function(){return Sy(n,a,!1)},20)}}}function nO(n){var e="";return n.ctrlKey&&(e+="c"),n.metaKey&&(e+="m"),n.altKey&&(e+="a"),n.shiftKey&&(e+="s"),e}function iO(n,e){var t=e.keyCode,o=nO(e);return t==8||ue.mac&&t==72&&o=="c"?_y(n,-1)||hf(n):t==46||ue.mac&&t==68&&o=="c"?_y(n,1)||pf(n):t==13||t==27?!0:t==37?Iy(n,-1,o)||hf(n):t==39?Iy(n,1,o)||pf(n):t==38?yy(n,-1,o)||hf(n):t==40?rO(n)||yy(n,1,o)||pf(n):o==(ue.mac?"m":"c")&&(t==66||t==73||t==89||t==90)}function oO(n,e,t){var o=n.docView.parseRange(e,t),a=o.node,l=o.fromOffset,d=o.toOffset,p=o.from,g=o.to,v=n.root.getSelection(),C=null,y=v.anchorNode;if(y&&n.dom.contains(y.nodeType==1?y:y.parentNode)&&(C=[{node:y,offset:v.anchorOffset}],tf(v)||C.push({node:v.focusNode,offset:v.focusOffset})),ue.chrome&&n.lastKeyCode===8)for(var w=d;w>l;w--){var O=a.childNodes[w-1],M=O.pmViewDesc;if(O.nodeName=="BR"&&!M){d=w;break}if(!M||M.size)break}var x=n.state.doc,G=n.someProp("domParser")||Zi.fromSchema(n.state.schema),K=x.resolve(p),F=null,re=G.parse(a,{topNode:K.parent,topMatch:K.parent.contentMatchAt(K.index()),topOpen:!0,from:l,to:d,preserveWhitespace:K.parent.type.spec.code?"full":!0,editableContent:!0,findPositions:C,ruleFromNode:sO,context:K});if(C&&C[0].pos!=null){var Q=C[0].pos,Ae=C[1]&&C[1].pos;Ae==null&&(Ae=Q),F={anchor:Q+p,head:Ae+p}}return{doc:re,sel:F,from:p,to:g}}function sO(n){var e=n.pmViewDesc;if(e)return e.parseRule();if(n.nodeName=="BR"&&n.parentNode){if(ue.safari&&/^(ul|ol)$/i.test(n.parentNode.nodeName)){var t=document.createElement("div");return t.appendChild(document.createElement("li")),{skip:t}}else if(n.parentNode.lastChild==n||ue.safari&&/^(tr|table)$/i.test(n.parentNode.nodeName))return{ignore:!0}}else if(n.nodeName=="IMG"&&n.getAttribute("mark-placeholder"))return{ignore:!0}}function aO(n,e,t,o,a){if(e<0){var l=n.lastSelectionTime>Date.now()-50?n.lastSelectionOrigin:null,d=py(n,l);if(d&&!n.state.selection.eq(d)){var p=n.state.tr.setSelection(d);l=="pointer"?p.setMeta("pointer",!0):l=="key"&&p.scrollIntoView(),n.dispatch(p)}return}var g=n.state.doc.resolve(e),v=g.sharedDepth(t);e=g.before(v+1),t=n.state.doc.resolve(t).after(v+1);var C=n.state.selection,y=oO(n,e,t);if(ue.chrome&&n.cursorWrapper&&y.sel&&y.sel.anchor==n.cursorWrapper.deco.from){var w=n.cursorWrapper.deco.type.toDOM.nextSibling,O=w&&w.nodeValue?w.nodeValue.length:1;y.sel={anchor:y.sel.anchor+O,head:y.sel.anchor+O}}var M=n.state.doc,x=M.slice(y.from,y.to),G,K;n.lastKeyCode===8&&Date.now()-100<n.lastKeyCodeTime?(G=n.state.selection.to,K="end"):(G=n.state.selection.from,K="start"),n.lastKeyCode=null;var F=uO(x.content,y.doc.content,y.from,G,K);if(!F)if(o&&C instanceof Rt&&!C.empty&&C.$head.sameParent(C.$anchor)&&!n.composing&&!(y.sel&&y.sel.anchor!=y.sel.head))F={start:C.from,endA:C.to,endB:C.to};else if((ue.ios&&n.lastIOSEnter>Date.now()-225||ue.android)&&a.some(function(at){return at.nodeName=="DIV"||at.nodeName=="P"})&&n.someProp("handleKeyDown",function(at){return at(n,Ec(13,"Enter"))})){n.lastIOSEnter=0;return}else{if(y.sel){var re=Ty(n,n.state.doc,y.sel);re&&!re.eq(n.state.selection)&&n.dispatch(n.state.tr.setSelection(re))}return}n.domChangeCount++,n.state.selection.from<n.state.selection.to&&F.start==F.endB&&n.state.selection instanceof Rt&&(F.start>n.state.selection.from&&F.start<=n.state.selection.from+2?F.start=n.state.selection.from:F.endA<n.state.selection.to&&F.endA>=n.state.selection.to-2&&(F.endB+=n.state.selection.to-F.endA,F.endA=n.state.selection.to)),ue.ie&&ue.ie_version<=11&&F.endB==F.start+1&&F.endA==F.start&&F.start>y.from&&y.doc.textBetween(F.start-y.from-1,F.start-y.from+1)==" \xA0"&&(F.start--,F.endA--,F.endB--);var Q=y.doc.resolveNoCache(F.start-y.from),Ae=y.doc.resolveNoCache(F.endB-y.from),oe=Q.sameParent(Ae)&&Q.parent.inlineContent,Te;if((ue.ios&&n.lastIOSEnter>Date.now()-225&&(!oe||a.some(function(at){return at.nodeName=="DIV"||at.nodeName=="P"}))||!oe&&Q.pos<y.doc.content.size&&(Te=rt.findFrom(y.doc.resolve(Q.pos+1),1,!0))&&Te.head==Ae.pos)&&n.someProp("handleKeyDown",function(at){return at(n,Ec(13,"Enter"))})){n.lastIOSEnter=0;return}if(n.state.selection.anchor>F.start&&lO(M,F.start,F.endA,Q,Ae)&&n.someProp("handleKeyDown",function(at){return at(n,Ec(8,"Backspace"))})){ue.android&&ue.chrome&&n.domObserver.suppressSelectionUpdates();return}ue.chrome&&ue.android&&F.toB==F.from&&(n.lastAndroidDelete=Date.now()),ue.android&&!oe&&Q.start()!=Ae.start()&&Ae.parentOffset==0&&Q.depth==Ae.depth&&y.sel&&y.sel.anchor==y.sel.head&&y.sel.head==F.endA&&(F.endB-=2,Ae=y.doc.resolveNoCache(F.endB-y.from),setTimeout(function(){n.someProp("handleKeyDown",function(at){return at(n,Ec(13,"Enter"))})},20));var je=F.start,We=F.endA,Oe,Mt,At,Gt;if(oe){if(Q.pos==Ae.pos)ue.ie&&ue.ie_version<=11&&Q.parentOffset==0&&(n.domObserver.suppressSelectionUpdates(),setTimeout(function(){return Cs(n)},20)),Oe=n.state.tr.delete(je,We),Mt=M.resolve(F.start).marksAcross(M.resolve(F.endA));else if(F.endA==F.endB&&(Gt=M.resolve(F.start))&&(At=cO(Q.parent.content.cut(Q.parentOffset,Ae.parentOffset),Gt.parent.content.cut(Gt.parentOffset,F.endA-Gt.start()))))Oe=n.state.tr,At.type=="add"?Oe.addMark(je,We,At.mark):Oe.removeMark(je,We,At.mark);else if(Q.parent.child(Q.index()).isText&&Q.index()==Ae.index()-(Ae.textOffset?0:1)){var Dr=Q.parent.textBetween(Q.parentOffset,Ae.parentOffset);if(n.someProp("handleTextInput",function(at){return at(n,je,We,Dr)}))return;Oe=n.state.tr.insertText(Dr,je,We)}}if(Oe||(Oe=n.state.tr.replace(je,We,y.doc.slice(F.start-y.from,F.endB-y.from))),y.sel){var Lt=Ty(n,Oe.doc,y.sel);Lt&&!(ue.chrome&&ue.android&&n.composing&&Lt.empty&&(F.start!=F.endB||n.lastAndroidDelete<Date.now()-100)&&(Lt.head==je||Lt.head==Oe.mapping.map(We)-1)||ue.ie&&Lt.empty&&Lt.head==je)&&Oe.setSelection(Lt)}Mt&&Oe.ensureMarks(Mt),n.dispatch(Oe.scrollIntoView())}function Ty(n,e,t){return Math.max(t.anchor,t.head)>e.content.size?null:lf(n,e.resolve(t.anchor),e.resolve(t.head))}function cO(n,e){for(var t=n.firstChild.marks,o=e.firstChild.marks,a=t,l=o,d,p,g,v=0;v<o.length;v++)a=o[v].removeFromSet(a);for(var C=0;C<t.length;C++)l=t[C].removeFromSet(l);if(a.length==1&&l.length==0)p=a[0],d="add",g=function(O){return O.mark(p.addToSet(O.marks))};else if(a.length==0&&l.length==1)p=l[0],d="remove",g=function(O){return O.mark(p.removeFromSet(O.marks))};else return null;for(var y=[],w=0;w<e.childCount;w++)y.push(g(e.child(w)));if(ee.from(y).eq(n))return{mark:p,type:d}}function lO(n,e,t,o,a){if(!o.parent.isTextblock||t-e<=a.pos-o.pos||ff(o,!0,!1)<a.pos)return!1;var l=n.resolve(e);if(l.parentOffset<l.parent.content.size||!l.parent.isTextblock)return!1;var d=n.resolve(ff(l,!0,!0));return!d.parent.isTextblock||d.pos>t||ff(d,!0,!1)<t?!1:o.parent.content.cut(o.parentOffset).eq(d.parent.content)}function ff(n,e,t){for(var o=n.depth,a=e?n.end():n.pos;o>0&&(e||n.indexAfter(o)==n.node(o).childCount);)o--,a++,e=!1;if(t)for(var l=n.node(o).maybeChild(n.indexAfter(o));l&&!l.isLeaf;)l=l.firstChild,a++;return a}function uO(n,e,t,o,a){var l=n.findDiffStart(e,t);if(l==null)return null;var d=n.findDiffEnd(e,t+n.size,t+e.size),p=d.a,g=d.b;if(a=="end"){var v=Math.max(0,l-Math.min(p,g));o-=p+v-l}if(p<l&&n.size<e.size){var C=o<=l&&o>=p?l-o:0;l-=C,g=l+(g-p),p=l}else if(g<l){var y=o<=l&&o>=g?l-o:0;l-=y,p=l+(p-g),g=l}return{start:l,endA:p,endB:g}}function Ry(n,e){for(var t=[],o=e.content,a=e.openStart,l=e.openEnd;a>1&&l>1&&o.childCount==1&&o.firstChild.childCount==1;){a--,l--;var d=o.firstChild;t.push(d.type.name,d.attrs!=d.type.defaultAttrs?d.attrs:null),o=d.content}var p=n.someProp("clipboardSerializer")||tn.fromSchema(n.state.schema),g=My(),v=g.createElement("div");v.appendChild(p.serializeFragment(o,{document:g}));for(var C=v.firstChild,y;C&&C.nodeType==1&&(y=Dy[C.nodeName.toLowerCase()]);){for(var w=y.length-1;w>=0;w--){for(var O=g.createElement(y[w]);v.firstChild;)O.appendChild(v.firstChild);v.appendChild(O),y[w]!="tbody"&&(a++,l++)}C=v.firstChild}C&&C.nodeType==1&&C.setAttribute("data-pm-slice",a+" "+l+" "+JSON.stringify(t));var M=n.someProp("clipboardTextSerializer",function(x){return x(e)})||e.content.textBetween(0,e.content.size,`

`);return{dom:v,text:M}}function wy(n,e,t,o,a){var l,d=a.parent.type.spec.code,p;if(!t&&!e)return null;var g=e&&(o||d||!t);if(g){if(n.someProp("transformPastedText",function(Ae){e=Ae(e,d||o)}),d)return e?new ye(ee.from(n.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0):ye.empty;var v=n.someProp("clipboardTextParser",function(Ae){return Ae(e,a,o)});if(v)p=v;else{var C=a.marks(),y=n.state,w=y.schema,O=tn.fromSchema(w);l=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(function(Ae){var oe=l.appendChild(document.createElement("p"));Ae&&oe.appendChild(O.serializeNode(w.text(Ae,C)))})}}else n.someProp("transformPastedHTML",function(Ae){t=Ae(t)}),l=pO(t),ue.webkit&&AO(l);var M=l&&l.querySelector("[data-pm-slice]"),x=M&&/^(\d+) (\d+) (.*)/.exec(M.getAttribute("data-pm-slice"));if(!p){var G=n.someProp("clipboardParser")||n.someProp("domParser")||Zi.fromSchema(n.state.schema);p=G.parseSlice(l,{preserveWhitespace:!!(g||x),context:a,ruleFromNode:function(oe){if(oe.nodeName=="BR"&&!oe.nextSibling&&oe.parentNode&&!dO.test(oe.parentNode.nodeName))return{ignore:!0}}})}if(x)p=fO(by(p,+x[1],+x[2]),x[3]);else if(p=ye.maxOpen(hO(p.content,a),!0),p.openStart||p.openEnd){for(var K=0,F=0,re=p.content.firstChild;K<p.openStart&&!re.type.spec.isolating;K++,re=re.firstChild);for(var Q=p.content.lastChild;F<p.openEnd&&!Q.type.spec.isolating;F++,Q=Q.lastChild);p=by(p,K,F)}return n.someProp("transformPasted",function(Ae){p=Ae(p)}),p}var dO=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function hO(n,e){if(n.childCount<2)return n;for(var t=function(l){var d=e.node(l),p=d.contentMatchAt(e.index(l)),g=void 0,v=[];if(n.forEach(function(C){if(!!v){var y=p.findWrapping(C.type),w;if(!y)return v=null;if(w=v.length&&g.length&&ky(y,g,C,v[v.length-1],0))v[v.length-1]=w;else{v.length&&(v[v.length-1]=Oy(v[v.length-1],g.length));var O=Ny(C,y);v.push(O),p=p.matchType(O.type,O.attrs),g=y}}}),v)return{v:ee.from(v)}},o=e.depth;o>=0;o--){var a=t(o);if(a)return a.v}return n}function Ny(n,e,t){t===void 0&&(t=0);for(var o=e.length-1;o>=t;o--)n=e[o].create(null,ee.from(n));return n}function ky(n,e,t,o,a){if(a<n.length&&a<e.length&&n[a]==e[a]){var l=ky(n,e,t,o.lastChild,a+1);if(l)return o.copy(o.content.replaceChild(o.childCount-1,l));var d=o.contentMatchAt(o.childCount);if(d.matchType(a==n.length-1?t.type:n[a+1]))return o.copy(o.content.append(ee.from(Ny(t,n,a+1))))}}function Oy(n,e){if(e==0)return n;var t=n.content.replaceChild(n.childCount-1,Oy(n.lastChild,e-1)),o=n.contentMatchAt(n.childCount).fillBefore(ee.empty,!0);return n.copy(t.append(o))}function gf(n,e,t,o,a,l){var d=e<0?n.firstChild:n.lastChild,p=d.content;return a<o-1&&(p=gf(p,e,t,o,a+1,l)),a>=t&&(p=e<0?d.contentMatchAt(0).fillBefore(p,n.childCount>1||l<=a).append(p):p.append(d.contentMatchAt(d.childCount).fillBefore(ee.empty,!0))),n.replaceChild(e<0?0:n.childCount-1,d.copy(p))}function by(n,e,t){return e<n.openStart&&(n=new ye(gf(n.content,-1,e,n.openStart,0,n.openEnd),e,n.openEnd)),t<n.openEnd&&(n=new ye(gf(n.content,1,t,n.openEnd,0,0),n.openStart,t)),n}var Dy={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]},By=null;function My(){return By||(By=document.implementation.createHTMLDocument("title"))}function pO(n){var e=/^(\s*<meta [^>]*>)*/.exec(n);e&&(n=n.slice(e[0].length));var t=My().createElement("div"),o=/<([a-z][^>\s]+)/i.exec(n),a;if((a=o&&Dy[o[1].toLowerCase()])&&(n=a.map(function(d){return"<"+d+">"}).join("")+n+a.map(function(d){return"</"+d+">"}).reverse().join("")),t.innerHTML=n,a)for(var l=0;l<a.length;l++)t=t.querySelector(a[l])||t;return t}function AO(n){for(var e=n.querySelectorAll(ue.chrome?"span:not([class]):not([style])":"span.Apple-converted-space"),t=0;t<e.length;t++){var o=e[t];o.childNodes.length==1&&o.textContent=="\xA0"&&o.parentNode&&o.parentNode.replaceChild(n.ownerDocument.createTextNode(" "),o)}}function fO(n,e){if(!n.size)return n;var t=n.content.firstChild.type.schema,o;try{o=JSON.parse(e)}catch{return n}for(var a=n.content,l=n.openStart,d=n.openEnd,p=o.length-2;p>=0;p-=2){var g=t.nodes[o[p]];if(!g||g.hasRequiredAttrs())break;a=ee.from(g.create(o[p+1],a)),l++,d++}return new ye(a,l,d)}var gO={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},mf=ue.ie&&ue.ie_version<=11,vf=function(){this.anchorNode=this.anchorOffset=this.focusNode=this.focusOffset=null};vf.prototype.set=function(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset};vf.prototype.eq=function(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset};var fi=function(e,t){var o=this;this.view=e,this.handleDOMChange=t,this.queue=[],this.flushingSoon=-1,this.observer=window.MutationObserver&&new window.MutationObserver(function(a){for(var l=0;l<a.length;l++)o.queue.push(a[l]);ue.ie&&ue.ie_version<=11&&a.some(function(d){return d.type=="childList"&&d.removedNodes.length||d.type=="characterData"&&d.oldValue.length>d.target.nodeValue.length})?o.flushSoon():o.flush()}),this.currentSelection=new vf,mf&&(this.onCharData=function(a){o.queue.push({target:a.target,type:"characterData",oldValue:a.prevValue}),o.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.suppressingSelectionUpdates=!1};fi.prototype.flushSoon=function(){var e=this;this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(function(){e.flushingSoon=-1,e.flush()},20))};fi.prototype.forceFlush=function(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())};fi.prototype.start=function(){this.observer&&this.observer.observe(this.view.dom,gO),mf&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()};fi.prototype.stop=function(){var e=this;if(this.observer){var t=this.observer.takeRecords();if(t.length){for(var o=0;o<t.length;o++)this.queue.push(t[o]);window.setTimeout(function(){return e.flush()},20)}this.observer.disconnect()}mf&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()};fi.prototype.connectSelection=function(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)};fi.prototype.disconnectSelection=function(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)};fi.prototype.suppressSelectionUpdates=function(){var e=this;this.suppressingSelectionUpdates=!0,setTimeout(function(){return e.suppressingSelectionUpdates=!1},50)};fi.prototype.onSelectionChange=function(){if(!!eO(this.view)){if(this.suppressingSelectionUpdates)return Cs(this.view);if(ue.ie&&ue.ie_version<=11&&!this.view.state.selection.empty){var e=this.view.root.getSelection();if(e.focusNode&&Nd(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}};fi.prototype.setCurSelection=function(){this.currentSelection.set(this.view.root.getSelection())};fi.prototype.ignoreSelectionChange=function(e){if(e.rangeCount==0)return!0;var t=e.getRangeAt(0).commonAncestorContainer,o=this.view.docView.nearestDesc(t);if(o&&o.ignoreMutation({type:"selection",target:t.nodeType==3?t.parentNode:t}))return this.setCurSelection(),!0};fi.prototype.flush=function(){if(!(!this.view.docView||this.flushingSoon>-1)){var e=this.observer?this.observer.takeRecords():[];this.queue.length&&(e=this.queue.concat(e),this.queue.length=0);var t=this.view.root.getSelection(),o=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(t)&&uf(this.view)&&!this.ignoreSelectionChange(t),a=-1,l=-1,d=!1,p=[];if(this.view.editable)for(var g=0;g<e.length;g++){var v=this.registerMutation(e[g],p);v&&(a=a<0?v.from:Math.min(v.from,a),l=l<0?v.to:Math.max(v.to,l),v.typeOver&&(d=!0))}if(ue.gecko&&p.length>1){var C=p.filter(function(O){return O.nodeName=="BR"});if(C.length==2){var y=C[0],w=C[1];y.parentNode&&y.parentNode.parentNode==w.parentNode?w.remove():y.remove()}}(a>-1||o)&&(a>-1&&(this.view.docView.markDirty(a,l),mO(this.view)),this.handleDOMChange(a,l,d,p),this.view.docView.dirty?this.view.updateState(this.view.state):this.currentSelection.eq(t)||Cs(this.view),this.currentSelection.set(t))}};fi.prototype.registerMutation=function(e,t){if(t.indexOf(e.target)>-1)return null;var o=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(o==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!o||o.ignoreMutation(e))return null;if(e.type=="childList"){for(var a=0;a<e.addedNodes.length;a++)t.push(e.addedNodes[a]);if(o.contentDOM&&o.contentDOM!=o.dom&&!o.contentDOM.contains(e.target))return{from:o.posBefore,to:o.posAfter};var l=e.previousSibling,d=e.nextSibling;if(ue.ie&&ue.ie_version<=11&&e.addedNodes.length)for(var p=0;p<e.addedNodes.length;p++){var g=e.addedNodes[p],v=g.previousSibling,C=g.nextSibling;(!v||Array.prototype.indexOf.call(e.addedNodes,v)<0)&&(l=v),(!C||Array.prototype.indexOf.call(e.addedNodes,C)<0)&&(d=C)}var y=l&&l.parentNode==e.target?Ai(l)+1:0,w=o.localPosFromDOM(e.target,y,-1),O=d&&d.parentNode==e.target?Ai(d):e.target.childNodes.length,M=o.localPosFromDOM(e.target,O,1);return{from:w,to:M}}else return e.type=="attributes"?{from:o.posAtStart-o.border,to:o.posAtEnd+o.border}:{from:o.posAtStart,to:o.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}};var Ly=!1;function mO(n){Ly||(Ly=!0,getComputedStyle(n.dom).whiteSpace=="normal"&&console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."))}var Xn={},Ln={};function vO(n){n.shiftKey=!1,n.mouseDown=null,n.lastKeyCode=null,n.lastKeyCodeTime=0,n.lastClick={time:0,x:0,y:0,type:""},n.lastSelectionOrigin=null,n.lastSelectionTime=0,n.lastIOSEnter=0,n.lastIOSEnterFallbackTimeout=null,n.lastAndroidDelete=0,n.composing=!1,n.composingTimeout=null,n.compositionNodes=[],n.compositionEndedAt=-2e8,n.domObserver=new fi(n,function(o,a,l,d){return aO(n,o,a,l,d)}),n.domObserver.start(),n.domChangeCount=0,n.eventHandlers=Object.create(null);var e=function(o){var a=Xn[o];n.dom.addEventListener(o,n.eventHandlers[o]=function(l){IO(n,l)&&!If(n,l)&&(n.editable||!(l.type in Ln))&&a(n,l)})};for(var t in Xn)e(t);ue.safari&&n.dom.addEventListener("input",function(){return null}),Ef(n)}function la(n,e){n.lastSelectionOrigin=e,n.lastSelectionTime=Date.now()}function EO(n){n.domObserver.stop();for(var e in n.eventHandlers)n.dom.removeEventListener(e,n.eventHandlers[e]);clearTimeout(n.composingTimeout),clearTimeout(n.lastIOSEnterFallbackTimeout)}function Ef(n){n.someProp("handleDOMEvents",function(e){for(var t in e)n.eventHandlers[t]||n.dom.addEventListener(t,n.eventHandlers[t]=function(o){return If(n,o)})})}function If(n,e){return n.someProp("handleDOMEvents",function(t){var o=t[e.type];return o?o(n,e)||e.defaultPrevented:!1})}function IO(n,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(var t=e.target;t!=n.dom;t=t.parentNode)if(!t||t.nodeType==11||t.pmViewDesc&&t.pmViewDesc.stopEvent(e))return!1;return!0}function CO(n,e){!If(n,e)&&Xn[e.type]&&(n.editable||!(e.type in Ln))&&Xn[e.type](n,e)}Ln.keydown=function(n,e){if(n.shiftKey=e.keyCode==16||e.shiftKey,!Qy(n,e))if(e.keyCode!=229&&n.domObserver.forceFlush(),n.lastKeyCode=e.keyCode,n.lastKeyCodeTime=Date.now(),ue.ios&&e.keyCode==13&&!e.ctrlKey&&!e.altKey&&!e.metaKey){var t=Date.now();n.lastIOSEnter=t,n.lastIOSEnterFallbackTimeout=setTimeout(function(){n.lastIOSEnter==t&&(n.someProp("handleKeyDown",function(o){return o(n,Ec(13,"Enter"))}),n.lastIOSEnter=0)},200)}else n.someProp("handleKeyDown",function(o){return o(n,e)})||iO(n,e)?e.preventDefault():la(n,"key")};Ln.keyup=function(n,e){e.keyCode==16&&(n.shiftKey=!1)};Ln.keypress=function(n,e){if(!(Qy(n,e)||!e.charCode||e.ctrlKey&&!e.altKey||ue.mac&&e.metaKey)){if(n.someProp("handleKeyPress",function(a){return a(n,e)})){e.preventDefault();return}var t=n.state.selection;if(!(t instanceof Rt)||!t.$from.sameParent(t.$to)){var o=String.fromCharCode(e.charCode);n.someProp("handleTextInput",function(a){return a(n,t.$from.pos,t.$to.pos,o)})||n.dispatch(n.state.tr.insertText(o).scrollIntoView()),e.preventDefault()}}};function bd(n){return{left:n.clientX,top:n.clientY}}function yO(n,e){var t=e.x-n.clientX,o=e.y-n.clientY;return t*t+o*o<100}function Cf(n,e,t,o,a){if(o==-1)return!1;for(var l=n.state.doc.resolve(o),d=function(v){if(n.someProp(e,function(C){return v>l.depth?C(n,t,l.nodeAfter,l.before(v),a,!0):C(n,t,l.node(v),l.before(v),a,!1)}))return{v:!0}},p=l.depth+1;p>0;p--){var g=d(p);if(g)return g.v}return!1}function Cc(n,e,t){n.focused||n.focus();var o=n.state.tr.setSelection(e);t=="pointer"&&o.setMeta("pointer",!0),n.dispatch(o)}function _O(n,e){if(e==-1)return!1;var t=n.state.doc.resolve(e),o=t.nodeAfter;return o&&o.isAtom&&$e.isSelectable(o)?(Cc(n,new $e(t),"pointer"),!0):!1}function SO(n,e){if(e==-1)return!1;var t=n.state.selection,o,a;t instanceof $e&&(o=t.node);for(var l=n.state.doc.resolve(e),d=l.depth+1;d>0;d--){var p=d>l.depth?l.nodeAfter:l.node(d);if($e.isSelectable(p)){o&&t.$from.depth>0&&d>=t.$from.depth&&l.before(t.$from.depth+1)==t.$from.pos?a=l.before(t.$from.depth):a=l.before(d);break}}return a!=null?(Cc(n,$e.create(n.state.doc,a),"pointer"),!0):!1}function TO(n,e,t,o,a){return Cf(n,"handleClickOn",e,t,o)||n.someProp("handleClick",function(l){return l(n,e,o)})||(a?SO(n,t):_O(n,t))}function RO(n,e,t,o){return Cf(n,"handleDoubleClickOn",e,t,o)||n.someProp("handleDoubleClick",function(a){return a(n,e,o)})}function wO(n,e,t,o){return Cf(n,"handleTripleClickOn",e,t,o)||n.someProp("handleTripleClick",function(a){return a(n,e,o)})||NO(n,t,o)}function NO(n,e,t){if(t.button!=0)return!1;var o=n.state.doc;if(e==-1)return o.inlineContent?(Cc(n,Rt.create(o,0,o.content.size),"pointer"),!0):!1;for(var a=o.resolve(e),l=a.depth+1;l>0;l--){var d=l>a.depth?a.nodeAfter:a.node(l),p=a.before(l);if(d.inlineContent)Cc(n,Rt.create(o,p+1,p+1+d.content.size),"pointer");else if($e.isSelectable(d))Cc(n,$e.create(o,p),"pointer");else continue;return!0}}function yf(n){return Bd(n)}var Py=ue.mac?"metaKey":"ctrlKey";Xn.mousedown=function(n,e){n.shiftKey=e.shiftKey;var t=yf(n),o=Date.now(),a="singleClick";o-n.lastClick.time<500&&yO(e,n.lastClick)&&!e[Py]&&(n.lastClick.type=="singleClick"?a="doubleClick":n.lastClick.type=="doubleClick"&&(a="tripleClick")),n.lastClick={time:o,x:e.clientX,y:e.clientY,type:a};var l=n.posAtCoords(bd(e));!l||(a=="singleClick"?(n.mouseDown&&n.mouseDown.done(),n.mouseDown=new Dd(n,l,e,t)):(a=="doubleClick"?RO:wO)(n,l.pos,l.inside,e)?e.preventDefault():la(n,"pointer"))};var Dd=function(e,t,o,a){var l=this;this.view=e,this.startDoc=e.state.doc,this.pos=t,this.event=o,this.flushed=a,this.selectNode=o[Py],this.allowDefault=o.shiftKey,this.delayedSelectionSync=!1;var d,p;if(t.inside>-1)d=e.state.doc.nodeAt(t.inside),p=t.inside;else{var g=e.state.doc.resolve(t.pos);d=g.parent,p=g.depth?g.before():0}this.mightDrag=null;var v=a?null:o.target,C=v?e.docView.nearestDesc(v,!0):null;this.target=C?C.dom:null;var y=e.state,w=y.selection;(o.button==0&&d.type.spec.draggable&&d.type.spec.selectable!==!1||w instanceof $e&&w.from<=p&&w.to>p)&&(this.mightDrag={node:d,pos:p,addAttr:this.target&&!this.target.draggable,setUneditable:this.target&&ue.gecko&&!this.target.hasAttribute("contentEditable")}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(function(){l.view.mouseDown==l&&l.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),la(e,"pointer")};Dd.prototype.done=function(){var e=this;this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(function(){return Cs(e.view)}),this.view.mouseDown=null};Dd.prototype.up=function(e){if(this.done(),!!this.view.dom.contains(e.target.nodeType==3?e.target.parentNode:e.target)){var t=this.pos;this.view.state.doc!=this.startDoc&&(t=this.view.posAtCoords(bd(e))),this.allowDefault||!t?la(this.view,"pointer"):TO(this.view,t.pos,t.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||ue.safari&&this.mightDrag&&!this.mightDrag.node.isAtom||ue.chrome&&!(this.view.state.selection instanceof Rt)&&Math.min(Math.abs(t.pos-this.view.state.selection.from),Math.abs(t.pos-this.view.state.selection.to))<=2)?(Cc(this.view,rt.near(this.view.state.doc.resolve(t.pos)),"pointer"),e.preventDefault()):la(this.view,"pointer")}};Dd.prototype.move=function(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0),la(this.view,"pointer"),e.buttons==0&&this.done()};Xn.touchdown=function(n){yf(n),la(n,"pointer")};Xn.contextmenu=function(n){return yf(n)};function Qy(n,e){return n.composing?!0:ue.safari&&Math.abs(e.timeStamp-n.compositionEndedAt)<500?(n.compositionEndedAt=-2e8,!0):!1}var kO=ue.android?5e3:-1;Ln.compositionstart=Ln.compositionupdate=function(n){if(!n.composing){n.domObserver.flush();var e=n.state,t=e.selection.$from;if(e.selection.empty&&(e.storedMarks||!t.textOffset&&t.parentOffset&&t.nodeBefore.marks.some(function(p){return p.type.spec.inclusive===!1})))n.markCursor=n.state.storedMarks||t.marks(),Bd(n,!0),n.markCursor=null;else if(Bd(n),ue.gecko&&e.selection.empty&&t.parentOffset&&!t.textOffset&&t.nodeBefore.marks.length)for(var o=n.root.getSelection(),a=o.focusNode,l=o.focusOffset;a&&a.nodeType==1&&l!=0;){var d=l<0?a.lastChild:a.childNodes[l-1];if(!d)break;if(d.nodeType==3){o.collapse(d,d.nodeValue.length);break}else a=d,l=-1}n.composing=!0}xy(n,kO)};Ln.compositionend=function(n,e){n.composing&&(n.composing=!1,n.compositionEndedAt=e.timeStamp,xy(n,20))};function xy(n,e){clearTimeout(n.composingTimeout),e>-1&&(n.composingTimeout=setTimeout(function(){return Bd(n)},e))}function Uy(n){for(n.composing&&(n.composing=!1,n.compositionEndedAt=OO());n.compositionNodes.length>0;)n.compositionNodes.pop().markParentsDirty()}function OO(){var n=document.createEvent("Event");return n.initEvent("event",!0,!0),n.timeStamp}function Bd(n,e){if(n.domObserver.forceFlush(),Uy(n),e||n.docView.dirty){var t=py(n);return t&&!t.eq(n.state.selection)?n.dispatch(n.state.tr.setSelection(t)):n.updateState(n.state),!0}return!1}function bO(n,e){if(!!n.dom.parentNode){var t=n.dom.parentNode.appendChild(document.createElement("div"));t.appendChild(e),t.style.cssText="position: fixed; left: -10000px; top: 10px";var o=getSelection(),a=document.createRange();a.selectNodeContents(e),n.dom.blur(),o.removeAllRanges(),o.addRange(a),setTimeout(function(){t.parentNode&&t.parentNode.removeChild(t),n.focus()},50)}}var yc=ue.ie&&ue.ie_version<15||ue.ios&&ue.webkit_version<604;Xn.copy=Ln.cut=function(n,e){var t=n.state.selection,o=e.type=="cut";if(!t.empty){var a=yc?null:e.clipboardData,l=t.content(),d=Ry(n,l),p=d.dom,g=d.text;a?(e.preventDefault(),a.clearData(),a.setData("text/html",p.innerHTML),a.setData("text/plain",g)):bO(n,p),o&&n.dispatch(n.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))}};function DO(n){return n.openStart==0&&n.openEnd==0&&n.content.childCount==1?n.content.firstChild:null}function BO(n,e){if(!!n.dom.parentNode){var t=n.shiftKey||n.state.selection.$from.parent.type.spec.code,o=n.dom.parentNode.appendChild(document.createElement(t?"textarea":"div"));t||(o.contentEditable="true"),o.style.cssText="position: fixed; left: -10000px; top: 10px",o.focus(),setTimeout(function(){n.focus(),o.parentNode&&o.parentNode.removeChild(o),t?_f(n,o.value,null,e):_f(n,o.textContent,o.innerHTML,e)},50)}}function _f(n,e,t,o){var a=wy(n,e,t,n.shiftKey,n.state.selection.$from);if(n.someProp("handlePaste",function(p){return p(n,o,a||ye.empty)}))return!0;if(!a)return!1;var l=DO(a),d=l?n.state.tr.replaceSelectionWith(l,n.shiftKey):n.state.tr.replaceSelection(a);return n.dispatch(d.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}Ln.paste=function(n,e){var t=yc?null:e.clipboardData;t&&_f(n,t.getData("text/plain"),t.getData("text/html"),e)?e.preventDefault():BO(n,e)};var MO=function(e,t){this.slice=e,this.move=t},Fy=ue.mac?"altKey":"ctrlKey";Xn.dragstart=function(n,e){var t=n.mouseDown;if(t&&t.done(),!!e.dataTransfer){var o=n.state.selection,a=o.empty?null:n.posAtCoords(bd(e));if(!(a&&a.pos>=o.from&&a.pos<=(o instanceof $e?o.to-1:o.to))){if(t&&t.mightDrag)n.dispatch(n.state.tr.setSelection($e.create(n.state.doc,t.mightDrag.pos)));else if(e.target&&e.target.nodeType==1){var l=n.docView.nearestDesc(e.target,!0);l&&l.node.type.spec.draggable&&l!=n.docView&&n.dispatch(n.state.tr.setSelection($e.create(n.state.doc,l.posBefore)))}}var d=n.state.selection.content(),p=Ry(n,d),g=p.dom,v=p.text;e.dataTransfer.clearData(),e.dataTransfer.setData(yc?"Text":"text/html",g.innerHTML),e.dataTransfer.effectAllowed="copyMove",yc||e.dataTransfer.setData("text/plain",v),n.dragging=new MO(d,!e[Fy])}};Xn.dragend=function(n){var e=n.dragging;window.setTimeout(function(){n.dragging==e&&(n.dragging=null)},50)};Ln.dragover=Ln.dragenter=function(n,e){return e.preventDefault()};Ln.drop=function(n,e){var t=n.dragging;if(n.dragging=null,!!e.dataTransfer){var o=n.posAtCoords(bd(e));if(!!o){var a=n.state.doc.resolve(o.pos);if(!!a){var l=t&&t.slice;l?n.someProp("transformPasted",function(M){l=M(l)}):l=wy(n,e.dataTransfer.getData(yc?"Text":"text/plain"),yc?null:e.dataTransfer.getData("text/html"),!1,a);var d=t&&!e[Fy];if(n.someProp("handleDrop",function(M){return M(n,e,l||ye.empty,d)})){e.preventDefault();return}if(!!l){e.preventDefault();var p=l?vC(n.state.doc,a.pos,l):a.pos;p==null&&(p=a.pos);var g=n.state.tr;d&&g.deleteSelection();var v=g.mapping.map(p),C=l.openStart==0&&l.openEnd==0&&l.content.childCount==1,y=g.doc;if(C?g.replaceRangeWith(v,v,l.content.firstChild):g.replaceRange(v,v,l),!g.doc.eq(y)){var w=g.doc.resolve(v);if(C&&$e.isSelectable(l.content.firstChild)&&w.nodeAfter&&w.nodeAfter.sameMarkup(l.content.firstChild))g.setSelection(new $e(w));else{var O=g.mapping.map(p);g.mapping.maps[g.mapping.maps.length-1].forEach(function(M,x,G,K){return O=K}),g.setSelection(lf(n,w,g.doc.resolve(O)))}n.focus(),n.dispatch(g.setMeta("uiEvent","drop"))}}}}}};Xn.focus=function(n){n.focused||(n.domObserver.stop(),n.dom.classList.add("ProseMirror-focused"),n.domObserver.start(),n.focused=!0,setTimeout(function(){n.docView&&n.hasFocus()&&!n.domObserver.currentSelection.eq(n.root.getSelection())&&Cs(n)},20))};Xn.blur=function(n,e){n.focused&&(n.domObserver.stop(),n.dom.classList.remove("ProseMirror-focused"),n.domObserver.start(),e.relatedTarget&&n.dom.contains(e.relatedTarget)&&n.domObserver.currentSelection.set({}),n.focused=!1)};Xn.beforeinput=function(n,e){if(ue.chrome&&ue.android&&e.inputType=="deleteContentBackward"){var t=n.domChangeCount;setTimeout(function(){if(n.domChangeCount==t&&(n.dom.blur(),n.focus(),!n.someProp("handleKeyDown",function(l){return l(n,Ec(8,"Backspace"))}))){var o=n.state.selection,a=o.$cursor;a&&a.pos>0&&n.dispatch(n.state.tr.delete(a.pos-1,a.pos).scrollIntoView())}},50)}};for(var Vy in Ln)Xn[Vy]=Ln[Vy];function Kl(n,e){if(n==e)return!0;for(var t in n)if(n[t]!==e[t])return!1;for(var o in e)if(!(o in n))return!1;return!0}var _c=function(e,t){this.spec=t||ua,this.side=this.spec.side||0,this.toDOM=e};_c.prototype.map=function(e,t,o,a){var l=e.mapResult(t.from+a,this.side<0?-1:1),d=l.pos,p=l.deleted;return p?null:new Or(d-o,d-o,this)};_c.prototype.valid=function(){return!0};_c.prototype.eq=function(e){return this==e||e instanceof _c&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&Kl(this.spec,e.spec))};_c.prototype.destroy=function(e){this.spec.destroy&&this.spec.destroy(e)};var eo=function(e,t){this.spec=t||ua,this.attrs=e};eo.prototype.map=function(e,t,o,a){var l=e.map(t.from+a,this.spec.inclusiveStart?-1:1)-o,d=e.map(t.to+a,this.spec.inclusiveEnd?1:-1)-o;return l>=d?null:new Or(l,d,this)};eo.prototype.valid=function(e,t){return t.from<t.to};eo.prototype.eq=function(e){return this==e||e instanceof eo&&Kl(this.attrs,e.attrs)&&Kl(this.spec,e.spec)};eo.is=function(e){return e.type instanceof eo};var Wl=function(e,t){this.spec=t||ua,this.attrs=e};Wl.prototype.map=function(e,t,o,a){var l=e.mapResult(t.from+a,1);if(l.deleted)return null;var d=e.mapResult(t.to+a,-1);return d.deleted||d.pos<=l.pos?null:new Or(l.pos-o,d.pos-o,this)};Wl.prototype.valid=function(e,t){var o=e.content.findIndex(t.from),a=o.index,l=o.offset,d;return l==t.from&&!(d=e.child(a)).isText&&l+d.nodeSize==t.to};Wl.prototype.eq=function(e){return this==e||e instanceof Wl&&Kl(this.attrs,e.attrs)&&Kl(this.spec,e.spec)};var Or=function(e,t,o){this.from=e,this.to=t,this.type=o},Sf={spec:{configurable:!0},inline:{configurable:!0}};Or.prototype.copy=function(e,t){return new Or(e,t,this.type)};Or.prototype.eq=function(e,t){return t===void 0&&(t=0),this.type.eq(e.type)&&this.from+t==e.from&&this.to+t==e.to};Or.prototype.map=function(e,t,o){return this.type.map(e,this,t,o)};Or.widget=function(e,t,o){return new Or(e,e,new _c(t,o))};Or.inline=function(e,t,o,a){return new Or(e,t,new eo(o,a))};Or.node=function(e,t,o,a){return new Or(e,t,new Wl(o,a))};Sf.spec.get=function(){return this.type.spec};Sf.inline.get=function(){return this.type instanceof eo};Object.defineProperties(Or.prototype,Sf);var Md=[],ua={},xt=function(e,t){this.local=e&&e.length?e:Md,this.children=t&&t.length?t:Md};xt.create=function(e,t){return t.length?Ld(t,e,0,ua):on};xt.prototype.find=function(e,t,o){var a=[];return this.findInner(e==null?0:e,t==null?1e9:t,a,0,o),a};xt.prototype.findInner=function(e,t,o,a,l){for(var d=0;d<this.local.length;d++){var p=this.local[d];p.from<=t&&p.to>=e&&(!l||l(p.spec))&&o.push(p.copy(p.from+a,p.to+a))}for(var g=0;g<this.children.length;g+=3)if(this.children[g]<t&&this.children[g+1]>e){var v=this.children[g]+1;this.children[g+2].findInner(e-v,t-v,o,a+v,l)}};xt.prototype.map=function(e,t,o){return this==on||e.maps.length==0?this:this.mapInner(e,t,0,0,o||ua)};xt.prototype.mapInner=function(e,t,o,a,l){for(var d,p=0;p<this.local.length;p++){var g=this.local[p].map(e,o,a);g&&g.type.valid(t,g)?(d||(d=[])).push(g):l.onRemove&&l.onRemove(this.local[p].spec)}return this.children.length?LO(this.children,d,e,t,o,a,l):d?new xt(d.sort(da)):on};xt.prototype.add=function(e,t){return t.length?this==on?xt.create(e,t):this.addInner(e,t,0):this};xt.prototype.addInner=function(e,t,o){var a=this,l,d=0;e.forEach(function(v,C){var y=C+o,w;if(!!(w=jy(t,v,y))){for(l||(l=a.children.slice());d<l.length&&l[d]<C;)d+=3;l[d]==C?l[d+2]=l[d+2].addInner(v,w,y+1):l.splice(d,0,C,C+v.nodeSize,Ld(w,v,y+1,ua)),d+=3}});for(var p=Gy(d?Hy(t):t,-o),g=0;g<p.length;g++)p[g].type.valid(e,p[g])||p.splice(g--,1);return new xt(p.length?this.local.concat(p).sort(da):this.local,l||this.children)};xt.prototype.remove=function(e){return e.length==0||this==on?this:this.removeInner(e,0)};xt.prototype.removeInner=function(e,t){for(var o=this.children,a=this.local,l=0;l<o.length;l+=3){for(var d=void 0,p=o[l]+t,g=o[l+1]+t,v=0,C=void 0;v<e.length;v++)(C=e[v])&&C.from>p&&C.to<g&&(e[v]=null,(d||(d=[])).push(C));if(!!d){o==this.children&&(o=this.children.slice());var y=o[l+2].removeInner(d,p+1);y!=on?o[l+2]=y:(o.splice(l,3),l-=3)}}if(a.length){for(var w=0,O=void 0;w<e.length;w++)if(O=e[w])for(var M=0;M<a.length;M++)a[M].eq(O,t)&&(a==this.local&&(a=this.local.slice()),a.splice(M--,1))}return o==this.children&&a==this.local?this:a.length||o.length?new xt(a,o):on};xt.prototype.forChild=function(e,t){if(this==on)return this;if(t.isLeaf)return xt.empty;for(var o,a,l=0;l<this.children.length;l+=3)if(this.children[l]>=e){this.children[l]==e&&(o=this.children[l+2]);break}for(var d=e+1,p=d+t.content.size,g=0;g<this.local.length;g++){var v=this.local[g];if(v.from<p&&v.to>d&&v.type instanceof eo){var C=Math.max(d,v.from)-d,y=Math.min(p,v.to)-d;C<y&&(a||(a=[])).push(v.copy(C,y))}}if(a){var w=new xt(a.sort(da));return o?new Pi([w,o]):w}return o||on};xt.prototype.eq=function(e){if(this==e)return!0;if(!(e instanceof xt)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(var t=0;t<this.local.length;t++)if(!this.local[t].eq(e.local[t]))return!1;for(var o=0;o<this.children.length;o+=3)if(this.children[o]!=e.children[o]||this.children[o+1]!=e.children[o+1]||!this.children[o+2].eq(e.children[o+2]))return!1;return!0};xt.prototype.locals=function(e){return Tf(this.localsInner(e))};xt.prototype.localsInner=function(e){if(this==on)return Md;if(e.inlineContent||!this.local.some(eo.is))return this.local;for(var t=[],o=0;o<this.local.length;o++)this.local[o].type instanceof eo||t.push(this.local[o]);return t};var on=new xt;xt.empty=on;xt.removeOverlap=Tf;var Pi=function(e){this.members=e};Pi.prototype.map=function(e,t){var o=this.members.map(function(a){return a.map(e,t,ua)});return Pi.from(o)};Pi.prototype.forChild=function(e,t){if(t.isLeaf)return xt.empty;for(var o=[],a=0;a<this.members.length;a++){var l=this.members[a].forChild(e,t);l!=on&&(l instanceof Pi?o=o.concat(l.members):o.push(l))}return Pi.from(o)};Pi.prototype.eq=function(e){if(!(e instanceof Pi)||e.members.length!=this.members.length)return!1;for(var t=0;t<this.members.length;t++)if(!this.members[t].eq(e.members[t]))return!1;return!0};Pi.prototype.locals=function(e){for(var t,o=!0,a=0;a<this.members.length;a++){var l=this.members[a].localsInner(e);if(!!l.length)if(!t)t=l;else{o&&(t=t.slice(),o=!1);for(var d=0;d<l.length;d++)t.push(l[d])}}return t?Tf(o?t:t.sort(da)):Md};Pi.from=function(e){switch(e.length){case 0:return on;case 1:return e[0];default:return new Pi(e)}};function LO(n,e,t,o,a,l,d){for(var p=n.slice(),g=function(Mt,At,Gt,Dr){for(var Lt=0;Lt<p.length;Lt+=3){var at=p[Lt+1],$t=void 0;at==-1||Mt>at+l||(At>=p[Lt]+l?p[Lt+1]=-1:Gt>=a&&($t=Dr-Gt-(At-Mt))&&(p[Lt]+=$t,p[Lt+1]+=$t))}},v=0;v<t.maps.length;v++)t.maps[v].forEach(g);for(var C=!1,y=0;y<p.length;y+=3)if(p[y+1]==-1){var w=t.map(n[y]+l),O=w-a;if(O<0||O>=o.content.size){C=!0;continue}var M=t.map(n[y+1]+l,-1),x=M-a,G=o.content.findIndex(O),K=G.index,F=G.offset,re=o.maybeChild(K);if(re&&F==O&&F+re.nodeSize==x){var Q=p[y+2].mapInner(t,re,w+1,n[y]+l+1,d);Q!=on?(p[y]=O,p[y+1]=x,p[y+2]=Q):(p[y+1]=-2,C=!0)}else C=!0}if(C){var Ae=PO(p,n,e||[],t,a,l,d),oe=Ld(Ae,o,0,d);e=oe.local;for(var Te=0;Te<p.length;Te+=3)p[Te+1]<0&&(p.splice(Te,3),Te-=3);for(var je=0,We=0;je<oe.children.length;je+=3){for(var Oe=oe.children[je];We<p.length&&p[We]<Oe;)We+=3;p.splice(We,0,oe.children[je],oe.children[je+1],oe.children[je+2])}}return new xt(e&&e.sort(da),p)}function Gy(n,e){if(!e||!n.length)return n;for(var t=[],o=0;o<n.length;o++){var a=n[o];t.push(new Or(a.from+e,a.to+e,a.type))}return t}function PO(n,e,t,o,a,l,d){function p(v,C){for(var y=0;y<v.local.length;y++){var w=v.local[y].map(o,a,C);w?t.push(w):d.onRemove&&d.onRemove(v.local[y].spec)}for(var O=0;O<v.children.length;O+=3)p(v.children[O+2],v.children[O]+C+1)}for(var g=0;g<n.length;g+=3)n[g+1]==-1&&p(n[g+2],e[g]+l+1);return t}function jy(n,e,t){if(e.isLeaf)return null;for(var o=t+e.nodeSize,a=null,l=0,d=void 0;l<n.length;l++)(d=n[l])&&d.from>t&&d.to<o&&((a||(a=[])).push(d),n[l]=null);return a}function Hy(n){for(var e=[],t=0;t<n.length;t++)n[t]!=null&&e.push(n[t]);return e}function Ld(n,e,t,o){var a=[],l=!1;e.forEach(function(g,v){var C=jy(n,g,v+t);if(C){l=!0;var y=Ld(C,g,t+v+1,o);y!=on&&a.push(v,v+g.nodeSize,y)}});for(var d=Gy(l?Hy(n):n,-t).sort(da),p=0;p<d.length;p++)d[p].type.valid(e,d[p])||(o.onRemove&&o.onRemove(d[p].spec),d.splice(p--,1));return d.length||a.length?new xt(d,a):on}function da(n,e){return n.from-e.from||n.to-e.to}function Tf(n){for(var e=n,t=0;t<e.length-1;t++){var o=e[t];if(o.from!=o.to)for(var a=t+1;a<e.length;a++){var l=e[a];if(l.from==o.from){l.to!=o.to&&(e==n&&(e=n.slice()),e[a]=l.copy(l.from,o.to),Ky(e,a+1,l.copy(o.to,l.to)));continue}else{l.from<o.to&&(e==n&&(e=n.slice()),e[t]=o.copy(o.from,l.from),Ky(e,a,o.copy(l.from,o.to)));break}}}return e}function Ky(n,e,t){for(;e<n.length&&da(t,n[e])>0;)e++;n.splice(e,0,t)}function Rf(n){var e=[];return n.someProp("decorations",function(t){var o=t(n.state);o&&o!=on&&e.push(o)}),n.cursorWrapper&&e.push(xt.create(n.state.doc,[n.cursorWrapper.deco])),Pi.from(e)}var br=function(e,t){this._props=t,this.state=t.state,this.directPlugins=t.plugins||[],this.directPlugins.forEach(zy),this.dispatch=this.dispatch.bind(this),this._root=null,this.focused=!1,this.trackWrites=null,this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):e.apply?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=qy(this),this.markCursor=null,this.cursorWrapper=null,Yy(this),this.nodeViews=Jy(this),this.docView=sy(this.state.doc,Wy(this),Rf(this),this.dom,this),this.lastSelectedViewDesc=null,this.dragging=null,vO(this),this.prevDirectPlugins=[],this.pluginViews=[],this.updatePluginViews()},Pd={props:{configurable:!0},root:{configurable:!0},isDestroyed:{configurable:!0}};Pd.props.get=function(){if(this._props.state!=this.state){var n=this._props;this._props={};for(var e in n)this._props[e]=n[e];this._props.state=this.state}return this._props};br.prototype.update=function(e){e.handleDOMEvents!=this._props.handleDOMEvents&&Ef(this),this._props=e,e.plugins&&(e.plugins.forEach(zy),this.directPlugins=e.plugins),this.updateStateInner(e.state,!0)};br.prototype.setProps=function(e){var t={};for(var o in this._props)t[o]=this._props[o];t.state=this.state;for(var a in e)t[a]=e[a];this.update(t)};br.prototype.updateState=function(e){this.updateStateInner(e,this.state.plugins!=e.plugins)};br.prototype.updateStateInner=function(e,t){var o=this,a=this.state,l=!1,d=!1;if(e.storedMarks&&this.composing&&(Uy(this),d=!0),this.state=e,t){var p=Jy(this);xO(p,this.nodeViews)&&(this.nodeViews=p,l=!0),Ef(this)}this.editable=qy(this),Yy(this);var g=Rf(this),v=Wy(this),C=t?"reset":e.scrollToSelection>a.scrollToSelection?"to selection":"preserve",y=l||!this.docView.matchesNode(e.doc,v,g);(y||!e.selection.eq(a.selection))&&(d=!0);var w=C=="preserve"&&d&&this.dom.style.overflowAnchor==null&&Ok(this);if(d){this.domObserver.stop();var O=y&&(ue.ie||ue.chrome)&&!this.composing&&!a.selection.empty&&!e.selection.empty&&QO(a.selection,e.selection);if(y){var M=ue.chrome?this.trackWrites=this.root.getSelection().focusNode:null;(l||!this.docView.update(e.doc,v,g,this))&&(this.docView.updateOuterDeco([]),this.docView.destroy(),this.docView=sy(e.doc,v,g,this.dom,this)),M&&!this.trackWrites&&(O=!0)}O||!(this.mouseDown&&this.domObserver.currentSelection.eq(this.root.getSelection())&&tO(this))?Cs(this,O):(vy(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}if(this.updatePluginViews(a),C=="reset")this.dom.scrollTop=0;else if(C=="to selection"){var x=this.root.getSelection().focusNode;this.someProp("handleScrollToSelection",function(G){return G(o)})||(e.selection instanceof $e?qC(this,this.docView.domAfterPos(e.selection.from).getBoundingClientRect(),x):qC(this,this.coordsAtPos(e.selection.head,1),x))}else w&&bk(w)};br.prototype.destroyPluginViews=function(){for(var e;e=this.pluginViews.pop();)e.destroy&&e.destroy()};br.prototype.updatePluginViews=function(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(var t=0;t<this.directPlugins.length;t++){var o=this.directPlugins[t];o.spec.view&&this.pluginViews.push(o.spec.view(this))}for(var a=0;a<this.state.plugins.length;a++){var l=this.state.plugins[a];l.spec.view&&this.pluginViews.push(l.spec.view(this))}}else for(var d=0;d<this.pluginViews.length;d++){var p=this.pluginViews[d];p.update&&p.update(this,e)}};br.prototype.someProp=function(e,t){var o=this._props&&this._props[e],a;if(o!=null&&(a=t?t(o):o))return a;for(var l=0;l<this.directPlugins.length;l++){var d=this.directPlugins[l].props[e];if(d!=null&&(a=t?t(d):d))return a}var p=this.state.plugins;if(p)for(var g=0;g<p.length;g++){var v=p[g].props[e];if(v!=null&&(a=t?t(v):v))return a}};br.prototype.hasFocus=function(){return this.root.activeElement==this.dom};br.prototype.focus=function(){this.domObserver.stop(),this.editable&&Dk(this.dom),Cs(this),this.domObserver.start()};Pd.root.get=function(){var n=this._root;if(n==null){for(var e=this.dom.parentNode;e;e=e.parentNode)if(e.nodeType==9||e.nodeType==11&&e.host)return e.getSelection||(Object.getPrototypeOf(e).getSelection=function(){return document.getSelection()}),this._root=e}return n||document};br.prototype.posAtCoords=function(e){return Qk(this,e)};br.prototype.coordsAtPos=function(e,t){return t===void 0&&(t=1),$C(this,e,t)};br.prototype.domAtPos=function(e,t){return t===void 0&&(t=0),this.docView.domFromPos(e,t)};br.prototype.nodeDOM=function(e){var t=this.docView.descAt(e);return t?t.nodeDOM:null};br.prototype.posAtDOM=function(e,t,o){o===void 0&&(o=-1);var a=this.docView.posFromDOM(e,t,o);if(a==null)throw new RangeError("DOM position not inside the editor");return a};br.prototype.endOfTextblock=function(e,t){return Gk(this,t||this.state,e)};br.prototype.destroy=function(){!this.docView||(EO(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],Rf(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null)};Pd.isDestroyed.get=function(){return this.docView==null};br.prototype.dispatchEvent=function(e){return CO(this,e)};br.prototype.dispatch=function(e){var t=this._props.dispatchTransaction;t?t.call(this,e):this.updateState(this.state.apply(e))};Object.defineProperties(br.prototype,Pd);function Wy(n){var e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(n.editable),e.translate="no",n.someProp("attributes",function(t){if(typeof t=="function"&&(t=t(n.state)),t)for(var o in t)o=="class"&&(e.class+=" "+t[o]),o=="style"?e.style=(e.style?e.style+";":"")+t[o]:!e[o]&&o!="contenteditable"&&o!="nodeName"&&(e[o]=String(t[o]))}),[Or.node(0,n.state.doc.content.size,e)]}function Yy(n){if(n.markCursor){var e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),n.cursorWrapper={dom:e,deco:Or.widget(n.state.selection.head,e,{raw:!0,marks:n.markCursor})}}else n.cursorWrapper=null}function qy(n){return!n.someProp("editable",function(e){return e(n.state)===!1})}function QO(n,e){var t=Math.min(n.$anchor.sharedDepth(n.head),e.$anchor.sharedDepth(e.head));return n.$anchor.start(t)!=e.$anchor.start(t)}function Jy(n){var e={};return n.someProp("nodeViews",function(t){for(var o in t)Object.prototype.hasOwnProperty.call(e,o)||(e[o]=t[o])}),e}function xO(n,e){var t=0,o=0;for(var a in n){if(n[a]!=e[a])return!0;t++}for(var l in e)o++;return t!=o}function zy(n){if(n.spec.state||n.spec.filterTransaction||n.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var ys={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",229:"q"},Qd={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"',229:"Q"},Xy=typeof navigator!="undefined"&&/Chrome\/(\d+)/.exec(navigator.userAgent),UO=typeof navigator!="undefined"&&/Apple Computer/.test(navigator.vendor),FO=typeof navigator!="undefined"&&/Gecko\/\d+/.test(navigator.userAgent),Zy=typeof navigator!="undefined"&&/Mac/.test(navigator.platform),VO=typeof navigator!="undefined"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),GO=Xy&&(Zy||+Xy[1]<57)||FO&&Zy;for(var sn=0;sn<10;sn++)ys[48+sn]=ys[96+sn]=String(sn);for(var sn=1;sn<=24;sn++)ys[sn+111]="F"+sn;for(var sn=65;sn<=90;sn++)ys[sn]=String.fromCharCode(sn+32),Qd[sn]=String.fromCharCode(sn);for(var wf in ys)Qd.hasOwnProperty(wf)||(Qd[wf]=ys[wf]);function jO(n){var e=GO&&(n.ctrlKey||n.altKey||n.metaKey)||(UO||VO)&&n.shiftKey&&n.key&&n.key.length==1,t=!e&&n.key||(n.shiftKey?Qd:ys)[n.keyCode]||n.key||"Unidentified";return t=="Esc"&&(t="Escape"),t=="Del"&&(t="Delete"),t=="Left"&&(t="ArrowLeft"),t=="Up"&&(t="ArrowUp"),t=="Right"&&(t="ArrowRight"),t=="Down"&&(t="ArrowDown"),t}var HO=typeof navigator!="undefined"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!1;function KO(n){var e=n.split(/-(?!$)/),t=e[e.length-1];t=="Space"&&(t=" ");for(var o,a,l,d,p=0;p<e.length-1;p++){var g=e[p];if(/^(cmd|meta|m)$/i.test(g))d=!0;else if(/^a(lt)?$/i.test(g))o=!0;else if(/^(c|ctrl|control)$/i.test(g))a=!0;else if(/^s(hift)?$/i.test(g))l=!0;else if(/^mod$/i.test(g))HO?d=!0:a=!0;else throw new Error("Unrecognized modifier name: "+g)}return o&&(t="Alt-"+t),a&&(t="Ctrl-"+t),d&&(t="Meta-"+t),l&&(t="Shift-"+t),t}function WO(n){var e=Object.create(null);for(var t in n)e[KO(t)]=n[t];return e}function Nf(n,e,t){return e.altKey&&(n="Alt-"+n),e.ctrlKey&&(n="Ctrl-"+n),e.metaKey&&(n="Meta-"+n),t!==!1&&e.shiftKey&&(n="Shift-"+n),n}function YO(n){return new nn({props:{handleKeyDown:$y(n)}})}function $y(n){var e=WO(n);return function(t,o){var a=jO(o),l=a.length==1&&a!=" ",d,p=e[Nf(a,o,!l)];if(p&&p(t.state,t.dispatch,t))return!0;if(l&&(o.shiftKey||o.altKey||o.metaKey||a.charCodeAt(0)>127)&&(d=ys[o.keyCode])&&d!=a){var g=e[Nf(d,o,!0)];if(g&&g(t.state,t.dispatch,t))return!0}else if(l&&o.shiftKey){var v=e[Nf(a,o,!0)];if(v&&v(t.state,t.dispatch,t))return!0}return!1}}function qO(n){return Object.prototype.toString.call(n).slice(8,-1)}function kf(n){return qO(n)!=="Object"?!1:n.constructor===Object&&Object.getPrototypeOf(n)===Object.prototype}function xd(n,e){const t=ie({},n);return kf(n)&&kf(e)&&Object.keys(e).forEach(o=>{kf(e[o])?o in n?t[o]=xd(n[o],e[o]):Object.assign(t,{[o]:e[o]}):Object.assign(t,{[o]:e[o]})}),t}function e0(n){return typeof n=="function"}function it(n,e=void 0,...t){return e0(n)?e?n.bind(e)(...t):n(...t):n}function Ne(n,e,t){return n.config[e]===void 0&&n.parent?Ne(n.parent,e,t):typeof n.config[e]=="function"?n.config[e].bind(On(ie({},t),{parent:n.parent?Ne(n.parent,e,t):null})):n.config[e]}class qr{constructor(e={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config=ie(ie({},this.config),e),this.name=this.config.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=it(Ne(this,"addOptions",{name:this.name}))),this.storage=it(Ne(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new qr(e)}configure(e={}){const t=this.extend();return t.options=xd(this.options,e),t.storage=it(Ne(t,"addStorage",{name:t.name,options:t.options})),t}extend(e={}){const t=new qr(e);return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=e.defaultOptions?e.defaultOptions:t.parent.options,e.addOptions&&(t.options=it(Ne(t,"addOptions",{name:t.name}))),t.storage=it(Ne(t,"addStorage",{name:t.name,options:t.options})),t}}function t0(n,e,t){const{from:o,to:a}=e,{blockSeparator:l=`

`,textSerializers:d={}}=t||{};let p="",g=!0;return n.nodesBetween(o,a,(v,C,y,w)=>{var O;const M=d==null?void 0:d[v.type.name];M?(v.isBlock&&!g&&(p+=l,g=!0),p+=M({node:v,pos:C,parent:y,index:w})):v.isText?(p+=(O=v==null?void 0:v.text)===null||O===void 0?void 0:O.slice(Math.max(o,C)-C,a-C),g=!1):v.isBlock&&!g&&(p+=l,g=!0)}),p}function r0(n){return Object.fromEntries(Object.entries(n.nodes).filter(([,e])=>e.spec.toText).map(([e,t])=>[e,t.spec.toText]))}const JO=qr.create({name:"clipboardTextSerializer",addProseMirrorPlugins(){return[new nn({key:new zn("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:n}=this,{state:e,schema:t}=n,{doc:o,selection:a}=e,{from:l,to:d}=a,p=r0(t);return t0(o,{from:l,to:d},{textSerializers:p})}}})]}}),zO=()=>({editor:n,view:e})=>(requestAnimationFrame(()=>{n.isDestroyed||e.dom.blur()}),!0);var XO=Object.freeze({__proto__:null,blur:zO});const ZO=(n=!1)=>({commands:e})=>e.setContent("",n);var $O=Object.freeze({__proto__:null,clearContent:ZO});const eb=()=>({state:n,tr:e,dispatch:t})=>{const{selection:o}=e,{ranges:a}=o;return a.forEach(l=>{n.doc.nodesBetween(l.$from.pos,l.$to.pos,(d,p)=>{if(d.type.isText)return;const g=e.doc.resolve(e.mapping.map(p)),v=e.doc.resolve(e.mapping.map(p+d.nodeSize)),C=g.blockRange(v);if(!C)return;const y=gc(C);if(d.type.isTextblock&&t){const{defaultType:w}=g.parent.contentMatchAt(g.index());e.setNodeMarkup(C.start,w)}(y||y===0)&&t&&e.lift(C,y)})}),!0};var tb=Object.freeze({__proto__:null,clearNodes:eb});const rb=n=>e=>n(e);var nb=Object.freeze({__proto__:null,command:rb});const ib=()=>({state:n,dispatch:e})=>UC(n,e);var ob=Object.freeze({__proto__:null,createParagraphNear:ib});function Jr(n,e){if(typeof n=="string"){if(!e.nodes[n])throw Error(`There is no node type named '${n}'. Maybe you forgot to add the extension?`);return e.nodes[n]}return n}const sb=n=>({tr:e,state:t,dispatch:o})=>{const a=Jr(n,t.schema),l=e.selection.$anchor;for(let d=l.depth;d>0;d-=1)if(l.node(d).type===a){if(o){const g=l.before(d),v=l.after(d);e.delete(g,v).scrollIntoView()}return!0}return!1};var ab=Object.freeze({__proto__:null,deleteNode:sb});const cb=n=>({tr:e,dispatch:t})=>{const{from:o,to:a}=n;return t&&e.delete(o,a),!0};var lb=Object.freeze({__proto__:null,deleteRange:cb});const ub=()=>({state:n,dispatch:e})=>WA(n,e);var db=Object.freeze({__proto__:null,deleteSelection:ub});const hb=()=>({commands:n})=>n.keyboardShortcut("Enter");var pb=Object.freeze({__proto__:null,enter:hb});const Ab=()=>({state:n,dispatch:e})=>xC(n,e);var fb=Object.freeze({__proto__:null,exitCode:Ab});function _s(n,e){if(typeof n=="string"){if(!e.marks[n])throw Error(`There is no mark type named '${n}'. Maybe you forgot to add the extension?`);return e.marks[n]}return n}function Of(n){return Object.prototype.toString.call(n)==="[object RegExp]"}function Ud(n,e,t={strict:!0}){const o=Object.keys(e);return o.length?o.every(a=>t.strict?e[a]===n[a]:Of(e[a])?e[a].test(n[a]):e[a]===n[a]):!0}function bf(n,e,t={}){return n.find(o=>o.type===e&&Ud(o.attrs,t))}function gb(n,e,t={}){return!!bf(n,e,t)}function n0(n,e,t={}){if(!n||!e)return;const o=n.parent.childAfter(n.parentOffset);if(!o.node)return;const a=bf(o.node.marks,e,t);if(!a)return;let l=n.index(),d=n.start()+o.offset,p=l+1,g=d+o.node.nodeSize;for(bf(o.node.marks,e,t);l>0&&a.isInSet(n.parent.child(l-1).marks);)l-=1,d-=n.parent.child(l).nodeSize;for(;p<n.parent.childCount&&gb(n.parent.child(p).marks,e,t);)g+=n.parent.child(p).nodeSize,p+=1;return{from:d,to:g}}const mb=(n,e={})=>({tr:t,state:o,dispatch:a})=>{const l=_s(n,o.schema),{doc:d,selection:p}=t,{$from:g,from:v,to:C}=p;if(a){const y=n0(g,l,e);if(y&&y.from<=v&&y.to>=C){const w=Rt.create(d,y.from,y.to);t.setSelection(w)}}return!0};var vb=Object.freeze({__proto__:null,extendMarkRange:mb});const Eb=n=>e=>{const t=typeof n=="function"?n(e):n;for(let o=0;o<t.length;o+=1)if(t[o](e))return!0;return!1};var Ib=Object.freeze({__proto__:null,first:Eb});function ha(n=0,e=0,t=0){return Math.min(Math.max(n,e),t)}function Cb(n){var e;return((e=n.constructor)===null||e===void 0?void 0:e.toString().substring(0,5))==="class"}function Df(n){return n&&typeof n=="object"&&!Array.isArray(n)&&!Cb(n)}function i0(n){return Df(n)&&n instanceof Rt}function yb(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}function _b(n,e=null){if(!e)return null;if(e==="start"||e===!0)return{from:0,to:0};const{size:t}=n.doc.content;return e==="end"?{from:t,to:t}:e==="all"?{from:0,to:t}:{from:e,to:e}}const Sb=(n=null,e)=>({editor:t,view:o,tr:a,dispatch:l})=>{e=ie({scrollIntoView:!0},e);const d=()=>{yb()&&o.dom.focus(),requestAnimationFrame(()=>{t.isDestroyed||(o.focus(),(e==null?void 0:e.scrollIntoView)&&t.commands.scrollIntoView())})};if(o.hasFocus()&&n===null||n===!1)return!0;if(l&&n===null&&!i0(t.state.selection))return d(),!0;const{from:p,to:g}=_b(t.state,n)||t.state.selection,{doc:v,storedMarks:C}=a,y=rt.atStart(v).from,w=rt.atEnd(v).to,O=ha(p,y,w),M=ha(g,y,w),x=Rt.create(v,O,M),G=t.state.selection.eq(x);return l&&(G||a.setSelection(x),G&&C&&a.setStoredMarks(C),d()),!0};var Tb=Object.freeze({__proto__:null,focus:Sb});const Rb=(n,e)=>t=>n.every((o,a)=>e(o,On(ie({},t),{index:a})));var wb=Object.freeze({__proto__:null,forEach:Rb});const Nb=(n,e)=>({tr:t,commands:o})=>o.insertContentAt({from:t.selection.from,to:t.selection.to},n,e);var kb=Object.freeze({__proto__:null,insertContent:Nb});function o0(n){const e=`<body>${n}</body>`;return new window.DOMParser().parseFromString(e,"text/html").body}function Fd(n,e,t){if(t=ie({slice:!0,parseOptions:{}},t),typeof n=="object"&&n!==null)try{return Array.isArray(n)?ee.fromArray(n.map(o=>e.nodeFromJSON(o))):e.nodeFromJSON(n)}catch(o){return console.warn("[tiptap warn]: Invalid content.","Passed value:",n,"Error:",o),Fd("",e,t)}if(typeof n=="string"){const o=Zi.fromSchema(e);return t.slice?o.parseSlice(o0(n),t.parseOptions).content:o.parse(o0(n),t.parseOptions)}return Fd("",e,t)}function Ob(n,e,t){const o=n.steps.length-1;if(o<e)return;const a=n.steps[o];if(!(a instanceof qo||a instanceof Jn))return;const l=n.mapping.maps[o];let d=0;l.forEach((p,g,v,C)=>{d===0&&(d=C)}),n.setSelection(rt.near(n.doc.resolve(d),t))}const bb=n=>n.toString().startsWith("<"),Db=(n,e,t)=>({tr:o,dispatch:a,editor:l})=>{if(a){t=ie({parseOptions:{},updateSelection:!0},t);const d=Fd(e,l.schema,{parseOptions:ie({preserveWhitespace:"full"},t.parseOptions)});if(d.toString()==="<>")return!0;let{from:p,to:g}=typeof n=="number"?{from:n,to:n}:n,v=!0;if((bb(d)?d:[d]).forEach(y=>{v=v?y.isBlock:!1}),p===g&&v){const{parent:y}=o.doc.resolve(p);y.isTextblock&&!y.type.spec.code&&!y.childCount&&(p-=1,g+=1)}o.replaceWith(p,g,d),t.updateSelection&&Ob(o,o.steps.length-1,-1)}return!0};var Bb=Object.freeze({__proto__:null,insertContentAt:Db});const Mb=()=>({state:n,dispatch:e})=>OC(n,e);var Lb=Object.freeze({__proto__:null,joinBackward:Mb});const Pb=()=>({state:n,dispatch:e})=>BC(n,e);var Qb=Object.freeze({__proto__:null,joinForward:Pb});const xb=typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1;function Ub(n){const e=n.split(/-(?!$)/);let t=e[e.length-1];t==="Space"&&(t=" ");let o,a,l,d;for(let p=0;p<e.length-1;p+=1){const g=e[p];if(/^(cmd|meta|m)$/i.test(g))d=!0;else if(/^a(lt)?$/i.test(g))o=!0;else if(/^(c|ctrl|control)$/i.test(g))a=!0;else if(/^s(hift)?$/i.test(g))l=!0;else if(/^mod$/i.test(g))xb?d=!0:a=!0;else throw new Error(`Unrecognized modifier name: ${g}`)}return o&&(t=`Alt-${t}`),a&&(t=`Ctrl-${t}`),d&&(t=`Meta-${t}`),l&&(t=`Shift-${t}`),t}const Fb=n=>({editor:e,view:t,tr:o,dispatch:a})=>{const l=Ub(n).split(/-(?!$)/),d=l.find(v=>!["Alt","Ctrl","Meta","Shift"].includes(v)),p=new KeyboardEvent("keydown",{key:d==="Space"?" ":d,altKey:l.includes("Alt"),ctrlKey:l.includes("Ctrl"),metaKey:l.includes("Meta"),shiftKey:l.includes("Shift"),bubbles:!0,cancelable:!0}),g=e.captureTransaction(()=>{t.someProp("handleKeyDown",v=>v(t,p))});return g==null||g.steps.forEach(v=>{const C=v.map(o.mapping);C&&a&&o.maybeStep(C)}),!0};var Vb=Object.freeze({__proto__:null,keyboardShortcut:Fb});function Sc(n,e,t={}){const{from:o,to:a,empty:l}=n.selection,d=e?Jr(e,n.schema):null,p=[];n.doc.nodesBetween(o,a,(y,w)=>{if(y.isText)return;const O=Math.max(o,w),M=Math.min(a,w+y.nodeSize);p.push({node:y,from:O,to:M})});const g=a-o,v=p.filter(y=>d?d.name===y.node.type.name:!0).filter(y=>Ud(y.node.attrs,t,{strict:!1}));return l?!!v.length:v.reduce((y,w)=>y+w.to-w.from,0)>=g}const Gb=(n,e={})=>({state:t,dispatch:o})=>{const a=Jr(n,t.schema);return Sc(t,a,e)?PC(t,o):!1};var jb=Object.freeze({__proto__:null,lift:Gb});const Hb=()=>({state:n,dispatch:e})=>FC(n,e);var Kb=Object.freeze({__proto__:null,liftEmptyBlock:Hb});const Wb=n=>({state:e,dispatch:t})=>{const o=Jr(n,e.schema);return Ck(o)(e,t)};var Yb=Object.freeze({__proto__:null,liftListItem:Wb});const qb=()=>({state:n,dispatch:e})=>QC(n,e);var Jb=Object.freeze({__proto__:null,newlineInCode:qb});function Vd(n,e){return e.nodes[n]?"node":e.marks[n]?"mark":null}function s0(n,e){const t=typeof e=="string"?[e]:e;return Object.keys(n).reduce((o,a)=>(t.includes(a)||(o[a]=n[a]),o),{})}const zb=(n,e)=>({tr:t,state:o,dispatch:a})=>{let l=null,d=null;const p=Vd(typeof n=="string"?n:n.name,o.schema);return p?(p==="node"&&(l=Jr(n,o.schema)),p==="mark"&&(d=_s(n,o.schema)),a&&t.selection.ranges.forEach(g=>{o.doc.nodesBetween(g.$from.pos,g.$to.pos,(v,C)=>{l&&l===v.type&&t.setNodeMarkup(C,void 0,s0(v.attrs,e)),d&&v.marks.length&&v.marks.forEach(y=>{d===y.type&&t.addMark(C,C+v.nodeSize,d.create(s0(y.attrs,e)))})})}),!0):!1};var Xb=Object.freeze({__proto__:null,resetAttributes:zb});const Zb=()=>({tr:n,dispatch:e})=>(e&&n.scrollIntoView(),!0);var $b=Object.freeze({__proto__:null,scrollIntoView:Zb});const eD=()=>({tr:n,commands:e})=>e.setTextSelection({from:0,to:n.doc.content.size});var tD=Object.freeze({__proto__:null,selectAll:eD});const rD=()=>({state:n,dispatch:e})=>bC(n,e);var nD=Object.freeze({__proto__:null,selectNodeBackward:rD});const iD=()=>({state:n,dispatch:e})=>MC(n,e);var oD=Object.freeze({__proto__:null,selectNodeForward:iD});const sD=()=>({state:n,dispatch:e})=>Ak(n,e);var aD=Object.freeze({__proto__:null,selectParentNode:sD});function a0(n,e,t={}){return Fd(n,e,{slice:!1,parseOptions:t})}const cD=(n,e=!1,t={})=>({tr:o,editor:a,dispatch:l})=>{const{doc:d}=o,p=a0(n,a.schema,t),g=Rt.create(d,0,d.content.size);return l&&o.setSelection(g).replaceSelectionWith(p,!1).setMeta("preventUpdate",!e),!0};var lD=Object.freeze({__proto__:null,setContent:cD});function c0(n,e){const t=_s(e,n.schema),{from:o,to:a,empty:l}=n.selection,d=[];l?(n.storedMarks&&d.push(...n.storedMarks),d.push(...n.selection.$head.marks())):n.doc.nodesBetween(o,a,g=>{d.push(...g.marks)});const p=d.find(g=>g.type.name===t.name);return p?ie({},p.attrs):{}}const uD=(n,e={})=>({tr:t,state:o,dispatch:a})=>{const{selection:l}=t,{empty:d,ranges:p}=l,g=_s(n,o.schema);if(a)if(d){const v=c0(o,g);t.addStoredMark(g.create(ie(ie({},v),e)))}else p.forEach(v=>{const C=v.$from.pos,y=v.$to.pos;o.doc.nodesBetween(C,y,(w,O)=>{const M=Math.max(O,C),x=Math.min(O+w.nodeSize,y);w.marks.find(K=>K.type===g)?w.marks.forEach(K=>{g===K.type&&t.addMark(M,x,g.create(ie(ie({},K.attrs),e)))}):t.addMark(M,x,g.create(e))})});return!0};var dD=Object.freeze({__proto__:null,setMark:uD});const hD=(n,e)=>({tr:t})=>(t.setMeta(n,e),!0);var pD=Object.freeze({__proto__:null,setMeta:hD});const AD=(n,e={})=>({state:t,dispatch:o})=>{const a=Jr(n,t.schema);return mk(a,e)(t,o)};var fD=Object.freeze({__proto__:null,setNode:AD});const gD=n=>({tr:e,dispatch:t})=>{if(t){const{doc:o}=e,a=rt.atStart(o).from,l=rt.atEnd(o).to,d=ha(n,a,l),p=$e.create(o,d);e.setSelection(p)}return!0};var mD=Object.freeze({__proto__:null,setNodeSelection:gD});const vD=n=>({tr:e,dispatch:t})=>{if(t){const{doc:o}=e,{from:a,to:l}=typeof n=="number"?{from:n,to:n}:n,d=rt.atStart(o).from,p=rt.atEnd(o).to,g=ha(a,d,p),v=ha(l,d,p),C=Rt.create(o,g,v);e.setSelection(C)}return!0};var ED=Object.freeze({__proto__:null,setTextSelection:vD});const ID=n=>({state:e,dispatch:t})=>{const o=Jr(n,e.schema);return Sk(o)(e,t)};var CD=Object.freeze({__proto__:null,sinkListItem:ID});function Gd(n,e,t){return Object.fromEntries(Object.entries(t).filter(([o])=>{const a=n.find(l=>l.type===e&&l.name===o);return a?a.attribute.keepOnSplit:!1}))}function yD(n){for(let e=0;e<n.edgeCount;e+=1){const{type:t}=n.edge(e);if(t.isTextblock&&!t.hasRequiredAttrs())return t}return null}function l0(n,e){const t=n.storedMarks||n.selection.$to.parentOffset&&n.selection.$from.marks();if(t){const o=t.filter(a=>e==null?void 0:e.includes(a.type.name));n.tr.ensureMarks(o)}}const _D=({keepMarks:n=!0}={})=>({tr:e,state:t,dispatch:o,editor:a})=>{const{selection:l,doc:d}=e,{$from:p,$to:g}=l,v=a.extensionManager.attributes,C=Gd(v,p.node().type.name,p.node().attrs);if(l instanceof $e&&l.node.isBlock)return!p.parentOffset||!Jo(d,p.pos)?!1:(o&&(n&&l0(t,a.extensionManager.splittableMarks),e.split(p.pos).scrollIntoView()),!0);if(!p.parent.isBlock)return!1;if(o){const y=g.parentOffset===g.parent.content.size;l instanceof Rt&&e.deleteSelection();const w=p.depth===0?void 0:yD(p.node(-1).contentMatchAt(p.indexAfter(-1)));let O=y&&w?[{type:w,attrs:C}]:void 0,M=Jo(e.doc,e.mapping.map(p.pos),1,O);if(!O&&!M&&Jo(e.doc,e.mapping.map(p.pos),1,w?[{type:w}]:void 0)&&(M=!0,O=w?[{type:w,attrs:C}]:void 0),M&&(e.split(e.mapping.map(p.pos),1,O),w&&!y&&!p.parentOffset&&p.parent.type!==w)){const x=e.mapping.map(p.before()),G=e.doc.resolve(x);p.node(-1).canReplaceWith(G.index(),G.index()+1,w)&&e.setNodeMarkup(e.mapping.map(p.before()),w)}n&&l0(t,a.extensionManager.splittableMarks),e.scrollIntoView()}return!0};var SD=Object.freeze({__proto__:null,splitBlock:_D});const TD=n=>({tr:e,state:t,dispatch:o,editor:a})=>{var l;const d=Jr(n,t.schema),{$from:p,$to:g}=t.selection,v=t.selection.node;if(v&&v.isBlock||p.depth<2||!p.sameParent(g))return!1;const C=p.node(-1);if(C.type!==d)return!1;const y=a.extensionManager.attributes;if(p.parent.content.size===0&&p.node(-1).childCount===p.indexAfter(-1)){if(p.depth===2||p.node(-3).type!==d||p.index(-2)!==p.node(-2).childCount-1)return!1;if(o){let G=ee.empty;const K=p.index(-1)?1:p.index(-2)?2:3;for(let Te=p.depth-K;Te>=p.depth-3;Te-=1)G=ee.from(p.node(Te).copy(G));const F=p.indexAfter(-1)<p.node(-2).childCount?1:p.indexAfter(-2)<p.node(-3).childCount?2:3,re=Gd(y,p.node().type.name,p.node().attrs),Q=((l=d.contentMatch.defaultType)===null||l===void 0?void 0:l.createAndFill(re))||void 0;G=G.append(ee.from(d.createAndFill(null,Q)||void 0));const Ae=p.before(p.depth-(K-1));e.replace(Ae,p.after(-F),new ye(G,4-K,0));let oe=-1;e.doc.nodesBetween(Ae,e.doc.content.size,(Te,je)=>{if(oe>-1)return!1;Te.isTextblock&&Te.content.size===0&&(oe=je+1)}),oe>-1&&e.setSelection(Rt.near(e.doc.resolve(oe))),e.scrollIntoView()}return!0}const w=g.pos===p.end()?C.contentMatchAt(0).defaultType:null,O=Gd(y,C.type.name,C.attrs),M=Gd(y,p.node().type.name,p.node().attrs);e.delete(p.pos,g.pos);const x=w?[{type:d,attrs:O},{type:w,attrs:M}]:[{type:d,attrs:O}];return Jo(e.doc,p.pos,2)?(o&&e.split(p.pos,2,x).scrollIntoView(),!0):!1};var RD=Object.freeze({__proto__:null,splitListItem:TD});function wD(n,e){for(let t=n.depth;t>0;t-=1){const o=n.node(t);if(e(o))return{pos:t>0?n.before(t):0,start:n.start(t),depth:t,node:o}}}function ND(n){return e=>wD(e.$from,n)}function jd(n){const e=n.filter(a=>a.type==="extension"),t=n.filter(a=>a.type==="node"),o=n.filter(a=>a.type==="mark");return{baseExtensions:e,nodeExtensions:t,markExtensions:o}}function u0(n,e){const{nodeExtensions:t}=jd(e),o=t.find(d=>d.name===n);if(!o)return!1;const a={name:o.name,options:o.options,storage:o.storage},l=it(Ne(o,"group",a));return typeof l!="string"?!1:l.split(" ").includes("list")}const kD=(n,e)=>({editor:t,tr:o,state:a,dispatch:l,chain:d,commands:p,can:g})=>{const{extensions:v}=t.extensionManager,C=Jr(n,a.schema),y=Jr(e,a.schema),{selection:w}=a,{$from:O,$to:M}=w,x=O.blockRange(M);if(!x)return!1;const G=ND(F=>u0(F.type.name,v))(w);if(x.depth>=1&&G&&x.depth-G.depth<=1){if(G.node.type===C)return p.liftListItem(y);if(u0(G.node.type.name,v)&&C.validContent(G.node.content)&&l)return o.setNodeMarkup(G.pos,C),!0}return g().wrapInList(C)?p.wrapInList(C):d().clearNodes().wrapInList(C).run()};var OD=Object.freeze({__proto__:null,toggleList:kD});function Bf(n,e,t={}){const{empty:o,ranges:a}=n.selection,l=e?_s(e,n.schema):null;if(o)return!!(n.storedMarks||n.selection.$from.marks()).filter(y=>l?l.name===y.type.name:!0).find(y=>Ud(y.attrs,t,{strict:!1}));let d=0;const p=[];if(a.forEach(({$from:y,$to:w})=>{const O=y.pos,M=w.pos;n.doc.nodesBetween(O,M,(x,G)=>{if(!x.isText&&!x.marks.length)return;const K=Math.max(O,G),F=Math.min(M,G+x.nodeSize);d+=F-K,p.push(...x.marks.map(Q=>({mark:Q,from:K,to:F})))})}),d===0)return!1;const g=p.filter(y=>l?l.name===y.mark.type.name:!0).filter(y=>Ud(y.mark.attrs,t,{strict:!1})).reduce((y,w)=>y+w.to-w.from,0),v=p.filter(y=>l?y.mark.type!==l&&y.mark.type.excludes(l):!0).reduce((y,w)=>y+w.to-w.from,0);return(g>0?g+v:g)>=d}const bD=(n,e={},t={})=>({state:o,commands:a})=>{const{extendEmptyMarkRange:l=!1}=t,d=_s(n,o.schema);return Bf(o,d,e)?a.unsetMark(d,{extendEmptyMarkRange:l}):a.setMark(d,e)};var DD=Object.freeze({__proto__:null,toggleMark:bD});const BD=(n,e,t={})=>({state:o,commands:a})=>{const l=Jr(n,o.schema),d=Jr(e,o.schema);return Sc(o,l,t)?a.setNode(d):a.setNode(l,t)};var MD=Object.freeze({__proto__:null,toggleNode:BD});const LD=(n,e={})=>({state:t,dispatch:o})=>{const a=Jr(n,t.schema);return Sc(t,a,e)?PC(t,o):GC(a,e)(t,o)};var PD=Object.freeze({__proto__:null,toggleWrap:LD});const QD=()=>({state:n,dispatch:e})=>{const t=n.plugins;for(let o=0;o<t.length;o+=1){const a=t[o];let l;if(a.spec.isInputRules&&(l=a.getState(n))){if(e){const d=n.tr,p=l.transform;for(let g=p.steps.length-1;g>=0;g-=1)d.step(p.steps[g].invert(p.docs[g]));if(l.text){const g=d.doc.resolve(l.from).marks();d.replaceWith(l.from,l.to,n.schema.text(l.text,g))}else d.delete(l.from,l.to)}return!0}}return!1};var xD=Object.freeze({__proto__:null,undoInputRule:QD});const UD=()=>({tr:n,state:e,dispatch:t})=>{const{selection:o}=n,{empty:a,ranges:l}=o;return a||t&&Object.entries(e.schema.marks).forEach(([,d])=>{l.forEach(p=>{n.removeMark(p.$from.pos,p.$to.pos,d)})}),!0};var FD=Object.freeze({__proto__:null,unsetAllMarks:UD});const VD=(n,e={})=>({tr:t,state:o,dispatch:a})=>{var l;const{extendEmptyMarkRange:d=!1}=e,{selection:p}=t,g=_s(n,o.schema),{$from:v,empty:C,ranges:y}=p;if(!a)return!0;if(C&&d){let{from:w,to:O}=p;const M=(l=v.marks().find(G=>G.type===g))===null||l===void 0?void 0:l.attrs,x=n0(v,g,M);x&&(w=x.from,O=x.to),t.removeMark(w,O,g)}else y.forEach(w=>{t.removeMark(w.$from.pos,w.$to.pos,g)});return t.removeStoredMark(g),!0};var GD=Object.freeze({__proto__:null,unsetMark:VD});const jD=(n,e={})=>({tr:t,state:o,dispatch:a})=>{let l=null,d=null;const p=Vd(typeof n=="string"?n:n.name,o.schema);return p?(p==="node"&&(l=Jr(n,o.schema)),p==="mark"&&(d=_s(n,o.schema)),a&&t.selection.ranges.forEach(g=>{const v=g.$from.pos,C=g.$to.pos;o.doc.nodesBetween(v,C,(y,w)=>{l&&l===y.type&&t.setNodeMarkup(w,void 0,ie(ie({},y.attrs),e)),d&&y.marks.length&&y.marks.forEach(O=>{if(d===O.type){const M=Math.max(w,v),x=Math.min(w+y.nodeSize,C);t.addMark(M,x,d.create(ie(ie({},O.attrs),e)))}})})}),!0):!1};var HD=Object.freeze({__proto__:null,updateAttributes:jD});const KD=(n,e={})=>({state:t,dispatch:o})=>{const a=Jr(n,t.schema);return Sc(t,a,e)?!1:GC(a,e)(t,o)};var WD=Object.freeze({__proto__:null,wrapIn:KD});const YD=(n,e={})=>({state:t,dispatch:o})=>{const a=Jr(n,t.schema);return Ek(a,e)(t,o)};var qD=Object.freeze({__proto__:null,wrapInList:YD});const JD=qr.create({name:"commands",addCommands(){return ie(ie(ie(ie(ie(ie(ie(ie(ie(ie(ie(ie(ie(ie(ie(ie(ie(ie(ie(ie(ie(ie(ie(ie(ie(ie(ie(ie(ie(ie(ie(ie(ie(ie(ie(ie(ie(ie(ie(ie(ie(ie(ie(ie(ie(ie(ie(ie({},XO),$O),tb),nb),ob),ab),lb),db),pb),fb),vb),Ib),Tb),wb),kb),Bb),Lb),Qb),Vb),jb),Kb),Yb),Jb),Xb),$b),tD),nD),oD),aD),lD),dD),pD),fD),mD),ED),CD),SD),RD),OD),DD),MD),PD),xD),FD),GD),HD),WD),qD)}}),zD=qr.create({name:"editable",addProseMirrorPlugins(){return[new nn({key:new zn("editable"),props:{editable:()=>this.editor.options.editable}})]}}),XD=qr.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:n}=this;return[new nn({key:new zn("focusEvents"),props:{handleDOMEvents:{focus:(e,t)=>{n.isFocused=!0;const o=n.state.tr.setMeta("focus",{event:t}).setMeta("addToHistory",!1);return e.dispatch(o),!1},blur:(e,t)=>{n.isFocused=!1;const o=n.state.tr.setMeta("blur",{event:t}).setMeta("addToHistory",!1);return e.dispatch(o),!1}}}})]}}),ZD=qr.create({name:"keymap",addKeyboardShortcuts(){const n=()=>this.editor.commands.first(({commands:t})=>[()=>t.undoInputRule(),()=>t.deleteSelection(),()=>t.joinBackward(),()=>t.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:t})=>[()=>t.deleteSelection(),()=>t.joinForward(),()=>t.selectNodeForward()]);return{Enter:()=>this.editor.commands.first(({commands:t})=>[()=>t.newlineInCode(),()=>t.createParagraphNear(),()=>t.liftEmptyBlock(),()=>t.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:n,"Mod-Backspace":n,"Shift-Backspace":n,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()}}}),$D=qr.create({name:"tabindex",addProseMirrorPlugins(){return[new nn({key:new zn("tabindex"),props:{attributes:{tabindex:"0"}}})]}});var eB=Object.freeze({__proto__:null,ClipboardTextSerializer:JO,Commands:JD,Editable:zD,FocusEvents:XD,Keymap:ZD,Tabindex:$D});function tB(n,e){const t=Jr(e,n.schema),{from:o,to:a}=n.selection,l=[];n.doc.nodesBetween(o,a,p=>{l.push(p)});const d=l.reverse().find(p=>p.type.name===t.name);return d?ie({},d.attrs):{}}function rB(n,e){const t=Vd(typeof e=="string"?e:e.name,n.schema);return t==="node"?tB(n,e):t==="mark"?c0(n,e):{}}function nB(n,e,t={}){if(!e)return Sc(n,null,t)||Bf(n,null,t);const o=Vd(e,n.schema);return o==="node"?Sc(n,e,t):o==="mark"?Bf(n,e,t):!1}function iB(n,e){const t=tn.fromSchema(e).serializeFragment(n),a=document.implementation.createHTMLDocument().createElement("div");return a.appendChild(t),a.innerHTML}function oB(n,e){const t={from:0,to:n.content.size};return t0(n,t,e)}function sB(n){var e;const t=(e=n.type.createAndFill())===null||e===void 0?void 0:e.toJSON(),o=n.toJSON();return JSON.stringify(t)===JSON.stringify(o)}function aB(n){const e=document.querySelector("style[data-tiptap-style]");if(e!==null)return e;const t=document.createElement("style");return t.setAttribute("data-tiptap-style",""),t.innerHTML=n,document.getElementsByTagName("head")[0].appendChild(t),t}function Mf(n){const{state:e,transaction:t}=n;let{selection:o}=t,{doc:a}=t,{storedMarks:l}=t;return On(ie({},e),{schema:e.schema,plugins:e.plugins,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return l},get selection(){return o},get doc(){return a},get tr(){return o=t.selection,a=t.doc,l=t.storedMarks,t}})}class Lf{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:t,state:o}=this,{view:a}=t,{tr:l}=o,d=this.buildProps(l);return Object.fromEntries(Object.entries(e).map(([p,g])=>[p,(...C)=>{const y=g(...C)(d);return!l.getMeta("preventDispatch")&&!this.hasCustomState&&a.dispatch(l),y}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,t=!0){const{rawCommands:o,editor:a,state:l}=this,{view:d}=a,p=[],g=!!e,v=e||l.tr,C=()=>(!g&&t&&!v.getMeta("preventDispatch")&&!this.hasCustomState&&d.dispatch(v),p.every(w=>w===!0)),y=On(ie({},Object.fromEntries(Object.entries(o).map(([w,O])=>[w,(...x)=>{const G=this.buildProps(v,t),K=O(...x)(G);return p.push(K),y}]))),{run:C});return y}createCan(e){const{rawCommands:t,state:o}=this,a=void 0,l=e||o.tr,d=this.buildProps(l,a),p=Object.fromEntries(Object.entries(t).map(([g,v])=>[g,(...C)=>v(...C)(On(ie({},d),{dispatch:a}))]));return On(ie({},p),{chain:()=>this.createChain(l,a)})}buildProps(e,t=!0){const{rawCommands:o,editor:a,state:l}=this,{view:d}=a;l.storedMarks&&e.setStoredMarks(l.storedMarks);const p={tr:e,editor:a,view:d,state:Mf({state:l,transaction:e}),dispatch:t?()=>{}:void 0,chain:()=>this.createChain(e),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(o).map(([g,v])=>[g,(...C)=>v(...C)(p)]))}};return p}}class Hd{constructor(e){this.find=e.find,this.handler=e.handler}}const cB=(n,e)=>{if(Of(e))return e.exec(n);const t=e(n);if(!t)return null;const o=[];return o.push(t.text),o.index=t.index,o.input=n,o.data=t.data,t.replaceWith&&(t.text.includes(t.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),o.push(t.replaceWith)),o};function Pf(n){var e;const{editor:t,from:o,to:a,text:l,rules:d,plugin:p}=n,{view:g}=t;if(g.composing)return!1;const v=g.state.doc.resolve(o);if(v.parent.type.spec.code||!!((e=v.nodeBefore||v.nodeAfter)===null||e===void 0?void 0:e.marks.find(O=>O.type.spec.code)))return!1;let C=!1;const y=500,w=v.parent.textBetween(Math.max(0,v.parentOffset-y),v.parentOffset,void 0,"\uFFFC")+l;return d.forEach(O=>{if(C)return;const M=cB(w,O.find);if(!M)return;const x=g.state.tr,G=Mf({state:g.state,transaction:x}),K={from:o-(M[0].length-l.length),to:a},{commands:F,chain:re,can:Q}=new Lf({editor:t,state:G});O.handler({state:G,range:K,match:M,commands:F,chain:re,can:Q}),!!x.steps.length&&(x.setMeta(p,{transform:x,from:o,to:a,text:l}),g.dispatch(x),C=!0)}),C}function lB(n){const{editor:e,rules:t}=n,o=new nn({state:{init(){return null},apply(a,l){const d=a.getMeta(this);return d||(a.selectionSet||a.docChanged?null:l)}},props:{handleTextInput(a,l,d,p){return Pf({editor:e,from:l,to:d,text:p,rules:t,plugin:o})},handleDOMEvents:{compositionend:a=>(setTimeout(()=>{const{$cursor:l}=a.state.selection;l&&Pf({editor:e,from:l.pos,to:l.pos,text:"",rules:t,plugin:o})}),!1)},handleKeyDown(a,l){if(l.key!=="Enter")return!1;const{$cursor:d}=a.state.selection;return d?Pf({editor:e,from:d.pos,to:d.pos,text:`
`,rules:t,plugin:o}):!1}},isInputRules:!0});return o}function uB(n){return typeof n=="number"}class dB{constructor(e){this.find=e.find,this.handler=e.handler}}const hB=(n,e)=>{if(Of(e))return[...n.matchAll(e)];const t=e(n);return t?t.map(o=>{const a=[];return a.push(o.text),a.index=o.index,a.input=n,a.data=o.data,o.replaceWith&&(o.text.includes(o.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),a.push(o.replaceWith)),a}):[]};function pB(n){const{editor:e,state:t,from:o,to:a,rules:l}=n,{commands:d,chain:p,can:g}=new Lf({editor:e,state:t});t.doc.nodesBetween(o,a,(v,C)=>{if(!v.isTextblock||v.type.spec.code)return;const y=Math.max(o,C),w=Math.min(a,C+v.content.size),O=v.textBetween(y-C,w-C,void 0,"\uFFFC");l.forEach(M=>{hB(O,M.find).forEach(G=>{if(G.index===void 0)return;const K=y+G.index+1,F=K+G[0].length,re={from:t.tr.mapping.map(K),to:t.tr.mapping.map(F)};M.handler({state:t,range:re,match:G,commands:d,chain:p,can:g})})})})}function AB(n){const{editor:e,rules:t}=n;let o=!1;const a=new nn({props:{handlePaste:(l,d)=>{var p;const g=(p=d.clipboardData)===null||p===void 0?void 0:p.getData("text/html");return o=!!(g==null?void 0:g.includes("data-pm-slice")),!1}},appendTransaction:(l,d,p)=>{const g=l[0];if(!g.getMeta("paste")||o)return;const{doc:v,before:C}=g,y=C.content.findDiffStart(v.content),w=C.content.findDiffEnd(v.content);if(!uB(y)||!w||y===w.b)return;const O=p.tr,M=Mf({state:p,transaction:O});if(pB({editor:e,state:M,from:Math.max(y-1,0),to:w.b,rules:t,plugin:a}),!!O.steps.length)return O},isPasteRules:!0});return a}function d0(n){const e=[],{nodeExtensions:t,markExtensions:o}=jd(n),a=[...t,...o],l={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0};return n.forEach(d=>{const p={name:d.name,options:d.options,storage:d.storage},g=Ne(d,"addGlobalAttributes",p);if(!g)return;g().forEach(C=>{C.types.forEach(y=>{Object.entries(C.attributes).forEach(([w,O])=>{e.push({type:y,name:w,attribute:ie(ie({},l),O)})})})})}),a.forEach(d=>{const p={name:d.name,options:d.options,storage:d.storage},g=Ne(d,"addAttributes",p);if(!g)return;const v=g();Object.entries(v).forEach(([C,y])=>{e.push({type:d.name,name:C,attribute:ie(ie({},l),y)})})}),e}function an(...n){return n.filter(e=>!!e).reduce((e,t)=>{const o=ie({},e);return Object.entries(t).forEach(([a,l])=>{if(!o[a]){o[a]=l;return}a==="class"?o[a]=[o[a],l].join(" "):a==="style"?o[a]=[o[a],l].join("; "):o[a]=l}),o},{})}function Qf(n,e){return e.filter(t=>t.attribute.rendered).map(t=>t.attribute.renderHTML?t.attribute.renderHTML(n.attrs)||{}:{[t.name]:n.attrs[t.name]}).reduce((t,o)=>an(t,o),{})}function fB(n={}){return Object.keys(n).length===0&&n.constructor===Object}function gB(n){return typeof n!="string"?n:n.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(n):n==="true"?!0:n==="false"?!1:n}function h0(n,e){return n.style?n:On(ie({},n),{getAttrs:t=>{const o=n.getAttrs?n.getAttrs(t):n.attrs;if(o===!1)return!1;const a=e.filter(l=>l.attribute.rendered).reduce((l,d)=>{const p=d.attribute.parseHTML?d.attribute.parseHTML(t):gB(t.getAttribute(d.name));return Df(p)&&console.warn(`[tiptap warn]: BREAKING CHANGE: "parseHTML" for your attribute "${d.name}" returns an object but should return the value itself. If this is expected you can ignore this message. This warning will be removed in one of the next releases. Further information: https://github.com/ueberdosis/tiptap/issues/1863`),p==null?l:On(ie({},l),{[d.name]:p})},{});return ie(ie({},o),a)}})}function p0(n){return Object.fromEntries(Object.entries(n).filter(([e,t])=>e==="attrs"&&fB(t)?!1:t!=null))}function mB(n){var e;const t=d0(n),{nodeExtensions:o,markExtensions:a}=jd(n),l=(e=o.find(g=>Ne(g,"topNode")))===null||e===void 0?void 0:e.name,d=Object.fromEntries(o.map(g=>{const v=t.filter(G=>G.type===g.name),C={name:g.name,options:g.options,storage:g.storage},y=n.reduce((G,K)=>{const F=Ne(K,"extendNodeSchema",C);return ie(ie({},G),F?F(g):{})},{}),w=p0(On(ie({},y),{content:it(Ne(g,"content",C)),marks:it(Ne(g,"marks",C)),group:it(Ne(g,"group",C)),inline:it(Ne(g,"inline",C)),atom:it(Ne(g,"atom",C)),selectable:it(Ne(g,"selectable",C)),draggable:it(Ne(g,"draggable",C)),code:it(Ne(g,"code",C)),defining:it(Ne(g,"defining",C)),isolating:it(Ne(g,"isolating",C)),attrs:Object.fromEntries(v.map(G=>{var K;return[G.name,{default:(K=G==null?void 0:G.attribute)===null||K===void 0?void 0:K.default}]}))})),O=it(Ne(g,"parseHTML",C));O&&(w.parseDOM=O.map(G=>h0(G,v)));const M=Ne(g,"renderHTML",C);M&&(w.toDOM=G=>M({node:G,HTMLAttributes:Qf(G,v)}));const x=Ne(g,"renderText",C);return x&&(w.toText=x),[g.name,w]})),p=Object.fromEntries(a.map(g=>{const v=t.filter(x=>x.type===g.name),C={name:g.name,options:g.options,storage:g.storage},y=n.reduce((x,G)=>{const K=Ne(G,"extendMarkSchema",C);return ie(ie({},x),K?K(g):{})},{}),w=p0(On(ie({},y),{inclusive:it(Ne(g,"inclusive",C)),excludes:it(Ne(g,"excludes",C)),group:it(Ne(g,"group",C)),spanning:it(Ne(g,"spanning",C)),code:it(Ne(g,"code",C)),attrs:Object.fromEntries(v.map(x=>{var G;return[x.name,{default:(G=x==null?void 0:x.attribute)===null||G===void 0?void 0:G.default}]}))})),O=it(Ne(g,"parseHTML",C));O&&(w.parseDOM=O.map(x=>h0(x,v)));const M=Ne(g,"renderHTML",C);return M&&(w.toDOM=x=>M({mark:x,HTMLAttributes:Qf(x,v)})),[g.name,w]}));return new sa({topNode:l,nodes:d,marks:p})}function xf(n,e){return e.nodes[n]||e.marks[n]||null}function A0(n,e){return Array.isArray(e)?e.some(t=>(typeof t=="string"?t:t.name)===n.name):e}function vB(n){const e=n.filter((t,o)=>n.indexOf(t)!==o);return[...new Set(e)]}class Tc{constructor(e,t){this.splittableMarks=[],this.editor=t,this.extensions=Tc.resolve(e),this.schema=mB(this.extensions),this.extensions.forEach(o=>{var a;this.editor.extensionStorage[o.name]=o.storage;const l={name:o.name,options:o.options,storage:o.storage,editor:this.editor,type:xf(o.name,this.schema)};o.type==="mark"&&((a=it(Ne(o,"keepOnSplit",l)))!==null&&a!==void 0?a:!0)&&this.splittableMarks.push(o.name);const d=Ne(o,"onBeforeCreate",l);d&&this.editor.on("beforeCreate",d);const p=Ne(o,"onCreate",l);p&&this.editor.on("create",p);const g=Ne(o,"onUpdate",l);g&&this.editor.on("update",g);const v=Ne(o,"onSelectionUpdate",l);v&&this.editor.on("selectionUpdate",v);const C=Ne(o,"onTransaction",l);C&&this.editor.on("transaction",C);const y=Ne(o,"onFocus",l);y&&this.editor.on("focus",y);const w=Ne(o,"onBlur",l);w&&this.editor.on("blur",w);const O=Ne(o,"onDestroy",l);O&&this.editor.on("destroy",O)})}static resolve(e){const t=Tc.sort(Tc.flatten(e)),o=vB(t.map(a=>a.name));return o.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${o.map(a=>`'${a}'`).join(", ")}]. This can lead to issues.`),t}static flatten(e){return e.map(t=>{const o={name:t.name,options:t.options,storage:t.storage},a=Ne(t,"addExtensions",o);return a?[t,...this.flatten(a())]:t}).flat(10)}static sort(e){const t=100;return e.sort((o,a)=>{const l=Ne(o,"priority")||t,d=Ne(a,"priority")||t;return l>d?-1:l<d?1:0})}get commands(){return this.extensions.reduce((e,t)=>{const o={name:t.name,options:t.options,storage:t.storage,editor:this.editor,type:xf(t.name,this.schema)},a=Ne(t,"addCommands",o);return a?ie(ie({},e),a()):e},{})}get plugins(){const{editor:e}=this,t=Tc.sort([...this.extensions].reverse()),o=[],a=[],l=t.map(d=>{const p={name:d.name,options:d.options,storage:d.storage,editor:e,type:xf(d.name,this.schema)},g=[],v=Ne(d,"addKeyboardShortcuts",p);if(v){const O=Object.fromEntries(Object.entries(v()).map(([x,G])=>[x,()=>G({editor:e})])),M=YO(O);g.push(M)}const C=Ne(d,"addInputRules",p);A0(d,e.options.enableInputRules)&&C&&o.push(...C());const y=Ne(d,"addPasteRules",p);A0(d,e.options.enablePasteRules)&&y&&a.push(...y());const w=Ne(d,"addProseMirrorPlugins",p);if(w){const O=w();g.push(...O)}return g}).flat();return[lB({editor:e,rules:o}),AB({editor:e,rules:a}),...l]}get attributes(){return d0(this.extensions)}get nodeViews(){const{editor:e}=this,{nodeExtensions:t}=jd(this.extensions);return Object.fromEntries(t.filter(o=>!!Ne(o,"addNodeView")).map(o=>{const a=this.attributes.filter(g=>g.type===o.name),l={name:o.name,options:o.options,storage:o.storage,editor:e,type:Jr(o.name,this.schema)},d=Ne(o,"addNodeView",l);if(!d)return[];const p=(g,v,C,y)=>{const w=Qf(g,a);return d()({editor:e,node:g,getPos:C,decorations:y,HTMLAttributes:w,extension:o})};return[o.name,p]}))}}class EB{constructor(){this.callbacks={}}on(e,t){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(t),this}emit(e,...t){const o=this.callbacks[e];return o&&o.forEach(a=>a.apply(this,t)),this}off(e,t){const o=this.callbacks[e];return o&&(t?this.callbacks[e]=o.filter(a=>a!==t):delete this.callbacks[e]),this}removeAllListeners(){this.callbacks={}}}const IB=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 1px !important;
  height: 1px !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}

.tippy-box[data-animation=fade][data-state=hidden] {
  opacity: 0
}`;class CB extends EB{constructor(e={}){super();this.isFocused=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(e),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}))},0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=aB(IB))}setOptions(e={}){this.options=ie(ie({},this.options),e),!(!this.view||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(e){this.setOptions({editable:e})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(e,t){const o=e0(t)?t(e,this.state.plugins):[...this.state.plugins,e],a=this.state.reconfigure({plugins:o});this.view.updateState(a)}unregisterPlugin(e){if(this.isDestroyed)return;const t=typeof e=="string"?`${e}$`:e.key,o=this.state.reconfigure({plugins:this.state.plugins.filter(a=>!a.key.startsWith(t))});this.view.updateState(o)}createExtensionManager(){const t=[...this.options.enableCoreExtensions?Object.values(eB):[],...this.options.extensions].filter(o=>["extension","node","mark"].includes(o==null?void 0:o.type));this.extensionManager=new Tc(t,this)}createCommandManager(){this.commandManager=new Lf({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){this.view=new br(this.options.element,On(ie({},this.options.editorProps),{dispatchTransaction:this.dispatchTransaction.bind(this),state:Cn.create({doc:a0(this.options.content,this.schema,this.options.parseOptions)})}));const e=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(e),this.createNodeViews();const t=this.view.dom;t.editor=this}createNodeViews(){this.view.setProps({nodeViews:this.extensionManager.nodeViews})}captureTransaction(e){this.isCapturingTransaction=!0,e(),this.isCapturingTransaction=!1;const t=this.capturedTransaction;return this.capturedTransaction=null,t}dispatchTransaction(e){if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=e;return}e.steps.forEach(d=>{var p;return(p=this.capturedTransaction)===null||p===void 0?void 0:p.step(d)});return}const t=this.state.apply(e),o=!this.state.selection.eq(t.selection);this.view.updateState(t),this.emit("transaction",{editor:this,transaction:e}),o&&this.emit("selectionUpdate",{editor:this,transaction:e});const a=e.getMeta("focus"),l=e.getMeta("blur");a&&this.emit("focus",{editor:this,event:a.event,transaction:e}),l&&this.emit("blur",{editor:this,event:l.event,transaction:e}),!(!e.docChanged||e.getMeta("preventUpdate"))&&this.emit("update",{editor:this,transaction:e})}getAttributes(e){return rB(this.state,e)}isActive(e,t){const o=typeof e=="string"?e:null,a=typeof e=="string"?t:e;return nB(this.state,o,a)}getJSON(){return this.state.doc.toJSON()}getHTML(){return iB(this.state.doc.content,this.schema)}getText(e){const{blockSeparator:t=`

`,textSerializers:o={}}=e||{};return oB(this.state.doc,{blockSeparator:t,textSerializers:ie(ie({},o),r0(this.schema))})}get isEmpty(){return sB(this.state.doc)}getCharacterCount(){return this.state.doc.content.size-2}destroy(){this.emit("destroy"),this.view&&this.view.destroy(),this.removeAllListeners()}get isDestroyed(){var e;return!((e=this.view)===null||e===void 0?void 0:e.docView)}}class yn{constructor(e={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config=ie(ie({},this.config),e),this.name=this.config.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=it(Ne(this,"addOptions",{name:this.name}))),this.storage=it(Ne(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new yn(e)}configure(e={}){const t=this.extend();return t.options=xd(this.options,e),t.storage=it(Ne(t,"addStorage",{name:t.name,options:t.options})),t}extend(e={}){const t=new yn(e);return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=e.defaultOptions?e.defaultOptions:t.parent.options,e.addOptions&&(t.options=it(Ne(t,"addOptions",{name:t.name}))),t.storage=it(Ne(t,"addStorage",{name:t.name,options:t.options})),t}}class Ss{constructor(e={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config=ie(ie({},this.config),e),this.name=this.config.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=it(Ne(this,"addOptions",{name:this.name}))),this.storage=it(Ne(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Ss(e)}configure(e={}){const t=this.extend();return t.options=xd(this.options,e),t.storage=it(Ne(t,"addStorage",{name:t.name,options:t.options})),t}extend(e={}){const t=new Ss(e);return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=e.defaultOptions?e.defaultOptions:t.parent.options,e.addOptions&&(t.options=it(Ne(t,"addOptions",{name:t.name}))),t.storage=it(Ne(t,"addStorage",{name:t.name,options:t.options})),t}}function yB(n){return new Hd({find:n.find,handler:({state:e,range:t,match:o})=>{const a=it(n.getAttributes,void 0,o)||{},{tr:l}=e,d=t.from;let p=t.to;if(o[1]){const g=o[0].lastIndexOf(o[1]);let v=d+g;v>p?v=p:p=v+o[1].length;const C=o[0][o[0].length-1];l.insertText(C,d+o[0].length-1),l.replaceWith(v,p,n.type.create(a))}else o[0]&&l.replaceWith(d,p,n.type.create(a))}})}function f0(n,e,t){const o=[];return t.doc.nodesBetween(n,e,(a,l)=>{o.push(...a.marks.map(d=>({from:l,to:l+a.nodeSize,mark:d})))}),o}function pa(n){return new Hd({find:n.find,handler:({state:e,range:t,match:o})=>{const a=it(n.getAttributes,void 0,o);if(a===!1||a===null)return;const{tr:l}=e,d=o[o.length-1],p=o[0];let g=t.to;if(d){const v=p.search(/\S/),C=t.from+p.indexOf(d),y=C+d.length;if(f0(t.from,t.to,e).filter(O=>O.mark.type.excluded.find(x=>x===n.type&&x!==O.mark.type)).filter(O=>O.to>C).length)return null;y<t.to&&l.delete(y,t.to),C>t.from&&l.delete(t.from+v,C),g=t.from+v+d.length,l.addMark(t.from+v,g,n.type.create(a||{})),l.removeStoredMark(n.type)}}})}function Uf(n){return new Hd({find:n.find,handler:({state:e,range:t,match:o})=>{const a=e.doc.resolve(t.from),l=it(n.getAttributes,void 0,o)||{};if(!a.node(-1).canReplaceWith(a.index(-1),a.indexAfter(-1),n.type))return null;e.tr.delete(t.from,t.to).setBlockType(t.from,t.from,n.type,l)}})}function Kd(n){return new Hd({find:n.find,handler:({state:e,range:t,match:o})=>{const a=it(n.getAttributes,void 0,o)||{},l=e.tr.delete(t.from,t.to),p=l.doc.resolve(t.from).blockRange(),g=p&&QA(p,n.type,a);if(!g)return null;l.wrap(p,g);const v=l.doc.resolve(t.from-1).nodeBefore;v&&v.type===n.type&&xA(l.doc,t.from-1)&&(!n.joinPredicate||n.joinPredicate(o,v))&&l.join(t.from-1)}})}function Aa(n){return new dB({find:n.find,handler:({state:e,range:t,match:o})=>{const a=it(n.getAttributes,void 0,o);if(a===!1||a===null)return;const{tr:l}=e,d=o[o.length-1],p=o[0];let g=t.to;if(d){const v=p.search(/\S/),C=t.from+p.indexOf(d),y=C+d.length;if(f0(t.from,t.to,e).filter(O=>O.mark.type.excluded.find(x=>x===n.type&&x!==O.mark.type)).filter(O=>O.to>C).length)return null;y<t.to&&l.delete(y,t.to),C>t.from&&l.delete(t.from+v,C),g=t.from+v+d.length,l.addMark(t.from+v,g,n.type.create(a||{})),l.removeStoredMark(n.type)}}})}function _B(n){return Df(n)&&n instanceof $e}function g0(n,e,t){const o=0,a=n.state.doc.content.size,l=ha(e,o,a),d=ha(t,o,a),p=n.coordsAtPos(l),g=n.coordsAtPos(d,-1),v=Math.min(p.top,g.top),C=Math.max(p.bottom,g.bottom),y=Math.min(p.left,g.left),w=Math.max(p.right,g.right),O=w-y,M=C-v,K={top:v,bottom:C,left:y,right:w,width:O,height:M,x:y,y:v};return On(ie({},K),{toJSON:()=>K})}var Zn="top",Qi="bottom",xi="right",$n="left",Ff="auto",Yl=[Zn,Qi,xi,$n],Rc="start",ql="end",SB="clippingParents",m0="viewport",Jl="popper",TB="reference",v0=Yl.reduce(function(n,e){return n.concat([e+"-"+Rc,e+"-"+ql])},[]),E0=[].concat(Yl,[Ff]).reduce(function(n,e){return n.concat([e,e+"-"+Rc,e+"-"+ql])},[]),RB="beforeRead",wB="read",NB="afterRead",kB="beforeMain",OB="main",bB="afterMain",DB="beforeWrite",BB="write",MB="afterWrite",LB=[RB,wB,NB,kB,OB,bB,DB,BB,MB];function So(n){return n?(n.nodeName||"").toLowerCase():null}function to(n){if(n==null)return window;if(n.toString()!=="[object Window]"){var e=n.ownerDocument;return e&&e.defaultView||window}return n}function wc(n){var e=to(n).Element;return n instanceof e||n instanceof Element}function Ui(n){var e=to(n).HTMLElement;return n instanceof e||n instanceof HTMLElement}function I0(n){if(typeof ShadowRoot=="undefined")return!1;var e=to(n).ShadowRoot;return n instanceof e||n instanceof ShadowRoot}function PB(n){var e=n.state;Object.keys(e.elements).forEach(function(t){var o=e.styles[t]||{},a=e.attributes[t]||{},l=e.elements[t];!Ui(l)||!So(l)||(Object.assign(l.style,o),Object.keys(a).forEach(function(d){var p=a[d];p===!1?l.removeAttribute(d):l.setAttribute(d,p===!0?"":p)}))})}function QB(n){var e=n.state,t={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,t.popper),e.styles=t,e.elements.arrow&&Object.assign(e.elements.arrow.style,t.arrow),function(){Object.keys(e.elements).forEach(function(o){var a=e.elements[o],l=e.attributes[o]||{},d=Object.keys(e.styles.hasOwnProperty(o)?e.styles[o]:t[o]),p=d.reduce(function(g,v){return g[v]="",g},{});!Ui(a)||!So(a)||(Object.assign(a.style,p),Object.keys(l).forEach(function(g){a.removeAttribute(g)}))})}}var C0={name:"applyStyles",enabled:!0,phase:"write",fn:PB,effect:QB,requires:["computeStyles"]};function To(n){return n.split("-")[0]}var fa=Math.max,Wd=Math.min,Nc=Math.round;function kc(n,e){e===void 0&&(e=!1);var t=n.getBoundingClientRect(),o=1,a=1;if(Ui(n)&&e){var l=n.offsetHeight,d=n.offsetWidth;d>0&&(o=Nc(t.width)/d||1),l>0&&(a=Nc(t.height)/l||1)}return{width:t.width/o,height:t.height/a,top:t.top/a,right:t.right/o,bottom:t.bottom/a,left:t.left/o,x:t.left/o,y:t.top/a}}function Vf(n){var e=kc(n),t=n.offsetWidth,o=n.offsetHeight;return Math.abs(e.width-t)<=1&&(t=e.width),Math.abs(e.height-o)<=1&&(o=e.height),{x:n.offsetLeft,y:n.offsetTop,width:t,height:o}}function y0(n,e){var t=e.getRootNode&&e.getRootNode();if(n.contains(e))return!0;if(t&&I0(t)){var o=e;do{if(o&&n.isSameNode(o))return!0;o=o.parentNode||o.host}while(o)}return!1}function Ro(n){return to(n).getComputedStyle(n)}function xB(n){return["table","td","th"].indexOf(So(n))>=0}function Ts(n){return((wc(n)?n.ownerDocument:n.document)||window.document).documentElement}function Yd(n){return So(n)==="html"?n:n.assignedSlot||n.parentNode||(I0(n)?n.host:null)||Ts(n)}function _0(n){return!Ui(n)||Ro(n).position==="fixed"?null:n.offsetParent}function UB(n){var e=navigator.userAgent.toLowerCase().indexOf("firefox")!==-1,t=navigator.userAgent.indexOf("Trident")!==-1;if(t&&Ui(n)){var o=Ro(n);if(o.position==="fixed")return null}for(var a=Yd(n);Ui(a)&&["html","body"].indexOf(So(a))<0;){var l=Ro(a);if(l.transform!=="none"||l.perspective!=="none"||l.contain==="paint"||["transform","perspective"].indexOf(l.willChange)!==-1||e&&l.willChange==="filter"||e&&l.filter&&l.filter!=="none")return a;a=a.parentNode}return null}function zl(n){for(var e=to(n),t=_0(n);t&&xB(t)&&Ro(t).position==="static";)t=_0(t);return t&&(So(t)==="html"||So(t)==="body"&&Ro(t).position==="static")?e:t||UB(n)||e}function Gf(n){return["top","bottom"].indexOf(n)>=0?"x":"y"}function Xl(n,e,t){return fa(n,Wd(e,t))}function FB(n,e,t){var o=Xl(n,e,t);return o>t?t:o}function S0(){return{top:0,right:0,bottom:0,left:0}}function T0(n){return Object.assign({},S0(),n)}function R0(n,e){return e.reduce(function(t,o){return t[o]=n,t},{})}var VB=function(e,t){return e=typeof e=="function"?e(Object.assign({},t.rects,{placement:t.placement})):e,T0(typeof e!="number"?e:R0(e,Yl))};function GB(n){var e,t=n.state,o=n.name,a=n.options,l=t.elements.arrow,d=t.modifiersData.popperOffsets,p=To(t.placement),g=Gf(p),v=[$n,xi].indexOf(p)>=0,C=v?"height":"width";if(!(!l||!d)){var y=VB(a.padding,t),w=Vf(l),O=g==="y"?Zn:$n,M=g==="y"?Qi:xi,x=t.rects.reference[C]+t.rects.reference[g]-d[g]-t.rects.popper[C],G=d[g]-t.rects.reference[g],K=zl(l),F=K?g==="y"?K.clientHeight||0:K.clientWidth||0:0,re=x/2-G/2,Q=y[O],Ae=F-w[C]-y[M],oe=F/2-w[C]/2+re,Te=Xl(Q,oe,Ae),je=g;t.modifiersData[o]=(e={},e[je]=Te,e.centerOffset=Te-oe,e)}}function jB(n){var e=n.state,t=n.options,o=t.element,a=o===void 0?"[data-popper-arrow]":o;a!=null&&(typeof a=="string"&&(a=e.elements.popper.querySelector(a),!a)||!y0(e.elements.popper,a)||(e.elements.arrow=a))}var HB={name:"arrow",enabled:!0,phase:"main",fn:GB,effect:jB,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Oc(n){return n.split("-")[1]}var KB={top:"auto",right:"auto",bottom:"auto",left:"auto"};function WB(n){var e=n.x,t=n.y,o=window,a=o.devicePixelRatio||1;return{x:Nc(e*a)/a||0,y:Nc(t*a)/a||0}}function w0(n){var e,t=n.popper,o=n.popperRect,a=n.placement,l=n.variation,d=n.offsets,p=n.position,g=n.gpuAcceleration,v=n.adaptive,C=n.roundOffsets,y=n.isFixed,w=C===!0?WB(d):typeof C=="function"?C(d):d,O=w.x,M=O===void 0?0:O,x=w.y,G=x===void 0?0:x,K=d.hasOwnProperty("x"),F=d.hasOwnProperty("y"),re=$n,Q=Zn,Ae=window;if(v){var oe=zl(t),Te="clientHeight",je="clientWidth";if(oe===to(t)&&(oe=Ts(t),Ro(oe).position!=="static"&&p==="absolute"&&(Te="scrollHeight",je="scrollWidth")),oe=oe,a===Zn||(a===$n||a===xi)&&l===ql){Q=Qi;var We=y&&Ae.visualViewport?Ae.visualViewport.height:oe[Te];G-=We-o.height,G*=g?1:-1}if(a===$n||(a===Zn||a===Qi)&&l===ql){re=xi;var Oe=y&&Ae.visualViewport?Ae.visualViewport.width:oe[je];M-=Oe-o.width,M*=g?1:-1}}var Mt=Object.assign({position:p},v&&KB);if(g){var At;return Object.assign({},Mt,(At={},At[Q]=F?"0":"",At[re]=K?"0":"",At.transform=(Ae.devicePixelRatio||1)<=1?"translate("+M+"px, "+G+"px)":"translate3d("+M+"px, "+G+"px, 0)",At))}return Object.assign({},Mt,(e={},e[Q]=F?G+"px":"",e[re]=K?M+"px":"",e.transform="",e))}function YB(n){var e=n.state,t=n.options,o=t.gpuAcceleration,a=o===void 0?!0:o,l=t.adaptive,d=l===void 0?!0:l,p=t.roundOffsets,g=p===void 0?!0:p,v={placement:To(e.placement),variation:Oc(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:a,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,w0(Object.assign({},v,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:d,roundOffsets:g})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,w0(Object.assign({},v,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:g})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}var qB={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:YB,data:{}},qd={passive:!0};function JB(n){var e=n.state,t=n.instance,o=n.options,a=o.scroll,l=a===void 0?!0:a,d=o.resize,p=d===void 0?!0:d,g=to(e.elements.popper),v=[].concat(e.scrollParents.reference,e.scrollParents.popper);return l&&v.forEach(function(C){C.addEventListener("scroll",t.update,qd)}),p&&g.addEventListener("resize",t.update,qd),function(){l&&v.forEach(function(C){C.removeEventListener("scroll",t.update,qd)}),p&&g.removeEventListener("resize",t.update,qd)}}var zB={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:JB,data:{}},XB={left:"right",right:"left",bottom:"top",top:"bottom"};function Jd(n){return n.replace(/left|right|bottom|top/g,function(e){return XB[e]})}var ZB={start:"end",end:"start"};function N0(n){return n.replace(/start|end/g,function(e){return ZB[e]})}function jf(n){var e=to(n),t=e.pageXOffset,o=e.pageYOffset;return{scrollLeft:t,scrollTop:o}}function Hf(n){return kc(Ts(n)).left+jf(n).scrollLeft}function $B(n){var e=to(n),t=Ts(n),o=e.visualViewport,a=t.clientWidth,l=t.clientHeight,d=0,p=0;return o&&(a=o.width,l=o.height,/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||(d=o.offsetLeft,p=o.offsetTop)),{width:a,height:l,x:d+Hf(n),y:p}}function eM(n){var e,t=Ts(n),o=jf(n),a=(e=n.ownerDocument)==null?void 0:e.body,l=fa(t.scrollWidth,t.clientWidth,a?a.scrollWidth:0,a?a.clientWidth:0),d=fa(t.scrollHeight,t.clientHeight,a?a.scrollHeight:0,a?a.clientHeight:0),p=-o.scrollLeft+Hf(n),g=-o.scrollTop;return Ro(a||t).direction==="rtl"&&(p+=fa(t.clientWidth,a?a.clientWidth:0)-l),{width:l,height:d,x:p,y:g}}function Kf(n){var e=Ro(n),t=e.overflow,o=e.overflowX,a=e.overflowY;return/auto|scroll|overlay|hidden/.test(t+a+o)}function k0(n){return["html","body","#document"].indexOf(So(n))>=0?n.ownerDocument.body:Ui(n)&&Kf(n)?n:k0(Yd(n))}function Zl(n,e){var t;e===void 0&&(e=[]);var o=k0(n),a=o===((t=n.ownerDocument)==null?void 0:t.body),l=to(o),d=a?[l].concat(l.visualViewport||[],Kf(o)?o:[]):o,p=e.concat(d);return a?p:p.concat(Zl(Yd(d)))}function Wf(n){return Object.assign({},n,{left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height})}function tM(n){var e=kc(n);return e.top=e.top+n.clientTop,e.left=e.left+n.clientLeft,e.bottom=e.top+n.clientHeight,e.right=e.left+n.clientWidth,e.width=n.clientWidth,e.height=n.clientHeight,e.x=e.left,e.y=e.top,e}function O0(n,e){return e===m0?Wf($B(n)):wc(e)?tM(e):Wf(eM(Ts(n)))}function rM(n){var e=Zl(Yd(n)),t=["absolute","fixed"].indexOf(Ro(n).position)>=0,o=t&&Ui(n)?zl(n):n;return wc(o)?e.filter(function(a){return wc(a)&&y0(a,o)&&So(a)!=="body"&&(t?Ro(a).position!=="static":!0)}):[]}function nM(n,e,t){var o=e==="clippingParents"?rM(n):[].concat(e),a=[].concat(o,[t]),l=a[0],d=a.reduce(function(p,g){var v=O0(n,g);return p.top=fa(v.top,p.top),p.right=Wd(v.right,p.right),p.bottom=Wd(v.bottom,p.bottom),p.left=fa(v.left,p.left),p},O0(n,l));return d.width=d.right-d.left,d.height=d.bottom-d.top,d.x=d.left,d.y=d.top,d}function b0(n){var e=n.reference,t=n.element,o=n.placement,a=o?To(o):null,l=o?Oc(o):null,d=e.x+e.width/2-t.width/2,p=e.y+e.height/2-t.height/2,g;switch(a){case Zn:g={x:d,y:e.y-t.height};break;case Qi:g={x:d,y:e.y+e.height};break;case xi:g={x:e.x+e.width,y:p};break;case $n:g={x:e.x-t.width,y:p};break;default:g={x:e.x,y:e.y}}var v=a?Gf(a):null;if(v!=null){var C=v==="y"?"height":"width";switch(l){case Rc:g[v]=g[v]-(e[C]/2-t[C]/2);break;case ql:g[v]=g[v]+(e[C]/2-t[C]/2);break}}return g}function $l(n,e){e===void 0&&(e={});var t=e,o=t.placement,a=o===void 0?n.placement:o,l=t.boundary,d=l===void 0?SB:l,p=t.rootBoundary,g=p===void 0?m0:p,v=t.elementContext,C=v===void 0?Jl:v,y=t.altBoundary,w=y===void 0?!1:y,O=t.padding,M=O===void 0?0:O,x=T0(typeof M!="number"?M:R0(M,Yl)),G=C===Jl?TB:Jl,K=n.rects.popper,F=n.elements[w?G:C],re=nM(wc(F)?F:F.contextElement||Ts(n.elements.popper),d,g),Q=kc(n.elements.reference),Ae=b0({reference:Q,element:K,strategy:"absolute",placement:a}),oe=Wf(Object.assign({},K,Ae)),Te=C===Jl?oe:Q,je={top:re.top-Te.top+x.top,bottom:Te.bottom-re.bottom+x.bottom,left:re.left-Te.left+x.left,right:Te.right-re.right+x.right},We=n.modifiersData.offset;if(C===Jl&&We){var Oe=We[a];Object.keys(je).forEach(function(Mt){var At=[xi,Qi].indexOf(Mt)>=0?1:-1,Gt=[Zn,Qi].indexOf(Mt)>=0?"y":"x";je[Mt]+=Oe[Gt]*At})}return je}function iM(n,e){e===void 0&&(e={});var t=e,o=t.placement,a=t.boundary,l=t.rootBoundary,d=t.padding,p=t.flipVariations,g=t.allowedAutoPlacements,v=g===void 0?E0:g,C=Oc(o),y=C?p?v0:v0.filter(function(M){return Oc(M)===C}):Yl,w=y.filter(function(M){return v.indexOf(M)>=0});w.length===0&&(w=y);var O=w.reduce(function(M,x){return M[x]=$l(n,{placement:x,boundary:a,rootBoundary:l,padding:d})[To(x)],M},{});return Object.keys(O).sort(function(M,x){return O[M]-O[x]})}function oM(n){if(To(n)===Ff)return[];var e=Jd(n);return[N0(n),e,N0(e)]}function sM(n){var e=n.state,t=n.options,o=n.name;if(!e.modifiersData[o]._skip){for(var a=t.mainAxis,l=a===void 0?!0:a,d=t.altAxis,p=d===void 0?!0:d,g=t.fallbackPlacements,v=t.padding,C=t.boundary,y=t.rootBoundary,w=t.altBoundary,O=t.flipVariations,M=O===void 0?!0:O,x=t.allowedAutoPlacements,G=e.options.placement,K=To(G),F=K===G,re=g||(F||!M?[Jd(G)]:oM(G)),Q=[G].concat(re).reduce(function(vi,Fn){return vi.concat(To(Fn)===Ff?iM(e,{placement:Fn,boundary:C,rootBoundary:y,padding:v,flipVariations:M,allowedAutoPlacements:x}):Fn)},[]),Ae=e.rects.reference,oe=e.rects.popper,Te=new Map,je=!0,We=Q[0],Oe=0;Oe<Q.length;Oe++){var Mt=Q[Oe],At=To(Mt),Gt=Oc(Mt)===Rc,Dr=[Zn,Qi].indexOf(At)>=0,Lt=Dr?"width":"height",at=$l(e,{placement:Mt,boundary:C,rootBoundary:y,altBoundary:w,padding:v}),$t=Dr?Gt?xi:$n:Gt?Qi:Zn;Ae[Lt]>oe[Lt]&&($t=Jd($t));var Cr=Jd($t),ei=[];if(l&&ei.push(at[At]<=0),p&&ei.push(at[$t]<=0,at[Cr]<=0),ei.every(function(vi){return vi})){We=Mt,je=!1;break}Te.set(Mt,ei)}if(je)for(var ti=M?3:1,io=function(Fn){var Ei=Q.find(function(bo){var Ii=Te.get(bo);if(Ii)return Ii.slice(0,Fn).every(function(Do){return Do})});if(Ei)return We=Ei,"break"},ri=ti;ri>0;ri--){var oo=io(ri);if(oo==="break")break}e.placement!==We&&(e.modifiersData[o]._skip=!0,e.placement=We,e.reset=!0)}}var aM={name:"flip",enabled:!0,phase:"main",fn:sM,requiresIfExists:["offset"],data:{_skip:!1}};function D0(n,e,t){return t===void 0&&(t={x:0,y:0}),{top:n.top-e.height-t.y,right:n.right-e.width+t.x,bottom:n.bottom-e.height+t.y,left:n.left-e.width-t.x}}function B0(n){return[Zn,xi,Qi,$n].some(function(e){return n[e]>=0})}function cM(n){var e=n.state,t=n.name,o=e.rects.reference,a=e.rects.popper,l=e.modifiersData.preventOverflow,d=$l(e,{elementContext:"reference"}),p=$l(e,{altBoundary:!0}),g=D0(d,o),v=D0(p,a,l),C=B0(g),y=B0(v);e.modifiersData[t]={referenceClippingOffsets:g,popperEscapeOffsets:v,isReferenceHidden:C,hasPopperEscaped:y},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":C,"data-popper-escaped":y})}var lM={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:cM};function uM(n,e,t){var o=To(n),a=[$n,Zn].indexOf(o)>=0?-1:1,l=typeof t=="function"?t(Object.assign({},e,{placement:n})):t,d=l[0],p=l[1];return d=d||0,p=(p||0)*a,[$n,xi].indexOf(o)>=0?{x:p,y:d}:{x:d,y:p}}function dM(n){var e=n.state,t=n.options,o=n.name,a=t.offset,l=a===void 0?[0,0]:a,d=E0.reduce(function(C,y){return C[y]=uM(y,e.rects,l),C},{}),p=d[e.placement],g=p.x,v=p.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=g,e.modifiersData.popperOffsets.y+=v),e.modifiersData[o]=d}var hM={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:dM};function pM(n){var e=n.state,t=n.name;e.modifiersData[t]=b0({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}var AM={name:"popperOffsets",enabled:!0,phase:"read",fn:pM,data:{}};function fM(n){return n==="x"?"y":"x"}function gM(n){var e=n.state,t=n.options,o=n.name,a=t.mainAxis,l=a===void 0?!0:a,d=t.altAxis,p=d===void 0?!1:d,g=t.boundary,v=t.rootBoundary,C=t.altBoundary,y=t.padding,w=t.tether,O=w===void 0?!0:w,M=t.tetherOffset,x=M===void 0?0:M,G=$l(e,{boundary:g,rootBoundary:v,padding:y,altBoundary:C}),K=To(e.placement),F=Oc(e.placement),re=!F,Q=Gf(K),Ae=fM(Q),oe=e.modifiersData.popperOffsets,Te=e.rects.reference,je=e.rects.popper,We=typeof x=="function"?x(Object.assign({},e.rects,{placement:e.placement})):x,Oe=typeof We=="number"?{mainAxis:We,altAxis:We}:Object.assign({mainAxis:0,altAxis:0},We),Mt=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,At={x:0,y:0};if(!!oe){if(l){var Gt,Dr=Q==="y"?Zn:$n,Lt=Q==="y"?Qi:xi,at=Q==="y"?"height":"width",$t=oe[Q],Cr=$t+G[Dr],ei=$t-G[Lt],ti=O?-je[at]/2:0,io=F===Rc?Te[at]:je[at],ri=F===Rc?-je[at]:-Te[at],oo=e.elements.arrow,vi=O&&oo?Vf(oo):{width:0,height:0},Fn=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:S0(),Ei=Fn[Dr],bo=Fn[Lt],Ii=Xl(0,Te[at],vi[at]),Do=re?Te[at]/2-ti-Ii-Ei-Oe.mainAxis:io-Ii-Ei-Oe.mainAxis,ni=re?-Te[at]/2+ti+Ii+bo+Oe.mainAxis:ri+Ii+bo+Oe.mainAxis,Ci=e.elements.arrow&&zl(e.elements.arrow),so=Ci?Q==="y"?Ci.clientTop||0:Ci.clientLeft||0:0,Bo=(Gt=Mt==null?void 0:Mt[Q])!=null?Gt:0,$o=$t+Do-Bo-so,Ye=$t+ni-Bo,bs=Xl(O?Wd(Cr,$o):Cr,$t,O?fa(ei,Ye):ei);oe[Q]=bs,At[Q]=bs-$t}if(p){var ao,ya=Q==="x"?Zn:$n,co=Q==="x"?Qi:xi,dn=oe[Ae],Xt=Ae==="y"?"height":"width",Br=dn+G[ya],Vn=dn-G[co],es=[Zn,$n].indexOf(K)!==-1,Ds=(ao=Mt==null?void 0:Mt[Ae])!=null?ao:0,Gn=es?Br:dn-Te[Xt]-je[Xt]-Ds+Oe.altAxis,Bs=es?dn+Te[Xt]+je[Xt]-Ds-Oe.altAxis:Vn,ts=O&&es?FB(Gn,dn,Bs):Xl(O?Gn:Br,dn,O?Bs:Vn);oe[Ae]=ts,At[Ae]=ts-dn}e.modifiersData[o]=At}}var mM={name:"preventOverflow",enabled:!0,phase:"main",fn:gM,requiresIfExists:["offset"]};function vM(n){return{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}}function EM(n){return n===to(n)||!Ui(n)?jf(n):vM(n)}function IM(n){var e=n.getBoundingClientRect(),t=Nc(e.width)/n.offsetWidth||1,o=Nc(e.height)/n.offsetHeight||1;return t!==1||o!==1}function CM(n,e,t){t===void 0&&(t=!1);var o=Ui(e),a=Ui(e)&&IM(e),l=Ts(e),d=kc(n,a),p={scrollLeft:0,scrollTop:0},g={x:0,y:0};return(o||!o&&!t)&&((So(e)!=="body"||Kf(l))&&(p=EM(e)),Ui(e)?(g=kc(e,!0),g.x+=e.clientLeft,g.y+=e.clientTop):l&&(g.x=Hf(l))),{x:d.left+p.scrollLeft-g.x,y:d.top+p.scrollTop-g.y,width:d.width,height:d.height}}function yM(n){var e=new Map,t=new Set,o=[];n.forEach(function(l){e.set(l.name,l)});function a(l){t.add(l.name);var d=[].concat(l.requires||[],l.requiresIfExists||[]);d.forEach(function(p){if(!t.has(p)){var g=e.get(p);g&&a(g)}}),o.push(l)}return n.forEach(function(l){t.has(l.name)||a(l)}),o}function _M(n){var e=yM(n);return LB.reduce(function(t,o){return t.concat(e.filter(function(a){return a.phase===o}))},[])}function SM(n){var e;return function(){return e||(e=new Promise(function(t){Promise.resolve().then(function(){e=void 0,t(n())})})),e}}function TM(n){var e=n.reduce(function(t,o){var a=t[o.name];return t[o.name]=a?Object.assign({},a,o,{options:Object.assign({},a.options,o.options),data:Object.assign({},a.data,o.data)}):o,t},{});return Object.keys(e).map(function(t){return e[t]})}var M0={placement:"bottom",modifiers:[],strategy:"absolute"};function L0(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return!e.some(function(o){return!(o&&typeof o.getBoundingClientRect=="function")})}function RM(n){n===void 0&&(n={});var e=n,t=e.defaultModifiers,o=t===void 0?[]:t,a=e.defaultOptions,l=a===void 0?M0:a;return function(p,g,v){v===void 0&&(v=l);var C={placement:"bottom",orderedModifiers:[],options:Object.assign({},M0,l),modifiersData:{},elements:{reference:p,popper:g},attributes:{},styles:{}},y=[],w=!1,O={state:C,setOptions:function(K){var F=typeof K=="function"?K(C.options):K;x(),C.options=Object.assign({},l,C.options,F),C.scrollParents={reference:wc(p)?Zl(p):p.contextElement?Zl(p.contextElement):[],popper:Zl(g)};var re=_M(TM([].concat(o,C.options.modifiers)));return C.orderedModifiers=re.filter(function(Q){return Q.enabled}),M(),O.update()},forceUpdate:function(){if(!w){var K=C.elements,F=K.reference,re=K.popper;if(!!L0(F,re)){C.rects={reference:CM(F,zl(re),C.options.strategy==="fixed"),popper:Vf(re)},C.reset=!1,C.placement=C.options.placement,C.orderedModifiers.forEach(function(Oe){return C.modifiersData[Oe.name]=Object.assign({},Oe.data)});for(var Q=0;Q<C.orderedModifiers.length;Q++){if(C.reset===!0){C.reset=!1,Q=-1;continue}var Ae=C.orderedModifiers[Q],oe=Ae.fn,Te=Ae.options,je=Te===void 0?{}:Te,We=Ae.name;typeof oe=="function"&&(C=oe({state:C,options:je,name:We,instance:O})||C)}}}},update:SM(function(){return new Promise(function(G){O.forceUpdate(),G(C)})}),destroy:function(){x(),w=!0}};if(!L0(p,g))return O;O.setOptions(v).then(function(G){!w&&v.onFirstUpdate&&v.onFirstUpdate(G)});function M(){C.orderedModifiers.forEach(function(G){var K=G.name,F=G.options,re=F===void 0?{}:F,Q=G.effect;if(typeof Q=="function"){var Ae=Q({state:C,name:K,instance:O,options:re}),oe=function(){};y.push(Ae||oe)}})}function x(){y.forEach(function(G){return G()}),y=[]}return O}}var wM=[zB,AM,qB,C0,hM,aM,mM,HB,lM],NM=RM({defaultModifiers:wM}),kM="tippy-box",P0="tippy-content",OM="tippy-backdrop",Q0="tippy-arrow",x0="tippy-svg-arrow",ga={passive:!0,capture:!0},U0=function(){return document.body};function Yf(n,e,t){if(Array.isArray(n)){var o=n[e];return o==null?Array.isArray(t)?t[e]:t:o}return n}function qf(n,e){var t={}.toString.call(n);return t.indexOf("[object")===0&&t.indexOf(e+"]")>-1}function F0(n,e){return typeof n=="function"?n.apply(void 0,e):n}function V0(n,e){if(e===0)return n;var t;return function(o){clearTimeout(t),t=setTimeout(function(){n(o)},e)}}function bM(n){return n.split(/\s+/).filter(Boolean)}function bc(n){return[].concat(n)}function G0(n,e){n.indexOf(e)===-1&&n.push(e)}function DM(n){return n.filter(function(e,t){return n.indexOf(e)===t})}function BM(n){return n.split("-")[0]}function zd(n){return[].slice.call(n)}function j0(n){return Object.keys(n).reduce(function(e,t){return n[t]!==void 0&&(e[t]=n[t]),e},{})}function eu(){return document.createElement("div")}function Xd(n){return["Element","Fragment"].some(function(e){return qf(n,e)})}function MM(n){return qf(n,"NodeList")}function LM(n){return qf(n,"MouseEvent")}function PM(n){return!!(n&&n._tippy&&n._tippy.reference===n)}function QM(n){return Xd(n)?[n]:MM(n)?zd(n):Array.isArray(n)?n:zd(document.querySelectorAll(n))}function Jf(n,e){n.forEach(function(t){t&&(t.style.transitionDuration=e+"ms")})}function H0(n,e){n.forEach(function(t){t&&t.setAttribute("data-state",e)})}function xM(n){var e,t=bc(n),o=t[0];return o!=null&&(e=o.ownerDocument)!=null&&e.body?o.ownerDocument:document}function UM(n,e){var t=e.clientX,o=e.clientY;return n.every(function(a){var l=a.popperRect,d=a.popperState,p=a.props,g=p.interactiveBorder,v=BM(d.placement),C=d.modifiersData.offset;if(!C)return!0;var y=v==="bottom"?C.top.y:0,w=v==="top"?C.bottom.y:0,O=v==="right"?C.left.x:0,M=v==="left"?C.right.x:0,x=l.top-o+y>g,G=o-l.bottom-w>g,K=l.left-t+O>g,F=t-l.right-M>g;return x||G||K||F})}function zf(n,e,t){var o=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(a){n[o](a,t)})}function K0(n,e){for(var t=e;t;){var o;if(n.contains(t))return!0;t=t.getRootNode==null||(o=t.getRootNode())==null?void 0:o.host}return!1}var wo={isTouch:!1},W0=0;function FM(){wo.isTouch||(wo.isTouch=!0,window.performance&&document.addEventListener("mousemove",Y0))}function Y0(){var n=performance.now();n-W0<20&&(wo.isTouch=!1,document.removeEventListener("mousemove",Y0)),W0=n}function VM(){var n=document.activeElement;if(PM(n)){var e=n._tippy;n.blur&&!e.state.isVisible&&n.blur()}}function GM(){document.addEventListener("touchstart",FM,ga),window.addEventListener("blur",VM)}var jM=typeof window!="undefined"&&typeof document!="undefined",HM=jM?!!window.msCrypto:!1,KM={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},WM={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},ro=Object.assign({appendTo:U0,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},KM,WM),YM=Object.keys(ro),qM=function(e){var t=Object.keys(e);t.forEach(function(o){ro[o]=e[o]})};function q0(n){var e=n.plugins||[],t=e.reduce(function(o,a){var l=a.name,d=a.defaultValue;if(l){var p;o[l]=n[l]!==void 0?n[l]:(p=ro[l])!=null?p:d}return o},{});return Object.assign({},n,t)}function JM(n,e){var t=e?Object.keys(q0(Object.assign({},ro,{plugins:e}))):YM,o=t.reduce(function(a,l){var d=(n.getAttribute("data-tippy-"+l)||"").trim();if(!d)return a;if(l==="content")a[l]=d;else try{a[l]=JSON.parse(d)}catch{a[l]=d}return a},{});return o}function J0(n,e){var t=Object.assign({},e,{content:F0(e.content,[n])},e.ignoreAttributes?{}:JM(n,e.plugins));return t.aria=Object.assign({},ro.aria,t.aria),t.aria={expanded:t.aria.expanded==="auto"?e.interactive:t.aria.expanded,content:t.aria.content==="auto"?e.interactive?null:"describedby":t.aria.content},t}var zM=function(){return"innerHTML"};function Xf(n,e){n[zM()]=e}function z0(n){var e=eu();return n===!0?e.className=Q0:(e.className=x0,Xd(n)?e.appendChild(n):Xf(e,n)),e}function X0(n,e){Xd(e.content)?(Xf(n,""),n.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?Xf(n,e.content):n.textContent=e.content)}function Zf(n){var e=n.firstElementChild,t=zd(e.children);return{box:e,content:t.find(function(o){return o.classList.contains(P0)}),arrow:t.find(function(o){return o.classList.contains(Q0)||o.classList.contains(x0)}),backdrop:t.find(function(o){return o.classList.contains(OM)})}}function Z0(n){var e=eu(),t=eu();t.className=kM,t.setAttribute("data-state","hidden"),t.setAttribute("tabindex","-1");var o=eu();o.className=P0,o.setAttribute("data-state","hidden"),X0(o,n.props),e.appendChild(t),t.appendChild(o),a(n.props,n.props);function a(l,d){var p=Zf(e),g=p.box,v=p.content,C=p.arrow;d.theme?g.setAttribute("data-theme",d.theme):g.removeAttribute("data-theme"),typeof d.animation=="string"?g.setAttribute("data-animation",d.animation):g.removeAttribute("data-animation"),d.inertia?g.setAttribute("data-inertia",""):g.removeAttribute("data-inertia"),g.style.maxWidth=typeof d.maxWidth=="number"?d.maxWidth+"px":d.maxWidth,d.role?g.setAttribute("role",d.role):g.removeAttribute("role"),(l.content!==d.content||l.allowHTML!==d.allowHTML)&&X0(v,n.props),d.arrow?C?l.arrow!==d.arrow&&(g.removeChild(C),g.appendChild(z0(d.arrow))):g.appendChild(z0(d.arrow)):C&&g.removeChild(C)}return{popper:e,onUpdate:a}}Z0.$$tippy=!0;var XM=1,Zd=[],$f=[];function ZM(n,e){var t=J0(n,Object.assign({},ro,q0(j0(e)))),o,a,l,d=!1,p=!1,g=!1,v=!1,C,y,w,O=[],M=V0($o,t.interactiveDebounce),x,G=XM++,K=null,F=DM(t.plugins),re={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},Q={id:G,reference:n,popper:eu(),popperInstance:K,props:t,state:re,plugins:F,clearDelayTimeouts:Gn,setProps:Bs,setContent:ts,show:rs,hide:xc,hideWithInteractivity:_a,enable:es,disable:Ds,unmount:Sa,destroy:Ur};if(!t.render)return Q;var Ae=t.render(Q),oe=Ae.popper,Te=Ae.onUpdate;oe.setAttribute("data-tippy-root",""),oe.id="tippy-"+Q.id,Q.popper=oe,n._tippy=Q,oe._tippy=Q;var je=F.map(function(X){return X.fn(Q)}),We=n.hasAttribute("aria-expanded");return Ci(),ti(),$t(),Cr("onCreate",[Q]),t.showOnCreate&&Br(),oe.addEventListener("mouseenter",function(){Q.props.interactive&&Q.state.isVisible&&Q.clearDelayTimeouts()}),oe.addEventListener("mouseleave",function(){Q.props.interactive&&Q.props.trigger.indexOf("mouseenter")>=0&&Dr().addEventListener("mousemove",M)}),Q;function Oe(){var X=Q.props.touch;return Array.isArray(X)?X:[X,0]}function Mt(){return Oe()[0]==="hold"}function At(){var X;return!!((X=Q.props.render)!=null&&X.$$tippy)}function Gt(){return x||n}function Dr(){var X=Gt().parentNode;return X?xM(X):document}function Lt(){return Zf(oe)}function at(X){return Q.state.isMounted&&!Q.state.isVisible||wo.isTouch||C&&C.type==="focus"?0:Yf(Q.props.delay,X?0:1,ro.delay)}function $t(X){X===void 0&&(X=!1),oe.style.pointerEvents=Q.props.interactive&&!X?"":"none",oe.style.zIndex=""+Q.props.zIndex}function Cr(X,te,be){if(be===void 0&&(be=!0),je.forEach(function(ft){ft[X]&&ft[X].apply(ft,te)}),be){var St;(St=Q.props)[X].apply(St,te)}}function ei(){var X=Q.props.aria;if(!!X.content){var te="aria-"+X.content,be=oe.id,St=bc(Q.props.triggerTarget||n);St.forEach(function(ft){var Fr=ft.getAttribute(te);if(Q.state.isVisible)ft.setAttribute(te,Fr?Fr+" "+be:be);else{var Sn=Fr&&Fr.replace(be,"").trim();Sn?ft.setAttribute(te,Sn):ft.removeAttribute(te)}})}}function ti(){if(!(We||!Q.props.aria.expanded)){var X=bc(Q.props.triggerTarget||n);X.forEach(function(te){Q.props.interactive?te.setAttribute("aria-expanded",Q.state.isVisible&&te===Gt()?"true":"false"):te.removeAttribute("aria-expanded")})}}function io(){Dr().removeEventListener("mousemove",M),Zd=Zd.filter(function(X){return X!==M})}function ri(X){if(!(wo.isTouch&&(g||X.type==="mousedown"))){var te=X.composedPath&&X.composedPath()[0]||X.target;if(!(Q.props.interactive&&K0(oe,te))){if(bc(Q.props.triggerTarget||n).some(function(be){return K0(be,te)})){if(wo.isTouch||Q.state.isVisible&&Q.props.trigger.indexOf("click")>=0)return}else Cr("onClickOutside",[Q,X]);Q.props.hideOnClick===!0&&(Q.clearDelayTimeouts(),Q.hide(),p=!0,setTimeout(function(){p=!1}),Q.state.isMounted||Ei())}}}function oo(){g=!0}function vi(){g=!1}function Fn(){var X=Dr();X.addEventListener("mousedown",ri,!0),X.addEventListener("touchend",ri,ga),X.addEventListener("touchstart",vi,ga),X.addEventListener("touchmove",oo,ga)}function Ei(){var X=Dr();X.removeEventListener("mousedown",ri,!0),X.removeEventListener("touchend",ri,ga),X.removeEventListener("touchstart",vi,ga),X.removeEventListener("touchmove",oo,ga)}function bo(X,te){Do(X,function(){!Q.state.isVisible&&oe.parentNode&&oe.parentNode.contains(oe)&&te()})}function Ii(X,te){Do(X,te)}function Do(X,te){var be=Lt().box;function St(ft){ft.target===be&&(zf(be,"remove",St),te())}if(X===0)return te();zf(be,"remove",y),zf(be,"add",St),y=St}function ni(X,te,be){be===void 0&&(be=!1);var St=bc(Q.props.triggerTarget||n);St.forEach(function(ft){ft.addEventListener(X,te,be),O.push({node:ft,eventType:X,handler:te,options:be})})}function Ci(){Mt()&&(ni("touchstart",Bo,{passive:!0}),ni("touchend",Ye,{passive:!0})),bM(Q.props.trigger).forEach(function(X){if(X!=="manual")switch(ni(X,Bo),X){case"mouseenter":ni("mouseleave",Ye);break;case"focus":ni(HM?"focusout":"blur",bs);break;case"focusin":ni("focusout",bs);break}})}function so(){O.forEach(function(X){var te=X.node,be=X.eventType,St=X.handler,ft=X.options;te.removeEventListener(be,St,ft)}),O=[]}function Bo(X){var te,be=!1;if(!(!Q.state.isEnabled||ao(X)||p)){var St=((te=C)==null?void 0:te.type)==="focus";C=X,x=X.currentTarget,ti(),!Q.state.isVisible&&LM(X)&&Zd.forEach(function(ft){return ft(X)}),X.type==="click"&&(Q.props.trigger.indexOf("mouseenter")<0||d)&&Q.props.hideOnClick!==!1&&Q.state.isVisible?be=!0:Br(X),X.type==="click"&&(d=!be),be&&!St&&Vn(X)}}function $o(X){var te=X.target,be=Gt().contains(te)||oe.contains(te);if(!(X.type==="mousemove"&&be)){var St=Xt().concat(oe).map(function(ft){var Fr,Sn=ft._tippy,Vi=(Fr=Sn.popperInstance)==null?void 0:Fr.state;return Vi?{popperRect:ft.getBoundingClientRect(),popperState:Vi,props:t}:null}).filter(Boolean);UM(St,X)&&(io(),Vn(X))}}function Ye(X){var te=ao(X)||Q.props.trigger.indexOf("click")>=0&&d;if(!te){if(Q.props.interactive){Q.hideWithInteractivity(X);return}Vn(X)}}function bs(X){Q.props.trigger.indexOf("focusin")<0&&X.target!==Gt()||Q.props.interactive&&X.relatedTarget&&oe.contains(X.relatedTarget)||Vn(X)}function ao(X){return wo.isTouch?Mt()!==X.type.indexOf("touch")>=0:!1}function ya(){co();var X=Q.props,te=X.popperOptions,be=X.placement,St=X.offset,ft=X.getReferenceClientRect,Fr=X.moveTransition,Sn=At()?Zf(oe).arrow:null,Vi=ft?{getBoundingClientRect:ft,contextElement:ft.contextElement||Gt()}:n,Uc={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(lo){var uo=lo.state;if(At()){var Ra=Lt(),wa=Ra.box;["placement","reference-hidden","escaped"].forEach(function(Ms){Ms==="placement"?wa.setAttribute("data-placement",uo.placement):uo.attributes.popper["data-popper-"+Ms]?wa.setAttribute("data-"+Ms,""):wa.removeAttribute("data-"+Ms)}),uo.attributes.popper={}}}},yi=[{name:"offset",options:{offset:St}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!Fr}},Uc];At()&&Sn&&yi.push({name:"arrow",options:{element:Sn,padding:3}}),yi.push.apply(yi,(te==null?void 0:te.modifiers)||[]),Q.popperInstance=NM(Vi,oe,Object.assign({},te,{placement:be,onFirstUpdate:w,modifiers:yi}))}function co(){Q.popperInstance&&(Q.popperInstance.destroy(),Q.popperInstance=null)}function dn(){var X=Q.props.appendTo,te,be=Gt();Q.props.interactive&&X===U0||X==="parent"?te=be.parentNode:te=F0(X,[be]),te.contains(oe)||te.appendChild(oe),Q.state.isMounted=!0,ya()}function Xt(){return zd(oe.querySelectorAll("[data-tippy-root]"))}function Br(X){Q.clearDelayTimeouts(),X&&Cr("onTrigger",[Q,X]),Fn();var te=at(!0),be=Oe(),St=be[0],ft=be[1];wo.isTouch&&St==="hold"&&ft&&(te=ft),te?o=setTimeout(function(){Q.show()},te):Q.show()}function Vn(X){if(Q.clearDelayTimeouts(),Cr("onUntrigger",[Q,X]),!Q.state.isVisible){Ei();return}if(!(Q.props.trigger.indexOf("mouseenter")>=0&&Q.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(X.type)>=0&&d)){var te=at(!1);te?a=setTimeout(function(){Q.state.isVisible&&Q.hide()},te):l=requestAnimationFrame(function(){Q.hide()})}}function es(){Q.state.isEnabled=!0}function Ds(){Q.hide(),Q.state.isEnabled=!1}function Gn(){clearTimeout(o),clearTimeout(a),cancelAnimationFrame(l)}function Bs(X){if(!Q.state.isDestroyed){Cr("onBeforeUpdate",[Q,X]),so();var te=Q.props,be=J0(n,Object.assign({},te,j0(X),{ignoreAttributes:!0}));Q.props=be,Ci(),te.interactiveDebounce!==be.interactiveDebounce&&(io(),M=V0($o,be.interactiveDebounce)),te.triggerTarget&&!be.triggerTarget?bc(te.triggerTarget).forEach(function(St){St.removeAttribute("aria-expanded")}):be.triggerTarget&&n.removeAttribute("aria-expanded"),ti(),$t(),Te&&Te(te,be),Q.popperInstance&&(ya(),Xt().forEach(function(St){requestAnimationFrame(St._tippy.popperInstance.forceUpdate)})),Cr("onAfterUpdate",[Q,X])}}function ts(X){Q.setProps({content:X})}function rs(){var X=Q.state.isVisible,te=Q.state.isDestroyed,be=!Q.state.isEnabled,St=wo.isTouch&&!Q.props.touch,ft=Yf(Q.props.duration,0,ro.duration);if(!(X||te||be||St)&&!Gt().hasAttribute("disabled")&&(Cr("onShow",[Q],!1),Q.props.onShow(Q)!==!1)){if(Q.state.isVisible=!0,At()&&(oe.style.visibility="visible"),$t(),Fn(),Q.state.isMounted||(oe.style.transition="none"),At()){var Fr=Lt(),Sn=Fr.box,Vi=Fr.content;Jf([Sn,Vi],0)}w=function(){var yi;if(!(!Q.state.isVisible||v)){if(v=!0,oe.offsetHeight,oe.style.transition=Q.props.moveTransition,At()&&Q.props.animation){var Ta=Lt(),lo=Ta.box,uo=Ta.content;Jf([lo,uo],ft),H0([lo,uo],"visible")}ei(),ti(),G0($f,Q),(yi=Q.popperInstance)==null||yi.forceUpdate(),Cr("onMount",[Q]),Q.props.animation&&At()&&Ii(ft,function(){Q.state.isShown=!0,Cr("onShown",[Q])})}},dn()}}function xc(){var X=!Q.state.isVisible,te=Q.state.isDestroyed,be=!Q.state.isEnabled,St=Yf(Q.props.duration,1,ro.duration);if(!(X||te||be)&&(Cr("onHide",[Q],!1),Q.props.onHide(Q)!==!1)){if(Q.state.isVisible=!1,Q.state.isShown=!1,v=!1,d=!1,At()&&(oe.style.visibility="hidden"),io(),Ei(),$t(!0),At()){var ft=Lt(),Fr=ft.box,Sn=ft.content;Q.props.animation&&(Jf([Fr,Sn],St),H0([Fr,Sn],"hidden"))}ei(),ti(),Q.props.animation?At()&&bo(St,Q.unmount):Q.unmount()}}function _a(X){Dr().addEventListener("mousemove",M),G0(Zd,M),M(X)}function Sa(){Q.state.isVisible&&Q.hide(),!!Q.state.isMounted&&(co(),Xt().forEach(function(X){X._tippy.unmount()}),oe.parentNode&&oe.parentNode.removeChild(oe),$f=$f.filter(function(X){return X!==Q}),Q.state.isMounted=!1,Cr("onHidden",[Q]))}function Ur(){Q.state.isDestroyed||(Q.clearDelayTimeouts(),Q.unmount(),so(),delete n._tippy,Q.state.isDestroyed=!0,Cr("onDestroy",[Q]))}}function Dc(n,e){e===void 0&&(e={});var t=ro.plugins.concat(e.plugins||[]);GM();var o=Object.assign({},e,{plugins:t}),a=QM(n),l=a.reduce(function(d,p){var g=p&&ZM(p,o);return g&&d.push(g),d},[]);return Xd(n)?l[0]:l}Dc.defaultProps=ro;Dc.setDefaultProps=qM;Dc.currentInput=wo;Object.assign({},C0,{effect:function(e){var t=e.state,o={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(t.elements.popper.style,o.popper),t.styles=o,t.elements.arrow&&Object.assign(t.elements.arrow.style,o.arrow)}});Dc.setDefaultProps({render:Z0});class $M{constructor({editor:e,element:t,view:o,tippyOptions:a={},shouldShow:l}){this.preventHide=!1,this.shouldShow=({state:d,from:p,to:g})=>{const{doc:v,selection:C}=d,{empty:y}=C,w=!v.textBetween(p,g).length&&i0(d.selection);return!(y||w)},this.mousedownHandler=()=>{this.preventHide=!0},this.dragstartHandler=()=>{this.hide()},this.focusHandler=()=>{setTimeout(()=>this.update(this.editor.view))},this.blurHandler=({event:d})=>{var p;if(this.preventHide){this.preventHide=!1;return}(d==null?void 0:d.relatedTarget)&&((p=this.element.parentNode)===null||p===void 0?void 0:p.contains(d.relatedTarget))||this.hide()},this.editor=e,this.element=t,this.view=o,l&&(this.shouldShow=l),this.element.addEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.view.dom.addEventListener("dragstart",this.dragstartHandler),this.editor.on("focus",this.focusHandler),this.editor.on("blur",this.blurHandler),this.tippyOptions=a,this.element.remove(),this.element.style.visibility="visible"}createTooltip(){const{element:e}=this.editor.options,t=!!e.parentElement;this.tippy||!t||(this.tippy=Dc(e,ie({duration:0,getReferenceClientRect:null,content:this.element,interactive:!0,trigger:"manual",placement:"top",hideOnClick:"toggle"},this.tippyOptions)))}update(e,t){var o,a;const{state:l,composing:d}=e,{doc:p,selection:g}=l,v=t&&t.doc.eq(p)&&t.selection.eq(g);if(d||v)return;this.createTooltip();const{ranges:C}=g,y=Math.min(...C.map(M=>M.$from.pos)),w=Math.max(...C.map(M=>M.$to.pos));if(!((o=this.shouldShow)===null||o===void 0?void 0:o.call(this,{editor:this.editor,view:e,state:l,oldState:t,from:y,to:w}))){this.hide();return}(a=this.tippy)===null||a===void 0||a.setProps({getReferenceClientRect:()=>{if(_B(l.selection)){const M=e.nodeDOM(y);if(M)return M.getBoundingClientRect()}return g0(e,y,w)}}),this.show()}show(){var e;(e=this.tippy)===null||e===void 0||e.show()}hide(){var e;(e=this.tippy)===null||e===void 0||e.hide()}destroy(){var e;(e=this.tippy)===null||e===void 0||e.destroy(),this.element.removeEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.view.dom.removeEventListener("dragstart",this.dragstartHandler),this.editor.off("focus",this.focusHandler),this.editor.off("blur",this.blurHandler)}}const $0=n=>new nn({key:typeof n.pluginKey=="string"?new zn(n.pluginKey):n.pluginKey,view:e=>new $M(ie({view:e},n))});qr.create({name:"bubbleMenu",addOptions(){return{element:null,tippyOptions:{},pluginKey:"bubbleMenu",shouldShow:null}},addProseMirrorPlugins(){return this.options.element?[$0({pluginKey:this.options.pluginKey,editor:this.editor,element:this.options.element,tippyOptions:this.options.tippyOptions,shouldShow:this.options.shouldShow})]:[]}});class eL{constructor({editor:e,element:t,view:o,tippyOptions:a={},shouldShow:l}){this.preventHide=!1,this.shouldShow=({state:d})=>{const{selection:p}=d,{$anchor:g,empty:v}=p,C=g.depth===1,y=g.parent.isTextblock&&!g.parent.type.spec.code&&!g.parent.textContent;return!(!v||!C||!y)},this.mousedownHandler=()=>{this.preventHide=!0},this.focusHandler=()=>{setTimeout(()=>this.update(this.editor.view))},this.blurHandler=({event:d})=>{var p;if(this.preventHide){this.preventHide=!1;return}(d==null?void 0:d.relatedTarget)&&((p=this.element.parentNode)===null||p===void 0?void 0:p.contains(d.relatedTarget))||this.hide()},this.editor=e,this.element=t,this.view=o,l&&(this.shouldShow=l),this.element.addEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.editor.on("focus",this.focusHandler),this.editor.on("blur",this.blurHandler),this.tippyOptions=a,this.element.remove(),this.element.style.visibility="visible"}createTooltip(){const{element:e}=this.editor.options,t=!!e.parentElement;this.tippy||!t||(this.tippy=Dc(e,ie({duration:0,getReferenceClientRect:null,content:this.element,interactive:!0,trigger:"manual",placement:"right",hideOnClick:"toggle"},this.tippyOptions)))}update(e,t){var o,a;const{state:l}=e,{doc:d,selection:p}=l,{from:g,to:v}=p;if(t&&t.doc.eq(d)&&t.selection.eq(p))return;if(this.createTooltip(),!((o=this.shouldShow)===null||o===void 0?void 0:o.call(this,{editor:this.editor,view:e,state:l,oldState:t}))){this.hide();return}(a=this.tippy)===null||a===void 0||a.setProps({getReferenceClientRect:()=>g0(e,g,v)}),this.show()}show(){var e;(e=this.tippy)===null||e===void 0||e.show()}hide(){var e;(e=this.tippy)===null||e===void 0||e.hide()}destroy(){var e;(e=this.tippy)===null||e===void 0||e.destroy(),this.element.removeEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.editor.off("focus",this.focusHandler),this.editor.off("blur",this.blurHandler)}}const e_=n=>new nn({key:typeof n.pluginKey=="string"?new zn(n.pluginKey):n.pluginKey,view:e=>new eL(ie({view:e},n))});qr.create({name:"floatingMenu",addOptions(){return{element:null,tippyOptions:{},pluginKey:"floatingMenu",shouldShow:null}},addProseMirrorPlugins(){return this.options.element?[e_({pluginKey:this.options.pluginKey,editor:this.editor,element:this.options.element,tippyOptions:this.options.tippyOptions,shouldShow:this.options.shouldShow})]:[]}});Sl({name:"BubbleMenu",props:{pluginKey:{type:null,default:"bubbleMenu"},editor:{type:Object,required:!0},tippyOptions:{type:Object,default:()=>({})},shouldShow:{type:Function,default:null}},setup(n,{slots:e}){const t=ta(null);return fA(()=>{const{pluginKey:o,editor:a,tippyOptions:l,shouldShow:d}=n;a.registerPlugin($0({pluginKey:o,editor:a,element:t.value,tippyOptions:l,shouldShow:d}))}),gA(()=>{const{pluginKey:o,editor:a}=n;a.unregisterPlugin(o)}),()=>{var o;return ra("div",{ref:t},(o=e.default)===null||o===void 0?void 0:o.call(e))}}});function t_(n){return Hw((e,t)=>({get(){return e(),n},set(o){n=o,requestAnimationFrame(()=>{requestAnimationFrame(()=>{t()})})}}))}class tL extends CB{constructor(e={}){super(e);return this.vueRenderers=Tl(new Map),this.contentComponent=null,this.reactiveState=t_(this.view.state),this.reactiveExtensionStorage=t_(this.extensionStorage),this.on("transaction",()=>{this.reactiveState.value=this.view.state,this.reactiveExtensionStorage.value=this.extensionStorage}),Kw(this)}get state(){return this.reactiveState?this.reactiveState.value:this.view.state}get storage(){return this.reactiveExtensionStorage?this.reactiveExtensionStorage.value:super.storage}registerPlugin(e,t){super.registerPlugin(e,t),this.reactiveState.value=this.view.state}unregisterPlugin(e){super.unregisterPlugin(e),this.reactiveState.value=this.view.state}}const rL=Sl({name:"EditorContent",props:{editor:{default:null,type:Object}},setup(n){const e=ta(),t=jw();return Vw(()=>{const o=n.editor;o&&o.options.element&&e.value&&DI(()=>{if(!e.value||!o.options.element.firstChild)return;const a=Bi(e.value);e.value.append(...o.options.element.childNodes),o.contentComponent=t.ctx._,o.setOptions({element:a}),o.createNodeViews()})}),gA(()=>{const o=n.editor;if(!o||(o.isDestroyed||o.view.setProps({nodeViews:{}}),o.contentComponent=null,!o.options.element.firstChild))return;const a=document.createElement("div");a.append(...o.options.element.childNodes),o.setOptions({element:a})}),{rootEl:e}},render(){const n=[];return this.editor&&this.editor.vueRenderers.forEach(e=>{const t=ra(Gw,{to:e.teleportElement,key:e.id},ra(e.component,ie({ref:e.id},e.props)));n.push(t)}),ra("div",{ref:e=>{this.rootEl=e}},...n)}});Sl({name:"FloatingMenu",props:{pluginKey:{type:null,default:"floatingMenu"},editor:{type:Object,required:!0},tippyOptions:{type:Object,default:()=>({})},shouldShow:{type:Function,default:null}},setup(n,{slots:e}){const t=ta(null);return fA(()=>{const{pluginKey:o,editor:a,tippyOptions:l,shouldShow:d}=n;a.registerPlugin(e_({pluginKey:o,editor:a,element:t.value,tippyOptions:l,shouldShow:d}))}),gA(()=>{const{pluginKey:o,editor:a}=n;a.unregisterPlugin(o)}),()=>{var o;return ra("div",{ref:t},(o=e.default)===null||o===void 0?void 0:o.call(e))}}});Sl({props:{as:{type:String,default:"div"}},inject:["onDragStart","decorationClasses"],render(){var n,e;return ra(this.as,{class:this.decorationClasses.value,style:{whiteSpace:"normal"},"data-node-view-wrapper":"",onDragstart:this.onDragStart},(e=(n=this.$slots).default)===null||e===void 0?void 0:e.call(n))}});Sl({props:{as:{type:String,default:"div"}},render(){return ra(this.as,{style:{whiteSpace:"pre-wrap"},"data-node-view-content":""})}});const nL=/^\s*>\s$/,iL=yn.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:n}){return["blockquote",an(this.options.HTMLAttributes,n),0]},addCommands(){return{setBlockquote:()=>({commands:n})=>n.wrapIn("blockquote"),toggleBlockquote:()=>({commands:n})=>n.toggleWrap("blockquote"),unsetBlockquote:()=>({commands:n})=>n.lift("blockquote")}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[Kd({find:nL,type:this.type})]}}),oL=/(?:^|\s)((?:\*\*)((?:[^*]+))(?:\*\*))$/,sL=/(?:^|\s)((?:\*\*)((?:[^*]+))(?:\*\*))/g,aL=/(?:^|\s)((?:__)((?:[^__]+))(?:__))$/,cL=/(?:^|\s)((?:__)((?:[^__]+))(?:__))/g,lL=Ss.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:n=>n.style.fontWeight!=="normal"&&null},{style:"font-weight",getAttrs:n=>/^(bold(er)?|[5-9]\d{2,})$/.test(n)&&null}]},renderHTML({HTMLAttributes:n}){return["strong",an(this.options.HTMLAttributes,n),0]},addCommands(){return{setBold:()=>({commands:n})=>n.setMark("bold"),toggleBold:()=>({commands:n})=>n.toggleMark("bold"),unsetBold:()=>({commands:n})=>n.unsetMark("bold")}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold()}},addInputRules(){return[pa({find:oL,type:this.type}),pa({find:aL,type:this.type})]},addPasteRules(){return[Aa({find:sL,type:this.type}),Aa({find:cL,type:this.type})]}}),uL=/^\s*([-+*])\s$/,dL=yn.create({name:"bulletList",addOptions(){return{HTMLAttributes:{}}},group:"block list",content:"listItem+",parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:n}){return["ul",an(this.options.HTMLAttributes,n),0]},addCommands(){return{toggleBulletList:()=>({commands:n})=>n.toggleList("bulletList","listItem")}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){return[Kd({find:uL,type:this.type})]}}),hL=/(?:^|\s)((?:`)((?:[^`]+))(?:`))$/,pL=/(?:^|\s)((?:`)((?:[^`]+))(?:`))/g,AL=Ss.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:n}){return["code",an(this.options.HTMLAttributes,n),0]},addCommands(){return{setCode:()=>({commands:n})=>n.setMark("code"),toggleCode:()=>({commands:n})=>n.toggleMark("code"),unsetCode:()=>({commands:n})=>n.unsetMark("code")}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[pa({find:hL,type:this.type})]},addPasteRules(){return[Aa({find:pL,type:this.type})]}}),fL=/^```(?<language>[a-z]*)?[\s\n]$/,gL=/^~~~(?<language>[a-z]*)?[\s\n]$/,mL=yn.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:null,parseHTML:n=>{var e;const{languageClassPrefix:t}=this.options,l=[...((e=n.firstElementChild)===null||e===void 0?void 0:e.classList)||[]].filter(d=>d.startsWith(t)).map(d=>d.replace(t,""))[0];return l||null},renderHTML:n=>n.language?{class:this.options.languageClassPrefix+n.language}:null}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({HTMLAttributes:n}){return["pre",this.options.HTMLAttributes,["code",n,0]]},addCommands(){return{setCodeBlock:n=>({commands:e})=>e.setNode("codeBlock",n),toggleCodeBlock:n=>({commands:e})=>e.toggleNode("codeBlock","paragraph",n)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:n,$anchor:e}=this.editor.state.selection,t=e.pos===1;return!n||e.parent.type.name!==this.name?!1:t||!e.parent.textContent.length?this.editor.commands.clearNodes():!1}}},addInputRules(){return[Uf({find:fL,type:this.type,getAttributes:({groups:n})=>n}),Uf({find:gL,type:this.type,getAttributes:({groups:n})=>n})]},addProseMirrorPlugins(){return[new nn({key:new zn("codeBlockVSCodeHandler"),props:{handlePaste:(n,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const t=e.clipboardData.getData("text/plain"),o=e.clipboardData.getData("vscode-editor-data"),a=o?JSON.parse(o):void 0,l=a==null?void 0:a.mode;if(!t||!l)return!1;const{tr:d}=n.state;return d.replaceSelectionWith(this.type.create({language:l})),d.setSelection(Rt.near(d.doc.resolve(Math.max(0,d.selection.from-2)))),d.insertText(t.replace(/\r\n?/g,`
`)),d.setMeta("paste",!0),n.dispatch(d),!0}}})]}}),vL=yn.create({name:"doc",topNode:!0,content:"block+"});function EL(n){return n===void 0&&(n={}),new nn({view:function(t){return new No(t,n)}})}var No=function(e,t){var o=this;this.editorView=e,this.width=t.width||1,this.color=t.color||"black",this.class=t.class,this.cursorPos=null,this.element=null,this.timeout=null,this.handlers=["dragover","dragend","drop","dragleave"].map(function(a){var l=function(d){return o[a](d)};return e.dom.addEventListener(a,l),{name:a,handler:l}})};No.prototype.destroy=function(){var e=this;this.handlers.forEach(function(t){var o=t.name,a=t.handler;return e.editorView.dom.removeEventListener(o,a)})};No.prototype.update=function(e,t){this.cursorPos!=null&&t.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())};No.prototype.setCursor=function(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())};No.prototype.updateOverlay=function(){var e=this.editorView.state.doc.resolve(this.cursorPos),t;if(!e.parent.inlineContent){var o=e.nodeBefore,a=e.nodeAfter;if(o||a){var l=this.editorView.nodeDOM(this.cursorPos-(o?o.nodeSize:0)).getBoundingClientRect(),d=o?l.bottom:l.top;o&&a&&(d=(d+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),t={left:l.left,right:l.right,top:d-this.width/2,bottom:d+this.width/2}}}if(!t){var p=this.editorView.coordsAtPos(this.cursorPos);t={left:p.left-this.width/2,right:p.left+this.width/2,top:p.top,bottom:p.bottom}}var g=this.editorView.dom.offsetParent;this.element||(this.element=g.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none; background-color: "+this.color);var v,C;if(!g||g==document.body&&getComputedStyle(g).position=="static")v=-pageXOffset,C=-pageYOffset;else{var y=g.getBoundingClientRect();v=y.left-g.scrollLeft,C=y.top-g.scrollTop}this.element.style.left=t.left-v+"px",this.element.style.top=t.top-C+"px",this.element.style.width=t.right-t.left+"px",this.element.style.height=t.bottom-t.top+"px"};No.prototype.scheduleRemoval=function(e){var t=this;clearTimeout(this.timeout),this.timeout=setTimeout(function(){return t.setCursor(null)},e)};No.prototype.dragover=function(e){if(!!this.editorView.editable){var t=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),o=t&&t.inside>=0&&this.editorView.state.doc.nodeAt(t.inside),a=o&&o.type.spec.disableDropCursor,l=typeof a=="function"?a(this.editorView,t):a;if(t&&!l){var d=t.pos;if(this.editorView.dragging&&this.editorView.dragging.slice&&(d=vC(this.editorView.state.doc,d,this.editorView.dragging.slice),d==null))return this.setCursor(null);this.setCursor(d),this.scheduleRemoval(5e3)}}};No.prototype.dragend=function(){this.scheduleRemoval(20)};No.prototype.drop=function(){this.scheduleRemoval(20)};No.prototype.dragleave=function(e){(e.target==this.editorView.dom||!this.editorView.dom.contains(e.relatedTarget))&&this.setCursor(null)};const IL=qr.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:null}},addProseMirrorPlugins(){return[EL(this.options)]}});var no=function(n){function e(t){n.call(this,t,t)}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.map=function(o,a){var l=o.resolve(a.map(this.head));return e.valid(l)?new e(l):n.near(l)},e.prototype.content=function(){return ye.empty},e.prototype.eq=function(o){return o instanceof e&&o.head==this.head},e.prototype.toJSON=function(){return{type:"gapcursor",pos:this.head}},e.fromJSON=function(o,a){if(typeof a.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new e(o.resolve(a.pos))},e.prototype.getBookmark=function(){return new $d(this.anchor)},e.valid=function(o){var a=o.parent;if(a.isTextblock||!CL(o)||!yL(o))return!1;var l=a.type.spec.allowGapCursor;if(l!=null)return l;var d=a.contentMatchAt(o.index()).defaultType;return d&&d.isTextblock},e.findFrom=function(o,a,l){e:for(;;){if(!l&&e.valid(o))return o;for(var d=o.pos,p=null,g=o.depth;;g--){var v=o.node(g);if(a>0?o.indexAfter(g)<v.childCount:o.index(g)>0){p=v.child(a>0?o.indexAfter(g):o.index(g)-1);break}else if(g==0)return null;d+=a;var C=o.doc.resolve(d);if(e.valid(C))return C}for(;;){var y=a>0?p.firstChild:p.lastChild;if(!y){if(p.isAtom&&!p.isText&&!$e.isSelectable(p)){o=o.doc.resolve(d+p.nodeSize*a),l=!1;continue e}break}p=y,d+=a;var w=o.doc.resolve(d);if(e.valid(w))return w}return null}},e}(rt);no.prototype.visible=!1;rt.jsonID("gapcursor",no);var $d=function(e){this.pos=e};$d.prototype.map=function(e){return new $d(e.map(this.pos))};$d.prototype.resolve=function(e){var t=e.resolve(this.pos);return no.valid(t)?new no(t):rt.near(t)};function CL(n){for(var e=n.depth;e>=0;e--){var t=n.index(e);if(t!=0)for(var o=n.node(e).child(t-1);;o=o.lastChild){if(o.childCount==0&&!o.inlineContent||o.isAtom||o.type.spec.isolating)return!0;if(o.inlineContent)return!1}}return!0}function yL(n){for(var e=n.depth;e>=0;e--){var t=n.indexAfter(e),o=n.node(e);if(t!=o.childCount)for(var a=o.child(t);;a=a.firstChild){if(a.childCount==0&&!a.inlineContent||a.isAtom||a.type.spec.isolating)return!0;if(a.inlineContent)return!1}}return!0}var _L=function(){return new nn({props:{decorations:RL,createSelectionBetween:function(e,t,o){if(t.pos==o.pos&&no.valid(o))return new no(o)},handleClick:TL,handleKeyDown:SL}})},SL=$y({ArrowLeft:eh("horiz",-1),ArrowRight:eh("horiz",1),ArrowUp:eh("vert",-1),ArrowDown:eh("vert",1)});function eh(n,e){var t=n=="vert"?e>0?"down":"up":e>0?"right":"left";return function(o,a,l){var d=o.selection,p=e>0?d.$to:d.$from,g=d.empty;if(d instanceof Rt){if(!l.endOfTextblock(t)||p.depth==0)return!1;g=!1,p=o.doc.resolve(e>0?p.after():p.before())}var v=no.findFrom(p,e,g);return v?(a&&a(o.tr.setSelection(new no(v))),!0):!1}}function TL(n,e,t){if(!n.editable)return!1;var o=n.state.doc.resolve(e);if(!no.valid(o))return!1;var a=n.posAtCoords({left:t.clientX,top:t.clientY}),l=a.inside;return l>-1&&$e.isSelectable(n.state.doc.nodeAt(l))?!1:(n.dispatch(n.state.tr.setSelection(new no(o))),!0)}function RL(n){if(!(n.selection instanceof no))return null;var e=document.createElement("div");return e.className="ProseMirror-gapcursor",xt.create(n.doc,[Or.widget(n.selection.head,e,{key:"gapcursor"})])}const wL=qr.create({name:"gapCursor",addProseMirrorPlugins(){return[_L()]},extendNodeSchema(n){var e;const t={name:n.name,options:n.options,storage:n.storage};return{allowGapCursor:(e=it(Ne(n,"allowGapCursor",t)))!==null&&e!==void 0?e:null}}}),NL=yn.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:n}){return["br",an(this.options.HTMLAttributes,n)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:n,chain:e,state:t,editor:o})=>n.first([()=>n.exitCode(),()=>n.command(()=>{const{selection:a,storedMarks:l}=t;if(a.$from.parent.type.spec.isolating)return!1;const{keepMarks:d}=this.options,{splittableMarks:p}=o.extensionManager,g=l||a.$to.parentOffset&&a.$from.marks();return e().insertContent({type:this.name}).command(({tr:v,dispatch:C})=>{if(C&&g&&d){const y=g.filter(w=>p.includes(w.type.name));v.ensureMarks(y)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),kL=yn.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(n=>({tag:`h${n}`,attrs:{level:n}}))},renderHTML({node:n,HTMLAttributes:e}){return[`h${this.options.levels.includes(n.attrs.level)?n.attrs.level:this.options.levels[0]}`,an(this.options.HTMLAttributes,e),0]},addCommands(){return{setHeading:n=>({commands:e})=>this.options.levels.includes(n.level)?e.setNode("heading",n):!1,toggleHeading:n=>({commands:e})=>this.options.levels.includes(n.level)?e.toggleNode("heading","paragraph",n):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((n,e)=>On(ie({},n),{[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(n=>Uf({find:new RegExp(`^(#{1,${n}})\\s$`),type:this.type,getAttributes:{level:n}}))}});var th=200,cn=function(){};cn.prototype.append=function(e){return e.length?(e=cn.from(e),!this.length&&e||e.length<th&&this.leafAppend(e)||this.length<th&&e.leafPrepend(this)||this.appendInner(e)):this};cn.prototype.prepend=function(e){return e.length?cn.from(e).append(this):this};cn.prototype.appendInner=function(e){return new OL(this,e)};cn.prototype.slice=function(e,t){return e===void 0&&(e=0),t===void 0&&(t=this.length),e>=t?cn.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,t))};cn.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};cn.prototype.forEach=function(e,t,o){t===void 0&&(t=0),o===void 0&&(o=this.length),t<=o?this.forEachInner(e,t,o,0):this.forEachInvertedInner(e,t,o,0)};cn.prototype.map=function(e,t,o){t===void 0&&(t=0),o===void 0&&(o=this.length);var a=[];return this.forEach(function(l,d){return a.push(e(l,d))},t,o),a};cn.from=function(e){return e instanceof cn?e:e&&e.length?new r_(e):cn.empty};var r_=function(n){function e(o){n.call(this),this.values=o}n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e;var t={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(a,l){return a==0&&l==this.length?this:new e(this.values.slice(a,l))},e.prototype.getInner=function(a){return this.values[a]},e.prototype.forEachInner=function(a,l,d,p){for(var g=l;g<d;g++)if(a(this.values[g],p+g)===!1)return!1},e.prototype.forEachInvertedInner=function(a,l,d,p){for(var g=l-1;g>=d;g--)if(a(this.values[g],p+g)===!1)return!1},e.prototype.leafAppend=function(a){if(this.length+a.length<=th)return new e(this.values.concat(a.flatten()))},e.prototype.leafPrepend=function(a){if(this.length+a.length<=th)return new e(a.flatten().concat(this.values))},t.length.get=function(){return this.values.length},t.depth.get=function(){return 0},Object.defineProperties(e.prototype,t),e}(cn);cn.empty=new r_([]);var OL=function(n){function e(t,o){n.call(this),this.left=t,this.right=o,this.length=t.length+o.length,this.depth=Math.max(t.depth,o.depth)+1}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(o){return o<this.left.length?this.left.get(o):this.right.get(o-this.left.length)},e.prototype.forEachInner=function(o,a,l,d){var p=this.left.length;if(a<p&&this.left.forEachInner(o,a,Math.min(l,p),d)===!1||l>p&&this.right.forEachInner(o,Math.max(a-p,0),Math.min(this.length,l)-p,d+p)===!1)return!1},e.prototype.forEachInvertedInner=function(o,a,l,d){var p=this.left.length;if(a>p&&this.right.forEachInvertedInner(o,a-p,Math.max(l,p)-p,d+p)===!1||l<p&&this.left.forEachInvertedInner(o,Math.min(a,p),l,d)===!1)return!1},e.prototype.sliceInner=function(o,a){if(o==0&&a==this.length)return this;var l=this.left.length;return a<=l?this.left.slice(o,a):o>=l?this.right.slice(o-l,a-l):this.left.slice(o,l).append(this.right.slice(0,a-l))},e.prototype.leafAppend=function(o){var a=this.right.leafAppend(o);if(a)return new e(this.left,a)},e.prototype.leafPrepend=function(o){var a=this.left.leafPrepend(o);if(a)return new e(a,this.right)},e.prototype.appendInner=function(o){return this.left.depth>=Math.max(this.right.depth,o.depth)+1?new e(this.left,new e(this.right,o)):new e(this,o)},e}(cn),n_=cn,bL=500,ln=function(e,t){this.items=e,this.eventCount=t};ln.prototype.popEvent=function(e,t){var o=this;if(this.eventCount==0)return null;for(var a=this.items.length;;a--){var l=this.items.get(a-1);if(l.selection){--a;break}}var d,p;t&&(d=this.remapping(a,this.items.length),p=d.maps.length);var g=e.tr,v,C,y=[],w=[];return this.items.forEach(function(O,M){if(!O.step){d||(d=o.remapping(a,M+1),p=d.maps.length),p--,w.push(O);return}if(d){w.push(new ko(O.map));var x=O.step.map(d.slice(p)),G;x&&g.maybeStep(x).doc&&(G=g.mapping.maps[g.mapping.maps.length-1],y.push(new ko(G,null,null,y.length+w.length))),p--,G&&d.appendMap(G,p)}else g.maybeStep(O.step);if(O.selection)return v=d?O.selection.map(d.slice(p)):O.selection,C=new ln(o.items.slice(0,a).append(w.reverse().concat(y)),o.eventCount-1),!1},this.items.length,0),{remaining:C,transform:g,selection:v}};ln.prototype.addTransform=function(e,t,o,a){for(var l=[],d=this.eventCount,p=this.items,g=!a&&p.length?p.get(p.length-1):null,v=0;v<e.steps.length;v++){var C=e.steps[v].invert(e.docs[v]),y=new ko(e.mapping.maps[v],C,t),w=void 0;(w=g&&g.merge(y))&&(y=w,v?l.pop():p=p.slice(0,p.length-1)),l.push(y),t&&(d++,t=null),a||(g=y)}var O=d-o.depth;return O>BL&&(p=DL(p,O),d-=O),new ln(p.append(l),d)};ln.prototype.remapping=function(e,t){var o=new En;return this.items.forEach(function(a,l){var d=a.mirrorOffset!=null&&l-a.mirrorOffset>=e?o.maps.length-a.mirrorOffset:null;o.appendMap(a.map,d)},e,t),o};ln.prototype.addMaps=function(e){return this.eventCount==0?this:new ln(this.items.append(e.map(function(t){return new ko(t)})),this.eventCount)};ln.prototype.rebased=function(e,t){if(!this.eventCount)return this;var o=[],a=Math.max(0,this.items.length-t),l=e.mapping,d=e.steps.length,p=this.eventCount;this.items.forEach(function(O){O.selection&&p--},a);var g=t;this.items.forEach(function(O){var M=l.getMirror(--g);if(M!=null){d=Math.min(d,M);var x=l.maps[M];if(O.step){var G=e.steps[M].invert(e.docs[M]),K=O.selection&&O.selection.map(l.slice(g+1,M));K&&p++,o.push(new ko(x,G,K))}else o.push(new ko(x))}},a);for(var v=[],C=t;C<d;C++)v.push(new ko(l.maps[C]));var y=this.items.slice(0,a).append(v).append(o),w=new ln(y,p);return w.emptyItemCount()>bL&&(w=w.compress(this.items.length-o.length)),w};ln.prototype.emptyItemCount=function(){var e=0;return this.items.forEach(function(t){t.step||e++}),e};ln.prototype.compress=function(e){e===void 0&&(e=this.items.length);var t=this.remapping(0,e),o=t.maps.length,a=[],l=0;return this.items.forEach(function(d,p){if(p>=e)a.push(d),d.selection&&l++;else if(d.step){var g=d.step.map(t.slice(o)),v=g&&g.getMap();if(o--,v&&t.appendMap(v,o),g){var C=d.selection&&d.selection.map(t.slice(o));C&&l++;var y=new ko(v.invert(),g,C),w,O=a.length-1;(w=a.length&&a[O].merge(y))?a[O]=w:a.push(y)}}else d.map&&o--},this.items.length,0),new ln(n_.from(a.reverse()),l)};ln.empty=new ln(n_.empty,0);function DL(n,e){var t;return n.forEach(function(o,a){if(o.selection&&e--==0)return t=a,!1}),n.slice(t)}var ko=function(e,t,o,a){this.map=e,this.step=t,this.selection=o,this.mirrorOffset=a};ko.prototype.merge=function(e){if(this.step&&e.step&&!e.selection){var t=e.step.merge(this.step);if(t)return new ko(t.getMap().invert(),t,this.selection)}};var Rs=function(e,t,o,a){this.done=e,this.undone=t,this.prevRanges=o,this.prevTime=a},BL=20;function ML(n,e,t,o){var a=t.getMeta(ws),l;if(a)return a.historyState;t.getMeta(PL)&&(n=new Rs(n.done,n.undone,null,0));var d=t.getMeta("appendedTransaction");if(t.steps.length==0)return n;if(d&&d.getMeta(ws))return d.getMeta(ws).redo?new Rs(n.done.addTransform(t,null,o,rh(e)),n.undone,i_(t.mapping.maps[t.steps.length-1]),n.prevTime):new Rs(n.done,n.undone.addTransform(t,null,o,rh(e)),null,n.prevTime);if(t.getMeta("addToHistory")!==!1&&!(d&&d.getMeta("addToHistory")===!1)){var p=n.prevTime==0||!d&&(n.prevTime<(t.time||0)-o.newGroupDelay||!LL(t,n.prevRanges)),g=d?eg(n.prevRanges,t.mapping):i_(t.mapping.maps[t.steps.length-1]);return new Rs(n.done.addTransform(t,p?e.selection.getBookmark():null,o,rh(e)),ln.empty,g,t.time)}else return(l=t.getMeta("rebased"))?new Rs(n.done.rebased(t,l),n.undone.rebased(t,l),eg(n.prevRanges,t.mapping),n.prevTime):new Rs(n.done.addMaps(t.mapping.maps),n.undone.addMaps(t.mapping.maps),eg(n.prevRanges,t.mapping),n.prevTime)}function LL(n,e){if(!e)return!1;if(!n.docChanged)return!0;var t=!1;return n.mapping.maps[0].forEach(function(o,a){for(var l=0;l<e.length;l+=2)o<=e[l+1]&&a>=e[l]&&(t=!0)}),t}function i_(n){var e=[];return n.forEach(function(t,o,a,l){return e.push(a,l)}),e}function eg(n,e){if(!n)return null;for(var t=[],o=0;o<n.length;o+=2){var a=e.map(n[o],1),l=e.map(n[o+1],-1);a<=l&&t.push(a,l)}return t}function o_(n,e,t,o){var a=rh(e),l=ws.get(e).spec.config,d=(o?n.undone:n.done).popEvent(e,a);if(!!d){var p=d.selection.resolve(d.transform.doc),g=(o?n.done:n.undone).addTransform(d.transform,e.selection.getBookmark(),l,a),v=new Rs(o?g:d.remaining,o?d.remaining:g,null,0);t(d.transform.setSelection(p).setMeta(ws,{redo:o,historyState:v}).scrollIntoView())}}var tg=!1,s_=null;function rh(n){var e=n.plugins;if(s_!=e){tg=!1,s_=e;for(var t=0;t<e.length;t++)if(e[t].spec.historyPreserveItems){tg=!0;break}}return tg}var ws=new zn("history"),PL=new zn("closeHistory");function QL(n){return n={depth:n&&n.depth||100,newGroupDelay:n&&n.newGroupDelay||500},new nn({key:ws,state:{init:function(){return new Rs(ln.empty,ln.empty,null,0)},apply:function(t,o,a){return ML(o,a,t,n)}},config:n,props:{handleDOMEvents:{beforeinput:function(t,o){var a=o.inputType=="historyUndo"?a_(t.state,t.dispatch):o.inputType=="historyRedo"?c_(t.state,t.dispatch):!1;return a&&o.preventDefault(),a}}}})}function a_(n,e){var t=ws.getState(n);return!t||t.done.eventCount==0?!1:(e&&o_(t,n,e,!1),!0)}function c_(n,e){var t=ws.getState(n);return!t||t.undone.eventCount==0?!1:(e&&o_(t,n,e,!0),!0)}const xL=qr.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:n,dispatch:e})=>a_(n,e),redo:()=>({state:n,dispatch:e})=>c_(n,e)}},addProseMirrorPlugins(){return[QL(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Mod-y":()=>this.editor.commands.redo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-\u044F":()=>this.editor.commands.undo(),"Shift-Mod-\u044F":()=>this.editor.commands.redo()}}}),UL=yn.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:n}){return["hr",an(this.options.HTMLAttributes,n)]},addCommands(){return{setHorizontalRule:()=>({chain:n})=>n().insertContent({type:this.name}).command(({tr:e,dispatch:t})=>{var o;if(t){const{parent:a,pos:l}=e.selection.$from,d=l+1;if(e.doc.nodeAt(d))e.setSelection(Rt.create(e.doc,d));else{const g=(o=a.type.contentMatch.defaultType)===null||o===void 0?void 0:o.create();g&&(e.insert(d,g),e.setSelection(Rt.create(e.doc,d)))}e.scrollIntoView()}return!0}).run()}},addInputRules(){return[yB({find:/^(?:---|—-|___\s|\*\*\*\s)$/,type:this.type})]}}),FL=/(?:^|\s)((?:\*)((?:[^*]+))(?:\*))$/,VL=/(?:^|\s)((?:\*)((?:[^*]+))(?:\*))/g,GL=/(?:^|\s)((?:_)((?:[^_]+))(?:_))$/,jL=/(?:^|\s)((?:_)((?:[^_]+))(?:_))/g,HL=Ss.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:n=>n.style.fontStyle!=="normal"&&null},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:n}){return["em",an(this.options.HTMLAttributes,n),0]},addCommands(){return{setItalic:()=>({commands:n})=>n.setMark("italic"),toggleItalic:()=>({commands:n})=>n.toggleMark("italic"),unsetItalic:()=>({commands:n})=>n.unsetMark("italic")}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[pa({find:FL,type:this.type}),pa({find:GL,type:this.type})]},addPasteRules(){return[Aa({find:VL,type:this.type}),Aa({find:jL,type:this.type})]}}),KL=yn.create({name:"listItem",addOptions(){return{HTMLAttributes:{}}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:n}){return["li",an(this.options.HTMLAttributes,n),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem("listItem"),Tab:()=>this.editor.commands.sinkListItem("listItem"),"Shift-Tab":()=>this.editor.commands.liftListItem("listItem")}}}),WL=/^(\d+)\.\s$/,YL=yn.create({name:"orderedList",addOptions(){return{HTMLAttributes:{}}},group:"block list",content:"listItem+",addAttributes(){return{start:{default:1,parseHTML:n=>n.hasAttribute("start")?parseInt(n.getAttribute("start")||"",10):1}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:n}){const o=n,{start:e}=o,t=bI(o,["start"]);return e===1?["ol",an(this.options.HTMLAttributes,t),0]:["ol",an(this.options.HTMLAttributes,n),0]},addCommands(){return{toggleOrderedList:()=>({commands:n})=>n.toggleList("orderedList","listItem")}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){return[Kd({find:WL,type:this.type,getAttributes:n=>({start:+n[1]}),joinPredicate:(n,e)=>e.childCount+e.attrs.start===+n[1]})]}}),qL=yn.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:n}){return["p",an(this.options.HTMLAttributes,n),0]},addCommands(){return{setParagraph:()=>({commands:n})=>n.setNode("paragraph")}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),JL=/(?:^|\s)((?:~~)((?:[^~]+))(?:~~))$/,zL=/(?:^|\s)((?:~~)((?:[^~]+))(?:~~))/g,XL=Ss.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:n=>n.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:n}){return["s",an(this.options.HTMLAttributes,n),0]},addCommands(){return{setStrike:()=>({commands:n})=>n.setMark("strike"),toggleStrike:()=>({commands:n})=>n.toggleMark("strike"),unsetStrike:()=>({commands:n})=>n.unsetMark("strike")}},addKeyboardShortcuts(){return{"Mod-Shift-x":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[pa({find:JL,type:this.type})]},addPasteRules(){return[Aa({find:zL,type:this.type})]}}),ZL=yn.create({name:"text",group:"inline"}),$L=qr.create({name:"starterKit",addExtensions(){var n,e,t,o,a,l,d,p,g,v,C,y,w,O,M,x,G,K;const F=[];return this.options.blockquote!==!1&&F.push(iL.configure((n=this.options)===null||n===void 0?void 0:n.blockquote)),this.options.bold!==!1&&F.push(lL.configure((e=this.options)===null||e===void 0?void 0:e.bold)),this.options.bulletList!==!1&&F.push(dL.configure((t=this.options)===null||t===void 0?void 0:t.bulletList)),this.options.code!==!1&&F.push(AL.configure((o=this.options)===null||o===void 0?void 0:o.code)),this.options.codeBlock!==!1&&F.push(mL.configure((a=this.options)===null||a===void 0?void 0:a.codeBlock)),this.options.document!==!1&&F.push(vL.configure((l=this.options)===null||l===void 0?void 0:l.document)),this.options.dropcursor!==!1&&F.push(IL.configure((d=this.options)===null||d===void 0?void 0:d.dropcursor)),this.options.gapcursor!==!1&&F.push(wL.configure((p=this.options)===null||p===void 0?void 0:p.gapcursor)),this.options.hardBreak!==!1&&F.push(NL.configure((g=this.options)===null||g===void 0?void 0:g.hardBreak)),this.options.heading!==!1&&F.push(kL.configure((v=this.options)===null||v===void 0?void 0:v.heading)),this.options.history!==!1&&F.push(xL.configure((C=this.options)===null||C===void 0?void 0:C.history)),this.options.horizontalRule!==!1&&F.push(UL.configure((y=this.options)===null||y===void 0?void 0:y.horizontalRule)),this.options.italic!==!1&&F.push(HL.configure((w=this.options)===null||w===void 0?void 0:w.italic)),this.options.listItem!==!1&&F.push(KL.configure((O=this.options)===null||O===void 0?void 0:O.listItem)),this.options.orderedList!==!1&&F.push(YL.configure((M=this.options)===null||M===void 0?void 0:M.orderedList)),this.options.paragraph!==!1&&F.push(qL.configure((x=this.options)===null||x===void 0?void 0:x.paragraph)),this.options.strike!==!1&&F.push(XL.configure((G=this.options)===null||G===void 0?void 0:G.strike)),this.options.text!==!1&&F.push(ZL.configure((K=this.options)===null||K===void 0?void 0:K.text)),F}}),eP=(n,e)=>{let t=0,o=0;for(;t<n.length&&t<e.length&&n[t]===e[t];)t++;if(t!==n.length||t!==e.length)for(;o+t<n.length&&o+t<e.length&&n[n.length-o-1]===e[e.length-o-1];)o++;return{index:t,remove:n.length-t-o,insert:e.slice(t,e.length-o)}},tP=eP,pr=new zn("y-sync"),ma=new zn("y-undo"),nh=new zn("yjs-cursor"),ih=(n,e)=>e===void 0?!n.deleted:e.sv.has(n.id.client)&&e.sv.get(n.id.client)>n.id.clock&&!lN(e.ds,n.id),rP=[{light:"#ecd44433",dark:"#ecd444"}],nP=(n,e,t)=>{if(!n.has(t)){if(n.size<e.length){const o=mN();n.forEach(a=>o.add(a)),e=e.filter(a=>!o.has(a))}n.set(t,AN(e))}return n.get(t)},iP=(n,{colors:e=rP,colorMapping:t=new Map,permanentUserData:o=null}={})=>{let a=!1;const l=new nn({props:{editable:d=>{const p=pr.getState(d);return p.snapshot==null&&p.prevSnapshot==null}},key:pr,state:{init:(d,p)=>({type:n,doc:n.doc,binding:null,snapshot:null,prevSnapshot:null,isChangeOrigin:!1,colors:e,colorMapping:t,permanentUserData:o}),apply:(d,p)=>{const g=d.getMeta(pr);if(g!==void 0){p=Object.assign({},p);for(const v in g)p[v]=g[v]}return p.isChangeOrigin=g!==void 0&&!!g.isChangeOrigin,p.binding!==null&&g!==void 0&&(g.snapshot!=null||g.prevSnapshot!=null)&&setTimeout(()=>{g.restore==null?p.binding._renderSnapshot(g.snapshot,g.prevSnapshot,p):(p.binding._renderSnapshot(g.snapshot,g.snapshot,p),delete p.restore,delete p.snapshot,delete p.prevSnapshot,p.binding._prosemirrorChanged(p.binding.prosemirrorView.state.doc))},0),p}},view:d=>{const p=new sP(n,d);return setTimeout(()=>{p._forceRerender(),d.dispatch(d.state.tr.setMeta(pr,{binding:p}))},0),{update:()=>{const g=l.getState(d.state);g.snapshot==null&&g.prevSnapshot==null&&(a||d.state.doc.content.findDiffStart(d.state.doc.type.createAndFill().content)!==null)&&(a=!0,p._prosemirrorChanged(d.state.doc))},destroy:()=>{p.destroy()}}}});return l},oP=(n,e,t)=>{if(e!==null&&e.anchor!==null&&e.head!==null){const o=nu(t.doc,t.type,e.anchor,t.mapping),a=nu(t.doc,t.type,e.head,t.mapping);o!==null&&a!==null&&(n=n.setSelection(Rt.create(n.doc,o,a)))}},rg=(n,e)=>({anchor:ch(e.selection.anchor,n.type,n.mapping),head:ch(e.selection.head,n.type,n.mapping)});class sP{constructor(e,t){this.type=e,this.prosemirrorView=t,this.mux=oN(),this.mapping=new Map,this._observeFunction=this._typeChanged.bind(this),this.doc=e.doc,this.beforeTransactionSelection=null,this.beforeAllTransactions=()=>{this.beforeTransactionSelection===null&&(this.beforeTransactionSelection=rg(this,t.state))},this.afterAllTransactions=()=>{this.beforeTransactionSelection=null},this.doc.on("beforeAllTransactions",this.beforeAllTransactions),this.doc.on("afterAllTransactions",this.afterAllTransactions),e.observeDeep(this._observeFunction),this._domSelectionInView=null}_isLocalCursorInView(){return this.prosemirrorView.hasFocus()?(sN&&this._domSelectionInView===null&&(setTimeout(()=>{this._domSelectionInView=null},0),this._domSelectionInView=this._isDomSelectionInView()),this._domSelectionInView):!1}_isDomSelectionInView(){const e=this.prosemirrorView._root.getSelection(),t=this.prosemirrorView._root.createRange();t.setStart(e.anchorNode,e.anchorOffset),t.setEnd(e.focusNode,e.focusOffset),t.getClientRects().length===0&&t.startContainer&&t.collapsed&&t.selectNodeContents(t.startContainer);const a=t.getBoundingClientRect(),l=aN.documentElement;return a.bottom>=0&&a.right>=0&&a.left<=(window.innerWidth||l.clientWidth||0)&&a.top<=(window.innerHeight||l.clientHeight||0)}renderSnapshot(e,t){t||(t=hN(pN(),new Map)),this.prosemirrorView.dispatch(this.prosemirrorView.state.tr.setMeta(pr,{snapshot:e,prevSnapshot:t}))}unrenderSnapshot(){this.mapping=new Map,this.mux(()=>{const e=this.type.toArray().map(o=>oh(o,this.prosemirrorView.state.schema,this.mapping)).filter(o=>o!==null),t=this.prosemirrorView.state.tr.replace(0,this.prosemirrorView.state.doc.content.size,new ye(new ee(e),0,0));t.setMeta(pr,{snapshot:null,prevSnapshot:null}),this.prosemirrorView.dispatch(t)})}_forceRerender(){this.mapping=new Map,this.mux(()=>{const e=this.type.toArray().map(o=>oh(o,this.prosemirrorView.state.schema,this.mapping)).filter(o=>o!==null),t=this.prosemirrorView.state.tr.replace(0,this.prosemirrorView.state.doc.content.size,new ye(new ee(e),0,0));this.prosemirrorView.dispatch(t.setMeta(pr,{isChangeOrigin:!0}))})}_renderSnapshot(e,t,o){e||(e=cN(this.doc)),this.mapping=new Map,this.mux(()=>{this.doc.transact(a=>{const l=o.permanentUserData;l&&l.dss.forEach(v=>{QI(a,v,C=>{})});const d=(v,C)=>{const y=v==="added"?l.getUserByClientId(C.client):l.getUserByDeletedId(C);return{user:y,type:v,color:nP(o.colorMapping,o.colors,y)}},p=xI(this.type,new UI(t.ds,e.sv)).map(v=>!v._item.deleted||ih(v._item,e)||ih(v._item,t)?oh(v,this.prosemirrorView.state.schema,new Map,e,t,d):null).filter(v=>v!==null),g=this.prosemirrorView.state.tr.replace(0,this.prosemirrorView.state.doc.content.size,new ye(new ee(p),0,0));this.prosemirrorView.dispatch(g.setMeta(pr,{isChangeOrigin:!0}))},pr)})}_typeChanged(e,t){const o=pr.getState(this.prosemirrorView.state);if(e.length===0||o.snapshot!=null||o.prevSnapshot!=null){this.renderSnapshot(o.snapshot,o.prevSnapshot);return}this.mux(()=>{const a=(p,g)=>this.mapping.delete(g);QI(t,t.deleteSet,p=>p.constructor===FI&&this.mapping.delete(p.content.type)),t.changed.forEach(a),t.changedParentTypes.forEach(a);const l=this.type.toArray().map(p=>l_(p,this.prosemirrorView.state.schema,this.mapping)).filter(p=>p!==null);let d=this.prosemirrorView.state.tr.replace(0,this.prosemirrorView.state.doc.content.size,new ye(new ee(l),0,0));oP(d,this.beforeTransactionSelection,this),d=d.setMeta(pr,{isChangeOrigin:!0}),this.beforeTransactionSelection!==null&&this._isLocalCursorInView()&&d.scrollIntoView(),this.prosemirrorView.dispatch(d)})}_prosemirrorChanged(e){this.mux(()=>{this.doc.transact(()=>{og(this.doc,this.type,e,this.mapping),this.beforeTransactionSelection=rg(this,this.prosemirrorView.state)},pr)})}destroy(){this.type.unobserveDeep(this._observeFunction),this.doc.off("beforeAllTransactions",this.beforeAllTransactions),this.doc.off("afterAllTransactions",this.afterAllTransactions)}}const l_=(n,e,t,o,a,l)=>{const d=t.get(n);if(d===void 0){if(n instanceof Wo)return oh(n,e,t,o,a,l);throw uN()}return d},oh=(n,e,t,o,a,l)=>{const d=[],p=g=>{if(g.constructor===Wo){const v=l_(g,e,t,o,a,l);v!==null&&d.push(v)}else{const v=aP(g,e,t,o,a,l);v!==null&&v.forEach(C=>{C!==null&&d.push(C)})}};o===void 0||a===void 0?n.toArray().forEach(p):xI(n,new UI(a.ds,o.sv)).forEach(p);try{const g=n.getAttributes(o);o!==void 0&&(ih(n._item,o)?ih(n._item,a)||(g.ychange=l?l("added",n._item.id):{type:"added"}):g.ychange=l?l("removed",n._item.id):{type:"removed"});const v=e.node(n.nodeName,g,d);return t.set(n,v),v}catch{return n.doc.transact(v=>{n._item.delete(v)},pr),t.delete(n),null}},aP=(n,e,t,o,a,l)=>{const d=[],p=n.toDelta(o,a,l);try{for(let g=0;g<p.length;g++){const v=p[g],C=[];for(const y in v.attributes)C.push(e.mark(y,v.attributes[y]));d.push(e.text(v.insert,C))}}catch{return n.doc.transact(v=>{n._item.delete(v)},pr),null}return d},cP=(n,e)=>{const t=new ps,o=n.map(a=>({insert:a.text,attributes:p_(a.marks)}));return t.applyDelta(o),e.set(t,n),t},lP=(n,e)=>{const t=new Wo(n.type.name);for(const o in n.attrs){const a=n.attrs[o];a!==null&&o!=="ychange"&&t.setAttribute(o,a)}return t.insert(0,sh(n).map(o=>ng(o,e))),e.set(t,n),t},ng=(n,e)=>n instanceof Array?cP(n,e):lP(n,e),u_=n=>typeof n=="object"&&n!==null,ig=(n,e)=>{const t=Object.keys(n).filter(a=>n[a]!==null);let o=t.length===Object.keys(e).filter(a=>e[a]!==null).length;for(let a=0;a<t.length&&o;a++){const l=t[a],d=n[l],p=e[l];o=l==="ychange"||d===p||u_(d)&&u_(p)&&ig(d,p)}return o},sh=n=>{const e=n.content.content,t=[];for(let o=0;o<e.length;o++){const a=e[o];if(a.isText){const l=[];for(let d=e[o];o<e.length&&d.isText;d=e[++o])l.push(d);o--,t.push(l)}else t.push(a)}return t},d_=(n,e)=>{const t=n.toDelta();return t.length===e.length&&t.every((o,a)=>o.insert===e[a].text&&dN(o.attributes||{}).length===e[a].marks.length&&e[a].marks.every(l=>ig(o.attributes[l.type.name]||{},l.attrs)))},tu=(n,e)=>{if(n instanceof Wo&&!(e instanceof Array)&&sg(n,e)){const t=sh(e);return n._length===t.length&&ig(n.getAttributes(),e.attrs)&&n.toArray().every((o,a)=>tu(o,t[a]))}return n instanceof ps&&e instanceof Array&&d_(n,e)},ah=(n,e)=>n===e||n instanceof Array&&e instanceof Array&&n.length===e.length&&n.every((t,o)=>e[o]===t),h_=(n,e,t)=>{const o=n.toArray(),a=sh(e),l=a.length,d=o.length,p=wl(d,l);let g=0,v=0,C=!1;for(;g<p;g++){const y=o[g],w=a[g];if(ah(t.get(y),w))C=!0;else if(!tu(y,w))break}for(;g+v<p;v++){const y=o[d-v-1],w=a[l-v-1];if(ah(t.get(y),w))C=!0;else if(!tu(y,w))break}return{equalityFactor:g+v,foundMappedChild:C}},uP=n=>{let e="",t=n._start;const o={};for(;t!==null;)t.deleted||(t.countable&&t.content instanceof fN?e+=t.content.str:t.content instanceof gN&&(o[t.content.key]=null)),t=t.right;return{str:e,nAttrs:o}},dP=(n,e,t)=>{t.set(n,e);const{nAttrs:o,str:a}=uP(n),l=e.map(v=>({insert:v.text,attributes:Object.assign({},o,p_(v.marks))})),{insert:d,remove:p,index:g}=tP(a,l.map(v=>v.insert).join(""));n.delete(g,p),n.insert(g,d),n.applyDelta(l.map(v=>({retain:v.insert.length,attributes:v.attributes})))},p_=n=>{const e={};return n.forEach(t=>{t.type.name!=="ychange"&&(e[t.type.name]=t.attrs)}),e},og=(n,e,t,o)=>{if(e instanceof Wo&&e.nodeName!==t.type.name)throw new Error("node name mismatch!");if(o.set(e,t),e instanceof Wo){const y=e.getAttributes(),w=t.attrs;for(const O in w)w[O]!==null?y[O]!==w[O]&&O!=="ychange"&&e.setAttribute(O,w[O]):e.removeAttribute(O);for(const O in y)w[O]===void 0&&e.removeAttribute(O)}const a=sh(t),l=a.length,d=e.toArray(),p=d.length,g=wl(l,p);let v=0,C=0;for(;v<g;v++){const y=d[v],w=a[v];if(!ah(o.get(y),w))if(tu(y,w))o.set(y,w);else break}for(;C+v+1<g;C++){const y=d[p-C-1],w=a[l-C-1];if(!ah(o.get(y),w))if(tu(y,w))o.set(y,w);else break}n.transact(()=>{for(;p-v-C>0&&l-v-C>0;){const w=d[v],O=a[v],M=d[p-C-1],x=a[l-C-1];if(w instanceof ps&&O instanceof Array)d_(w,O)||dP(w,O,o),v+=1;else{let G=w instanceof Wo&&sg(w,O),K=M instanceof Wo&&sg(M,x);if(G&&K){const F=h_(w,O,o),re=h_(M,x,o);F.foundMappedChild&&!re.foundMappedChild?K=!1:!F.foundMappedChild&&re.foundMappedChild||F.equalityFactor<re.equalityFactor?G=!1:K=!1}G?(og(n,w,O,o),v+=1):K?(og(n,M,x,o),C+=1):(e.delete(v,1),e.insert(v,[ng(O,o)]),v+=1)}}const y=p-v-C;if(y>0&&e.delete(v,y),v+C<l){const w=[];for(let O=v;O<l-C;O++)w.push(ng(a[O],o));e.insert(v,w)}},pr)},sg=(n,e)=>!(e instanceof Array)&&n.nodeName===e.type.name;let ru=null;const hP=()=>{const n=ru;ru=null,n.forEach((e,t)=>{const o=t.state.tr;e.forEach((a,l)=>{o.setMeta(l,a)}),t.dispatch(o)})},pP=(n,e,t)=>{ru||(ru=new Map,BN(0,hP)),yN(ru,n,_N).set(e,t)},ch=(n,e,t)=>{if(n===0)return IA(e,0);let o=e._first===null?null:e._first.content.type;for(;o!==null&&e!==o;){if(o instanceof ps){if(o._length>=n)return IA(o,n);if(n-=o._length,o._item!==null&&o._item.next!==null)o=o._item.next.content.type;else{do o=o._item===null?null:o._item.parent,n--;while(o!==e&&o!==null&&o._item!==null&&o._item.next===null);o!==null&&o!==e&&(o=o._item===null?null:o._item.next.content.type)}}else{const a=(t.get(o)||{nodeSize:0}).nodeSize;if(o._first!==null&&n<a)o=o._first.content.type,n--;else{if(n===1&&o._length===0&&a>1)return new CA(o._item===null?null:o._item.id,o._item===null?yA(o):null,null);if(n-=a,o._item!==null&&o._item.next!==null)o=o._item.next.content.type;else{if(n===0)return o=o._item===null?o:o._item.parent,new CA(o._item===null?null:o._item.id,o._item===null?yA(o):null,null);do o=o._item.parent,n--;while(o!==e&&o._item.next===null);o!==e&&(o=o._item.next.content.type)}}}if(o===null)throw vN();if(n===0&&o.constructor!==ps&&o!==e)return AP(o._item.parent,o._item)}return IA(e,e._length)},AP=(n,e)=>{let t=null,o=null;return n._item===null?o=yA(n):t=EN(n._item.id.client,n._item.id.clock),new CA(t,o,e.id)},nu=(n,e,t,o)=>{const a=IN(t,n);if(a===null||a.type!==e&&!CN(e,a.type._item))return null;let l=a.type,d=0;if(l.constructor===ps)d=a.index;else if(l._item===null||!l._item.deleted){let p=l._first,g=0;for(;g<l._length&&g<a.index&&p!==null;){if(!p.deleted){const v=p.content.type;g++,v instanceof ps?d+=v._length:d+=o.get(v).nodeSize}p=p.right}d+=1}for(;l!==e&&l._item!==null;){const p=l._item.parent;if(p._item===null||!p._item.deleted){d+=1;let g=p._first;for(;g!==null;){const v=g.content.type;if(v===l)break;g.deleted||(v instanceof ps?d+=v._length:d+=o.get(v).nodeSize),g=g.right}}l=p}return d-1},fP=n=>{const e=document.createElement("span");e.classList.add("ProseMirror-yjs-cursor"),e.setAttribute("style",`border-color: ${n.color}`);const t=document.createElement("div");return t.setAttribute("style",`background-color: ${n.color}`),t.insertBefore(document.createTextNode(n.name),null),e.insertBefore(t,null),e},gP=/^#[0-9a-fA-F]{6}$/,A_=(n,e,t)=>{const o=pr.getState(n),a=o.doc,l=[];return o.snapshot!=null||o.prevSnapshot!=null||o.binding===null?xt.create(n.doc,[]):(e.getStates().forEach((d,p)=>{if(p!==a.clientID&&d.cursor!=null){const g=d.user||{};g.color==null?g.color="#ffa500":gP.test(g.color)||console.warn("A user uses an unsupported color format",g),g.name==null&&(g.name=`User: ${p}`);let v=nu(a,o.type,Nl(d.cursor.anchor),o.binding.mapping),C=nu(a,o.type,Nl(d.cursor.head),o.binding.mapping);if(v!==null&&C!==null){const y=VI(n.doc.content.size-1,0);v=wl(v,y),C=wl(C,y),l.push(Or.widget(C,()=>t(g),{key:p+"",side:10}));const w=wl(v,C),O=VI(v,C);l.push(Or.inline(w,O,{style:`background-color: ${g.color}70`},{inclusiveEnd:!0,inclusiveStart:!1}))}}}),xt.create(n.doc,l))},mP=(n,{cursorBuilder:e=fP,getSelection:t=a=>a.selection}={},o="cursor")=>new nn({key:nh,state:{init(a,l){return A_(l,n,e)},apply(a,l,d,p){const g=pr.getState(p),v=a.getMeta(nh);return g&&g.isChangeOrigin||v&&v.awarenessUpdated?A_(p,n,e):l.map(a.mapping,a.doc)}},props:{decorations:a=>nh.getState(a)},view:a=>{const l=()=>{a.docView&&pP(a,nh,{awarenessUpdated:!0})},d=()=>{const p=pr.getState(a.state),g=n.getLocalState()||{};if(a.hasFocus()&&p.binding!==null){const v=t(a.state),C=ch(v.anchor,p.type,p.binding.mapping),y=ch(v.head,p.type,p.binding.mapping);(g.cursor==null||!GI(Nl(g.cursor.anchor),C)||!GI(Nl(g.cursor.head),y))&&n.setLocalStateField(o,{anchor:C,head:y})}else g.cursor!=null&&nu(p.doc,p.type,Nl(g.cursor.anchor),p.binding.mapping)!==null&&n.setLocalStateField(o,null)};return n.on("change",l),a.dom.addEventListener("focusin",d),a.dom.addEventListener("focusout",d),{update:d,destroy:()=>{a.dom.removeEventListener("focusin",d),a.dom.removeEventListener("focusout",d),n.off("change",l),n.setLocalStateField(o,null)}}}}),vP=n=>{const e=ma.getState(n).undoManager;if(e!=null)return e.undo(),!0},EP=n=>{const e=ma.getState(n).undoManager;if(e!=null)return e.redo(),!0},IP=({protectedNodes:n=new Set(["paragraph"]),trackedOrigins:e=[]}={})=>new nn({key:ma,state:{init:(t,o)=>{const a=pr.getState(o),l=new SN(a.type,{trackedOrigins:new Set([pr].concat(e)),deleteFilter:d=>!(d instanceof FI)||!(d.content instanceof TN)||!(d.content.type instanceof RN||d.content.type instanceof Wo&&n.has(d.content.type.nodeName))||d.content.type._length===0});return{undoManager:l,prevSel:null,hasUndoOps:l.undoStack.length>0,hasRedoOps:l.redoStack.length>0}},apply:(t,o,a,l)=>{const d=pr.getState(l).binding,p=o.undoManager,g=p.undoStack.length>0,v=p.redoStack.length>0;return d?{undoManager:p,prevSel:rg(d,a),hasUndoOps:g,hasRedoOps:v}:g!==o.hasUndoOps||v!==o.hasRedoOps?Object.assign({},o,{hasUndoOps:p.undoStack.length>0,hasRedoOps:p.redoStack.length>0}):o}},view:t=>{const o=pr.getState(t.state),a=ma.getState(t.state).undoManager;return a.on("stack-item-added",({stackItem:l})=>{const d=o.binding;d&&l.meta.set(d,ma.getState(t.state).prevSel)}),a.on("stack-item-popped",({stackItem:l})=>{const d=o.binding;d&&(d.beforeTransactionSelection=l.meta.get(d)||d.beforeTransactionSelection)}),{destroy:()=>{a.destroy()}}}}),CP=qr.create({name:"collaboration",priority:1e3,addOptions(){return{document:null,field:"default",fragment:null}},onCreate(){this.editor.extensionManager.extensions.find(n=>n.name==="history")&&console.warn('[tiptap warn]: "@tiptap/extension-collaboration" comes with its own history support and is not compatible with "@tiptap/extension-history".')},addCommands(){return{undo:()=>({tr:n,state:e,dispatch:t})=>(n.setMeta("preventDispatch",!0),ma.getState(e).undoManager.undoStack.length===0?!1:t?vP(e):!0),redo:()=>({tr:n,state:e,dispatch:t})=>(n.setMeta("preventDispatch",!0),ma.getState(e).undoManager.redoStack.length===0?!1:t?EP(e):!0)}},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Mod-y":()=>this.editor.commands.redo(),"Shift-Mod-z":()=>this.editor.commands.redo()}},addProseMirrorPlugins(){const n=this.options.fragment?this.options.fragment:this.options.document.getXmlFragment(this.options.field);return[iP(n),IP()]}}),f_=n=>Array.from(n.entries()).map(([e,t])=>ie({clientId:e},t.user)),g_=()=>null,yP=qr.create({name:"collaborationCursor",addOptions(){return{provider:null,user:{name:null,color:null},render:n=>{const e=document.createElement("span");e.classList.add("collaboration-cursor__caret"),e.setAttribute("style",`border-color: ${n.color}`);const t=document.createElement("div");return t.classList.add("collaboration-cursor__label"),t.setAttribute("style",`background-color: ${n.color}`),t.insertBefore(document.createTextNode(n.name),null),e.insertBefore(t,null),e},onUpdate:g_}},onCreate(){this.options.onUpdate!==g_&&console.warn('[tiptap warn]: DEPRECATED: The "onUpdate" option is deprecated. Please use `editor.storage.collaborationCursor.users` instead. Read more: https://tiptap.dev/api/extensions/collaboration-cursor')},addStorage(){return{users:[]}},addCommands(){return{updateUser:n=>()=>(this.options.user=n,this.options.provider.awareness.setLocalStateField("user",this.options.user),!0),user:n=>({editor:e})=>(console.warn('[tiptap warn]: DEPRECATED: The "user" command is deprecated. Please use "updateUser" instead. Read more: https://tiptap.dev/api/extensions/collaboration-cursor'),e.commands.updateUser(n))}},addProseMirrorPlugins(){return[mP((()=>(this.options.provider.awareness.setLocalStateField("user",this.options.user),this.storage.users=f_(this.options.provider.awareness.states),this.options.provider.awareness.on("update",()=>{this.storage.users=f_(this.options.provider.awareness.states)}),this.options.provider.awareness))(),{cursorBuilder:this.options.render})]}}),_P=yn.create({name:"taskList",addOptions(){return{HTMLAttributes:{}}},group:"block list",content:"taskItem+",parseHTML(){return[{tag:'ul[data-type="taskList"]',priority:51}]},renderHTML({HTMLAttributes:n}){return["ul",an(this.options.HTMLAttributes,n,{"data-type":"taskList"}),0]},addCommands(){return{toggleTaskList:()=>({commands:n})=>n.toggleList("taskList","taskItem")}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}}),SP=/^\s*(\[([ |x])\])\s$/,TP=yn.create({name:"taskItem",addOptions(){return{nested:!1,HTMLAttributes:{}}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:n=>n.getAttribute("data-checked")==="true",renderHTML:n=>({"data-checked":n.checked})}}},parseHTML(){return[{tag:'li[data-type="taskItem"]',priority:51}]},renderHTML({node:n,HTMLAttributes:e}){return["li",an(this.options.HTMLAttributes,e,{"data-type":"taskItem"}),["label",["input",{type:"checkbox",checked:n.attrs.checked?"checked":null}],["span"]],["div",0]]},addKeyboardShortcuts(){const n={Enter:()=>this.editor.commands.splitListItem("taskItem"),"Shift-Tab":()=>this.editor.commands.liftListItem("taskItem")};return this.options.nested?On(ie({},n),{Tab:()=>this.editor.commands.sinkListItem("taskItem")}):n},addNodeView(){return({node:n,HTMLAttributes:e,getPos:t,editor:o})=>{const a=document.createElement("li"),l=document.createElement("label"),d=document.createElement("span"),p=document.createElement("input"),g=document.createElement("div");return l.contentEditable="false",p.type="checkbox",p.addEventListener("change",v=>{if(!o.isEditable){p.checked=!p.checked;return}const{checked:C}=v.target;o.isEditable&&typeof t=="function"&&o.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:y})=>(y.setNodeMarkup(t(),void 0,{checked:C}),!0)).run()}),Object.entries(this.options.HTMLAttributes).forEach(([v,C])=>{a.setAttribute(v,C)}),a.dataset.checked=n.attrs.checked,n.attrs.checked&&p.setAttribute("checked","checked"),l.append(p,d),a.append(l,g),Object.entries(e).forEach(([v,C])=>{a.setAttribute(v,C)}),{dom:a,contentDOM:g,update:v=>v.type!==this.type?!1:(a.dataset.checked=v.attrs.checked,v.attrs.checked?p.setAttribute("checked","checked"):p.removeAttribute("checked"),!0)}}},addInputRules(){return[Kd({find:SP,type:this.type,getAttributes:n=>({checked:n[n.length-1]==="x"})})]}}),RP=/(?:^|\s)((?:==)((?:[^~]+))(?:==))$/,wP=/(?:^|\s)((?:==)((?:[^~]+))(?:==))/g,NP=Ss.create({name:"highlight",addOptions(){return{multicolor:!1,HTMLAttributes:{}}},addAttributes(){return this.options.multicolor?{color:{default:null,parseHTML:n=>n.getAttribute("data-color")||n.style.backgroundColor,renderHTML:n=>n.color?{"data-color":n.color,style:`background-color: ${n.color}`}:{}}}:{}},parseHTML(){return[{tag:"mark"}]},renderHTML({HTMLAttributes:n}){return["mark",an(this.options.HTMLAttributes,n),0]},addCommands(){return{setHighlight:n=>({commands:e})=>e.setMark("highlight",n),toggleHighlight:n=>({commands:e})=>e.toggleMark("highlight",n),unsetHighlight:()=>({commands:n})=>n.unsetMark("highlight")}},addKeyboardShortcuts(){return{"Mod-Shift-h":()=>this.editor.commands.toggleHighlight()}},addInputRules(){return[pa({find:RP,type:this.type})]},addPasteRules(){return[Aa({find:wP,type:this.type})]}});function m_(n,e,t){for(var o=0;;o++){if(o==n.childCount||o==e.childCount)return n.childCount==e.childCount?null:t;var a=n.child(o),l=e.child(o);if(a==l){t+=a.nodeSize;continue}if(!a.sameMarkup(l))return t;if(a.isText&&a.text!=l.text){for(var d=0;a.text[d]==l.text[d];d++)t++;return t}if(a.content.size||l.content.size){var p=m_(a.content,l.content,t+1);if(p!=null)return p}t+=a.nodeSize}}function v_(n,e,t,o){for(var a=n.childCount,l=e.childCount;;){if(a==0||l==0)return a==l?null:{a:t,b:o};var d=n.child(--a),p=e.child(--l),g=d.nodeSize;if(d==p){t-=g,o-=g;continue}if(!d.sameMarkup(p))return{a:t,b:o};if(d.isText&&d.text!=p.text){for(var v=0,C=Math.min(d.text.length,p.text.length);v<C&&d.text[d.text.length-v-1]==p.text[p.text.length-v-1];)v++,t--,o--;return{a:t,b:o}}if(d.content.size||p.content.size){var y=v_(d.content,p.content,t-1,o-1);if(y)return y}t-=g,o-=g}}var me=function(e,t){if(this.content=e,this.size=t||0,t==null)for(var o=0;o<e.length;o++)this.size+=e[o].nodeSize},lh={firstChild:{configurable:!0},lastChild:{configurable:!0},childCount:{configurable:!0}};me.prototype.nodesBetween=function(e,t,o,a,l){a===void 0&&(a=0);for(var d=0,p=0;p<t;d++){var g=this.content[d],v=p+g.nodeSize;if(v>e&&o(g,a+p,l,d)!==!1&&g.content.size){var C=p+1;g.nodesBetween(Math.max(0,e-C),Math.min(g.content.size,t-C),o,a+C)}p=v}};me.prototype.descendants=function(e){this.nodesBetween(0,this.size,e)};me.prototype.textBetween=function(e,t,o,a){var l="",d=!0;return this.nodesBetween(e,t,function(p,g){p.isText?(l+=p.text.slice(Math.max(e,g)-g,t-g),d=!o):p.isLeaf&&a?(l+=typeof a=="function"?a(p):a,d=!o):!d&&p.isBlock&&(l+=o,d=!0)},0),l};me.prototype.append=function(e){if(!e.size)return this;if(!this.size)return e;var t=this.lastChild,o=e.firstChild,a=this.content.slice(),l=0;for(t.isText&&t.sameMarkup(o)&&(a[a.length-1]=t.withText(t.text+o.text),l=1);l<e.content.length;l++)a.push(e.content[l]);return new me(a,this.size+e.size)};me.prototype.cut=function(e,t){if(t==null&&(t=this.size),e==0&&t==this.size)return this;var o=[],a=0;if(t>e)for(var l=0,d=0;d<t;l++){var p=this.content[l],g=d+p.nodeSize;g>e&&((d<e||g>t)&&(p.isText?p=p.cut(Math.max(0,e-d),Math.min(p.text.length,t-d)):p=p.cut(Math.max(0,e-d-1),Math.min(p.content.size,t-d-1))),o.push(p),a+=p.nodeSize),d=g}return new me(o,a)};me.prototype.cutByIndex=function(e,t){return e==t?me.empty:e==0&&t==this.content.length?this:new me(this.content.slice(e,t))};me.prototype.replaceChild=function(e,t){var o=this.content[e];if(o==t)return this;var a=this.content.slice(),l=this.size+t.nodeSize-o.nodeSize;return a[e]=t,new me(a,l)};me.prototype.addToStart=function(e){return new me([e].concat(this.content),this.size+e.nodeSize)};me.prototype.addToEnd=function(e){return new me(this.content.concat(e),this.size+e.nodeSize)};me.prototype.eq=function(e){if(this.content.length!=e.content.length)return!1;for(var t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0};lh.firstChild.get=function(){return this.content.length?this.content[0]:null};lh.lastChild.get=function(){return this.content.length?this.content[this.content.length-1]:null};lh.childCount.get=function(){return this.content.length};me.prototype.child=function(e){var t=this.content[e];if(!t)throw new RangeError("Index "+e+" out of range for "+this);return t};me.prototype.maybeChild=function(e){return this.content[e]};me.prototype.forEach=function(e){for(var t=0,o=0;t<this.content.length;t++){var a=this.content[t];e(a,o,t),o+=a.nodeSize}};me.prototype.findDiffStart=function(e,t){return t===void 0&&(t=0),m_(this,e,t)};me.prototype.findDiffEnd=function(e,t,o){return t===void 0&&(t=this.size),o===void 0&&(o=e.size),v_(this,e,t,o)};me.prototype.findIndex=function(e,t){if(t===void 0&&(t=-1),e==0)return uh(0,e);if(e==this.size)return uh(this.content.length,e);if(e>this.size||e<0)throw new RangeError("Position "+e+" outside of fragment ("+this+")");for(var o=0,a=0;;o++){var l=this.child(o),d=a+l.nodeSize;if(d>=e)return d==e||t>0?uh(o+1,d):uh(o,a);a=d}};me.prototype.toString=function(){return"<"+this.toStringInner()+">"};me.prototype.toStringInner=function(){return this.content.join(", ")};me.prototype.toJSON=function(){return this.content.length?this.content.map(function(e){return e.toJSON()}):null};me.fromJSON=function(e,t){if(!t)return me.empty;if(!Array.isArray(t))throw new RangeError("Invalid input for Fragment.fromJSON");return new me(t.map(e.nodeFromJSON))};me.fromArray=function(e){if(!e.length)return me.empty;for(var t,o=0,a=0;a<e.length;a++){var l=e[a];o+=l.nodeSize,a&&l.isText&&e[a-1].sameMarkup(l)?(t||(t=e.slice(0,a)),t[t.length-1]=l.withText(t[t.length-1].text+l.text)):t&&t.push(l)}return new me(t||e,o)};me.from=function(e){if(!e)return me.empty;if(e instanceof me)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new me([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))};Object.defineProperties(me.prototype,lh);var ag={index:0,offset:0};function uh(n,e){return ag.index=n,ag.offset=e,ag}me.empty=new me([],0);function dh(n,e){if(n===e)return!0;if(!(n&&typeof n=="object")||!(e&&typeof e=="object"))return!1;var t=Array.isArray(n);if(Array.isArray(e)!=t)return!1;if(t){if(n.length!=e.length)return!1;for(var o=0;o<n.length;o++)if(!dh(n[o],e[o]))return!1}else{for(var a in n)if(!(a in e)||!dh(n[a],e[a]))return!1;for(var l in e)if(!(l in n))return!1}return!0}var wt=function(e,t){this.type=e,this.attrs=t};wt.prototype.addToSet=function(e){for(var t,o=!1,a=0;a<e.length;a++){var l=e[a];if(this.eq(l))return e;if(this.type.excludes(l.type))t||(t=e.slice(0,a));else{if(l.type.excludes(this.type))return e;!o&&l.type.rank>this.type.rank&&(t||(t=e.slice(0,a)),t.push(this),o=!0),t&&t.push(l)}}return t||(t=e.slice()),o||t.push(this),t};wt.prototype.removeFromSet=function(e){for(var t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e};wt.prototype.isInSet=function(e){for(var t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1};wt.prototype.eq=function(e){return this==e||this.type==e.type&&dh(this.attrs,e.attrs)};wt.prototype.toJSON=function(){var e={type:this.type.name};for(var t in this.attrs){e.attrs=this.attrs;break}return e};wt.fromJSON=function(e,t){if(!t)throw new RangeError("Invalid input for Mark.fromJSON");var o=e.marks[t.type];if(!o)throw new RangeError("There is no mark type "+t.type+" in this schema");return o.create(t.attrs)};wt.sameSet=function(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(var o=0;o<e.length;o++)if(!e[o].eq(t[o]))return!1;return!0};wt.setFrom=function(e){if(!e||e.length==0)return wt.none;if(e instanceof wt)return[e];var t=e.slice();return t.sort(function(o,a){return o.type.rank-a.type.rank}),t};wt.none=[];function Oo(n){var e=Error.call(this,n);return e.__proto__=Oo.prototype,e}Oo.prototype=Object.create(Error.prototype);Oo.prototype.constructor=Oo;Oo.prototype.name="ReplaceError";var Ue=function(e,t,o){this.content=e,this.openStart=t,this.openEnd=o},E_={size:{configurable:!0}};E_.size.get=function(){return this.content.size-this.openStart-this.openEnd};Ue.prototype.insertAt=function(e,t){var o=C_(this.content,e+this.openStart,t,null);return o&&new Ue(o,this.openStart,this.openEnd)};Ue.prototype.removeBetween=function(e,t){return new Ue(I_(this.content,e+this.openStart,t+this.openStart),this.openStart,this.openEnd)};Ue.prototype.eq=function(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd};Ue.prototype.toString=function(){return this.content+"("+this.openStart+","+this.openEnd+")"};Ue.prototype.toJSON=function(){if(!this.content.size)return null;var e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e};Ue.fromJSON=function(e,t){if(!t)return Ue.empty;var o=t.openStart||0,a=t.openEnd||0;if(typeof o!="number"||typeof a!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new Ue(me.fromJSON(e,t.content),o,a)};Ue.maxOpen=function(e,t){t===void 0&&(t=!0);for(var o=0,a=0,l=e.firstChild;l&&!l.isLeaf&&(t||!l.type.spec.isolating);l=l.firstChild)o++;for(var d=e.lastChild;d&&!d.isLeaf&&(t||!d.type.spec.isolating);d=d.lastChild)a++;return new Ue(e,o,a)};Object.defineProperties(Ue.prototype,E_);function I_(n,e,t){var o=n.findIndex(e),a=o.index,l=o.offset,d=n.maybeChild(a),p=n.findIndex(t),g=p.index,v=p.offset;if(l==e||d.isText){if(v!=t&&!n.child(g).isText)throw new RangeError("Removing non-flat range");return n.cut(0,e).append(n.cut(t))}if(a!=g)throw new RangeError("Removing non-flat range");return n.replaceChild(a,d.copy(I_(d.content,e-l-1,t-l-1)))}function C_(n,e,t,o){var a=n.findIndex(e),l=a.index,d=a.offset,p=n.maybeChild(l);if(d==e||p.isText)return o&&!o.canReplace(l,l,t)?null:n.cut(0,e).append(t).append(n.cut(e));var g=C_(p.content,e-d-1,t);return g&&n.replaceChild(l,p.copy(g))}Ue.empty=new Ue(me.empty,0,0);function kP(n,e,t){if(t.openStart>n.depth)throw new Oo("Inserted content deeper than insertion position");if(n.depth-t.openStart!=e.depth-t.openEnd)throw new Oo("Inconsistent open depths");return y_(n,e,t,0)}function y_(n,e,t,o){var a=n.index(o),l=n.node(o);if(a==e.index(o)&&o<n.depth-t.openStart){var d=y_(n,e,t,o+1);return l.copy(l.content.replaceChild(a,d))}else if(t.content.size)if(!t.openStart&&!t.openEnd&&n.depth==o&&e.depth==o){var p=n.parent,g=p.content;return Ea(p,g.cut(0,n.parentOffset).append(t.content).append(g.cut(e.parentOffset)))}else{var v=OP(t,n),C=v.start,y=v.end;return Ea(l,S_(n,C,y,e,o))}else return Ea(l,hh(n,e,o))}function __(n,e){if(!e.type.compatibleContent(n.type))throw new Oo("Cannot join "+e.type.name+" onto "+n.type.name)}function cg(n,e,t){var o=n.node(t);return __(o,e.node(t)),o}function va(n,e){var t=e.length-1;t>=0&&n.isText&&n.sameMarkup(e[t])?e[t]=n.withText(e[t].text+n.text):e.push(n)}function iu(n,e,t,o){var a=(e||n).node(t),l=0,d=e?e.index(t):a.childCount;n&&(l=n.index(t),n.depth>t?l++:n.textOffset&&(va(n.nodeAfter,o),l++));for(var p=l;p<d;p++)va(a.child(p),o);e&&e.depth==t&&e.textOffset&&va(e.nodeBefore,o)}function Ea(n,e){if(!n.type.validContent(e))throw new Oo("Invalid content for node "+n.type.name);return n.copy(e)}function S_(n,e,t,o,a){var l=n.depth>a&&cg(n,e,a+1),d=o.depth>a&&cg(t,o,a+1),p=[];return iu(null,n,a,p),l&&d&&e.index(a)==t.index(a)?(__(l,d),va(Ea(l,S_(n,e,t,o,a+1)),p)):(l&&va(Ea(l,hh(n,e,a+1)),p),iu(e,t,a,p),d&&va(Ea(d,hh(t,o,a+1)),p)),iu(o,null,a,p),new me(p)}function hh(n,e,t){var o=[];if(iu(null,n,t,o),n.depth>t){var a=cg(n,e,t+1);va(Ea(a,hh(n,e,t+1)),o)}return iu(e,null,t,o),new me(o)}function OP(n,e){for(var t=e.depth-n.openStart,o=e.node(t),a=o.copy(n.content),l=t-1;l>=0;l--)a=e.node(l).copy(me.from(a));return{start:a.resolveNoCache(n.openStart+t),end:a.resolveNoCache(a.content.size-n.openEnd-t)}}var rr=function(e,t,o){this.pos=e,this.path=t,this.depth=t.length/3-1,this.parentOffset=o},Bc={parent:{configurable:!0},doc:{configurable:!0},textOffset:{configurable:!0},nodeAfter:{configurable:!0},nodeBefore:{configurable:!0}};rr.prototype.resolveDepth=function(e){return e==null?this.depth:e<0?this.depth+e:e};Bc.parent.get=function(){return this.node(this.depth)};Bc.doc.get=function(){return this.node(0)};rr.prototype.node=function(e){return this.path[this.resolveDepth(e)*3]};rr.prototype.index=function(e){return this.path[this.resolveDepth(e)*3+1]};rr.prototype.indexAfter=function(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)};rr.prototype.start=function(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1};rr.prototype.end=function(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size};rr.prototype.before=function(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]};rr.prototype.after=function(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize};Bc.textOffset.get=function(){return this.pos-this.path[this.path.length-1]};Bc.nodeAfter.get=function(){var n=this.parent,e=this.index(this.depth);if(e==n.childCount)return null;var t=this.pos-this.path[this.path.length-1],o=n.child(e);return t?n.child(e).cut(t):o};Bc.nodeBefore.get=function(){var n=this.index(this.depth),e=this.pos-this.path[this.path.length-1];return e?this.parent.child(n).cut(0,e):n==0?null:this.parent.child(n-1)};rr.prototype.posAtIndex=function(e,t){t=this.resolveDepth(t);for(var o=this.path[t*3],a=t==0?0:this.path[t*3-1]+1,l=0;l<e;l++)a+=o.child(l).nodeSize;return a};rr.prototype.marks=function(){var e=this.parent,t=this.index();if(e.content.size==0)return wt.none;if(this.textOffset)return e.child(t).marks;var o=e.maybeChild(t-1),a=e.maybeChild(t);if(!o){var l=o;o=a,a=l}for(var d=o.marks,p=0;p<d.length;p++)d[p].type.spec.inclusive===!1&&(!a||!d[p].isInSet(a.marks))&&(d=d[p--].removeFromSet(d));return d};rr.prototype.marksAcross=function(e){var t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;for(var o=t.marks,a=e.parent.maybeChild(e.index()),l=0;l<o.length;l++)o[l].type.spec.inclusive===!1&&(!a||!o[l].isInSet(a.marks))&&(o=o[l--].removeFromSet(o));return o};rr.prototype.sharedDepth=function(e){for(var t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0};rr.prototype.blockRange=function(e,t){if(e===void 0&&(e=this),e.pos<this.pos)return e.blockRange(this);for(var o=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);o>=0;o--)if(e.pos<=this.end(o)&&(!t||t(this.node(o))))return new T_(this,e,o)};rr.prototype.sameParent=function(e){return this.pos-this.parentOffset==e.pos-e.parentOffset};rr.prototype.max=function(e){return e.pos>this.pos?e:this};rr.prototype.min=function(e){return e.pos<this.pos?e:this};rr.prototype.toString=function(){for(var e="",t=1;t<=this.depth;t++)e+=(e?"/":"")+this.node(t).type.name+"_"+this.index(t-1);return e+":"+this.parentOffset};rr.resolve=function(e,t){if(!(t>=0&&t<=e.content.size))throw new RangeError("Position "+t+" out of range");for(var o=[],a=0,l=t,d=e;;){var p=d.content.findIndex(l),g=p.index,v=p.offset,C=l-v;if(o.push(d,g,a+v),!C||(d=d.child(g),d.isText))break;l=C-1,a+=v+1}return new rr(t,o,l)};rr.resolveCached=function(e,t){for(var o=0;o<lg.length;o++){var a=lg[o];if(a.pos==t&&a.doc==e)return a}var l=lg[ug]=rr.resolve(e,t);return ug=(ug+1)%bP,l};Object.defineProperties(rr.prototype,Bc);var lg=[],ug=0,bP=12,T_=function(e,t,o){this.$from=e,this.$to=t,this.depth=o},Mc={start:{configurable:!0},end:{configurable:!0},parent:{configurable:!0},startIndex:{configurable:!0},endIndex:{configurable:!0}};Mc.start.get=function(){return this.$from.before(this.depth+1)};Mc.end.get=function(){return this.$to.after(this.depth+1)};Mc.parent.get=function(){return this.$from.node(this.depth)};Mc.startIndex.get=function(){return this.$from.index(this.depth)};Mc.endIndex.get=function(){return this.$to.indexAfter(this.depth)};Object.defineProperties(T_.prototype,Mc);var DP=Object.create(null),Nt=function(e,t,o,a){this.type=e,this.attrs=t,this.content=o||me.empty,this.marks=a||wt.none},gi={nodeSize:{configurable:!0},childCount:{configurable:!0},textContent:{configurable:!0},firstChild:{configurable:!0},lastChild:{configurable:!0},isBlock:{configurable:!0},isTextblock:{configurable:!0},inlineContent:{configurable:!0},isInline:{configurable:!0},isText:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};gi.nodeSize.get=function(){return this.isLeaf?1:2+this.content.size};gi.childCount.get=function(){return this.content.childCount};Nt.prototype.child=function(e){return this.content.child(e)};Nt.prototype.maybeChild=function(e){return this.content.maybeChild(e)};Nt.prototype.forEach=function(e){this.content.forEach(e)};Nt.prototype.nodesBetween=function(e,t,o,a){a===void 0&&(a=0),this.content.nodesBetween(e,t,o,a,this)};Nt.prototype.descendants=function(e){this.nodesBetween(0,this.content.size,e)};gi.textContent.get=function(){return this.textBetween(0,this.content.size,"")};Nt.prototype.textBetween=function(e,t,o,a){return this.content.textBetween(e,t,o,a)};gi.firstChild.get=function(){return this.content.firstChild};gi.lastChild.get=function(){return this.content.lastChild};Nt.prototype.eq=function(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)};Nt.prototype.sameMarkup=function(e){return this.hasMarkup(e.type,e.attrs,e.marks)};Nt.prototype.hasMarkup=function(e,t,o){return this.type==e&&dh(this.attrs,t||e.defaultAttrs||DP)&&wt.sameSet(this.marks,o||wt.none)};Nt.prototype.copy=function(e){return e===void 0&&(e=null),e==this.content?this:new this.constructor(this.type,this.attrs,e,this.marks)};Nt.prototype.mark=function(e){return e==this.marks?this:new this.constructor(this.type,this.attrs,this.content,e)};Nt.prototype.cut=function(e,t){return e==0&&t==this.content.size?this:this.copy(this.content.cut(e,t))};Nt.prototype.slice=function(e,t,o){if(t===void 0&&(t=this.content.size),o===void 0&&(o=!1),e==t)return Ue.empty;var a=this.resolve(e),l=this.resolve(t),d=o?0:a.sharedDepth(t),p=a.start(d),g=a.node(d),v=g.content.cut(a.pos-p,l.pos-p);return new Ue(v,a.depth-d,l.depth-d)};Nt.prototype.replace=function(e,t,o){return kP(this.resolve(e),this.resolve(t),o)};Nt.prototype.nodeAt=function(e){for(var t=this;;){var o=t.content.findIndex(e),a=o.index,l=o.offset;if(t=t.maybeChild(a),!t)return null;if(l==e||t.isText)return t;e-=l+1}};Nt.prototype.childAfter=function(e){var t=this.content.findIndex(e),o=t.index,a=t.offset;return{node:this.content.maybeChild(o),index:o,offset:a}};Nt.prototype.childBefore=function(e){if(e==0)return{node:null,index:0,offset:0};var t=this.content.findIndex(e),o=t.index,a=t.offset;if(a<e)return{node:this.content.child(o),index:o,offset:a};var l=this.content.child(o-1);return{node:l,index:o-1,offset:a-l.nodeSize}};Nt.prototype.resolve=function(e){return rr.resolveCached(this,e)};Nt.prototype.resolveNoCache=function(e){return rr.resolve(this,e)};Nt.prototype.rangeHasMark=function(e,t,o){var a=!1;return t>e&&this.nodesBetween(e,t,function(l){return o.isInSet(l.marks)&&(a=!0),!a}),a};gi.isBlock.get=function(){return this.type.isBlock};gi.isTextblock.get=function(){return this.type.isTextblock};gi.inlineContent.get=function(){return this.type.inlineContent};gi.isInline.get=function(){return this.type.isInline};gi.isText.get=function(){return this.type.isText};gi.isLeaf.get=function(){return this.type.isLeaf};gi.isAtom.get=function(){return this.type.isAtom};Nt.prototype.toString=function(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);var e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),BP(this.marks,e)};Nt.prototype.contentMatchAt=function(e){var t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw new Error("Called contentMatchAt on a node with invalid content");return t};Nt.prototype.canReplace=function(e,t,o,a,l){o===void 0&&(o=me.empty),a===void 0&&(a=0),l===void 0&&(l=o.childCount);var d=this.contentMatchAt(e).matchFragment(o,a,l),p=d&&d.matchFragment(this.content,t);if(!p||!p.validEnd)return!1;for(var g=a;g<l;g++)if(!this.type.allowsMarks(o.child(g).marks))return!1;return!0};Nt.prototype.canReplaceWith=function(e,t,o,a){if(a&&!this.type.allowsMarks(a))return!1;var l=this.contentMatchAt(e).matchType(o),d=l&&l.matchFragment(this.content,t);return d?d.validEnd:!1};Nt.prototype.canAppend=function(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)};Nt.prototype.check=function(){if(!this.type.validContent(this.content))throw new RangeError("Invalid content for node "+this.type.name+": "+this.content.toString().slice(0,50));for(var e=wt.none,t=0;t<this.marks.length;t++)e=this.marks[t].addToSet(e);if(!wt.sameSet(e,this.marks))throw new RangeError("Invalid collection of marks for node "+this.type.name+": "+this.marks.map(function(o){return o.type.name}));this.content.forEach(function(o){return o.check()})};Nt.prototype.toJSON=function(){var e={type:this.type.name};for(var t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(function(o){return o.toJSON()})),e};Nt.fromJSON=function(e,t){if(!t)throw new RangeError("Invalid input for Node.fromJSON");var o=null;if(t.marks){if(!Array.isArray(t.marks))throw new RangeError("Invalid mark data for Node.fromJSON");o=t.marks.map(e.markFromJSON)}if(t.type=="text"){if(typeof t.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(t.text,o)}var a=me.fromJSON(e,t.content);return e.nodeType(t.type).create(t.attrs,a,o)};Object.defineProperties(Nt.prototype,gi);function BP(n,e){for(var t=n.length-1;t>=0;t--)e=n[t].type.name+"("+e+")";return e}var Pn=function(e){this.validEnd=e,this.next=[],this.wrapCache=[]},ph={inlineContent:{configurable:!0},defaultType:{configurable:!0},edgeCount:{configurable:!0}};Pn.parse=function(e,t){var o=new Ah(e,t);if(o.next==null)return Pn.empty;var a=w_(o);o.next&&o.err("Unexpected trailing text");var l=FP(UP(a));return VP(l,o),l};Pn.prototype.matchType=function(e){for(var t=0;t<this.next.length;t+=2)if(this.next[t]==e)return this.next[t+1];return null};Pn.prototype.matchFragment=function(e,t,o){t===void 0&&(t=0),o===void 0&&(o=e.childCount);for(var a=this,l=t;a&&l<o;l++)a=a.matchType(e.child(l).type);return a};ph.inlineContent.get=function(){var n=this.next[0];return n?n.isInline:!1};ph.defaultType.get=function(){for(var n=0;n<this.next.length;n+=2){var e=this.next[n];if(!(e.isText||e.hasRequiredAttrs()))return e}};Pn.prototype.compatible=function(e){for(var t=0;t<this.next.length;t+=2)for(var o=0;o<e.next.length;o+=2)if(this.next[t]==e.next[o])return!0;return!1};Pn.prototype.fillBefore=function(e,t,o){t===void 0&&(t=!1),o===void 0&&(o=0);var a=[this];function l(d,p){var g=d.matchFragment(e,o);if(g&&(!t||g.validEnd))return me.from(p.map(function(O){return O.createAndFill()}));for(var v=0;v<d.next.length;v+=2){var C=d.next[v],y=d.next[v+1];if(!(C.isText||C.hasRequiredAttrs())&&a.indexOf(y)==-1){a.push(y);var w=l(y,p.concat(C));if(w)return w}}}return l(this,[])};Pn.prototype.findWrapping=function(e){for(var t=0;t<this.wrapCache.length;t+=2)if(this.wrapCache[t]==e)return this.wrapCache[t+1];var o=this.computeWrapping(e);return this.wrapCache.push(e,o),o};Pn.prototype.computeWrapping=function(e){for(var t=Object.create(null),o=[{match:this,type:null,via:null}];o.length;){var a=o.shift(),l=a.match;if(l.matchType(e)){for(var d=[],p=a;p.type;p=p.via)d.push(p.type);return d.reverse()}for(var g=0;g<l.next.length;g+=2){var v=l.next[g];!v.isLeaf&&!v.hasRequiredAttrs()&&!(v.name in t)&&(!a.type||l.next[g+1].validEnd)&&(o.push({match:v.contentMatch,type:v,via:a}),t[v.name]=!0)}}};ph.edgeCount.get=function(){return this.next.length>>1};Pn.prototype.edge=function(e){var t=e<<1;if(t>=this.next.length)throw new RangeError("There's no "+e+"th edge in this content match");return{type:this.next[t],next:this.next[t+1]}};Pn.prototype.toString=function(){var e=[];function t(o){e.push(o);for(var a=1;a<o.next.length;a+=2)e.indexOf(o.next[a])==-1&&t(o.next[a])}return t(this),e.map(function(o,a){for(var l=a+(o.validEnd?"*":" ")+" ",d=0;d<o.next.length;d+=2)l+=(d?", ":"")+o.next[d].name+"->"+e.indexOf(o.next[d+1]);return l}).join(`
`)};Object.defineProperties(Pn.prototype,ph);Pn.empty=new Pn(!0);var Ah=function(e,t){this.string=e,this.nodeTypes=t,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()},R_={next:{configurable:!0}};R_.next.get=function(){return this.tokens[this.pos]};Ah.prototype.eat=function(e){return this.next==e&&(this.pos++||!0)};Ah.prototype.err=function(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")};Object.defineProperties(Ah.prototype,R_);function w_(n){var e=[];do e.push(MP(n));while(n.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function MP(n){var e=[];do e.push(LP(n));while(n.next&&n.next!=")"&&n.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function LP(n){for(var e=xP(n);;)if(n.eat("+"))e={type:"plus",expr:e};else if(n.eat("*"))e={type:"star",expr:e};else if(n.eat("?"))e={type:"opt",expr:e};else if(n.eat("{"))e=PP(n,e);else break;return e}function N_(n){/\D/.test(n.next)&&n.err("Expected number, got '"+n.next+"'");var e=Number(n.next);return n.pos++,e}function PP(n,e){var t=N_(n),o=t;return n.eat(",")&&(n.next!="}"?o=N_(n):o=-1),n.eat("}")||n.err("Unclosed braced range"),{type:"range",min:t,max:o,expr:e}}function QP(n,e){var t=n.nodeTypes,o=t[e];if(o)return[o];var a=[];for(var l in t){var d=t[l];d.groups.indexOf(e)>-1&&a.push(d)}return a.length==0&&n.err("No node type or group '"+e+"' found"),a}function xP(n){if(n.eat("(")){var e=w_(n);return n.eat(")")||n.err("Missing closing paren"),e}else if(/\W/.test(n.next))n.err("Unexpected token '"+n.next+"'");else{var t=QP(n,n.next).map(function(o){return n.inline==null?n.inline=o.isInline:n.inline!=o.isInline&&n.err("Mixing inline and block content"),{type:"name",value:o}});return n.pos++,t.length==1?t[0]:{type:"choice",exprs:t}}}function UP(n){var e=[[]];return a(l(n,0),t()),e;function t(){return e.push([])-1}function o(d,p,g){var v={term:g,to:p};return e[d].push(v),v}function a(d,p){d.forEach(function(g){return g.to=p})}function l(d,p){if(d.type=="choice")return d.exprs.reduce(function(K,F){return K.concat(l(F,p))},[]);if(d.type=="seq")for(var g=0;;g++){var v=l(d.exprs[g],p);if(g==d.exprs.length-1)return v;a(v,p=t())}else if(d.type=="star"){var C=t();return o(p,C),a(l(d.expr,C),C),[o(C)]}else if(d.type=="plus"){var y=t();return a(l(d.expr,p),y),a(l(d.expr,y),y),[o(y)]}else{if(d.type=="opt")return[o(p)].concat(l(d.expr,p));if(d.type=="range"){for(var w=p,O=0;O<d.min;O++){var M=t();a(l(d.expr,w),M),w=M}if(d.max==-1)a(l(d.expr,w),w);else for(var x=d.min;x<d.max;x++){var G=t();o(w,G),a(l(d.expr,w),G),w=G}return[o(w)]}else if(d.type=="name")return[o(p,null,d.value)]}}}function k_(n,e){return e-n}function O_(n,e){var t=[];return o(e),t.sort(k_);function o(a){var l=n[a];if(l.length==1&&!l[0].term)return o(l[0].to);t.push(a);for(var d=0;d<l.length;d++){var p=l[d],g=p.term,v=p.to;!g&&t.indexOf(v)==-1&&o(v)}}}function FP(n){var e=Object.create(null);return t(O_(n,0));function t(o){var a=[];o.forEach(function(g){n[g].forEach(function(v){var C=v.term,y=v.to;if(!!C){var w=a.indexOf(C),O=w>-1&&a[w+1];O_(n,y).forEach(function(M){O||a.push(C,O=[]),O.indexOf(M)==-1&&O.push(M)})}})});for(var l=e[o.join(",")]=new Pn(o.indexOf(n.length-1)>-1),d=0;d<a.length;d+=2){var p=a[d+1].sort(k_);l.next.push(a[d],e[p.join(",")]||t(p))}return l}}function VP(n,e){for(var t=0,o=[n];t<o.length;t++){for(var a=o[t],l=!a.validEnd,d=[],p=0;p<a.next.length;p+=2){var g=a.next[p],v=a.next[p+1];d.push(g.name),l&&!(g.isText||g.hasRequiredAttrs())&&(l=!1),o.indexOf(v)==-1&&o.push(v)}l&&e.err("Only non-generatable nodes ("+d.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function b_(n){var e=Object.create(null);for(var t in n){var o=n[t];if(!o.hasDefault)return null;e[t]=o.default}return e}function D_(n,e){var t=Object.create(null);for(var o in n){var a=e&&e[o];if(a===void 0){var l=n[o];if(l.hasDefault)a=l.default;else throw new RangeError("No value supplied for attribute "+o)}t[o]=a}return t}function B_(n){var e=Object.create(null);if(n)for(var t in n)e[t]=new M_(n[t]);return e}var mi=function(e,t,o){this.name=e,this.schema=t,this.spec=o,this.groups=o.group?o.group.split(" "):[],this.attrs=B_(o.attrs),this.defaultAttrs=b_(this.attrs),this.contentMatch=null,this.markSet=null,this.inlineContent=null,this.isBlock=!(o.inline||e=="text"),this.isText=e=="text"},ou={isInline:{configurable:!0},isTextblock:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};ou.isInline.get=function(){return!this.isBlock};ou.isTextblock.get=function(){return this.isBlock&&this.inlineContent};ou.isLeaf.get=function(){return this.contentMatch==Pn.empty};ou.isAtom.get=function(){return this.isLeaf||this.spec.atom};mi.prototype.hasRequiredAttrs=function(){for(var e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1};mi.prototype.compatibleContent=function(e){return this==e||this.contentMatch.compatible(e.contentMatch)};mi.prototype.computeAttrs=function(e){return!e&&this.defaultAttrs?this.defaultAttrs:D_(this.attrs,e)};mi.prototype.create=function(e,t,o){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Nt(this,this.computeAttrs(e),me.from(t),wt.setFrom(o))};mi.prototype.createChecked=function(e,t,o){if(t=me.from(t),!this.validContent(t))throw new RangeError("Invalid content for node "+this.name);return new Nt(this,this.computeAttrs(e),t,wt.setFrom(o))};mi.prototype.createAndFill=function(e,t,o){if(e=this.computeAttrs(e),t=me.from(t),t.size){var a=this.contentMatch.fillBefore(t);if(!a)return null;t=a.append(t)}var l=this.contentMatch.matchFragment(t).fillBefore(me.empty,!0);return l?new Nt(this,e,t.append(l),wt.setFrom(o)):null};mi.prototype.validContent=function(e){var t=this.contentMatch.matchFragment(e);if(!t||!t.validEnd)return!1;for(var o=0;o<e.childCount;o++)if(!this.allowsMarks(e.child(o).marks))return!1;return!0};mi.prototype.allowsMarkType=function(e){return this.markSet==null||this.markSet.indexOf(e)>-1};mi.prototype.allowsMarks=function(e){if(this.markSet==null)return!0;for(var t=0;t<e.length;t++)if(!this.allowsMarkType(e[t].type))return!1;return!0};mi.prototype.allowedMarks=function(e){if(this.markSet==null)return e;for(var t,o=0;o<e.length;o++)this.allowsMarkType(e[o].type)?t&&t.push(e[o]):t||(t=e.slice(0,o));return t?t.length?t:wt.empty:e};mi.compile=function(e,t){var o=Object.create(null);e.forEach(function(d,p){return o[d]=new mi(d,t,p)});var a=t.spec.topNode||"doc";if(!o[a])throw new RangeError("Schema is missing its top node type ('"+a+"')");if(!o.text)throw new RangeError("Every schema needs a 'text' type");for(var l in o.text.attrs)throw new RangeError("The text node type should not have attributes");return o};Object.defineProperties(mi.prototype,ou);var M_=function(e){this.hasDefault=Object.prototype.hasOwnProperty.call(e,"default"),this.default=e.default},L_={isRequired:{configurable:!0}};L_.isRequired.get=function(){return!this.hasDefault};Object.defineProperties(M_.prototype,L_);var Ia=function(e,t,o,a){this.name=e,this.schema=o,this.spec=a,this.attrs=B_(a.attrs),this.rank=t,this.excluded=null;var l=b_(this.attrs);this.instance=l&&new wt(this,l)};Ia.prototype.create=function(e){return!e&&this.instance?this.instance:new wt(this,D_(this.attrs,e))};Ia.compile=function(e,t){var o=Object.create(null),a=0;return e.forEach(function(l,d){return o[l]=new Ia(l,a++,t,d)}),o};Ia.prototype.removeFromSet=function(e){for(var t=0;t<e.length;t++)e[t].type==this&&(e=e.slice(0,t).concat(e.slice(t+1)),t--);return e};Ia.prototype.isInSet=function(e){for(var t=0;t<e.length;t++)if(e[t].type==this)return e[t]};Ia.prototype.excludes=function(e){return this.excluded.indexOf(e)>-1};var dg={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},GP={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},P_={ol:!0,ul:!0},hg=1,pg=2,su=4;function Q_(n){return(n?hg:0)|(n==="full"?pg:0)}var Zo=function(e,t,o,a,l,d,p){this.type=e,this.attrs=t,this.solid=l,this.match=d||(p&su?null:e.contentMatch),this.options=p,this.content=[],this.marks=o,this.activeMarks=wt.none,this.pendingMarks=a,this.stashMarks=[]};Zo.prototype.findWrapping=function(e){if(!this.match){if(!this.type)return[];var t=this.type.contentMatch.fillBefore(me.from(e));if(t)this.match=this.type.contentMatch.matchFragment(t);else{var o=this.type.contentMatch,a;return(a=o.findWrapping(e.type))?(this.match=o,a):null}}return this.match.findWrapping(e.type)};Zo.prototype.finish=function(e){if(!(this.options&hg)){var t=this.content[this.content.length-1],o;t&&t.isText&&(o=/[ \t\r\n\u000c]+$/.exec(t.text))&&(t.text.length==o[0].length?this.content.pop():this.content[this.content.length-1]=t.withText(t.text.slice(0,t.text.length-o[0].length)))}var a=me.from(this.content);return!e&&this.match&&(a=a.append(this.match.fillBefore(me.empty,!0))),this.type?this.type.create(this.attrs,a,this.marks):a};Zo.prototype.popFromStashMark=function(e){for(var t=this.stashMarks.length-1;t>=0;t--)if(e.eq(this.stashMarks[t]))return this.stashMarks.splice(t,1)[0]};Zo.prototype.applyPending=function(e){for(var t=0,o=this.pendingMarks;t<o.length;t++){var a=o[t];(this.type?this.type.allowsMarkType(a.type):KP(a.type,e))&&!a.isInSet(this.activeMarks)&&(this.activeMarks=a.addToSet(this.activeMarks),this.pendingMarks=a.removeFromSet(this.pendingMarks))}};Zo.prototype.inlineContext=function(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!dg.hasOwnProperty(e.parentNode.nodeName.toLowerCase())};var nr=function(e,t,o){this.parser=e,this.options=t,this.isOpen=o;var a=t.topNode,l,d=Q_(t.preserveWhitespace)|(o?su:0);a?l=new Zo(a.type,a.attrs,wt.none,wt.none,!0,t.topMatch||a.type.contentMatch,d):o?l=new Zo(null,null,wt.none,wt.none,!0,null,d):l=new Zo(e.schema.topNodeType,null,wt.none,wt.none,!0,null,d),this.nodes=[l],this.open=0,this.find=t.findPositions,this.needsBlock=!1},Ag={top:{configurable:!0},currentPos:{configurable:!0}};Ag.top.get=function(){return this.nodes[this.open]};nr.prototype.addDOM=function(e){if(e.nodeType==3)this.addTextNode(e);else if(e.nodeType==1){var t=e.getAttribute("style"),o=t?this.readStyles(HP(t)):null,a=this.top;if(o!=null)for(var l=0;l<o.length;l++)this.addPendingMark(o[l]);if(this.addElement(e),o!=null)for(var d=0;d<o.length;d++)this.removePendingMark(o[d],a)}};nr.prototype.addTextNode=function(e){var t=e.nodeValue,o=this.top;if(o.options&pg||o.inlineContext(e)||/[^ \t\r\n\u000c]/.test(t)){if(o.options&hg)o.options&pg?t=t.replace(/\r\n?/g,`
`):t=t.replace(/\r?\n|\r/g," ");else if(t=t.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(t)&&this.open==this.nodes.length-1){var a=o.content[o.content.length-1],l=e.previousSibling;(!a||l&&l.nodeName=="BR"||a.isText&&/[ \t\r\n\u000c]$/.test(a.text))&&(t=t.slice(1))}t&&this.insertNode(this.parser.schema.text(t)),this.findInText(e)}else this.findInside(e)};nr.prototype.addElement=function(e,t){var o=e.nodeName.toLowerCase(),a;P_.hasOwnProperty(o)&&this.parser.normalizeLists&&jP(e);var l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(a=this.parser.matchTag(e,this,t));if(l?l.ignore:GP.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);var d,p=this.top,g=this.needsBlock;if(dg.hasOwnProperty(o))d=!0,p.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e);return}this.addAll(e),d&&this.sync(p),this.needsBlock=g}else this.addElementByRule(e,l,l.consuming===!1?a:null)};nr.prototype.leafFallback=function(e){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`))};nr.prototype.ignoreFallback=function(e){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"))};nr.prototype.readStyles=function(e){var t=wt.none;e:for(var o=0;o<e.length;o+=2)for(var a=null;;){var l=this.parser.matchStyle(e[o],e[o+1],this,a);if(!l)continue e;if(l.ignore)return null;if(t=this.parser.schema.marks[l.mark].create(l.attrs).addToSet(t),l.consuming===!1)a=l;else break}return t};nr.prototype.addElementByRule=function(e,t,o){var a=this,l,d,p,g;t.node?(d=this.parser.schema.nodes[t.node],d.isLeaf?this.insertNode(d.create(t.attrs))||this.leafFallback(e):l=this.enter(d,t.attrs,t.preserveWhitespace)):(p=this.parser.schema.marks[t.mark],g=p.create(t.attrs),this.addPendingMark(g));var v=this.top;if(d&&d.isLeaf)this.findInside(e);else if(o)this.addElement(e,o);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach(function(y){return a.insertNode(y)});else{var C=t.contentElement;typeof C=="string"?C=e.querySelector(C):typeof C=="function"&&(C=C(e)),C||(C=e),this.findAround(e,C,!0),this.addAll(C,l)}l&&(this.sync(v),this.open--),g&&this.removePendingMark(g,v)};nr.prototype.addAll=function(e,t,o,a){for(var l=o||0,d=o?e.childNodes[o]:e.firstChild,p=a==null?null:e.childNodes[a];d!=p;d=d.nextSibling,++l)this.findAtPoint(e,l),this.addDOM(d),t&&dg.hasOwnProperty(d.nodeName.toLowerCase())&&this.sync(t);this.findAtPoint(e,l)};nr.prototype.findPlace=function(e){for(var t,o,a=this.open;a>=0;a--){var l=this.nodes[a],d=l.findWrapping(e);if(d&&(!t||t.length>d.length)&&(t=d,o=l,!d.length)||l.solid)break}if(!t)return!1;this.sync(o);for(var p=0;p<t.length;p++)this.enterInner(t[p],null,!1);return!0};nr.prototype.insertNode=function(e){if(e.isInline&&this.needsBlock&&!this.top.type){var t=this.textblockFromContext();t&&this.enterInner(t)}if(this.findPlace(e)){this.closeExtra();var o=this.top;o.applyPending(e.type),o.match&&(o.match=o.match.matchType(e.type));for(var a=o.activeMarks,l=0;l<e.marks.length;l++)(!o.type||o.type.allowsMarkType(e.marks[l].type))&&(a=e.marks[l].addToSet(a));return o.content.push(e.mark(a)),!0}return!1};nr.prototype.enter=function(e,t,o){var a=this.findPlace(e.create(t));return a&&this.enterInner(e,t,!0,o),a};nr.prototype.enterInner=function(e,t,o,a){this.closeExtra();var l=this.top;l.applyPending(e),l.match=l.match&&l.match.matchType(e,t);var d=a==null?l.options&~su:Q_(a);l.options&su&&l.content.length==0&&(d|=su),this.nodes.push(new Zo(e,t,l.activeMarks,l.pendingMarks,o,null,d)),this.open++};nr.prototype.closeExtra=function(e){var t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}};nr.prototype.finish=function(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)};nr.prototype.sync=function(e){for(var t=this.open;t>=0;t--)if(this.nodes[t]==e){this.open=t;return}};Ag.currentPos.get=function(){this.closeExtra();for(var n=0,e=this.open;e>=0;e--){for(var t=this.nodes[e].content,o=t.length-1;o>=0;o--)n+=t[o].nodeSize;e&&n++}return n};nr.prototype.findAtPoint=function(e,t){if(this.find)for(var o=0;o<this.find.length;o++)this.find[o].node==e&&this.find[o].offset==t&&(this.find[o].pos=this.currentPos)};nr.prototype.findInside=function(e){if(this.find)for(var t=0;t<this.find.length;t++)this.find[t].pos==null&&e.nodeType==1&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)};nr.prototype.findAround=function(e,t,o){if(e!=t&&this.find){for(var a=0;a<this.find.length;a++)if(this.find[a].pos==null&&e.nodeType==1&&e.contains(this.find[a].node)){var l=t.compareDocumentPosition(this.find[a].node);l&(o?2:4)&&(this.find[a].pos=this.currentPos)}}};nr.prototype.findInText=function(e){if(this.find)for(var t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))};nr.prototype.matchesContext=function(e){var t=this;if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);var o=e.split("/"),a=this.options.context,l=!this.isOpen&&(!a||a.parent.type==this.nodes[0].type),d=-(a?a.depth+1:0)+(l?0:1),p=function(g,v){for(;g>=0;g--){var C=o[g];if(C==""){if(g==o.length-1||g==0)continue;for(;v>=d;v--)if(p(g-1,v))return!0;return!1}else{var y=v>0||v==0&&l?t.nodes[v].type:a&&v>=d?a.node(v-d).type:null;if(!y||y.name!=C&&y.groups.indexOf(C)==-1)return!1;v--}}return!0};return p(o.length-1,this.open)};nr.prototype.textblockFromContext=function(){var e=this.options.context;if(e)for(var t=e.depth;t>=0;t--){var o=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(o&&o.isTextblock&&o.defaultAttrs)return o}for(var a in this.parser.schema.nodes){var l=this.parser.schema.nodes[a];if(l.isTextblock&&l.defaultAttrs)return l}};nr.prototype.addPendingMark=function(e){var t=WP(e,this.top.pendingMarks);t&&this.top.stashMarks.push(t),this.top.pendingMarks=e.addToSet(this.top.pendingMarks)};nr.prototype.removePendingMark=function(e,t){for(var o=this.open;o>=0;o--){var a=this.nodes[o],l=a.pendingMarks.lastIndexOf(e);if(l>-1)a.pendingMarks=e.removeFromSet(a.pendingMarks);else{a.activeMarks=e.removeFromSet(a.activeMarks);var d=a.popFromStashMark(e);d&&a.type&&a.type.allowsMarkType(d.type)&&(a.activeMarks=d.addToSet(a.activeMarks))}if(a==t)break}};Object.defineProperties(nr.prototype,Ag);function jP(n){for(var e=n.firstChild,t=null;e;e=e.nextSibling){var o=e.nodeType==1?e.nodeName.toLowerCase():null;o&&P_.hasOwnProperty(o)&&t?(t.appendChild(e),e=t):o=="li"?t=e:o&&(t=null)}}function HP(n){for(var e=/\s*([\w-]+)\s*:\s*([^;]+)/g,t,o=[];t=e.exec(n);)o.push(t[1],t[2].trim());return o}function KP(n,e){var t=e.schema.nodes,o=function(d){var p=t[d];if(!!p.allowsMarkType(n)){var g=[],v=function(C){g.push(C);for(var y=0;y<C.edgeCount;y++){var w=C.edge(y),O=w.type,M=w.next;if(O==e||g.indexOf(M)<0&&v(M))return!0}};if(v(p.contentMatch))return{v:!0}}};for(var a in t){var l=o(a);if(l)return l.v}}function WP(n,e){for(var t=0;t<e.length;t++)if(n.eq(e[t]))return e[t]}var x_=65535,U_=Math.pow(2,16);function YP(n,e){return n+e*U_}function F_(n){return n&x_}function qP(n){return(n-(n&x_))/U_}var fg=function(e,t,o){t===void 0&&(t=!1),o===void 0&&(o=null),this.pos=e,this.deleted=t,this.recover=o},un=function(e,t){t===void 0&&(t=!1),this.ranges=e,this.inverted=t};un.prototype.recover=function(e){var t=0,o=F_(e);if(!this.inverted)for(var a=0;a<o;a++)t+=this.ranges[a*3+2]-this.ranges[a*3+1];return this.ranges[o*3]+t+qP(e)};un.prototype.mapResult=function(e,t){return t===void 0&&(t=1),this._map(e,t,!1)};un.prototype.map=function(e,t){return t===void 0&&(t=1),this._map(e,t,!0)};un.prototype._map=function(e,t,o){for(var a=0,l=this.inverted?2:1,d=this.inverted?1:2,p=0;p<this.ranges.length;p+=3){var g=this.ranges[p]-(this.inverted?a:0);if(g>e)break;var v=this.ranges[p+l],C=this.ranges[p+d],y=g+v;if(e<=y){var w=v?e==g?-1:e==y?1:t:t,O=g+a+(w<0?0:C);if(o)return O;var M=e==(t<0?g:y)?null:YP(p/3,e-g);return new fg(O,t<0?e!=g:e!=y,M)}a+=C-v}return o?e+a:new fg(e+a)};un.prototype.touches=function(e,t){for(var o=0,a=F_(t),l=this.inverted?2:1,d=this.inverted?1:2,p=0;p<this.ranges.length;p+=3){var g=this.ranges[p]-(this.inverted?o:0);if(g>e)break;var v=this.ranges[p+l],C=g+v;if(e<=C&&p==a*3)return!0;o+=this.ranges[p+d]-v}return!1};un.prototype.forEach=function(e){for(var t=this.inverted?2:1,o=this.inverted?1:2,a=0,l=0;a<this.ranges.length;a+=3){var d=this.ranges[a],p=d-(this.inverted?l:0),g=d+(this.inverted?0:l),v=this.ranges[a+t],C=this.ranges[a+o];e(p,p+v,g,g+C),l+=C-v}};un.prototype.invert=function(){return new un(this.ranges,!this.inverted)};un.prototype.toString=function(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)};un.offset=function(e){return e==0?un.empty:new un(e<0?[0,-e,0]:[0,0,e])};un.empty=new un([]);var Qn=function(e,t,o,a){this.maps=e||[],this.from=o||0,this.to=a==null?this.maps.length:a,this.mirror=t};Qn.prototype.slice=function(e,t){return e===void 0&&(e=0),t===void 0&&(t=this.maps.length),new Qn(this.maps,this.mirror,e,t)};Qn.prototype.copy=function(){return new Qn(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)};Qn.prototype.appendMap=function(e,t){this.to=this.maps.push(e),t!=null&&this.setMirror(this.maps.length-1,t)};Qn.prototype.appendMapping=function(e){for(var t=0,o=this.maps.length;t<e.maps.length;t++){var a=e.getMirror(t);this.appendMap(e.maps[t],a!=null&&a<t?o+a:null)}};Qn.prototype.getMirror=function(e){if(this.mirror){for(var t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}};Qn.prototype.setMirror=function(e,t){this.mirror||(this.mirror=[]),this.mirror.push(e,t)};Qn.prototype.appendMappingInverted=function(e){for(var t=e.maps.length-1,o=this.maps.length+e.maps.length;t>=0;t--){var a=e.getMirror(t);this.appendMap(e.maps[t].invert(),a!=null&&a>t?o-a-1:null)}};Qn.prototype.invert=function(){var e=new Qn;return e.appendMappingInverted(this),e};Qn.prototype.map=function(e,t){if(t===void 0&&(t=1),this.mirror)return this._map(e,t,!0);for(var o=this.from;o<this.to;o++)e=this.maps[o].map(e,t);return e};Qn.prototype.mapResult=function(e,t){return t===void 0&&(t=1),this._map(e,t,!1)};Qn.prototype._map=function(e,t,o){for(var a=!1,l=this.from;l<this.to;l++){var d=this.maps[l],p=d.mapResult(e,t);if(p.recover!=null){var g=this.getMirror(l);if(g!=null&&g>l&&g<this.to){l=g,e=this.maps[g].recover(p.recover);continue}}p.deleted&&(a=!0),e=p.pos}return o?e:new fg(e,a)};function Lc(n){var e=Error.call(this,n);return e.__proto__=Lc.prototype,e}Lc.prototype=Object.create(Error.prototype);Lc.prototype.constructor=Lc;Lc.prototype.name="TransformError";var Ir=function(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new Qn},gg={before:{configurable:!0},docChanged:{configurable:!0}};gg.before.get=function(){return this.docs.length?this.docs[0]:this.doc};Ir.prototype.step=function(e){var t=this.maybeStep(e);if(t.failed)throw new Lc(t.failed);return this};Ir.prototype.maybeStep=function(e){var t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t};gg.docChanged.get=function(){return this.steps.length>0};Ir.prototype.addStep=function(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t};Object.defineProperties(Ir.prototype,gg);function fh(){throw new Error("Override me")}var mg=Object.create(null),_n=function(){};_n.prototype.apply=function(e){return fh()};_n.prototype.getMap=function(){return un.empty};_n.prototype.invert=function(e){return fh()};_n.prototype.map=function(e){return fh()};_n.prototype.merge=function(e){return null};_n.prototype.toJSON=function(){return fh()};_n.fromJSON=function(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");var o=mg[t.stepType];if(!o)throw new RangeError("No step type "+t.stepType+" defined");return o.fromJSON(e,t)};_n.jsonID=function(e,t){if(e in mg)throw new RangeError("Duplicate use of step JSON ID "+e);return mg[e]=t,t.prototype.jsonID=e,t};var xn=function(e,t){this.doc=e,this.failed=t};xn.ok=function(e){return new xn(e,null)};xn.fail=function(e){return new xn(null,e)};xn.fromReplace=function(e,t,o,a){try{return xn.ok(e.replace(t,o,a))}catch(l){if(l instanceof Oo)return xn.fail(l.message);throw l}};var Ns=function(n){function e(t,o,a,l){n.call(this),this.from=t,this.to=o,this.slice=a,this.structure=!!l}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.apply=function(o){return this.structure&&vg(o,this.from,this.to)?xn.fail("Structure replace would overwrite content"):xn.fromReplace(o,this.from,this.to,this.slice)},e.prototype.getMap=function(){return new un([this.from,this.to-this.from,this.slice.size])},e.prototype.invert=function(o){return new e(this.from,this.from+this.slice.size,o.slice(this.from,this.to))},e.prototype.map=function(o){var a=o.mapResult(this.from,1),l=o.mapResult(this.to,-1);return a.deleted&&l.deleted?null:new e(a.pos,Math.max(a.pos,l.pos),this.slice)},e.prototype.merge=function(o){if(!(o instanceof e)||o.structure||this.structure)return null;if(this.from+this.slice.size==o.from&&!this.slice.openEnd&&!o.slice.openStart){var a=this.slice.size+o.slice.size==0?Ue.empty:new Ue(this.slice.content.append(o.slice.content),this.slice.openStart,o.slice.openEnd);return new e(this.from,this.to+(o.to-o.from),a,this.structure)}else if(o.to==this.from&&!this.slice.openStart&&!o.slice.openEnd){var l=this.slice.size+o.slice.size==0?Ue.empty:new Ue(o.slice.content.append(this.slice.content),o.slice.openStart,this.slice.openEnd);return new e(o.from,this.to,l,this.structure)}else return null},e.prototype.toJSON=function(){var o={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(o.slice=this.slice.toJSON()),this.structure&&(o.structure=!0),o},e.fromJSON=function(o,a){if(typeof a.from!="number"||typeof a.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new e(a.from,a.to,Ue.fromJSON(o,a.slice),!!a.structure)},e}(_n);_n.jsonID("replace",Ns);var Ca=function(n){function e(t,o,a,l,d,p,g){n.call(this),this.from=t,this.to=o,this.gapFrom=a,this.gapTo=l,this.slice=d,this.insert=p,this.structure=!!g}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.apply=function(o){if(this.structure&&(vg(o,this.from,this.gapFrom)||vg(o,this.gapTo,this.to)))return xn.fail("Structure gap-replace would overwrite content");var a=o.slice(this.gapFrom,this.gapTo);if(a.openStart||a.openEnd)return xn.fail("Gap is not a flat range");var l=this.slice.insertAt(this.insert,a.content);return l?xn.fromReplace(o,this.from,this.to,l):xn.fail("Content does not fit in gap")},e.prototype.getMap=function(){return new un([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])},e.prototype.invert=function(o){var a=this.gapTo-this.gapFrom;return new e(this.from,this.from+this.slice.size+a,this.from+this.insert,this.from+this.insert+a,o.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)},e.prototype.map=function(o){var a=o.mapResult(this.from,1),l=o.mapResult(this.to,-1),d=o.map(this.gapFrom,-1),p=o.map(this.gapTo,1);return a.deleted&&l.deleted||d<a.pos||p>l.pos?null:new e(a.pos,l.pos,d,p,this.slice,this.insert,this.structure)},e.prototype.toJSON=function(){var o={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(o.slice=this.slice.toJSON()),this.structure&&(o.structure=!0),o},e.fromJSON=function(o,a){if(typeof a.from!="number"||typeof a.to!="number"||typeof a.gapFrom!="number"||typeof a.gapTo!="number"||typeof a.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new e(a.from,a.to,a.gapFrom,a.gapTo,Ue.fromJSON(o,a.slice),a.insert,!!a.structure)},e}(_n);_n.jsonID("replaceAround",Ca);function vg(n,e,t){for(var o=n.resolve(e),a=t-e,l=o.depth;a>0&&l>0&&o.indexAfter(l)==o.node(l).childCount;)l--,a--;if(a>0)for(var d=o.node(l).maybeChild(o.indexAfter(l));a>0;){if(!d||d.isLeaf)return!0;d=d.firstChild,a--}return!1}Ir.prototype.lift=function(n,e){for(var t=n.$from,o=n.$to,a=n.depth,l=t.before(a+1),d=o.after(a+1),p=l,g=d,v=me.empty,C=0,y=a,w=!1;y>e;y--)w||t.index(y)>0?(w=!0,v=me.from(t.node(y).copy(v)),C++):p--;for(var O=me.empty,M=0,x=a,G=!1;x>e;x--)G||o.after(x+1)<o.end(x)?(G=!0,O=me.from(o.node(x).copy(O)),M++):g++;return this.step(new Ca(p,g,l,d,new Ue(v.append(O),C,M),v.size-C,!0))};Ir.prototype.wrap=function(n,e){for(var t=me.empty,o=e.length-1;o>=0;o--)t=me.from(e[o].type.create(e[o].attrs,t));var a=n.start,l=n.end;return this.step(new Ca(a,l,a,l,new Ue(t,0,0),e.length,!0))};Ir.prototype.setBlockType=function(n,e,t,o){var a=this;if(e===void 0&&(e=n),!t.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");var l=this.steps.length;return this.doc.nodesBetween(n,e,function(d,p){if(d.isTextblock&&!d.hasMarkup(t,o)&&JP(a.doc,a.mapping.slice(l).map(p),t)){a.clearIncompatible(a.mapping.slice(l).map(p,1),t);var g=a.mapping.slice(l),v=g.map(p,1),C=g.map(p+d.nodeSize,1);return a.step(new Ca(v,C,v+1,C-1,new Ue(me.from(t.create(o,null,d.marks)),0,0),1,!0)),!1}}),this};function JP(n,e,t){var o=n.resolve(e),a=o.index();return o.parent.canReplaceWith(a,a+1,t)}Ir.prototype.setNodeMarkup=function(n,e,t,o){var a=this.doc.nodeAt(n);if(!a)throw new RangeError("No node at given position");e||(e=a.type);var l=e.create(t,null,o||a.marks);if(a.isLeaf)return this.replaceWith(n,n+a.nodeSize,l);if(!e.validContent(a.content))throw new RangeError("Invalid content for node type "+e.name);return this.step(new Ca(n,n+a.nodeSize,n+1,n+a.nodeSize-1,new Ue(me.from(l),0,0),1,!0))};Ir.prototype.split=function(n,e,t){e===void 0&&(e=1);for(var o=this.doc.resolve(n),a=me.empty,l=me.empty,d=o.depth,p=o.depth-e,g=e-1;d>p;d--,g--){a=me.from(o.node(d).copy(a));var v=t&&t[g];l=me.from(v?v.type.create(v.attrs,l):o.node(d).copy(l))}return this.step(new Ns(n,n,new Ue(a.append(l),e,e),!0))};Ir.prototype.join=function(n,e){e===void 0&&(e=1);var t=new Ns(n-e,n+e,Ue.empty,!0);return this.step(t)};function zP(n,e,t){var o=n.resolve(e);if(o.parent.canReplaceWith(o.index(),o.index(),t))return e;if(o.parentOffset==0)for(var a=o.depth-1;a>=0;a--){var l=o.index(a);if(o.node(a).canReplaceWith(l,l,t))return o.before(a+1);if(l>0)return null}if(o.parentOffset==o.parent.content.size)for(var d=o.depth-1;d>=0;d--){var p=o.indexAfter(d);if(o.node(d).canReplaceWith(p,p,t))return o.after(d+1);if(p<o.node(d).childCount)return null}}function Eg(n,e,t){for(var o=[],a=0;a<n.childCount;a++){var l=n.child(a);l.content.size&&(l=l.copy(Eg(l.content,e,l))),l.isInline&&(l=e(l,t,a)),o.push(l)}return me.fromArray(o)}var Ig=function(n){function e(t,o,a){n.call(this),this.from=t,this.to=o,this.mark=a}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.apply=function(o){var a=this,l=o.slice(this.from,this.to),d=o.resolve(this.from),p=d.node(d.sharedDepth(this.to)),g=new Ue(Eg(l.content,function(v,C){return!v.isAtom||!C.type.allowsMarkType(a.mark.type)?v:v.mark(a.mark.addToSet(v.marks))},p),l.openStart,l.openEnd);return xn.fromReplace(o,this.from,this.to,g)},e.prototype.invert=function(){return new au(this.from,this.to,this.mark)},e.prototype.map=function(o){var a=o.mapResult(this.from,1),l=o.mapResult(this.to,-1);return a.deleted&&l.deleted||a.pos>=l.pos?null:new e(a.pos,l.pos,this.mark)},e.prototype.merge=function(o){if(o instanceof e&&o.mark.eq(this.mark)&&this.from<=o.to&&this.to>=o.from)return new e(Math.min(this.from,o.from),Math.max(this.to,o.to),this.mark)},e.prototype.toJSON=function(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},e.fromJSON=function(o,a){if(typeof a.from!="number"||typeof a.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new e(a.from,a.to,o.markFromJSON(a.mark))},e}(_n);_n.jsonID("addMark",Ig);var au=function(n){function e(t,o,a){n.call(this),this.from=t,this.to=o,this.mark=a}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.apply=function(o){var a=this,l=o.slice(this.from,this.to),d=new Ue(Eg(l.content,function(p){return p.mark(a.mark.removeFromSet(p.marks))}),l.openStart,l.openEnd);return xn.fromReplace(o,this.from,this.to,d)},e.prototype.invert=function(){return new Ig(this.from,this.to,this.mark)},e.prototype.map=function(o){var a=o.mapResult(this.from,1),l=o.mapResult(this.to,-1);return a.deleted&&l.deleted||a.pos>=l.pos?null:new e(a.pos,l.pos,this.mark)},e.prototype.merge=function(o){if(o instanceof e&&o.mark.eq(this.mark)&&this.from<=o.to&&this.to>=o.from)return new e(Math.min(this.from,o.from),Math.max(this.to,o.to),this.mark)},e.prototype.toJSON=function(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},e.fromJSON=function(o,a){if(typeof a.from!="number"||typeof a.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new e(a.from,a.to,o.markFromJSON(a.mark))},e}(_n);_n.jsonID("removeMark",au);Ir.prototype.addMark=function(n,e,t){var o=this,a=[],l=[],d=null,p=null;return this.doc.nodesBetween(n,e,function(g,v,C){if(!!g.isInline){var y=g.marks;if(!t.isInSet(y)&&C.type.allowsMarkType(t.type)){for(var w=Math.max(v,n),O=Math.min(v+g.nodeSize,e),M=t.addToSet(y),x=0;x<y.length;x++)y[x].isInSet(M)||(d&&d.to==w&&d.mark.eq(y[x])?d.to=O:a.push(d=new au(w,O,y[x])));p&&p.to==w?p.to=O:l.push(p=new Ig(w,O,t))}}}),a.forEach(function(g){return o.step(g)}),l.forEach(function(g){return o.step(g)}),this};Ir.prototype.removeMark=function(n,e,t){var o=this;t===void 0&&(t=null);var a=[],l=0;return this.doc.nodesBetween(n,e,function(d,p){if(!!d.isInline){l++;var g=null;if(t instanceof Ia)for(var v=d.marks,C;C=t.isInSet(v);)(g||(g=[])).push(C),v=C.removeFromSet(v);else t?t.isInSet(d.marks)&&(g=[t]):g=d.marks;if(g&&g.length)for(var y=Math.min(p+d.nodeSize,e),w=0;w<g.length;w++){for(var O=g[w],M=void 0,x=0;x<a.length;x++){var G=a[x];G.step==l-1&&O.eq(a[x].style)&&(M=G)}M?(M.to=y,M.step=l):a.push({style:O,from:Math.max(p,n),to:y,step:l})}}}),a.forEach(function(d){return o.step(new au(d.from,d.to,d.style))}),this};Ir.prototype.clearIncompatible=function(n,e,t){t===void 0&&(t=e.contentMatch);for(var o=this.doc.nodeAt(n),a=[],l=n+1,d=0;d<o.childCount;d++){var p=o.child(d),g=l+p.nodeSize,v=t.matchType(p.type,p.attrs);if(!v)a.push(new Ns(l,g,Ue.empty));else{t=v;for(var C=0;C<p.marks.length;C++)e.allowsMarkType(p.marks[C].type)||this.step(new au(l,g,p.marks[C]))}l=g}if(!t.validEnd){var y=t.fillBefore(me.empty,!0);this.replace(l,l,new Ue(y,0,0))}for(var w=a.length-1;w>=0;w--)this.step(a[w]);return this};function XP(n,e,t,o){if(t===void 0&&(t=e),o===void 0&&(o=Ue.empty),e==t&&!o.size)return null;var a=n.resolve(e),l=n.resolve(t);return V_(a,l,o)?new Ns(e,t,o):new Fi(a,l,o).fit()}Ir.prototype.replace=function(n,e,t){e===void 0&&(e=n),t===void 0&&(t=Ue.empty);var o=XP(this.doc,n,e,t);return o&&this.step(o),this};Ir.prototype.replaceWith=function(n,e,t){return this.replace(n,e,new Ue(me.from(t),0,0))};Ir.prototype.delete=function(n,e){return this.replace(n,e,Ue.empty)};Ir.prototype.insert=function(n,e){return this.replaceWith(n,n,e)};function V_(n,e,t){return!t.openStart&&!t.openEnd&&n.start()==e.start()&&n.parent.canReplace(n.index(),e.index(),t.content)}var Fi=function(e,t,o){this.$to=t,this.$from=e,this.unplaced=o,this.frontier=[];for(var a=0;a<=e.depth;a++){var l=e.node(a);this.frontier.push({type:l.type,match:l.contentMatchAt(e.indexAfter(a))})}this.placed=me.empty;for(var d=e.depth;d>0;d--)this.placed=me.from(e.node(d).copy(this.placed))},G_={depth:{configurable:!0}};G_.depth.get=function(){return this.frontier.length-1};Fi.prototype.fit=function(){for(;this.unplaced.size;){var e=this.findFittable();e?this.placeNodes(e):this.openMore()||this.dropNode()}var t=this.mustMoveInline(),o=this.placed.size-this.depth-this.$from.depth,a=this.$from,l=this.close(t<0?this.$to:a.doc.resolve(t));if(!l)return null;for(var d=this.placed,p=a.depth,g=l.depth;p&&g&&d.childCount==1;)d=d.firstChild.content,p--,g--;var v=new Ue(d,p,g);if(t>-1)return new Ca(a.pos,t,this.$to.pos,this.$to.end(),v,o);if(v.size||a.pos!=this.$to.pos)return new Ns(a.pos,l.pos,v)};Fi.prototype.findFittable=function(){for(var e=1;e<=2;e++)for(var t=this.unplaced.openStart;t>=0;t--){var o=void 0,a=void 0;t?(a=Cg(this.unplaced.content,t-1).firstChild,o=a.content):o=this.unplaced.content;for(var l=o.firstChild,d=this.depth;d>=0;d--){var p=this.frontier[d],g=p.type,v=p.match,C=void 0,y=void 0;if(e==1&&(l?v.matchType(l.type)||(y=v.fillBefore(me.from(l),!1)):g.compatibleContent(a.type)))return{sliceDepth:t,frontierDepth:d,parent:a,inject:y};if(e==2&&l&&(C=v.findWrapping(l.type)))return{sliceDepth:t,frontierDepth:d,parent:a,wrap:C};if(a&&v.matchType(a.type))break}}};Fi.prototype.openMore=function(){var e=this.unplaced,t=e.content,o=e.openStart,a=e.openEnd,l=Cg(t,o);return!l.childCount||l.firstChild.isLeaf?!1:(this.unplaced=new Ue(t,o+1,Math.max(a,l.size+o>=t.size-a?o+1:0)),!0)};Fi.prototype.dropNode=function(){var e=this.unplaced,t=e.content,o=e.openStart,a=e.openEnd,l=Cg(t,o);if(l.childCount<=1&&o>0){var d=t.size-o<=o+l.size;this.unplaced=new Ue(cu(t,o-1,1),o-1,d?o-1:a)}else this.unplaced=new Ue(cu(t,o,1),o,a)};Fi.prototype.placeNodes=function(e){for(var t=e.sliceDepth,o=e.frontierDepth,a=e.parent,l=e.inject,d=e.wrap;this.depth>o;)this.closeFrontierNode();if(d)for(var p=0;p<d.length;p++)this.openFrontierNode(d[p]);var g=this.unplaced,v=a?a.content:g.content,C=g.openStart-t,y=0,w=[],O=this.frontier[o],M=O.match,x=O.type;if(l){for(var G=0;G<l.childCount;G++)w.push(l.child(G));M=M.matchFragment(l)}for(var K=v.size+t-(g.content.size-g.openEnd);y<v.childCount;){var F=v.child(y),re=M.matchType(F.type);if(!re)break;y++,(y>1||C==0||F.content.size)&&(M=re,w.push(j_(F.mark(x.allowedMarks(F.marks)),y==1?C:0,y==v.childCount?K:-1)))}var Q=y==v.childCount;Q||(K=-1),this.placed=lu(this.placed,o,me.from(w)),this.frontier[o].match=M,Q&&K<0&&a&&a.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(var Ae=0,oe=v;Ae<K;Ae++){var Te=oe.lastChild;this.frontier.push({type:Te.type,match:Te.contentMatchAt(Te.childCount)}),oe=Te.content}this.unplaced=Q?t==0?Ue.empty:new Ue(cu(g.content,t-1,1),t-1,K<0?g.openEnd:t-1):new Ue(cu(g.content,t,y),g.openStart,g.openEnd)};Fi.prototype.mustMoveInline=function(){if(!this.$to.parent.isTextblock||this.$to.end()==this.$to.pos)return-1;var e=this.frontier[this.depth],t;if(!e.type.isTextblock||!yg(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;for(var o=this.$to,a=o.depth,l=this.$to.after(a);a>1&&l==this.$to.end(--a);)++l;return l};Fi.prototype.findCloseLevel=function(e){e:for(var t=Math.min(this.depth,e.depth);t>=0;t--){var o=this.frontier[t],a=o.match,l=o.type,d=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),p=yg(e,t,l,a,d);if(!!p){for(var g=t-1;g>=0;g--){var v=this.frontier[g],C=v.match,y=v.type,w=yg(e,g,y,C,!0);if(!w||w.childCount)continue e}return{depth:t,fit:p,move:d?e.doc.resolve(e.after(t+1)):e}}}};Fi.prototype.close=function(e){var t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=lu(this.placed,t.depth,t.fit)),e=t.move;for(var o=t.depth+1;o<=e.depth;o++){var a=e.node(o),l=a.type.contentMatch.fillBefore(a.content,!0,e.index(o));this.openFrontierNode(a.type,a.attrs,l)}return e};Fi.prototype.openFrontierNode=function(e,t,o){var a=this.frontier[this.depth];a.match=a.match.matchType(e),this.placed=lu(this.placed,this.depth,me.from(e.create(t,o))),this.frontier.push({type:e,match:e.contentMatch})};Fi.prototype.closeFrontierNode=function(){var e=this.frontier.pop(),t=e.match.fillBefore(me.empty,!0);t.childCount&&(this.placed=lu(this.placed,this.frontier.length,t))};Object.defineProperties(Fi.prototype,G_);function cu(n,e,t){return e==0?n.cutByIndex(t):n.replaceChild(0,n.firstChild.copy(cu(n.firstChild.content,e-1,t)))}function lu(n,e,t){return e==0?n.append(t):n.replaceChild(n.childCount-1,n.lastChild.copy(lu(n.lastChild.content,e-1,t)))}function Cg(n,e){for(var t=0;t<e;t++)n=n.firstChild.content;return n}function j_(n,e,t){if(e<=0)return n;var o=n.content;return e>1&&(o=o.replaceChild(0,j_(o.firstChild,e-1,o.childCount==1?t-1:0))),e>0&&(o=n.type.contentMatch.fillBefore(o).append(o),t<=0&&(o=o.append(n.type.contentMatch.matchFragment(o).fillBefore(me.empty,!0)))),n.copy(o)}function yg(n,e,t,o,a){var l=n.node(e),d=a?n.indexAfter(e):n.index(e);if(d==l.childCount&&!t.compatibleContent(l.type))return null;var p=o.fillBefore(l.content,!0,d);return p&&!ZP(t,l.content,d)?p:null}function ZP(n,e,t){for(var o=t;o<e.childCount;o++)if(!n.allowsMarks(e.child(o).marks))return!0;return!1}Ir.prototype.replaceRange=function(n,e,t){if(!t.size)return this.deleteRange(n,e);var o=this.doc.resolve(n),a=this.doc.resolve(e);if(V_(o,a,t))return this.step(new Ns(n,e,t));var l=K_(o,this.doc.resolve(e));l[l.length-1]==0&&l.pop();var d=-(o.depth+1);l.unshift(d);for(var p=o.depth,g=o.pos-1;p>0;p--,g--){var v=o.node(p).type.spec;if(v.defining||v.isolating)break;l.indexOf(p)>-1?d=p:o.before(p)==g&&l.splice(1,0,-p)}for(var C=l.indexOf(d),y=[],w=t.openStart,O=t.content,M=0;;M++){var x=O.firstChild;if(y.push(x),M==t.openStart)break;O=x.content}w>0&&y[w-1].type.spec.defining&&o.node(C).type!=y[w-1].type?w-=1:w>=2&&y[w-1].isTextblock&&y[w-2].type.spec.defining&&o.node(C).type!=y[w-2].type&&(w-=2);for(var G=t.openStart;G>=0;G--){var K=(G+w+1)%(t.openStart+1),F=y[K];if(!!F)for(var re=0;re<l.length;re++){var Q=l[(re+C)%l.length],Ae=!0;Q<0&&(Ae=!1,Q=-Q);var oe=o.node(Q-1),Te=o.index(Q-1);if(oe.canReplaceWith(Te,Te,F.type,F.marks))return this.replace(o.before(Q),Ae?a.after(Q):e,new Ue(H_(t.content,0,t.openStart,K),K,t.openEnd))}}for(var je=this.steps.length,We=l.length-1;We>=0&&(this.replace(n,e,t),!(this.steps.length>je));We--){var Oe=l[We];Oe<0||(n=o.before(Oe),e=a.after(Oe))}return this};function H_(n,e,t,o,a){if(e<t){var l=n.firstChild;n=n.replaceChild(0,l.copy(H_(l.content,e+1,t,o,l)))}if(e>o){var d=a.contentMatchAt(0),p=d.fillBefore(n).append(n);n=p.append(d.matchFragment(p).fillBefore(me.empty,!0))}return n}Ir.prototype.replaceRangeWith=function(n,e,t){if(!t.isInline&&n==e&&this.doc.resolve(n).parent.content.size){var o=zP(this.doc,n,t.type);o!=null&&(n=e=o)}return this.replaceRange(n,e,new Ue(me.from(t),0,0))};Ir.prototype.deleteRange=function(n,e){for(var t=this.doc.resolve(n),o=this.doc.resolve(e),a=K_(t,o),l=0;l<a.length;l++){var d=a[l],p=l==a.length-1;if(p&&d==0||t.node(d).type.contentMatch.validEnd)return this.delete(t.start(d),o.end(d));if(d>0&&(p||t.node(d-1).canReplace(t.index(d-1),o.indexAfter(d-1))))return this.delete(t.before(d),o.after(d))}for(var g=1;g<=t.depth&&g<=o.depth;g++)if(n-t.start(g)==t.depth-g&&e>t.end(g)&&o.end(g)-e!=o.depth-g)return this.delete(t.before(g),e);return this.delete(n,e)};function K_(n,e){for(var t=[],o=Math.min(n.depth,e.depth),a=o;a>=0;a--){var l=n.start(a);if(l<n.pos-(n.depth-a)||e.end(a)>e.pos+(e.depth-a)||n.node(a).type.spec.isolating||e.node(a).type.spec.isolating)break;(l==e.start(a)||a==n.depth&&a==e.depth&&n.parent.inlineContent&&e.parent.inlineContent&&a&&e.start(a-1)==l-1)&&t.push(a)}return t}var _g=Object.create(null),dr=function(e,t,o){this.ranges=o||[new $P(e.min(t),e.max(t))],this.$anchor=e,this.$head=t},ks={anchor:{configurable:!0},head:{configurable:!0},from:{configurable:!0},to:{configurable:!0},$from:{configurable:!0},$to:{configurable:!0},empty:{configurable:!0}};ks.anchor.get=function(){return this.$anchor.pos};ks.head.get=function(){return this.$head.pos};ks.from.get=function(){return this.$from.pos};ks.to.get=function(){return this.$to.pos};ks.$from.get=function(){return this.ranges[0].$from};ks.$to.get=function(){return this.ranges[0].$to};ks.empty.get=function(){for(var n=this.ranges,e=0;e<n.length;e++)if(n[e].$from.pos!=n[e].$to.pos)return!1;return!0};dr.prototype.content=function(){return this.$from.node(0).slice(this.from,this.to,!0)};dr.prototype.replace=function(e,t){t===void 0&&(t=Ue.empty);for(var o=t.content.lastChild,a=null,l=0;l<t.openEnd;l++)a=o,o=o.lastChild;for(var d=e.steps.length,p=this.ranges,g=0;g<p.length;g++){var v=p[g],C=v.$from,y=v.$to,w=e.mapping.slice(d);e.replaceRange(w.map(C.pos),w.map(y.pos),g?Ue.empty:t),g==0&&W_(e,d,(o?o.isInline:a&&a.isTextblock)?-1:1)}};dr.prototype.replaceWith=function(e,t){for(var o=e.steps.length,a=this.ranges,l=0;l<a.length;l++){var d=a[l],p=d.$from,g=d.$to,v=e.mapping.slice(o),C=v.map(p.pos),y=v.map(g.pos);l?e.deleteRange(C,y):(e.replaceRangeWith(C,y,t),W_(e,o,t.isInline?-1:1))}};dr.findFrom=function(e,t,o){var a=e.parent.inlineContent?new uu(e):Qc(e.node(0),e.parent,e.pos,e.index(),t,o);if(a)return a;for(var l=e.depth-1;l>=0;l--){var d=t<0?Qc(e.node(0),e.node(l),e.before(l+1),e.index(l),t,o):Qc(e.node(0),e.node(l),e.after(l+1),e.index(l)+1,t,o);if(d)return d}};dr.near=function(e,t){return t===void 0&&(t=1),this.findFrom(e,t)||this.findFrom(e,-t)||new hu(e.node(0))};dr.atStart=function(e){return Qc(e,e,0,0,1)||new hu(e)};dr.atEnd=function(e){return Qc(e,e,e.content.size,e.childCount,-1)||new hu(e)};dr.fromJSON=function(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");var o=_g[t.type];if(!o)throw new RangeError("No selection type "+t.type+" defined");return o.fromJSON(e,t)};dr.jsonID=function(e,t){if(e in _g)throw new RangeError("Duplicate use of selection JSON ID "+e);return _g[e]=t,t.prototype.jsonID=e,t};dr.prototype.getBookmark=function(){return uu.between(this.$anchor,this.$head).getBookmark()};Object.defineProperties(dr.prototype,ks);dr.prototype.visible=!0;var $P=function(e,t){this.$from=e,this.$to=t},uu=function(n){function e(o,a){a===void 0&&(a=o),n.call(this,o,a)}n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e;var t={$cursor:{configurable:!0}};return t.$cursor.get=function(){return this.$anchor.pos==this.$head.pos?this.$head:null},e.prototype.map=function(a,l){var d=a.resolve(l.map(this.head));if(!d.parent.inlineContent)return n.near(d);var p=a.resolve(l.map(this.anchor));return new e(p.parent.inlineContent?p:d,d)},e.prototype.replace=function(a,l){if(l===void 0&&(l=Ue.empty),n.prototype.replace.call(this,a,l),l==Ue.empty){var d=this.$from.marksAcross(this.$to);d&&a.ensureMarks(d)}},e.prototype.eq=function(a){return a instanceof e&&a.anchor==this.anchor&&a.head==this.head},e.prototype.getBookmark=function(){return new du(this.anchor,this.head)},e.prototype.toJSON=function(){return{type:"text",anchor:this.anchor,head:this.head}},e.fromJSON=function(a,l){if(typeof l.anchor!="number"||typeof l.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new e(a.resolve(l.anchor),a.resolve(l.head))},e.create=function(a,l,d){d===void 0&&(d=l);var p=a.resolve(l);return new this(p,d==l?p:a.resolve(d))},e.between=function(a,l,d){var p=a.pos-l.pos;if((!d||p)&&(d=p>=0?1:-1),!l.parent.inlineContent){var g=n.findFrom(l,d,!0)||n.findFrom(l,-d,!0);if(g)l=g.$head;else return n.near(l,d)}return a.parent.inlineContent||(p==0?a=l:(a=(n.findFrom(a,-d,!0)||n.findFrom(a,d,!0)).$anchor,a.pos<l.pos!=p<0&&(a=l))),new e(a,l)},Object.defineProperties(e.prototype,t),e}(dr);dr.jsonID("text",uu);var du=function(e,t){this.anchor=e,this.head=t};du.prototype.map=function(e){return new du(e.map(this.anchor),e.map(this.head))};du.prototype.resolve=function(e){return uu.between(e.resolve(this.anchor),e.resolve(this.head))};var Pc=function(n){function e(t){var o=t.nodeAfter,a=t.node(0).resolve(t.pos+o.nodeSize);n.call(this,t,a),this.node=o}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.map=function(o,a){var l=a.mapResult(this.anchor),d=l.deleted,p=l.pos,g=o.resolve(p);return d?n.near(g):new e(g)},e.prototype.content=function(){return new Ue(me.from(this.node),0,0)},e.prototype.eq=function(o){return o instanceof e&&o.anchor==this.anchor},e.prototype.toJSON=function(){return{type:"node",anchor:this.anchor}},e.prototype.getBookmark=function(){return new gh(this.anchor)},e.fromJSON=function(o,a){if(typeof a.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new e(o.resolve(a.anchor))},e.create=function(o,a){return new this(o.resolve(a))},e.isSelectable=function(o){return!o.isText&&o.type.spec.selectable!==!1},e}(dr);Pc.prototype.visible=!1;dr.jsonID("node",Pc);var gh=function(e){this.anchor=e};gh.prototype.map=function(e){var t=e.mapResult(this.anchor),o=t.deleted,a=t.pos;return o?new du(a,a):new gh(a)};gh.prototype.resolve=function(e){var t=e.resolve(this.anchor),o=t.nodeAfter;return o&&Pc.isSelectable(o)?new Pc(t):dr.near(t)};var hu=function(n){function e(t){n.call(this,t.resolve(0),t.resolve(t.content.size))}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.replace=function(o,a){if(a===void 0&&(a=Ue.empty),a==Ue.empty){o.delete(0,o.doc.content.size);var l=n.atStart(o.doc);l.eq(o.selection)||o.setSelection(l)}else n.prototype.replace.call(this,o,a)},e.prototype.toJSON=function(){return{type:"all"}},e.fromJSON=function(o){return new e(o)},e.prototype.map=function(o){return new e(o)},e.prototype.eq=function(o){return o instanceof e},e.prototype.getBookmark=function(){return e3},e}(dr);dr.jsonID("all",hu);var e3={map:function(){return this},resolve:function(e){return new hu(e)}};function Qc(n,e,t,o,a,l){if(e.inlineContent)return uu.create(n,t);for(var d=o-(a>0?0:1);a>0?d<e.childCount:d>=0;d+=a){var p=e.child(d);if(p.isAtom){if(!l&&Pc.isSelectable(p))return Pc.create(n,t-(a<0?p.nodeSize:0))}else{var g=Qc(n,p,t+a,a<0?p.childCount:0,a,l);if(g)return g}t+=p.nodeSize*a}}function W_(n,e,t){var o=n.steps.length-1;if(!(o<e)){var a=n.steps[o];if(a instanceof Ns||a instanceof Ca){var l=n.mapping.maps[o],d;l.forEach(function(p,g,v,C){d==null&&(d=C)}),n.setSelection(dr.near(n.doc.resolve(d),t))}}}var Y_=1,mh=2,q_=4,t3=function(n){function e(o){n.call(this,o.doc),this.time=Date.now(),this.curSelection=o.selection,this.curSelectionFor=0,this.storedMarks=o.storedMarks,this.updated=0,this.meta=Object.create(null)}n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e;var t={selection:{configurable:!0},selectionSet:{configurable:!0},storedMarksSet:{configurable:!0},isGeneric:{configurable:!0},scrolledIntoView:{configurable:!0}};return t.selection.get=function(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection},e.prototype.setSelection=function(a){if(a.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=a,this.curSelectionFor=this.steps.length,this.updated=(this.updated|Y_)&~mh,this.storedMarks=null,this},t.selectionSet.get=function(){return(this.updated&Y_)>0},e.prototype.setStoredMarks=function(a){return this.storedMarks=a,this.updated|=mh,this},e.prototype.ensureMarks=function(a){return wt.sameSet(this.storedMarks||this.selection.$from.marks(),a)||this.setStoredMarks(a),this},e.prototype.addStoredMark=function(a){return this.ensureMarks(a.addToSet(this.storedMarks||this.selection.$head.marks()))},e.prototype.removeStoredMark=function(a){return this.ensureMarks(a.removeFromSet(this.storedMarks||this.selection.$head.marks()))},t.storedMarksSet.get=function(){return(this.updated&mh)>0},e.prototype.addStep=function(a,l){n.prototype.addStep.call(this,a,l),this.updated=this.updated&~mh,this.storedMarks=null},e.prototype.setTime=function(a){return this.time=a,this},e.prototype.replaceSelection=function(a){return this.selection.replace(this,a),this},e.prototype.replaceSelectionWith=function(a,l){var d=this.selection;return l!==!1&&(a=a.mark(this.storedMarks||(d.empty?d.$from.marks():d.$from.marksAcross(d.$to)||wt.none))),d.replaceWith(this,a),this},e.prototype.deleteSelection=function(){return this.selection.replace(this),this},e.prototype.insertText=function(a,l,d){d===void 0&&(d=l);var p=this.doc.type.schema;if(l==null)return a?this.replaceSelectionWith(p.text(a),!0):this.deleteSelection();if(!a)return this.deleteRange(l,d);var g=this.storedMarks;if(!g){var v=this.doc.resolve(l);g=d==l?v.marks():v.marksAcross(this.doc.resolve(d))}return this.replaceRangeWith(l,d,p.text(a,g)),this.selection.empty||this.setSelection(dr.near(this.selection.$to)),this},e.prototype.setMeta=function(a,l){return this.meta[typeof a=="string"?a:a.key]=l,this},e.prototype.getMeta=function(a){return this.meta[typeof a=="string"?a:a.key]},t.isGeneric.get=function(){for(var o in this.meta)return!1;return!0},e.prototype.scrollIntoView=function(){return this.updated|=q_,this},t.scrolledIntoView.get=function(){return(this.updated&q_)>0},Object.defineProperties(e.prototype,t),e}(Ir);function J_(n,e){return!e||!n?n:n.bind(e)}var pu=function(e,t,o){this.name=e,this.init=J_(t.init,o),this.apply=J_(t.apply,o)},r3=[new pu("doc",{init:function(e){return e.doc||e.schema.topNodeType.createAndFill()},apply:function(e){return e.doc}}),new pu("selection",{init:function(e,t){return e.selection||dr.atStart(t.doc)},apply:function(e){return e.selection}}),new pu("storedMarks",{init:function(e){return e.storedMarks||null},apply:function(e,t,o,a){return a.selection.$cursor?e.storedMarks:null}}),new pu("scrollToSelection",{init:function(){return 0},apply:function(e,t){return e.scrolledIntoView?t+1:t}})],Sg=function(e,t){var o=this;this.schema=e,this.fields=r3.concat(),this.plugins=[],this.pluginsByKey=Object.create(null),t&&t.forEach(function(a){if(o.pluginsByKey[a.key])throw new RangeError("Adding different instances of a keyed plugin ("+a.key+")");o.plugins.push(a),o.pluginsByKey[a.key]=a,a.spec.state&&o.fields.push(new pu(a.key,a.spec.state,a))})},Un=function(e){this.config=e},vh={schema:{configurable:!0},plugins:{configurable:!0},tr:{configurable:!0}};vh.schema.get=function(){return this.config.schema};vh.plugins.get=function(){return this.config.plugins};Un.prototype.apply=function(e){return this.applyTransaction(e).state};Un.prototype.filterTransaction=function(e,t){t===void 0&&(t=-1);for(var o=0;o<this.config.plugins.length;o++)if(o!=t){var a=this.config.plugins[o];if(a.spec.filterTransaction&&!a.spec.filterTransaction.call(a,e,this))return!1}return!0};Un.prototype.applyTransaction=function(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};for(var t=[e],o=this.applyInner(e),a=null;;){for(var l=!1,d=0;d<this.config.plugins.length;d++){var p=this.config.plugins[d];if(p.spec.appendTransaction){var g=a?a[d].n:0,v=a?a[d].state:this,C=g<t.length&&p.spec.appendTransaction.call(p,g?t.slice(g):t,v,o);if(C&&o.filterTransaction(C,d)){if(C.setMeta("appendedTransaction",e),!a){a=[];for(var y=0;y<this.config.plugins.length;y++)a.push(y<d?{state:o,n:t.length}:{state:this,n:0})}t.push(C),o=o.applyInner(C),l=!0}a&&(a[d]={state:o,n:t.length})}}if(!l)return{state:o,transactions:t}}};Un.prototype.applyInner=function(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");for(var t=new Un(this.config),o=this.config.fields,a=0;a<o.length;a++){var l=o[a];t[l.name]=l.apply(e,this[l.name],this,t)}for(var d=0;d<Au.length;d++)Au[d](this,e,t);return t};vh.tr.get=function(){return new t3(this)};Un.create=function(e){for(var t=new Sg(e.doc?e.doc.type.schema:e.schema,e.plugins),o=new Un(t),a=0;a<t.fields.length;a++)o[t.fields[a].name]=t.fields[a].init(e,o);return o};Un.prototype.reconfigure=function(e){for(var t=new Sg(this.schema,e.plugins),o=t.fields,a=new Un(t),l=0;l<o.length;l++){var d=o[l].name;a[d]=this.hasOwnProperty(d)?this[d]:o[l].init(e,a)}return a};Un.prototype.toJSON=function(e){var t={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(t.storedMarks=this.storedMarks.map(function(d){return d.toJSON()})),e&&typeof e=="object")for(var o in e){if(o=="doc"||o=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");var a=e[o],l=a.spec.state;l&&l.toJSON&&(t[o]=l.toJSON.call(a,this[a.key]))}return t};Un.fromJSON=function(e,t,o){if(!t)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");var a=new Sg(e.schema,e.plugins),l=new Un(a);return a.fields.forEach(function(d){if(d.name=="doc")l.doc=Nt.fromJSON(e.schema,t.doc);else if(d.name=="selection")l.selection=dr.fromJSON(l.doc,t.selection);else if(d.name=="storedMarks")t.storedMarks&&(l.storedMarks=t.storedMarks.map(e.schema.markFromJSON));else{if(o)for(var p in o){var g=o[p],v=g.spec.state;if(g.key==d.name&&v&&v.fromJSON&&Object.prototype.hasOwnProperty.call(t,p)){l[d.name]=v.fromJSON.call(g,e,t[p],l);return}}l[d.name]=d.init(e,l)}}),l};Un.addApplyListener=function(e){Au.push(e)};Un.removeApplyListener=function(e){var t=Au.indexOf(e);t>-1&&Au.splice(t,1)};Object.defineProperties(Un.prototype,vh);var Au=[];function z_(n,e,t){for(var o in n){var a=n[o];a instanceof Function?a=a.bind(e):o=="handleDOMEvents"&&(a=z_(a,e,{})),t[o]=a}return t}var X_=function(e){this.props={},e.props&&z_(e.props,this,this.props),this.spec=e,this.key=e.key?e.key.key:Z_("plugin")};X_.prototype.getState=function(e){return e[this.key]};var Tg=Object.create(null);function Z_(n){return n in Tg?n+"$"+ ++Tg[n]:(Tg[n]=0,n+"$")}var Rg=function(e){e===void 0&&(e="key"),this.key=Z_(e)};Rg.prototype.get=function(e){return e.config.pluginsByKey[this.key]};Rg.prototype.getState=function(e){return e[this.key]};const n3=new Rg("characterLimit"),i3=qr.create({name:"characterCount",addOptions(){return{limit:0}},addProseMirrorPlugins(){const{options:n}=this;return[new X_({key:n3,appendTransaction:(e,t,o)=>{const a=o.doc.content.size;if(n.limit&&a>n.limit)return o.tr.insertText("",n.limit+1,a)}})]}});const o3={props:{icon:{type:String,required:!0},title:{type:String,required:!0},action:{type:Function,required:!0},isActive:{type:Function,default:null}},components:{SvgIcon:na}},s3=["title"];function a3(n,e,t,o,a,l){const d=md("SvgIcon");return vr(),bn("button",{class:uc(["menu-item",{"is-active":t.isActive?t.isActive():null}]),onClick:e[0]||(e[0]=(...p)=>t.action&&t.action(...p)),title:t.title},[Dn(d,{name:"tiptap-"+t.icon},null,8,["name"])],10,s3)}var c3=kl(o3,[["render",a3],["__scopeId","data-v-d2d2a634"]]);const l3={components:{MenuItem:c3},props:{editor:{type:Object,required:!0}},data(){return{items:[{icon:"bold",title:"Bold",action:()=>this.editor.chain().focus().toggleBold().run(),isActive:()=>this.editor.isActive("bold")},{icon:"italic",title:"Italic",action:()=>this.editor.chain().focus().toggleItalic().run(),isActive:()=>this.editor.isActive("italic")},{icon:"strikethrough",title:"Strike",action:()=>this.editor.chain().focus().toggleStrike().run(),isActive:()=>this.editor.isActive("strike")},{icon:"code-view",title:"Code",action:()=>this.editor.chain().focus().toggleCode().run(),isActive:()=>this.editor.isActive("code")},{icon:"mark-pen-line",title:"Highlight",action:()=>this.editor.chain().focus().toggleHighlight().run(),isActive:()=>this.editor.isActive("highlight")},{type:"divider"},{icon:"h-1",title:"Heading 1",action:()=>this.editor.chain().focus().toggleHeading({level:1}).run(),isActive:()=>this.editor.isActive("heading",{level:1})},{icon:"h-2",title:"Heading 2",action:()=>this.editor.chain().focus().toggleHeading({level:2}).run(),isActive:()=>this.editor.isActive("heading",{level:2})},{icon:"paragraph",title:"Paragraph",action:()=>this.editor.chain().focus().setParagraph().run(),isActive:()=>this.editor.isActive("paragraph")},{icon:"list-unordered",title:"Bullet List",action:()=>this.editor.chain().focus().toggleBulletList().run(),isActive:()=>this.editor.isActive("bulletList")},{icon:"list-ordered",title:"Ordered List",action:()=>this.editor.chain().focus().toggleOrderedList().run(),isActive:()=>this.editor.isActive("orderedList")},{icon:"list-check-2",title:"Task List",action:()=>this.editor.chain().focus().toggleTaskList().run(),isActive:()=>this.editor.isActive("taskList")},{icon:"code-box-line",title:"Code Block",action:()=>this.editor.chain().focus().toggleCodeBlock().run(),isActive:()=>this.editor.isActive("codeBlock")},{type:"divider"},{icon:"double-quotes-l",title:"Blockquote",action:()=>this.editor.chain().focus().toggleBlockquote().run(),isActive:()=>this.editor.isActive("blockquote")},{icon:"separator",title:"Horizontal Rule",action:()=>this.editor.chain().focus().setHorizontalRule().run()},{type:"divider"},{icon:"text-wrap",title:"Hard Break",action:()=>this.editor.chain().focus().setHardBreak().run()},{icon:"format-clear",title:"Clear Format",action:()=>this.editor.chain().focus().clearNodes().unsetAllMarks().run()},{type:"divider"},{icon:"arrow-go-back-line",title:"Undo",action:()=>this.editor.chain().focus().undo().run()},{icon:"arrow-go-forward-line",title:"Redo",action:()=>this.editor.chain().focus().redo().run()}]}}};function u3(n,e,t,o,a,l){const d=md("menu-item");return vr(),bn("div",null,[(vr(!0),bn(Ko,null,mA(a.items,(p,g)=>(vr(),bn(Ko,null,[p.type==="divider"?(vr(),bn("div",{class:"divider",key:`divider${g}`})):(vr(),dc(d,Ww({key:1,key:g},p),null,16))],64))),256))])}var d3=kl(l3,[["render",u3],["__scopeId","data-v-1ebce63e"]]);const $_=_A(),eS=n=>n[Math.floor(Math.random()*n.length)],h3={components:{EditorContent:rL,MenuBar:d3},data(){return{currentUser:JSON.parse(localStorage.getItem("currentUser"))||{name:this.getRandomName(),color:this.getRandomColor()},provider:null,editor:null,users:[],status:"connecting"}},mounted(){const n=new wN;this.provider=new NN("wss://ws1.hookin.fun","f452c7864b7a575cf23e0850cf0c9291",n),this.provider.on("status",e=>{this.status=e.status}),this.editor=new tL({extensions:[$L.configure({history:!1}),NP,_P,TP,CP.configure({document:n}),yP.configure({provider:this.provider,user:this.currentUser}),i3.configure({limit:1e4})]})},methods:{setName(){const n=(window.prompt("Name")||"").trim().substring(0,32);if(n)return this.updateCurrentUser({name:n})},updateCurrentUser(n){this.currentUser=ie(ie({},this.currentUser),n),this.editor.chain().focus().user(this.currentUser).run(),localStorage.setItem("currentUser",JSON.stringify(this.currentUser))},getRandomColor(){return eS(["#958DF1","#F98181","#FBBC88","#FAF594","#70CFF8","#94FADB","#B9F18D"])},getRandomName(){return $_.uid==0?eS(["\u6BB5\u8A89","\u6728\u5A49\u6E05","\u865A\u7AF9","\u674E\u6E05\u9732","\u6653\u857E","\u6BB5\u6B63\u660E","\u9EC4\u7709\u50E7","\u65E0\u5D16\u5B50","\u7384\u9EC4\u5B50","\u5353\u4E0D\u51E1","\u53F8\u9A6C\u6797","\u674E\u767D","\u9646\u6E38","\u674E\u6E05\u7167","\u675C\u752B","\u767D\u5C45\u6613","\u675C\u7267","\u82CF\u8F7C","\u738B\u5B89\u77F3","\u6768\u4E07\u91CC","\u5B5F\u6D69\u7136","\u8F9B\u5F03\u75BE","\u8303\u4EF2\u6DF9","\u738B\u7EF4","\u6B27\u9633\u4FEE"]):$_.name}},beforeUnmount(){this.editor.destroy(),this.provider.destroy()}},p3={key:0,class:"editor"},A3={class:"editor__footer"},f3=BI(" \u8FDE\u63A5\u4E2D\u2026\u2026 "),g3={class:"editor__name"};function m3(n,e,t,o,a,l){const d=md("menu-bar"),p=md("editor-content");return a.editor?(vr(),bn("div",p3,[Dn(d,{class:"editor__header",editor:a.editor},null,8,["editor"]),Dn(p,{class:"editor__content",editor:a.editor},null,8,["editor"]),Qt("div",A3,[Qt("div",{class:uc(`editor__status editor__status--${a.status}`)},[a.status==="connected"?(vr(),bn(Ko,{key:0},[BI(Rl(a.editor.storage.collaborationCursor.users.length)+" user"+Rl(a.editor.storage.collaborationCursor.users.length===1?"":"s"),1)],64)):(vr(),bn(Ko,{key:1},[f3],64))],2),Qt("div",g3,[Qt("button",{onClick:e[0]||(e[0]=(...g)=>l.setName&&l.setName(...g))},Rl(a.currentUser.name),1)])])])):vA("",!0)}var v3=kl(h3,[["render",m3],["__scopeId","data-v-f9ecf2a6"]]);const E3={setup(n){const e=Tl([{name:"\u97F3\u9891",value:0},{name:"\u89C6\u9891",value:1}]),t=ta(0),o=a=>{t.value=a};return(a,l)=>(vr(),dc(Bi(Jw),{onChange:o},{default:hc(()=>[Dn(Bi(qw),{class:"flex p-1 space-x-1 bg-indigo-500 rounded-lg dark border dark:border-gray-600 transition"},{default:hc(()=>[(vr(!0),bn(Ko,null,mA(Bi(e),d=>(vr(),dc(Bi(Yw),{as:"template",key:d.value},{default:hc(({selected:p})=>[Qt("button",{class:uc(["w-full py-1 text-sm leading-5 font-mediumtext-white text-white font-bold rounded-md","focus:outline-none focus:ring-2 ring-offset-2 ring-offset-indigo-300",p?"bg-white shadow text-indigo-700":"hover:bg-white/[0.12]"])},Rl(d.name),3)]),_:2},1024))),128))]),_:1})]),_:1}))}};const Os=n=>(MI("data-v-0391e847"),n=n(),LI(),n),I3={as:"nav",class:"bg-gray-800 rounded-b-md fixed top-0 w-full z-10"},C3={class:"max-w-7xl mx-auto px-2 sm:px-6 lg:px-8"},y3={class:"relative flex items-center justify-between h-16"},_3={class:"flex-1 flex items-center justify-center sm:justify-start"},S3={class:"absolute inset-y-0 inset-x-0 right-0 flex items-center px-2 sm:static sm:inset-auto sm:pr-0"},T3={class:"video-btn mr-4"},R3=Os(()=>Qt("span",{class:"sr-only"},"Open live",-1)),w3={class:"w-80"},N3=Os(()=>Qt("div",null,"\u656C\u8BF7\u671F\u5F85~",-1)),k3=Os(()=>Qt("hr",{class:"my-4"},null,-1)),O3={class:"flex items-center"},b3=Os(()=>Qt("div",{class:"w-24 text-right"},"\u5206\u4EAB\u6A21\u5F0F\uFF1A",-1)),D3={class:"w-40"},B3=Os(()=>Qt("button",{class:"close-btn"},"\u5173\u95ED",-1)),M3=Os(()=>Qt("div",{class:"flex-grow"},null,-1)),L3=Os(()=>Qt("span",{class:"sr-only"},"Copy Share Link",-1)),P3=Os(()=>Qt("div",{class:"leave-btn"},"\u79BB\u5F00",-1)),Q3={setup(n){const e=window.location.href,t=()=>{navigator.clipboard.writeText(e),Xw.success("\u5DF2\u6210\u529F\u590D\u5236\u9080\u8BF7\u94FE\u63A5\uFF01")};return(o,a)=>(vr(),bn("nav",I3,[Qt("div",C3,[Qt("div",y3,[Qt("div",_3,[Dn(na,{name:"logo",class:"h-8 w-8"})]),Qt("div",S3,[Dn(Bi(zw),null,{content:hc(()=>[Qt("div",w3,[N3,k3,Qt("div",O3,[b3,Qt("div",D3,[Dn(E3)]),B3])])]),default:hc(()=>[Qt("button",T3,[R3,Dn(na,{name:"toolbar-live",class:"h-6 w-6"})])]),_:1}),M3,Qt("button",{title:"\u70B9\u51FB\u5206\u4EAB\u6B64\u623F\u95F4 share",class:"text-gray-300 hover:text-white cursor-pointer mr-4",onClick:t},[L3,Dn(na,{name:"toolbar-share",class:"inline-block h-5 w-5"})]),P3])])])]))}};var x3=kl(Q3,[["__scopeId","data-v-0391e847"]]);const U3=n=>(MI("data-v-16c6c8e9"),n=n(),LI(),n),F3={class:"z-10 absolute flex left-0 right-0 group-hover:bg-gray-800 text-white p-1 transition"},V3={class:"sm-btn w-5 bg-indigo-600 text-center overflow-hidden",title:"\u540D\u79F0"},G3=["title"],j3=["title"],H3=U3(()=>Qt("div",{class:"flex-1"},null,-1)),K3=["id","onClick"];function W3(n,{emit:e}){const t=n,o=ta(null);Zw(window,"resize",()=>{const l=window.getComputedStyle(o.value,null),d=+l.left.replace(/\px/g,""),p=+l.top.replace(/\px/g,"");(d<0||p<0)&&(o.value.style.right="8px",o.value.style.bottom="8px")});const a=()=>{};return PI(()=>{}),(l,d)=>{const p=$w("drag");return eN((vr(),bn("div",{ref:(g,v)=>{v.target=g,o.value=g},class:uc(["fixed cursor-move min-w-[10rem] min-h-[2.5rem] right-2 select-none z-10 bg-gray-100 rounded overflow-hidden border-4 border-indigo-300 shadow-md hover:shadow-lg transition group",n.className]),style:rN(n.liveUser.hasOpenVideo?"":"height:0;")},[Qt("div",F3,[Qt("div",V3,Rl(t.name[0]),1),Qt("button",{class:uc(["sm-btn",n.liveUser.hasOpenVideo?"":"active"]),title:n.liveUser.hasOpenVideo?"\u505C\u6B62\u5F55\u50CF":"\u5F00\u59CB\u5F55\u50CF",onClick:d[0]||(d[0]=g=>l.$emit("video",n.name))},[Dn(na,{name:"live-camera-off",class:"w-5 h-5"})],10,G3),Qt("button",{class:uc(["sm-btn",n.liveUser.hasOpenAudio?"":"active"]),title:n.liveUser.hasOpenAudio?"\u505C\u6B62\u5F55\u97F3":"\u5F00\u59CB\u5F55\u97F3",onClick:d[1]||(d[1]=g=>l.$emit("audio",n.name))},[Dn(na,{name:"live-mic-off",class:"w-5 h-5"})],10,j3),H3,Qt("button",{class:"close-btn",onClick:d[2]||(d[2]=g=>l.$emit("close",n.name)),title:"\u5173\u95ED"},[Dn(na,{name:"close",class:"h-5 w-5"})])]),Qt("div",{class:"player",id:"player-"+n.liveUser.uid,onClick:tN(a,["stop"])},null,8,K3)],6)),[[p]])}}const Y3={directives:{drag:{mounted(n){const e=window.getComputedStyle(n,null);n.onmousedown=t=>{const o=t.clientX,a=t.clientY,l=+e.right.replace(/\px/g,""),d=+e.bottom.replace(/\px/g,""),p=+e.width.replace(/\px/g,""),g=+e.height.replace(/\px/g,""),v=window.innerWidth,C=window.innerHeight;document.onmousemove=function(y){const w=y.clientX-o,O=y.clientY-a,M=l-w,x=d-O;M<0||x<0||M>v-p||x>C-g||(n.style.right=M+"px",n.style.bottom=x+"px")},document.onmouseup=function(y){document.onmousemove=null,document.onmouseup=null}}}}}},q3=Object.assign(Y3,{props:{name:{type:String,default:"\u6211"},liveUser:{type:Object},className:{type:String,default:"h-[8rem] bottom-2"}},emits:["close","video","audio"],setup:W3});var tS=kl(q3,[["__scopeId","data-v-16c6c8e9"]]),rS={exports:{}};(function(n,e){(function(t,o){n.exports=o()})(EA,function(){function t(i,r,s){return i(s={path:r,exports:{},require:function(c,u){throw Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}},s.exports),s.exports}function o(i,r,s){return(i=i.match(r))&&i.length>=s&&ar(i[s],10)}function a(i,r,s){if(i.RTCPeerConnection){i=i.RTCPeerConnection.prototype;var c=i.addEventListener;i.addEventListener=function(h,A){if(h!==r)return c.apply(this,arguments);let f=m=>{(m=s(m))&&A(m)};return this._eventMap=this._eventMap||{},this._eventMap[A]=f,c.apply(this,[h,f])};var u=i.removeEventListener;i.removeEventListener=function(h,A){if(h!==r||!this._eventMap||!this._eventMap[A])return u.apply(this,arguments);let f=this._eventMap[A];return delete this._eventMap[A],u.apply(this,[h,f])},ht(i,"on"+r,{get(){return this["_on"+r]},set(h){this["_on"+r]&&(this.removeEventListener(r,this["_on"+r]),delete this["_on"+r]),h&&this.addEventListener(r,this["_on"+r]=h)},enumerable:!0,configurable:!0})}}function l(i){return typeof i!="boolean"?Error("Argument type: "+typeof i+". Please use a boolean."):(vv=i,i?"adapter.js logging disabled":"adapter.js logging enabled")}function d(i){return typeof i!="boolean"?Error("Argument type: "+typeof i+". Please use a boolean."):(Ev=!i,"adapter.js deprecation warnings "+(i?"disabled":"enabled"))}function p(){typeof window!="object"||vv||typeof console!="undefined"&&typeof console.log=="function"&&console.log.apply(console,arguments)}function g(i,r){Ev&&console.warn(i+" is deprecated, please use "+r+" instead.")}function v(i){let{navigator:r}=i,s={browser:null,version:null};if(i===void 0||!i.navigator)return s.browser="Not a browser.",s;if(r.mozGetUserMedia)s.browser="firefox",s.version=o(r.userAgent,/Firefox\/(\d+)\./,1);else if(r.webkitGetUserMedia||i.isSecureContext===!1&&i.webkitRTCPeerConnection&&!i.RTCIceGatherer)s.browser="chrome",s.version=o(r.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(r.mediaDevices&&r.userAgent.match(/Edge\/(\d+).(\d+)$/))s.browser="edge",s.version=o(r.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!i.RTCPeerConnection||!r.userAgent.match(/AppleWebKit\/(\d+)\./))return s.browser="Not a supported browser.",s;s.browser="safari",s.version=o(r.userAgent,/AppleWebKit\/(\d+)\./,1),s.supportsUnifiedPlan=i.RTCRtpTransceiver&&"currentDirection"in i.RTCRtpTransceiver.prototype}return s}function C(i){var r;return Object.prototype.toString.call(i)==="[object Object]"?Fu(r=dt(i)).call(r,function(s,c){var u=Object.prototype.toString.call(i[c])==="[object Object]";let h=u?C(i[c]):i[c];return u=u&&!dt(h).length,h===void 0||u?s:Zr(s,{[c]:h})},{}):i}function y(i,r,s){let c=s?"outbound-rtp":"inbound-rtp",u=new Ct;if(r===null)return u;let h=[];return W(i).call(i,A=>{A.type==="track"&&A.trackIdentifier===r.id&&h.push(A)}),W(h).call(h,A=>{W(i).call(i,f=>{f.type===c&&f.trackId===A.id&&function m(I,E,_){var S;E&&!_.has(E.id)&&(_.set(E.id,E),W(S=dt(E)).call(S,N=>{if(uv(N).call(N,"Id"))m(I,I.get(E[N]),_);else if(uv(N).call(N,"Ids")){var k;W(k=E[N]).call(k,B=>{m(I,I.get(B),_)})}}))}(i,f,u)})}),u}function w(i){let r=i&&i.navigator;if(r.mediaDevices){var s=v(i),c=function(f){var m;if(typeof f!="object"||f.mandatory||f.optional)return f;const I={};var E;return W(m=dt(f)).call(m,_=>{if(_!=="require"&&_!=="advanced"&&_!=="mediaSource"){var S=typeof f[_]=="object"?f[_]:{ideal:f[_]};S.exact!==void 0&&typeof S.exact=="number"&&(S.min=S.max=S.exact);var N=function(B,P){return B?B+P.charAt(0).toUpperCase()+Mr(P).call(P,1):P==="deviceId"?"sourceId":P};if(S.ideal!==void 0){I.optional=I.optional||[];let B={};typeof S.ideal=="number"?(B[N("min",_)]=S.ideal,I.optional.push(B),B={},B[N("max",_)]=S.ideal,I.optional.push(B)):(B[N("",_)]=S.ideal,I.optional.push(B))}var k;S.exact!==void 0&&typeof S.exact!="number"?(I.mandatory=I.mandatory||{},I.mandatory[N("",_)]=S.exact):W(k=["min","max"]).call(k,B=>{S[B]!==void 0&&(I.mandatory=I.mandatory||{},I.mandatory[N(B,_)]=S[B])})}}),f.advanced&&(I.optional=b(E=I.optional||[]).call(E,f.advanced)),I},u=function(f,m){if(61<=s.version)return m(f);if((f=JSON.parse(fe(f)))&&typeof f.audio=="object"){var I=function(E,_,S){_ in E&&!(S in E)&&(E[S]=E[_],delete E[_])};I((f=JSON.parse(fe(f))).audio,"autoGainControl","googAutoGainControl"),I(f.audio,"noiseSuppression","googNoiseSuppression"),f.audio=c(f.audio)}if(f&&typeof f.video=="object"){let E=f.video.facingMode;if(E=E&&(typeof E=="object"?E:{ideal:E}),I=66>s.version,!(!E||E.exact!=="user"&&E.exact!=="environment"&&E.ideal!=="user"&&E.ideal!=="environment"||r.mediaDevices.getSupportedConstraints&&r.mediaDevices.getSupportedConstraints().facingMode&&!I)){let _;if(delete f.video.facingMode,E.exact==="environment"||E.ideal==="environment"?_=["back","rear"]:E.exact!=="user"&&E.ideal!=="user"||(_=["front"]),_)return r.mediaDevices.enumerateDevices().then(S=>{S=Qe(S).call(S,k=>k.kind==="videoinput");let N=Je(S).call(S,k=>sE(_).call(_,B=>{var P;return gt(P=k.label.toLowerCase()).call(P,B)}));return!N&&S.length&&gt(_).call(_,"back")&&(N=S[S.length-1]),N&&(f.video.deviceId=E.exact?{exact:N.deviceId}:{ideal:N.deviceId}),f.video=c(f.video),aE("chrome: "+fe(f)),m(f)})}f.video=c(f.video)}return aE("chrome: "+fe(f)),m(f)},h=function(f){return 64<=s.version?f:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[f.name]||f.name,message:f.message,constraint:f.constraint||f.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(i=function(f,m,I){u(f,E=>{r.webkitGetUserMedia(E,m,_=>{I&&I(h(_))})})},r.getUserMedia=cr(i).call(i,r),r.mediaDevices.getUserMedia){var A;let f=cr(A=r.mediaDevices.getUserMedia).call(A,r.mediaDevices);r.mediaDevices.getUserMedia=function(m){return u(m,I=>f(I).then(E=>{var _;if(I.audio&&!E.getAudioTracks().length||I.video&&!E.getVideoTracks().length)throw W(_=E.getTracks()).call(_,S=>{S.stop()}),new DOMException("","NotFoundError");return E},E=>ce.reject(h(E))))}}}}function O(i){i.MediaStream=i.MediaStream||i.webkitMediaStream}function M(i){if(typeof i!="object"||!i.RTCPeerConnection||"ontrack"in i.RTCPeerConnection.prototype)a(i,"track",r=>(r.transceiver||ht(r,"transceiver",{value:{receiver:r.receiver}}),r));else{ht(i.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(s){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=s)},enumerable:!0,configurable:!0});let r=i.RTCPeerConnection.prototype.setRemoteDescription;i.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=s=>{var c;s.stream.addEventListener("addtrack",u=>{let h;var A;i.RTCPeerConnection.prototype.getReceivers?h=Je(A=this.getReceivers()).call(A,f=>f.track&&f.track.id===u.track.id):h={track:u.track},A=new Event("track"),A.track=u.track,A.receiver=h,A.transceiver={receiver:h},A.streams=[s.stream],this.dispatchEvent(A)}),W(c=s.stream.getTracks()).call(c,u=>{let h;var A;i.RTCPeerConnection.prototype.getReceivers?h=Je(A=this.getReceivers()).call(A,f=>f.track&&f.track.id===u.id):h={track:u},A=new Event("track"),A.track=u,A.receiver=h,A.transceiver={receiver:h},A.streams=[s.stream],this.dispatchEvent(A)})},this.addEventListener("addstream",this._ontrackpoly)),r.apply(this,arguments)}}}function x(i){if(typeof i=="object"&&i.RTCPeerConnection&&!("getSenders"in i.RTCPeerConnection.prototype)&&"createDTMFSender"in i.RTCPeerConnection.prototype){let r=function(u,h){return{track:h,get dtmf(){return this._dtmf===void 0&&(h.kind==="audio"?this._dtmf=u.createDTMFSender(h):this._dtmf=null),this._dtmf},_pc:u}};if(!i.RTCPeerConnection.prototype.getSenders){i.RTCPeerConnection.prototype.getSenders=function(){var A;return this._senders=this._senders||[],Mr(A=this._senders).call(A)};let u=i.RTCPeerConnection.prototype.addTrack;i.RTCPeerConnection.prototype.addTrack=function(A,f){let m=u.apply(this,arguments);return m||(m=r(this,A),this._senders.push(m)),m};let h=i.RTCPeerConnection.prototype.removeTrack;i.RTCPeerConnection.prototype.removeTrack=function(A){var f;h.apply(this,arguments);let m=Ge(f=this._senders).call(f,A);var I;m!==-1&&Gr(I=this._senders).call(I,m,1)}}let s=i.RTCPeerConnection.prototype.addStream;i.RTCPeerConnection.prototype.addStream=function(u){var h;this._senders=this._senders||[],s.apply(this,[u]),W(h=u.getTracks()).call(h,A=>{this._senders.push(r(this,A))})};let c=i.RTCPeerConnection.prototype.removeStream;i.RTCPeerConnection.prototype.removeStream=function(u){var h;this._senders=this._senders||[],c.apply(this,[u]),W(h=u.getTracks()).call(h,A=>{var f;let m=Je(f=this._senders).call(f,_=>_.track===A);var I,E;m&&Gr(I=this._senders).call(I,Ge(E=this._senders).call(E,m),1)})}}else if(typeof i=="object"&&i.RTCPeerConnection&&"getSenders"in i.RTCPeerConnection.prototype&&"createDTMFSender"in i.RTCPeerConnection.prototype&&i.RTCRtpSender&&!("dtmf"in i.RTCRtpSender.prototype)){let r=i.RTCPeerConnection.prototype.getSenders;i.RTCPeerConnection.prototype.getSenders=function(){let s=r.apply(this,[]);return W(s).call(s,c=>c._pc=this),s},ht(i.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function G(i){if(i.RTCPeerConnection){var r=i.RTCPeerConnection.prototype.getStats;i.RTCPeerConnection.prototype.getStats=function(){let[s,c,u]=arguments;if(0<arguments.length&&typeof s=="function")return r.apply(this,arguments);if(r.length===0&&(arguments.length===0||typeof s!="function"))return r.apply(this,[]);let h=function(f){const m={};return f=f.result(),W(f).call(f,I=>{var E;const _={id:I.id,timestamp:I.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[I.type]||I.type};W(E=I.names()).call(E,S=>{_[S]=I.stat(S)}),m[_.id]=_}),m},A=function(f){var m;return new Ct(Ie(m=dt(f)).call(m,I=>[I,f[I]]))};return 2<=arguments.length?r.apply(this,[function(f){c(A(h(f)))},s]):new ce((f,m)=>{r.apply(this,[function(I){f(A(h(I)))},m])}).then(c,u)}}}function K(i){if(typeof i=="object"&&i.RTCPeerConnection&&i.RTCRtpSender&&i.RTCRtpReceiver){if(!("getStats"in i.RTCRtpSender.prototype)){let s=i.RTCPeerConnection.prototype.getSenders;s&&(i.RTCPeerConnection.prototype.getSenders=function(){let u=s.apply(this,[]);return W(u).call(u,h=>h._pc=this),u});let c=i.RTCPeerConnection.prototype.addTrack;c&&(i.RTCPeerConnection.prototype.addTrack=function(){let u=c.apply(this,arguments);return u._pc=this,u}),i.RTCRtpSender.prototype.getStats=function(){let u=this;return this._pc.getStats().then(h=>y(h,u.track,!0))}}if(!("getStats"in i.RTCRtpReceiver.prototype)){let s=i.RTCPeerConnection.prototype.getReceivers;s&&(i.RTCPeerConnection.prototype.getReceivers=function(){let c=s.apply(this,[]);return W(c).call(c,u=>u._pc=this),c}),a(i,"track",c=>(c.receiver._pc=c.srcElement,c)),i.RTCRtpReceiver.prototype.getStats=function(){let c=this;return this._pc.getStats().then(u=>y(u,c.track,!1))}}if("getStats"in i.RTCRtpSender.prototype&&"getStats"in i.RTCRtpReceiver.prototype){var r=i.RTCPeerConnection.prototype.getStats;i.RTCPeerConnection.prototype.getStats=function(){if(0<arguments.length&&arguments[0]instanceof i.MediaStreamTrack){var s,c;let u=arguments[0],h,A,f;return W(s=this.getSenders()).call(s,m=>{m.track===u&&(h?f=!0:h=m)}),W(c=this.getReceivers()).call(c,m=>(m.track===u&&(A?f=!0:A=m),m.track===u)),f||h&&A?ce.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):h?h.getStats():A?A.getStats():ce.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return r.apply(this,arguments)}}}}function F(i){i.RTCPeerConnection.prototype.getLocalStreams=function(){var h;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Ie(h=dt(this._shimmedLocalStreams)).call(h,A=>this._shimmedLocalStreams[A][0])};let r=i.RTCPeerConnection.prototype.addTrack;i.RTCPeerConnection.prototype.addTrack=function(h,A){var f;if(!A)return r.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let m=r.apply(this,arguments);return this._shimmedLocalStreams[A.id]?Ge(f=this._shimmedLocalStreams[A.id]).call(f,m)===-1&&this._shimmedLocalStreams[A.id].push(m):this._shimmedLocalStreams[A.id]=[A,m],m};let s=i.RTCPeerConnection.prototype.addStream;i.RTCPeerConnection.prototype.addStream=function(h){var A,f,m;this._shimmedLocalStreams=this._shimmedLocalStreams||{},W(A=h.getTracks()).call(A,E=>{var _;if(Je(_=this.getSenders()).call(_,S=>S.track===E))throw new DOMException("Track already exists.","InvalidAccessError")});let I=this.getSenders();s.apply(this,arguments),A=Qe(f=this.getSenders()).call(f,E=>Ge(I).call(I,E)===-1),this._shimmedLocalStreams[h.id]=b(m=[h]).call(m,A)};let c=i.RTCPeerConnection.prototype.removeStream;i.RTCPeerConnection.prototype.removeStream=function(h){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[h.id],c.apply(this,arguments)};let u=i.RTCPeerConnection.prototype.removeTrack;i.RTCPeerConnection.prototype.removeTrack=function(h){var A;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},h&&W(A=dt(this._shimmedLocalStreams)).call(A,f=>{var m;let I=Ge(m=this._shimmedLocalStreams[f]).call(m,h);var E;I!==-1&&Gr(E=this._shimmedLocalStreams[f]).call(E,I,1),this._shimmedLocalStreams[f].length===1&&delete this._shimmedLocalStreams[f]}),u.apply(this,arguments)}}function re(i){function r(E,_){var S;let N=_.sdp;return W(S=dt(E._reverseStreams||[])).call(S,k=>{k=E._reverseStreams[k],N=N.replace(new RegExp(E._streams[k.id].id,"g"),k.id)}),new RTCSessionDescription({type:_.type,sdp:N})}function s(E,_){var S;let N=_.sdp;return W(S=dt(E._reverseStreams||[])).call(S,k=>{k=E._reverseStreams[k],N=N.replace(new RegExp(k.id,"g"),E._streams[k.id].id)}),new RTCSessionDescription({type:_.type,sdp:N})}var c;if(i.RTCPeerConnection){var u=v(i);if(i.RTCPeerConnection.prototype.addTrack&&65<=u.version)return F(i);var h=i.RTCPeerConnection.prototype.getLocalStreams;i.RTCPeerConnection.prototype.getLocalStreams=function(){let E=h.apply(this);return this._reverseStreams=this._reverseStreams||{},Ie(E).call(E,_=>this._reverseStreams[_.id])};var A=i.RTCPeerConnection.prototype.addStream;i.RTCPeerConnection.prototype.addStream=function(E){var _;this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},W(_=E.getTracks()).call(_,S=>{var N;if(Je(N=this.getSenders()).call(N,k=>k.track===S))throw new DOMException("Track already exists.","InvalidAccessError")}),this._reverseStreams[E.id]||(_=new i.MediaStream(E.getTracks()),this._streams[E.id]=_,this._reverseStreams[_.id]=E,E=_),A.apply(this,[E])};var f=i.RTCPeerConnection.prototype.removeStream;i.RTCPeerConnection.prototype.removeStream=function(E){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},f.apply(this,[this._streams[E.id]||E]),delete this._reverseStreams[this._streams[E.id]?this._streams[E.id].id:E.id],delete this._streams[E.id]},i.RTCPeerConnection.prototype.addTrack=function(E,_){var S,N,k;if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let B=Mr([]).call(arguments,1);if(B.length!==1||!Je(S=B[0].getTracks()).call(S,P=>P===E))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(Je(N=this.getSenders()).call(N,P=>P.track===E))throw new DOMException("Track already exists.","InvalidAccessError");return this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},(S=this._streams[_.id])?(S.addTrack(E),ce.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))})):(S=new i.MediaStream([E]),this._streams[_.id]=S,this._reverseStreams[S.id]=_,this.addStream(S)),Je(k=this.getSenders()).call(k,P=>P.track===E)},W(c=["createOffer","createAnswer"]).call(c,function(E){let _=i.RTCPeerConnection.prototype[E];i.RTCPeerConnection.prototype[E]={[E](){const S=arguments;return arguments.length&&typeof arguments[0]=="function"?_.apply(this,[N=>{N=r(this,N),S[0].apply(null,[N])},N=>{S[1]&&S[1].apply(null,N)},arguments[2]]):_.apply(this,arguments).then(N=>r(this,N))}}[E]});var m=i.RTCPeerConnection.prototype.setLocalDescription;i.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=s(this,arguments[0]),m.apply(this,arguments)):m.apply(this,arguments)};var I=ct(i.RTCPeerConnection.prototype,"localDescription");ht(i.RTCPeerConnection.prototype,"localDescription",{get(){let E=I.get.apply(this);return E.type===""?E:r(this,E)}}),i.RTCPeerConnection.prototype.removeTrack=function(E){var _;if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!E._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(E._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let S;this._streams=this._streams||{},W(_=dt(this._streams)).call(_,N=>{var k;Je(k=this._streams[N].getTracks()).call(k,B=>E.track===B)&&(S=this._streams[N])}),S&&(S.getTracks().length===1?this.removeStream(this._reverseStreams[S.id]):S.removeTrack(E.track),this.dispatchEvent(new Event("negotiationneeded")))}}}function Q(i){let r=v(i);if(!i.RTCPeerConnection&&i.webkitRTCPeerConnection&&(i.RTCPeerConnection=i.webkitRTCPeerConnection),i.RTCPeerConnection){var s;53>r.version&&W(s=["setLocalDescription","setRemoteDescription","addIceCandidate"]).call(s,function(u){let h=i.RTCPeerConnection.prototype[u];i.RTCPeerConnection.prototype[u]={[u](){return arguments[0]=new(u==="addIceCandidate"?i.RTCIceCandidate:i.RTCSessionDescription)(arguments[0]),h.apply(this,arguments)}}[u]});var c=i.RTCPeerConnection.prototype.addIceCandidate;i.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?78>r.version&&arguments[0]&&arguments[0].candidate===""?ce.resolve():c.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),ce.resolve())}}}function Ae(i){a(i,"negotiationneeded",r=>{if(r.target.signalingState==="stable")return r})}function oe(i,r,s,c,u){return r=xe.writeRtpDescription(i.kind,r),r+=xe.writeIceParameters(i.iceGatherer.getLocalParameters()),r+=xe.writeDtlsParameters(i.dtlsTransport.getLocalParameters(),s==="offer"?"actpass":u||"active"),r+="a=mid:"+i.mid+`\r
`,i.rtpSender&&i.rtpReceiver?r+=`a=sendrecv\r
`:i.rtpSender?r+=`a=sendonly\r
`:i.rtpReceiver?r+=`a=recvonly\r
`:r+=`a=inactive\r
`,i.rtpSender&&(s=i.rtpSender._initialTrackId||i.rtpSender.track.id,i.rtpSender._initialTrackId=s,c="msid:"+(c?c.id:"-")+" "+s+`\r
`,r=r+("a="+c)+("a=ssrc:"+i.sendEncodingParameters[0].ssrc+" "+c),i.sendEncodingParameters[0].rtx&&(r+="a=ssrc:"+i.sendEncodingParameters[0].rtx.ssrc+" "+c,r+="a=ssrc-group:FID "+i.sendEncodingParameters[0].ssrc+" "+i.sendEncodingParameters[0].rtx.ssrc+`\r
`)),r+="a=ssrc:"+i.sendEncodingParameters[0].ssrc+" cname:"+xe.localCName+`\r
`,i.rtpSender&&i.sendEncodingParameters[0].rtx&&(r+="a=ssrc:"+i.sendEncodingParameters[0].rtx.ssrc+" cname:"+xe.localCName+`\r
`),r}function Te(i,r){var s={codecs:[],headerExtensions:[],fecMechanisms:[]},c=function(h,A){h=parseInt(h,10);for(var f=0;f<A.length;f++)if(A[f].payloadType===h||A[f].preferredPayloadType===h)return A[f]},u=function(h,A,f,m){return h=c(h.parameters.apt,f),A=c(A.parameters.apt,m),h&&A&&h.name.toLowerCase()===A.name.toLowerCase()};return i.codecs.forEach(function(h){for(var A=0;A<r.codecs.length;A++){var f=r.codecs[A];if(h.name.toLowerCase()===f.name.toLowerCase()&&h.clockRate===f.clockRate&&(h.name.toLowerCase()!=="rtx"||!h.parameters||!f.parameters.apt||u(h,f,i.codecs,r.codecs))){(f=JSON.parse(JSON.stringify(f))).numChannels=Math.min(h.numChannels,f.numChannels),s.codecs.push(f),f.rtcpFeedback=f.rtcpFeedback.filter(function(m){for(var I=0;I<h.rtcpFeedback.length;I++)if(h.rtcpFeedback[I].type===m.type&&h.rtcpFeedback[I].parameter===m.parameter)return!0;return!1});break}}}),i.headerExtensions.forEach(function(h){for(var A=0;A<r.headerExtensions.length;A++){var f=r.headerExtensions[A];if(h.uri===f.uri){s.headerExtensions.push(f);break}}}),s}function je(i,r,s){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[r][i].indexOf(s)!==-1}function We(i,r){var s=i.getRemoteCandidates().find(function(c){return r.foundation===c.foundation&&r.ip===c.ip&&r.port===c.port&&r.priority===c.priority&&r.protocol===c.protocol&&r.type===c.type});return s||i.addRemoteCandidate(r),!s}function Oe(i,r){return r=Error(r),r.name=i,r.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[i],r}function Mt(i){var r;i=i&&i.navigator;let s=cr(r=i.mediaDevices.getUserMedia).call(r,i.mediaDevices);i.mediaDevices.getUserMedia=function(c){return s(c).catch(u=>ce.reject(function(h){return{name:{PermissionDeniedError:"NotAllowedError"}[h.name]||h.name,message:h.message,constraint:h.constraint,toString(){return this.name}}}(u)))}}function At(i){var r;"getDisplayMedia"in i.navigator&&i.navigator.mediaDevices&&(i.navigator.mediaDevices&&"getDisplayMedia"in i.navigator.mediaDevices||(i.navigator.mediaDevices.getDisplayMedia=cr(r=i.navigator.getDisplayMedia).call(r,i.navigator)))}function Gt(i){let r=v(i);if(i.RTCIceGatherer&&(i.RTCIceCandidate||(i.RTCIceCandidate=function(c){return c}),i.RTCSessionDescription||(i.RTCSessionDescription=function(c){return c}),15025>r.version)){let c=ct(i.MediaStreamTrack.prototype,"enabled");ht(i.MediaStreamTrack.prototype,"enabled",{set(u){c.set.call(this,u);let h=new Event("enabled");h.enabled=u,this.dispatchEvent(h)}})}!i.RTCRtpSender||"dtmf"in i.RTCRtpSender.prototype||ht(i.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=new i.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}}),i.RTCDtmfSender&&!i.RTCDTMFSender&&(i.RTCDTMFSender=i.RTCDtmfSender);let s=CR(i,r.version);i.RTCPeerConnection=function(c){return c&&c.iceServers&&(c.iceServers=function(u,h){let A=!1;return u=JSON.parse(fe(u)),Qe(u).call(u,f=>{if(f&&(f.urls||f.url)){var m=f.urls||f.url;f.url&&!f.urls&&g("RTCIceServer.url","RTCIceServer.urls");let I=typeof m=="string";return I&&(m=[m]),m=Qe(m).call(m,E=>Ge(E).call(E,"stun:")===0?!1:(E=il(E).call(E,"turn")&&!il(E).call(E,"turn:[")&&gt(E).call(E,"transport=udp"))&&!A?(A=!0,!0):E&&!A),delete f.url,f.urls=I?m[0]:m,!!m.length}})}(c.iceServers,r.version),p("ICE servers after filtering:",c.iceServers)),new s(c)},i.RTCPeerConnection.prototype=s.prototype}function Dr(i){!i.RTCRtpSender||"replaceTrack"in i.RTCRtpSender.prototype||(i.RTCRtpSender.prototype.replaceTrack=i.RTCRtpSender.prototype.setTrack)}function Lt(i){let r=v(i),s=i&&i.navigator;if(i=i&&i.MediaStreamTrack,s.getUserMedia=function(u,h,A){g("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),s.mediaDevices.getUserMedia(u).then(h,A)},!(55<r.version&&"autoGainControl"in s.mediaDevices.getSupportedConstraints())){var c;let u=function(A,f,m){f in A&&!(m in A)&&(A[m]=A[f],delete A[f])},h=cr(c=s.mediaDevices.getUserMedia).call(c,s.mediaDevices);if(s.mediaDevices.getUserMedia=function(A){return typeof A=="object"&&typeof A.audio=="object"&&(A=JSON.parse(fe(A)),u(A.audio,"autoGainControl","mozAutoGainControl"),u(A.audio,"noiseSuppression","mozNoiseSuppression")),h(A)},i&&i.prototype.getSettings){let A=i.prototype.getSettings;i.prototype.getSettings=function(){let f=A.apply(this,arguments);return u(f,"mozAutoGainControl","autoGainControl"),u(f,"mozNoiseSuppression","noiseSuppression"),f}}if(i&&i.prototype.applyConstraints){let A=i.prototype.applyConstraints;i.prototype.applyConstraints=function(f){return this.kind==="audio"&&typeof f=="object"&&(f=JSON.parse(fe(f)),u(f,"autoGainControl","mozAutoGainControl"),u(f,"noiseSuppression","mozNoiseSuppression")),A.apply(this,[f])}}}}function at(i){typeof i=="object"&&i.RTCTrackEvent&&"receiver"in i.RTCTrackEvent.prototype&&!("transceiver"in i.RTCTrackEvent.prototype)&&ht(i.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function $t(i){let r=v(i);if(typeof i=="object"&&(i.RTCPeerConnection||i.mozRTCPeerConnection)){var s;!i.RTCPeerConnection&&i.mozRTCPeerConnection&&(i.RTCPeerConnection=i.mozRTCPeerConnection),53>r.version&&W(s=["setLocalDescription","setRemoteDescription","addIceCandidate"]).call(s,function(A){let f=i.RTCPeerConnection.prototype[A];i.RTCPeerConnection.prototype[A]={[A](){return arguments[0]=new(A==="addIceCandidate"?i.RTCIceCandidate:i.RTCSessionDescription)(arguments[0]),f.apply(this,arguments)}}[A]});var c=i.RTCPeerConnection.prototype.addIceCandidate;i.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?68>r.version&&arguments[0]&&arguments[0].candidate===""?ce.resolve():c.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),ce.resolve())};var u={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},h=i.RTCPeerConnection.prototype.getStats;i.RTCPeerConnection.prototype.getStats=function(){let[A,f,m]=arguments;return h.apply(this,[A||null]).then(I=>{if(53>r.version&&!f)try{W(I).call(I,E=>{E.type=u[E.type]||E.type})}catch(E){if(E.name!=="TypeError")throw E;W(I).call(I,(_,S)=>{I.set(S,Zr({},_,{type:u[_.type]||_.type}))})}return I}).then(f,m)}}}function Cr(i){if(typeof i=="object"&&i.RTCPeerConnection&&i.RTCRtpSender&&!(i.RTCRtpSender&&"getStats"in i.RTCRtpSender.prototype)){var r=i.RTCPeerConnection.prototype.getSenders;r&&(i.RTCPeerConnection.prototype.getSenders=function(){let c=r.apply(this,[]);return W(c).call(c,u=>u._pc=this),c});var s=i.RTCPeerConnection.prototype.addTrack;s&&(i.RTCPeerConnection.prototype.addTrack=function(){let c=s.apply(this,arguments);return c._pc=this,c}),i.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):ce.resolve(new Ct)}}}function ei(i){if(typeof i=="object"&&i.RTCPeerConnection&&i.RTCRtpSender&&!(i.RTCRtpSender&&"getStats"in i.RTCRtpReceiver.prototype)){var r=i.RTCPeerConnection.prototype.getReceivers;r&&(i.RTCPeerConnection.prototype.getReceivers=function(){let s=r.apply(this,[]);return W(s).call(s,c=>c._pc=this),s}),a(i,"track",s=>(s.receiver._pc=s.srcElement,s)),i.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}}function ti(i){!i.RTCPeerConnection||"removeStream"in i.RTCPeerConnection.prototype||(i.RTCPeerConnection.prototype.removeStream=function(r){var s;g("removeStream","removeTrack"),W(s=this.getSenders()).call(s,c=>{var u;c.track&&gt(u=r.getTracks()).call(u,c.track)&&this.removeTrack(c)})})}function io(i){i.DataChannel&&!i.RTCDataChannel&&(i.RTCDataChannel=i.DataChannel)}function ri(i){if(typeof i=="object"&&i.RTCPeerConnection){if("getLocalStreams"in i.RTCPeerConnection.prototype||(i.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in i.RTCPeerConnection.prototype)){let r=i.RTCPeerConnection.prototype.addTrack;i.RTCPeerConnection.prototype.addStream=function(s){var c,u,h;this._localStreams||(this._localStreams=[]),gt(c=this._localStreams).call(c,s)||this._localStreams.push(s),W(u=s.getAudioTracks()).call(u,A=>r.call(this,A,s)),W(h=s.getVideoTracks()).call(h,A=>r.call(this,A,s))},i.RTCPeerConnection.prototype.addTrack=function(s,c){var u;return c&&(this._localStreams?gt(u=this._localStreams).call(u,c)||this._localStreams.push(c):this._localStreams=[c]),r.call(this,s,c)}}"removeStream"in i.RTCPeerConnection.prototype||(i.RTCPeerConnection.prototype.removeStream=function(r){var s,c,u;this._localStreams||(this._localStreams=[]);let h=Ge(s=this._localStreams).call(s,r);if(h!==-1){Gr(c=this._localStreams).call(c,h,1);var A=r.getTracks();W(u=this.getSenders()).call(u,f=>{gt(A).call(A,f.track)&&this.removeTrack(f)})}})}}function oo(i){if(typeof i=="object"&&i.RTCPeerConnection&&("getRemoteStreams"in i.RTCPeerConnection.prototype||(i.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in i.RTCPeerConnection.prototype))){ht(i.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(s){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=s),this.addEventListener("track",this._onaddstreampoly=c=>{var u;W(u=c.streams).call(u,h=>{var A;this._remoteStreams||(this._remoteStreams=[]),gt(A=this._remoteStreams).call(A,h)||(this._remoteStreams.push(h),A=new Event("addstream"),A.stream=h,this.dispatchEvent(A))})})}});let r=i.RTCPeerConnection.prototype.setRemoteDescription;i.RTCPeerConnection.prototype.setRemoteDescription=function(){let s=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(c){var u;W(u=c.streams).call(u,h=>{var A;s._remoteStreams||(s._remoteStreams=[]),0<=Ge(A=s._remoteStreams).call(A,h)||(s._remoteStreams.push(h),A=new Event("addstream"),A.stream=h,s.dispatchEvent(A))})}),r.apply(s,arguments)}}}function vi(i){if(typeof i=="object"&&i.RTCPeerConnection){i=i.RTCPeerConnection.prototype;var r=i.createOffer,s=i.createAnswer,c=i.setLocalDescription,u=i.setRemoteDescription,h=i.addIceCandidate;i.createOffer=function(f,m){let I=r.apply(this,[2<=arguments.length?arguments[2]:arguments[0]]);return m?(I.then(f,m),ce.resolve()):I},i.createAnswer=function(f,m){let I=s.apply(this,[2<=arguments.length?arguments[2]:arguments[0]]);return m?(I.then(f,m),ce.resolve()):I};var A=function(f,m,I){return f=c.apply(this,[f]),I?(f.then(m,I),ce.resolve()):f};i.setLocalDescription=A,A=function(f,m,I){return f=u.apply(this,[f]),I?(f.then(m,I),ce.resolve()):f},i.setRemoteDescription=A,A=function(f,m,I){return f=h.apply(this,[f]),I?(f.then(m,I),ce.resolve()):f},i.addIceCandidate=A}}function Fn(i){let r=i&&i.navigator;if(r.mediaDevices&&r.mediaDevices.getUserMedia){var s;i=r.mediaDevices;let u=cr(s=i.getUserMedia).call(s,i);r.mediaDevices.getUserMedia=h=>u(Ei(h))}var c;!r.getUserMedia&&r.mediaDevices&&r.mediaDevices.getUserMedia&&(r.getUserMedia=cr(c=function(u,h,A){r.mediaDevices.getUserMedia(u).then(h,A)}).call(c,r))}function Ei(i){return i&&i.video!==void 0?Zr({},i,{video:C(i.video)}):i}function bo(i){let r=i.RTCPeerConnection;i.RTCPeerConnection=function(s,c){if(s&&s.iceServers){let u=[];for(let h=0;h<s.iceServers.length;h++){let A=s.iceServers[h];!A.hasOwnProperty("urls")&&A.hasOwnProperty("url")?(g("RTCIceServer.url","RTCIceServer.urls"),A=JSON.parse(fe(A)),A.urls=A.url,delete A.url,u.push(A)):u.push(s.iceServers[h])}s.iceServers=u}return new r(s,c)},i.RTCPeerConnection.prototype=r.prototype,"generateCertificate"in i.RTCPeerConnection&&ht(i.RTCPeerConnection,"generateCertificate",{get:()=>r.generateCertificate})}function Ii(i){typeof i=="object"&&i.RTCPeerConnection&&"receiver"in i.RTCTrackEvent.prototype&&!i.RTCTransceiver&&ht(i.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Do(i){let r=i.RTCPeerConnection.prototype.createOffer;i.RTCPeerConnection.prototype.createOffer=function(s){if(s){var c,u;s.offerToReceiveAudio!==void 0&&(s.offerToReceiveAudio=!!s.offerToReceiveAudio);let h=Je(c=this.getTransceivers()).call(c,A=>A.receiver.track.kind==="audio");s.offerToReceiveAudio===!1&&h?h.direction==="sendrecv"?h.setDirection?h.setDirection("sendonly"):h.direction="sendonly":h.direction==="recvonly"&&(h.setDirection?h.setDirection("inactive"):h.direction="inactive"):s.offerToReceiveAudio!==!0||h||this.addTransceiver("audio"),s.offerToReceiveVideo!==void 0&&(s.offerToReceiveVideo=!!s.offerToReceiveVideo),c=Je(u=this.getTransceivers()).call(u,A=>A.receiver.track.kind==="video"),s.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):s.offerToReceiveVideo!==!0||c||this.addTransceiver("video")}return r.apply(this,arguments)}}function ni(i){if(i.RTCIceCandidate&&!(i.RTCIceCandidate&&"foundation"in i.RTCIceCandidate.prototype)){var r=i.RTCIceCandidate;i.RTCIceCandidate=function(s){var c;if(typeof s=="object"&&s.candidate&&Ge(c=s.candidate).call(c,"a=")===0&&((s=JSON.parse(fe(s))).candidate=s.candidate.substr(2)),s.candidate&&s.candidate.length){c=new r(s),s=xe.parseCandidate(s.candidate);let u=Zr(c,s);return u.toJSON=function(){return{candidate:u.candidate,sdpMid:u.sdpMid,sdpMLineIndex:u.sdpMLineIndex,usernameFragment:u.usernameFragment}},u}return new r(s)},i.RTCIceCandidate.prototype=r.prototype,a(i,"icecandidate",s=>(s.candidate&&ht(s,"candidate",{value:new i.RTCIceCandidate(s.candidate),writable:"false"}),s))}}function Ci(i){if(i.RTCPeerConnection){var r=v(i);"sctp"in i.RTCPeerConnection.prototype||ht(i.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});var s=function(f){return!f||!f.sdp?!1:(f=xe.splitSections(f.sdp),f.shift(),sE(f).call(f,m=>{var I;return(m=xe.parseMLine(m))&&m.kind==="application"&&Ge(I=m.protocol).call(I,"SCTP")!==-1}))},c=function(f){return f=f.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/),f===null||2>f.length?-1:(f=ar(f[1],10),f!=f?-1:f)},u=function(f){let m=65536;return r.browser==="firefox"&&(m=57>r.version?f===-1?16384:2147483637:60>r.version?r.version===57?65535:65536:2147483637),m},h=function(f,m){let I=65536;return r.browser==="firefox"&&r.version===57&&(I=65535),f=xe.matchPrefix(f.sdp,"a=max-message-size:"),0<f.length?I=ar(f[0].substr(19),10):r.browser==="firefox"&&m!==-1&&(I=2147483637),I},A=i.RTCPeerConnection.prototype.setRemoteDescription;i.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,r.browser==="chrome"&&76<=r.version){var{sdpSemantics:f}=this.getConfiguration();f==="plan-b"&&ht(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(s(arguments[0])){var m=c(arguments[0]);f=u(m),m=h(arguments[0],m);let I;I=f===0&&m===0?Number.POSITIVE_INFINITY:f===0||m===0?Math.max(f,m):Math.min(f,m),f={},ht(f,"maxMessageSize",{get:()=>I}),this._sctp=f}return A.apply(this,arguments)}}}function so(i){function r(c,u){let h=c.send;c.send=function(){var A=arguments[0];if(A=A.length||A.size||A.byteLength,c.readyState==="open"&&u.sctp&&A>u.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+u.sctp.maxMessageSize+" bytes)");return h.apply(c,arguments)}}if(i.RTCPeerConnection&&"createDataChannel"in i.RTCPeerConnection.prototype){var s=i.RTCPeerConnection.prototype.createDataChannel;i.RTCPeerConnection.prototype.createDataChannel=function(){let c=s.apply(this,arguments);return r(c,this),c},a(i,"datachannel",c=>(r(c.channel,c.target),c))}}function Bo(i){var r;if(i.RTCPeerConnection&&!("connectionState"in i.RTCPeerConnection.prototype)){var s=i.RTCPeerConnection.prototype;ht(s,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),ht(s,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(c){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),c&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=c)},enumerable:!0,configurable:!0}),W(r=["setLocalDescription","setRemoteDescription"]).call(r,c=>{let u=s[c];s[c]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=h=>{let A=h.target;if(A._lastConnectionState!==A.connectionState){A._lastConnectionState=A.connectionState;let f=new Event("connectionstatechange",h);A.dispatchEvent(f)}return h},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),u.apply(this,arguments)}})}}function $o(i){if(i.RTCPeerConnection){var r=v(i);if(!(r.browser==="chrome"&&71<=r.version)){var s=i.RTCPeerConnection.prototype.setRemoteDescription;i.RTCPeerConnection.prototype.setRemoteDescription=function(c){var u,h;return c&&c.sdp&&Ge(u=c.sdp).call(u,`
a=extmap-allow-mixed`)!==-1&&(c.sdp=Qe(h=c.sdp.split(`
`)).call(h,A=>Ws(A).call(A)!=="a=extmap-allow-mixed").join(`
`)),s.apply(this,arguments)}}}}function Ye(i){i&&Ep.setUA(i),pn=Ep.getResult(),i=bs(pn);var r,s=(r=pn.engine.name==="Blink"?pn.engine.version||"":pn.browser.version||"",r.split(".")[0]);e:switch(pn.os.name){case"Windows":r=pn.os.version?pn.os.name+" "+pn.os.version:pn.os.name;break e;default:r=pn.os.name||""}return{name:i,version:s,os:r,osVersion:pn.os.version}}function bs(i){if(i.engine.name==="Blink")return ze.CHROME;switch(i.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return ze.CHROME;case"Safari":case"Mobile Safari":return ze.SAFARI;case"Edge":return ze.EDGE;case"Firefox":return ze.FIREFOX;case"QQBrowser":return ze.QQ;case"Opera":return ze.OPERA;case"WeChat":return ze.WECHAT;default:return i.browser.name||""}}function ao(){let i=Ye();return!!(pn.engine.name==="WebKit"&&i.os===Lr.MAC_OS&&navigator.maxTouchPoints&&0<navigator.maxTouchPoints&&i.name!==ze.SAFARI||Br()&&i.name!==ze.SAFARI)}function ya(){var i=Ye();return!!(ao()&&(i.os===Lr.MAC_OS||i.os===Lr.IOS&&((i=pn.os.version&&pn.os.version.split("."))&&Number(i[0])===14&&i[1]&&3<=Number(i[1])||i&&14<Number(i[0]))))}function co(){return Ye().name===ze.CHROME}function dn(){return Ye().name===ze.SAFARI}function Xt(){return Ye().name===ze.FIREFOX}function Br(){return Ye().os===Lr.IOS}function Vn(){var i=Ye();return i.os!==Lr.IOS||!i.osVersion?!1:(i=i.osVersion.split("."),Number(i[0])===15)}function es(){var i=Ye();return i.os!==Lr.IOS||!i.osVersion?!1:(i=i.osVersion.split("."),Number(i[0])===15&&Number(i[1])===0)}function Ds(){var i=Ye();return i.os!==Lr.IOS||!i.osVersion?!1:(i=i.osVersion.split("."),Number(i[0])===15&&1<=Number(i[1]))}function Gn(){return dn()&&0<navigator.maxTouchPoints}function Bs(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&35>=window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]}function ts(){let i=Ye();return i.name===ze.EDGE||i.name===ze.SAFARI?!1:!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function rs(i){return typeof i=="string"?Zr({},_R[i]):i}function xc(i){return typeof i=="string"?Zr({},SR[i]):i}function _a(i){return typeof i=="string"?Zr({},TR[i]):i}function Sa(i){return typeof i=="string"?Zr({},RR[i]):i}function Ur(i,r){var s;gt(s=dt(ne)).call(s,i)&&(ne[i]=r)}function X(i,r,s){return{sampleRate:i,stereo:r,bitrate:s}}function te(i,r,s,c,u){return{width:i,height:r,frameRate:s,bitrateMin:c,bitrateMax:u}}function be(i,r,s,c,u){return{width:{max:i},height:{max:r},frameRate:s,bitrateMin:c,bitrateMax:u}}function St(i,r){return{numSpatialLayers:i,numTemporalLayers:r}}function ft(i){return qa.call(i)==="[object Array]"}function Fr(i){return i!==null&&typeof i=="object"}function Sn(i){return qa.call(i)==="[object Function]"}function Vi(i,r){if(i!=null)if(typeof i!="object"&&(i=[i]),ft(i))for(var s=0,c=i.length;s<c;s++)r.call(null,i[s],s,i);else for(s in i)Object.prototype.hasOwnProperty.call(i,s)&&r.call(null,i[s],s,i)}function Uc(i){return encodeURIComponent(i).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function yi(){this.handlers=[]}function Ta(i,r){!He.isUndefined(i)&&He.isUndefined(i["Content-Type"])&&(i["Content-Type"]=r)}function lo(i){this.defaults=i,this.interceptors={request:new CE,response:new CE}}function uo(i){this.message=i}function Ra(i){if(typeof i!="function")throw new TypeError("executor must be a function.");var r;this.promise=new Promise(function(c){r=c});var s=this;i(function(c){s.reason||(s.reason=new SE(c),r(s.reason))})}function wa(i){i=new qu(i);var r=EE(qu.prototype.request,i);return He.extend(r,qu.prototype,i),He.extend(r,i),r}function Ms(){let i=new Date;return i.toTimeString().split(" ")[0]+":"+i.getMilliseconds()}function fu(i,r){if(typeof i!="boolean")throw new L(D.INVALID_PARAMS,"Invalid ".concat(r,": The value is of the boolean type."))}function hn(i,r,s){var c;if(!gt(s).call(s,i))throw new L(D.INVALID_PARAMS,b(c="".concat(r," can only be set as ")).call(c,fe(s)))}function It(i,r,s=1,c=1e4,u=!0){if(i<s||i>c||u&&(typeof i!="number"||i%1!=0)){var h,A;throw new L(D.INVALID_PARAMS,b(h=b(A="invalid ".concat(r,": the value range is [")).call(A,s,", ")).call(h,c,"]. integer only"))}}function Vr(i,r,s=1,c=255,u=!0){if(i==null)throw new L(D.INVALID_PARAMS,"".concat(r||"param"," cannot be empty"));var h,A,f;if(!Ng(i,s,c,u))throw new L(D.INVALID_PARAMS,b(h=b(A=b(f="Invalid ".concat(r||"string param",": Length of the string: [")).call(f,s,",")).call(A,c,"].")).call(h,u?" ASCII characters only.":""))}function Eh(i,r){if(!Wi(i))throw new L(D.INVALID_PARAMS,"".concat(r," should be an array"))}function Ih(i){if(typeof i!="string"||!/^[a-zA-Z0-9 !#\$%&\(\)\+\-:;<=\.>\?@\[\]\^_\{\}\|~,]{1,64}$/.test(i))throw R.error("Invalid Channel Name ".concat(i)),new L(D.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function Ch(i){var r;if(!(typeof i=="number"&&Math.floor(i)===i&&0<=i&&4294967295>=i||Ng(i,1,255)))throw R.error(b(r="Invalid UID ".concat(i," ")).call(r,typeof i)),new L(D.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");typeof i=="string"&&R.warning("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}function Ng(i,r=1,s=255,c=!0){if(r=typeof i=="string"&&i.length<=s&&i.length>=r){if(!(c=!c))e:if(typeof i!="string")c=!1;else{for(c=0;c<i.length;c+=1)if(r=i.charCodeAt(c),0>r||255<r){c=!1;break e}c=!0}r=c}return r}function nS(i){return Vr(i.reportId,"params.reportId",0,100,!1),Vr(i.category,"params.category",0,100,!1),Vr(i.event,"params.event",0,100,!1),Vr(i.label,"params.label",0,100,!1),It(i.value,"params.value",-9007199254740991,9007199254740991,!1),!0}function kg(i){return It(i.timeout,"config.timeout",0,1e5),It(i.timeoutFactor,"config.timeoutFactor",0,100,!1),It(i.maxRetryCount,"config.maxRetryConfig",0,1/0),It(i.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}function Og(i){if(!Wi(i)||1>i.length)return!1;try{W(i).call(i,r=>{if(!r.urls)throw Error()})}catch{return!1}return!0}function bg(i){return Vr(i.turnServerURL,"turnServerURL"),Vr(i.username,"username"),Vr(i.password,"password"),i.udpport&&It(i.udpport,"udpport",1,99999,!0),i.forceturn&&fu(i.forceturn,"forceturn"),i.security&&fu(i.security,"security"),i.tcpport&&It(i.tcpport,"tcpport",1,99999,!0),!0}function Dg(i){return i.level!==void 0&&hn(i.level,"level",[1,2,3]),!0}function yh(i,r){Vr(i.url,"".concat(r,".url"),1,1e3,!1),i.x==null||It(i.x,"".concat(r,".x"),0,1e4),i.y==null||It(i.y,"".concat(r,".y"),0,1e4),i.width==null||It(i.width,"".concat(r,".width"),0,1e4),i.height==null||It(i.height,"".concat(r,".height"),0,1e4),i.zOrder==null||It(i.zOrder,"".concat(r,".zOrder"),0,255),i.alpha==null||It(i.alpha,"".concat(r,".alpha"),0,1,!1)}function Bg(i){if(!i.channelName)throw new L(D.INVALID_PARAMS,"invalid channelName in info");if(!i.uid||typeof i.uid!="number")throw new L(D.INVALID_PARAMS,"invalid uid in info, uid must be a number");return i.token&&Vr(i.token,"info.token",1,2047),Ch(i.uid),Ih(i.channelName),!0}function Mg(i){return hn(i,"mediaSource",["screen","window","application"]),!0}function Lg(i,r){var s=dt(i);if(bt){var c=bt(i);r&&(c=Qe(c).call(c,function(u){return ct(i,u).enumerable})),s.push.apply(s,c)}return s}function Gi(i,r,s){return new ce((c,u)=>{r.timeout=r.timeout||ne.HTTP_CONNECT_TIMEOUT,r.responseType=r.responseType||"json",r.data&&!s?(r.data=fe(r.data),Zu+=ka(r.data)):s&&(r.data.size?Zu+=r.data.size:r.data instanceof FormData?Zu+=function(h){let A=0;return/DingTalk/i.test(navigator.userAgent)&&h.realFormData&&(h=h.realFormData),W(h).call(h,f=>{A+=typeof f=="string"?ka(f):f.size}),A+138}(r.data):Zu+=ka(fe(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=i,mo.request(r).then(h=>{typeof h.data=="string"?Pp+=ka(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?Pp+=h.data.byteLength:Pp+=ka(fe(h.data)),c(h.data)}).catch(h=>{mo.isCancel(h)?u(new L(D.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new L(D.NETWORK_TIMEOUT,h.message)):h.response?u(new L(D.NETWORK_RESPONSE_ERROR,h.response.status)):u(new L(D.NETWORK_ERROR,h.message))})})}async function iS(i,r){let s=new Blob([r.data],{type:"buffer"});return await Gi(i,function(c){for(var u=1;u<arguments.length;u++){var h,A=arguments[u]!=null?arguments[u]:{};if(u%2)W(h=Lg(Object(A),!0)).call(h,function(m){gn(c,m,A[m])});else if(Ot)An(c,Ot(A));else{var f;W(f=Lg(Object(A))).call(f,function(m){ht(c,m,ct(A,m))})}}return c}({},r,{data:s,headers:{"Content-Type":"application/octet-stream"}}),!0)}function ho(i,r,s,c){let u=Zr({},Tr,c),h=u.timeout,A=async()=>{await Tn(h),h*=u.timeoutFactor,h=Math.min(u.maxRetryTimeout,h)},f=!1;return c=new ce(async(m,I)=>{r=r||(()=>!1),s=s||(()=>!0);for(let E=0;E<u.maxRetryCount;E+=1){if(f)return I(new L(D.OPERATION_ABORTED));try{const _=await i();if(!r(_,E)||E+1===u.maxRetryCount)return m(_);await A()}catch(_){if(!s(_,E)||E+1===u.maxRetryCount)return I(_);await A()}}}),c.cancel=()=>f=!0,c}function Pg(i,r){var s=dt(i);if(bt){var c=bt(i);r&&(c=Qe(c).call(c,function(u){return ct(i,u).enumerable})),s.push.apply(s,c)}return s}function Ar(i){for(var r=1;r<arguments.length;r++){var s,c=arguments[r]!=null?arguments[r]:{};if(r%2)W(s=Pg(Object(c),!0)).call(s,function(h){gn(i,h,c[h])});else if(Ot)An(i,Ot(c));else{var u;W(u=Pg(Object(c))).call(u,function(h){ht(i,h,ct(c,h))})}}return i}function Fc(i={report:z}){return function(r,s,c){let u=r[s];if(typeof u=="function"){let h=r.constructor.name==="AgoraRTCClient"?"Client":r.constructor.name;c.value=function(...A){var f;let m=i.report.reportApiInvoke(this._sessionId||null,{name:b(f="".concat(h,".")).call(f,s),options:A,tag:Re.TRACER});try{let I=u.apply(this,A);return m.onSuccess(),I}catch(I){throw m.onError(I),I}}}return c}}function _h(i={report:z}){return function(r,s,c){let u=r[s];if(typeof u=="function"){let h=r.constructor.name==="AgoraRTCClient"?"Client":r.constructor.name;c.value=async function(...A){var f;let m=i.report.reportApiInvoke(this._sessionId||null,{name:b(f="".concat(h,".")).call(f,s),options:A,tag:Re.TRACER});try{let I=await u.apply(this,A);return m.onSuccess(),I}catch(I){throw m.onError(I),I}}}return c}}function oS(){YE?(R.info("create audio context"),zi=new YE,ot.curState=zi.state,zi.onstatechange=()=>{var i;ot.prevState=ot.curState,ot.curState=zi?zi.state:void 0,R.debug("AudioContext State Change",b(i="".concat(ot.prevState,"=>")).call(i,ot.curState)),(Br()||Gn())&&ot.prevState==="running"&&ot.curState==="interrupted"&&(R.info("ios-interruption-start"),ot.emit(Rr.IOS_INTERRUPTION_START)),(Br()||Gn())&&ot.prevState==="interrupted"&&ot.curState==="running"&&(R.info("ios-interruption-end"),ot.emit(Rr.IOS_INTERRUPTION_END)),ot.emit("state-change")},async function(i){function r(k){i.state==="running"?s(!1):Br()||Gn()?i.state==="suspended"&&(s(!0),k?i.resume().then(c,c):s(!1)):i.state!=="closed"&&(s(!0),k?i.resume().then(c,c):s(!1))}function s(k){if(_!==k){_=k;for(let B=0,P=I;B<P.length;B+=1){let J=P[B];k?window.addEventListener(J,u,{capture:!0,passive:!0}):window.removeEventListener(J,u,{capture:!0,passive:!0})}}}function c(){r(!1)}function u(){r(!0)}function h(k){if(!N)if(E.paused)if(k){A(!1),N=!0,k=void 0;try{(k=E.play())?k.then(f,f):(E.addEventListener("playing",f),E.addEventListener("abort",f),E.addEventListener("error",f))}catch{f()}}else A(!0);else A(!1)}function A(k){if(S!==k){S=k;for(let B=0,P=I;B<P.length;B++){let J=P[B];k?window.addEventListener(J,m,{capture:!0,passive:!0}):window.removeEventListener(J,m,{capture:!0,passive:!0})}}}function f(){E.removeEventListener("playing",f),E.removeEventListener("abort",f),E.removeEventListener("error",f),N=!1,h(!1)}function m(){h(!0)}let I="click contextmenu auxclick dblclick mousedown mouseup touchend keydown keyup".split(" "),E,_=!1,S=!1,N=!1;if(Br()){let k=i.createMediaStreamDestination(),B=document.createElement("div");B.innerHTML="<audio x-webkit-airplay='deny'></audio>",E=B.children.item(0),E.controls=!1,E.disableRemotePlayback=!0,E.preload="auto",E.srcObject=k.stream,h(!0)}ot.on("state-change",function(){r(!0)}),r(!1)}(zi)):R.error("your browser is not support web audio")}function Vc(){if(!zi&&(oS(),!zi))throw new L(D.NOT_SUPPORTED,"can not create audio context");return zi}function Gc(i){if(!function(){if(Qp!==null)return Qp;var c=Vc();let u=c.createBufferSource(),h=c.createGain();c=c.createGain(),u.connect(h),u.connect(c),u.disconnect(h),c=!1;try{u.disconnect(h)}catch{c=!0}return u.disconnect(),Qp=c,c}()){R.debug("polyfill audio node");var r=i.connect,s=i.disconnect;i.connect=(c,u,h)=>{var A;return i._inputNodes||(i._inputNodes=[]),gt(A=i._inputNodes).call(A,c)||(c instanceof AudioNode?(i._inputNodes.push(c),r.call(i,c,u,h)):r.call(i,c,u)),i},i.disconnect=(c,u,h)=>{s.call(i),c?Ps(i._inputNodes,c):i._inputNodes=[];for(let A of i._inputNodes)r.call(i,A)}}}function Sh(i,r){let s=1/r,c=Vc(),u=c.createGain();u.gain.value=0,u.connect(c.destination);let h=!1,A=()=>{if(h)return void(u=null);const f=c.createOscillator();f.onended=A,f.connect(u),f.start(0),f.stop(c.currentTime+s),i(c.currentTime)};return A(),()=>{h=!0}}async function Qg(i,r){let s=(c,u)=>c?typeof c!="number"?c.max||c.exact||c.ideal||c.min||u:c:u;return i={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxHeight:s(r.height,1080),maxWidth:s(r.width,1920)}}},r.frameRate&&typeof r.frameRate!="number"?(i.video.mandatory.maxFrameRate=r.frameRate.max,i.video.mandatory.minFrameRate=r.frameRate.min):typeof r.frameRate=="number"&&(i.video.mandatory.maxFrameRate=r.frameRate),await navigator.mediaDevices.getUserMedia(i)}async function sS(i){let r=await function(s){return new ce((c,u)=>{const h=document.createElement("div");h.innerText="share screen",h.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const A=document.createElement("div");A.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const f=document.createElement("div");f.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",f.setAttribute("style","height: 12%;");const m=document.createElement("div");m.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const I=document.createElement("div");I.setAttribute("style","text-align: right; padding: 16px 0;");const E=document.createElement("button");E.innerHTML="cancel",E.setAttribute("style","width: 85px;"),E.onclick=()=>{document.body.removeChild(_);const S=Error("NotAllowedError");S.name="NotAllowedError",u(S)},I.appendChild(E),A.appendChild(f),A.appendChild(m),A.appendChild(I);const _=document.createElement("div");_.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),_.appendChild(h),_.appendChild(A),document.body.appendChild(_),Ie(s).call(s,S=>{if(S.id){const N=document.createElement("div");N.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let k=S.thumbnail;const{width:B}=k.getSize();1920<B&&(k=k.resize({width:1920})),N.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+k.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+(S.name.replace(/[\u00A0-\u9999<>&]/g,function(P){return"&#"+P.charCodeAt(0)+";"})+"</span>"),N.onclick=()=>{document.body.removeChild(_),c(S.id)},m.appendChild(N)}})})}(await xg(i.mediaSource));return await Qg(r,i)}async function xg(i){let r=["window","screen"];i!=="application"&&i!=="window"||(r=["window"]),i==="screen"&&(r=["screen"]);let s=Ug();if(!s)throw new L(D.ELECTRON_IS_NULL);i=null;try{i=s.desktopCapturer.getSources({types:r})}catch{i=null}i&&i.then||(i=new ce((c,u)=>{s.desktopCapturer.getSources({types:r},(h,A)=>{h?u(h):c(A)})}));try{return await i}catch(c){throw new L(D.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,c.toString())}}function Ug(){if(ed)return ed;try{return ed=window.require("electron"),ed}catch{return null}}async function _i(i,r){let s=0,c=null;for(;2>s;)try{c=await aS(i,r,0<s);break}catch(A){var u,h;if(A instanceof L)throw R.error(b(h="[".concat(r,"] ")).call(h,A.toString())),A;let f=gu(A.name||A.code||A,A.message);if(f.code===D.MEDIA_OPTION_INVALID)R.debug("[".concat(r,"] detect media option invalid, retry")),s+=1,await Tn(500);else throw R.error(b(u="[".concat(r,"] ")).call(u,f.toString())),f}if(!c)throw new L(D.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return c}async function aS(i,r,s){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new L(D.NOT_SUPPORTED,"can not find getUserMedia");s&&(i.video&&(delete i.video.width,delete i.video.height),i.screen&&(delete i.screen.width,delete i.screen.height));var c=kt;if(s=new MediaStream,i.audioSource&&s.addTrack(i.audioSource),i.videoSource&&s.addTrack(i.videoSource),!i.audio&&!i.video&&!i.screen)return R.debug("Using Video Source/ Audio Source"),s;if(i.screen)if(Ug())i.screen.sourceId?Na(s,await Qg(i.screen.sourceId,i.screen)):Na(s,await sS(i.screen));else if(co()&&i.screen.extensionId&&i.screen.mandatory){if(!c.getStreamFromExtension)throw new L(D.NOT_SUPPORTED,"This browser does not support screen sharing");R.debug("[".concat(r,'] Screen access on chrome stable, looking for extension"'));var u=await(h=i.screen.extensionId,A=r,new ce((m,I)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},_=>{if(!_||!_.streamId)return R.error("[".concat(A,"] No response from Chrome Plugin. Plugin not installed properly"),_),void I(new L(D.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));m(_.streamId)})}catch(_){var E;R.error(b(E="[".concat(A,"] AgoraRTC screensharing plugin is not accessible(")).call(E,h,")"),_.toString()),I(new L(D.CHROME_PLUGIN_NOT_INSTALL))}}));i.screen.mandatory.chromeMediaSourceId=u,Na(s,await navigator.mediaDevices.getUserMedia({video:{mandatory:i.screen.mandatory}}))}else if(c.getDisplayMedia)i.screen.mediaSource&&Mg(i.screen.mediaSource),u={width:i.screen.width,height:i.screen.height,frameRate:i.screen.frameRate,displaySurface:i.screen.mediaSource==="screen"?"monitor":i.screen.mediaSource},R.debug("[".concat(r,"] getDisplayMedia:"),fe({video:u,audio:!!i.screenAudio})),Na(s,await navigator.mediaDevices.getDisplayMedia({video:u,audio:!!i.screenAudio}));else{if(!Xt())throw R.error("[".concat(r,"] This browser does not support screenSharing")),new L(D.NOT_SUPPORTED,"This browser does not support screen sharing");i.screen.mediaSource&&Mg(i.screen.mediaSource),c={video:{mediaSource:i.screen.mediaSource,width:i.screen.width,height:i.screen.height,frameRate:i.screen.frameRate}},R.debug(b(u="[".concat(r,"] getUserMedia: ")).call(u,fe(c))),Na(s,await navigator.mediaDevices.getUserMedia(c))}var h,A;if(!i.video&&!i.audio)return s;i={video:i.video,audio:i.audio},R.debug("[".concat(r,"] GetUserMedia"),fe(i)),Ye();let f;r=null,(dn()||Br()||ao())&&(r=await xp.lock());try{f=await navigator.mediaDevices.getUserMedia(i)}catch(m){throw r&&r(),m}return i.audio&&(zE=!0),i.video&&(XE=!0),Na(s,f),r&&r(),s}function gu(i,r){switch(i){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":var s;return new L(D.MEDIA_OPTION_INVALID,b(s="".concat(i,": ")).call(s,r));case"NotFoundError":case"DevicesNotFoundError":var c;return new L(D.DEVICE_NOT_FOUND,b(c="".concat(i,": ")).call(c,r));case"NotSupportedError":var u;return new L(D.NOT_SUPPORTED,b(u="".concat(i,": ")).call(u,r));case"NotReadableError":var h;return new L(D.NOT_READABLE,b(h="".concat(i,": ")).call(h,r));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":var A;return new L(D.PERMISSION_DENIED,b(A="".concat(i,": ")).call(A,r));case"ConstraintNotSatisfiedError":var f;return new L(D.CONSTRAINT_NOT_SATISFIED,b(f="".concat(i,": ")).call(f,r));default:var m;return R.error("getUserMedia unexpected error",i),new L(D.UNEXPECTED_ERROR,b(m="".concat(i,": ")).call(m,r))}}function Na(i,r){let s=i.getVideoTracks()[0],c=i.getAudioTracks()[0],u=r.getVideoTracks()[0];(r=r.getAudioTracks()[0])&&(c&&i.removeTrack(c),i.addTrack(r)),u&&(s&&i.removeTrack(s),i.addTrack(u))}function Fg(){if(!Up){let i=r=>{r.preventDefault(),Up=!1,document.body.removeEventListener("touchstart",i,!0),document.body.removeEventListener("mousedown",i,!0)};Up=!0,document.body.addEventListener("touchstart",i,!0),document.body.addEventListener("mousedown",i,!0),e1.emit("autoplay-failed")}}function jt(){return function(i,r,s){let c=i[r];typeof c=="function"&&(s.value=function(...u){this._isClosed&&new L(D.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning");let h=c.apply(this,u);return h instanceof ce?new ce((A,f)=>{h.then(A).catch(f)}):h})}}function Vg(i,r){var s=dt(i);if(bt){var c=bt(i);r&&(c=Qe(c).call(c,function(u){return ct(i,u).enumerable})),s.push.apply(s,c)}return s}function mu(i){for(var r=1;r<arguments.length;r++){var s,c=arguments[r]!=null?arguments[r]:{};if(r%2)W(s=Vg(Object(c),!0)).call(s,function(h){gn(i,h,c[h])});else if(Ot)An(i,Ot(c));else{var u;W(u=Vg(Object(c))).call(u,function(h){ht(i,h,ct(c,h))})}}return i}function Gg(i,r){var s=dt(i);if(bt){var c=bt(i);r&&(c=Qe(c).call(c,function(u){return ct(i,u).enumerable})),s.push.apply(s,c)}return s}function po(i){for(var r=1;r<arguments.length;r++){var s,c=arguments[r]!=null?arguments[r]:{};if(r%2)W(s=Gg(Object(c),!0)).call(s,function(h){gn(i,h,c[h])});else if(Ot)An(i,Ot(c));else{var u;W(u=Gg(Object(c))).call(u,function(h){ht(i,h,ct(c,h))})}}return i}function jg(i,r){var s=dt(i);if(bt){var c=bt(i);r&&(c=Qe(c).call(c,function(u){return ct(i,u).enumerable})),s.push.apply(s,c)}return s}function Hg(i){for(var r=1;r<arguments.length;r++){var s,c=arguments[r]!=null?arguments[r]:{};if(r%2)W(s=jg(Object(c),!0)).call(s,function(h){gn(i,h,c[h])});else if(Ot)An(i,Ot(c));else{var u;W(u=jg(Object(c))).call(u,function(h){ht(i,h,ct(c,h))})}}return i}function cS(i){if(!i.address||!i.tcp)throw new L(D.UNEXPECTED_RESPONSE,"Invalid address format ".concat(i));return i.address.match(/^[\.:\d]+$/)?"".concat(i.address.replace(/[^\d]/g,"-"),".edge.agora.io"):(R.info("Cannot recognized as IP address ".concat(i.address,". Used As Host instead")),b(r="".concat(i.address,":")).call(r,i.tcp));var r}function Kg(i,r){var s;let c=ne.GATEWAY_DOMAINS,u=c[1]&&Ge(r).call(r,c[1])!==-1?1:0;return i.addresses=i.addresses||[],{gatewayAddrs:Ie(s=i.addresses).call(s,h=>{var A,f,m;return h.ip.match(/^[\.:\d]+$/)?b(A=b(f="".concat(h.ip.replace(/[^\d]/g,"-"),".")).call(f,c[u++%c.length],":")).call(A,h.port):(R.info("Cannot recognized as IP address ".concat(h.ip,". Used As Host instead")),b(m="".concat(h.ip,":")).call(m,h.port))}),uid:i.uid,cid:i.cid,vid:i.detail&&i.detail[8],uni_lbs_ip:i.detail&&i.detail[1],res:i,csIp:i.detail&&i.detail[502]}}function ns(i){return typeof i=="number"?i:i.exact||i.ideal||i.max||i.min||0}function Wg(i,r){let s=i.videoSend[0];return s?(r=r&&r.videoSend[0]?r.videoSend[0].inputFrame:void 0,i={id:er(10,""),timestamp:new Date(i.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:s.ssrc.toString()},s.inputFrame&&(r&&s.inputFrame.height===r.height||(i.A_fhi=s.inputFrame.height?s.inputFrame.height.toString():"0"),r&&s.inputFrame.width===r.width||(i.A_fwi=s.inputFrame.width?s.inputFrame.width.toString():"0"),r&&s.inputFrame.frameRate===r.frameRate||(i.A_fri=s.inputFrame.frameRate?s.inputFrame.frameRate.toString():"0")),i):null}function Yg(i){return 0<=i&&.17>i?1:.17<=i&&.36>i?2:.36<=i&&.59>i?3:.59<=i&&1>=i?4:1<i?5:0}function lS(i,r){let s={};return i.height&&i.width&&(r=r._videoHeight||r.getMediaStreamTrack(!0).getSettings().height,s.scaleResolutionDownBy=r?r/ns(i.height):4),s.maxFramerate=i.framerate?ns(i.framerate):void 0,s.maxBitrate=i.bitrate?1e3*i.bitrate:void 0,s}function Th(i,r){var s;let c,u;switch(r){case fn.CHOOSE_SERVER:c=4096,r="choose server";break;case fn.CLOUD_PROXY:c=1048576,r="proxy";break;case fn.CLOUD_PROXY_5:c=4194304,r="proxy5";break;default:throw new L(D.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:i.detail&&i.detail[502],retry:!1})}if(W(s=i.response_body).call(s,h=>{var A;h.buffer&&h.buffer.flag===c&&(u={code:h.buffer.code,addresses:Ie(A=h.buffer.edges_services).call(A,f=>Hg({},f,{ticket:h.buffer.cert})),server_ts:i.enter_ts,uid:h.buffer.uid,cid:h.buffer.cid,cname:h.buffer.cname,detail:Hg({},h.buffer.detail,{},i.detail),flag:h.buffer.flag,opid:i.opid})}),!u)throw new L(D.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(r," from multi unilbs response"),{csIp:i.detail&&i.detail[502]});return u}function uS(i){var r;return Ie(r=i.addresses).call(r,s=>({address:s.ip,tcpport:s.port,udpport:s.port,username:Pr.username,password:Pr.password}))}function qg(i,r){var s=dt(i);if(bt){var c=bt(i);r&&(c=Qe(c).call(c,function(u){return ct(i,u).enumerable})),s.push.apply(s,c)}return s}function Rh(i){for(var r=1;r<arguments.length;r++){var s,c=arguments[r]!=null?arguments[r]:{};if(r%2)W(s=qg(Object(c),!0)).call(s,function(h){gn(i,h,c[h])});else if(Ot)An(i,Ot(c));else{var u;W(u=qg(Object(c))).call(u,function(h){ht(i,h,ct(c,h))})}}return i}function ka(i){return window.TextEncoder?new TextEncoder().encode(i).length:i.length}function Tn(i){return new ce(r=>{window.setTimeout(r,i)})}function dS(i){let r=new L(D.TIMEOUT,"timeout");return new ce((s,c)=>{window.setTimeout(()=>c(r),i)})}function er(i=7,r){var s,c;let u=Math.random().toString(16).substr(2,i).toLowerCase();return u.length===i?b(s="".concat(r)).call(s,u):b(c="".concat(r)).call(c,u)+er(i-u.length,"")}function Jg(i){return new ce((r,s)=>{let c=!1,u=document.createElement("video");u.setAttribute("autoplay",""),u.setAttribute("muted",""),u.muted=!0,u.autoplay=!0,u.setAttribute("playsinline",""),u.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(u),s=Br()?"canplay":"playing",u.addEventListener(s,()=>{let h=u.videoWidth,A=u.videoHeight;!h&&Xt()||(c=!0,u.srcObject=null,u.remove(),r([h,A]))}),u.srcObject=new MediaStream([i]),u.play().catch(td),ai(()=>{c||(u.srcObject=null,u.remove(),r([u.videoWidth,u.videoHeight]))},4e3)})}function Oa(i){return ce.all(Ie(i).call(i,r=>r.then(s=>{throw s},s=>s))).then(r=>{throw r},r=>r)}function yr(i,r,...s){return i.getListeners(r).length===0?ce.reject(new L(D.UNEXPECTED_ERROR,"can not emit promise")):new ce((c,u)=>{i.emit(r,...s,c,u)})}function zr(i,r,...s){return i.getListeners(r).length===0?ce.resolve():yr(i,r,...s)}function Ls(i,r,...s){return i.getListeners(r).length===0?null:jc(i,r,...s)}function jc(i,r,...s){let c=null,u=null;if(i.emit(r,...s,h=>{c=h},h=>{u=h}),u!==null)throw u;if(c===null)throw new L(D.UNEXPECTED_ERROR,"handler is not sync");return c}function Ps(i,r){r=Ge(i).call(i,r),r!==-1&&Gr(i).call(i,r,1)}function zg(i){let r=[];return W(i).call(i,s=>{Ge(r).call(r,s)===-1&&r.push(s)}),r}function ii(i){ce.resolve().then(i)}function Hc(i,r){i1[r]||(i1[r]=!0,i())}function wh(i){i=window.atob(i);let r=new Uint8Array(new ArrayBuffer(i.length));for(let s=0;s<i.length;s+=1)r[s]=i.charCodeAt(s);return r}function vu(i){let r="";for(let s=0;s<i.length;s+=1)r+=String.fromCharCode(i[s]);return window.btoa(r)}function Eu(i){var r=s2[Math.floor(i/1e4)];if(!r)return{desc:"unkonw error",retry:!1};if(r=r[i%1e4],!r){if(Math.floor(i/1e4)===Ja.ACCESS_POINT){if(r=i%1e4,r.toString()[0]==="1")return{desc:i.toString(),retry:!1};if(r.toString()[0]==="2")return{desc:i.toString(),retry:!0}}return{desc:"unkonw error",retry:!1}}return r}function Xg(i){return a2[i]||{desc:"UNKNOW_ERROR_".concat(i),action:"failed"}}async function hS(){function i(pe){let Pe=f["_"+pe];var _e;return _e="Cannot call unknown function "+pe+", make sure it is exported",Pe||s("Assertion failed: "+_e),Pe}function r(pe,Pe,_e,gr,$s){$s={string:function(nt){let Yt=0;if(nt!=null&&nt!==0){var kr=1+(nt.length<<2);Yt=he(kr);var mr=se,ur=Yt;if(0<kr){kr=ur+kr-1;for(let Xi=0;Xi<nt.length;++Xi){let xr=nt.charCodeAt(Xi);if(55296<=xr&&57343>=xr&&(xr=65536+((1023&xr)<<10)|1023&nt.charCodeAt(++Xi)),127>=xr){if(ur>=kr)break;mr[ur++]=xr}else{if(2047>=xr){if(ur+1>=kr)break;mr[ur++]=192|xr>>6}else{if(65535>=xr){if(ur+2>=kr)break;mr[ur++]=224|xr>>12}else{if(ur+3>=kr)break;mr[ur++]=240|xr>>18,mr[ur++]=128|xr>>12&63}mr[ur++]=128|xr>>6&63}mr[ur++]=128|63&xr}}mr[ur]=0}}return Yt},array:function(nt){const Yt=he(nt.length);return J.set(nt,Yt),Yt}};let ea=i(pe),oc=[];if(pe=0,gr)for(let nt=0;nt<gr.length;nt++){let Yt=$s[_e[nt]];Yt?(pe===0&&(pe=q()),oc[nt]=Yt(gr[nt])):oc[nt]=gr[nt]}return _e=ea.apply(null,oc),_e=function(nt){if(Pe==="string")if(mr=nt){nt=se;var Yt=mr+kr,kr=mr;let ur="";for(;nt[kr]&&!(kr>=Yt);)++kr;if(16<kr-mr&&nt.subarray&&P)nt=P.decode(nt.subarray(mr,kr));else{for(;mr<kr;){if(Yt=nt[mr++],!(128&Yt)){ur+=String.fromCharCode(Yt);continue}let Xi=63&nt[mr++];if((224&Yt)==192){ur+=String.fromCharCode((31&Yt)<<6|Xi);continue}let xr=63&nt[mr++];Yt=(240&Yt)==224?(15&Yt)<<12|Xi<<6|xr:(7&Yt)<<18|Xi<<12|xr<<6|63&nt[mr++],65536>Yt?ur+=String.fromCharCode(Yt):(Yt-=65536,ur+=String.fromCharCode(55296|Yt>>10,56320|1023&Yt))}nt=ur}}else nt="";else nt=Pe==="boolean"?!!nt:nt;return nt;var mr}(_e),pe!==0&&$(pe),_e}function s(pe){throw f.onAbort&&f.onAbort(pe),N(pe+=""),B=!0,new WebAssembly.RuntimeError("abort("+pe+"). Build with -s ASSERTIONS=1 for more info.")}function c(pe){for(;0<pe.length;){let Pe=pe.shift();if(typeof Pe=="function"){Pe(f);continue}let _e=Pe.func;typeof _e=="number"?Pe.arg===void 0?ge.get(_e)():ge.get(_e)(Pe.arg):_e(Pe.arg===void 0?null:Pe.arg)}}function u(pe){function Pe(){if(!Pt&&(Pt=!0,f.calledRun=!0,!B)){if(c(Be),c(yt),f.onRuntimeInitialized&&f.onRuntimeInitialized(),f.postRun)for(typeof f.postRun=="function"&&(f.postRun=[f.postRun]);f.postRun.length;){var _e=f.postRun.shift();ve.unshift(_e)}c(ve)}}0<Ze||(function(){if(f.preRun)for(typeof f.preRun=="function"&&(f.preRun=[f.preRun]);f.preRun.length;){var _e=f.preRun.shift();Le.unshift(_e)}c(Le)}(),0<Ze||(f.setStatus?(f.setStatus("Running..."),ai(function(){ai(function(){f.setStatus("")},1),Pe()},1)):Pe()))}var h,A;if(Gp)return Gp;let f={},m,I={};for(m in f)Object.prototype.hasOwnProperty.call(f,m)&&(I[m]=f[m]);let E=!1,_=!1;E=typeof window=="object",_=typeof importScripts=="function";let S="";(E||_)&&(_?S=self.location.href:typeof document!="undefined"&&document.currentScript&&(S=document.currentScript.src),S=Ge(S).call(S,"blob:")!==0?S.substr(0,E2(S).call(S,"/")+1):""),f.print||cr(h=console.log).call(h,console);let N=f.printErr||cr(A=console.warn).call(A,console);for(m in I)Object.prototype.hasOwnProperty.call(I,m)&&(f[m]=I[m]);let k;I=null,typeof WebAssembly!="object"&&s("no native wasm support detected");let B=!1,P=typeof TextDecoder!="undefined"?new TextDecoder("utf8"):void 0;typeof TextDecoder!="undefined"&&new TextDecoder("utf-16le");let J,se,ge,Le=[],Be=[],yt=[],ve=[];Be.push({func:function(){en()}});let Ze=0,vt=null;f.preloadedImages={},f.preloadedAudios={},h="deflate.wasm";var Wt;il(Wt=h).call(Wt,"data:application/octet-stream;base64,")||(h=function(pe){return f.locateFile?f.locateFile(pe,S):S+pe}(h));let Nr={emscripten_memcpy_big:function(pe,Pe,_e){var gr=se.copyWithin;(se===a1||se instanceof Array&&gr===a1.copyWithin?u2:gr).call(se,pe,Pe,Pe+_e)},emscripten_resize_heap:function(pe){s("OOM")}};await async function(){function pe(_e,gr){f.asm=_e.exports,k=f.asm.memory,_e=k.buffer,f.HEAP8=J=new Int8Array(_e),f.HEAP16=new Int16Array(_e),f.HEAP32=new Int32Array(_e),f.HEAPU8=se=new Uint8Array(_e),f.HEAPU16=new Uint16Array(_e),f.HEAPU32=new Uint32Array(_e),f.HEAPF32=new Float32Array(_e),f.HEAPF64=new Float64Array(_e),ge=f.asm.__indirect_function_table,Ze--,f.monitorRunDependencies&&f.monitorRunDependencies(Ze),Ze==0&&vt&&(_e=vt,vt=null,_e())}let Pe={env:Nr,wasi_snapshot_preview1:Nr};if(Ze++,f.monitorRunDependencies&&f.monitorRunDependencies(Ze),f.instantiateWasm)try{return f.instantiateWasm(Pe,pe)}catch(_e){return N("Module.instantiateWasm callback failed with error: "+_e),!1}return await function(_e){return new ce((gr,$s)=>{gr(I2().buffer)}).then(function(gr){return WebAssembly.instantiate(gr,Pe)}).then(_e,function(gr){N("failed to asynchronously prepare wasm: "+gr),s(gr)})}(function(_e){pe(_e.instance)}),{}}();let Pt,en=f.___wasm_call_ctors=function(){return(en=f.___wasm_call_ctors=f.asm.__wasm_call_ctors).apply(null,arguments)},j=f._malloc=function(){return(j=f._malloc=f.asm.malloc).apply(null,arguments)};f._free=function(){return(f._free=f.asm.free).apply(null,arguments)},f.___errno_location=function(){return(f.___errno_location=f.asm.__errno_location).apply(null,arguments)},f._zlibCompress=function(){return(f._zlibCompress=f.asm.zlibCompress).apply(null,arguments)};let q=f.stackSave=function(){return(q=f.stackSave=f.asm.stackSave).apply(null,arguments)},$=f.stackRestore=function(){return($=f.stackRestore=f.asm.stackRestore).apply(null,arguments)},he=f.stackAlloc=function(){return(he=f.stackAlloc=f.asm.stackAlloc).apply(null,arguments)};if(f.ccall=r,f.cwrap=function(pe,Pe,_e,gr){let $s=h2(_e=_e||[]).call(_e,function(ea){return ea==="number"});return Pe!=="string"&&$s&&!gr?i(pe):function(){return r(pe,Pe,_e,arguments)}},f.allocate=function(pe,Pe){let _e;return _e=Pe==1?he(pe.length):j(pe.length),pe.subarray||Mr(pe)?se.set(pe,_e):se.set(new Uint8Array(pe),_e),_e},vt=function pe(){Pt||u(),Pt||(vt=pe)},f.run=u,f.preInit)for(typeof f.preInit=="function"&&(f.preInit=[f.preInit]);0<f.preInit.length;)f.preInit.pop()();return u(),Gp=f,f}function Zg(i,r){var s=dt(i);if(bt){var c=bt(i);r&&(c=Qe(c).call(c,function(u){return ct(i,u).enumerable})),s.push.apply(s,c)}return s}function Nh(i){for(var r=1;r<arguments.length;r++){var s,c=arguments[r]!=null?arguments[r]:{};if(r%2)W(s=Zg(Object(c),!0)).call(s,function(h){gn(i,h,c[h])});else if(Ot)An(i,Ot(c));else{var u;W(u=Zg(Object(c))).call(u,function(h){ht(i,h,ct(c,h))})}}return i}function $g(i,r){var s=dt(i);if(bt){var c=bt(i);r&&(c=Qe(c).call(c,function(u){return ct(i,u).enumerable})),s.push.apply(s,c)}return s}function pS(i,r,s,c,u){lA+=1;let h={sid:s.sid,command:"convergeAllocateEdge",uid:"666",appId:s.appId,ts:Math.floor(de()/1e3),seq:lA,requestId:lA,version:Hn,cname:s.cname},A={service_name:r,json_body:fe(h)},f,m,I=i[0];return ho(async()=>{f=de();var E=await Gi(I,{data:A,cancelToken:c,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(m=de()-f,E.code!==0){var _=new L(D.UNEXPECTED_RESPONSE,"live streaming ap error, code"+E.code,{retry:!0,responseTime:m});throw R.error(_.toString()),_}if(E=JSON.parse(E.json_body),E.code!==200)throw E=new L(D.UNEXPECTED_RESPONSE,b(_="live streaming app center error, code: ".concat(E.code,", reason: ")).call(_,E.reason),{code:E.code,responseTime:m}),R.error(E.toString()),E;if(!E.servers||E.servers.length===0)throw _=new L(D.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:E.code,responseTime:m}),R.error(_.toString()),_;return _=function(S,N){var k;return{addressList:Ie(k=S.servers).call(k,B=>{var P,J;return b(P=b(J="wss://".concat(B.address.replace(/\./g,"-"),".edge.agora.io:")).call(J,B.wss,"?serviceName=")).call(P,encodeURIComponent(N))}),workerToken:S.workerToken,vid:S.vid}}(E,r),ne.LIVE_STREAMING_ADDRESS&&(_.addressList=ne.LIVE_STREAMING_ADDRESS instanceof Array?ne.LIVE_STREAMING_ADDRESS:[ne.LIVE_STREAMING_ADDRESS]),function(S){for(var N=1;N<arguments.length;N++){var k,B=arguments[N]!=null?arguments[N]:{};if(N%2)W(k=$g(Object(B),!0)).call(k,function(J){gn(S,J,B[J])});else if(Ot)An(S,Ot(B));else{var P;W(P=$g(Object(B))).call(P,function(J){ht(S,J,ct(B,J))})}}return S}({},_,{responseTime:m})},(E,_)=>(z.apworkerEvent(s.sid,{success:!0,sc:200,serviceName:r,responseDetail:fe(E.addressList),firstSuccess:_===0,responseTime:m,serverIp:i[_%i.length]}),!1),(E,_)=>(z.apworkerEvent(s.sid,{success:!1,sc:E.data&&E.data.code||200,serviceName:r,responseTime:m,serverIp:i[_%i.length]}),!!(E.code!==D.OPERATION_ABORTED&&E.code!==D.UNEXPECTED_RESPONSE||E.data&&E.data.retry)&&(I=i[(_+1)%i.length],!0)),u)}function em({url:i,areaCode:r},s,c,u){let h=de(),[A,f]=$1(s,r,[fn.CHOOSE_SERVER]),m=Yn.networkState;return ho(async()=>{m&&Yn.networkState===bi.OFFLINE&&Yn.onlineWaiter&&await ce.race([Yn.onlineWaiter,Tn(u&&u.maxRetryTimeout||Tr.maxRetryTimeout)]),m=Yn.networkState;var I=await Gi(i,{data:A,cancelToken:c,headers:{"Content-Type":"multipart/form-data;"}},!0);return X1(I,i,s,h,[fn.CHOOSE_SERVER]),I=Th(I,fn.CHOOSE_SERVER),Z1(I),Kg(I,i)},I=>(I&&z.joinChooseServer(s.sid,{lts:h,succ:!0,csAddr:i,opid:f,serverList:I.gatewayAddrs,ec:null,cid:I.cid.toString(),uid:I.uid.toString(),csIp:I.csIp,unilbsServerIds:[fn.CHOOSE_SERVER].toString()}),!1),I=>I.code!==D.OPERATION_ABORTED&&(I.code===D.CAN_NOT_GET_GATEWAY_SERVER?I.data.retry:(z.joinChooseServer(s.sid,{lts:h,succ:!1,csAddr:i,serverList:null,opid:f,ec:I.code,csIp:I.data&&I.data.csIp,unilbsServerIds:[fn.CHOOSE_SERVER].toString(),extend:fe({networkState:m})}),R.warning("[".concat(s.clientId,"] Choose server network error, retry"),I),!0)),u)}function tm({url:i,areaCode:r,serviceIds:s},c,u,h){let A=de(),[f,m]=$1(c,r,s),I;return ho(async()=>{I&&Yn.networkState===bi.OFFLINE&&Yn.onlineWaiter&&await ce.race([Yn.onlineWaiter,Tn(h&&h.maxRetryTimeout||Tr.maxRetryTimeout)]),I=Yn.networkState;var E=await Gi(i,{data:f,cancelToken:u,headers:{"Content-Type":"multipart/form-data;"}},!0);X1(E,i,c,A,s);let _=Th(E,fn.CHOOSE_SERVER);return E=Th(E,c.cloudProxyServer==="proxy5"?fn.CLOUD_PROXY_5:fn.CLOUD_PROXY),Z1(_),{gatewayInfo:Kg(_,i),proxyInfo:E,url:i}},E=>{var _;return E.gatewayInfo&&z.joinChooseServer(c.sid,{lts:A,succ:!0,csAddr:i,serverList:E.gatewayInfo.gatewayAddrs,ec:null,opid:m,cid:E.gatewayInfo.cid.toString(),uid:E.gatewayInfo.uid.toString(),csIp:E.gatewayInfo.csIp,unilbsServerIds:s.toString()}),E.proxyInfo&&z.joinWebProxyAP(c.sid,{lts:A,sucess:1,apServerAddr:i,turnServerAddrList:Ie(_=E.proxyInfo.addresses).call(_,S=>S.ip).join(","),errorCode:null,eventType:c.cloudProxyServer,unilbsServerIds:s.toString()}),!1},E=>E.code!==D.OPERATION_ABORTED&&(E.code===D.CAN_NOT_GET_GATEWAY_SERVER?E.data.retry:(z.joinWebProxyAP(c.sid,{lts:A,sucess:0,apServerAddr:i,turnServerAddrList:null,errorCode:E.code,eventType:c.cloudProxyServer,unilbsServerIds:s.toString(),extend:fe({networkState:I})}),R.warning("[".concat(c.clientId,"] multi unilbs network error, retry"),E),!0)),h)}async function Kc(i,r,s){return{gatewayInfo:await async function(c,u,h){var A,f;const m=Ie(A=Mr(f=ne.WEBCS_DOMAIN).call(f,0,ne.AJAX_REQUEST_CONCURRENT)).call(A,_=>{var S;return{url:c.proxyServer?b(S="https://".concat(c.proxyServer,"/ap/?url=")).call(S,_+"/api/v2/transpond/webrtc?v=2"):"https://".concat(_,"/api/v2/transpond/webrtc?v=2"),areaCode:ml()}});let I=null;const E=[];return I=await Oa([(async()=>await ec({fragementLength:ne.FRAGEMENT_LENGTH,referenceList:m,asyncMapHandler:_=>(R.debug("[".concat(c.clientId,"] Connect to choose_server:"),_.url),em(_,c,u,h)),allFailedhandler:_=>{throw _[0]},promisesCollector:E}))(),(async()=>{var _;if(await Tn(1e3),I!==null)return I;const S=Ie(_=ne.WEBCS_DOMAIN_BACKUP_LIST).call(_,N=>{var k;return{url:c.proxyServer?b(k="https://".concat(c.proxyServer,"/ap/?url=")).call(k,N+"/api/v2/transpond/webrtc?v=2"):"https://".concat(N,"/api/v2/transpond/webrtc?v=2"),areaCode:ml()}});return await ec({fragementLength:ne.FRAGEMENT_LENGTH,referenceList:S,asyncMapHandler:N=>(R.debug("[".concat(c.clientId,"] Connect to backup choose_server:"),N.url),em(N,c,u,h)),allFailedhandler:N=>{throw N[0]},promisesCollector:E})})()]),E.length&&W(E).call(E,_=>_.cancel&&typeof _.cancel=="function"&&_.cancel()),I}(i,r,s)}}async function rm(i,r,s,c){var u,h;if(i.cloudProxyServer==="disabled")return c?await Kc(i,r,s):void 0;let A;if(i.cloudProxyServer==="443only"||i.cloudProxyServer==="normal"){var f;let m;c?i.cloudProxyServer!=="normal"?[m,A]=await ce.all([Iu(i,r,s),Kc(i,r,s)]):(m=await Iu(i,r,s),i.proxyServer=m.addresses[0],z.setProxyServer(i.proxyServer),R.setProxyServer(i.proxyServer),A=await Kc(i,r,s)):(A=void 0,i.cloudProxyServer!=="normal"?m=await Iu(i,r,s):(m=await Iu(i,r,s),i.proxyServer=m.addresses[0],z.setProxyServer(i.proxyServer),R.setProxyServer(i.proxyServer))),i.turnServer={mode:"manual",servers:Ie(f=m.addresses).call(f,I=>({turnServerURL:I,tcpport:i.cloudProxyServer==="proxy3"?void 0:m.serverResponse.tcpport?m.serverResponse.tcpport:Pr.tcpport,udpport:i.cloudProxyServer==="proxy4"?void 0:m.serverResponse.udpport?m.serverResponse.udpport:Pr.udpport,username:m.serverResponse.username||Pr.username,password:m.serverResponse.password||Pr.password,forceturn:i.cloudProxyServer!=="proxy4"&&i.cloudProxyServer!=="proxy5",security:i.cloudProxyServer==="proxy5"}))}}else{let{proxyInfo:m,gatewayInfo:I}=await async function(E,_,S){var N,k;const B=ne.PROXY_SERVER_TYPE3,P=(ve,Ze)=>{var vt;let Wt=B;return Wi(Wt)&&(Wt=Ze%2==0?B[1]:B[0]),b(vt="https://".concat(Wt,"/ap/?url=")).call(vt,ve)},J=Ie(N=Mr(k=ne.WEBCS_DOMAIN).call(k,0,ne.AJAX_REQUEST_CONCURRENT)).call(N,(ve,Ze)=>({url:P("".concat(ve,"/api/v2/transpond/webrtc?v=2"),Ze),areaCode:ml(),serviceIds:[fn.CHOOSE_SERVER,E.cloudProxyServer==="proxy5"?fn.CLOUD_PROXY_5:fn.CLOUD_PROXY]}));let se=null;const ge=[],{gatewayInfo:Le,proxyInfo:Be,url:yt}=await Oa([(async()=>await ec({fragementLength:ne.FRAGEMENT_LENGTH,referenceList:J,asyncMapHandler:ve=>(R.debug("[".concat(E.clientId,"] Connect to choose_server:"),ve.url),tm(ve,E,_,S)),allFailedhandler:ve=>{throw ve[0]},promisesCollector:ge}))(),(async()=>{var ve;if(await Tn(1e3),se!==null)return se;const Ze=Ie(ve=ne.WEBCS_DOMAIN_BACKUP_LIST).call(ve,(vt,Wt)=>({url:P("".concat(vt,"/api/v2/transpond/webrtc?v=2"),Wt),areaCode:ml(),serviceIds:[11,18]}));return await ec({fragementLength:ne.FRAGEMENT_LENGTH,referenceList:Ze,asyncMapHandler:vt=>(R.debug("[".concat(E.clientId,"] Connect to backup choose_server:"),vt.url),tm(vt,E,_,S)),allFailedhandler:vt=>{throw vt[0]},promisesCollector:ge})})()]);if(ge.length&&W(ge).call(ge,ve=>ve.cancel&&typeof ve.cancel=="function"&&ve.cancel()),!Le||!Be)throw new L(D.UNEXPECTED_ERROR,"missing gateway or proxy response").print();return Wi(B)&&yt&&(N=new ew(yt).host,gt(B).call(B,N)&&(E.proxyServer=N,R.setProxyServer(N),z.setProxyServer(N))),se={gatewayInfo:Le,proxyInfo:uS(Be)},se}(i,r,s);A={gatewayInfo:I},i.turnServer={mode:"manual",servers:Ie(m).call(m,E=>({turnServerURL:E.address,tcpport:i.cloudProxyServer==="proxy3"?void 0:E.tcpport?E.tcpport:Pr.tcpport,udpport:i.cloudProxyServer==="proxy4"?void 0:E.udpport?E.udpport:Pr.udpport,username:E.username||Pr.username,password:E.password||Pr.password,forceturn:i.cloudProxyServer!=="proxy4"&&i.cloudProxyServer!=="proxy5",security:i.cloudProxyServer==="proxy5"}))}}return R.debug(b(u=b(h="[".concat(i.clientId,"] set proxy server: ")).call(h,i.proxyServer,", mode: ")).call(u,i.cloudProxyServer)),A}async function kh(i,r,s,c){var u;let h=Mr(u=ne.ACCOUNT_REGISTER).call(u,0,ne.AJAX_REQUEST_CONCURRENT);return u=[],u=r.proxyServer?Ie(h).call(h,A=>{var f;return b(f="https://".concat(r.proxyServer,"/ap/?url=")).call(f,A+"/api/v1")}):Ie(h).call(h,A=>"https://".concat(A,"/api/v1")),(await async function(A,f,m,I,E){let _=de(),S={sid:m.sid,opid:10,appid:m.appId,string_uid:f},N=A[0];if(m=await ho(()=>Gi(N+"".concat(Ge(N).call(N,"?")===-1?"?":"&","action=stringuid"),{data:S,cancelToken:I,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(k,B)=>{if(k.code===0){var P;if(0>=k.uid||k.uid>=Math.pow(2,32))throw R.error(b(P="Invalid Uint Uid ".concat(f," => ")).call(P,k.uid),k),z.reqUserAccount(S.sid,{lts:_,success:!1,serverAddr:N,stringUid:S.string_uid,uid:k.uid,errorCode:D.INVALID_UINT_UID_FROM_STRING_UID,extend:S}),new L(D.INVALID_UINT_UID_FROM_STRING_UID);return z.reqUserAccount(S.sid,{lts:_,success:!0,serverAddr:N,stringUid:S.string_uid,uid:k.uid,errorCode:null,extend:S}),!1}return P=Eu(k.code),P.retry&&(N=A[(B+1)%A.length]),z.reqUserAccount(S.sid,{lts:_,success:!1,serverAddr:N,stringUid:S.string_uid,uid:k.uid,errorCode:P.desc,extend:S}),P.retry},(k,B)=>k.code!==D.OPERATION_ABORTED&&(z.reqUserAccount(S.sid,{lts:_,success:!1,serverAddr:N,stringUid:S.string_uid,uid:null,errorCode:k.code,extend:S}),N=A[(B+1)%A.length],!0),E),m.code!==0)throw m=Eu(m.code),new L(D.UNEXPECTED_RESPONSE,m.desc);return m}(u,i,r,s,c)).uid}async function Iu(i,r,s){var c,u=de(),h=Ie(c=ne[i.cloudProxyServer==="normal"?"PROXY_CS":"WEBCS_DOMAIN"]).call(c,f=>{var m;return i.proxyServer?b(m="https://".concat(i.proxyServer,"/ap/?url=")).call(m,f+"/api/v1"):"https://".concat(f,"/api/v1")});if(i.cloudProxyServer==="proxy3"||i.cloudProxyServer==="proxy4"||i.cloudProxyServer==="proxy5"){u=Ie(h).call(h,f=>({url:f,areaCode:ml()}));var A=null;if(A=await ec({fragementLength:ne.FRAGEMENT_LENGTH,referenceList:u,asyncMapHandler:f=>function({url:m,areaCode:I},E,_,S){let N=de(),k={opid:133,flag:E.cloudProxyServer==="proxy5"?4194304:1048576,ts:+new Date,key:E.token,cname:E.cname,sid:E.sid,detail:{6:E.stringUid,11:I},uid:E.uid||0};return ho(async()=>await Gi(m,{data:k,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":69}}),B=>{var P;if(B.code===0)return z.joinWebProxyAP(E.sid,{lts:N,sucess:1,apServerAddr:m,turnServerAddrList:Ie(P=B.addresses).call(P,J=>J.ip).join(","),errorCode:null,eventType:E.cloudProxyServer}),!1;throw B=Eu(B.code),new L(D.CAN_NOT_GET_GATEWAY_SERVER,B.desc,{retry:B.retry})},B=>{return B.code!==D.OPERATION_ABORTED&&(B.code===D.CAN_NOT_GET_GATEWAY_SERVER?(z.joinWebProxyAP(k.sid,{lts:N,sucess:0,apServerAddr:m,turnServerAddrList:null,errorCode:B.code,eventType:E.cloudProxyServer}),R.warning(b(P=b(J=b(se="[".concat(E.clientId,"] proxy ap server ")).call(se,m," failed, message: ")).call(J,B.message,", retry: ")).call(P,B.data.retry)),B.data.retry):(z.joinWebProxyAP(k.sid,{lts:N,sucess:0,apServerAddr:m,turnServerAddrList:null,errorCode:B.code,eventType:E.cloudProxyServer}),!0));var P,J,se},S)}(f,i,r,s),allFailedhandler:()=>{throw R.error("[".concat(i.clientId,"] can not get proxy server after trying several times")),new L(D.CAN_NOT_GET_PROXY_SERVER)}}),u=A.addresses,!u||u.length===0)throw R.error("[".concat(i.clientId,"] can not get proxy server, empty proxy server list")),new L(D.CAN_NOT_GET_PROXY_SERVER,"empty proxy server list");return{addresses:Ie(u).call(u,f=>f.ip),serverResponse:{tcpport:u[0].port||443,udpport:u[0].port||Pr.udpport,username:Pr.username,password:Pr.password}}}if(c=null,c=await ec({fragementLength:ne.FRAGEMENT_LENGTH,referenceList:h,asyncMapHandler:f=>function(m,I,E,_){let S=de(),N={command:"convergeAllocateEdge",sid:I.sid,appId:I.appId,token:I.token,uid:I.uid,cname:I.cname,ts:Math.floor(de()/1e3),version:Hn,seq:0,requestId:1};return ho(async()=>({res:await Gi(m,{data:{service_name:"webrtc_proxy",json_body:fe(N)},cancelToken:E,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}}),url:m}),k=>{if(!k.res.json_body)throw R.debug("[".concat(I.clientId,"] Get proxy server failed: no json_body")),new L(D.UNEXPECTED_RESPONSE,fe(k.res));let B=JSON.parse(k.res.json_body);var P,J;if(B.code!==200)throw R.debug(b(P=b(J="[".concat(I.clientId,"] Get proxy server failed: response code [")).call(J,B.code,"], reason [")).call(P,B.reason,"]")),new L(D.UNEXPECTED_RESPONSE,fe(k.res));return R.debug("[".concat(I.clientId,"] App return server length"),B.servers.length),!1},k=>k.code!==D.OPERATION_ABORTED&&(z.requestProxyAppCenter(N.sid,{lts:S,succ:!1,APAddr:m,workerManagerList:null,ec:k.code,response:k.message}),!0),_)}(f,i,r,s),allFailedhandler:()=>{throw R.error("[".concat(i.clientId,"] can not get proxy server after trying several times")),new L(D.CAN_NOT_GET_PROXY_SERVER)}}),h=JSON.parse(c.res.json_body),h=Ie(A=h.servers).call(A,cS),i.cloudProxyServer==="443only")return{addresses:h,serverResponse:{tcpport:443,udpport:Pr.udpport,username:Pr.username,password:Pr.password}};z.requestProxyAppCenter(i.sid,{lts:u,succ:!0,APAddr:c.url,workerManagerList:fe(h),ec:null,response:fe(c.res)}),u=de(),A=Ie(h).call(h,f=>function(m,I,E,_){const S=de();let N=m;il(m).call(m,"http")||(N="https://".concat(m,":4000/v2/machine"));const k={command:"request",gatewayType:"http",appId:I.appId,cname:I.cname,uid:(I.uid||"").toString(),sdkVersion:"2.3.1",sid:I.sid,seq:1,ts:de(),requestId:3,clientRequest:{appId:I.appId,cname:I.cname,uid:(I.uid||"").toString(),sid:I.sid}};return ho(async()=>({res:await Gi(N,{data:k,cancelToken:E}),url:m}),B=>{if(!B.res.serverResponse)throw new L(D.UNEXPECTED_RESPONSE,"requeet worker manager server failed: serverResponse is undefined");return!1},B=>B.code!==D.OPERATION_ABORTED&&(z.requestProxyWorkerManager(k.sid,{lts:S,succ:!1,workerManagerAddr:m,ec:B.code,response:B.message}),!0),_)}(f,i,r,s)),c=null;try{c=await Oa(A)}catch{throw R.error("[".concat(i.clientId,"] can not get worker manager after trying several times")),new L(D.CAN_NOT_GET_PROXY_SERVER)}return W(A).call(A,f=>f.cancel()),z.requestProxyWorkerManager(i.sid,{lts:u,succ:!0,workerManagerAddr:c.url,ec:null,response:fe(c.res)}),{addresses:[c.url],serverResponse:c.res.serverResponse}}async function AS(i,r,s){var c,u,h=Ie(c=Mr(u=ne.CDS_AP).call(u,0,ne.AJAX_REQUEST_CONCURRENT)).call(c,f=>{var m;return i.proxyServer?b(m="https://".concat(i.proxyServer,"/ap/?url=")).call(m,f+"/api/v1"):"https://".concat(f,"/api/v1?action=config")});c=Ie(h).call(h,f=>function(m,I,E,_){const S=Ye(),N={flag:64,cipher_method:0,features:{device:S.name,system:S.os,vendor:I.appId,version:Hn,cname:I.cname,sid:I.sid,session_id:I.sid,detail:"",proxyServer:I.proxyServer}};return ho(()=>Gi(m,{data:N,timeout:1e3,cancelToken:E,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,k=>k.code!==D.OPERATION_ABORTED,_)}(f,i,r,s)),h=u=null;let A={};try{u=await Oa(c)}catch(f){if(f.code===D.OPERATION_ABORTED)throw f;h=f}if(W(c).call(c,f=>f.cancel()),z.reportApiInvoke(i.sid,{name:we.REQUEST_CONFIG_DISTRIBUTE,options:{error:h,res:u}}).onSuccess(),u&&u.test_tags)try{A=function(f){if(!f.test_tags)return{};let m=f.test_tags;f=dt(m);let I={};return W(f).call(f,E=>{var _;let S=Ws(_=Mr(E).call(E,4)).call(_);E=JSON.parse(m[E])[1],I[S]=E}),I}(u)}catch{}return A}async function nm(i,r,s,c){var u,h;let A=Ie(u=Mr(h=ne.UAP_AP).call(h,0,ne.AJAX_REQUEST_CONCURRENT)).call(u,f=>{var m;return r.proxyServer?b(m="https://".concat(r.proxyServer,"/ap/?url=")).call(m,f+"/api/v1?action=uap"):"https://".concat(f,"/api/v1?action=uap")});return await pS(A,i,r,s,c)}async function fS(i,r,s){var c,u;let h=Ie(c=Mr(u=ne.UAP_AP).call(u,0,ne.AJAX_REQUEST_CONCURRENT)).call(c,A=>{var f;return i.proxyServer?b(f="https://".concat(i.proxyServer,"/ap/?url=")).call(f,A+"/api/v1?action=uap"):"https://".concat(A,"/api/v1?action=uap")});c=Ie(h).call(h,A=>function(f,m,I,E){m={command:"convergeAllocateEdge",sid:m.sid,appId:m.appId,token:m.token,ts:de(),version:Hn,cname:m.cname,uid:m.uid.toString(),requestId:uA,seq:uA},uA+=1;const _={service_name:"tele_channel",json_body:fe(m)};return ho(async()=>{var S=await Gi(f,{data:_,cancelToken:I,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(S.code!==0){var N=new L(D.UNEXPECTED_RESPONSE,"cross channel ap error, code"+S.code,{retry:!0});throw R.error(N.toString()),N}if(S=JSON.parse(S.json_body),S.code!==200){var k=new L(D.UNEXPECTED_RESPONSE,b(N="cross channel app center error, code: ".concat(S.code,", reason: ")).call(N,S.reason));throw R.error(k.toString()),k}if(!S.servers||S.servers.length===0)throw N=new L(D.UNEXPECTED_RESPONSE,"cross channel app center empty server"),R.error(N.toString()),N;return{vid:S.vid,workerToken:S.workerToken,addressList:Ie(k=S.servers).call(k,B=>{var P;return b(P="wss://".concat(B.address.replace(/\./g,"-"),".edge.agora.io:")).call(P,B.wss)})}},void 0,S=>!!(S.code!==D.OPERATION_ABORTED&&S.code!==D.UNEXPECTED_RESPONSE||S.data&&S.data.retry),E)}(A,i,r,s));try{let A=await Oa(c);return W(c).call(c,f=>f.cancel()),A}catch(A){throw A[0]}}function im(i,r){var s=dt(i);if(bt){var c=bt(i);r&&(c=Qe(c).call(c,function(u){return ct(i,u).enumerable})),s.push.apply(s,c)}return s}function Si(i){if(Array.isArray(i))return i.map(function(c){return c});if(!om(i))return i;var r={},s;for(s in i)om(i[s])||Array.isArray(i[s])?r[s]=Si(i[s]):r[s]=i[s];return r}function om(i){return!(typeof i!="object"||Array.isArray(i)||!i)}function Oh(i,r){function s(){this.constructor=i}eI(i,r),i.prototype=r===null?Object.create(r):(s.prototype=r.prototype,new s)}function bh(i,r,s,c){return new(s||(s=Promise))(function(u,h){function A(I){try{m(c.next(I))}catch(E){h(E)}}function f(I){try{m(c.throw(I))}catch(E){h(E)}}function m(I){I.done?u(I.value):new s(function(E){E(I.value)}).then(A,f)}m((c=c.apply(i,r||[])).next())})}function Dh(i,r){function s(m){return function(I){return function(E){if(c)throw new TypeError("Generator is already executing.");for(;f;)try{if(c=1,u&&(h=2&E[0]?u.return:E[0]?u.throw||((h=u.return)&&h.call(u),0):u.next)&&!(h=h.call(u,E[1])).done)return h;switch(u=0,h&&(E=[2&E[0],h.value]),E[0]){case 0:case 1:h=E;break;case 4:return f.label++,{value:E[1],done:!1};case 5:f.label++,u=E[1],E=[0];continue;case 7:E=f.ops.pop(),f.trys.pop();continue;default:if(h=f.trys,!((h=0<h.length&&h[h.length-1])||E[0]!==6&&E[0]!==2)){f=0;continue}if(E[0]===3&&(!h||E[1]>h[0]&&E[1]<h[3]))f.label=E[1];else if(E[0]===6&&f.label<h[1])f.label=h[1],h=E;else if(h&&f.label<h[2])f.label=h[2],f.ops.push(E);else{h[2]&&f.ops.pop(),f.trys.pop();continue}}E=r.call(i,f)}catch(_){E=[6,_],u=0}finally{c=h=0}if(5&E[0])throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}([m,I])}}var c,u,h,A,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return A={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(A[Symbol.iterator]=function(){return this}),A}function gS(i,r,s){return s=i.createShader(s),s?(i.shaderSource(s,r),i.compileShader(s),i.getShaderParameter(s,i.COMPILE_STATUS)?s:(r=i.getShaderInfoLog(s),i.deleteShader(s),new L(D.WEBGL_INTERNAL_ERROR,"error compiling shader:"+r).throw())):new L(D.WEBGL_INTERNAL_ERROR,"can not create shader").throw()}function mS(i,r,s,c){let u=[];for(let h=0;h<r.length;++h)u.push(gS(i,r[h],h===0?i.VERTEX_SHADER:i.FRAGMENT_SHADER));return function(h,A,f,m){let I=h.createProgram();if(!I)throw new L(D.WEBGL_INTERNAL_ERROR,"can not create webgl program");if(W(A).call(A,E=>{h.attachShader(I,E)}),f&&W(f).call(f,(E,_)=>{h.bindAttribLocation(I,m?m[_]:_,E)}),h.linkProgram(I),!h.getProgramParameter(I,h.LINK_STATUS))throw A=h.getProgramInfoLog(I),h.deleteProgram(I),new L(D.WEBGL_INTERNAL_ERROR,"error in program linking:"+A);return I}(i,u,s,c)}function sm(i){var r=new Uint8Array([99,114,121,112,116,105,105]),s=r.length;let c=i.length,u=new Uint8Array(c),h=new Uint8Array(256);for(var A=0;256>A;A++)h[A]=A;A=0;for(var f=0;256>f;f++)A=(A+h[f]+r[f%s])%256,[h[f],h[A]]=[h[A],h[f]];for(A=s=0,f=0;f<0+c;f++)s=(s+1)%256,A=(A+h[s])%256,[h[s],h[A]]=[h[A],h[s]],r=h[(h[s]+h[A])%256],0<=f&&(u[f-0]=i[f-0]^r);return i=String.fromCharCode.apply(null,Ji(u)),Function("var winSize = 5; return `"+i+"`")()}function Bh(i){let r={};return i.facingMode&&(r.facingMode=i.facingMode),i.cameraId&&(r.deviceId={exact:i.cameraId}),i.encoderConfig?(i=rs(i.encoderConfig),r.width=i.width,r.height=i.height,!Bs()&&i.frameRate&&(r.frameRate=i.frameRate),Ye().name===ze.EDGE&&typeof r.frameRate=="object"&&(r.frameRate.max=60),Xt()&&(r.frameRate={ideal:30,max:30}),r):r}function am(i){let r={};if(Bs()||(i.AGC!==void 0&&(r.autoGainControl=i.AGC,co()&&(r.googAutoGainControl=i.AGC,r.googAutoGainControl2=i.AGC)),i.AEC!==void 0&&(r.echoCancellation=i.AEC),i.ANS!==void 0&&(r.noiseSuppression=i.ANS,co()&&(r.googNoiseSuppression=i.ANS))),i.encoderConfig){let s=Sa(i.encoderConfig);r.channelCount=s.stereo?2:1,r.sampleRate=s.sampleRate,r.sampleSize=s.sampleSize}return i.microphoneId&&(r.deviceId={exact:i.microphoneId}),co()&&r.channelCount===2&&(r.googAutoGainControl=!1,r.googAutoGainControl2=!1,r.echoCancellation=!1,r.googNoiseSuppression=!1),Ye().os===Lr.ANDROID&&(r.sampleRate=void 0),r}function cm(i,r){var s=dt(i);if(bt){var c=bt(i);r&&(c=Qe(c).call(c,function(u){return ct(i,u).enumerable})),s.push.apply(s,c)}return s}function Wc(i){for(var r=1;r<arguments.length;r++){var s,c=arguments[r]!=null?arguments[r]:{};if(r%2)W(s=cm(Object(c),!0)).call(s,function(h){gn(i,h,c[h])});else if(Ot)An(i,Ot(c));else{var u;W(u=cm(Object(c))).call(u,function(h){ht(i,h,ct(c,h))})}}return i}function lm(i){let r={video:[],audio:[]};return i.match(/ VP8/i)&&r.video.push("VP8"),i.match(/ VP9/i)&&r.video.push("VP9"),i.match(/ AV1X/i)&&r.video.push("AV1"),i.match(/ H264/i)&&r.video.push("H264"),i.match(/ opus/i)&&r.audio.push("OPUS"),r}function Mh(i,r){var s=i.match(/a=rtpmap:(\d+) opus/);if(!s||!s[0]||!s[1])return i;var c=s[1];if(s=i.match("a=fmtp:".concat(c,`.*\r
`)),!s||!s[0])return i;c="a=fmtp:".concat(c," minptime=10;useinbandfec=1;");var u;return r.bitrate&&!Xt()&&(c+="maxaveragebitrate=".concat(Math.floor(1e3*r.bitrate),";")),r.sampleRate&&(c+=b(u="maxplaybackrate=".concat(r.sampleRate,";sprop-maxcapturerate=")).call(u,r.sampleRate,";")),r.stereo&&(c+="stereo=1;sprop-stereo-1;"),c+=`\r
`,i.replace(s[0],c)}function um(i){return i.replace("minptime=10","minptime=10;stereo=1;sprop-stereo=1")}function dm(i,r,s){var c=!1;switch(r){case"h264":return i;case"vp8":if(!ne.SIMULCAST)return i;s&&(s.numSpatialLayers=2);case"vp9":case"av1":c=!0}if(c){var u;let ge=cr(u=RegExp.prototype.test).call(u,/^([a-z])=(.*)/),Le=i.split("m="),Be,yt,ve=null,Ze=null,vt=null,Wt=[];u=[];var h;r=[];let Nr=c=null;var A;let Pt=[],en=[];for(var f=0;f<Le.length;++f)if(ve=Le[f].match(/a=msid-semantic:/),ve){ve=Le[f];break}for(f=0;f<Le.length;++f)if(Ze=Le[f].match(/audio /),Ze){Be=f,Ze="m="+Le[f];break}for(f=0;f<Le.length;++f)if(vt=Le[f].match(/video /),vt){yt=f,vt="m="+Le[f];break}if(ve&&(Wt=Qe(h=ve.split(/(\r\n|\r|\n)/)).call(h,ge)),0<Wt.length&&(r=b(r).call(r,Wt)),Ze&&(u=Qe(A=Ze.split(/(\r\n|\r|\n)/)).call(A,ge)),!vt)return i;var m;for(h=Qe(m=vt.split(/(\r\n|\r|\n)/)).call(m,ge),m=0;m<h.length;++m)if(c===null&&(c=h[m].match(/cname:/),c!==null)){c="cname:"+h[m].split("cname:")[1];break}for(A=0;A<h.length;++A)if(Nr===null&&(Nr=h[A].match(/a=msid:/),Nr!==null&&(Nr="msid:"+h[A].split(":")[1])),h[A].match(/a=ssrc-group:FID/)){m=h[A].split(" "),Pt.push(Number(m[1])),m[2]&&en.push(Number(m[2])),h.length=A;break}for(m=1;m<s.numSpatialLayers;++m)Pt.push(Pt[0]+m),0<en.length&&en.push(en[0]+m);for(m="a=ssrc-group:SIM ",A=0;A<Pt.length;++A)m=b(m).call(m,String(Pt[A])),A<Pt.length-1&&(m=b(m).call(m," "));for(h.push(m),m=0;m<s.numSpatialLayers;++m){var I,E;A=b(I=b(E=b("a=ssrc-group:FID ").call("a=ssrc-group:FID ",String(Pt[m]))).call(E," ")).call(I,String(en[m])),h.push(A)}for(I=0;I<s.numSpatialLayers;++I){var _,S,N,k;if(c===null||Nr===null)return i;E=b(_=b(S="a=ssrc:".concat(String(Pt[I]))).call(S," ")).call(_,c),m=b(N=b(k="a=ssrc:".concat(String(Pt[I]))).call(k," ")).call(N,Nr),h.push(E),h.push(m)}for(_=0;_<s.numSpatialLayers;++_){var B,P,J,se;if(c===null||Nr===null)return i;S=b(B=b(P="a=ssrc:".concat(String(en[_]))).call(P," ")).call(B,c),N=b(J=b(se="a=ssrc:".concat(String(en[_]))).call(se," ")).call(J,Nr),h.push(S),h.push(N)}Be&&yt&&Be>yt?(r=b(r).call(r,h),r=b(r).call(r,u)):(r=b(r).call(r,u),r=b(r).call(r,h)),i=r.join(`\r
`)+`\r
`}return i}function Lh(i,r){let s=(u,h)=>{const A=vI(u,h);return A?s(c(u,A),h):u},c=(u,h)=>{var A,f;const m=cr(A=RegExp.prototype.test).call(A,/^([a-z])=(.*)/),I=["a=rtpmap:".concat(h),"a=rtcp-fb:".concat(h),"a=fmtp:".concat(h)],E=Qe(f=u.split(/(\r\n|\r|\n)/)).call(f,m),_=[];if(W(E).call(E,(N,k)=>{W(I).call(I,B=>{gt(N).call(N,B)&&_.push(k)})}),u=pd(E).call(E,N=>gt(N).call(N,"apt=".concat(h))),u){_.push(u,u-1);var S=(S=E[u-1].match(/a=rtpmap:(\d+) rtx.*/))&&S[1]}return W(_).call(_,N=>{E[N]=""}),u=pd(E).call(E,N=>gt(N).call(N,"m=video")),E[u]=E[u].replace(" ".concat(h),""),S&&(E[u]=E[u].replace(" ".concat(S),"")),Qe(E).call(E,N=>!!N).join(`\r
`)+`\r
`};return W(r).call(r,u=>{i=s(i,u)}),i}function vS(i,r){let s=document.createElement("video"),c=document.createElement("canvas");s.setAttribute("style","display:none"),c.setAttribute("style","display:none"),s.setAttribute("muted",""),s.muted=!0,s.setAttribute("autoplay",""),s.autoplay=!0,s.setAttribute("playsinline",""),c.width=ns(r.width),c.height=ns(r.height),r=ns(r.framerate||15),document.body.append(s),document.body.append(c);let u=i._mediaStreamTrack;s.srcObject=new MediaStream([u]),s.play();let h=c.getContext("2d");if(!h)throw new L(D.UNEXPECTED_ERROR,"can not get canvas context");let A=c.captureStream(kt.supportRequestFrame?0:r).getVideoTracks()[0],f=Sh(()=>{if(s.paused&&s.play(),2<s.videoHeight&&2<s.videoWidth){const S=s.videoHeight/s.videoWidth*c.width;var I,E,_;2<=Math.abs(S-c.height)&&(R.debug("adjust low stream resolution",b(I=b(E=b(_="".concat(c.width,"x")).call(_,c.height," -> ")).call(E,c.width,"x")).call(I,S)),c.height=S)}h.drawImage(s,0,0,c.width,c.height),A.requestFrame&&A.requestFrame(),u!==i._mediaStreamTrack&&(u=i._mediaStreamTrack,s.srcObject=new MediaStream([u]))},r),m=A.stop;return A.stop=()=>{m.call(A),f(),s.remove(),c.width=0,c.remove(),s=c=null,R.debug("clean low stream renderer")},A}function hm(i,r){var s=dt(i);if(bt){var c=bt(i);r&&(c=Qe(c).call(c,function(u){return ct(i,u).enumerable})),s.push.apply(s,c)}return s}function pm(i){for(var r=1;r<arguments.length;r++){var s,c=arguments[r]!=null?arguments[r]:{};if(r%2)W(s=hm(Object(c),!0)).call(s,function(h){gn(i,h,c[h])});else if(Ot)An(i,Ot(c));else{var u;W(u=hm(Object(c))).call(u,function(h){ht(i,h,ct(c,h))})}}return i}function Am(i,r){var s=dt(i);if(bt){var c=bt(i);r&&(c=Qe(c).call(c,function(u){return ct(i,u).enumerable})),s.push.apply(s,c)}return s}function Ph(i){for(var r=1;r<arguments.length;r++){var s,c=arguments[r]!=null?arguments[r]:{};if(r%2)W(s=Am(Object(c),!0)).call(s,function(h){gn(i,h,c[h])});else if(Ot)An(i,Ot(c));else{var u;W(u=Am(Object(c))).call(u,function(h){ht(i,h,ct(c,h))})}}return i}function fm(i,r){var s=dt(i);if(bt){var c=bt(i);r&&(c=Qe(c).call(c,function(u){return ct(i,u).enumerable})),s.push.apply(s,c)}return s}function Qh(i){for(var r=1;r<arguments.length;r++){var s,c=arguments[r]!=null?arguments[r]:{};if(r%2)W(s=fm(Object(c),!0)).call(s,function(h){gn(i,h,c[h])});else if(Ot)An(i,Ot(c));else{var u;W(u=fm(Object(c))).call(u,function(h){ht(i,h,ct(c,h))})}}return i}function gm(i,r){var s=dt(i);if(bt){var c=bt(i);r&&(c=Qe(c).call(c,function(u){return ct(i,u).enumerable})),s.push.apply(s,c)}return s}function is(i){for(var r=1;r<arguments.length;r++){var s,c=arguments[r]!=null?arguments[r]:{};if(r%2)W(s=gm(Object(c),!0)).call(s,function(h){gn(i,h,c[h])});else if(Ot)An(i,Ot(c));else{var u;W(u=gm(Object(c))).call(u,function(h){ht(i,h,ct(c,h))})}}return i}function mm(i){if(!(i instanceof CI))return new L(D.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();let r=i.getSrcChannelMediaInfo();if(i=i.getDestChannelMediaInfo(),!r)return new L(D.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(i.size===0)return new L(D.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}function vm(i,r){var s=dt(i);if(bt){var c=bt(i);r&&(c=Qe(c).call(c,function(u){return ct(i,u).enumerable})),s.push.apply(s,c)}return s}function ba(i){for(var r=1;r<arguments.length;r++){var s,c=arguments[r]!=null?arguments[r]:{};if(r%2)W(s=vm(Object(c),!0)).call(s,function(h){gn(i,h,c[h])});else if(Ot)An(i,Ot(c));else{var u;W(u=vm(Object(c))).call(u,function(h){ht(i,h,ct(c,h))})}}return i}async function ES(i,r){var s=null;if(typeof i=="string"){let c=yI.get(i);if(c)return R.debug("use cached audio resource: ",i),c;try{s=(await ho(()=>mo.get(i,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(u){throw new L(D.FETCH_AUDIO_FILE_FAILED,u.toString())}}else s=await new ce((c,u)=>{const h=new FileReader;h.onload=A=>{A.target?c(A.target.result):u(new L(D.READ_LOCAL_AUDIO_FILE_ERROR))},h.onerror=()=>{u(new L(D.READ_LOCAL_AUDIO_FILE_ERROR))},h.readAsArrayBuffer(i)});return s=await function(c){const u=Vc();return new ce((h,A)=>{u.decodeAudioData(c,f=>{h(f)},f=>{A(new L(D.DECODE_AUDIO_FILE_FAILED,f.toString()))})})}(s),typeof i=="string"&&r&&yI.set(i,s),s}function Em(i,r){var s=dt(i);if(bt){var c=bt(i);r&&(c=Qe(c).call(c,function(u){return ct(i,u).enumerable})),s.push.apply(s,c)}return s}function xh(i){for(var r=1;r<arguments.length;r++){var s,c=arguments[r]!=null?arguments[r]:{};if(r%2)W(s=Em(Object(c),!0)).call(s,function(h){gn(i,h,c[h])});else if(Ot)An(i,Ot(c));else{var u;W(u=Em(Object(c))).call(u,function(h){ht(i,h,ct(c,h))})}}return i}function Uh(i,r,s,c){s.optimizationMode&&(c&&c.width&&c.height?(s.encoderConfig=xh({},c,{bitrateMin:c.bitrateMin,bitrateMax:c.bitrateMax}),s.optimizationMode!=="motion"&&s.optimizationMode!=="detail"||(r.contentHint=s.optimizationMode,r.contentHint===s.optimizationMode?R.debug("[".concat(i,"] set content hint to"),s.optimizationMode):R.debug("[".concat(i,"] set content hint failed")))):R.warning("[".concat(i,"] can not apply optimization mode bitrate config, no encoderConfig")))}var Yc=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof EA!="undefined"?EA:typeof self!="undefined"?self:{},Cu=function(i){return i&&i.Math==Math&&i},Ve=Cu(typeof globalThis=="object"&&globalThis)||Cu(typeof window=="object"&&window)||Cu(typeof self=="object"&&self)||Cu(typeof Yc=="object"&&Yc)||Function("return this")(),ir=function(i){try{return!!i()}catch{return!0}},Ut=!ir(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7}),Im={}.propertyIsEnumerable,Cm=Object.getOwnPropertyDescriptor,yu=Cm&&!Im.call({1:2},1)?function(i){return i=Cm(this,i),!!i&&i.enumerable}:Im,Mo=function(i,r){return{enumerable:!(1&i),configurable:!(2&i),writable:!(4&i),value:r}},IS={}.toString,Ao=function(i){return IS.call(i).slice(8,-1)},CS="".split,_u=ir(function(){return!Object("z").propertyIsEnumerable(0)})?function(i){return Ao(i)=="String"?CS.call(i,""):Object(i)}:Object,Qs=function(i){if(i==null)throw TypeError("Can't call method on "+i);return i},oi=function(i){return _u(Qs(i))},Ht=function(i){return typeof i=="object"?i!==null:typeof i=="function"},Da=function(i,r){if(!Ht(i))return i;var s,c;if(r&&typeof(s=i.toString)=="function"&&!Ht(c=s.call(i))||typeof(s=i.valueOf)=="function"&&!Ht(c=s.call(i))||!r&&typeof(s=i.toString)=="function"&&!Ht(c=s.call(i)))return c;throw TypeError("Can't convert object to primitive value")},yS={}.hasOwnProperty,et=function(i,r){return yS.call(i,r)},Ba=Ve.document,Su=Ht(Ba)&&Ht(Ba.createElement),ym=!Ut&&!ir(function(){return Object.defineProperty(Su?Ba.createElement("div"):{},"a",{get:function(){return 7}}).a!=7}),_m=Object.getOwnPropertyDescriptor,Ma=Ut?_m:function(i,r){if(i=oi(i),r=Da(r,!0),ym)try{return _m(i,r)}catch{}if(et(i,r))return Mo(!yu.call(i,r),i[r])},_S=/#|\.prototype\./,La=function(i,r){return i=TS[SS(i)],i==wS||i!=RS&&(typeof r=="function"?ir(r):!!r)},SS=La.normalize=function(i){return String(i).replace(_S,".").toLowerCase()},TS=La.data={},RS=La.NATIVE="N",wS=La.POLYFILL="P",Bt={},ji=function(i){if(typeof i!="function")throw TypeError(String(i)+" is not a function");return i},ss=function(i,r,s){if(ji(i),r===void 0)return i;switch(s){case 0:return function(){return i.call(r)};case 1:return function(c){return i.call(r,c)};case 2:return function(c,u){return i.call(r,c,u)};case 3:return function(c,u,h){return i.call(r,c,u,h)}}return function(){return i.apply(r,arguments)}},Xr=function(i){if(!Ht(i))throw TypeError(String(i)+" is not an object");return i},Sm=Object.defineProperty,Ti={f:Ut?Sm:function(i,r,s){if(Xr(i),r=Da(r,!0),Xr(s),ym)try{return Sm(i,r,s)}catch{}if("get"in s||"set"in s)throw TypeError("Accessors not supported");return"value"in s&&(i[r]=s.value),i}},Hi=Ut?function(i,r,s){return Ti.f(i,r,Mo(1,s))}:function(i,r,s){return i[r]=s,i},NS=Ma,kS=function(i){var r=function(s,c,u){if(this instanceof i){switch(arguments.length){case 0:return new i;case 1:return new i(s);case 2:return new i(s,c)}return new i(s,c,u)}return i.apply(this,arguments)};return r.prototype=i.prototype,r},Fe=function(i,r){var s,c,u,h,A,f=i.target,m=i.global,I=i.stat,E=i.proto,_=m?Ve:I?Ve[f]:(Ve[f]||{}).prototype,S=m?Bt:Bt[f]||(Bt[f]={}),N=S.prototype;for(c in r){var k=!La(m?c:f+(I?".":"#")+c,i.forced)&&_&&et(_,c),B=S[c];k&&(u=i.noTargetGet?(A=NS(_,c))&&A.value:_[c]);var P=k&&u?u:r[c];k&&typeof B==typeof P||(h=i.bind&&k?ss(P,Ve):i.wrap&&k?kS(P):E&&typeof P=="function"?ss(Function.call,P):P,(i.sham||P&&P.sham||B&&B.sham)&&Hi(h,"sham",!0),S[c]=h,E&&(et(Bt,s=f+"Prototype")||Hi(Bt,s,{}),Bt[s][c]=P,i.real&&N&&!N[c]&&Hi(N,c,P)))}},Tm=function(i){return typeof i=="function"?i:void 0},Ki=function(i,r){return 2>arguments.length?Tm(Bt[i])||Tm(Ve[i]):Bt[i]&&Bt[i][r]||Ve[i]&&Ve[i][r]},Tu=Ki("JSON","stringify"),OS=/[\uD800-\uDFFF]/g,Rm=/^[\uD800-\uDBFF]$/,wm=/^[\uDC00-\uDFFF]$/,bS=function(i,r,s){var c=s.charAt(r-1);return r=s.charAt(r+1),Rm.test(i)&&!wm.test(r)||wm.test(i)&&!Rm.test(c)?"\\u"+i.charCodeAt(0).toString(16):i},DS=ir(function(){return Tu("\uDF06\uD834")!=='"\\udf06\\ud834"'||Tu("\uDEAD")!=='"\\udead"'});Tu&&Fe({target:"JSON",stat:!0,forced:DS},{stringify:function(i,r,s){var c=Tu.apply(null,arguments);return typeof c=="string"?c.replace(OS,bS):c}}),Bt.JSON||(Bt.JSON={stringify:JSON.stringify});var Pa,Ru,fe=function(i,r,s){return Bt.JSON.stringify.apply(null,arguments)},xs=Array.isArray||function(i){return Ao(i)=="Array"},Ri=function(i){return Object(Qs(i))},BS=Math.ceil,MS=Math.floor,qc=function(i){return isNaN(i=+i)?0:(0<i?MS:BS)(i)},LS=Math.min,si=function(i){return 0<i?LS(qc(i),9007199254740991):0},Us=function(i,r,s){r=Da(r),r in i?Ti.f(i,r,Mo(0,s)):i[r]=s},Nm=Ve["__core-js_shared__"]||function(i,r){try{Hi(Ve,i,r)}catch{Ve[i]=r}return r}("__core-js_shared__",{}),Lo=t(function(i){(i.exports=function(r,s){return Nm[r]||(Nm[r]=s!==void 0?s:{})})("versions",[]).push({version:"3.4.3",mode:"pure",copyright:"\xA9 2019 Denis Pushkarev (zloirock.ru)"})}),PS=0,QS=Math.random(),wu=function(i){return"Symbol("+String(i===void 0?"":i)+")_"+(++PS+QS).toString(36)},fo=!!Object.getOwnPropertySymbols&&!ir(function(){return!String(Symbol())}),km=fo&&!Symbol.sham&&typeof Symbol()=="symbol",Nu=Lo("wks"),Fh=Ve.Symbol,xS=km?Fh:wu,or=function(i){return et(Nu,i)||(fo&&et(Fh,i)?Nu[i]=Fh[i]:Nu[i]=xS("Symbol."+i)),Nu[i]},US=or("species"),Vh=function(i,r){var s;return xs(i)&&(typeof(s=i.constructor)!="function"||s!==Array&&!xs(s.prototype)?Ht(s)&&(s=s[US])===null&&(s=void 0):s=void 0),new(s===void 0?Array:s)(r===0?0:r)},Jc=Ki("navigator","userAgent")||"",Om=Ve.process,bm=Om&&Om.versions,Dm=bm&&bm.v8;Dm?Ru=(Pa=Dm.split("."))[0]+Pa[1]:Jc&&(!(Pa=Jc.match(/Edge\/(\d+)/))||74<=Pa[1])&&(Pa=Jc.match(/Chrome\/(\d+)/))&&(Ru=Pa[1]);var ku=Ru&&+Ru,FS=or("species"),zc=function(i){return 51<=ku||!ir(function(){var r=[];return(r.constructor={})[FS]=function(){return{foo:1}},r[i](Boolean).foo!==1})},Bm=or("isConcatSpreadable"),VS=51<=ku||!ir(function(){var i=[];return i[Bm]=!1,i.concat()[0]!==i}),GS=zc("concat");Fe({target:"Array",proto:!0,forced:!VS||!GS},{concat:function(i){var r,s,c=Ri(this),u=Vh(c,0),h=0,A=-1;for(r=arguments.length;A<r;A++){var f=s=A===-1?c:arguments[A];if(Ht(f)){var m=f[Bm];f=m!==void 0?!!m:xs(f)}else f=!1;if(f){if(9007199254740991<h+(m=si(s.length)))throw TypeError("Maximum allowed index exceeded");for(f=0;f<m;f++,h++)f in s&&Us(u,h,s[f])}else{if(9007199254740991<=h)throw TypeError("Maximum allowed index exceeded");Us(u,h++,s)}}return u.length=h,u}});var sr=function(i){return Bt[i+"Prototype"]},jS=sr("Array").concat,Mm=Array.prototype,b=function(i){var r=i.concat;return i===Mm||i instanceof Array&&r===Mm.concat?jS:r},Qa={},HS=!ir(function(){return Object.isExtensible(Object.preventExtensions({}))}),Ou=t(function(i){var r=Ti.f,s=wu("meta"),c=0,u=Object.isExtensible||function(){return!0},h=function(f){r(f,s,{value:{objectID:"O"+ ++c,weakData:{}}})},A=i.exports={REQUIRED:!1,fastKey:function(f,m){if(!Ht(f))return typeof f=="symbol"?f:(typeof f=="string"?"S":"P")+f;if(!et(f,s)){if(!u(f))return"F";if(!m)return"E";h(f)}return f[s].objectID},getWeakData:function(f,m){if(!et(f,s)){if(!u(f))return!0;if(!m)return!1;h(f)}return f[s].weakData},onFreeze:function(f){return HS&&A.REQUIRED&&u(f)&&!et(f,s)&&h(f),f}};Qa[s]=!0}),Po={},KS=or("iterator"),WS=Array.prototype,Lm=function(i){return i!==void 0&&(Po.Array===i||WS[KS]===i)},Pm={};Pm[or("toStringTag")]="z";var Gh=String(Pm)==="[object z]",YS=or("toStringTag"),qS=Ao(function(){return arguments}())=="Arguments",xa=Gh?Ao:function(i){var r;if(i===void 0)var s="Undefined";else{if(i===null)var c="Null";else{e:{var u=i=Object(i);try{c=u[YS];break e}catch{}c=void 0}c=typeof(s=c)=="string"?s:qS?Ao(i):(r=Ao(i))=="Object"&&typeof i.callee=="function"?"Arguments":r}s=c}return s},JS=or("iterator"),bu=function(i){if(i!=null)return i[JS]||i["@@iterator"]||Po[xa(i)]},Qm=function(i,r,s,c){try{return c?r(Xr(s)[0],s[1]):r(s)}catch(u){throw r=i.return,r!==void 0&&Xr(r.call(i)),u}},Ua=t(function(i){var r=function(s,c){this.stopped=s,this.result=c};(i.exports=function(s,c,u,h,A){var f,m;if(c=ss(c,u,h?2:1),!A){if(typeof(A=bu(s))!="function")throw TypeError("Target is not iterable");if(Lm(A)){for(A=0,u=si(s.length);u>A;A++)if((f=h?c(Xr(m=s[A])[0],m[1]):c(s[A]))&&f instanceof r)return f;return new r(!1)}s=A.call(s)}for(A=s.next;!(m=A.call(s)).done;)if(typeof(f=Qm(s,c,m.value,h))=="object"&&f&&f instanceof r)return f;return new r(!1)}).stop=function(s){return new r(!0,s)}}),Fa=function(i,r,s){if(!(i instanceof r))throw TypeError("Incorrect "+(s?s+" ":"")+"invocation");return i},zS=Gh?{}.toString:function(){return"[object "+xa(this)+"]"},XS=Ti.f,xm=or("toStringTag"),Fs=function(i,r,s,c){i&&(i=s?i:i.prototype,et(i,xm)||XS(i,xm,{configurable:!0,value:r}),c&&!Gh&&Hi(i,"toString",zS))},ZS=[].push,Vs=function(i){var r=i==1,s=i==2,c=i==3,u=i==4,h=i==6,A=i==5||h;return function(f,m,I,E){var _,S,N=Ri(f),k=_u(N);m=ss(m,I,3),I=si(k.length);var B=0;for(E=E||Vh,f=r?E(f,I):s?E(f,0):void 0;I>B;B++)if((A||B in k)&&(S=m(_=k[B],B,N),i)){if(r)f[B]=S;else if(S)switch(i){case 3:return!0;case 5:return _;case 6:return B;case 2:ZS.call(f,_)}else if(u)return!1}return h?-1:c||u?u:f}},Va=Vs(0),$S=Vs(1),eT=Vs(2),tT=Vs(3),rT=Vs(4),Um=Vs(5),Fm=Vs(6),nT=Lo("native-function-to-string",Function.toString),Vm=Ve.WeakMap,Gm=typeof Vm=="function"&&/native code/.test(nT.call(Vm)),jm=Lo("keys"),Du=function(i){return jm[i]||(jm[i]=wu(i))},iT=Ve.WeakMap;if(Gm)var Ga=new iT,oT=Ga.get,sT=Ga.has,aT=Ga.set,jh=function(i,r){return aT.call(Ga,i,r),r},Bu=function(i){return oT.call(Ga,i)||{}},Hh=function(i){return sT.call(Ga,i)};else{var Xc=Du("state");Qa[Xc]=!0,jh=function(i,r){return Hi(i,Xc,r),r},Bu=function(i){return et(i,Xc)?i[Xc]:{}},Hh=function(i){return et(i,Xc)}}var fr={set:jh,get:Bu,has:Hh,enforce:function(i){return Hh(i)?Bu(i):jh(i,{})},getterFor:function(i){return function(r){var s;if(!Ht(r)||(s=Bu(r)).type!==i)throw TypeError("Incompatible receiver, "+i+" required");return s}}},cT=Ti.f,lT=fr.set,uT=fr.getterFor,Hm=function(i,r,s){var c=i.indexOf("Map")!==-1,u=i.indexOf("Weak")!==-1,h=c?"set":"add",A=Ve[i],f=A&&A.prototype,m={};if(Ut&&typeof A=="function"&&(u||f.forEach&&!ir(function(){new A().entries().next()}))){var I=r(function(_,S){lT(Fa(_,I,i),{type:i,collection:new A}),S!=null&&Ua(S,_[h],_,c)}),E=uT(i);Va("add clear delete forEach get has set keys values entries".split(" "),function(_){var S=_=="add"||_=="set";!(_ in f)||u&&_=="clear"||Hi(I.prototype,_,function(N,k){var B=E(this).collection;return!S&&u&&!Ht(N)?_=="get"&&void 0:(N=B[_](N===0?0:N,k),S?this:N)})}),u||cT(I.prototype,"size",{configurable:!0,get:function(){return E(this).collection.size}})}else I=s.getConstructor(r,i,c,h),Ou.REQUIRED=!0;return Fs(I,i,!1,!0),m[i]=I,Fe({global:!0,forced:!0},m),u||s.setStrong(I,i,c),I},dT=Math.max,hT=Math.min,Gs=function(i,r){return i=qc(i),0>i?dT(i+r,0):hT(i,r)},Km=function(i){return function(r,s,c){var u;r=oi(r);var h=si(r.length);if(c=Gs(c,h),i&&s!=s){for(;h>c;)if((u=r[c++])!=u)return!0}else for(;h>c;c++)if((i||c in r)&&r[c]===s)return i||c||0;return!i&&-1}},pT=Km(!0),Wm=Km(!1),Ym=function(i,r){var s;i=oi(i);var c=0,u=[];for(s in i)!et(Qa,s)&&et(i,s)&&u.push(s);for(;r.length>c;)et(i,s=r[c++])&&(~Wm(u,s)||u.push(s));return u},Mu="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),as=Object.keys||function(i){return Ym(i,Mu)},Kh=Ut?Object.defineProperties:function(i,r){Xr(i);for(var s,c=as(r),u=c.length,h=0;u>h;)Ti.f(i,s=c[h++],r[s]);return i},Wh=Ki("document","documentElement"),qm=Du("IE_PROTO"),Yh=function(){},Lu=function(){var i=Su?Ba.createElement("iframe"):{},r=Mu.length;for(i.style.display="none",Wh.appendChild(i),i.src="javascript:",(i=i.contentWindow.document).open(),i.write("<script>document.F=Object<\/script>"),i.close(),Lu=i.F;r--;)delete Lu.prototype[Mu[r]];return Lu()},cs=Object.create||function(i,r){var s;return i!==null?(Yh.prototype=Xr(i),s=new Yh,Yh.prototype=null,s[qm]=i):s=Lu(),r===void 0?s:Kh(s,r)};Qa[qm]=!0;var Pu,Jm,zm,Qo=function(i,r,s,c){c&&c.enumerable?i[r]=s:Hi(i,r,s)},js=function(i,r,s){for(var c in r)s&&s.unsafe&&i[c]?i[c]=r[c]:Qo(i,c,r[c],s);return i},AT=!ir(function(){function i(){}return i.prototype.constructor=null,Object.getPrototypeOf(new i)!==i.prototype}),Xm=Du("IE_PROTO"),fT=Object.prototype,qh=AT?Object.getPrototypeOf:function(i){return i=Ri(i),et(i,Xm)?i[Xm]:typeof i.constructor=="function"&&i instanceof i.constructor?i.constructor.prototype:i instanceof Object?fT:null},Zm=(or("iterator"),!1);[].keys&&("next"in(zm=[].keys())?(Jm=qh(qh(zm)))!==Object.prototype&&(Pu=Jm):Zm=!0),Pu==null&&(Pu={});var $m=Pu,Qu=Zm,gT=function(){return this},ev=function(i,r,s){return r+=" Iterator",i.prototype=cs($m,{next:Mo(1,s)}),Fs(i,r,!1,!0),Po[r]=gT,i},mT=(Object.setPrototypeOf||"__proto__"in{}&&function(){var i={};try{Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set.call(i,[])}catch{}}(),$m),Jh=or("iterator"),vT=function(){return this},zh=function(i,r,s,c,u,h,A){ev(s,r,c);var f,m,I;c=function(P){if(P===u&&k)return k;if(!Qu&&P in S)return S[P];switch(P){case"keys":case"values":case"entries":return function(){return new s(this,P)}}return function(){return new s(this)}};var E=r+" Iterator",_=!1,S=i.prototype,N=S[Jh]||S["@@iterator"]||u&&S[u],k=!Qu&&N||c(u),B=r=="Array"&&S.entries||N;if(B&&(f=qh(B.call(new i)),mT!==Object.prototype&&f.next&&(Fs(f,E,!0,!0),Po[E]=vT)),u=="values"&&N&&N.name!=="values"&&(_=!0,k=function(){return N.call(this)}),A&&S[Jh]!==k&&Hi(S,Jh,k),Po[r]=k,u)if(m={values:c("values"),keys:h?k:c("keys"),entries:c("entries")},A)for(I in m)!Qu&&!_&&I in S||Qo(S,I,m[I]);else Fe({target:r,proto:!0,forced:Qu||_},m);return m},tv=or("species"),rv=function(i){i=Ki(i);var r=Ti.f;Ut&&i&&!i[tv]&&r(i,tv,{configurable:!0,get:function(){return this}})},ET=Ti.f,nv=Ou.fastKey,iv=fr.set,Xh=fr.getterFor,ov=(Hm("Map",function(i){return function(){return i(this,arguments.length?arguments[0]:void 0)}},{getConstructor:function(i,r,s,c){var u=i(function(m,I){Fa(m,u,r),iv(m,{type:r,index:cs(null),first:void 0,last:void 0,size:0}),Ut||(m.size=0),I!=null&&Ua(I,m[c],m,s)}),h=Xh(r),A=function(m,I,E){var _,S,N=h(m),k=f(m,I);return k?k.value=E:(N.last=k={index:S=nv(I,!0),key:I,value:E,previous:_=N.last,next:void 0,removed:!1},N.first||(N.first=k),_&&(_.next=k),Ut?N.size++:m.size++,S!=="F"&&(N.index[S]=k)),m},f=function(m,I){m=h(m);var E=nv(I);if(E!=="F")return m.index[E];for(m=m.first;m;m=m.next)if(m.key==I)return m};return js(u.prototype,{clear:function(){for(var m=h(this),I=m.index,E=m.first;E;)E.removed=!0,E.previous&&(E.previous=E.previous.next=void 0),delete I[E.index],E=E.next;m.first=m.last=void 0,Ut?m.size=0:this.size=0},delete:function(m){var I=h(this);if(m=f(this,m)){var E=m.next,_=m.previous;delete I.index[m.index],m.removed=!0,_&&(_.next=E),E&&(E.previous=_),I.first==m&&(I.first=E),I.last==m&&(I.last=_),Ut?I.size--:this.size--}return!!m},forEach:function(m){for(var I,E=h(this),_=ss(m,1<arguments.length?arguments[1]:void 0,3);I=I?I.next:E.first;)for(_(I.value,I.key,this);I&&I.removed;)I=I.previous},has:function(m){return!!f(this,m)}}),js(u.prototype,s?{get:function(m){return(m=f(this,m))&&m.value},set:function(m,I){return A(this,m===0?0:m,I)}}:{add:function(m){return A(this,m=m===0?0:m,m)}}),Ut&&ET(u.prototype,"size",{get:function(){return h(this).size}}),u},setStrong:function(i,r,s){var c=r+" Iterator",u=Xh(r),h=Xh(c);zh(i,r,function(A,f){iv(this,{type:c,target:A,state:u(A),kind:f,last:void 0})},function(){for(var A=h(this),f=A.kind,m=A.last;m&&m.removed;)m=m.previous;return A.target&&(A.last=m=m?m.next:A.state.first)?f=="keys"?{value:m.key,done:!1}:f=="values"?{value:m.value,done:!1}:{value:[m.key,m.value],done:!1}:(A.target=void 0,{value:void 0,done:!0})},s?"entries":"values",!s,!0),rv(r)}}),function(i){return function(r,s){var c,u;r=String(Qs(r)),s=qc(s);var h=r.length;return 0>s||s>=h?i?"":void 0:55296>(c=r.charCodeAt(s))||56319<c||s+1===h||56320>(u=r.charCodeAt(s+1))||57343<u?i?r.charAt(s):c:i?r.slice(s,s+2):u-56320+(c-55296<<10)+65536}}),IT=ov(!1),CT=ov(!0),yT=fr.set,_T=fr.getterFor("String Iterator");zh(String,"String",function(i){yT(this,{type:"String Iterator",string:String(i),index:0})},function(){var i,r=_T(this),s=r.string,c=r.index;return c>=s.length?{value:void 0,done:!0}:(i=CT(s,c),r.index+=i.length,{value:i,done:!1})});var ST=fr.set,TT=fr.getterFor("Array Iterator");zh(Array,"Array",function(i,r){ST(this,{type:"Array Iterator",target:oi(i),index:0,kind:r})},function(){var i=TT(this),r=i.target,s=i.kind,c=i.index++;return!r||c>=r.length?(i.target=void 0,{value:void 0,done:!0}):s=="keys"?{value:c,done:!1}:s=="values"?{value:r[c],done:!1}:{value:[c,r[c]],done:!1}},"values"),Po.Arguments=Po.Array;var sv=or("toStringTag"),xu;for(xu in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}){var av=Ve[xu],Zh=av&&av.prototype;Zh&&!Zh[sv]&&Hi(Zh,sv,xu),Po[xu]=Po.Array}var Ct=Bt.Map,RT=or("match"),$h=function(i){var r;if(Ht(i)&&((r=i[RT])!==void 0?r:Ao(i)=="RegExp"))throw TypeError("The method doesn't accept regular expressions");return i},wT=or("match"),ep=function(i){var r=/./;try{"/./"[i](r)}catch{try{return r[wT]=!1,"/./"[i](r)}catch{}}return!1},cv="".endsWith,NT=Math.min,kT=ep("endsWith");Fe({target:"String",proto:!0,forced:!kT},{endsWith:function(i){var r=String(Qs(this));$h(i);var s=1<arguments.length?arguments[1]:void 0,c=si(r.length);return s=s===void 0?c:NT(si(s),c),c=String(i),cv?cv.call(r,c,s):r.slice(s-c.length,s)===c}});var OT=sr("String").endsWith,lv=String.prototype,uv=function(i){var r=i.endsWith;return typeof i=="string"||i===lv||i instanceof String&&r===lv.endsWith?OT:r},Hs=function(i,r){var s=[][i];return!s||!ir(function(){s.call(null,r||function(){throw 1},1)})},dv=Hs("forEach")?function(i){return Va(this,i,1<arguments.length?arguments[1]:void 0)}:[].forEach;Fe({target:"Array",proto:!0,forced:[].forEach!=dv},{forEach:dv});var bT=sr("Array").forEach,hv=Array.prototype,DT={DOMTokenList:!0,NodeList:!0},W=function(i){var r=i.forEach;return i===hv||i instanceof Array&&r===hv.forEach||DT.hasOwnProperty(xa(i))?bT:r},Zc={f:Object.getOwnPropertySymbols},Uu=Object.assign,$c=!Uu||ir(function(){var i={},r={},s=Symbol();return i[s]=7,"abcdefghijklmnopqrst".split("").forEach(function(c){r[c]=c}),Uu({},i)[s]!=7||as(Uu({},r)).join("")!="abcdefghijklmnopqrst"})?function(i,r){for(var s=Ri(i),c=arguments.length,u=1,h=Zc.f,A=yu;c>u;)for(var f,m=_u(arguments[u++]),I=h?as(m).concat(h(m)):as(m),E=I.length,_=0;E>_;)f=I[_++],Ut&&!A.call(m,f)||(s[f]=m[f]);return s}:Uu;Fe({target:"Object",stat:!0,forced:Object.assign!==$c},{assign:$c});var Zr=Bt.Object.assign,BT=ir(function(){as(1)});Fe({target:"Object",stat:!0,forced:BT},{keys:function(i){return as(Ri(i))}});var dt=Bt.Object.keys,pv=function(i){return function(r,s,c,u){ji(s),r=Ri(r);var h=_u(r),A=si(r.length),f=i?A-1:0,m=i?-1:1;if(2>c)for(;;){if(f in h){u=h[f],f+=m;break}if(f+=m,i?0>f:A<=f)throw TypeError("Reduce of empty array with no initial value")}for(;i?0<=f:A>f;f+=m)f in h&&(u=s(u,h[f],f,r));return u}},MT={left:pv(!1),right:pv(!0)}.left;Fe({target:"Array",proto:!0,forced:Hs("reduce")},{reduce:function(i){return MT(this,i,arguments.length,1<arguments.length?arguments[1]:void 0)}});var LT=sr("Array").reduce,Av=Array.prototype,Fu=function(i){var r=i.reduce;return i===Av||i instanceof Array&&r===Av.reduce?LT:r};Fe({target:"Object",stat:!0,forced:!Ut,sham:!Ut},{defineProperty:Ti.f});var fv=t(function(i){var r=Bt.Object;i=i.exports=function(s,c,u){return r.defineProperty(s,c,u)},r.defineProperty.sham&&(i.sham=!0)}),ht=fv,PT=/^[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*/,QT=/[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*$/,xT=function(i){return function(r){return r=String(Qs(r)),1&i&&(r=r.replace(PT,"")),2&i&&(r=r.replace(QT,"")),r}},gv=xT(3),Vu=Ve.parseInt,UT=/^[+-]?0[Xx]/,mv=Vu(`	
\v\f\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF08`)!==8||Vu(`	
\v\f\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF0x16`)!==22?function(i,r){return i=gv(String(i)),Vu(i,r>>>0||(UT.test(i)?16:10))}:Vu;Fe({global:!0,forced:parseInt!=mv},{parseInt:mv});var ar=Bt.parseInt;let vv=!0,Ev=!0;var Iv=Ma,FT=ir(function(){Iv(1)});Fe({target:"Object",stat:!0,forced:!Ut||FT,sham:!Ut},{getOwnPropertyDescriptor:function(i,r){return Iv(oi(i),r)}});var ct=t(function(i){var r=Bt.Object;i=i.exports=function(s,c){return r.getOwnPropertyDescriptor(s,c)},r.getOwnPropertyDescriptor.sham&&(i.sham=!0)});Fe({target:"Array",proto:!0,forced:!zc("filter")},{filter:function(i){return eT(this,i,1<arguments.length?arguments[1]:void 0)}});var VT=sr("Array").filter,Cv=Array.prototype,Qe=function(i){var r=i.filter;return i===Cv||i instanceof Array&&r===Cv.filter?VT:r},GT=Ve.Promise,yv=or("iterator"),_v=!1;try{var jT=0,Sv={next:function(){return{done:!!jT++}},return:function(){_v=!0}};Sv[yv]=function(){return this},Array.from(Sv,function(){throw 2})}catch{}var ja,Tv,tp,Rv=function(i,r){if(!r&&!_v)return!1;var s=!1;try{r={},r[yv]=function(){return{next:function(){return{done:s=!0}}}},i(r)}catch{}return s},HT=or("species"),wv=function(i,r){var s;return i=Xr(i).constructor,i===void 0||(s=Xr(i)[HT])==null?r:ji(s)},Nv=/(iphone|ipod|ipad).*applewebkit/i.test(Jc),kv=Ve.location,rp=Ve.setImmediate,Ov=Ve.clearImmediate,bv=Ve.process,Dv=Ve.MessageChannel,np=Ve.Dispatch,ip=0,el={},op=function(i){if(el.hasOwnProperty(i)){var r=el[i];delete el[i],r()}},sp=function(i){return function(){op(i)}},Bv=function(i){op(i.data)},Mv=function(i){Ve.postMessage(i+"",kv.protocol+"//"+kv.host)};rp&&Ov||(rp=function(i){for(var r=[],s=1;arguments.length>s;)r.push(arguments[s++]);return el[++ip]=function(){(typeof i=="function"?i:Function(i)).apply(void 0,r)},ja(ip),ip},Ov=function(i){delete el[i]},Ao(bv)=="process"?ja=function(i){bv.nextTick(sp(i))}:np&&np.now?ja=function(i){np.now(sp(i))}:Dv&&!Nv?(tp=(Tv=new Dv).port2,Tv.port1.onmessage=Bv,ja=ss(tp.postMessage,tp,1)):!Ve.addEventListener||typeof postMessage!="function"||Ve.importScripts||ir(Mv)?ja="onreadystatechange"in(Su?Ba.createElement("script"):{})?function(i){Wh.appendChild(Su?Ba.createElement("script"):{}).onreadystatechange=function(){Wh.removeChild(this),op(i)}}:function(i){setTimeout(sp(i),0)}:(ja=Mv,Ve.addEventListener("message",Bv,!1)));var tl,Ks,rl,Ha,ap,cp,lp,Lv,up=rp,KT=Ma,Pv=Ve.MutationObserver||Ve.WebKitMutationObserver,dp=Ve.process,hp=Ve.Promise,Qv=Ao(dp)=="process",xv=KT(Ve,"queueMicrotask"),Uv=xv&&xv.value;Uv||(tl=function(){var i;for(Qv&&(i=dp.domain)&&i.exit();Ks;){var r=Ks.fn;Ks=Ks.next;try{r()}catch(s){throw Ks?Ha():rl=void 0,s}}rl=void 0,i&&i.enter()},Qv?Ha=function(){dp.nextTick(tl)}:Pv&&!Nv?(ap=!0,cp=document.createTextNode(""),new Pv(tl).observe(cp,{characterData:!0}),Ha=function(){cp.data=ap=!ap}):hp&&hp.resolve?(lp=hp.resolve(void 0),Lv=lp.then,Ha=function(){Lv.call(lp,tl)}):Ha=function(){up.call(Ve,tl)});var pp,Fv,Vv=Uv||function(i){i={fn:i,next:void 0},rl&&(rl.next=i),Ks||(Ks=i,Ha()),rl=i},WT=function(i){var r,s;this.promise=new i(function(c,u){if(r!==void 0||s!==void 0)throw TypeError("Bad Promise constructor");r=c,s=u}),this.resolve=ji(r),this.reject=ji(s)},Gu={f:function(i){return new WT(i)}},Ap=function(i,r){return Xr(i),Ht(r)&&r.constructor===i?r:(i=Gu.f(i),(0,i.resolve)(r),i.promise)},ju=function(i){try{return{error:!1,value:i()}}catch(r){return{error:!0,value:r}}},YT=or("species"),Gv=fr.get,qT=fr.set,JT=fr.getterFor("Promise"),jn=GT,jv=Ve.TypeError,fp=Ve.document,Hu=Ve.process,zT=Lo("inspectSource"),Ka=(Ki("fetch"),Gu.f),XT=Ka,nl=Ao(Hu)=="process",ZT=!!(fp&&fp.createEvent&&Ve.dispatchEvent),Ku=La("Promise",function(){if(zT(jn)===String(jn)&&(ku===66||!nl&&typeof PromiseRejectionEvent!="function")||!jn.prototype.finally)return!0;if(51<=ku&&/native code/.test(jn))return!1;var i=jn.resolve(1),r=function(s){s(function(){},function(){})};return(i.constructor={})[YT]=r,!(i.then(function(){})instanceof r)}),$T=Ku||!Rv(function(i){jn.all(i).catch(function(){})}),Hv=function(i){var r;return!(!Ht(i)||typeof(r=i.then)!="function")&&r},gp=function(i,r,s){if(!r.notified){r.notified=!0;var c=r.reactions;Vv(function(){for(var u=r.value,h=r.state==1,A=0;c.length>A;){var f,m,I,E=c[A++],_=h?E.ok:E.fail,S=E.resolve,N=E.reject,k=E.domain;try{_?(h||(r.rejection===2&&tR(i,r),r.rejection=1),_===!0?f=u:(k&&k.enter(),f=_(u),k&&(k.exit(),I=!0)),f===E.promise?N(jv("Promise-chain cycle")):(m=Hv(f))?m.call(f,S,N):S(f)):N(u)}catch(B){k&&!I&&k.exit(),N(B)}}r.reactions=[],r.notified=!1,s&&!r.rejection&&eR(i,r)})}},Kv=function(i,r,s){var c,u;ZT?((c=fp.createEvent("Event")).promise=r,c.reason=s,c.initEvent(i,!1,!0),Ve.dispatchEvent(c)):c={promise:r,reason:s},(u=Ve["on"+i])?u(c):i==="unhandledrejection"&&function(h,A){var f=Ve.console;f&&f.error&&(arguments.length===1?f.error(h):f.error(h,A))}("Unhandled promise rejection",s)},eR=function(i,r){up.call(Ve,function(){var s,c=r.value;if(r.rejection!==1&&!r.parent&&(s=ju(function(){nl?Hu.emit("unhandledRejection",c,i):Kv("unhandledrejection",i,c)}),r.rejection=nl||r.rejection!==1&&!r.parent?2:1,s.error))throw s.value})},tR=function(i,r){up.call(Ve,function(){nl?Hu.emit("rejectionHandled",i):Kv("rejectionhandled",i,r.value)})},Wa=function(i,r,s,c){return function(u){i(r,s,u,c)}},Ya=function(i,r,s,c){r.done||(r.done=!0,c&&(r=c),r.value=s,r.state=2,gp(i,r,!0))},mp=function(i,r,s,c){if(!r.done){r.done=!0,c&&(r=c);try{if(i===s)throw jv("Promise can't be resolved itself");var u=Hv(s);u?Vv(function(){var h={done:!1};try{u.call(s,Wa(mp,i,h,r),Wa(Ya,i,h,r))}catch(A){Ya(i,h,A,r)}}):(r.value=s,r.state=1,gp(i,r,!1))}catch(h){Ya(i,{done:!1},h,r)}}};Ku&&(jn=function(i){Fa(this,jn,"Promise"),ji(i),pp.call(this);var r=Gv(this);try{i(Wa(mp,this,r),Wa(Ya,this,r))}catch(s){Ya(this,r,s)}},(pp=function(i){qT(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=js(jn.prototype,{then:function(i,r){var s=JT(this),c=Ka(wv(this,jn));return c.ok=typeof i!="function"||i,c.fail=typeof r=="function"&&r,c.domain=nl?Hu.domain:void 0,s.parent=!0,s.reactions.push(c),s.state!=0&&gp(this,s,!1),c.promise},catch:function(i){return this.then(void 0,i)}}),Fv=function(){var i=new pp,r=Gv(i);this.promise=i,this.resolve=Wa(mp,i,r),this.reject=Wa(Ya,i,r)},Gu.f=Ka=function(i){return i===jn||i===Wv?new Fv(i):XT(i)}),Fe({global:!0,wrap:!0,forced:Ku},{Promise:jn}),Fs(jn,"Promise",!1,!0),rv("Promise");var Wv=Ki("Promise");Fe({target:"Promise",stat:!0,forced:Ku},{reject:function(i){var r=Ka(this);return r.reject.call(void 0,i),r.promise}}),Fe({target:"Promise",stat:!0,forced:!0},{resolve:function(i){return Ap(this===Wv?jn:this,i)}}),Fe({target:"Promise",stat:!0,forced:$T},{all:function(i){var r=this,s=Ka(r),c=s.resolve,u=s.reject,h=ju(function(){var A=ji(r.resolve),f=[],m=0,I=1;Ua(i,function(E){var _=m++,S=!1;f.push(void 0),I++,A.call(r,E).then(function(N){S||(S=!0,f[_]=N,--I||c(f))},u)}),--I||c(f)});return h.error&&u(h.value),s.promise},race:function(i){var r=this,s=Ka(r),c=s.reject,u=ju(function(){var h=ji(r.resolve);Ua(i,function(A){h.call(r,A).then(s.resolve,c)})});return u.error&&c(u.value),s.promise}}),Fe({target:"Promise",stat:!0},{allSettled:function(i){var r=this,s=Gu.f(r),c=s.resolve,u=s.reject,h=ju(function(){var A=ji(r.resolve),f=[],m=0,I=1;Ua(i,function(E){var _=m++,S=!1;f.push(void 0),I++,A.call(r,E).then(function(N){S||(S=!0,f[_]={status:"fulfilled",value:N},--I||c(f))},function(N){S||(S=!0,f[_]={status:"rejected",reason:N},--I||c(f))})}),--I||c(f)});return h.error&&u(h.value),s.promise}}),Fe({target:"Promise",proto:!0,real:!0},{finally:function(i){var r=wv(this,Ki("Promise")),s=typeof i=="function";return this.then(s?function(c){return Ap(r,i()).then(function(){return c})}:i,s?function(c){return Ap(r,i()).then(function(){throw c})}:i)}});var ce=Bt.Promise;Fe({target:"Array",proto:!0,forced:!zc("map")},{map:function(i){return $S(this,i,1<arguments.length?arguments[1]:void 0)}});var rR=sr("Array").map,Yv=Array.prototype,Ie=function(i){var r=i.map;return i===Yv||i instanceof Array&&r===Yv.map?rR:r},nR=Math.max,iR=Math.min;Fe({target:"Array",proto:!0,forced:!zc("splice")},{splice:function(i,r){var s,c,u,h,A=Ri(this),f=si(A.length),m=Gs(i,f),I=arguments.length;if(I===0?s=c=0:I===1?(s=0,c=f-m):(s=I-2,c=iR(nR(qc(r),0),f-m)),9007199254740991<f+s-c)throw TypeError("Maximum allowed length exceeded");for(I=Vh(A,c),u=0;u<c;u++)(h=m+u)in A&&Us(I,u,A[h]);if(I.length=c,s<c){for(u=m;u<f-c;u++){var E=u+s;(h=u+c)in A?A[E]=A[h]:delete A[E]}for(u=f;u>f-c+s;u--)delete A[u-1]}else if(s>c)for(u=f-c;u>m;u--)E=u+s-1,(h=u+c-1)in A?A[E]=A[h]:delete A[E];for(u=0;u<s;u++)A[u+m]=arguments[u+2];return A.length=f-c+s,I}});var oR=sr("Array").splice,qv=Array.prototype,Gr=function(i){var r=i.splice;return i===qv||i instanceof Array&&r===qv.splice?oR:r},Jv=[].indexOf,zv=!!Jv&&0>1/[1].indexOf(1,-0),sR=Hs("indexOf");Fe({target:"Array",proto:!0,forced:zv||sR},{indexOf:function(i){return zv?Jv.apply(this,arguments)||0:Wm(this,i,1<arguments.length?arguments[1]:void 0)}});var aR=sr("Array").indexOf,Xv=Array.prototype,Ge=function(i){var r=i.indexOf;return i===Xv||i instanceof Array&&r===Xv.indexOf?aR:r},cR=or("species"),lR=[].slice,uR=Math.max;Fe({target:"Array",proto:!0,forced:!zc("slice")},{slice:function(i,r){var s,c=oi(this),u=si(c.length);if(i=Gs(i,u),r=Gs(r===void 0?u:r,u),xs(c)&&(typeof(s=c.constructor)!="function"||s!==Array&&!xs(s.prototype)?Ht(s)&&(s=s[cR])===null&&(s=void 0):s=void 0,s===Array||s===void 0))return lR.call(c,i,r);for(s=new(s===void 0?Array:s)(uR(r-i,0)),u=0;i<r;i++,u++)i in c&&Us(s,u,c[i]);return s.length=u,s}});var dR=sr("Array").slice,Zv=Array.prototype,Mr=function(i){var r=i.slice;return i===Zv||i instanceof Array&&r===Zv.slice?dR:r},$v=!0;"find"in[]&&Array(1).find(function(){$v=!1}),Fe({target:"Array",proto:!0,forced:$v},{find:function(i){return Um(this,i,1<arguments.length?arguments[1]:void 0)}});var hR=sr("Array").find,eE=Array.prototype,Je=function(i){var r=i.find;return i===eE||i instanceof Array&&r===eE.find?hR:r},tE=[].slice,vp={};Fe({target:"Function",proto:!0},{bind:Function.bind||function(i){var r=ji(this),s=tE.call(arguments,1),c=function(){var u=s.concat(tE.call(arguments));if(this instanceof c){var h=u.length;if(!(h in vp)){for(var A=[],f=0;f<h;f++)A[f]="a["+f+"]";vp[h]=Function("C,a","return new C("+A.join(",")+")")}u=vp[h](r,u)}else u=r.apply(i,u);return u};return Ht(r.prototype)&&(c.prototype=r.prototype),c}});var pR=sr("Function").bind,rE=Function.prototype,cr=function(i){var r=i.bind;return i===rE||i instanceof Function&&r===rE.bind?pR:r};Fe({target:"Array",proto:!0},{includes:function(i){return pT(this,i,1<arguments.length?arguments[1]:void 0)}});var AR=sr("Array").includes;Fe({target:"String",proto:!0,forced:!ep("includes")},{includes:function(i){return!!~String(Qs(this)).indexOf($h(i),1<arguments.length?arguments[1]:void 0)}});var fR=sr("String").includes,nE=Array.prototype,iE=String.prototype,gt=function(i){var r=i.includes;return i===nE||i instanceof Array&&r===nE.includes?AR:typeof i=="string"||i===iE||i instanceof String&&r===iE.includes?fR:r};Fe({target:"Array",proto:!0,forced:Hs("some")},{some:function(i){return tT(this,i,1<arguments.length?arguments[1]:void 0)}});var gR=sr("Array").some,oE=Array.prototype,sE=function(i){var r=i.some;return i===oE||i instanceof Array&&r===oE.some?gR:r};let aE=p;var cE=Object.freeze({__proto__:null,shimMediaStream:O,shimOnTrack:M,shimGetSendersWithDtmf:x,shimGetStats:G,shimSenderReceiverGetStats:K,shimAddTrackRemoveTrackWithNative:F,shimAddTrackRemoveTrack:re,shimPeerConnection:Q,fixNegotiationNeeded:Ae,shimGetUserMedia:w,shimGetDisplayMedia:function(i,r){i.navigator.mediaDevices&&"getDisplayMedia"in i.navigator.mediaDevices||i.navigator.mediaDevices&&(typeof r=="function"?i.navigator.mediaDevices.getDisplayMedia=function(s){return r(s).then(c=>{let u=s.video&&s.video.width,h=s.video&&s.video.height;return s.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:c,maxFrameRate:s.video&&s.video.frameRate||3}},u&&(s.video.mandatory.maxWidth=u),h&&(s.video.mandatory.maxHeight=h),i.navigator.mediaDevices.getUserMedia(s)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}}),lE="".startsWith,mR=Math.min,vR=ep("startsWith");Fe({target:"String",proto:!0,forced:!vR},{startsWith:function(i){var r=String(Qs(this));$h(i);var s=si(mR(1<arguments.length?arguments[1]:void 0,r.length)),c=String(i);return lE?lE.call(r,c,s):r.slice(s,s+c.length)===c}});var ER=sr("String").startsWith,uE=String.prototype,il=function(i){var r=i.startsWith;return typeof i=="string"||i===uE||i instanceof String&&r===uE.startsWith?ER:r};Fe({target:"String",proto:!0,forced:ir(function(){return`	
\v\f\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF`.trim.name!=="trim"})},{trim:function(){return gv(this)}});var IR=sr("String").trim,dE=String.prototype,Ws=function(i){var r=i.trim;return typeof i=="string"||i===dE||i instanceof String&&r===dE.trim?IR:r},xe=t(function(i){var r={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};r.localCName=r.generateIdentifier(),r.splitLines=function(s){var c;return Ie(c=Ws(s).call(s).split(`
`)).call(c,function(u){return Ws(u).call(u)})},r.splitSections=function(s){return s=s.split(`
m=`),Ie(s).call(s,function(c,u){var h;return Ws(h=0<u?"m="+c:c).call(h)+`\r
`})},r.getDescription=function(s){return(s=r.splitSections(s))&&s[0]},r.getMediaSections=function(s){return s=r.splitSections(s),s.shift(),s},r.matchPrefix=function(s,c){var u;return Qe(u=r.splitLines(s)).call(u,function(h){return Ge(h).call(h,c)===0})},r.parseCandidate=function(s){var c;s={foundation:(c=Ge(s).call(s,"a=candidate:")===0?s.substring(12).split(" "):s.substring(10).split(" "))[0],component:ar(c[1],10),protocol:c[2].toLowerCase(),priority:ar(c[3],10),ip:c[4],address:c[4],port:ar(c[5],10),type:c[7]};for(var u=8;u<c.length;u+=2)switch(c[u]){case"raddr":s.relatedAddress=c[u+1];break;case"rport":s.relatedPort=ar(c[u+1],10);break;case"tcptype":s.tcpType=c[u+1];break;case"ufrag":s.ufrag=c[u+1],s.usernameFragment=c[u+1];break;default:s[c[u]]=c[u+1]}return s},r.writeCandidate=function(s){var c=[];c.push(s.foundation),c.push(s.component),c.push(s.protocol.toUpperCase()),c.push(s.priority),c.push(s.address||s.ip),c.push(s.port);var u=s.type;return c.push("typ"),c.push(u),u!=="host"&&s.relatedAddress&&s.relatedPort&&(c.push("raddr"),c.push(s.relatedAddress),c.push("rport"),c.push(s.relatedPort)),s.tcpType&&s.protocol.toLowerCase()==="tcp"&&(c.push("tcptype"),c.push(s.tcpType)),(s.usernameFragment||s.ufrag)&&(c.push("ufrag"),c.push(s.usernameFragment||s.ufrag)),"candidate:"+c.join(" ")},r.parseIceOptions=function(s){return s.substr(14).split(" ")},r.parseRtpMap=function(s){s=s.substr(9).split(" ");var c={payloadType:ar(s.shift(),10)};return s=s[0].split("/"),c.name=s[0],c.clockRate=ar(s[1],10),c.channels=s.length===3?ar(s[2],10):1,c.numChannels=c.channels,c},r.writeRtpMap=function(s){var c=s.payloadType;s.preferredPayloadType!==void 0&&(c=s.preferredPayloadType);var u=s.channels||s.numChannels||1;return"a=rtpmap:"+c+" "+s.name+"/"+s.clockRate+(u!==1?"/"+u:"")+`\r
`},r.parseExtmap=function(s){var c;return s=s.substr(9).split(" "),{id:ar(s[0],10),direction:0<Ge(c=s[0]).call(c,"/")?s[0].split("/")[1]:"sendrecv",uri:s[1]}},r.writeExtmap=function(s){return"a=extmap:"+(s.id||s.preferredId)+(s.direction&&s.direction!=="sendrecv"?"/"+s.direction:"")+" "+s.uri+`\r
`},r.parseFmtp=function(s){for(var c={},u=s.substr(Ge(s).call(s," ")+1).split(";"),h=0;h<u.length;h++){var A,f;s=Ws(A=u[h]).call(A).split("="),c[Ws(f=s[0]).call(f)]=s[1]}return c},r.writeFmtp=function(s){var c="",u=s.payloadType;if(s.preferredPayloadType!==void 0&&(u=s.preferredPayloadType),s.parameters&&dt(s.parameters).length){var h,A=[];W(h=dt(s.parameters)).call(h,function(f){s.parameters[f]?A.push(f+"="+s.parameters[f]):A.push(f)}),c+="a=fmtp:"+u+" "+A.join(";")+`\r
`}return c},r.parseRtcpFb=function(s){return s=s.substr(Ge(s).call(s," ")+1).split(" "),{type:s.shift(),parameter:s.join(" ")}},r.writeRtcpFb=function(s){var c,u="",h=s.payloadType;return s.preferredPayloadType!==void 0&&(h=s.preferredPayloadType),s.rtcpFeedback&&s.rtcpFeedback.length&&W(c=s.rtcpFeedback).call(c,function(A){u+="a=rtcp-fb:"+h+" "+A.type+(A.parameter&&A.parameter.length?" "+A.parameter:"")+`\r
`}),u},r.parseSsrcMedia=function(s){var c=Ge(s).call(s," "),u={ssrc:ar(s.substr(7,c-7),10)},h=Ge(s).call(s,":",c);return-1<h?(u.attribute=s.substr(c+1,h-c-1),u.value=s.substr(h+1)):u.attribute=s.substr(c+1),u},r.parseSsrcGroup=function(s){return s=s.substr(13).split(" "),{semantics:s.shift(),ssrcs:Ie(s).call(s,function(c){return ar(c,10)})}},r.getMid=function(s){if(s=r.matchPrefix(s,"a=mid:")[0])return s.substr(6)},r.parseFingerprint=function(s){return s=s.substr(14).split(" "),{algorithm:s[0].toLowerCase(),value:s[1]}},r.getDtlsParameters=function(s,c){return s=r.matchPrefix(s+c,"a=fingerprint:"),{role:"auto",fingerprints:Ie(s).call(s,r.parseFingerprint)}},r.writeDtlsParameters=function(s,c){var u,h="a=setup:"+c+`\r
`;return W(u=s.fingerprints).call(u,function(A){h+="a=fingerprint:"+A.algorithm+" "+A.value+`\r
`}),h},r.getIceParameters=function(s,c){return s=r.splitLines(s),s=b(s).call(s,r.splitLines(c)),{usernameFragment:Qe(s).call(s,function(u){return Ge(u).call(u,"a=ice-ufrag:")===0})[0].substr(12),password:Qe(s).call(s,function(u){return Ge(u).call(u,"a=ice-pwd:")===0})[0].substr(10)}},r.writeIceParameters=function(s){return"a=ice-ufrag:"+s.usernameFragment+`\r
a=ice-pwd:`+s.password+`\r
`},r.parseRtpParameters=function(s){for(var c,u={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},h=r.splitLines(s)[0].split(" "),A=3;A<h.length;A++){var f=h[A],m=r.matchPrefix(s,"a=rtpmap:"+f+" ")[0];if(m){var I;m=r.parseRtpMap(m);var E=r.matchPrefix(s,"a=fmtp:"+f+" ");switch(m.parameters=E.length?r.parseFmtp(E[0]):{},m.rtcpFeedback=Ie(I=r.matchPrefix(s,"a=rtcp-fb:"+f+" ")).call(I,r.parseRtcpFb),u.codecs.push(m),m.name.toUpperCase()){case"RED":case"ULPFEC":u.fecMechanisms.push(m.name.toUpperCase())}}}return W(c=r.matchPrefix(s,"a=extmap:")).call(c,function(_){u.headerExtensions.push(r.parseExtmap(_))}),u},r.writeRtpDescription=function(s,c){var u,h,A,f="";f+="m="+s+" ",f+=0<c.codecs.length?"9":"0",f+=" UDP/TLS/RTP/SAVPF ",f+=Ie(u=c.codecs).call(u,function(E){return E.preferredPayloadType!==void 0?E.preferredPayloadType:E.payloadType}).join(" ")+`\r
`,f+=`c=IN IP4 0.0.0.0\r
`,f+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,W(h=c.codecs).call(h,function(E){f+=r.writeRtpMap(E),f+=r.writeFmtp(E),f+=r.writeRtcpFb(E)});var m,I=0;return W(A=c.codecs).call(A,function(E){E.maxptime>I&&(I=E.maxptime)}),0<I&&(f+="a=maxptime:"+I+`\r
`),f+=`a=rtcp-mux\r
`,c.headerExtensions&&W(m=c.headerExtensions).call(m,function(E){f+=r.writeExtmap(E)}),f},r.parseRtpEncodingParameters=function(s){var c,u,h,A,f,m,I,E=[],_=r.parseRtpParameters(s),S=Ge(c=_.fecMechanisms).call(c,"RED")!==-1,N=Ge(u=_.fecMechanisms).call(u,"ULPFEC")!==-1;c=Qe(h=Ie(A=r.matchPrefix(s,"a=ssrc:")).call(A,function(se){return r.parseSsrcMedia(se)})).call(h,function(se){return se.attribute==="cname"});var k=0<c.length&&c[0].ssrc;h=Ie(f=r.matchPrefix(s,"a=ssrc-group:FID")).call(f,function(se){return se=se.substr(17).split(" "),Ie(se).call(se,function(ge){return ar(ge,10)})}),0<h.length&&1<h[0].length&&h[0][0]===k&&(I=h[0][1]),W(m=_.codecs).call(m,function(se){se.name.toUpperCase()==="RTX"&&se.parameters.apt&&(se={ssrc:k,codecPayloadType:ar(se.parameters.apt,10)},k&&I&&(se.rtx={ssrc:I}),E.push(se),S&&((se=JSON.parse(fe(se))).fec={ssrc:k,mechanism:N?"red+ulpfec":"red"},E.push(se)))}),E.length===0&&k&&E.push({ssrc:k});var B,P,J=r.matchPrefix(s,"b=");return J.length&&(J=Ge(B=J[0]).call(B,"b=TIAS:")===0?ar(J[0].substr(7),10):Ge(P=J[0]).call(P,"b=AS:")===0?950*ar(J[0].substr(5),10)-16e3:void 0,W(E).call(E,function(se){se.maxBitrate=J})),E},r.parseRtcpParameters=function(s){var c,u,h={},A=Qe(c=Ie(u=r.matchPrefix(s,"a=ssrc:")).call(u,function(f){return r.parseSsrcMedia(f)})).call(c,function(f){return f.attribute==="cname"})[0];return A&&(h.cname=A.value,h.ssrc=A.ssrc),c=r.matchPrefix(s,"a=rtcp-rsize"),h.reducedSize=0<c.length,h.compound=c.length===0,s=r.matchPrefix(s,"a=rtcp-mux"),h.mux=0<s.length,h},r.parseMsid=function(s){var c,u,h,A=r.matchPrefix(s,"a=msid:");return A.length===1?{stream:(h=A[0].substr(7).split(" "))[0],track:h[1]}:(s=Qe(c=Ie(u=r.matchPrefix(s,"a=ssrc:")).call(u,function(f){return r.parseSsrcMedia(f)})).call(c,function(f){return f.attribute==="msid"}),0<s.length?{stream:(h=s[0].value.split(" "))[0],track:h[1]}:void 0)},r.generateSessionId=function(){return Math.random().toString().substr(2,21)},r.writeSessionBoilerplate=function(s,c,u){return c=c!==void 0?c:2,`v=0\r
o=`+(u||"thisisadapterortc")+" "+(s||r.generateSessionId())+" "+c+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},r.writeMediaSection=function(s,c,u,h){return c=r.writeRtpDescription(s.kind,c),c+=r.writeIceParameters(s.iceGatherer.getLocalParameters()),c+=r.writeDtlsParameters(s.dtlsTransport.getLocalParameters(),u==="offer"?"actpass":"active"),c+="a=mid:"+s.mid+`\r
`,s.direction?c+="a="+s.direction+`\r
`:s.rtpSender&&s.rtpReceiver?c+=`a=sendrecv\r
`:s.rtpSender?c+=`a=sendonly\r
`:s.rtpReceiver?c+=`a=recvonly\r
`:c+=`a=inactive\r
`,s.rtpSender&&(u="msid:"+h.id+" "+s.rtpSender.track.id+`\r
`,c=c+("a="+u)+("a=ssrc:"+s.sendEncodingParameters[0].ssrc+" "+u),s.sendEncodingParameters[0].rtx&&(c+="a=ssrc:"+s.sendEncodingParameters[0].rtx.ssrc+" "+u,c+="a=ssrc-group:FID "+s.sendEncodingParameters[0].ssrc+" "+s.sendEncodingParameters[0].rtx.ssrc+`\r
`)),c+="a=ssrc:"+s.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+`\r
`,s.rtpSender&&s.sendEncodingParameters[0].rtx&&(c+="a=ssrc:"+s.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+`\r
`),c},r.getDirection=function(s,c){s=r.splitLines(s);for(var u=0;u<s.length;u++)switch(s[u]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return s[u].substr(2)}return c?r.getDirection(c):"sendrecv"},r.getKind=function(s){return r.splitLines(s)[0].split(" ")[0].substr(2)},r.isRejected=function(s){return s.split(" ",2)[1]==="0"},r.parseMLine=function(s){return s=r.splitLines(s)[0].substr(2).split(" "),{kind:s[0],port:ar(s[1],10),protocol:s[2],fmt:Mr(s).call(s,3).join(" ")}},r.parseOLine=function(s){return s=r.matchPrefix(s,"o=")[0].substr(2).split(" "),{username:s[0],sessionId:s[1],sessionVersion:ar(s[2],10),netType:s[3],addressType:s[4],address:s[5]}},r.isValidSDP=function(s){if(typeof s!="string"||s.length===0)return!1;s=r.splitLines(s);for(var c=0;c<s.length;c++)if(2>s[c].length||s[c].charAt(1)!=="=")return!1;return!0},i.exports=r}),CR=function(i,r){function s(A,f){f.addTrack(A),f.dispatchEvent(new i.MediaStreamTrackEvent("addtrack",{track:A}))}function c(A,f,m,I){var E=new Event("track");E.track=f,E.receiver=m,E.transceiver={receiver:m},E.streams=I,i.setTimeout(function(){A._dispatchEvent("track",E)})}var u=function(A){var f=this,m=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(E){f[E]=m[E].bind(m)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",A=JSON.parse(JSON.stringify(A||{})),this.usingBundle=A.bundlePolicy==="max-bundle",A.rtcpMuxPolicy==="negotiate")throw Oe("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(A.rtcpMuxPolicy||(A.rtcpMuxPolicy="require"),A.iceTransportPolicy){case"all":case"relay":break;default:A.iceTransportPolicy="all"}switch(A.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:A.bundlePolicy="balanced"}if(A.iceServers=function(E,_){var S=!1;return(E=JSON.parse(JSON.stringify(E))).filter(function(N){if(N&&(N.urls||N.url)){var k=N.urls||N.url;N.url&&!N.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var B=typeof k=="string";return B&&(k=[k]),k=k.filter(function(P){return P.indexOf("turn:")!==0||P.indexOf("transport=udp")===-1||P.indexOf("turn:[")!==-1||S?P.indexOf("stun:")===0&&14393<=_&&P.indexOf("?transport=udp")===-1:(S=!0,!0)}),delete N.url,N.urls=B?k[0]:k,!!k.length}})}(A.iceServers||[],r),this._iceGatherers=[],A.iceCandidatePoolSize)for(var I=A.iceCandidatePoolSize;0<I;I--)this._iceGatherers.push(new i.RTCIceGatherer({iceServers:A.iceServers,gatherPolicy:A.iceTransportPolicy}));else A.iceCandidatePoolSize=0;this._config=A,this.transceivers=[],this._sdpSessionId=xe.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(u.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(u.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),u.prototype.onicecandidate=null,u.prototype.onaddstream=null,u.prototype.ontrack=null,u.prototype.onremovestream=null,u.prototype.onsignalingstatechange=null,u.prototype.oniceconnectionstatechange=null,u.prototype.onconnectionstatechange=null,u.prototype.onicegatheringstatechange=null,u.prototype.onnegotiationneeded=null,u.prototype.ondatachannel=null,u.prototype._dispatchEvent=function(A,f){this._isClosed||(this.dispatchEvent(f),typeof this["on"+A]=="function"&&this["on"+A](f))},u.prototype._emitGatheringStateChange=function(){var A=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",A)},u.prototype.getConfiguration=function(){return this._config},u.prototype.getLocalStreams=function(){return this.localStreams},u.prototype.getRemoteStreams=function(){return this.remoteStreams},u.prototype._createTransceiver=function(A,f){var m=0<this.transceivers.length;return A={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:A,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0},this.usingBundle&&m?(A.iceTransport=this.transceivers[0].iceTransport,A.dtlsTransport=this.transceivers[0].dtlsTransport):(m=this._createIceAndDtlsTransports(),A.iceTransport=m.iceTransport,A.dtlsTransport=m.dtlsTransport),f||this.transceivers.push(A),A},u.prototype.addTrack=function(A,f){if(this._isClosed)throw Oe("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var m;if(this.transceivers.find(function(E){return E.track===A}))throw Oe("InvalidAccessError","Track already exists.");for(var I=0;I<this.transceivers.length;I++)this.transceivers[I].track||this.transceivers[I].kind!==A.kind||(m=this.transceivers[I]);return m||(m=this._createTransceiver(A.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(f)===-1&&this.localStreams.push(f),m.track=A,m.stream=f,m.rtpSender=new i.RTCRtpSender(A,m.dtlsTransport),m.rtpSender},u.prototype.addStream=function(A){var f=this;if(15025<=r)A.getTracks().forEach(function(I){f.addTrack(I,A)});else{var m=A.clone();A.getTracks().forEach(function(I,E){var _=m.getTracks()[E];I.addEventListener("enabled",function(S){_.enabled=S.enabled})}),m.getTracks().forEach(function(I){f.addTrack(I,m)})}},u.prototype.removeTrack=function(A){if(this._isClosed)throw Oe("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(A instanceof i.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var f=this.transceivers.find(function(I){return I.rtpSender===A});if(!f)throw Oe("InvalidAccessError","Sender was not created by this connection.");var m=f.stream;f.rtpSender.stop(),f.rtpSender=null,f.track=null,f.stream=null,this.transceivers.map(function(I){return I.stream}).indexOf(m)===-1&&-1<this.localStreams.indexOf(m)&&this.localStreams.splice(this.localStreams.indexOf(m),1),this._maybeFireNegotiationNeeded()},u.prototype.removeStream=function(A){var f=this;A.getTracks().forEach(function(m){var I=f.getSenders().find(function(E){return E.track===m});I&&f.removeTrack(I)})},u.prototype.getSenders=function(){return this.transceivers.filter(function(A){return!!A.rtpSender}).map(function(A){return A.rtpSender})},u.prototype.getReceivers=function(){return this.transceivers.filter(function(A){return!!A.rtpReceiver}).map(function(A){return A.rtpReceiver})},u.prototype._createIceGatherer=function(A,f){var m=this;if(f&&0<A)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var I=new i.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(I,"state",{value:"new",writable:!0}),this.transceivers[A].bufferedCandidateEvents=[],this.transceivers[A].bufferCandidates=function(E){var _=!E.candidate||Object.keys(E.candidate).length===0;I.state=_?"completed":"gathering",m.transceivers[A].bufferedCandidateEvents!==null&&m.transceivers[A].bufferedCandidateEvents.push(E)},I.addEventListener("localcandidate",this.transceivers[A].bufferCandidates),I},u.prototype._gather=function(A,f){var m=this,I=this.transceivers[f].iceGatherer;if(!I.onlocalcandidate){var E=this.transceivers[f].bufferedCandidateEvents;this.transceivers[f].bufferedCandidateEvents=null,I.removeEventListener("localcandidate",this.transceivers[f].bufferCandidates),I.onlocalcandidate=function(_){if(!(m.usingBundle&&0<f)){var S=new Event("icecandidate");S.candidate={sdpMid:A,sdpMLineIndex:f};var N=_.candidate;(_=!N||Object.keys(N).length===0)?I.state!=="new"&&I.state!=="gathering"||(I.state="completed"):(I.state==="new"&&(I.state="gathering"),N.component=1,N.ufrag=I.getLocalParameters().usernameFragment,N=xe.writeCandidate(N),S.candidate=Object.assign(S.candidate,xe.parseCandidate(N)),S.candidate.candidate=N,S.candidate.toJSON=function(){return{candidate:S.candidate.candidate,sdpMid:S.candidate.sdpMid,sdpMLineIndex:S.candidate.sdpMLineIndex,usernameFragment:S.candidate.usernameFragment}}),N=xe.getMediaSections(m._localDescription.sdp),N[S.candidate.sdpMLineIndex]+=_?`a=end-of-candidates\r
`:"a="+S.candidate.candidate+`\r
`,m._localDescription.sdp=xe.getDescription(m._localDescription.sdp)+N.join(""),N=m.transceivers.every(function(k){return k.iceGatherer&&k.iceGatherer.state==="completed"}),m.iceGatheringState!=="gathering"&&(m.iceGatheringState="gathering",m._emitGatheringStateChange()),_||m._dispatchEvent("icecandidate",S),N&&(m._dispatchEvent("icecandidate",new Event("icecandidate")),m.iceGatheringState="complete",m._emitGatheringStateChange())}},i.setTimeout(function(){E.forEach(function(_){I.onlocalcandidate(_)})},0)}},u.prototype._createIceAndDtlsTransports=function(){var A=this,f=new i.RTCIceTransport(null);f.onicestatechange=function(){A._updateIceConnectionState(),A._updateConnectionState()};var m=new i.RTCDtlsTransport(f);return m.ondtlsstatechange=function(){A._updateConnectionState()},m.onerror=function(){Object.defineProperty(m,"state",{value:"failed",writable:!0}),A._updateConnectionState()},{iceTransport:f,dtlsTransport:m}},u.prototype._disposeIceAndDtlsTransports=function(A){var f=this.transceivers[A].iceGatherer;f&&(delete f.onlocalcandidate,delete this.transceivers[A].iceGatherer),(f=this.transceivers[A].iceTransport)&&(delete f.onicestatechange,delete this.transceivers[A].iceTransport),(f=this.transceivers[A].dtlsTransport)&&(delete f.ondtlsstatechange,delete f.onerror,delete this.transceivers[A].dtlsTransport)},u.prototype._transceive=function(A,f,m){var I=Te(A.localCapabilities,A.remoteCapabilities);f&&A.rtpSender&&(I.encodings=A.sendEncodingParameters,I.rtcp={cname:xe.localCName,compound:A.rtcpParameters.compound},A.recvEncodingParameters.length&&(I.rtcp.ssrc=A.recvEncodingParameters[0].ssrc),A.rtpSender.send(I)),m&&A.rtpReceiver&&0<I.codecs.length&&(A.kind==="video"&&A.recvEncodingParameters&&15019>r&&A.recvEncodingParameters.forEach(function(E){delete E.rtx}),A.recvEncodingParameters.length?I.encodings=A.recvEncodingParameters:I.encodings=[{}],I.rtcp={compound:A.rtcpParameters.compound},A.rtcpParameters.cname&&(I.rtcp.cname=A.rtcpParameters.cname),A.sendEncodingParameters.length&&(I.rtcp.ssrc=A.sendEncodingParameters[0].ssrc),A.rtpReceiver.receive(I))},u.prototype.setLocalDescription=function(A){var f=this;if(["offer","answer"].indexOf(A.type)===-1)return Promise.reject(Oe("TypeError",'Unsupported type "'+A.type+'"'));if(!je("setLocalDescription",A.type,f.signalingState)||f._isClosed)return Promise.reject(Oe("InvalidStateError","Can not set local "+A.type+" in state "+f.signalingState));if(A.type==="offer"){var m=xe.splitSections(A.sdp),I=m.shift();m.forEach(function(_,S){_=xe.parseRtpParameters(_),f.transceivers[S].localCapabilities=_}),f.transceivers.forEach(function(_,S){f._gather(_.mid,S)})}else if(A.type==="answer"){m=xe.splitSections(f._remoteDescription.sdp),I=m.shift();var E=0<xe.matchPrefix(I,"a=ice-lite").length;m.forEach(function(_,S){var N=f.transceivers[S],k=N.iceGatherer,B=N.iceTransport,P=N.dtlsTransport,J=N.localCapabilities,se=N.remoteCapabilities;if(!(xe.isRejected(_)&&xe.matchPrefix(_,"a=bundle-only").length===0||N.rejected)){var ge=xe.getIceParameters(_,I);_=xe.getDtlsParameters(_,I),E&&(_.role="server"),f.usingBundle&&S!==0||(f._gather(N.mid,S),B.state==="new"&&B.start(k,ge,E?"controlling":"controlled"),P.state==="new"&&P.start(_)),S=Te(J,se),f._transceive(N,0<S.codecs.length,!1)}})}return f._localDescription={type:A.type,sdp:A.sdp},A.type==="offer"?f._updateSignalingState("have-local-offer"):f._updateSignalingState("stable"),Promise.resolve()},u.prototype.setRemoteDescription=function(A){var f=this;if(["offer","answer"].indexOf(A.type)===-1)return Promise.reject(Oe("TypeError",'Unsupported type "'+A.type+'"'));if(!je("setRemoteDescription",A.type,f.signalingState)||f._isClosed)return Promise.reject(Oe("InvalidStateError","Can not set remote "+A.type+" in state "+f.signalingState));var m={};f.remoteStreams.forEach(function(B){m[B.id]=B});var I=[],E=xe.splitSections(A.sdp),_=E.shift(),S=0<xe.matchPrefix(_,"a=ice-lite").length,N=0<xe.matchPrefix(_,"a=group:BUNDLE ").length;f.usingBundle=N;var k=xe.matchPrefix(_,"a=ice-options:")[0];return f.canTrickleIceCandidates=!!k&&0<=k.substr(14).split(" ").indexOf("trickle"),E.forEach(function(B,P){var J=xe.splitLines(B),se=xe.getKind(B),ge=xe.isRejected(B)&&xe.matchPrefix(B,"a=bundle-only").length===0,Le=J[0].substr(2).split(" ")[2];J=xe.getDirection(B,_);var Be=xe.parseMsid(B),yt=xe.getMid(B)||xe.generateIdentifier();if(ge||se==="application"&&(Le==="DTLS/SCTP"||Le==="UDP/DTLS/SCTP"))f.transceivers[P]={mid:yt,kind:se,protocol:Le,rejected:!0};else{var ve,Ze;!ge&&f.transceivers[P]&&f.transceivers[P].rejected&&(f.transceivers[P]=f._createTransceiver(se,!0));var vt,Wt,Nr=xe.parseRtpParameters(B);ge||(vt=xe.getIceParameters(B,_),(Wt=xe.getDtlsParameters(B,_)).role="client"),Le=xe.parseRtpEncodingParameters(B);var Pt=xe.parseRtcpParameters(B),en=0<xe.matchPrefix(B,"a=end-of-candidates",_).length;if(B=xe.matchPrefix(B,"a=candidate:").map(function(he){return xe.parseCandidate(he)}).filter(function(he){return he.component===1}),(A.type==="offer"||A.type==="answer")&&!ge&&N&&0<P&&f.transceivers[P]&&(f._disposeIceAndDtlsTransports(P),f.transceivers[P].iceGatherer=f.transceivers[0].iceGatherer,f.transceivers[P].iceTransport=f.transceivers[0].iceTransport,f.transceivers[P].dtlsTransport=f.transceivers[0].dtlsTransport,f.transceivers[P].rtpSender&&f.transceivers[P].rtpSender.setTransport(f.transceivers[0].dtlsTransport),f.transceivers[P].rtpReceiver&&f.transceivers[P].rtpReceiver.setTransport(f.transceivers[0].dtlsTransport)),A.type!=="offer"||ge){if(A.type==="answer"&&!ge){se=(ve=f.transceivers[P]).iceGatherer;var j=ve.iceTransport,q=ve.dtlsTransport,$=ve.rtpReceiver;ge=ve.sendEncodingParameters,yt=ve.localCapabilities,f.transceivers[P].recvEncodingParameters=Le,f.transceivers[P].remoteCapabilities=Nr,f.transceivers[P].rtcpParameters=Pt,B.length&&j.state==="new"&&(!S&&!en||N&&P!==0?B.forEach(function(he){We(ve.iceTransport,he)}):j.setRemoteCandidates(B)),N&&P!==0||(j.state==="new"&&j.start(se,vt,"controlling"),q.state==="new"&&q.start(Wt)),!Te(ve.localCapabilities,ve.remoteCapabilities).codecs.filter(function(he){return he.name.toLowerCase()==="rtx"}).length&&ve.sendEncodingParameters[0].rtx&&delete ve.sendEncodingParameters[0].rtx,f._transceive(ve,J==="sendrecv"||J==="recvonly",J==="sendrecv"||J==="sendonly"),!$||J!=="sendrecv"&&J!=="sendonly"?delete ve.rtpReceiver:(Ze=$.track,Be?(m[Be.stream]||(m[Be.stream]=new i.MediaStream),s(Ze,m[Be.stream]),I.push([Ze,$,m[Be.stream]])):(m.default||(m.default=new i.MediaStream),s(Ze,m.default),I.push([Ze,$,m.default])))}}else(ve=f.transceivers[P]||f._createTransceiver(se)).mid=yt,ve.iceGatherer||(ve.iceGatherer=f._createIceGatherer(P,N)),B.length&&ve.iceTransport.state==="new"&&(!en||N&&P!==0?B.forEach(function(he){We(ve.iceTransport,he)}):ve.iceTransport.setRemoteCandidates(B)),yt=i.RTCRtpReceiver.getCapabilities(se),15019>r&&(yt.codecs=yt.codecs.filter(function(he){return he.name!=="rtx"})),ge=ve.sendEncodingParameters||[{ssrc:1001*(2*P+2)}],vt=!1,J==="sendrecv"||J==="sendonly"?(vt=!ve.rtpReceiver,$=ve.rtpReceiver||new i.RTCRtpReceiver(ve.dtlsTransport,se),vt&&(Ze=$.track,Be&&Be.stream==="-"||(Be?(m[Be.stream]||(m[Be.stream]=new i.MediaStream,Object.defineProperty(m[Be.stream],"id",{get:function(){return Be.stream}})),Object.defineProperty(Ze,"id",{get:function(){return Be.track}}),j=m[Be.stream]):(m.default||(m.default=new i.MediaStream),j=m.default)),j&&(s(Ze,j),ve.associatedRemoteMediaStreams.push(j)),I.push([Ze,$,j]))):ve.rtpReceiver&&ve.rtpReceiver.track&&(ve.associatedRemoteMediaStreams.forEach(function(he){var pe=he.getTracks().find(function(Pe){return Pe.id===ve.rtpReceiver.track.id});pe&&function(Pe,_e){_e.removeTrack(Pe),_e.dispatchEvent(new i.MediaStreamTrackEvent("removetrack",{track:Pe}))}(pe,he)}),ve.associatedRemoteMediaStreams=[]),ve.localCapabilities=yt,ve.remoteCapabilities=Nr,ve.rtpReceiver=$,ve.rtcpParameters=Pt,ve.sendEncodingParameters=ge,ve.recvEncodingParameters=Le,f._transceive(f.transceivers[P],!1,vt)}}),f._dtlsRole===void 0&&(f._dtlsRole=A.type==="offer"?"active":"passive"),f._remoteDescription={type:A.type,sdp:A.sdp},A.type==="offer"?f._updateSignalingState("have-remote-offer"):f._updateSignalingState("stable"),Object.keys(m).forEach(function(B){var P=m[B];if(P.getTracks().length){if(f.remoteStreams.indexOf(P)===-1){f.remoteStreams.push(P);var J=new Event("addstream");J.stream=P,i.setTimeout(function(){f._dispatchEvent("addstream",J)})}I.forEach(function(se){var ge=se[0],Le=se[1];P.id===se[2].id&&c(f,ge,Le,[P])})}}),I.forEach(function(B){B[2]||c(f,B[0],B[1],[])}),i.setTimeout(function(){f&&f.transceivers&&f.transceivers.forEach(function(B){B.iceTransport&&B.iceTransport.state==="new"&&0<B.iceTransport.getRemoteCandidates().length&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),B.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},u.prototype.close=function(){this.transceivers.forEach(function(A){A.iceTransport&&A.iceTransport.stop(),A.dtlsTransport&&A.dtlsTransport.stop(),A.rtpSender&&A.rtpSender.stop(),A.rtpReceiver&&A.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},u.prototype._updateSignalingState=function(A){this.signalingState=A,A=new Event("signalingstatechange"),this._dispatchEvent("signalingstatechange",A)},u.prototype._maybeFireNegotiationNeeded=function(){var A=this;this.signalingState==="stable"&&this.needNegotiation!==!0&&(this.needNegotiation=!0,i.setTimeout(function(){if(A.needNegotiation){A.needNegotiation=!1;var f=new Event("negotiationneeded");A._dispatchEvent("negotiationneeded",f)}},0))},u.prototype._updateIceConnectionState=function(){var A,f={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(function(m){m.iceTransport&&!m.rejected&&f[m.iceTransport.state]++}),A="new",0<f.failed?A="failed":0<f.checking?A="checking":0<f.disconnected?A="disconnected":0<f.new?A="new":0<f.connected?A="connected":0<f.completed&&(A="completed"),A!==this.iceConnectionState&&(this.iceConnectionState=A,A=new Event("iceconnectionstatechange"),this._dispatchEvent("iceconnectionstatechange",A))},u.prototype._updateConnectionState=function(){var A,f={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(function(m){m.iceTransport&&m.dtlsTransport&&!m.rejected&&(f[m.iceTransport.state]++,f[m.dtlsTransport.state]++)}),f.connected+=f.completed,A="new",0<f.failed?A="failed":0<f.connecting?A="connecting":0<f.disconnected?A="disconnected":0<f.new?A="new":0<f.connected&&(A="connected"),A!==this.connectionState&&(this.connectionState=A,A=new Event("connectionstatechange"),this._dispatchEvent("connectionstatechange",A))},u.prototype.createOffer=function(A){var f=this;if(f._isClosed)return Promise.reject(Oe("InvalidStateError","Can not call createOffer after close"));var m=f.transceivers.filter(function(_){return _.kind==="audio"}).length,I=f.transceivers.filter(function(_){return _.kind==="video"}).length;if(A){if(A.mandatory||A.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");A.offerToReceiveAudio!==void 0&&(m=A.offerToReceiveAudio===!0?1:A.offerToReceiveAudio===!1?0:A.offerToReceiveAudio),A.offerToReceiveVideo!==void 0&&(I=A.offerToReceiveVideo===!0?1:A.offerToReceiveVideo===!1?0:A.offerToReceiveVideo)}for(f.transceivers.forEach(function(_){_.kind==="audio"?0>--m&&(_.wantReceive=!1):_.kind==="video"&&0>--I&&(_.wantReceive=!1)});0<m||0<I;)0<m&&(f._createTransceiver("audio"),m--),0<I&&(f._createTransceiver("video"),I--);var E=xe.writeSessionBoilerplate(f._sdpSessionId,f._sdpSessionVersion++);return f.transceivers.forEach(function(_,S){var N=_.track,k=_.kind,B=_.mid||xe.generateIdentifier();_.mid=B,_.iceGatherer||(_.iceGatherer=f._createIceGatherer(S,f.usingBundle)),B=i.RTCRtpSender.getCapabilities(k),15019>r&&(B.codecs=B.codecs.filter(function(P){return P.name!=="rtx"})),B.codecs.forEach(function(P){P.name==="H264"&&P.parameters["level-asymmetry-allowed"]===void 0&&(P.parameters["level-asymmetry-allowed"]="1"),_.remoteCapabilities&&_.remoteCapabilities.codecs&&_.remoteCapabilities.codecs.forEach(function(J){P.name.toLowerCase()===J.name.toLowerCase()&&P.clockRate===J.clockRate&&(P.preferredPayloadType=J.payloadType)})}),B.headerExtensions.forEach(function(P){(_.remoteCapabilities&&_.remoteCapabilities.headerExtensions||[]).forEach(function(J){P.uri===J.uri&&(P.id=J.id)})}),S=_.sendEncodingParameters||[{ssrc:1001*(2*S+1)}],N&&15019<=r&&k==="video"&&!S[0].rtx&&(S[0].rtx={ssrc:S[0].ssrc+1}),_.wantReceive&&(_.rtpReceiver=new i.RTCRtpReceiver(_.dtlsTransport,k)),_.localCapabilities=B,_.sendEncodingParameters=S}),f._config.bundlePolicy!=="max-compat"&&(E+="a=group:BUNDLE "+f.transceivers.map(function(_){return _.mid}).join(" ")+`\r
`),E+=`a=ice-options:trickle\r
`,f.transceivers.forEach(function(_,S){E+=oe(_,_.localCapabilities,"offer",_.stream,f._dtlsRole),E+=`a=rtcp-rsize\r
`,!_.iceGatherer||f.iceGatheringState==="new"||S!==0&&f.usingBundle||(_.iceGatherer.getLocalCandidates().forEach(function(N){N.component=1,E+="a="+xe.writeCandidate(N)+`\r
`}),_.iceGatherer.state==="completed"&&(E+=`a=end-of-candidates\r
`))}),A=new i.RTCSessionDescription({type:"offer",sdp:E}),Promise.resolve(A)},u.prototype.createAnswer=function(){var A=this;if(A._isClosed)return Promise.reject(Oe("InvalidStateError","Can not call createAnswer after close"));if(A.signalingState!=="have-remote-offer"&&A.signalingState!=="have-local-pranswer")return Promise.reject(Oe("InvalidStateError","Can not call createAnswer in signalingState "+A.signalingState));var f=xe.writeSessionBoilerplate(A._sdpSessionId,A._sdpSessionVersion++);A.usingBundle&&(f+="a=group:BUNDLE "+A.transceivers.map(function(E){return E.mid}).join(" ")+`\r
`),f+=`a=ice-options:trickle\r
`;var m=xe.getMediaSections(A._remoteDescription.sdp).length;A.transceivers.forEach(function(E,_){if(!(_+1>m)){if(E.rejected)return E.kind==="application"?E.protocol==="DTLS/SCTP"?f+=`m=application 0 DTLS/SCTP 5000\r
`:f+="m=application 0 "+E.protocol+` webrtc-datachannel\r
`:E.kind==="audio"?f+=`m=audio 0 UDP/TLS/RTP/SAVPF 0\r
a=rtpmap:0 PCMU/8000\r
`:E.kind==="video"&&(f+=`m=video 0 UDP/TLS/RTP/SAVPF 120\r
a=rtpmap:120 VP8/90000\r
`),void(f+=`c=IN IP4 0.0.0.0\r
a=inactive\r
a=mid:`+E.mid+`\r
`);var S;E.stream&&(E.kind==="audio"?S=E.stream.getAudioTracks()[0]:E.kind==="video"&&(S=E.stream.getVideoTracks()[0]),S&&15019<=r&&E.kind==="video"&&!E.sendEncodingParameters[0].rtx&&(E.sendEncodingParameters[0].rtx={ssrc:E.sendEncodingParameters[0].ssrc+1})),_=Te(E.localCapabilities,E.remoteCapabilities),!_.codecs.filter(function(N){return N.name.toLowerCase()==="rtx"}).length&&E.sendEncodingParameters[0].rtx&&delete E.sendEncodingParameters[0].rtx,f+=oe(E,_,"answer",E.stream,A._dtlsRole),E.rtcpParameters&&E.rtcpParameters.reducedSize&&(f+=`a=rtcp-rsize\r
`)}});var I=new i.RTCSessionDescription({type:"answer",sdp:f});return Promise.resolve(I)},u.prototype.addIceCandidate=function(A){var f,m=this;return A&&A.sdpMLineIndex===void 0&&!A.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(I,E){if(!m._remoteDescription)return E(Oe("InvalidStateError","Can not add ICE candidate without a remote description"));if(A&&A.candidate!==""){var _=A.sdpMLineIndex;if(A.sdpMid){for(var S=0;S<m.transceivers.length;S++)if(m.transceivers[S].mid===A.sdpMid){_=S;break}}var N=m.transceivers[_];if(!N)return E(Oe("OperationError","Can not add ICE candidate"));if(N.rejected||(S=0<Object.keys(A.candidate).length?xe.parseCandidate(A.candidate):{},S.protocol==="tcp"&&(S.port===0||S.port===9)||S.component&&S.component!==1))return I();if((_===0||0<_&&N.iceTransport!==m.transceivers[0].iceTransport)&&!We(N.iceTransport,S))return E(Oe("OperationError","Can not add ICE candidate"));E=A.candidate.trim(),E.indexOf("a=")===0&&(E=E.substr(2)),(f=xe.getMediaSections(m._remoteDescription.sdp))[_]+="a="+(S.type?E:"end-of-candidates")+`\r
`,m._remoteDescription.sdp=xe.getDescription(m._remoteDescription.sdp)+f.join("")}else for(_=0;_<m.transceivers.length&&(m.transceivers[_].rejected||(m.transceivers[_].iceTransport.addRemoteCandidate({}),(f=xe.getMediaSections(m._remoteDescription.sdp))[_]+=`a=end-of-candidates\r
`,m._remoteDescription.sdp=xe.getDescription(m._remoteDescription.sdp)+f.join(""),!m.usingBundle));_++);I()})},u.prototype.getStats=function(A){if(A&&A instanceof i.MediaStreamTrack){var f=null;if(this.transceivers.forEach(function(I){I.rtpSender&&I.rtpSender.track===A?f=I.rtpSender:I.rtpReceiver&&I.rtpReceiver.track===A&&(f=I.rtpReceiver)}),!f)throw Oe("InvalidAccessError","Invalid selector.");return f.getStats()}var m=[];return this.transceivers.forEach(function(I){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(E){I[E]&&m.push(I[E].getStats())})}),Promise.all(m).then(function(I){var E=new Map;return I.forEach(function(_){_.forEach(function(S){E.set(S.id,S)})}),E})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(A){if((A=i[A])&&A.prototype&&A.prototype.getStats){var f=A.prototype.getStats;A.prototype.getStats=function(){return f.apply(this).then(function(m){var I=new Map;return Object.keys(m).forEach(function(E){var _;m[E].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(_=m[E]).type]||_.type,I.set(E,m[E])}),I})}}});var h=["createOffer","createAnswer"];return h.forEach(function(A){var f=u.prototype[A];u.prototype[A]=function(){var m=arguments;return typeof m[0]=="function"||typeof m[1]=="function"?f.apply(this,[arguments[2]]).then(function(I){typeof m[0]=="function"&&m[0].apply(null,[I])},function(I){typeof m[1]=="function"&&m[1].apply(null,[I])}):f.apply(this,arguments)}}),(h=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(A){var f=u.prototype[A];u.prototype[A]=function(){var m=arguments;return typeof m[1]=="function"||typeof m[2]=="function"?f.apply(this,arguments).then(function(){typeof m[1]=="function"&&m[1].apply(null)},function(I){typeof m[2]=="function"&&m[2].apply(null,[I])}):f.apply(this,arguments)}}),["getStats"].forEach(function(A){var f=u.prototype[A];u.prototype[A]=function(){var m=arguments;return typeof m[1]=="function"?f.apply(this,arguments).then(function(){typeof m[1]=="function"&&m[1].apply(null)}):f.apply(this,arguments)}}),u},hE=Object.freeze({__proto__:null,shimPeerConnection:Gt,shimReplaceTrack:Dr,shimGetUserMedia:Mt,shimGetDisplayMedia:At}),pE=Object.freeze({__proto__:null,shimOnTrack:at,shimPeerConnection:$t,shimSenderGetStats:Cr,shimReceiverGetStats:ei,shimRemoveStream:ti,shimRTCDataChannel:io,shimGetUserMedia:Lt,shimGetDisplayMedia:function(i,r){i.navigator.mediaDevices&&"getDisplayMedia"in i.navigator.mediaDevices||i.navigator.mediaDevices&&(i.navigator.mediaDevices.getDisplayMedia=function(s){return s&&s.video?(s.video===!0?s.video={mediaSource:r}:s.video.mediaSource=r,i.navigator.mediaDevices.getUserMedia(s)):(s=new DOMException("getDisplayMedia without video constraints is undefined"),s.name="NotFoundError",s.code=8,ce.reject(s))})}}),AE=Object.freeze({__proto__:null,shimLocalStreamsAPI:ri,shimRemoteStreamsAPI:oo,shimCallbacksAPI:vi,shimGetUserMedia:Fn,shimConstraints:Ei,shimRTCIceServerUrls:bo,shimTrackEventTransceiver:Ii,shimCreateOfferLegacy:Do}),yR=Object.freeze({__proto__:null,shimRTCIceCandidate:ni,shimMaxMessageSize:Ci,shimSendThrowTypeError:so,shimConnectionState:Bo,removeAllowExtmapMixed:$o});(function({window:i}={},r={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){let s=v(i),c={browserDetails:s,commonShim:yR,extractVersion:o,disableLog:l,disableWarnings:d};switch(s.browser){case"chrome":if(!cE||!Q||!r.shimChrome)return p("Chrome shim is not included in this adapter release."),c;p("adapter.js shimming chrome."),c.browserShim=cE,w(i),O(i),Q(i),M(i),re(i),x(i),G(i),K(i),Ae(i),ni(i),Bo(i),Ci(i),so(i),$o(i);break;case"firefox":if(!pE||!$t||!r.shimFirefox)return p("Firefox shim is not included in this adapter release."),c;p("adapter.js shimming firefox."),c.browserShim=pE,Lt(i),$t(i),at(i),ti(i),Cr(i),ei(i),io(i),ni(i),Bo(i),Ci(i),so(i);break;case"edge":if(!hE||!Gt||!r.shimEdge)return p("MS edge shim is not included in this adapter release."),c;p("adapter.js shimming edge."),c.browserShim=hE,Mt(i),At(i),Gt(i),Dr(i),Ci(i),so(i);break;case"safari":if(!AE||!r.shimSafari)return p("Safari shim is not included in this adapter release."),c;p("adapter.js shimming safari."),c.browserShim=AE,bo(i),Do(i),vi(i),ri(i),oo(i),Ii(i),Fn(i),ni(i),Ci(i),so(i),$o(i);break;default:p("Unsupported browser!")}})({window});var Lr,ze;(function(i){i.WIN_10="Windows 10",i.WIN_81="Windows 8.1",i.WIN_8="Windows 8",i.WIN_7="Windows 7",i.WIN_VISTA="Windows Vista",i.WIN_SERVER_2003="Windows Server 2003",i.WIN_XP="Windows XP",i.WIN_2000="Windows 2000",i.ANDROID="Android",i.OPEN_BSD="Open BSD",i.SUN_OS="Sun OS",i.LINUX="Linux",i.IOS="iOS",i.MAC_OS="Mac OS",i.QNX="QNX",i.UNIX="UNIX",i.BEOS="BeOS",i.OS_2="OS/2",i.SEARCH_BOT="Search Bot"})(Lr||(Lr={})),function(i){i.CHROME="Chrome",i.SAFARI="Safari",i.EDGE="Edge",i.FIREFOX="Firefox",i.OPERA="OPR",i.QQ="QQBrowser",i.WECHAT="MicroMessenger"}(ze||(ze={}));let Ep=new(t(function(i,r){(function(s,c){var u={extend:function(S,N){var k={},B;for(B in S)N[B]&&N[B].length%2==0?k[B]=N[B].concat(S[B]):k[B]=S[B];return k},has:function(S,N){return typeof S=="string"&&N.toLowerCase().indexOf(S.toLowerCase())!==-1},lowerize:function(S){return S.toLowerCase()},major:function(S){return typeof S=="string"?S.replace(/[^\d\.]/g,"").split(".")[0]:c},trim:function(S,N){return S=S.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),N===void 0?S:S.substring(0,255)}},h=function(S,N){for(var k,B,P,J,se,ge,Le=0;Le<N.length&&!se;){var Be=N[Le],yt=N[Le+1];for(k=B=0;k<Be.length&&!se;)if(se=Be[k++].exec(S))for(P=0;P<yt.length;P++)ge=se[++B],typeof(J=yt[P])=="object"&&0<J.length?J.length==2?typeof J[1]=="function"?this[J[0]]=J[1].call(this,ge):this[J[0]]=J[1]:J.length==3?typeof J[1]!="function"||J[1].exec&&J[1].test?this[J[0]]=ge?ge.replace(J[1],J[2]):c:this[J[0]]=ge?J[1].call(this,ge,J[2]):c:J.length==4&&(this[J[0]]=ge?J[3].call(this,ge.replace(J[1],J[2])):c):this[J]=ge||c;Le+=2}},A=function(S,N){for(var k in N)if(typeof N[k]=="object"&&0<N[k].length){for(var B=0;B<N[k].length;B++)if(u.has(N[k][B],S))return k==="?"?c:k}else if(u.has(N[k],S))return k==="?"?c:k;return S},f={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},m={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],["version",["name","Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],["version",["name","Edge"]],[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]{3,6})\b.+version\/([\w\.-]+)/i,/(opera)(?:.+version\/|[\/\s]+)([\w\.]+)/i],["name","version"],[/opios[\/\s]+([\w\.]+)/i],["version",["name","Opera Mini"]],[/\sopr\/([\w\.]+)/i],["version",["name","Opera"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]*)/i,/(avant\s|iemobile|slim)(?:browser)?[\/\s]?([\w\.]*)/i,/(ba?idubrowser)[\/\s]?([\w\.]+)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon)\/([\w\.-]+)/i,/(rekonq|puffin|brave|whale|qqbrowserlite|qq)\/([\w\.]+)/i,/(weibo)__([\d\.]+)/i],["name","version"],[/(?:[\s\/]uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],["version",["name","UCBrowser"]],[/(?:windowswechat)?\sqbcore\/([\w\.]+)\b.*(?:windowswechat)?/i],["version",["name","WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],["version",["name","WeChat"]],[/konqueror\/([\w\.]+)/i],["version",["name","Konqueror"]],[/trident.+rv[:\s]([\w\.]{1,9})\b.+like\sgecko/i],["version",["name","IE"]],[/yabrowser\/([\w\.]+)/i],["version",["name","Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[["name",/(.+)/,"$1 Secure Browser"],"version"],[/focus\/([\w\.]+)/i],["version",["name","Firefox Focus"]],[/opt\/([\w\.]+)/i],["version",["name","Opera Touch"]],[/coc_coc_browser\/([\w\.]+)/i],["version",["name","Coc Coc"]],[/dolfin\/([\w\.]+)/i],["version",["name","Dolphin"]],[/coast\/([\w\.]+)/i],["version",["name","Opera Coast"]],[/xiaomi\/miuibrowser\/([\w\.]+)/i],["version",["name","MIUI Browser"]],[/fxios\/([\w\.-]+)/i],["version",["name","Firefox"]],[/(qihu|qhbrowser|qihoobrowser|360browser)/i],[["name","360 Browser"]],[/(oculus|samsung|sailfish)browser\/([\w\.]+)/i],[["name",/(.+)/,"$1 Browser"],"version"],[/(comodo_dragon)\/([\w\.]+)/i],[["name",/_/g," "],"version"],[/\s(electron)\/([\w\.]+)\ssafari/i,/(tesla)(?:\sqtcarbrowser|\/(20[12]\d\.[\w\.-]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/\s]?([\w\.]+)/i],["name","version"],[/(MetaSr)[\/\s]?([\w\.]+)/i,/(LBBROWSER)/i],["name"],[/;fbav\/([\w\.]+);/i],["version",["name","Facebook"]],[/FBAN\/FBIOS|FB_IAB\/FB4A/i],[["name","Facebook"]],[/safari\s(line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/\s]([\w\.-]+)/i],["name","version"],[/\bgsa\/([\w\.]+)\s.*safari\//i],["version",["name","GSA"]],[/headlesschrome(?:\/([\w\.]+)|\s)/i],["version",["name","Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[["name","Chrome WebView"],"version"],[/droid.+\sversion\/([\w\.]+)\b.+(?:mobile\ssafari|safari)/i],["version",["name","Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],["name","version"],[/version\/([\w\.]+)\s.*mobile\/\w+\s(safari)/i],["version",["name","Mobile Safari"]],[/version\/([\w\.]+)\s.*(mobile\s?safari|safari)/i],["version","name"],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],["name",["version",A,{"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],["name","version"],[/(navigator|netscape)\/([\w\.-]+)/i],[["name","Netscape"],"version"],[/ile\svr;\srv:([\w\.]+)\).+firefox/i],["version",["name","Firefox Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([\w\.-]+)$/i,/(firefox)\/([\w\.]+)\s[\w\s\-]+\/[\w\.]+$/i,/(mozilla)\/([\w\.]+)\s.+rv:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]*)/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],["name","version"]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[["architecture","amd64"]],[/(ia32(?=;))/i],[["architecture",u.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[["architecture","ia32"]],[/\b(aarch64|armv?8e?l?)\b/i],[["architecture","arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[["architecture","armhf"]],[/windows\s(ce|mobile);\sppc;/i],[["architecture","arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[["architecture",/ower/,"",u.lowerize]],[/(sun4\w)[;\)]/i],[["architecture","sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?:64|(?=v(?:[1-7]|[5-7]1)l?|;|eabi))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[["architecture",u.lowerize]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[pt]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus\s10)/i],["model",["vendor","Samsung"],["type","tablet"]],[/\b((?:s[cgp]h|gt|sm)-\w+|galaxy\snexus)/i,/\ssamsung[\s-]([\w-]+)/i,/sec-(sgh\w+)/i],["model",["vendor","Samsung"],["type","mobile"]],[/\((ip(?:hone|od)[\s\w]*);/i],["model",["vendor","Apple"],["type","mobile"]],[/\((ipad);[\w\s\),;-]+apple/i,/applecoremedia\/[\w\.]+\s\((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],["model",["vendor","Apple"],["type","tablet"]],[/\b((?:agr|ags[23]|bah2?|sht?)-a?[lw]\d{2})/i],["model",["vendor","Huawei"],["type","tablet"]],[/d\/huawei([\w\s-]+)[;\)]/i,/\b(nexus\s6p|vog-[at]?l\d\d|ane-[at]?l[x\d]\d|eml-a?l\d\da?|lya-[at]?l\d[\dc]|clt-a?l\d\di?|ele-l\d\d)/i,/\b(\w{2,4}-[atu][ln][01259][019])[;\)\s]/i],["model",["vendor","Huawei"],["type","mobile"]],[/\b(poco[\s\w]+)(?:\sbuild|\))/i,/\b;\s(\w+)\sbuild\/hm\1/i,/\b(hm[\s\-_]?note?[\s_]?(?:\d\w)?)\sbuild/i,/\b(redmi[\s\-_]?(?:note|k)?[\w\s_]+)(?:\sbuild|\))/i,/\b(mi[\s\-_]?(?:a\d|one|one[\s_]plus|note lte)?[\s_]?(?:\d?\w?)[\s_]?(?:plus)?)\sbuild/i],[["model",/_/g," "],["vendor","Xiaomi"],["type","mobile"]],[/\b(mi[\s\-_]?(?:pad)(?:[\w\s_]+))(?:\sbuild|\))/i],[["model",/_/g," "],["vendor","Xiaomi"],["type","tablet"]],[/;\s(\w+)\sbuild.+\soppo/i,/\s(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007)\b/i],["model",["vendor","OPPO"],["type","mobile"]],[/\svivo\s(\w+)(?:\sbuild|\))/i,/\s(v[12]\d{3}\w?[at])(?:\sbuild|;)/i],["model",["vendor","Vivo"],["type","mobile"]],[/\s(rmx[12]\d{3})(?:\sbuild|;)/i],["model",["vendor","Realme"],["type","mobile"]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?:?(\s4g)?)\b[\w\s]+build\//i,/\smot(?:orola)?[\s-](\w*)/i,/((?:moto[\s\w\(\)]+|xt\d{3,4}|nexus\s6)(?=\sbuild|\)))/i],["model",["vendor","Motorola"],["type","mobile"]],[/\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],["model",["vendor","Motorola"],["type","tablet"]],[/((?=lg)?[vl]k\-?\d{3})\sbuild|\s3\.[\s\w;-]{10}lg?-([06cv9]{3,4})/i],["model",["vendor","LG"],["type","tablet"]],[/(lm-?f100[nv]?|nexus\s[45])/i,/lg[e;\s\/-]+((?!browser|netcast)\w+)/i,/\blg(\-?[\d\w]+)\sbuild/i],["model",["vendor","LG"],["type","mobile"]],[/(ideatab[\w\-\s]+)/i,/lenovo\s?(s(?:5000|6000)(?:[\w-]+)|tab(?:[\s\w]+)|yt[\d\w-]{6}|tb[\d\w-]{6})/i],["model",["vendor","Lenovo"],["type","tablet"]],[/(?:maemo|nokia).*(n900|lumia\s\d+)/i,/nokia[\s_-]?([\w\.-]*)/i],[["model",/_/g," "],["vendor","Nokia"],["type","mobile"]],[/droid.+;\s(pixel\sc)[\s)]/i],["model",["vendor","Google"],["type","tablet"]],[/droid.+;\s(pixel[\s\daxl]{0,6})(?:\sbuild|\))/i],["model",["vendor","Google"],["type","mobile"]],[/droid.+\s([c-g]\d{4}|so[-l]\w+|xq-a\w[4-7][12])(?=\sbuild\/|\).+chrome\/(?![1-6]{0,1}\d\.))/i],["model",["vendor","Sony"],["type","mobile"]],[/sony\stablet\s[ps]\sbuild\//i,/(?:sony)?sgp\w+(?:\sbuild\/|\))/i],[["model","Xperia Tablet"],["vendor","Sony"],["type","tablet"]],[/\s(kb2005|in20[12]5|be20[12][59])\b/i,/\ba000(1)\sbuild/i,/\boneplus\s(a\d{4})[\s)]/i],["model",["vendor","OnePlus"],["type","mobile"]],[/(alexa)webm/i,/(kf[a-z]{2}wi)(\sbuild\/|\))/i,/(kf[a-z]+)(\sbuild\/|\)).+silk\//i],["model",["vendor","Amazon"],["type","tablet"]],[/(sd|kf)[0349hijorstuw]+(\sbuild\/|\)).+silk\//i],[["model","Fire Phone"],["vendor","Amazon"],["type","mobile"]],[/\((playbook);[\w\s\),;-]+(rim)/i],["model","vendor",["type","tablet"]],[/((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10;\s(\w+)/i],["model",["vendor","BlackBerry"],["type","mobile"]],[/(?:\b|asus_)(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus\s7|padfone|p00[cj])/i],["model",["vendor","ASUS"],["type","tablet"]],[/\s(z[es]6[027][01][km][ls]|zenfone\s\d\w?)\b/i],["model",["vendor","ASUS"],["type","mobile"]],[/(nexus\s9)/i],["model",["vendor","HTC"],["type","tablet"]],[/(htc)[;_\s-]{1,2}([\w\s]+(?=\)|\sbuild)|\w+)/i,/(zte)-(\w*)/i,/(alcatel|geeksphone|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]*)/i],["vendor",["model",/_/g," "],["type","mobile"]],[/droid[x\d\.\s;]+\s([ab][1-7]\-?[0178a]\d\d?)/i],["model",["vendor","Acer"],["type","tablet"]],[/droid.+;\s(m[1-5]\snote)\sbuild/i,/\bmz-([\w-]{2,})/i],["model",["vendor","Meizu"],["type","mobile"]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]*)/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i,/(microsoft);\s(lumia[\s\w]+)/i,/(lenovo)[_\s-]?([\w-]+)/i,/linux;.+(jolla);/i,/droid.+;\s(oppo)\s?([\w\s]+)\sbuild/i],["vendor","model",["type","mobile"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i,/[;\/]\s?(le[\s\-]+pan)[\s\-]+(\w{1,9})\sbuild/i,/[;\/]\s?(trinity)[\-\s]*(t\d{3})\sbuild/i,/\b(gigaset)[\s\-]+(q\w{1,9})\sbuild/i,/\b(vodafone)\s([\w\s]+)(?:\)|\sbuild)/i],["vendor","model",["type","tablet"]],[/\s(surface\sduo)\s/i],["model",["vendor","Microsoft"],["type","tablet"]],[/droid\s[\d\.]+;\s(fp\du?)\sbuild/i],["model",["vendor","Fairphone"],["type","mobile"]],[/\s(u304aa)\sbuild/i],["model",["vendor","AT&T"],["type","mobile"]],[/sie-(\w*)/i],["model",["vendor","Siemens"],["type","mobile"]],[/[;\/]\s?(rct\w+)\sbuild/i],["model",["vendor","RCA"],["type","tablet"]],[/[;\/\s](venue[\d\s]{2,7})\sbuild/i],["model",["vendor","Dell"],["type","tablet"]],[/[;\/]\s?(q(?:mv|ta)\w+)\sbuild/i],["model",["vendor","Verizon"],["type","tablet"]],[/[;\/]\s(?:barnes[&\s]+noble\s|bn[rt])([\w\s\+]*)\sbuild/i],["model",["vendor","Barnes & Noble"],["type","tablet"]],[/[;\/]\s(tm\d{3}\w+)\sbuild/i],["model",["vendor","NuVision"],["type","tablet"]],[/;\s(k88)\sbuild/i],["model",["vendor","ZTE"],["type","tablet"]],[/;\s(nx\d{3}j)\sbuild/i],["model",["vendor","ZTE"],["type","mobile"]],[/[;\/]\s?(gen\d{3})\sbuild.*49h/i],["model",["vendor","Swiss"],["type","mobile"]],[/[;\/]\s?(zur\d{3})\sbuild/i],["model",["vendor","Swiss"],["type","tablet"]],[/[;\/]\s?((zeki)?tb.*\b)\sbuild/i],["model",["vendor","Zeki"],["type","tablet"]],[/[;\/]\s([yr]\d{2})\sbuild/i,/[;\/]\s(dragon[\-\s]+touch\s|dt)(\w{5})\sbuild/i],[["vendor","Dragon Touch"],"model",["type","tablet"]],[/[;\/]\s?(ns-?\w{0,9})\sbuild/i],["model",["vendor","Insignia"],["type","tablet"]],[/[;\/]\s?((nxa|Next)-?\w{0,9})\sbuild/i],["model",["vendor","NextBook"],["type","tablet"]],[/[;\/]\s?(xtreme_)?(v(1[045]|2[015]|[3469]0|7[05]))\sbuild/i],[["vendor","Voice"],"model",["type","mobile"]],[/[;\/]\s?(lvtel\-)?(v1[12])\sbuild/i],[["vendor","LvTel"],"model",["type","mobile"]],[/;\s(ph-1)\s/i],["model",["vendor","Essential"],["type","mobile"]],[/[;\/]\s?(v(100md|700na|7011|917g).*\b)\sbuild/i],["model",["vendor","Envizen"],["type","tablet"]],[/[;\/]\s?(trio[\s\w\-\.]+)\sbuild/i],["model",["vendor","MachSpeed"],["type","tablet"]],[/[;\/]\s?tu_(1491)\sbuild/i],["model",["vendor","Rotor"],["type","tablet"]],[/(shield[\w\s]+)\sbuild/i],["model",["vendor","Nvidia"],["type","tablet"]],[/(sprint)\s(\w+)/i],["vendor","model",["type","mobile"]],[/(kin\.[onetw]{3})/i],[["model",/\./g," "],["vendor","Microsoft"],["type","mobile"]],[/droid\s[\d\.]+;\s(cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],["model",["vendor","Zebra"],["type","tablet"]],[/droid\s[\d\.]+;\s(ec30|ps20|tc[2-8]\d[kx])\)/i],["model",["vendor","Zebra"],["type","mobile"]],[/\s(ouya)\s/i,/(nintendo)\s([wids3utch]+)/i],["vendor","model",["type","console"]],[/droid.+;\s(shield)\sbuild/i],["model",["vendor","Nvidia"],["type","console"]],[/(playstation\s[345portablevi]+)/i],["model",["vendor","Sony"],["type","console"]],[/[\s\(;](xbox(?:\sone)?(?!;\sxbox))[\s\);]/i],["model",["vendor","Microsoft"],["type","console"]],[/smart-tv.+(samsung)/i],["vendor",["type","smarttv"]],[/hbbtv.+maple;(\d+)/i],[["model",/^/,"SmartTV"],["vendor","Samsung"],["type","smarttv"]],[/(?:linux;\snetcast.+smarttv|lg\snetcast\.tv-201\d)/i],[["vendor","LG"],["type","smarttv"]],[/(apple)\s?tv/i],["vendor",["model","Apple TV"],["type","smarttv"]],[/crkey/i],[["model","Chromecast"],["vendor","Google"],["type","smarttv"]],[/droid.+aft([\w])(\sbuild\/|\))/i],["model",["vendor","Amazon"],["type","smarttv"]],[/\(dtv[\);].+(aquos)/i],["model",["vendor","Sharp"],["type","smarttv"]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[["vendor",u.trim],["model",u.trim],["type","smarttv"]],[/[\s\/\(](android\s|smart[-\s]?|opera\s)tv[;\)\s]/i],[["type","smarttv"]],[/((pebble))app\/[\d\.]+\s/i],["vendor","model",["type","wearable"]],[/droid.+;\s(glass)\s\d/i],["model",["vendor","Google"],["type","wearable"]],[/droid\s[\d\.]+;\s(wt63?0{2,3})\)/i],["model",["vendor","Zebra"],["type","wearable"]],[/(tesla)(?:\sqtcarbrowser|\/20[12]\d\.[\w\.-]+)/i],["vendor",["type","embedded"]],[/droid .+?; ([^;]+?)(?: build|\) applewebkit).+? mobile safari/i],["model",["type","mobile"]],[/droid .+?;\s([^;]+?)(?: build|\) applewebkit).+?(?! mobile) safari/i],["model",["type","tablet"]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[["type",u.lowerize]],[/(android[\w\.\s\-]{0,9});.+build/i],["model",["vendor","Generic"]],[/(phone)/i],[["type","mobile"]]],engine:[[/windows.+\sedge\/([\w\.]+)/i],["version",["name","EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],["version",["name","Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],["name","version"],[/rv:([\w\.]{1,9})\b.+(gecko)/i],["version","name"]],os:[[/microsoft\s(windows)\s(vista|xp)/i],["name","version"],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s\w]*)/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)(?!.+xbox)/i],["name",["version",A,f]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[["name","Windows"],["version",A,f]],[/ip[honead]{2,4}\b(?:.*os\s([\w]+)\slike\smac|;\sopera)/i,/cfnetwork\/.+darwin/i],[["version",/_/g,"."],["name","iOS"]],[/(mac\sos\sx)\s?([\w\s\.]*)/i,/(macintosh|mac(?=_powerpc)\s)(?!.+haiku)/i],[["name","Mac OS"],["version",/_/g,"."]],[/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|sailfish|contiki)[\/\s-]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/\s]([\w\.]+)/i,/\((series40);/i],["name","version"],[/\(bb(10);/i],["version",["name","BlackBerry"]],[/(?:symbian\s?os|symbos|s60(?=;)|series60)[\/\s-]?([\w\.]*)/i],["version",["name","Symbian"]],[/mozilla.+\(mobile;.+gecko.+firefox/i],[["name","Firefox OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],["version",["name","webOS"]],[/crkey\/([\d\.]+)/i],["version",["name","Chromecast"]],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[["name","Chromium OS"],"version"],[/(nintendo|playstation)\s([wids345portablevuch]+)/i,/(xbox);\s+xbox\s([^\);]+)/i,/(mint)[\/\s\(\)]?(\w*)/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?=\slinux)|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus|raspbian)(?:\sgnu\/linux)?(?:\slinux)?[\/\s-]?(?!chrom|package)([\w\.-]*)/i,/(hurd|linux)\s?([\w\.]*)/i,/(gnu)\s?([\w\.]*)/i,/\s([frentopc-]{0,4}bsd|dragonfly)\s?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku)\s(\w+)/i],["name","version"],[/(sunos)\s?([\w\.\d]*)/i],[["name","Solaris"],"version"],[/((?:open)?solaris)[\/\s-]?([\w\.]*)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.])*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms|fuchsia)/i,/(unix)\s?([\w\.]*)/i],["name","version"]]},I=function(S,N){if(typeof S=="object"&&(N=S,S=c),!(this instanceof I))return new I(S,N).getResult();var k=S||(s!==void 0&&s.navigator&&s.navigator.userAgent?s.navigator.userAgent:""),B=N?u.extend(m,N):m;return this.getBrowser=function(){var P={name:c,version:c};return h.call(P,k,B.browser),P.major=u.major(P.version),P},this.getCPU=function(){var P={architecture:c};return h.call(P,k,B.cpu),P},this.getDevice=function(){var P={vendor:c,model:c,type:c};return h.call(P,k,B.device),P},this.getEngine=function(){var P={name:c,version:c};return h.call(P,k,B.engine),P},this.getOS=function(){var P={name:c,version:c};return h.call(P,k,B.os),P},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return k},this.setUA=function(P){return k=typeof P=="string"&&255<P.length?u.trim(P,255):P,this},this.setUA(k),this};I.VERSION="0.7.28",I.BROWSER={NAME:"name",MAJOR:"major",VERSION:"version"},I.CPU={ARCHITECTURE:"architecture"},I.DEVICE={MODEL:"model",VENDOR:"vendor",TYPE:"type",CONSOLE:"console",MOBILE:"mobile",SMARTTV:"smarttv",TABLET:"tablet",WEARABLE:"wearable",EMBEDDED:"embedded"},I.ENGINE={NAME:"name",VERSION:"version"},I.OS={NAME:"name",VERSION:"version"},i.exports&&(r=i.exports=I),r.UAParser=I;var E=s!==void 0&&(s.jQuery||s.Zepto);if(E&&!E.ua){var _=new I;E.ua=_.getResult(),E.ua.get=function(){return _.getUA()},E.ua.set=function(S){_.setUA(S),S=_.getResult();for(var N in S)E.ua[N]=S[N]}}})(typeof window=="object"?window:Yc)})),pn=Ep.getResult(),Hn=function(i){if(i.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return i;var r=i.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(r&&r[1]&&r[2]){var s,c=r[2];return b(s="".concat(r[1],".")).call(s,c)}return(r=i.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/))&&r[1]&&r[2]?(s=r[2],b(c="".concat(r[1],".")).call(c,100*(Number(s)+1))):"4.0.0.999"}("4.7.3");try{var fE=JSON.parse("true")===!0}catch{fE=!0}let Ip=fE,Pr={username:"test",password:"111111",turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1},_R={"90p":te(160,90),"90p_1":te(160,90),"120p":te(160,120,15,30,65),"120p_1":te(160,120,15,30,65),"120p_3":te(120,120,15,30,50),"120p_4":te(212,120),"180p":te(320,180,15,30,140),"180p_1":te(320,180,15,30,140),"180p_3":te(180,180,15,30,100),"180p_4":te(240,180,15,30,120),"240p":te(320,240,15,40,200),"240p_1":te(320,240,15,40,200),"240p_3":te(240,240,15,40,140),"240p_4":te(424,240,15,40,220),"360p":te(640,360,15,80,400),"360p_1":te(640,360,15,80,400),"360p_3":te(360,360,15,80,260),"360p_4":te(640,360,30,80,600),"360p_6":te(360,360,30,80,400),"360p_7":te(480,360,15,80,320),"360p_8":te(480,360,30,80,490),"360p_9":te(640,360,15,80,800),"360p_10":te(640,360,24,80,800),"360p_11":te(640,360,24,80,1e3),"480p":te(640,480,15,100,500),"480p_1":te(640,480,15,100,500),"480p_2":te(640,480,30,100,1e3),"480p_3":te(480,480,15,100,400),"480p_4":te(640,480,30,100,750),"480p_6":te(480,480,30,100,600),"480p_8":te(848,480,15,100,610),"480p_9":te(848,480,30,100,930),"480p_10":te(640,480,10,100,400),"720p":te(1280,720,15,120,1130),"720p_1":te(1280,720,15,120,1130),"720p_2":te(1280,720,30,120,2e3),"720p_3":te(1280,720,30,120,1710),"720p_5":te(960,720,15,120,910),"720p_6":te(960,720,30,120,1380),"1080p":te(1920,1080,15,120,2080),"1080p_1":te(1920,1080,15,120,2080),"1080p_2":te(1920,1080,30,120,3e3),"1080p_3":te(1920,1080,30,120,3150),"1080p_5":te(1920,1080,60,120,4780),"1440p":te(2560,1440,30,120,4850),"1440p_1":te(2560,1440,30,120,4850),"1440p_2":te(2560,1440,60,120,7350),"4k":te(3840,2160,30,120,8910),"4k_1":te(3840,2160,30,120,8910),"4k_3":te(3840,2160,60,120,13500)},SR={"480p":be(640,480,5),"480p_1":be(640,480,5),"480p_2":be(640,480,30),"480p_3":be(640,480,15),"720p":be(1280,720,5),"720p_1":be(1280,720,5),"720p_2":be(1280,720,30),"720p_3":be(1280,720,15),"1080p":be(1920,1080,5),"1080p_1":be(1920,1080,5),"1080p_2":be(1920,1080,30),"1080p_3":be(1920,1080,15)},TR={"1SL1TL":St(1,1),"3SL3TL":St(3,3),"2SL3TL":St(2,3)},RR={speech_low_quality:X(16e3,!1),speech_standard:X(32e3,!1,18),music_standard:X(48e3,!1),standard_stereo:X(48e3,!0,56),high_quality:X(48e3,!1,128),high_quality_stereo:X(48e3,!0,192)},ne={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,HTTP_CONNECT_TIMEOUT:5e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_TIMEOUT:1e4,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],FILEPATH_LENMAX:255,SUBSCRIBE_TCC:!0,PING_PONG_TIME_OUT:10,DUALSTREAM_OPERATION_CHECK:!0,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,MEDIA_ELEMENT_EXISTS_DEPTH:3,CANDIDATE_TIMEOUT:5e3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,SHOW_REPORT_INVOKER_LOG:!1,STATS_FILTER:{transportId:!0,googTrackId:!0},JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,ENUMERATE_DEVICES_INTERVAL:!0};Ip||(ne.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],ne.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],ne.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],ne.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ne.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],ne.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],ne.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",ne.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",ne.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",ne.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",ne.AREAS=["NORTH_AMERICA","OVERSEA"]);let wR=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],xo=[],ls=[];var Cp=[],gE=Cp.sort,NR=ir(function(){Cp.sort(void 0)}),kR=ir(function(){Cp.sort(null)}),OR=Hs("sort");Fe({target:"Array",proto:!0,forced:NR||!kR||OR},{sort:function(i){return i===void 0?gE.call(Ri(this)):gE.call(Ri(this),ji(i))}});var bR=sr("Array").sort,mE=Array.prototype,ol=function(i){var r=i.sort;return i===mE||i instanceof Array&&r===mE.sort?bR:r};Fe({target:"Array",stat:!0},{isArray:xs});var D,Wi=Bt.Array.isArray;(function(i){i.UNEXPECTED_ERROR="UNEXPECTED_ERROR",i.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",i.TIMEOUT="TIMEOUT",i.INVALID_PARAMS="INVALID_PARAMS",i.NOT_READABLE="NOT_READABLE",i.NOT_SUPPORTED="NOT_SUPPORTED",i.INVALID_OPERATION="INVALID_OPERATION",i.OPERATION_ABORTED="OPERATION_ABORTED",i.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",i.NETWORK_ERROR="NETWORK_ERROR",i.NETWORK_TIMEOUT="NETWORK_TIMEOUT",i.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",i.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",i.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",i.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",i.ELECTRON_IS_NULL="ELECTRON_IS_NULL",i.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",i.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",i.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",i.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",i.PERMISSION_DENIED="PERMISSION_DENIED",i.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",i.TRACK_IS_DISABLED="TRACK_IS_DISABLED",i.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",i.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",i.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",i.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",i.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",i.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",i.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",i.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",i.UID_CONFLICT="UID_CONFLICT",i.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",i.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",i.INVALID_TRACK="INVALID_TRACK",i.SENDER_NOT_FOUND="SENDER_NOT_FOUND",i.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",i.SET_ANSWER_FAILED="SET_ANSWER_FAILED",i.ICE_FAILED="ICE_FAILED",i.PC_CLOSED="PC_CLOSED",i.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",i.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",i.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",i.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",i.CAN_NOT_PUBLISH_MULTIPLE_AUDIO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_AUDIO_TRACKS",i.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",i.INVALID_REMOTE_USER="INVALID_REMOTE_USER",i.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",i.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",i.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",i.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",i.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",i.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",i.WS_ABORT="WS_ABORT",i.WS_DISCONNECT="WS_DISCONNECT",i.WS_ERR="WS_ERR",i.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",i.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",i.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",i.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",i.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",i.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",i.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",i.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",i.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",i.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",i.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",i.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",i.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",i.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",i.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",i.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",i.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",i.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",i.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",i.INVALID_PLUGIN="INVALID_PLUGIN"})(D||(D={}));var DR=[].slice,BR=/MSIE .\./.test(Jc),vE=function(i){return function(r,s){var c=2<arguments.length,u=c?DR.call(arguments,2):void 0;return i(c?function(){(typeof r=="function"?r:Function(r)).apply(this,u)}:r,s)}};Fe({global:!0,bind:!0,forced:BR},{setTimeout:vE(Ve.setTimeout),setInterval:vE(Ve.setInterval)});var ai=Bt.setTimeout;Fe({target:"Date",stat:!0},{now:function(){return new Date().getTime()}});var de=Bt.Date.now,EE=function(i,r){return function(){for(var s=Array(arguments.length),c=0;c<s.length;c++)s[c]=arguments[c];return i.apply(r,s)}},qa=Object.prototype.toString,He={isArray:ft,isArrayBuffer:function(i){return qa.call(i)==="[object ArrayBuffer]"},isBuffer:function(i){return i!=null&&i.constructor!=null&&typeof i.constructor.isBuffer=="function"&&i.constructor.isBuffer(i)},isFormData:function(i){return typeof FormData!="undefined"&&i instanceof FormData},isArrayBufferView:function(i){return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?ArrayBuffer.isView(i):i&&i.buffer&&i.buffer instanceof ArrayBuffer},isString:function(i){return typeof i=="string"},isNumber:function(i){return typeof i=="number"},isObject:Fr,isUndefined:function(i){return i===void 0},isDate:function(i){return qa.call(i)==="[object Date]"},isFile:function(i){return qa.call(i)==="[object File]"},isBlob:function(i){return qa.call(i)==="[object Blob]"},isFunction:Sn,isStream:function(i){return Fr(i)&&Sn(i.pipe)},isURLSearchParams:function(i){return typeof URLSearchParams!="undefined"&&i instanceof URLSearchParams},isStandardBrowserEnv:function(){return(typeof navigator=="undefined"||navigator.product!=="ReactNative"&&navigator.product!=="NativeScript"&&navigator.product!=="NS")&&typeof window!="undefined"&&typeof document!="undefined"},forEach:Vi,merge:function i(){function r(h,A){typeof s[A]=="object"&&typeof h=="object"?s[A]=i(s[A],h):s[A]=h}for(var s={},c=0,u=arguments.length;c<u;c++)Vi(arguments[c],r);return s},deepMerge:function i(){function r(h,A){typeof s[A]=="object"&&typeof h=="object"?s[A]=i(s[A],h):s[A]=typeof h=="object"?i({},h):h}for(var s={},c=0,u=arguments.length;c<u;c++)Vi(arguments[c],r);return s},extend:function(i,r,s){return Vi(r,function(c,u){i[u]=s&&typeof c=="function"?EE(c,s):c}),i},trim:function(i){return i.replace(/^\s*/,"").replace(/\s*$/,"")}},IE=function(i,r,s){if(!r)return i;if(s)r=s(r);else if(He.isURLSearchParams(r))r=r.toString();else{var c=[];He.forEach(r,function(u,h){u!=null&&(He.isArray(u)?h+="[]":u=[u],He.forEach(u,function(A){He.isDate(A)?A=A.toISOString():He.isObject(A)&&(A=JSON.stringify(A)),c.push(Uc(h)+"="+Uc(A))}))}),r=c.join("&")}return r&&(s=i.indexOf("#"),s!==-1&&(i=i.slice(0,s)),i+=(i.indexOf("?")===-1?"?":"&")+r),i};yi.prototype.use=function(i,r){return this.handlers.push({fulfilled:i,rejected:r}),this.handlers.length-1},yi.prototype.eject=function(i){this.handlers[i]&&(this.handlers[i]=null)},yi.prototype.forEach=function(i){He.forEach(this.handlers,function(r){r!==null&&i(r)})};var CE=yi,yp=function(i,r,s){return He.forEach(s,function(c){i=c(i,r)}),i},yE=function(i){return!(!i||!i.__CANCEL__)},_E=function(i,r){He.forEach(i,function(s,c){c!==r&&c.toUpperCase()===r.toUpperCase()&&(i[r]=s,delete i[c])})},Wu=function(i,r,s,c,u){return function(h,A,f,m,I){return h.config=A,f&&(h.code=f),h.request=m,h.response=I,h.isAxiosError=!0,h.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},h}(Error(i),r,s,c,u)},MR="age authorization content-length content-type etag expires from host if-modified-since if-unmodified-since last-modified location max-forwards proxy-authorization referer retry-after user-agent".split(" "),LR=He.isStandardBrowserEnv()?function(){function i(u){return s&&(c.setAttribute("href",u),u=c.href),c.setAttribute("href",u),{href:c.href,protocol:c.protocol?c.protocol.replace(/:$/,""):"",host:c.host,search:c.search?c.search.replace(/^\?/,""):"",hash:c.hash?c.hash.replace(/^#/,""):"",hostname:c.hostname,port:c.port,pathname:c.pathname.charAt(0)==="/"?c.pathname:"/"+c.pathname}}var r,s=/(msie|trident)/i.test(navigator.userAgent),c=document.createElement("a");return r=i(window.location.href),function(u){return u=He.isString(u)?i(u):u,u.protocol===r.protocol&&u.host===r.host}}():function(){return!0},PR=He.isStandardBrowserEnv()?{write:function(i,r,s,c,u,h){var A=[];A.push(i+"="+encodeURIComponent(r)),He.isNumber(s)&&A.push("expires="+new Date(s).toGMTString()),He.isString(c)&&A.push("path="+c),He.isString(u)&&A.push("domain="+u),h===!0&&A.push("secure"),document.cookie=A.join("; ")},read:function(i){return(i=document.cookie.match(new RegExp("(^|;\\s*)("+i+")=([^;]*)")))?decodeURIComponent(i[3]):null},remove:function(i){this.write(i,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},QR=function(i){return new Promise(function(r,s){var c=i.data,u=i.headers;He.isFormData(c)&&delete u["Content-Type"];var h=new XMLHttpRequest;if(i.auth&&(u.Authorization="Basic "+btoa((i.auth.username||"")+":"+(i.auth.password||""))),h.open(i.method.toUpperCase(),IE(i.url,i.params,i.paramsSerializer),!0),h.timeout=i.timeout,h.onreadystatechange=function(){if(h&&h.readyState===4&&(h.status!==0||h.responseURL&&h.responseURL.indexOf("file:")===0)){var f,m,I,E,_,S="getAllResponseHeaders"in h?(f=h.getAllResponseHeaders(),_={},f&&He.forEach(f.split(`
`),function(N){E=N.indexOf(":"),m=He.trim(N.substr(0,E)).toLowerCase(),I=He.trim(N.substr(E+1)),!m||_[m]&&0<=MR.indexOf(m)||(_[m]=m==="set-cookie"?(_[m]?_[m]:[]).concat([I]):_[m]?_[m]+", "+I:I)}),_):null;(function(N,k,B){var P=B.config.validateStatus;!P||P(B.status)?N(B):k(Wu("Request failed with status code "+B.status,B.config,null,B.request,B))})(r,s,{data:i.responseType&&i.responseType!=="text"?h.response:h.responseText,status:h.status,statusText:h.statusText,headers:S,config:i,request:h}),h=null}},h.onabort=function(){h&&(s(Wu("Request aborted",i,"ECONNABORTED",h)),h=null)},h.onerror=function(){s(Wu("Network Error",i,null,h)),h=null},h.ontimeout=function(){s(Wu("timeout of "+i.timeout+"ms exceeded",i,"ECONNABORTED",h)),h=null},He.isStandardBrowserEnv()){var A=(i.withCredentials||LR(i.url))&&i.xsrfCookieName?PR.read(i.xsrfCookieName):void 0;A&&(u[i.xsrfHeaderName]=A)}if("setRequestHeader"in h&&He.forEach(u,function(f,m){c===void 0&&m.toLowerCase()==="content-type"?delete u[m]:h.setRequestHeader(m,f)}),i.withCredentials&&(h.withCredentials=!0),i.responseType)try{h.responseType=i.responseType}catch(f){if(i.responseType!=="json")throw f}typeof i.onDownloadProgress=="function"&&h.addEventListener("progress",i.onDownloadProgress),typeof i.onUploadProgress=="function"&&h.upload&&h.upload.addEventListener("progress",i.onUploadProgress),i.cancelToken&&i.cancelToken.promise.then(function(f){h&&(h.abort(),s(f),h=null)}),c===void 0&&(c=null),h.send(c)})},xR={"Content-Type":"application/x-www-form-urlencoded"},Yu={adapter:function(){var i;return(typeof process!="undefined"&&Object.prototype.toString.call(process)==="[object process]"||typeof XMLHttpRequest!="undefined")&&(i=QR),i}(),transformRequest:[function(i,r){return _E(r,"Accept"),_E(r,"Content-Type"),He.isFormData(i)||He.isArrayBuffer(i)||He.isBuffer(i)||He.isStream(i)||He.isFile(i)||He.isBlob(i)?i:He.isArrayBufferView(i)?i.buffer:He.isURLSearchParams(i)?(Ta(r,"application/x-www-form-urlencoded;charset=utf-8"),i.toString()):He.isObject(i)?(Ta(r,"application/json;charset=utf-8"),JSON.stringify(i)):i}],transformResponse:[function(i){if(typeof i=="string")try{i=JSON.parse(i)}catch{}return i}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(i){return 200<=i&&300>i},headers:{common:{Accept:"application/json, text/plain, */*"}}};He.forEach(["delete","get","head"],function(i){Yu.headers[i]={}}),He.forEach(["post","put","patch"],function(i){Yu.headers[i]=He.merge(xR)});var UR=function(i){var r,s;return i.cancelToken&&i.cancelToken.throwIfRequested(),i.baseURL&&!/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(i.url)&&(i.url=(r=i.baseURL,(s=i.url)?r.replace(/\/+$/,"")+"/"+s.replace(/^\/+/,""):r)),i.headers=i.headers||{},i.data=yp(i.data,i.headers,i.transformRequest),i.headers=He.merge(i.headers.common||{},i.headers[i.method]||{},i.headers||{}),He.forEach("delete get head post put patch common".split(" "),function(c){delete i.headers[c]}),(i.adapter||Yu.adapter)(i).then(function(c){return i.cancelToken&&i.cancelToken.throwIfRequested(),c.data=yp(c.data,c.headers,i.transformResponse),c},function(c){return yE(c)||(i.cancelToken&&i.cancelToken.throwIfRequested(),c&&c.response&&(c.response.data=yp(c.response.data,c.response.headers,i.transformResponse))),Promise.reject(c)})},_p=function(i,r){r=r||{};var s={};return He.forEach(["url","method","params","data"],function(c){r[c]!==void 0&&(s[c]=r[c])}),He.forEach(["headers","auth","proxy"],function(c){He.isObject(r[c])?s[c]=He.deepMerge(i[c],r[c]):r[c]!==void 0?s[c]=r[c]:He.isObject(i[c])?s[c]=He.deepMerge(i[c]):i[c]!==void 0&&(s[c]=i[c])}),He.forEach("baseURL transformRequest transformResponse paramsSerializer timeout withCredentials adapter responseType xsrfCookieName xsrfHeaderName onUploadProgress onDownloadProgress maxContentLength validateStatus maxRedirects httpAgent httpsAgent cancelToken socketPath".split(" "),function(c){r[c]!==void 0?s[c]=r[c]:i[c]!==void 0&&(s[c]=i[c])}),s};lo.prototype.request=function(i,r){typeof i=="string"?(i=r||{}).url=i:i=i||{},(i=_p(this.defaults,i)).method=i.method?i.method.toLowerCase():"get";var s=[UR,void 0];for(i=Promise.resolve(i),this.interceptors.request.forEach(function(c){s.unshift(c.fulfilled,c.rejected)}),this.interceptors.response.forEach(function(c){s.push(c.fulfilled,c.rejected)});s.length;)i=i.then(s.shift(),s.shift());return i},lo.prototype.getUri=function(i){return i=_p(this.defaults,i),IE(i.url,i.params,i.paramsSerializer).replace(/^\?/,"")},He.forEach(["delete","get","head","options"],function(i){lo.prototype[i]=function(r,s){return this.request(He.merge(s||{},{method:i,url:r}))}}),He.forEach(["post","put","patch"],function(i){lo.prototype[i]=function(r,s,c){return this.request(He.merge(c||{},{method:i,url:r,data:s}))}});var qu=lo;uo.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},uo.prototype.__CANCEL__=!0;var SE=uo;Ra.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},Ra.source=function(){var i;return{token:new Ra(function(r){i=r}),cancel:i}};var go=wa(Yu);go.Axios=qu,go.create=function(i){return wa(_p(go.defaults,i))},go.Cancel=SE,go.CancelToken=Ra,go.isCancel=yE,go.all=function(i){return Promise.all(i)},go.spread=function(i){return function(r){return i.apply(null,r)}};var mo=go.default=go;let wi={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},TE=de(),RE=i=>{for(const r in wi)if(Object.prototype.hasOwnProperty.call(wi,r)&&wi[r]===i)return r;return"DEFAULT"},R=new class{constructor(){this.logLevel=wi.DEBUG,this.uploadState="collecting",this.uploadLogWaitingList=[],this.uploadLogUploadingList=[],this.currentLogID=this.uploadErrorCount=0}debug(...i){var r;i=b(r=[wi.DEBUG]).call(r,i),this.log.apply(this,i)}info(...i){var r;i=b(r=[wi.INFO]).call(r,i),this.log.apply(this,i)}warning(...i){var r;i=b(r=[wi.WARNING]).call(r,i),this.log.apply(this,i)}error(...i){var r;i=b(r=[wi.ERROR]).call(r,i),this.log.apply(this,i)}setLogLevel(i){this.logLevel=i=Math.min(Math.max(0,i),4)}enableLogUpload(){Ur("UPLOAD_LOG",!0)}disableLogUpload(){Ur("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(i){this.proxyServerURL=i}log(...i){var r,s,c,u;if(100>de()-TE)return void ai(()=>{this.log(...i)},de()-TE);const h=Math.max(0,Math.min(4,i[0]));if(i[0]=Ms()+" Agora-SDK [".concat(RE(h),"]:"),this.appendLogToWaitingList(h,i),!(h<this.logLevel)){var A=Ms()+" %cAgora-SDK [".concat(RE(h),"]:"),f=[];switch(h){case wi.DEBUG:f=b(r=[A,"color: #64B5F6;"]).call(r,Mr(i).call(i,1)),console.log.apply(console,f);break;case wi.INFO:f=b(s=[A,"color: #1E88E5; font-weight: bold;"]).call(s,Mr(i).call(i,1)),console.log.apply(console,f);break;case wi.WARNING:f=b(c=[A,"color: #FB8C00; font-weight: bold;"]).call(c,Mr(i).call(i,1)),console.warn.apply(console,f);break;case wi.ERROR:f=b(u=[A,"color: #B00020; font-weight: bold;"]).call(u,Mr(i).call(i,1)),console.error.apply(console,f)}}}appendLogToWaitingList(i,...r){if(ne.UPLOAD_LOG){var s="";W(r).call(r,c=>{typeof c=="object"&&(c=fe(c)),s+="".concat(c," ")}),this.uploadLogWaitingList.push({payload_str:s,log_level:i,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){var i,r={sdk_version:Hn,process_id:ne.PROCESS_ID,payload:fe(this.uploadLogUploadingList)};if(r=await mo.post(this.url||(this.proxyServerURL?b(i="https://".concat(this.proxyServerURL,"/ls/?h=")).call(i,ne.LOG_UPLOAD_SERVER,"&p=443&d=upload/v1"):"https://".concat(ne.LOG_UPLOAD_SERVER,"/upload/v1")),r,{responseType:"text"}),r.data!=="OK")throw Error("unexpected upload log response: "+r.data);this.uploadLogUploadingList=[]}uploadLogInterval(){if(this.uploadLogUploadingList.length!==0||this.uploadLogWaitingList.length!==0){var i;this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=Gr(i=this.uploadLogWaitingList).call(i,0,10)),this.uploadLogs().then(()=>{this.uploadErrorCount=0,0<this.uploadLogWaitingList.length&&window.setTimeout(()=>this.uploadLogInterval(),3e3)}).catch(r=>{this.uploadErrorCount+=1,2>this.uploadErrorCount?window.setTimeout(()=>this.uploadLogInterval(),200):window.setTimeout(()=>this.uploadLogInterval(),1e3)})}}};class L{constructor(r,s="",c){var u;this.name="AgoraRTCException",this.code=r,this.message=b(u="AgoraRTCError ".concat(this.code,": ")).call(u,s),this.data=c}toString(){var r;return this.data?b(r="".concat(this.message," data: ")).call(r,fe(this.data)):this.message}print(r="error"){return r==="error"&&R.error(this.toString()),r==="warning"&&R.warning(this.toString()),this}throw(){throw this.print(),this}}var wE,Qr;(function(i){i.FREE="free",i.UPLOADING="uploading"})(wE||(wE={})),function(i){i.NONE="none",i.INIT="init",i.CANPLAY="canplay",i.PLAYING="playing",i.PAUSED="paused",i.SUSPEND="suspend",i.STALLED="stalled",i.WAITING="waiting",i.ERROR="error",i.DESTROYED="destroyed",i.ABORT="abort",i.ENDED="ended",i.EMPTIED="emptied"}(Qr||(Qr={})),Fe({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991}),Fe({target:"Number",stat:!0},{MIN_SAFE_INTEGER:-9007199254740991});let FR={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};var jr,Jt,NE,we,Re,Ys,Uo,Ja,sl,Kn,Hr,ke,qe,Rn,hr,Xe,Tt,Ni,mt,De,ki;(function(i){i.PUBLISH="publish",i.SUBSCRIBE="subscribe",i.SESSION_INIT="session_init",i.JOIN_CHOOSE_SERVER="join_choose_server",i.REQ_USER_ACCOUNT="req_user_account",i.JOIN_GATEWAY="join_gateway",i.STREAM_SWITCH="stream_switch",i.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",i.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",i.FIRST_VIDEO_RECEIVED="first_video_received",i.FIRST_AUDIO_RECEIVED="first_audio_received",i.FIRST_VIDEO_DECODE="first_video_decode",i.FIRST_AUDIO_DECODE="first_audio_decode",i.ON_ADD_AUDIO_STREAM="on_add_audio_stream",i.ON_ADD_VIDEO_STREAM="on_add_video_stream",i.ON_UPDATE_STREAM="on_update_stream",i.ON_REMOVE_STREAM="on_remove_stream",i.USER_ANALYTICS="req_user_analytics"})(jr||(jr={})),function(i){i.SESSION="io.agora.pb.Wrtc.Session",i.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",i.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",i.JOIN_GATEWAT="io.agora.pb.Wrtc.JoinGateway",i.PUBLISH="io.agora.pb.Wrtc.Publish",i.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",i.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",i.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",i.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",i.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",i.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",i.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",i.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",i.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",i.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",i.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",i.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",i.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",i.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",i.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",i.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",i.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",i.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",i.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",i.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",i.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",i.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics"}(Jt||(Jt={})),function(i){i[i.WORKER_EVENT=156]="WORKER_EVENT",i[i.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}(NE||(NE={})),function(i){i.CREATE_CLIENT="createClient",i.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",i.SET_AREA="setArea",i.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",i.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",i.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",i.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",i.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",i.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",i.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",i.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",i.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",i.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",i.START_PROXY_SERVER="Client.startProxyServer",i.STOP_PROXY_SERVER="Client.stopProxyServer",i.SET_PROXY_SERVER="Client.setProxyServer",i.SET_TURN_SERVER="Client.setTurnServer",i.SET_CLIENT_ROLE="Client.setClientRole",i.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",i.ENABLE_DUAL_STREAM="Client.enableDualStream",i.DISABLE_DUAL_STREAM="Client.disableDualStream",i.JOIN="Client.join",i.LEAVE="Client.leave",i.PUBLISH="Client.publish",i.UNPUBLISH="Client.unpublish",i.SUBSCRIBE="Client.subscribe",i.UNSUBSCRIBE="Client.unsubscribe",i.RENEW_TOKEN="Client.renewToken",i.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",i.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",i.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",i.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",i.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",i.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",i.START_LIVE_STREAMING="Client.startLiveStreaming",i.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",i.STOP_LIVE_STREAMING="Client.stopLiveStreaming",i.ADD_INJECT_STREAM_URL="Client.addInjectStreamUrl",i.REMOVE_INJECT_STREAM_URL="Client.removeInjectStreamUrl",i.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",i.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",i.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",i.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",i.SET_CONFIG_DISTRIBUTE="_configDistribute",i.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",i.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",i.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",i.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",i.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",i.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",i.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",i.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",i.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",i.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",i.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",i.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",i.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",i.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",i.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",i.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",i.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",i.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",i.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",i.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",i.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",i.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",i.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",i.STREAM_TYPE_CHANGE="streamTypeChange"}(we||(we={})),(Re||(Re={})).TRACER="tracer",function(i){i.IDLE="IDLE",i.INITING="INITING",i.INITEND="INITEND"}(Ys||(Ys={})),function(i){i.STATE_CHANGE="state_change",i.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",i.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",i.CAMERA_DEVICE_CHANGED="cameraDeviceChanged"}(Uo||(Uo={})),function(i){i[i.ACCESS_POINT=101]="ACCESS_POINT",i[i.UNILBS=201]="UNILBS",i[i.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR"}(Ja||(Ja={})),function(i){i[i.IIIEGAL_APPID=1]="IIIEGAL_APPID",i[i.IIIEGAL_UID=2]="IIIEGAL_UID",i[i.INTERNAL_ERROR=3]="INTERNAL_ERROR"}(sl||(sl={})),function(i){i[i.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",i[i.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",i[i.INTERNAL_ERROR=8]="INTERNAL_ERROR",i[i.NO_AUTHORIZED=9]="NO_AUTHORIZED",i[i.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",i[i.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",i[i.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",i[i.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",i[i.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",i[i.USER_OVERLOAD=16]="USER_OVERLOAD",i[i.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",i[i.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND"}(Kn||(Kn={})),function(i){i[i.NO_FLAG_SET=100]="NO_FLAG_SET",i[i.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",i[i.INVALID_FALG_SET=102]="INVALID_FALG_SET",i[i.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",i[i.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",i[i.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",i[i.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",i[i.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",i[i.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",i[i.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",i[i.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",i[i.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",i[i.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",i[i.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",i[i.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",i[i.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",i[i.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV"}(Hr||(Hr={})),function(i){i[i.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",i[i.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",i[i.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",i[i.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",i[i.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",i[i.K_TICKET_INVALID=7]="K_TICKET_INVALID",i[i.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",i[i.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",i[i.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",i[i.K_UID_BANNED=14]="K_UID_BANNED",i[i.K_IP_BANNED=15]="K_IP_BANNED",i[i.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",i[i.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",i[i.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",i[i.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",i[i.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",i[i.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",i[i.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",i[i.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",i[i.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",i[i.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",i[i.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",i[i.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",i[i.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",i[i.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",i[i.ERR_INVALID_UID=117]="ERR_INVALID_UID",i[i.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",i[i.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",i[i.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",i[i.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",i[i.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",i[i.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",i[i.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",i[i.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",i[i.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",i[i.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",i[i.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",i[i.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",i[i.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",i[i.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",i[i.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",i[i.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",i[i.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",i[i.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",i[i.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",i[i.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",i[i.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",i[i.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",i[i.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",i[i.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",i[i.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",i[i.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",i[i.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",i[i.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",i[i.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY"}(ke||(ke={})),function(i){i.CONNECTION_STATE_CHANGE="connection-state-change",i.MEDIA_RECONNECT_START="media-reconnect-start",i.MEDIA_RECONNECT_END="media-reconnect-end",i.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",i.USER_JOINED="user-joined",i.USER_LEAVED="user-left",i.USER_PUBLISHED="user-published",i.USER_UNPUBLISHED="user-unpublished",i.USER_INFO_UPDATED="user-info-updated",i.CLIENT_BANNED="client-banned",i.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",i.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",i.VOLUME_INDICATOR="volume-indicator",i.CRYPT_ERROR="crypt-error",i.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",i.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",i.NETWORK_QUALITY="network-quality",i.STREAM_TYPE_CHANGED="stream-type-changed",i.STREAM_FALLBACK="stream-fallback",i.RECEIVE_METADATA="receive-metadata",i.STREAM_MESSAGE="stream-message",i.LIVE_STREAMING_ERROR="live-streaming-error",i.LIVE_STREAMING_WARNING="live-streaming-warning",i.INJECT_STREAM_STATUS="stream-inject-status",i.EXCEPTION="exception",i.ERROR="error",i.P2P_LOST="p2p_lost"}(qe||(qe={})),function(i){i.NETWORK_ERROR="NETWORK_ERROR",i.SERVER_ERROR="SERVER_ERROR",i.MULTI_IP="MULTI_IP",i.TIMEOUT="TIMEOUT",i.OFFLINE="OFFLINE",i.LEAVE="LEAVE"}(Rn||(Rn={})),function(i){i.CONNECTING="connecting",i.CONNECTED="connected",i.RECONNECTING="reconnecting",i.CLOSED="closed"}(hr||(hr={})),function(i){i.WS_CONNECTED="ws_connected",i.WS_RECONNECTING="ws_reconnecting",i.WS_CLOSED="ws_closed",i.ON_BINARY_DATA="on_binary_data",i.REQUEST_RECOVER="request_recover",i.REQUEST_JOIN_INFO="request_join_info",i.REQUEST_REJOIN_INFO="req_rejoin_info",i.IS_P2P_DISCONNECTED="is_p2p_dis",i.DISCONNECT_P2P="dis_p2p",i.NEED_RENEW_SESSION="need-sid",i.REPORT_JOIN_GATEWAY="report_join_gateway",i.REQUEST_TIMEOUT="request_timeout",i.REQUEST_SUCCESS="request_success"}(Xe||(Xe={})),function(i){i.PING="ping",i.PING_BACK="ping_back",i.JOIN="join_v2",i.REJOIN="rejoin",i.LEAVE="leave",i.SET_CLIENT_ROLE="set_client_role",i.PUBLISH="publish",i.UNPUBLISH="unpublish",i.SUBSCRIBE="subscribe",i.UNSUBSCRIBE="unsubscribe",i.SUBSCRIBE_CHANGE="subscribe_change",i.TRAFFIC_STATS="traffic_stats",i.RENEW_TOKEN="renew_token",i.SWITCH_VIDEO_STREAM="switch_video_stream",i.SET_FALLBACK_OPTION="set_fallback_option",i.GATEWAY_INFO="gateway_info",i.CONTROL="control",i.SEND_METADATA="send_metadata",i.DATA_STREAM="data_stream",i.PICK_SVC_LAYER="pick_svc_layer"}(Tt||(Tt={})),function(i){i.PUBLISH_STATS="publish_stats",i.PUBLISH_RELATED_STATS="publish_related_stats",i.SUBSCRIBE_STATS="subscribe_stats",i.SUBSCRIBE_RELATED_STATS="subscribe_related_stats",i.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length"}(Ni||(Ni={})),function(i){i.ON_USER_ONLINE="on_user_online",i.ON_USER_OFFLINE="on_user_offline",i.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",i.ON_PUBLISH_STREAM="on_publish_stream",i.ON_UPLINK_STATS="on_uplink_stats",i.ON_P2P_LOST="on_p2p_lost",i.ON_REMOVE_STREAM="on_remove_stream",i.ON_ADD_AUDIO_STREAM="on_add_audio_stream",i.ON_ADD_VIDEO_STREAM="on_add_video_stream",i.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",i.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",i.ON_USER_BANNED="on_user_banned",i.ON_NOTIFICATION="on_notification",i.ON_CRYPT_ERROR="on_crypt_error",i.MUTE_AUDIO="mute_audio",i.MUTE_VIDEO="mute_video",i.UNMUTE_AUDIO="unmute_audio",i.UNMUTE_VIDEO="unmute_video",i.RECEIVE_METADATA="receive_metadata",i.ON_DATA_STREAM="on_data_stream",i.ENABLE_LOCAL_VIDEO="enable_local_video",i.DISABLE_LOCAL_VIDEO="disable_local_video",i.ENABLE_LOCAL_AUDIO="enable_local_audio",i.DISABLE_LOCAL_AUDIO="disable_local_audio"}(mt||(mt={})),function(i){i.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",i.NEED_ANSWER="NEED_ANSWER",i.NEED_RENEGOTIATE="NEED_RENEGOTIATE",i.P2P_LOST="P2P_LOST",i.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",i.NEED_UNPUB="NEED_UNPUB",i.NEED_UNSUB="NEED_UNSUB",i.NEED_UPLOAD="NEED_UPLOAD",i.NEED_CONTROL="NEED_CONTROL",i.START_RECONNECT="START_RECONNECT",i.END_RECONNECT="END_RECONNECT",i.NEED_SIGNAL_RTT="NEED_SIGNAL_RTT"}(De||(De={})),function(i){i.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",i.RECEIVE_TRACK_BUFFER="receive_track_buffer",i.ON_AUDIO_BUFFER="on_audio_buffer"}(ki||(ki={}));let Ju={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,currentPacketLossRate:0},zu={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},Sp={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},kE={uplinkNetworkQuality:0,downlinkNetworkQuality:0},Tp={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};var lt,Zt;(function(i){i.CONNECTED="websocket:connected",i.RECONNECTING="websocket:reconnecting",i.WILL_RECONNECT="websocket:will_reconnect",i.CLOSED="websocket:closed",i.FAILED="websocket:failed",i.ON_MESSAGE="websocket:on_message",i.REQUEST_NEW_URLS="websocket:request_new_urls"})(lt||(lt={})),function(i){i.TRANSCODE="mix_streaming",i.RAW="raw_streaming",i.INJECT="inject_streaming"}(Zt||(Zt={}));let VR={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},Rp={x:0,y:0,width:160,height:160,zOrder:255,alpha:1},GR={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},jR={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};var Oi,za,Ft,OE,Kr,_r,Me,Yi,qs,al;(function(i){i.WARNING="@live_uap-warning",i.ERROR="@line_uap-error",i.PUBLISH_STREAM_STATUS="@live_uap-publish-status",i.INJECT_STREAM_STATUS="@live_uap-inject-status",i.WORKER_STATUS="@live_uap-worker-status",i.REQUEST_NEW_ADDRESS="@live_uap-request-address"})(Oi||(Oi={})),(za||(za={})).REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",function(i){i[i.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",i[i.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",i[i.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",i[i.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",i[i.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",i[i.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",i[i.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",i[i.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",i[i.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",i[i.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",i[i.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",i[i.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",i[i.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",i[i.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",i[i.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",i[i.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",i[i.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",i[i.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",i[i.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",i[i.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",i[i.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(Ft||(Ft={})),function(i){i.CONNECT_FAILED="connect failed",i.CONNECT_TIMEOUT="connect timeout",i.WS_DISCONNECTED="websocket disconnected",i.REQUEST_TIMEOUT="request timeout",i.REQUEST_FAILED="request failed",i.WAIT_STATUS_TIMEOUT="wait status timeout",i.WAIT_STATUS_ERROR="wait status error",i.BAD_STATE="bad state",i.WS_ABORT="ws abort",i.AP_REQUEST_TIMEOUT="AP request timeout",i.AP_JSON_PARSE_ERROR="AP json parse error",i.AP_REQUEST_ERROR="AP request error",i.AP_REQUEST_ABORT="AP request abort"}(OE||(OE={})),function(i){i[i.SetSdkProfile=0]="SetSdkProfile",i[i.SetSourceChannel=1]="SetSourceChannel",i[i.SetSourceUserId=2]="SetSourceUserId",i[i.SetDestChannel=3]="SetDestChannel",i[i.StartPacketTransfer=4]="StartPacketTransfer",i[i.StopPacketTransfer=5]="StopPacketTransfer",i[i.UpdateDestChannel=6]="UpdateDestChannel",i[i.Reconnect=7]="Reconnect",i[i.SetVideoProfile=8]="SetVideoProfile"}(Kr||(Kr={})),function(i){i.DISCONNECT="disconnect",i.CONNECTION_STATE_CHANGE="connection-state-change",i.NETWORK_QUALITY="network-quality",i.STREAM_TYPE_CHANGE="stream-type-change",i.IS_P2P_DISCONNECTED="is-p2p-dis",i.DISCONNECT_P2P="dis-p2p",i.REQUEST_NEW_GATEWAY_LIST="req-gate-url",i.NEED_RENEW_SESSION="need-sid"}(_r||(_r={})),function(i){i.NEED_RENEGOTIATE="@need_renegotiate",i.NEED_REPLACE_TRACK="@need_replace_track",i.NEED_CLOSE="@need_close",i.NEED_ADD_TRACK="@need_add_track",i.NEED_REMOVE_TRACK="@need_remove_track",i.NEED_SESSION_ID="@need_sid",i.SET_OPTIMIZATION_MODE="@set_optimization_mode",i.GET_STATS="@get_stats",i.GET_LOW_VIDEO_TRACK="@get_low_video_track",i.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",i.SET_VIDEO_TRACK_MUTED="@set_video_track_muted",i.SET_AUDIO_TRACK_MUTED="@set_audio_track_muted"}(Me||(Me={})),function(i){i.SCREEN_TRACK="screen_track",i.LOW_STREAM="low_stream"}(Yi||(Yi={})),function(i){i.SOURCE_STATE_CHANGE="source-state-change",i.TRACK_ENDED="track-ended",i.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload"}(qs||(qs={})),(al||(al={})).FIRST_FRAME_DECODED="first-frame-decoded";let bE="AFRICA ASIA CHINA EUROPE GLOBAL INDIA JAPAN NORTH_AMERICA OCEANIA OVERSEA SOUTH_AMERICA".split(" ");var Sr;(function(i){i.CHINA="CN",i.ASIA="AS",i.NORTH_AMERICA="NA",i.EUROPE="EU",i.JAPAN="JP",i.INDIA="IN",i.OCEANIA="OC",i.SOUTH_AMERICA="SA",i.AFRICA="AF",i.OVERSEA="OVERSEA",i.GLOBAL="GLOBAL"})(Sr||(Sr={}));let wp={CHINA:{},ASIA:{CODE:Sr.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Sr.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Sr.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Sr.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","	uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Sr.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Sr.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Sr.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Sr.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Sr.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Sr.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]}};var cl,bi,Xa;Ip&&(wp.CHINA={CODE:Sr.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),(cl||(cl={})).UPDATE_BITRATE_LIMIT="update_bitrate_limit",function(i){i.ONLINE="ONLINE",i.OFFLINE="OFFLINE"}(bi||(bi={})),function(i){i.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",i.ONLINE="ONLINE",i.OFFLINE="OFFLINE"}(Xa||(Xa={}));let HR={join:["startJoin","startRequestAp","startJoinGateway","finishJoin"],publish:["startPublish"]},kt={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1};Fe({target:"Object",stat:!0,forced:!Ut,sham:!Ut},{defineProperties:Kh});var An=t(function(i){var r=Bt.Object;i=i.exports=function(s,c){return r.defineProperties(s,c)},r.defineProperties.sham&&(i.sham=!0)}),KR=Mu.concat("length","prototype"),Np={f:Object.getOwnPropertyNames||function(i){return Ym(i,KR)}},WR=Ki("Reflect","ownKeys")||function(i){var r=Np.f(Xr(i)),s=Zc.f;return s?r.concat(s(i)):r};Fe({target:"Object",stat:!0,sham:!Ut},{getOwnPropertyDescriptors:function(i){var r,s;i=oi(i);for(var c=Ma,u=WR(i),h={},A=0;u.length>A;)(s=c(i,r=u[A++]))!==void 0&&Us(h,r,s);return h}});var Ot=Bt.Object.getOwnPropertyDescriptors,DE=Np.f,YR={}.toString,BE=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],ME=function(i){if(BE&&YR.call(i)=="[object Window]")try{var r=DE(i)}catch{r=BE.slice()}else r=DE(oi(i));return r},LE={f:or},qR=Ti.f,Wn=Du("hidden"),PE=or("toPrimitive"),JR=fr.set,QE=fr.getterFor("Symbol"),qi=Object.prototype,ci=Ve.Symbol,ll=Ki("JSON","stringify"),xE=Ma,us=Ti.f,UE=ME,zR=yu,Fo=Lo("symbols"),ul=Lo("op-symbols"),kp=Lo("string-to-symbol-registry"),Op=Lo("symbol-to-string-registry"),XR=Lo("wks"),bp=Ve.QObject,Dp=!bp||!bp.prototype||!bp.prototype.findChild,Bp=Ut&&ir(function(){return cs(us({},"a",{get:function(){return us(this,"a",{value:7}).a}})).a!=7})?function(i,r,s){var c=xE(qi,r);c&&delete qi[r],us(i,r,s),c&&i!==qi&&us(qi,r,c)}:us,FE=function(i,r){var s=Fo[i]=cs(ci.prototype);return JR(s,{type:"Symbol",tag:i,description:r}),Ut||(s.description=r),s},Mp=fo&&typeof ci.iterator=="symbol"?function(i){return typeof i=="symbol"}:function(i){return Object(i)instanceof ci},Xu=function(i,r,s){return i===qi&&Xu(ul,r,s),Xr(i),r=Da(r,!0),Xr(s),et(Fo,r)?(s.enumerable?(et(i,Wn)&&i[Wn][r]&&(i[Wn][r]=!1),s=cs(s,{enumerable:Mo(0,!1)})):(et(i,Wn)||us(i,Wn,Mo(1,{})),i[Wn][r]=!0),Bp(i,r,s)):us(i,r,s)},VE=function(i,r){Xr(i);var s=oi(r);return r=as(s).concat(Lp(s)),Va(r,function(c){Ut&&!GE.call(s,c)||Xu(i,c,s[c])}),i},GE=function(i){i=Da(i,!0);var r=zR.call(this,i);return!(this===qi&&et(Fo,i)&&!et(ul,i))&&(!(r||!et(this,i)||!et(Fo,i)||et(this,Wn)&&this[Wn][i])||r)},jE=function(i,r){if(i=oi(i),r=Da(r,!0),i!==qi||!et(Fo,r)||et(ul,r)){var s=xE(i,r);return!s||!et(Fo,r)||et(i,Wn)&&i[Wn][r]||(s.enumerable=!0),s}},HE=function(i){i=UE(oi(i));var r=[];return Va(i,function(s){et(Fo,s)||et(Qa,s)||r.push(s)}),r},Lp=function(i){var r=i===qi;i=UE(r?ul:oi(i));var s=[];return Va(i,function(c){!et(Fo,c)||r&&!et(qi,c)||s.push(Fo[c])}),s};if(fo||(Qo((ci=function(){if(this instanceof ci)throw TypeError("Symbol is not a constructor");var i=arguments.length&&arguments[0]!==void 0?String(arguments[0]):void 0,r=wu(i),s=function(c){this===qi&&s.call(ul,c),et(this,Wn)&&et(this[Wn],r)&&(this[Wn][r]=!1),Bp(this,r,Mo(1,c))};return Ut&&Dp&&Bp(qi,r,{configurable:!0,set:s}),FE(r,i)}).prototype,"toString",function(){return QE(this).tag}),yu=GE,Ti.f=Xu,Ma=jE,Np.f=ME=HE,Zc.f=Lp,Ut&&us(ci.prototype,"description",{configurable:!0,get:function(){return QE(this).description}})),km||(LE.f=function(i){return FE(or(i),i)}),Fe({global:!0,wrap:!0,forced:!fo,sham:!fo},{Symbol:ci}),Va(as(XR),function(i){var r=Bt.Symbol||(Bt.Symbol={});et(r,i)||qR(r,i,{value:LE.f(i)})}),Fe({target:"Symbol",stat:!0,forced:!fo},{for:function(i){if(i=String(i),et(kp,i))return kp[i];var r=ci(i);return kp[i]=r,Op[r]=i,r},keyFor:function(i){if(!Mp(i))throw TypeError(i+" is not a symbol");if(et(Op,i))return Op[i]},useSetter:function(){Dp=!0},useSimple:function(){Dp=!1}}),Fe({target:"Object",stat:!0,forced:!fo,sham:!Ut},{create:function(i,r){return r===void 0?cs(i):VE(cs(i),r)},defineProperty:Xu,defineProperties:VE,getOwnPropertyDescriptor:jE}),Fe({target:"Object",stat:!0,forced:!fo},{getOwnPropertyNames:HE,getOwnPropertySymbols:Lp}),Fe({target:"Object",stat:!0,forced:ir(function(){Zc.f(1)})},{getOwnPropertySymbols:function(i){return Zc.f(Ri(i))}}),ll){var ZR=!fo||ir(function(){var i=ci();return ll([i])!="[null]"||ll({a:i})!="{}"||ll(Object(i))!="{}"});Fe({target:"JSON",stat:!0,forced:ZR},{stringify:function(i,r,s){for(var c,u=[i],h=1;arguments.length>h;)u.push(arguments[h++]);if(c=r,(Ht(r)||i!==void 0)&&!Mp(i))return xs(r)||(r=function(A,f){if(typeof c=="function"&&(f=c.call(this,A,f)),!Mp(f))return f}),u[1]=r,ll.apply(null,u)}})}ci.prototype[PE]||Hi(ci.prototype,PE,ci.prototype.valueOf),Fs(ci,"Symbol"),Qa[Wn]=!0;var bt=Bt.Object.getOwnPropertySymbols,fn,gn=function(i,r,s){return r in i?fv(i,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[r]=s,i};(function(i){i[i.CHOOSE_SERVER=11]="CHOOSE_SERVER",i[i.CLOUD_PROXY=18]="CLOUD_PROXY",i[i.CLOUD_PROXY_5=20]="CLOUD_PROXY_5"})(fn||(fn={}));var $R=sr("Array").values,KE=Array.prototype,e2={DOMTokenList:!0,NodeList:!0},Js=function(i){var r=i.values;return i===KE||i instanceof Array&&r===KE.values||e2.hasOwnProperty(xa(i))?$R:r},zs=function(i){var r=Ri(i),s=typeof this=="function"?this:Array,c=arguments.length,u=1<c?arguments[1]:void 0,h=u!==void 0,A=0,f=bu(r);if(h&&(u=ss(u,2<c?arguments[2]:void 0,2)),f==null||s==Array&&Lm(f))for(s=new s(c=si(r.length));c>A;A++)Us(s,A,h?u(r[A],A):r[A]);else for(c=(r=f.call(r)).next,s=new s;!(f=c.call(r)).done;A++)Us(s,A,h?Qm(r,u,[f.value,A],!0):f.value);return s.length=A,s},t2=!Rv(function(i){Array.from(i)});Fe({target:"Array",stat:!0,forced:t2},{from:zs});var Ji=Bt.Array.from;class Wr{constructor(){this._events={},this.addListener=this.on}getListeners(r){var s;return this._events[r]?Ie(s=this._events[r]).call(s,c=>c.listener):[]}on(r,s){this._events[r]||(this._events[r]=[]),r=this._events[r],this._indexOfListener(r,s)===-1&&r.push({listener:s,once:!1})}once(r,s){this._events[r]||(this._events[r]=[]),r=this._events[r],this._indexOfListener(r,s)===-1&&r.push({listener:s,once:!0})}off(r,s){if(this._events[r]){var c=this._events[r];s=this._indexOfListener(c,s),s!==-1&&Gr(c).call(c,s,1),this._events[r].length===0&&delete this._events[r]}}removeAllListeners(r){r?delete this._events[r]:this._events={}}emit(r,...s){var c;this._events[r]||(this._events[r]=[]);let u=Ie(c=this._events[r]).call(c,h=>h);for(c=0;c<u.length;c+=1){let h=u[c];h.once&&this.off(r,h.listener),h.listener.apply(this,s||[])}}_indexOfListener(r,s){let c=r.length;for(;c--;)if(r[c].listener===s)return c;return-1}}let Zu=0,Pp=0,Yn=new class extends Wr{constructor(){super();this._moduleName="network-indicator",this._networkState=bi.ONLINE,window.addEventListener("online",()=>{this.networkState=bi.ONLINE}),window.addEventListener("offline",()=>{this.networkState=bi.OFFLINE})}set networkState(i){R.info("[".concat(this._moduleName,"]")+"network state changed, "+this._networkState+" -> "+i),this.emit(Xa.NETWORK_STATE_CHANGE,i,this._networkState),i===bi.ONLINE?this.emit(Xa.ONLINE):i===bi.OFFLINE&&(this.onlineWaiter=new ce(r=>{this.once(Xa.ONLINE,()=>{this.onlineWaiter=void 0,r(bi.ONLINE)})}),this.emit(Xa.OFFLINE)),this._networkState=i}get networkState(){return this._networkState}},Tr={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4},z=new class{constructor(){var i,r;this.baseInfoMap=new Ct,this.clientList=xo,this.keyEventUploadPendingItems=[],this.normalEventUploadPendingItems=[],this.apiInvokeUploadPendingItems=[],this.apiInvokeCount=0,this.ltsList=[],this.lastSendNormalEventTime=de(),this.customReportCount=0,this.eventUploadTimer=window.setInterval(cr(i=this.doSend).call(i,this),ne.EVENT_REPORT_SEND_INTERVAL),this.setSessionIdTimer=window.setInterval(cr(r=this.appendSessionId).call(r,this),ne.EVENT_REPORT_SEND_INTERVAL)}reportApiInvoke(i,r,s){r.timeout=r.timeout||6e4,r.reportResult=r.reportResult===void 0||r.reportResult;const c=de(),u=this.apiInvokeCount+=1,h=()=>({tag:r.tag,invokeId:u,sid:i,name:r.name,apiInvokeTime:c,options:r.options,states:r.states||null}),A=!!ne.SHOW_REPORT_INVOKER_LOG;A&&R.info("".concat(r.name," start"),r.options);let f=!1;Tn(r.timeout).then(()=>{f||(this.sendApiInvoke(Ar({},h(),{error:D.API_INVOKE_TIMEOUT,success:!1})),R.debug("".concat(r.name," timeout")))});const m=new L(D.UNEXPECTED_ERROR,"".concat(r.name,": this api invoke is end"));return{onSuccess:I=>{const E=()=>{if(f)throw m;return f=!0,this.sendApiInvoke(Ar({},h(),{success:!0},r.reportResult&&{result:I})),A&&R.info("".concat(r.name," onSuccess")),I};return s?s1(E,r.name+"Success",s,()=>f=!0):E()},onError:I=>{const E=()=>{if(f)throw I;f=!0,this.sendApiInvoke(Ar({},h(),{success:!1,error:I.toString()})),A&&R.info("".concat(r.name," onFailure"),I.toString())};return s?s1(E,r.name+"Error",s,()=>f=!0):E()}}}sessionInit(i,r){if(!this.baseInfoMap.has(i)){var s=de();i=this.createBaseInfo(i,s),i.cname=r.cname;var c=Zr({},{willUploadConsoleLog:ne.UPLOAD_LOG,maxTouchPoints:navigator.maxTouchPoints,areaVersion:Ip?"global":"oversea",areas:ne.AREAS&&ne.AREAS.join(",")},r.extend),u=de();r=Ar({},i,{eventType:jr.SESSION_INIT,appid:r.appid,browser:navigator.userAgent,build:"v4.7.3-0-g0eb931c7(11/16/2021, 7:57:58 PM)",lts:u,elapse:u-s,extend:fe(c),mode:r.mode,process:ne.PROCESS_ID,success:!0,version:Hn}),this.send({type:Jt.SESSION,data:r},!0)}}joinChooseServer(i,r){if(i=this.baseInfoMap.get(i)){var s=i.info,c=de();r=Ar({},s,{eventType:jr.JOIN_CHOOSE_SERVER,lts:c,eventElapse:c-r.lts,chooseServerAddr:r.csAddr,errorCode:r.ec,elapse:c-i.startTime,success:r.succ,chooseServerAddrList:fe(r.serverList),uid:r.uid?ar(r.uid):null,cid:r.cid?ar(r.cid):null,chooseServerIp:r.csIp||"",opid:r.opid,unilbsServerIds:r.unilbsServerIds,extend:r.extend||void 0}),this.send({type:Jt.JOIN_CHOOSE_SERVER,data:r},!0)}}reqUserAccount(i,r){if(i=this.baseInfoMap.get(i)){var s=i.info,c=de();r=Ar({},s,{eventType:jr.REQ_USER_ACCOUNT,lts:c,success:r.success,serverAddress:r.serverAddr,stringUid:r.stringUid,uid:r.uid,errorCode:r.errorCode,elapse:c-i.startTime,eventElapse:c-r.lts,extend:fe(r.extend)}),this.send({type:Jt.REQ_USER_ACCOUNT,data:r},!0)}}joinGateway(i,r){if(i=this.baseInfoMap.get(i)){var s=i.info;r.vid&&(s.vid=r.vid),s.uid=r.uid,s.cid=r.cid;var c=de();s=Ar({},s,{eventType:jr.JOIN_GATEWAY,lts:c,gatewayAddr:r.addr,success:r.succ,errorCode:r.ec,elapse:c-i.startTime,eventElapse:c-r.lts}),r.succ&&(i.lastJoinSuccessTime=c),this.send({type:Jt.JOIN_GATEWAT,data:s},!0)}}joinChannelTimeout(i,r){if(i=this.baseInfoMap.get(i)){var s=de();r=Ar({},i.info,{lts:s,timeout:r,elapse:s-i.startTime}),this.send({type:Jt.JOIN_CHANNEL_TIMEOUT,data:r},!0)}}publish(i,r){if(i=this.baseInfoMap.get(i)){var s=i.info,c=de();r=Ar({},s,{eventType:jr.PUBLISH,lts:c,eventElapse:c-r.lts,elapse:c-i.startTime,success:r.succ,errorCode:r.ec,videoName:r.videoName,audioName:r.audioName,screenName:r.screenName,screenshare:r.screenshare,audio:r.audio,video:r.video,p2pid:r.p2pid,publishRequestid:r.publishRequestid}),this.send({type:Jt.PUBLISH,data:r},!0)}}subscribe(i,r){if(i=this.baseInfoMap.get(i)){var s=i.info,c=de();i=Ar({},s,{eventType:jr.SUBSCRIBE,lts:c,eventElapse:c-r.lts,elapse:c-i.startTime,success:r.succ,errorCode:r.ec,video:r.video,audio:r.audio,subscribeRequestid:r.subscribeRequestid,p2pid:r.p2pid}),typeof r.peerid=="string"?i.peerSuid=r.peerid:i.peer=r.peerid,this.send({type:Jt.SUBSCRIBE,data:i},!0)}}firstRemoteFrame(i,r,s,c){if(i=this.baseInfoMap.get(i)){var u=i.info,h=de();r=Ar({},u,{},c,{elapse:h-i.startTime,eventType:r,lts:h}),this.send({type:s,data:r},!0)}}onGatewayStream(i,r,s,c){(i=this.baseInfoMap.get(i))&&(r=Ar({},i.info,{},c,{eventType:r,lts:de()}),this.send({type:s,data:r},!0))}streamSwitch(i,r){if(i=this.baseInfoMap.get(i)){var s=i.info,c=de();r=Ar({},s,{eventType:jr.STREAM_SWITCH,lts:c,isDual:r.isdual,elapse:c-i.startTime,success:r.succ}),this.send({type:Jt.STREAM_SWITCH,data:r},!0)}}requestProxyAppCenter(i,r){if(i=this.baseInfoMap.get(i)){var s=i.info,c=de();r=Ar({},s,{eventType:jr.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-r.lts,elapse:c-i.startTime,APAddr:r.APAddr,workerManagerList:r.workerManagerList,response:r.response,errorCode:r.ec,success:r.succ}),this.send({type:Jt.REQUEST_PROXY_APPCENTER,data:r},!0)}}requestProxyWorkerManager(i,r){if(i=this.baseInfoMap.get(i)){var s=i.info,c=de();r=Ar({},s,{eventType:jr.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-r.lts,elapse:c-i.startTime,workerManagerAddr:r.workerManagerAddr,response:r.response,errorCode:r.ec,success:r.succ}),this.send({type:Jt.REQUEST_PROXY_WORKER_MANAGER,data:r},!0)}}setProxyServer(i){(this.proxyServer=i)?R.debug("reportProxyServerurl: ".concat(i)):R.debug("disable reportProxyServerurl: ".concat(i))}peerPublishStatus(i,r){if(i=this.baseInfoMap.get(i)){var s=i.info,c=de();r=Ar({},s,{subscribeElapse:r.subscribeElapse,peer:r.peer,peerPublishDuration:Math.max(r.audioPublishDuration,r.videoPublishDuration),audiotag:0<r.audioPublishDuration?1:-1,videotag:0<r.videoPublishDuration?1:-1,lts:c,elapse:c-i.startTime,joinChannelSuccessElapse:c-(i.lastJoinSuccessTime||c)}),this.send({type:Jt.PEER_PUBLISH_STATUS,data:r},!0)}}workerEvent(i,r){if(i=this.baseInfoMap.get(i)){var s=i.info,c=de();r=function(u,h,A){const f=u[h];if(!f||typeof f!="string")return[u];u[h]="";const m=ka(fe(u));let I=0;const E=[];let _=0;for(let S=0;S<f.length;S++)_+=127>=f.charCodeAt(S)?1:3,_<=A-m||(E[E.length]=Rh({},u,{[h]:f.substring(I,S)}),I=S,_=127>=f.charCodeAt(S)?1:3);return I!==f.length-1&&(E[E.length]=Rh({},u,{[h]:f.substring(I)})),E}(Ar({},s,{},r,{elapse:c-i.startTime,lts:c,productType:"WebRTC"}),"payload",1300),W(r).call(r,u=>this.send({type:Jt.WORKER_EVENT,data:u},!0))}}apworkerEvent(i,r){if(i=this.baseInfoMap.get(i)){var s=i.info,c=de();r=Ar({},s,{},r,{elapse:c-i.startTime,lts:c}),this.send({type:Jt.AP_WORKER_EVENT,data:r},!0)}}joinWebProxyAP(i,r){if(i=this.baseInfoMap.get(i)){var s=i.info,c=de();r=Ar({},s,{},r,{elapse:c-i.startTime,lts:c,extend:r.extend||void 0}),this.send({type:Jt.JOIN_WEB_PROXY_AP,data:r},!0)}}WebSocketQuit(i,r){if(i=this.baseInfoMap.get(i)){var s=i.info,c=de();r=Ar({},s,{},r,{elapse:c-i.startTime,lts:c}),this.send({type:Jt.WEBSOCKET_QUIT,data:r},!0)}}async sendCustomReportMessage(i,r){if(this.customReportCount+=r.length,this.customReportCount>ne.CUSTOM_REPORT_LIMIT)throw new L(D.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3)),r=Ie(r).call(r,s=>({type:Jt.USER_ANALYTICS,data:Ar({sid:i},s)})),r={msgType:"EventMessages",sentTs:Math.round(de()/1e3),payloads:Ie(r).call(r,s=>fe(s))};try{await this.postDataToStatsCollector(r)}catch(s){throw R.error("send custom report message failed",s.toString()),new L(D.CUSTOM_REPORT_SEND_FAILED,s.message)}}sendApiInvoke(i){var r=ne.NOT_REPORT_EVENT;if(i.tag&&gt(r)&&gt(r).call(r,i.tag))return!1;if(i.sid===null)return this.apiInvokeUploadPendingItems.push(i),!1;if(r=this.baseInfoMap.get(i.sid),!r)return this.apiInvokeUploadPendingItems.push(i),!1;const{cname:s,uid:c,cid:u}=r.info;return i.lts=i.lts||de(),i={invokeId:i.invokeId,sid:i.sid,cname:s,cid:u,uid:c,lts:i.lts,success:i.success,elapse:i.lts-r.startTime,execElapse:i.lts-i.apiInvokeTime,apiName:i.name,options:i.options?fe(i.options):void 0,execStates:i.states?fe(i.states):void 0,execResult:i.result?fe(i.result):void 0,errorCode:i.error?fe(i.error):void 0},this.send({type:Jt.API_INVOKE,data:i},!1),!0}appendSessionId(){var i;W(i=this.clientList).call(i,r=>{if(r._sessionId){const s=this.apiInvokeUploadPendingItems.length;for(let c=0;c<s;c++){const u=this.apiInvokeUploadPendingItems.shift();u&&(u.sid=r._sessionId,this.sendApiInvoke(Zr({},u)))}}})}send(i,r){if(r)return this.keyEventUploadPendingItems.push(i),void this.sendItems(this.keyEventUploadPendingItems,!0);var s;this.normalEventUploadPendingItems.push(i),this.normalEventUploadPendingItems.length>ne.NORMAL_EVENT_QUEUE_CAPACITY&&Gr(s=this.normalEventUploadPendingItems).call(s,0,1),10<=this.normalEventUploadPendingItems.length&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){0<this.keyEventUploadPendingItems.length&&this.sendItems(this.keyEventUploadPendingItems,!0),0<this.normalEventUploadPendingItems.length&&5e3<=de()-this.lastSendNormalEventTime&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(i,r){const s=[];for(var c=[];i.length;){const A=i.shift();20>s.length?s.push(A):c.push(A)}i.push(...c);for(const A of[...s]){var u,h;Ge(u=this.ltsList).call(u,A.data.lts)!==-1?(A.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(A.data.lts)):(this.ltsList.push(A.data.lts),ol(h=this.ltsList).call(h,(f,m)=>f-m))}return r||(this.lastSendNormalEventTime=de()),c={msgType:"EventMessages",sentTs:Math.round(de()/1e3),payloads:Ie(s).call(s,A=>fe(A)),vid:(A=>(A=A&&A.data.sid&&this.baseInfoMap.get(A.data.sid))&&A.info.vid&&+A.info.vid||0)(s[0])},s.length&&this.postDataToStatsCollector(c).catch((A=>f=>{var m,I,E;ne.EVENT_REPORT_RETRY&&(r?this.keyEventUploadPendingItems=b(m=this.keyEventUploadPendingItems).call(m,A):(this.normalEventUploadPendingItems=b(I=this.normalEventUploadPendingItems).call(I,A),this.normalEventUploadPendingItems.length>ne.NORMAL_EVENT_QUEUE_CAPACITY&&(Gr(E=this.normalEventUploadPendingItems).call(E,0,this.normalEventUploadPendingItems.length-ne.NORMAL_EVENT_QUEUE_CAPACITY),R.warning("report: drop normal events"))))})(s)),i}async postDataToStatsCollector(i,r=!1){var s,c,u;Yn.networkState===bi.OFFLINE&&await ce.race([Yn.onlineWaiter,Tn(2*Tr.maxRetryTimeout)]);const h=r?"/events/proto-raws":"/events/messages";let A=this.url||(this.proxyServer?b(s=b(c="https://".concat(this.proxyServer,"/rs/?h=")).call(c,ne.EVENT_REPORT_DOMAIN,"&p=6443&d=")).call(s,h):b(u="https://".concat(ne.EVENT_REPORT_DOMAIN,":6443")).call(u,h));for(s=0;2>s;s+=1){var f,m,I;s===1&&(A=this.backupUrl||(this.proxyServer?b(f=b(m="https://".concat(this.proxyServer,"/rs/?h=")).call(m,ne.EVENT_REPORT_BACKUP_DOMAIN,"&p=6443&d=")).call(f,h):b(I="https://".concat(ne.EVENT_REPORT_BACKUP_DOMAIN,":6443")).call(I,h)));try{r?await iS(A,{timeout:1e4,data:i}):await Gi(A,{timeout:1e4,data:i})}catch(E){if(s===1)throw E;continue}break}}createBaseInfo(i,r){const s=Zr({},FR);return s.sid=i,this.baseInfoMap.set(i,{info:s,startTime:r}),s}};class WE extends Wr{constructor(r,s){super();this._hints=[],this._isClosed=!1,this._ID=s||er(8,"track-"),this._mediaStreamTrack=this._originMediaStreamTrack=r,gt(ls).call(ls,this)||ls.push(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(r){return r||(r=z.reportApiInvoke(null,{name:we.GET_MEDIA_STREAM_TRACK,options:[],tag:Re.TRACER}),this._mediaStreamTrack&&typeof this._mediaStreamTrack.label=="string"?r.onSuccess(this._mediaStreamTrack.label):r.onSuccess("")),this._mediaStreamTrack}close(){this._isClosed=!0;{let r=Ge(ls).call(ls,this);r!==-1&&Gr(ls).call(ls,r,1)}}}let r2=1;class Vo{constructor(r){var s;this.lockingPromise=ce.resolve(),this.locks=0,this.name="",this.lockId=r2++,r&&(this.name=r),R.debug(b(s="[lock-".concat(this.name,"-")).call(s,this.lockId,"] is created."))}get isLocked(){return 0<this.locks}lock(){var r,s;let c;this.locks+=1,R.debug(b(r=b(s="[lock-".concat(this.name,"-")).call(s,this.lockId,"] is locked, current queue ")).call(r,this.locks,"."));let u=new ce(h=>{c=()=>{var A,f;--this.locks,R.debug(b(A=b(f="[lock-".concat(this.name,"-")).call(f,this.lockId,"] is not locked, current queue ")).call(A,this.locks,".")),h()}});return r=this.lockingPromise.then(()=>c),this.lockingPromise=this.lockingPromise.then(()=>u),r}}class $u extends WE{constructor(r,s){super(r,s);this._enabled=!0,this._isClosed=this._muted=!1,this._trackProcessors=[],this._handleTrackEnded=()=>{this.onTrackEnded()},this._enabledMutex=new Vo("".concat(s)),r.addEventListener("ended",this._handleTrackEnded)}get muted(){return this._muted}get enabled(){return this._enabled}getTrackLabel(){return this._originMediaStreamTrack.label}close(){var r;this._isClosed||(this.stop(),W(r=this._trackProcessors).call(r,s=>s.destroy()),this._trackProcessors=[],this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,R.debug("[".concat(this.getTrackId(),"] close")),this.emit(Me.NEED_CLOSE),super.close())}async _registerTrackProcessor(r){var s;if(Ge(s=this._trackProcessors).call(s,r)===-1){var c=this._trackProcessors[this._trackProcessors.length-1];this._trackProcessors.push(r),r.onOutputChange=async()=>{this._mediaStreamTrack=r.output||this._originMediaStreamTrack,this._updatePlayerSource(),await zr(this,Me.NEED_REPLACE_TRACK,this._mediaStreamTrack)},c?(c.onOutputChange=async()=>{c.output&&await r.setInput(c.output)},await r.setInput(c.output||c.input||this._originMediaStreamTrack)):await r.setInput(this._originMediaStreamTrack)}}_getOutputFromProcessors(){if(this._trackProcessors.length===0)return this._originMediaStreamTrack;let r=this._trackProcessors[this._trackProcessors.length-1];return r.output||r.input||this._originMediaStreamTrack}async _updateOriginMediaStreamTrack(r,s){r!==this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),s&&this._originMediaStreamTrack.stop(),r.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=r,0<this._trackProcessors.length?(await this._trackProcessors[0].setInput(r),this._mediaStreamTrack=this._getOutputFromProcessors()):this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await zr(this,Me.NEED_REPLACE_TRACK,this._mediaStreamTrack))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){R.debug("[".concat(this.getTrackId(),"] track ended")),this.emit(qs.TRACK_ENDED)}stateCheck(r,s){var c,u,h;if(R.debug(b(c=b(u=b(h="check track state, [muted: ".concat(this._muted,", enabled: ")).call(h,this._enabled,"] to [")).call(u,r,": ")).call(c,s,"]")),r==="muted"&&!kt.webAudioMediaStreamDest)throw new L(D.NOT_SUPPORTED,"current environment does not support set mute").print();if(fu(s,r),this._enabled&&this._muted&&r==="enabled"&&s===!1)throw new L(D.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print();if(!this._enabled&&!this._muted&&r==="muted"&&s===!0)throw new L(D.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print()}}var Rr;(function(i){i.IOS_15_INTERRUPTION_START="ios15-interruption-start",i.IOS_15_INTERRUPTION_END="ios15-interruption-end",i.IOS_INTERRUPTION_START="ios-interruption-start",i.IOS_INTERRUPTION_END="ios-interruption-end"})(Rr||(Rr={}));let YE=window.AudioContext||window.webkitAudioContext,zi=null,ot=new class extends Wr{constructor(){super(...arguments);this.onLocalAudioTrackMute=()=>{R.info("ios15-interruption-start"),this.emit(Rr.IOS_15_INTERRUPTION_START)},this.onLocalAudioTrackUnmute=async()=>{R.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?R.info("ios15-interruption-end-canceled"):(zi&&await zi.suspend(),this.emit(Rr.IOS_15_INTERRUPTION_END))}}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(i){R.debug("webaudio bindInterruptDetectorTrack ".concat(i.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=i,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(i){R.debug("webaudio unbindInterruptDetectorTrack ".concat(i.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===i&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}},Qp=null;class qE extends Wr{constructor(){super();this.isPlayed=!1,this.audioOutputLevel=0,this.isNoAudioInput=this.isDestroyed=!1,this._noAudioInputCount=0,this.context=Vc(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Gc(this.outputNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.smoothingTimeConstant=.4,this.analyserNode.fftSize=2048}startGetAudioBuffer(r){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(r),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=s=>{this.emit(ki.ON_AUDIO_BUFFER,function(c){for(let u=0;u<c.outputBuffer.numberOfChannels;u+=1){let h=c.outputBuffer.getChannelData(u);for(let A=0;A<h.length;A+=1)h[A]=0}return c.inputBuffer}(s))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!kt.webAudioMediaStreamDest)throw new L(D.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(r){this.context.state!=="running"&&ii(()=>{ot.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=r||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){if(!this.context||Br()||Gn()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode)return 0;let r=new Uint8Array(this.analyserNode.frequencyBinCount);this.analyserNode.getByteFrequencyData(r);let s=0;for(let c=0;c<r.length;c++)s+=64>c?Math.abs(10*r[c]):Math.abs(6*r[c]/15);return s/r.length/255}async checkHasAudioInput(r=0){if(5<r)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;if(Br()||Gn()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume(),!this.analyserNode)return!1;let s=new Uint8Array(this.analyserNode.frequencyBinCount);this.analyserNode.getByteFrequencyData(s);let c=!1;for(let u=0;u<s.length;u++)s[u]!==0&&(c=!0);return c?(this.isNoAudioInput=!1,!0):(await Tn(200),await this.checkHasAudioInput(r?r+1:1)&&c)}getAudioVolume(){return this.outputNode.gain.value}setVolume(r){this.outputNode.gain.setValueAtTime(r,this.context.currentTime)}setMute(r){r?(this.disconnect(),this.audioOutputLevel=0):this.connect()}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){this.sourceNode&&this.sourceNode.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){this.sourceNode&&this.sourceNode.connect(this.outputNode),this.outputNode.connect(this.analyserNode)}}class JE extends qE{constructor(r,s){if(super(),this.isCurrentTrackCloned=!1,this.isRemoteTrack=!1,this.rebuildWebAudio=async()=>{if(R.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void R.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>R.info("resume success")),R.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();var c=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?c.stop():this.isCurrentTrackCloned=!0,c=new MediaStream([this.track]),this.sourceNode=this.context.createMediaStreamSource(c),Gc(this.sourceNode),this.analyserNode=this.context.createAnalyser();let u=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(u,this.context.currentTime),Gc(this.outputNode),this.connect(),this.audioElement.srcObject=c,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()},r.kind!=="audio")throw new L(D.UNEXPECTED_ERROR);this.track=r,r=new MediaStream([this.track]),this.isRemoteTrack=!!s,this.sourceNode=this.context.createMediaStreamSource(r),Gc(this.sourceNode),this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=r,r=Ye(),s&&r.os===Lr.IOS&&15>Number(r.osVersion&&r.osVersion.split(".")[0])&&(ot.on("state-change",()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(c=>{c||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}get isFreeze(){return!1}updateTrack(r){this.sourceNode.disconnect(),this.track=r,this.isCurrentTrackCloned=!1,r=new MediaStream([r]),this.sourceNode=this.context.createMediaStreamSource(r),Gc(this.sourceNode),this.sourceNode.connect(this.outputNode),this.audioElement.srcObject=r}destroy(){this.audioElement.srcObject=null,this.audioElement.remove(),ot.off("state-change",this.rebuildWebAudio),super.destroy()}}let ed=null,xp=new Vo("safari"),zE=!1,XE=!1,wn=new class extends Wr{constructor(){super();this._state=Ys.IDLE,this.lastAccessCameraPermission=this.lastAccessMicrophonePermission=this.isAccessCameraPermission=this.isAccessMicrophonePermission=!1,this.deviceInfoMap=new Ct,this.init().then(()=>{var i;navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",cr(i=this.updateDevicesInfo).call(i,this)),window.setInterval(()=>Ye().name!==ze.WECHAT&&ne.ENUMERATE_DEVICES_INTERVAL&&this.updateDevicesInfo(),6e4)}).catch(i=>R.error(i.toString()))}get state(){return this._state}set state(i){i!==this._state&&(this.emit(Uo.STATE_CHANGE,i),this._state=i)}async enumerateDevices(i,r,s=!1){if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new L(D.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();var c=await navigator.mediaDevices.enumerateDevices();c=this.checkMediaDeviceInfoIsOk(c);let u=!this.isAccessMicrophonePermission&&i,h=!this.isAccessCameraPermission&&r;c.audio&&(u=!1),c.video&&(h=!1);let A=c=null,f=null;if(!s&&(u||h)){if(xp.isLocked&&(R.debug("[device manager] wait GUM lock"),(await xp.lock())(),R.debug("[device manager] GUM unlock")),zE&&(u=!1,this.isAccessMicrophonePermission=!0),XE&&(h=!1,this.isAccessCameraPermission=!0),R.debug("[device manager] check media device permissions",i,r,u,h),u&&h){try{f=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(k){if(s=gu(k.name||k.code||k,k.message),s.code===D.PERMISSION_DENIED)throw s;R.warning("getUserMedia failed in getDevices",s)}this.isAccessMicrophonePermission=this.isAccessCameraPermission=!0}else if(u){try{c=await navigator.mediaDevices.getUserMedia({audio:i})}catch(k){if(s=gu(k.name||k.code||k,k.message),s.code===D.PERMISSION_DENIED)throw s;R.warning("getUserMedia failed in getDevices",s)}this.isAccessMicrophonePermission=!0}else if(h){try{A=await navigator.mediaDevices.getUserMedia({video:r})}catch(k){if(s=gu(k.name||k.code||k,k.message),s.code===D.PERMISSION_DENIED)throw s;R.warning("getUserMedia failed in getDevices",s)}this.isAccessCameraPermission=!0}R.debug("[device manager] mic permission",i,"cam permission",r)}try{var m,I,E;const k=await navigator.mediaDevices.enumerateDevices();return c&&W(m=c.getTracks()).call(m,B=>B.stop()),A&&W(I=A.getTracks()).call(I,B=>B.stop()),f&&W(E=f.getTracks()).call(E,B=>B.stop()),c=null,A=null,f=null,k}catch(k){var _,S,N;return c&&W(_=c.getTracks()).call(_,B=>B.stop()),A&&W(S=A.getTracks()).call(S,B=>B.stop()),f&&W(N=f.getTracks()).call(N,B=>B.stop()),f=A=c=null,new L(D.ENUMERATE_DEVICES_FAILED,k.toString()).throw()}}async getRecordingDevices(i=!1){return i=await this.enumerateDevices(!0,!1,i),Qe(i).call(i,r=>r.kind==="audioinput")}async getCamerasDevices(i=!1){return i=await this.enumerateDevices(!1,!0,i),Qe(i).call(i,r=>r.kind==="videoinput")}async getSpeakers(i=!1){return i=await this.enumerateDevices(!0,!1,i),Qe(i).call(i,r=>r.kind==="audiooutput")}searchDeviceNameById(i){return(i=this.deviceInfoMap.get(i))?i.device.label||i.device.deviceId:null}searchDeviceIdByName(i){var r;let s=null;return W(r=this.deviceInfoMap).call(r,c=>{c.device.label===i&&(s=c.device.deviceId)}),s}async getDeviceById(i){var r=await this.enumerateDevices(!0,!0,!0);if(r=Je(r).call(r,s=>s.deviceId===i),!r)throw new L(D.DEVICE_NOT_FOUND,"deviceId: ".concat(i));return r}async init(){this.state=Ys.INITING;try{await this.updateDevicesInfo(),this.state=Ys.INITEND}catch(r){R.warning("Device Detection functionality cannot start properly.",r.toString()),this.state=Ys.IDLE;var i=typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1";throw i||new L(D.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),r}}async updateDevicesInfo(){var i;const r=await this.enumerateDevices(!0,!0,!0),s=de(),c=[],u=this.checkMediaDeviceInfoIsOk(r);if(W(r).call(r,h=>{if(h.deviceId){var A=this.deviceInfoMap.get(h.deviceId);if((A?A.state:"INACTIVE")!=="ACTIVE"){const f={initAt:s,updateAt:s,device:h,state:"ACTIVE"};this.deviceInfoMap.set(h.deviceId,f),c.push(f)}A&&(A.updateAt=s)}}),W(i=this.deviceInfoMap).call(i,(h,A)=>{h.state==="ACTIVE"&&h.updateAt!==s&&(h.state="INACTIVE",c.push(h))}),this.state!==Ys.INITEND)return u.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(u.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));W(c).call(c,h=>{switch(h.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Uo.RECORDING_DEVICE_CHANGED,h);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Uo.CAMERA_DEVICE_CHANGED,h);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Uo.PLAYOUT_DEVICE_CHANGED,h)}}),u.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),u.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(i){const r=Qe(i).call(i,c=>c.kind==="audioinput");i=Qe(i).call(i,c=>c.kind==="videoinput");const s={audio:!1,video:!1};for(const c of r)if(c.label&&c.deviceId){s.audio=!0;break}for(const c of i)if(c.label&&c.deviceId){s.video=!0;break}return s}};var n2=sr("Array").entries,ZE=Array.prototype,i2={DOMTokenList:!0,NodeList:!0},$E=function(i){var r=i.entries;return i===ZE||i instanceof Array&&r===ZE.entries||i2.hasOwnProperty(xa(i))?n2:r};let Up=!1,e1=new Wr,t1="play playing loadeddata canplay pause stalled suspend waiting abort emptied ended".split(" "),li=new class{constructor(){this.elementMap=new Ct,this.elementStateMap=new Ct,this.elementsNeedToResume=[],this.sinkIdMap=new Ct,this.autoResumeAfterInterruption=()=>{var i,r;W(i=Ji($E(r=this.elementMap).call(r))).call(i,([s,c])=>{s=this.elementStateMap.get(s);const u=c.srcObject.getAudioTracks()[0];Vn()?u&&u.readyState==="live"&&ot.curState==="running"&&(R.debug("auto resume after interruption for iOS 15"),c.pause(),c.play()):s&&s==="pause"&&u&&u.readyState==="live"&&ot.curState==="running"&&(R.debug("auto resume after interruption for iOS"),c.play())})},this.autoResumeAfterInterruptionOnIOS15=()=>{var i,r;W(i=Ji($E(r=this.elementMap).call(r))).call(i,([,s])=>{const c=s.srcObject.getAudioTracks()[0];c&&c.readyState==="live"&&(R.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),s.pause(),s.play())})},this.autoResumeAudioElement(),ot.on(Rr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),ot.on(Rr.IOS_15_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15)}async setSinkID(i,r){const s=this.elementMap.get(i);if(this.sinkIdMap.set(i,r),s)try{await s.setSinkId(r)}catch(c){throw new L(D.PERMISSION_DENIED,"can not set sink id: "+c.toString())}}play(i,r,s){if(!this.elementMap.has(r)){var c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([i]),this.bindAudioElementEvents(r,c),this.elementMap.set(r,c),this.elementStateMap.set(r,Qr.INIT),this.setVolume(r,s),(i=this.sinkIdMap.get(r))&&c.setSinkId(i).catch(u=>{R.warning("[".concat(r,"] set sink id failed"),u.toString())}),(i=c.play())&&i.then&&i.catch(u=>{R.warning("audio element play warning",u.toString()),this.elementMap.has(r)&&u.name==="NotAllowedError"&&(R.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),ii(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),Fg()}))})}}updateTrack(i,r){(i=this.elementMap.get(i))&&(i.srcObject=new MediaStream([r]))}isPlaying(i){return this.elementMap.has(i)}setVolume(i,r){(i=this.elementMap.get(i))&&(r=Math.max(0,Math.min(100,r)),i.volume=r/100)}stop(i){var r,s;const c=this.elementMap.get(i);if(this.sinkIdMap.delete(i),c){var u=Ge(r=this.elementsNeedToResume).call(r,c);Gr(s=this.elementsNeedToResume).call(s,u,1),c.srcObject=null,c.remove(),this.elementMap.delete(i),this.elementStateMap.delete(i)}}bindAudioElementEvents(i,r){W(t1).call(t1,s=>{r.addEventListener(s,c=>{var u,h;const A=this.elementStateMap.get(i);c=c.type,R.debug(b(u=b(h="[".concat(i,"] audio-element-status change ")).call(h,A," => ")).call(u,c)),this.elementStateMap.set(i,c)})})}autoResumeAudioElement(){const i=()=>{var r;W(r=this.elementsNeedToResume).call(r,s=>{s.play().then(c=>{R.debug("Auto resume audio element success")}).catch(c=>{R.warning("Auto resume audio element failed!",c)})}),this.elementsNeedToResume=[]};new ce(r=>{document.body?r():window.addEventListener("load",()=>r())}).then(()=>{document.body.addEventListener("touchstart",i,!0),document.body.addEventListener("mousedown",i,!0)})}};var qn=function(i,r,s,c){var u,h=arguments.length,A=3>h?r:c===null?c=ct(r,s):c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")A=Reflect.decorate(i,r,s,c);else for(var f=i.length-1;0<=f;f--)(u=i[f])&&(A=(3>h?u(A):3<h?u(r,s,A):u(r,s))||A);return 3<h&&A&&ht(r,s,A),A},tt=function(i,r){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,r)};class wr extends $u{constructor(r,s,c){super(r,c);this.trackMediaType="audio",this._enabled=!0,this._volume=100,this._bypassWebAudio=this._useAudioElement=!1,this._encoderConfig=s,this._source=new JE(r)}get isPlaying(){return this._useAudioElement?li.isPlaying(this.getTrackId()):this._source.isPlayed}setVolume(r){It(r,"volume",0,1e3);let s=z.reportApiInvoke(null,{tag:Re.TRACER,name:we.LOCAL_AUDIO_TRACK_SET_VOLUME,options:[this.getTrackId(),r]},300);this._volume=r,this._source.setVolume(r/100),this._useAudioElement&&li.setVolume(this.getTrackId(),r);try{if(this._bypassWebAudio)return void R.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));let c=this._source.createOutputTrack();this._mediaStreamTrack!==c&&(this._mediaStreamTrack=c,zr(this,Me.NEED_REPLACE_TRACK,this._mediaStreamTrack).then(()=>{R.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(u=>{R.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),u)}))}catch{}s.onSuccess()}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}async setPlaybackDevice(r){let s=z.reportApiInvoke(null,{tag:Re.TRACER,name:we.REMOTE_AUDIO_SET_OUTPUT_DEVICE,options:[this.getTrackId(),r]});if(!this._useAudioElement)throw new L(D.NOT_SUPPORTED,"your browser does not support setting the audio output device");try{await li.setSinkID(this.getTrackId(),r)}catch(c){throw s.onError(c),c}s.onSuccess()}async setEnabled(r,s,c){var u;if(!c){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),r),s=await this._enabledMutex.lock(),!r){this._originMediaStreamTrack.enabled=!1;try{await zr(this,Me.NEED_REMOVE_TRACK,this)}catch(h){throw R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),h.toString()),s(),h}return c||(this._enabled=!1),s()}this._originMediaStreamTrack.enabled=!0;try{await zr(this,Me.NEED_ADD_TRACK,this)}catch(h){throw R.error("[".concat(this.getTrackId(),"] setEnabled to true error"),h.toString()),s(),h}R.info(b(u="[".concat(this.getTrackId(),"] setEnabled to ")).call(u,r," success")),c||(this._enabled=!0),s()}async setMuted(r){var s,c;if(this._bypassWebAudio)return R.debug(b(c="[".concat(this.getTrackId(),"] setMuted:")).call(c,r," fallback to setEnabled because no pass through.")),void await this.setEnabled(!r);if(r!==this._muted){if(this.stateCheck("muted",r),this._muted=r,Ye().name===ze.FIREFOX)return R.debug("[".concat(this.getTrackId(),"] firefox set mute fallback to set enabled")),void await this.setEnabled(!r,void 0,!0);this._mediaStreamTrack.enabled=!r,R.debug(b(s="[".concat(this.getTrackId(),"] start set muted: ")).call(s,r)),await zr(this,Me.SET_AUDIO_TRACK_MUTED,{track:this,muted:r})}}getStats(){return Hc(()=>{R.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Ls(this,Me.GET_STATS)||mu({},Ju)}setAudioFrameCallback(r,s=4096){if(!r)return this._source.removeAllListeners(ki.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(s),this._source.removeAllListeners(ki.ON_AUDIO_BUFFER),this._source.on(ki.ON_AUDIO_BUFFER,c=>r(c))}play(){let r=z.reportApiInvoke(null,{tag:Re.TRACER,name:we.LOCAL_AUDIO_TRACK_PLAY,options:[this.getTrackId()]});R.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(R.debug("[".concat(this.getTrackId(),"] start audio playback in element")),li.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play(),r.onSuccess()}stop(){let r=z.reportApiInvoke(null,{tag:Re.TRACER,name:we.LOCAL_AUDIO_TRACK_STOP,options:[this.getTrackId()]});R.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?li.stop(this.getTrackId()):this._source.stop(),r.onSuccess()}close(){super.close(),this._source.destroy()}_updatePlayerSource(){R.debug("[".concat(this.getTrackId(),"] update player source track")),this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&li.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(r,s){this._originMediaStreamTrack!==r&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r.addEventListener("ended",this._handleTrackEnded),s&&this._originMediaStreamTrack.stop(),this._originMediaStreamTrack=r,this._source.updateTrack(this._originMediaStreamTrack),this._mediaStreamTrack!==this._source.outputTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await zr(this,Me.NEED_REPLACE_TRACK,this._mediaStreamTrack)))}renewMediaStreamTrack(){return ce.resolve(void 0)}}qn([jt(),tt("design:type",Function),tt("design:paramtypes",[String]),tt("design:returntype",ce)],wr.prototype,"setPlaybackDevice",null),qn([jt(),tt("design:type",Function),tt("design:paramtypes",[Boolean,Object,Boolean]),tt("design:returntype",ce)],wr.prototype,"setEnabled",null),qn([jt(),_h({report:z}),tt("design:type",Function),tt("design:paramtypes",[Boolean]),tt("design:returntype",ce)],wr.prototype,"setMuted",null),qn([jt(),tt("design:type",Function),tt("design:paramtypes",[]),tt("design:returntype",Object)],wr.prototype,"getStats",null),qn([jt(),tt("design:type",Function),tt("design:paramtypes",[Object,Number]),tt("design:returntype",void 0)],wr.prototype,"setAudioFrameCallback",null),qn([jt(),tt("design:type",Function),tt("design:paramtypes",[]),tt("design:returntype",void 0)],wr.prototype,"play",null),qn([jt(),tt("design:type",Function),tt("design:paramtypes",[]),tt("design:returntype",void 0)],wr.prototype,"stop",null);class dl extends wr{constructor(r,s,c,u){super(r,s.encoderConfig?Sa(s.encoderConfig):{},u);this._deviceName="default",this._enabled=!0,this._config=s,this._constraints=c,this._deviceName=r.label,typeof s.bypassWebAudio=="boolean"&&(this._bypassWebAudio=s.bypassWebAudio),Vn()&&ot.bindInterruptDetectorTrack(this)}async setDevice(r){var s,c;let u=z.reportApiInvoke(null,{tag:Re.TRACER,name:we.MIC_AUDIO_TRACK_SET_DEVICE,options:[this.getTrackId(),r]});if(R.info(b(s="[".concat(this.getTrackId(),"] start set device to ")).call(s,r)),this._enabled)try{let h=await wn.getDeviceById(r);s={},s.audio=mu({},this._constraints),s.audio.deviceId={exact:r},this._originMediaStreamTrack.stop();let A=null;try{A=await _i(s,this.getTrackId())}catch(f){throw R.error("[".concat(this.getTrackId(),"] setDevice failed"),f.toString()),A=await _i({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(A.getAudioTracks()[0],!1),f}await this._updateOriginMediaStreamTrack(A.getAudioTracks()[0],!1),this._deviceName=h.label,this._config.microphoneId=r,this._constraints.deviceId={exact:r}}catch(h){throw u.onError(h),R.error("[".concat(this.getTrackId(),"] setDevice error"),h.toString()),h}else try{this._deviceName=(await wn.getDeviceById(r)).label,this._config.microphoneId=r,this._constraints.deviceId={exact:r}}catch(h){throw u.onError(h),R.error("[".concat(this.getTrackId(),"] setDevice error"),h.toString()),h}u.onSuccess(),R.info(b(c="[".concat(this.getTrackId(),"] set device to ")).call(c,r," success"))}async setEnabled(r,s,c){if(s)return R.debug("[".concat(this.getTrackId,"] setEnabled false (do not close microphone)")),await super.setEnabled(r);if(!c){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),r),s=await this._enabledMutex.lock(),!r){this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),c||(this._enabled=!1);try{await zr(this,Me.NEED_REMOVE_TRACK,this)}catch(h){throw R.error("[".concat(this.getTrackId(),"] setEnabled false failed"),h.toString()),s(),h}return void s()}r=mu({},this._constraints);let u=wn.searchDeviceIdByName(this._deviceName);u&&!r.deviceId&&(r.deviceId=u);try{let h=await _i({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),await zr(this,Me.NEED_ADD_TRACK,this)}catch(h){throw s(),R.error("[".concat(this.getTrackId(),"] setEnabled true failed"),h.toString()),h}c||(this._enabled=!0),R.info("[".concat(this.getTrackId(),"] setEnabled success")),s()}close(){super.close(),Vn()&&ot.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Br()||Gn())&&this._enabled&&!this._isClosed&&ot.duringInterruption){let r=async()=>{ot.off(Rr.IOS_INTERRUPTION_END,r),this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};ot.on(Rr.IOS_INTERRUPTION_END,r)}else R.debug("[".concat(this.getTrackId(),"] track ended")),this.emit(qs.TRACK_ENDED)}async renewMediaStreamTrack(){var r=mu({},this._constraints);let s=wn.searchDeviceIdByName(this._deviceName);s&&!r.deviceId&&(r.deviceId=s),r=await _i({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!0)}}qn([jt(),tt("design:type",Function),tt("design:paramtypes",[String]),tt("design:returntype",ce)],dl.prototype,"setDevice",null),qn([jt(),tt("design:type",Function),tt("design:paramtypes",[Boolean,Boolean,Boolean]),tt("design:returntype",ce)],dl.prototype,"setEnabled",null);class Za extends wr{constructor(r,s,c,u){super(s.createOutputTrack(),c,u);this.source=r,this._bufferSource=s,this._bufferSource.on(ki.AUDIO_SOURCE_STATE_CHANGE,h=>{this.emit(qs.SOURCE_STATE_CHANGE,h)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(r){let s=z.reportApiInvoke(null,{tag:Re.TRACER,name:we.BUFFER_AUDIO_TRACK_START,options:[this.getTrackId(),r,this.duration]});r&&this._bufferSource.updateOptions(r),this._bufferSource.startProcessAudioBuffer(),s.onSuccess()}pauseProcessAudioBuffer(){let r=z.reportApiInvoke(null,{tag:Re.TRACER,name:we.BUFFER_AUDIO_TRACK_PAUSE,options:[this.getTrackId()]});this._bufferSource.pauseProcessAudioBuffer(),r.onSuccess()}seekAudioBuffer(r){let s=z.reportApiInvoke(null,{tag:Re.TRACER,name:we.BUFFER_AUDIO_TRACK_SEEK,options:[this.getTrackId()]});this._bufferSource.seekAudioBuffer(r),s.onSuccess()}resumeProcessAudioBuffer(){let r=z.reportApiInvoke(null,{tag:Re.TRACER,name:we.BUFFER_AUDIO_TRACK_RESUME,options:[this.getTrackId()]});this._bufferSource.resumeProcessAudioBuffer(),r.onSuccess()}stopProcessAudioBuffer(){let r=z.reportApiInvoke(null,{tag:Re.TRACER,name:we.BUFFER_AUDIO_TRACK_STOP,options:[this.getTrackId()]});this._bufferSource.stopProcessAudioBuffer(),r.onSuccess()}}qn([jt(),tt("design:type",Function),tt("design:paramtypes",[Object]),tt("design:returntype",void 0)],Za.prototype,"startProcessAudioBuffer",null),qn([jt(),tt("design:type",Function),tt("design:paramtypes",[]),tt("design:returntype",void 0)],Za.prototype,"pauseProcessAudioBuffer",null),qn([jt(),tt("design:type",Function),tt("design:paramtypes",[Number]),tt("design:returntype",void 0)],Za.prototype,"seekAudioBuffer",null),qn([jt(),tt("design:type",Function),tt("design:paramtypes",[]),tt("design:returntype",void 0)],Za.prototype,"resumeProcessAudioBuffer",null),qn([jt(),tt("design:type",Function),tt("design:paramtypes",[]),tt("design:returntype",void 0)],Za.prototype,"stopProcessAudioBuffer",null);class $r extends wr{constructor(){let r=Vc().createMediaStreamDestination();super(r.stream.getAudioTracks()[0],void 0,er(8,"track-mix-"));try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=r,this.trackList=[]}get isActive(){var r;return!(!this.trackList.length||!Je(r=this.trackList).call(r,s=>!s.muted))}getSubTrackLabels(){var r;return Ie(r=this.trackList).call(r,s=>s.getTrackLabel())}hasAudioTrack(r){var s;return Ge(s=this.trackList).call(s,r)!==-1}addAudioTrack(r){var s;Ge(s=this.trackList).call(s,r)===-1?(R.debug("add ".concat(r.getTrackId()," to mixing track")),r._source.outputNode.connect(this.destNode),this.trackList.push(r),this.updateEncoderConfig()):R.debug("track ".concat(r.getTrackId()," is already added"))}removeAudioTrack(r){var s;if(Ge(s=this.trackList).call(s,r)!==-1){R.debug("remove ".concat(r.getTrackId()," from mixing track"));try{r._source.outputNode.disconnect(this.destNode)}catch{}Ps(this.trackList,r),this.updateEncoderConfig()}}updateEncoderConfig(){var r;let s={};W(r=this.trackList).call(r,c=>{c._encoderConfig&&((c._encoderConfig.bitrate||0)>(s.bitrate||0)&&(s.bitrate=c._encoderConfig.bitrate),(c._encoderConfig.sampleRate||0)>(s.sampleRate||0)&&(s.sampleRate=c._encoderConfig.sampleRate),(c._encoderConfig.sampleSize||0)>(s.sampleSize||0)&&(s.sampleSize=c._encoderConfig.sampleSize),c._encoderConfig.stereo&&(s.stereo=!0))}),this._encoderConfig=s}}class o2 extends Wr{constructor(){super(...arguments);this.resultStorage=new Ct}setLocalAudioStats(r,s,c){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",r,this.checkAudioInputLevel(c,s)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",r,this.checkSendAudioBitrate(c,s))}setLocalVideoStats(r,s,c){this.record("SEND_VIDEO_BITRATE_TOO_LOW",r,this.checkSendVideoBitrate(c,s)),this.record("FRAMERATE_INPUT_TOO_LOW",r,this.checkFramerateInput(c,s)),this.record("FRAMERATE_SENT_TOO_LOW",r,this.checkFramerateSent(c))}setRemoteAudioStats(r,s){r=r.getUserId(),this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",r,this.checkAudioOutputLevel(s))}setRemoteVideoStats(r,s){r=r.getUserId(),this.record("RECV_VIDEO_DECODE_FAILED",r,this.checkVideoDecode(s))}record(r,s,c){this.resultStorage.has(r)||this.resultStorage.set(r,{result:[],isPrevNormal:!0});let u=this.resultStorage.get(r);if(u&&(u.result.push(c),5<=u.result.length)){var h;c=gt(h=u.result).call(h,!0),u.isPrevNormal&&!c&&this.emit("exception",r1[r],r,s),!u.isPrevNormal&&c&&this.emit("exception",r1[r]+2e3,r+"_RECOVER",s),u.isPrevNormal=c,u.result=[]}}checkAudioOutputLevel(r){return!(0<r.receiveBitrate&&r.receiveLevel===0)}checkAudioInputLevel(r,s){return s instanceof $r&&!s.isActive||!!s.muted||r.sendVolumeLevel!==0}checkFramerateInput(r,s){let c=null;return s._encoderConfig&&s._encoderConfig.frameRate&&(c=ns(s._encoderConfig.frameRate)),r=r.captureFrameRate,!c||!r||!(10<c&&5>r||10>c&&5<=c&&1>=r)}checkFramerateSent(r){return!(r.captureFrameRate&&r.sendFrameRate&&5<r.captureFrameRate&&1>=r.sendFrameRate)}checkSendVideoBitrate(r,s){return!!s.muted||r.sendBitrate!==0}checkSendAudioBitrate(r,s){return s instanceof $r&&!s.isActive||!!s.muted||r.sendBitrate!==0}checkVideoDecode(r){return r.receiveBitrate===0||r.decodeFrameRate!==0}}let r1={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003};class $a{constructor(r){this.localConnectionsMap=new Ct,this.remoteConnectionsMap=new Ct,this.trafficStatsPeerList=[],this.updateStats=()=>{var s,c;W(s=this.remoteConnectionsMap).call(s,u=>{var h;let A=u.audioStats;var f=u.videoStats,m=u.pcStats;let I=po({},Sp),E=po({},Tp),_=po({},kE),S=u.connection.pc.getStats(),N=S.audioRecv[0],k=S.videoRecv[0];m=m?m.videoRecv[0]:void 0;let B=u.connection.pc._statsFilter.videoIsReady===!0,P=this.trafficStats&&Je(h=this.trafficStats.peer_delay).call(h,J=>J.peer_uid===u.connection.getUserId());N&&(N.codec!=="opus"&&N.codec!=="aac"||(I.codecType=N.codec),N.outputLevel?I.receiveLevel=Math.round(32767*N.outputLevel):u.connection.user.audioTrack&&(I.receiveLevel=Math.round(32767*u.connection.user.audioTrack.getVolumeLevel())),I.receiveBytes=N.bytes,I.receivePackets=N.packets,I.receivePacketsLost=N.packetsLost,I.packetLossRate=I.receivePacketsLost/(I.receivePackets+I.receivePacketsLost),I.receiveBitrate=A?8*Math.max(0,I.receiveBytes-A.receiveBytes):0,I.totalDuration=A?A.totalDuration+1:1,I.totalFreezeTime=A?A.totalFreezeTime:0,I.freezeRate=I.totalFreezeTime/I.totalDuration,I.receiveDelay=N.jitterBufferMs,h=u.connection.user.audioTrack,10<I.totalDuration&&$a.isRemoteAudioFreeze(h)&&(I.totalFreezeTime+=1)),k&&(k.codec!=="H264"&&k.codec!=="VP8"&&k.codec!=="VP9"&&k.codec!=="AV1X"||(E.codecType=k.codec),E.receiveBytes=k.bytes,E.receiveBitrate=f?8*Math.max(0,E.receiveBytes-f.receiveBytes):0,E.decodeFrameRate=k.decodeFrameRate,E.renderFrameRate=k.decodeFrameRate,k.outputFrame&&(E.renderFrameRate=k.outputFrame.frameRate),k.receivedFrame?(E.receiveFrameRate=k.receivedFrame.frameRate,E.receiveResolutionHeight=k.receivedFrame.height,E.receiveResolutionWidth=k.receivedFrame.width):u.connection.user.videoTrack&&(E.receiveResolutionHeight=u.connection.user.videoTrack._videoHeight||0,E.receiveResolutionWidth=u.connection.user.videoTrack._videoWidth||0),k.framesRateFirefox!==void 0&&(E.receiveFrameRate=Math.round(k.framesRateFirefox)),E.receivePackets=k.packets,E.receivePacketsLost=k.packetsLost,E.packetLossRate=E.receivePacketsLost/(E.receivePackets+E.receivePacketsLost),E.totalDuration=f?f.totalDuration+1:1,E.totalFreezeTime=f?f.totalFreezeTime:0,E.receiveDelay=k.jitterBufferMs||0,f=u.connection.user.videoTrack,u.connection.subscribeOptions.video&&B&&$a.isRemoteVideoFreeze(f,k,m)&&(E.totalFreezeTime+=1),E.freezeRate=E.totalFreezeTime/E.totalDuration),P&&(I.end2EndDelay=P.B_ad,E.end2EndDelay=P.B_vd,I.transportDelay=P.B_ed,E.transportDelay=P.B_ed,I.currentPacketLossRate=P.B_ealr4/100,E.currentPacketLossRate=P.B_evlr4/100,_.uplinkNetworkQuality=P.B_punq?P.B_punq:0,_.downlinkNetworkQuality=P.B_pdnq?P.B_punq:0),u.audioStats=I,u.videoStats=E,u.pcStats=S,u.networkStats=_,u.connection.user.audioTrack&&this.exceptionMonitor.setRemoteAudioStats(u.connection.user.audioTrack,I),u.connection.user.videoTrack&&this.exceptionMonitor.setRemoteVideoStats(u.connection.user.videoTrack,E)}),W(c=this.localConnectionsMap).call(c,u=>{let h=u.audioStats,A=u.videoStats,f=po({},Ju),m=po({},zu);var I=u.connection.pc.getStats();let E=I.audioSend[0];I=I.videoSend[0];let _=u.connection.getUserId();E&&(E.codec!=="opus"&&E.codec!=="aac"||(f.codecType=E.codec),E.inputLevel?f.sendVolumeLevel=Math.round(32767*E.inputLevel):u.connection.audioTrack&&(f.sendVolumeLevel=Math.round(32767*u.connection.audioTrack.getVolumeLevel())),f.sendBytes=E.bytes,f.sendPackets=E.packets,f.sendPacketsLost=E.packetsLost,f.sendBitrate=h?8*Math.max(0,f.sendBytes-h.sendBytes):0),I&&(I.codec!=="H264"&&I.codec!=="VP8"&&I.codec!=="VP9"&&I.codec!=="AV1X"||(m.codecType=I.codec),m.sendBytes=I.bytes,m.sendBitrate=A?8*Math.max(0,m.sendBytes-A.sendBytes):0,I.inputFrame?(m.captureFrameRate=I.inputFrame.frameRate,m.captureResolutionHeight=I.inputFrame.height,m.captureResolutionWidth=I.inputFrame.width):u.connection.videoTrack&&(m.captureResolutionWidth=u.connection.videoTrack._videoWidth||0,m.captureResolutionHeight=u.connection.videoTrack._videoHeight||0),I.sentFrame?(m.sendFrameRate=I.sentFrame.frameRate,m.sendResolutionHeight=I.sentFrame.height,m.sendResolutionWidth=I.sentFrame.width):u.connection.videoTrack&&(m.sendResolutionWidth=u.connection.videoTrack._videoWidth||0,m.sendResolutionHeight=u.connection.videoTrack._videoHeight||0),I.avgEncodeMs&&(m.encodeDelay=I.avgEncodeMs),u.connection.videoTrack&&u.connection.videoTrack._encoderConfig&&u.connection.videoTrack._encoderConfig.bitrateMax&&(m.targetSendBitrate=1e3*u.connection.videoTrack._encoderConfig.bitrateMax),m.sendPackets=I.packets,m.sendPacketsLost=I.packetsLost,m.totalDuration=A?A.totalDuration+1:1,m.totalFreezeTime=A?A.totalFreezeTime:0,this.isLocalVideoFreeze(I)&&(m.totalFreezeTime+=1)),this.trafficStats&&(f.sendPacketsLost=this.trafficStats.B_palr4/100,m.sendPacketsLost=this.trafficStats.B_pvlr4/100),u.audioStats=f,u.videoStats=m,u.audioStats&&u.connection.audioTrack&&this.exceptionMonitor.setLocalAudioStats(_,u.connection.audioTrack,u.audioStats),u.videoStats&&u.connection.videoTrack&&this.exceptionMonitor.setLocalVideoStats(_,u.connection.videoTrack,u.videoStats)})},this.clientId=r,this.updateStatsInterval=window.setInterval(this.updateStats,1e3),this.exceptionMonitor=new o2,this.exceptionMonitor.on("exception",(s,c,u)=>{this.onStatsException&&this.onStatsException(s,c,u)})}reset(){this.localConnectionsMap=new Ct,this.remoteConnectionsMap=new Ct,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(r){return(r=this.localConnectionsMap.get(r))&&r.audioStats?r.audioStats:po({},Ju)}getLocalVideoTrackStats(r){return(r=this.localConnectionsMap.get(r))&&r.videoStats?r.videoStats:po({},zu)}getRemoteAudioTrackStats(r){var s;let c=this.remoteConnectionsMap.get(r);return!c||!c.audioStats?po({},Sp):this.trafficStats?(r=Je(s=this.trafficStats.peer_delay).call(s,u=>u.peer_uid===c.connection.user.uid),r&&(c.audioStats.publishDuration=r.B_ppad+(de()-this.trafficStats.timestamp)),c.audioStats):c.audioStats}getRemoteNetworkQualityStats(r){return(r=this.remoteConnectionsMap.get(r))&&r.networkStats?r.networkStats:po({},kE)}getRemoteVideoTrackStats(r){var s;let c=this.remoteConnectionsMap.get(r);return!c||!c.videoStats?po({},Tp):this.trafficStats?(r=Je(s=this.trafficStats.peer_delay).call(s,u=>u.peer_uid===c.connection.user.uid),r&&(c.videoStats.publishDuration=r.B_ppvd+(de()-this.trafficStats.timestamp)),c.videoStats):c.videoStats}getRTCStats(){var r,s;let c=0,u=0,h=0,A=0;return W(r=this.localConnectionsMap).call(r,f=>{f.audioStats&&(c+=f.audioStats.sendBytes,u+=f.audioStats.sendBitrate),f.videoStats&&(c+=f.videoStats.sendBytes,u+=f.videoStats.sendBitrate)}),W(s=this.remoteConnectionsMap).call(s,f=>{f.audioStats&&(h+=f.audioStats.receiveBytes,A+=f.audioStats.receiveBitrate),f.videoStats&&(h+=f.videoStats.receiveBytes,A+=f.videoStats.receiveBitrate)}),r=1,this.trafficStats&&(r+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:r,SendBitrate:u,SendBytes:c,RecvBytes:h,RecvBitrate:A,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}removeConnection(r){this.localConnectionsMap.delete(r),this.remoteConnectionsMap.delete(r)}addLocalConnection(r){let s=r.connectionId;this.localConnectionsMap.has(s)||this.localConnectionsMap.set(s,{connection:r})}addRemoteConnection(r){let s=r.connectionId;this.remoteConnectionsMap.has(s)||this.remoteConnectionsMap.set(s,{connection:r})}updateTrafficStats(r){var s;let c=Qe(s=r.peer_delay).call(s,u=>{var h;return Ge(h=this.trafficStatsPeerList).call(h,u.peer_uid)===-1});W(c).call(c,u=>{var h,A;let f=Je(h=Ji(Js(A=this.remoteConnectionsMap).call(A))).call(h,m=>m.connection._userId===u.peer_uid);u.B_ppad!==void 0&&u.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(u.peer_uid,u.B_ppad,u.B_ppvd,f?de()-f.connection.startTime:0),this.trafficStatsPeerList.push(u.peer_uid))}),this.trafficStats=r}updateUplinkStats(r){var s;this.uplinkStats&&this.uplinkStats.B_fir!==r.B_fir&&R.debug(b(s="[".concat(this.clientId,"]: Period fir changes to ")).call(s,r.B_fir)),this.uplinkStats=r}static isRemoteVideoFreeze(r,s,c){return r?(r=!c||s.framesDecodeCount>c.framesDecodeCount,!!c&&s.framesDecodeFreezeTime>c.framesDecodeFreezeTime||!r):!1}static isRemoteAudioFreeze(r){return!!r&&r._isFreeze()}isLocalVideoFreeze(r){return!(!r.inputFrame||!r.sentFrame)&&5<r.inputFrame.frameRate&&3>r.sentFrame.frameRate}}var n1;let td=()=>{},i1={},o1=new class{constructor(){this.fnMap=new Ct}throttleByKey(i,r,s,c,...u){if(this.fnMap.has(r)){var h=this.fnMap.get(r);h.threshold!==s?(h.fn(...h.args),clearTimeout(h.timer),h=window.setTimeout(()=>{const A=this.fnMap.get(r);A&&A.fn(...A.args),this.fnMap.delete(r)},s),this.fnMap.set(r,{fn:i,threshold:s,timer:h,args:u,skipFn:c})):(h.skipFn&&h.skipFn(...h.args),this.fnMap.set(r,Rh({},h,{fn:i,args:u,skipFn:c})))}else h=window.setTimeout(()=>{const A=this.fnMap.get(r);A&&A.fn(...A.args),this.fnMap.delete(r)},s),this.fnMap.set(r,{fn:i,threshold:s,timer:h,args:u,skipFn:c})}},s1=cr(n1=o1.throttleByKey).call(n1,o1),ec=async({fragementLength:i,referenceList:r,asyncMapHandler:s,allFailedhandler:c,promisesCollector:u})=>{let h=0,A,f=0;const m=async()=>{const I=(()=>{var E=h*i;const _=E+i;return E=Mr(r).call(r,E,_),Ie(E).call(E,s)})();u&&u.push(...I);try{A=await Oa(I)}catch(E){if(f+=i,h++,!(f>=r.length))return void await m();c(E)}W(I).call(I,E=>E.cancel())};return await m(),A},s2={[Ja.ACCESS_POINT]:{[Hr.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Hr.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Hr.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Hr.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Hr.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Hr.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voice service available",retry:!0},[Hr.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Hr.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Hr.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Hr.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Hr.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Hr.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Hr.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Hr.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Hr.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Hr.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[Ja.UNILBS]:{[Kn.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Kn.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Kn.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Kn.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Kn.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Kn.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Kn.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Kn.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Kn.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Kn.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Kn.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Kn.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[Ja.STRING_UID_ALLOCATOR]:{[sl.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[sl.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[sl.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}},a2={[ke.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[ke.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[ke.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[ke.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[ke.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[ke.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[ke.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[ke.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[ke.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[ke.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[ke.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[ke.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[ke.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[ke.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[ke.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[ke.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[ke.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[ke.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[ke.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[ke.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[ke.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[ke.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[ke.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[ke.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[ke.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[ke.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[ke.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[ke.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[ke.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[ke.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[ke.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[ke.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[ke.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[ke.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[ke.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[ke.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[ke.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[ke.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[ke.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[ke.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[ke.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[ke.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[ke.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[ke.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[ke.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[ke.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[ke.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[ke.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[ke.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[ke.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[ke.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[ke.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[ke.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[ke.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[ke.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[ke.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"}};var c2=t(function(i,r){i.exports=function(){function s(U){for(var T=U.length,V=0,H=0;H<T;){var Z=U.charCodeAt(H++);if((4294967168&Z)!=0)if((4294965248&Z)==0)V+=2;else{if(55296<=Z&&56319>=Z&&H<T){var Y=U.charCodeAt(H);(64512&Y)==56320&&(++H,Z=((1023&Z)<<10)+(1023&Y)+65536)}V+=(4294901760&Z)==0?3:4}else V++}return V}function c(U,T,V){V=T+V;for(var H=[],Z="";T<V;){var Y=U[T++];if((128&Y)==0)H.push(Y);else if((224&Y)==192){var Ce=63&U[T++];H.push((31&Y)<<6|Ce)}else if((240&Y)==224){Ce=63&U[T++];var ae=63&U[T++];H.push((31&Y)<<12|Ce<<6|ae)}else(248&Y)==240&&(Y=(7&Y)<<18|(63&U[T++])<<12|(63&U[T++])<<6|63&U[T++],65535<Y&&(Y-=65536,H.push(Y>>>10&1023|55296),Y=56320|1023&Y)),H.push(Y);4096<=H.length&&(Z+=String.fromCharCode.apply(String,ve([],yt(H))),H.length=0)}return 0<H.length&&(Z+=String.fromCharCode.apply(String,ve([],yt(H)))),Z}function u(U,T){return 4294967296*U.getInt32(T)+U.getUint32(T+4)}function h(U){var T,V=U.sec;if(U=U.nsec,0<=V&&0<=U&&17179869183>=V){if(U===0&&4294967295>=V){var H=new Uint8Array(4);return new DataView(H.buffer).setUint32(0,V),H}var Z=V/4294967296;return V&=4294967295,H=new Uint8Array(8),(T=new DataView(H.buffer)).setUint32(0,U<<2|3&Z),T.setUint32(4,V),H}return H=new Uint8Array(12),(T=new DataView(H.buffer)).setUint32(0,U),T.setUint32(4,Math.floor(V/4294967296)),T.setUint32(8,V),H}function A(U){var T=U.getTime();U=Math.floor(T/1e3),T=1e6*(T-1e3*U);var V=Math.floor(T/1e9);return{sec:U+V,nsec:T-1e9*V}}function f(U){return U instanceof Date?h(A(U)):null}function m(U){var T=new DataView(U.buffer,U.byteOffset,U.byteLength);switch(U.byteLength){case 4:return{sec:T.getUint32(0),nsec:0};case 8:return U=T.getUint32(0),{sec:4294967296*(3&U)+T.getUint32(4),nsec:U>>>2};case 12:return{sec:u(T,4),nsec:T.getUint32(0)};default:throw Error("Unrecognized data size for timestamp: "+U.length)}}function I(U){return U=m(U),new Date(1e3*U.sec+U.nsec/1e6)}function E(U){return U instanceof Uint8Array?U:ArrayBuffer.isView(U)?new Uint8Array(U.buffer,U.byteOffset,U.byteLength):U instanceof ArrayBuffer?new Uint8Array(U):Uint8Array.from(U)}function _(U,T){return T===void 0&&(T=_e),new Pe(T.extensionCodec,T.context,T.maxDepth,T.initialBufferSize,T.sortKeys,T.forceFloat32,T.ignoreUndefined,T.forceIntegerToFloat).encode(U)}function S(U){return(0>U?"-":"")+"0x"+Math.abs(U).toString(16).padStart(2,"0")}function N(U,T){return T===void 0&&(T=ac),new sc(T.extensionCodec,T.context,T.maxStrLength,T.maxBinLength,T.maxArrayLength,T.maxMapLength,T.maxExtLength).decode(U)}function k(U,T){return T===void 0&&(T=ac),new sc(T.extensionCodec,T.context,T.maxStrLength,T.maxBinLength,T.maxArrayLength,T.maxMapLength,T.maxExtLength).decodeMulti(U)}function B(U){return U[Symbol.asyncIterator]!=null?U:function(T){return Qw(this,arguments,function(){var V,H,Z,Y;return Pw(this,function(Ce){switch(Ce.label){case 0:V=T.getReader(),Ce.label=1;case 1:Ce.trys.push([1,,9,10]),Ce.label=2;case 2:return[4,cc(V.read())];case 3:return H=Ce.sent(),Z=H.done,Y=H.value,Z?[4,cc(void 0)]:[3,5];case 4:return[2,Ce.sent()];case 5:if(Y==null)throw Error("Assertion Failure: value must not be null nor undefined");return[4,cc(Y)];case 6:return[4,Ce.sent()];case 7:return Ce.sent(),[3,2];case 8:return[3,10];case 9:return V.releaseLock(),[7];case 10:return[2]}})})}(U)}function P(U,T){return T===void 0&&(T=ac),V=this,H=void 0,Y=function(){var Ce;return function(ae,Ke){function Dt(hi){return function(lc){return function(pt){if(le)throw new TypeError("Generator is already executing.");for(;ut;)try{if(le=1,Se&&(Ee=2&pt[0]?Se.return:pt[0]?Se.throw||((Ee=Se.return)&&Ee.call(Se),0):Se.next)&&!(Ee=Ee.call(Se,pt[1])).done)return Ee;switch(Se=0,Ee&&(pt=[2&pt[0],Ee.value]),pt[0]){case 0:case 1:Ee=pt;break;case 4:return ut.label++,{value:pt[1],done:!1};case 5:ut.label++,Se=pt[1],pt=[0];continue;case 7:pt=ut.ops.pop(),ut.trys.pop();continue;default:if(!((Ee=0<(Ee=ut.trys).length&&Ee[Ee.length-1])||pt[0]!==6&&pt[0]!==2)){ut=0;continue}if(pt[0]===3&&(!Ee||pt[1]>Ee[0]&&pt[1]<Ee[3]))ut.label=pt[1];else if(pt[0]===6&&ut.label<Ee[1])ut.label=Ee[1],Ee=pt;else if(Ee&&ut.label<Ee[2])ut.label=Ee[2],ut.ops.push(pt);else{Ee[2]&&ut.ops.pop(),ut.trys.pop();continue}}pt=Ke.call(ae,ut)}catch(fd){pt=[6,fd],Se=0}finally{le=Ee=0}if(5&pt[0])throw pt[1];return{value:pt[0]?pt[1]:void 0,done:!0}}([hi,lc])}}var le,Se,Ee,Vt,ut={label:0,sent:function(){if(1&Ee[0])throw Ee[1];return Ee[1]},trys:[],ops:[]};return Vt={next:Dt(0),throw:Dt(1),return:Dt(2)},typeof Symbol=="function"&&(Vt[Symbol.iterator]=function(){return this}),Vt}(this,function(ae){return Ce=B(U),[2,new sc(T.extensionCodec,T.context,T.maxStrLength,T.maxBinLength,T.maxArrayLength,T.maxMapLength,T.maxExtLength).decodeAsync(Ce)]})},new(Z=void 0,Z=Promise)(function(Ce,ae){function Ke(Se){try{le(Y.next(Se))}catch(Ee){ae(Ee)}}function Dt(Se){try{le(Y.throw(Se))}catch(Ee){ae(Ee)}}function le(Se){var Ee;Se.done?Ce(Se.value):(Ee=Se.value,Ee instanceof Z?Ee:new Z(function(Vt){Vt(Ee)})).then(Ke,Dt)}le((Y=Y.apply(V,H||[])).next())});var V,H,Z,Y}function J(U,T){return T===void 0&&(T=ac),U=B(U),new sc(T.extensionCodec,T.context,T.maxStrLength,T.maxBinLength,T.maxArrayLength,T.maxMapLength,T.maxExtLength).decodeArrayStream(U)}function se(U,T){return T===void 0&&(T=ac),U=B(U),new sc(T.extensionCodec,T.context,T.maxStrLength,T.maxBinLength,T.maxArrayLength,T.maxMapLength,T.maxExtLength).decodeStream(U)}function ge(U,T){return T===void 0&&(T=ac),se(U,T)}var Le={d:function(U,T){for(var V in T)Le.o(T,V)&&!Le.o(U,V)&&Object.defineProperty(U,V,{enumerable:!0,get:T[V]})},o:function(U,T){return Object.prototype.hasOwnProperty.call(U,T)},r:function(U){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(U,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(U,"__esModule",{value:!0})}},Be={};Le.r(Be),Le.d(Be,{DecodeError:function(){return Io},Decoder:function(){return sc},EXT_TIMESTAMP:function(){return q},Encoder:function(){return Pe},ExtData:function(){return j},ExtensionCodec:function(){return he},decode:function(){return N},decodeArrayStream:function(){return J},decodeAsync:function(){return P},decodeMulti:function(){return k},decodeMultiStream:function(){return se},decodeStream:function(){return ge},decodeTimestampExtension:function(){return I},decodeTimestampToTimeSpec:function(){return m},encode:function(){return _},encodeDateToTimeSpec:function(){return A},encodeTimeSpecToTimestamp:function(){return h},encodeTimestampExtension:function(){return f}});var yt=function(U,T){var V=typeof Symbol=="function"&&U[Symbol.iterator];if(!V)return U;var H;U=V.call(U);var Z=[];try{for(;(T===void 0||0<T--)&&!(H=U.next()).done;)Z.push(H.value)}catch(Ce){var Y={error:Ce}}finally{try{H&&!H.done&&(V=U.return)&&V.call(U)}finally{if(Y)throw Y.error}}return Z},ve=function(U,T){for(var V=0,H=T.length,Z=U.length;V<H;V++,Z++)U[Z]=T[V];return U},Ze=typeof TextEncoder!="undefined"&&typeof TextDecoder!="undefined",vt=Ze?new TextEncoder:void 0,Wt=Ze?typeof process!="undefined"?200:0:4294967295,Nr=(vt==null?0:vt.encodeInto)?function(U,T,V){vt.encodeInto(U,T.subarray(V))}:function(U,T,V){T.set(vt.encode(U),V)},Pt=Ze?new TextDecoder:null,en=Ze?typeof process!="undefined"?200:0:4294967295,j=function(U,T){this.type=U,this.data=T},q=-1,$={type:q,encode:f,decode:I},he=function(){function U(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register($)}return U.prototype.register=function(T){var V=T.type,H=T.encode;T=T.decode,0<=V?(this.encoders[V]=H,this.decoders[V]=T):(V=1+V,this.builtInEncoders[V]=H,this.builtInDecoders[V]=T)},U.prototype.tryToEncode=function(T,V){for(var H=0;H<this.builtInEncoders.length;H++)if((Z=this.builtInEncoders[H])!=null&&(Y=Z(T,V))!=null)return new j(-1-H,Y);for(H=0;H<this.encoders.length;H++){var Z,Y;if((Z=this.encoders[H])!=null&&(Y=Z(T,V))!=null)return new j(H,Y)}return T instanceof j?T:null},U.prototype.decode=function(T,V,H){var Z=0>V?this.builtInDecoders[-1-V]:this.decoders[V];return Z?Z(T,V,H):new j(V,T)},U.defaultCodec=new U,U}(),pe=function(U){var T=typeof Symbol=="function"&&Symbol.iterator,V=T&&U[T],H=0;if(V)return V.call(U);if(U&&typeof U.length=="number")return{next:function(){return U&&H>=U.length&&(U=void 0),{value:U&&U[H++],done:!U}}};throw new TypeError(T?"Object is not iterable.":"Symbol.iterator is not defined.")},Pe=function(){function U(T,V,H,Z,Y,Ce,ae,Ke){T===void 0&&(T=he.defaultCodec),V===void 0&&(V=void 0),H===void 0&&(H=100),Z===void 0&&(Z=2048),Y===void 0&&(Y=!1),Ce===void 0&&(Ce=!1),ae===void 0&&(ae=!1),Ke===void 0&&(Ke=!1),this.extensionCodec=T,this.context=V,this.maxDepth=H,this.initialBufferSize=Z,this.sortKeys=Y,this.forceFloat32=Ce,this.ignoreUndefined=ae,this.forceIntegerToFloat=Ke,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}return U.prototype.getUint8Array=function(){return this.bytes.subarray(0,this.pos)},U.prototype.reinitializeState=function(){this.pos=0},U.prototype.encode=function(T){return this.reinitializeState(),this.doEncode(T,1),this.getUint8Array()},U.prototype.doEncode=function(T,V){if(V>this.maxDepth)throw Error("Too deep objects in depth "+V);T==null?this.encodeNil():typeof T=="boolean"?this.encodeBoolean(T):typeof T=="number"?this.encodeNumber(T):typeof T=="string"?this.encodeString(T):this.encodeObject(T,V)},U.prototype.ensureBufferSizeToWrite=function(T){T=this.pos+T,this.view.byteLength<T&&this.resizeBuffer(2*T)},U.prototype.resizeBuffer=function(T){var V=new ArrayBuffer(T);T=new Uint8Array(V),V=new DataView(V),T.set(this.bytes),this.view=V,this.bytes=T},U.prototype.encodeNil=function(){this.writeU8(192)},U.prototype.encodeBoolean=function(T){T===!1?this.writeU8(194):this.writeU8(195)},U.prototype.encodeNumber=function(T){Number.isSafeInteger(T)&&!this.forceIntegerToFloat?0<=T?128>T?this.writeU8(T):256>T?(this.writeU8(204),this.writeU8(T)):65536>T?(this.writeU8(205),this.writeU16(T)):4294967296>T?(this.writeU8(206),this.writeU32(T)):(this.writeU8(207),this.writeU64(T)):-32<=T?this.writeU8(224|T+32):-128<=T?(this.writeU8(208),this.writeI8(T)):-32768<=T?(this.writeU8(209),this.writeI16(T)):-2147483648<=T?(this.writeU8(210),this.writeI32(T)):(this.writeU8(211),this.writeI64(T)):this.forceFloat32?(this.writeU8(202),this.writeF32(T)):(this.writeU8(203),this.writeF64(T))},U.prototype.writeStringHeader=function(T){if(32>T)this.writeU8(160+T);else if(256>T)this.writeU8(217),this.writeU8(T);else if(65536>T)this.writeU8(218),this.writeU16(T);else{if(!(4294967296>T))throw Error("Too long string: "+T+" bytes in UTF-8");this.writeU8(219),this.writeU32(T)}},U.prototype.encodeString=function(T){if(T.length>Wt){var V=s(T);this.ensureBufferSizeToWrite(5+V),this.writeStringHeader(V),Nr(T,this.bytes,this.pos)}else{V=s(T),this.ensureBufferSizeToWrite(5+V),this.writeStringHeader(V);for(var H=this.bytes,Z=T.length,Y=this.pos,Ce=0;Ce<Z;){var ae=T.charCodeAt(Ce++);if((4294967168&ae)!=0){if((4294965248&ae)==0)H[Y++]=ae>>6&31|192;else{if(55296<=ae&&56319>=ae&&Ce<Z){var Ke=T.charCodeAt(Ce);(64512&Ke)==56320&&(++Ce,ae=((1023&ae)<<10)+(1023&Ke)+65536)}(4294901760&ae)==0?(H[Y++]=ae>>12&15|224,H[Y++]=ae>>6&63|128):(H[Y++]=ae>>18&7|240,H[Y++]=ae>>12&63|128,H[Y++]=ae>>6&63|128)}H[Y++]=63&ae|128}else H[Y++]=ae}}this.pos+=V},U.prototype.encodeObject=function(T,V){var H=this.extensionCodec.tryToEncode(T,this.context);if(H!=null)this.encodeExtension(H);else if(Array.isArray(T))this.encodeArray(T,V);else if(ArrayBuffer.isView(T))this.encodeBinary(T);else{if(typeof T!="object")throw Error("Unrecognized object: "+Object.prototype.toString.apply(T));this.encodeMap(T,V)}},U.prototype.encodeBinary=function(T){var V=T.byteLength;if(256>V)this.writeU8(196),this.writeU8(V);else if(65536>V)this.writeU8(197),this.writeU16(V);else{if(!(4294967296>V))throw Error("Too large binary: "+V);this.writeU8(198),this.writeU32(V)}T=E(T),this.writeU8a(T)},U.prototype.encodeArray=function(T,V){var H,Z=T.length;if(16>Z)this.writeU8(144+Z);else if(65536>Z)this.writeU8(220),this.writeU16(Z);else{if(!(4294967296>Z))throw Error("Too large array: "+Z);this.writeU8(221),this.writeU32(Z)}try{for(var Y=pe(T),Ce=Y.next();!Ce.done;Ce=Y.next())this.doEncode(Ce.value,V+1)}catch(Ke){var ae={error:Ke}}finally{try{Ce&&!Ce.done&&(H=Y.return)&&H.call(Y)}finally{if(ae)throw ae.error}}},U.prototype.countWithoutUndefined=function(T,V){var H,Z=0;try{for(var Y=pe(V),Ce=Y.next();!Ce.done;Ce=Y.next())T[Ce.value]!==void 0&&Z++}catch(Ke){var ae={error:Ke}}finally{try{Ce&&!Ce.done&&(H=Y.return)&&H.call(Y)}finally{if(ae)throw ae.error}}return Z},U.prototype.encodeMap=function(T,V){var H,Z=Object.keys(T);this.sortKeys&&Z.sort();var Y=this.ignoreUndefined?this.countWithoutUndefined(T,Z):Z.length;if(16>Y)this.writeU8(128+Y);else if(65536>Y)this.writeU8(222),this.writeU16(Y);else{if(!(4294967296>Y))throw Error("Too large map object: "+Y);this.writeU8(223),this.writeU32(Y)}try{for(var Ce=pe(Z),ae=Ce.next();!ae.done;ae=Ce.next()){var Ke=ae.value,Dt=T[Ke];this.ignoreUndefined&&Dt===void 0||(this.encodeString(Ke),this.doEncode(Dt,V+1))}}catch(Se){var le={error:Se}}finally{try{ae&&!ae.done&&(H=Ce.return)&&H.call(Ce)}finally{if(le)throw le.error}}},U.prototype.encodeExtension=function(T){var V=T.data.length;if(V===1)this.writeU8(212);else if(V===2)this.writeU8(213);else if(V===4)this.writeU8(214);else if(V===8)this.writeU8(215);else if(V===16)this.writeU8(216);else if(256>V)this.writeU8(199),this.writeU8(V);else if(65536>V)this.writeU8(200),this.writeU16(V);else{if(!(4294967296>V))throw Error("Too large extension object: "+V);this.writeU8(201),this.writeU32(V)}this.writeI8(T.type),this.writeU8a(T.data)},U.prototype.writeU8=function(T){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,T),this.pos++},U.prototype.writeU8a=function(T){var V=T.length;this.ensureBufferSizeToWrite(V),this.bytes.set(T,this.pos),this.pos+=V},U.prototype.writeI8=function(T){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,T),this.pos++},U.prototype.writeU16=function(T){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,T),this.pos+=2},U.prototype.writeI16=function(T){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,T),this.pos+=2},U.prototype.writeU32=function(T){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,T),this.pos+=4},U.prototype.writeI32=function(T){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,T),this.pos+=4},U.prototype.writeF32=function(T){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,T),this.pos+=4},U.prototype.writeF64=function(T){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,T),this.pos+=8},U.prototype.writeU64=function(T){this.ensureBufferSizeToWrite(8);var V=this.view,H=this.pos;V.setUint32(H,T/4294967296),V.setUint32(H+4,T),this.pos+=8},U.prototype.writeI64=function(T){this.ensureBufferSizeToWrite(8);var V=this.view,H=this.pos;V.setUint32(H,Math.floor(T/4294967296)),V.setUint32(H+4,T),this.pos+=8},U}(),_e={},gr;Ze=function(){function U(T,V){for(T===void 0&&(T=16),V===void 0&&(V=16),this.maxKeyLength=T,this.maxLengthPerKey=V,this.miss=this.hit=0,this.caches=[],T=0;T<this.maxKeyLength;T++)this.caches.push([])}return U.prototype.canBeCached=function(T){return 0<T&&T<=this.maxKeyLength},U.prototype.find=function(T,V,H){var Z,Y=this.caches[H-1];try{var Ce=function(Se){var Ee=typeof Symbol=="function"&&Symbol.iterator,Vt=Ee&&Se[Ee],ut=0;if(Vt)return Vt.call(Se);if(Se&&typeof Se.length=="number")return{next:function(){return Se&&ut>=Se.length&&(Se=void 0),{value:Se&&Se[ut++],done:!Se}}};throw new TypeError(Ee?"Object is not iterable.":"Symbol.iterator is not defined.")}(Y),ae=Ce.next();e:for(;!ae.done;ae=Ce.next()){var Ke=ae.value,Dt=Ke.bytes;for(Y=0;Y<H;Y++)if(Dt[Y]!==T[V+Y])continue e;return Ke.str}}catch(Se){var le={error:Se}}finally{try{ae&&!ae.done&&(Z=Ce.return)&&Z.call(Ce)}finally{if(le)throw le.error}}return null},U.prototype.store=function(T,V){var H=this.caches[T.length-1];T={bytes:T,str:V},H.length>=this.maxLengthPerKey?H[Math.random()*H.length|0]=T:H.push(T)},U.prototype.decode=function(T,V,H){var Z=this.find(T,V,H);return Z!=null?(this.hit++,Z):(this.miss++,Z=c(T,V,H),T=Uint8Array.prototype.slice.call(T,V,V+H),this.store(T,Z),Z)},U}();var $s=(gr=function(U,T){return(gr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(V,H){V.__proto__=H}||function(V,H){for(var Z in H)Object.prototype.hasOwnProperty.call(H,Z)&&(V[Z]=H[Z])})(U,T)},function(U,T){function V(){this.constructor=U}if(typeof T!="function"&&T!==null)throw new TypeError("Class extends value "+String(T)+" is not a constructor or null");gr(U,T),U.prototype=T===null?Object.create(T):(V.prototype=T.prototype,new V)}),ea=function(U,T){function V(Ke){return function(Dt){return function(le){if(H)throw new TypeError("Generator is already executing.");for(;ae;)try{if(H=1,Z&&(Y=2&le[0]?Z.return:le[0]?Z.throw||((Y=Z.return)&&Y.call(Z),0):Z.next)&&!(Y=Y.call(Z,le[1])).done)return Y;switch(Z=0,Y&&(le=[2&le[0],Y.value]),le[0]){case 0:case 1:Y=le;break;case 4:return ae.label++,{value:le[1],done:!1};case 5:ae.label++,Z=le[1],le=[0];continue;case 7:le=ae.ops.pop(),ae.trys.pop();continue;default:if(!((Y=0<(Y=ae.trys).length&&Y[Y.length-1])||le[0]!==6&&le[0]!==2)){ae=0;continue}if(le[0]===3&&(!Y||le[1]>Y[0]&&le[1]<Y[3]))ae.label=le[1];else if(le[0]===6&&ae.label<Y[1])ae.label=Y[1],Y=le;else if(Y&&ae.label<Y[2])ae.label=Y[2],ae.ops.push(le);else{Y[2]&&ae.ops.pop(),ae.trys.pop();continue}}le=T.call(U,ae)}catch(Se){le=[6,Se],Z=0}finally{H=Y=0}if(5&le[0])throw le[1];return{value:le[0]?le[1]:void 0,done:!0}}([Ke,Dt])}}var H,Z,Y,Ce,ae={label:0,sent:function(){if(1&Y[0])throw Y[1];return Y[1]},trys:[],ops:[]};return Ce={next:V(0),throw:V(1),return:V(2)},typeof Symbol=="function"&&(Ce[Symbol.iterator]=function(){return this}),Ce},oc=function(U){function T(Z){V[Z]=U[Z]&&function(Y){return new Promise(function(Ce,ae){(function(Ke,Dt,le,Se){Promise.resolve(Se).then(function(Ee){Ke({value:Ee,done:le})},Dt)})(Ce,ae,(Y=U[Z](Y)).done,Y.value)})}}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var V,H=U[Symbol.asyncIterator];return H?H.call(U):(U=typeof __values=="function"?__values(U):U[Symbol.iterator](),V={},T("next"),T("throw"),T("return"),V[Symbol.asyncIterator]=function(){return this},V)},nt=function(U){return this instanceof nt?(this.v=U,this):new nt(U)},Yt=function(U,T,V){function H(Se){Dt[Se]&&(Ke[Se]=function(Ee){return new Promise(function(Vt,ut){1<le.push([Se,Ee,Vt,ut])||Z(Se,Ee)})})}function Z(Se,Ee){try{(Vt=Dt[Se](Ee)).value instanceof nt?Promise.resolve(Vt.value.v).then(Y,Ce):ae(le[0][2],Vt)}catch(ut){ae(le[0][3],ut)}var Vt}function Y(Se){Z("next",Se)}function Ce(Se){Z("throw",Se)}function ae(Se,Ee){Se(Ee),le.shift(),le.length&&Z(le[0][0],le[0][1])}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var Ke,Dt=V.apply(U,T||[]),le=[];return Ke={},H("next"),H("throw"),H("return"),Ke[Symbol.asyncIterator]=function(){return this},Ke},kr=new DataView(new ArrayBuffer(0)),mr=new Uint8Array(kr.buffer);e:{try{kr.getInt8(0)}catch(U){var ur=U.constructor;break e}throw Error("never reached")}var Xi=new ur("Insufficient data"),xr=new Ze,Io=function(U){function T(V){V=U.call(this,V)||this;var H=Object.create(T.prototype);return Object.setPrototypeOf(V,H),Object.defineProperty(V,"name",{configurable:!0,enumerable:!1,value:T.name}),V}return $s(T,U),T}(Error),sc=function(){function U(T,V,H,Z,Y,Ce,ae,Ke){T===void 0&&(T=he.defaultCodec),V===void 0&&(V=void 0),H===void 0&&(H=4294967295),Z===void 0&&(Z=4294967295),Y===void 0&&(Y=4294967295),Ce===void 0&&(Ce=4294967295),ae===void 0&&(ae=4294967295),Ke===void 0&&(Ke=xr),this.extensionCodec=T,this.context=V,this.maxStrLength=H,this.maxBinLength=Z,this.maxArrayLength=Y,this.maxMapLength=Ce,this.maxExtLength=ae,this.keyDecoder=Ke,this.pos=this.totalPos=0,this.view=kr,this.bytes=mr,this.headByte=-1,this.stack=[]}return U.prototype.reinitializeState=function(){this.totalPos=0,this.headByte=-1,this.stack.length=0},U.prototype.setBuffer=function(T){this.bytes=E(T),T=this.bytes,T instanceof ArrayBuffer?T=new DataView(T):(T=E(T),T=new DataView(T.buffer,T.byteOffset,T.byteLength)),this.view=T,this.pos=0},U.prototype.appendBuffer=function(T){if(this.headByte!==-1||this.hasRemaining()){var V=this.bytes.subarray(this.pos);T=E(T);var H=new Uint8Array(V.length+T.length);H.set(V),H.set(T,V.length),this.setBuffer(H)}else this.setBuffer(T)},U.prototype.hasRemaining=function(T){return T===void 0&&(T=1),this.view.byteLength-this.pos>=T},U.prototype.createExtraByteError=function(T){var V=this.view;return new RangeError("Extra "+(V.byteLength-this.pos)+" of "+V.byteLength+" byte(s) found at buffer["+T+"]")},U.prototype.decode=function(T){if(this.reinitializeState(),this.setBuffer(T),T=this.doDecodeSync(),this.hasRemaining())throw this.createExtraByteError(this.pos);return T},U.prototype.decodeMulti=function(T){return ea(this,function(V){switch(V.label){case 0:this.reinitializeState(),this.setBuffer(T),V.label=1;case 1:return this.hasRemaining()?[4,this.doDecodeSync()]:[3,3];case 2:return V.sent(),[3,1];case 3:return[2]}})},U.prototype.decodeAsync=function(T){var V,H,Z,Y,Ce,ae,Ke;return Ce=this,Ke=function(){var Dt,le,Se,Ee,Vt,ut,hi,lc;return ea(this,function(pt){switch(pt.label){case 0:Dt=!1,pt.label=1;case 1:pt.trys.push([1,6,7,12]),V=oc(T),pt.label=2;case 2:return[4,V.next()];case 3:if((H=pt.sent()).done)return[3,5];if(Se=H.value,Dt)throw this.createExtraByteError(this.totalPos);this.appendBuffer(Se);try{le=this.doDecodeSync(),Dt=!0}catch(fd){if(!(fd instanceof ur))throw fd}this.totalPos+=this.pos,pt.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return Ee=pt.sent(),Z={error:Ee},[3,12];case 7:return pt.trys.push([7,,10,11]),H&&!H.done&&(Y=V.return)?[4,Y.call(V)]:[3,9];case 8:pt.sent(),pt.label=9;case 9:return[3,11];case 10:if(Z)throw Z.error;return[7];case 11:return[7];case 12:if(Dt){if(this.hasRemaining())throw this.createExtraByteError(this.totalPos);return[2,le]}throw ut=(Vt=this).headByte,hi=Vt.pos,lc=Vt.totalPos,new RangeError("Insufficient data in parsing "+S(ut)+" at "+lc+" ("+hi+" in the current buffer)")}})},new(ae=void 0,ae=Promise)(function(Dt,le){function Se(ut){try{Vt(Ke.next(ut))}catch(hi){le(hi)}}function Ee(ut){try{Vt(Ke.throw(ut))}catch(hi){le(hi)}}function Vt(ut){var hi;ut.done?Dt(ut.value):(hi=ut.value,hi instanceof ae?hi:new ae(function(lc){lc(hi)})).then(Se,Ee)}Vt((Ke=Ke.apply(Ce,[])).next())})},U.prototype.decodeArrayStream=function(T){return this.decodeMultiAsync(T,!0)},U.prototype.decodeStream=function(T){return this.decodeMultiAsync(T,!1)},U.prototype.decodeMultiAsync=function(T,V){return Yt(this,arguments,function(){var H,Z,Y,Ce,ae,Ke,Dt,le,Se;return ea(this,function(Ee){switch(Ee.label){case 0:H=V,Z=-1,Ee.label=1;case 1:Ee.trys.push([1,13,14,19]),Y=oc(T),Ee.label=2;case 2:return[4,nt(Y.next())];case 3:if((Ce=Ee.sent()).done)return[3,12];if(ae=Ce.value,V&&Z===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(ae),H&&(Z=this.readArraySize(),H=!1,this.complete()),Ee.label=4;case 4:Ee.trys.push([4,9,,10]),Ee.label=5;case 5:return[4,nt(this.doDecodeSync())];case 6:return[4,Ee.sent()];case 7:return Ee.sent(),--Z==0?[3,8]:[3,5];case 8:return[3,10];case 9:if(!((Ke=Ee.sent())instanceof ur))throw Ke;return[3,10];case 10:this.totalPos+=this.pos,Ee.label=11;case 11:return[3,2];case 12:return[3,19];case 13:return Dt=Ee.sent(),le={error:Dt},[3,19];case 14:return Ee.trys.push([14,,17,18]),Ce&&!Ce.done&&(Se=Y.return)?[4,nt(Se.call(Y))]:[3,16];case 15:Ee.sent(),Ee.label=16;case 16:return[3,18];case 17:if(le)throw le.error;return[7];case 18:return[7];case 19:return[2]}})})},U.prototype.doDecodeSync=function(){e:for(;;){var T=this.readHeadByte();if(224<=T)T-=256;else if(192>T){if(!(128>T))if(144>T){if((T-=128)!=0){this.pushMapState(T),this.complete();continue e}T={}}else if(160>T){if((T-=144)!=0){this.pushArrayState(T),this.complete();continue e}T=[]}else T-=160,T=this.decodeUtf8String(T,0)}else if(T===192)T=null;else if(T===194)T=!1;else if(T===195)T=!0;else if(T===202)T=this.readF32();else if(T===203)T=this.readF64();else if(T===204)T=this.readU8();else if(T===205)T=this.readU16();else if(T===206)T=this.readU32();else if(T===207)T=this.readU64();else if(T===208)T=this.readI8();else if(T===209)T=this.readI16();else if(T===210)T=this.readI32();else if(T===211)T=this.readI64();else if(T===217)T=this.lookU8(),T=this.decodeUtf8String(T,1);else if(T===218)T=this.lookU16(),T=this.decodeUtf8String(T,2);else if(T===219)T=this.lookU32(),T=this.decodeUtf8String(T,4);else if(T===220){if((T=this.readU16())!==0){this.pushArrayState(T),this.complete();continue e}T=[]}else if(T===221){if((T=this.readU32())!==0){this.pushArrayState(T),this.complete();continue e}T=[]}else if(T===222){if((T=this.readU16())!==0){this.pushMapState(T),this.complete();continue e}T={}}else if(T===223){if((T=this.readU32())!==0){this.pushMapState(T),this.complete();continue e}T={}}else if(T===196)T=this.lookU8(),T=this.decodeBinary(T,1);else if(T===197)T=this.lookU16(),T=this.decodeBinary(T,2);else if(T===198)T=this.lookU32(),T=this.decodeBinary(T,4);else if(T===212)T=this.decodeExtension(1,0);else if(T===213)T=this.decodeExtension(2,0);else if(T===214)T=this.decodeExtension(4,0);else if(T===215)T=this.decodeExtension(8,0);else if(T===216)T=this.decodeExtension(16,0);else if(T===199)T=this.lookU8(),T=this.decodeExtension(T,1);else if(T===200)T=this.lookU16(),T=this.decodeExtension(T,2);else{if(T!==201)throw new Io("Unrecognized type byte: "+S(T));T=this.lookU32(),T=this.decodeExtension(T,4)}this.complete();for(var V=this.stack;0<V.length;){var H=V[V.length-1];if(H.type===0){if(H.array[H.position]=T,H.position++,H.position!==H.size)continue e;V.pop(),T=H.array}else{if(H.type===1){if((Z=typeof T)!="string"&&Z!=="number")throw new Io("The type of key must be string or number but "+typeof T);if(T==="__proto__")throw new Io("The key __proto__ is not allowed");H.key=T,H.type=2;continue e}if(H.map[H.key]=T,H.readCount++,H.readCount!==H.size){H.key=null,H.type=1;continue e}V.pop(),T=H.map}}return T}var Z},U.prototype.readHeadByte=function(){return this.headByte===-1&&(this.headByte=this.readU8()),this.headByte},U.prototype.complete=function(){this.headByte=-1},U.prototype.readArraySize=function(){var T=this.readHeadByte();switch(T){case 220:return this.readU16();case 221:return this.readU32();default:if(160>T)return T-144;throw new Io("Unrecognized array type byte: "+S(T))}},U.prototype.pushMapState=function(T){if(T>this.maxMapLength)throw new Io("Max length exceeded: map length ("+T+") > maxMapLengthLength ("+this.maxMapLength+")");this.stack.push({type:1,size:T,key:null,readCount:0,map:{}})},U.prototype.pushArrayState=function(T){if(T>this.maxArrayLength)throw new Io("Max length exceeded: array length ("+T+") > maxArrayLength ("+this.maxArrayLength+")");this.stack.push({type:0,size:T,array:Array(T),position:0})},U.prototype.decodeUtf8String=function(T,V){var H;if(T>this.maxStrLength)throw new Io("Max length exceeded: UTF-8 byte length ("+T+") > maxStrLength ("+this.maxStrLength+")");if(this.bytes.byteLength<this.pos+V+T)throw Xi;var Z,Y=this.pos+V;return this.stateIsMapKey()&&((H=this.keyDecoder)===null||H===void 0?0:H.canBeCached(T))?H=this.keyDecoder.decode(this.bytes,Y,T):T>en?(H=this.bytes.subarray(Y,Y+T),H=Pt.decode(H)):H=c(this.bytes,Y,T),Z=H,this.pos+=V+T,Z},U.prototype.stateIsMapKey=function(){return 0<this.stack.length&&this.stack[this.stack.length-1].type===1},U.prototype.decodeBinary=function(T,V){if(T>this.maxBinLength)throw new Io("Max length exceeded: bin length ("+T+") > maxBinLength ("+this.maxBinLength+")");if(!this.hasRemaining(T+V))throw Xi;var H=this.pos+V;return H=this.bytes.subarray(H,H+T),this.pos+=V+T,H},U.prototype.decodeExtension=function(T,V){if(T>this.maxExtLength)throw new Io("Max length exceeded: ext length ("+T+") > maxExtLength ("+this.maxExtLength+")");var H=this.view.getInt8(this.pos+V);return T=this.decodeBinary(T,V+1),this.extensionCodec.decode(T,H,this.context)},U.prototype.lookU8=function(){return this.view.getUint8(this.pos)},U.prototype.lookU16=function(){return this.view.getUint16(this.pos)},U.prototype.lookU32=function(){return this.view.getUint32(this.pos)},U.prototype.readU8=function(){var T=this.view.getUint8(this.pos);return this.pos++,T},U.prototype.readI8=function(){var T=this.view.getInt8(this.pos);return this.pos++,T},U.prototype.readU16=function(){var T=this.view.getUint16(this.pos);return this.pos+=2,T},U.prototype.readI16=function(){var T=this.view.getInt16(this.pos);return this.pos+=2,T},U.prototype.readU32=function(){var T=this.view.getUint32(this.pos);return this.pos+=4,T},U.prototype.readI32=function(){var T=this.view.getInt32(this.pos);return this.pos+=4,T},U.prototype.readU64=function(){var T,V,H=(T=this.view,V=this.pos,4294967296*T.getUint32(V)+T.getUint32(V+4));return this.pos+=8,H},U.prototype.readI64=function(){var T=u(this.view,this.pos);return this.pos+=8,T},U.prototype.readF32=function(){var T=this.view.getFloat32(this.pos);return this.pos+=4,T},U.prototype.readF64=function(){var T=this.view.getFloat64(this.pos);return this.pos+=8,T},U}(),ac={},Pw=function(U,T){function V(Ke){return function(Dt){return function(le){if(H)throw new TypeError("Generator is already executing.");for(;ae;)try{if(H=1,Z&&(Y=2&le[0]?Z.return:le[0]?Z.throw||((Y=Z.return)&&Y.call(Z),0):Z.next)&&!(Y=Y.call(Z,le[1])).done)return Y;switch(Z=0,Y&&(le=[2&le[0],Y.value]),le[0]){case 0:case 1:Y=le;break;case 4:return ae.label++,{value:le[1],done:!1};case 5:ae.label++,Z=le[1],le=[0];continue;case 7:le=ae.ops.pop(),ae.trys.pop();continue;default:if(!((Y=0<(Y=ae.trys).length&&Y[Y.length-1])||le[0]!==6&&le[0]!==2)){ae=0;continue}if(le[0]===3&&(!Y||le[1]>Y[0]&&le[1]<Y[3]))ae.label=le[1];else if(le[0]===6&&ae.label<Y[1])ae.label=Y[1],Y=le;else if(Y&&ae.label<Y[2])ae.label=Y[2],ae.ops.push(le);else{Y[2]&&ae.ops.pop(),ae.trys.pop();continue}}le=T.call(U,ae)}catch(Se){le=[6,Se],Z=0}finally{H=Y=0}if(5&le[0])throw le[1];return{value:le[0]?le[1]:void 0,done:!0}}([Ke,Dt])}}var H,Z,Y,Ce,ae={label:0,sent:function(){if(1&Y[0])throw Y[1];return Y[1]},trys:[],ops:[]};return Ce={next:V(0),throw:V(1),return:V(2)},typeof Symbol=="function"&&(Ce[Symbol.iterator]=function(){return this}),Ce},cc=function(U){return this instanceof cc?(this.v=U,this):new cc(U)},Qw=function(U,T,V){function H(Se){Dt[Se]&&(Ke[Se]=function(Ee){return new Promise(function(Vt,ut){1<le.push([Se,Ee,Vt,ut])||Z(Se,Ee)})})}function Z(Se,Ee){try{(Vt=Dt[Se](Ee)).value instanceof cc?Promise.resolve(Vt.value.v).then(Y,Ce):ae(le[0][2],Vt)}catch(ut){ae(le[0][3],ut)}var Vt}function Y(Se){Z("next",Se)}function Ce(Se){Z("throw",Se)}function ae(Se,Ee){Se(Ee),le.shift(),le.length&&Z(le[0][0],le[0][1])}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var Ke,Dt=V.apply(U,T||[]),le=[];return Ke={},H("next"),H("throw"),H("return"),Ke[Symbol.asyncIterator]=function(){return this},Ke};return Be}()}),l2=Math.min;Fe({target:"Array",proto:!0},{copyWithin:[].copyWithin||function(i,r){var s=Ri(this),c=si(s.length),u=Gs(i,c),h=Gs(r,c),A=2<arguments.length?arguments[2]:void 0;for(c=l2((A===void 0?c:Gs(A,c))-h,c-u),A=1,h<u&&u<h+c&&(A=-1,h+=c-1,u+=c-1);0<c--;)h in s?s[u]=s[h]:delete s[u],u+=A,h+=A;return s}});var u2=sr("Array").copyWithin,a1=Array.prototype;Fe({target:"Array",proto:!0,forced:Hs("every")},{every:function(i){return rT(this,i,1<arguments.length?arguments[1]:void 0)}});var d2=sr("Array").every,c1=Array.prototype,h2=function(i){var r=i.every;return i===c1||i instanceof Array&&r===c1.every?d2:r},rd=Ou.getWeakData,p2=fr.set,A2=fr.getterFor,f2=0,nd=function(i){return i.frozen||(i.frozen=new l1)},l1=function(){this.entries=[]},Fp=function(i,r){return Um(i.entries,function(s){return s[0]===r})};l1.prototype={get:function(i){if(i=Fp(this,i))return i[1]},has:function(i){return!!Fp(this,i)},set:function(i,r){var s=Fp(this,i);s?s[1]=r:this.entries.push([i,r])},delete:function(i){var r=Fm(this.entries,function(s){return s[0]===i});return~r&&this.entries.splice(r,1),!!~r}};var u1={getConstructor:function(i,r,s,c){var u=i(function(f,m){Fa(f,u,r),p2(f,{type:r,id:f2++,frozen:void 0}),m!=null&&Ua(m,f[c],f,s)}),h=A2(r),A=function(f,m,I){var E=h(f),_=rd(Xr(m),!0);return _===!0?nd(E).set(m,I):_[E.id]=I,f};return js(u.prototype,{delete:function(f){var m=h(this);if(!Ht(f))return!1;var I=rd(f);return I===!0?nd(m).delete(f):I&&et(I,m.id)&&delete I[m.id]},has:function(f){var m=h(this);if(!Ht(f))return!1;var I=rd(f);return I===!0?nd(m).has(f):I&&et(I,m.id)}}),js(u.prototype,s?{get:function(f){var m=h(this);if(Ht(f)){var I=rd(f);return I===!0?nd(m).get(f):I?I[m.id]:void 0}},set:function(f,m){return A(this,f,m)}}:{add:function(f){return A(this,f,!0)}}),u}},g2=(t(function(i){var r=fr.enforce,s=!Ve.ActiveXObject&&"ActiveXObject"in Ve,c=Object.isExtensible,u=function(E){return function(){return E(this,arguments.length?arguments[0]:void 0)}};if(i=i.exports=Hm("WeakMap",u,u1),Gm&&s){var h=u1.getConstructor(u,"WeakMap",!0);Ou.REQUIRED=!0,s=i.prototype;var A=s.delete,f=s.has,m=s.get,I=s.set;js(s,{delete:function(E){if(Ht(E)&&!c(E)){var _=r(this);return _.frozen||(_.frozen=new h),A.call(this,E)||_.frozen.delete(E)}return A.call(this,E)},has:function(E){if(Ht(E)&&!c(E)){var _=r(this);return _.frozen||(_.frozen=new h),f.call(this,E)||_.frozen.has(E)}return f.call(this,E)},get:function(E){if(Ht(E)&&!c(E)){var _=r(this);return _.frozen||(_.frozen=new h),f.call(this,E)?m.call(this,E):_.frozen.get(E)}return m.call(this,E)},set:function(E,_){if(Ht(E)&&!c(E)){var S=r(this);S.frozen||(S.frozen=new h),f.call(this,E)?I.call(this,E,_):S.frozen.set(E,_)}else I.call(this,E,_);return this}})}}),Math.min),Vp=[].lastIndexOf,d1=!!Vp&&0>1/[1].lastIndexOf(1,-0),m2=Hs("lastIndexOf"),h1=d1||m2?function(i){if(d1)return Vp.apply(this,arguments)||0;var r=oi(this),s=si(r.length),c=s-1;for(1<arguments.length&&(c=g2(c,qc(arguments[1]))),0>c&&(c=s+c);0<=c;c--)if(c in r&&r[c]===i)return c||0;return-1}:Vp;Fe({target:"Array",proto:!0,forced:h1!==[].lastIndexOf},{lastIndexOf:h1});var v2=sr("Array").lastIndexOf,p1=Array.prototype,E2=function(i){var r=i.lastIndexOf;return i===p1||i instanceof Array&&r===p1.lastIndexOf?v2:r};let I2=()=>function(i){var r;return i=Ie(r=window.atob(i).split("")).call(r,s=>s.charCodeAt(0)),new Uint8Array(i,0,i.length/Uint8Array.BYTES_PER_ELEMENT)}("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AAA2AkAgACgCKCABKAJMQQIgACgCIBEAACECIAFBADYCwC0gASACNgJEIAFBgAg2ApwtIAEgACgCKEGACEEEIAAoAiARAAAiAjYCCCABIAEoApwtIgNBAnQ2AgwCQAJAIAEoAjhFDQAgASgCQEUNACACRQ0AIAEoAkQNAQsgAUGaBTYCBCAAQbjfACgCADYCGCAAEAgPCyABQQA2AogBIAFBCTYChAEgAUEIOgAkIAEgAiADQQNsajYCmC0gASACIANBfnFqNgKkLSAAEAkNACAAKAIcIgAgACgCLEEBdDYCPCAAKAJEIgEgACgCTEEBdEECayIDakEAOwEAIAEgAxAgIABBADYCtC0gAEKAgICAIDcCdCAAQgA3AmggAEKAgICAIDcCXCAAQQA2AkggACAAKAKEAUEMbCIBQYTIAGovAQA2ApABIAAgAUGAyABqLwEANgKMASAAIAFBgsgAai8BADYCgAEgACABQYbIAGovAQA2AnwLC6kCAQN/AkAgAEUNACAAKAIgRQ0AIAAoAiQiA0UNACAAKAIcIgFFDQAgASgCACAARw0AAkACQCABKAIEIgJBOWsOOQECAgICAgICAgICAgECAgIBAgICAgICAgICAgICAgICAgIBAgICAgICAgICAgIBAgICAgICAgICAQALIAJBmgVGDQAgAkEqRw0BCwJ/An8CfyABKAIIIgIEQCAAKAIoIAIgAxECACAAKAIcIQELIAEoAkQiAgsEQCAAKAIoIAIgACgCJBECACAAKAIcIQELIAEoAkAiAgsEQCAAKAIoIAIgACgCJBECACAAKAIcIQELIAEoAjgiAgsEQCAAKAIoIAIgACgCJBECACAAKAIcIQELIAAoAiggASAAKAIkEQIAIABBADYCHAsLlgIBA39BfiECAkAgAEUNACAAKAIgRQ0AIAAoAiRFDQAgACgCHCIBRQ0AIAEoAgAgAEcNAAJAAkAgASgCBCIDQTlrDjkBAgICAgICAgICAgIBAgICAQICAgICAgICAgICAgICAgICAQICAgICAgICAgICAQICAgICAgICAgEACyADQZoFRg0AIANBKkcNAQsgAEECNgIsIABBADYCCCAAQgA3AhQgAUEANgIUIAEgASgCCDYCECABKAIYIgJBf0wEQCABQQAgAmsiAjYCGAsgAUE5QSpB8QAgAhsgAkECRhs2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KAIIaiACQR9wIAJyQR9zOgAAIAEoAmwEQCAAKAIwIQIgASABKAIUIgNBAWo2AhQgAyABKAIIaiACQRh2OgAAIAEgASgCFCIDQQFqNgIUIAMgASgCCGogAkEQdjoAACAAKAIwIQIgASABKAIUIgNBAWo2AhQgAyABKAIIaiACQQh2OgAAIAEgASgCFCIDQQFqNgIUIAMgASgCCGogAjoAAAsgAEEAQQBBABAENgIwIAFB8QA2AgQgACgCHCICEBMCQCAAKAIQIgMgAigCFCIEIAMgBEkbIgNFDQAgACgCDCACKAIQIAMQHxogACAAKAIMIANqNgIMIAIgAigCECADajYCECAAIAAoAhQgA2o2AhQgACAAKAIQIANrNgIQIAIgAigCFCADayIDNgIUIAMNACACIAIoAgg2AhALIAEoAhQNBCABKAIEIQMLAkACQAJAAkACQAJAAkAgA0E5RgR/IABBAEEAQQAQBjYCMCABIAEoAhQiAkEBajYCFCACIAEoAghqQR86AAAgASABKAIUIgJBAWo2AhQgAiABKAIIakGLAToAACABIAEoAhQiAkEBajYCFCACIAEoAghqQQg6AAAgASgCHCICDQIgASABKAIUIgJBAWo2AhQgAiABKAIIakEAOgAAIAEgASgCFCICQQFqNgIUIAIgASgCCGpBADoAACABIAEoAhQiAkEBajYCFCACIAEoAghqQQA6AAAgASABKAIUIgJBAWo2AhQgAiABKAIIakEAOgAAIAEgASgCFCICQQFqNgIUIAIgASgCCGpBADoAAEECIQIgASgChAEiA0EJRwRAQQQgASgCiAFBAUpBAnQgA0ECSBshAgsgASABKAIUIgNBAWo2AhQgAyABKAIIaiACOgAAIAEgASgCFCICQQFqNgIUIAIgASgCCGpBAzoAACABQfEANgIEIAAoAhwiAhATAkAgACgCECIDIAIoAhQiBCADIARJGyIDRQ0AIAAoAgwgAigCECADEB8aIAAgACgCDCADajYCDCACIAIoAhAgA2o2AhAgACAAKAIUIANqNgIUIAAgACgCECADazYCECACIAIoAhQgA2siAzYCFCADDQAgAiACKAIINgIQCyABKAIUDQEgASgCBAUgAwtBxQBrDiMCBgYGAwYGBgYGBgYGBgYGBgYGBgYGBAYGBgYGBgYGBgYGBQYLIAFBfzYCKA8LIAIoAiQhAyACKAIcIQQgAigCECEFIAIoAiwhBiACKAIAIQggASABKAIUIgdBAWo2AhRBAiECIAcgASgCCGogBkEAR0EBdCAIQQBHciAFQQBHQQJ0ciAEQQBHQQN0ciADQQBHQQR0cjoAACABKAIcKAIEIQMgASABKAIUIgRBAWo2AhQgBCABKAIIaiADOgAAIAEoAhwoAgQhAyABIAEoAhQiBEEBajYCFCAEIAEoAghqIANBCHY6AAAgASgCHC8BBiEDIAEgASgCFCIEQQFqNgIUIAQgASgCCGogAzoAACABKAIcLQAHIQMgASABKAIUIgRBAWo2AhQgBCABKAIIaiADOgAAIAEoAoQBIgNBCUcEQEEEIAEoAogBQQFKQQJ0IANBAkgbIQILIAEgASgCFCIDQQFqNgIUIAMgASgCCGogAjoAACABKAIcKAIMIQIgASABKAIUIgNBAWo2AhQgAyABKAIIaiACOgAAIAEoAhwiAigCEAR/IAIoAhQhAiABIAEoAhQiA0EBajYCFCADIAEoAghqIAI6AAAgASgCHCgCFCECIAEgASgCFCIDQQFqNgIUIAMgASgCCGogAkEIdjoAACABKAIcBSACCygCLARAIAAgACgCMCABKAIIIAEoAhQQBjYCMAsgAUHFADYCBCABQQA2AiALIAEoAhwiBCgCECIDBEAgASgCFCICIAQvARQgASgCICIGayIFaiABKAIMIgRLBEADQCABKAIIIAJqIAMgBmogBCACayIEEB8aIAEgASgCDCIDNgIUAkAgAiADTw0AIAEoAhwoAixFDQAgACAAKAIwIAEoAgggAmogAyACaxAGNgIwCyABIAEoAiAgBGo2AiAgACgCHCICEBMCQCAAKAIQIgMgAigCFCIGIAMgBkkbIgNFDQAgACgCDCACKAIQIAMQHxogACAAKAIMIANqNgIMIAIgAigCECADajYCECAAIAAoAhQgA2o2AhQgACAAKAIQIANrNgIQIAIgAigCFCADayIDNgIUIAMNACACIAIoAgg2AhALIAEoAhQEQCABQX82AigPCyABKAIgIQYgASgCHCgCECEDQQAhAiAFIARrIgUgASgCDCIESw0ACwsgASgCCCACaiADIAZqIAUQHxogASABKAIUIAVqIgM2AhQCQCACIANPDQAgASgCHCgCLEUNACAAIAAoAjAgASgCCCACaiADIAJrEAY2AjALIAFBADYCIAsgAUHJADYCBAsgASgCHCgCHARAIAEoAhQiAiEFA0ACQCACIAEoAgxHDQACQCACIAVNDQAgASgCHCgCLEUNACAAIAAoAjAgASgCCCAFaiACIAVrEAY2AjALIAAoAhwiAhATAkAgACgCECIDIAIoAhQiBCADIARJGyIDRQ0AIAAoAgwgAigCECADEB8aIAAgACgCDCADajYCDCACIAIoAhAgA2o2AhAgACAAKAIUIANqNgIUIAAgACgCECADazYCECACIAIoAhQgA2siAzYCFCADDQAgAiACKAIINgIQC0EAIQJBACEFIAEoAhRFDQAgAUF/NgIoDwsgASgCHCgCHCEDIAEgASgCICIEQQFqNgIgIAMgBGotAAAhAyABIAJBAWo2AhQgASgCCCACaiADOgAAIAMEQCABKAIUIQIMAQsLAkAgASgCHCgCLEUNACABKAIUIgIgBU0NACAAIAAoAjAgASgCCCAFaiACIAVrEAY2AjALIAFBADYCIAsgAUHbADYCBAsCQCABKAIcKAIkRQ0AIAEoAhQiAiEFA0ACQCACIAEoAgxHDQACQCACIAVNDQAgASgCHCgCLEUNACAAIAAoAjAgASgCCCAFaiACIAVrEAY2AjALIAAoAhwiAhATAkAgACgCECIDIAIoAhQiBCADIARJGyIDRQ0AIAAoAgwgAigCECADEB8aIAAgACgCDCADajYCDCACIAIoAhAgA2o2AhAgACAAKAIUIANqNgIUIAAgACgCECADazYCECACIAIoAhQgA2siAzYCFCADDQAgAiACKAIINgIQC0EAIQJBACEFIAEoAhRFDQAgAUF/NgIoDwsgASgCHCgCJCEDIAEgASgCICIEQQFqNgIgIAMgBGotAAAhAyABIAJBAWo2AhQgASgCCCACaiADOgAAIAMEQCABKAIUIQIMAQsLIAEoAhwoAixFDQAgASgCFCICIAVNDQAgACAAKAIwIAEoAgggBWogAiAFaxAGNgIwCyABQecANgIECyABKAIcKAIsBEAgASgCDCABKAIUIgJBAmpJBEAgACgCHCICEBMCQCAAKAIQIgMgAigCFCIEIAMgBEkbIgNFDQAgACgCDCACKAIQIAMQHxogACAAKAIMIANqNgIMIAIgAigCECADajYCECAAIAAoAhQgA2o2AhQgACAAKAIQIANrNgIQIAIgAigCFCADayIDNgIUIAMNACACIAIoAgg2AhALIAEoAhQNBUEAIQILIAAoAjAhAyABIAJBAWo2AhQgASgCCCACaiADOgAAIAAoAjAhAiABIAEoAhQiA0EBajYCFCADIAEoAghqIAJBCHY6AAAgAEEAQQBBABAGNgIwCyABQfEANgIEIAAoAhwiAhATAkAgACgCECIDIAIoAhQiBCADIARJGyIDRQ0AIAAoAgwgAigCECADEB8aIAAgACgCDCADajYCDCACIAIoAhAgA2o2AhAgACAAKAIUIANqNgIUIAAgACgCECADazYCECACIAIoAhQgA2siAzYCFCADDQAgAiACKAIINgIQCyABKAIURQ0AIAFBfzYCKA8LIAAoAgQNAQsgASgCdA0AIAEoAgRBmgVGDQgLIAEoAoQBIgJFBEAgAUEDEAwMBAsCQAJAIAEoAogBQQJrDgIAAQQLA0ACQAJAIAEoAnQNACABEAogASgCdA0AIAFBADYCtC0MAQsgAUEANgJgIAEoAjggASgCbGotAAAhAiABKAKkLSABKAKgLSIDQQF0akEAOwEAIAEgA0EBajYCoC0gAyABKAKYLWogAjoAACABIAJBAnRqQZQBaiICIAIvAQBBAWo7AQAgASABKAJ0QQFrNgJ0IAEgASgCbEEBaiICNgJsIAEoAqAtIAEoApwtQQFrRw0BIAEgASgCXCIEQQBOBH8gASgCOCAEagVBAAsgAiAEa0EAEBQgASABKAJsNgJcIAEoAgAiAigCHCIDEBMCQCACKAIQIgQgAygCFCIFIAQgBUkbIgRFDQAgAigCDCADKAIQIAQQHxogAiACKAIMIARqNgIMIAMgAygCECAEajYCECACIAIoAhQgBGo2AhQgAiACKAIQIARrNgIQIAMgAygCFCAEayICNgIUIAINACADIAMoAgg2AhALIAEoAgAoAhANAQwHCwsgASgCoC1FDQcgASABKAJcIgNBAE4EfyABKAI4IANqBUEACyABKAJsIANrQQAQFCABIAEoAmw2AlwgASgCACICKAIcIgMQEwJAIAIoAhAiBCADKAIUIgUgBCAFSRsiBEUNACACKAIMIAMoAhAgBBAfGiACIAIoAgwgBGo2AgwgAyADKAIQIARqNgIQIAIgAigCFCAEajYCFCACIAIoAhAgBGs2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CAC2AAgAdgAIAPYACAAOAAgAjgAIAE4ACADOAAgALgAIAK4ACABuAAgA7gAIAB4ACACeAAgAXgAIAN4ACAA+AAgAvgAIAH4ACAD+AAgAAQAIAIEACABBAAgAwQAIACEACAChAAgAYQAIAOEACAARAAgAkQAIAFEACADRAAgAMQAIALEACABxAAgA8QAIAAkACACJAAgASQAIAMkACAApAAgAqQAIAGkACADpAAgAGQAIAJkACABZAAgA2QAIADkACAC5AAgAeQAIAPkACAAFAAgAhQAIAEUACADFAAgAJQAIAKUACABlAAgA5QAIABUACACVAAgAVQAIANUACAA1AAgAtQAIAHUACAD1AAgADQAIAI0ACABNAAgAzQAIAC0ACACtAAgAbQAIAO0ACAAdAAgAnQAIAF0ACADdAAgAPQAIAL0ACAB9AAgA/QAIABMACQATAQkAkwAJAJMBCQBTAAkAUwEJANMACQDTAQkAMwAJADMBCQCzAAkAswEJAHMACQBzAQkA8wAJAPMBCQALAAkACwEJAIsACQCLAQkASwAJAEsBCQDLAAkAywEJACsACQArAQkAqwAJAKsBCQBrAAkAawEJAOsACQDrAQkAGwAJABsBCQCbAAkAmwEJAFsACQBbAQkA2wAJANsBCQA7AAkAOwEJALsACQC7AQkAewAJAHsBCQD7AAkA+wEJAAcACQAHAQkAhwAJAIcBCQBHAAkARwEJAMcACQDHAQkAJwAJACcBCQCnAAkApwEJAGcACQBnAQkA5wAJAOcBCQAXAAkAFwEJAJcACQCXAQkAVwAJAFcBCQDXAAkA1wEJADcACQA3AQkAtwAJALcBCQB3AAkAdwEJAPcACQD3AQkADwAJAA8BCQCPAAkAjwEJAE8ACQBPAQkAzwAJAM8BCQAvAAkALwEJAK8ACQCvAQkAbwAJAG8BCQDvAAkA7wEJAB8ACQAfAQkAnwAJAJ8BCQBfAAkAXwEJAN8ACQDfAQkAPwAJAD8BCQC/AAkAvwEJAH8ACQB/AQkA/wAJAP8BCQAAAAcAQAAHACAABwBgAAcAEAAHAFAABwAwAAcAcAAHAAgABwBIAAcAKAAHAGgABwAYAAcAWAAHADgABwB4AAcABAAHAEQABwAkAAcAZAAHABQABwBUAAcANAAHAHQABwADAAgAgwAIAEMACADDAAgAIwAIAKMACABjAAgA4wAIAAAABQAQAAUACAAFABgABQAEAAUAFAAFAAwABQAcAAUAAgAFABIABQAKAAUAGgAFAAYABQAWAAUADgAFAB4ABQABAAUAEQAFAAkABQAZAAUABQAFABUABQANAAUAHQAFAAMABQATAAUACwAFABsABQAHAAUAFwAFAEHg2QALTQEAAAABAAAAAQAAAAEAAAACAAAAAgAAAAIAAAACAAAAAwAAAAMAAAADAAAAAwAAAAQAAAAEAAAABAAAAAQAAAAFAAAABQAAAAUAAAAFAEHQ2gALZQEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAUAAAAGAAAABgAAAAcAAAAHAAAACAAAAAgAAAAJAAAACQAAAAoAAAAKAAAACwAAAAsAAAAMAAAADAAAAA0AAAANAEGA3AALIwIAAAADAAAABwAAAAAAAAAQERIACAcJBgoFCwQMAw0CDgEPAEG03AALaQEAAAACAAAAAwAAAAQAAAAFAAAABgAAAAcAAAAIAAAACgAAAAwAAAAOAAAAEAAAABQAAAAYAAAAHAAAACAAAAAoAAAAMAAAADgAAABAAAAAUAAAAGAAAABwAAAAgAAAAKAAAADAAAAA4ABBtN0AC5oCAQAAAAIAAAADAAAABAAAAAYAAAAIAAAADAAAABAAAAAYAAAAIAAAADAAAABAAAAAYAAAAIAAAADAAAAAAAEAAIABAAAAAgAAAAMAAAAEAAAABgAAAAgAAAAMAAAAEAAAABgAAAAgAAAAMAAAAEAAAABgAABuZWVkIGRpY3Rpb25hcnkAc3RyZWFtIGVuZAAAZmlsZSBlcnJvcgBzdHJlYW0gZXJyb3IAZGF0YSBlcnJvcgBpbnN1ZmZpY2llbnQgbWVtb3J5AGJ1ZmZlciBlcnJvcgBpbmNvbXBhdGlibGUgdmVyc2lvbgAAAAAoLwAAOC8AAEMvAABELwAATy8AAFwvAABnLwAAey8AAIgvAABDLwAAMS4yLjExAEHQ3wALA9AxUA=="),Gp,Go,A1=Uint8Array.BYTES_PER_ELEMENT,C2={bytesReceived:"br",frameDropped:"fd",frameReceived:"fr",googJitterReceived:"jr",isAudioMute:"am",isFreeze:"fz",mediaType:"mt",packetsLost:"pl",packetsReceived:"pr",peerId:"pid",id:"id",ssrc:"ssrc",timestamp:"ts",type:"tp",frameRateInput:"fi",frameRateSent:"fs",googRtt:"rt",isVideoMute:"vm"},y2={stats:"sts",state:"st",stream_id:"stid",session_id:"seid",stream_type:"stt",app_id:"aid",channel_key:"ck",channel_name:"cn",sdk_version:"sv",browser:"b",process_id:"pcid",mode:"m",codec:"c",role:"r",has_changed_gateway:"hcg",ap_response:"ar",extends:"es",details:"d",features:"ft",p2p_id:"ppid",sdp:"sdp",audio:"a",video:"v",attributes:"at",hq:"h",lq:"l",stereo:"str",speech:"spe",extend:"e",pingpongElapse:"ppe"},_2={_message:"m",_type:"t",_id:"id"},S2={join_v2:"j2",publish:"pub",publish_related_stats:"prs",ping:"pi",traffic_stats:"ts",ping_back:"pib",publish_stats:"pubs"},jp;class T2{constructor(){}async init(){jp||(jp=(await(async()=>(Go||(Go=await hS()),{zlibCompress:r=>{var s,c=new Uint8Array(r);const u=A1*c.byteLength;r=Go._malloc(u);const h=Go._malloc(3*u);for(let A=0;A<u;A++)Go.HEAP8[r/A1+A]=c[A];return c=Go._zlibCompress(r,u,h),c=new Uint8Array(Mr(s=Go.HEAP8).call(s,h,h+c)),Go._free(r),Go._free(h),c}}))()).zlibCompress),this.zlibCompress=jp}msgPackCompress(r){return c2.encode(r)}compress(r){let s=de(),c=this.compressKeyAndValue(JSON.parse(fe(r))),u=this.msgPackCompress(c);var h=this.zlibCompress(u);return h=new Uint8Array([49,49,49,50,...Ji(h)]),{origin:Zr({},r),originLength:fe(r).length,shortKeyAndValue:c,msgpackSer:u,compressed:h,compressedLength:h.length,time:de()-s}}compressKeyAndValue(r){return this._ObjectKeyCompress(this._typeCompress(r))}_typeCompress(r){let s=r._type;return s&&(r._type=S2[s]||s),r}_ObjectKeyCompress(r){let s=r._message;if(s){let c=s.stats;c&&(s.stats=this._statsCompress(c)),r._message=this._messageCompress(s)}return this._reportCompress(r)}_statsCompress(r){return this._keyCompress(r,C2)}_messageCompress(r){return this._keyCompress(r,y2)}_reportCompress(r){return this._keyCompress(r,_2)}_keyCompress(r,s){let c={},u=dt(r);return Fu(u).call(u,(h,A)=>(h=r[A],s[A]?c[s[A]]=h:c[A]=h,c),c),c}}class R2 extends Wr{constructor(r){super();this.lowPriorityQueue=[],this.highPriorityQueue=[],this.AgoraWebSocketManager=r}get queue(){return[...this.highPriorityQueue,...this.lowPriorityQueue]}reset(){this.lowPriorityQueue=[],this.highPriorityQueue=[]}pushMessage(r,s=!1){s?this.highPriorityQueue.push(r):this.lowPriorityQueue.push(r),this.sendMessage()}sendMessage(){let r=this.queue.length;ai(()=>{this._sendMessage()},5>r?15*r:60+3*(r-4))}_sendMessage(){var r;if(this.queue.length){var s=this.AgoraWebSocketManager.getConnection();if(s&&s.readyState===1){var c=this.queue.shift();return gt(r=this.lowPriorityQueue).call(r,c)?this.lowPriorityQueue.shift():this.highPriorityQueue.shift(),s.send(c.compressed),c}}}}class Hp extends Wr{constructor(r,s,c=!1){super();this.currentURLIndex=this.connectionID=0,this.reconnectMode="tryNext",this._state="closed",this.reconnectCount=0,this.isCompressorInitSuccess=!1,this.wsDeflateLength=this.wsInflateLength=0,this.name=r,this.retryConfig=s,this.useCompress=c}get url(){return this.websocket?this.websocket.url:null}get state(){return this._state}set state(r){r!==this._state&&(this._state=r,this._state==="reconnecting"?this.emit(lt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(lt.CONNECTED):this._state==="closed"?this.emit(lt.CLOSED):this._state==="failed"&&this.emit(lt.FAILED))}getConnection(){return this.websocket||void 0}init(r){let s=(c,u)=>{this.urls=r;const h=this.urls[this.currentURLIndex];this.state="connecting",this.messageSender=new R2(this),this.createWebSocketConnection(h).then(c).catch(u),this.once(lt.CLOSED,()=>u(new L(D.WS_DISCONNECT))),this.once(lt.CONNECTED,()=>c())};return new ce((c,u)=>{this.compressor=new T2,this.compressor.init().then(()=>{var h;R.debug("websocket compressor initialized successfully"),this.isCompressorInitSuccess=!0,this.compress=cr(h=this.compressor.compress).call(h,this.compressor),s(c,u)}).catch(()=>{R.debug("websocket compressor failed to initialize"),s(c,u)})})}close(r,s){if(this.currentURLIndex=0,this.reconnectCount=0,this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;let c=this.websocket;s?ai(()=>c.close(),500):c.close(),this.websocket=void 0}this.state=r?"failed":"closed"}reconnect(r,s){if(!this.websocket)return void R.warning("[".concat(this.name,"] can not reconnect, no websocket"));r!==void 0&&(this.reconnectMode=r),R.debug("[".concat(this.name,"] reconnect is triggered initiative")),r=this.websocket.onclose,this.websocket.onclose=null,this.websocket.close(),r&&cr(r).call(r,this.websocket)({code:9999,reason:s})}sendMessage(r,s=!1){if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new L(D.WS_ABORT,"websocket is not ready");try{let c=null;if(this.isCompressorInitSuccess&&this.useCompress&&ne.WEBSOCKET_COMPRESS)c=this.compress(r),this.setWsInflateData(c);else{if(this.isCompressorInitSuccess&&this.useCompress){let h=this.compress(r);this.setWsInflateData(h)}let u=fe(r);c={compressed:u,compressedLength:u.length,origin:r}}s?this.websocket.send(c.compressed):this.messageSender.pushMessage(c)}catch(c){throw new L(D.WS_ERR,"send websocket message error"+c.toString())}}setWsInflateData(r){this.wsDeflateLength+=r.originLength,this.wsInflateLength+=r.compressedLength}getWsInflateData(){let r=this.wsInflateLength,s=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:r,wsDeflateLength:s}}clearWsInflateData(){this.wsDeflateLength=this.wsInflateLength=0}async createWebSocketConnection(r){let s=this.connectionID+=1;return new ce((c,u)=>{var h,A;this.websocket&&(this.websocket.onclose=null,this.websocket.close()),ne.GATEWAY_WSS_ADDRESS&&il(h=this.name).call(h,"gateway")&&(r=ne.GATEWAY_WSS_ADDRESS),R.debug(b(A="[".concat(this.name,"] start connect, url: ")).call(A,r));try{this.websocket=new WebSocket(r),this.websocket.binaryType="arraybuffer"}catch(m){var f;return h=new L(D.WS_ERR,"init websocket failed! Error: ".concat(m.toString())),R.error(b(f="[".concat(this.name,"]")).call(f,h)),void u(h)}Tn(5e3).then(()=>{s===this.connectionID&&this.websocket&&this.websocket.readyState!==WebSocket.OPEN&&this.websocket&&this.websocket.close()}),this.websocket.onopen=()=>{R.debug("[".concat(this.name,"] websocket opened:"),r),this.reconnectMode="retry",this.state="connected",this.reconnectCount=0,c()},this.websocket.onclose=async m=>{var I,E,_,S;if(R.debug(b(I=b(E=b(_=b(S="[".concat(this.name,"] websocket close ")).call(S,this.websocket&&this.websocket.url,", code: ")).call(_,m.code,", reason: ")).call(E,m.reason,", current mode: ")).call(I,this.reconnectMode)),this.reconnectCount<this.retryConfig.maxRetryCount){if(this.state==="connected"&&(this.reconnectReason=m.reason,this.state="reconnecting"),I=Ls(this,lt.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,I=await this.reconnectWithAction(I),this.state==="closed")return void R.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!I)return u(new L(D.WS_DISCONNECT,"websocket reconnect failed: ".concat(m.code))),void this.close(!0);c()}else u(new L(D.WS_DISCONNECT,"websocket close: ".concat(m.code))),this.close()},this.websocket.onmessage=m=>{this.emit(lt.ON_MESSAGE,m)}})}async reconnectWithAction(r,s){var c,u;if(!s&&this.reconnectCount>=this.retryConfig.maxRetryCount||!this.urls||this.state==="closed"||(this.onlineReconnectListener||Yn.networkState!==bi.OFFLINE||(this.onlineReconnectListener=Yn.onlineWaiter&&Yn.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0})),s=function(f,m){return Math.min(m.maxRetryTimeout,m.timeout*Math.pow(m.timeoutFactor,f))}(this.reconnectCount,this.retryConfig),R.debug(b(c=b(u="[".concat(this.name,"] wait ")).call(u,s,"ms to reconnect websocket, mode: ")).call(c,r)),await ce.race([Tn(s),this.onlineReconnectListener||new ce(()=>{})]),this.state==="closed"))return!1;this.reconnectCount+=1;try{if(r==="retry")await this.createWebSocketConnection(this.urls[this.currentURLIndex]);else if(r==="tryNext"){var h,A;if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return await this.reconnectWithAction("recover");R.debug(b(h=b(A="[".concat(this.name,"] websocket url length: ")).call(A,this.urls.length," current index: ")).call(h,this.currentURLIndex)),await this.createWebSocketConnection(this.urls[this.currentURLIndex])}else r==="recover"&&(R.debug("[".concat(this.name,"] request new urls")),this.urls=await yr(this,lt.REQUEST_NEW_URLS),this.currentURLIndex=0,await this.createWebSocketConnection(this.urls[this.currentURLIndex]));return!0}catch(f){return R.error("[".concat(this.name,"] reconnect failed"),f.toString()),await this.reconnectWithAction(r)}}}class w2{constructor(r){this.input=[],this.size=r}add(r){var s;this.input.push(r),this.input.length>this.size&&Gr(s=this.input).call(s,0,1)}mean(){var r;return this.input.length===0?0:Fu(r=this.input).call(r,(s,c)=>s+c)/this.input.length}}class N2 extends Wr{constructor(r){super();this._connectionState=hr.CLOSED,this.openConnectionTime=de(),this.lastMsgTime=de(),this.uploadCache=[],this.rttRolling=new w2(5),this.pingpongTimeoutCount=0,this.onWebsocketMessage=s=>{if(s.data instanceof ArrayBuffer)return void this.emit(Xe.ON_BINARY_DATA,s.data);if(s=JSON.parse(s.data),this.lastMsgTime=de(),Object.prototype.hasOwnProperty.call(s,"_id")){let c="res-@".concat(s._id);this.emit(c,s._result,s._message)}else if(Object.prototype.hasOwnProperty.call(s,"_type")&&(this.emit(s._type,s._message),s._type===mt.ON_NOTIFICATION&&this.handleNotification(s._message),s._type===mt.ON_USER_BANNED))switch(s._message.error_code){case 14:this.close("UID_BANNED");break;case 15:this.close("IP_BANNED");break;case 16:this.close("CHANNEL_BANNED")}},this.clientId=r.clientId,this.spec=r,this.websocket=new Hp("gateway-".concat(this.clientId),this.spec.retryConfig,!0),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===hr.CONNECTED&&this.reconnect("retry",Rn.OFFLINE)})}get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===hr.CONNECTED?this.emit(Xe.WS_CONNECTED):r===hr.RECONNECTING?this.emit(Xe.WS_RECONNECTING,this._websocketReconnectReason):r===hr.CLOSED&&this.emit(Xe.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}async request(r,s,c,u){var h,A,f,m,I;let E=er(6,"");var _={_id:E,_type:r,_message:s};let S=this.websocket.connectionID;var N=()=>new ce((k,B)=>{if(this.connectionState===hr.CONNECTED)return k();const P=()=>{this.off(Xe.WS_CLOSED,J),k()},J=()=>{this.off(Xe.WS_CONNECTED,P),B(new L(D.WS_ABORT))};this.once(Xe.WS_CONNECTED,P),this.once(Xe.WS_CLOSED,J)});if(this.connectionState!==hr.CONNECTING&&this.connectionState!==hr.RECONNECTING||r===Tt.JOIN||r===Tt.REJOIN||await N(),this.websocket.sendMessage(_,!0),!u){_=new ce((k,B)=>{let P=!1;const J=(ge,Le)=>{P=!0,k({isSuccess:ge==="success",message:Le||{}}),this.off(Xe.WS_CLOSED,se),this.off(Xe.WS_RECONNECTING,se),this.emit(Xe.REQUEST_SUCCESS,r,s)};this.once("res-@".concat(E),J);const se=()=>{B(new L(D.WS_ABORT,"type: ".concat(r))),this.off(Xe.WS_CLOSED,se),this.off(Xe.WS_RECONNECTING,se),this.off("res-@".concat(E),J)};this.once(Xe.WS_CLOSED,se),this.once(Xe.WS_RECONNECTING,se),Tn(ne.SIGNAL_REQUEST_TIMEOUT).then(()=>{this.websocket.connectionID!==S||P||(R.warning("ws request timeout, type: ".concat(r)),this.emit(Xe.REQUEST_TIMEOUT,r,s))})}),u=null;try{u=await _}catch(k){if(this.connectionState===hr.CLOSED||r===Tt.LEAVE)throw new L(D.WS_ABORT);return!this.spec.forceWaitGatewayResponse||c?k.throw():r===Tt.JOIN||r===Tt.REJOIN?null:(await N(),await this.request(r,s))}return u.isSuccess?u.message:(c=Number(u.message.error_code||u.message.code),N=Xg(c),_=new L(D.UNEXPECTED_RESPONSE,b(h="".concat(N.desc,": ")).call(h,u.message.error_str),{code:c,data:u.message}),N.action==="success"?u.message:(R.warning(b(A=b(f=b(m=b(I="[".concat(this.websocket.connectionID,"] unexpected response from type ")).call(I,r,", error_code: ")).call(m,c,", message: ")).call(f,N.desc,", action: ")).call(A,N.action)),N.action==="failed"?_.throw():N.action==="quit"?(this.initError=_,this.close(),_.throw()):(c===ke.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=u.message.option,R.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Rn.MULTI_IP)):this.reconnect(N.action,Rn.SERVER_ERROR),r===Tt.JOIN||r===Tt.REJOIN?null:await this.request(r,s))))}}waitMessage(r,s){return new ce(c=>{let u=h=>{s&&!s(h)||(this.off(r,u),c(h))};this.on(r,u)})}upload(r,s){r={_type:r,_message:s};try{this.websocket.sendMessage(r)}catch{s=ne.MAX_UPLOAD_CACHE||50;var c;this.uploadCache.push(r),this.uploadCache.length>s&&Gr(c=this.uploadCache).call(c,0,1),0<this.uploadCache.length&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{var h;if(this.connectionState===hr.CONNECTED){var A=Gr(h=this.uploadCache).call(h,0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(A._type,A._message)}},ne.UPLOAD_CACHE_INTERVAL||2e3))}}send(r,s){this.websocket.sendMessage({_type:r,_message:s})}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,new ce((s,c)=>{this.once(Xe.WS_CONNECTED,()=>s(this.joinResponse)),this.once(Xe.WS_CLOSED,()=>c(this.initError||new L(D.WS_ABORT))),this.connectionState=hr.CONNECTING,this.websocket.init(r).catch(c),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.joinResponse=this.reconnectToken=void 0,this._disconnectedReason=r||"LEAVE",this.connectionState=hr.CLOSED,this.websocket.close()}async join(){var r;if(!this.joinResponse){var s=jc(this,Xe.REQUEST_JOIN_INFO);if(s=await this.request(Tt.JOIN,s),!s)return this.emit(Xe.REPORT_JOIN_GATEWAY,D.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=hr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(cr(r=this.handlePingPong).call(r,this),3e3),!0}async rejoin(){var r,s;if(!this.reconnectToken)throw new L(D.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");var c=jc(this,Xe.REQUEST_REJOIN_INFO);return c.token=this.reconnectToken,c=await this.request(Tt.REJOIN,c),!!c&&(this.connectionState=hr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(cr(r=this.handlePingPong).call(r,this),3e3),c.peers&&W(s=c.peers).call(s,u=>{this.emit(mt.ON_USER_ONLINE,{uid:u.uid}),u.audio_mute?this.emit(mt.MUTE_AUDIO,{uid:u.uid}):this.emit(mt.UNMUTE_AUDIO,{uid:u.uid}),u.video_mute?this.emit(mt.MUTE_VIDEO,{uid:u.uid}):this.emit(mt.UNMUTE_VIDEO,{uid:u.uid}),u.audio_enable_local?this.emit(mt.ENABLE_LOCAL_AUDIO,{uid:u.uid}):this.emit(mt.DISABLE_LOCAL_AUDIO,{uid:u.uid}),u.video_enable_local?this.emit(mt.ENABLE_LOCAL_VIDEO,{uid:u.uid}):this.emit(mt.DISABLE_LOCAL_VIDEO,{uid:u.uid}),u.audio||u.video||this.emit(mt.ON_REMOVE_STREAM,{uid:u.uid,uint_id:u.uint_id}),u.audio&&this.emit(mt.ON_ADD_AUDIO_STREAM,{uid:u.uid,uint_id:u.uint_id,audio:!0}),u.video&&this.emit(mt.ON_ADD_VIDEO_STREAM,{uid:u.uid,uint_id:u.uint_id,video:!0})}),!0)}reconnect(r,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,s)}handleNotification(r){if(R.debug("[".concat(this.clientId,"] receive notification: "),r),r=Xg(r.code),r.action!=="success"){if(r.action!=="failed")return r.action==="quit"?(r.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close("UID_BANNED"),void this.close()):void this.reconnect(r.action,Rn.SERVER_ERROR);R.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(this.websocket&&this.websocket.state==="connected"){0<this.pingpongTimeoutCount&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;var r=ne.PING_PONG_TIME_OUT,s=de();this.pingpongTimeoutCount>=r&&(R.warning("PINGPONG Timeout. Last Socket Message: ".concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>ne.WEBSOCKET_TIMEOUT_MIN)?this.reconnect("retry",Rn.TIMEOUT):this.request(Tt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let c=de()-s;this.rttRolling.add(c),ne.REPORT_STATS&&this.send(Tt.PING_BACK,{pingpongElapse:c})}).catch(c=>{})}}handleWsInflateData(){let{wsInflateLength:r,wsDeflateLength:s}=this.websocket.getWsInflateData();r!==0&&s!==0&&this.upload(Ni.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:s,ws_inflate_length:r})}handleWebsocketEvents(){this.websocket.on(lt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(lt.CLOSED,()=>{this.connectionState=hr.CLOSED}),this.websocket.on(lt.FAILED,()=>{this._disconnectedReason="NETWORK_ERROR",this.connectionState=hr.CLOSED}),this.websocket.on(lt.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===hr.CONNECTED?this.connectionState=hr.RECONNECTING:this.connectionState=hr.CONNECTING}),this.websocket.on(lt.WILL_RECONNECT,(r,s)=>{if(jc(this,Xe.IS_P2P_DISCONNECTED)&&r==="retry")return this.reconnectToken=void 0,this.emit(Xe.NEED_RENEW_SESSION),this.emit(Xe.DISCONNECT_P2P),s("tryNext");r!=="retry"&&(this.reconnectToken=void 0,this.emit(Xe.NEED_RENEW_SESSION),this.emit(Xe.DISCONNECT_P2P)),s(r)}),this.websocket.on(lt.CONNECTED,()=>{this.openConnectionTime=de(),this.reconnectToken?this.rejoin().catch(r=>{var s;R.warning(b(s="[".concat(this.clientId,"] rejoin failed ")).call(s,r)),this.reconnect("tryNext",Rn.SERVER_ERROR)}):this.join().catch(r=>{if(this.emit(Xe.REPORT_JOIN_GATEWAY,r.message||r.code,this.url||""),r instanceof L&&r.code===D.UNEXPECTED_RESPONSE&&r.data.code===ke.ERR_NO_AUTHORIZED)return R.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Rn.SERVER_ERROR);R.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Rn.SERVER_ERROR):(this.initError=r,this.close())})}),this.websocket.on(lt.REQUEST_NEW_URLS,(r,s)=>{yr(this,Xe.REQUEST_RECOVER,this.multiIpOption).then(r).catch(s)})}}let Kp=new Ct;class k2 extends Wr{constructor(r){super();this.inChannelInfo={joinAt:null,duration:0},this._state="DISCONNECTED",this.needToSendUnpubUnsub=new Ct,this.hasChangeBGPAddress=this.isSignalRecover=!1,this.joinGatewayStartTime=0,this._signalTimeout=!1,this.clientId=r.clientId,this.spec=r,this.signal=new N2(Nh({},r,{retryConfig:r.websocketRetryConfig})),this._statsCollector=r.statsCollector,this.role=r.role||"audience",this._clientRoleOptions=r.clientRoleOptions,this.handleSignalEvents()}get state(){return this._state}set state(r){if(r!==this._state){var s=this._state;this._state=r,r==="DISCONNECTED"&&this._disconnectedReason?this.emit(_r.CONNECTION_STATE_CHANGE,r,s,this._disconnectedReason):this.emit(_r.CONNECTION_STATE_CHANGE,r,s)}}async join(r,s){var c,u;r.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);let h=de();var A=Kp.get(r.cname);if(A||(A=new Ct,Kp.set(r.cname,A)),A.has(r.uid))throw A=new L(D.UID_CONFLICT),z.joinGateway(r.sid,{lts:h,succ:!1,ec:A.message,addr:null,uid:r.uid,cid:r.cid}),A;A.set(r.uid,!0),this.joinInfo=r,this.key=s,s=r.proxyServer?Ie(c=r.gatewayAddrs).call(c,f=>{var m,I;return f=f.split(":"),b(m=b(I="wss://".concat(r.proxyServer,"/ws/?h=")).call(I,f[0],"&p=")).call(m,f[1])}):Ie(u=r.gatewayAddrs).call(u,f=>"wss://".concat(f)),c=0,this.joinGatewayStartTime=h;try{c=(await this.signal.init(s)).uid}catch(f){throw R.error("[".concat(this.clientId,"] User join failed"),f.toString()),z.joinGateway(r.sid,{lts:h,succ:!1,ec:f.message,addr:this.signal.url,uid:r.uid,cid:r.cid}),A.delete(r.uid),this.signal.close(),f}return this.state="CONNECTED",this.inChannelInfo.joinAt=de(),R.debug("[".concat(this.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(f=>{R.warning("[".concat(this.clientId,"] get traffic stats error"),f.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(_r.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(_r.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(_r.NETWORK_QUALITY,{uplinkNetworkQuality:Yg(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:Yg(this._statsCollector.trafficStats.B_dnq)}):this.emit(_r.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),c}async leave(r=!1){if(this.state!=="DISCONNECTED"){this.state="DISCONNECTING";try{if(!r&&this.signal.connectionState===hr.CONNECTED){var s=this.signal.request(Tt.LEAVE,void 0,!0);await(1/0==3e3?s:ce.race([s,dS(3e3)]))}}catch(c){R.warning("[".concat(this.clientId,"] leave request failed, ignore"),c)}this.signal.close(),this.reset(),this.state="DISCONNECTED"}}async publish(r,s){if(!this.joinInfo)throw new L(D.UNEXPECTED_ERROR,"publish no joinInfo");let c=r.getUserId(),u=r.videoTrack?function(h){var A;if(h=h._encoderConfig,!h)return{};const f={resolution:h.width&&h.height?b(A="".concat(ns(h.width),"x")).call(A,ns(h.height)):void 0,maxVideoBW:h.bitrateMax,minVideoBW:h.bitrateMin};return typeof h.frameRate=="number"?(f.maxFrameRate=h.frameRate,f.minFrameRate=h.frameRate):h.frameRate&&(f.maxFrameRate=h.frameRate.max||h.frameRate.ideal||h.frameRate.exact||h.frameRate.min,f.minFrameRate=h.frameRate.min||h.frameRate.ideal||h.frameRate.exact||h.frameRate.max),f}(r.videoTrack):{};if(r.on(De.NEED_ANSWER,(h,A,f)=>{var m;let I={state:"offer",stream_type:s,p2p_id:r.pc.ID,sdp:fe(h),audio:!!r.audioTrack,video:!!r.videoTrack,screen:r.videoTrack&&Ge(m=r.videoTrack._hints).call(m,Yi.SCREEN_TRACK)!==-1,attributes:u,dtx:r.audioTrack instanceof dl&&r.audioTrack._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1,mode:this.spec.mode,codec:this.spec.codec,extend:ne.PUB_EXTEND};r.audioTrack&&r.audioTrack instanceof $r&&(r.audioTrack&&(m={stream_id:this.joinInfo&&(this.joinInfo.stringUid||this.joinInfo.uid),action:""},r.audioTrack.isActive?m.action="unmute_local_audio":m.action="mute_local_audio",this.sendControl(m)),r.videoTrack&&(m={stream_id:this.joinInfo&&(this.joinInfo.stringUid||this.joinInfo.uid),action:""},r.videoTrack.muted?m.action="mute_local_video":m.action="unmute_local_video",this.sendControl(m))),this.signal.request(Tt.PUBLISH,I,!0).then(E=>{c&&this.needToSendUnpubUnsub.set(c,!0),A(JSON.parse(E.sdp))}).catch(E=>{if(h.retry&&E.data&&E.data.code===ke.ERR_PUBLISH_REQUEST_INVALID)return R.warning("[".concat(this.clientId,"] receiver publish error code, retry"),E.toString()),yr(r,De.NEED_UNPUB).then(()=>{h.retry=!1,yr(r,De.NEED_ANSWER,h).then(A).catch(f)});E.code!==D.WS_ABORT&&f(E)})}),r.on(De.NEED_RENEGOTIATE,(h,A,f)=>{this.signal.request(Tt.PUBLISH,{state:"negotiation",stream_type:s,p2p_id:r.pc.ID,sdp:h},!0).then(m=>{A(JSON.parse(m.sdp))}).catch(m=>{m.code!==D.WS_ABORT&&f(m)})}),r.on(De.NEED_UNPUB,h=>c&&!this.needToSendUnpubUnsub.has(c)?h(!1):this.state==="RECONNECTING"?h(!0):void this.signal.request(Tt.UNPUBLISH,{stream_id:r.getUserId(),stream_type:s},!0).then(()=>h(!1)).catch(A=>{R.warning("unpublish warning: ",A),h(!0)})),r.on(De.NEED_UPLOAD,(h,A)=>{this.signal.upload(h,{stream_type:s,stats:A})}),r.on(De.NEED_SIGNAL_RTT,h=>{h(this.signal.rtt)}),r.on(De.NEED_CONTROL,(h,A,f)=>{if(h.type==="video"&&h.muted)h="mute_local_video";else if(h.type!=="video"||h.muted)if(h.type==="audio"&&h.muted)h="mute_local_audio";else{if(h.type!=="audio"||h.muted)return;h="unmute_local_audio"}else h="unmute_local_video";this.sendControl({stream_id:this.joinInfo&&(this.joinInfo.stringUid||this.joinInfo.uid),action:h}).then(A).catch(f)}),this.state!=="RECONNECTING"){if(this.state!=="CONNECTED")return new L(D.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state)).throw();await r.startP2PConnection()}else r.readyToReconnectPC()}async subscribe(r){if(!this.joinInfo)throw new L(D.UNEXPECTED_ERROR,"subscribe no joinInfo");let s=r.getUserId();if(r.on(De.NEED_ANSWER,(c,u,h)=>{var A=r.subscribeOptions;A={stream_id:r.getUserId(),audio:!!A.audio,video:!!A.video,mode:this.spec.mode,codec:this.spec.codec,p2p_id:r.pc.ID,sdp:fe(c),tcc:!!ne.SUBSCRIBE_TCC,extend:ne.SUB_EXTEND},this.signal.request(Tt.SUBSCRIBE,A,!0).then(f=>{this.needToSendUnpubUnsub.set(s,!0),u(JSON.parse(f.sdp))}).catch(f=>{if(c.retry&&f.data&&f.data.code===ke.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.clientId,"] receiver subscribe error code, retry"),f.toString()),yr(r,De.NEED_UNSUB).then(()=>{c.retry=!1,yr(r,De.NEED_ANSWER,c).then(u).catch(h)});f.code!==D.WS_ABORT&&h(f)})}),r.on(De.NEED_UNSUB,c=>this.needToSendUnpubUnsub.has(s)?this.state==="RECONNECTING"?c(!0):void this.signal.request(Tt.UNSUBSCRIBE,{stream_id:r.getUserId()},!0).then(()=>c(!1)).catch(u=>{R.warning("unsubscribe warning",u),c(!0)}):c(!1)),r.on(De.NEED_UPLOAD,(c,u)=>{this.signal.upload(c,{stream_id:r.getUserId(),stats:u})}),r.on(De.NEED_SIGNAL_RTT,c=>{c(this.signal.rtt)}),this.state!=="RECONNECTING"){if(this.state!=="CONNECTED")return new L(D.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state)).throw();await r.startP2PConnection()}else r.readyToReconnectPC()}async subscribeChange(r,s){var c,u;if(!this.joinInfo)throw new L(D.UNEXPECTED_ERROR,"subscribe no joinInfo");if(await r.setSubscribeOptions(s),this.state!=="RECONNECTING"){if(this.state!=="CONNECTED")return new L(D.INVALID_OPERATION,"can not subscribe change when connection state is ".concat(this.state)).throw();R.debug(b(c=b(u="[".concat(this.clientId,"] send subscribe change, audio: ")).call(u,s.audio,", video: ")).call(c,s.video)),await this.signal.request(Tt.SUBSCRIBE_CHANGE,{stream_id:r.getUserId(),audio:!!s.audio,video:!!s.video},!0)}}async sendControl(r){this.signal.request(Tt.CONTROL,r,!0,!0)}async unsubscribe(r){await r.closeP2PConnection()}getGatewayInfo(){return this.signal.request(Tt.GATEWAY_INFO)}renewToken(r){return this.signal.request(Tt.RENEW_TOKEN,{token:r})}async setClientRole(r,s){if(s&&(this._clientRoleOptions=Zr({},s)),this.state!=="CONNECTED")return void(this.role=r);await this.signal.request(Tt.SET_CLIENT_ROLE,{role:r,level:r==="audience"?this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:0}),this.role=r}async setRemoteVideoStreamType(r,s){await this.signal.request(Tt.SWITCH_VIDEO_STREAM,{stream_id:r,stream_type:s})}async setStreamFallbackOption(r,s){await this.signal.request(Tt.SET_FALLBACK_OPTION,{stream_id:r,fallback_type:s})}async pickSVCLayer(r,s){await this.signal.request(Tt.PICK_SVC_LAYER,{stream_id:r,spatial_layer:s.spatialLayer,temporal_layer:s.temporalLayer})}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=de()-this.inChannelInfo.joinAt),Nh({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Tt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=de()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){let r=Kp.get(this.joinInfo.cname);r&&r.delete(this.joinInfo.uid)}this.needToSendUnpubUnsub=new Ct,this.key=this.joinInfo=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(this.joinInfo){var r=(r=((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex])||"").match(/(wss:\/\/)?([^:]+):(\d+)/))?{username:Pr.username,password:Pr.password,turnServerURL:r[2],tcpport:ar(r[3])+30,udpport:ar(r[3])+30,forceturn:!1}:null;this.joinInfo.turnServer.serversFromGateway=[],r&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Nh({},Pr,{turnServerURL:r.turnServerURL,tcpport:r.tcpport,udpport:r.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}}async updateTrafficStats(){var r;if(this.state==="CONNECTED"){var s=await this.signal.request(Tt.TRAFFIC_STATS,void 0,!0);s.timestamp=de(),W(r=s.peer_delay).call(r,c=>{var u;let h=this._statsCollector.trafficStats&&Je(u=this._statsCollector.trafficStats.peer_delay).call(u,A=>A.peer_uid===c.peer_uid);h&&h.B_st!==c.B_st&&ii(()=>{this.emit(_r.STREAM_TYPE_CHANGE,c.peer_uid,c.B_st)})}),this._statsCollector.updateTrafficStats(s)}}getJoinMessage(){if(!this.joinInfo||!this.key)throw new L(D.UNEXPECTED_ERROR,"can not generate join message, no join info");let r=Zr({},this.joinInfo.apResponse);var s=ne.REPORT_APP_SCENARIO;if(typeof s!="string")try{s=fe(s)}catch{s=void 0}return s&&128<s.length&&(s=void 0),s={session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Hn,browser:navigator.userAgent,process_id:ne.PROCESS_ID,mode:this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:r,extend:ne.JOIN_EXTEND,details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:s},this.joinInfo.stringUid&&(s.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(s.aes_mode=this.joinInfo.aesmode,ne.ENCRYPT_AES?(s.aes_secret=this.joinInfo.aespassword,s.aes_encrypt=!0):s.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(s.aes_salt=this.joinInfo.aessalt)),r.addresses[this.signal.websocket.currentURLIndex]&&(s.ap_response.ticket=r.addresses[this.signal.websocket.currentURLIndex].ticket,delete r.addresses),s}getRejoinMessage(){if(!this.joinInfo)throw new L(D.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Xe.WS_RECONNECTING,r=>{this.joinInfo&&z.WebSocketQuit(this.joinInfo.sid,{lts:de(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r||Rn.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",z.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode}),this.isSignalRecover=!1,this.joinGatewayStartTime=de())}),this.signal.on(Xe.WS_CLOSED,r=>{let s;switch(r){case"LEAVE":s=Rn.LEAVE;break;case"UID_BANNED":case"IP_BANNED":case"CHANNEL_BANNED":case"SERVER_ERROR":s=Rn.SERVER_ERROR;break;default:s=Rn.NETWORK_ERROR}R.debug("[signal] websocket closed, reason: ".concat(s||"undefined -> "+Rn.NETWORK_ERROR)),this.joinInfo&&z.WebSocketQuit(this.joinInfo.sid,{lts:de(),succ:r==="LEAVE"?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:s}),this.reset(),this._disconnectedReason=r,this.state="DISCONNECTED"}),this.signal.on(Xe.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){var r,s,c;if(this.role==="audience"&&this._clientRoleOptions&&this._clientRoleOptions.level&&(R.debug(b(r=b(s=b(c="[".concat(this.clientId,"] patch to send set client role, role: ")).call(c,this.role,", mode: ")).call(s,this.spec.mode,", level: ")).call(r,this._clientRoleOptions&&this._clientRoleOptions.level)),this.setClientRole(this.role,this._clientRoleOptions)),z.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid}),this.joinInfo.useLocalAccessPoint){r=this.signal.url&&this.signal.url.match(/wss:\/\/([^:]+):(\d+)/);var u;if(!r)return void R.error(b(u="[".concat(this.clientId,"] set local access point after joined failed: ")).call(u,r));Ur("EVENT_REPORT_DOMAIN",r[1]),Ur("EVENT_REPORT_BACKUP_DOMAIN",r[1]),Ur("LOG_UPLOAD_SERVER","".concat(r[1],":6444"))}}}),this.signal.on(mt.ON_UPLINK_STATS,r=>{this._statsCollector.updateUplinkStats(r)}),this.signal.on(Xe.REQUEST_RECOVER,(r,s,c)=>{if(!this.joinInfo)return c(new L(D.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));r&&(this.joinInfo.multiIP=r,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,yr(this,_r.REQUEST_NEW_GATEWAY_LIST).then(s).catch(c)}),this.signal.on(Xe.REQUEST_JOIN_INFO,r=>{r(this.getJoinMessage())}),this.signal.on(Xe.REQUEST_REJOIN_INFO,r=>{r(this.getRejoinMessage())}),this.signal.on(Xe.REPORT_JOIN_GATEWAY,(r,s)=>{this.joinInfo&&z.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:r,addr:s,uid:this.joinInfo.uid,cid:this.joinInfo.cid})}),this.signal.on(Xe.IS_P2P_DISCONNECTED,r=>{r(jc(this,_r.IS_P2P_DISCONNECTED))}),this.signal.on(Xe.DISCONNECT_P2P,()=>{this.needToSendUnpubUnsub=new Ct,this.emit(_r.DISCONNECT_P2P)}),this.signal.on(Xe.NEED_RENEW_SESSION,()=>{this.emit(_r.NEED_RENEW_SESSION)}),this.signal.on(Xe.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Xe.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0})}}var O2=or("iterator"),Wp=!ir(function(){var i=new URL("b?a=1&b=2&c=3","http://a"),r=i.searchParams,s="";return i.pathname="c%20d",r.forEach(function(c,u){r.delete("b"),s+=u+c}),!i.toJSON||!r.sort||i.href!=="http://a/c%20d?a=1&c=3"||r.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!r[O2]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://\u0442\u0435\u0441\u0442").host!=="xn--e1aybc"||new URL("http://a#\u0431").hash!=="#%D0%B1"||s!=="a1c3"||new URL("http://x",void 0).host!=="x"}),b2=/[^\0-\u007E]/,D2=/[.\u3002\uFF0E\uFF61]/g,tc=Math.floor,Yp=String.fromCharCode,f1=function(i){return i+22+75*(26>i)},B2=function(i){for(var r,s=[],c=[],u=0,h=i.length;u<h;){var A=i.charCodeAt(u++);if(55296<=A&&56319>=A&&u<h){var f=i.charCodeAt(u++);(64512&f)==56320?c.push(((1023&A)<<10)+(1023&f)+65536):(c.push(A),u--)}else c.push(A)}u=(i=c).length,h=128;var m=0,I=72;for(c=0;c<i.length;c++)128>(r=i[c])&&s.push(Yp(r));for((f=A=s.length)&&s.push("-");f<u;){var E=2147483647;for(c=0;c<i.length;c++)(r=i[c])>=h&&r<E&&(E=r);var _=f+1;if(E-h>tc((2147483647-m)/_))throw RangeError("Overflow: input needs wider integers to process");for(m+=(E-h)*_,h=E,c=0;c<i.length;c++){if((r=i[c])<h&&2147483647<++m)throw RangeError("Overflow: input needs wider integers to process");if(r==h){var S=m;for(E=36;;E+=36){var N=E<=I?1:E>=I+26?26:E-I;if(S<N)break;S-=N;var k=36-N;s.push(Yp(f1(N+S%k))),S=tc(S/k)}for(s.push(Yp(f1(S))),I=_,E=0,m=f==A?tc(m/700):m>>1,m+=tc(m/I);455<m;E+=36)m=tc(m/35);I=tc(E+36*m/(m+38)),m=0,++f}}++m,++h}return s.join("")},g1=function(i){var r=bu(i);if(typeof r!="function")throw TypeError(String(i)+" is not iterable");return Xr(r.call(i))},m1=Ki("fetch"),qp=Ki("Headers"),M2=or("iterator"),v1=fr.set,ui=fr.getterFor("URLSearchParams"),L2=fr.getterFor("URLSearchParamsIterator"),P2=/\+/g,E1=Array(4),Q2=function(i){return E1[i-1]||(E1[i-1]=RegExp("((?:%[\\da-f]{2}){"+i+"})","gi"))},x2=function(i){try{return decodeURIComponent(i)}catch{return i}},I1=function(i){i=i.replace(P2," ");var r=4;try{return decodeURIComponent(i)}catch{for(;r;)i=i.replace(Q2(r--),x2);return i}},C1=/[!'()~]|%20/g,U2={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},y1=function(i){return U2[i]},_1=function(i,r){if(r){var s,c;r=r.split("&");for(var u=0;u<r.length;)(s=r[u++]).length&&(c=s.split("="),i.push({key:I1(c.shift()),value:I1(c.join("="))}))}},F2=function(i){this.entries.length=0,_1(this.entries,i)},rc=function(i,r){if(i<r)throw TypeError("Not enough arguments")},Jp=ev(function(i,r){v1(this,{type:"URLSearchParamsIterator",iterator:g1(ui(i).entries),kind:r})},"Iterator",function(){var i=L2(this),r=i.kind;i=i.iterator.next();var s=i.value;return i.done||(i.value=r==="keys"?s.key:r==="values"?s.value:[s.key,s.value]),i}),hl=function(){Fa(this,hl,"URLSearchParams");var i,r,s,c,u,h=0<arguments.length?arguments[0]:void 0,A=[];if(v1(this,{type:"URLSearchParams",entries:A,updateURL:function(){},updateSearchParams:F2}),h!==void 0)if(Ht(h))if(typeof(i=bu(h))=="function")for(r=(i=i.call(h)).next;!(h=r.call(i)).done;){if((h=(c=(s=g1(Xr(h.value))).next).call(s)).done||(u=c.call(s)).done||!c.call(s).done)throw TypeError("Expected sequence with length 2");A.push({key:h.value+"",value:u.value+""})}else for(r in h)et(h,r)&&A.push({key:r,value:h[r]+""});else _1(A,typeof h=="string"?h.charAt(0)==="?"?h.slice(1):h:h+"")},id=hl.prototype;js(id,{append:function(i,r){rc(arguments.length,2);var s=ui(this);s.entries.push({key:i+"",value:r+""}),s.updateURL()},delete:function(i){rc(arguments.length,1);for(var r=ui(this),s=r.entries,c=i+"",u=0;u<s.length;)s[u].key===c?s.splice(u,1):u++;r.updateURL()},get:function(i){rc(arguments.length,1);for(var r=ui(this).entries,s=i+"",c=0;c<r.length;c++)if(r[c].key===s)return r[c].value;return null},getAll:function(i){rc(arguments.length,1);for(var r=ui(this).entries,s=i+"",c=[],u=0;u<r.length;u++)r[u].key===s&&c.push(r[u].value);return c},has:function(i){rc(arguments.length,1);for(var r=ui(this).entries,s=i+"",c=0;c<r.length;)if(r[c++].key===s)return!0;return!1},set:function(i,r){rc(arguments.length,1);for(var s,c=ui(this),u=c.entries,h=!1,A=i+"",f=r+"",m=0;m<u.length;m++)(s=u[m]).key===A&&(h?u.splice(m--,1):(h=!0,s.value=f));h||u.push({key:A,value:f}),c.updateURL()},sort:function(){var i,r,s=ui(this),c=s.entries,u=c.slice();for(r=c.length=0;r<u.length;r++){var h=u[r];for(i=0;i<r;i++)if(c[i].key>h.key){c.splice(i,0,h);break}i===r&&c.push(h)}s.updateURL()},forEach:function(i){for(var r,s=ui(this).entries,c=ss(i,1<arguments.length?arguments[1]:void 0,3),u=0;u<s.length;)c((r=s[u++]).value,r.key,this)},keys:function(){return new Jp(this,"keys")},values:function(){return new Jp(this,"values")},entries:function(){return new Jp(this,"entries")}},{enumerable:!0}),Qo(id,M2,id.entries),Qo(id,"toString",function(){for(var i,r=ui(this).entries,s=[],c=0;c<r.length;)i=r[c++],s.push(encodeURIComponent(i.key).replace(C1,y1)+"="+encodeURIComponent(i.value).replace(C1,y1));return s.join("&")},{enumerable:!0}),Fs(hl,"URLSearchParams"),Fe({global:!0,forced:!Wp},{URLSearchParams:hl}),Wp||typeof m1!="function"||typeof qp!="function"||Fe({global:!0,enumerable:!0,forced:!0},{fetch:function(i){var r,s,c,u=[i];return 1<arguments.length&&(Ht(r=arguments[1])&&(s=r.body,xa(s)==="URLSearchParams"&&((c=r.headers?new qp(r.headers):new qp).has("content-type")||c.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),r=cs(r,{body:Mo(0,String(s)),headers:Mo(0,c)}))),u.push(r)),m1.apply(this,u)}});var pl=Ve.URL,V2=hl,G2=fr.set,lr=fr.getterFor("URL"),j2=Math.floor,S1=Math.pow,T1=/[A-Za-z]/,H2=/[\d+\-.A-Za-z]/,zp=/\d/,K2=/^(0x|0X)/,W2=/^[0-7]+$/,Y2=/^\d+$/,R1=/^[\dA-Fa-f]+$/,q2=/[\u0000\u0009\u000A\u000D #%/:?@[\\]]/,J2=/[\u0000\u0009\u000A\u000D #/:?@[\\]]/,z2=/^[\u0000-\u001F ]+|[\u0000-\u001F ]+$/g,X2=/[\u0009\u000A\u000D]/g,Xp=function(i,r){var s,c;if(r.charAt(0)=="["){if(r.charAt(r.length-1)!="]"||!(s=$2(r.slice(1,-1))))return"Invalid host"}else if(Yr(i)){var u=[],h=r.toLowerCase().replace(D2,".").split(".");for(c=0;c<h.length;c++){var A=h[c];u.push(b2.test(A)?"xn--"+B2(A):A)}if(r=u.join("."),q2.test(r)||(s=Z2(r))===null)return"Invalid host"}else{if(J2.test(r))return"Invalid host";for(s="",r=zs(r),c=0;c<r.length;c++)s+=ds(r[c],od)}i.host=s},Z2=function(i){var r,s,c,u,h=i.split(".");if(h.length&&h[h.length-1]==""&&h.pop(),4<(r=h.length))return i;var A=[];for(s=0;s<r;s++){if((c=h[s])=="")return i;if(u=10,1<c.length&&c.charAt(0)=="0"&&(u=K2.test(c)?16:8,c=c.slice(u==8?1:2)),c==="")c=0;else{if(!(u==10?Y2:u==8?W2:R1).test(c))return i;c=parseInt(c,u)}A.push(c)}for(s=0;s<r;s++)if(c=A[s],s==r-1){if(c>=S1(256,5-r))return null}else if(255<c)return null;for(i=A.pop(),s=0;s<A.length;s++)i+=A[s]*S1(256,3-s);return i},$2=function(i){var r,s,c,u=[0,0,0,0,0,0,0,0],h=0,A=null,f=0,m=function(){return i.charAt(f)};if(m()==":"){if(i.charAt(1)!=":")return;f+=2,A=++h}for(;m();){if(h==8)return;if(m()!=":"){for(r=s=0;4>s&&R1.test(m());)r=16*r+parseInt(m(),16),f++,s++;if(m()=="."){if(s==0||(f-=s,6<h))return;for(r=0;m();){if(s=null,0<r){if(!(m()=="."&&4>r))return;f++}if(!zp.test(m()))return;for(;zp.test(m());){if(c=parseInt(m(),10),s===null)s=c;else{if(s==0)return;s=10*s+c}if(255<s)return;f++}u[h]=256*u[h]+s,++r!=2&&r!=4||h++}if(r!=4)return;break}if(m()==":"){if(f++,!m())return}else if(m())return;u[h++]=r}else{if(A!==null)return;f++,A=++h}}if(A!==null)for(m=h-A,h=7;h!=0&&0<m;)r=u[h],u[h--]=u[A+m-1],u[A+--m]=r;else if(h!=8)return;return u},Al=function(i){var r,s;if(typeof i=="number"){var c=[];for(r=0;4>r;r++)c.unshift(i%256),i=j2(i/256);return c.join(".")}if(typeof i=="object"){c="",r=null;for(var u=1,h=null,A=0,f=0;8>f;f++)i[f]!==0?(A>u&&(r=h,u=A),h=null,A=0):(h===null&&(h=f),++A);for(u=(A>u&&(r=h),r),r=0;8>r;r++)s&&i[r]===0||(s&&(s=!1),u===r?(c+=r?":":"::",s=!0):(c+=i[r].toString(16),7>r&&(c+=":")));return"["+c+"]"}return i},od={},w1=$c({},od,{" ":1,'"':1,"<":1,">":1,"`":1}),N1=$c({},w1,{"#":1,"?":1,"{":1,"}":1}),Zp=$c({},N1,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),ds=function(i,r){var s=IT(i,0);return 32<s&&127>s&&!et(r,i)?i:encodeURIComponent(i)},sd={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Yr=function(i){return et(sd,i.scheme)},$p=function(i){return!i.host||i.cannotBeABaseURL||i.scheme=="file"},fl=function(i,r){var s;return i.length==2&&T1.test(i.charAt(0))&&((s=i.charAt(1))==":"||!r&&s=="|")},k1=function(i){var r;return 1<i.length&&fl(i.slice(0,2))&&(i.length==2||(r=i.charAt(2))==="/"||r==="\\"||r==="?"||r==="#")},O1=function(i){var r=i.path,s=r.length;!s||i.scheme=="file"&&s==1&&fl(r[0],!0)||r.pop()},eA={},b1={},tA={},D1={},B1={},rA={},M1={},L1={},ad={},cd={},nA={},iA={},oA={},sA={},P1={},aA={},gl={},vo={},Q1={},Xs={},jo={},Eo=function(i,r,s,c){var u,h,A=s||eA,f=0,m="",I=!1,E=!1,_=!1;for(s||(i.scheme="",i.username="",i.password="",i.host=null,i.port=null,i.path=[],i.query=null,i.fragment=null,i.cannotBeABaseURL=!1,r=r.replace(z2,"")),r=r.replace(X2,""),r=zs(r);f<=r.length;){switch(u=r[f],A){case eA:if(!u||!T1.test(u)){if(s)return"Invalid scheme";A=tA;continue}m+=u.toLowerCase(),A=b1;break;case b1:if(u&&(H2.test(u)||u=="+"||u=="-"||u=="."))m+=u.toLowerCase();else{if(u!=":"){if(s)return"Invalid scheme";m="",A=tA,f=0;continue}if(s&&(Yr(i)!=et(sd,m)||m=="file"&&(i.username!=""||i.password!=""||i.port!==null)||i.scheme=="file"&&!i.host))return;if(i.scheme=m,s)return void(Yr(i)&&sd[i.scheme]==i.port&&(i.port=null));m="",i.scheme=="file"?A=sA:Yr(i)&&c&&c.scheme==i.scheme?A=D1:Yr(i)?A=L1:r[f+1]=="/"?(A=B1,f++):(i.cannotBeABaseURL=!0,i.path.push(""),A=Q1)}break;case tA:if(!c||c.cannotBeABaseURL&&u!="#")return"Invalid scheme";if(c.cannotBeABaseURL&&u=="#"){i.scheme=c.scheme,i.path=c.path.slice(),i.query=c.query,i.fragment="",i.cannotBeABaseURL=!0,A=jo;break}A=c.scheme=="file"?sA:rA;continue;case D1:if(u!="/"||r[f+1]!="/"){A=rA;continue}A=ad,f++;break;case B1:if(u=="/"){A=cd;break}A=vo;continue;case rA:if(i.scheme=c.scheme,u==null)i.username=c.username,i.password=c.password,i.host=c.host,i.port=c.port,i.path=c.path.slice(),i.query=c.query;else if(u=="/"||u=="\\"&&Yr(i))A=M1;else if(u=="?")i.username=c.username,i.password=c.password,i.host=c.host,i.port=c.port,i.path=c.path.slice(),i.query="",A=Xs;else{if(u!="#"){i.username=c.username,i.password=c.password,i.host=c.host,i.port=c.port,i.path=c.path.slice(),i.path.pop(),A=vo;continue}i.username=c.username,i.password=c.password,i.host=c.host,i.port=c.port,i.path=c.path.slice(),i.query=c.query,i.fragment="",A=jo}break;case M1:if(!Yr(i)||u!="/"&&u!="\\"){if(u!="/"){i.username=c.username,i.password=c.password,i.host=c.host,i.port=c.port,A=vo;continue}A=cd}else A=ad;break;case L1:if(A=ad,u!="/"||m.charAt(f+1)!="/")continue;f++;break;case ad:if(u!="/"&&u!="\\"){A=cd;continue}break;case cd:if(u=="@"){for(I&&(m="%40"+m),I=!0,m=zs(m),u=0;u<m.length;u++){var S=m[u];S!=":"||_?(S=ds(S,Zp),_?i.password+=S:i.username+=S):_=!0}m=""}else if(u==null||u=="/"||u=="?"||u=="#"||u=="\\"&&Yr(i)){if(I&&m=="")return"Invalid authority";f-=zs(m).length+1,m="",A=nA}else m+=u;break;case nA:case iA:if(s&&i.scheme=="file"){A=aA;continue}if(u!=":"||E){if(u==null||u=="/"||u=="?"||u=="#"||u=="\\"&&Yr(i)){if(Yr(i)&&m=="")return"Invalid host";if(s&&m==""&&(i.username!=""||i.password!=""||i.port!==null))return;if(A=Xp(i,m))return A;if(m="",A=gl,s)return;continue}u=="["?E=!0:u=="]"&&(E=!1),m+=u}else{if(m=="")return"Invalid host";if(A=Xp(i,m))return A;if(m="",A=oA,s==iA)return}break;case oA:if(!zp.test(u)){if(u==null||u=="/"||u=="?"||u=="#"||u=="\\"&&Yr(i)||s){if(m!=""){if(A=parseInt(m,10),65535<A)return"Invalid port";i.port=Yr(i)&&A===sd[i.scheme]?null:A,m=""}if(s)return;A=gl;continue}return"Invalid port"}m+=u;break;case sA:if(i.scheme="file",u=="/"||u=="\\")A=P1;else{if(!c||c.scheme!="file"){A=vo;continue}if(u==null)i.host=c.host,i.path=c.path.slice(),i.query=c.query;else if(u=="?")i.host=c.host,i.path=c.path.slice(),i.query="",A=Xs;else{if(u!="#"){k1(r.slice(f).join(""))||(i.host=c.host,i.path=c.path.slice(),O1(i)),A=vo;continue}i.host=c.host,i.path=c.path.slice(),i.query=c.query,i.fragment="",A=jo}}break;case P1:if(u=="/"||u=="\\"){A=aA;break}c&&c.scheme=="file"&&!k1(r.slice(f).join(""))&&(fl(c.path[0],!0)?i.path.push(c.path[0]):i.host=c.host),A=vo;continue;case aA:if(u==null||u=="/"||u=="\\"||u=="?"||u=="#"){if(!s&&fl(m))A=vo;else{if(m==""){if(i.host="",s)return}else{if(A=Xp(i,m))return A;if(i.host=="localhost"&&(i.host=""),s)return;m=""}A=gl}continue}m+=u;break;case gl:if(Yr(i)){if(A=vo,u!="/"&&u!="\\")continue}else if(s||u!="?")if(s||u!="#"){if(u!=null&&(A=vo,u!="/"))continue}else i.fragment="",A=jo;else i.query="",A=Xs;break;case vo:if(u==null||u=="/"||u=="\\"&&Yr(i)||!s&&(u=="?"||u=="#")){if((h=(h=m).toLowerCase())===".."||h==="%2e."||h===".%2e"||h==="%2e%2e"?(O1(i),u=="/"||u=="\\"&&Yr(i)||i.path.push("")):m==="."||m.toLowerCase()==="%2e"?u=="/"||u=="\\"&&Yr(i)||i.path.push(""):(i.scheme=="file"&&!i.path.length&&fl(m)&&(i.host&&(i.host=""),m=m.charAt(0)+":"),i.path.push(m)),m="",i.scheme=="file"&&(u==null||u=="?"||u=="#"))for(;1<i.path.length&&i.path[0]==="";)i.path.shift();u=="?"?(i.query="",A=Xs):u=="#"&&(i.fragment="",A=jo)}else m+=ds(u,N1);break;case Q1:u=="?"?(i.query="",A=Xs):u=="#"?(i.fragment="",A=jo):u!=null&&(i.path[0]+=ds(u,od));break;case Xs:s||u!="#"?u!=null&&(u=="'"&&Yr(i)?i.query+="%27":i.query+=u=="#"?"%23":ds(u,od)):(i.fragment="",A=jo);break;case jo:u!=null&&(i.fragment+=ds(u,w1))}f++}},Zs=function(i){var r=Fa(this,Zs,"URL"),s=1<arguments.length?arguments[1]:void 0,c=String(i),u=G2(r,{type:"URL"});if(s!==void 0){if(s instanceof Zs)var h=lr(s);else if(s=Eo(h={},String(s)))throw TypeError(s)}if(s=Eo(u,c,null,h))throw TypeError(s);var A=u.searchParams=new V2;h=ui(A),h.updateSearchParams(u.query),h.updateURL=function(){u.query=String(A)||null},Ut||(r.href=ld.call(r),r.origin=x1.call(r),r.protocol=U1.call(r),r.username=F1.call(r),r.password=V1.call(r),r.host=G1.call(r),r.hostname=j1.call(r),r.port=H1.call(r),r.pathname=K1.call(r),r.search=W1.call(r),r.searchParams=Y1.call(r),r.hash=q1.call(r))},cA=Zs.prototype,ld=function(){var i=lr(this),r=i.scheme,s=i.username,c=i.password,u=i.host,h=i.port,A=i.path,f=i.query,m=i.fragment,I=r+":";return u!==null?(I+="//",(i.username!=""||i.password!="")&&(I+=s+(c?":"+c:"")+"@"),I+=Al(u),h!==null&&(I+=":"+h)):r=="file"&&(I+="//"),I+=i.cannotBeABaseURL?A[0]:A.length?"/"+A.join("/"):"",f!==null&&(I+="?"+f),m!==null&&(I+="#"+m),I},x1=function(){var i=lr(this),r=i.scheme,s=i.port;if(r=="blob")try{return new URL(r.path[0]).origin}catch{return"null"}return r!="file"&&Yr(i)?r+"://"+Al(i.host)+(s!==null?":"+s:""):"null"},U1=function(){return lr(this).scheme+":"},F1=function(){return lr(this).username},V1=function(){return lr(this).password},G1=function(){var i=lr(this),r=i.host;return i=i.port,r===null?"":i===null?Al(r):Al(r)+":"+i},j1=function(){var i=lr(this).host;return i===null?"":Al(i)},H1=function(){var i=lr(this).port;return i===null?"":String(i)},K1=function(){var i=lr(this),r=i.path;return i.cannotBeABaseURL?r[0]:r.length?"/"+r.join("/"):""},W1=function(){var i=lr(this).query;return i?"?"+i:""},Y1=function(){return lr(this).searchParams},q1=function(){var i=lr(this).fragment;return i?"#"+i:""},Di=function(i,r){return{get:i,set:r,configurable:!0,enumerable:!0}};if(Ut&&Kh(cA,{href:Di(ld,function(i){var r=lr(this);if(i=Eo(r,String(i)))throw TypeError(i);ui(r.searchParams).updateSearchParams(r.query)}),origin:Di(x1),protocol:Di(U1,function(i){var r=lr(this);Eo(r,String(i)+":",eA)}),username:Di(F1,function(i){var r=lr(this);if(i=zs(String(i)),!$p(r)){r.username="";for(var s=0;s<i.length;s++)r.username+=ds(i[s],Zp)}}),password:Di(V1,function(i){var r=lr(this);if(i=zs(String(i)),!$p(r)){r.password="";for(var s=0;s<i.length;s++)r.password+=ds(i[s],Zp)}}),host:Di(G1,function(i){var r=lr(this);r.cannotBeABaseURL||Eo(r,String(i),nA)}),hostname:Di(j1,function(i){var r=lr(this);r.cannotBeABaseURL||Eo(r,String(i),iA)}),port:Di(H1,function(i){var r=lr(this);$p(r)||((i=String(i))==""?r.port=null:Eo(r,i,oA))}),pathname:Di(K1,function(i){var r=lr(this);r.cannotBeABaseURL||(r.path=[],Eo(r,i+"",gl))}),search:Di(W1,function(i){var r=lr(this);(i=String(i))==""?r.query=null:(i.charAt(0)=="?"&&(i=i.slice(1)),r.query="",Eo(r,i,Xs)),ui(r.searchParams).updateSearchParams(r.query)}),searchParams:Di(Y1),hash:Di(q1,function(i){var r=lr(this);(i=String(i))!=""?(i.charAt(0)=="#"&&(i=i.slice(1)),r.fragment="",Eo(r,i,jo)):r.fragment=null})}),Qo(cA,"toJSON",function(){return ld.call(this)},{enumerable:!0}),Qo(cA,"toString",function(){return ld.call(this)},{enumerable:!0}),pl){var J1=pl.createObjectURL,z1=pl.revokeObjectURL;J1&&Qo(Zs,"createObjectURL",function(i){return J1.apply(pl,arguments)}),z1&&Qo(Zs,"revokeObjectURL",function(i){return z1.apply(pl,arguments)})}Fs(Zs,"URL"),Fe({global:!0,forced:!Wp,sham:!Ut},{URL:Zs});var ew=Bt.URL;(function(){function i(j){var q=0;return function(){return q<j.length?{done:!1,value:j[q++]}:{done:!0}}}function r(j,q){if(q)e:{var $=k;j=j.split(".");for(var he=0;he<j.length-1;he++){var pe=j[he];if(!(pe in $))break e;$=$[pe]}(q=q(he=$[j=j[j.length-1]]))!=he&&q!=null&&N($,j,{configurable:!0,writable:!0,value:q})}}function s(j){return(j={next:j})[Symbol.iterator]=function(){return this},j}function c(j){var q=typeof Symbol!="undefined"&&Symbol.iterator&&j[Symbol.iterator];return q?q.call(j):{next:i(j)}}function u(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function h(j){if(j.m)throw new TypeError("Generator is already running");j.m=!0}function A(j,q){return j.h=3,{value:q}}function f(j){this.g=new u,this.G=j}function m(j,q,$,he){try{var pe=q.call(j.g.j,$);if(!(pe instanceof Object))throw new TypeError("Iterator result "+pe+" is not an object");if(!pe.done)return j.g.m=!1,pe;var Pe=pe.value}catch(_e){return j.g.j=null,j.g.s(_e),I(j)}return j.g.j=null,he.call(j.g,Pe),I(j)}function I(j){for(;j.g.h;)try{var q=j.G(j.g);if(q)return j.g.m=!1,{value:q.value,done:!1}}catch($){j.g.v=void 0,j.g.s($)}if(j.g.m=!1,j.g.l){if(q=j.g.l,j.g.l=null,q.F)throw q.D;return{value:q.return,done:!0}}return{value:void 0,done:!0}}function E(j){this.next=function(q){return j.o(q)},this.throw=function(q){return j.s(q)},this.return=function(q){return function($,he){h($.g);var pe=$.g.j;return pe?m($,"return"in pe?pe.return:function(Pe){return{value:Pe,done:!0}},he,$.g.return):($.g.return(he),I($))}(j,q)},this[Symbol.iterator]=function(){return this}}function _(j,q){return q=new E(new f(q)),J&&j.prototype&&J(q,j.prototype),q}var S,N=typeof Object.defineProperties=="function"?Object.defineProperty:function(j,q,$){return j==Array.prototype||j==Object.prototype||(j[q]=$.value),j},k=function(j){j=[typeof globalThis=="object"&&globalThis,j,typeof window=="object"&&window,typeof self=="object"&&self,typeof Yc=="object"&&Yc];for(var q=0;q<j.length;++q){var $=j[q];if($&&$.Math==Math)return $}throw Error("Cannot find global object")}(this);if(r("Symbol",function(j){function q(pe,Pe){this.A=pe,N(this,"description",{configurable:!0,writable:!0,value:Pe})}if(j)return j;q.prototype.toString=function(){return this.A};var $="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",he=0;return function pe(Pe){if(this instanceof pe)throw new TypeError("Symbol is not a constructor");return new q($+(Pe||"")+"_"+he++,Pe)}}),r("Symbol.iterator",function(j){if(j)return j;j=Symbol("Symbol.iterator");for(var q="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),$=0;$<q.length;$++){var he=k[q[$]];typeof he=="function"&&typeof he.prototype[j]!="function"&&N(he.prototype,j,{configurable:!0,writable:!0,value:function(){return s(i(this))}})}return j}),typeof Object.setPrototypeOf=="function")var B=Object.setPrototypeOf;else{e:{var P={};try{P.__proto__={a:!0},B=P.a;break e}catch{}B=!1}B=B?function(j,q){if(j.__proto__=q,j.__proto__!==q)throw new TypeError(j+" is not extensible");return j}:null}var J=B;if(u.prototype.o=function(j){this.v=j},u.prototype.s=function(j){this.l={D:j,F:!0},this.h=this.C||this.u},u.prototype.return=function(j){this.l={return:j},this.h=this.u},f.prototype.o=function(j){return h(this.g),this.g.j?m(this,this.g.j.next,j,this.g.o):(this.g.o(j),I(this))},f.prototype.s=function(j){return h(this.g),this.g.j?m(this,this.g.j.throw,j,this.g.o):(this.g.s(j),I(this))},r("Array.prototype.entries",function(j){return j||function(){return function(q,$){q instanceof String&&(q+="");var he=0,pe=!1,Pe={next:function(){if(!pe&&he<q.length){var _e=he++;return{value:$(_e,q[_e]),done:!1}}return pe=!0,{done:!0,value:void 0}}};return Pe[Symbol.iterator]=function(){return Pe},Pe}(this,function(q,$){return[q,$]})}}),typeof Blob!="undefined"&&(typeof FormData=="undefined"||!FormData.prototype.keys)){var se=function(j,q){for(var $=0;$<j.length;$++)q(j[$])},ge=function(j){return j.replace(/\r?\n|\r/g,`\r
`)},Le=function(j,q,$){return q instanceof Blob?($=$!==void 0?String($+""):typeof q.name=="string"?q.name:"blob",q.name===$&&Object.prototype.toString.call(q)!=="[object Blob]"||(q=new File([q],$)),[String(j),q]):[String(j),String(q)]},Be=function(j,q){if(j.length<q)throw new TypeError(q+" argument required, but only "+j.length+" present.")};B=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this;var yt=B.FormData,ve=B.XMLHttpRequest&&B.XMLHttpRequest.prototype.send,Ze=B.Request&&B.fetch,vt=B.navigator&&B.navigator.sendBeacon;P=B.Element&&B.Element.prototype;var Wt=B.Symbol&&Symbol.toStringTag;Wt&&(Blob.prototype[Wt]||(Blob.prototype[Wt]="Blob"),"File"in B&&!File.prototype[Wt]&&(File.prototype[Wt]="File"));try{new File([],"")}catch{B.File=function(q,$,he){return q=new Blob(q,he||{}),Object.defineProperties(q,{name:{value:$},lastModified:{value:+(he&&he.lastModified!==void 0?new Date(he.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),Wt&&Object.defineProperty(q,Wt,{value:"File"}),q}}var Nr=function(j){return j.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Pt=function(j){this.i=[];var q=this;j&&se(j.elements,function($){if($.name&&!$.disabled&&$.type!=="submit"&&$.type!=="button"&&!$.matches("form fieldset[disabled] *"))if($.type==="file"){var he=$.files&&$.files.length?$.files:[new File([],"",{type:"application/octet-stream"})];se(he,function(pe){q.append($.name,pe)})}else $.type==="select-multiple"||$.type==="select-one"?se($.options,function(pe){!pe.disabled&&pe.selected&&q.append($.name,pe.value)}):$.type==="checkbox"||$.type==="radio"?$.checked&&q.append($.name,$.value):(he=$.type==="textarea"?ge($.value):$.value,q.append($.name,he))})};if((S=Pt.prototype).append=function(j,q,$){Be(arguments,2),this.i.push(Le(j,q,$))},S.delete=function(j){Be(arguments,1);var q=[];j=String(j),se(this.i,function($){$[0]!==j&&q.push($)}),this.i=q},S.entries=function j(){var q,$=this;return _(j,function(he){if(he.h==1&&(q=0),he.h!=3)return q<$.i.length?he=A(he,$.i[q]):(he.h=0,he=void 0),he;q++,he.h=2})},S.forEach=function(j,q){Be(arguments,1);for(var $=c(this),he=$.next();!he.done;he=$.next()){var pe=c(he.value);he=pe.next().value,pe=pe.next().value,j.call(q,pe,he,this)}},S.get=function(j){Be(arguments,1);var q=this.i;j=String(j);for(var $=0;$<q.length;$++)if(q[$][0]===j)return q[$][1];return null},S.getAll=function(j){Be(arguments,1);var q=[];return j=String(j),se(this.i,function($){$[0]===j&&q.push($[1])}),q},S.has=function(j){Be(arguments,1),j=String(j);for(var q=0;q<this.i.length;q++)if(this.i[q][0]===j)return!0;return!1},S.keys=function j(){var q,$,he,pe,Pe=this;return _(j,function(_e){if(_e.h==1&&(q=c(Pe),$=q.next()),_e.h!=3)return $.done?void(_e.h=0):(he=$.value,pe=c(he),A(_e,pe.next().value));$=q.next(),_e.h=2})},S.set=function(j,q,$){Be(arguments,2),j=String(j);var he=[],pe=Le(j,q,$),Pe=!0;se(this.i,function(_e){_e[0]===j?Pe&&(Pe=!he.push(pe)):he.push(_e)}),Pe&&he.push(pe),this.i=he},S.values=function j(){var q,$,he,pe,Pe=this;return _(j,function(_e){if(_e.h==1&&(q=c(Pe),$=q.next()),_e.h!=3)return $.done?void(_e.h=0):(he=$.value,(pe=c(he)).next(),A(_e,pe.next().value));$=q.next(),_e.h=2})},Pt.prototype._asNative=function(){for(var j=new yt,q=c(this),$=q.next();!$.done;$=q.next()){var he=c($.value);$=he.next().value,he=he.next().value,j.append($,he)}return j},Pt.prototype._blob=function(){var j="----formdata-polyfill-"+Math.random(),q=[],$="--"+j+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(he,pe){return typeof he=="string"?q.push($+Nr(ge(pe))+`"\r
\r
`+ge(he)+`\r
`):q.push($+Nr(ge(pe))+'"; filename="'+Nr(he.name)+`"\r
Content-Type: `+(he.type||"application/octet-stream")+`\r
\r
`,he,`\r
`)}),q.push("--"+j+"--"),new Blob(q,{type:"multipart/form-data; boundary="+j})},Pt.prototype[Symbol.iterator]=function(){return this.entries()},Pt.prototype.toString=function(){return"[object FormData]"},P&&!P.matches&&(P.matches=P.matchesSelector||P.mozMatchesSelector||P.msMatchesSelector||P.oMatchesSelector||P.webkitMatchesSelector||function(j){for(var q=(j=(this.document||this.ownerDocument).querySelectorAll(j)).length;0<=--q&&j.item(q)!==this;);return-1<q}),Wt&&(Pt.prototype[Wt]="FormData"),ve){var en=B.XMLHttpRequest.prototype.setRequestHeader;B.XMLHttpRequest.prototype.setRequestHeader=function(j,q){en.call(this,j,q),j.toLowerCase()==="content-type"&&(this.B=!0)},B.XMLHttpRequest.prototype.send=function(j){j instanceof Pt?(j=j._blob(),this.B||this.setRequestHeader("Content-Type",j.type),ve.call(this,j)):ve.call(this,j)}}Ze&&(B.fetch=function(j,q){return q&&q.body&&q.body instanceof Pt&&(q.body=q.body._blob()),Ze.call(this,j,q)}),vt&&(B.navigator.sendBeacon=function(j,q){return q instanceof Pt&&(q=q._asNative()),vt.call(this,j,q)}),B.FormData=Pt}})();let lA=1,uA=1,X1=(i,r,s,c,u)=>{var h,A,f;const m=[];if(W(h=i.response_body).call(h,I=>{var E=I.buffer.code;E!==0&&(E=Eu(E),I={error:new L(D.CAN_NOT_GET_GATEWAY_SERVER,E.desc,{retry:E.retry,csIp:i.detail[502]}),flag:I.buffer.flag},m.push(I),I.flag===4096?z.joinChooseServer(s.sid,{lts:c,succ:!1,csAddr:r,opid:i.opid,serverList:null,ec:I.error.message,csIp:I.error.data&&I.error.data.csIp,unilbsServerIds:u.toString()}):I.flag!==1048576&&I.flag!==4194304||z.joinWebProxyAP(s.sid,{lts:c,sucess:0,apServerAddr:r,turnServerAddrList:null,errorCode:I.error.code,eventType:s.cloudProxyServer,unilbsServerIds:u.toString()}))}),m.length)throw R.warning(b(A=b(f="[".concat(s.clientId,"] multi unilbs ")).call(f,r," failed, ")).call(A,Ie(m).call(m,I=>{var E,_;return b(E=b(_="flag: ".concat(I.flag,", message: ")).call(_,I.error.message,", retry: ")).call(E,I.error.data.retry)}).join(" | "))),new L(D.CAN_NOT_GET_GATEWAY_SERVER,Ie(m).call(m,I=>{var E;return b(E="flag: ".concat(I.flag,", message: ")).call(E,I.error.message)}).join(" | "),{retry:!!Je(m).call(m,I=>I.error.data.retry),csIp:i.detail[502]})},Z1=i=>{if(i.addresses&&i.addresses.length===0&&i.code===0)throw new L(D.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:i.detail&&i.detail[502]});if(ne.GATEWAY_ADDRESS&&0<ne.GATEWAY_ADDRESS.length){var r;R.debug("assign gateway address to",ne.GATEWAY_ADDRESS);const s=Ie(r=ne.GATEWAY_ADDRESS).call(r,c=>({ip:c.ip,port:c.port,ticket:i.addresses[0]&&i.addresses[0].ticket}));i.addresses=s}},$1=(i,r,s)=>{var c;const u=Math.floor(1e12*Math.random());return r={appid:i.appId,client_ts:de(),opid:u,sid:i.sid,request_bodies:[{uri:22,buffer:{cname:i.cname,detail:{6:i.stringUid,11:r},key:i.token,service_ids:s,uid:i.uid||0}}]},W(c=r.request_bodies).call(c,h=>{i.multiIP&&i.multiIP.gateway_ip&&(h.buffer.detail[5]=fe({vocs_ip:[i.multiIP.uni_lbs_ip],vos_ip:[i.multiIP.gateway_ip]}))}),c=new FormData,c.append("request",fe(r)),[c,u]},ml=()=>{const i=ne.AREAS;return i.length===0&&i.push("GLOBAL"),Fu(i).call(i,(r,s,c)=>{var u,h,A,f,m;s=s==="OVERSEA"?b(u=b(h=b(A=b(f=b(m="".concat(Sr.ASIA,",")).call(m,Sr.EUROPE,",")).call(f,Sr.AFRICA,",")).call(A,Sr.NORTH_AMERICA,",")).call(h,Sr.SOUTH_AMERICA,",")).call(u,Sr.OCEANIA):Sr[s];var I;return s?c===0?s:b(I="".concat(r,",")).call(I,s):r},"")};var ud={ASIA:["CHINA","JAPAN","INDIA"],EUROPE:[],NORTH_AMERICA:[],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]};let nc=dt(ud),dd="CHINA NORTH_AMERICA EUROPE ASIA JAPAN INDIA OCEANIA SOUTH_AMERICA AFRICA".split(" "),tw=function(i,r){var s=[];if(gt(i).call(i,"GLOBAL")){s=["GLOBAL","OVERSEA"];const u=dt(wp);if(r==="GLOBAL")throw new L(D.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(r==="CHINA")s=["OVERSEA"];else if(c=r,gt(nc).call(nc,c)){i=ud[r]||[];const h=[...s,r,...i];s=Qe(u).call(u,A=>!gt(h).call(h,A))}else if(function(h){let A=!1;return W(nc).call(nc,f=>{var m;gt(m=ud[f]).call(m,h)&&(A=!0)}),A}(r)){i=function(A){let f;return W(nc).call(nc,m=>{var I;gt(I=ud[m]).call(I,A)&&(f=m)}),f}(r);const h=[...s,i,r];s=Qe(u).call(u,A=>!gt(h).call(h,A))}else s=i;s=function(h){const A=[];return W(dd).call(dd,f=>{gt(h).call(h,f)&&A.push(f)}),b(A).call(A,Qe(h).call(h,f=>!gt(dd).call(dd,f)))}(s)}else s=i;var c;return s};class rw extends Wr{constructor(){super();this.retryConfig={timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4},this.mutex=new Vo("config-distribute")}startGetConfigDistribute(r,s){this.joinInfo=r,this.cancelToken=s,this.interval&&this.stopGetConfigDistribute(),this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},ne.CONFIG_DISTRIBUTE_INTERVAL)}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.cancelToken=this.joinInfo=this.interval=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(!this.joinInfo||!this.cancelToken||!this.retryConfig)return void R.debug("[config-distribute] get config distribute interrupted have no joininfo");let r,s=await this.mutex.lock();try{r=await AS(this.joinInfo,this.cancelToken,this.retryConfig),R.debug("[config-distribute] get config distribute",fe(r)),r.limit_bitrate&&this.handleBitrateLimit(r.limit_bitrate),this.configs=r}catch(c){let u=new L(D.NETWORK_RESPONSE_ERROR,c);R.warning("[config-distribute] ".concat(u.toString()))}finally{s()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(r){r&&r.uplink&&r.id&&r.uplink.max_bitrate!==void 0&&r.uplink.min_bitrate!==void 0&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==r.id&&this.emit(cl.UPDATE_BITRATE_LIMIT,r):this.emit(cl.UPDATE_BITRATE_LIMIT,r))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&function(r){for(var s=1;s<arguments.length;s++){var c,u=arguments[s]!=null?arguments[s]:{};if(s%2)W(c=im(Object(u),!0)).call(c,function(A){gn(r,A,u[A])});else if(Ot)An(r,Ot(u));else{var h;W(h=im(Object(u))).call(h,function(A){ht(r,A,ct(u,A))})}}return r}({},this.configs.limit_bitrate.low_stream_uplink)}}var dA=function(){function i(r){this.input=[],this.size=r}return i.prototype.add=function(r){this.input.push(r),this.input.length>this.size&&this.input.splice(0,1)},i.prototype.diffMean=function(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length},i}(),eI=function(i,r){return(eI=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var u in c)c.hasOwnProperty(u)&&(s[u]=c[u])})(i,r)},hA=function(){return(hA=Object.assign||function(i){for(var r,s=1,c=arguments.length;s<c;s++)for(var u in r=arguments[s])Object.prototype.hasOwnProperty.call(r,u)&&(i[u]=r[u]);return i}).apply(this,arguments)},hs,vl={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[]},tI={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0},rI={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0},nI={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0},iI={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0},pA=function(){function i(r,s){var c=this;this.videoIsReady=!1,this.stats=Si(vl),this.isFirstAudioDecoded=this.isFirstAudioReceived=this.isFirstVideoDecoded=this.isFirstVideoReceived=!1,this.lossRateWindowStats=[],this.pc=r,this.options=s,this.intervalTimer=window.setInterval(function(){return bh(c,void 0,void 0,function(){return Dh(this,function(u){return this.updateStats(),[2]})})},this.options.updateInterval)}return i.prototype.getStats=function(){return this.stats},i.prototype.setVideoIsReady=function(r){this.videoIsReady=r},i.prototype.setIsFirstAudioDecoded=function(r){this.isFirstAudioDecoded=r},i.prototype.destroy=function(){window.clearInterval(this.intervalTimer),this.pc=void 0},i.prototype.calcLossRate=function(r){var s=this;this.lossRateWindowStats.push(r),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);for(var c=this.lossRateWindowStats.length,u=0,h=0,A=0,f=0,m=function(_){r[_].forEach(function(S,N){if(s.lossRateWindowStats[c-1][_][N]&&s.lossRateWindowStats[0][_][N]){var k=s.lossRateWindowStats[c-1][_][N].packets-s.lossRateWindowStats[0][_][N].packets;N=s.lossRateWindowStats[c-1][_][N].packetsLost-s.lossRateWindowStats[0][_][N].packetsLost,_==="videoSend"||_==="audioSend"?(u+=k,A+=N):(h+=k,f+=N),Number.isNaN(k)||Number.isNaN(k)?S.packetLostRate=0:S.packetLostRate=0>=k||0>=N?0:N/(k+N)}})},I=0,E=["videoSend","audioSend","videoRecv","audioRecv"];I<E.length;I++)m(E[I]);r.sendPacketLossRate=0>=u||0>=A?0:A/(u+A),r.recvPacketLossRate=0>=h||0>=f?0:f/(h+f)},i}(),nw=function(i){function r(){var s=i!==null&&i.apply(this,arguments)||this;return s._stats=vl,s.lastDecodeVideoReceiverStats=new Map,s}return Oh(r,i),r.prototype.updateStats=function(){return bh(this,void 0,void 0,function(){var s,c,u,h;return Dh(this,function(A){switch(A.label){case 0:return[4,this._getStats()];case 1:return s=A.sent(),c=this.statsResponsesToObjects(s),this._stats=Si(vl),u=c.filter(function(f){return f.type==="ssrc"}),this.processSSRCStats(u),(h=c.find(function(f){return f.type==="VideoBwe"}))&&this.processBandwidthStats(h),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats,[2]}})})},r.prototype.processBandwidthStats=function(s){this._stats.bitrate={actualEncoded:Number(s.googActualEncBitrate),targetEncoded:Number(s.googTargetEncBitrate),retransmit:Number(s.googRetransmitBitrate),transmit:Number(s.googTransmitBitrate)},this._stats.sendBandwidth=Number(s.googAvailableSendBandwidth)},r.prototype.processSSRCStats=function(s){var c=this;s.forEach(function(u){var h=u.id.includes("send");switch(u.mediaType+"_"+(h?"send":"recv")){case"video_send":h=Si(rI),h.codec=u.googCodecName,h.adaptionChangeReason="none",u.googCpuLimitedResolution&&(h.adaptionChangeReason="cpu"),u.googBandwidthLimitedResolution&&(h.adaptionChangeReason="bandwidth"),h.avgEncodeMs=Number(u.googAvgEncodeMs),h.inputFrame={width:Number(u.googFrameWidthInput)||Number(u.googFrameWidthSent),height:Number(u.googFrameHeightInput)||Number(u.googFrameHeightSent),frameRate:Number(u.googFrameRateInput)},h.sentFrame={width:Number(u.googFrameWidthSent),height:Number(u.googFrameHeightSent),frameRate:Number(u.googFrameRateInput)},h.firsCount=Number(u.googFirReceived),h.nacksCount=Number(u.googNacksReceived),h.plisCount=Number(u.googPlisReceived),h.frameCount=Number(u.framesEncoded),h.bytes=Number(u.bytesSent),h.packets=Number(u.packetsSent),h.packetsLost=Number(u.packetsLost),h.ssrc=Number(u.ssrc),h.rttMs=Number(u.googRtt||0),c._stats.videoSend.push(h),c._stats.rtt=h.rttMs;break;case"video_recv":h=Si(tI);var A=c.lastDecodeVideoReceiverStats.get(Number(u.ssrc));if(h.codec=u.googCodecName,h.targetDelayMs=Number(u.googTargetDelayMs),h.renderDelayMs=Number(u.googRenderDelayMs),h.currentDelayMs=Number(u.googCurrentDelayMs),h.minPlayoutDelayMs=Number(u.googMinPlayoutDelayMs),h.decodeMs=Number(u.googDecodeMs),h.maxDecodeMs=Number(u.googMaxDecodeMs),h.receivedFrame={width:Number(u.googFrameWidthReceived),height:Number(u.googFrameHeightReceived),frameRate:Number(u.googFrameRateReceived)},h.decodedFrame={width:Number(u.googFrameWidthReceived),height:Number(u.googFrameHeightReceived),frameRate:Number(u.googFrameRateDecoded)},h.outputFrame={width:Number(u.googFrameWidthReceived),height:Number(u.googFrameHeightReceived),frameRate:Number(u.googFrameRateOutput)},h.jitterBufferMs=Number(u.googJitterBufferMs),h.firsCount=Number(u.googFirsSent),h.nacksCount=Number(u.googNacksSent),h.plisCount=Number(u.googPlisSent),h.framesDecodeCount=Number(u.framesDecoded),h.bytes=Number(u.bytesReceived),h.packets=Number(u.packetsReceived),h.packetsLost=Number(u.packetsLost),h.ssrc=Number(u.ssrc),0<h.packets&&!c.isFirstVideoReceived&&(c.onFirstVideoReceived&&c.onFirstVideoReceived(),c.isFirstVideoReceived=!0),0<h.framesDecodeCount&&!c.isFirstVideoDecoded&&(c.onFirstVideoDecoded&&c.onFirstVideoDecoded(h.decodedFrame.width,h.decodedFrame.height),c.isFirstVideoDecoded=!0),A){u=A.stats;var f=Date.now()-A.lts;h.framesDecodeFreezeTime=u.framesDecodeFreezeTime,h.framesDecodeInterval=u.framesDecodeInterval,h.framesDecodeCount>u.framesDecodeCount&&c.isFirstVideoDecoded?(A.lts=Date.now(),h.framesDecodeInterval=f,h.framesDecodeInterval>=c.options.freezeRateLimit&&(c.videoIsReady?h.framesDecodeFreezeTime+=h.framesDecodeInterval:c.setVideoIsReady(!0))):h.framesDecodeCount<A.stats.framesDecodeCount&&(h.framesDecodeInterval=0)}c.lastDecodeVideoReceiverStats.set(h.ssrc,{stats:hA({},h),lts:Date.now()}),c._stats.videoRecv.push(h);break;case"audio_recv":h=Si(iI),h.codec=u.googCodecName,h.outputLevel=Math.abs(Number(u.audioOutputLevel))/32767,h.decodingCNG=Number(u.googDecodingCNG),h.decodingCTN=Number(u.googDecodingCTN),h.decodingCTSG=Number(u.googDecodingCTSG),h.decodingNormal=Number(u.googDecodingNormal),h.decodingPLC=Number(u.googDecodingPLC),h.decodingPLCCNG=Number(u.googDecodingPLCCNG),h.expandRate=Number(u.googExpandRate),h.accelerateRate=Number(u.googAccelerateRate),h.preemptiveExpandRate=Number(u.googPreemptiveExpandRate),h.secondaryDecodedRate=Number(u.googSecondaryDecodedRate),h.speechExpandRate=Number(u.googSpeechExpandRate),h.preferredJitterBufferMs=Number(u.googPreferredJitterBufferMs),h.jitterBufferMs=Number(u.googJitterBufferMs),h.jitterMs=Number(u.googJitterReceived),h.bytes=Number(u.bytesReceived),h.packets=Number(u.packetsReceived),h.packetsLost=Number(u.packetsLost),h.ssrc=Number(u.ssrc),h.receivedFrames=Number(u.googDecodingCTN)||Number(u.packetsReceived),h.droppedFrames=Number(u.googDecodingPLC)+Number(u.googDecodingPLCCNG)||Number(u.packetsLost),0<h.receivedFrames&&!c.isFirstAudioReceived&&(c.onFirstAudioReceived&&c.onFirstAudioReceived(),c.isFirstAudioReceived=!0),0<h.decodingNormal&&!c.isFirstAudioDecoded&&(c.onFirstAudioDecoded&&c.onFirstAudioDecoded(),c.isFirstAudioDecoded=!0),c._stats.audioRecv.push(h);break;case"audio_send":h=Si(nI),h.codec=u.googCodecName,h.inputLevel=Math.abs(Number(u.audioInputLevel))/32767,h.aecReturnLoss=Number(u.googEchoCancellationReturnLoss||0),h.aecReturnLossEnhancement=Number(u.googEchoCancellationReturnLossEnhancement||0),h.residualEchoLikelihood=Number(u.googResidualEchoLikelihood||0),h.residualEchoLikelihoodRecentMax=Number(u.googResidualEchoLikelihoodRecentMax||0),h.bytes=Number(u.bytesSent),h.packets=Number(u.packetsSent),h.packetsLost=Number(u.packetsLost),h.ssrc=Number(u.ssrc),h.rttMs=Number(u.googRtt||0),c._stats.rtt=h.rttMs,c._stats.audioSend.push(h)}})},r.prototype._getStats=function(){var s=this;return new Promise(function(c,u){s.pc.getStats(c,u)})},r.prototype.statsResponsesToObjects=function(s){var c=[];return s.result().forEach(function(u){var h={id:u.id,timestamp:u.timestamp.valueOf().toString(),type:u.type};u.names().forEach(function(A){h[A]=u.stat(A)}),c.push(h)}),c},r}(pA);(function(i){i.CERTIFICATE="certificate",i.CODEC="codec",i.CANDIDATE_PAIR="candidate-pair",i.LOCAL_CANDIDATE="local-candidate",i.REMOTE_CANDIDATE="remote-candidate",i.INBOUND="inbound-rtp",i.TRACK="track",i.OUTBOUND="outbound-rtp",i.PC="peer-connection",i.REMOTE_INBOUND="remote-inbound-rtp",i.REMOTE_OUTBOUND="remote-outbound-rtp",i.TRANSPORT="transport",i.CSRC="csrc",i.DATA_CHANNEL="data-channel",i.STREAM="stream",i.SENDER="sender",i.RECEIVER="receiver"})(hs||(hs={}));var oI=function(i){function r(){var s=i!==null&&i.apply(this,arguments)||this;return s._stats=vl,s.lastDecodeVideoReceiverStats=new Map,s.lastVideoFramesRecv=new Map,s.lastVideoFramesSent=new Map,s.lastVideoFramesDecode=new Map,s.lastVideoJBDelay=new Map,s.lastAudioJBDelay=new Map,s.mediaBytesSent=new Map,s.mediaBytesRetransmit=new Map,s.mediaBytesTargetEncode=new Map,s.lastEncoderMs=new Map,s}return Oh(r,i),r.prototype.updateStats=function(){return bh(this,void 0,void 0,function(){var s,c=this;return Dh(this,function(u){switch(u.label){case 0:return s=this,[4,this.pc.getStats()];case 1:return s.report=u.sent(),this._stats=Si(vl),this.report.forEach(function(h){switch(h.type){case hs.OUTBOUND:h.mediaType==="audio"?c.processAudioOutboundStats(h):h.mediaType==="video"&&c.processVideoOutboundStats(h);break;case hs.INBOUND:h.mediaType==="audio"?c.processAudioInboundStats(h):h.mediaType==="video"&&c.processVideoInboundStats(h);break;case hs.TRANSPORT:(h=c.report.get(h.selectedCandidatePairId))&&c.processCandidatePairStats(h);break;case hs.CANDIDATE_PAIR:h.selected&&c.processCandidatePairStats(h)}}),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats,[2]}})})},r.prototype.processCandidatePairStats=function(s){this._stats.sendBandwidth=s.availableOutgoingBitrate||0,s.currentRoundTripTime&&(this._stats.rtt=1e3*s.currentRoundTripTime),this._stats.videoSend.forEach(function(c){!c.rttMs&&s.currentRoundTripTime&&(c.rttMs=1e3*s.currentRoundTripTime)}),this._stats.audioSend.forEach(function(c){!c.rttMs&&s.currentRoundTripTime&&(c.rttMs=1e3*s.currentRoundTripTime)})},r.prototype.processAudioInboundStats=function(s){var c=this._stats.audioRecv.find(function(u){return u.ssrc===s.ssrc});c||(c=Si(iI),this._stats.audioRecv.push(c)),c.ssrc=s.ssrc,c.packets=s.packetsReceived,c.packetsLost=s.packetsLost,c.bytes=s.bytesReceived,c.jitterMs=1e3*s.jitter,s.trackId&&this.processAudioTrackReceiverStats(s.trackId,c),s.codecId&&(c.codec=this.getCodecFromCodecStats(s.codecId)),c.receivedFrames||(c.receivedFrames=s.packetsReceived),c.droppedFrames||(c.droppedFrames=s.packetsLost),0<c.receivedFrames&&!this.isFirstAudioReceived&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(),this.isFirstAudioReceived=!0),c.outputLevel&&0<c.outputLevel&&!this.isFirstAudioDecoded&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(),this.isFirstAudioDecoded=!0)},r.prototype.processVideoInboundStats=function(s){var c=this._stats.videoRecv.find(function(I){return I.ssrc===s.ssrc});c||(c=Si(tI),this._stats.videoRecv.push(c)),c.ssrc=s.ssrc,c.packets=s.packetsReceived,c.packetsLost=s.packetsLost,c.bytes=s.bytesReceived,c.firsCount=s.firCount,c.nacksCount=s.nackCount,c.plisCount=s.pliCount,c.framesDecodeCount=s.framesDecoded;var u=this.lastDecodeVideoReceiverStats.get(c.ssrc),h=this.lastVideoFramesDecode.get(c.ssrc),A=Date.now();if(0<c.framesDecodeCount&&!this.isFirstVideoDecoded){var f=c.decodedFrame?c.decodedFrame.width:0,m=c.decodedFrame?c.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(f,m),this.isFirstVideoDecoded=!0}u&&(f=u.stats,m=A-u.lts,c.framesDecodeFreezeTime=f.framesDecodeFreezeTime,c.framesDecodeInterval=f.framesDecodeInterval,c.framesDecodeCount>f.framesDecodeCount&&this.isFirstVideoDecoded?(u.lts=Date.now(),c.framesDecodeInterval=m,c.framesDecodeInterval>=this.options.freezeRateLimit&&(this.videoIsReady?c.framesDecodeFreezeTime+=c.framesDecodeInterval:this.setVideoIsReady(!0))):c.framesDecodeCount<f.framesDecodeCount&&(c.framesDecodeInterval=0)),h&&800<=A-h.lts?(c.decodeFrameRate=Math.round((c.framesDecodeCount-h.count)/((A-h.lts)/1e3)),this.lastVideoFramesDecode.set(c.ssrc,{count:c.framesDecodeCount,lts:A,rate:c.decodeFrameRate})):h?c.decodeFrameRate=h.rate:this.lastVideoFramesDecode.set(c.ssrc,{count:c.framesDecodeCount,lts:A,rate:0}),s.totalDecodeTime&&(c.decodeMs=1e3*s.totalDecodeTime),s.trackId&&this.processVideoTrackReceiverStats(s.trackId,c),s.codecId&&(c.codec=this.getCodecFromCodecStats(s.codecId)),s.framerateMean&&(c.framesRateFirefox=s.framerateMean),0<c.packets&&!this.isFirstVideoReceived&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(),this.isFirstVideoReceived=!0),this.lastDecodeVideoReceiverStats.set(c.ssrc,{stats:hA({},c),lts:u?u.lts:Date.now()})},r.prototype.processVideoOutboundStats=function(s){var c=this._stats.videoSend.find(function(A){return A.ssrc===s.ssrc});c||(c=Si(rI),this._stats.videoSend.push(c));var u=this.mediaBytesSent.get(s.ssrc);if(u?u.add(s.bytesSent):((h=new dA(10)).add(s.bytesSent),this.mediaBytesSent.set(s.ssrc,h)),s.retransmittedBytesSent!==void 0&&((u=this.mediaBytesRetransmit.get(s.ssrc))?u.add(s.retransmittedBytesSent):((h=new dA(10)).add(s.retransmittedBytesSent),this.mediaBytesRetransmit.set(s.ssrc,h))),s.totalEncodedBytesTarget){var h;(u=this.mediaBytesTargetEncode.get(s.ssrc))?u.add(s.totalEncodedBytesTarget):((h=new dA(10)).add(s.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(s.ssrc,h))}c.ssrc=s.ssrc,c.bytes=s.bytesSent,c.packets=s.packetsSent,c.firsCount=s.firCount,c.nacksCount=s.nackCount,c.plisCount=s.pliCount,c.frameCount=s.framesEncoded,c.adaptionChangeReason=s.qualityLimitationReason,s.totalEncodeTime&&s.framesEncoded&&(u=this.lastEncoderMs.get(s.ssrc),c.avgEncodeMs=!u||u.lastFrameCount>s.framesEncoded?1e3*s.totalEncodeTime/s.framesEncoded:1e3*(s.totalEncodeTime-u.lastEncoderTime)/(s.framesEncoded-u.lastFrameCount),this.lastEncoderMs.set(s.ssrc,{lastFrameCount:s.framesEncoded,lastEncoderTime:s.totalEncodeTime,lts:Date.now()})),s.codecId&&(c.codec=this.getCodecFromCodecStats(s.codecId)),s.mediaSourceId&&this.processVideoMediaSource(s.mediaSourceId,c),s.trackId&&this.processVideoTrackSenderStats(s.trackId,c),s.remoteId?this.processRemoteInboundStats(s.remoteId,c):(u=this.findRemoteStatsId(s.ssrc,hs.REMOTE_INBOUND))&&this.processRemoteInboundStats(u,c)},r.prototype.processAudioOutboundStats=function(s){var c=this._stats.audioSend.find(function(h){return h.ssrc===s.ssrc});if(c||(c=Si(nI),this._stats.audioSend.push(c)),c.ssrc=s.ssrc,c.packets=s.packetsSent,c.bytes=s.bytesSent,s.mediaSourceId&&this.processAudioMediaSource(s.mediaSourceId,c),s.codecId&&(c.codec=this.getCodecFromCodecStats(s.codecId)),s.trackId&&this.processAudioTrackSenderStats(s.trackId,c),s.remoteId)this.processRemoteInboundStats(s.remoteId,c);else{var u=this.findRemoteStatsId(s.ssrc,hs.REMOTE_INBOUND);u&&this.processRemoteInboundStats(u,c)}},r.prototype.findRemoteStatsId=function(s,c){var u=Array.from(this.report.values()).find(function(h){return h.type===c&&h.ssrc===s});return u?u.id:null},r.prototype.processVideoMediaSource=function(s,c){(s=this.report.get(s))&&s.width&&s.height&&s.framesPerSecond&&(c.inputFrame={width:s.width,height:s.height,frameRate:s.framesPerSecond})},r.prototype.processAudioMediaSource=function(s,c){(s=this.report.get(s))&&(c.inputLevel=s.audioLevel)},r.prototype.processVideoTrackSenderStats=function(s,c){if(s=this.report.get(s)){var u=0,h=Date.now(),A=this.lastVideoFramesSent.get(c.ssrc);A&&800<=h-A.lts?(u=Math.round((s.framesSent-A.count)/((h-A.lts)/1e3)),this.lastVideoFramesSent.set(c.ssrc,{count:s.framesSent,lts:h,rate:u})):A?u=A.rate:this.lastVideoFramesSent.set(c.ssrc,{count:s.framesSent,lts:h,rate:0}),c.sentFrame={width:s.frameWidth,height:s.frameHeight,frameRate:u}}},r.prototype.processVideoTrackReceiverStats=function(s,c){if(s=this.report.get(s)){var u=this.lastVideoFramesRecv.get(c.ssrc),h=Date.now();c.framesReceivedCount=s.framesReceived;var A=0;u&&800<=h-u.lts?(A=Math.round((s.framesReceived-u.count)/((h-u.lts)/1e3)),this.lastVideoFramesRecv.set(c.ssrc,{count:s.framesReceived,lts:h,rate:A})):u?A=u.rate:this.lastVideoFramesRecv.set(c.ssrc,{count:s.framesReceived,lts:h,rate:0}),c.receivedFrame={width:s.frameWidth||0,height:s.frameHeight||0,frameRate:A||0},c.decodedFrame={width:s.frameWidth||0,height:s.frameHeight||0,frameRate:c.decodeFrameRate||0},c.outputFrame={width:s.frameWidth||0,height:s.frameHeight||0,frameRate:c.decodeFrameRate||0},s.jitterBufferDelay&&s.jitterBufferEmittedCount&&(u=this.lastVideoJBDelay.get(c.ssrc),this.lastVideoJBDelay.set(c.ssrc,{jitterBufferDelay:s.jitterBufferDelay,jitterBufferEmittedCount:s.jitterBufferEmittedCount}),u||(u={jitterBufferDelay:0,jitterBufferEmittedCount:0}),s=1e3*(s.jitterBufferDelay-u.jitterBufferDelay)/(s.jitterBufferEmittedCount-u.jitterBufferEmittedCount),c.jitterBufferMs=s,c.currentDelayMs=Math.round(s))}},r.prototype.processAudioTrackSenderStats=function(s,c){(s=this.report.get(s))&&(c.aecReturnLoss=s.echoReturnLoss||0,c.aecReturnLossEnhancement=s.echoReturnLossEnhancement||0)},r.prototype.processAudioTrackReceiverStats=function(s,c){if(s=this.report.get(s)){if(s.removedSamplesForAcceleration&&s.totalSamplesReceived&&(c.accelerateRate=s.removedSamplesForAcceleration/s.totalSamplesReceived),s.jitterBufferDelay&&s.jitterBufferEmittedCount){var u=this.lastAudioJBDelay.get(c.ssrc);this.lastAudioJBDelay.set(c.ssrc,{jitterBufferDelay:s.jitterBufferDelay,jitterBufferEmittedCount:s.jitterBufferEmittedCount}),u||(u={jitterBufferDelay:0,jitterBufferEmittedCount:0}),c.jitterBufferMs=Math.round(1e3*(s.jitterBufferDelay-u.jitterBufferDelay)/(s.jitterBufferEmittedCount-u.jitterBufferEmittedCount))}c.outputLevel=s.audioLevel,u=1920,s.totalSamplesDuration&&s.totalSamplesReceived&&(u=s.totalSamplesReceived/s.totalSamplesDuration/50,c.receivedFrames=Math.round(s.totalSamplesReceived/u)),s.concealedSamples&&(c.droppedFrames=Math.round(s.concealedSamples/u))}},r.prototype.processRemoteInboundStats=function(s,c){(s=this.report.get(s))&&(c.packetsLost=s.packetsLost,s.roundTripTime&&(c.rttMs=1e3*s.roundTripTime))},r.prototype.getCodecFromCodecStats=function(s){return s=this.report.get(s),s&&(s=s.mimeType.match(/\/(.*)$/))&&s[1]?s[1]:""},r.prototype.updateSendBitrate=function(){var s=0,c=null,u=null;this.mediaBytesSent.forEach(function(h){s+=h.diffMean()}),this.mediaBytesRetransmit.forEach(function(h){c=c===null?h.diffMean():c+h.diffMean()}),this.mediaBytesTargetEncode.forEach(function(h){u=u===null?h.diffMean():u+h.diffMean()}),this._stats.bitrate={actualEncoded:8*(c!==null?s-c:s)/(this.options.updateInterval/1e3),transmit:8*s/(this.options.updateInterval/1e3)},c!==null&&(this._stats.bitrate.retransmit=8*c/(this.options.updateInterval/1e3)),u!==null&&(this._stats.bitrate.targetEncoded=8*u/(this.options.updateInterval/1e3))},r}(pA),iw=function(i){function r(){return i!==null&&i.apply(this,arguments)||this}return Oh(r,i),r.prototype.updateStats=function(){return Promise.resolve()},r}(pA);class sI{constructor(r){this.localCandidateCount=0,this.allCandidateReceived=!1,this.videoTrack=this.audioTrack=null,this.mediaStream=new MediaStream,this.ID=lI,lI+=1,this.spec=r,this.createPeerConnection(),r=this.pc;var s=void 0,c=void 0,u=Xt()?1200:void 0;s===void 0&&(s=250),c===void 0&&(c=8),u===void 0&&(u=500);var h,A=(h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i))&&h[0]?Number(h[0].split("/")[1]):null;this.statsFilter=A?76>A?new nw(r,{updateInterval:s,lossRateInterval:c,freezeRateLimit:u}):new oI(r,{updateInterval:s,lossRateInterval:c,freezeRateLimit:u}):window.RTCStatsReport&&r.getStats()instanceof Promise?new oI(r,{updateInterval:s,lossRateInterval:c,freezeRateLimit:u}):new iw(r,{updateInterval:s,lossRateInterval:c,freezeRateLimit:u})}get _statsFilter(){return this.statsFilter}getStats(){return this.statsFilter.getStats()}async createOfferSDP(){try{let r=await this.pc.createOffer(this.offerOptions);if(!r.sdp)throw Error("offer sdp is empty");return r.sdp}catch(r){throw R.error("create offer error:",r.toString()),new L(D.CREATE_OFFER_FAILED,r.toString())}}async setOfferSDP(r){try{await this.pc.setLocalDescription({type:"offer",sdp:r})}catch(s){throw R.error("set local offer error",s.toString()),new L(D.CREATE_OFFER_FAILED,s.toString())}}async setAnswerSDP(r){try{await this.pc.setRemoteDescription({type:"answer",sdp:r})}catch(s){if(s.name!=="InvalidStateError"||this.pc.signalingState!=="stable")throw R.error("set remote answer error",s.toString()),new L(D.SET_ANSWER_FAILED,s.toString());R.debug("[pc-".concat(this.ID,"] ignore invalidstate error"))}}close(){this.onConnectionStateChange=this.onICEConnectionStateChange=void 0;try{this.pc.oniceconnectionstatechange=null,this.pc.onconnectionstatechange=null,this.pc.onsignalingstatechange=null,this.pc.onicecandidateerror=null,this.pc.onicecandidate=null,this.pc.close(),this.pc=null,this.videoTransceiver=this.audioTransceiver=void 0}catch{}this.statsFilter.destroy()}createPeerConnection(){let r={iceServers:[]},s=h=>{const A=[];return W(h).call(h,f=>{if(f.security){var m;f.tcpport&&A.push({username:f.username,credential:f.password,credentialType:"password",urls:b(m="turns:".concat((_=f.turnServerURL,_.match(/^[\.:\d]+$/)?"".concat(_.replace(/[^\d]/g,"-"),".edge.agora.io"):(R.info("Cannot recognized as IP address ".concat(_,". Used As Host instead")),_)),":")).call(m,f.tcpport,"?transport=tcp")})}else{var I,E;f.udpport&&A.push({username:f.username,credential:f.password,credentialType:"password",urls:b(I="turn:".concat(f.turnServerURL,":")).call(I,f.udpport,"?transport=udp")}),f.tcpport&&A.push({username:f.username,credential:f.password,credentialType:"password",urls:b(E="turn:".concat(f.turnServerURL,":")).call(E,f.tcpport,"?transport=tcp")})}var _}),A};var c,u;this.spec.iceServers?r.iceServers=this.spec.iceServers:this.spec.turnServer&&this.spec.turnServer.mode!=="off"&&(Og(this.spec.turnServer.servers)?r.iceServers=this.spec.turnServer.servers:(r.iceServers&&r.iceServers.push(...s(this.spec.turnServer.servers)),r.iceServers&&this.spec.turnServer.serversFromGateway&&r.iceServers.push(...s(this.spec.turnServer.serversFromGateway)),W(c=b(u=this.spec.turnServer.servers).call(u,this.spec.turnServer.serversFromGateway||[])).call(c,h=>{h.forceturn&&(r.iceTransportPolicy="relay")}))),ne.CHROME_FORCE_PLAN_B&&ts()&&(r.sdpSemantics="plan-b",kt.supportUnifiedPlan=!1),this.pc=new RTCPeerConnection(r,{optional:[{googDscp:!0}]}),this.pc.oniceconnectionstatechange=()=>{this.onICEConnectionStateChange&&this.onICEConnectionStateChange(this.pc.iceConnectionState)},this.pc.onconnectionstatechange=()=>{this.onConnectionStateChange&&this.onConnectionStateChange(this.pc.connectionState)},this.pc.onsignalingstatechange=()=>{this.pc&&this.pc.connectionState==="closed"&&this.onConnectionStateChange&&this.onConnectionStateChange(this.pc.connectionState)},this.pc.onicecandidate=h=>{if(!h.candidate)return this.pc.onicecandidate=null,this.allCandidateReceived=!0,void R.debug("[pc-".concat(this.ID,"] local candidate count"),this.localCandidateCount);this.localCandidateCount+=1},ai(()=>{this.allCandidateReceived||(this.allCandidateReceived=!0,R.debug("[pc-".concat(this.ID,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},ne.CANDIDATE_TIMEOUT)}}class aI extends sI{constructor(r){super(r)}async setOfferSDP(r){let s=ne.CUSTOM_PUB_OFFER_MODIFIER;return s&&(r=s(r)),await super.setOfferSDP(r)}async setAnswerSDP(r){let s=ne.CUSTOM_PUB_ANSWER_MODIFIER;return s&&(r=s(r)),await super.setAnswerSDP(r)}getAnswerSDP(){return this.pc.remoteDescription}getOfferSDP(){return this.pc.localDescription}async addStream(r){r=r.getTracks();for(let s of r)await this.addTrack(s)}async replaceTrack(r){if(!kt.supportReplaceTrack){var s=r.kind==="audio"?this.audioTrack:this.videoTrack;if(!s)throw new L(D.UNEXPECTED_ERROR,"can not find replaced track");return await this.removeTrack(s),await this.addTrack(r),!0}let c=this.getSender(r.kind),u=Je(s=this.mediaStream.getTracks()).call(s,h=>h.kind===r.kind);u&&this.mediaStream.removeTrack(u),this.mediaStream.addTrack(r);try{await c.replaceTrack(r),r.kind==="audio"?this.audioTrack=r:this.videoTrack=r}catch(h){throw new L(D.SENDER_REPLACE_FAILED,h.toString())}return!1}async removeTrack(r){let s=this.getSender(r.kind);this.mediaStream.removeTrack(r);try{let c=Ye();c.name==="Safari"&&c.version==="11"&&await s.replaceTrack(null),this.pc.removeTrack(s)}catch(c){R.warning("[pc-".concat(this.ID,"] remove track error, ignore"),c)}r.kind==="audio"?(this.audioTrack=null,this.audioSender=void 0,this.audioTransceiver&&(this.audioTransceiver.direction="inactive"),this.audioTransceiver=void 0):(this.videoTrack=null,this.videoSender=void 0,this.videoTransceiver&&(this.videoTransceiver.direction="inactive"),this.videoTransceiver=void 0)}onOfferSettled({videoActive:r,audioActive:s}){if(Xt())R.debug("firefox do not set sender parameter");else{if(this.audioSender){let c={networkQuality:void 0,active:!0};ne.DSCP_TYPE&&(c.networkQuality=ne.DSCP_TYPE),this.audioTrack&&(c.active=!!s),this.setAudioRtpEncodingParameters(c).catch(u=>{R.debug("set audio sender`s network priority failed")})}this.videoSender&&(s={networkQuality:void 0,active:!0},ne.DSCP_TYPE&&(s.networkQuality=ne.DSCP_TYPE),this.videoTrack&&(s.active=!!r),this.setVideoRtpEncodingParameters(s).catch(c=>{R.debug("set video sender`s network priority failed")}))}}async addTrack(r){let s=kt;if(r.kind==="audio"&&this.audioTrack||r.kind==="video"&&this.videoTrack)throw new L(D.UNEXPECTED_ERROR,"Can't add multiple stream");let c,u;this.mediaStream.addTrack(r),s.supportUnifiedPlan?(c=await async function(h,A,f){var m;let I=Je(m=h.getTransceivers()).call(m,E=>E.direction==="inactive"&&E.receiver.track.kind===A.kind);return I?(I.direction="sendrecv",await I.sender.replaceTrack(A),I):h.addTransceiver(A,{direction:"sendrecv",streams:[f]})}(this.pc,r,this.mediaStream),u=c.sender):u=this.pc.addTrack(r,this.mediaStream),r.kind==="audio"?(this.audioTrack=r,this.audioSender=u,this.audioTransceiver=c):(this.videoTrack=r,this.videoSender=u,this.videoTransceiver=c)}async setRtpSenderParameters(r,s){if(r=this.videoSender||(this.videoTransceiver?this.videoTransceiver.sender:void 0)){var c=r.getParameters();c.degradationPreference=s;try{await r.setParameters(c)}catch(u){R.debug("[".concat(this.ID,"] ignore RtpSender.setParameters"),u.toString())}}}async setVideoRtpEncodingParameters(r){let s=this.videoSender||(this.videoTransceiver?this.videoTransceiver.sender:void 0);if(!s)throw new L(D.LOW_STREAM_ENCODING_ERROR,"Low stream has no video sender.");let c=s.getParameters();if(!c.encodings||!c.encodings[0])throw new L(D.LOW_STREAM_ENCODING_ERROR,"Low stream RtpEncodingParameters is empty.");r.scaleResolutionDownBy&&(c.encodings[0].scaleResolutionDownBy=r.scaleResolutionDownBy),r.maxBitrate&&(c.encodings[0].maxBitrate=r.maxBitrate),r.maxFramerate&&(c.encodings[0].maxFramerate=r.maxFramerate),r.active!==void 0&&(R.debug("set video sender encoding active:",r.active),c.encodings[0].active=r.active);let u=["very-low","low","medium","high"];return r.networkPriority&&gt(u).call(u,r.networkPriority)&&(R.debug("set video sender network quality:",r.networkPriority),c.encodings[0].networkPriority=r.networkPriority),await s.setParameters(c),s.getParameters()}async setAudioRtpEncodingParameters(r){let s=this.audioSender||(this.audioTransceiver?this.audioTransceiver.sender:void 0);if(!s)throw new L(D.SET_ENCODING_PARAMETER_ERROR,"pc has no audio sender.");let c=s.getParameters();if(!c.encodings||!c.encodings[0])throw new L(D.SET_ENCODING_PARAMETER_ERROR,"pc RtpEncodingParameters is empty.");r.active!==void 0&&(R.debug("set audio sender encoding active:",r.active),c.encodings[0].active=r.active);let u=["very-low","low","medium","high"];return r.networkPriority&&gt(u).call(u,r.networkPriority)&&(R.debug("set audio sender network quality:",r.networkPriority),c.encodings[0].networkPriority=r.networkPriority),await s.setParameters(c),s.getParameters()}getSender(r){var s=null;if(kt.supportUnifiedPlan){var c;s=(s=Je(c=this.pc.getTransceivers()).call(c,h=>h.sender.track&&h.sender.track.kind===r))?s.sender:null}else{var u;s=Je(u=this.pc.getSenders()).call(u,h=>h.track&&h.track.kind===r)||null}if(!s)throw new L(D.SENDER_NOT_FOUND);return s}close(){this.videoSender=this.audioSender=void 0,super.close()}}class cI extends sI{constructor(r){super(r);this.statsFilter.onFirstAudioDecoded=()=>this.onFirstAudioDecoded&&this.onFirstAudioDecoded(),this.statsFilter.onFirstVideoDecoded=(s,c)=>this.onFirstVideoDecoded&&this.onFirstVideoDecoded(s,c),this.statsFilter.onFirstAudioReceived=()=>this.onFirstAudioReceived&&this.onFirstAudioReceived(),this.statsFilter.onFirstVideoReceived=()=>this.onFirstVideoReceived&&this.onFirstVideoReceived(),kt.supportUnifiedPlan?(this.audioTransceiver=this.pc.addTransceiver("audio",{direction:"recvonly"}),this.videoTransceiver=this.pc.addTransceiver("video",{direction:"recvonly"})):this.offerOptions={offerToReceiveAudio:!0,offerToReceiveVideo:!0},this.pc.ontrack=s=>{s.track.kind==="audio"?this.audioTrack=s.track:this.videoTrack=s.track,this.onTrack&&this.onTrack(s.track,s.streams[0])}}async setOfferSDP(r){let s=ne.CUSTOM_SUB_OFFER_MODIFIER;return s&&(r=s(r)),await super.setOfferSDP(r)}async setAnswerSDP(r){let s=ne.CUSTOM_SUB_ANSWER_MODIFIER;return s&&(r=s(r)),await super.setAnswerSDP(r)}}let lI=1,uI=1;class dI extends Wr{constructor(r,s){super();this.startTime=de(),this.createTime=de(),this.readyToReconnect=!1,this._connectionState="disconnected",this.currentReconnectCount=0,this.ID=uI,uI+=1,this.joinInfo=r,this._userId=s,this.createPC()}get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this.emit(De.CONNECTION_STATE_CHANGE,r,this._connectionState),this._connectionState=r)}get connectionId(){var r,s;return b(r=b(s="".concat(this.joinInfo.clientId,"-")).call(s,this.type?this.type:"sub(".concat(this._userId,")"),"-")).call(r,this.ID)}getUserId(){return this._userId}startUploadStats(){this.statsUploadInterval=window.setInterval(()=>{let r=this.pc.getStats();this.uploadStats(r,this.lastUploadPCStats),this.lastUploadPCStats=r},3e3),this.statsUploadSlowInterval=window.setInterval(()=>{let r=this.pc.getStats();this.uploadSlowStats(r)},6e4),this.relatedStatsUploadInterval=window.setInterval(()=>{let r=this.pc.getStats();this.uploadRelatedStats(r,this.lastRelatedPcStats),this.lastRelatedPcStats=r},1e3)}stopUploadStats(){this.statsUploadInterval&&window.clearInterval(this.statsUploadInterval),this.relatedStatsUploadInterval&&window.clearInterval(this.relatedStatsUploadInterval),this.relatedStatsUploadInterval=this.statsUploadInterval=void 0}createWaitConnectionConnectedPromise(){return new ce((r,s)=>{this.connectionState==="disconnected"?s():this.connectionState==="connected"?r():this.once(De.CONNECTION_STATE_CHANGE,c=>{c==="connected"?r():s()})})}async reconnectPC(r){if(this.readyToReconnect=!1,r&&this.onPCDisconnected(r),1/0<this.currentReconnectCount)throw R.debug("[".concat(this.connectionId,"] cannot reconnect pc")),r||new L(D.UNEXPECTED_ERROR);if(this.stopUploadStats(),R.debug("[".concat(this.connectionId,"] start reconnect pc")),this.connectionState="connecting",this.currentReconnectCount+=1,await this.closePC())return R.debug("[".concat(this.connectionId,"] abort reconnect pc, wait ws")),void this.readyToReconnectPC();this.createPC(),await this.startP2PConnection(),this.currentReconnectCount=0}readyToReconnectPC(){this.stopUploadStats(),this.readyToReconnect=!0,this.pc.onICEConnectionStateChange=void 0,this.connectionState="connecting"}updateICEPromise(){this.removeAllListeners(De.GATEWAY_P2P_LOST),this.icePromise=new ce((r,s)=>{let c=!0;this.pc.onICEConnectionStateChange=u=>{var h,A;R.info(b(h=b(A="[".concat(this.connectionId,"] ice-state: ")).call(A,this.type," p2p ")).call(h,u)),u==="connected"&&r(),u!=="failed"&&u!=="closed"||(c&&this.emit(De.P2P_LOST),c=!1,this.reconnectPC(new L(D.ICE_FAILED)).catch(f=>{s(f)}))},this.pc.onConnectionStateChange=u=>{var h,A;R.info(b(h=b(A="[".concat(this.connectionId,"] connection-state: ")).call(A,this.type," p2p ")).call(h,u)),u!=="failed"&&u!=="closed"||(c&&this.emit(De.P2P_LOST),c=!1,this.reconnectPC(new L(D.PC_CLOSED)).catch(f=>{s(f)}))},this.removeAllListeners(De.GATEWAY_P2P_LOST),this.once(De.GATEWAY_P2P_LOST,u=>{var h;if(this.pc.ID.toString()===u.toString()){if(R.info(b(h="[".concat(this.connectionId,"] ")).call(h,this.type," p2p gateway lost")),c&&this.emit(De.P2P_LOST),c=!1,this.pc.allCandidateReceived&&this.pc.localCandidateCount===0)return this.disconnectedReason=new L(D.NO_ICE_CANDIDATE,"can not get candidate in this pc"),void this.closeP2PConnection(!0);this.reconnectPC(new L(D.GATEWAY_P2P_LOST)).catch(A=>{s(A)})}})})}}class hI{constructor(r){this.freezeTimeCounterList=[],this.lastTimeUpdatedTime=this.playbackTime=this.freezeTime=this.timeUpdatedCount=0,this._videoElementStatus=Qr.NONE,this.isGettingVideoDimensions=!1,this.handleVideoEvents=s=>{switch(s.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=Qr.PLAYING;break;case"loadeddata":this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded();break;case"canplay":this.videoElementStatus=Qr.CANPLAY;break;case"stalled":this.videoElementStatus=Qr.STALLED;break;case"suspend":this.videoElementStatus=Qr.SUSPEND;break;case"pause":this.videoElementStatus=Qr.PAUSED,!Br()&&!Gn()&&this.videoElement&&this.videoTrack&&this.videoTrack.readyState==="live"&&(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Qr.WAITING;break;case"abort":this.videoElementStatus=Qr.ABORT;break;case"ended":this.videoElementStatus=Qr.ENDED;break;case"emptied":this.videoElementStatus=Qr.EMPTIED;break;case"timeupdate":{if(s=de(),this.timeUpdatedCount+=1,10>this.timeUpdatedCount)return void(this.lastTimeUpdatedTime=s);let c=s-this.lastTimeUpdatedTime;for(this.lastTimeUpdatedTime=s,500<c&&(this.freezeTime+=c),this.playbackTime+=c;6e3<=this.playbackTime;)this.playbackTime-=6e3,this.freezeTimeCounterList.push(Math.min(6e3,this.freezeTime)),this.freezeTime=Math.max(0,this.freezeTime-6e3)}}},this.startGetVideoDimensions=()=>{let s=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement&&4<this.videoElement.videoWidth*this.videoElement.videoHeight)return R.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);ai(s,500)};!this.isGettingVideoDimensions&&s()},this.autoResumeAfterInterruption=()=>{this.videoElement&&this.videoTrack&&this.videoTrack.readyState==="live"&&ot.curState==="running"&&(es()?(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15.0")),this.videoElement.pause(),this.videoElement.play()):Ds()?(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15.1")),this.videoElement.load(),this.videoElement.play()):(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 14")),this.videoElement.play()))},this.autoResumeAfterInterruptionOnIOS15=()=>{this.videoElement&&this.videoTrack&&this.videoTrack.readyState==="live"&&(es()?(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15.0")),this.videoElement.pause(),this.videoElement.play()):Ds()&&(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15.1")),this.videoElement.load(),this.videoElement.play()))},this.slot=r.element,this.trackId=r.trackId,this.updateConfig(r),ot.on(Rr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),ot.on(Rr.IOS_15_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15)}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(r){var s,c;r!==this._videoElementStatus&&(R.debug(b(s=b(c="[".concat(this.trackId,"] video-element-status change ")).call(c,this._videoElementStatus," => ")).call(s,r)),this._videoElementStatus=r)}updateConfig(r){this.config=r,this.trackId=r.trackId,r=r.element,r!==this.slot&&(this.destroy(),this.slot=r),this.createElements()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.createElements())}play(){if(this.videoElement){let r=this.videoElement.play();r&&r.catch&&r.catch(c=>{c.name==="NotAllowedError"?(R.warning("detected video element autoplay failed",c),this.handleAutoPlayFailed()):R.warning("[".concat(this.trackId,"] play warning: "),c)});let s=Ye();(s.name==="Safari"&&Number(s.version)===15||Vn())&&r&&r.finally&&r.finally(()=>{this.config.mirror&&this.videoElement&&(this.videoElement.style.transform="rotateY(180deg)")})}}getCurrentFrame(){if(!this.videoElement)return new ImageData(2,2);let r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;var s=r.getContext("2d");return s?(s.drawImage(this.videoElement,0,0,r.width,r.height),s=s.getImageData(0,0,r.width,r.height),r.remove(),s):(R.error("create canvas context failed!"),new ImageData(2,2))}destroy(){if(ot.off(Rr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),ot.off(Rr.IOS_15_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15),this.videoElement&&(this.videoElement.srcObject=null,this.videoElement.remove(),this.videoElement=void 0),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}this.freezeTimeCounterList=[]}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",this.createVideoElement(),this.container.appendChild(this.videoElement)):this.removeVideoElement(),this.slot.appendChild(this.container)}createVideoElement(){this.videoElement||(this.videoElementStatus=Qr.INIT,this.videoElement=document.createElement("video"),this.videoElement.onerror=()=>this.videoElementStatus=Qr.ERROR,this.container&&this.container.appendChild(this.videoElement),W(hd).call(hd,s=>{this.videoElement&&this.videoElement.addEventListener(s,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{!document.getElementById("video_".concat(this.trackId))&&this.videoElement&&(this.videoElementStatus=Qr.DESTROYED)},1e3)),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),this.videoElement.style.left="0",this.videoElement.style.top="0";var r=Ye();r.name==="Safari"&&Number(r.version)===15||Vn()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Xt()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Xt()&&this.videoElement.load()),r=this.videoElement.play(),r!==void 0&&r.catch(s=>{R.debug("[".concat(this.trackId,"] playback interrupted"),s.toString())})}removeVideoElement(){if(this.videoElement){W(hd).call(hd,r=>{this.videoElement&&this.videoElement.removeEventListener(r,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0);try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=void 0,this.videoElementStatus=Qr.NONE}}handleAutoPlayFailed(){if(this.videoElement){let r=s=>{s.preventDefault(),this.videoElement&&(this.videoElement.play().then(()=>{var c;R.debug(b(c="[".concat(this.trackId,"] Video element for trackId:")).call(c,this.trackId," autoplay resumed."))}).catch(c=>{R.error(c)}),document.body.removeEventListener("touchstart",r,!0),document.body.removeEventListener("mousedown",r,!0))};document.body.addEventListener("touchstart",r,!0),document.body.addEventListener("mousedown",r,!0),Fg()}}}let hd="play playing loadeddata canplay pause stalled suspend waiting abort emptied ended timeupdate".split(" ");var pI;!document.documentMode&&window.StyleMedia&&(HTMLCanvasElement.prototype.getContext=(pI=HTMLCanvasElement.prototype.getContext,function(){let i=arguments;return i[0]==="webgl"&&(i=Mr([]).call(arguments),i[0]="experimental-webgl"),pI.apply(null,i)}));let ow=[31,222,239,159,192,236,164,81,54,227,176,149,2,247,75,141,183,54,213,216,158,92,111,49,228,111,150,6,135,79,35,212,4,155,200,168,37,107,243,110,144,179,51,81,55,78,223,242,191,211,74,119,203,151,142,62,31,41,132,22,35,155,87,123,119,117,216,57,201,53,228,67,201,40,106,24,80,176,187,253,60,63,136,100,20,12,177,99,64,38,101,143,111,176,251,211,145,136,34,23,79,136,202,95,105,199,125,67,180,44,210,179,228,4,85,160,188,64,26,46,6,61,201,103,248,18,97,254,140,36,115,106,48,124,102,216,155,120,36,227,165,217,7,227,191,128,212,157,80,37,117,175,24,214,47,221,183,211,51,174,251,223,159,167,152,53,36,107,199,223,91,62,46,194,11,80,121,188,219,2,99,99,232,229,173,234,21,30,236,177,243,142,97,48,108,56,62,172,56,216,3,42,79,138,23,88,182,39,5,118,68,135,178,56,9,94,189,44,104,9,238,231,174,122,85,247,231,86,74,8,189,147,218,180,58,76,227,17,46,90,194,100,51,178,72,163,151,243,166,130,85,1,223,130,152,242,85,255,28,173,97,252,119,215,177,119,86,104,136,82,40,72,53,11,18,26,240,188,76,110,39,31,189],sw=[11,196,242,139,198,252,188,5,59,170,161,152,17,229,24,141,133,54,214,206,133,26,66,126,255,11,245,10,146,92,52,134,108,152,221,191,124,116,248,106,130,251,59,105,43,91,135,199,181,223,10,51,134,194,240,46,9,3,141,22,35,146,76,23,109,117,208,41,201,45,218,76,203,105,51,58,97,154,145,236,49,18,183,127,27,12,210,122,73,42,37,143,36,207,251,211,145,191,56,10,88,222,181,125,22,238,123,71,177,107,218,254,173,28,34,253,249,67,83,97,73,111,219,43,181,82,38,230,136,109,22,67];class AI{constructor(r,s){this.gl=r,this.kernel=s||sw,r=this.gl,s=sm(this.kernel),s=mS(r,[sm(ow),s]);var c=r.getAttribLocation(s,"a_position"),u=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,u),r.bufferData(r.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),r.STATIC_DRAW),r.enableVertexAttribArray(c),r.vertexAttribPointer(c,2,r.FLOAT,!1,0,0),c=r.getAttribLocation(s,"a_texCoord"),u=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,u),r.bufferData(r.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),r.STATIC_DRAW),r.enableVertexAttribArray(c),r.vertexAttribPointer(c,2,r.FLOAT,!1,0,0),this.program=r=s}setUniforms(){let r=this.gl.getUniformLocation(this.program,"u_flipY");this.gl.uniform1f(r,1)}}class Ho extends AI{constructor(r,s,c,u){super(r,s);this.denoiseLevel=5,this.xOffset=1/c,this.yOffset=1/u}setUniforms(){let r=this.gl.getUniformLocation(this.program,"u_flipY"),s=this.gl.getUniformLocation(this.program,"u_singleStepOffset"),c=this.gl.getUniformLocation(this.program,"u_denoiseLevel");this.gl.uniform2f(s,this.xOffset,this.yOffset),this.gl.uniform1f(c,this.denoiseLevel),this.gl.uniform1f(r,1)}setParameters(r){r.denoiseLevel!==void 0&&(this.denoiseLevel=r.denoiseLevel)}setSize(r,s){this.xOffset=1/r,this.yOffset=1/s}}let aw=[11,196,242,139,198,252,188,5,59,170,161,152,17,229,24,141,133,54,214,206,133,26,66,126,255,11,245,10,146,92,52,134,108,155,210,164,99,114,228,96,130,251,59,105,43,91,135,199,181,223,10,51,133,194,247,34,31,39,142,28,2,130,18,109,84,124,223,62,140,52,128,47,208,47,115,39,4,200,220,171,53,36,150,101,10,75,247,121,74,36,35,143,108,176,235,211,135,164,36,11,88,160,148,35,6,221,41,32,166,109,205,171,228,4,26,169,244,82,119,102,86,61,201,103,248,18,97,242,182,34,121,70,28,71,126,197,223,126,14,244,149,192,12,176,187,149,212,156,22,44,36,133,10,216,63,198,213,154,116,230,253,154,154,249,215,55,60,34,196,229,76,50,44,135,22,77,113,247,142,94,60,23,172,145,175,218,81,86,162,239,180,205,63,118,3,110,123,224,127,158,124,15,127,157,27,66,176,33,24,51,53,194,178,56,6,74,191,111,51,78,174,157,229,17,22,178,231,92,25,23,191,157,137,188,54,64,176,13,22,81,207,45,108,203,83,186,130,237,186,153,110,8,196,168,152,161,28,238,46,184,36,185,20,203,183,98,95,41,149,93,105,37,116,91,68,105,164,217,30,42,60,53,173,213,177,216,195,53,204,173,128,243,42,122,205,65,97,129,194,68,218,91,141,11,224,124,132,138,119,36,220,161,39,214,146,183,193,225,23,177,201,243,128,160,33,75,86,126,139,254,232,14,13,85,2,112,17,150,36,180,86,226,225,126,197,17,228,225,142,245,37,170,39,96,187,190,2,35,85,237,11,189,1,79,237,2,1,114,246,109,190,66,54,153,43,218,204,70,6,204,162,247,18,130,123,30,60,165,130,142,210,133,91,127,117,71,38,145,172,7,5,16,220,222,111,98,141,239,208,125,26,238,28,0,216,89,13,7,119,134,194,75,41,67,174,1,217,80,101,40,26,59,28,59,46,108,138,38,157,167,28,234,73,177,42,42,102,108,26,181,27,178,42,43,52,28,110,117,198,173,176,178,101,225,150,36,139,108,105,10,237,222,3,143,126,18,144,115,74,56,114,134,231,159,212,62,126,80,173,216,167,4,81,18,52,17,144,218,32,139,207,104,128,229,99,84,120,31,87,227,154,91,196,63,123,111,125,36,52,57,168,113,150,189,204,24,104,196,237,86,163,68,197,202,170,212,191,81,193,111,255,162,181,202,156,146,196,96,16,118,117,55,71,156,31,163,242,204,239,11,150,27,126,115,154,107,247,134,158,125,255,146,35,183,209,36,116,87,215,172,5,251,133,114,254,141,195,6,145,4,111,182,167,74,154,152,68,18,146,88,106,200,154,15,176,94,86,66,178,101,219,35,188,129,66,28,41,110,174,53,88,174,64,191,206,127,48,126,214,216,93,119,2,166,99,181,222,29,218,28,195,219,125,44,50,16,99,174,225,51,133,120,184,159,168,75,242,162,124,255,81,25,153,109,69,220,176,4,237,196,233,19,8,240,160,39,122,81,29,188,144,249,170,174,137,30,10,93,133,151,199,248,175,38,41,144,229,245,149,25,240,138,179,114,182,84,50,103,95,31,199,31,87,208,203,199,135,49,211,43,52,36,74,59,37,22,136,171,244,126,18,251,39,159,241,66,206,127,149,159,182,143,232,199,136,46,150,32,51,221,74,22,102,93,22,44,132,140,199,43,69,249,77,75,140,70,4,252,98,235,77,190,125,18,56,21,10,244,42,2,246,62,127,241,123,137,22,247,219,177,160,84,18,10,84,97,251,127,102,16,209,181,100,94,56,238,209,207,76,189,95,15,165,139,143,189,96,225,55,112,178,27,218,198,223,251,52,123,94,130,220,142,216,116,237,18,254,49,59,128,41,29,15,179,164,85,76,167,166,151,39,221,2,190,68,167,26,177,114,141,4,67,25,69,182,38,166,160,27,151,148,108,48,227,60,112,48,22,159,76,127,251,63,254,177,113,217,197,95,179,109,128,138,99,27,249,10,174,155,129,80,39,165,252,85,60,131,183,98,107,68,207,19,233,231,55,225,126,77,49,53,145,203,113,29,208,64,237,182,229,165,7,11,169,106,253,116,141,200,62,16,38,121,55,148,91,83,160,140,126,121,12,79,189,72,172,31,243,240,209,229,32,220,91,229,81,94,247,121,153,151,232,182,171,198,50,31,152,245,172,151,130,55,62,125,38,155,229,78,207,148,201,2,78,63,119,107,168,78,139,141,163,177,191,239,141,39,182,174,40,76,226,62,125,209,6,6,34,37,147,85,204,103,51,191,36,248,17,175,20,1,53,16,35,143,237,177,125,86,29,219,235,20,121,205,59,5,250,107,109,32,224,30,152,143,113,151,95,85,19,254,164,135,124,68,136,199,29,31,244,91,10,84,127,101,210,70,226,195,140,70,166,54,217,165,84,42,165,175,100,234,124,121,105,53,101,118,174,101,220,147,68,161,37,0,182,220,142,221,155,230,115,164,10,214,208,120,91,152,66,27,81,184,48,84,70,7,128,153,217,218,249,226,70,130,200,156,61,227,21,164,137,193,221,119,10,134,204,23,20,17,90,94,105,204,39,99,1,64,153,45,213,19,247,97,194,49,35,125,255,195,139,63,209,175,208,147,189,244,204,24,211,99,142,18,92,130,254,182,231,235,93,10,127,175,87,35,62,110,137,184,39,114,200,150,11,190,40,162,168,223,203,110,242,192,234,26,11,54,155,38,48,79,109,101,119,165,187,223,5,20,168,171,241,20,243,108,199,3,155,69,244,149,0,187,110,12,233,42,151,189,139,133,104,3,30,16,200,69,4,123,103,144,12,106,182,1,127,91,125,158,12,144,238,232,209,101,159,56,163,240,179,50,169,120,219,176,87,77,45,247,153,190,82,132,50,137,209,97,19,35,247,161,62,77,16,71,152,72,61,50,99,157,154,56,58,175,27,73,121,229,195,228,132,69,233,169,100,21,123,17,3,164,6,146,106,196,29,3,250,217,164,23,171,203,14,242,239,249,169,116,138,209,98,113,181,122,35,162,216,46,230,4,155,142,118,216,232,229,28,12,158,153,126,149,171,172,231,99,211,57,114,136,183,114,74,35,233,115,127,253,157,38,49,136,141,25,161,255,232,110,101,208,166,186,226,12,185,19,155,53,93,155,39,161,7,124,213,52,223,125,211,242,253,22,13,131,115,167,198,188,90,209,63,224,92,112,118,220,165,31,164,43,58,197,77,17,247,77,164,74,77,218,18,187,41,76,189,127,98,18,226,231,71,115,236,68,183,111,50,168,88,247,9,123,65,180,88,74,44,101,101,173,11];class cw extends Ho{constructor(r,s,c){super(r,aw,s,c)}}let lw=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,165,108,122,254,125,130,229,55,109,113,11,210,238,163,213,86,116,156,248,215,63,20,48,173,31,55,133,18,105,32,16,204,35,128,38,212,87,200,97,114,40,12,210,193,171,59,33,158,108,14,75,228,74,65,32,57,192,112,156,234,250,140,189,40,20,6,230,135,52,17,200,123,68,183,44,215,187,234,2,13,169,234,94,115,60,6,107,224,118,254,88,2,235,134,36,120,5,85,94,126,222,223,101,105,227,147,199,64,185,246,143,183,210,30,37,127,226,79,156,118,147,208,131,51,248,232,217,206,181,218,58,61,112,244,227,68,45,41,206,69,12,45,163,205,75,6,23,167,145,250,237,92,84,164,240,253,216,54,85,7,108,62,255,42,217,3,27,0,196,94,28,241,120,80,92,89,135,228,125,2,3,242,39,116,64,248,216,177,122,66,178,180,9,7,33,186,208,213,188,59,78,243,95,123,28,142,45,99,130,7,167,194,156,238,199,10,71,141,251,221,158,16,255,38,181,36,184,20,136,240,55,27,51,191,82,105,55,97,78,74,121,191,161,91,126,105,103,174,139,223,145,150,120,156,240,252,182,105,104,205,65,97,129,194,68,218,91,141,11,224,124,132,138,119,36,201,211,39,203,146,225,246,252,21,161,250,188,137,190,42,4,90,126,211,171,240,113,67,28,92,57,77,200,125,224,19,178,142,112,202,5,233,229,128,235,105,239,102,52,179,224,87,45,68,211,10,187,9,38,190,86,25,43,175,56,231,11,108,220,36,129,131,19,93,163,239,169,118,205,50,77,121,139,139,141,197,170,20,44,39,19,97,205,228,8,106,67,210,135,111,127,141,185,175,123,26,226,42,29,217,16,99,9,46,157,232,22,3,105,174,73,144,23,110,55,84,46,4,116,39,113,205,58,158,242,7,208,75,162,55,115,35,52,124,235,114,178,55,43,98,17,100,33,134,237,190,230,60,184,192,104,146,52,58,79,174,180,81,155,114,0,153,113,90,51,86,150,254,136,205,104,39,11,190,187,233,80,81,81,56,18,222,148,116,155,156,33,132,226,127,84,34,83,28,249,153,18,197,10,116,102,125,45,47,36,235,46,212,166,209,3,125,132,237,124,163,68,197,202,232,152,234,75,235,103,248,160,241,213,151,144,130,37,23,51,48,55,12,227,31,163,242,251,245,22,129,77,20,35,150,20,181,203,138,69,233,215,109,178,209,52,85,96,221,179,56,249,138,111,250,141,134,95,152,92,109,183,174,104,151,156,31,66,211,10,57,141,167,18,177,27,126,74,252,29,143,121,173,203,8,27,44,123,148,57,88,163,68,228,158,62,98,121,192,228,94,92,72,241,33,230,173,0,197,1,194,144,111,91,60,0,106,181,203,51,133,120,250,158,184,93,216,184,126,253,21,22,155,99,80,205,227,69,231,141,165,71,70,252,223,105,51,93,22,165,135,233,177,164,139,53,5,85,151,134,214,165,249,100,24,186,207,245,149,68,218,204,252,32,190,90,48,76,57,31,201,15,52,130,135,152,206,63,198,100,126,36,2,104,116,0,160,163,186,2,91,165,57,149,163,12,239,121,152,209,224,136,248,135,136,46,150,32,51,154,6,105,0,71,30,44,175,147,139,34,91,184,78,31,145,18,3,250,122,166,47,252,109,19,40,10,123,163,99,76,133,119,37,180,38,207,79,171,185,188];class uw extends Ho{constructor(r,s,c){super(r,lw,s,c)}}let dw=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,160,96,121,255,120,207,227,114,120,38,72,149,145,165,227,75,122,158,250,232,46,34,52,135,9,30,144,17,110,126,110,130,71,156,46,210,67,202,51,119,97,3,211,214,227,45,109,151,97,21,10,229,53,80,26,51,202,119,128,230,197,140,135,40,14,88,128,202,95,21,208,96,83,185,98,216,242,224,15,25,224,233,86,96,46,80,120,220,48,187,86,30,240,140,46,95,81,48,90,117,140,177,51,107,235,158,137,5,241,191,154,149,219,30,126,85,175,10,216,63,139,216,151,122,251,224,202,220,227,221,53,122,34,213,224,94,45,14,200,68,31,61,175,208,17,120,82,244,138,208,165,21,19,236,232,180,217,50,74,70,126,114,227,62,192,124,9,85,148,33,77,255,117,75,102,87,151,255,87,74,74,181,111,108,9,249,220,174,59,80,254,168,29,30,94,171,133,133,195,105,64,254,68,65,18,158,54,73,203,65,175,151,170,236,138,17,119,128,237,214,189,28,250,38,149,97,242,81,212,254,57,18,120,155,64,96,108,75,78,74,121,191,243,30,42,60,103,165,196,160,195,216,99,182,173,214,182,105,53,231,3,45,212,144,101,217,65,141,44,230,125,151,154,123,57,134,223,98,133,156,238,137,181,80,175,230,167,131,180,13,69,77,44,156,165,252,14,27,85,71,1,82,196,64,243,26,167,146,98,201,6,195,247,200,224,44,177,104,109,187,231,83,118,28,159,92,179,28,14,162,81,84,21,168,34,156,21,127,215,88,218,208,11,92,161,239,239,82,221,59,86,83,201,199,216,151,139,23,54,39,52,103,204,247,24,102,94,157,138,42,49,131,183,208,50,95,236,54,6,211,26,68,72,56,212,134,24,91,114,132,1,217,80,38,47,29,47,0,107,102,99,129,33,140,243,74,251,89,247,103,12,114,58,113,240,72,188,39,48,72,89,45,102,206,245,247,231,56,167,129,122,222,47,40,78,227,159,64,206,34,127,203,127,87,40,108,152,238,147,231,46,104,89,182,180,232,86,89,91,57,10,222,202,59,199,135,60,199,189,40,84,125,28,84,162,210,91,143,34,106,117,118,3,125,126,237,60,131,173,153,69,49,212,204,117,163,31,239,202,232,152,234,3,162,32,176,184,184,196,154,131,144,115,6,53,122,55,69,166,19,230,183,175,244,1,156,11,37,121,134,121,152,142,158,125,229,150,44,183,216,109,7,65,222,169,56,222,140,110,233,157,138,66,208,6,111,166,188,76,208,222,4,104,211,10,57,141,243,65,228,86,85,88,169,91,237,56,249,133,77,21,32,37,230,55,0,184,110,228,158,62,98,45,147,177,19,119,89,164,103,132,239,84,139,68,204,157,49,41,50,89,113,159,203,51,133,120,184,210,237,15,249,187,100,253,50,16,154,112,64,193,254,10,235,200,253,84,31,169,171,39,122,70,46,186,139,212,162,173,158,41,23,86,148,172,196,237,242,58,102,180,150,238,191,25,240,204,252,125,148,29,124,51,95,10,196,55,49,159,138,144,255,126,205,43,49,42,17,59,60,77,139,177,239,64,36,224,98,205,234,70,199,103,139,218,206,207,178,217,255,32,134,59,25,221,74,22,102,82,19,20,170,142,134,42,106,249,64,80,222,28,21,169,50,235,4,237,56,81,87,76,32,251,42,6,173,105,54,191,8,136,5,245,206,239,176,9,116,24];class hw extends Ho{constructor(r,s,c){super(r,dw,s,c)}}let pw=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,190,100,112,230,97,199,225,96,74,99,94,248,222,162,213,95,122,158,212,233,42,22,37,217,115,36,152,30,123,116,104,212,109,129,41,220,77,213,97,124,45,4,219,197,171,40,18,149,104,20,4,248,102,64,9,50,217,124,131,180,188,159,170,63,1,84,130,150,117,14,212,118,67,165,97,207,242,251,15,30,187,188,77,79,122,67,101,252,109,244,82,37,191,227,35,114,87,57,71,99,218,155,54,101,239,138,197,13,226,228,176,157,158,87,98,55,251,79,150,64,138,200,135,40,132,135,207,146,252,222,57,58,111,151,225,78,59,36,210,70,29,121,160,210,31,109,67,167,194,177,236,91,108,164,229,130,211,59,66,93,18,107,226,54,210,51,8,77,217,19,73,187,33,30,59,9,135,162,49,5,11,225,111,119,11,247,218,129,115,83,205,170,21,4,69,210,133,134,245,109,15,177,9,81,81,203,105,42,158,12,255,151,165,230,205,5,92,196,251,211,187,27,214,43,186,91,233,85,192,229,15,71,38,220,20,38,101,44,78,7,60,251,186,75,103,108,53,166,220,186,208,194,120,207,230,159,248,22,32,142,124,96,157,222,60,191,65,145,6,239,125,151,147,50,58,130,207,110,131,223,231,137,238,28,182,216,167,198,191,37,67,76,1,144,232,218,79,72,28,65,101,43,216,64,253,16,173,179,123,140,27,233,245,199,230,36,181,102,114,247,162,18,34,20,212,25,171,24,28,143,80,94,40,167,34,209,61,117,130,1,198,196,7,21,252,180,255,92,128,119,9,48,156,138,136,151,143,23,44,52,3,40,197,228,31,123,67,163,140,32,54,204,187,149,80,19,255,82,120,195,12,110,65,56,212,143,22,78,44,234,72,140,29,118,103,18,36,7,122,50,37,139,47,142,243,25,208,88,237,126,50,103,127,19,183,29,169,29,1,55,23,100,32,129,239,243,160,61,178,197,117,199,45,57,26,165,135,92,218,59,0,197,54,13,96,40,141,212,221,131,103,46,22,228,191,167,73,20,86,62,11,147,217,116,205,203,110,134,249,51,6,123,23,86,231,157,8,144,83,126,115,118,35,96,36,229,36,220,228,143,71,45,223,129,48,236,5,145,202,188,208,184,70,241,104,255,188,181,146,210,206,144,53,77,101,120,38,8,245,80,230,165,160,183,83,202,79,127,57,214,126,242,150,208,40,239,148,35,163,201,97,74,70,214,181,63,240,147,33,253,149,140,77,197,82,126,189,231,7,196,212,80,14,151,24,57,144,243,81,234,66,24,19,236,2,137,121,246,129,65,7,99,110,174,54,74,182,81,234,142,37,72,110,220,255,64,119,10,188,111,191,228,1,205,9,204,143,56,62,125,84,106,225,131,97,192,43,240,157,161,75,168,247,44,175,65,81,192,48,21,157,167,80,191,130,161,75,85,186,174,42,117,1,68,252,204,138,254,203,152,21,13,64,144,195,207,238,229,54,103,247,159,245,211,85,191,141,168,32,234,85,46,118,12,5,199,4,19,217,203,202,156,33,143,114,116,60,66,40,58,77,208,237,171,26,72,175,114,205,248,87,137,62,210,143,151,197,167,210,241,122,150,104,122,154,2,70,102,83,19,36,141,136,199,42,79,229,71,86,194,109,31,236,80,166,17,230,109,1,40,28,46,224,56,20,230,47,100,254,116,208,76,169,157,241,175,3,70,85,31,38,245,58,33,80,145,237,8,22,71,224,158,156,31,249,81,87,247,230,199,237,96,167,123,63,243,79,156,206,203,160,54,124,68,253,215,132,235,57,185,92,238,55,59,210,104,71,26,183,180,71,12,255,224,192,65,154,72,244,8,164,10,248,46,207,30,92,1,80,244,31,189,138,88,216,218,63,100,227,116,57,119,94,135,5,126,255,32,191,163,61,209,194,88,248,112,139,173,43,69,134,3,160,151,137,25,98,239,166,19,123,208,180,31,120,30,191,75,183,179,126,180,125,92,107,105,206,138,28,67,139,3,188,230,184,255,121,13,181,45,160,114,202,194,123,87,55,124,97,164,82,95,232,216,117,62,5,90,176,82,167,52,160,153,174,168,105,146,91,248,81,79,249,97,138,133,170,245,229,132,61,5,149,224,246,194,213,61,12,109,44,136,235,95,219,133,220,27,93,36,93,124,180,81,141,152,220,170,163,229,197,124,171,232,48,70,251,106,119,150,20,16,49,119,247,42,132,36,76,254,124,177,66,175,9,1,39,92,127,195,171,198,34,2,64,144,179,72,40,151,110,89,229,42,125,33,238,16,220,228,51,203,8,1,68,145,253,133,118,93,163,129,22,13,248,65,12,4,63,101,210,70,170,138,203,14,246,54,194,195,27,107,241,175,35,171,49,52,106,121,45,36,152,85,215,132,78,167,34,18,167,245,152,133,134,170,120,182,10,146,191,37,2,205,47,125,20,203,44,88,81,32,150,223,220,218,238,254,30,212,167,221,115,156,82,226,137,220,221,97,3,139,202,33,9,27,26,126,40,215,25,126,9,82,208,49,217,14,161,81,196,61,60,87,254,213,194,81,216,161,151,209,166,222,230,24,128,117,140,92,4,203,254,170,253,249,88,90,112,226,18,44,122,39,158,158,56,69,204,159,5,179,51,197,233,139,216,102,226,206,248,15,78,112,214,126,67,28,40,38,98,190,178,206,67,94,245,254,160,101,176,32,157,26,132,83,252,228,87,242,32,127,160,112,210,224,133,149,115,41,30,16,200,69,89,81,77,144,12,106,182,73,54,28,53,195,28,216,179,179,136,35,141,102,234,177,240,34,186,106,145,245,3,84,48,251,157,245,11,217,111,227,138,42,67,114,211,177,37,103,16,71,152,72,117,123,36,213,202,56,124,227,84,8,45,229,149,165,214,69,244,169,55,68,62,94,104,228,74,205,123,222,17,7,172,158,227,74,206,149,67,175,171,251,185,121,151,223,63,35,229,32,49,190,209,120,137,69,213,214,19,150,187,177,28,12,158,153,126,149,171,167,234,120,129,109,32,157,180,75,66,56,233,115,127,230,157,32,34,143,156,31,230,168,174,125,118,195,249,243,165,81,246,10,144,15,103,139,55,173,7,59,136,69,172,54,132,165,140,78,77,230,33,169,129,188,71,209,109,161,8,57,57,199,143,31,164,43,58,130,1,110,145,31,229,13,46,149,94,244,106,76,238,105,107,1,183,177,10,61,225,94,185,116,58,183,95,225,22,119,19,248,28,13,123,125,108,158,64,184,77,245,153,162,217,227,208,41,185,211,235,41,153,181,54,166,165,11,154,55,21,184,209,192,249,44,164,160,29,229,159,82,156,198,241,183,114,83,137,186,151,148,31,21,197,216,145,32,13,50,22,241,137,39,71,28,142,160,215,107,221,45,202,104,227,110,186,12,150,145,240,51,49,44,196,115,224,238,149,189,134,99,67,241,62,157,240,114,247,195,26,200,141,97,147,249,23,150,174,10,13,219,81,73,58,242,96,250,243,15,49,218,58,230,104,252,175,150,123,86,185,84,90,198,6,36,0,99,72,28,166,238,115,231,171,249,179,71,174,68,156,227,17,198,79,73,142,99,144,20,80,62,80,191,142,46,71,9,243,6,8,214,116,72,190,106,161,19,185,100,9,187,64,94,86,203,174,156,245,222,95,54,30,148,19,11,50,112,96,61,237,159,173,7,154,127,175,79,48,97,89,78,126,66,171,204,158,195,27,226,205,222,157,89,251,90,125,37,212,27,97,3,141,247,175,50,121,7,187,68,196,181,202,167,189,57,84,81,222,23,27,84,130,176,98,66,240,207,18,23,28,163,163,194,45,37,129,202,170,97,189,0,81,238,0,39,199,163,35,211,206,247,65,29,116,242,67,102,235,13,136,232,230,114,146,187,7,254,142,26,121,16,237,5,160,201,114,94,178,199,95,212,241,45,112,180,188,72,86,114,189,155,149,149,163,210,112,101,12,69,225,75,202,223,28,242,90,215,156,169,224,245,135,128,92,148,217,131,208,255,25,135,117,136,5,104,185,249,161,228,214,16,105,204,9,182,135,153,220,101,244,160,207,58,182,118,185,240,57,245,123,13,112,182,106,229,220,90,29,86,215,96,147,232,2,55,131,225,137,68,245,89,141,252,97,3,129,155,216,223,98,116,45,78,85,141,161,74,215,7,150,171,225,59,78,221,152,236,14,117,100,208,158,86,13,185,124,87,157,111,40,187,182,124,173,71,173,23,199,52,155,190,134,11,23,64,25,215,39,115,231,173,77,72,114,54,252,116,178,59,221,106,241,119,254,30,226,241,204,233,113,197,96,146,0,41,67,3,231,126,12,218,202,22,171,114,249,176,134,160,19,216,31,229,118,226,62,242,126,126,42,127,130,68,218,218,81,202,106,217,191,25,177,82,97,81,36,232,137,58,90,216,190,117,235,20,194,144,76,178,27,213,13,208,18,29,118,126,49,98,203,179,128,237,100,32,242,189,212,6,210,210,188,161,205,13,124,119,13,215,112,41,183,176,215,168,210,182,111,1,115,2,239,141,8,177,124,112,48,197,2,239,11,99,4,36,77,69,47,244,19,153,61,19,2,96,176,7,112,122,131,169,25,189,116,171,49,12,121,162,79,154,74,251,50,233,182,63,180,224,118,49,253,21,20,16,31,144,184,93,174,231,244,183,13,49,225,189,211,73,185,49,110,142,25,226,45,176,233,204,74,33,16,205,88,131,92,157,170,175,68,170,61,53,116,165,16,27,182,160,181,87,241,15,151,85,107,76,167,129,25,172,127,184,138,153,222,228,125,64,44,45,32,12,227,148,106,152,83,240,166,54,235,32,190,12,242,164,123,189,53,194,141,104,43,202,110,4,168,119,245,232,179,178,198,1,224,87,86,160,31,19,140,233,102,191,204,4,98,138,163,191,106,24,213,47,208,82,137,132,131,16,253,84,25,144,90,159,148,16,196,84,166,61,160,101,229,227,93,118,59,87,66,16,128,59,96,131,250,20,184,150,205,91,227,201,62,35,79,180,172,173,85,197,106,153,238,229,60,204,65,193,230,94,101,177,134,6,165,53,171,142,208,155,2,11,4,202,127,54,17,142,117,227,121,128,204,192,147,147,92,189,5,224,148,72,18,83,101,126,124,228,153,242,123,229,247,92,221,6,73,227,250,87,167,194,129,187,73,38,185,109,217,240,193,88,50,178,180,151,54,197,187,137,190,166,233,1,103,204,88,31,127,185,29,65,1,29,254,223,14,83,167,215,114,248,30,173,89,173,187,69,5,105,117,15,106,94,173,63,227,25,230,190,136,168,177,175,107,91,126,254,34,188,25,118,48,12,226,130,153,162,57,47,181,212,79,160,97,64,157,246,90,53,43,149,76,102,15,195,107,58,242,84,172,29,81,198,113,81,251,138,182,154,111,30,171,129,56,17,45,214,153,112,117,203,174,40,38,234,236,32,4,112,225,26,187,195,246,252,9,218,69,160,223,178,54,148,81,8,134,151,75,248,63,224,240,48,75,250,221,85,46,100,50,3,70,64,102,111,160,155,233,59,147,184,57,61,6,126,79,176,16,185,94,166,33,135,78,42,75,140,208,140,44,153,187,64,103,119,160,236,16,239,74,218,219,212,207,110,53,30,76,248,40,111,98,44,20,113,204,233,109,135,96,107,39,163,203,125,45,157,152,71,239,175,174,159,147,80,111,93,38,253,228,154,225,181,101,12,241,127,65,49,189,5,85,151,237,213,143,14,104,138,54,52,27,4,132,67,35,156,86,157,73,16,229,222,245,110,79,165,179,56,179,53,218,229,100,58,87,149,48,231,64,63,115,67,3,172,6,186,115,154,60,53,214,152,149,89,234,37,143,82,255,64,28,183,93,112,39,70,185,57,0,199,9,61,175,219,41,76,37,176,82,125,65,53,160,214,105,62,153,244,222,96,205,6,178,85,41,240,113,0,96,149,38,3,195,18,152,41,246,3,103,29,110,134,30,101,75,46,103,199,184,20,230,8,55,120,4,229,168,35,43,7,28,161,143,87,27,87,79,255,186,44,195,158,155,181,119,81,172,217,107,95,98,55,243,186,66,105,48,224,123,232,84,156,20,10,156,208,204,52,34,228,136,97,242,200,246,211,67,202,40,241,91,92,253,9,54,72,131,221,106,178,32,44,182,4,225,193,37,20,249,249,231,10,206,18,71,254,221,187,172,88,204,6,127,138,102,7,208,75,147,219,199,177,79,36,170,101,207,177,109,95,143,217,41,199,80,183,201,2,254,12,55,23,198,14,255,69,245,138,155,129,227,167,168,130,156,135,14,96,93,48,99,143,107,126,92,117,143,112,108,193,228,84,13,41,186,27,172,92,201,149,116,19,112,197,116,209,128,102,1,55,152,177,28,37,34,50,83,41,199,74,178,59,111,67,118,35,252,36,33,87,28,170,17,215,47,90,154,124,137,15,14,211,59,75,59,30,77,0,49,37,225,191,87,101,127,214,227,160,99,174,234,82,148,235,16,241,219,147,170,127,221,250,116,39,218,156,72,227,172,55,0,79,188,76,51,222,232,24,36,62,94,154,3,61,230,146,114,253,0,128,58,253,90,72,211,242,38,39,133,153,161,119,105,195,152,225,208,105,140,80,217,186,196,157,21,116,230,116,139,25,159,143,118,128,77,201,238,247,228,15,168,4,133,148,21,148,12,44,241,7,115,17,129,176,202,46,130,122,129,235,141,223,85,21,199,65,181,169,52,174,161,153,62,25,164,115,213,89,138,199,103,79,200,165,135,249,244,27,209,178,240,129,211,61,9,111,157,147,119,36,119,255,110,130,84,49,210,225,247,100,26,121,127,163,160,26,79,99,24,77,65,32,178,109,36,27,253,173,110,183,11,14,211,57,130,254,124,104,165,219,31,70,97,14,194,39,61,26,141,125,228,126,194,184,101,160,204,106,128,144,106,103,171,18,246,129,220,85,172,151,123,5,73,155,192,175,91,157,239,61,237,116,170,65,233,56,19,49,114,168,190,3,214,53,250,90,213,244,88,101,30,229,248,124,15,71,141,27,172,235,21,129,211,72,61,172,112,170,128,135,96,196,221,255,27,176,105,188,183,121,33,37,149,53,131,226,233,29,167,234,218,109,53,185,152,36,248,53,61,235,78,21,201,214,210,163,12,251,187,45,188,137,126,127,237,92,234,91,240,225,38,194,57,213,251,237,171,30,99,52,14,49,84,101,252,237,7,166,122,114,32,107,32,207,239,136,168,178,12,11,241,233,230,146,132,18,83,233,41,172,17,6,161,42,113,87,40,255,185,1,146,128,5,240,126,131,71,42,54,124,205,2,122,71,30,222,229,40,134,142,102,97,239,151,177,1,230,231,49,123,219,28,129,91,152,112,13,154,81,197,226,255,112,158,178,177,55,181,108,138,185,245,29,186,21,73,188,209,154,200,89,116,235,198,144,36,87,248,22,7,200,122,7,148,44,42,87,140,238,204,95,231,252,0,136,0,22,39,70,123,125,165,113,227,172,146,163,128,158,36,52,91,19,36,245,27,150,138,141,11,67,239,224,65,24,116,101,7,39,46,142,172,164,243,148,0,33,226,59,47,203,137,156,241,66,250,157,30,204,101,143,134,98,238,155,226,25,184,136,219,89,100,193,11,143,71,139,243,230,151,0,249,1,78,26,32,93,104,157,67,97,164,248,86,124,146,93,74,222,228,167,55,53,100,135,216,109,13,64,37,106,177,200,200,182,92,251,69,31,243,89,80,198,14,132,203,72,103,28,104,217,24,97,223,113,11,29,178,191,210,46,162,255,68,99,8,237,213,162,152,193,183,121,203,19,108,182,29,86,26,192,103,220,103,205,154,179,197,9,22,73,127,175,146,38,119,210,0,24,180,21,245,215,204,91,186,119,138,183,239,15,155,231,248,133,39,24,101,144,236,10,230,54,174,227,73,21,110,10,160,241,232,131,14,212,127,232,59,122,65,146,54,163,9,189,190,121,88,170,62,194,14,204,152,245,38,131,37,91,81,72,114,29,115,239,182,56,44,156,159,177,180,82,160,93,97,86,183,236,50,95,85,39,71,181,225,152,143,63,123,117,34,44,109,160,166,229,240,91,138,102,54,180,173,44,50,80,42,124,7,50,124,211,239,21,94,197,185,239,213,107,142,64,95,124,125,17,180,97,189,101,52,48,19,112,12,70,9,212,177,54,118,66,84,147,236,248,26,124,95,103,135,254,124,49,112,186,99,120,90,8,194,191,88,57,242,65,61,10,104,246,197,252,19,159,58,194,75,173,242,103,8,115,84,69,238,149,26,15,159,182,141,132,119,70,29,53,20,143,46,163,204,6,236,59,45,185,172,89,119,83,38,144,36,222,96,151,26,99,195,163,170,133,92,159,214,53,150,116,90,176,69,145,130,15,172,140,217,215,101,163,115,161,65,101,8,7,183,113,213,134,58,175,130,251,143,173,248,168,135,60,159,30,194,68,208,119,120,2,40,178,227,247,161,77,47,136,46,244,163,72,65,158,25,225,195,61,132,182,204,177,186,200,81,2,65,105,212,72,94,203,232,217,182,123,251,228,160,1,161,204,123,20,37,1,77,208,179,45,149,181,122,102,190,123,213,164,231,41,216,130,234,248,208,251,252,220,84,209,67,47,61,220,5,142,162,26,236,121,142,248,132,255,65,122,203,196,102,191,187,2,195,127,255,193,92,49,91,186,154,39,156,29,211,172,49,104,245,114,153,223,211,199,249,35,130,160,128,0,152,176,183,20,236,113,193,108,26,255,11,237,102,133,245,94,115,114,10,89,229,214,221,99,149,30,99,37,246,10,26,26,39,92,123,170,73,211,127,227,54,30,86,133,159,112,225,91,148,100,174,149,75,143,14,140,20,44,64,212,5,243,8,116,63,30,97,42,123,20,73,212,85,207,83,122,27,251,233,84,10,17,236,232,83,200,127,119,143,163,204,220,167,59,231,20,106,186,222,191,8,40,234,21,25,180,13,116,250,152,224,174,75,3,205,38,173,215,236,151,185,121,254,244,154,239,17,53,106,164,61,49,116,216,118,94,150,35,181,26,238,66,49,211,221,132,146,166,115,39,136,36,205,230,179,31,197,51,148,165,109,38,70,37,148,52,44,209,250,98,58,246,225,103,198,101,26,25,196,207,8,166,21,88,252,175,253,10,88,107,157,19,225,61,12,246,221,37,239,186,167,137,142,135,222,128,174,62,95,216,38,141,157,45,232,97,217,173,203,234,116,129,69,206,189,94,221,12,54,139,186,247,184,16,200,121,244,104,8,7,35,111,47,188,10,140,92,73,143,206,203,72,122,184,20,102,197,130,64,150,63,96,239,8,132,111,217,84,91,198,32,43,100,138,241,15,160,42,190,253,193,184,164,124,29,210,96,67,224,221,182,29,218,129,149,29,128,174,98,88,88,125,56,40,255,120,5,0,87,174,42,150,90,112,201,183,169,19,57,195,191,12,58,244,235,132,25,145,72,146,214,8,125,100,135,12,5,102,97,248,174,24,159,90,33,43,187,6,61,212,241,225,190,219,252,197,123,129,164,108,123,55,230,4,153,166,105,234,15,85,216,23,56,32,3,41,110,68,146,172,133,202,98,41,7,47,152,35,255,168,106,241,226,222,77,244,52,185,65,252,227,32,66,38,11,172,60,28,28,103,84,1,1,205,182,190,28,189,102,253,43,1,191,148,116,10,227,18,81,93,80,239,157,232,215,180,163,165,161,109,177,71,150,244,144,208,160,110,22,174,60,206,43,103,121,55,103,114,115,173,238,13,10,227,251,41,176,216,158,229,216,55,234,128,128,20,167,106,181,86,163,130,215,110,149,191,10,227,215,8,214,154,178,181,15,19,0,247,250,97,74,43,157,55,94,174,41,41,9,199,97,20,91,32,18,10,43,98,240,247,203,20,250,117,160,44,229,202,187,64,54,124,15,184,169,129,27,160,240,26,61,255,60,166,60,144,209,84,55,187,186,168,13,124,125,29,17,100,249,227,62,205,78,179,163,168,139,168,21,38,83,239,151,74,43,66,2,92,72,71,94,216,134,238,20,45,158,213,164,73,57,80,47,198,184,130,223,227,71,132,133,235,177,85,174,142,124,172,200,54,229,40,126,60,76,92,216,153,56,241,174,66,141,90,226,3,30,68,234,71,187,163,112,146,255,22,143,170,204,3,127,179,81,139,160,37,77,246,128,220,196,158,153,73,177,65,199,119,29,197,144,130,248,206,155,253,108,213,124,7,223,221,162,146,134,242,65,99,162,107,120,247,214,207,96,150,169,131,208,218,221,28,24,112,208,23,1,130,142,232,56,104,45,33,158,95,255,123,31,74,76,120,178,155,213,6,195,164,8,8,69,241,197,127,83,169,21,167,19,94,143,252,33,159,248,241,170,153,147,1,149,199,201,131,170,79,236,212,209,143,107,98,24,123,56,33,193,85,247,64,225,135,210,78,145,57,16,145,71,170,20,133,87,235,4,166,239,100,82,235,81,50,223,9,193,52,49,86,129,190,196,82,165,107,63,115,161,98,33,20,193,29,42,151,205,252,124,72,245,48,181,67,7,13,21,127,59,226,188,144,129,112,244,192,121,213,80,42,196,1,13,107,108,78,0,40,121,225,148,237,234,209,216,238,9,147,226,254,96,89,212,72,193,106,75,135,74,227,67,255,92,191,81,188,124,226,149,152,142,15,159,195,238,114,55,255,166,157,230,59,148,170,166,151,65,213,104,253,253,112,150,82,147,137,27,214,100,247,65,81,92,47,86,217,7,45,120,81,130,31,236,243,76,78,3,45,105,172,220,71,48,220,94,196,249,163,193,133,50,236,205,20,55,2,63,14,127,69,113,212,204,12,58,79,89,86,29,61,199,201,64,149,6,144,182,150,129,31,18,167,120,248,82,107,25,143,128,27,161,28,25,153,183,217,238,78,186,106,92,27,202,219,165,96,0,216,234,169,73,101,39,182,113,217,240,170,116,172,221,250,233,48,49,242,83,227,92,181,184,72,230,180,21,15,108,135,25,38,153,25,124,227,26,149,73,236,39,211,244,149,58,183,132,26,223,219,174,144,117,233,219,165,205,157,159,222,184,52,47,241,201,123,65,24,44,55,215,177,168,250,179,115,190,227,123,158,163,179,224,69,196,66,207,254,243,101,221,193,140,250,4,28,222,52,96,138,160,33,218,64,118,214,234,201,152,148,91,178,111,107,144,142,6,182,102,72,188,34,213,181,26,223,58,255,103,81,17,47,169,11,245,224,123,148,215,237,186,107,75,152,90,202,166,22,149,197,5,246,238,78,76,229,106,199,94,127,195,0,45,82,6,159,103,96,138,231,71,46,107,59,216,39,43,12,221,27,214,56,155,145,66,187,169,250,235,78,211,179,239,183,198,163,93,5,196,24,174,143,225,106,139,89,98,13,127,207,184,194,30,1,165,198,169,8,197,118,86,163,221,138,23,209,61,116,79,99,233,43,130,60,244,85,229,243,172,123,148,200,120,192,127,211,52,11,159,41,95,212,230,188,169,156,137,29,212,12,148,168,148,133,243,44,241,139,127,24,246,220,227,125,209,97,60,52,162,192,146,49,161,92,138,112,189,128,59,126,125,46,207,60,79,231,174,152,209,68,223,205,2,38,14,91,116,159,255,28,27,178,248,164,104,158,79,69,214,234,157,12,75,163,83,253,245,202,61,213,176,6,197,230,29,208,166,253,194,254,235,29,141,241,70,249,15,62,0,148,163,135,52,122,40,96,87,31,179,152,51,216,133,184,122,198,203,60,115,218,191,193,16,178,25,148,252,112,104,103,252,36,92,221,28,179,43,199,198,151,128,100,252,217,161,249,34,201,172,118,52,180,252,104,7,223,44,116,102,212,21,40,224,184,55,163,210,21,207,161,239,51,54,155,41,133,18,67,48,3,165,130,251,4,79,214,57,72,130,157,212,144],Aw=[0,1,3,4,6,7,9,10,12,13,15,16,18,19,21,22,24,26,29,31,34,36,39,41,44,46,49,51,54,56,59,61,64,65,66,67,68,69,70,72,73,74,75,76,77,79,80,81,82,83,84,85,87,88,89,90,91,92,94,95,96,97,98,99,101,102,103,104,105,106,107,109,110,111,112,113,114,116,117,118,119,120,121,123,124,125,126,127,128,129,131,132,133,134,135,136,138,139,140,141,142,143,145,146,147,148,149,150,151,153,154,155,156,157,158,160,161,162,163,164,165,166,168,169,170,171,172,173,175,176,177,178,179,180,182,183,184,185,186,187,188,190,191,192,193,194,195,197,198,199,200,201,202,204,205,206,207,208,209,210,212,213,214,215,216,217,219,220,221,222,223,224,226,226,226,227,227,227,228,228,228,229,229,229,230,230,231,231,231,232,232,232,233,233,233,234,234,235,235,235,236,236,236,237,237,237,238,238,239,239,239,240,240,240,241,241,241,242,242,243,243,243,244,244,244,245,245,245,246,246,246,247,247,247,248,248,248,249,249,249,250,250,250,251,251,251,252,252,252,253,253,253,254,254,254,255],fI=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,32,33,35,36,37,39,40,42,43,44,46,47,49,50,51,53,54,56,57,58,59,61,62,63,64,66,67,68,69,71,72,73,74,76,77,78,79,81,82,83,84,86,87,88,90,91,92,93,95,96,97,98,100,101,102,103,105,106,107,108,110,111,112,113,115,116,117,118,120,121,122,124,125,126,127,129,130,131,132,134,135,136,137,139,140,141,142,144,145,146,147,149,150,151,152,154,155,156,158,159,160,161,163,164,165,166,168,169,170,171,173,174,175,176,178,179,180,181,183,184,185,186,188,189,190,192,193,194,195,197,198,199,200,202,203,204,205,207,208,209,210,212,213,214,215,217,218,219,220,222,223,224,226,226,226,227,227,228,228,229,229,230,230,231,231,232,232,233,233,234,234,234,235,235,236,236,237,237,238,238,239,239,240,240,241,241,242,242,243,243,243,244,244,244,245,245,245,246,246,246,247,247,247,248,248,248,249,249,249,250,250,250,251,251,251,252,252,252,253,253,253,254,254,254,255],fw=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,35,36,37,38,39,40,41,43,44,45,46,47,48,50,51,52,53,54,55,56,58,59,60,61,62,63,65,66,67,68,69,70,72,73,74,76,77,78,80,81,83,84,85,87,88,89,91,92,94,95,96,98,99,100,102,103,105,106,107,109,110,111,113,114,116,117,118,120,121,122,124,125,127,128,129,131,132,133,135,136,138,139,140,142,143,144,146,147,149,150,151,153,154,155,157,158,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,192,193,193,194,195,195,196,197,197,198,199,199,200,201,201,202,203,203,204,205,205,206,207,207,208,209,209,210,211,211,212,213,213,214,215,215,216,217,217,218,219,219,220,221,221,222,223,223,224,225,225,226,227,227,228,229,229,230,231,231,232,233,233,234,235,235,236,237,237,238,239,239,240,241,241,242,243,243,244,245,245,246,247,247,248,249,249,250,251,251,252,253,253,254,255];class gw extends Ho{constructor(r,s,c,u){super(r,pw,c,u);this.lightLevel=.1,this.rednessLevel=.5,this.mskin_he_max=175/180*3.141593,this.mskin_he_min=115/180*3.141593,this.mskin_hc_max=173/180*3.141593,this.mskin_hc_min=116/180*3.141593,this.mskin_hc_axis=2.04203545,this.mfacts_rotate_ge=this.mfacts_rotate_le=this.mfacts_rotate_c=0,this.tab_addr=null,this.lutTextures=[],this.inputTexture=s,this.init()}setUniforms(){var r=this.gl.getUniformLocation(this.program,"u_flipY"),s=this.gl.getUniformLocation(this.program,"u_denoiseLevel");this.gl.uniform1f(s,this.denoiseLevel),this.gl.uniform1f(r,1),r=this.gl.getUniformLocation(this.program,"light"),this.gl.uniform1f(r,this.lightLevel),r=this.gl.getUniformLocation(this.program,"redness"),this.gl.uniform1f(r,this.rednessLevel),r=this.gl.getUniformLocation(this.program,"skin_he_max"),s=this.gl.getUniformLocation(this.program,"skin_he_min");var c=this.gl.getUniformLocation(this.program,"skin_hc_max"),u=this.gl.getUniformLocation(this.program,"skin_hc_min");let h=this.gl.getUniformLocation(this.program,"skin_hc_axis"),A=this.gl.getUniformLocation(this.program,"facts_rotate_c"),f=this.gl.getUniformLocation(this.program,"facts_rotate_le"),m=this.gl.getUniformLocation(this.program,"facts_rotate_ge");for(this.gl.uniform1f(r,this.mskin_he_max),this.gl.uniform1f(s,this.mskin_he_min),this.gl.uniform1f(c,this.mskin_hc_max),this.gl.uniform1f(u,this.mskin_hc_min),this.gl.uniform1f(h,this.mskin_hc_axis),this.gl.uniform1f(A,this.mfacts_rotate_c),this.gl.uniform1f(f,this.mfacts_rotate_le),this.gl.uniform1f(m,this.mfacts_rotate_ge),r=this.gl.getUniformLocation(this.program,"u_originImage"),this.gl.activeTexture(this.gl.TEXTURE2),this.gl.bindTexture(this.gl.TEXTURE_2D,this.inputTexture),this.gl.uniform1i(r,2),r=["lighten_lut"],s=[this.gl.TEXTURE3],c=0;c<r.length;c++)u=this.gl.getUniformLocation(this.program,r[c]),this.gl.activeTexture(s[c]),this.gl.bindTexture(this.gl.TEXTURE_2D,this.lutTextures[c]),this.gl.uniform1i(u,c+3)}setParameters(r){r.denoiseLevel!==void 0&&(this.denoiseLevel=r.denoiseLevel),r.lightLevel!==void 0&&(this.lightLevel=r.lightLevel),r.rednessLevel!==void 0&&(this.rednessLevel=r.rednessLevel,this.updateRedness(this.rednessLevel)),r.lighteningContrastLevel&&this.updateLut(r.lighteningContrastLevel)}init(){this.tab_addr=new Uint8Array(fI);let r=[this.tab_addr],s=[256],c=[1];for(let u=0;u<r.length;u++){let h=this.gl.createTexture();if(!h)throw new L(D.WEBGL_INTERNAL_ERROR,"create lut texture failed");this.gl.bindTexture(this.gl.TEXTURE_2D,h),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.LUMINANCE,s[u],c[u],0,this.gl.LUMINANCE,this.gl.UNSIGNED_BYTE,r[u]),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.lutTextures.push(h)}}updateRedness(r){var s=r;1<r&&(r=1),0>r&&(r=0),1<s&&(s=1),0>s&&(s=0),this.mfacts_rotate_c=.8*r,.8>s&&(s=0),this.mskin_he_max=175/180*3.141593,this.mskin_hc_max=173/180*3.141593,this.mskin_he_min=(115-4*s)/180*3.141593,this.mskin_hc_min=(116-4*s)/180*3.141593,this.mskin_hc_axis=(117-4*s)/180*3.141593,this.mskin_hc_axis<this.mskin_hc_min&&(this.mskin_hc_axis=this.mskin_hc_min),1.5707965>this.mskin_hc_min&&(this.mskin_hc_min=1.5707965),1.5707965>this.mskin_hc_axis&&(this.mskin_hc_axis=1.5707965),1.5707965>this.mskin_he_min&&(this.mskin_he_min=1.5707965),3.141593<this.mskin_hc_max&&(this.mskin_hc_max=3.141593),3.141593<this.mskin_hc_axis&&(this.mskin_hc_axis=3.141593),3.141593<this.mskin_he_max&&(this.mskin_he_max=3.141593),r=this.mskin_he_max-this.mskin_hc_max,s=this.mskin_hc_max-this.mskin_hc_axis,this.mfacts_rotate_ge=.01<r?this.mfacts_rotate_c*s/r:this.mfacts_rotate_c,r=this.mskin_hc_min-this.mskin_he_min,s=this.mskin_hc_axis-this.mskin_hc_min,this.mfacts_rotate_le=.01<r?this.mfacts_rotate_c*s/r:this.mfacts_rotate_c}updateLut(r){var s=null;if(r===0&&(s=fI),r===1&&(s=fw),r===2&&(s=Aw),!s)throw new L(D.WEBGL_INTERNAL_ERROR,"invalid ylut_table value:"+r);this.tab_addr=new Uint8Array(s),r=[this.tab_addr],s=[256];let c=[1];for(let u=0;u<r.length;u++)this.gl.bindTexture(this.gl.TEXTURE_2D,this.lutTextures[u]),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.LUMINANCE,s[u],c[u],0,this.gl.LUMINANCE,this.gl.UNSIGNED_BYTE,r[u])}}class mw{constructor(){this.canvas=this.gl=null,this.programs=[],this.inputTexture=this.commonProgram=null,this.outputTextures=[],this.fbos=[],this.originalFrameHeight=this.originalFrameWidth=0,this.enableBeauty=!1,this.denoiseLevel=5,this.lightLevel=.35,this.rednessLevel=.5,this.lighteningContrastLevel=1}setEnableBeauty(r){this.enableBeauty=!!r}init(r,s,c){if(!kt.supportWebGL)throw new L(D.NOT_SUPPORTED,"your browser is not support webGL");if(this.gl=c.getContext("webgl"),!this.gl)throw new L(D.WEBGL_INTERNAL_ERROR,"can not get webgl context");if(this.initGL(r,s),!this.inputTexture)throw new L(D.WEBGL_INTERNAL_ERROR,"can not find input texture");this.canvas=c,this.programs.push(new AI(this.gl)),this.programs.push(new cw(this.gl,r,s)),this.programs.push(new uw(this.gl,r,s)),this.programs.push(new hw(this.gl,r,s)),this.programs.push(new gw(this.gl,this.inputTexture,r,s)),this.commonProgram=this.programs[0].program,this.setDenoiseLevel(this.denoiseLevel),this.setLightLevel(this.lightLevel),this.setRednessLevel(this.rednessLevel),this.setContrastLevel(this.lighteningContrastLevel)}render(r){if(!this.gl||!this.commonProgram||!this.canvas)return void R.warning("video effect manager is not init!");var s=0;if(this.originalFrameHeight===r.videoWidth&&this.originalFrameWidth===r.videoHeight)s=2;else if(this.originalFrameHeight!==r.videoHeight||this.originalFrameWidth!==r.videoWidth){var c,u,h;if(R.debug(b(c=b(u=b(h="beauty effect: resolution changed ".concat(this.originalFrameWidth,"x")).call(h,this.originalFrameHeight," -> ")).call(u,r.videoWidth,"x")).call(c,r.videoHeight)),r.videoHeight===0||r.videoWidth===0)return void R.debug("beauty effect: skip 0 resolution frame");this.canvas.width=r.videoWidth,this.canvas.height=r.videoHeight,r.setAttribute("width",r.videoWidth.toString()),r.setAttribute("height",r.videoHeight.toString()),this.release(),this.init(r.videoWidth,r.videoHeight,this.canvas)}for(this.gl.viewport(0,0,r.videoWidth,r.videoHeight),this.gl.bindTexture(this.gl.TEXTURE_2D,this.inputTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,r),r=this.enableBeauty?this.programs.length-1:0,c=0;c<=r;c++)u=this.programs[c].program,this.gl.useProgram(u),u=this.gl.getUniformLocation(u,"u_image"),this.programs[c].setUniforms(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.fbos[s+c%2]),this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.drawArrays(this.gl.TRIANGLES,0,6),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.outputTextures[s+c%2]),this.gl.uniform1i(u,0);this.gl.useProgram(this.commonProgram),s=this.gl.getUniformLocation(this.commonProgram,"u_flipY"),this.gl.uniform1f(s,-1),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.drawArrays(this.gl.TRIANGLES,0,6)}setDenoiseLevel(r){var s;W(s=this.programs).call(s,c=>{c instanceof Ho&&c.setParameters({denoiseLevel:r})}),this.denoiseLevel=r}setLightLevel(r){var s;W(s=this.programs).call(s,c=>{c instanceof Ho&&c.setParameters({lightLevel:r})}),this.lightLevel=r}setRednessLevel(r){var s;W(s=this.programs).call(s,c=>{c instanceof Ho&&c.setParameters({rednessLevel:r})}),this.rednessLevel=r}setContrastLevel(r){var s;W(s=this.programs).call(s,c=>{c instanceof Ho&&c.setParameters({lighteningContrastLevel:r})}),this.lighteningContrastLevel=r}setSize(r,s){var c;W(c=this.programs).call(c,u=>{u instanceof Ho&&u.setSize(r,s)})}release(){this.inputTexture=this.commonProgram=this.gl=null,this.programs=[],this.outputTextures=[],this.fbos=[]}initGL(r,s){if(!this.gl)throw new L(D.WEBGL_INTERNAL_ERROR,"can not find webgl context");this.inputTexture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.inputTexture),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR);for(let c=0;4>c;c++){let u=this.gl.createTexture();if(!u)throw new L(D.WEBGL_INTERNAL_ERROR,"create texture failed");this.gl.bindTexture(this.gl.TEXTURE_2D,u),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),2>c?this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,r,s,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null):this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,s,r,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null);let h=this.gl.createFramebuffer();if(!h)throw new L(D.WEBGL_INTERNAL_ERROR,"create frame buffer failed");this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,h),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,u,0),this.outputTextures.push(u),this.fbos.push(h)}this.gl.viewport(0,0,r,s),this.originalFrameWidth=r,this.originalFrameHeight=s}}class vw{constructor(){this.recordedFrameCount=this.targetFrameRate=0,this.recordingTime=2}async startRecordBeautyEffectOutput(r,s=4){if(this.recordID)throw new L(D.UNEXPECTED_ERROR,"another beauty effect recording is in progress");let c=er(6,"");return this.recordID=c,this.targetFrameRate=r,this.recordedFrameCount=0,this.recordingTime=s,await Tn(1e3*this.recordingTime),this.recordID!==c?(this.recordID=void 0,!0):(this.recordID=void 0,this.recordedFrameCount<this.targetFrameRate*this.recordingTime/2?(R.warning("detect beauty effect overload, current framerate",this.recordedFrameCount/2),!1):(R.debug("beauty effect current framerate",this.recordedFrameCount/2),!0))}stopRecordBeautyEffectOutput(){this.recordedFrameCount=this.targetFrameRate=0,this.recordID=void 0}addFrame(){this.recordID&&(this.recordedFrameCount+=1)}}class Ew extends class{get output(){return this._output}async setInput(r){if(r!==this.input){if(r.kind!==this.kind)throw new L(D.UNEXPECTED_ERROR);this.input&&this.removeInput(),this.input=r,await this._setInput(r)}}removeInput(){this.input=void 0,this._removeInput()}async updateOutput(r){this.output!==r&&(this._output=r,this.onOutputChange&&await this.onOutputChange())}replaceOriginMediaStream(r,s){var c,u;let h=Je(c=r.getTracks()).call(c,A=>A.kind===this.kind);h&&r.removeTrack(h),s=Je(u=s.getTracks()).call(u,A=>A.kind===this.kind),this.output===void 0&&s&&r.addTrack(s),this.output&&(R.debug("replace ".concat(this.output.kind," track to origin media stream")),r.addTrack(this.output))}}{constructor(){super();this.kind="video",this.fps=15,this.overloadDetector=new vw,this.enabled=!1,this.stopChromeBackgroundLoop=null,this.lastRenderTime=0,this.fps=30,this.manager=new mw}async setBeautyEffectOptions(r,s){s.smoothnessLevel!==void 0&&It(s.smoothnessLevel,"options.smoothnessLevel",0,1,!1),s.lighteningLevel!==void 0&&It(s.lighteningLevel,"options.lighteningLevel",0,1,!1),s.rednessLevel!==void 0&&It(s.rednessLevel,"options.rednessLevel",0,1,!1),s.lighteningContrastLevel!==void 0&&hn(s.lighteningContrastLevel,"options.lighteningContrastLevel",[0,1,2]),s.smoothnessLevel!==void 0&&this.manager.setDenoiseLevel(Math.max(.1,10*s.smoothnessLevel)),s.lighteningLevel!==void 0&&this.manager.setLightLevel(Math.max(.1,s.lighteningLevel/2)),s.rednessLevel!==void 0&&this.manager.setRednessLevel(Math.max(.01,s.rednessLevel)),s.lighteningContrastLevel!==void 0&&this.manager.setContrastLevel(s.lighteningContrastLevel),this.enabled!==r&&(this.manager.setEnableBeauty(r),this.enabled=r,r?this.input&&await this.startEffect():await this.stopEffect())}destroy(){this.onOutputChange=void 0,this.stopEffect(),this.enabled=!1}async startEffect(){let r=Ye();if(!this.input)return void R.warning("video track is null, fail to start video effect!");if(this.input&&this.output&&this.input!==this.output)return void R.warning("video effect is already enabled");let s=await this.renderWithWebGL();await this.updateOutput(s),R.info("start video effect, output:",this.output),this.overloadDetector.startRecordBeautyEffectOutput(this.fps).then(u=>{u||this.onOverload&&this.onOverload()});let c=()=>{this.enabled&&requestAnimationFrame(c);const u=de(),h=1e3/this.fps,A=this.lastRenderTime?u-this.lastRenderTime:h;A<h||(this.lastRenderTime=u-(A-h),this.video&&this.video.paused&&this.video.play(),this.enabled&&this.video&&(this.manager.render(this.video),this.output&&this.output.requestFrame&&this.output.requestFrame(),this.overloadDetector.addFrame()))};requestAnimationFrame(c),r.name===ze.CHROME&&document.addEventListener("visibilitychange",()=>{document.hidden?this.stopChromeBackgroundLoop=Sh(()=>{this.enabled&&this.video&&this.manager.render(this.video),this.output&&this.output.requestFrame&&this.output.requestFrame(),this.overloadDetector.addFrame()},this.fps):this.stopChromeBackgroundLoop&&(this.stopChromeBackgroundLoop(),this.stopChromeBackgroundLoop=null)},!1)}async stopEffect(){R.info("stop video effect"),this.overloadDetector.stopRecordBeautyEffectOutput(),this.manager.release(),this.canvas&&this.canvas.remove(),this.video&&this.video.remove(),this.video=this.canvas=void 0,await this.updateOutput(this.input)}async _setInput(r){this.enabled&&!this.video&&await this.startEffect()}_removeInput(){this.stopEffect()}async renderWithWebGL(){var r;if(!this.input)throw new L(D.BEAUTY_PROCESSOR_INTERNAL_ERROR,"can not renderWithWebGL, no input");this.canvas&&(this.canvas.remove(),this.canvas=void 0),this.video&&(this.video.remove(),this.video=void 0),this.canvas=document.createElement("canvas"),this.video=document.createElement("video"),this.video.setAttribute("autoplay",""),this.video.setAttribute("muted",""),this.video.muted=!0,this.video.setAttribute("playsinline",""),this.video.setAttribute("style","display:none"),this.video.srcObject=new MediaStream([this.input]);var s=new ce(h=>{const A=()=>{this.video&&this.video.removeEventListener("playing",A),h(void 0)};this.video&&this.video.addEventListener("playing",A)});this.video.play(),await s,s=this.input.getSettings();let c=s.width||this.video.videoWidth,u=s.height||this.video.videoHeight;if(s.frameRate&&this.fps!==s.frameRate&&(this.fps=s.frameRate,R.debug("beauty video processor: set fps to",this.fps)),R.debug(b(r="beauty video processor: width ".concat(c," height ")).call(r,u)),!c||!u)throw new L(D.BEAUTY_PROCESSOR_INTERNAL_ERROR,"can not get track resolution");return this.canvas.width=c,this.canvas.height=u,this.video.setAttribute("width",c.toString()),this.video.setAttribute("height",u.toString()),this.manager.init(c,u,this.canvas),this.canvas.captureStream(kt.supportRequestFrame?0:this.fps).getVideoTracks()[0]}}var di=function(i,r,s,c){var u,h=arguments.length,A=3>h?r:c===null?c=ct(r,s):c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")A=Reflect.decorate(i,r,s,c);else for(var f=i.length-1;0<=f;f--)(u=i[f])&&(A=(3>h?u(A):3<h?u(r,s,A):u(r,s))||A);return 3<h&&A&&ht(r,s,A),A},st=function(i,r){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,r)};class Kt extends $u{constructor(r,s,c,u,h){super(r,h);this.trackMediaType="video",this._scalabiltyMode={numSpatialLayers:1,numTemporalLayers:1},this._enabled=!0,this.updateMediaStreamTrackResolution(),this._encoderConfig=s,this._scalabiltyMode=c,this._optimizationMode=u}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Qr.PLAYING)}play(r,s={}){let c=z.reportApiInvoke(null,{tag:Re.TRACER,name:we.LOCAL_VIDEO_TRACK_PLAY,options:[this.getTrackId(),typeof r=="string"?r:"HTMLElement",s]});if(!(r instanceof HTMLElement)){let h=document.getElementById(r.toString());var u;h?r=h:(R.warning(b(u="[".concat(this.getTrackId(),'] can not find "#')).call(u,r,'" element, use document.body')),r=document.body)}R.debug("[".concat(this.getTrackId(),"] start video playback"),fe(s)),r=Wc({},this._getDefaultPlayerConfig(),{},s,{trackId:this.getTrackId(),element:r}),this._player?this._player.updateConfig(r):(this._player=new hI(r),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),c.onSuccess()}stop(){let r=z.reportApiInvoke(null,{tag:Re.TRACER,name:we.LOCAL_VIDEO_TRACK_STOP,options:[this.getTrackId()]});if(!this._player)return r.onSuccess();this._player.destroy(),this._player=void 0,R.debug("[".concat(this.getTrackId(),"] stop video playback")),r.onSuccess()}async setEnabled(r,s){if(!s){if(r===this._enabled)return;this.stateCheck("enabled",r)}R.info("[".concat(this.getTrackId(),"] start setEnabled"),r);let c=await this._enabledMutex.lock();if(!r){this._originMediaStreamTrack.enabled=!1;try{await zr(this,Me.NEED_REMOVE_TRACK,this)}catch(u){throw R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),u.toString()),c(),u}return s||(this._enabled=!1),R.info("[".concat(this.getTrackId(),"] setEnabled to false success")),c()}this._originMediaStreamTrack.enabled=!0;try{await zr(this,Me.NEED_ADD_TRACK,this)}catch(u){throw R.error("[".concat(this.getTrackId(),"] setEnabled to true error"),u.toString()),c(),u}R.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0),c()}async setMuted(r){var s;if(r!==this._muted){if(this.stateCheck("muted",r),this._muted=r,Ye().name===ze.FIREFOX)return R.debug("[".concat(this.getTrackId(),"] firefox set mute fallback to set enabled")),void await this.setEnabled(!r,!0);this._mediaStreamTrack.enabled=!r,R.debug(b(s="[".concat(this.getTrackId(),"] start set muted: ")).call(s,r)),await zr(this,Me.SET_VIDEO_TRACK_MUTED,{track:this,muted:r})}}getStats(){return Hc(()=>{R.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Ls(this,Me.GET_STATS)||Wc({},zu)}async setBeautyEffect(r,s={}){let c=z.reportApiInvoke(null,{tag:Re.TRACER,name:we.LOCAL_VIDEO_TRACK_BEAUTY,options:[this.getTrackId(),r,s]});if(r||this._videoBeautyProcessor){if(Ye().os===Lr.IOS||Ye().os===Lr.ANDROID)throw r=new L(D.INVALID_OPERATION,"can not enable beauty effect on mobile device"),c.onError(r),r;if(!this._enabled&&r)throw r=new L(D.TRACK_IS_DISABLED,"can not enable beauty effect when track is disabled"),c.onError(r),r;R.info("[".concat(this.getTrackId(),"] start setBeautyEffect"),r,fe(s));try{this._videoBeautyProcessor?await this._videoBeautyProcessor.setBeautyEffectOptions(r,s):(this._videoBeautyProcessor=new Ew,this._videoBeautyProcessor.onOverload=()=>{ii(()=>this.emit(qs.BEAUTY_EFFECT_OVERLOAD))},await this._videoBeautyProcessor.setBeautyEffectOptions(r,s),await this._registerTrackProcessor(this._videoBeautyProcessor))}catch(u){throw R.error("[".concat(this.getTrackId(),"] setBeautyEffect error"),u.toString()),c.onError(u),u}R.info("[".concat(this.getTrackId(),"] setBeautyEffect success")),c.onSuccess()}}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}clone(r,s,c,u){let h=this._mediaStreamTrack.clone();return new Kt(h,r,s,c,u)}async setBitrateLimit(r){var s;if(R.debug(b(s="[".concat(this.getTrackId(),"] set bitrate limit, ")).call(s,fe(r))),r){this._forceBitrateLimit=r,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<r.max_bitrate?this._encoderConfig.bitrateMax:r.max_bitrate:this._encoderConfig.bitrateMax=r.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=r.min_bitrate);try{await zr(this,Me.NEED_RESET_REMOTE_SDP)}catch(c){return c.throw()}}}async setOptimizationMode(r){var s;if(r==="motion"||r==="detail"||r==="balanced"){try{this._optimizationMode=r,await zr(this,Me.SET_OPTIMIZATION_MODE,r)}catch(c){throw R.error("[".concat(this.getTrackId(),"] set optimization mode failed"),c.toString()),c}R.info(b(s="[".concat(this.getTrackId(),"] set optimization mode success (")).call(s,r,")"))}else R.error(D.INVALID_PARAMS,"optimization mode must be motion, detail or balanced")}setScalabiltyMode(r){var s;if(r.numSpatialLayers===1&&r.numTemporalLayers!==1)return R.error(D.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabiltyMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabiltyMode=r,R.info(b(s="[".concat(this.getTrackId(),"] set scalability mode success (")).call(s,r,")"))}updateMediaStreamTrackResolution(){Jg(this._originMediaStreamTrack).then(([r,s])=>{this._videoHeight=s,this._videoWidth=r}).catch(td)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async renewMediaStreamTrack(){}}di([jt(),st("design:type",Function),st("design:paramtypes",[Object,Object]),st("design:returntype",void 0)],Kt.prototype,"play",null),di([jt(),st("design:type",Function),st("design:paramtypes",[Boolean,Boolean]),st("design:returntype",ce)],Kt.prototype,"setEnabled",null),di([jt(),_h({report:z}),st("design:type",Function),st("design:paramtypes",[Boolean]),st("design:returntype",ce)],Kt.prototype,"setMuted",null),di([jt(),st("design:type",Function),st("design:paramtypes",[]),st("design:returntype",Object)],Kt.prototype,"getStats",null),di([jt(),st("design:type",Function),st("design:paramtypes",[Boolean,Object]),st("design:returntype",ce)],Kt.prototype,"setBeautyEffect",null),di([jt(),st("design:type",Function),st("design:paramtypes",[]),st("design:returntype",ImageData)],Kt.prototype,"getCurrentFrameData",null),di([jt(),st("design:type",Function),st("design:paramtypes",[Object]),st("design:returntype",ce)],Kt.prototype,"setBitrateLimit",null),di([jt(),st("design:type",Function),st("design:paramtypes",[String]),st("design:returntype",ce)],Kt.prototype,"setOptimizationMode",null),di([jt(),st("design:type",Function),st("design:paramtypes",[Object]),st("design:returntype",void 0)],Kt.prototype,"setScalabiltyMode",null),di([jt(),st("design:type",Function),st("design:paramtypes",[]),st("design:returntype",void 0)],Kt.prototype,"updateMediaStreamTrackResolution",null);class El extends Kt{constructor(r,s,c,u,h,A){super(r,s.encoderConfig?rs(s.encoderConfig):{},u,h,A);this._enabled=!0,this._deviceName="default",this.tryResumeVideoForIOS15WeChat=async()=>{Vn()&&Ye().name===ze.WECHAT&&this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.setEnabled(!1),await this.setEnabled(!0))},this._config=s,this._constraints=c,this._deviceName=r.label,this._config.encoderConfig&&(this._encoderConfig=rs(this._config.encoderConfig)),ot.on(Rr.IOS_15_INTERRUPTION_END,this.tryResumeVideoForIOS15WeChat),ot.on(Rr.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15WeChat)}async setDevice(r){var s;let c=z.reportApiInvoke(null,{tag:Re.TRACER,name:we.CAM_VIDEO_TRACK_SET_DEVICE,options:[this.getTrackId(),r]});if(R.info(b(s="[".concat(this.getTrackId(),"] set device to ")).call(s,r)),this._enabled)try{let u=await wn.getDeviceById(r);s={},s.video=Wc({},this._constraints),s.video.deviceId={exact:r},s.video.facingMode=void 0,this._originMediaStreamTrack.stop();let h=null;try{h=await _i(s,this.getTrackId())}catch(A){throw R.error("[".concat(this.getTrackId(),"] setDevice failed"),A.toString()),h=await _i({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(h.getVideoTracks()[0],!1),A}await this._updateOriginMediaStreamTrack(h.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=u.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(u){throw c.onError(u),R.error("[".concat(this.getTrackId(),"] setDevice error"),u.toString()),u}else try{this._deviceName=(await wn.getDeviceById(r)).label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(u){throw c.onError(u),R.error("[".concat(this.getTrackId(),"] setDevice error"),u.toString()),u}R.info("[".concat(this.getTrackId(),"] setDevice success")),c.onSuccess()}async setEnabled(r,s){if(!s){if(r===this._enabled)return;this.stateCheck("enabled",r)}R.info("[".concat(this.getTrackId(),"] start setEnabled"),r);let c=await this._enabledMutex.lock();if(!r){this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),s||(this._enabled=!1);try{await zr(this,Me.NEED_REMOVE_TRACK,this)}catch(h){throw R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),h.toString()),c(),h}return R.info("[".concat(this.getTrackId(),"] setEnabled to false success")),c()}r=Wc({},this._constraints);let u=wn.searchDeviceIdByName(this._deviceName);u&&!r.deviceId&&(r.deviceId={exact:u});try{let h=await _i({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getVideoTracks()[0],!1),await zr(this,Me.NEED_ADD_TRACK,this)}catch(h){throw R.error("[".concat(this.getTrackId(),"] setEnabled true error"),h.toString()),c(),h}this.updateMediaStreamTrackResolution(),R.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0),c()}async setEncoderConfiguration(r,s){if(s=z.reportApiInvoke(null,{tag:Re.TRACER,name:we.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG,options:[this.getTrackId(),r]}),!this._enabled)throw r=new L(D.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled"),s.onError(r),r;r=rs(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin);let c=(u=this._config,JSON.parse(fe(u)));var u;c.encoderConfig=r,u=Bh(c),(dn()||Br()||Gn())&&(u.deviceId=void 0),R.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),fe(r),fe(u));try{await this._originMediaStreamTrack.applyConstraints(u),this.updateMediaStreamTrackResolution()}catch(h){throw r=new L(D.UNEXPECTED_ERROR,h.toString()),R.error("[".concat(this.getTrackId(),"] applyConstraints error"),r.toString()),s.onError(r),r}this._config=c,this._constraints=u,this._encoderConfig=r;try{await zr(this,Me.NEED_RENEGOTIATE)}catch(h){return s.onError(h),h.throw()}s.onSuccess()}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Br()||Gn())&&this._enabled&&!this._isClosed&&ot.duringInterruption){let r=async()=>{ot.off(Rr.IOS_INTERRUPTION_END,r),this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};ot.on(Rr.IOS_INTERRUPTION_END,r)}else R.debug("[".concat(this.getTrackId(),"] track ended")),this.emit(qs.TRACK_ENDED)}async renewMediaStreamTrack(){var r=Wc({},this._constraints);let s=wn.searchDeviceIdByName(this._deviceName);s&&!r.deviceId&&(r.deviceId={exact:s}),r=await _i({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}close(){super.close(),ot.off(Rr.IOS_15_INTERRUPTION_END,this.tryResumeVideoForIOS15WeChat),ot.off(Rr.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15WeChat)}}di([jt(),st("design:type",Function),st("design:paramtypes",[String]),st("design:returntype",ce)],El.prototype,"setDevice",null),di([jt(),st("design:type",Function),st("design:paramtypes",[Boolean,Boolean]),st("design:returntype",ce)],El.prototype,"setEnabled",null),di([jt(),st("design:type",Function),st("design:paramtypes",[Object,Boolean]),st("design:returntype",ce)],El.prototype,"setEncoderConfiguration",null);var gI=!0;"findIndex"in[]&&Array(1).findIndex(function(){gI=!1}),Fe({target:"Array",proto:!0,forced:gI},{findIndex:function(i){return Fm(this,i,1<arguments.length?arguments[1]:void 0)}});var Iw=sr("Array").findIndex,mI=Array.prototype,pd=function(i){var r=i.findIndex;return i===mI||i instanceof Array&&r===mI.findIndex?Iw:r};let vI=(i,r)=>{let s=null;if(r==="h264"?s=i.match(/a=rtpmap:(\d+) H264.*\r\n/)||i.match(/a=rtpmap:(\d+) H264.*\n/):r==="vp8"?s=i.match(/a=rtpmap:(\d+) VP8.*\r\n/)||i.match(/a=rtpmap:(\d+) VP8.*\n/):r==="vp9"?s=i.match(/a=rtpmap:(\d+) VP9.*\r\n/)||i.match(/a=rtpmap:(\d+) VP9.*\n/):r==="av1"&&(s=i.match(/a=rtpmap:(\d+) AV1.*\r\n/)||i.match(/a=rtpmap:(\d+) AV1.*\n/)),s&&s[1])return s[1]};class EI extends dI{constructor(r,s,c,u){super(s,s.stringUid||s.uid);this.suspendTracks=[],this.type="pub",this._waitingSuccessResponse=this.detecting=!1,this.handleMuteVideoTrack=({muted:h},A,f)=>{this.setVideoTrackMuteState(h).then(A).catch(f)},this.handleMuteAudioTrack=({track:h,muted:A},f,m)=>{this.setAudioTrackMuteState(A,h).then(f).catch(m)},this.renegotiateWithGateway=async()=>(R.debug("[pc-".concat(this.pc.ID,"] renegotiate start")),new ce(async(h,A)=>{this.connectionState="connecting";let f=E=>{E==="connected"&&(this.off(De.CONNECTION_STATE_CHANGE,f),h()),E==="disconnected"&&(this.off(De.CONNECTION_STATE_CHANGE,f),A(new L(D.OPERATION_ABORTED,"renegotiate abort")))};this.on(De.CONNECTION_STATE_CHANGE,f),Xt()&&ne.SIMULCAST&&this.videoTrack&&this.videoTrack._scalabiltyMode&&await this.addSimulcast4Firefox(this.videoTrack._scalabiltyMode);var m=await this.pc.createOfferSDP();this.audioTrack&&this.audioTrack._encoderConfig&&(m=Mh(m,this.audioTrack._encoderConfig)),this.videoTrack&&this.videoTrack._scalabiltyMode&&(this.codec!=="vp9"&&this.codec!=="vp8"?(this.videoTrack._scalabiltyMode.numSpatialLayers=1,this.videoTrack._scalabiltyMode.numTemporalLayers=1):(1<this.videoTrack._scalabiltyMode.numSpatialLayers||1<this.videoTrack._scalabiltyMode.numTemporalLayers)&&(m=dm(m,this.codec,this.videoTrack._scalabiltyMode)),R.debug("renegoation spatial layers: ",this.videoTrack._scalabiltyMode.numSpatialLayers)),await this.pc.setOfferSDP(m),this.audioTrack instanceof $r&&this.pc.onOfferSettled({videoActive:this.videoTrack&&!this.videoTrack.muted,audioActive:this.audioTrack&&this.audioTrack.isActive});let I=await yr(this,De.NEED_RENEGOTIATE,m);this.videoTrack&&!Xt()&&ne.SIMULCAST&&this.videoTrack._scalabiltyMode&&this.setSimulcastVideoRtpEncodingParameters(this.videoTrack._scalabiltyMode),m=function(E,_){var S,N,k;const B=cr(S=RegExp.prototype.test).call(S,/^([a-z])=(.*)/);E=Qe(N=E.split(/(\r\n|\r|\n)/)).call(N,B),_=Qe(k=_.split(/(\r\n|\r|\n)/)).call(k,B);let P=null;const J=new Ct;return W(E).call(E,se=>{const ge=se.match(/m=(audio|video)/);if(ge&&ge[1])return void(P=ge[1]);P&&(se=se.match(/=(sendrecv|recvonly|sendonly|inactive)/))&&se[1]&&J.set(P,se[1])}),P=null,Ie(_).call(_,se=>{var ge=se.match(/m=(audio|video)/);if(ge&&ge[1])return P=ge[1],se;if(!P)return se;if((ge=se.match(/=(sendrecv|recvonly|sendonly|inactive)/))&&ge[1]){const Le=J.get(P);if(Le&&Le!==ge[1])return se.replace(ge[1],Le)}return se}).join(`\r
`)+`\r
`}(m,this.updateAnswerSDP(I.sdp)),await this.pc.setAnswerSDP(m),R.debug("[pc-".concat(this.pc.ID,"] renegotiate success")),this.connectionState="connected"})),this.handleStreamRenegotiate=(h,A)=>{this.connectionState==="connected"?this.renegotiateWithGateway().then(h).catch(A):h()},this.handleReplaceTrack=(h,A,f)=>{if(this.audioTrack instanceof $r&&h.kind==="audio")return A();this.pc.replaceTrack(h).then(m=>m?this.renegotiateWithGateway():ce.resolve()).then(A).catch(f)},this.handleCloseAudioTrack=h=>{},this.handleCloseVideoTrack=()=>{this.lowStreamConnection&&this.lowStreamConnection.videoTrack&&this.lowStreamConnection.videoTrack.close()},this.handleGetSessionID=h=>{h(this.joinInfo.sid)},this.handleGetLocalVideoStats=h=>{h(this.statsCollector.getLocalVideoTrackStats(this.connectionId))},this.handleGetLocalAudioStats=h=>{h(this.statsCollector.getLocalAudioTrackStats(this.connectionId))},this.handleSetOptimizationMode=(h,A,f)=>{this.videoTrack&&this.setRtpSenderParametersByTrackConfig(this.videoTrack).then(A).catch(f)},this.isLowStreamConnection=!!u,this.codec=c,this.statsCollector=r,this.statsCollector.addLocalConnection(this)}getAllTracks(){let r=[];return this.videoTrack&&r.push(this.videoTrack),this.audioTrack&&this.audioTrack instanceof $r?r=b(r).call(r,this.audioTrack.trackList):this.audioTrack&&r.push(this.audioTrack),r.push(...this.suspendTracks),r}async addTracks(r){let s=kt;if(this.connectionState==="connecting")try{return await this.createWaitConnectionConnectedPromise(),await this.addTracks(r)}catch{throw new L(D.OPERATION_ABORTED,"publish abort")}var c=!1;let u=this.getAllTracks();r=zg(r=Qe(r).call(r,A=>Ge(u).call(u,A)===-1));for(let A=0;A<r.length;A+=1){var h=r[A];if(!(h instanceof $u))return new L(D.INVALID_LOCAL_TRACK).throw();if(h instanceof Kt&&this.disabledVideoTrack){if(this.disabledVideoTrack!==h)return new L(D.EXIST_DISABLED_VIDEO_TRACK).throw();this.disabledVideoTrack=void 0}if(h instanceof Kt&&this.videoTrack)return new L(D.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw();if(h instanceof wr){if(this.audioTrack&&this.audioTrack._bypassWebAudio)throw R.error("One of the audio track was created with config bypassWebAudio set to true, there is no way to publish multiple audio tracks."),new L(D.CAN_NOT_PUBLISH_MULTIPLE_AUDIO_TRACKS);if(this.audioTrack instanceof $r)this.audioTrack.trackList.length===0&&await this.pc.setAudioRtpEncodingParameters({active:!0}),this.audioTrack.addAudioTrack(h);else if(s.webAudioMediaStreamDest)if(h._bypassWebAudio){if(this.audioTrack)throw R.error("Can not publish another audio track with bypassWebAudio set to true."),new L(D.CAN_NOT_PUBLISH_MULTIPLE_AUDIO_TRACKS);R.debug("[".concat(this.connectionId,"] audio track doesn't not pass through WebAudio, use original audio track to publish")),c=await this.addTrackWithPC(h)}else c=new $r,h.muted?this.suspendTracks.push(h):c.addAudioTrack(h),c=await this.addTrackWithPC(c);else R.debug("[".concat(this.connectionId,"] your browser does not support mixing track, use original audio track to publish")),c=await this.addTrackWithPC(h)}else h instanceof Kt&&this.isLowStreamConnection?(c=pm({},{width:160,height:120,framerate:15,bitrate:50},{},this.lowStreamParameter),s.supportDualStreamEncoding?(R.debug("[".concat(this.connectionId,"] creating low stream using rtp encoding.")),this.lowStreamEncoding=lS(c,h),h=h.clone({bitrateMax:c.bitrate,bitrateMin:c.bitrate})):(R.debug("[".concat(this.connectionId,"] creating low stream using canvas.")),h=vS(h,c),h=new Kt(h,{bitrateMax:c.bitrate,bitrateMin:c.bitrate})),h._hints.push(Yi.LOW_STREAM),c=await this.addTrackWithPC(h),this.bindTrackEvents(h)):(this.detecting=!0,ai(()=>{this.detecting=!1},8e3),c=await this.addTrackWithPC(h))}await this.updateControlMessage(),c&&await this.renegotiateWithGateway(),W(r).call(r,A=>this.bindTrackEvents(A))}async removeTracks(r,s){let c=this.getAllTracks();r=zg(r=Qe(r).call(r,A=>Ge(c).call(c,A)!==-1||A===this.disabledVideoTrack));let u=[];for(let A=0;A<r.length;A+=1){let f=r[A];if(this.unbindTrackEvents(f),this.audioTrack instanceof $r&&f instanceof wr)this.audioTrack.removeAudioTrack(f),Ps(this.suspendTracks,f),this.audioTrack.trackList.length===0&&(u.push(this.audioTrack),this.audioTrack=void 0);else if(f instanceof wr)u.push(f),this.audioTrack=void 0;else if(f instanceof Kt){if(s){if(this.disabledVideoTrack===f)return void(this.disabledVideoTrack=void 0)}else this.disabledVideoTrack=this.videoTrack;u.push(f),this.isLowStreamConnection&&f.close(),this.videoTrack=void 0}}if(this.videoTrack||this.audioTrack){if(u.length!==0){if(this.connectionState==="connecting")try{await this.createWaitConnectionConnectedPromise()}catch{return}for(let A of u){var h;R.debug(b(h="[".concat(this.connectionId,"] remove ")).call(h,A.trackMediaType," from pc")),await this.pc.removeTrack(A._mediaStreamTrack),r=Ye(),r.name==="Safari"&&r.version==="11"&&await A.renewMediaStreamTrack()}await this.renegotiateWithGateway()}}else await this.closeP2PConnection()}async updateControlMessage(){this.audioTrack instanceof $r&&this.connectionState==="connected"&&(this.audioTrack&&await yr(this,De.NEED_CONTROL,{type:"audio",muted:!this.audioTrack.isActive}),this.videoTrack&&await yr(this,De.NEED_CONTROL,{type:"video",muted:this.videoTrack.muted}))}async setSimulcastVideoRtpEncodingParameters(r){let s=this.pc.getSender("video");if(!s)throw new L(D.LOW_STREAM_ENCODING_ERROR,"Low stream has no video sender.");let c=s.getParameters();if(!c.encodings||!c.encodings[0])throw new L(D.LOW_STREAM_ENCODING_ERROR,"Low stream RtpEncodingParameters is empty.");this.videoTrack&&this.videoTrack._encoderConfig&&this.videoTrack._encoderConfig.bitrateMax&&200<this.videoTrack._encoderConfig.bitrateMax&&1<r.numSpatialLayers&&(c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:1e3*(this.videoTrack._encoderConfig.bitrateMax-50)},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:5e4,scaleResolutionDownBy:4}]),await s.setParameters(c)}startP2PConnection(){return new ce(async(r,s)=>{if(!this.audioTrack&&!this.videoTrack)return s(new L(D.UNEXPECTED_ERROR,"no track to publish"));let c=h=>{if(h==="connected"&&(this.off(De.CONNECTION_STATE_CHANGE,c),r()),h==="disconnected"){if(this.off(De.CONNECTION_STATE_CHANGE,c),this.disconnectedReason)return s(this.disconnectedReason);s(new L(D.OPERATION_ABORTED,"publish abort"))}};this.on(De.CONNECTION_STATE_CHANGE,c),this.disconnectedReason=void 0,this.connectionState="connecting",this._waitingSuccessResponse=!0,this.startTime=de();try{var u;!this.pc.audioTrack&&this.audioTrack&&await this.pc.addTrack(this.audioTrack._mediaStreamTrack),!this.pc.videoTrack&&this.videoTrack&&await this.pc.addTrack(this.videoTrack._mediaStreamTrack),Xt()&&ne.SIMULCAST&&this.videoTrack&&this.videoTrack._scalabiltyMode&&await this.addSimulcast4Firefox(this.videoTrack._scalabiltyMode);let h=await this.pc.createOfferSDP();ne.REMOVE_NEW_CODECS&&(h=this.codec==="vp9"?Lh(h,["av1"]):this.codec==="av1"?Lh(h,["vp9"]):Lh(h,["vp9","av1"]));let A=lm(h);this.videoTrack&&!gt(u=A.video).call(u,this.codec.toUpperCase())&&R.warning("current codec is not supported, support list: ".concat(A.video.join(","))),this.audioTrack&&this.audioTrack._encoderConfig&&(h=Mh(h,this.audioTrack._encoderConfig)),this.videoTrack&&!Xt()&&this.videoTrack._scalabiltyMode&&(this.codec!=="vp9"&&this.codec!=="vp8"?(this.videoTrack._scalabiltyMode.numSpatialLayers=1,this.videoTrack._scalabiltyMode.numTemporalLayers=1):(1<this.videoTrack._scalabiltyMode.numSpatialLayers||1<this.videoTrack._scalabiltyMode.numTemporalLayers)&&(h=dm(h,this.codec,this.videoTrack._scalabiltyMode)),R.debug("spatial layers: ",this.videoTrack._scalabiltyMode.numSpatialLayers)),await this.pc.setOfferSDP(h),this.audioTrack instanceof $r&&this.pc.onOfferSettled({videoActive:this.videoTrack&&!this.videoTrack.muted,audioActive:this.audioTrack&&this.audioTrack.isActive}),this.videoTrack&&this.setRtpSenderParametersByTrackConfig(this.videoTrack),R.debug("[".concat(this.connectionId,"] create and set offer success")),u={messageType:"OFFER",sdp:h,offererSessionId:104,retry:!0},kt.supportDualStreamEncoding&&this.isLowStreamConnection&&this.lowStreamEncoding&&this.videoTrack&&await this.setLowStreamEncoding(this.lowStreamEncoding,this.videoTrack),this.videoTrack&&!Xt()&&ne.SIMULCAST&&this.videoTrack._scalabiltyMode&&this.setSimulcastVideoRtpEncodingParameters(this.videoTrack._scalabiltyMode);let f=await yr(this,De.NEED_ANSWER,u),m=this.updateAnswerSDP(f.sdp);await this.pc.setAnswerSDP(m),R.debug("[".concat(this.connectionId,"] set answer success")),await this.icePromise,this.connectionState="connected",this.startUploadStats()}catch(h){this.off(De.CONNECTION_STATE_CHANGE,c),this.connectionState="disconnected",this.reportPublishEvent(!1,h.code),R.error("[".concat(this.connectionId,"] connection error"),h.toString()),s(h)}})}reportPublishEvent(r,s,c){var u;this._waitingSuccessResponse=!1,z.publish(this.joinInfo.sid,{lts:this.startTime,succ:r,ec:s,audioName:this.audioTrack&&(this.audioTrack instanceof $r?this.audioTrack.getSubTrackLabels().join(","):this.audioTrack.getTrackLabel()),videoName:this.videoTrack&&this.videoTrack.getTrackLabel(),screenshare:!(!this.videoTrack||Ge(u=this.videoTrack._hints).call(u,Yi.SCREEN_TRACK)===-1),audio:!!this.audioTrack,video:!!this.videoTrack,p2pid:this.pc.ID,publishRequestid:this.ID,extend:c})}async closeP2PConnection(r){let s=this.getAllTracks();var c;W(s).call(s,u=>{this.unbindTrackEvents(u)}),this.isLowStreamConnection&&this.videoTrack&&this.videoTrack.close(),this.videoTrack=void 0,this.audioTrack instanceof $r&&(W(c=this.audioTrack.trackList).call(c,u=>{this.audioTrack.removeAudioTrack(u)}),this.audioTrack.close()),this.audioTrack=void 0,this.stopUploadStats(),this.statsCollector.removeConnection(this.connectionId),await this.closePC(r),this.connectionState="disconnected",this.removeAllListeners()}getNetworkQuality(){var r,s=this.pc.getStats();if(!s.videoSend[0]&&!s.audioSend[0])return 1;var c=Ls(this,De.NEED_SIGNAL_RTT),u=s.videoSend[0]?s.videoSend[0].rttMs:void 0;let h=s.audioSend[0]?s.audioSend[0].rttMs:void 0;return u=u&&h?(u+h)/2:u||h,c=70*s.sendPacketLossRate/50+.3*((u&&c?(u+c)/2:u||c)||0)/1500,c=.17>c?1:.36>c?2:.59>c?3:.1>c?4:5,this.videoTrack&&this.videoTrack._encoderConfig&&Ge(r=this.videoTrack._hints).call(r,Yi.SCREEN_TRACK)===-1&&(r=this.videoTrack._encoderConfig.bitrateMax,s=s.bitrate.actualEncoded,r&&s)?(s=(1e3*r-s)/(1e3*r),wR[.15>s?0:.3>s?1:.45>s?2:.6>s?3:4][c]):c}handleUpdateBitrateLimit(r){this.videoTrack&&this.videoTrack.setBitrateLimit(r)}async setAudioTrackMuteState(r,s){if(!(this.audioTrack instanceof $r))return void R.debug("[".concat(this.connectionId,"] set audio mute in unsupported environment"));let c=this.audioTrack;try{if(r){var u;c.removeAudioTrack(s),c.trackList.length===0&&(R.debug(b(u="[".concat(this.connectionId,"] set audio encoding active, id: ")).call(u,s.getTrackId(),", state: ",!1)),await this.pc.setAudioRtpEncodingParameters({active:!1})),this.suspendTracks.push(s)}else await this.pc.setAudioRtpEncodingParameters({active:!0}),c.addAudioTrack(s),Ps(this.suspendTracks,s)}catch(A){var h;R.warning(b(h="[".concat(this.connectionId,"] set audio muted error ")).call(h,A,", fallback to set enabled"))}await yr(this,De.NEED_CONTROL,{type:"audio",muted:!(!this.audioTrack||this.audioTrack.isActive)})}async setVideoTrackMuteState(r){let s=!r,c=!1;if(Ye().name===ze.FIREFOX)c=!0;else try{var u,h;R.debug(b(u=b(h="[".concat(this.connectionId,"] set video encoding active, id: ")).call(h,this.videoTrack&&this.videoTrack.getTrackId(),", state: ")).call(u,s)),await this.pc.setVideoRtpEncodingParameters({active:s})}catch(I){var A;R.warning(b(A="[".concat(this.connectionId,"] set video encoding active error ")).call(A,I,", fallback to set enabled")),c=!0}var f,m;c&&this.videoTrack&&(R.debug(b(f=b(m="[".concat(this.connectionId,"] set video encoding active fallback to enabled on firefox, type: ")).call(m,this.videoTrack&&this.videoTrack.getTrackId(),", state: ")).call(f,s)),this.videoTrack.getMediaStreamTrack().enabled=s),this.lowStreamConnection&&this.lowStreamConnection.setVideoTrackMuteState(r),!this.isLowStreamConnection&&await yr(this,De.NEED_CONTROL,{type:"video",muted:r})}uploadStats(r,s){let c=this.audioTrack?function(f,m){const I=f.audioSend[0];return I?(f={id:er(10,""),timestamp:new Date(f.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:I.ssrc.toString()},f.A_astd=m._originMediaStreamTrack.enabled&&m._mediaStreamTrack.enabled?"0":"1",I.inputLevel?f.A_ail=Math.round(100*I.inputLevel).toString():f.A_ail=Math.round(100*m._source.getAccurateVolumeLevel()).toString(),f.A_apil=Math.round(100*m._source.getAccurateVolumeLevel()).toString(),f):null}(r,this.audioTrack):void 0,u=this.videoTrack?function(f,m){const I=f.videoSend[0];if(!I)return null;switch(f={id:er(10,""),timestamp:new Date(f.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:I.ssrc.toString()},f.A_vstd=m._originMediaStreamTrack&&!m._originMediaStreamTrack.enabled||!m._mediaStreamTrack.enabled?"1":"0",I.sentFrame&&(f.A_fhs=I.sentFrame.height.toString(),f.A_frs=I.sentFrame.frameRate.toString(),f.A_fws=I.sentFrame.width.toString()),I.adaptionChangeReason){case"none":f.A_ac="0";break;case"cpu":f.A_ac="1";break;case"bandwidth":f.A_ac="2";break;case"other":f.A_ac="3"}return f.A_nr=I.nacksCount.toString(),I.avgEncodeMs&&(f.A_aem=I.avgEncodeMs.toFixed(0).toString()),f}(r,this.videoTrack):void 0,h=Wg(r,s),A=function(f){const m={id:"bweforvideo",timestamp:new Date(f.timestamp).toISOString(),type:"VideoBwe"};return f.bitrate.retransmit&&(m.A_rb=f.bitrate.retransmit.toString()),f.bitrate.targetEncoded&&(m.A_teb=f.bitrate.targetEncoded.toString()),m.A_aeb=f.bitrate.actualEncoded.toString(),m.A_tb=f.bitrate.transmit.toString(),f.sendBandwidth!==void 0&&(m.A_asb=f.sendBandwidth.toString()),m}(r);c&&ii(()=>this.emit(De.NEED_UPLOAD,Ni.PUBLISH_STATS,c)),u&&ii(()=>this.emit(De.NEED_UPLOAD,Ni.PUBLISH_STATS,pm({},u,{},h))),A&&ii(()=>this.emit(De.NEED_UPLOAD,Ni.PUBLISH_STATS,A))}uploadSlowStats(r){let s=Wg(r);s&&ii(()=>this.emit(De.NEED_UPLOAD,Ni.PUBLISH_STATS,s))}uploadRelatedStats(r){let s=function(c){return(c=c.videoSend[0])?{mediaType:"video",isVideoMute:!1,frameRateInput:c.inputFrame&&c.inputFrame.frameRate.toString(),frameRateSent:c.sentFrame&&c.sentFrame.frameRate.toString(),googRtt:c.rttMs.toString()}:null}(r);s&&(s.isVideoMute=!(!this.videoTrack||!this.videoTrack.muted),ii(()=>{this.emit(De.NEED_UPLOAD,Ni.PUBLISH_RELATED_STATS,s)}))}async addSimulcast4Firefox(r){if(Xt()&&this.videoTrack&&this.videoTrack._encoderConfig&&this.videoTrack._encoderConfig.bitrateMax&&200<this.videoTrack._encoderConfig.bitrateMax&&1<r.numSpatialLayers&&this.codec==="vp8"&&(r=this.pc.getSender("video"))){let s=r.getParameters();R.debug("getParameters : ",s),s||R.error("[".concat(this.connectionId,"] get sender parameter error.")),s.encodings=[{rid:"m",active:!0,maxBitrate:5e4,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:1e3*(this.videoTrack._encoderConfig.bitrateMax-50)}],await r.setParameters(s),R.debug("setParameters : ",s)}}bindTrackEvents(r){var s;r.addListener(Me.NEED_RESET_REMOTE_SDP,cr(s=this.handleResetRemoteSdp).call(s,this)),this.isLowStreamConnection||(r instanceof wr?(r.addListener(Me.GET_STATS,this.handleGetLocalAudioStats),r.addListener(Me.NEED_CLOSE,this.handleCloseAudioTrack),r.addListener(Me.SET_AUDIO_TRACK_MUTED,this.handleMuteAudioTrack)):r instanceof Kt&&(r.addListener(Me.GET_STATS,this.handleGetLocalVideoStats),r.addListener(Me.NEED_CLOSE,this.handleCloseVideoTrack),r.addListener(Me.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),r.addListener(Me.SET_VIDEO_TRACK_MUTED,this.handleMuteVideoTrack)),r.addListener(Me.NEED_RENEGOTIATE,this.handleStreamRenegotiate),r.addListener(Me.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.addListener(Me.NEED_SESSION_ID,this.handleGetSessionID))}unbindTrackEvents(r){this.isLowStreamConnection||(r instanceof wr?(r.off(Me.GET_STATS,this.handleGetLocalAudioStats),r.off(Me.NEED_CLOSE,this.handleCloseAudioTrack),r.off(Me.SET_AUDIO_TRACK_MUTED,this.handleMuteAudioTrack)):r instanceof Kt&&(r.off(Me.GET_STATS,this.handleGetLocalVideoStats),r.off(Me.NEED_CLOSE,this.handleCloseVideoTrack),r.off(Me.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),r.off(Me.SET_VIDEO_TRACK_MUTED,this.handleMuteVideoTrack)),r.off(Me.NEED_RENEGOTIATE,this.handleStreamRenegotiate),r.off(Me.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.off(Me.NEED_SESSION_ID,this.handleGetSessionID))}async addTrackWithPC(r){if(this.connectionState==="connecting")return new L(D.INVALID_OPERATION,"last publish operation has not finished").throw();let s=this.videoTrack,c=!1;return this.audioTrack&&r instanceof $r?(this.audioTrack=r,R.debug("[".concat(this.connectionId,"] replace pc audio track")),c=await this.pc.replaceTrack(r._mediaStreamTrack)):this.videoTrack&&r instanceof Kt?(this.videoTrack=r,R.debug("[".concat(this.connectionId,"] replace pc video track")),c=await this.pc.replaceTrack(r._mediaStreamTrack)):r instanceof wr?(this.audioTrack=r,R.debug("[".concat(this.connectionId,"] add audio track to pc")),await this.pc.addTrack(r._mediaStreamTrack),c=!0):r instanceof Kt&&(this.videoTrack=r,R.debug("[".concat(this.connectionId,"] add video track to pc")),await this.pc.addTrack(r._mediaStreamTrack),c=!0),this.connectionState==="connected"&&this.videoTrack!==s&&this.videoTrack&&await this.setRtpSenderParametersByTrackConfig(this.videoTrack),this.connectionState!=="disconnected"&&c}handleResetRemoteSdp(){return new ce((r,s)=>{var c;R.info("[pc-".concat(this.pc.ID,"] start reset remote sdp"));let u=this.pc.getOfferSDP();var h=this.pc.getAnswerSDP();if(!h||!u)return r();h=h.sdp;let A;this.videoTrack&&this.videoTrack._encoderConfig&&Ge(c=this.videoTrack._hints).call(c,Yi.SCREEN_TRACK)===-1&&(A=function(f,m){var I,E;let _=m.bitrateMin;m=m.bitrateMax;let S=cr(I=RegExp.prototype.test).call(I,/^([a-z])=(.*)/);if(f=Qe(E=f.split(/(\r\n|\r|\n)/)).call(E,S),m){let k="AS";Ye().name===ze.FIREFOX&&(m=1e3*(m>>>0),k="TIAS"),E=pd(f).call(f,B=>gt(B).call(B,k));var N;0<E&&(f[E]=b(N="b=".concat(k,":")).call(N,m))}return _&&(N=pd(f).call(f,k=>gt(k).call(k,"x-google-min-bitrate")),0<N&&(f[N]=f[N].replace(/x-google-min-bitrate=(.*)/,"x-google-min-bitrate=".concat(_)))),f.join(`\r
`)+`\r
`}(h,this.videoTrack._encoderConfig)),h!==A?this.pc.setOfferSDP(u.sdp).then(()=>{if(A)return this.pc.setAnswerSDP(A)}).then(r).catch(f=>{var m;R.error(b(m="[pc-".concat(this.pc.ID,"] reset remote sdp error, ")).call(m,f)),s(f)}):R.debug("[pc-".concat(this.pc.ID,"] remote sdp have no not changed"))})}async setRtpSenderParametersByTrackConfig(r){if(!kt.supportSetRtpSenderParameters)return void R.debug("[".concat(this.connectionId,"] do not support set pc rtp sender, skip"));let s={},c="balanced";r._optimizationMode==="motion"?c="maintain-framerate":r._optimizationMode==="detail"&&(c="maintain-resolution"),R.debug("[".concat(this.connectionId,"] set pc rtp sender"),s,c),await this.pc.setRtpSenderParameters(s,c)}updateAnswerSDP(r){var s,c;return r=r.replace(/a=x-google-flag:conference\r\n/g,""),this.videoTrack&&Ge(s=this.videoTrack._hints).call(s,Yi.SCREEN_TRACK),this.videoTrack&&this.videoTrack._encoderConfig&&Ge(c=this.videoTrack._hints).call(c,Yi.SCREEN_TRACK)===-1&&(r=function(u,h,A){let f=kt;var m=A.bitrateMin;A=A.bitrateMax;let I=u.match(/m=video.*\r\n/)||u.match(/m=video.*\n/);if(I&&0<I.length&&f.supportMinBitrate&&m&&(h=vI(u,h)))if(ne.SIMULCAST){var E,_;m=A?.7*A:300,u=u.replace(I[0],b(E=b(_="".concat(I[0],"a=fmtp:")).call(_,h," x-google-start-bitrate=")).call(E,m,`\r
`))}else{var S,N;u=u.replace(I[0],b(S=b(N="".concat(I[0],"a=fmtp:")).call(N,h," x-google-min-bitrate=")).call(S,m,`\r
`))}if(I&&0<I.length&&A){var k,B;E="AS",Ye().name===ze.FIREFOX&&(A=1e3*(A>>>0),E="TIAS"),u=u.replace(I[0],b(k=b(B="".concat(I[0],"b=")).call(B,E,":")).call(k,A,`\r
`))}return u}(r,this.codec,this.videoTrack._encoderConfig)),this.audioTrack&&this.audioTrack._encoderConfig&&(r=Mh(r,this.audioTrack._encoderConfig)),r=function(u){let h=Ye();return h.name!==ze.SAFARI&&h.os!==Lr.IOS?u:u.replace(/a=.*video-orientation\r\n/g,"")}(r)}createPC(){this.pc=new aI({turnServer:this.joinInfo.turnServer}),this.updateICEPromise()}async closePC(r){return this.pc.onICEConnectionStateChange=void 0,this.pc.close(),!r&&await yr(this,De.NEED_UNPUB)}onPCDisconnected(r){this.reportPublishEvent(!1,r.code)}async setLowStreamEncoding(r,s){try{let c=await this.pc.setVideoRtpEncodingParameters(r),u=s.getMediaStreamTrack();if(r.scaleResolutionDownBy&&c.encodings[0].scaleResolutionDownBy!==r.scaleResolutionDownBy){let h=s._videoHeight||u.getSettings().height,A=s._videoWidth||u.getSettings().width;h&&A&&await u.applyConstraints({height:h/r.scaleResolutionDownBy,width:A/r.scaleResolutionDownBy})}r.maxFramerate&&c.encodings[0].maxFramerate!==r.maxFramerate&&await u.applyConstraints({frameRate:r.maxFramerate})}catch(c){throw c instanceof L?c:new L(D.LOW_STREAM_ENCODING_ERROR,c.message)}}}class II extends WE{constructor(r,s,c,u){var h,A;super(r,b(h=b(A="track-".concat(r.kind,"-")).call(A,s,"-")).call(h,u));this._isDestroyed=!1,this._userId=s,this._uintId=c}getUserId(){return this._userId}_updateOriginMediaStreamTrack(r){this._mediaStreamTrack=this._originMediaStreamTrack=r,this._updatePlayerSource()}_destroy(){this._isDestroyed=!0,R.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}}class Il extends II{constructor(r,s,c,u){super(r,s,c,u);this.trackMediaType="video",this.updateMediaStreamTrackResolution()}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Qr.PLAYING)}getStats(){return Hc(()=>{R.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Ls(this,Me.GET_STATS)||Ph({},Tp)}play(r,s={}){let c=z.reportApiInvoke(null,{tag:Re.TRACER,name:we.REMOTE_VIDEO_TRACK_PLAY,options:[this.getTrackId(),typeof r=="string"?r:"HTMLElement",s]});if(typeof r=="string"){let h=document.getElementById(r);var u;h?r=h:(R.warning(b(u="[".concat(this.getTrackId(),'] can not find "#')).call(u,r,'" element, use document.body')),r=document.body)}R.debug("[".concat(this.getTrackId(),"] start video playback"),fe(s)),r=Ph({fit:"cover"},s,{trackId:this.getTrackId(),element:r}),this._player?this._player.updateConfig(r):(this._player=new hI(r),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.emit(al.FIRST_FRAME_DECODED)}),this._player.play(),c.onSuccess()}stop(){let r=z.reportApiInvoke(null,{tag:Re.TRACER,name:we.REMOTE_VIDEO_TRACK_STOP,options:[this.getTrackId()]});if(!this._player)return r.onSuccess();this._player.destroy(),this._player=void 0,R.debug("[".concat(this.getTrackId(),"] stop video playback")),r.onSuccess()}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){Jg(this._originMediaStreamTrack).then(([r,s])=>{this._videoHeight=s,this._videoWidth=r}).catch(td)}_updatePlayerSource(){R.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}}class Cl extends II{constructor(r,s,c,u){super(r,s,c,u);this.trackMediaType="audio",this._useAudioElement=!0,this._volume=100,this._source=new JE(r,!0),this._source.once(ki.RECEIVE_TRACK_BUFFER,()=>{this.emit(al.FIRST_FRAME_DECODED)})}get isPlaying(){return this._useAudioElement?li.isPlaying(this.getTrackId()):this._source.isPlayed}setAudioFrameCallback(r,s=4096){if(!r)return this._source.removeAllListeners(ki.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(s),this._source.removeAllListeners(ki.ON_AUDIO_BUFFER),this._source.on(ki.ON_AUDIO_BUFFER,c=>r(c))}setVolume(r){let s=z.reportApiInvoke(null,{tag:Re.TRACER,name:we.REMOTE_AUDIO_SET_VOLUME,options:[this.getTrackId(),r]},300);this._volume=r,this._useAudioElement?li.setVolume(this.getTrackId(),r):this._source.setVolume(r/100),s.onSuccess()}async setPlaybackDevice(r){let s=z.reportApiInvoke(null,{tag:Re.TRACER,name:we.REMOTE_AUDIO_SET_OUTPUT_DEVICE,options:[this.getTrackId(),r]});if(!this._useAudioElement)throw new L(D.NOT_SUPPORTED,"your browser does not support setting the audio output device");try{await li.setSinkID(this.getTrackId(),r)}catch(c){throw s.onError(c),c}s.onSuccess()}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Hc(()=>{R.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Ls(this,Me.GET_STATS)||Ph({},Sp)}play(){let r=z.reportApiInvoke(null,{tag:Re.TRACER,name:we.REMOTE_AUDIO_TRACK_PLAY,options:[this.getTrackId()]});R.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(R.debug("[".concat(this.getTrackId(),"] use audio element to play")),li.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play(),r.onSuccess()}stop(){let r=z.reportApiInvoke(null,{tag:Re.TRACER,name:we.REMOTE_AUDIO_TRACK_STOP,options:[this.getTrackId()]});R.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?li.stop(this.getTrackId()):this._source.stop(),r.onSuccess()}_destroy(){super._destroy(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){R.debug("[".concat(this.getTrackId(),"] update player source track")),this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&li.updateTrack(this.getTrackId(),this._mediaStreamTrack)}}class Cw extends dI{constructor(r,s,c,u){super(c,r.uid);this.type="sub",this.unusedTracks=[],this.onTrack=h=>{var A,f;if(h.kind==="audio"&&!this.subscribeOptions.audio||h.kind==="video"&&!this.subscribeOptions.video)return this.unusedTracks.push(h),void R.debug(b(f="[".concat(this.connectionId,"] unused ontrack event, kind: ")).call(f,h.kind));R.debug(b(A="[".concat(this.connectionId,"] emit pc ontrack after subscribe ")).call(A,h.kind),h),A=h.kind==="audio"?this.user._audioTrack:this.user._videoTrack;var m,I;A?A._updateOriginMediaStreamTrack(h):h.kind==="audio"?(this.pc._statsFilter.setIsFirstAudioDecoded(!1),this.user._audioTrack=new Cl(h,this.getUserId(),this.user._uintid,this.joinInfo.clientId),R.info(b(m="[".concat(this.connectionId,"] create remote audio track: ")).call(m,this.user._audioTrack.getTrackId())),this.bindTrackEvents(this.user._audioTrack)):(this.user._videoTrack=new Il(h,this.getUserId(),this.user._uintid,this.joinInfo.clientId),R.info(b(I="[".concat(this.connectionId,"] create remote video track: ")).call(I,this.user._videoTrack.getTrackId())),this.bindTrackEvents(this.user._videoTrack))},this.handleGetRemoteAudioStats=h=>{h(this.statsCollector.getRemoteAudioTrackStats(this.connectionId))},this.handleGetRemoteVideoStats=h=>{h(this.statsCollector.getRemoteVideoTrackStats(this.connectionId))},this.handleGetSessionID=h=>{h(this.joinInfo.sid)},this.user=r,this.statsCollector=s,this.statsCollector.addRemoteConnection(this),this.subscribeOptions=u}async startP2PConnection(){return new ce(async(r,s)=>{let c=m=>{if(m==="connected"&&(z.subscribe(this.joinInfo.sid,{lts:this.startTime,succ:!0,video:this.subscribeOptions.video,audio:this.subscribeOptions.audio,peerid:this.user.uid,ec:null,subscribeRequestid:this.ID,p2pid:this.pc.ID}),this.off(De.CONNECTION_STATE_CHANGE,c),r()),m==="disconnected"){if(this.off(De.CONNECTION_STATE_CHANGE,c),this.disconnectedReason)return s(this.disconnectedReason);s(new L(D.OPERATION_ABORTED,"subscribe abort"))}};if(this.on(De.CONNECTION_STATE_CHANGE,c),this.disconnectedReason=void 0,this.connectionState="connecting",this.startTime=de(),!this.subscribeOptions)return void s(new L(D.UNEXPECTED_ERROR,"no subscribe options"));let u=new MediaStream,h=new ce(m=>{this.pc.onTrack=(I,E)=>{var _,S;if(I.kind==="audio"&&!this.subscribeOptions.audio||I.kind==="video"&&!this.subscribeOptions.video)return this.unusedTracks.push(I),void R.debug(b(S="[".concat(this.connectionId,"] unused ontrack event ")).call(S,I.kind));u.addTrack(I),S={audio:0<u.getAudioTracks().length,video:0<u.getVideoTracks().length},R.debug(b(_="[".concat(this.connectionId,"] subscribe ontrack: ")).call(_,I.kind),E,I);e:{I=this.subscribeOptions;var N,k;for(E=ol(N=dt(S)).call(N),N=ol(k=dt(I)).call(k),k=0;k<E.length;k+=1){if(E[k]!==N[k]){S=!1;break e}if(S[E[k]]!==I[E[k]]){S=!1;break e}}S=!0}S&&(this.pc.onTrack=this.onTrack,R.debug("[".concat(this.connectionId,"] get all subscribed tracks")),m(u))}});try{let m=function(N){return Ye().name!==ze.FIREFOX?N:N.replace("/recvonly http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"," http://www.webrtc.org/experiments/rtp-hdrext/playout-delay")}(um(await this.pc.createOfferSDP()));await this.pc.setOfferSDP(m),R.debug("[".concat(this.connectionId,"] create and set offer success"));let I=await yr(this,De.NEED_ANSWER,{messageType:"OFFER",sdp:m,offererSessionId:104,retry:!0});await this.pc.setAnswerSDP(um(I.sdp)),R.debug("[".concat(this.connectionId,"] set answer success"));let E=await ce.all([h,this.icePromise]),_=E[0].getAudioTracks()[0],S=E[0].getVideoTracks()[0];var A,f;_&&(this.user._audioTrack?this.user._audioTrack._updateOriginMediaStreamTrack(_):(this.user._audioTrack=new Cl(_,this.getUserId(),this.user._uintid,this.joinInfo.clientId),R.info(b(A="[".concat(this.connectionId,"] create remote audio track: ")).call(A,this.user._audioTrack.getTrackId())),this.bindTrackEvents(this.user._audioTrack))),S&&(this.user._videoTrack?this.user._videoTrack._updateOriginMediaStreamTrack(S):(this.user._videoTrack=new Il(S,this.getUserId(),this.user._uintid,this.joinInfo.clientId),R.info(b(f="[".concat(this.connectionId,"] create remote video track: ")).call(f,this.user._videoTrack.getTrackId())),this.bindTrackEvents(this.user._videoTrack))),this.connectionState="connected",this.startUploadStats()}catch(m){this.off(De.CONNECTION_STATE_CHANGE,c),this.connectionState="disconnected",z.subscribe(this.joinInfo.sid,{lts:this.startTime,succ:!1,video:this.subscribeOptions.video,audio:this.subscribeOptions.audio,peerid:this.user.uid,ec:m.code,subscribeRequestid:this.ID,p2pid:this.pc.ID}),s(m)}})}async closeP2PConnection(r){this.connectionState!=="disconnected"&&(this.stopUploadStats(),this.statsCollector.removeConnection(this.connectionId),this.connectionState="disconnected",await this.setSubscribeOptions({audio:!1,video:!1}),await this.closePC(r),this.removeAllListeners())}getNetworkQuality(){var r=this.pc.getStats();if(!r.audioRecv[0]&&!r.videoRecv[0])return 1;var s=Ls(this,De.NEED_SIGNAL_RTT),c=r.rtt;s=(c&&s?(c+s)/2:c||s)||0,c=r.audioRecv[0]?r.audioRecv[0].jitterMs:void 0,r=r.recvPacketLossRate;let u=70*r/50+.3*s/1500;return c&&(u=60*r/50+.2*s/1500+.2*c/400),.1>u?1:.17>u?2:.36>u?3:.59>u?4:5}uploadStats(r){let s=this.user.audioTrack?function(u,h){const A=u.audioRecv[0];return A?(u={id:er(10,""),timestamp:new Date(u.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:A.ssrc.toString()},u.bytesReceived=A.bytes.toString(),u.packetsLost=A.packetsLost.toString(),u.packetsReceived=A.packets.toString(),A.outputLevel?u.A_aol=Math.round(100*A.outputLevel).toString():u.A_aol=Math.round(100*h._source.getAccurateVolumeLevel()).toString(),u.A_apol=Math.round(100*h._source.getAccurateVolumeLevel()).toString(),h&&(u.A_artd=h._originMediaStreamTrack.enabled&&h._mediaStreamTrack.enabled?"0":"1"),u.A_jr=A.jitterMs.toString(),u.A_jbm=Math.floor(A.jitterBufferMs).toString(),u.A_cdm=Math.floor(A.jitterBufferMs).toString(),u):null}(r,this.user.audioTrack):void 0,c=this.user.videoTrack?function(u,h){const A=u.videoRecv[0];if(!A)return null;u={id:er(10,""),timestamp:new Date(u.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:A.ssrc.toString()};var f;return u.bytesReceived=A.bytes.toString(),u.packetsLost=A.packetsLost.toString(),u.packetsReceived=A.packets.toString(),A.framesRateFirefox&&(u.A_frr=A.framesRateFirefox.toString()),A.receivedFrame&&(u.A_frr=A.receivedFrame.frameRate.toString()),u.A_frd=A.decodeFrameRate.toString(),A.outputFrame&&(u.A_fro=A.outputFrame.frameRate.toString()),A.jitterBufferMs!==void 0&&(u.A_jbm=Math.floor(A.jitterBufferMs).toString()),A.currentDelayMs!==void 0&&(u.A_cdm=Math.floor(A.currentDelayMs).toString()),u.A_fs=A.firsCount.toString(),u.A_ns=A.nacksCount.toString(),u.A_ps=A.plisCount.toString(),h&&(u.A_vrtd=h._originMediaStreamTrack.enabled&&h._mediaStreamTrack.enabled?"0":"1"),h._player&&0<h._player.freezeTimeCounterList.length&&(u.A_vrft=Gr(f=h._player.freezeTimeCounterList).call(f,0,1)[0].toString()),u}(r,this.user.videoTrack):void 0;s&&ii(()=>this.emit(De.NEED_UPLOAD,Ni.SUBSCRIBE_STATS,s)),c&&ii(()=>this.emit(De.NEED_UPLOAD,Ni.SUBSCRIBE_STATS,c))}uploadSlowStats(r){}uploadRelatedStats(r,s){let c=this.pc._statsFilter.videoIsReady===!0,u=function(A,f,m){return A=A.audioRecv[0],A?(m=$a.isRemoteAudioFreeze(m),{mediaType:"audio",isAudioMute:!1,peerId:f,googJitterReceived:A.jitterMs.toString(),isFreeze:m,bytesReceived:A.bytes.toString(),packetsReceived:A.packets.toString(),packetsLost:A.packetsLost.toString(),frameReceived:A.receivedFrames.toString(),frameDropped:A.droppedFrames.toString()}):null}(r,this.getUserId(),this.user.audioTrack),h=function(A,f,m,I,E){return f=f.videoRecv[0],f?(A=$a.isRemoteVideoFreeze(E,f,I?I.videoRecv[0]:void 0)&&A,m={mediaType:"video",isVideoMute:!1,peerId:m,frameRateReceived:f.receivedFrame&&f.receivedFrame.frameRate.toString(),frameRateDecoded:f.decodedFrame&&f.decodedFrame.frameRate.toString(),isFreeze:A,bytesReceived:f.bytes.toString(),packetsReceived:f.packets.toString(),packetsLost:f.packetsLost.toString()},f.framesRateFirefox&&(m.frameRateDecoded=f.framesRateFirefox.toString(),m.frameRateReceived=f.framesRateFirefox.toString()),m):null}(c,r,this.getUserId(),s,this.user.videoTrack);u&&ii(()=>{this.emit(De.NEED_UPLOAD,Ni.SUBSCRIBE_RELATED_STATS,u)}),h&&ii(()=>{this.emit(De.NEED_UPLOAD,Ni.SUBSCRIBE_RELATED_STATS,h)})}emitOnTrackFromUnusedTracks(){if(this.subscribeOptions){var r=this.subscribeOptions.video;if(this.subscribeOptions.audio){var s;let u=Je(s=this.unusedTracks).call(s,h=>h.kind==="audio"&&h.readyState==="live");Ps(this.unusedTracks,u),u&&this.onTrack(u)}if(r){var c;r=Je(c=this.unusedTracks).call(c,u=>u.kind==="video"&&u.readyState==="live"),Ps(this.unusedTracks,r),r&&this.onTrack(r)}}}async setSubscribeOptions(r){var s,c,u,h;if(r.audio!==this.subscribeOptions.audio||r.video!==this.subscribeOptions.video){if(this.connectionState==="connecting")try{await this.createWaitConnectionConnectedPromise()}catch{throw new L(D.OPERATION_ABORTED,"can not update subscribe options, operation abort")}r.audio===this.subscribeOptions.audio&&r.video===this.subscribeOptions.video||(R.debug(b(s=b(c=b(u=b(h="[".concat(this.connectionId,"] update subscribe options [a: ")).call(h,this.subscribeOptions.audio,", v: ")).call(u,this.subscribeOptions.video,"] -> [a: ")).call(c,r.audio,", v: ")).call(s,r.video,"]")),this.subscribeOptions=r,!r.audio&&this.user._audioTrack&&(this.unusedTracks.push(this.user._audioTrack._originMediaStreamTrack),this.user._audioTrack._destroy(),this.unbindTrackEvents(this.user._audioTrack),this.user._audioTrack=void 0),!r.video&&this.user._videoTrack&&(this.unusedTracks.push(this.user._videoTrack._originMediaStreamTrack),this.user._videoTrack._destroy(),this.unbindTrackEvents(this.user._videoTrack),this.user._videoTrack=void 0),this.emitOnTrackFromUnusedTracks())}}createPC(){this.pc=new cI({turnServer:this.joinInfo.turnServer}),this.pc.onFirstAudioDecoded=()=>{this.user.audioTrack&&this.user.audioTrack.emit(al.FIRST_FRAME_DECODED),z.firstRemoteFrame(this.joinInfo.sid,jr.FIRST_AUDIO_DECODE,Jt.FIRST_AUDIO_DECODE,{peer:this.user._uintid,subscribeElapse:de()-this.startTime,subscribeRequestid:this.ID,p2pid:this.pc.ID})},this.pc.onFirstAudioReceived=()=>{z.firstRemoteFrame(this.joinInfo.sid,jr.FIRST_AUDIO_RECEIVED,Jt.FIRST_AUDIO_RECEIVED,{peer:this.user._uintid,subscribeElapse:de()-this.startTime,subscribeRequestid:this.ID,p2pid:this.pc.ID})},this.pc.onFirstVideoDecoded=(r,s)=>{z.firstRemoteFrame(this.joinInfo.sid,jr.FIRST_VIDEO_DECODE,Jt.FIRST_VIDEO_DECODE,{peer:this.user._uintid,videowidth:r,videoheight:s,subscribeElapse:de()-this.startTime,subscribeRequestid:this.ID,p2pid:this.pc.ID})},this.pc.onFirstVideoReceived=()=>{z.firstRemoteFrame(this.joinInfo.sid,jr.FIRST_VIDEO_RECEIVED,Jt.FIRST_VIDEO_RECEIVED,{peer:this.user._uintid,subscribeElapse:de()-this.startTime,subscribeRequestid:this.ID,p2pid:this.pc.ID})},this.updateICEPromise()}async closePC(r){return this.pc.audioTrack&&this.pc.audioTrack.stop(),this.pc.videoTrack&&this.pc.videoTrack.stop(),this.pc.onTrack=void 0,this.pc.onICEConnectionStateChange=void 0,this.pc.close(),r?!1:await yr(this,De.NEED_UNSUB)}onPCDisconnected(r){z.subscribe(this.joinInfo.sid,{lts:this.startTime,succ:!1,video:this.subscribeOptions.video,audio:this.subscribeOptions.audio,peerid:this.user.uid,ec:r.code,subscribeRequestid:this.ID,p2pid:this.pc.ID})}bindTrackEvents(r){r instanceof Cl?r.addListener(Me.GET_STATS,this.handleGetRemoteAudioStats):r instanceof Il&&r.addListener(Me.GET_STATS,this.handleGetRemoteVideoStats)}unbindTrackEvents(r){r instanceof Cl?r.off(Me.GET_STATS,this.handleGetRemoteAudioStats):r instanceof Il&&r.off(Me.GET_STATS,this.handleGetRemoteVideoStats)}}class yw extends Wr{constructor(r,s,c,u){super();this.reconnectMode="retry",this.commandReqId=this.reqId=0,this.handleWebSocketOpen=()=>{this.reconnectMode="retry",this.startPingPong()},this.handleWebSocketMessage=h=>{if(h.data){h=JSON.parse(h.data);var A;h.requestId?this.emit(b(A="@".concat(h.requestId,"-")).call(A,h.sid),h):this.serviceMode===Zt.INJECT?this.emit(Oi.INJECT_STREAM_STATUS,h):(z.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===Zt.TRANSCODE?1:2}),this.emit(Oi.PUBLISH_STREAM_STATUS,h))}},this.spec=s,this.token=r,this.serviceMode=u,this.websocket=new Hp("live-streaming",c),this.websocket.on(lt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(lt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(lt.REQUEST_NEW_URLS,(h,A)=>{yr(this,Oi.REQUEST_NEW_ADDRESS).then(h).catch(A)}),this.websocket.on(lt.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(r){return this.websocket.init(r)}async request(r,s,c,u){this.reqId+=1,r==="request"&&(this.commandReqId+=1);let h=this.commandReqId,A=this.reqId;if(!A||!this.websocket)throw new L(D.UNEXPECTED_ERROR);var f=Qh({command:r,sdkVersion:Hn==="4.7.3"?"0.0.1":Hn,seq:A,requestId:A,allocate:c,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(de()/1e3)},s);if(this.websocket.state==="closed")throw new L(D.WS_DISCONNECT);let m=()=>new ce((_,S)=>{this.websocket.once(lt.CLOSED,()=>S(new L(D.WS_ABORT))),this.websocket.once(lt.CONNECTED,_)});this.websocket.state!=="connected"&&await m(),f.clientRequest&&(f.clientRequest.workerToken=this.token);let I=new ce((_,S)=>{var N;const k=()=>{S(new L(D.WS_ABORT))};this.websocket.once(lt.RECONNECTING,k),this.websocket.once(lt.CLOSED,k),this.once(b(N="@".concat(A,"-")).call(N,this.spec.sid),B=>{_(B)})});u&&z.workerEvent(this.spec.sid,Qh({},u,{requestId:h,actionType:"request",payload:fe(s.clientRequest),serverCode:0,code:0}));let E=de();this.websocket.sendMessage(f),f=null;try{f=await I}catch(_){if(this.websocket.state==="closed")throw _;return await m(),await this.request(r,s,c)}return u&&z.workerEvent(this.spec.sid,Qh({},u,{requestId:h,actionType:"response",payload:fe(f.serverResponse),serverCode:f.code,success:f.code===200,responseTime:de()-E})),f.code!==200&&this.handleResponseError(f),f}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){let r=Hn==="4.7.3"?"0.0.1":Hn;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:r,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(de()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(r){switch(r.code){case Ft.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void R.warning("live stream response already exists stream");case Ft.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Ft.LIVE_STREAM_RESPONSE_BAD_STREAM:case Ft.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new L(D.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:r.code}).throw();case Ft.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(r.serverResponse.command==="UnpublishStream"||r.serverResponse.command==="UninjectStream")break;throw new L(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Ft.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new L(D.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:r.code}).throw();case Ft.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:var s=new L(D.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Oi.WARNING,s,r.serverResponse.url);case Ft.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:return s=new L(D.LIVE_STREAMING_WARN_FREQUENT_REQUEST),this.emit(Oi.WARNING,s,r.serverResponse.url);case Ft.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new L(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Ft.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new L(D.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:r.code}).throw();case Ft.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:return s=new L(D.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT),this.emit(Oi.WARNING,s,r.serverResponse.url);case Ft.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new L(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code}).throw();case Ft.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new L(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Ft.LIVE_STREAM_RESPONSE_WORKER_LOST:case Ft.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(r.serverResponse.command==="UnpublishStream"||r.serverResponse.command==="UninjectStream")break;throw new L(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Ft.ERROR_FAIL_SEND_MESSAGE:if(r.serverResponse.command==="UnpublishStream"||r.serverResponse.command==="UninjectStream")break;if(r.serverResponse.command==="UpdateTranscoding"||r.serverResponse.command==="ControlStream")return new L(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:r.code}).throw();throw new L(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Ft.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Ft.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Ft.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Ft.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new L(D.LIVE_STREAMING_CDN_ERROR,"",{code:r.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(td)},6e3)}}class _w extends Wr{constructor(r,s=Tr,c=Tr){super();this.retryTimeout=1e4,this.streamingTasks=new Ct,this.isStartingStreamingTask=!1,this.taskMutex=new Vo("live-streaming"),this.cancelToken=mo.CancelToken.source(),this.injectConfig=is({},jR),this.injectLoopTimes=0,this.lastTaskId=1,this.statusError=new Ct,this.spec=r,this.httpRetryConfig=c,this.wsRetryConfig=s}async setTranscodingConfig(r){var s;let c=is({},GR,{},r);var u,h;c.videoCodecProfile!==66&&c.videoCodecProfile!==77&&c.videoCodecProfile!==100&&(R.debug(b(u="[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ")).call(u,c.videoCodecProfile," -> 100")),c.videoCodecProfile=100),c.transcodingUsers||(c.transcodingUsers=c.userConfigs),c.transcodingUsers&&(c.transcodingUsers=Ie(h=c.transcodingUsers).call(h,S=>is({},VR,{},S,{zOrder:S.zOrder?S.zOrder+1:1}))),function(S){var N,k;S.width==null||It(S.width,"config.width",0,1e4),S.height==null||It(S.height,"config.height",0,1e4),S.videoBitrate==null||It(S.videoBitrate,"config.videoBitrate",1,1e6),S.videoFrameRate==null||It(S.videoFrameRate,"config.videoFrameRate"),S.lowLatency==null||fu(S.lowLatency,"config.lowLatency"),S.audioSampleRate==null||hn(S.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),S.audioBitrate==null||It(S.audioBitrate,"config.audioBitrate",1,128),S.audioChannels==null||hn(S.audioChannels,"config.audioChannels",[1,2,3,4,5]),S.videoGop==null||It(S.videoGop,"config.videoGop"),S.videoCodecProfile==null||hn(S.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),S.userCount==null||It(S.userCount,"config.userCount",0,17),S.backgroundColor==null||It(S.backgroundColor,"config.backgroundColor",0,16777215),S.userConfigExtraInfo==null||Vr(S.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),S.transcodingUsers&&S.transcodingUsers!=null&&(Eh(S.transcodingUsers,"config.transcodingUsers"),W(N=S.transcodingUsers).call(N,(B,P)=>{Ch(B.uid),B.x==null||It(B.x,"transcodingUser[".concat(P,"].x"),0,1e4),B.y==null||It(B.y,"transcodingUser[".concat(P,"].y"),0,1e4),B.width==null||It(B.width,"transcodingUser[".concat(P,"].width"),0,1e4),B.height==null||It(B.height,"transcodingUser[".concat(P,"].height"),0,1e4),B.zOrder==null||It(B.zOrder-1,"transcodingUser[".concat(P,"].zOrder"),0,100),B.alpha==null||It(B.alpha,"transcodingUser[".concat(P,"].alpha"),0,1,!1)})),S.watermark==null||yh(S.watermark,"watermark"),S.backgroundImage==null||yh(S.backgroundImage,"backgroundImage"),S.images&&S.images!=null&&(Eh(S.images,"config.images"),W(k=S.images).call(k,(B,P)=>{yh(B,"images[".concat(P,"]"))}))}(c),r=[];var A,f;if(c.images&&r.push(...Ie(A=c.images).call(A,S=>is({},Rp,{},S,{zOrder:255}))),c.backgroundImage&&(r.push(is({},Rp,{},c.backgroundImage,{zOrder:0})),delete c.backgroundImage),c.watermark&&(r.push(is({},Rp,{},c.watermark,{zOrder:255})),delete c.watermark),c.images=r,c.transcodingUsers&&(c.userConfigs=Ie(f=c.transcodingUsers).call(f,S=>is({},S)),c.userCount=c.transcodingUsers.length,delete c.transcodingUsers),A=Ie(s=c.userConfigs||[]).call(s,S=>typeof S.uid=="number"?ce.resolve(S.uid):kh(S.uid,this.spec,this.cancelToken.token,this.httpRetryConfig)),s=await ce.all(A),W(s).call(s,(S,N)=>{c.userConfigs&&c.userConfigs[N]&&(c.userConfigs[N].uid=S)}),this.transcodingConfig=c,this.connection)try{var m,I,E;let S=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Ie(m=Ji(Js(I=this.streamingTasks).call(I))).call(m,N=>N.taskId).join("#")});R.debug(b(E="[".concat(this.spec.clientId,"] update live transcoding config success, code: ")).call(E,S.code,", config:"),fe(this.transcodingConfig))}catch(S){var _;if(!S.data||!S.data.retry)throw S;S.data.changeAddress&&this.connection.tryNextAddress(),W(_=this.streamingTasks).call(_,N=>{R.warning("[".concat(this.spec.clientId,"] live streaming receive error"),S.toString(),"try to republish",N.url),this.startLiveStreamingTask(N.url,N.mode,S).then(()=>{var k;R.debug(b(k="[".concat(this.spec.clientId,"] live streaming republish ")).call(k,N.url," success"))}).catch(k=>{R.error("[".concat(this.spec.clientId,"] live streaming republish failed"),N.url,k.toString()),this.onLiveStreamError&&this.onLiveStreamError(N.url,k)})})}}setInjectStreamConfig(r,s){this.injectConfig=Zr({},this.injectConfig,r),this.injectLoopTimes=s}async startLiveStreamingTask(r,s,c){var u,h,A,f;if(Je(u=Ji(Js(h=this.streamingTasks).call(h))).call(u,I=>I.mode===Zt.INJECT)&&s===Zt.INJECT)return new L(D.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!this.transcodingConfig&&s===Zt.TRANSCODE)throw new L(D.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");if(u={command:"PublishStream",ts:de(),url:r,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0},R.debug(b(A=b(f="[".concat(this.spec.clientId,"] start live streaming ")).call(f,r,", mode: ")).call(A,s)),A=await this.taskMutex.lock(),!this.connection&&c)return void A();if(this.streamingTasks.get(r)&&!c)return A(),new L(D.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(s))}catch(I){throw A(),I}switch(s){case Zt.TRANSCODE:u.transcodingConfig=is({},this.transcodingConfig);break;case Zt.INJECT:u={cname:this.spec.cname,command:"InjectStream",sid:this.spec.sid,transcodingConfig:this.injectConfig,ts:de(),url:r,loopTimes:this.injectLoopTimes}}this.uapResponse&&this.uapResponse.vid&&(u.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0,f=this.lastTaskId++;try{var m;let I=new ce((_,S)=>{Tn(this.retryTimeout).then(()=>{if(c)return S(c);const N=this.statusError.get(r);return N?(this.statusError.delete(r),S(N)):void 0})}),E=await ce.race([this.connection.request("request",{clientRequest:u},!0,{url:r,command:"PublishStream",workerType:s===Zt.TRANSCODE?1:2,requestByUser:!c,tid:f.toString()}),I]);this.isStartingStreamingTask=!1,R.debug(b(m="[".concat(this.spec.clientId,"] live streaming started, code: ")).call(m,E.code)),this.streamingTasks.set(r,{clientRequest:u,mode:s,url:r,taskId:f}),A()}catch(I){if(A(),this.isStartingStreamingTask=!1,!I.data||!I.data.retry||c)throw I;return I.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(r,s,I)):await this.startLiveStreamingTask(r,s,I)}}stopLiveStreamingTask(r){return new ce((s,c)=>{let u=this.streamingTasks.get(r);if(!u||!this.connection)return new L(D.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();let h=u.mode;u.abortTask=()=>{R.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(r),s()},this.connection.request("request",{clientRequest:{command:h===Zt.INJECT?"UninjectStream":"UnpublishStream",url:u.url}},!1,{url:r,command:"UnPublishStream",workerType:h===Zt.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(A=>{var f;R.debug(b(f="[".concat(this.spec.clientId,"] stop live streaming success, code: ")).call(f,A.code)),this.streamingTasks.delete(r),this.streamingTasks.size===0&&h!==Zt.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),s(),h===Zt.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(5,this.spec.uid,r)}).catch(c)})}async controlInjectStream(r,s,c,u){let h=this.streamingTasks.get(r);if(!h||!this.connection||h.mode!==Zt.INJECT)throw new L(D.INVALID_OPERATION,"can not find inject stream task to control");return(await this.connection.request("request",{clientRequest:{command:"ControlStream",url:r,control:s,audioVolume:c,position:u}})).serverResponse}resetAllTask(){var r;let s=Ji(Js(r=this.streamingTasks).call(r));this.terminate();for(let c of s)this.startLiveStreamingTask(c.url,c.mode).catch(u=>{this.onLiveStreamError&&this.onLiveStreamError(c.url,u)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Ct,this.isStartingStreamingTask=!1,this.statusError=new Ct,this.cancelToken=mo.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(r){if(this.connection)throw new L(D.UNEXPECTED_ERROR,"live streaming connection has already connected");let s=await yr(this,za.REQUEST_WORKER_MANAGER_LIST,r);return this.uapResponse=s,this.connection=new yw(s.workerToken,this.spec,this.wsRetryConfig,r),this.connection.on(Oi.WARNING,(c,u)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(u,c)),this.connection.on(Oi.PUBLISH_STREAM_STATUS,c=>this.handlePublishStreamServer(c)),this.connection.on(Oi.INJECT_STREAM_STATUS,c=>this.handleInjectStreamServerStatus(c)),this.connection.on(Oi.REQUEST_NEW_ADDRESS,(c,u)=>{if(!this.connection)return u(new L(D.UNEXPECTED_ERROR,"can not get new live streaming address list"));yr(this,za.REQUEST_WORKER_MANAGER_LIST,r).then(h=>{this.uapResponse=h,c(h.addressList)}).catch(u)}),await this.connection.init(s.addressList),this.connection}handlePublishStreamServer(r){var s=r.serverStatus&&r.serverStatus.url||"empty_url";let c=this.streamingTasks.get(s),u=r.reason;switch(r.code){case Ft.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Ft.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Ft.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Ft.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:if(r=new L(D.LIVE_STREAMING_CDN_ERROR,"",{code:r.code}),c)return R.error(r.toString()),this.onLiveStreamError&&this.onLiveStreamError(s,r);if(!this.isStartingStreamingTask)break;this.statusError.set(s,r);case Ft.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:return r=new L(D.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,u),this.onLiveStreamWarning&&this.onLiveStreamWarning(s,r);case Ft.LIVE_STREAM_RESPONSE_WORKER_LOST:case Ft.LIVE_STREAM_RESPONSE_WORKER_QUIT:var h;if(this.connection){this.connection.tryNextAddress(),s=Ji(Js(h=this.streamingTasks).call(h));for(let A of s)A.abortTask?A.abortTask():(R.warning("[".concat(this.spec.clientId,"] publish stream status code"),r.code,"try to republish",A.url),this.startLiveStreamingTask(A.url,A.mode,new L(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code})).then(()=>{R.debug("[".concat(this.spec.clientId,"] republish live stream success"),A.url)}).catch(f=>{R.error(f.toString()),this.onLiveStreamError&&this.onLiveStreamError(A.url,f)}))}}}handleInjectStreamServerStatus(r){let s=Number(r.uid),c=r.serverStatus&&r.serverStatus.url;switch(r.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(0,s,c));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(1,s,c),void this.streamingTasks.delete(c);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(2,s,c),void this.streamingTasks.delete(c);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(10,s,c),void this.streamingTasks.delete(c);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(3,s,c),void this.streamingTasks.delete(c);default:return void R.debug("inject stream server status",r)}}hasUrl(r){return this.streamingTasks.has(r)}}class CI{constructor(){this.destChannelMediaInfos=new Ct}setSrcChannelInfo(r){Bg(r),this.srcChannelMediaInfo=r}addDestChannelInfo(r){Bg(r),this.destChannelMediaInfos.set(r.channelName,r)}removeDestChannelInfo(r){Ih(r),this.destChannelMediaInfos.delete(r)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}class Sw extends Wr{constructor(r,s,c){super();this.requestId=1,this.onOpen=()=>{this.emit("open"),this.startHeartBeatCheck()},this.onClose=u=>{this.emit("close"),this.dispose()},this.onMessage=u=>{if(u=JSON.parse(u.data),!u||u.command!=="serverResponse"||!u.requestId)return u&&u.command==="serverStatus"&&u.serverStatus&&u.serverStatus.command?(this.emit("status",u.serverStatus),void this.emit(u.serverStatus.command,u.serverStatus)):void 0;this.emit("req_".concat(u.requestId),u)},this.joinInfo=r,this.clientId=s,this.ws=new Hp("cross-channel-".concat(this.clientId),c),this.ws.on(lt.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(lt.CONNECTED,this.onOpen),this.ws.on(lt.ON_MESSAGE,this.onMessage),this.ws.on(lt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(r){let s=this.requestId++;return r.requestId=s,r.seq=s,this.ws.sendMessage(r),s}waitStatus(r){return new ce((s,c)=>{let u=window.setTimeout(()=>{c(new L(D.TIMEOUT,"wait status timeout, status: ".concat(r)))},5e3);this.once(r,h=>{window.clearTimeout(u),h.state&&h.state!==0?c(new L(D.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(r))):s(void 0)}),this.once("dispose",()=>{window.clearTimeout(u),c(new L(D.WS_ABORT))})})}async request(r){if(this.ws.state==="closed")throw new L(D.WS_DISCONNECT);let s=()=>new ce((u,h)=>{this.ws.once(lt.CLOSED,()=>h(new L(D.WS_ABORT))),this.ws.once(lt.CONNECTED,u)});this.ws.state!=="connected"&&await s();let c=this.sendMessage(r);if(r=await new ce((u,h)=>{const A=()=>{h(new L(D.WS_ABORT))};this.ws.once(lt.RECONNECTING,A),this.ws.once(lt.CLOSED,A),this.once("req_".concat(c),u),Tn(3e3).then(()=>{this.removeAllListeners("req_".concat(c)),this.ws.off(lt.RECONNECTING,A),this.ws.off(lt.CLOSED,A),h(new L(D.TIMEOUT,"cross channel ws request timeout"))})}),!r||r.code!==200)throw new L(D.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(fe(r)));return r}async connect(r){this.ws.removeAllListeners(lt.REQUEST_NEW_URLS),this.ws.on(lt.REQUEST_NEW_URLS,s=>{s(r)}),await this.ws.init(r)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(r){let s=this.requestId++;return r.requestId=s,this.ws.sendMessage(r),s}startHeartBeatCheck(){this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class Tw extends Wr{constructor(r,s,c,u){super();this.cancelToken=mo.CancelToken.source(),this.requestId=0,this._state="RELAY_STATE_IDLE",this.errorCode="RELAY_OK",this.onStatus=h=>{var A;R.debug(b(A="[".concat(this.clientId,"] ChannelMediaStatus: ")).call(A,fe(h))),h&&h.command&&(h.command==="onAudioPacketReceived"&&this.emit("event","PACKET_RECEIVED_AUDIO_FROM_SRC"),h.command==="onVideoPacketReceived"&&this.emit("event","PACKET_RECEIVED_VIDEO_FROM_SRC"),h.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode="SRC_TOKEN_EXPIRED",this.state="RELAY_STATE_FAILURE"),h.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode="DEST_TOKEN_EXPIRED",this.state="RELAY_STATE_FAILURE"))},this.onReconnect=async()=>{R.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event","NETWORK_DISCONNECTED"),this.state="RELAY_STATE_IDLE",this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(h=>{this.state!=="RELAY_STATE_IDLE"&&(R.error("auto restart channel media relay failed",h.toString()),this.errorCode="SERVER_CONNECTION_LOST",this.state="RELAY_STATE_FAILURE")})},this.joinInfo=r,this.clientId=s,this.signal=new Sw(this.joinInfo,this.clientId,c),this.httpRetryConfig=u}set state(r){r!==this._state&&(r!=="RELAY_STATE_FAILURE"&&(this.errorCode="RELAY_OK"),this.emit("state",r,this.errorCode),this._state=r)}get state(){return this._state}async startChannelMediaRelay(r){if(this.state!=="RELAY_STATE_IDLE")throw new L(D.INVALID_OPERATION);this.state="RELAY_STATE_CONNECTING",await this.connect(),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(r)}catch(s){throw s.data&&s.data.serverResponse&&s.data.serverResponse.command==="SetSourceChannel"?new L(D.CROSS_CHANNEL_FAILED_JOIN_SRC):s.data&&s.data.serverResponse&&s.serverResponse.command==="SetDestChannelStatus"?new L(D.CROSS_CHANNEL_FAILED_JOIN_DEST):s.data&&s.data.serverResponse&&s.serverResponse.command==="StartPacketTransfer"?new L(D.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):s}this.prevChannelMediaConfig=r}async updateChannelMediaRelay(r){if(this.state!=="RELAY_STATE_RUNNING")throw new L(D.INVALID_OPERATION);await this.sendUpdateMessage(r),this.prevChannelMediaConfig=r}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),R.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state="RELAY_STATE_IDLE",this.dispose()}dispose(){R.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=mo.CancelToken.source(),this.state="RELAY_STATE_IDLE",this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){let r=await fS(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=r.workerToken,await this.signal.connect(r.addressList),this.emit("event","NETWORK_CONNECTED"),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(r){var s=this.genMessage(Kr.StopPacketTransfer);await this.signal.request(s),await this.signal.waitStatus("Normal Quit"),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success")),s=this.genMessage(Kr.SetSdkProfile,r),await this.signal.request(s),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success")),s=this.genMessage(Kr.SetSourceChannel,r),await this.signal.request(s),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event","PACKET_JOINED_SRC_CHANNEL"),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success")),s=this.genMessage(Kr.SetSourceUserId,r),await this.signal.request(s),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success")),s=this.genMessage(Kr.SetDestChannel,r),await this.signal.request(s),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event","PACKET_JOINED_DEST_CHANNEL"),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success")),r=this.genMessage(Kr.StartPacketTransfer,r),await this.signal.request(r),this.emit("event","PACKET_SENT_TO_DEST_CHANNEL"),this.state="RELAY_STATE_RUNNING",R.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success"))}async sendUpdateMessage(r){r=this.genMessage(Kr.UpdateDestChannel,r),await this.signal.request(r),this.emit("event","PACKET_UPDATE_DEST_CHANNEL"),R.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){let r=this.genMessage(Kr.StopPacketTransfer);await this.signal.request(r),R.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(r,s){let c=[],u=[],h=[];this.requestId+=1;let A={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Hn,sid:this.joinInfo.sid,ts:de(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};A.sdkVersion==="4.7.3"&&(A.sdkVersion="0.0.1");let f=null,m=null;switch(r){case Kr.SetSdkProfile:return A.clientRequest={command:"SetSdkProfile",type:"multi_channel"},A;case Kr.SetSourceChannel:if(m=s&&s.getSrcChannelMediaInfo(),!m)throw new L(D.UNEXPECTED_ERROR,"can not find source config");return A.clientRequest={command:"SetSourceChannel",uid:"0",channelName:m.channelName,token:m.token||this.joinInfo.appId},A;case Kr.SetSourceUserId:if(m=s&&s.getSrcChannelMediaInfo(),!m)throw new L(D.UNEXPECTED_ERROR,"can not find source config");return A.clientRequest={command:"SetSourceUserId",uid:m.uid+""},A;case Kr.SetDestChannel:if(f=s&&s.getDestChannelMediaInfo(),!f)throw new L(D.UNEXPECTED_ERROR,"can not find dest config");return W(f).call(f,I=>{c.push(I.channelName),u.push(I.uid+""),h.push(I.token||this.joinInfo.appId)}),A.clientRequest={command:"SetDestChannel",channelName:c,uid:u,token:h},A;case Kr.StartPacketTransfer:return A.clientRequest={command:"StartPacketTransfer"},A;case Kr.Reconnect:return A.clientRequest={command:"Reconnect"},A;case Kr.StopPacketTransfer:return A.clientRequest={command:"StopPacketTransfer"},A;case Kr.UpdateDestChannel:if(f=s&&s.getDestChannelMediaInfo(),!f)throw new L(D.UNEXPECTED_ERROR,"can not find dest config");return W(f).call(f,I=>{c.push(I.channelName),u.push(I.uid+""),h.push(I.token||this.joinInfo.appId)}),A.clientRequest={command:"UpdateDestChannel",channelName:c,uid:u,token:h},A}return A}}class Rw{constructor(r,s){this._trust_stream_added_state_=this._trust_video_mute_state_=this._trust_audio_mute_state_=this._trust_video_enabled_state_=this._trust_audio_enabled_state_=this._trust_in_room_=!0,this._video_muted_=this._audio_muted_=!1,this._video_enabled_=this._audio_enabled_=!0,this._video_added_=this._audio_added_=!1,this.uid=r,this._uintid=s}get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio)return this._audioTrack}get videoTrack(){if(this.hasVideo)return this._videoTrack}}let ww=async i=>{var r=wh(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`);r=await window.crypto.subtle.importKey("spki",r,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),i=(s=i,new TextEncoder().encode(s));var s;return s=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},r,i),vu(new Uint8Array(s))},Ad;class Nw{constructor(r,s){var c;this.name=r,this.time=performance.now(),this.sequence=Ge(c=HR[s]).call(c,r)}setElapse(r){this.elapse=r}}let kw=new Ct;class Ow{constructor(r,s){this.records=[],this._id=r,this._group=s,this._localTimeStamp=de(),this._performanceTimeStamp=performance.now()}checkPoint(r){var s;let c=new Nw(r,this._group);c.sequence===-1&&R.warning("[".concat(this._id,"] check point record failed, cannot get the sequence")),this.records.push(c),(r=Je(s=this.records).call(s,u=>u.sequence===c.sequence-1))&&c.setElapse(c.time-r.time)}getRecord(r){var s;return Je(s=this.records).call(s,c=>c&&c.name===r)}resetRecords(){this.records.length=0}}var yl=function(i,r,s,c){var u,h=arguments.length,A=3>h?r:c===null?c=ct(r,s):c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")A=Reflect.decorate(i,r,s,c);else for(var f=i.length-1;0<=f;f--)(u=i[f])&&(A=(3>h?u(A):3<h?u(r,s,A):u(r,s))||A);return 3<h&&A&&ht(r,s,A),A},Nn=function(i,r){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,r)};class ic extends Wr{constructor(r){var s,c,u,h;let A;if(super(),this._users=[],this._sessionId=null,this._bindEnabledTracks=[],this._leaveMutex=new Vo("client-leave"),this._publishMutex=new Vo("client-publish"),this._subscribeMutex=new Ct,this._remoteStream=new Ct,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._turnServer={servers:[],mode:"auto"},this._cloudProxyServerMode="disabled",this._isDualStreamEnabled=!1,this._streamFallbackTypeCacheMap=new Ct,this._remoteStreamTypeCacheMap=new Ct,this._axiosCancelSource=mo.CancelToken.source(),this._networkQualitySensitivity="normal",this._useLocalAccessPoint=!1,this._handleLocalTrackEnable=(m,I,E)=>{this.publish(m,!1).then(I).catch(E)},this._handleLocalTrackDisable=(m,I,E)=>{this.unpublish(m,!1).then(I).catch(E)},this._handleUserOnline=m=>{var I;this.isStringUID&&typeof m.uid!="string"&&R.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));let E=Je(I=this._users).call(I,_=>_.uid===m.uid);E?E._trust_in_room_=!0:(I=new Rw(m.uid,m.uint_id||m.uid),this._users.push(I),R.debug("[".concat(this._clientId,"] user online"),m.uid),this.emit(qe.USER_JOINED,I))},this._handleUserOffline=m=>{var I;let E=Je(I=this._users).call(I,_=>_.uid===m.uid);E&&(this._handleRemoveStream(m),Ps(this._users,E),this._remoteStreamTypeCacheMap.delete(E.uid),this._streamFallbackTypeCacheMap.delete(E.uid),R.debug("[".concat(this._clientId,"] user offline"),m.uid,"reason:",m.reason),this.emit(qe.USER_LEAVED,E,m.reason))},this._handleAddAudioOrVideoStream=(m,I,E)=>{var _,S,N;let k=Je(_=this._users).call(_,J=>J.uid===I);if(!k)return void R.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));R.debug(b(S=b(N="[".concat(this._clientId,"] stream added with uid ")).call(N,I,", type ")).call(S,m)),_=m==="audio"?k.hasAudio:k.hasVideo;var B,P;k._uintid||(k._uintid=E||I),k._trust_stream_added_state_=!0,m==="audio"?k._audio_added_=!0:k._video_added_=!0,(m==="audio"?k.hasAudio:k.hasVideo)&&!_&&(R.info(b(B=b(P="[".concat(this._clientId,"] remote user ")).call(P,k.uid," published ")).call(B,m)),this.emit(qe.USER_PUBLISHED,k,m)),m==="video"?z.onGatewayStream(this._sessionId,jr.ON_ADD_VIDEO_STREAM,Jt.ON_ADD_VIDEO_STREAM,{peer:E||I}):z.onGatewayStream(this._sessionId,jr.ON_ADD_AUDIO_STREAM,Jt.ON_ADD_AUDIO_STREAM,{peer:E||I}),(m=this._remoteStream.get(I))&&m.readyToReconnect&&m.connectionState==="connecting"&&m.reconnectPC().catch(J=>{R.error("[".concat(this._clientId,"] resubscribe error"),J.toString())})},this._handleRemoveStream=m=>{var I,E;let _=Je(I=this._users).call(I,S=>S.uid===m.uid);if(!_)return void R.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));R.debug(b(E="[".concat(this._clientId,"] stream removed with uid ")).call(E,m.uid)),I=()=>{},_.hasAudio&&_.hasVideo?I=()=>{var S,N;R.info(b(S="[".concat(this._clientId,"] remote user ")).call(S,_.uid," unpublished audio track")),this.emit(qe.USER_UNPUBLISHED,_,"audio"),R.info(b(N="[".concat(this._clientId,"] remote user ")).call(N,_.uid," unpublished video track")),this.emit(qe.USER_UNPUBLISHED,_,"video")}:_.hasVideo?I=()=>{var S;R.info(b(S="[".concat(this._clientId,"] remote user ")).call(S,_.uid," unpublished video track")),this.emit(qe.USER_UNPUBLISHED,_,"video")}:_.hasAudio&&(I=()=>{var S;R.info(b(S="[".concat(this._clientId,"] remote user ")).call(S,_.uid," unpublished audio track")),this.emit(qe.USER_UNPUBLISHED,_,"audio")}),_._trust_stream_added_state_=!0,_._audio_added_=!1,_._video_added_=!1,(E=this._remoteStream.get(_.uid))&&(E.closeP2PConnection(),this._remoteStream.delete(_.uid)),z.onGatewayStream(this._sessionId,jr.ON_REMOVE_STREAM,Jt.ON_REMOVE_STREAM,{peer:m.uint_id||m.uid}),I()},this._handleSetStreamLocalEnable=(m,I,E)=>{var _,S,N,k,B,P;let J=Je(_=this._users).call(_,Ze=>Ze.uid===I);if(!J)return void R.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));if(R.debug(b(S=b(N=b(k="[".concat(this._clientId,"] local ")).call(k,m," ")).call(N,E?"enabled":"disabled"," with uid ")).call(S,I)),_=m==="audio"?J.hasAudio:J.hasVideo,m==="audio"){J._trust_audio_enabled_state_=!0;var se=J._audio_enabled_;if(J._audio_enabled_=E,J._audio_enabled_===se)return;var ge,Le;E=J._audio_enabled_?"enable-local-audio":"disable-local-audio",R.debug(b(ge=b(Le="[".concat(this._clientId,"] user-info-updated, uid: ")).call(Le,I,", msg: ")).call(ge,E)),this.emit(qe.USER_INFO_UPDATED,I,E)}else{if(J._trust_video_enabled_state_=!0,ge=J._video_enabled_,J._video_enabled_=E,J._video_enabled_===ge)return;var Be;E=J._video_enabled_?"enable-local-video":"disable-local-video",R.debug(b(se=b(Be="[".concat(this._clientId,"] user-info-update, uid: ")).call(Be,I,", msg: ")).call(se,E)),this.emit(qe.USER_INFO_UPDATED,I,E)}if(E=m==="audio"?J.hasAudio:J.hasVideo,_!==E){var yt,ve;if(!_&&E)return R.info(b(yt=b(ve="[".concat(this._clientId,"] remote user ")).call(ve,I," published ")).call(yt,m)),void this.emit(qe.USER_PUBLISHED,J,m);(yt=this._remoteStream.get(I))&&(ve=ba({},yt.subscribeOptions),ve.audio=!!J.hasAudio&&ve.audio,ve.video=!!J.hasVideo&&ve.video,ve.audio||ve.video?yt.setSubscribeOptions(ve):(yt.closeP2PConnection().catch(Ze=>{R.warning("close sub pc error",Ze)}),this._remoteStream.delete(J.uid))),R.info(b(B=b(P="[".concat(this._clientId,"] remote user ")).call(P,J.uid," unpublished ")).call(B,m)),this.emit(qe.USER_UNPUBLISHED,J,m)}},this._handleMuteStream=(m,I,E)=>{var _,S,N;R.debug("[".concat(this._clientId,"] receive mute message"),m,I,E);let k=Je(_=this._users).call(_,yt=>yt.uid===m);var B;if(!k)return void R.warning(b(B="[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ")).call(B,m));if(_=I==="audio"?k.hasAudio:k.hasVideo,I==="audio"){k._trust_audio_mute_state_=!0;var P=k._audio_muted_;if(k._audio_muted_=E,k._audio_muted_===P)return;var J,se;E=k._audio_muted_?"mute-audio":"unmute-audio",R.debug(b(J=b(se="[".concat(this._clientId,"] user-info-update, uid: ")).call(se,m,", msg: ")).call(J,E)),this.emit(qe.USER_INFO_UPDATED,m,E)}else{if(k._trust_video_mute_state_=!0,J=k._video_muted_,k._video_muted_=E,k._video_muted_===J)return;var ge;E=k._video_muted_?"mute-video":"unmute-video",R.debug(b(P=b(ge="[".concat(this._clientId,"] user-info-update, uid: ")).call(ge,m,", msg: ")).call(P,E)),this.emit(qe.USER_INFO_UPDATED,m,E)}if(E=I==="audio"?k.hasAudio:k.hasVideo,_!==E){var Le,Be;if(!_&&E)return R.info(b(Le=b(Be="[".concat(this._clientId,"] remote user ")).call(Be,m," published ")).call(Le,I)),void this.emit(qe.USER_PUBLISHED,k,I);(Le=this._remoteStream.get(m))&&(Be=ba({},Le.subscribeOptions),Be.audio=!!k.hasAudio&&Be.audio,Be.video=!!k.hasVideo&&Be.video,I==="video"&&Le.pc._statsFilter.setVideoIsReady(!1),Be.audio||Be.video?Le.setSubscribeOptions(Be):(Le.closeP2PConnection().catch(yt=>{R.warning("close sub pc error",yt)}),this._remoteStream.delete(k.uid))),R.info(b(S=b(N="[".concat(this._clientId,"] remote user ")).call(N,m," unpublished ")).call(S,I)),this.emit(qe.USER_UNPUBLISHED,k,I)}},this._handleP2PLost=m=>{R.debug("[".concat(this._clientId,"] receive p2p lost"),m);let I=null;if(this._highStream&&this._highStream.pc.ID===m.p2pid)I=this._highStream;else if(this._lowStream&&this._lowStream.pc.ID===m.p2pid)I=this._lowStream;else{var E;W(E=this._remoteStream).call(E,_=>{_.pc.ID===m.p2pid&&(I=_)})}I?I.emit(De.GATEWAY_P2P_LOST,m.p2pid):R.warning("P2PLost stream not found",m)},this._handleTokenWillExpire=()=>{R.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.emit(qe.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)},this._handleBeforeUnload=m=>{m.returnValue!==void 0&&m.returnValue!==""||(this.leave(),R.info("[".concat(this._clientId,"] auto leave onbeforeunload")))},this._handleUpdateNetworkQuality=()=>{var m;if(this._networkQualitySensitivity!=="normal"){if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.emit(qe.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});var I={downlinkNetworkQuality:0,uplinkNetworkQuality:0};this._highStream&&!this._highStream.detecting&&(I.uplinkNetworkQuality=this._highStream.getNetworkQuality());var E=0;W(m=this._remoteStream).call(m,_=>E+=_.getNetworkQuality()),0<this._remoteStream.size&&(I.downlinkNetworkQuality=Math.round(E/this._remoteStream.size)),this.emit(qe.NETWORK_QUALITY,I)}},this._codec=r.codec,this._mode=r.mode,r.proxyServer&&(this._proxyServer=r.proxyServer,z.setProxyServer(this._proxyServer),R.setProxyServer(this._proxyServer)),r.turnServer&&(this._turnServer=ba({},this._turnServer,{mode:"manual"},r.turnServer)),this._clientId=er(5,"client-"),R.info(b(s=b(c=b(u=b(h="[".concat(this._clientId,"] Initializing AgoraRTC client v")).call(h,Hn," build: ")).call(u,"v4.7.3-0-g0eb931c7(11/16/2021, 7:57:58 PM)",", mode: ")).call(c,this._mode,", codec: ")).call(s,this._codec)),this._performanceRecorder=function(m,I){return I=new Ow(m,I),kw.set(m,I),I}(this._clientId,"join"),r.clientRoleOptions)try{Dg(r.clientRoleOptions),A=Zr({},r.clientRoleOptions)}catch(m){var f;R.warning(b(f="[".concat(this._clientId,"] ")).call(f,m.toString()))}this._statsCollector=new $a(this._clientId),this._statsCollector.onStatsException=(m,I,E)=>{var _,S,N;R.debug(b(_=b(S=b(N="[".concat(this._clientId,"] receive exception msg, code: ")).call(N,m,", msg: ")).call(S,I,", uid: ")).call(_,E)),this.emit(qe.EXCEPTION,{code:m,msg:I,uid:E})},this._statsCollector.onUploadPublishDuration=(m,I,E,_)=>{var S;let N=Je(S=this._users).call(S,k=>k.uid===m);N&&z.peerPublishStatus(this._sessionId,{subscribeElapse:_,audioPublishDuration:I,videoPublishDuration:E,peer:N._uintid})},this._gateway=new k2({clientId:this._clientId,mode:this._mode,codec:this._codec,websocketRetryConfig:r.websocketRetryConfig||Tr,httpRetryConfig:r.httpRetryConfig||Tr,forceWaitGatewayResponse:r.forceWaitGatewayResponse===void 0||r.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:r.role,clientRoleOptions:A}),this._config=r,this._configDistribute=new rw,this._handleGatewayEvents()}get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._highStream?this._highStream.getAllTracks():[]}get uid(){return this._uid}get channelName(){return this._channelName}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}async join(r,s,c,u,h){var A;this._performanceRecorder.checkPoint("startJoin");var f=(Ad||Ad||(Ad=(window.location.protocol.split(":")[0]||"").toUpperCase(),Ad))==="HTTPS";let m=window.isSecureContext!==void 0?window.isSecureContext:"Browser Not Support",I=()=>{R.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser")};window.isSecureContext!==void 0?window.isSecureContext||I():f||I(),f=z.reportApiInvoke(this._sessionId,{name:we.JOIN,options:[r,s,c,u],states:{isHttps:f,isSecureContext:m},tag:Re.TRACER});try{if(!c&&c!==null)throw new L(D.INVALID_PARAMS,"Invalid token: ".concat(c,". If you don not use token, set it to null"));c&&Vr(c,"token",1,2047),Vr(r,"appid",1,2047),Ih(s),u&&Ch(u),h&&Vr(h,"optionalInfo",1,2047)}catch(k){throw f.onError(k),k}if(R.info(b(A="[".concat(this._clientId,"] start join channel ")).call(A,s)),this._leaveMutex.isLocked&&(R.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),R.debug("[".concat(this._clientId,"] join: continue"))),this.connectionState!=="DISCONNECTED")throw r=new L(D.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state")),f.onError(r),r;this._sessionId||(this._sessionId=er(32,"").toUpperCase()),this._gateway.state="CONNECTING",h={clientId:this._clientId,appId:r,sid:this._sessionId,cname:s,uid:typeof u!="string"?u:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:c||r,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:h,useLocalAccessPoint:this._useLocalAccessPoint},typeof u=="string"&&(h.stringUid=u,this._uintUid?(h.uid=this._uintUid,this._uintUid=void 0):h.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret&&(h.aesmode=this._encryptionMode,h.aespassword=await ww(this._encryptionSecret),this._encryptionSalt&&(h.aessalt=this._encryptionSalt)),this._startSession(this._sessionId,{channel:s,appId:r}),ai(()=>{this.connectionState==="CONNECTING"&&z.joinChannelTimeout(this._sessionId,5)},5e3);try{var E;let k;if(h.cloudProxyServer==="443only")h.proxyServer=ne.PROXY_SERVER_TYPE2;else if(h.cloudProxyServer==="proxy3"||h.cloudProxyServer==="proxy4"||h.cloudProxyServer==="proxy5"){let P=ne.PROXY_SERVER_TYPE3;Wi(P)?h.proxyServer=P[0]:h.proxyServer=P}if(z.setProxyServer(h.proxyServer),R.setProxyServer(h.proxyServer),this._performanceRecorder.checkPoint("startRequestAp"),h.stringUid&&!h.uid&&h.cloudProxyServer==="normal"){var _;await rm(h,this._axiosCancelSource.token,this._config.httpRetryConfig||Tr,!1);let P=await kh(h.stringUid,h,this._axiosCancelSource.token,this._config.httpRetryConfig||Tr);R.debug(b(_="getUserAccount Success ".concat(h.stringUid," => ")).call(_,P)),h.uid=P,k=await Kc(h,this._axiosCancelSource.token,this._config.httpRetryConfig||Tr)}else{if(h.stringUid&&!h.uid){var S;let P=await kh(h.stringUid,h,this._axiosCancelSource.token,this._config.httpRetryConfig||Tr);R.debug(b(S="getUserAccount Success ".concat(h.stringUid," => ")).call(S,P)),h.uid=P}k=await rm(h,this._axiosCancelSource.token,this._config.httpRetryConfig||Tr,!0)}this._performanceRecorder.checkPoint("startJoinGateway"),this._configDistribute.startGetConfigDistribute(h,this._axiosCancelSource.token),this._configDistribute.on(cl.UPDATE_BITRATE_LIMIT,P=>{this._highStream&&this._highStream.handleUpdateBitrateLimit(P.uplink),P.low_stream_uplink&&this._lowStream&&this._lowStream.handleUpdateBitrateLimit({max_bitrate:P.low_stream_uplink.bitrate,min_bitrate:P.low_stream_uplink.bitrate||0})}),this._key=c||r,this._joinInfo=ba({},h,{cid:k.gatewayInfo.cid,uid:h.uid?h.uid:k.gatewayInfo.uid,vid:k.gatewayInfo.vid,apResponse:k.gatewayInfo.res,uni_lbs_ip:k.gatewayInfo.uni_lbs_ip,gatewayAddrs:k.gatewayInfo.gatewayAddrs});let B=await this._gateway.join(this._joinInfo,this._key);return f.onSuccess(B),this._appId=r,this._channelName=h.cname,this._uid=B,this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener("beforeunload",this._handleBeforeUnload),R.info(b(E="[".concat(this._clientId,"] Joining channel success: ")).call(E,s)),ai(()=>{R.startUpload()},5e3),this._performanceRecorder.checkPoint("finishJoin"),N=this,gt(xo).call(xo,N)||xo.push(N),B}catch(k){throw r=Wi(k)?k[0]:k,R.error("[".concat(this._clientId,"] Joining channel failed, rollback"),r),r.code!==D.OPERATION_ABORTED&&(this._gateway.state="DISCONNECTED",this._reset()),f.onError(r),r}var N}async leave(){let r=z.reportApiInvoke(this._sessionId,{name:we.LEAVE,options:[],tag:Re.TRACER});R.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener("beforeunload",this._handleBeforeUnload),this._reset();var s=Ge(xo).call(xo,this);if(s!==-1&&Gr(xo).call(xo,s,1),s=await this._leaveMutex.lock(),this.connectionState==="DISCONNECTED")return R.info("[".concat(this._clientId,"] Leaving channel repeated, success")),s(),r.onSuccess();await this._gateway.leave(this.connectionState!=="CONNECTED"),R.info("[".concat(this._clientId,"] Leaving channel success")),s(),r.onSuccess()}async publish(r,s=!0){var c,u;Wi(r)||(r=[r]);let h=z.reportApiInvoke(this._sessionId,{name:we.PUBLISH,options:Ie(r).call(r,A=>A?Object(A).toString():"null"),tag:Re.TRACER});if(r.length===0)return r=new L(D.INVALID_PARAMS,"track list is empty"),h.onError(r),r.throw();if(this._gateway.role==="audience")return r=new L(D.INVALID_OPERATION,"audience can not publish stream"),h.onError(r),r.throw();for(let A of r){if(!(A instanceof $u))return r=new L(D.INVALID_PARAMS,"pamameter is not local track"),h.onError(r),r.throw();if(!A._enabled&&s)return r=new L(D.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(A.getTrackId())),h.onError(r),r.throw()}if(R.info(b(c="[".concat(this._clientId,"] Publishing tracks, id ")).call(c,Ie(r).call(r,A=>"".concat(A.getTrackId()," ")))),await this._configDistribute.awaitConfigDistributeComplete(),s&&W(r).call(r,A=>{var f;let m=this._configDistribute.getBitrateLimit();var I;A instanceof Kt&&m&&A.setBitrateLimit(m.uplink),Ge(f=this._bindEnabledTracks).call(f,A)===-1&&(A.addListener(Me.NEED_ADD_TRACK,this._handleLocalTrackEnable),A.addListener(Me.NEED_REMOVE_TRACK,this._handleLocalTrackDisable),this._bindEnabledTracks.push(A),Xt()&&A.muted&&R.debug(b(I="[".concat(this._clientId,"] on firefox publish a muted track ")).call(I,A.getTrackId(),", skip the pub operation and wait unmute")))}),Xt()&&(r=Qe(r).call(r,A=>!A.muted)).length===0)return void h.onSuccess(Ie(r).call(r,A=>A.trackMediaType+":"+A.getTrackLabel()).toString());c=await this._publishMutex.lock();try{let A=await this._publishHighStream(r),f=(A.audioTrack,A.videoTrack);this._isDualStreamEnabled&&f&&!this._lowStream&&await this._publishLowStream(f),c(),h.onSuccess(Ie(r).call(r,m=>m.trackMediaType+":"+m.getTrackLabel()).toString())}catch(A){throw c(),s&&W(r).call(r,f=>{var m,I;let E=Ge(m=this._bindEnabledTracks).call(m,f);E!==-1&&(f.off(Me.NEED_ADD_TRACK,this._handleLocalTrackEnable),f.off(Me.NEED_REMOVE_TRACK,this._handleLocalTrackDisable),Gr(I=this._bindEnabledTracks).call(I,E,1))}),h.onError(A),R.error("[".concat(this._clientId,"] publish error"),A.toString()),A}R.info(b(u="[".concat(this._clientId,"] Publish success, id ")).call(u,Ie(r).call(r,A=>"".concat(A.getTrackId()," "))))}async unpublish(r,s=!0){var c;let u=await this._publishMutex.lock(),h,A,f;try{var m,I;if(!this._highStream||(h=this._highStream.getAllTracks(),r?Wi(r)||(r=[r]):r=this._highStream.getAllTracks(),A=function(E,_){if(E.length!==_.length)return!1;for(let S=0;S<E.length;S+=1){let N=E[S];if(Qe(E).call(E,k=>k===N).length!==Qe(_).call(_,k=>k===N).length)return!1}return!0}(h,r),f=z.reportApiInvoke(this._sessionId,{name:we.UNPUBLISH,options:Ie(r).call(r,E=>E.getTrackId()),tag:Re.TRACER}),R.info(b(m=b(I="[".concat(this._clientId,"] Unpublish tracks, tracks ")).call(I,Ie(r).call(r,E=>"".concat(E.getTrackId()," ")),", isClosePC: ")).call(m,A)),!this._highStream))return R.warning("[".concat(this._clientId,"] Could not find tracks to unpublish")),void(u&&u())}catch(E){throw u&&u(),E}try{this._lowStream&&0<Qe(r).call(r,E=>E.trackMediaType==="video").length&&(await this._lowStream.closeP2PConnection(),this._lowStream=void 0),A?await this._highStream.closeP2PConnection():await this._highStream.removeTracks(r,s),u&&u()}catch(E){if(E.code!==D.OPERATION_ABORTED)throw f.onError(E),R.error("[".concat(this._clientId,"] unpublish error"),E.toString()),u&&u(),E;R.debug("[".concat(this._clientId,"] ignore unpub operation abort")),u&&u()}this._highStream&&this._highStream.connectionState==="disconnected"&&(this._highStream=void 0,this._lowStream=void 0),s&&W(r).call(r,E=>{var _,S;let N=Ge(_=this._bindEnabledTracks).call(_,E);N!==-1&&(E.off(Me.NEED_ADD_TRACK,this._handleLocalTrackEnable),E.off(Me.NEED_REMOVE_TRACK,this._handleLocalTrackDisable),Gr(S=this._bindEnabledTracks).call(S,N,1))}),R.info(b(c="[".concat(this._clientId,"] Unpublish success,tracks ")).call(c,Ie(r).call(r,E=>"".concat(E.getTrackId())))),f.onSuccess()}async subscribe(r,s){var c,u,h,A;hn(s,"mediaType",["audio","video"]);let f=z.reportApiInvoke(this._sessionId,{name:we.SUBSCRIBE,options:[r.uid,s],tag:Re.TRACER});if(!this._joinInfo)throw s=new L(D.INVALID_OPERATION,"Can't subscribe stream, not joined"),f.onError(s),s;if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw s=new L(D.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state")),f.onError(s),s;if(!Je(c=this._users).call(c,k=>k===r)){var m;throw s=new L(D.INVALID_REMOTE_USER,"user is not in the channel"),R.error(b(m="[".concat(this._clientId,"] can not subscribe ")).call(m,r.uid,", this user is not in the channel")),f.onError(s),s}if(!r.hasAudio&&!r.hasVideo){var I;throw s=new L(D.INVALID_REMOTE_USER,"user is not published"),R.error(b(I="[".concat(this._clientId,"] can not subscribe ")).call(I,r.uid,", user is not published")),f.onError(s),s}if(m={audio:s==="audio",video:s==="video"},!r.hasAudio&&m.audio||!r.hasVideo&&m.video){var E,_,S=new L(D.REMOTE_USER_IS_NOT_PUBLISHED);throw R.error(b(E=b(_="[".concat(this._clientId,"] can not subscribe ")).call(_,r.uid," with mediaType ")).call(E,s,", remote track is not published")),f.onError(S),S}(E=this._subscribeMutex.get(r.uid))||(E=new Vo("sub-".concat(r.uid)),this._subscribeMutex.set(r.uid,E)),R.info(b(u=b(h="[".concat(this._clientId,"] subscribe user ")).call(h,r.uid,", mediaType: ")).call(u,s)),u=await E.lock(),h=this._remoteStream.get(r.uid);try{if(h)m.audio=m.audio||h.subscribeOptions.audio,m.video=m.video||h.subscribeOptions.video,await this._gateway.subscribeChange(h,m);else{h=new Cw(r,this._statsCollector,this._joinInfo,m),this._remoteStream.set(r.uid,h);try{await this._gateway.subscribe(h)}catch(k){throw this._remoteStream.delete(r.uid),k}h.on(De.CONNECTION_STATE_CHANGE,(k,B)=>{k==="connecting"?this.emit(qe.MEDIA_RECONNECT_START,r.uid):k==="connected"&&this.emit(qe.MEDIA_RECONNECT_END,r.uid)})}u()}catch(k){var N;throw f.onError(k),u(),R.error(b(N="[".concat(this._clientId,"] subscribe user ")).call(N,r.uid," error"),k),k}return R.info(b(S=b(A="[".concat(this._clientId,"] subscribe success user ")).call(A,r.uid,", mediaType: ")).call(S,s)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(r.uid,this._defaultStreamFallbackType).catch(k=>{R.warning("[".concat(this._clientId,"] auto set fallback failed"),k)}),s=s==="audio"?r.audioTrack:r.videoTrack,s?(f.onSuccess(s.getTrackId()),s):(s=new L(D.UNEXPECTED_ERROR,"can not find remote track in user object"),f.onError(s),s.throw())}async unsubscribe(r,s){var c,u,h,A,f;s&&hn(s,"mediaType",["audio","video"]);let m=z.reportApiInvoke(this._sessionId,{name:we.UNSUBSCRIBE,options:[r.uid,s],tag:Re.TRACER});if(!Je(c=this._users).call(c,S=>S===r)){var I;throw s=new L(D.INVALID_REMOTE_USER,"user is not in the channel"),R.error(b(I="[".concat(this._clientId,"] can not subscribe ")).call(I,r.uid,", user is not in the channel")),m.onError(s),s}R.info(b(u=b(h="[".concat(this._clientId,"] unsubscribe uid: ")).call(h,r.uid,", mediaType: ")).call(u,s)),(I=this._subscribeMutex.get(r.uid))||(I=new Vo("sub-".concat(r.uid)),this._subscribeMutex.set(r.uid,I)),I=await I.lock(),c=this._remoteStream.get(r.uid);var E;if(!c)return R.warning(b(E="[".concat(this._clientId,"]: you have not subscribe the remote user ")).call(E,r.uid)),m.onSuccess(),void I();E=ba({},c.subscribeOptions),s==="audio"?E.audio=!1:s==="video"?(E.video=!1,c.pc._statsFilter.setVideoIsReady(!1)):(E.audio=!1,E.video=!1);try{E.audio||E.video?await this._gateway.subscribeChange(c,E):(await c.closeP2PConnection(),this._remoteStream.delete(r.uid)),I()}catch(S){var _;if(S.code!==D.OPERATION_ABORTED)throw m.onError(S),I(),R.error(b(_="[".concat(this._clientId,"] unsubscribe user ")).call(_,r.uid," error"),S.toString()),S;I(),R.debug("[".concat(this._clientId,"] ignore unsub operation abort"))}R.info(b(A=b(f="[".concat(this._clientId,"] unsubscribe success uid: ")).call(f,r.uid,", mediaType: ")).call(A,s)),m.onSuccess()}setLowStreamParameter(r){if(!r)throw new L(D.INVALID_PARAMS);r.width==null||It(r.width,"streamParameter.width"),r.height==null||It(r.height,"streamParameter.height"),r.framerate==null||It(r.framerate,"streamParameter.framerate"),r.bitrate==null||It(r.bitrate,"streamParameter.bitrate");let s=z.reportApiInvoke(this._sessionId,{name:we.SET_LOW_STREAM_PARAMETER,options:[r],tag:Re.TRACER});(!r.width&&r.height||r.width&&!r.height)&&R.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),R.info("[".concat(this._clientId,"] set low stream parameter to"),fe(r));let c=this._configDistribute.getLowStreamConfigDistribute();c&&c.bitrate&&r.bitrate&&c.bitrate<r.bitrate&&(r.bitrate=c.bitrate),this._lowStreamParameter=r,s.onSuccess()}async enableDualStream(){let r=z.reportApiInvoke(this._sessionId,{name:we.ENABLE_DUAL_STREAM,options:[],tag:Re.TRACER});if(!kt.supportDualStream){z.streamSwitch(this._sessionId,{lts:de(),isdual:!0,succ:!1});var s=new L(D.NOT_SUPPORTED,"Your browser is not support dual stream");throw r.onError(s),s}if(this._isDualStreamEnabled)throw s=new L(D.INVALID_OPERATION,"Dual stream is already enabled"),r.onError(s),s;if(this._highStream&&this._highStream.connectionState==="connected"&&this._highStream.videoTrack)try{await this._publishLowStream(this._highStream.videoTrack)}catch(c){throw z.streamSwitch(this._sessionId,{lts:de(),isdual:!0,succ:!1}),r.onError(c),c}this._isDualStreamEnabled=!0,z.streamSwitch(this._sessionId,{lts:de(),isdual:!0,succ:!0}),R.info("[".concat(this._clientId,"] enable dual stream")),r.onSuccess()}async disableDualStream(){let r=z.reportApiInvoke(this._sessionId,{name:we.DISABLE_DUAL_STREAM,options:[],tag:Re.TRACER});if(this._lowStream)try{await this._lowStream.closeP2PConnection()}catch(s){throw z.streamSwitch(this._sessionId,{lts:de(),isdual:!1,succ:!1}),r.onError(s),s}this._lowStream=void 0,this._isDualStreamEnabled=!1,this._highStream&&(this._highStream.lowStreamConnection=void 0),z.streamSwitch(this._sessionId,{lts:de(),isdual:!1,succ:!0}),R.info("[".concat(this._clientId,"] disable dual stream")),r.onSuccess()}async setClientRole(r,s){hn(r,"role",["audience","host"]),s&&Dg(s);let c=z.reportApiInvoke(this._sessionId,{name:we.SET_CLIENT_ROLE,options:[r,s],tag:Re.TRACER});if(this._mode==="rtc")return R.warning("[".concat(this._clientId,"]rtc mode can not use setClientRole")),r=new L(D.INVALID_OPERATION,"rtc mode can not use setClientRole"),c.onError(r),r.throw();if(s&&s.level&&r==="host")return r=new L(D.INVALID_OPERATION,"host mode can not set audience latency level"),c.onError(r),r.throw();try{var u,h;if(r==="audience"&&this._highStream){let A=new L(D.INVALID_OPERATION,"can not set client role to audience when publishing stream");return c.onError(A),A.throw()}await this._gateway.setClientRole(r,s),R.info(b(u=b(h="[".concat(this._clientId,"] set client role to ")).call(h,r,", level: ")).call(u,s&&s.level)),c.onSuccess()}catch(A){throw c.onError(A),A}}setProxyServer(r){if(Vr(r,"proxyServer"),this.connectionState!=="DISCONNECTED")throw new L(D.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new L(D.INVALID_OPERATION,"You have already set the proxy");this._proxyServer=r,z.setProxyServer(this._proxyServer),R.setProxyServer(this._proxyServer)}setTurnServer(r){if(Wi(r)||(r=[r]),this.connectionState!=="DISCONNECTED")throw new L(D.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new L(D.INVALID_OPERATION,"You have already set the proxy");var s;if(Og(r))return this._turnServer={servers:r,mode:"original-manual"},void R.info(b(s="[".concat(this._clientId,"] Set original turnserver success: ")).call(s,Ie(r).call(r,c=>c.urls).join(","),"."));W(r).call(r,c=>bg(c)),this._turnServer={servers:r,mode:"manual"},R.info("[".concat(this._clientId,"] Set turnserver success."))}startProxyServer(r){let s=z.reportApiInvoke(this._sessionId,{name:we.START_PROXY_SERVER,options:[],tag:Re.TRACER});if(this.connectionState!=="DISCONNECTED")throw r=new L(D.INVALID_OPERATION,"Start proxy server before join channel"),s.onError(r),r;if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw r=new L(D.INVALID_OPERATION,"You have already set the proxy"),s.onError(r),r;let c=[1,2,3,4,5];switch(r===void 0&&(r=1),r){case 1:this._cloudProxyServerMode="normal";break;case 2:this._cloudProxyServerMode="443only";break;case 3:this._cloudProxyServerMode="proxy3";break;case 4:this._cloudProxyServerMode="proxy4";break;case 5:this._cloudProxyServerMode="proxy5";break;default:throw r=new L(D.INVALID_PARAMS,"proxy server mode must be ".concat(c.join("|"))),s.onError(r),r}R.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),s.onSuccess()}stopProxyServer(){let r=z.reportApiInvoke(this._sessionId,{name:we.STOP_PROXY_SERVER,options:[],tag:Re.TRACER});if(this.connectionState!=="DISCONNECTED")throw new L(D.INVALID_OPERATION,"Stop proxy server after leave channel");z.setProxyServer(),R.setProxyServer(),this._cloudProxyServerMode="disabled",R.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]},r.onSuccess()}setLocalAccessPoints(r,s){if(Eh(r,"serverList"),Vr(s,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new L(D.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");let c=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;r=Ie(r).call(r,u=>{var h;return c.test(u)?b(h="".concat(u.replace(/\./g,"-"),".")).call(h,s):u}),this._useLocalAccessPoint=!0,Ur("WEBCS_DOMAIN",r),Ur("WEBCS_DOMAIN_BACKUP_LIST",r),Ur("GATEWAY_DOMAINS",[s]),Ur("EVENT_REPORT_DOMAIN",r[0]),Ur("EVENT_REPORT_BACKUP_DOMAIN",r[1]||r[0]),Ur("LOG_UPLOAD_SERVER","".concat(r[0],":6444")),R.info("set local access point success")}async setRemoteVideoStreamType(r,s){var c,u;hn(s,"streamType",[0,1]);let h=z.reportApiInvoke(this._sessionId,{name:we.SET_REMOTE_VIDEO_STREAM_TYPE,options:[r,s],tag:Re.TRACER});try{await this._gateway.setRemoteVideoStreamType(r,s),ai(()=>{var A;let f=Je(A=this._users).call(A,m=>m.uid===r);f&&f.videoTrack&&f.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(A){throw h.onError(A),R.error("[".concat(this._clientId,"] set remote video stream type error"),A.toString()),A}R.info(b(c=b(u="[".concat(this._clientId,"] set remote ")).call(u,r," video stream type to ")).call(c,s)),this._remoteStreamTypeCacheMap.set(r,s),h.onSuccess()}async setStreamFallbackOption(r,s){var c,u;hn(s,"fallbackType",[0,1,2]);let h=z.reportApiInvoke(this._sessionId,{name:we.SET_STREAM_FALLBACK_OPTION,options:["too long to show",s],tag:Re.TRACER});try{await this._gateway.setStreamFallbackOption(r,s)}catch(A){throw h.onError(A),R.error("[".concat(this._clientId,"] set stream fallback option"),A.toString()),A}R.info(b(c=b(u="[".concat(this._clientId,"] set remote ")).call(u,r," stream fallback type to ")).call(c,s)),this._streamFallbackTypeCacheMap.set(r,s),h.onSuccess()}setEncryptionConfig(r,s,c){hn(r,"encryptionMode","aes-128-xts aes-256-xts aes-128-ecb sm4-128-ecb aes-128-gcm aes-256-gcm aes-128-gcm2 aes-256-gcm2 none".split(" ")),Vr(s,"secret");let u=["aes-128-gcm2","aes-256-gcm2"];if(gt(u).call(u,r)){if(!(c&&c instanceof Uint8Array&&c.length===32))throw new L(D.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(c)throw new L(D.INVALID_PARAMS,"current encrypt mode does not need salt");/^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\[\]])(?=.{8,})/.test(s)||R.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=r,this._encryptionSecret=s,c&&(this._encryptionSalt=vu(c))}async renewToken(r){Vr(r,"token",1,2047);let s=z.reportApiInvoke(this._sessionId,{name:we.RENEW_TOKEN,options:[r],tag:Re.TRACER});if(!this._key)return r=new L(D.INVALID_OPERATION,"renewToken should not be called before user join"),s.onError(r),r.throw();this._key=r;try{await this._gateway.renewToken(r)}catch(c){throw s.onError(c),R.error("[".concat(this._clientId,"] renewToken failed"),c.toString()),c}R.debug("[".concat(this._clientId,"] renewToken success")),s.onSuccess()}enableAudioVolumeIndicator(){let r=z.reportApiInvoke(this._sessionId,{name:we.ENABLE_AUDIO_VOLUME_INDICATOR,options:[],tag:Re.TRACER});if(this._audioVolumeIndicationInterval)return R.warning("you have already enabled audio volume indicator!"),r.onSuccess();this._audioVolumeIndicationInterval=window.setInterval(()=>{var s,c,u;let h=ol(s=Ie(c=Ji(Js(u=this._remoteStream).call(u))).call(c,A=>({level:A.user.audioTrack?100*A.user.audioTrack._source.getAccurateVolumeLevel():0,uid:A.getUserId()}))).call(s,(A,f)=>A.level-f.level);this._highStream&&this._highStream.audioTrack&&(h.push({level:100*this._highStream.audioTrack._source.getAccurateVolumeLevel(),uid:this._highStream._userId}),h=ol(h).call(h,(A,f)=>A.level-f.level)),this.emit(qe.VOLUME_INDICATOR,h)},ne.AUDIO_VOLUME_INDICATION_INTERVAL||2e3),r.onSuccess()}getRTCStats(){let r=this._statsCollector.getRTCStats(),s=this._gateway.getInChannelInfo();return r.Duration=Math.round(s.duration/1e3),r}startLiveStreaming(r,s){let c=z.reportApiInvoke(this._sessionId,{name:we.START_LIVE_STREAMING,options:[r,s],tag:Re.TRACER});if(!s){if(this._codec!=="h264")return r=new L(D.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264"),c.onError(r),ce.reject(r);if(!this._highStream)return r=new L(D.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming"),c.onError(r),ce.reject(r)}return this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(r)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(r)?(r=new L(D.LIVE_STREAMING_TASK_CONFLICT),c.onError(r),ce.reject(r)):(s=s?Zt.TRANSCODE:Zt.RAW,this._createLiveStreamingClient(s).startLiveStreamingTask(r,s).then(()=>c.onSuccess()).catch(u=>{throw c.onError(u),u}))}setLiveTranscoding(r){let s=z.reportApiInvoke(this._sessionId,{name:we.SET_LIVE_TRANSCODING,options:[r],tag:Re.TRACER});return this._createLiveStreamingClient(Zt.TRANSCODE).setTranscodingConfig(r).then(()=>s.onSuccess()).catch(c=>{throw s.onError(c),c})}stopLiveStreaming(r){var s;let c=z.reportApiInvoke(this._sessionId,{name:we.STOP_LIVE_STREAMING,options:[r],tag:Re.TRACER}),u=Qe(s=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient]).call(s,h=>h&&h.hasUrl(r));return u.length?ce.all(Ie(u).call(u,h=>h&&h.stopLiveStreamingTask(r))).then(()=>c.onSuccess()).catch(h=>{throw c.onError(h),h}):(s=new L(D.INVALID_PARAMS,"can not find live streaming url to stop"),c.onError(s),ce.reject(s))}async addInjectStreamUrl(r,s){let c=z.reportApiInvoke(this._sessionId,{name:we.ADD_INJECT_STREAM_URL,options:[r,s],tag:Re.TRACER});try{if(!this._joinInfo)throw new L(D.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");let u=this._createLiveStreamingClient(Zt.INJECT);u.setInjectStreamConfig(s,0),await u.startLiveStreamingTask(r,Zt.INJECT)}catch(u){throw c.onError(u),u}c.onSuccess()}async removeInjectStreamUrl(){let r=z.reportApiInvoke(this._sessionId,{name:we.REMOVE_INJECT_STREAM_URL,options:[],tag:Re.TRACER});try{var s,c;let u=this._createLiveStreamingClient(Zt.INJECT),h=Je(s=Ji(Js(c=u.streamingTasks).call(c))).call(s,A=>A.mode===Zt.INJECT);if(!this._joinInfo||!h)throw new L(D.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");await u.stopLiveStreamingTask(h.url)}catch(u){throw r.onError(u),u}r.onSuccess()}async startChannelMediaRelay(r){let s=z.reportApiInvoke(this._sessionId,{name:we.START_CHANNEL_MEDIA_RELAY,options:[r],tag:Re.TRACER});try{mm(r),await this._createChannelMediaRelayClient().startChannelMediaRelay(r)}catch(c){return s.onError(c),c.throw()}s.onSuccess()}async updateChannelMediaRelay(r){let s=z.reportApiInvoke(this._sessionId,{name:we.UPDATE_CHANNEL_MEDIA_RELAY,options:[r],tag:Re.TRACER});try{mm(r),await this._createChannelMediaRelayClient().updateChannelMediaRelay(r)}catch(c){return s.onError(c),c.throw()}s.onSuccess()}async stopChannelMediaRelay(){let r=z.reportApiInvoke(this._sessionId,{name:we.STOP_CHANNEL_MEDIA_RELAY,options:[],tag:Re.TRACER});try{await this._createChannelMediaRelayClient().stopChannelMediaRelay()}catch(s){return r.onError(s),s.throw()}r.onSuccess()}sendStreamMessage(r,s=!0){if(!this._joinInfo)throw new L(D.INVALID_OPERATION,"can not send data stream, not joined");if(typeof r=="string"&&(r=new TextEncoder().encode(r)),1024<new Blob([r]).size)throw new L(D.INVALID_PARAMS,"stream message out of range.");return this._gateway.signal.request(Tt.DATA_STREAM,{payload:vu(r)},!s)}sendMetadata(r){if(!this._joinInfo)throw new L(D.INVALID_OPERATION,"can not send metadata, not joined");if(1024<new Blob([r]).size)throw new L(D.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Tt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:vu(r)})}async sendCustomReportMessage(r){Wi(r)||(r=[r]),W(r).call(r,nS);let s=z.reportApiInvoke(this._sessionId,{name:we.SEND_CUSTOM_REPORT_MESSAGE,options:[fe(r)],tag:Re.TRACER});if(!this._joinInfo)return r=new L(D.INVALID_OPERATION,"can not send custom report, not joined"),s.onError(r),r.throw();await z.sendCustomReportMessage(this._joinInfo.sid,r),s.onSuccess()}getLocalAudioStats(){if(!this._highStream)return Ju;let r=this._statsCollector.getLocalAudioTrackStats(this._highStream.connectionId);return dn()&&this._highStream&&this._highStream.audioTrack&&(this._highStream.audioTrack instanceof $r?!this._highStream.audioTrack.isActive:!this._highStream.audioTrack.enabled)&&(r.sendVolumeLevel=0),r}getRemoteAudioStats(){var r;let s={};return W(r=this._remoteStream).call(r,(c,u)=>{s[u]=this._statsCollector.getRemoteAudioTrackStats(c.connectionId)}),s}getLocalVideoStats(){return this._highStream?this._statsCollector.getLocalVideoTrackStats(this._highStream.connectionId):zu}getRemoteVideoStats(){var r;let s={};return W(r=this._remoteStream).call(r,(c,u)=>{s[u]=this._statsCollector.getRemoteVideoTrackStats(c.connectionId)}),s}getRemoteNetworkQuality(){var r;let s={};return W(r=this._remoteStream).call(r,(c,u)=>{s[u]=this._statsCollector.getRemoteNetworkQualityStats(c.connectionId)}),s}async pickSVCLayer(r,s){hn(s.spatialLayer,"spatialLayer",[0,1,2,3]),hn(s.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(r,s)}catch(c){throw R.error("[".concat(this._clientId,"] pick SVC layer failed"),c.toString()),c}}_reset(){var r,s,c;R.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=mo.CancelToken.source(),this._streamFallbackTypeCacheMap=new Ct,this._remoteStreamTypeCacheMap=new Ct,this._configDistribute.stopGetConfigDistribute(),this._defaultStreamFallbackType=this._proxyServer=this._joinInfo=void 0,this._sessionId=null,this._statsCollector.reset(),this._channelName=this._uid=this._appId=this._key=void 0,this._encryptionMode="none",this._encryptionSalt=this._encryptionSecret=null,W(r=this._users).call(r,u=>{u.audioTrack&&(u.audioTrack.stop(),u.audioTrack._isDestroyed=!0),u.videoTrack&&(u.videoTrack.stop(),u.videoTrack._isDestroyed=!0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._highStream&&(this._highStream.closeP2PConnection(!0),this._highStream=void 0),W(s=this._bindEnabledTracks).call(s,u=>{u.off(Me.NEED_ADD_TRACK,this._handleLocalTrackEnable),u.off(Me.NEED_REMOVE_TRACK,this._handleLocalTrackDisable)}),this._bindEnabledTracks=[],this._lowStream&&(this._lowStream.closeP2PConnection(!0),this._lowStream=void 0),W(c=this._remoteStream).call(c,u=>{u.closeP2PConnection(!0)}),this._remoteStream=new Ct,this._publishMutex=new Vo("client-publish"),this._subscribeMutex=new Ct,this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0)}_startSession(r,s){var c,u,h;let A=r||er(32,"").toUpperCase();r?R.debug(b(c="[".concat(this._clientId,"] new Session ")).call(c,A)):R.debug(b(u=b(h="[".concat(this._clientId,"] renewSession ")).call(h,this._sessionId," => ")).call(u,A)),this._sessionId=A,s?z.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:s.channel,appid:s.appId,mode:this._mode}):this._joinInfo?z.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:this._joinInfo.cname,appid:this._joinInfo.appId,mode:this._mode}):this._gateway.joinInfo&&z.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId,mode:this._mode}),this._joinInfo&&(this._joinInfo.sid=A),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=A)}async _publishHighStream(r){if(!this._joinInfo)throw new L(D.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new L(D.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&ne.FORCE_TURN&&!ne.TURN_ENABLE_TCP&&!ne.TURN_ENABLE_UDP)throw new L(D.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");if(R.debug("[".concat(this._clientId,"] publish high stream")),this._highStream)return await this._highStream.addTracks(r),this._highStream;this._highStream=new EI(this._statsCollector,this._joinInfo,this._codec),this._highStream.on(De.P2P_LOST,()=>{this._highStream&&this.emit(qe.P2P_LOST,this._highStream.getUserId())}),await this._highStream.addTracks(r);try{await this._gateway.publish(this._highStream,"high")}catch(s){throw this._highStream=void 0,s}return this._highStream.on(De.CONNECTION_STATE_CHANGE,(s,c)=>{this._highStream&&(s==="connected"?this.emit(qe.MEDIA_RECONNECT_END,this._highStream.getUserId()):s==="connecting"&&this.emit(qe.MEDIA_RECONNECT_START,this._highStream.getUserId()))}),this._highStream}async _publishLowStream(r){if(!this._joinInfo)throw new L(D.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new L(D.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(!this._highStream||this._highStream.connectionState!=="connected")throw new L(D.UNEXPECTED_ERROR,"Could not find high stream");if(this._lowStream)return new L(D.UNEXPECTED_ERROR,"[".concat(this._clientId,"] Can't publish low stream when stream already publish")).throw();R.debug("[".concat(this._clientId,"] publish low stream")),this._lowStream=new EI(this._statsCollector,this._joinInfo,this._codec,!0);let s=this._configDistribute.getLowStreamConfigDistribute();s&&s.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&s.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=s.bitrate)),this._lowStream.lowStreamParameter=this._lowStreamParameter,await this._lowStream.addTracks([r]);try{await this._gateway.publish(this._lowStream,"low")}catch(c){throw this._lowStream=void 0,c}this._highStream.lowStreamConnection=this._lowStream}_createLiveStreamingClient(r){if(!this._joinInfo||!this._appId)return new L(D.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();let s=()=>new _w(this._joinInfo,this._config.websocketRetryConfig||Tr,this._config.httpRetryConfig||Tr),c=u=>{u.onLiveStreamError=(h,A)=>{z.reportApiInvoke(this._sessionId,{name:we.ON_LIVE_STREAM_ERROR,options:[h,A],tag:Re.TRACER}).onSuccess(),this.emit(qe.LIVE_STREAMING_ERROR,h,A)},u.onLiveStreamWarning=(h,A)=>{z.reportApiInvoke(this._sessionId,{name:we.ON_LIVE_STREAM_WARNING,options:[h,A],tag:Re.TRACER}).onSuccess(),this.emit(qe.LIVE_STREAMING_WARNING,h,A)},u.on(za.REQUEST_WORKER_MANAGER_LIST,(h,A,f)=>{if(!this._joinInfo)return f(new L(D.INVALID_OPERATION,"can not find join info to get worker manager"));nm(h,this._joinInfo,this._axiosCancelSource.token,Tr).then(A).catch(f)})};switch(r){case Zt.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=s(),c(this._liveRawStreamingClient)),this._liveRawStreamingClient;case Zt.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=s(),c(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case Zt.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=s(),this._injectStreamingClient.on(za.REQUEST_WORKER_MANAGER_LIST,(u,h,A)=>{if(!this._joinInfo)return A(new L(D.INVALID_OPERATION,"can not find join info to get worker manager"));nm(u,this._joinInfo,this._axiosCancelSource.token,Tr).then(h).catch(A)}),this._injectStreamingClient.onInjectStatusChange=(u,h,A)=>{this.emit(qe.INJECT_STREAM_STATUS,u,h,A)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){return this._joinInfo?(this._channelMediaRelayClient||(this._channelMediaRelayClient=new Tw(this._joinInfo,this._clientId,this._config.websocketRetryConfig||Tr,this._config.httpRetryConfig||Tr),this._channelMediaRelayClient.on("state",r=>{r==="RELAY_STATE_FAILURE"&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.emit(qe.CHANNEL_MEDIA_RELAY_STATE,r)}),this._channelMediaRelayClient.on("event",r=>{this.emit(qe.CHANNEL_MEDIA_RELAY_EVENT,r)})),this._channelMediaRelayClient):new L(D.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw()}_handleGatewayEvents(){this._gateway.on(_r.DISCONNECT_P2P,()=>{var r;R.debug("[".concat(this._clientId,"] start full reconnect")),this._highStream&&this._highStream.connectionState!=="disconnected"&&(R.debug("[".concat(this._clientId,"] ready to reconnect high stream")),this._highStream.readyToReconnectPC()),this._lowStream&&this._lowStream.connectionState!=="disconnected"&&(R.debug("[".concat(this._clientId,"] ready to reconnect low stream")),this._lowStream.readyToReconnectPC()),W(r=this._remoteStream).call(r,(s,c)=>{var u;R.debug(b(u="[".concat(this._clientId,"] ready to reconnect remote stream ")).call(u,c)),s.readyToReconnectPC()})}),this._gateway.on(_r.CONNECTION_STATE_CHANGE,(r,s,c)=>{var u,h;let A=()=>{this.emit(qe.CONNECTION_STATE_CHANGE,r,s,c)};if(R.info(b(u=b(h="[".concat(this._clientId,"] connection state change: ")).call(h,s," -> ")).call(u,r)),r==="DISCONNECTED")return this._reset(),void A();var f,m;if(r==="RECONNECTING")this._highStream&&this._highStream.connectionState==="connecting"&&(R.debug("[".concat(this._clientId,"] ready to reconnect high stream")),this._highStream.readyToReconnectPC()),this._lowStream&&this._lowStream.connectionState==="connecting"&&(R.debug("[".concat(this._clientId,"] ready to reconnect low stream")),this._lowStream.readyToReconnectPC()),W(f=this._remoteStream).call(f,(_,S)=>{var N;_.connectionState==="connecting"&&(R.debug(b(N="[".concat(this._clientId,"] ready to reconnect remote stream ")).call(N,S)),_.readyToReconnectPC())}),W(m=this._users).call(m,_=>{_._trust_in_room_=!1,_._trust_audio_enabled_state_=!1,_._trust_video_enabled_state_=!1,_._trust_audio_mute_state_=!1,_._trust_video_mute_state_=!1,_._trust_stream_added_state_=!1}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._streamRemovedTimeout=this._userOfflineTimeout=void 0;else if(r==="CONNECTED"){var I,E;W(I=this._streamFallbackTypeCacheMap).call(I,(_,S)=>{this._gateway.setStreamFallbackOption(S,_).catch(N=>R.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),N))}),W(E=this._remoteStreamTypeCacheMap).call(E,(_,S)=>{this._gateway.setRemoteVideoStreamType(S,_).catch(N=>R.warning("[".concat(this._clientId,"] auto set remote stream type failed"),N))}),this._highStream&&this._highStream.connectionState==="connecting"?this._highStream.reconnectPC().then(()=>{this._lowStream&&this._lowStream.connectionState==="connecting"&&this._lowStream.reconnectPC().catch(_=>{R.error("[".concat(this._clientId,"] republish low stream error"),_.toString()),this.emit(qe.ERROR,{reason:_})})}).catch(_=>{R.error("[".concat(this._clientId,"] republish high stream error"),_.toString()),this.emit(qe.ERROR,{reason:_})}):this._lowStream&&this._lowStream.connectionState==="connecting"&&this._lowStream.reconnectPC().catch(_=>{R.error("[".concat(this._clientId,"] republish low stream error"),_.toString()),this.emit(qe.ERROR,{reason:_})}),this._userOfflineTimeout=window.setTimeout(()=>{var _;if(this.connectionState==="CONNECTED"){this._userOfflineTimeout=void 0;var S=Qe(_=this._users).call(_,N=>!N._trust_in_room_);W(S).call(S,N=>{var k;R.debug(b(k="[".concat(this._clientId,"] user offline timeout, emit user offline ")).call(k,N.uid)),this._handleUserOffline({uid:N.uid})})}},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{var _;this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,W(_=this._users).call(_,S=>{var N,k,B,P,J;S._trust_audio_mute_state_||(R.debug(b(N="[".concat(this._clientId,"] auto dispatch audio unmute event ")).call(N,S.uid)),this._handleMuteStream(S.uid,"audio",!1)),S._trust_video_mute_state_||(R.debug(b(k="[".concat(this._clientId,"] auto dispatch video unmute event ")).call(k,S.uid)),this._handleMuteStream(S.uid,"video",!1)),S._trust_audio_enabled_state_||(R.debug(b(B="[".concat(this._clientId,"] auto dispatch enable local audio ")).call(B,S.uid)),this._handleSetStreamLocalEnable("audio",S.uid,!0)),!S._trust_video_enabled_state_&&S._video_enabled_&&(R.debug(b(P="[".concat(this._clientId,"] auto dispatch enable local video ")).call(P,S.uid)),this._handleSetStreamLocalEnable("video",S.uid,!0)),S._trust_stream_added_state_||(R.debug(b(J="[".concat(this._clientId,"] auto dispatch stream remove ")).call(J,S.uid)),this._handleRemoveStream({uid:S.uid,uint_id:S._uintid}))}))},1e3)}A()}),this._gateway.on(_r.REQUEST_NEW_GATEWAY_LIST,(r,s)=>{if(!this._joinInfo)return s(new L(D.UNEXPECTED_ERROR,"can not recover, no join info"));Kc(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Tr).then(c=>{var u;this._joinInfo&&(this._joinInfo.apResponse=c.gatewayInfo.res),r(Ie(u=c.gatewayInfo.gatewayAddrs).call(u,h=>{if(this._joinInfo&&this._joinInfo.proxyServer){var A,f;return h=h.split(":"),b(A=b(f="wss://".concat(this._joinInfo.proxyServer,"/ws/?h=")).call(f,h[0],"&p=")).call(A,h[1])}return"wss://".concat(h)}))}).catch(s)}),this._gateway.on(_r.NETWORK_QUALITY,r=>{this._networkQualitySensitivity==="normal"&&this.emit(qe.NETWORK_QUALITY,r)}),this._gateway.on(_r.STREAM_TYPE_CHANGE,(r,s)=>{this.emit(qe.STREAM_TYPE_CHANGED,r,s),z.reportApiInvoke(this._sessionId,{name:we.STREAM_TYPE_CHANGE,options:[r,s],tag:Re.TRACER}).onSuccess(fe({uid:r,streamType:s}))}),this._gateway.on(_r.IS_P2P_DISCONNECTED,r=>{var s,c,u;let h=[];return this._highStream&&h.push(this._highStream),W(s=this._remoteStream).call(s,A=>h.push(A)),h.length===0||Qe(h).call(h,A=>A.connectionState==="connected").length===0?r(!0):(R.debug(b(c="[".concat(this._clientId,"] ")).call(c,Ie(u=Qe(h).call(h,A=>A.connectionState==="connected")).call(u,A=>A.connectionId)," is connected")),void r(!1))}),this._gateway.on(_r.NEED_RENEW_SESSION,()=>{this._startSession()}),this._gateway.signal.on(mt.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(mt.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(mt.ON_ADD_AUDIO_STREAM,r=>this._handleAddAudioOrVideoStream("audio",r.uid,r.uint_id)),this._gateway.signal.on(mt.ON_ADD_VIDEO_STREAM,r=>this._handleAddAudioOrVideoStream("video",r.uid,r.uint_id)),this._gateway.signal.on(mt.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(mt.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(mt.MUTE_AUDIO,r=>this._handleMuteStream(r.uid,"audio",!0)),this._gateway.signal.on(mt.UNMUTE_AUDIO,r=>this._handleMuteStream(r.uid,"audio",!1)),this._gateway.signal.on(mt.MUTE_VIDEO,r=>this._handleMuteStream(r.uid,"video",!0)),this._gateway.signal.on(mt.UNMUTE_VIDEO,r=>this._handleMuteStream(r.uid,"video",!1)),this._gateway.signal.on(mt.RECEIVE_METADATA,r=>{let s=wh(r.metadata);this.emit(qe.RECEIVE_METADATA,r.uid,s)}),this._gateway.signal.on(mt.ON_DATA_STREAM,r=>{r.seq&&delete r.seq,r.payload=wh(r.payload),this.emit(qe.STREAM_MESSAGE,r.uid,r.payload),this.onStreamMessage&&this.onStreamMessage(r)}),this._gateway.signal.on(mt.ON_CRYPT_ERROR,()=>{Hc(()=>{R.warning("[".concat(this._clientId,"] on crypt error")),this.emit(qe.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(mt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(mt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{R.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._reset(),this._gateway.leave(!0),this.emit(qe.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this._gateway.signal.on(mt.ON_STREAM_FALLBACK_UPDATE,r=>{var s,c;R.debug(b(s=b(c="[".concat(this._clientId,"] stream fallback peerId: ")).call(c,r.stream_id,", attr: ")).call(s,r.stream_type)),this.emit(qe.STREAM_FALLBACK,r.stream_id,r.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(mt.ON_PUBLISH_STREAM,r=>{var s;this.uid===this._uid&&(this._highStream&&this._highStream._waitingSuccessResponse&&this._highStream.connectionState==="connected"?(this._highStream.reportPublishEvent(!0,null,fe({proxy:r.proxy})),R.info(b(s="[".concat(this._clientId,"] on publish stream, ")).call(s,fe(r))),r.proxy!==void 0&&this.emit(qe.IS_USING_CLOUD_PROXY,!!r.proxy)):this._lowStream?this._lowStream.reportPublishEvent(!0,null,fe({proxy:r.proxy})):R.warning("get on_publish_stream message but cannot handle"))}),this._gateway.signal.on(mt.ENABLE_LOCAL_VIDEO,r=>{this._handleSetStreamLocalEnable("video",r.uid,!0)}),this._gateway.signal.on(mt.DISABLE_LOCAL_VIDEO,r=>{this._handleSetStreamLocalEnable("video",r.uid,!1)}),this._gateway.signal.on(Xe.REQUEST_TIMEOUT,(r,s)=>{if(this._joinInfo)switch(r){case Tt.PUBLISH:var c;if(!s||(r=s.stream_type==="high"?this._highStream:this._lowStream,!r))break;s.state==="offer"&&z.publish(this._joinInfo.sid,{lts:r.startTime,succ:!1,ec:D.TIMEOUT,audio:s.audio,video:s.video,p2pid:s.p2p_id,publishRequestid:r.ID,screenshare:!(!r.videoTrack||Ge(c=r.videoTrack._hints).call(c,Yi.SCREEN_TRACK)===-1),audioName:r.audioTrack&&(r.audioTrack instanceof $r?r.audioTrack.getSubTrackLabels().join(","):r.audioTrack.getTrackLabel()),videoName:r.videoTrack&&r.videoTrack.getTrackLabel()});break;case Tt.SUBSCRIBE:(c=this._remoteStream.get(s.stream_id))&&s&&z.subscribe(this._joinInfo.sid,{lts:c.startTime,succ:!1,ec:D.TIMEOUT,audio:!!s.audio,video:!!s.video,peerid:s.stream_id,subscribeRequestid:c.ID,p2pid:c.pc.ID})}})}}yl([Fc({report:z}),Nn("design:type",Function),Nn("design:paramtypes",[String]),Nn("design:returntype",void 0)],ic.prototype,"setProxyServer",null),yl([Fc(),Nn("design:type",Function),Nn("design:paramtypes",[Object]),Nn("design:returntype",void 0)],ic.prototype,"setTurnServer",null),yl([Fc({report:z}),Nn("design:type",Function),Nn("design:paramtypes",[Array,String]),Nn("design:returntype",void 0)],ic.prototype,"setLocalAccessPoints",null),yl([Fc({report:z}),Nn("design:type",Function),Nn("design:paramtypes",[String,String,Uint8Array]),Nn("design:returntype",void 0)],ic.prototype,"setEncryptionConfig",null),yl([_h({report:z}),Nn("design:type",Function),Nn("design:paramtypes",[Object,Object]),Nn("design:returntype",ce)],ic.prototype,"pickSVCLayer",null);class bw extends qE{constructor(r,s={}){super();this.currentLoopCount=this.pausePlayTime=this.startPlayOffset=this.startPlayTime=0,this._currentState="stopped",this.audioBuffer=r,this.options=s,this.startPlayOffset=this.options.startPlayTime||0}set currentState(r){r!==this._currentState&&(this._currentState=r,this.emit(ki.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer.duration}get currentTime(){return this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:(this.context.currentTime-this.startPlayTime+this.startPlayOffset)%this.audioBuffer.duration}updateOptions(r){this.currentState==="stopped"?(this.options=r,this.startPlayOffset=this.options.startPlayTime||0):R.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(r){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=r,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=r))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}startSourceNode(){var r;this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=cr(r=this.handleSourceNodeEnded).call(r,this))}createSourceNode(){let r=this.context.createBufferSource();return r.buffer=this.audioBuffer,r.loop=!!this.options.loop,r.connect(this.outputNode),r}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}let yI=new Ct;var Dw=Bt.setInterval;let Bw=Ye().name;class _l{constructor(r,s){this.id=0,_l.count+=1,this.id=_l.count,this.element=r,this.context=s}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=r=>{let s=document.createElement("audio");s.srcObject=new MediaStream([r.track]),s.play(),this.audioPlayerElement=s}}async switchSdp(){if(this.peerPair){var r=async(c,u)=>(u=u==="offer"?await c.createOffer():await c.createAnswer(),await c.setLocalDescription(u),c.iceGatheringState==="complete"?c.localDescription:new ce(h=>{c.onicegatheringstatechange=()=>{c.iceGatheringState==="complete"&&h(c.localDescription)}})),s=async(c,u)=>await c.setRemoteDescription(u);try{let c=await r(this.peerPair[0],"offer");await s(this.peerPair[1],c);let u=await r(this.peerPair[1],"answer");await s(this.peerPair[0],u)}catch(c){throw new L(D.LOCAL_AEC_ERROR,c.toString()).print()}}}async getTracksFromMediaElement(r){if(this.audioTrack)return this.audioTrack;let s;try{r instanceof HTMLVideoElement&&(r.captureStream?r.captureStream():r.mozCaptureStream()),s=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(r).connect(s)}catch(c){throw new L(D.LOCAL_AEC_ERROR,c.toString()).print()}if(!s)throw new L(D.LOCAL_AEC_ERROR,"no dest node when local aec").print();return r=s.stream.getAudioTracks()[0],this.audioTrack=r,r}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();let r=await this.getTracksFromMediaElement(this.element);this.peerPair&&this.peerPair[0].addTrack(r),await this.switchSdp()}close(){var r;R.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&W(r=this.peerPair).call(r,s=>{s.close()}),this.audioPlayerElement=this.peerPair=void 0}}_l.count=0;var AA=function(i,r){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,r)};let Mw=window.AudioContext||window.webkitAudioContext;class _I{constructor(){this.units=[]}processExternalMediaAEC(r){var s;if(!this._doesEnvironmentNeedAEC())return R.debug("the system does not need to process local aec"),-1;this.context||(this.context=new Mw);let c=Je(s=this.units).call(s,u=>u&&u.getElement()===r);return c||(c=new _l(r,this.context),this.units.push(c)),c.startEchoCancellation(),R.debug("start processing local audio echo cancellation, id is",c.id),c.id}_doesEnvironmentNeedAEC(){return Ye().name!==ze.SAFARI}}(function(i,r,s,c){var u,h=arguments.length,A=3>h?r:c===null?c=ct(r,s):c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")A=Reflect.decorate(i,r,s,c);else for(var f=i.length-1;0<=f;f--)(u=i[f])&&(A=(3>h?u(A):3<h?u(r,s,A):u(r,s))||A);return 3<h&&A&&ht(r,s,A),A})([Fc({report:z}),AA("design:type",Function),AA("design:paramtypes",[HTMLAudioElement]),AA("design:returntype",Number)],_I.prototype,"processExternalMediaAEC",null);let Lw=new _I;var SI,TI,RI,wI;Ur("PROCESS_ID",b(SI=b(TI=b(RI=b(wI="process-".concat(er(8,""),"-")).call(wI,er(4,""),"-")).call(RI,er(4,""),"-")).call(TI,er(4,""),"-")).call(SI,er(12,""))),function(){let i=Ye();var r=!!(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia);kt.getDisplayMedia=r,kt.getStreamFromExtension=i.name===ze.CHROME&&34<Number(i.version),kt.supportUnifiedPlan=function(){if(!(window.RTCRtpTransceiver&&"currentDirection"in RTCRtpTransceiver.prototype))return!1;let s=new RTCPeerConnection,c=!1;try{s.addTransceiver("audio"),c=!0}catch{}return s.close(),c}(),kt.supportMinBitrate=i.name===ze.CHROME||i.name===ze.EDGE,kt.supportSetRtpSenderParameters=function(){let s=Ye();return window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters?!!ts()||!(!dn()&&!ao())||s.name===ze.FIREFOX&&64<=Number(s.version):!1}(),i.name===ze.SAFARI&&(14<=Number(i.version)?kt.supportDualStream=!0:kt.supportDualStream=!1),kt.webAudioMediaStreamDest=function(){let s=Ye();return!(s.name===ze.SAFARI&&12>Number(s.version))}(),kt.supportReplaceTrack=window.RTCRtpSender?typeof RTCRtpSender.prototype.replaceTrack=="function":!1,kt.supportWebGL=typeof WebGLRenderingContext!="undefined",kt.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,ts()||(kt.webAudioWithAEC=!0),kt.supportShareAudio=function(){let s=Ye();return(s.os===Lr.WIN_10||s.os===Lr.WIN_81||s.os===Lr.WIN_7||s.os===Lr.LINUX||s.os===Lr.MAC_OS)&&s.name===ze.CHROME&&74<=Number(s.version)}(),kt.supportDualStreamEncoding=function(){let s=Ye();return s.name==="Safari"&&14<=Number(s.version)}(),R.info("browser compatibility",fe(kt),fe(i))}();let kn={__CLIENT_LIST__:xo,__TRACK_LIST__:ls,VERSION:Hn,BUILD:"v4.7.3-0-g0eb931c7(11/16/2021, 7:57:58 PM)",setParameter:Ur,getParameter:function(i){return ne[i]},getSupportedCodec:async function(i){let r=null;return i?(r=new aI({}),r.addStream(i)):r=new cI({}),i=lm(await r.createOfferSDP()),r.close(),i},checkSystemRequirements:function(){const i=z.reportApiInvoke(null,{name:we.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Re.TRACER});var r=!1;try{var s=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,c=window.WebSocket;r=!!(window.RTCPeerConnection&&s&&c)}catch(u){return R.error("check system requirement failed: ",u),!1}return s=!1,c=Ye(),c.name===ze.CHROME&&58<=Number(c.version)&&(pn.engine.name!=="WebKit"||ya())&&(s=!0),c.name===ze.FIREFOX&&56<=Number(c.version)&&(s=!0),c.name===ze.OPERA&&45<=Number(c.version)&&(s=!0),c.name===ze.SAFARI&&11<=Number(c.version)&&(s=!0),Ye().name!==ze.WECHAT&&Ye().name!==ze.QQ||(s=!0),R.debug("checkSystemRequirements, api:",r,"browser",s),r=r&&s,i.onSuccess(r),r},getDevices:function(i){return wn.enumerateDevices(!0,!0,i)},getMicrophones:function(i){return wn.getRecordingDevices(i)},getCameras:function(i){return wn.getCamerasDevices(i)},getElectronScreenSources:xg,getPlaybackDevices:function(i){return wn.getSpeakers(i)},createClient:function(i={codec:"vp8",mode:"rtc"}){const r=z.reportApiInvoke(null,{name:we.CREATE_CLIENT,options:[i],tag:Re.TRACER});try{hn(i.codec,"config.codec",["vp8","vp9","av1","h264"]),hn(i.mode,"config.mode",["rtc","live"]),i.proxyServer!==void 0&&Vr(i.proxyServer,"config.proxyServer",1,1e4),i.turnServer!==void 0&&bg(i.turnServer),i.httpRetryConfig!==void 0&&kg(i.httpRetryConfig),i.websocketRetryConfig!==void 0&&kg(i.websocketRetryConfig)}catch(s){throw r.onError(s),s}return r.onSuccess(),new ic(ba({forceWaitGatewayResponse:!0},i,{role:i.mode==="rtc"?"host":i.role}))},createCameraVideoTrack:async function(i={encoderConfig:"480p_1"}){const r=z.reportApiInvoke(null,{tag:Re.TRACER,name:we.CREATE_CAM_VIDEO_TRACK,options:[xh({},i)]}),s=Bh(i);var c=er(8,"track-cam-");let u=null;R.info("start create camera video track with config",fe(i),"trackId",c);try{u=(await _i({video:s},c)).getVideoTracks()[0]||null}catch(h){throw r.onError(h),h}return u?(i.optimizationMode&&Uh(c,u,i,i.encoderConfig&&rs(i.encoderConfig)),i=new El(u,i,s,i.scalabiltyMode?_a(i.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},i.optimizationMode,c),r.onSuccess(i.getTrackId()),R.info("create camera video success, trackId:",c),i):(c=new L(D.UNEXPECTED_ERROR,"can not find track in media stream"),r.onError(c),c.throw())},createCustomVideoTrack:function(i){const r=z.reportApiInvoke(null,{tag:Re.TRACER,name:we.CREATE_CUSTOM_VIDEO_TRACK,options:[i]}),s=new Kt(i.mediaStreamTrack,{bitrateMax:i.bitrateMax,bitrateMin:i.bitrateMin},i.scalabiltyMode?_a(i.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},i.optimizationMode);return r.onSuccess(s.getTrackId()),R.info("create custom video track success with config",i,"trackId",s.getTrackId()),s},createScreenVideoTrack:async function(i={},r="disable"){const s=z.reportApiInvoke(null,{tag:Re.TRACER,name:we.CREATE_SCREEN_VIDEO_TRACK,options:[xh({},i),r]});i.encoderConfig?typeof i.encoderConfig=="string"||i.encoderConfig.width&&i.encoderConfig.height||(i.encoderConfig.width={max:1920},i.encoderConfig.height={max:1080}):i.encoderConfig="1080p_2";var c={};i.screenSourceType&&(c.mediaSource=i.screenSourceType),i.extensionId&&co()&&(c.extensionId=i.extensionId),i.electronScreenSourceId&&(c.sourceId=i.electronScreenSourceId);var u=i.encoderConfig?xc(i.encoderConfig):null;u=(c.mandatory={chromeMediaSource:"desktop",maxWidth:u?u.width:void 0,maxHeight:u?u.height:void 0},u&&u.frameRate&&(typeof u.frameRate=="number"?(c.mandatory.maxFrameRate=u.frameRate,c.mandatory.minFrameRate=u.frameRate):(c.mandatory.maxFrameRate=u.frameRate.max||u.frameRate.ideal||u.frameRate.exact||void 0,c.mandatory.minFrameRate=u.frameRate.min||u.frameRate.ideal||u.frameRate.exact||void 0),c.frameRate=u.frameRate),u&&u.width&&(c.width=u.width),u&&u.height&&(c.height=u.height),c);const h=er(8,"track-scr");let A=null;c=null;const f=kt;if(!f.supportShareAudio&&r==="enable")return i=new L(D.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio"),s.onError(i),i.throw();R.info("start create screen video track with config",i,"withAudio",r,"trackId",h);try{const m=await _i({screen:u,screenAudio:r==="auto"?f.supportShareAudio:r==="enable"},h);A=m.getVideoTracks()[0]||null,c=m.getAudioTracks()[0]||null}catch(m){throw s.onError(m),m}return A?!c&&r==="enable"?(A&&A.stop(),i=new L(D.SHARE_AUDIO_NOT_ALLOWED),s.onError(i),i.throw()):(i.optimizationMode||(i.optimizationMode="detail"),i.optimizationMode&&(Uh(h,A,i,i.encoderConfig&&xc(i.encoderConfig)),i.encoderConfig&&typeof i.encoderConfig!="string"&&(i.encoderConfig.bitrateMin=i.encoderConfig.bitrateMax)),i=new Kt(A,i.encoderConfig?xc(i.encoderConfig):{},i.scalabiltyMode?_a(i.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},i.optimizationMode,h),i._hints.push(Yi.SCREEN_TRACK),c?(r=new wr(c),s.onSuccess([i.getTrackId(),r.getTrackId()]),R.info("create screen video track success","video:",i.getTrackId(),"audio:",r.getTrackId()),[i,r]):(s.onSuccess(i.getTrackId()),R.info("create screen video track success","video:",i.getTrackId()),i)):(i=new L(D.UNEXPECTED_ERROR,"can not find track in media stream"),s.onError(i),i.throw())},createMicrophoneAndCameraTracks:async function(i={},r={encoderConfig:"480p_1"}){var s,c,u;const h=z.reportApiInvoke(null,{tag:Re.TRACER,name:we.CREATE_MIC_AND_CAM_TRACKS,options:[i,r]}),A=Bh(r),f=am(i),m=er(8,"track-mic-"),I=er(8,"track-cam-");let E=null,_=null;R.info(b(s=b(c=b(u="start create camera video track(".concat(I,") and microphone audio track(")).call(u,m,") with config, audio: ")).call(c,fe(i),", video: ")).call(s,fe(r)));try{var S;const k=await _i({audio:f,video:A},b(S="".concat(m,"-")).call(S,I));E=k.getAudioTracks()[0],_=k.getVideoTracks()[0]}catch(k){throw h.onError(k),k}if(!E||!_){var N=new L(D.UNEXPECTED_ERROR,"can not find tracks in media stream");return h.onError(N),N.throw()}return r.optimizationMode&&Uh(I,_,r,r.encoderConfig&&rs(r.encoderConfig)),i=new dl(E,i,f,m),r=new El(_,r,A,r.scalabiltyMode?_a(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,I),h.onSuccess([i.getTrackId(),r.getTrackId()]),R.info(b(N="create camera video track(".concat(I,") and microphone audio track(")).call(N,m,") success")),[i,r]},createMicrophoneAudioTrack:async function(i={}){const r=z.reportApiInvoke(null,{tag:Re.TRACER,name:we.CREATE_MIC_AUDIO_TRACK,options:[i]}),s=am(i);var c=er(8,"track-mic-");let u=null;R.info("start create microphone audio track with config",fe(i),"trackId",c);try{u=(await _i({audio:s},c)).getAudioTracks()[0]||null}catch(h){throw r.onError(h),h}return u?(i=new dl(u,i,s,c),r.onSuccess(i.getTrackId()),R.info("create microphone audio track success, trackId:",c),i):(c=new L(D.UNEXPECTED_ERROR,"can not find track in media stream"),r.onError(c),c.throw())},createCustomAudioTrack:function(i){const r=z.reportApiInvoke(null,{tag:Re.TRACER,name:we.CREATE_CUSTOM_AUDIO_TRACK,options:[i]}),s=new wr(i.mediaStreamTrack,i.encoderConfig?Sa(i.encoderConfig):{});return R.info("create custom audio track success with config",i,"trackId",s.getTrackId()),r.onSuccess(s.getTrackId()),s},createBufferSourceAudioTrack:async function(i){const r=z.reportApiInvoke(null,{tag:Re.TRACER,name:we.CREATE_BUFFER_AUDIO_TRACK,options:[i]}),s=er(8,"track-buf-");R.info("start create buffer source audio track with config",fe(i),"trackId",s);const c=i.source;if(!(i.source instanceof AudioBuffer))try{i.source=await ES(i.source,i.cacheOnlineFile)}catch(h){return r.onError(h),h.throw()}const u=new bw(i.source);return i=new Za(c,u,i.encoderConfig?Sa(i.encoderConfig):{},s),R.info("create buffer source audio track success, trackId:",s),r.onSuccess(i.getTrackId()),i},setLogLevel:function(i){R.setLogLevel(i)},enableLogUpload:function(){R.enableLogUpload()},disableLogUpload:function(){R.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new CI},checkAudioTrackIsActive:async function(i,r=5e3){const s=z.reportApiInvoke(null,{tag:Re.TRACER,name:we.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[r]});if(!(i instanceof wr||i instanceof Cl)){var c=new L(D.INVALID_TRACK,"the parameter is not a audio track");return s.onError(c),c.throw()}r&&1e3>r&&(r=1e3);const u=i instanceof wr?i.getTrackLabel():"remote_track";let h=c=i.getVolumeLevel(),A=c;const f=de();return new ce(m=>{const I=Dw(()=>{var E=i.getVolumeLevel();h=E>h?E:h,A=E<A?E:A,E=1e-4<h-A;var _=de()-f;if(E||_>r){var S;clearInterval(I),_={duration:_,deviceLabel:u,maxVolumeLevel:h,result:E},R.info(b(S="[track-".concat(i.getTrackId(),"] check audio track active completed. ")).call(S,fe(_))),s.onSuccess(_),m(E)}},200)})},checkVideoTrackIsActive:async function(i,r=5e3){var s;const c=z.reportApiInvoke(null,{tag:Re.TRACER,name:we.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[r]});if(!(i instanceof Kt||i instanceof Il))return i=new L(D.INVALID_TRACK,"the parameter is not a video track"),c.onError(i),i.throw();r&&1e3>r&&(r=1e3);var u=i instanceof Kt?i.getTrackLabel():"remote_track",h=i.getMediaStreamTrack(!0);const A=document.createElement("video");A.style.width="1px",A.style.height="1px",A.setAttribute("muted",""),A.muted=!0,A.setAttribute("playsinline",""),A.controls=!1,(dn()||ao())&&(A.style.opacity="0.01",A.style.position="fixed",A.style.left="0",A.style.top="0",document.body.appendChild(A)),A.srcObject=new MediaStream([h]),A.play();const f=document.createElement("canvas");f.width=160,f.height=120;let m=h=0;try{const I=de();h=await function(E,_,S,N){let k,B=0,P=null;return new ce((J,se)=>{ai(()=>{k&&(k(),J(B))},_),k=Sh(()=>{e:{B>N&&k&&(k(),J(B));var ge=S.getContext("2d");if(ge){ge.drawImage(E,0,0,160,120),ge=ge.getImageData(0,0,S.width,S.height);var Le=Math.floor(ge.data.length/3);if(P){for(let Be=0;Be<Le;Be+=3)if(ge.data[Be]!==P[Be]){B+=1,P=ge.data;break e}}P=ge.data}else ge=new L(D.UNEXPECTED_ERROR,"can not get canvas 2d context."),R.error(ge.toString()),se(ge)}},30)})}(A,r,f,4),m=de()-I}catch(I){throw c.onError(I),I}return Bw===ze.SAFARI&&(A.pause(),A.remove()),A.srcObject=null,r=4<h,u={duration:m,changedPicNum:h,deviceLabel:u,result:r},R.info(b(s="[track-".concat(i.getTrackId(),"] check video track active completed. ")).call(s,fe(u))),c.onSuccess(u),r},setArea:function(i){const r=z.reportApiInvoke(null,{name:we.SET_AREA,options:i,tag:Re.TRACER});try{var s;let c=[];if(typeof i=="string"&&(c=[i]),Wi(i)&&(W(i).call(i,h=>{if(!gt(bE).call(bE,h))throw new L(D.INVALID_PARAMS,"invalid area code")}),c=i),Object.prototype.toString.call(i)==="[object Object]"){const{areaCode:h,excludedArea:A}=i;if(!h)throw new L(D.INVALID_PARAMS,"area code is needed");i=h,typeof h=="string"&&(i=[h]),c=A?tw(i,A):i}Ur("AREAS",c);const u=(h=>{const A={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return Ie(h).call(h,f=>{const m=wp[f];(f=dt(m))&&Ie(f).call(f,I=>{var E;I!=="CODE"&&(A[I]=b(E=A[I]).call(E,m[I]))})}),A})(c);Ie(s=dt(u)).call(s,h=>{h==="LOG_UPLOAD_SERVER"||h==="EVENT_REPORT_DOMAIN"||h==="EVENT_REPORT_BACKUP_DOMAIN"||h==="PROXY_SERVER_TYPE3"?Ur(h,u[h][0]):Ur(h,u[h])}),R.debug("set area success:",c.join(","))}catch(c){throw r.onError(c),c}r.onSuccess()},loadModule:async function(i,r){var s;if(R.debug(b(s="loadModule: ".concat(i.name,", loadOption: ")).call(s,fe(r))),!i.moduleInit)throw R.debug("Invalid Plugin"),new L(D.INVALID_PLUGIN,"invalid plugin");try{await i.moduleInit({logger:R,report:z},r)}catch(c){throw new L(D.UNEXPECTED_ERROR,"unexpected error in loadModule",c)}},processExternalMediaAEC:function(i){Lw.processExternalMediaAEC(i)}};return wn.on(Uo.CAMERA_DEVICE_CHANGED,i=>{R.info("camera device changed",fe(i)),kn.onCameraChanged&&kn.onCameraChanged(i)}),wn.on(Uo.RECORDING_DEVICE_CHANGED,i=>{R.info("microphone device changed",fe(i)),kn.onMicrophoneChanged&&kn.onMicrophoneChanged(i)}),wn.on(Uo.PLAYOUT_DEVICE_CHANGED,i=>{R.debug("playout device changed",fe(i)),kn.onPlaybackDeviceChanged&&kn.onPlaybackDeviceChanged(i)}),li.onAutoplayFailed=()=>{R.info("detect audio element autoplay failed"),kn.onAudioAutoplayFailed&&kn.onAudioAutoplayFailed()},ot.on("autoplay-failed",()=>{R.info("detect webaudio autoplay failed"),kn.onAudioAutoplayFailed&&kn.onAudioAutoplayFailed()}),e1.on("autoplay-failed",()=>{R.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),kn.onAutoplayFailed?kn.onAutoplayFailed():kn.onAudioAutoplayFailed?R.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):R.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`)}),window&&(window.__ARTC__=kn),kn})})(rS);var wg=nN(rS.exports);const J3=(n={token:null,channelName:null})=>{const e=_A(),t=n.token||e.token;return kN.request({url:"client/user/pub/getVideoToken",params:{uni_id_token:t,channelName:n.channelName,need_user_info:!0}})},z3={props:{id:{type:String,default:""}},setup(n){const e=n,t=ON();_A();let o=Tl({});const a=Tl({uid:1,name:"a",hasOpenVideo:ta(!1),hasOpenAudio:ta(!1),videoTrack:null,audioTrack:null,isShow:!0}),l=async K=>{K.isShow=!1,K.hasOpenVideo&&K.videoTrack&&(K.videoTrack.stop(),K.videoTrack.close(),K.uid===a.uid&&g.unpublish(a.videoTrack)),K.hasOpenAudio&&K.audioTrack&&(K.audioTrack.stop(),K.audioTrack.close(),K.uid===a.uid&&g.unpublish(a.audioTrack))},d=async K=>{const F=K.uid;if(F===a.uid){if(!a.audioTrack){await w();return}a.hasOpenAudio?(a.audioTrack.setEnabled(!1),a.hasOpenAudio=!1):(a.audioTrack.setEnabled(!0),a.hasOpenAudio=!0);return}o[F].hasAudio?o[F].hasOpenAudio?(o[F].audioTrack.stop(),o[F].hasOpenAudio=!1):(o[F].audioTrack.play(),o[F].hasOpenAudio=!0):o[F].hasOpenAudio=!1},p=async K=>{const F=K.uid;if(F===a.uid){if(!a.videoTrack){await y();return}a.hasOpenVideo?(a.videoTrack.setEnabled(!1),a.hasOpenVideo=!1):(a.videoTrack.setEnabled(!0),a.hasOpenVideo=!0);return}o[F].hasVideo&&(o[F].hasOpenVideo?(o[F].videoTrack.stop(),o[F].hasOpenVideo=!1):(o[F].videoTrack.play(`player-${F}`),o[F].hasOpenVideo=!0))};let g=null,v=Tl({audioTrack:null,videoTrack:null});fA(async()=>{g=wg.createClient({codec:"vp8",mode:"rtc"}),g.on("user-published",C),g.on("user-unpublished",M),g.on("user-left",x);const K=await J3({channelName:e.id}),{token:F,uid:re}=K.data;a.uid=await g.join(t.liveOptions.APPID,e.id,F,re),await y(),await w()}),PI(async()=>{await G()});async function C(K,F){const re=K.uid;o[re]||(o[re]=K),O(K,F)}async function y(){v.videoTrack=await wg.createCameraVideoTrack().catch(K=>{}),v.videoTrack&&(a.hasOpenVideo=!0,a.isShow=!0,v.videoTrack.play("player-"+a.uid),a.videoTrack=v.videoTrack,g.publish(v.videoTrack))}async function w(){v.audioTrack=await wg.createMicrophoneAudioTrack().catch(K=>{}),v.audioTrack&&(a.hasOpenAudio=!0,a.audioTrack=v.audioTrack,g.publish(v.audioTrack))}async function O(K,F){const re=K.uid;await g.subscribe(K,F),F==="video"&&(o[re].isShow=!0,await DI(),o[re].videoTrack.play(`player-${re}`),o[re].hasOpenVideo=!0),F==="audio"&&(o[re].audioTrack.play(),o[re].hasOpenAudio=!0)}async function M(K){const F=K.uid;o[F].hasVideo?o[F].hasAudio||(o[F].hasOpenAudio=!1):o[F].isShow=!1}async function x(K){const F=K.uid;o[F].isShow=!1,o[F].hasOpenVideo&&o[F].videoTrack&&o[F].videoTrack.stop(),o[F].hasOpenAudio&&o[F].audioTrack&&o[F].audioTrack.stop(),delete o[F];for(const re in o)if(Object.hasOwnProperty.call(o,re)){const Q=o[re];if(Q.hasVideo){O(Q,"video");break}}}async function G(){for(const K in v){let F=v[K];F&&(F.stop(),F.close(),v[K]=void 0)}o={},await g.leave()}return(K,F)=>(vr(),bn(Ko,null,[(vr(!0),bn(Ko,null,mA(Bi(o),(re,Q,Ae)=>(vr(),bn(Ko,{key:re.uid},[re.isShow?(vr(),dc(tS,{key:0,"live-user":re,onVideo:oe=>p(re),onAudio:oe=>d(re),onClose:oe=>l(re),name:re.uid+"","class-name":"w-80 h-60 "+(Ae==0?"bottom-[calc(100vh-19rem)]":"bottom-[calc(100vh-34.6rem)]")},null,8,["live-user","onVideo","onAudio","onClose","name","class-name"])):vA("",!0)],64))),128)),Bi(a).isShow?(vr(),dc(tS,{key:0,"live-user":Bi(a),onVideo:F[0]||(F[0]=re=>p(Bi(a))),onAudio:F[1]||(F[1]=re=>d(Bi(a))),onClose:F[2]||(F[2]=re=>l(Bi(a)))},null,8,["live-user"])):vA("",!0)],64))}},X3={class:"pt-16 w-screen h-screen overflow-hidden"},nQ={props:{id:{type:String,default:""}},setup(n){return(e,t)=>(vr(),bn(Ko,null,[Dn(x3),Qt("div",X3,[Dn(v3,{class:"h-full"})]),(vr(),dc(iN,null,{default:hc(()=>[Dn(z3,{id:n.id},null,8,["id"])]),_:1}))],64))}};export{nQ as default};
