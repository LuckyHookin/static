var fG=Object.defineProperty,gG=Object.defineProperties;var mG=Object.getOwnPropertyDescriptors;var KA=Object.getOwnPropertySymbols;var LN=Object.prototype.hasOwnProperty,PN=Object.prototype.propertyIsEnumerable;var DN=(o,n,a)=>n in o?fG(o,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[n]=a,Nt=(o,n)=>{for(var a in n||(n={}))LN.call(n,a)&&DN(o,a,n[a]);if(KA)for(var a of KA(n))PN.call(n,a)&&DN(o,a,n[a]);return o},zn=(o,n)=>gG(o,mG(n));var BN=(o,n)=>{var a={};for(var c in o)LN.call(o,c)&&n.indexOf(c)<0&&(a[c]=o[c]);if(o!=null&&KA)for(var c of KA(o))n.indexOf(c)<0&&PN.call(o,c)&&(a[c]=o[c]);return a};import{l as _h,v as Wc,a6 as LI,a9 as PI,aa as Qc,t as Yu,ab as EG,ac as _G,ad as IG,ae as o2,a as ds,af as vG,ag as CG,r as oh,o as vn,c as ki,i as Oi,B as ad,F as Ea,y as BI,g as ud,ah as SG,f as br,z as s2,A as qu,b as sI,h as cd,ai as TG,aj as RG,ak as yG,p as a2,e as c2,a7 as wG,a8 as l2,al as bG,O as NG,am as OG,an as kG,a5 as D_,ao as DG,ap as LG}from"./vendor.ce17cf77.js";import{c as PG,i as BG,d as MG,s as UG,e as MN,t as d2,S as u2,f as xG,Y as ga,m as FG,g as Ja,k as QG,h as VG,j as GG,l as Ju,o as jG,I as h2,C as HG,n as KG,p as WG,b as L_,R as aI,q as cI,u as YG,r as qG,a as JG,v as zG,w as XG,x as ZG,y as zu,z as UN,A as xN,U as $G,B as tj,E as ej,D as rj,W as nj}from"./y-websocket.2d693161.js";import{_ as Ih,S as Vc,a as MI,h as ij,u as oj}from"./index.b1c851d8.js";const sj=o=>class{constructor(a){this._=a}destroy(){o(this._)}},aj=sj(clearTimeout),cj=(o,n)=>new aj(setTimeout(n,o));function Ei(o){this.content=o}Ei.prototype={constructor:Ei,find:function(o){for(var n=0;n<this.content.length;n+=2)if(this.content[n]===o)return n;return-1},get:function(o){var n=this.find(o);return n==-1?void 0:this.content[n+1]},update:function(o,n,a){var c=a&&a!=o?this.remove(a):this,u=c.find(o),A=c.content.slice();return u==-1?A.push(a||o,n):(A[u+1]=n,a&&(A[u]=a)),new Ei(A)},remove:function(o){var n=this.find(o);if(n==-1)return this;var a=this.content.slice();return a.splice(n,2),new Ei(a)},addToStart:function(o,n){return new Ei([o,n].concat(this.remove(o).content))},addToEnd:function(o,n){var a=this.remove(o).content.slice();return a.push(o,n),new Ei(a)},addBefore:function(o,n,a){var c=this.remove(n),u=c.content.slice(),A=c.find(o);return u.splice(A==-1?u.length:A,0,n,a),new Ei(u)},forEach:function(o){for(var n=0;n<this.content.length;n+=2)o(this.content[n],this.content[n+1])},prepend:function(o){return o=Ei.from(o),o.size?new Ei(o.content.concat(this.subtract(o).content)):this},append:function(o){return o=Ei.from(o),o.size?new Ei(this.subtract(o).content.concat(o.content)):this},subtract:function(o){var n=this;o=Ei.from(o);for(var a=0;a<o.content.length;a+=2)n=n.remove(o.content[a]);return n},get size(){return this.content.length>>1}};Ei.from=function(o){if(o instanceof Ei)return o;var n=[];if(o)for(var a in o)n.push(a,o[a]);return new Ei(n)};var FN=Ei;function p2(o,n,a){for(var c=0;;c++){if(c==o.childCount||c==n.childCount)return o.childCount==n.childCount?null:a;var u=o.child(c),A=n.child(c);if(u==A){a+=u.nodeSize;continue}if(!u.sameMarkup(A))return a;if(u.isText&&u.text!=A.text){for(var g=0;u.text[g]==A.text[g];g++)a++;return a}if(u.content.size||A.content.size){var E=p2(u.content,A.content,a+1);if(E!=null)return E}a+=u.nodeSize}}function A2(o,n,a,c){for(var u=o.childCount,A=n.childCount;;){if(u==0||A==0)return u==A?null:{a,b:c};var g=o.child(--u),E=n.child(--A),I=g.nodeSize;if(g==E){a-=I,c-=I;continue}if(!g.sameMarkup(E))return{a,b:c};if(g.isText&&g.text!=E.text){for(var C=0,b=Math.min(g.text.length,E.text.length);C<b&&g.text[g.text.length-C-1]==E.text[E.text.length-C-1];)C++,a--,c--;return{a,b:c}}if(g.content.size||E.content.size){var N=A2(g.content,E.content,a-1,c-1);if(N)return N}a-=I,c-=I}}var bt=function(n,a){if(this.content=n,this.size=a||0,a==null)for(var c=0;c<n.length;c++)this.size+=n[c].nodeSize},vf={firstChild:{configurable:!0},lastChild:{configurable:!0},childCount:{configurable:!0}};bt.prototype.nodesBetween=function(n,a,c,u,A){u===void 0&&(u=0);for(var g=0,E=0;E<a;g++){var I=this.content[g],C=E+I.nodeSize;if(C>n&&c(I,u+E,A,g)!==!1&&I.content.size){var b=E+1;I.nodesBetween(Math.max(0,n-b),Math.min(I.content.size,a-b),c,u+b)}E=C}};bt.prototype.descendants=function(n){this.nodesBetween(0,this.size,n)};bt.prototype.textBetween=function(n,a,c,u){var A="",g=!0;return this.nodesBetween(n,a,function(E,I){E.isText?(A+=E.text.slice(Math.max(n,I)-I,a-I),g=!c):E.isLeaf&&u?(A+=typeof u=="function"?u(E):u,g=!c):!g&&E.isBlock&&(A+=c,g=!0)},0),A};bt.prototype.append=function(n){if(!n.size)return this;if(!this.size)return n;var a=this.lastChild,c=n.firstChild,u=this.content.slice(),A=0;for(a.isText&&a.sameMarkup(c)&&(u[u.length-1]=a.withText(a.text+c.text),A=1);A<n.content.length;A++)u.push(n.content[A]);return new bt(u,this.size+n.size)};bt.prototype.cut=function(n,a){if(a==null&&(a=this.size),n==0&&a==this.size)return this;var c=[],u=0;if(a>n)for(var A=0,g=0;g<a;A++){var E=this.content[A],I=g+E.nodeSize;I>n&&((g<n||I>a)&&(E.isText?E=E.cut(Math.max(0,n-g),Math.min(E.text.length,a-g)):E=E.cut(Math.max(0,n-g-1),Math.min(E.content.size,a-g-1))),c.push(E),u+=E.nodeSize),g=I}return new bt(c,u)};bt.prototype.cutByIndex=function(n,a){return n==a?bt.empty:n==0&&a==this.content.length?this:new bt(this.content.slice(n,a))};bt.prototype.replaceChild=function(n,a){var c=this.content[n];if(c==a)return this;var u=this.content.slice(),A=this.size+a.nodeSize-c.nodeSize;return u[n]=a,new bt(u,A)};bt.prototype.addToStart=function(n){return new bt([n].concat(this.content),this.size+n.nodeSize)};bt.prototype.addToEnd=function(n){return new bt(this.content.concat(n),this.size+n.nodeSize)};bt.prototype.eq=function(n){if(this.content.length!=n.content.length)return!1;for(var a=0;a<this.content.length;a++)if(!this.content[a].eq(n.content[a]))return!1;return!0};vf.firstChild.get=function(){return this.content.length?this.content[0]:null};vf.lastChild.get=function(){return this.content.length?this.content[this.content.length-1]:null};vf.childCount.get=function(){return this.content.length};bt.prototype.child=function(n){var a=this.content[n];if(!a)throw new RangeError("Index "+n+" out of range for "+this);return a};bt.prototype.maybeChild=function(n){return this.content[n]};bt.prototype.forEach=function(n){for(var a=0,c=0;a<this.content.length;a++){var u=this.content[a];n(u,c,a),c+=u.nodeSize}};bt.prototype.findDiffStart=function(n,a){return a===void 0&&(a=0),p2(this,n,a)};bt.prototype.findDiffEnd=function(n,a,c){return a===void 0&&(a=this.size),c===void 0&&(c=n.size),A2(this,n,a,c)};bt.prototype.findIndex=function(n,a){if(a===void 0&&(a=-1),n==0)return WA(0,n);if(n==this.size)return WA(this.content.length,n);if(n>this.size||n<0)throw new RangeError("Position "+n+" outside of fragment ("+this+")");for(var c=0,u=0;;c++){var A=this.child(c),g=u+A.nodeSize;if(g>=n)return g==n||a>0?WA(c+1,g):WA(c,u);u=g}};bt.prototype.toString=function(){return"<"+this.toStringInner()+">"};bt.prototype.toStringInner=function(){return this.content.join(", ")};bt.prototype.toJSON=function(){return this.content.length?this.content.map(function(n){return n.toJSON()}):null};bt.fromJSON=function(n,a){if(!a)return bt.empty;if(!Array.isArray(a))throw new RangeError("Invalid input for Fragment.fromJSON");return new bt(a.map(n.nodeFromJSON))};bt.fromArray=function(n){if(!n.length)return bt.empty;for(var a,c=0,u=0;u<n.length;u++){var A=n[u];c+=A.nodeSize,u&&A.isText&&n[u-1].sameMarkup(A)?(a||(a=n.slice(0,u)),a[a.length-1]=A.withText(a[a.length-1].text+A.text)):a&&a.push(A)}return new bt(a||n,c)};bt.from=function(n){if(!n)return bt.empty;if(n instanceof bt)return n;if(Array.isArray(n))return this.fromArray(n);if(n.attrs)return new bt([n],n.nodeSize);throw new RangeError("Can not convert "+n+" to a Fragment"+(n.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))};Object.defineProperties(bt.prototype,vf);var P_={index:0,offset:0};function WA(o,n){return P_.index=o,P_.offset=n,P_}bt.empty=new bt([],0);function rf(o,n){if(o===n)return!0;if(!(o&&typeof o=="object")||!(n&&typeof n=="object"))return!1;var a=Array.isArray(o);if(Array.isArray(n)!=a)return!1;if(a){if(o.length!=n.length)return!1;for(var c=0;c<o.length;c++)if(!rf(o[c],n[c]))return!1}else{for(var u in o)if(!(u in n)||!rf(o[u],n[u]))return!1;for(var A in n)if(!(A in o))return!1}return!0}var ir=function(n,a){this.type=n,this.attrs=a};ir.prototype.addToSet=function(n){for(var a,c=!1,u=0;u<n.length;u++){var A=n[u];if(this.eq(A))return n;if(this.type.excludes(A.type))a||(a=n.slice(0,u));else{if(A.type.excludes(this.type))return n;!c&&A.type.rank>this.type.rank&&(a||(a=n.slice(0,u)),a.push(this),c=!0),a&&a.push(A)}}return a||(a=n.slice()),c||a.push(this),a};ir.prototype.removeFromSet=function(n){for(var a=0;a<n.length;a++)if(this.eq(n[a]))return n.slice(0,a).concat(n.slice(a+1));return n};ir.prototype.isInSet=function(n){for(var a=0;a<n.length;a++)if(this.eq(n[a]))return!0;return!1};ir.prototype.eq=function(n){return this==n||this.type==n.type&&rf(this.attrs,n.attrs)};ir.prototype.toJSON=function(){var n={type:this.type.name};for(var a in this.attrs){n.attrs=this.attrs;break}return n};ir.fromJSON=function(n,a){if(!a)throw new RangeError("Invalid input for Mark.fromJSON");var c=n.marks[a.type];if(!c)throw new RangeError("There is no mark type "+a.type+" in this schema");return c.create(a.attrs)};ir.sameSet=function(n,a){if(n==a)return!0;if(n.length!=a.length)return!1;for(var c=0;c<n.length;c++)if(!n[c].eq(a[c]))return!1;return!0};ir.setFrom=function(n){if(!n||n.length==0)return ir.none;if(n instanceof ir)return[n];var a=n.slice();return a.sort(function(c,u){return c.type.rank-u.type.rank}),a};ir.none=[];function xs(o){var n=Error.call(this,o);return n.__proto__=xs.prototype,n}xs.prototype=Object.create(Error.prototype);xs.prototype.constructor=xs;xs.prototype.name="ReplaceError";var Kt=function(n,a,c){this.content=n,this.openStart=a,this.openEnd=c},f2={size:{configurable:!0}};f2.size.get=function(){return this.content.size-this.openStart-this.openEnd};Kt.prototype.insertAt=function(n,a){var c=m2(this.content,n+this.openStart,a,null);return c&&new Kt(c,this.openStart,this.openEnd)};Kt.prototype.removeBetween=function(n,a){return new Kt(g2(this.content,n+this.openStart,a+this.openStart),this.openStart,this.openEnd)};Kt.prototype.eq=function(n){return this.content.eq(n.content)&&this.openStart==n.openStart&&this.openEnd==n.openEnd};Kt.prototype.toString=function(){return this.content+"("+this.openStart+","+this.openEnd+")"};Kt.prototype.toJSON=function(){if(!this.content.size)return null;var n={content:this.content.toJSON()};return this.openStart>0&&(n.openStart=this.openStart),this.openEnd>0&&(n.openEnd=this.openEnd),n};Kt.fromJSON=function(n,a){if(!a)return Kt.empty;var c=a.openStart||0,u=a.openEnd||0;if(typeof c!="number"||typeof u!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new Kt(bt.fromJSON(n,a.content),c,u)};Kt.maxOpen=function(n,a){a===void 0&&(a=!0);for(var c=0,u=0,A=n.firstChild;A&&!A.isLeaf&&(a||!A.type.spec.isolating);A=A.firstChild)c++;for(var g=n.lastChild;g&&!g.isLeaf&&(a||!g.type.spec.isolating);g=g.lastChild)u++;return new Kt(n,c,u)};Object.defineProperties(Kt.prototype,f2);function g2(o,n,a){var c=o.findIndex(n),u=c.index,A=c.offset,g=o.maybeChild(u),E=o.findIndex(a),I=E.index,C=E.offset;if(A==n||g.isText){if(C!=a&&!o.child(I).isText)throw new RangeError("Removing non-flat range");return o.cut(0,n).append(o.cut(a))}if(u!=I)throw new RangeError("Removing non-flat range");return o.replaceChild(u,g.copy(g2(g.content,n-A-1,a-A-1)))}function m2(o,n,a,c){var u=o.findIndex(n),A=u.index,g=u.offset,E=o.maybeChild(A);if(g==n||E.isText)return c&&!c.canReplace(A,A,a)?null:o.cut(0,n).append(a).append(o.cut(n));var I=m2(E.content,n-g-1,a);return I&&o.replaceChild(A,E.copy(I))}Kt.empty=new Kt(bt.empty,0,0);function lj(o,n,a){if(a.openStart>o.depth)throw new xs("Inserted content deeper than insertion position");if(o.depth-a.openStart!=n.depth-a.openEnd)throw new xs("Inconsistent open depths");return E2(o,n,a,0)}function E2(o,n,a,c){var u=o.index(c),A=o.node(c);if(u==n.index(c)&&c<o.depth-a.openStart){var g=E2(o,n,a,c+1);return A.copy(A.content.replaceChild(u,g))}else if(a.content.size)if(!a.openStart&&!a.openEnd&&o.depth==c&&n.depth==c){var E=o.parent,I=E.content;return jc(E,I.cut(0,o.parentOffset).append(a.content).append(I.cut(n.parentOffset)))}else{var C=dj(a,o),b=C.start,N=C.end;return jc(A,I2(o,b,N,n,c))}else return jc(A,nf(o,n,c))}function _2(o,n){if(!n.type.compatibleContent(o.type))throw new xs("Cannot join "+n.type.name+" onto "+o.type.name)}function lI(o,n,a){var c=o.node(a);return _2(c,n.node(a)),c}function Gc(o,n){var a=n.length-1;a>=0&&o.isText&&o.sameMarkup(n[a])?n[a]=o.withText(n[a].text+o.text):n.push(o)}function Xu(o,n,a,c){var u=(n||o).node(a),A=0,g=n?n.index(a):u.childCount;o&&(A=o.index(a),o.depth>a?A++:o.textOffset&&(Gc(o.nodeAfter,c),A++));for(var E=A;E<g;E++)Gc(u.child(E),c);n&&n.depth==a&&n.textOffset&&Gc(n.nodeBefore,c)}function jc(o,n){if(!o.type.validContent(n))throw new xs("Invalid content for node "+o.type.name);return o.copy(n)}function I2(o,n,a,c,u){var A=o.depth>u&&lI(o,n,u+1),g=c.depth>u&&lI(a,c,u+1),E=[];return Xu(null,o,u,E),A&&g&&n.index(u)==a.index(u)?(_2(A,g),Gc(jc(A,I2(o,n,a,c,u+1)),E)):(A&&Gc(jc(A,nf(o,n,u+1)),E),Xu(n,a,u,E),g&&Gc(jc(g,nf(a,c,u+1)),E)),Xu(c,null,u,E),new bt(E)}function nf(o,n,a){var c=[];if(Xu(null,o,a,c),o.depth>a){var u=lI(o,n,a+1);Gc(jc(u,nf(o,n,a+1)),c)}return Xu(n,null,a,c),new bt(c)}function dj(o,n){for(var a=n.depth-o.openStart,c=n.node(a),u=c.copy(o.content),A=a-1;A>=0;A--)u=n.node(A).copy(bt.from(u));return{start:u.resolveNoCache(o.openStart+a),end:u.resolveNoCache(u.content.size-o.openEnd-a)}}var cn=function(n,a,c){this.pos=n,this.path=a,this.depth=a.length/3-1,this.parentOffset=c},vd={parent:{configurable:!0},doc:{configurable:!0},textOffset:{configurable:!0},nodeAfter:{configurable:!0},nodeBefore:{configurable:!0}};cn.prototype.resolveDepth=function(n){return n==null?this.depth:n<0?this.depth+n:n};vd.parent.get=function(){return this.node(this.depth)};vd.doc.get=function(){return this.node(0)};cn.prototype.node=function(n){return this.path[this.resolveDepth(n)*3]};cn.prototype.index=function(n){return this.path[this.resolveDepth(n)*3+1]};cn.prototype.indexAfter=function(n){return n=this.resolveDepth(n),this.index(n)+(n==this.depth&&!this.textOffset?0:1)};cn.prototype.start=function(n){return n=this.resolveDepth(n),n==0?0:this.path[n*3-1]+1};cn.prototype.end=function(n){return n=this.resolveDepth(n),this.start(n)+this.node(n).content.size};cn.prototype.before=function(n){if(n=this.resolveDepth(n),!n)throw new RangeError("There is no position before the top-level node");return n==this.depth+1?this.pos:this.path[n*3-1]};cn.prototype.after=function(n){if(n=this.resolveDepth(n),!n)throw new RangeError("There is no position after the top-level node");return n==this.depth+1?this.pos:this.path[n*3-1]+this.path[n*3].nodeSize};vd.textOffset.get=function(){return this.pos-this.path[this.path.length-1]};vd.nodeAfter.get=function(){var o=this.parent,n=this.index(this.depth);if(n==o.childCount)return null;var a=this.pos-this.path[this.path.length-1],c=o.child(n);return a?o.child(n).cut(a):c};vd.nodeBefore.get=function(){var o=this.index(this.depth),n=this.pos-this.path[this.path.length-1];return n?this.parent.child(o).cut(0,n):o==0?null:this.parent.child(o-1)};cn.prototype.posAtIndex=function(n,a){a=this.resolveDepth(a);for(var c=this.path[a*3],u=a==0?0:this.path[a*3-1]+1,A=0;A<n;A++)u+=c.child(A).nodeSize;return u};cn.prototype.marks=function(){var n=this.parent,a=this.index();if(n.content.size==0)return ir.none;if(this.textOffset)return n.child(a).marks;var c=n.maybeChild(a-1),u=n.maybeChild(a);if(!c){var A=c;c=u,u=A}for(var g=c.marks,E=0;E<g.length;E++)g[E].type.spec.inclusive===!1&&(!u||!g[E].isInSet(u.marks))&&(g=g[E--].removeFromSet(g));return g};cn.prototype.marksAcross=function(n){var a=this.parent.maybeChild(this.index());if(!a||!a.isInline)return null;for(var c=a.marks,u=n.parent.maybeChild(n.index()),A=0;A<c.length;A++)c[A].type.spec.inclusive===!1&&(!u||!c[A].isInSet(u.marks))&&(c=c[A--].removeFromSet(c));return c};cn.prototype.sharedDepth=function(n){for(var a=this.depth;a>0;a--)if(this.start(a)<=n&&this.end(a)>=n)return a;return 0};cn.prototype.blockRange=function(n,a){if(n===void 0&&(n=this),n.pos<this.pos)return n.blockRange(this);for(var c=this.depth-(this.parent.inlineContent||this.pos==n.pos?1:0);c>=0;c--)if(n.pos<=this.end(c)&&(!a||a(this.node(c))))return new sh(this,n,c)};cn.prototype.sameParent=function(n){return this.pos-this.parentOffset==n.pos-n.parentOffset};cn.prototype.max=function(n){return n.pos>this.pos?n:this};cn.prototype.min=function(n){return n.pos<this.pos?n:this};cn.prototype.toString=function(){for(var n="",a=1;a<=this.depth;a++)n+=(n?"/":"")+this.node(a).type.name+"_"+this.index(a-1);return n+":"+this.parentOffset};cn.resolve=function(n,a){if(!(a>=0&&a<=n.content.size))throw new RangeError("Position "+a+" out of range");for(var c=[],u=0,A=a,g=n;;){var E=g.content.findIndex(A),I=E.index,C=E.offset,b=A-C;if(c.push(g,I,u+C),!b||(g=g.child(I),g.isText))break;A=b-1,u+=C+1}return new cn(a,c,A)};cn.resolveCached=function(n,a){for(var c=0;c<B_.length;c++){var u=B_[c];if(u.pos==a&&u.doc==n)return u}var A=B_[M_]=cn.resolve(n,a);return M_=(M_+1)%uj,A};Object.defineProperties(cn.prototype,vd);var B_=[],M_=0,uj=12,sh=function(n,a,c){this.$from=n,this.$to=a,this.depth=c},Cd={start:{configurable:!0},end:{configurable:!0},parent:{configurable:!0},startIndex:{configurable:!0},endIndex:{configurable:!0}};Cd.start.get=function(){return this.$from.before(this.depth+1)};Cd.end.get=function(){return this.$to.after(this.depth+1)};Cd.parent.get=function(){return this.$from.node(this.depth)};Cd.startIndex.get=function(){return this.$from.index(this.depth)};Cd.endIndex.get=function(){return this.$to.indexAfter(this.depth)};Object.defineProperties(sh.prototype,Cd);var hj=Object.create(null),sr=function(n,a,c,u){this.type=n,this.attrs=a,this.content=c||bt.empty,this.marks=u||ir.none},Co={nodeSize:{configurable:!0},childCount:{configurable:!0},textContent:{configurable:!0},firstChild:{configurable:!0},lastChild:{configurable:!0},isBlock:{configurable:!0},isTextblock:{configurable:!0},inlineContent:{configurable:!0},isInline:{configurable:!0},isText:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};Co.nodeSize.get=function(){return this.isLeaf?1:2+this.content.size};Co.childCount.get=function(){return this.content.childCount};sr.prototype.child=function(n){return this.content.child(n)};sr.prototype.maybeChild=function(n){return this.content.maybeChild(n)};sr.prototype.forEach=function(n){this.content.forEach(n)};sr.prototype.nodesBetween=function(n,a,c,u){u===void 0&&(u=0),this.content.nodesBetween(n,a,c,u,this)};sr.prototype.descendants=function(n){this.nodesBetween(0,this.content.size,n)};Co.textContent.get=function(){return this.textBetween(0,this.content.size,"")};sr.prototype.textBetween=function(n,a,c,u){return this.content.textBetween(n,a,c,u)};Co.firstChild.get=function(){return this.content.firstChild};Co.lastChild.get=function(){return this.content.lastChild};sr.prototype.eq=function(n){return this==n||this.sameMarkup(n)&&this.content.eq(n.content)};sr.prototype.sameMarkup=function(n){return this.hasMarkup(n.type,n.attrs,n.marks)};sr.prototype.hasMarkup=function(n,a,c){return this.type==n&&rf(this.attrs,a||n.defaultAttrs||hj)&&ir.sameSet(this.marks,c||ir.none)};sr.prototype.copy=function(n){return n===void 0&&(n=null),n==this.content?this:new this.constructor(this.type,this.attrs,n,this.marks)};sr.prototype.mark=function(n){return n==this.marks?this:new this.constructor(this.type,this.attrs,this.content,n)};sr.prototype.cut=function(n,a){return n==0&&a==this.content.size?this:this.copy(this.content.cut(n,a))};sr.prototype.slice=function(n,a,c){if(a===void 0&&(a=this.content.size),c===void 0&&(c=!1),n==a)return Kt.empty;var u=this.resolve(n),A=this.resolve(a),g=c?0:u.sharedDepth(a),E=u.start(g),I=u.node(g),C=I.content.cut(u.pos-E,A.pos-E);return new Kt(C,u.depth-g,A.depth-g)};sr.prototype.replace=function(n,a,c){return lj(this.resolve(n),this.resolve(a),c)};sr.prototype.nodeAt=function(n){for(var a=this;;){var c=a.content.findIndex(n),u=c.index,A=c.offset;if(a=a.maybeChild(u),!a)return null;if(A==n||a.isText)return a;n-=A+1}};sr.prototype.childAfter=function(n){var a=this.content.findIndex(n),c=a.index,u=a.offset;return{node:this.content.maybeChild(c),index:c,offset:u}};sr.prototype.childBefore=function(n){if(n==0)return{node:null,index:0,offset:0};var a=this.content.findIndex(n),c=a.index,u=a.offset;if(u<n)return{node:this.content.child(c),index:c,offset:u};var A=this.content.child(c-1);return{node:A,index:c-1,offset:u-A.nodeSize}};sr.prototype.resolve=function(n){return cn.resolveCached(this,n)};sr.prototype.resolveNoCache=function(n){return cn.resolve(this,n)};sr.prototype.rangeHasMark=function(n,a,c){var u=!1;return a>n&&this.nodesBetween(n,a,function(A){return c.isInSet(A.marks)&&(u=!0),!u}),u};Co.isBlock.get=function(){return this.type.isBlock};Co.isTextblock.get=function(){return this.type.isTextblock};Co.inlineContent.get=function(){return this.type.inlineContent};Co.isInline.get=function(){return this.type.isInline};Co.isText.get=function(){return this.type.isText};Co.isLeaf.get=function(){return this.type.isLeaf};Co.isAtom.get=function(){return this.type.isAtom};sr.prototype.toString=function(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);var n=this.type.name;return this.content.size&&(n+="("+this.content.toStringInner()+")"),v2(this.marks,n)};sr.prototype.contentMatchAt=function(n){var a=this.type.contentMatch.matchFragment(this.content,0,n);if(!a)throw new Error("Called contentMatchAt on a node with invalid content");return a};sr.prototype.canReplace=function(n,a,c,u,A){c===void 0&&(c=bt.empty),u===void 0&&(u=0),A===void 0&&(A=c.childCount);var g=this.contentMatchAt(n).matchFragment(c,u,A),E=g&&g.matchFragment(this.content,a);if(!E||!E.validEnd)return!1;for(var I=u;I<A;I++)if(!this.type.allowsMarks(c.child(I).marks))return!1;return!0};sr.prototype.canReplaceWith=function(n,a,c,u){if(u&&!this.type.allowsMarks(u))return!1;var A=this.contentMatchAt(n).matchType(c),g=A&&A.matchFragment(this.content,a);return g?g.validEnd:!1};sr.prototype.canAppend=function(n){return n.content.size?this.canReplace(this.childCount,this.childCount,n.content):this.type.compatibleContent(n.type)};sr.prototype.check=function(){if(!this.type.validContent(this.content))throw new RangeError("Invalid content for node "+this.type.name+": "+this.content.toString().slice(0,50));for(var n=ir.none,a=0;a<this.marks.length;a++)n=this.marks[a].addToSet(n);if(!ir.sameSet(n,this.marks))throw new RangeError("Invalid collection of marks for node "+this.type.name+": "+this.marks.map(function(c){return c.type.name}));this.content.forEach(function(c){return c.check()})};sr.prototype.toJSON=function(){var n={type:this.type.name};for(var a in this.attrs){n.attrs=this.attrs;break}return this.content.size&&(n.content=this.content.toJSON()),this.marks.length&&(n.marks=this.marks.map(function(c){return c.toJSON()})),n};sr.fromJSON=function(n,a){if(!a)throw new RangeError("Invalid input for Node.fromJSON");var c=null;if(a.marks){if(!Array.isArray(a.marks))throw new RangeError("Invalid mark data for Node.fromJSON");c=a.marks.map(n.markFromJSON)}if(a.type=="text"){if(typeof a.text!="string")throw new RangeError("Invalid text node in JSON");return n.text(a.text,c)}var u=bt.fromJSON(n,a.content);return n.nodeType(a.type).create(a.attrs,u,c)};Object.defineProperties(sr.prototype,Co);var pj=function(o){function n(c,u,A,g){if(o.call(this,c,u,null,g),!A)throw new RangeError("Empty text nodes are not allowed");this.text=A}o&&(n.__proto__=o),n.prototype=Object.create(o&&o.prototype),n.prototype.constructor=n;var a={textContent:{configurable:!0},nodeSize:{configurable:!0}};return n.prototype.toString=function(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):v2(this.marks,JSON.stringify(this.text))},a.textContent.get=function(){return this.text},n.prototype.textBetween=function(u,A){return this.text.slice(u,A)},a.nodeSize.get=function(){return this.text.length},n.prototype.mark=function(u){return u==this.marks?this:new n(this.type,this.attrs,this.text,u)},n.prototype.withText=function(u){return u==this.text?this:new n(this.type,this.attrs,u,this.marks)},n.prototype.cut=function(u,A){return u===void 0&&(u=0),A===void 0&&(A=this.text.length),u==0&&A==this.text.length?this:this.withText(this.text.slice(u,A))},n.prototype.eq=function(u){return this.sameMarkup(u)&&this.text==u.text},n.prototype.toJSON=function(){var u=o.prototype.toJSON.call(this);return u.text=this.text,u},Object.defineProperties(n.prototype,a),n}(sr);function v2(o,n){for(var a=o.length-1;a>=0;a--)n=o[a].type.name+"("+n+")";return n}var _i=function(n){this.validEnd=n,this.next=[],this.wrapCache=[]},Cf={inlineContent:{configurable:!0},defaultType:{configurable:!0},edgeCount:{configurable:!0}};_i.parse=function(n,a){var c=new Sf(n,a);if(c.next==null)return _i.empty;var u=S2(c);c.next&&c.err("Unexpected trailing text");var A=Ij(_j(u));return vj(A,c),A};_i.prototype.matchType=function(n){for(var a=0;a<this.next.length;a+=2)if(this.next[a]==n)return this.next[a+1];return null};_i.prototype.matchFragment=function(n,a,c){a===void 0&&(a=0),c===void 0&&(c=n.childCount);for(var u=this,A=a;u&&A<c;A++)u=u.matchType(n.child(A).type);return u};Cf.inlineContent.get=function(){var o=this.next[0];return o?o.isInline:!1};Cf.defaultType.get=function(){for(var o=0;o<this.next.length;o+=2){var n=this.next[o];if(!(n.isText||n.hasRequiredAttrs()))return n}};_i.prototype.compatible=function(n){for(var a=0;a<this.next.length;a+=2)for(var c=0;c<n.next.length;c+=2)if(this.next[a]==n.next[c])return!0;return!1};_i.prototype.fillBefore=function(n,a,c){a===void 0&&(a=!1),c===void 0&&(c=0);var u=[this];function A(g,E){var I=g.matchFragment(n,c);if(I&&(!a||I.validEnd))return bt.from(E.map(function(Q){return Q.createAndFill()}));for(var C=0;C<g.next.length;C+=2){var b=g.next[C],N=g.next[C+1];if(!(b.isText||b.hasRequiredAttrs())&&u.indexOf(N)==-1){u.push(N);var L=A(N,E.concat(b));if(L)return L}}}return A(this,[])};_i.prototype.findWrapping=function(n){for(var a=0;a<this.wrapCache.length;a+=2)if(this.wrapCache[a]==n)return this.wrapCache[a+1];var c=this.computeWrapping(n);return this.wrapCache.push(n,c),c};_i.prototype.computeWrapping=function(n){for(var a=Object.create(null),c=[{match:this,type:null,via:null}];c.length;){var u=c.shift(),A=u.match;if(A.matchType(n)){for(var g=[],E=u;E.type;E=E.via)g.push(E.type);return g.reverse()}for(var I=0;I<A.next.length;I+=2){var C=A.next[I];!C.isLeaf&&!C.hasRequiredAttrs()&&!(C.name in a)&&(!u.type||A.next[I+1].validEnd)&&(c.push({match:C.contentMatch,type:C,via:u}),a[C.name]=!0)}}};Cf.edgeCount.get=function(){return this.next.length>>1};_i.prototype.edge=function(n){var a=n<<1;if(a>=this.next.length)throw new RangeError("There's no "+n+"th edge in this content match");return{type:this.next[a],next:this.next[a+1]}};_i.prototype.toString=function(){var n=[];function a(c){n.push(c);for(var u=1;u<c.next.length;u+=2)n.indexOf(c.next[u])==-1&&a(c.next[u])}return a(this),n.map(function(c,u){for(var A=u+(c.validEnd?"*":" ")+" ",g=0;g<c.next.length;g+=2)A+=(g?", ":"")+c.next[g].name+"->"+n.indexOf(c.next[g+1]);return A}).join(`
`)};Object.defineProperties(_i.prototype,Cf);_i.empty=new _i(!0);var Sf=function(n,a){this.string=n,this.nodeTypes=a,this.inline=null,this.pos=0,this.tokens=n.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()},C2={next:{configurable:!0}};C2.next.get=function(){return this.tokens[this.pos]};Sf.prototype.eat=function(n){return this.next==n&&(this.pos++||!0)};Sf.prototype.err=function(n){throw new SyntaxError(n+" (in content expression '"+this.string+"')")};Object.defineProperties(Sf.prototype,C2);function S2(o){var n=[];do n.push(Aj(o));while(o.eat("|"));return n.length==1?n[0]:{type:"choice",exprs:n}}function Aj(o){var n=[];do n.push(fj(o));while(o.next&&o.next!=")"&&o.next!="|");return n.length==1?n[0]:{type:"seq",exprs:n}}function fj(o){for(var n=Ej(o);;)if(o.eat("+"))n={type:"plus",expr:n};else if(o.eat("*"))n={type:"star",expr:n};else if(o.eat("?"))n={type:"opt",expr:n};else if(o.eat("{"))n=gj(o,n);else break;return n}function QN(o){/\D/.test(o.next)&&o.err("Expected number, got '"+o.next+"'");var n=Number(o.next);return o.pos++,n}function gj(o,n){var a=QN(o),c=a;return o.eat(",")&&(o.next!="}"?c=QN(o):c=-1),o.eat("}")||o.err("Unclosed braced range"),{type:"range",min:a,max:c,expr:n}}function mj(o,n){var a=o.nodeTypes,c=a[n];if(c)return[c];var u=[];for(var A in a){var g=a[A];g.groups.indexOf(n)>-1&&u.push(g)}return u.length==0&&o.err("No node type or group '"+n+"' found"),u}function Ej(o){if(o.eat("(")){var n=S2(o);return o.eat(")")||o.err("Missing closing paren"),n}else if(/\W/.test(o.next))o.err("Unexpected token '"+o.next+"'");else{var a=mj(o,o.next).map(function(c){return o.inline==null?o.inline=c.isInline:o.inline!=c.isInline&&o.err("Mixing inline and block content"),{type:"name",value:c}});return o.pos++,a.length==1?a[0]:{type:"choice",exprs:a}}}function _j(o){var n=[[]];return u(A(o,0),a()),n;function a(){return n.push([])-1}function c(g,E,I){var C={term:I,to:E};return n[g].push(C),C}function u(g,E){g.forEach(function(I){return I.to=E})}function A(g,E){if(g.type=="choice")return g.exprs.reduce(function(lt,et){return lt.concat(A(et,E))},[]);if(g.type=="seq")for(var I=0;;I++){var C=A(g.exprs[I],E);if(I==g.exprs.length-1)return C;u(C,E=a())}else if(g.type=="star"){var b=a();return c(E,b),u(A(g.expr,b),b),[c(b)]}else if(g.type=="plus"){var N=a();return u(A(g.expr,E),N),u(A(g.expr,N),N),[c(N)]}else{if(g.type=="opt")return[c(E)].concat(A(g.expr,E));if(g.type=="range"){for(var L=E,Q=0;Q<g.min;Q++){var G=a();u(A(g.expr,L),G),L=G}if(g.max==-1)u(A(g.expr,L),L);else for(var Z=g.min;Z<g.max;Z++){var dt=a();c(L,dt),u(A(g.expr,L),dt),L=dt}return[c(L)]}else if(g.type=="name")return[c(E,null,g.value)]}}}function T2(o,n){return n-o}function VN(o,n){var a=[];return c(n),a.sort(T2);function c(u){var A=o[u];if(A.length==1&&!A[0].term)return c(A[0].to);a.push(u);for(var g=0;g<A.length;g++){var E=A[g],I=E.term,C=E.to;!I&&a.indexOf(C)==-1&&c(C)}}}function Ij(o){var n=Object.create(null);return a(VN(o,0));function a(c){var u=[];c.forEach(function(I){o[I].forEach(function(C){var b=C.term,N=C.to;if(!!b){var L=u.indexOf(b),Q=L>-1&&u[L+1];VN(o,N).forEach(function(G){Q||u.push(b,Q=[]),Q.indexOf(G)==-1&&Q.push(G)})}})});for(var A=n[c.join(",")]=new _i(c.indexOf(o.length-1)>-1),g=0;g<u.length;g+=2){var E=u[g+1].sort(T2);A.next.push(u[g],n[E.join(",")]||a(E))}return A}}function vj(o,n){for(var a=0,c=[o];a<c.length;a++){for(var u=c[a],A=!u.validEnd,g=[],E=0;E<u.next.length;E+=2){var I=u.next[E],C=u.next[E+1];g.push(I.name),A&&!(I.isText||I.hasRequiredAttrs())&&(A=!1),c.indexOf(C)==-1&&c.push(C)}A&&n.err("Only non-generatable nodes ("+g.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function R2(o){var n=Object.create(null);for(var a in o){var c=o[a];if(!c.hasDefault)return null;n[a]=c.default}return n}function y2(o,n){var a=Object.create(null);for(var c in o){var u=n&&n[c];if(u===void 0){var A=o[c];if(A.hasDefault)u=A.default;else throw new RangeError("No value supplied for attribute "+c)}a[c]=u}return a}function w2(o){var n=Object.create(null);if(o)for(var a in o)n[a]=new b2(o[a]);return n}var Li=function(n,a,c){this.name=n,this.schema=a,this.spec=c,this.groups=c.group?c.group.split(" "):[],this.attrs=w2(c.attrs),this.defaultAttrs=R2(this.attrs),this.contentMatch=null,this.markSet=null,this.inlineContent=null,this.isBlock=!(c.inline||n=="text"),this.isText=n=="text"},Sd={isInline:{configurable:!0},isTextblock:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0},whitespace:{configurable:!0}};Sd.isInline.get=function(){return!this.isBlock};Sd.isTextblock.get=function(){return this.isBlock&&this.inlineContent};Sd.isLeaf.get=function(){return this.contentMatch==_i.empty};Sd.isAtom.get=function(){return this.isLeaf||this.spec.atom};Sd.whitespace.get=function(){return this.spec.whitespace||(this.spec.code?"pre":"normal")};Li.prototype.hasRequiredAttrs=function(){for(var n in this.attrs)if(this.attrs[n].isRequired)return!0;return!1};Li.prototype.compatibleContent=function(n){return this==n||this.contentMatch.compatible(n.contentMatch)};Li.prototype.computeAttrs=function(n){return!n&&this.defaultAttrs?this.defaultAttrs:y2(this.attrs,n)};Li.prototype.create=function(n,a,c){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new sr(this,this.computeAttrs(n),bt.from(a),ir.setFrom(c))};Li.prototype.createChecked=function(n,a,c){if(a=bt.from(a),!this.validContent(a))throw new RangeError("Invalid content for node "+this.name);return new sr(this,this.computeAttrs(n),a,ir.setFrom(c))};Li.prototype.createAndFill=function(n,a,c){if(n=this.computeAttrs(n),a=bt.from(a),a.size){var u=this.contentMatch.fillBefore(a);if(!u)return null;a=u.append(a)}var A=this.contentMatch.matchFragment(a).fillBefore(bt.empty,!0);return A?new sr(this,n,a.append(A),ir.setFrom(c)):null};Li.prototype.validContent=function(n){var a=this.contentMatch.matchFragment(n);if(!a||!a.validEnd)return!1;for(var c=0;c<n.childCount;c++)if(!this.allowsMarks(n.child(c).marks))return!1;return!0};Li.prototype.allowsMarkType=function(n){return this.markSet==null||this.markSet.indexOf(n)>-1};Li.prototype.allowsMarks=function(n){if(this.markSet==null)return!0;for(var a=0;a<n.length;a++)if(!this.allowsMarkType(n[a].type))return!1;return!0};Li.prototype.allowedMarks=function(n){if(this.markSet==null)return n;for(var a,c=0;c<n.length;c++)this.allowsMarkType(n[c].type)?a&&a.push(n[c]):a||(a=n.slice(0,c));return a?a.length?a:ir.empty:n};Li.compile=function(n,a){var c=Object.create(null);n.forEach(function(g,E){return c[g]=new Li(g,a,E)});var u=a.spec.topNode||"doc";if(!c[u])throw new RangeError("Schema is missing its top node type ('"+u+"')");if(!c.text)throw new RangeError("Every schema needs a 'text' type");for(var A in c.text.attrs)throw new RangeError("The text node type should not have attributes");return c};Object.defineProperties(Li.prototype,Sd);var b2=function(n){this.hasDefault=Object.prototype.hasOwnProperty.call(n,"default"),this.default=n.default},N2={isRequired:{configurable:!0}};N2.isRequired.get=function(){return!this.hasDefault};Object.defineProperties(b2.prototype,N2);var Xa=function(n,a,c,u){this.name=n,this.schema=c,this.spec=u,this.attrs=w2(u.attrs),this.rank=a,this.excluded=null;var A=R2(this.attrs);this.instance=A&&new ir(this,A)};Xa.prototype.create=function(n){return!n&&this.instance?this.instance:new ir(this,y2(this.attrs,n))};Xa.compile=function(n,a){var c=Object.create(null),u=0;return n.forEach(function(A,g){return c[A]=new Xa(A,u++,a,g)}),c};Xa.prototype.removeFromSet=function(n){for(var a=0;a<n.length;a++)n[a].type==this&&(n=n.slice(0,a).concat(n.slice(a+1)),a--);return n};Xa.prototype.isInSet=function(n){for(var a=0;a<n.length;a++)if(n[a].type==this)return n[a]};Xa.prototype.excludes=function(n){return this.excluded.indexOf(n)>-1};var zc=function(n){this.spec={};for(var a in n)this.spec[a]=n[a];this.spec.nodes=FN.from(n.nodes),this.spec.marks=FN.from(n.marks),this.nodes=Li.compile(this.spec.nodes,this),this.marks=Xa.compile(this.spec.marks,this);var c=Object.create(null);for(var u in this.nodes){if(u in this.marks)throw new RangeError(u+" can not be both a node and a mark");var A=this.nodes[u],g=A.spec.content||"",E=A.spec.marks;A.contentMatch=c[g]||(c[g]=_i.parse(g,this.nodes)),A.inlineContent=A.contentMatch.inlineContent,A.markSet=E=="_"?null:E?GN(this,E.split(" ")):E==""||!A.inlineContent?[]:null}for(var I in this.marks){var C=this.marks[I],b=C.spec.excludes;C.excluded=b==null?[C]:b==""?[]:GN(this,b.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached=Object.create(null),this.cached.wrappings=Object.create(null)};zc.prototype.node=function(n,a,c,u){if(typeof n=="string")n=this.nodeType(n);else if(n instanceof Li){if(n.schema!=this)throw new RangeError("Node type from different schema used ("+n.name+")")}else throw new RangeError("Invalid node type: "+n);return n.createChecked(a,c,u)};zc.prototype.text=function(n,a){var c=this.nodes.text;return new pj(c,c.defaultAttrs,n,ir.setFrom(a))};zc.prototype.mark=function(n,a){return typeof n=="string"&&(n=this.marks[n]),n.create(a)};zc.prototype.nodeFromJSON=function(n){return sr.fromJSON(this,n)};zc.prototype.markFromJSON=function(n){return ir.fromJSON(this,n)};zc.prototype.nodeType=function(n){var a=this.nodes[n];if(!a)throw new RangeError("Unknown node type: "+n);return a};function GN(o,n){for(var a=[],c=0;c<n.length;c++){var u=n[c],A=o.marks[u],g=A;if(A)a.push(A);else for(var E in o.marks){var I=o.marks[E];(u=="_"||I.spec.group&&I.spec.group.split(" ").indexOf(u)>-1)&&a.push(g=I)}if(!g)throw new SyntaxError("Unknown mark type: '"+n[c]+"'")}return a}var hs=function(n,a){var c=this;this.schema=n,this.rules=a,this.tags=[],this.styles=[],a.forEach(function(u){u.tag?c.tags.push(u):u.style&&c.styles.push(u)}),this.normalizeLists=!this.tags.some(function(u){if(!/^(ul|ol)\b/.test(u.tag)||!u.node)return!1;var A=n.nodes[u.node];return A.contentMatch.matchType(A)})};hs.prototype.parse=function(n,a){a===void 0&&(a={});var c=new Xr(this,a,!1);return c.addAll(n,null,a.from,a.to),c.finish()};hs.prototype.parseSlice=function(n,a){a===void 0&&(a={});var c=new Xr(this,a,!0);return c.addAll(n,null,a.from,a.to),Kt.maxOpen(c.finish())};hs.prototype.matchTag=function(n,a,c){for(var u=c?this.tags.indexOf(c)+1:0;u<this.tags.length;u++){var A=this.tags[u];if(Tj(n,A.tag)&&(A.namespace===void 0||n.namespaceURI==A.namespace)&&(!A.context||a.matchesContext(A.context))){if(A.getAttrs){var g=A.getAttrs(n);if(g===!1)continue;A.attrs=g}return A}}};hs.prototype.matchStyle=function(n,a,c,u){for(var A=u?this.styles.indexOf(u)+1:0;A<this.styles.length;A++){var g=this.styles[A];if(!(g.style.indexOf(n)!=0||g.context&&!c.matchesContext(g.context)||g.style.length>n.length&&(g.style.charCodeAt(n.length)!=61||g.style.slice(n.length+1)!=a))){if(g.getAttrs){var E=g.getAttrs(a);if(E===!1)continue;g.attrs=E}return g}}};hs.schemaRules=function(n){var a=[];function c(I){for(var C=I.priority==null?50:I.priority,b=0;b<a.length;b++){var N=a[b],L=N.priority==null?50:N.priority;if(L<C)break}a.splice(b,0,I)}var u=function(I){var C=n.marks[I].spec.parseDOM;C&&C.forEach(function(b){c(b=jN(b)),b.mark=I})};for(var A in n.marks)u(A);var g=function(I){var C=n.nodes[E].spec.parseDOM;C&&C.forEach(function(b){c(b=jN(b)),b.node=E})};for(var E in n.nodes)g();return a};hs.fromSchema=function(n){return n.cached.domParser||(n.cached.domParser=new hs(n,hs.schemaRules(n)))};var UI={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},Cj={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},O2={ol:!0,ul:!0},of=1,sf=2,ah=4;function k2(o,n,a){return n!=null?(n?of:0)|(n==="full"?sf:0):o&&o.whitespace=="pre"?of|sf:a&~ah}var _a=function(n,a,c,u,A,g,E){this.type=n,this.attrs=a,this.solid=A,this.match=g||(E&ah?null:n.contentMatch),this.options=E,this.content=[],this.marks=c,this.activeMarks=ir.none,this.pendingMarks=u,this.stashMarks=[]};_a.prototype.findWrapping=function(n){if(!this.match){if(!this.type)return[];var a=this.type.contentMatch.fillBefore(bt.from(n));if(a)this.match=this.type.contentMatch.matchFragment(a);else{var c=this.type.contentMatch,u;return(u=c.findWrapping(n.type))?(this.match=c,u):null}}return this.match.findWrapping(n.type)};_a.prototype.finish=function(n){if(!(this.options&of)){var a=this.content[this.content.length-1],c;a&&a.isText&&(c=/[ \t\r\n\u000c]+$/.exec(a.text))&&(a.text.length==c[0].length?this.content.pop():this.content[this.content.length-1]=a.withText(a.text.slice(0,a.text.length-c[0].length)))}var u=bt.from(this.content);return!n&&this.match&&(u=u.append(this.match.fillBefore(bt.empty,!0))),this.type?this.type.create(this.attrs,u,this.marks):u};_a.prototype.popFromStashMark=function(n){for(var a=this.stashMarks.length-1;a>=0;a--)if(n.eq(this.stashMarks[a]))return this.stashMarks.splice(a,1)[0]};_a.prototype.applyPending=function(n){for(var a=0,c=this.pendingMarks;a<c.length;a++){var u=c[a];(this.type?this.type.allowsMarkType(u.type):yj(u.type,n))&&!u.isInSet(this.activeMarks)&&(this.activeMarks=u.addToSet(this.activeMarks),this.pendingMarks=u.removeFromSet(this.pendingMarks))}};_a.prototype.inlineContext=function(n){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:n.parentNode&&!UI.hasOwnProperty(n.parentNode.nodeName.toLowerCase())};var Xr=function(n,a,c){this.parser=n,this.options=a,this.isOpen=c;var u=a.topNode,A,g=k2(null,a.preserveWhitespace,0)|(c?ah:0);u?A=new _a(u.type,u.attrs,ir.none,ir.none,!0,a.topMatch||u.type.contentMatch,g):c?A=new _a(null,null,ir.none,ir.none,!0,null,g):A=new _a(n.schema.topNodeType,null,ir.none,ir.none,!0,null,g),this.nodes=[A],this.open=0,this.find=a.findPositions,this.needsBlock=!1},xI={top:{configurable:!0},currentPos:{configurable:!0}};xI.top.get=function(){return this.nodes[this.open]};Xr.prototype.addDOM=function(n){if(n.nodeType==3)this.addTextNode(n);else if(n.nodeType==1){var a=n.getAttribute("style"),c=a?this.readStyles(Rj(a)):null,u=this.top;if(c!=null)for(var A=0;A<c.length;A++)this.addPendingMark(c[A]);if(this.addElement(n),c!=null)for(var g=0;g<c.length;g++)this.removePendingMark(c[g],u)}};Xr.prototype.addTextNode=function(n){var a=n.nodeValue,c=this.top;if(c.options&sf||c.inlineContext(n)||/[^ \t\r\n\u000c]/.test(a)){if(c.options&of)c.options&sf?a=a.replace(/\r\n?/g,`
`):a=a.replace(/\r?\n|\r/g," ");else if(a=a.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(a)&&this.open==this.nodes.length-1){var u=c.content[c.content.length-1],A=n.previousSibling;(!u||A&&A.nodeName=="BR"||u.isText&&/[ \t\r\n\u000c]$/.test(u.text))&&(a=a.slice(1))}a&&this.insertNode(this.parser.schema.text(a)),this.findInText(n)}else this.findInside(n)};Xr.prototype.addElement=function(n,a){var c=n.nodeName.toLowerCase(),u;O2.hasOwnProperty(c)&&this.parser.normalizeLists&&Sj(n);var A=this.options.ruleFromNode&&this.options.ruleFromNode(n)||(u=this.parser.matchTag(n,this,a));if(A?A.ignore:Cj.hasOwnProperty(c))this.findInside(n),this.ignoreFallback(n);else if(!A||A.skip||A.closeParent){A&&A.closeParent?this.open=Math.max(0,this.open-1):A&&A.skip.nodeType&&(n=A.skip);var g,E=this.top,I=this.needsBlock;if(UI.hasOwnProperty(c))g=!0,E.type||(this.needsBlock=!0);else if(!n.firstChild){this.leafFallback(n);return}this.addAll(n),g&&this.sync(E),this.needsBlock=I}else this.addElementByRule(n,A,A.consuming===!1?u:null)};Xr.prototype.leafFallback=function(n){n.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(n.ownerDocument.createTextNode(`
`))};Xr.prototype.ignoreFallback=function(n){n.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"))};Xr.prototype.readStyles=function(n){var a=ir.none;t:for(var c=0;c<n.length;c+=2)for(var u=null;;){var A=this.parser.matchStyle(n[c],n[c+1],this,u);if(!A)continue t;if(A.ignore)return null;if(a=this.parser.schema.marks[A.mark].create(A.attrs).addToSet(a),A.consuming===!1)u=A;else break}return a};Xr.prototype.addElementByRule=function(n,a,c){var u=this,A,g,E,I;a.node?(g=this.parser.schema.nodes[a.node],g.isLeaf?this.insertNode(g.create(a.attrs))||this.leafFallback(n):A=this.enter(g,a.attrs,a.preserveWhitespace)):(E=this.parser.schema.marks[a.mark],I=E.create(a.attrs),this.addPendingMark(I));var C=this.top;if(g&&g.isLeaf)this.findInside(n);else if(c)this.addElement(n,c);else if(a.getContent)this.findInside(n),a.getContent(n,this.parser.schema).forEach(function(N){return u.insertNode(N)});else{var b=a.contentElement;typeof b=="string"?b=n.querySelector(b):typeof b=="function"&&(b=b(n)),b||(b=n),this.findAround(n,b,!0),this.addAll(b,A)}A&&(this.sync(C),this.open--),I&&this.removePendingMark(I,C)};Xr.prototype.addAll=function(n,a,c,u){for(var A=c||0,g=c?n.childNodes[c]:n.firstChild,E=u==null?null:n.childNodes[u];g!=E;g=g.nextSibling,++A)this.findAtPoint(n,A),this.addDOM(g),a&&UI.hasOwnProperty(g.nodeName.toLowerCase())&&this.sync(a);this.findAtPoint(n,A)};Xr.prototype.findPlace=function(n){for(var a,c,u=this.open;u>=0;u--){var A=this.nodes[u],g=A.findWrapping(n);if(g&&(!a||a.length>g.length)&&(a=g,c=A,!g.length)||A.solid)break}if(!a)return!1;this.sync(c);for(var E=0;E<a.length;E++)this.enterInner(a[E],null,!1);return!0};Xr.prototype.insertNode=function(n){if(n.isInline&&this.needsBlock&&!this.top.type){var a=this.textblockFromContext();a&&this.enterInner(a)}if(this.findPlace(n)){this.closeExtra();var c=this.top;c.applyPending(n.type),c.match&&(c.match=c.match.matchType(n.type));for(var u=c.activeMarks,A=0;A<n.marks.length;A++)(!c.type||c.type.allowsMarkType(n.marks[A].type))&&(u=n.marks[A].addToSet(u));return c.content.push(n.mark(u)),!0}return!1};Xr.prototype.enter=function(n,a,c){var u=this.findPlace(n.create(a));return u&&this.enterInner(n,a,!0,c),u};Xr.prototype.enterInner=function(n,a,c,u){this.closeExtra();var A=this.top;A.applyPending(n),A.match=A.match&&A.match.matchType(n,a);var g=k2(n,u,A.options);A.options&ah&&A.content.length==0&&(g|=ah),this.nodes.push(new _a(n,a,A.activeMarks,A.pendingMarks,c,null,g)),this.open++};Xr.prototype.closeExtra=function(n){var a=this.nodes.length-1;if(a>this.open){for(;a>this.open;a--)this.nodes[a-1].content.push(this.nodes[a].finish(n));this.nodes.length=this.open+1}};Xr.prototype.finish=function(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)};Xr.prototype.sync=function(n){for(var a=this.open;a>=0;a--)if(this.nodes[a]==n){this.open=a;return}};xI.currentPos.get=function(){this.closeExtra();for(var o=0,n=this.open;n>=0;n--){for(var a=this.nodes[n].content,c=a.length-1;c>=0;c--)o+=a[c].nodeSize;n&&o++}return o};Xr.prototype.findAtPoint=function(n,a){if(this.find)for(var c=0;c<this.find.length;c++)this.find[c].node==n&&this.find[c].offset==a&&(this.find[c].pos=this.currentPos)};Xr.prototype.findInside=function(n){if(this.find)for(var a=0;a<this.find.length;a++)this.find[a].pos==null&&n.nodeType==1&&n.contains(this.find[a].node)&&(this.find[a].pos=this.currentPos)};Xr.prototype.findAround=function(n,a,c){if(n!=a&&this.find){for(var u=0;u<this.find.length;u++)if(this.find[u].pos==null&&n.nodeType==1&&n.contains(this.find[u].node)){var A=a.compareDocumentPosition(this.find[u].node);A&(c?2:4)&&(this.find[u].pos=this.currentPos)}}};Xr.prototype.findInText=function(n){if(this.find)for(var a=0;a<this.find.length;a++)this.find[a].node==n&&(this.find[a].pos=this.currentPos-(n.nodeValue.length-this.find[a].offset))};Xr.prototype.matchesContext=function(n){var a=this;if(n.indexOf("|")>-1)return n.split(/\s*\|\s*/).some(this.matchesContext,this);var c=n.split("/"),u=this.options.context,A=!this.isOpen&&(!u||u.parent.type==this.nodes[0].type),g=-(u?u.depth+1:0)+(A?0:1),E=function(I,C){for(;I>=0;I--){var b=c[I];if(b==""){if(I==c.length-1||I==0)continue;for(;C>=g;C--)if(E(I-1,C))return!0;return!1}else{var N=C>0||C==0&&A?a.nodes[C].type:u&&C>=g?u.node(C-g).type:null;if(!N||N.name!=b&&N.groups.indexOf(b)==-1)return!1;C--}}return!0};return E(c.length-1,this.open)};Xr.prototype.textblockFromContext=function(){var n=this.options.context;if(n)for(var a=n.depth;a>=0;a--){var c=n.node(a).contentMatchAt(n.indexAfter(a)).defaultType;if(c&&c.isTextblock&&c.defaultAttrs)return c}for(var u in this.parser.schema.nodes){var A=this.parser.schema.nodes[u];if(A.isTextblock&&A.defaultAttrs)return A}};Xr.prototype.addPendingMark=function(n){var a=wj(n,this.top.pendingMarks);a&&this.top.stashMarks.push(a),this.top.pendingMarks=n.addToSet(this.top.pendingMarks)};Xr.prototype.removePendingMark=function(n,a){for(var c=this.open;c>=0;c--){var u=this.nodes[c],A=u.pendingMarks.lastIndexOf(n);if(A>-1)u.pendingMarks=n.removeFromSet(u.pendingMarks);else{u.activeMarks=n.removeFromSet(u.activeMarks);var g=u.popFromStashMark(n);g&&u.type&&u.type.allowsMarkType(g.type)&&(u.activeMarks=g.addToSet(u.activeMarks))}if(u==a)break}};Object.defineProperties(Xr.prototype,xI);function Sj(o){for(var n=o.firstChild,a=null;n;n=n.nextSibling){var c=n.nodeType==1?n.nodeName.toLowerCase():null;c&&O2.hasOwnProperty(c)&&a?(a.appendChild(n),n=a):c=="li"?a=n:c&&(a=null)}}function Tj(o,n){return(o.matches||o.msMatchesSelector||o.webkitMatchesSelector||o.mozMatchesSelector).call(o,n)}function Rj(o){for(var n=/\s*([\w-]+)\s*:\s*([^;]+)/g,a,c=[];a=n.exec(o);)c.push(a[1],a[2].trim());return c}function jN(o){var n={};for(var a in o)n[a]=o[a];return n}function yj(o,n){var a=n.schema.nodes,c=function(g){var E=a[g];if(!!E.allowsMarkType(o)){var I=[],C=function(b){I.push(b);for(var N=0;N<b.edgeCount;N++){var L=b.edge(N),Q=L.type,G=L.next;if(Q==n||I.indexOf(G)<0&&C(G))return!0}};if(C(E.contentMatch))return{v:!0}}};for(var u in a){var A=c(u);if(A)return A.v}}function wj(o,n){for(var a=0;a<n.length;a++)if(o.eq(n[a]))return n[a]}var ai=function(n,a){this.nodes=n||{},this.marks=a||{}};ai.prototype.serializeFragment=function(n,a,c){var u=this;a===void 0&&(a={}),c||(c=FI(a).createDocumentFragment());var A=c,g=null;return n.forEach(function(E){if(g||E.marks.length){g||(g=[]);for(var I=0,C=0;I<g.length&&C<E.marks.length;){var b=E.marks[C];if(!u.marks[b.type.name]){C++;continue}if(!b.eq(g[I])||b.type.spec.spanning===!1)break;I+=2,C++}for(;I<g.length;)A=g.pop(),g.pop();for(;C<E.marks.length;){var N=E.marks[C++],L=u.serializeMark(N,E.isInline,a);L&&(g.push(N,A),A.appendChild(L.dom),A=L.contentDOM||L.dom)}}A.appendChild(u.serializeNodeInner(E,a))}),c};ai.prototype.serializeNodeInner=function(n,a){a===void 0&&(a={});var c=ai.renderSpec(FI(a),this.nodes[n.type.name](n)),u=c.dom,A=c.contentDOM;if(A){if(n.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");a.onContent?a.onContent(n,A,a):this.serializeFragment(n.content,a,A)}return u};ai.prototype.serializeNode=function(n,a){a===void 0&&(a={});for(var c=this.serializeNodeInner(n,a),u=n.marks.length-1;u>=0;u--){var A=this.serializeMark(n.marks[u],n.isInline,a);A&&((A.contentDOM||A.dom).appendChild(c),c=A.dom)}return c};ai.prototype.serializeMark=function(n,a,c){c===void 0&&(c={});var u=this.marks[n.type.name];return u&&ai.renderSpec(FI(c),u(n,a))};ai.renderSpec=function(n,a,c){if(c===void 0&&(c=null),typeof a=="string")return{dom:n.createTextNode(a)};if(a.nodeType!=null)return{dom:a};if(a.dom&&a.dom.nodeType!=null)return a;var u=a[0],A=u.indexOf(" ");A>0&&(c=u.slice(0,A),u=u.slice(A+1));var g=null,E=c?n.createElementNS(c,u):n.createElement(u),I=a[1],C=1;if(I&&typeof I=="object"&&I.nodeType==null&&!Array.isArray(I)){C=2;for(var b in I)if(I[b]!=null){var N=b.indexOf(" ");N>0?E.setAttributeNS(b.slice(0,N),b.slice(N+1),I[b]):E.setAttribute(b,I[b])}}for(var L=C;L<a.length;L++){var Q=a[L];if(Q===0){if(L<a.length-1||L>C)throw new RangeError("Content hole must be the only child of its parent node");return{dom:E,contentDOM:E}}else{var G=ai.renderSpec(n,Q,c),Z=G.dom,dt=G.contentDOM;if(E.appendChild(Z),dt){if(g)throw new RangeError("Multiple content holes");g=dt}}}return{dom:E,contentDOM:g}};ai.fromSchema=function(n){return n.cached.domSerializer||(n.cached.domSerializer=new ai(this.nodesFromSchema(n),this.marksFromSchema(n)))};ai.nodesFromSchema=function(n){var a=D2(n.nodes);return a.text||(a.text=function(c){return c.text}),a};ai.marksFromSchema=function(n){return D2(n.marks)};function D2(o){var n={};for(var a in o){var c=o[a].spec.toDOM;c&&(n[a]=c)}return n}function FI(o){return o.document||window.document}var L2=65535,P2=Math.pow(2,16);function bj(o,n){return o+n*P2}function B2(o){return o&L2}function Nj(o){return(o-(o&L2))/P2}var dI=function(n,a,c){a===void 0&&(a=!1),c===void 0&&(c=null),this.pos=n,this.deleted=a,this.recover=c},oi=function o(n,a){if(a===void 0&&(a=!1),!n.length&&o.empty)return o.empty;this.ranges=n,this.inverted=a};oi.prototype.recover=function(n){var a=0,c=B2(n);if(!this.inverted)for(var u=0;u<c;u++)a+=this.ranges[u*3+2]-this.ranges[u*3+1];return this.ranges[c*3]+a+Nj(n)};oi.prototype.mapResult=function(n,a){return a===void 0&&(a=1),this._map(n,a,!1)};oi.prototype.map=function(n,a){return a===void 0&&(a=1),this._map(n,a,!0)};oi.prototype._map=function(n,a,c){for(var u=0,A=this.inverted?2:1,g=this.inverted?1:2,E=0;E<this.ranges.length;E+=3){var I=this.ranges[E]-(this.inverted?u:0);if(I>n)break;var C=this.ranges[E+A],b=this.ranges[E+g],N=I+C;if(n<=N){var L=C?n==I?-1:n==N?1:a:a,Q=I+u+(L<0?0:b);if(c)return Q;var G=n==(a<0?I:N)?null:bj(E/3,n-I);return new dI(Q,a<0?n!=I:n!=N,G)}u+=b-C}return c?n+u:new dI(n+u)};oi.prototype.touches=function(n,a){for(var c=0,u=B2(a),A=this.inverted?2:1,g=this.inverted?1:2,E=0;E<this.ranges.length;E+=3){var I=this.ranges[E]-(this.inverted?c:0);if(I>n)break;var C=this.ranges[E+A],b=I+C;if(n<=b&&E==u*3)return!0;c+=this.ranges[E+g]-C}return!1};oi.prototype.forEach=function(n){for(var a=this.inverted?2:1,c=this.inverted?1:2,u=0,A=0;u<this.ranges.length;u+=3){var g=this.ranges[u],E=g-(this.inverted?A:0),I=g+(this.inverted?0:A),C=this.ranges[u+a],b=this.ranges[u+c];n(E,E+C,I,I+b),A+=b-C}};oi.prototype.invert=function(){return new oi(this.ranges,!this.inverted)};oi.prototype.toString=function(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)};oi.offset=function(n){return n==0?oi.empty:new oi(n<0?[0,-n,0]:[0,0,n])};oi.empty=new oi([]);var Ii=function(n,a,c,u){this.maps=n||[],this.from=c||0,this.to=u==null?this.maps.length:u,this.mirror=a};Ii.prototype.slice=function(n,a){return n===void 0&&(n=0),a===void 0&&(a=this.maps.length),new Ii(this.maps,this.mirror,n,a)};Ii.prototype.copy=function(){return new Ii(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)};Ii.prototype.appendMap=function(n,a){this.to=this.maps.push(n),a!=null&&this.setMirror(this.maps.length-1,a)};Ii.prototype.appendMapping=function(n){for(var a=0,c=this.maps.length;a<n.maps.length;a++){var u=n.getMirror(a);this.appendMap(n.maps[a],u!=null&&u<a?c+u:null)}};Ii.prototype.getMirror=function(n){if(this.mirror){for(var a=0;a<this.mirror.length;a++)if(this.mirror[a]==n)return this.mirror[a+(a%2?-1:1)]}};Ii.prototype.setMirror=function(n,a){this.mirror||(this.mirror=[]),this.mirror.push(n,a)};Ii.prototype.appendMappingInverted=function(n){for(var a=n.maps.length-1,c=this.maps.length+n.maps.length;a>=0;a--){var u=n.getMirror(a);this.appendMap(n.maps[a].invert(),u!=null&&u>a?c-u-1:null)}};Ii.prototype.invert=function(){var n=new Ii;return n.appendMappingInverted(this),n};Ii.prototype.map=function(n,a){if(a===void 0&&(a=1),this.mirror)return this._map(n,a,!0);for(var c=this.from;c<this.to;c++)n=this.maps[c].map(n,a);return n};Ii.prototype.mapResult=function(n,a){return a===void 0&&(a=1),this._map(n,a,!1)};Ii.prototype._map=function(n,a,c){for(var u=!1,A=this.from;A<this.to;A++){var g=this.maps[A],E=g.mapResult(n,a);if(E.recover!=null){var I=this.getMirror(A);if(I!=null&&I>A&&I<this.to){A=I,n=this.maps[I].recover(E.recover);continue}}E.deleted&&(u=!0),n=E.pos}return c?n:new dI(n,u)};function hd(o){var n=Error.call(this,o);return n.__proto__=hd.prototype,n}hd.prototype=Object.create(Error.prototype);hd.prototype.constructor=hd;hd.prototype.name="TransformError";var Cn=function(n){this.doc=n,this.steps=[],this.docs=[],this.mapping=new Ii},QI={before:{configurable:!0},docChanged:{configurable:!0}};QI.before.get=function(){return this.docs.length?this.docs[0]:this.doc};Cn.prototype.step=function(n){var a=this.maybeStep(n);if(a.failed)throw new hd(a.failed);return this};Cn.prototype.maybeStep=function(n){var a=n.apply(this.doc);return a.failed||this.addStep(n,a.doc),a};QI.docChanged.get=function(){return this.steps.length>0};Cn.prototype.addStep=function(n,a){this.docs.push(this.doc),this.steps.push(n),this.mapping.appendMap(n.getMap()),this.doc=a};Object.defineProperties(Cn.prototype,QI);function Tf(){throw new Error("Override me")}var uI=Object.create(null),Si=function(){};Si.prototype.apply=function(n){return Tf()};Si.prototype.getMap=function(){return oi.empty};Si.prototype.invert=function(n){return Tf()};Si.prototype.map=function(n){return Tf()};Si.prototype.merge=function(n){return null};Si.prototype.toJSON=function(){return Tf()};Si.fromJSON=function(n,a){if(!a||!a.stepType)throw new RangeError("Invalid input for Step.fromJSON");var c=uI[a.stepType];if(!c)throw new RangeError("No step type "+a.stepType+" defined");return c.fromJSON(n,a)};Si.jsonID=function(n,a){if(n in uI)throw new RangeError("Duplicate use of step JSON ID "+n);return uI[n]=a,a.prototype.jsonID=n,a};var Di=function(n,a){this.doc=n,this.failed=a};Di.ok=function(n){return new Di(n,null)};Di.fail=function(n){return new Di(null,n)};Di.fromReplace=function(n,a,c,u){try{return Di.ok(n.replace(a,c,u))}catch(A){if(A instanceof xs)return Di.fail(A.message);throw A}};var Sa=function(o){function n(a,c,u,A){o.call(this),this.from=a,this.to=c,this.slice=u,this.structure=!!A}return o&&(n.__proto__=o),n.prototype=Object.create(o&&o.prototype),n.prototype.constructor=n,n.prototype.apply=function(c){return this.structure&&hI(c,this.from,this.to)?Di.fail("Structure replace would overwrite content"):Di.fromReplace(c,this.from,this.to,this.slice)},n.prototype.getMap=function(){return new oi([this.from,this.to-this.from,this.slice.size])},n.prototype.invert=function(c){return new n(this.from,this.from+this.slice.size,c.slice(this.from,this.to))},n.prototype.map=function(c){var u=c.mapResult(this.from,1),A=c.mapResult(this.to,-1);return u.deleted&&A.deleted?null:new n(u.pos,Math.max(u.pos,A.pos),this.slice)},n.prototype.merge=function(c){if(!(c instanceof n)||c.structure||this.structure)return null;if(this.from+this.slice.size==c.from&&!this.slice.openEnd&&!c.slice.openStart){var u=this.slice.size+c.slice.size==0?Kt.empty:new Kt(this.slice.content.append(c.slice.content),this.slice.openStart,c.slice.openEnd);return new n(this.from,this.to+(c.to-c.from),u,this.structure)}else if(c.to==this.from&&!this.slice.openStart&&!c.slice.openEnd){var A=this.slice.size+c.slice.size==0?Kt.empty:new Kt(c.slice.content.append(this.slice.content),c.slice.openStart,this.slice.openEnd);return new n(c.from,this.to,A,this.structure)}else return null},n.prototype.toJSON=function(){var c={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(c.slice=this.slice.toJSON()),this.structure&&(c.structure=!0),c},n.fromJSON=function(c,u){if(typeof u.from!="number"||typeof u.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new n(u.from,u.to,Kt.fromJSON(c,u.slice),!!u.structure)},n}(Si);Si.jsonID("replace",Sa);var to=function(o){function n(a,c,u,A,g,E,I){o.call(this),this.from=a,this.to=c,this.gapFrom=u,this.gapTo=A,this.slice=g,this.insert=E,this.structure=!!I}return o&&(n.__proto__=o),n.prototype=Object.create(o&&o.prototype),n.prototype.constructor=n,n.prototype.apply=function(c){if(this.structure&&(hI(c,this.from,this.gapFrom)||hI(c,this.gapTo,this.to)))return Di.fail("Structure gap-replace would overwrite content");var u=c.slice(this.gapFrom,this.gapTo);if(u.openStart||u.openEnd)return Di.fail("Gap is not a flat range");var A=this.slice.insertAt(this.insert,u.content);return A?Di.fromReplace(c,this.from,this.to,A):Di.fail("Content does not fit in gap")},n.prototype.getMap=function(){return new oi([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])},n.prototype.invert=function(c){var u=this.gapTo-this.gapFrom;return new n(this.from,this.from+this.slice.size+u,this.from+this.insert,this.from+this.insert+u,c.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)},n.prototype.map=function(c){var u=c.mapResult(this.from,1),A=c.mapResult(this.to,-1),g=c.map(this.gapFrom,-1),E=c.map(this.gapTo,1);return u.deleted&&A.deleted||g<u.pos||E>A.pos?null:new n(u.pos,A.pos,g,E,this.slice,this.insert,this.structure)},n.prototype.toJSON=function(){var c={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(c.slice=this.slice.toJSON()),this.structure&&(c.structure=!0),c},n.fromJSON=function(c,u){if(typeof u.from!="number"||typeof u.to!="number"||typeof u.gapFrom!="number"||typeof u.gapTo!="number"||typeof u.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new n(u.from,u.to,u.gapFrom,u.gapTo,Kt.fromJSON(c,u.slice),u.insert,!!u.structure)},n}(Si);Si.jsonID("replaceAround",to);function hI(o,n,a){for(var c=o.resolve(n),u=a-n,A=c.depth;u>0&&A>0&&c.indexAfter(A)==c.node(A).childCount;)A--,u--;if(u>0)for(var g=c.node(A).maybeChild(c.indexAfter(A));u>0;){if(!g||g.isLeaf)return!0;g=g.firstChild,u--}return!1}function Oj(o,n,a){return(n==0||o.canReplace(n,o.childCount))&&(a==o.childCount||o.canReplace(0,a))}function Td(o){for(var n=o.parent,a=n.content.cutByIndex(o.startIndex,o.endIndex),c=o.depth;;--c){var u=o.$from.node(c),A=o.$from.index(c),g=o.$to.indexAfter(c);if(c<o.depth&&u.canReplace(A,g,a))return c;if(c==0||u.type.spec.isolating||!Oj(u,A,g))break}}Cn.prototype.lift=function(o,n){for(var a=o.$from,c=o.$to,u=o.depth,A=a.before(u+1),g=c.after(u+1),E=A,I=g,C=bt.empty,b=0,N=u,L=!1;N>n;N--)L||a.index(N)>0?(L=!0,C=bt.from(a.node(N).copy(C)),b++):E--;for(var Q=bt.empty,G=0,Z=u,dt=!1;Z>n;Z--)dt||c.after(Z+1)<c.end(Z)?(dt=!0,Q=bt.from(c.node(Z).copy(Q)),G++):I++;return this.step(new to(E,I,A,g,new Kt(C.append(Q),b,G),C.size-b,!0))};function VI(o,n,a,c){c===void 0&&(c=o);var u=kj(o,n),A=u&&Dj(c,n);return A?u.map(HN).concat({type:n,attrs:a}).concat(A.map(HN)):null}function HN(o){return{type:o,attrs:null}}function kj(o,n){var a=o.parent,c=o.startIndex,u=o.endIndex,A=a.contentMatchAt(c).findWrapping(n);if(!A)return null;var g=A.length?A[0]:n;return a.canReplaceWith(c,u,g)?A:null}function Dj(o,n){var a=o.parent,c=o.startIndex,u=o.endIndex,A=a.child(c),g=n.contentMatch.findWrapping(A.type);if(!g)return null;for(var E=g.length?g[g.length-1]:n,I=E.contentMatch,C=c;I&&C<u;C++)I=I.matchType(a.child(C).type);return!I||!I.validEnd?null:g}Cn.prototype.wrap=function(o,n){for(var a=bt.empty,c=n.length-1;c>=0;c--){if(a.size){var u=n[c].type.contentMatch.matchFragment(a);if(!u||!u.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}a=bt.from(n[c].type.create(n[c].attrs,a))}var A=o.start,g=o.end;return this.step(new to(A,g,A,g,new Kt(a,0,0),n.length,!0))};Cn.prototype.setBlockType=function(o,n,a,c){var u=this;if(n===void 0&&(n=o),!a.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");var A=this.steps.length;return this.doc.nodesBetween(o,n,function(g,E){if(g.isTextblock&&!g.hasMarkup(a,c)&&Lj(u.doc,u.mapping.slice(A).map(E),a)){u.clearIncompatible(u.mapping.slice(A).map(E,1),a);var I=u.mapping.slice(A),C=I.map(E,1),b=I.map(E+g.nodeSize,1);return u.step(new to(C,b,C+1,b-1,new Kt(bt.from(a.create(c,null,g.marks)),0,0),1,!0)),!1}}),this};function Lj(o,n,a){var c=o.resolve(n),u=c.index();return c.parent.canReplaceWith(u,u+1,a)}Cn.prototype.setNodeMarkup=function(o,n,a,c){var u=this.doc.nodeAt(o);if(!u)throw new RangeError("No node at given position");n||(n=u.type);var A=n.create(a,null,c||u.marks);if(u.isLeaf)return this.replaceWith(o,o+u.nodeSize,A);if(!n.validContent(u.content))throw new RangeError("Invalid content for node type "+n.name);return this.step(new to(o,o+u.nodeSize,o+1,o+u.nodeSize-1,new Kt(bt.from(A),0,0),1,!0))};function Ia(o,n,a,c){a===void 0&&(a=1);var u=o.resolve(n),A=u.depth-a,g=c&&c[c.length-1]||u.parent;if(A<0||u.parent.type.spec.isolating||!u.parent.canReplace(u.index(),u.parent.childCount)||!g.type.validContent(u.parent.content.cutByIndex(u.index(),u.parent.childCount)))return!1;for(var E=u.depth-1,I=a-2;E>A;E--,I--){var C=u.node(E),b=u.index(E);if(C.type.spec.isolating)return!1;var N=C.content.cutByIndex(b,C.childCount),L=c&&c[I]||C;if(L!=C&&(N=N.replaceChild(0,L.type.create(L.attrs))),!C.canReplace(b+1,C.childCount)||!L.type.validContent(N))return!1}var Q=u.indexAfter(A),G=c&&c[0];return u.node(A).canReplaceWith(Q,Q,G?G.type:u.node(A+1).type)}Cn.prototype.split=function(o,n,a){n===void 0&&(n=1);for(var c=this.doc.resolve(o),u=bt.empty,A=bt.empty,g=c.depth,E=c.depth-n,I=n-1;g>E;g--,I--){u=bt.from(c.node(g).copy(u));var C=a&&a[I];A=bt.from(C?C.type.create(C.attrs,A):c.node(g).copy(A))}return this.step(new Sa(o,o,new Kt(u.append(A),n,n),!0))};function vh(o,n){var a=o.resolve(n),c=a.index();return Pj(a.nodeBefore,a.nodeAfter)&&a.parent.canReplace(c,c+1)}function Pj(o,n){return o&&n&&!o.isLeaf&&o.canAppend(n)}Cn.prototype.join=function(o,n){n===void 0&&(n=1);var a=new Sa(o-n,o+n,Kt.empty,!0);return this.step(a)};function Bj(o,n,a){var c=o.resolve(n);if(c.parent.canReplaceWith(c.index(),c.index(),a))return n;if(c.parentOffset==0)for(var u=c.depth-1;u>=0;u--){var A=c.index(u);if(c.node(u).canReplaceWith(A,A,a))return c.before(u+1);if(A>0)return null}if(c.parentOffset==c.parent.content.size)for(var g=c.depth-1;g>=0;g--){var E=c.indexAfter(g);if(c.node(g).canReplaceWith(E,E,a))return c.after(g+1);if(E<c.node(g).childCount)return null}}function M2(o,n,a){var c=o.resolve(n);if(!a.content.size)return n;for(var u=a.content,A=0;A<a.openStart;A++)u=u.firstChild.content;for(var g=1;g<=(a.openStart==0&&a.size?2:1);g++)for(var E=c.depth;E>=0;E--){var I=E==c.depth?0:c.pos<=(c.start(E+1)+c.end(E+1))/2?-1:1,C=c.index(E)+(I>0?1:0),b=c.node(E),N=!1;if(g==1)N=b.canReplace(C,C,u);else{var L=b.contentMatchAt(C).findWrapping(u.firstChild.type);N=L&&b.canReplaceWith(C,C,L[0])}if(N)return I==0?c.pos:I<0?c.before(E+1):c.after(E+1)}return null}function GI(o,n,a){for(var c=[],u=0;u<o.childCount;u++){var A=o.child(u);A.content.size&&(A=A.copy(GI(A.content,n,A))),A.isInline&&(A=n(A,a,u)),c.push(A)}return bt.fromArray(c)}var jI=function(o){function n(a,c,u){o.call(this),this.from=a,this.to=c,this.mark=u}return o&&(n.__proto__=o),n.prototype=Object.create(o&&o.prototype),n.prototype.constructor=n,n.prototype.apply=function(c){var u=this,A=c.slice(this.from,this.to),g=c.resolve(this.from),E=g.node(g.sharedDepth(this.to)),I=new Kt(GI(A.content,function(C,b){return!C.isAtom||!b.type.allowsMarkType(u.mark.type)?C:C.mark(u.mark.addToSet(C.marks))},E),A.openStart,A.openEnd);return Di.fromReplace(c,this.from,this.to,I)},n.prototype.invert=function(){return new Ch(this.from,this.to,this.mark)},n.prototype.map=function(c){var u=c.mapResult(this.from,1),A=c.mapResult(this.to,-1);return u.deleted&&A.deleted||u.pos>=A.pos?null:new n(u.pos,A.pos,this.mark)},n.prototype.merge=function(c){if(c instanceof n&&c.mark.eq(this.mark)&&this.from<=c.to&&this.to>=c.from)return new n(Math.min(this.from,c.from),Math.max(this.to,c.to),this.mark)},n.prototype.toJSON=function(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},n.fromJSON=function(c,u){if(typeof u.from!="number"||typeof u.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new n(u.from,u.to,c.markFromJSON(u.mark))},n}(Si);Si.jsonID("addMark",jI);var Ch=function(o){function n(a,c,u){o.call(this),this.from=a,this.to=c,this.mark=u}return o&&(n.__proto__=o),n.prototype=Object.create(o&&o.prototype),n.prototype.constructor=n,n.prototype.apply=function(c){var u=this,A=c.slice(this.from,this.to),g=new Kt(GI(A.content,function(E){return E.mark(u.mark.removeFromSet(E.marks))}),A.openStart,A.openEnd);return Di.fromReplace(c,this.from,this.to,g)},n.prototype.invert=function(){return new jI(this.from,this.to,this.mark)},n.prototype.map=function(c){var u=c.mapResult(this.from,1),A=c.mapResult(this.to,-1);return u.deleted&&A.deleted||u.pos>=A.pos?null:new n(u.pos,A.pos,this.mark)},n.prototype.merge=function(c){if(c instanceof n&&c.mark.eq(this.mark)&&this.from<=c.to&&this.to>=c.from)return new n(Math.min(this.from,c.from),Math.max(this.to,c.to),this.mark)},n.prototype.toJSON=function(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},n.fromJSON=function(c,u){if(typeof u.from!="number"||typeof u.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new n(u.from,u.to,c.markFromJSON(u.mark))},n}(Si);Si.jsonID("removeMark",Ch);Cn.prototype.addMark=function(o,n,a){var c=this,u=[],A=[],g=null,E=null;return this.doc.nodesBetween(o,n,function(I,C,b){if(!!I.isInline){var N=I.marks;if(!a.isInSet(N)&&b.type.allowsMarkType(a.type)){for(var L=Math.max(C,o),Q=Math.min(C+I.nodeSize,n),G=a.addToSet(N),Z=0;Z<N.length;Z++)N[Z].isInSet(G)||(g&&g.to==L&&g.mark.eq(N[Z])?g.to=Q:u.push(g=new Ch(L,Q,N[Z])));E&&E.to==L?E.to=Q:A.push(E=new jI(L,Q,a))}}}),u.forEach(function(I){return c.step(I)}),A.forEach(function(I){return c.step(I)}),this};Cn.prototype.removeMark=function(o,n,a){var c=this;a===void 0&&(a=null);var u=[],A=0;return this.doc.nodesBetween(o,n,function(g,E){if(!!g.isInline){A++;var I=null;if(a instanceof Xa)for(var C=g.marks,b;b=a.isInSet(C);)(I||(I=[])).push(b),C=b.removeFromSet(C);else a?a.isInSet(g.marks)&&(I=[a]):I=g.marks;if(I&&I.length)for(var N=Math.min(E+g.nodeSize,n),L=0;L<I.length;L++){for(var Q=I[L],G=void 0,Z=0;Z<u.length;Z++){var dt=u[Z];dt.step==A-1&&Q.eq(u[Z].style)&&(G=dt)}G?(G.to=N,G.step=A):u.push({style:Q,from:Math.max(E,o),to:N,step:A})}}}),u.forEach(function(g){return c.step(new Ch(g.from,g.to,g.style))}),this};Cn.prototype.clearIncompatible=function(o,n,a){a===void 0&&(a=n.contentMatch);for(var c=this.doc.nodeAt(o),u=[],A=o+1,g=0;g<c.childCount;g++){var E=c.child(g),I=A+E.nodeSize,C=a.matchType(E.type,E.attrs);if(!C)u.push(new Sa(A,I,Kt.empty));else{a=C;for(var b=0;b<E.marks.length;b++)n.allowsMarkType(E.marks[b].type)||this.step(new Ch(A,I,E.marks[b]))}A=I}if(!a.validEnd){var N=a.fillBefore(bt.empty,!0);this.replace(A,A,new Kt(N,0,0))}for(var L=u.length-1;L>=0;L--)this.step(u[L]);return this};function HI(o,n,a,c){if(a===void 0&&(a=n),c===void 0&&(c=Kt.empty),n==a&&!c.size)return null;var u=o.resolve(n),A=o.resolve(a);return U2(u,A,c)?new Sa(n,a,c):new Yo(u,A,c).fit()}Cn.prototype.replace=function(o,n,a){n===void 0&&(n=o),a===void 0&&(a=Kt.empty);var c=HI(this.doc,o,n,a);return c&&this.step(c),this};Cn.prototype.replaceWith=function(o,n,a){return this.replace(o,n,new Kt(bt.from(a),0,0))};Cn.prototype.delete=function(o,n){return this.replace(o,n,Kt.empty)};Cn.prototype.insert=function(o,n){return this.replaceWith(o,o,n)};function U2(o,n,a){return!a.openStart&&!a.openEnd&&o.start()==n.start()&&o.parent.canReplace(o.index(),n.index(),a.content)}var Yo=function(n,a,c){this.$to=a,this.$from=n,this.unplaced=c,this.frontier=[];for(var u=0;u<=n.depth;u++){var A=n.node(u);this.frontier.push({type:A.type,match:A.contentMatchAt(n.indexAfter(u))})}this.placed=bt.empty;for(var g=n.depth;g>0;g--)this.placed=bt.from(n.node(g).copy(this.placed))},x2={depth:{configurable:!0}};x2.depth.get=function(){return this.frontier.length-1};Yo.prototype.fit=function(){for(;this.unplaced.size;){var n=this.findFittable();n?this.placeNodes(n):this.openMore()||this.dropNode()}var a=this.mustMoveInline(),c=this.placed.size-this.depth-this.$from.depth,u=this.$from,A=this.close(a<0?this.$to:u.doc.resolve(a));if(!A)return null;for(var g=this.placed,E=u.depth,I=A.depth;E&&I&&g.childCount==1;)g=g.firstChild.content,E--,I--;var C=new Kt(g,E,I);if(a>-1)return new to(u.pos,a,this.$to.pos,this.$to.end(),C,c);if(C.size||u.pos!=this.$to.pos)return new Sa(u.pos,A.pos,C)};Yo.prototype.findFittable=function(){for(var n=1;n<=2;n++)for(var a=this.unplaced.openStart;a>=0;a--){var c=void 0,u=void 0;a?(u=KI(this.unplaced.content,a-1).firstChild,c=u.content):c=this.unplaced.content;for(var A=c.firstChild,g=this.depth;g>=0;g--){var E=this.frontier[g],I=E.type,C=E.match,b=void 0,N=void 0;if(n==1&&(A?C.matchType(A.type)||(N=C.fillBefore(bt.from(A),!1)):I.compatibleContent(u.type)))return{sliceDepth:a,frontierDepth:g,parent:u,inject:N};if(n==2&&A&&(b=C.findWrapping(A.type)))return{sliceDepth:a,frontierDepth:g,parent:u,wrap:b};if(u&&C.matchType(u.type))break}}};Yo.prototype.openMore=function(){var n=this.unplaced,a=n.content,c=n.openStart,u=n.openEnd,A=KI(a,c);return!A.childCount||A.firstChild.isLeaf?!1:(this.unplaced=new Kt(a,c+1,Math.max(u,A.size+c>=a.size-u?c+1:0)),!0)};Yo.prototype.dropNode=function(){var n=this.unplaced,a=n.content,c=n.openStart,u=n.openEnd,A=KI(a,c);if(A.childCount<=1&&c>0){var g=a.size-c<=c+A.size;this.unplaced=new Kt(ch(a,c-1,1),c-1,g?c-1:u)}else this.unplaced=new Kt(ch(a,c,1),c,u)};Yo.prototype.placeNodes=function(n){for(var a=n.sliceDepth,c=n.frontierDepth,u=n.parent,A=n.inject,g=n.wrap;this.depth>c;)this.closeFrontierNode();if(g)for(var E=0;E<g.length;E++)this.openFrontierNode(g[E]);var I=this.unplaced,C=u?u.content:I.content,b=I.openStart-a,N=0,L=[],Q=this.frontier[c],G=Q.match,Z=Q.type;if(A){for(var dt=0;dt<A.childCount;dt++)L.push(A.child(dt));G=G.matchFragment(A)}for(var lt=C.size+a-(I.content.size-I.openEnd);N<C.childCount;){var et=C.child(N),Dt=G.matchType(et.type);if(!Dt)break;N++,(N>1||b==0||et.content.size)&&(G=Dt,L.push(F2(et.mark(Z.allowedMarks(et.marks)),N==1?b:0,N==C.childCount?lt:-1)))}var J=N==C.childCount;J||(lt=-1),this.placed=Sh(this.placed,c,bt.from(L)),this.frontier[c].match=G,J&&lt<0&&u&&u.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(var Ft=0,Ot=C;Ft<lt;Ft++){var ce=Ot.lastChild;this.frontier.push({type:ce.type,match:ce.contentMatchAt(ce.childCount)}),Ot=ce.content}this.unplaced=J?a==0?Kt.empty:new Kt(ch(I.content,a-1,1),a-1,lt<0?I.openEnd:a-1):new Kt(ch(I.content,a,N),I.openStart,I.openEnd)};Yo.prototype.mustMoveInline=function(){if(!this.$to.parent.isTextblock||this.$to.end()==this.$to.pos)return-1;var n=this.frontier[this.depth],a;if(!n.type.isTextblock||!pI(this.$to,this.$to.depth,n.type,n.match,!1)||this.$to.depth==this.depth&&(a=this.findCloseLevel(this.$to))&&a.depth==this.depth)return-1;for(var c=this.$to,u=c.depth,A=this.$to.after(u);u>1&&A==this.$to.end(--u);)++A;return A};Yo.prototype.findCloseLevel=function(n){t:for(var a=Math.min(this.depth,n.depth);a>=0;a--){var c=this.frontier[a],u=c.match,A=c.type,g=a<n.depth&&n.end(a+1)==n.pos+(n.depth-(a+1)),E=pI(n,a,A,u,g);if(!!E){for(var I=a-1;I>=0;I--){var C=this.frontier[I],b=C.match,N=C.type,L=pI(n,I,N,b,!0);if(!L||L.childCount)continue t}return{depth:a,fit:E,move:g?n.doc.resolve(n.after(a+1)):n}}}};Yo.prototype.close=function(n){var a=this.findCloseLevel(n);if(!a)return null;for(;this.depth>a.depth;)this.closeFrontierNode();a.fit.childCount&&(this.placed=Sh(this.placed,a.depth,a.fit)),n=a.move;for(var c=a.depth+1;c<=n.depth;c++){var u=n.node(c),A=u.type.contentMatch.fillBefore(u.content,!0,n.index(c));this.openFrontierNode(u.type,u.attrs,A)}return n};Yo.prototype.openFrontierNode=function(n,a,c){var u=this.frontier[this.depth];u.match=u.match.matchType(n),this.placed=Sh(this.placed,this.depth,bt.from(n.create(a,c))),this.frontier.push({type:n,match:n.contentMatch})};Yo.prototype.closeFrontierNode=function(){var n=this.frontier.pop(),a=n.match.fillBefore(bt.empty,!0);a.childCount&&(this.placed=Sh(this.placed,this.frontier.length,a))};Object.defineProperties(Yo.prototype,x2);function ch(o,n,a){return n==0?o.cutByIndex(a):o.replaceChild(0,o.firstChild.copy(ch(o.firstChild.content,n-1,a)))}function Sh(o,n,a){return n==0?o.append(a):o.replaceChild(o.childCount-1,o.lastChild.copy(Sh(o.lastChild.content,n-1,a)))}function KI(o,n){for(var a=0;a<n;a++)o=o.firstChild.content;return o}function F2(o,n,a){if(n<=0)return o;var c=o.content;return n>1&&(c=c.replaceChild(0,F2(c.firstChild,n-1,c.childCount==1?a-1:0))),n>0&&(c=o.type.contentMatch.fillBefore(c).append(c),a<=0&&(c=c.append(o.type.contentMatch.matchFragment(c).fillBefore(bt.empty,!0)))),o.copy(c)}function pI(o,n,a,c,u){var A=o.node(n),g=u?o.indexAfter(n):o.index(n);if(g==A.childCount&&!a.compatibleContent(A.type))return null;var E=c.fillBefore(A.content,!0,g);return E&&!Mj(a,A.content,g)?E:null}function Mj(o,n,a){for(var c=a;c<n.childCount;c++)if(!o.allowsMarks(n.child(c).marks))return!0;return!1}Cn.prototype.replaceRange=function(o,n,a){if(!a.size)return this.deleteRange(o,n);var c=this.doc.resolve(o),u=this.doc.resolve(n);if(U2(c,u,a))return this.step(new Sa(o,n,a));var A=V2(c,this.doc.resolve(n));A[A.length-1]==0&&A.pop();var g=-(c.depth+1);A.unshift(g);for(var E=c.depth,I=c.pos-1;E>0;E--,I--){var C=c.node(E).type.spec;if(C.defining||C.isolating)break;A.indexOf(E)>-1?g=E:c.before(E)==I&&A.splice(1,0,-E)}for(var b=A.indexOf(g),N=[],L=a.openStart,Q=a.content,G=0;;G++){var Z=Q.firstChild;if(N.push(Z),G==a.openStart)break;Q=Z.content}L>0&&N[L-1].type.spec.defining&&c.node(b).type!=N[L-1].type?L-=1:L>=2&&N[L-1].isTextblock&&N[L-2].type.spec.defining&&c.node(b).type!=N[L-2].type&&(L-=2);for(var dt=a.openStart;dt>=0;dt--){var lt=(dt+L+1)%(a.openStart+1),et=N[lt];if(!!et)for(var Dt=0;Dt<A.length;Dt++){var J=A[(Dt+b)%A.length],Ft=!0;J<0&&(Ft=!1,J=-J);var Ot=c.node(J-1),ce=c.index(J-1);if(Ot.canReplaceWith(ce,ce,et.type,et.marks))return this.replace(c.before(J),Ft?u.after(J):n,new Kt(Q2(a.content,0,a.openStart,lt),lt,a.openEnd))}}for(var ge=this.steps.length,he=A.length-1;he>=0&&(this.replace(o,n,a),!(this.steps.length>ge));he--){var Te=A[he];Te<0||(o=c.before(Te),n=u.after(Te))}return this};function Q2(o,n,a,c,u){if(n<a){var A=o.firstChild;o=o.replaceChild(0,A.copy(Q2(A.content,n+1,a,c,A)))}if(n>c){var g=u.contentMatchAt(0),E=g.fillBefore(o).append(o);o=E.append(g.matchFragment(E).fillBefore(bt.empty,!0))}return o}Cn.prototype.replaceRangeWith=function(o,n,a){if(!a.isInline&&o==n&&this.doc.resolve(o).parent.content.size){var c=Bj(this.doc,o,a.type);c!=null&&(o=n=c)}return this.replaceRange(o,n,new Kt(bt.from(a),0,0))};Cn.prototype.deleteRange=function(o,n){for(var a=this.doc.resolve(o),c=this.doc.resolve(n),u=V2(a,c),A=0;A<u.length;A++){var g=u[A],E=A==u.length-1;if(E&&g==0||a.node(g).type.contentMatch.validEnd)return this.delete(a.start(g),c.end(g));if(g>0&&(E||a.node(g-1).canReplace(a.index(g-1),c.indexAfter(g-1))))return this.delete(a.before(g),c.after(g))}for(var I=1;I<=a.depth&&I<=c.depth;I++)if(o-a.start(I)==a.depth-I&&n>a.end(I)&&c.end(I)-n!=c.depth-I)return this.delete(a.before(I),n);return this.delete(o,n)};function V2(o,n){for(var a=[],c=Math.min(o.depth,n.depth),u=c;u>=0;u--){var A=o.start(u);if(A<o.pos-(o.depth-u)||n.end(u)>n.pos+(n.depth-u)||o.node(u).type.spec.isolating||n.node(u).type.spec.isolating)break;(A==n.start(u)||u==o.depth&&u==n.depth&&o.parent.inlineContent&&n.parent.inlineContent&&u&&n.start(u-1)==A-1)&&a.push(u)}return a}var AI=Object.create(null),De=function(n,a,c){this.ranges=c||[new Uj(n.min(a),n.max(a))],this.$anchor=n,this.$head=a},ec={anchor:{configurable:!0},head:{configurable:!0},from:{configurable:!0},to:{configurable:!0},$from:{configurable:!0},$to:{configurable:!0},empty:{configurable:!0}};ec.anchor.get=function(){return this.$anchor.pos};ec.head.get=function(){return this.$head.pos};ec.from.get=function(){return this.$from.pos};ec.to.get=function(){return this.$to.pos};ec.$from.get=function(){return this.ranges[0].$from};ec.$to.get=function(){return this.ranges[0].$to};ec.empty.get=function(){for(var o=this.ranges,n=0;n<o.length;n++)if(o[n].$from.pos!=o[n].$to.pos)return!1;return!0};De.prototype.content=function(){return this.$from.node(0).slice(this.from,this.to,!0)};De.prototype.replace=function(n,a){a===void 0&&(a=Kt.empty);for(var c=a.content.lastChild,u=null,A=0;A<a.openEnd;A++)u=c,c=c.lastChild;for(var g=n.steps.length,E=this.ranges,I=0;I<E.length;I++){var C=E[I],b=C.$from,N=C.$to,L=n.mapping.slice(g);n.replaceRange(L.map(b.pos),L.map(N.pos),I?Kt.empty:a),I==0&&G2(n,g,(c?c.isInline:u&&u.isTextblock)?-1:1)}};De.prototype.replaceWith=function(n,a){for(var c=n.steps.length,u=this.ranges,A=0;A<u.length;A++){var g=u[A],E=g.$from,I=g.$to,C=n.mapping.slice(c),b=C.map(E.pos),N=C.map(I.pos);A?n.deleteRange(b,N):(n.replaceRangeWith(b,N,a),G2(n,c,a.isInline?-1:1))}};De.findFrom=function(n,a,c){var u=n.parent.inlineContent?new rr(n):ld(n.node(0),n.parent,n.pos,n.index(),a,c);if(u)return u;for(var A=n.depth-1;A>=0;A--){var g=a<0?ld(n.node(0),n.node(A),n.before(A+1),n.index(A),a,c):ld(n.node(0),n.node(A),n.after(A+1),n.index(A)+1,a,c);if(g)return g}};De.near=function(n,a){return a===void 0&&(a=1),this.findFrom(n,a)||this.findFrom(n,-a)||new Ta(n.node(0))};De.atStart=function(n){return ld(n,n,0,0,1)||new Ta(n)};De.atEnd=function(n){return ld(n,n,n.content.size,n.childCount,-1)||new Ta(n)};De.fromJSON=function(n,a){if(!a||!a.type)throw new RangeError("Invalid input for Selection.fromJSON");var c=AI[a.type];if(!c)throw new RangeError("No selection type "+a.type+" defined");return c.fromJSON(n,a)};De.jsonID=function(n,a){if(n in AI)throw new RangeError("Duplicate use of selection JSON ID "+n);return AI[n]=a,a.prototype.jsonID=n,a};De.prototype.getBookmark=function(){return rr.between(this.$anchor,this.$head).getBookmark()};Object.defineProperties(De.prototype,ec);De.prototype.visible=!0;var Uj=function(n,a){this.$from=n,this.$to=a},rr=function(o){function n(c,u){u===void 0&&(u=c),o.call(this,c,u)}o&&(n.__proto__=o),n.prototype=Object.create(o&&o.prototype),n.prototype.constructor=n;var a={$cursor:{configurable:!0}};return a.$cursor.get=function(){return this.$anchor.pos==this.$head.pos?this.$head:null},n.prototype.map=function(u,A){var g=u.resolve(A.map(this.head));if(!g.parent.inlineContent)return o.near(g);var E=u.resolve(A.map(this.anchor));return new n(E.parent.inlineContent?E:g,g)},n.prototype.replace=function(u,A){if(A===void 0&&(A=Kt.empty),o.prototype.replace.call(this,u,A),A==Kt.empty){var g=this.$from.marksAcross(this.$to);g&&u.ensureMarks(g)}},n.prototype.eq=function(u){return u instanceof n&&u.anchor==this.anchor&&u.head==this.head},n.prototype.getBookmark=function(){return new lh(this.anchor,this.head)},n.prototype.toJSON=function(){return{type:"text",anchor:this.anchor,head:this.head}},n.fromJSON=function(u,A){if(typeof A.anchor!="number"||typeof A.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new n(u.resolve(A.anchor),u.resolve(A.head))},n.create=function(u,A,g){g===void 0&&(g=A);var E=u.resolve(A);return new this(E,g==A?E:u.resolve(g))},n.between=function(u,A,g){var E=u.pos-A.pos;if((!g||E)&&(g=E>=0?1:-1),!A.parent.inlineContent){var I=o.findFrom(A,g,!0)||o.findFrom(A,-g,!0);if(I)A=I.$head;else return o.near(A,g)}return u.parent.inlineContent||(E==0?u=A:(u=(o.findFrom(u,-g,!0)||o.findFrom(u,g,!0)).$anchor,u.pos<A.pos!=E<0&&(u=A))),new n(u,A)},Object.defineProperties(n.prototype,a),n}(De);De.jsonID("text",rr);var lh=function(n,a){this.anchor=n,this.head=a};lh.prototype.map=function(n){return new lh(n.map(this.anchor),n.map(this.head))};lh.prototype.resolve=function(n){return rr.between(n.resolve(this.anchor),n.resolve(this.head))};var ke=function(o){function n(a){var c=a.nodeAfter,u=a.node(0).resolve(a.pos+c.nodeSize);o.call(this,a,u),this.node=c}return o&&(n.__proto__=o),n.prototype=Object.create(o&&o.prototype),n.prototype.constructor=n,n.prototype.map=function(c,u){var A=u.mapResult(this.anchor),g=A.deleted,E=A.pos,I=c.resolve(E);return g?o.near(I):new n(I)},n.prototype.content=function(){return new Kt(bt.from(this.node),0,0)},n.prototype.eq=function(c){return c instanceof n&&c.anchor==this.anchor},n.prototype.toJSON=function(){return{type:"node",anchor:this.anchor}},n.prototype.getBookmark=function(){return new af(this.anchor)},n.fromJSON=function(c,u){if(typeof u.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new n(c.resolve(u.anchor))},n.create=function(c,u){return new this(c.resolve(u))},n.isSelectable=function(c){return!c.isText&&c.type.spec.selectable!==!1},n}(De);ke.prototype.visible=!1;De.jsonID("node",ke);var af=function(n){this.anchor=n};af.prototype.map=function(n){var a=n.mapResult(this.anchor),c=a.deleted,u=a.pos;return c?new lh(u,u):new af(u)};af.prototype.resolve=function(n){var a=n.resolve(this.anchor),c=a.nodeAfter;return c&&ke.isSelectable(c)?new ke(a):De.near(a)};var Ta=function(o){function n(a){o.call(this,a.resolve(0),a.resolve(a.content.size))}return o&&(n.__proto__=o),n.prototype=Object.create(o&&o.prototype),n.prototype.constructor=n,n.prototype.replace=function(c,u){if(u===void 0&&(u=Kt.empty),u==Kt.empty){c.delete(0,c.doc.content.size);var A=o.atStart(c.doc);A.eq(c.selection)||c.setSelection(A)}else o.prototype.replace.call(this,c,u)},n.prototype.toJSON=function(){return{type:"all"}},n.fromJSON=function(c){return new n(c)},n.prototype.map=function(c){return new n(c)},n.prototype.eq=function(c){return c instanceof n},n.prototype.getBookmark=function(){return xj},n}(De);De.jsonID("all",Ta);var xj={map:function(){return this},resolve:function(n){return new Ta(n)}};function ld(o,n,a,c,u,A){if(n.inlineContent)return rr.create(o,a);for(var g=c-(u>0?0:1);u>0?g<n.childCount:g>=0;g+=u){var E=n.child(g);if(E.isAtom){if(!A&&ke.isSelectable(E))return ke.create(o,a-(u<0?E.nodeSize:0))}else{var I=ld(o,E,a+u,u<0?E.childCount:0,u,A);if(I)return I}a+=E.nodeSize*u}}function G2(o,n,a){var c=o.steps.length-1;if(!(c<n)){var u=o.steps[c];if(u instanceof Sa||u instanceof to){var A=o.mapping.maps[c],g;A.forEach(function(E,I,C,b){g==null&&(g=b)}),o.setSelection(De.near(o.doc.resolve(g),a))}}}var KN=1,YA=2,WN=4,Fj=function(o){function n(c){o.call(this,c.doc),this.time=Date.now(),this.curSelection=c.selection,this.curSelectionFor=0,this.storedMarks=c.storedMarks,this.updated=0,this.meta=Object.create(null)}o&&(n.__proto__=o),n.prototype=Object.create(o&&o.prototype),n.prototype.constructor=n;var a={selection:{configurable:!0},selectionSet:{configurable:!0},storedMarksSet:{configurable:!0},isGeneric:{configurable:!0},scrolledIntoView:{configurable:!0}};return a.selection.get=function(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection},n.prototype.setSelection=function(u){if(u.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=u,this.curSelectionFor=this.steps.length,this.updated=(this.updated|KN)&~YA,this.storedMarks=null,this},a.selectionSet.get=function(){return(this.updated&KN)>0},n.prototype.setStoredMarks=function(u){return this.storedMarks=u,this.updated|=YA,this},n.prototype.ensureMarks=function(u){return ir.sameSet(this.storedMarks||this.selection.$from.marks(),u)||this.setStoredMarks(u),this},n.prototype.addStoredMark=function(u){return this.ensureMarks(u.addToSet(this.storedMarks||this.selection.$head.marks()))},n.prototype.removeStoredMark=function(u){return this.ensureMarks(u.removeFromSet(this.storedMarks||this.selection.$head.marks()))},a.storedMarksSet.get=function(){return(this.updated&YA)>0},n.prototype.addStep=function(u,A){o.prototype.addStep.call(this,u,A),this.updated=this.updated&~YA,this.storedMarks=null},n.prototype.setTime=function(u){return this.time=u,this},n.prototype.replaceSelection=function(u){return this.selection.replace(this,u),this},n.prototype.replaceSelectionWith=function(u,A){var g=this.selection;return A!==!1&&(u=u.mark(this.storedMarks||(g.empty?g.$from.marks():g.$from.marksAcross(g.$to)||ir.none))),g.replaceWith(this,u),this},n.prototype.deleteSelection=function(){return this.selection.replace(this),this},n.prototype.insertText=function(u,A,g){g===void 0&&(g=A);var E=this.doc.type.schema;if(A==null)return u?this.replaceSelectionWith(E.text(u),!0):this.deleteSelection();if(!u)return this.deleteRange(A,g);var I=this.storedMarks;if(!I){var C=this.doc.resolve(A);I=g==A?C.marks():C.marksAcross(this.doc.resolve(g))}return this.replaceRangeWith(A,g,E.text(u,I)),this.selection.empty||this.setSelection(De.near(this.selection.$to)),this},n.prototype.setMeta=function(u,A){return this.meta[typeof u=="string"?u:u.key]=A,this},n.prototype.getMeta=function(u){return this.meta[typeof u=="string"?u:u.key]},a.isGeneric.get=function(){for(var c in this.meta)return!1;return!0},n.prototype.scrollIntoView=function(){return this.updated|=WN,this},a.scrolledIntoView.get=function(){return(this.updated&WN)>0},Object.defineProperties(n.prototype,a),n}(Cn);function YN(o,n){return!n||!o?o:o.bind(n)}var Wu=function(n,a,c){this.name=n,this.init=YN(a.init,c),this.apply=YN(a.apply,c)},Qj=[new Wu("doc",{init:function(n){return n.doc||n.schema.topNodeType.createAndFill()},apply:function(n){return n.doc}}),new Wu("selection",{init:function(n,a){return n.selection||De.atStart(a.doc)},apply:function(n){return n.selection}}),new Wu("storedMarks",{init:function(n){return n.storedMarks||null},apply:function(n,a,c,u){return u.selection.$cursor?n.storedMarks:null}}),new Wu("scrollToSelection",{init:function(){return 0},apply:function(n,a){return n.scrolledIntoView?a+1:a}})],WI=function(n,a){var c=this;this.schema=n,this.fields=Qj.concat(),this.plugins=[],this.pluginsByKey=Object.create(null),a&&a.forEach(function(u){if(c.pluginsByKey[u.key])throw new RangeError("Adding different instances of a keyed plugin ("+u.key+")");c.plugins.push(u),c.pluginsByKey[u.key]=u,u.spec.state&&c.fields.push(new Wu(u.key,u.spec.state,u))})},vi=function(n){this.config=n},Rf={schema:{configurable:!0},plugins:{configurable:!0},tr:{configurable:!0}};Rf.schema.get=function(){return this.config.schema};Rf.plugins.get=function(){return this.config.plugins};vi.prototype.apply=function(n){return this.applyTransaction(n).state};vi.prototype.filterTransaction=function(n,a){a===void 0&&(a=-1);for(var c=0;c<this.config.plugins.length;c++)if(c!=a){var u=this.config.plugins[c];if(u.spec.filterTransaction&&!u.spec.filterTransaction.call(u,n,this))return!1}return!0};vi.prototype.applyTransaction=function(n){if(!this.filterTransaction(n))return{state:this,transactions:[]};for(var a=[n],c=this.applyInner(n),u=null;;){for(var A=!1,g=0;g<this.config.plugins.length;g++){var E=this.config.plugins[g];if(E.spec.appendTransaction){var I=u?u[g].n:0,C=u?u[g].state:this,b=I<a.length&&E.spec.appendTransaction.call(E,I?a.slice(I):a,C,c);if(b&&c.filterTransaction(b,g)){if(b.setMeta("appendedTransaction",n),!u){u=[];for(var N=0;N<this.config.plugins.length;N++)u.push(N<g?{state:c,n:a.length}:{state:this,n:0})}a.push(b),c=c.applyInner(b),A=!0}u&&(u[g]={state:c,n:a.length})}}if(!A)return{state:c,transactions:a}}};vi.prototype.applyInner=function(n){if(!n.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");for(var a=new vi(this.config),c=this.config.fields,u=0;u<c.length;u++){var A=c[u];a[A.name]=A.apply(n,this[A.name],this,a)}for(var g=0;g<dh.length;g++)dh[g](this,n,a);return a};Rf.tr.get=function(){return new Fj(this)};vi.create=function(n){for(var a=new WI(n.doc?n.doc.type.schema:n.schema,n.plugins),c=new vi(a),u=0;u<a.fields.length;u++)c[a.fields[u].name]=a.fields[u].init(n,c);return c};vi.prototype.reconfigure=function(n){for(var a=new WI(this.schema,n.plugins),c=a.fields,u=new vi(a),A=0;A<c.length;A++){var g=c[A].name;u[g]=this.hasOwnProperty(g)?this[g]:c[A].init(n,u)}return u};vi.prototype.toJSON=function(n){var a={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(a.storedMarks=this.storedMarks.map(function(g){return g.toJSON()})),n&&typeof n=="object")for(var c in n){if(c=="doc"||c=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");var u=n[c],A=u.spec.state;A&&A.toJSON&&(a[c]=A.toJSON.call(u,this[u.key]))}return a};vi.fromJSON=function(n,a,c){if(!a)throw new RangeError("Invalid input for EditorState.fromJSON");if(!n.schema)throw new RangeError("Required config field 'schema' missing");var u=new WI(n.schema,n.plugins),A=new vi(u);return u.fields.forEach(function(g){if(g.name=="doc")A.doc=sr.fromJSON(n.schema,a.doc);else if(g.name=="selection")A.selection=De.fromJSON(A.doc,a.selection);else if(g.name=="storedMarks")a.storedMarks&&(A.storedMarks=a.storedMarks.map(n.schema.markFromJSON));else{if(c)for(var E in c){var I=c[E],C=I.spec.state;if(I.key==g.name&&C&&C.fromJSON&&Object.prototype.hasOwnProperty.call(a,E)){A[g.name]=C.fromJSON.call(I,n,a[E],A);return}}A[g.name]=g.init(n,A)}}),A};vi.addApplyListener=function(n){dh.push(n)};vi.removeApplyListener=function(n){var a=dh.indexOf(n);a>-1&&dh.splice(a,1)};Object.defineProperties(vi.prototype,Rf);var dh=[];function j2(o,n,a){for(var c in o){var u=o[c];u instanceof Function?u=u.bind(n):c=="handleDOMEvents"&&(u=j2(u,n,{})),a[c]=u}return a}var Fn=function(n){this.props={},n.props&&j2(n.props,this,this.props),this.spec=n,this.key=n.key?n.key.key:H2("plugin")};Fn.prototype.getState=function(n){return n[this.key]};var U_=Object.create(null);function H2(o){return o in U_?o+"$"+ ++U_[o]:(U_[o]=0,o+"$")}var Ti=function(n){n===void 0&&(n="key"),this.key=H2(n)};Ti.prototype.get=function(n){return n.config.pluginsByKey[this.key]};Ti.prototype.getState=function(n){return n[this.key]};function YI(o,n){return o.selection.empty?!1:(n&&n(o.tr.deleteSelection().scrollIntoView()),!0)}function K2(o,n,a){var c=o.selection,u=c.$cursor;if(!u||(a?!a.endOfTextblock("backward",o):u.parentOffset>0))return!1;var A=Y2(u);if(!A){var g=u.blockRange(),E=g&&Td(g);return E==null?!1:(n&&n(o.tr.lift(g,E).scrollIntoView()),!0)}var I=A.nodeBefore;if(!I.type.spec.isolating&&ek(o,A,n))return!0;if(u.parent.content.size==0&&(pd(I,"end")||ke.isSelectable(I))){var C=HI(o.doc,u.before(),u.after(),Kt.empty);if(C.slice.size<C.to-C.from){if(n){var b=o.tr.step(C);b.setSelection(pd(I,"end")?De.findFrom(b.doc.resolve(b.mapping.map(A.pos,-1)),-1):ke.create(b.doc,A.pos-I.nodeSize)),n(b.scrollIntoView())}return!0}}return I.isAtom&&A.depth==u.depth-1?(n&&n(o.tr.delete(A.pos-I.nodeSize,A.pos).scrollIntoView()),!0):!1}function pd(o,n,a){for(;o;o=n=="start"?o.firstChild:o.lastChild){if(o.isTextblock)return!0;if(a&&o.childCount!=1)return!1}return!1}function W2(o,n,a){var c=o.selection,u=c.$head,A=c.empty,g=u;if(!A)return!1;if(u.parent.isTextblock){if(a?!a.endOfTextblock("backward",o):u.parentOffset>0)return!1;g=Y2(u)}var E=g&&g.nodeBefore;return!E||!ke.isSelectable(E)?!1:(n&&n(o.tr.setSelection(ke.create(o.doc,g.pos-E.nodeSize)).scrollIntoView()),!0)}function Y2(o){if(!o.parent.type.spec.isolating)for(var n=o.depth-1;n>=0;n--){if(o.index(n)>0)return o.doc.resolve(o.before(n+1));if(o.node(n).type.spec.isolating)break}return null}function q2(o,n,a){var c=o.selection,u=c.$cursor;if(!u||(a?!a.endOfTextblock("forward",o):u.parentOffset<u.parent.content.size))return!1;var A=z2(u);if(!A)return!1;var g=A.nodeAfter;if(ek(o,A,n))return!0;if(u.parent.content.size==0&&(pd(g,"start")||ke.isSelectable(g))){var E=HI(o.doc,u.before(),u.after(),Kt.empty);if(E.slice.size<E.to-E.from){if(n){var I=o.tr.step(E);I.setSelection(pd(g,"start")?De.findFrom(I.doc.resolve(I.mapping.map(A.pos)),1):ke.create(I.doc,I.mapping.map(A.pos))),n(I.scrollIntoView())}return!0}}return g.isAtom&&A.depth==u.depth-1?(n&&n(o.tr.delete(A.pos,A.pos+g.nodeSize).scrollIntoView()),!0):!1}function J2(o,n,a){var c=o.selection,u=c.$head,A=c.empty,g=u;if(!A)return!1;if(u.parent.isTextblock){if(a?!a.endOfTextblock("forward",o):u.parentOffset<u.parent.content.size)return!1;g=z2(u)}var E=g&&g.nodeAfter;return!E||!ke.isSelectable(E)?!1:(n&&n(o.tr.setSelection(ke.create(o.doc,g.pos)).scrollIntoView()),!0)}function z2(o){if(!o.parent.type.spec.isolating)for(var n=o.depth-1;n>=0;n--){var a=o.node(n);if(o.index(n)+1<a.childCount)return o.doc.resolve(o.after(n+1));if(a.type.spec.isolating)break}return null}function Vj(o,n){var a=o.selection,c=a.$from,u=a.$to,A=c.blockRange(u),g=A&&Td(A);return g==null?!1:(n&&n(o.tr.lift(A,g).scrollIntoView()),!0)}function X2(o,n){var a=o.selection,c=a.$head,u=a.$anchor;return!c.parent.type.spec.code||!c.sameParent(u)?!1:(n&&n(o.tr.insertText(`
`).scrollIntoView()),!0)}function qI(o){for(var n=0;n<o.edgeCount;n++){var a=o.edge(n),c=a.type;if(c.isTextblock&&!c.hasRequiredAttrs())return c}return null}function Z2(o,n){var a=o.selection,c=a.$head,u=a.$anchor;if(!c.parent.type.spec.code||!c.sameParent(u))return!1;var A=c.node(-1),g=c.indexAfter(-1),E=qI(A.contentMatchAt(g));if(!A.canReplaceWith(g,g,E))return!1;if(n){var I=c.after(),C=o.tr.replaceWith(I,I,E.createAndFill());C.setSelection(De.near(C.doc.resolve(I),1)),n(C.scrollIntoView())}return!0}function $2(o,n){var a=o.selection,c=a.$from,u=a.$to;if(a instanceof Ta||c.parent.inlineContent||u.parent.inlineContent)return!1;var A=qI(u.parent.contentMatchAt(u.indexAfter()));if(!A||!A.isTextblock)return!1;if(n){var g=(!c.parentOffset&&u.index()<u.parent.childCount?c:u).pos,E=o.tr.insert(g,A.createAndFill());E.setSelection(rr.create(E.doc,g+1)),n(E.scrollIntoView())}return!0}function tk(o,n){var a=o.selection,c=a.$cursor;if(!c||c.parent.content.size)return!1;if(c.depth>1&&c.after()!=c.end(-1)){var u=c.before();if(Ia(o.doc,u))return n&&n(o.tr.split(u).scrollIntoView()),!0}var A=c.blockRange(),g=A&&Td(A);return g==null?!1:(n&&n(o.tr.lift(A,g).scrollIntoView()),!0)}function Gj(o,n){var a=o.selection,c=a.$from,u=a.$to;if(o.selection instanceof ke&&o.selection.node.isBlock)return!c.parentOffset||!Ia(o.doc,c.pos)?!1:(n&&n(o.tr.split(c.pos).scrollIntoView()),!0);if(!c.parent.isBlock)return!1;if(n){var A=u.parentOffset==u.parent.content.size,g=o.tr;(o.selection instanceof rr||o.selection instanceof Ta)&&g.deleteSelection();var E=c.depth==0?null:qI(c.node(-1).contentMatchAt(c.indexAfter(-1))),I=A&&E?[{type:E}]:null,C=Ia(g.doc,g.mapping.map(c.pos),1,I);if(!I&&!C&&Ia(g.doc,g.mapping.map(c.pos),1,E&&[{type:E}])&&(I=[{type:E}],C=!0),C&&(g.split(g.mapping.map(c.pos),1,I),!A&&!c.parentOffset&&c.parent.type!=E)){var b=g.mapping.map(c.before()),N=g.doc.resolve(b);c.node(-1).canReplaceWith(N.index(),N.index()+1,E)&&g.setNodeMarkup(g.mapping.map(c.before()),E)}n(g.scrollIntoView())}return!0}function jj(o,n){var a=o.selection,c=a.$from,u=a.to,A,g=c.sharedDepth(u);return g==0?!1:(A=c.before(g),n&&n(o.tr.setSelection(ke.create(o.doc,A))),!0)}function Hj(o,n){return n&&n(o.tr.setSelection(new Ta(o.doc))),!0}function Kj(o,n,a){var c=n.nodeBefore,u=n.nodeAfter,A=n.index();return!c||!u||!c.type.compatibleContent(u.type)?!1:!c.content.size&&n.parent.canReplace(A-1,A)?(a&&a(o.tr.delete(n.pos-c.nodeSize,n.pos).scrollIntoView()),!0):!n.parent.canReplace(A,A+1)||!(u.isTextblock||vh(o.doc,n.pos))?!1:(a&&a(o.tr.clearIncompatible(n.pos,c.type,c.contentMatchAt(c.childCount)).join(n.pos).scrollIntoView()),!0)}function ek(o,n,a){var c=n.nodeBefore,u=n.nodeAfter,A,g;if(c.type.spec.isolating||u.type.spec.isolating)return!1;if(Kj(o,n,a))return!0;var E=n.parent.canReplace(n.index(),n.index()+1);if(E&&(A=(g=c.contentMatchAt(c.childCount)).findWrapping(u.type))&&g.matchType(A[0]||u.type).validEnd){if(a){for(var I=n.pos+u.nodeSize,C=bt.empty,b=A.length-1;b>=0;b--)C=bt.from(A[b].create(null,C));C=bt.from(c.copy(C));var N=o.tr.step(new to(n.pos-1,I,n.pos,I,new Kt(C,1,0),A.length,!0)),L=I+2*A.length;vh(N.doc,L)&&N.join(L),a(N.scrollIntoView())}return!0}var Q=De.findFrom(n,1),G=Q&&Q.$from.blockRange(Q.$to),Z=G&&Td(G);if(Z!=null&&Z>=n.depth)return a&&a(o.tr.lift(G,Z).scrollIntoView()),!0;if(E&&pd(u,"start",!0)&&pd(c,"end")){for(var dt=c,lt=[];lt.push(dt),!dt.isTextblock;)dt=dt.lastChild;for(var et=u,Dt=1;!et.isTextblock;et=et.firstChild)Dt++;if(dt.canReplace(dt.childCount,dt.childCount,et.content)){if(a){for(var J=bt.empty,Ft=lt.length-1;Ft>=0;Ft--)J=bt.from(lt[Ft].copy(J));var Ot=o.tr.step(new to(n.pos-lt.length,n.pos+u.nodeSize,n.pos+Dt,n.pos+u.nodeSize-Dt,new Kt(J,lt.length,0),0,!0));a(Ot.scrollIntoView())}return!0}}return!1}function rk(o){return function(n,a){for(var c=n.selection,u=o<0?c.$from:c.$to,A=u.depth;u.node(A).isInline;){if(!A)return!1;A--}return u.node(A).isTextblock?(a&&a(n.tr.setSelection(rr.create(n.doc,o<0?u.start(A):u.end(A)))),!0):!1}}var JI=rk(-1),zI=rk(1);function Wj(o,n){return function(a,c){var u=a.selection,A=u.$from,g=u.$to,E=A.blockRange(g),I=E&&VI(E,o,n);return I?(c&&c(a.tr.wrap(E,I).scrollIntoView()),!0):!1}}function qN(o,n){return function(a,c){var u=a.selection,A=u.from,g=u.to,E=!1;return a.doc.nodesBetween(A,g,function(I,C){if(E)return!1;if(!(!I.isTextblock||I.hasMarkup(o,n)))if(I.type==o)E=!0;else{var b=a.doc.resolve(C),N=b.index();E=b.parent.canReplaceWith(N,N+1,o)}}),E?(c&&c(a.tr.setBlockType(A,g,o,n).scrollIntoView()),!0):!1}}function XI(){for(var o=[],n=arguments.length;n--;)o[n]=arguments[n];return function(a,c,u){for(var A=0;A<o.length;A++)if(o[A](a,c,u))return!0;return!1}}var x_=XI(YI,K2,W2),JN=XI(YI,q2,J2),Ls={Enter:XI(X2,$2,tk,Gj),"Mod-Enter":Z2,Backspace:x_,"Mod-Backspace":x_,"Shift-Backspace":x_,Delete:JN,"Mod-Delete":JN,"Mod-a":Hj},Yj={"Ctrl-h":Ls.Backspace,"Alt-Backspace":Ls["Mod-Backspace"],"Ctrl-d":Ls.Delete,"Ctrl-Alt-Backspace":Ls["Mod-Delete"],"Alt-Delete":Ls["Mod-Delete"],"Alt-d":Ls["Mod-Delete"],"Ctrl-a":JI,"Ctrl-e":zI};for(var zN in Ls)Yj[zN]=Ls[zN];Ls.Home=JI;Ls.End=zI;typeof navigator!="undefined"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os!="undefined"&&os.platform()=="darwin";function qj(o,n){return function(a,c){var u=a.selection,A=u.$from,g=u.$to,E=A.blockRange(g),I=!1,C=E;if(!E)return!1;if(E.depth>=2&&A.node(E.depth-1).type.compatibleContent(o)&&E.startIndex==0){if(A.index(E.depth-1)==0)return!1;var b=a.doc.resolve(E.start-2);C=new sh(b,b,E.depth),E.endIndex<E.parent.childCount&&(E=new sh(A,a.doc.resolve(g.end(E.depth)),E.depth)),I=!0}var N=VI(C,o,n,E);return N?(c&&c(Jj(a.tr,E,N,I,o).scrollIntoView()),!0):!1}}function Jj(o,n,a,c,u){for(var A=bt.empty,g=a.length-1;g>=0;g--)A=bt.from(a[g].type.create(a[g].attrs,A));o.step(new to(n.start-(c?2:0),n.end,n.start,n.end,new Kt(A,0,0),a.length,!0));for(var E=0,I=0;I<a.length;I++)a[I].type==u&&(E=I+1);for(var C=a.length-E,b=n.start+a.length-(c?2:0),N=n.parent,L=n.startIndex,Q=n.endIndex,G=!0;L<Q;L++,G=!1)!G&&Ia(o.doc,b,C)&&(o.split(b,C),b+=2*C),b+=N.child(L).nodeSize;return o}function zj(o){return function(n,a){var c=n.selection,u=c.$from,A=c.$to,g=u.blockRange(A,function(E){return E.childCount&&E.firstChild.type==o});return g?a?u.node(g.depth-1).type==o?Xj(n,a,o,g):Zj(n,a,g):!0:!1}}function Xj(o,n,a,c){var u=o.tr,A=c.end,g=c.$to.end(c.depth);return A<g&&(u.step(new to(A-1,g,A,g,new Kt(bt.from(a.create(null,c.parent.copy())),1,0),1,!0)),c=new sh(u.doc.resolve(c.$from.pos),u.doc.resolve(g),c.depth)),n(u.lift(c,Td(c)).scrollIntoView()),!0}function Zj(o,n,a){for(var c=o.tr,u=a.parent,A=a.end,g=a.endIndex-1,E=a.startIndex;g>E;g--)A-=u.child(g).nodeSize,c.delete(A-1,A+1);var I=c.doc.resolve(a.start),C=I.nodeAfter;if(c.mapping.map(a.end)!=a.start+I.nodeAfter.nodeSize)return!1;var b=a.startIndex==0,N=a.endIndex==u.childCount,L=I.node(-1),Q=I.index(-1);if(!L.canReplace(Q+(b?0:1),Q+1,C.content.append(N?bt.empty:bt.from(u))))return!1;var G=I.pos,Z=G+C.nodeSize;return c.step(new to(G-(b?1:0),Z+(N?1:0),G+1,Z-1,new Kt((b?bt.empty:bt.from(u.copy(bt.empty))).append(N?bt.empty:bt.from(u.copy(bt.empty))),b?0:1,N?0:1),b?0:1)),n(c.scrollIntoView()),!0}function $j(o){return function(n,a){var c=n.selection,u=c.$from,A=c.$to,g=u.blockRange(A,function(Z){return Z.childCount&&Z.firstChild.type==o});if(!g)return!1;var E=g.startIndex;if(E==0)return!1;var I=g.parent,C=I.child(E-1);if(C.type!=o)return!1;if(a){var b=C.lastChild&&C.lastChild.type==I.type,N=bt.from(b?o.create():null),L=new Kt(bt.from(o.create(null,bt.from(I.type.create(null,N)))),b?3:1,0),Q=g.start,G=g.end;a(n.tr.step(new to(Q-(b?3:1),G,Q,G,L,1,!0)).scrollIntoView())}return!0}}var Bt={};if(typeof navigator!="undefined"&&typeof document!="undefined"){var F_=/Edge\/(\d+)/.exec(navigator.userAgent),XN=/MSIE \d/.test(navigator.userAgent),Q_=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),V_=Bt.ie=!!(XN||Q_||F_);Bt.ie_version=XN?document.documentMode||6:Q_?+Q_[1]:F_?+F_[1]:null,Bt.gecko=!V_&&/gecko\/(\d+)/i.test(navigator.userAgent),Bt.gecko_version=Bt.gecko&&+(/Firefox\/(\d+)/.exec(navigator.userAgent)||[0,0])[1];var G_=!V_&&/Chrome\/(\d+)/.exec(navigator.userAgent);Bt.chrome=!!G_,Bt.chrome_version=G_&&+G_[1],Bt.safari=!V_&&/Apple Computer/.test(navigator.vendor),Bt.ios=Bt.safari&&(/Mobile\/\w+/.test(navigator.userAgent)||navigator.maxTouchPoints>2),Bt.mac=Bt.ios||/Mac/.test(navigator.platform),Bt.android=/Android \d/.test(navigator.userAgent),Bt.webkit="webkitFontSmoothing"in document.documentElement.style,Bt.webkit_version=Bt.webkit&&+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]}var vo=function(o){for(var n=0;;n++)if(o=o.previousSibling,!o)return n},ZI=function(o){var n=o.assignedSlot||o.parentNode;return n&&n.nodeType==11?n.host:n},ZN=null,fa=function(o,n,a){var c=ZN||(ZN=document.createRange());return c.setEnd(o,a==null?o.nodeValue.length:a),c.setStart(o,n||0),c},uh=function(o,n,a,c){return a&&($N(o,n,a,c,-1)||$N(o,n,a,c,1))},tH=/^(img|br|input|textarea|hr)$/i;function $N(o,n,a,c,u){for(;;){if(o==a&&n==c)return!0;if(n==(u<0?0:Bs(o))){var A=o.parentNode;if(A.nodeType!=1||rH(o)||tH.test(o.nodeName)||o.contentEditable=="false")return!1;n=vo(o)+(u<0?0:1),o=A}else if(o.nodeType==1){if(o=o.childNodes[n+(u<0?-1:0)],o.contentEditable=="false")return!1;n=u<0?Bs(o):0}else return!1}}function Bs(o){return o.nodeType==3?o.nodeValue.length:o.childNodes.length}function eH(o,n,a){for(var c=n==0,u=n==Bs(o);c||u;){if(o==a)return!0;var A=vo(o);if(o=o.parentNode,!o)return!1;c=c&&A==0,u=u&&A==Bs(o)}}function rH(o){for(var n,a=o;a&&!(n=a.pmViewDesc);a=a.parentNode);return n&&n.node&&n.node.isBlock&&(n.dom==o||n.contentDOM==o)}var $I=function(o){var n=o.isCollapsed;return n&&Bt.chrome&&o.rangeCount&&!o.getRangeAt(0).collapsed&&(n=!1),n};function od(o,n){var a=document.createEvent("Event");return a.initEvent("keydown",!0,!0),a.keyCode=o,a.key=a.code=n,a}function nH(o){return{left:0,right:o.documentElement.clientWidth,top:0,bottom:o.documentElement.clientHeight}}function Wa(o,n){return typeof o=="number"?o:o[n]}function iH(o){var n=o.getBoundingClientRect(),a=n.width/o.offsetWidth||1,c=n.height/o.offsetHeight||1;return{left:n.left,right:n.left+o.clientWidth*a,top:n.top,bottom:n.top+o.clientHeight*c}}function tO(o,n,a){for(var c=o.someProp("scrollThreshold")||0,u=o.someProp("scrollMargin")||5,A=o.dom.ownerDocument,g=a||o.dom;g;g=ZI(g))if(g.nodeType==1){var E=g==A.body||g.nodeType!=1,I=E?nH(A):iH(g),C=0,b=0;if(n.top<I.top+Wa(c,"top")?b=-(I.top-n.top+Wa(u,"top")):n.bottom>I.bottom-Wa(c,"bottom")&&(b=n.bottom-I.bottom+Wa(u,"bottom")),n.left<I.left+Wa(c,"left")?C=-(I.left-n.left+Wa(u,"left")):n.right>I.right-Wa(c,"right")&&(C=n.right-I.right+Wa(u,"right")),C||b)if(E)A.defaultView.scrollBy(C,b);else{var N=g.scrollLeft,L=g.scrollTop;b&&(g.scrollTop+=b),C&&(g.scrollLeft+=C);var Q=g.scrollLeft-N,G=g.scrollTop-L;n={left:n.left-Q,top:n.top-G,right:n.right-Q,bottom:n.bottom-G}}if(E)break}}function oH(o){for(var n=o.dom.getBoundingClientRect(),a=Math.max(0,n.top),c,u,A=(n.left+n.right)/2,g=a+1;g<Math.min(innerHeight,n.bottom);g+=5){var E=o.root.elementFromPoint(A,g);if(!(E==o.dom||!o.dom.contains(E))){var I=E.getBoundingClientRect();if(I.top>=a-20){c=E,u=I.top;break}}}return{refDOM:c,refTop:u,stack:nk(o.dom)}}function nk(o){for(var n=[],a=o.ownerDocument;o&&(n.push({dom:o,top:o.scrollTop,left:o.scrollLeft}),o!=a);o=ZI(o));return n}function sH(o){var n=o.refDOM,a=o.refTop,c=o.stack,u=n?n.getBoundingClientRect().top:0;ik(c,u==0?0:u-a)}function ik(o,n){for(var a=0;a<o.length;a++){var c=o[a],u=c.dom,A=c.top,g=c.left;u.scrollTop!=A+n&&(u.scrollTop=A+n),u.scrollLeft!=g&&(u.scrollLeft=g)}}var nd=null;function aH(o){if(o.setActive)return o.setActive();if(nd)return o.focus(nd);var n=nk(o);o.focus(nd==null?{get preventScroll(){return nd={preventScroll:!0},!0}}:void 0),nd||(nd=!1,ik(n,0))}function ok(o,n){for(var a,c=2e8,u,A=0,g=n.top,E=n.top,I=o.firstChild,C=0;I;I=I.nextSibling,C++){var b=void 0;if(I.nodeType==1)b=I.getClientRects();else if(I.nodeType==3)b=fa(I).getClientRects();else continue;for(var N=0;N<b.length;N++){var L=b[N];if(L.top<=g&&L.bottom>=E){g=Math.max(L.bottom,g),E=Math.min(L.top,E);var Q=L.left>n.left?L.left-n.left:L.right<n.left?n.left-L.right:0;if(Q<c){a=I,c=Q,u=Q&&a.nodeType==3?{left:L.right<n.left?L.right:L.left,top:n.top}:n,I.nodeType==1&&Q&&(A=C+(n.left>=(L.left+L.right)/2?1:0));continue}}!a&&(n.left>=L.right&&n.top>=L.top||n.left>=L.left&&n.top>=L.bottom)&&(A=C+1)}}return a&&a.nodeType==3?cH(a,u):!a||c&&a.nodeType==1?{node:o,offset:A}:ok(a,u)}function cH(o,n){for(var a=o.nodeValue.length,c=document.createRange(),u=0;u<a;u++){c.setEnd(o,u+1),c.setStart(o,u);var A=Ya(c,1);if(A.top!=A.bottom&&tv(n,A))return{node:o,offset:u+(n.left>=(A.left+A.right)/2?1:0)}}return{node:o,offset:0}}function tv(o,n){return o.left>=n.left-1&&o.left<=n.right+1&&o.top>=n.top-1&&o.top<=n.bottom+1}function lH(o,n){var a=o.parentNode;return a&&/^li$/i.test(a.nodeName)&&n.left<o.getBoundingClientRect().left?a:o}function dH(o,n,a){var c=ok(n,a),u=c.node,A=c.offset,g=-1;if(u.nodeType==1&&!u.firstChild){var E=u.getBoundingClientRect();g=E.left!=E.right&&a.left>(E.left+E.right)/2?1:-1}return o.docView.posFromDOM(u,A,g)}function uH(o,n,a,c){for(var u=-1,A=n;A!=o.dom;){var g=o.docView.nearestDesc(A,!0);if(!g)return null;if(g.node.isBlock&&g.parent){var E=g.dom.getBoundingClientRect();if(E.left>c.left||E.top>c.top)u=g.posBefore;else if(E.right<c.left||E.bottom<c.top)u=g.posAfter;else break}A=g.dom.parentNode}return u>-1?u:o.docView.posFromDOM(n,a)}function sk(o,n,a){var c=o.childNodes.length;if(c&&a.top<a.bottom)for(var u=Math.max(0,Math.min(c-1,Math.floor(c*(n.top-a.top)/(a.bottom-a.top))-2)),A=u;;){var g=o.childNodes[A];if(g.nodeType==1)for(var E=g.getClientRects(),I=0;I<E.length;I++){var C=E[I];if(tv(n,C))return sk(g,n,C)}if((A=(A+1)%c)==u)break}return o}function hH(o,n){var a,c,u=o.dom.ownerDocument,A,g;if(u.caretPositionFromPoint)try{var E=u.caretPositionFromPoint(n.left,n.top);E&&(a=E,A=a.offsetNode,g=a.offset)}catch{}if(!A&&u.caretRangeFromPoint){var I=u.caretRangeFromPoint(n.left,n.top);I&&(c=I,A=c.startContainer,g=c.startOffset)}var C=(o.root.elementFromPoint?o.root:u).elementFromPoint(n.left,n.top+1),b;if(!C||!o.dom.contains(C.nodeType!=1?C.parentNode:C)){var N=o.dom.getBoundingClientRect();if(!tv(n,N)||(C=sk(o.dom,n,N),!C))return null}if(Bt.safari)for(var L=C;A&&L;L=ZI(L))L.draggable&&(A=g=null);if(C=lH(C,n),A){if(Bt.gecko&&A.nodeType==1&&(g=Math.min(g,A.childNodes.length),g<A.childNodes.length)){var Q=A.childNodes[g],G;Q.nodeName=="IMG"&&(G=Q.getBoundingClientRect()).right<=n.left&&G.bottom>n.top&&g++}A==o.dom&&g==A.childNodes.length-1&&A.lastChild.nodeType==1&&n.top>A.lastChild.getBoundingClientRect().bottom?b=o.state.doc.content.size:(g==0||A.nodeType!=1||A.childNodes[g-1].nodeName!="BR")&&(b=uH(o,A,g,n))}b==null&&(b=dH(o,C,n));var Z=o.docView.nearestDesc(C,!0);return{pos:b,inside:Z?Z.posAtStart-Z.border:-1}}function Ya(o,n){var a=o.getClientRects();return a.length?a[n<0?0:a.length-1]:o.getBoundingClientRect()}var pH=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function ak(o,n,a){var c=o.docView.domFromPos(n,a<0?-1:1),u=c.node,A=c.offset,g=Bt.webkit||Bt.gecko;if(u.nodeType==3)if(g&&(pH.test(u.nodeValue)||(a<0?!A:A==u.nodeValue.length))){var E=Ya(fa(u,A,A),a);if(Bt.gecko&&A&&/\s/.test(u.nodeValue[A-1])&&A<u.nodeValue.length){var I=Ya(fa(u,A-1,A-1),-1);if(I.top==E.top){var C=Ya(fa(u,A,A+1),-1);if(C.top!=E.top)return Hu(C,C.left<I.left)}}return E}else{var b=A,N=A,L=a<0?1:-1;return a<0&&!A?(N++,L=-1):a>=0&&A==u.nodeValue.length?(b--,L=1):a<0?b--:N++,Hu(Ya(fa(u,b,N),L),L<0)}if(!o.state.doc.resolve(n).parent.inlineContent){if(A&&(a<0||A==Bs(u))){var Q=u.childNodes[A-1];if(Q.nodeType==1)return j_(Q.getBoundingClientRect(),!1)}if(A<Bs(u)){var G=u.childNodes[A];if(G.nodeType==1)return j_(G.getBoundingClientRect(),!0)}return j_(u.getBoundingClientRect(),a>=0)}if(A&&(a<0||A==Bs(u))){var Z=u.childNodes[A-1],dt=Z.nodeType==3?fa(Z,Bs(Z)-(g?0:1)):Z.nodeType==1&&(Z.nodeName!="BR"||!Z.nextSibling)?Z:null;if(dt)return Hu(Ya(dt,1),!1)}if(A<Bs(u)){for(var lt=u.childNodes[A];lt.pmViewDesc&&lt.pmViewDesc.ignoreForCoords;)lt=lt.nextSibling;var et=lt?lt.nodeType==3?fa(lt,0,g?0:1):lt.nodeType==1?lt:null:null;if(et)return Hu(Ya(et,-1),!0)}return Hu(Ya(u.nodeType==3?fa(u):u,-a),a>=0)}function Hu(o,n){if(o.width==0)return o;var a=n?o.left:o.right;return{top:o.top,bottom:o.bottom,left:a,right:a}}function j_(o,n){if(o.height==0)return o;var a=n?o.top:o.bottom;return{top:a,bottom:a,left:o.left,right:o.right}}function ck(o,n,a){var c=o.state,u=o.root.activeElement;c!=n&&o.updateState(n),u!=o.dom&&o.focus();try{return a()}finally{c!=n&&o.updateState(c),u!=o.dom&&u&&u.focus()}}function AH(o,n,a){var c=n.selection,u=a=="up"?c.$from:c.$to;return ck(o,n,function(){for(var A=o.docView.domFromPos(u.pos,a=="up"?-1:1),g=A.node;;){var E=o.docView.nearestDesc(g,!0);if(!E)break;if(E.node.isBlock){g=E.dom;break}g=E.dom.parentNode}for(var I=ak(o,u.pos,1),C=g.firstChild;C;C=C.nextSibling){var b=void 0;if(C.nodeType==1)b=C.getClientRects();else if(C.nodeType==3)b=fa(C,0,C.nodeValue.length).getClientRects();else continue;for(var N=0;N<b.length;N++){var L=b[N];if(L.bottom>L.top+1&&(a=="up"?I.top-L.top>(L.bottom-I.top)*2:L.bottom-I.bottom>(I.bottom-L.top)*2))return!1}}return!0})}var fH=/[\u0590-\u08ac]/;function gH(o,n,a){var c=n.selection,u=c.$head;if(!u.parent.isTextblock)return!1;var A=u.parentOffset,g=!A,E=A==u.parent.content.size,I=o.root.getSelection();return!fH.test(u.parent.textContent)||!I.modify?a=="left"||a=="backward"?g:E:ck(o,n,function(){var C=I.getRangeAt(0),b=I.focusNode,N=I.focusOffset,L=I.caretBidiLevel;I.modify("move",a,"character");var Q=u.depth?o.docView.domAfterPos(u.before()):o.dom,G=!Q.contains(I.focusNode.nodeType==1?I.focusNode:I.focusNode.parentNode)||b==I.focusNode&&N==I.focusOffset;return I.removeAllRanges(),I.addRange(C),L!=null&&(I.caretBidiLevel=L),G})}var eO=null,rO=null,nO=!1;function mH(o,n,a){return eO==n&&rO==a?nO:(eO=n,rO=a,nO=a=="up"||a=="down"?AH(o,n,a):gH(o,n,a))}var ps=0,lk=1,Zu=2,va=3,Qr=function(n,a,c,u){this.parent=n,this.children=a,this.dom=c,c.pmViewDesc=this,this.contentDOM=u,this.dirty=ps},Qs={size:{configurable:!0},border:{configurable:!0},posBefore:{configurable:!0},posAtStart:{configurable:!0},posAfter:{configurable:!0},posAtEnd:{configurable:!0},contentLost:{configurable:!0},domAtom:{configurable:!0},ignoreForCoords:{configurable:!0}};Qr.prototype.matchesWidget=function(){return!1};Qr.prototype.matchesMark=function(){return!1};Qr.prototype.matchesNode=function(){return!1};Qr.prototype.matchesHack=function(n){return!1};Qr.prototype.parseRule=function(){return null};Qr.prototype.stopEvent=function(){return!1};Qs.size.get=function(){for(var o=0,n=0;n<this.children.length;n++)o+=this.children[n].size;return o};Qs.border.get=function(){return 0};Qr.prototype.destroy=function(){this.parent=null,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=null);for(var n=0;n<this.children.length;n++)this.children[n].destroy()};Qr.prototype.posBeforeChild=function(n){for(var a=0,c=this.posAtStart;a<this.children.length;a++){var u=this.children[a];if(u==n)return c;c+=u.size}};Qs.posBefore.get=function(){return this.parent.posBeforeChild(this)};Qs.posAtStart.get=function(){return this.parent?this.parent.posBeforeChild(this)+this.border:0};Qs.posAfter.get=function(){return this.posBefore+this.size};Qs.posAtEnd.get=function(){return this.posAtStart+this.size-2*this.border};Qr.prototype.localPosFromDOM=function(n,a,c){if(this.contentDOM&&this.contentDOM.contains(n.nodeType==1?n:n.parentNode))if(c<0){var u,A;if(n==this.contentDOM)u=n.childNodes[a-1];else{for(;n.parentNode!=this.contentDOM;)n=n.parentNode;u=n.previousSibling}for(;u&&!((A=u.pmViewDesc)&&A.parent==this);)u=u.previousSibling;return u?this.posBeforeChild(A)+A.size:this.posAtStart}else{var g,E;if(n==this.contentDOM)g=n.childNodes[a];else{for(;n.parentNode!=this.contentDOM;)n=n.parentNode;g=n.nextSibling}for(;g&&!((E=g.pmViewDesc)&&E.parent==this);)g=g.nextSibling;return g?this.posBeforeChild(E):this.posAtEnd}var I;if(n==this.dom&&this.contentDOM)I=a>vo(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))I=n.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(a==0)for(var C=n;;C=C.parentNode){if(C==this.dom){I=!1;break}if(C.parentNode.firstChild!=C)break}if(I==null&&a==n.childNodes.length)for(var b=n;;b=b.parentNode){if(b==this.dom){I=!0;break}if(b.parentNode.lastChild!=b)break}}return(I==null?c>0:I)?this.posAtEnd:this.posAtStart};Qr.prototype.nearestDesc=function(n,a){for(var c=!0,u=n;u;u=u.parentNode){var A=this.getDesc(u);if(A&&(!a||A.node))if(c&&A.nodeDOM&&!(A.nodeDOM.nodeType==1?A.nodeDOM.contains(n.nodeType==1?n:n.parentNode):A.nodeDOM==n))c=!1;else return A}};Qr.prototype.getDesc=function(n){for(var a=n.pmViewDesc,c=a;c;c=c.parent)if(c==this)return a};Qr.prototype.posFromDOM=function(n,a,c){for(var u=n;u;u=u.parentNode){var A=this.getDesc(u);if(A)return A.localPosFromDOM(n,a,c)}return-1};Qr.prototype.descAt=function(n){for(var a=0,c=0;a<this.children.length;a++){var u=this.children[a],A=c+u.size;if(c==n&&A!=c){for(;!u.border&&u.children.length;)u=u.children[0];return u}if(n<A)return u.descAt(n-c-u.border);c=A}};Qr.prototype.domFromPos=function(n,a){if(!this.contentDOM)return{node:this.dom,offset:0};for(var c=0,u=0,A=0;c<this.children.length;c++){var g=this.children[c],E=A+g.size;if(E>n||g instanceof pk){u=n-A;break}A=E}if(u)return this.children[c].domFromPos(u-this.children[c].border,a);for(var I=void 0;c&&!(I=this.children[c-1]).size&&I instanceof dk&&I.widget.type.side>=0;c--);if(a<=0){for(var C,b=!0;C=c?this.children[c-1]:null,!(!C||C.dom.parentNode==this.contentDOM);c--,b=!1);return C&&a&&b&&!C.border&&!C.domAtom?C.domFromPos(C.size,a):{node:this.contentDOM,offset:C?vo(C.dom)+1:0}}else{for(var N,L=!0;N=c<this.children.length?this.children[c]:null,!(!N||N.dom.parentNode==this.contentDOM);c++,L=!1);return N&&L&&!N.border&&!N.domAtom?N.domFromPos(0,a):{node:this.contentDOM,offset:N?vo(N.dom):this.contentDOM.childNodes.length}}};Qr.prototype.parseRange=function(n,a,c){if(c===void 0&&(c=0),this.children.length==0)return{node:this.contentDOM,from:n,to:a,fromOffset:0,toOffset:this.contentDOM.childNodes.length};for(var u=-1,A=-1,g=c,E=0;;E++){var I=this.children[E],C=g+I.size;if(u==-1&&n<=C){var b=g+I.border;if(n>=b&&a<=C-I.border&&I.node&&I.contentDOM&&this.contentDOM.contains(I.contentDOM))return I.parseRange(n,a,b);n=g;for(var N=E;N>0;N--){var L=this.children[N-1];if(L.size&&L.dom.parentNode==this.contentDOM&&!L.emptyChildAt(1)){u=vo(L.dom)+1;break}n-=L.size}u==-1&&(u=0)}if(u>-1&&(C>a||E==this.children.length-1)){a=C;for(var Q=E+1;Q<this.children.length;Q++){var G=this.children[Q];if(G.size&&G.dom.parentNode==this.contentDOM&&!G.emptyChildAt(-1)){A=vo(G.dom);break}a+=G.size}A==-1&&(A=this.contentDOM.childNodes.length);break}g=C}return{node:this.contentDOM,from:n,to:a,fromOffset:u,toOffset:A}};Qr.prototype.emptyChildAt=function(n){if(this.border||!this.contentDOM||!this.children.length)return!1;var a=this.children[n<0?0:this.children.length-1];return a.size==0||a.emptyChildAt(n)};Qr.prototype.domAfterPos=function(n){var a=this.domFromPos(n,0),c=a.node,u=a.offset;if(c.nodeType!=1||u==c.childNodes.length)throw new RangeError("No node after pos "+n);return c.childNodes[u]};Qr.prototype.setSelection=function(n,a,c,u){for(var A=Math.min(n,a),g=Math.max(n,a),E=0,I=0;E<this.children.length;E++){var C=this.children[E],b=I+C.size;if(A>I&&g<b)return C.setSelection(n-I-C.border,a-I-C.border,c,u);I=b}var N=this.domFromPos(n,n?-1:1),L=a==n?N:this.domFromPos(a,a?-1:1),Q=c.getSelection(),G=!1;if((Bt.gecko||Bt.safari)&&n==a){var Z=N.node,dt=N.offset;if(Z.nodeType==3){if(G=dt&&Z.nodeValue[dt-1]==`
`,G&&dt==Z.nodeValue.length)for(var lt=Z,et=void 0;lt;lt=lt.parentNode){if(et=lt.nextSibling){et.nodeName=="BR"&&(N=L={node:et.parentNode,offset:vo(et)+1});break}var Dt=lt.pmViewDesc;if(Dt&&Dt.node&&Dt.node.isBlock)break}}else{var J=Z.childNodes[dt-1];G=J&&(J.nodeName=="BR"||J.contentEditable=="false")}}if(Bt.gecko&&Q.focusNode&&Q.focusNode!=L.node&&Q.focusNode.nodeType==1){var Ft=Q.focusNode.childNodes[Q.focusOffset];Ft&&Ft.contentEditable=="false"&&(u=!0)}if(!(!(u||G&&Bt.safari)&&uh(N.node,N.offset,Q.anchorNode,Q.anchorOffset)&&uh(L.node,L.offset,Q.focusNode,Q.focusOffset))){var Ot=!1;if((Q.extend||n==a)&&!G){Q.collapse(N.node,N.offset);try{n!=a&&Q.extend(L.node,L.offset),Ot=!0}catch(he){if(!(he instanceof DOMException))throw he}}if(!Ot){if(n>a){var ce=N;N=L,L=ce}var ge=document.createRange();ge.setEnd(L.node,L.offset),ge.setStart(N.node,N.offset),Q.removeAllRanges(),Q.addRange(ge)}}};Qr.prototype.ignoreMutation=function(n){return!this.contentDOM&&n.type!="selection"};Qs.contentLost.get=function(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)};Qr.prototype.markDirty=function(n,a){for(var c=0,u=0;u<this.children.length;u++){var A=this.children[u],g=c+A.size;if(c==g?n<=g&&a>=c:n<g&&a>c){var E=c+A.border,I=g-A.border;if(n>=E&&a<=I){this.dirty=n==c||a==g?Zu:lk,n==E&&a==I&&(A.contentLost||A.dom.parentNode!=this.contentDOM)?A.dirty=va:A.markDirty(n-E,a-E);return}else A.dirty=A.dom==A.contentDOM&&A.dom.parentNode==this.contentDOM&&!A.children.length?Zu:va}c=g}this.dirty=Zu};Qr.prototype.markParentsDirty=function(){for(var n=1,a=this.parent;a;a=a.parent,n++){var c=n==1?Zu:lk;a.dirty<c&&(a.dirty=c)}};Qs.domAtom.get=function(){return!1};Qs.ignoreForCoords.get=function(){return!1};Object.defineProperties(Qr.prototype,Qs);var Za=[],dk=function(o){function n(c,u,A,g){var E,I=u.type.toDOM;if(typeof I=="function"&&(I=I(A,function(){if(!E)return g;if(E.parent)return E.parent.posBeforeChild(E)})),!u.type.spec.raw){if(I.nodeType!=1){var C=document.createElement("span");C.appendChild(I),I=C}I.contentEditable=!1,I.classList.add("ProseMirror-widget")}o.call(this,c,Za,I,null),this.widget=u,E=this}o&&(n.__proto__=o),n.prototype=Object.create(o&&o.prototype),n.prototype.constructor=n;var a={domAtom:{configurable:!0}};return n.prototype.matchesWidget=function(u){return this.dirty==ps&&u.type.eq(this.widget.type)},n.prototype.parseRule=function(){return{ignore:!0}},n.prototype.stopEvent=function(u){var A=this.widget.spec.stopEvent;return A?A(u):!1},n.prototype.ignoreMutation=function(u){return u.type!="selection"||this.widget.spec.ignoreSelection},n.prototype.destroy=function(){this.widget.type.destroy(this.dom),o.prototype.destroy.call(this)},a.domAtom.get=function(){return!0},Object.defineProperties(n.prototype,a),n}(Qr),EH=function(o){function n(c,u,A,g){o.call(this,c,Za,u,null),this.textDOM=A,this.text=g}o&&(n.__proto__=o),n.prototype=Object.create(o&&o.prototype),n.prototype.constructor=n;var a={size:{configurable:!0}};return a.size.get=function(){return this.text.length},n.prototype.localPosFromDOM=function(u,A){return u!=this.textDOM?this.posAtStart+(A?this.size:0):this.posAtStart+A},n.prototype.domFromPos=function(u){return{node:this.textDOM,offset:u}},n.prototype.ignoreMutation=function(u){return u.type==="characterData"&&u.target.nodeValue==u.oldValue},Object.defineProperties(n.prototype,a),n}(Qr),yf=function(o){function n(a,c,u,A){o.call(this,a,[],u,A),this.mark=c}return o&&(n.__proto__=o),n.prototype=Object.create(o&&o.prototype),n.prototype.constructor=n,n.create=function(c,u,A,g){var E=g.nodeViews[u.type.name],I=E&&E(u,g,A);return(!I||!I.dom)&&(I=ai.renderSpec(document,u.type.spec.toDOM(u,A))),new n(c,u,I.dom,I.contentDOM||I.dom)},n.prototype.parseRule=function(){return this.dirty&va||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}},n.prototype.matchesMark=function(c){return this.dirty!=va&&this.mark.eq(c)},n.prototype.markDirty=function(c,u){if(o.prototype.markDirty.call(this,c,u),this.dirty!=ps){for(var A=this.parent;!A.node;)A=A.parent;A.dirty<this.dirty&&(A.dirty=this.dirty),this.dirty=ps}},n.prototype.slice=function(c,u,A){var g=n.create(this.parent,this.mark,!0,A),E=this.children,I=this.size;u<I&&(E=mI(E,u,I,A)),c>0&&(E=mI(E,0,c,A));for(var C=0;C<E.length;C++)E[C].parent=g;return g.children=E,g},n}(Qr),Th=function(o){function n(c,u,A,g,E,I,C,b,N){o.call(this,c,u.isLeaf?Za:[],E,I),this.nodeDOM=C,this.node=u,this.outerDeco=A,this.innerDeco=g,I&&this.updateChildren(b,N)}o&&(n.__proto__=o),n.prototype=Object.create(o&&o.prototype),n.prototype.constructor=n;var a={size:{configurable:!0},border:{configurable:!0},domAtom:{configurable:!0}};return n.create=function(u,A,g,E,I,C){var b,N=I.nodeViews[A.type.name],L,Q=N&&N(A,I,function(){if(!L)return C;if(L.parent)return L.parent.posBeforeChild(L)},g,E),G=Q&&Q.dom,Z=Q&&Q.contentDOM;if(A.isText){if(!G)G=document.createTextNode(A.text);else if(G.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else G||(b=ai.renderSpec(document,A.type.spec.toDOM(A)),G=b.dom,Z=b.contentDOM);!Z&&!A.isText&&G.nodeName!="BR"&&(G.hasAttribute("contenteditable")||(G.contentEditable=!1),A.type.spec.draggable&&(G.draggable=!0));var dt=G;return G=gk(G,g,A),Q?L=new _H(u,A,g,E,G,Z,dt,Q,I,C+1):A.isText?new hk(u,A,g,E,G,dt,I):new n(u,A,g,E,G,Z,dt,I,C+1)},n.prototype.parseRule=function(){var u=this;if(this.node.type.spec.reparseInView)return null;var A={node:this.node.type.name,attrs:this.node.attrs};return this.node.type.whitespace=="pre"&&(A.preserveWhitespace="full"),this.contentDOM&&!this.contentLost?A.contentElement=this.contentDOM:A.getContent=function(){return u.contentDOM?bt.empty:u.node.content},A},n.prototype.matchesNode=function(u,A,g){return this.dirty==ps&&u.eq(this.node)&&gI(A,this.outerDeco)&&g.eq(this.innerDeco)},a.size.get=function(){return this.node.nodeSize},a.border.get=function(){return this.node.isLeaf?0:1},n.prototype.updateChildren=function(u,A){var g=this,E=this.node.inlineContent,I=A,C=u.composing&&this.localCompositionInfo(u,A),b=C&&C.pos>-1?C:null,N=C&&C.pos<0,L=new qo(this,b&&b.node);SH(this.node,this.innerDeco,function(Q,G,Z){Q.spec.marks?L.syncToMarks(Q.spec.marks,E,u):Q.type.side>=0&&!Z&&L.syncToMarks(G==g.node.childCount?ir.none:g.node.child(G).marks,E,u),L.placeWidget(Q,u,I)},function(Q,G,Z,dt){L.syncToMarks(Q.marks,E,u);var lt;L.findNodeMatch(Q,G,Z,dt)||N&&u.state.selection.from>I&&u.state.selection.to<I+Q.nodeSize&&(lt=L.findIndexWithChild(C.node))>-1&&L.updateNodeAt(Q,G,Z,lt,u)||L.updateNextNode(Q,G,Z,u,dt)||L.addNode(Q,G,Z,u,I),I+=Q.nodeSize}),L.syncToMarks(Za,E,u),this.node.isTextblock&&L.addTextblockHacks(),L.destroyRest(),(L.changed||this.dirty==Zu)&&(b&&this.protectLocalComposition(u,b),Ak(this.contentDOM,this.children,u),Bt.ios&&TH(this.dom))},n.prototype.localCompositionInfo=function(u,A){var g=u.state.selection,E=g.from,I=g.to;if(!(!(u.state.selection instanceof rr)||E<A||I>A+this.node.content.size)){var C=u.root.getSelection(),b=RH(C.focusNode,C.focusOffset);if(!(!b||!this.dom.contains(b.parentNode)))if(this.node.inlineContent){var N=b.nodeValue,L=yH(this.node.content,N,E-A,I-A);return L<0?null:{node:b,pos:L,text:N}}else return{node:b,pos:-1}}},n.prototype.protectLocalComposition=function(u,A){var g=A.node,E=A.pos,I=A.text;if(!this.getDesc(g)){for(var C=g;C.parentNode!=this.contentDOM;C=C.parentNode){for(;C.previousSibling;)C.parentNode.removeChild(C.previousSibling);for(;C.nextSibling;)C.parentNode.removeChild(C.nextSibling);C.pmViewDesc&&(C.pmViewDesc=null)}var b=new EH(this,C,g,I);u.compositionNodes.push(b),this.children=mI(this.children,E,E+I.length,u,b)}},n.prototype.update=function(u,A,g,E){return this.dirty==va||!u.sameMarkup(this.node)?!1:(this.updateInner(u,A,g,E),!0)},n.prototype.updateInner=function(u,A,g,E){this.updateOuterDeco(A),this.node=u,this.innerDeco=g,this.contentDOM&&this.updateChildren(E,this.posAtStart),this.dirty=ps},n.prototype.updateOuterDeco=function(u){if(!gI(u,this.outerDeco)){var A=this.nodeDOM.nodeType!=1,g=this.dom;this.dom=fk(this.dom,this.nodeDOM,fI(this.outerDeco,this.node,A),fI(u,this.node,A)),this.dom!=g&&(g.pmViewDesc=null,this.dom.pmViewDesc=this),this.outerDeco=u}},n.prototype.selectNode=function(){this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.dom.draggable=!0)},n.prototype.deselectNode=function(){this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.dom.removeAttribute("draggable")},a.domAtom.get=function(){return this.node.isAtom},Object.defineProperties(n.prototype,a),n}(Qr);function uk(o,n,a,c,u){return gk(c,n,o),new Th(null,o,n,a,c,c,c,u,0)}var hk=function(o){function n(c,u,A,g,E,I,C){o.call(this,c,u,A,g,E,null,I,C)}o&&(n.__proto__=o),n.prototype=Object.create(o&&o.prototype),n.prototype.constructor=n;var a={domAtom:{configurable:!0}};return n.prototype.parseRule=function(){for(var u=this.nodeDOM.parentNode;u&&u!=this.dom&&!u.pmIsDeco;)u=u.parentNode;return{skip:u||!0}},n.prototype.update=function(u,A,g,E){return this.dirty==va||this.dirty!=ps&&!this.inParent()||!u.sameMarkup(this.node)?!1:(this.updateOuterDeco(A),(this.dirty!=ps||u.text!=this.node.text)&&u.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=u.text,E.trackWrites==this.nodeDOM&&(E.trackWrites=null)),this.node=u,this.dirty=ps,!0)},n.prototype.inParent=function(){for(var u=this.parent.contentDOM,A=this.nodeDOM;A;A=A.parentNode)if(A==u)return!0;return!1},n.prototype.domFromPos=function(u){return{node:this.nodeDOM,offset:u}},n.prototype.localPosFromDOM=function(u,A,g){return u==this.nodeDOM?this.posAtStart+Math.min(A,this.node.text.length):o.prototype.localPosFromDOM.call(this,u,A,g)},n.prototype.ignoreMutation=function(u){return u.type!="characterData"&&u.type!="selection"},n.prototype.slice=function(u,A,g){var E=this.node.cut(u,A),I=document.createTextNode(E.text);return new n(this.parent,E,this.outerDeco,this.innerDeco,I,I,g)},n.prototype.markDirty=function(u,A){o.prototype.markDirty.call(this,u,A),this.dom!=this.nodeDOM&&(u==0||A==this.nodeDOM.nodeValue.length)&&(this.dirty=va)},a.domAtom.get=function(){return!1},Object.defineProperties(n.prototype,a),n}(Th),pk=function(o){function n(){o.apply(this,arguments)}o&&(n.__proto__=o),n.prototype=Object.create(o&&o.prototype),n.prototype.constructor=n;var a={domAtom:{configurable:!0},ignoreForCoords:{configurable:!0}};return n.prototype.parseRule=function(){return{ignore:!0}},n.prototype.matchesHack=function(u){return this.dirty==ps&&this.dom.nodeName==u},a.domAtom.get=function(){return!0},a.ignoreForCoords.get=function(){return this.dom.nodeName=="IMG"},Object.defineProperties(n.prototype,a),n}(Qr),_H=function(o){function n(a,c,u,A,g,E,I,C,b,N){o.call(this,a,c,u,A,g,E,I,b,N),this.spec=C}return o&&(n.__proto__=o),n.prototype=Object.create(o&&o.prototype),n.prototype.constructor=n,n.prototype.update=function(c,u,A,g){if(this.dirty==va)return!1;if(this.spec.update){var E=this.spec.update(c,u,A);return E&&this.updateInner(c,u,A,g),E}else return!this.contentDOM&&!c.isLeaf?!1:o.prototype.update.call(this,c,u,A,g)},n.prototype.selectNode=function(){this.spec.selectNode?this.spec.selectNode():o.prototype.selectNode.call(this)},n.prototype.deselectNode=function(){this.spec.deselectNode?this.spec.deselectNode():o.prototype.deselectNode.call(this)},n.prototype.setSelection=function(c,u,A,g){this.spec.setSelection?this.spec.setSelection(c,u,A):o.prototype.setSelection.call(this,c,u,A,g)},n.prototype.destroy=function(){this.spec.destroy&&this.spec.destroy(),o.prototype.destroy.call(this)},n.prototype.stopEvent=function(c){return this.spec.stopEvent?this.spec.stopEvent(c):!1},n.prototype.ignoreMutation=function(c){return this.spec.ignoreMutation?this.spec.ignoreMutation(c):o.prototype.ignoreMutation.call(this,c)},n}(Th);function Ak(o,n,a){for(var c=o.firstChild,u=!1,A=0;A<n.length;A++){var g=n[A],E=g.dom;if(E.parentNode==o){for(;E!=c;)c=iO(c),u=!0;c=c.nextSibling}else u=!0,o.insertBefore(E,c);if(g instanceof yf){var I=c?c.previousSibling:o.lastChild;Ak(g.contentDOM,g.children,a),c=I?I.nextSibling:o.firstChild}}for(;c;)c=iO(c),u=!0;u&&a.trackWrites==o&&(a.trackWrites=null)}function $u(o){o&&(this.nodeName=o)}$u.prototype=Object.create(null);var Fc=[new $u];function fI(o,n,a){if(o.length==0)return Fc;for(var c=a?Fc[0]:new $u,u=[c],A=0;A<o.length;A++){var g=o[A].type.attrs;if(!!g){g.nodeName&&u.push(c=new $u(g.nodeName));for(var E in g){var I=g[E];I!=null&&(a&&u.length==1&&u.push(c=new $u(n.isInline?"span":"div")),E=="class"?c.class=(c.class?c.class+" ":"")+I:E=="style"?c.style=(c.style?c.style+";":"")+I:E!="nodeName"&&(c[E]=I))}}}return u}function fk(o,n,a,c){if(a==Fc&&c==Fc)return n;for(var u=n,A=0;A<c.length;A++){var g=c[A],E=a[A];if(A){var I=void 0;E&&E.nodeName==g.nodeName&&u!=o&&(I=u.parentNode)&&I.tagName.toLowerCase()==g.nodeName||(I=document.createElement(g.nodeName),I.pmIsDeco=!0,I.appendChild(u),E=Fc[0]),u=I}IH(u,E||Fc[0],g)}return u}function IH(o,n,a){for(var c in n)c!="class"&&c!="style"&&c!="nodeName"&&!(c in a)&&o.removeAttribute(c);for(var u in a)u!="class"&&u!="style"&&u!="nodeName"&&a[u]!=n[u]&&o.setAttribute(u,a[u]);if(n.class!=a.class){for(var A=n.class?n.class.split(" ").filter(Boolean):Za,g=a.class?a.class.split(" ").filter(Boolean):Za,E=0;E<A.length;E++)g.indexOf(A[E])==-1&&o.classList.remove(A[E]);for(var I=0;I<g.length;I++)A.indexOf(g[I])==-1&&o.classList.add(g[I]);o.classList.length==0&&o.removeAttribute("class")}if(n.style!=a.style){if(n.style)for(var C=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,b;b=C.exec(n.style);)o.style.removeProperty(b[1]);a.style&&(o.style.cssText+=a.style)}}function gk(o,n,a){return fk(o,o,Fc,fI(n,a,o.nodeType!=1))}function gI(o,n){if(o.length!=n.length)return!1;for(var a=0;a<o.length;a++)if(!o[a].type.eq(n[a].type))return!1;return!0}function iO(o){var n=o.nextSibling;return o.parentNode.removeChild(o),n}var qo=function(n,a){this.top=n,this.lock=a,this.index=0,this.stack=[],this.changed=!1,this.preMatch=vH(n.node.content,n)};qo.prototype.destroyBetween=function(n,a){if(n!=a){for(var c=n;c<a;c++)this.top.children[c].destroy();this.top.children.splice(n,a-n),this.changed=!0}};qo.prototype.destroyRest=function(){this.destroyBetween(this.index,this.top.children.length)};qo.prototype.syncToMarks=function(n,a,c){for(var u=0,A=this.stack.length>>1,g=Math.min(A,n.length);u<g&&(u==A-1?this.top:this.stack[u+1<<1]).matchesMark(n[u])&&n[u].type.spec.spanning!==!1;)u++;for(;u<A;)this.destroyRest(),this.top.dirty=ps,this.index=this.stack.pop(),this.top=this.stack.pop(),A--;for(;A<n.length;){this.stack.push(this.top,this.index+1);for(var E=-1,I=this.index;I<Math.min(this.index+3,this.top.children.length);I++)if(this.top.children[I].matchesMark(n[A])){E=I;break}if(E>-1)E>this.index&&(this.changed=!0,this.destroyBetween(this.index,E)),this.top=this.top.children[this.index];else{var C=yf.create(this.top,n[A],a,c);this.top.children.splice(this.index,0,C),this.top=C,this.changed=!0}this.index=0,A++}};qo.prototype.findNodeMatch=function(n,a,c,u){var A=-1,g;if(u>=this.preMatch.index&&(g=this.preMatch.matches[u-this.preMatch.index]).parent==this.top&&g.matchesNode(n,a,c))A=this.top.children.indexOf(g,this.index);else for(var E=this.index,I=Math.min(this.top.children.length,E+5);E<I;E++){var C=this.top.children[E];if(C.matchesNode(n,a,c)&&!this.preMatch.matched.has(C)){A=E;break}}return A<0?!1:(this.destroyBetween(this.index,A),this.index++,!0)};qo.prototype.updateNodeAt=function(n,a,c,u,A){var g=this.top.children[u];return g.update(n,a,c,A)?(this.destroyBetween(this.index,u),this.index=u+1,!0):!1};qo.prototype.findIndexWithChild=function(n){for(;;){var a=n.parentNode;if(!a)return-1;if(a==this.top.contentDOM){var c=n.pmViewDesc;if(c){for(var u=this.index;u<this.top.children.length;u++)if(this.top.children[u]==c)return u}return-1}n=a}};qo.prototype.updateNextNode=function(n,a,c,u,A){for(var g=this.index;g<this.top.children.length;g++){var E=this.top.children[g];if(E instanceof Th){var I=this.preMatch.matched.get(E);if(I!=null&&I!=A)return!1;var C=E.dom,b=this.lock&&(C==this.lock||C.nodeType==1&&C.contains(this.lock.parentNode))&&!(n.isText&&E.node&&E.node.isText&&E.nodeDOM.nodeValue==n.text&&E.dirty!=va&&gI(a,E.outerDeco));if(!b&&E.update(n,a,c,u))return this.destroyBetween(this.index,g),E.dom!=C&&(this.changed=!0),this.index++,!0;break}}return!1};qo.prototype.addNode=function(n,a,c,u,A){this.top.children.splice(this.index++,0,Th.create(this.top,n,a,c,u,A)),this.changed=!0};qo.prototype.placeWidget=function(n,a,c){var u=this.index<this.top.children.length?this.top.children[this.index]:null;if(u&&u.matchesWidget(n)&&(n==u.widget||!u.widget.type.toDOM.parentNode))this.index++;else{var A=new dk(this.top,n,a,c);this.top.children.splice(this.index++,0,A),this.changed=!0}};qo.prototype.addTextblockHacks=function(){for(var n=this.top.children[this.index-1];n instanceof yf;)n=n.children[n.children.length-1];(!n||!(n instanceof hk)||/\n$/.test(n.node.text))&&((Bt.safari||Bt.chrome)&&n&&n.dom.contentEditable=="false"&&this.addHackNode("IMG"),this.addHackNode("BR"))};qo.prototype.addHackNode=function(n){if(this.index<this.top.children.length&&this.top.children[this.index].matchesHack(n))this.index++;else{var a=document.createElement(n);n=="IMG"&&(a.className="ProseMirror-separator"),n=="BR"&&(a.className="ProseMirror-trailingBreak"),this.top.children.splice(this.index++,0,new pk(this.top,Za,a,null)),this.changed=!0}};function vH(o,n){var a=n,c=a.children.length,u=o.childCount,A=new Map,g=[];t:for(;u>0;){for(var E=void 0;;)if(c){var I=a.children[c-1];if(I instanceof yf)a=I,c=I.children.length;else{E=I,c--;break}}else{if(a==n)break t;c=a.parent.children.indexOf(a),a=a.parent}var C=E.node;if(!!C){if(C!=o.child(u-1))break;--u,A.set(E,u),g.push(E)}}return{index:u,matched:A,matches:g.reverse()}}function CH(o,n){return o.type.side-n.type.side}function SH(o,n,a,c){var u=n.locals(o),A=0;if(u.length==0){for(var g=0;g<o.childCount;g++){var E=o.child(g);c(E,u,n.forChild(A,E),g),A+=E.nodeSize}return}for(var I=0,C=[],b=null,N=0;;){if(I<u.length&&u[I].to==A){for(var L=u[I++],Q=void 0;I<u.length&&u[I].to==A;)(Q||(Q=[L])).push(u[I++]);if(Q){Q.sort(CH);for(var G=0;G<Q.length;G++)a(Q[G],N,!!b)}else a(L,N,!!b)}var Z=void 0,dt=void 0;if(b)dt=-1,Z=b,b=null;else if(N<o.childCount)dt=N,Z=o.child(N++);else break;for(var lt=0;lt<C.length;lt++)C[lt].to<=A&&C.splice(lt--,1);for(;I<u.length&&u[I].from<=A&&u[I].to>A;)C.push(u[I++]);var et=A+Z.nodeSize;if(Z.isText){var Dt=et;I<u.length&&u[I].from<Dt&&(Dt=u[I].from);for(var J=0;J<C.length;J++)C[J].to<Dt&&(Dt=C[J].to);Dt<et&&(b=Z.cut(Dt-A),Z=Z.cut(0,Dt-A),et=Dt,dt=-1)}var Ft=C.length?Z.isInline&&!Z.isLeaf?C.filter(function(Ot){return!Ot.inline}):C.slice():Za;c(Z,Ft,n.forChild(A,Z),dt),A=et}}function TH(o){if(o.nodeName=="UL"||o.nodeName=="OL"){var n=o.style.cssText;o.style.cssText=n+"; list-style: square !important",window.getComputedStyle(o).listStyle,o.style.cssText=n}}function RH(o,n){for(;;){if(o.nodeType==3)return o;if(o.nodeType==1&&n>0){if(o.childNodes.length>n&&o.childNodes[n].nodeType==3)return o.childNodes[n];o=o.childNodes[n-1],n=Bs(o)}else if(o.nodeType==1&&n<o.childNodes.length)o=o.childNodes[n],n=0;else return null}}function yH(o,n,a,c){for(var u=0,A=0;u<o.childCount&&A<=c;){var g=o.child(u++),E=A;if(A+=g.nodeSize,!!g.isText){for(var I=g.text;u<o.childCount;){var C=o.child(u++);if(A+=C.nodeSize,!C.isText)break;I+=C.text}if(A>=a&&E<c){var b=I.lastIndexOf(n,c-E-1);if(b>=0&&b+n.length+E>=a)return E+b}}}return-1}function mI(o,n,a,c,u){for(var A=[],g=0,E=0;g<o.length;g++){var I=o[g],C=E,b=E+=I.size;C>=a||b<=n?A.push(I):(C<n&&A.push(I.slice(0,n-C,c)),u&&(A.push(u),u=null),b>a&&A.push(I.slice(a-C,I.size,c)))}return A}function mk(o,n){var a=o.root.getSelection(),c=o.state.doc;if(!a.focusNode)return null;var u=o.docView.nearestDesc(a.focusNode),A=u&&u.size==0,g=o.docView.posFromDOM(a.focusNode,a.focusOffset);if(g<0)return null;var E=c.resolve(g),I,C;if($I(a)){for(I=E;u&&!u.node;)u=u.parent;if(u&&u.node.isAtom&&ke.isSelectable(u.node)&&u.parent&&!(u.node.isInline&&eH(a.focusNode,a.focusOffset,u.dom))){var b=u.posBefore;C=new ke(g==b?E:c.resolve(b))}}else{var N=o.docView.posFromDOM(a.anchorNode,a.anchorOffset);if(N<0)return null;I=c.resolve(N)}if(!C){var L=n=="pointer"||o.state.selection.head<E.pos&&!A?1:-1;C=ev(o,I,E,L)}return C}function Ek(o){return o.editable?o.hasFocus():rv(o)&&document.activeElement&&document.activeElement.contains(o.dom)}function rc(o,n){var a=o.state.selection;if(_k(o,a),!!Ek(o)){if(!n&&o.mouseDown&&o.mouseDown.allowDefault&&Bt.chrome){var c=o.root.getSelection(),u=o.domObserver.currentSelection;if(c.anchorNode&&uh(c.anchorNode,c.anchorOffset,u.anchorNode,u.anchorOffset)){o.mouseDown.delayedSelectionSync=!0,o.domObserver.setCurSelection();return}}if(o.domObserver.disconnectSelection(),o.cursorWrapper)bH(o);else{var A=a.anchor,g=a.head,E,I;oO&&!(a instanceof rr)&&(a.$from.parent.inlineContent||(E=sO(o,a.from)),!a.empty&&!a.$from.parent.inlineContent&&(I=sO(o,a.to))),o.docView.setSelection(A,g,o.root,n),oO&&(E&&aO(E),I&&aO(I)),a.visible?o.dom.classList.remove("ProseMirror-hideselection"):(o.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&wH(o))}o.domObserver.setCurSelection(),o.domObserver.connectSelection()}}var oO=Bt.safari||Bt.chrome&&Bt.chrome_version<63;function sO(o,n){var a=o.docView.domFromPos(n,0),c=a.node,u=a.offset,A=u<c.childNodes.length?c.childNodes[u]:null,g=u?c.childNodes[u-1]:null;if(Bt.safari&&A&&A.contentEditable=="false")return H_(A);if((!A||A.contentEditable=="false")&&(!g||g.contentEditable=="false")){if(A)return H_(A);if(g)return H_(g)}}function H_(o){return o.contentEditable="true",Bt.safari&&o.draggable&&(o.draggable=!1,o.wasDraggable=!0),o}function aO(o){o.contentEditable="false",o.wasDraggable&&(o.draggable=!0,o.wasDraggable=null)}function wH(o){var n=o.dom.ownerDocument;n.removeEventListener("selectionchange",o.hideSelectionGuard);var a=o.root.getSelection(),c=a.anchorNode,u=a.anchorOffset;n.addEventListener("selectionchange",o.hideSelectionGuard=function(){(a.anchorNode!=c||a.anchorOffset!=u)&&(n.removeEventListener("selectionchange",o.hideSelectionGuard),setTimeout(function(){(!Ek(o)||o.state.selection.visible)&&o.dom.classList.remove("ProseMirror-hideselection")},20))})}function bH(o){var n=o.root.getSelection(),a=document.createRange(),c=o.cursorWrapper.dom,u=c.nodeName=="IMG";u?a.setEnd(c.parentNode,vo(c)+1):a.setEnd(c,0),a.collapse(!1),n.removeAllRanges(),n.addRange(a),!u&&!o.state.selection.visible&&Bt.ie&&Bt.ie_version<=11&&(c.disabled=!0,c.disabled=!1)}function _k(o,n){if(n instanceof ke){var a=o.docView.descAt(n.from);a!=o.lastSelectedViewDesc&&(cO(o),a&&a.selectNode(),o.lastSelectedViewDesc=a)}else cO(o)}function cO(o){o.lastSelectedViewDesc&&(o.lastSelectedViewDesc.parent&&o.lastSelectedViewDesc.deselectNode(),o.lastSelectedViewDesc=null)}function ev(o,n,a,c){return o.someProp("createSelectionBetween",function(u){return u(o,n,a)})||rr.between(n,a,c)}function NH(o){return o.editable&&o.root.activeElement!=o.dom?!1:rv(o)}function rv(o){var n=o.root.getSelection();if(!n.anchorNode)return!1;try{return o.dom.contains(n.anchorNode.nodeType==3?n.anchorNode.parentNode:n.anchorNode)&&(o.editable||o.dom.contains(n.focusNode.nodeType==3?n.focusNode.parentNode:n.focusNode))}catch{return!1}}function OH(o){var n=o.docView.domFromPos(o.state.selection.anchor,0),a=o.root.getSelection();return uh(n.node,n.offset,a.anchorNode,a.anchorOffset)}function EI(o,n){var a=o.selection,c=a.$anchor,u=a.$head,A=n>0?c.max(u):c.min(u),g=A.parent.inlineContent?A.depth?o.doc.resolve(n>0?A.after():A.before()):null:A;return g&&De.findFrom(g,n)}function xc(o,n){return o.dispatch(o.state.tr.setSelection(n).scrollIntoView()),!0}function lO(o,n,a){var c=o.state.selection;if(c instanceof rr){if(!c.empty||a.indexOf("s")>-1)return!1;if(o.endOfTextblock(n>0?"right":"left")){var u=EI(o.state,n);return u&&u instanceof ke?xc(o,u):!1}else if(!(Bt.mac&&a.indexOf("m")>-1)){var A=c.$head,g=A.textOffset?null:n<0?A.nodeBefore:A.nodeAfter,E;if(!g||g.isText)return!1;var I=n<0?A.pos-g.nodeSize:A.pos;return g.isAtom||(E=o.docView.descAt(I))&&!E.contentDOM?ke.isSelectable(g)?xc(o,new ke(n<0?o.state.doc.resolve(A.pos-g.nodeSize):A)):Bt.webkit?xc(o,new rr(o.state.doc.resolve(n<0?I:I+g.nodeSize))):!1:!1}}else{if(c instanceof ke&&c.node.isInline)return xc(o,new rr(n>0?c.$to:c.$from));var C=EI(o.state,n);return C?xc(o,C):!1}}function cf(o){return o.nodeType==3?o.nodeValue.length:o.childNodes.length}function th(o){var n=o.pmViewDesc;return n&&n.size==0&&(o.nextSibling||o.nodeName!="BR")}function K_(o){var n=o.root.getSelection(),a=n.focusNode,c=n.focusOffset;if(!!a){var u,A,g=!1;for(Bt.gecko&&a.nodeType==1&&c<cf(a)&&th(a.childNodes[c])&&(g=!0);;)if(c>0){if(a.nodeType!=1)break;var E=a.childNodes[c-1];if(th(E))u=a,A=--c;else if(E.nodeType==3)a=E,c=a.nodeValue.length;else break}else{if(Ik(a))break;for(var I=a.previousSibling;I&&th(I);)u=a.parentNode,A=vo(I),I=I.previousSibling;if(I)a=I,c=cf(a);else{if(a=a.parentNode,a==o.dom)break;c=0}}g?_I(o,n,a,c):u&&_I(o,n,u,A)}}function W_(o){var n=o.root.getSelection(),a=n.focusNode,c=n.focusOffset;if(!!a){for(var u=cf(a),A,g;;)if(c<u){if(a.nodeType!=1)break;var E=a.childNodes[c];if(th(E))A=a,g=++c;else break}else{if(Ik(a))break;for(var I=a.nextSibling;I&&th(I);)A=I.parentNode,g=vo(I)+1,I=I.nextSibling;if(I)a=I,c=0,u=cf(a);else{if(a=a.parentNode,a==o.dom)break;c=u=0}}A&&_I(o,n,A,g)}}function Ik(o){var n=o.pmViewDesc;return n&&n.node&&n.node.isBlock}function _I(o,n,a,c){if($I(n)){var u=document.createRange();u.setEnd(a,c),u.setStart(a,c),n.removeAllRanges(),n.addRange(u)}else n.extend&&n.extend(a,c);o.domObserver.setCurSelection();var A=o.state;setTimeout(function(){o.state==A&&rc(o)},50)}function dO(o,n,a){var c=o.state.selection;if(c instanceof rr&&!c.empty||a.indexOf("s")>-1||Bt.mac&&a.indexOf("m")>-1)return!1;var u=c.$from,A=c.$to;if(!u.parent.inlineContent||o.endOfTextblock(n<0?"up":"down")){var g=EI(o.state,n);if(g&&g instanceof ke)return xc(o,g)}if(!u.parent.inlineContent){var E=n<0?u:A,I=c instanceof Ta?De.near(E,n):De.findFrom(E,n);return I?xc(o,I):!1}return!1}function uO(o,n){if(!(o.state.selection instanceof rr))return!0;var a=o.state.selection,c=a.$head,u=a.$anchor,A=a.empty;if(!c.sameParent(u))return!0;if(!A)return!1;if(o.endOfTextblock(n>0?"forward":"backward"))return!0;var g=!c.textOffset&&(n<0?c.nodeBefore:c.nodeAfter);if(g&&!g.isText){var E=o.state.tr;return n<0?E.delete(c.pos-g.nodeSize,c.pos):E.delete(c.pos,c.pos+g.nodeSize),o.dispatch(E),!0}return!1}function hO(o,n,a){o.domObserver.stop(),n.contentEditable=a,o.domObserver.start()}function kH(o){if(!(!Bt.safari||o.state.selection.$head.parentOffset>0)){var n=o.root.getSelection(),a=n.focusNode,c=n.focusOffset;if(a&&a.nodeType==1&&c==0&&a.firstChild&&a.firstChild.contentEditable=="false"){var u=a.firstChild;hO(o,u,!0),setTimeout(function(){return hO(o,u,!1)},20)}}}function DH(o){var n="";return o.ctrlKey&&(n+="c"),o.metaKey&&(n+="m"),o.altKey&&(n+="a"),o.shiftKey&&(n+="s"),n}function LH(o,n){var a=n.keyCode,c=DH(n);return a==8||Bt.mac&&a==72&&c=="c"?uO(o,-1)||K_(o):a==46||Bt.mac&&a==68&&c=="c"?uO(o,1)||W_(o):a==13||a==27?!0:a==37?lO(o,-1,c)||K_(o):a==39?lO(o,1,c)||W_(o):a==38?dO(o,-1,c)||K_(o):a==40?kH(o)||dO(o,1,c)||W_(o):c==(Bt.mac?"m":"c")&&(a==66||a==73||a==89||a==90)}function PH(o,n,a){var c=o.docView.parseRange(n,a),u=c.node,A=c.fromOffset,g=c.toOffset,E=c.from,I=c.to,C=o.root.getSelection(),b=null,N=C.anchorNode;if(N&&o.dom.contains(N.nodeType==1?N:N.parentNode)&&(b=[{node:N,offset:C.anchorOffset}],$I(C)||b.push({node:C.focusNode,offset:C.focusOffset})),Bt.chrome&&o.lastKeyCode===8)for(var L=g;L>A;L--){var Q=u.childNodes[L-1],G=Q.pmViewDesc;if(Q.nodeName=="BR"&&!G){g=L;break}if(!G||G.size)break}var Z=o.state.doc,dt=o.someProp("domParser")||hs.fromSchema(o.state.schema),lt=Z.resolve(E),et=null,Dt=dt.parse(u,{topNode:lt.parent,topMatch:lt.parent.contentMatchAt(lt.index()),topOpen:!0,from:A,to:g,preserveWhitespace:lt.parent.type.whitespace=="pre"?"full":!0,editableContent:!0,findPositions:b,ruleFromNode:BH,context:lt});if(b&&b[0].pos!=null){var J=b[0].pos,Ft=b[1]&&b[1].pos;Ft==null&&(Ft=J),et={anchor:J+E,head:Ft+E}}return{doc:Dt,sel:et,from:E,to:I}}function BH(o){var n=o.pmViewDesc;if(n)return n.parseRule();if(o.nodeName=="BR"&&o.parentNode){if(Bt.safari&&/^(ul|ol)$/i.test(o.parentNode.nodeName)){var a=document.createElement("div");return a.appendChild(document.createElement("li")),{skip:a}}else if(o.parentNode.lastChild==o||Bt.safari&&/^(tr|table)$/i.test(o.parentNode.nodeName))return{ignore:!0}}else if(o.nodeName=="IMG"&&o.getAttribute("mark-placeholder"))return{ignore:!0}}function MH(o,n,a,c,u){if(n<0){var A=o.lastSelectionTime>Date.now()-50?o.lastSelectionOrigin:null,g=mk(o,A);if(g&&!o.state.selection.eq(g)){var E=o.state.tr.setSelection(g);A=="pointer"?E.setMeta("pointer",!0):A=="key"&&E.scrollIntoView(),o.dispatch(E)}return}var I=o.state.doc.resolve(n),C=I.sharedDepth(a);n=I.before(C+1),a=o.state.doc.resolve(a).after(C+1);var b=o.state.selection,N=PH(o,n,a);if(Bt.chrome&&o.cursorWrapper&&N.sel&&N.sel.anchor==o.cursorWrapper.deco.from){var L=o.cursorWrapper.deco.type.toDOM.nextSibling,Q=L&&L.nodeValue?L.nodeValue.length:1;N.sel={anchor:N.sel.anchor+Q,head:N.sel.anchor+Q}}var G=o.state.doc,Z=G.slice(N.from,N.to),dt,lt;o.lastKeyCode===8&&Date.now()-100<o.lastKeyCodeTime?(dt=o.state.selection.to,lt="end"):(dt=o.state.selection.from,lt="start"),o.lastKeyCode=null;var et=FH(Z.content,N.doc.content,N.from,dt,lt);if(!et)if(c&&b instanceof rr&&!b.empty&&b.$head.sameParent(b.$anchor)&&!o.composing&&!(N.sel&&N.sel.anchor!=N.sel.head))et={start:b.from,endA:b.to,endB:b.to};else if((Bt.ios&&o.lastIOSEnter>Date.now()-225||Bt.android)&&u.some(function(Re){return Re.nodeName=="DIV"||Re.nodeName=="P"})&&o.someProp("handleKeyDown",function(Re){return Re(o,od(13,"Enter"))})){o.lastIOSEnter=0;return}else{if(N.sel){var Dt=pO(o,o.state.doc,N.sel);Dt&&!Dt.eq(o.state.selection)&&o.dispatch(o.state.tr.setSelection(Dt))}return}o.domChangeCount++,o.state.selection.from<o.state.selection.to&&et.start==et.endB&&o.state.selection instanceof rr&&(et.start>o.state.selection.from&&et.start<=o.state.selection.from+2?et.start=o.state.selection.from:et.endA<o.state.selection.to&&et.endA>=o.state.selection.to-2&&(et.endB+=o.state.selection.to-et.endA,et.endA=o.state.selection.to)),Bt.ie&&Bt.ie_version<=11&&et.endB==et.start+1&&et.endA==et.start&&et.start>N.from&&N.doc.textBetween(et.start-N.from-1,et.start-N.from+1)==" \xA0"&&(et.start--,et.endA--,et.endB--);var J=N.doc.resolveNoCache(et.start-N.from),Ft=N.doc.resolveNoCache(et.endB-N.from),Ot=J.sameParent(Ft)&&J.parent.inlineContent,ce;if((Bt.ios&&o.lastIOSEnter>Date.now()-225&&(!Ot||u.some(function(Re){return Re.nodeName=="DIV"||Re.nodeName=="P"}))||!Ot&&J.pos<N.doc.content.size&&(ce=De.findFrom(N.doc.resolve(J.pos+1),1,!0))&&ce.head==Ft.pos)&&o.someProp("handleKeyDown",function(Re){return Re(o,od(13,"Enter"))})){o.lastIOSEnter=0;return}if(o.state.selection.anchor>et.start&&xH(G,et.start,et.endA,J,Ft)&&o.someProp("handleKeyDown",function(Re){return Re(o,od(8,"Backspace"))})){Bt.android&&Bt.chrome&&o.domObserver.suppressSelectionUpdates();return}Bt.chrome&&Bt.android&&et.toB==et.from&&(o.lastAndroidDelete=Date.now()),Bt.android&&!Ot&&J.start()!=Ft.start()&&Ft.parentOffset==0&&J.depth==Ft.depth&&N.sel&&N.sel.anchor==N.sel.head&&N.sel.head==et.endA&&(et.endB-=2,Ft=N.doc.resolveNoCache(et.endB-N.from),setTimeout(function(){o.someProp("handleKeyDown",function(Re){return Re(o,od(13,"Enter"))})},20));var ge=et.start,he=et.endA,Te,Sr,lr,_r;if(Ot){if(J.pos==Ft.pos)Bt.ie&&Bt.ie_version<=11&&J.parentOffset==0&&(o.domObserver.suppressSelectionUpdates(),setTimeout(function(){return rc(o)},20)),Te=o.state.tr.delete(ge,he),Sr=G.resolve(et.start).marksAcross(G.resolve(et.endA));else if(et.endA==et.endB&&(_r=G.resolve(et.start))&&(lr=UH(J.parent.content.cut(J.parentOffset,Ft.parentOffset),_r.parent.content.cut(_r.parentOffset,et.endA-_r.start()))))Te=o.state.tr,lr.type=="add"?Te.addMark(ge,he,lr.mark):Te.removeMark(ge,he,lr.mark);else if(J.parent.child(J.index()).isText&&J.index()==Ft.index()-(Ft.textOffset?0:1)){var Zr=J.parent.textBetween(J.parentOffset,Ft.parentOffset);if(o.someProp("handleTextInput",function(Re){return Re(o,ge,he,Zr)}))return;Te=o.state.tr.insertText(Zr,ge,he)}}if(Te||(Te=o.state.tr.replace(ge,he,N.doc.slice(et.start-N.from,et.endB-N.from))),N.sel){var gr=pO(o,Te.doc,N.sel);gr&&!(Bt.chrome&&Bt.android&&o.composing&&gr.empty&&(et.start!=et.endB||o.lastAndroidDelete<Date.now()-100)&&(gr.head==ge||gr.head==Te.mapping.map(he)-1)||Bt.ie&&gr.empty&&gr.head==ge)&&Te.setSelection(gr)}Sr&&Te.ensureMarks(Sr),o.dispatch(Te.scrollIntoView())}function pO(o,n,a){return Math.max(a.anchor,a.head)>n.content.size?null:ev(o,n.resolve(a.anchor),n.resolve(a.head))}function UH(o,n){for(var a=o.firstChild.marks,c=n.firstChild.marks,u=a,A=c,g,E,I,C=0;C<c.length;C++)u=c[C].removeFromSet(u);for(var b=0;b<a.length;b++)A=a[b].removeFromSet(A);if(u.length==1&&A.length==0)E=u[0],g="add",I=function(Q){return Q.mark(E.addToSet(Q.marks))};else if(u.length==0&&A.length==1)E=A[0],g="remove",I=function(Q){return Q.mark(E.removeFromSet(Q.marks))};else return null;for(var N=[],L=0;L<n.childCount;L++)N.push(I(n.child(L)));if(bt.from(N).eq(o))return{mark:E,type:g}}function xH(o,n,a,c,u){if(!c.parent.isTextblock||a-n<=u.pos-c.pos||Y_(c,!0,!1)<u.pos)return!1;var A=o.resolve(n);if(A.parentOffset<A.parent.content.size||!A.parent.isTextblock)return!1;var g=o.resolve(Y_(A,!0,!0));return!g.parent.isTextblock||g.pos>a||Y_(g,!0,!1)<a?!1:c.parent.content.cut(c.parentOffset).eq(g.parent.content)}function Y_(o,n,a){for(var c=o.depth,u=n?o.end():o.pos;c>0&&(n||o.indexAfter(c)==o.node(c).childCount);)c--,u++,n=!1;if(a)for(var A=o.node(c).maybeChild(o.indexAfter(c));A&&!A.isLeaf;)A=A.firstChild,u++;return u}function FH(o,n,a,c,u){var A=o.findDiffStart(n,a);if(A==null)return null;var g=o.findDiffEnd(n,a+o.size,a+n.size),E=g.a,I=g.b;if(u=="end"){var C=Math.max(0,A-Math.min(E,I));c-=E+C-A}if(E<A&&o.size<n.size){var b=c<=A&&c>=E?A-c:0;A-=b,I=A+(I-E),E=A}else if(I<A){var N=c<=A&&c>=I?A-c:0;A-=N,E=A+(E-I),I=A}return{start:A,endA:E,endB:I}}function vk(o,n){for(var a=[],c=n.content,u=n.openStart,A=n.openEnd;u>1&&A>1&&c.childCount==1&&c.firstChild.childCount==1;){u--,A--;var g=c.firstChild;a.push(g.type.name,g.attrs!=g.type.defaultAttrs?g.attrs:null),c=g.content}var E=o.someProp("clipboardSerializer")||ai.fromSchema(o.state.schema),I=wk(),C=I.createElement("div");C.appendChild(E.serializeFragment(c,{document:I}));for(var b=C.firstChild,N;b&&b.nodeType==1&&(N=yk[b.nodeName.toLowerCase()]);){for(var L=N.length-1;L>=0;L--){for(var Q=I.createElement(N[L]);C.firstChild;)Q.appendChild(C.firstChild);C.appendChild(Q),N[L]!="tbody"&&(u++,A++)}b=C.firstChild}b&&b.nodeType==1&&b.setAttribute("data-pm-slice",u+" "+A+" "+JSON.stringify(a));var G=o.someProp("clipboardTextSerializer",function(Z){return Z(n)})||n.content.textBetween(0,n.content.size,`

`);return{dom:C,text:G}}function Ck(o,n,a,c,u){var A,g=u.parent.type.spec.code,E;if(!a&&!n)return null;var I=n&&(c||g||!a);if(I){if(o.someProp("transformPastedText",function(Ft){n=Ft(n,g||c)}),g)return n?new Kt(bt.from(o.state.schema.text(n.replace(/\r\n?/g,`
`))),0,0):Kt.empty;var C=o.someProp("clipboardTextParser",function(Ft){return Ft(n,u,c)});if(C)E=C;else{var b=u.marks(),N=o.state,L=N.schema,Q=ai.fromSchema(L);A=document.createElement("div"),n.split(/(?:\r\n?|\n)+/).forEach(function(Ft){var Ot=A.appendChild(document.createElement("p"));Ft&&Ot.appendChild(Q.serializeNode(L.text(Ft,b)))})}}else o.someProp("transformPastedHTML",function(Ft){a=Ft(a)}),A=GH(a),Bt.webkit&&jH(A);var G=A&&A.querySelector("[data-pm-slice]"),Z=G&&/^(\d+) (\d+) (.*)/.exec(G.getAttribute("data-pm-slice"));if(!E){var dt=o.someProp("clipboardParser")||o.someProp("domParser")||hs.fromSchema(o.state.schema);E=dt.parseSlice(A,{preserveWhitespace:!!(I||Z),context:u,ruleFromNode:function(Ot){if(Ot.nodeName=="BR"&&!Ot.nextSibling&&Ot.parentNode&&!QH.test(Ot.parentNode.nodeName))return{ignore:!0}}})}if(Z)E=HH(AO(E,+Z[1],+Z[2]),Z[3]);else if(E=Kt.maxOpen(VH(E.content,u),!0),E.openStart||E.openEnd){for(var lt=0,et=0,Dt=E.content.firstChild;lt<E.openStart&&!Dt.type.spec.isolating;lt++,Dt=Dt.firstChild);for(var J=E.content.lastChild;et<E.openEnd&&!J.type.spec.isolating;et++,J=J.lastChild);E=AO(E,lt,et)}return o.someProp("transformPasted",function(Ft){E=Ft(E)}),E}var QH=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function VH(o,n){if(o.childCount<2)return o;for(var a=function(A){var g=n.node(A),E=g.contentMatchAt(n.index(A)),I=void 0,C=[];if(o.forEach(function(b){if(!!C){var N=E.findWrapping(b.type),L;if(!N)return C=null;if(L=C.length&&I.length&&Tk(N,I,b,C[C.length-1],0))C[C.length-1]=L;else{C.length&&(C[C.length-1]=Rk(C[C.length-1],I.length));var Q=Sk(b,N);C.push(Q),E=E.matchType(Q.type,Q.attrs),I=N}}}),C)return{v:bt.from(C)}},c=n.depth;c>=0;c--){var u=a(c);if(u)return u.v}return o}function Sk(o,n,a){a===void 0&&(a=0);for(var c=n.length-1;c>=a;c--)o=n[c].create(null,bt.from(o));return o}function Tk(o,n,a,c,u){if(u<o.length&&u<n.length&&o[u]==n[u]){var A=Tk(o,n,a,c.lastChild,u+1);if(A)return c.copy(c.content.replaceChild(c.childCount-1,A));var g=c.contentMatchAt(c.childCount);if(g.matchType(u==o.length-1?a.type:o[u+1]))return c.copy(c.content.append(bt.from(Sk(a,o,u+1))))}}function Rk(o,n){if(n==0)return o;var a=o.content.replaceChild(o.childCount-1,Rk(o.lastChild,n-1)),c=o.contentMatchAt(o.childCount).fillBefore(bt.empty,!0);return o.copy(a.append(c))}function II(o,n,a,c,u,A){var g=n<0?o.firstChild:o.lastChild,E=g.content;return u<c-1&&(E=II(E,n,a,c,u+1,A)),u>=a&&(E=n<0?g.contentMatchAt(0).fillBefore(E,o.childCount>1||A<=u).append(E):E.append(g.contentMatchAt(g.childCount).fillBefore(bt.empty,!0))),o.replaceChild(n<0?0:o.childCount-1,g.copy(E))}function AO(o,n,a){return n<o.openStart&&(o=new Kt(II(o.content,-1,n,o.openStart,0,o.openEnd),n,o.openEnd)),a<o.openEnd&&(o=new Kt(II(o.content,1,a,o.openEnd,0,0),o.openStart,a)),o}var yk={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]},fO=null;function wk(){return fO||(fO=document.implementation.createHTMLDocument("title"))}function GH(o){var n=/^(\s*<meta [^>]*>)*/.exec(o);n&&(o=o.slice(n[0].length));var a=wk().createElement("div"),c=/<([a-z][^>\s]+)/i.exec(o),u;if((u=c&&yk[c[1].toLowerCase()])&&(o=u.map(function(g){return"<"+g+">"}).join("")+o+u.map(function(g){return"</"+g+">"}).reverse().join("")),a.innerHTML=o,u)for(var A=0;A<u.length;A++)a=a.querySelector(u[A])||a;return a}function jH(o){for(var n=o.querySelectorAll(Bt.chrome?"span:not([class]):not([style])":"span.Apple-converted-space"),a=0;a<n.length;a++){var c=n[a];c.childNodes.length==1&&c.textContent=="\xA0"&&c.parentNode&&c.parentNode.replaceChild(o.ownerDocument.createTextNode(" "),c)}}function HH(o,n){if(!o.size)return o;var a=o.content.firstChild.type.schema,c;try{c=JSON.parse(n)}catch{return o}for(var u=o.content,A=o.openStart,g=o.openEnd,E=c.length-2;E>=0;E-=2){var I=a.nodes[c[E]];if(!I||I.hasRequiredAttrs())break;u=bt.from(I.create(c[E+1],u)),A++,g++}return new Kt(u,A,g)}var KH={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},nv=Bt.ie&&Bt.ie_version<=11,iv=function(){this.anchorNode=this.anchorOffset=this.focusNode=this.focusOffset=null};iv.prototype.set=function(n){this.anchorNode=n.anchorNode,this.anchorOffset=n.anchorOffset,this.focusNode=n.focusNode,this.focusOffset=n.focusOffset};iv.prototype.eq=function(n){return n.anchorNode==this.anchorNode&&n.anchorOffset==this.anchorOffset&&n.focusNode==this.focusNode&&n.focusOffset==this.focusOffset};var So=function(n,a){var c=this;this.view=n,this.handleDOMChange=a,this.queue=[],this.flushingSoon=-1,this.observer=window.MutationObserver&&new window.MutationObserver(function(u){for(var A=0;A<u.length;A++)c.queue.push(u[A]);Bt.ie&&Bt.ie_version<=11&&u.some(function(g){return g.type=="childList"&&g.removedNodes.length||g.type=="characterData"&&g.oldValue.length>g.target.nodeValue.length})?c.flushSoon():c.flush()}),this.currentSelection=new iv,nv&&(this.onCharData=function(u){c.queue.push({target:u.target,type:"characterData",oldValue:u.prevValue}),c.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.suppressingSelectionUpdates=!1};So.prototype.flushSoon=function(){var n=this;this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(function(){n.flushingSoon=-1,n.flush()},20))};So.prototype.forceFlush=function(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())};So.prototype.start=function(){this.observer&&this.observer.observe(this.view.dom,KH),nv&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()};So.prototype.stop=function(){var n=this;if(this.observer){var a=this.observer.takeRecords();if(a.length){for(var c=0;c<a.length;c++)this.queue.push(a[c]);window.setTimeout(function(){return n.flush()},20)}this.observer.disconnect()}nv&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()};So.prototype.connectSelection=function(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)};So.prototype.disconnectSelection=function(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)};So.prototype.suppressSelectionUpdates=function(){var n=this;this.suppressingSelectionUpdates=!0,setTimeout(function(){return n.suppressingSelectionUpdates=!1},50)};So.prototype.onSelectionChange=function(){if(!!NH(this.view)){if(this.suppressingSelectionUpdates)return rc(this.view);if(Bt.ie&&Bt.ie_version<=11&&!this.view.state.selection.empty){var n=this.view.root.getSelection();if(n.focusNode&&uh(n.focusNode,n.focusOffset,n.anchorNode,n.anchorOffset))return this.flushSoon()}this.flush()}};So.prototype.setCurSelection=function(){this.currentSelection.set(this.view.root.getSelection())};So.prototype.ignoreSelectionChange=function(n){if(n.rangeCount==0)return!0;var a=n.getRangeAt(0).commonAncestorContainer,c=this.view.docView.nearestDesc(a);if(c&&c.ignoreMutation({type:"selection",target:a.nodeType==3?a.parentNode:a}))return this.setCurSelection(),!0};So.prototype.flush=function(){if(!(!this.view.docView||this.flushingSoon>-1)){var n=this.observer?this.observer.takeRecords():[];this.queue.length&&(n=this.queue.concat(n),this.queue.length=0);var a=this.view.root.getSelection(),c=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(a)&&rv(this.view)&&!this.ignoreSelectionChange(a),u=-1,A=-1,g=!1,E=[];if(this.view.editable)for(var I=0;I<n.length;I++){var C=this.registerMutation(n[I],E);C&&(u=u<0?C.from:Math.min(C.from,u),A=A<0?C.to:Math.max(C.to,A),C.typeOver&&(g=!0))}if(Bt.gecko&&E.length>1){var b=E.filter(function(Q){return Q.nodeName=="BR"});if(b.length==2){var N=b[0],L=b[1];N.parentNode&&N.parentNode.parentNode==L.parentNode?L.remove():N.remove()}}(u>-1||c)&&(u>-1&&(this.view.docView.markDirty(u,A),WH(this.view)),this.handleDOMChange(u,A,g,E),this.view.docView.dirty?this.view.updateState(this.view.state):this.currentSelection.eq(a)||rc(this.view),this.currentSelection.set(a))}};So.prototype.registerMutation=function(n,a){if(a.indexOf(n.target)>-1)return null;var c=this.view.docView.nearestDesc(n.target);if(n.type=="attributes"&&(c==this.view.docView||n.attributeName=="contenteditable"||n.attributeName=="style"&&!n.oldValue&&!n.target.getAttribute("style"))||!c||c.ignoreMutation(n))return null;if(n.type=="childList"){for(var u=0;u<n.addedNodes.length;u++)a.push(n.addedNodes[u]);if(c.contentDOM&&c.contentDOM!=c.dom&&!c.contentDOM.contains(n.target))return{from:c.posBefore,to:c.posAfter};var A=n.previousSibling,g=n.nextSibling;if(Bt.ie&&Bt.ie_version<=11&&n.addedNodes.length)for(var E=0;E<n.addedNodes.length;E++){var I=n.addedNodes[E],C=I.previousSibling,b=I.nextSibling;(!C||Array.prototype.indexOf.call(n.addedNodes,C)<0)&&(A=C),(!b||Array.prototype.indexOf.call(n.addedNodes,b)<0)&&(g=b)}var N=A&&A.parentNode==n.target?vo(A)+1:0,L=c.localPosFromDOM(n.target,N,-1),Q=g&&g.parentNode==n.target?vo(g):n.target.childNodes.length,G=c.localPosFromDOM(n.target,Q,1);return{from:L,to:G}}else return n.type=="attributes"?{from:c.posAtStart-c.border,to:c.posAtEnd+c.border}:{from:c.posAtStart,to:c.posAtEnd,typeOver:n.target.nodeValue==n.oldValue}};var gO=!1;function WH(o){gO||(gO=!0,getComputedStyle(o.dom).whiteSpace=="normal"&&console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."))}var eo={},Pi={};function YH(o){o.shiftKey=!1,o.mouseDown=null,o.lastKeyCode=null,o.lastKeyCodeTime=0,o.lastClick={time:0,x:0,y:0,type:""},o.lastSelectionOrigin=null,o.lastSelectionTime=0,o.lastIOSEnter=0,o.lastIOSEnterFallbackTimeout=null,o.lastAndroidDelete=0,o.composing=!1,o.composingTimeout=null,o.compositionNodes=[],o.compositionEndedAt=-2e8,o.domObserver=new So(o,function(c,u,A,g){return MH(o,c,u,A,g)}),o.domObserver.start(),o.domChangeCount=0,o.eventHandlers=Object.create(null);var n=function(c){var u=eo[c];o.dom.addEventListener(c,o.eventHandlers[c]=function(A){JH(o,A)&&!sv(o,A)&&(o.editable||!(A.type in Pi))&&u(o,A)})};for(var a in eo)n(a);Bt.safari&&o.dom.addEventListener("input",function(){return null}),ov(o)}function Yc(o,n){o.lastSelectionOrigin=n,o.lastSelectionTime=Date.now()}function qH(o){o.domObserver.stop();for(var n in o.eventHandlers)o.dom.removeEventListener(n,o.eventHandlers[n]);clearTimeout(o.composingTimeout),clearTimeout(o.lastIOSEnterFallbackTimeout)}function ov(o){o.someProp("handleDOMEvents",function(n){for(var a in n)o.eventHandlers[a]||o.dom.addEventListener(a,o.eventHandlers[a]=function(c){return sv(o,c)})})}function sv(o,n){return o.someProp("handleDOMEvents",function(a){var c=a[n.type];return c?c(o,n)||n.defaultPrevented:!1})}function JH(o,n){if(!n.bubbles)return!0;if(n.defaultPrevented)return!1;for(var a=n.target;a!=o.dom;a=a.parentNode)if(!a||a.nodeType==11||a.pmViewDesc&&a.pmViewDesc.stopEvent(n))return!1;return!0}function zH(o,n){!sv(o,n)&&eo[n.type]&&(o.editable||!(n.type in Pi))&&eo[n.type](o,n)}Pi.keydown=function(o,n){if(o.shiftKey=n.keyCode==16||n.shiftKey,!Nk(o,n)&&(o.lastKeyCode=n.keyCode,o.lastKeyCodeTime=Date.now(),!(Bt.android&&Bt.chrome&&n.keyCode==13)))if(n.keyCode!=229&&o.domObserver.forceFlush(),Bt.ios&&n.keyCode==13&&!n.ctrlKey&&!n.altKey&&!n.metaKey){var a=Date.now();o.lastIOSEnter=a,o.lastIOSEnterFallbackTimeout=setTimeout(function(){o.lastIOSEnter==a&&(o.someProp("handleKeyDown",function(c){return c(o,od(13,"Enter"))}),o.lastIOSEnter=0)},200)}else o.someProp("handleKeyDown",function(c){return c(o,n)})||LH(o,n)?n.preventDefault():Yc(o,"key")};Pi.keyup=function(o,n){n.keyCode==16&&(o.shiftKey=!1)};Pi.keypress=function(o,n){if(!(Nk(o,n)||!n.charCode||n.ctrlKey&&!n.altKey||Bt.mac&&n.metaKey)){if(o.someProp("handleKeyPress",function(u){return u(o,n)})){n.preventDefault();return}var a=o.state.selection;if(!(a instanceof rr)||!a.$from.sameParent(a.$to)){var c=String.fromCharCode(n.charCode);o.someProp("handleTextInput",function(u){return u(o,a.$from.pos,a.$to.pos,c)})||o.dispatch(o.state.tr.insertText(c).scrollIntoView()),n.preventDefault()}}};function wf(o){return{left:o.clientX,top:o.clientY}}function XH(o,n){var a=n.x-o.clientX,c=n.y-o.clientY;return a*a+c*c<100}function av(o,n,a,c,u){if(c==-1)return!1;for(var A=o.state.doc.resolve(c),g=function(C){if(o.someProp(n,function(b){return C>A.depth?b(o,a,A.nodeAfter,A.before(C),u,!0):b(o,a,A.node(C),A.before(C),u,!1)}))return{v:!0}},E=A.depth+1;E>0;E--){var I=g(E);if(I)return I.v}return!1}function dd(o,n,a){o.focused||o.focus();var c=o.state.tr.setSelection(n);a=="pointer"&&c.setMeta("pointer",!0),o.dispatch(c)}function ZH(o,n){if(n==-1)return!1;var a=o.state.doc.resolve(n),c=a.nodeAfter;return c&&c.isAtom&&ke.isSelectable(c)?(dd(o,new ke(a),"pointer"),!0):!1}function $H(o,n){if(n==-1)return!1;var a=o.state.selection,c,u;a instanceof ke&&(c=a.node);for(var A=o.state.doc.resolve(n),g=A.depth+1;g>0;g--){var E=g>A.depth?A.nodeAfter:A.node(g);if(ke.isSelectable(E)){c&&a.$from.depth>0&&g>=a.$from.depth&&A.before(a.$from.depth+1)==a.$from.pos?u=A.before(a.$from.depth):u=A.before(g);break}}return u!=null?(dd(o,ke.create(o.state.doc,u),"pointer"),!0):!1}function tK(o,n,a,c,u){return av(o,"handleClickOn",n,a,c)||o.someProp("handleClick",function(A){return A(o,n,c)})||(u?$H(o,a):ZH(o,a))}function eK(o,n,a,c){return av(o,"handleDoubleClickOn",n,a,c)||o.someProp("handleDoubleClick",function(u){return u(o,n,c)})}function rK(o,n,a,c){return av(o,"handleTripleClickOn",n,a,c)||o.someProp("handleTripleClick",function(u){return u(o,n,c)})||nK(o,a,c)}function nK(o,n,a){if(a.button!=0)return!1;var c=o.state.doc;if(n==-1)return c.inlineContent?(dd(o,rr.create(c,0,c.content.size),"pointer"),!0):!1;for(var u=c.resolve(n),A=u.depth+1;A>0;A--){var g=A>u.depth?u.nodeAfter:u.node(A),E=u.before(A);if(g.inlineContent)dd(o,rr.create(c,E+1,E+1+g.content.size),"pointer");else if(ke.isSelectable(g))dd(o,ke.create(c,E),"pointer");else continue;return!0}}function cv(o){return lf(o)}var bk=Bt.mac?"metaKey":"ctrlKey";eo.mousedown=function(o,n){o.shiftKey=n.shiftKey;var a=cv(o),c=Date.now(),u="singleClick";c-o.lastClick.time<500&&XH(n,o.lastClick)&&!n[bk]&&(o.lastClick.type=="singleClick"?u="doubleClick":o.lastClick.type=="doubleClick"&&(u="tripleClick")),o.lastClick={time:c,x:n.clientX,y:n.clientY,type:u};var A=o.posAtCoords(wf(n));!A||(u=="singleClick"?(o.mouseDown&&o.mouseDown.done(),o.mouseDown=new bf(o,A,n,a)):(u=="doubleClick"?eK:rK)(o,A.pos,A.inside,n)?n.preventDefault():Yc(o,"pointer"))};var bf=function(n,a,c,u){var A=this;this.view=n,this.startDoc=n.state.doc,this.pos=a,this.event=c,this.flushed=u,this.selectNode=c[bk],this.allowDefault=c.shiftKey,this.delayedSelectionSync=!1;var g,E;if(a.inside>-1)g=n.state.doc.nodeAt(a.inside),E=a.inside;else{var I=n.state.doc.resolve(a.pos);g=I.parent,E=I.depth?I.before():0}this.mightDrag=null;var C=u?null:c.target,b=C?n.docView.nearestDesc(C,!0):null;this.target=b?b.dom:null;var N=n.state,L=N.selection;(c.button==0&&g.type.spec.draggable&&g.type.spec.selectable!==!1||L instanceof ke&&L.from<=E&&L.to>E)&&(this.mightDrag={node:g,pos:E,addAttr:this.target&&!this.target.draggable,setUneditable:this.target&&Bt.gecko&&!this.target.hasAttribute("contentEditable")}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(function(){A.view.mouseDown==A&&A.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),n.root.addEventListener("mouseup",this.up=this.up.bind(this)),n.root.addEventListener("mousemove",this.move=this.move.bind(this)),Yc(n,"pointer")};bf.prototype.done=function(){var n=this;this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(function(){return rc(n.view)}),this.view.mouseDown=null};bf.prototype.up=function(n){if(this.done(),!!this.view.dom.contains(n.target.nodeType==3?n.target.parentNode:n.target)){var a=this.pos;this.view.state.doc!=this.startDoc&&(a=this.view.posAtCoords(wf(n))),this.allowDefault||!a?Yc(this.view,"pointer"):tK(this.view,a.pos,a.inside,n,this.selectNode)?n.preventDefault():n.button==0&&(this.flushed||Bt.safari&&this.mightDrag&&!this.mightDrag.node.isAtom||Bt.chrome&&!(this.view.state.selection instanceof rr)&&Math.min(Math.abs(a.pos-this.view.state.selection.from),Math.abs(a.pos-this.view.state.selection.to))<=2)?(dd(this.view,De.near(this.view.state.doc.resolve(a.pos)),"pointer"),n.preventDefault()):Yc(this.view,"pointer")}};bf.prototype.move=function(n){!this.allowDefault&&(Math.abs(this.event.x-n.clientX)>4||Math.abs(this.event.y-n.clientY)>4)&&(this.allowDefault=!0),Yc(this.view,"pointer"),n.buttons==0&&this.done()};eo.touchdown=function(o){cv(o),Yc(o,"pointer")};eo.contextmenu=function(o){return cv(o)};function Nk(o,n){return o.composing?!0:Bt.safari&&Math.abs(n.timeStamp-o.compositionEndedAt)<500?(o.compositionEndedAt=-2e8,!0):!1}var iK=Bt.android?5e3:-1;Pi.compositionstart=Pi.compositionupdate=function(o){if(!o.composing){o.domObserver.flush();var n=o.state,a=n.selection.$from;if(n.selection.empty&&(n.storedMarks||!a.textOffset&&a.parentOffset&&a.nodeBefore.marks.some(function(E){return E.type.spec.inclusive===!1})))o.markCursor=o.state.storedMarks||a.marks(),lf(o,!0),o.markCursor=null;else if(lf(o),Bt.gecko&&n.selection.empty&&a.parentOffset&&!a.textOffset&&a.nodeBefore.marks.length)for(var c=o.root.getSelection(),u=c.focusNode,A=c.focusOffset;u&&u.nodeType==1&&A!=0;){var g=A<0?u.lastChild:u.childNodes[A-1];if(!g)break;if(g.nodeType==3){c.collapse(g,g.nodeValue.length);break}else u=g,A=-1}o.composing=!0}Ok(o,iK)};Pi.compositionend=function(o,n){o.composing&&(o.composing=!1,o.compositionEndedAt=n.timeStamp,Ok(o,20))};function Ok(o,n){clearTimeout(o.composingTimeout),n>-1&&(o.composingTimeout=setTimeout(function(){return lf(o)},n))}function kk(o){for(o.composing&&(o.composing=!1,o.compositionEndedAt=oK());o.compositionNodes.length>0;)o.compositionNodes.pop().markParentsDirty()}function oK(){var o=document.createEvent("Event");return o.initEvent("event",!0,!0),o.timeStamp}function lf(o,n){if(!(Bt.android&&o.domObserver.flushingSoon>=0)){if(o.domObserver.forceFlush(),kk(o),n||o.docView.dirty){var a=mk(o);return a&&!a.eq(o.state.selection)?o.dispatch(o.state.tr.setSelection(a)):o.updateState(o.state),!0}return!1}}function sK(o,n){if(!!o.dom.parentNode){var a=o.dom.parentNode.appendChild(document.createElement("div"));a.appendChild(n),a.style.cssText="position: fixed; left: -10000px; top: 10px";var c=getSelection(),u=document.createRange();u.selectNodeContents(n),o.dom.blur(),c.removeAllRanges(),c.addRange(u),setTimeout(function(){a.parentNode&&a.parentNode.removeChild(a),o.focus()},50)}}var Ad=Bt.ie&&Bt.ie_version<15||Bt.ios&&Bt.webkit_version<604;eo.copy=Pi.cut=function(o,n){var a=o.state.selection,c=n.type=="cut";if(!a.empty){var u=Ad?null:n.clipboardData,A=a.content(),g=vk(o,A),E=g.dom,I=g.text;u?(n.preventDefault(),u.clearData(),u.setData("text/html",E.innerHTML),u.setData("text/plain",I)):sK(o,E),c&&o.dispatch(o.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))}};function aK(o){return o.openStart==0&&o.openEnd==0&&o.content.childCount==1?o.content.firstChild:null}function cK(o,n){if(!!o.dom.parentNode){var a=o.shiftKey||o.state.selection.$from.parent.type.spec.code,c=o.dom.parentNode.appendChild(document.createElement(a?"textarea":"div"));a||(c.contentEditable="true"),c.style.cssText="position: fixed; left: -10000px; top: 10px",c.focus(),setTimeout(function(){o.focus(),c.parentNode&&c.parentNode.removeChild(c),a?vI(o,c.value,null,n):vI(o,c.textContent,c.innerHTML,n)},50)}}function vI(o,n,a,c){var u=Ck(o,n,a,o.shiftKey,o.state.selection.$from);if(o.someProp("handlePaste",function(E){return E(o,c,u||Kt.empty)}))return!0;if(!u)return!1;var A=aK(u),g=A?o.state.tr.replaceSelectionWith(A,o.shiftKey):o.state.tr.replaceSelection(u);return o.dispatch(g.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}Pi.paste=function(o,n){if(!(o.composing&&!Bt.android)){var a=Ad?null:n.clipboardData;a&&vI(o,a.getData("text/plain"),a.getData("text/html"),n)?n.preventDefault():cK(o,n)}};var lK=function(n,a){this.slice=n,this.move=a},Dk=Bt.mac?"altKey":"ctrlKey";eo.dragstart=function(o,n){var a=o.mouseDown;if(a&&a.done(),!!n.dataTransfer){var c=o.state.selection,u=c.empty?null:o.posAtCoords(wf(n));if(!(u&&u.pos>=c.from&&u.pos<=(c instanceof ke?c.to-1:c.to))){if(a&&a.mightDrag)o.dispatch(o.state.tr.setSelection(ke.create(o.state.doc,a.mightDrag.pos)));else if(n.target&&n.target.nodeType==1){var A=o.docView.nearestDesc(n.target,!0);A&&A.node.type.spec.draggable&&A!=o.docView&&o.dispatch(o.state.tr.setSelection(ke.create(o.state.doc,A.posBefore)))}}var g=o.state.selection.content(),E=vk(o,g),I=E.dom,C=E.text;n.dataTransfer.clearData(),n.dataTransfer.setData(Ad?"Text":"text/html",I.innerHTML),n.dataTransfer.effectAllowed="copyMove",Ad||n.dataTransfer.setData("text/plain",C),o.dragging=new lK(g,!n[Dk])}};eo.dragend=function(o){var n=o.dragging;window.setTimeout(function(){o.dragging==n&&(o.dragging=null)},50)};Pi.dragover=Pi.dragenter=function(o,n){return n.preventDefault()};Pi.drop=function(o,n){var a=o.dragging;if(o.dragging=null,!!n.dataTransfer){var c=o.posAtCoords(wf(n));if(!!c){var u=o.state.doc.resolve(c.pos);if(!!u){var A=a&&a.slice;A?o.someProp("transformPasted",function(G){A=G(A)}):A=Ck(o,n.dataTransfer.getData(Ad?"Text":"text/plain"),Ad?null:n.dataTransfer.getData("text/html"),!1,u);var g=a&&!n[Dk];if(o.someProp("handleDrop",function(G){return G(o,n,A||Kt.empty,g)})){n.preventDefault();return}if(!!A){n.preventDefault();var E=A?M2(o.state.doc,u.pos,A):u.pos;E==null&&(E=u.pos);var I=o.state.tr;g&&I.deleteSelection();var C=I.mapping.map(E),b=A.openStart==0&&A.openEnd==0&&A.content.childCount==1,N=I.doc;if(b?I.replaceRangeWith(C,C,A.content.firstChild):I.replaceRange(C,C,A),!I.doc.eq(N)){var L=I.doc.resolve(C);if(b&&ke.isSelectable(A.content.firstChild)&&L.nodeAfter&&L.nodeAfter.sameMarkup(A.content.firstChild))I.setSelection(new ke(L));else{var Q=I.mapping.map(E);I.mapping.maps[I.mapping.maps.length-1].forEach(function(G,Z,dt,lt){return Q=lt}),I.setSelection(ev(o,L,I.doc.resolve(Q)))}o.focus(),o.dispatch(I.setMeta("uiEvent","drop"))}}}}}};eo.focus=function(o){o.focused||(o.domObserver.stop(),o.dom.classList.add("ProseMirror-focused"),o.domObserver.start(),o.focused=!0,setTimeout(function(){o.docView&&o.hasFocus()&&!o.domObserver.currentSelection.eq(o.root.getSelection())&&rc(o)},20))};eo.blur=function(o,n){o.focused&&(o.domObserver.stop(),o.dom.classList.remove("ProseMirror-focused"),o.domObserver.start(),n.relatedTarget&&o.dom.contains(n.relatedTarget)&&o.domObserver.currentSelection.set({}),o.focused=!1)};eo.beforeinput=function(o,n){if(Bt.chrome&&Bt.android&&n.inputType=="deleteContentBackward"){o.domObserver.flushSoon();var a=o.domChangeCount;setTimeout(function(){if(o.domChangeCount==a&&(o.dom.blur(),o.focus(),!o.someProp("handleKeyDown",function(A){return A(o,od(8,"Backspace"))}))){var c=o.state.selection,u=c.$cursor;u&&u.pos>0&&o.dispatch(o.state.tr.delete(u.pos-1,u.pos).scrollIntoView())}},50)}};for(var mO in Pi)eo[mO]=Pi[mO];function hh(o,n){if(o==n)return!0;for(var a in o)if(o[a]!==n[a])return!1;for(var c in n)if(!(c in o))return!1;return!0}var fd=function(n,a){this.spec=a||Xc,this.side=this.spec.side||0,this.toDOM=n};fd.prototype.map=function(n,a,c,u){var A=n.mapResult(a.from+u,this.side<0?-1:1),g=A.pos,E=A.deleted;return E?null:new On(g-c,g-c,this)};fd.prototype.valid=function(){return!0};fd.prototype.eq=function(n){return this==n||n instanceof fd&&(this.spec.key&&this.spec.key==n.spec.key||this.toDOM==n.toDOM&&hh(this.spec,n.spec))};fd.prototype.destroy=function(n){this.spec.destroy&&this.spec.destroy(n)};var As=function(n,a){this.spec=a||Xc,this.attrs=n};As.prototype.map=function(n,a,c,u){var A=n.map(a.from+u,this.spec.inclusiveStart?-1:1)-c,g=n.map(a.to+u,this.spec.inclusiveEnd?1:-1)-c;return A>=g?null:new On(A,g,this)};As.prototype.valid=function(n,a){return a.from<a.to};As.prototype.eq=function(n){return this==n||n instanceof As&&hh(this.attrs,n.attrs)&&hh(this.spec,n.spec)};As.is=function(n){return n.type instanceof As};var ph=function(n,a){this.spec=a||Xc,this.attrs=n};ph.prototype.map=function(n,a,c,u){var A=n.mapResult(a.from+u,1);if(A.deleted)return null;var g=n.mapResult(a.to+u,-1);return g.deleted||g.pos<=A.pos?null:new On(A.pos-c,g.pos-c,this)};ph.prototype.valid=function(n,a){var c=n.content.findIndex(a.from),u=c.index,A=c.offset,g;return A==a.from&&!(g=n.child(u)).isText&&A+g.nodeSize==a.to};ph.prototype.eq=function(n){return this==n||n instanceof ph&&hh(this.attrs,n.attrs)&&hh(this.spec,n.spec)};var On=function(n,a,c){this.from=n,this.to=a,this.type=c},lv={spec:{configurable:!0},inline:{configurable:!0}};On.prototype.copy=function(n,a){return new On(n,a,this.type)};On.prototype.eq=function(n,a){return a===void 0&&(a=0),this.type.eq(n.type)&&this.from+a==n.from&&this.to+a==n.to};On.prototype.map=function(n,a,c){return this.type.map(n,this,a,c)};On.widget=function(n,a,c){return new On(n,n,new fd(a,c))};On.inline=function(n,a,c,u){return new On(n,a,new As(c,u))};On.node=function(n,a,c,u){return new On(n,a,new ph(c,u))};lv.spec.get=function(){return this.type.spec};lv.inline.get=function(){return this.type instanceof As};Object.defineProperties(On.prototype,lv);var df=[],Xc={},Nr=function(n,a){this.local=n&&n.length?n:df,this.children=a&&a.length?a:df};Nr.create=function(n,a){return a.length?Nf(a,n,0,Xc):ci};Nr.prototype.find=function(n,a,c){var u=[];return this.findInner(n==null?0:n,a==null?1e9:a,u,0,c),u};Nr.prototype.findInner=function(n,a,c,u,A){for(var g=0;g<this.local.length;g++){var E=this.local[g];E.from<=a&&E.to>=n&&(!A||A(E.spec))&&c.push(E.copy(E.from+u,E.to+u))}for(var I=0;I<this.children.length;I+=3)if(this.children[I]<a&&this.children[I+1]>n){var C=this.children[I]+1;this.children[I+2].findInner(n-C,a-C,c,u+C,A)}};Nr.prototype.map=function(n,a,c){return this==ci||n.maps.length==0?this:this.mapInner(n,a,0,0,c||Xc)};Nr.prototype.mapInner=function(n,a,c,u,A){for(var g,E=0;E<this.local.length;E++){var I=this.local[E].map(n,c,u);I&&I.type.valid(a,I)?(g||(g=[])).push(I):A.onRemove&&A.onRemove(this.local[E].spec)}return this.children.length?dK(this.children,g,n,a,c,u,A):g?new Nr(g.sort(Zc)):ci};Nr.prototype.add=function(n,a){return a.length?this==ci?Nr.create(n,a):this.addInner(n,a,0):this};Nr.prototype.addInner=function(n,a,c){var u=this,A,g=0;n.forEach(function(C,b){var N=b+c,L;if(!!(L=Pk(a,C,N))){for(A||(A=u.children.slice());g<A.length&&A[g]<b;)g+=3;A[g]==b?A[g+2]=A[g+2].addInner(C,L,N+1):A.splice(g,0,b,b+C.nodeSize,Nf(L,C,N+1,Xc)),g+=3}});for(var E=Lk(g?Bk(a):a,-c),I=0;I<E.length;I++)E[I].type.valid(n,E[I])||E.splice(I--,1);return new Nr(E.length?this.local.concat(E).sort(Zc):this.local,A||this.children)};Nr.prototype.remove=function(n){return n.length==0||this==ci?this:this.removeInner(n,0)};Nr.prototype.removeInner=function(n,a){for(var c=this.children,u=this.local,A=0;A<c.length;A+=3){for(var g=void 0,E=c[A]+a,I=c[A+1]+a,C=0,b=void 0;C<n.length;C++)(b=n[C])&&b.from>E&&b.to<I&&(n[C]=null,(g||(g=[])).push(b));if(!!g){c==this.children&&(c=this.children.slice());var N=c[A+2].removeInner(g,E+1);N!=ci?c[A+2]=N:(c.splice(A,3),A-=3)}}if(u.length){for(var L=0,Q=void 0;L<n.length;L++)if(Q=n[L])for(var G=0;G<u.length;G++)u[G].eq(Q,a)&&(u==this.local&&(u=this.local.slice()),u.splice(G--,1))}return c==this.children&&u==this.local?this:u.length||c.length?new Nr(u,c):ci};Nr.prototype.forChild=function(n,a){if(this==ci)return this;if(a.isLeaf)return Nr.empty;for(var c,u,A=0;A<this.children.length;A+=3)if(this.children[A]>=n){this.children[A]==n&&(c=this.children[A+2]);break}for(var g=n+1,E=g+a.content.size,I=0;I<this.local.length;I++){var C=this.local[I];if(C.from<E&&C.to>g&&C.type instanceof As){var b=Math.max(g,C.from)-g,N=Math.min(E,C.to)-g;b<N&&(u||(u=[])).push(C.copy(b,N))}}if(u){var L=new Nr(u.sort(Zc));return c?new jo([L,c]):L}return c||ci};Nr.prototype.eq=function(n){if(this==n)return!0;if(!(n instanceof Nr)||this.local.length!=n.local.length||this.children.length!=n.children.length)return!1;for(var a=0;a<this.local.length;a++)if(!this.local[a].eq(n.local[a]))return!1;for(var c=0;c<this.children.length;c+=3)if(this.children[c]!=n.children[c]||this.children[c+1]!=n.children[c+1]||!this.children[c+2].eq(n.children[c+2]))return!1;return!0};Nr.prototype.locals=function(n){return dv(this.localsInner(n))};Nr.prototype.localsInner=function(n){if(this==ci)return df;if(n.inlineContent||!this.local.some(As.is))return this.local;for(var a=[],c=0;c<this.local.length;c++)this.local[c].type instanceof As||a.push(this.local[c]);return a};var ci=new Nr;Nr.empty=ci;Nr.removeOverlap=dv;var jo=function(n){this.members=n};jo.prototype.map=function(n,a){var c=this.members.map(function(u){return u.map(n,a,Xc)});return jo.from(c)};jo.prototype.forChild=function(n,a){if(a.isLeaf)return Nr.empty;for(var c=[],u=0;u<this.members.length;u++){var A=this.members[u].forChild(n,a);A!=ci&&(A instanceof jo?c=c.concat(A.members):c.push(A))}return jo.from(c)};jo.prototype.eq=function(n){if(!(n instanceof jo)||n.members.length!=this.members.length)return!1;for(var a=0;a<this.members.length;a++)if(!this.members[a].eq(n.members[a]))return!1;return!0};jo.prototype.locals=function(n){for(var a,c=!0,u=0;u<this.members.length;u++){var A=this.members[u].localsInner(n);if(!!A.length)if(!a)a=A;else{c&&(a=a.slice(),c=!1);for(var g=0;g<A.length;g++)a.push(A[g])}}return a?dv(c?a:a.sort(Zc)):df};jo.from=function(n){switch(n.length){case 0:return ci;case 1:return n[0];default:return new jo(n)}};function dK(o,n,a,c,u,A,g){for(var E=o.slice(),I=function(Sr,lr,_r,Zr){for(var gr=0;gr<E.length;gr+=3){var Re=E[gr+1],ln=void 0;Re==-1||Sr>Re+A||(lr>=E[gr]+A?E[gr+1]=-1:_r>=u&&(ln=Zr-_r-(lr-Sr))&&(E[gr]+=ln,E[gr+1]+=ln))}},C=0;C<a.maps.length;C++)a.maps[C].forEach(I);for(var b=!1,N=0;N<E.length;N+=3)if(E[N+1]==-1){var L=a.map(o[N]+A),Q=L-u;if(Q<0||Q>=c.content.size){b=!0;continue}var G=a.map(o[N+1]+A,-1),Z=G-u,dt=c.content.findIndex(Q),lt=dt.index,et=dt.offset,Dt=c.maybeChild(lt);if(Dt&&et==Q&&et+Dt.nodeSize==Z){var J=E[N+2].mapInner(a,Dt,L+1,o[N]+A+1,g);J!=ci?(E[N]=Q,E[N+1]=Z,E[N+2]=J):(E[N+1]=-2,b=!0)}else b=!0}if(b){var Ft=uK(E,o,n||[],a,u,A,g),Ot=Nf(Ft,c,0,g);n=Ot.local;for(var ce=0;ce<E.length;ce+=3)E[ce+1]<0&&(E.splice(ce,3),ce-=3);for(var ge=0,he=0;ge<Ot.children.length;ge+=3){for(var Te=Ot.children[ge];he<E.length&&E[he]<Te;)he+=3;E.splice(he,0,Ot.children[ge],Ot.children[ge+1],Ot.children[ge+2])}}return new Nr(n&&n.sort(Zc),E)}function Lk(o,n){if(!n||!o.length)return o;for(var a=[],c=0;c<o.length;c++){var u=o[c];a.push(new On(u.from+n,u.to+n,u.type))}return a}function uK(o,n,a,c,u,A,g){function E(C,b){for(var N=0;N<C.local.length;N++){var L=C.local[N].map(c,u,b);L?a.push(L):g.onRemove&&g.onRemove(C.local[N].spec)}for(var Q=0;Q<C.children.length;Q+=3)E(C.children[Q+2],C.children[Q]+b+1)}for(var I=0;I<o.length;I+=3)o[I+1]==-1&&E(o[I+2],n[I]+A+1);return a}function Pk(o,n,a){if(n.isLeaf)return null;for(var c=a+n.nodeSize,u=null,A=0,g=void 0;A<o.length;A++)(g=o[A])&&g.from>a&&g.to<c&&((u||(u=[])).push(g),o[A]=null);return u}function Bk(o){for(var n=[],a=0;a<o.length;a++)o[a]!=null&&n.push(o[a]);return n}function Nf(o,n,a,c){var u=[],A=!1;n.forEach(function(I,C){var b=Pk(o,I,C+a);if(b){A=!0;var N=Nf(b,I,a+C+1,c);N!=ci&&u.push(C,C+I.nodeSize,N)}});for(var g=Lk(A?Bk(o):o,-a).sort(Zc),E=0;E<g.length;E++)g[E].type.valid(n,g[E])||(c.onRemove&&c.onRemove(g[E].spec),g.splice(E--,1));return g.length||u.length?new Nr(g,u):ci}function Zc(o,n){return o.from-n.from||o.to-n.to}function dv(o){for(var n=o,a=0;a<n.length-1;a++){var c=n[a];if(c.from!=c.to)for(var u=a+1;u<n.length;u++){var A=n[u];if(A.from==c.from){A.to!=c.to&&(n==o&&(n=o.slice()),n[u]=A.copy(A.from,c.to),EO(n,u+1,A.copy(c.to,A.to)));continue}else{A.from<c.to&&(n==o&&(n=o.slice()),n[a]=c.copy(c.from,A.from),EO(n,u,c.copy(A.from,c.to)));break}}}return n}function EO(o,n,a){for(;n<o.length&&Zc(a,o[n])>0;)n++;o.splice(n,0,a)}function uv(o){var n=[];return o.someProp("decorations",function(a){var c=a(o.state);c&&c!=ci&&n.push(c)}),o.cursorWrapper&&n.push(Nr.create(o.state.doc,[o.cursorWrapper.deco])),jo.from(n)}var kn=function(n,a){this._props=a,this.state=a.state,this.directPlugins=a.plugins||[],this.directPlugins.forEach(Qk),this.dispatch=this.dispatch.bind(this),this._root=null,this.focused=!1,this.trackWrites=null,this.dom=n&&n.mount||document.createElement("div"),n&&(n.appendChild?n.appendChild(this.dom):n.apply?n(this.dom):n.mount&&(this.mounted=!0)),this.editable=xk(this),this.markCursor=null,this.cursorWrapper=null,Uk(this),this.nodeViews=Fk(this),this.docView=uk(this.state.doc,Mk(this),uv(this),this.dom,this),this.lastSelectedViewDesc=null,this.dragging=null,YH(this),this.prevDirectPlugins=[],this.pluginViews=[],this.updatePluginViews()},Of={props:{configurable:!0},root:{configurable:!0},isDestroyed:{configurable:!0}};Of.props.get=function(){if(this._props.state!=this.state){var o=this._props;this._props={};for(var n in o)this._props[n]=o[n];this._props.state=this.state}return this._props};kn.prototype.update=function(n){n.handleDOMEvents!=this._props.handleDOMEvents&&ov(this),this._props=n,n.plugins&&(n.plugins.forEach(Qk),this.directPlugins=n.plugins),this.updateStateInner(n.state,!0)};kn.prototype.setProps=function(n){var a={};for(var c in this._props)a[c]=this._props[c];a.state=this.state;for(var u in n)a[u]=n[u];this.update(a)};kn.prototype.updateState=function(n){this.updateStateInner(n,this.state.plugins!=n.plugins)};kn.prototype.updateStateInner=function(n,a){var c=this,u=this.state,A=!1,g=!1;if(n.storedMarks&&this.composing&&(kk(this),g=!0),this.state=n,a){var E=Fk(this);pK(E,this.nodeViews)&&(this.nodeViews=E,A=!0),ov(this)}this.editable=xk(this),Uk(this);var I=uv(this),C=Mk(this),b=a?"reset":n.scrollToSelection>u.scrollToSelection?"to selection":"preserve",N=A||!this.docView.matchesNode(n.doc,C,I);(N||!n.selection.eq(u.selection))&&(g=!0);var L=b=="preserve"&&g&&this.dom.style.overflowAnchor==null&&oH(this);if(g){this.domObserver.stop();var Q=N&&(Bt.ie||Bt.chrome)&&!this.composing&&!u.selection.empty&&!n.selection.empty&&hK(u.selection,n.selection);if(N){var G=Bt.chrome?this.trackWrites=this.root.getSelection().focusNode:null;(A||!this.docView.update(n.doc,C,I,this))&&(this.docView.updateOuterDeco([]),this.docView.destroy(),this.docView=uk(n.doc,C,I,this.dom,this)),G&&!this.trackWrites&&(Q=!0)}Q||!(this.mouseDown&&this.domObserver.currentSelection.eq(this.root.getSelection())&&OH(this))?rc(this,Q):(_k(this,n.selection),this.domObserver.setCurSelection()),this.domObserver.start()}if(this.updatePluginViews(u),b=="reset")this.dom.scrollTop=0;else if(b=="to selection"){var Z=this.root.getSelection().focusNode;this.someProp("handleScrollToSelection",function(dt){return dt(c)})||(n.selection instanceof ke?tO(this,this.docView.domAfterPos(n.selection.from).getBoundingClientRect(),Z):tO(this,this.coordsAtPos(n.selection.head,1),Z))}else L&&sH(L)};kn.prototype.destroyPluginViews=function(){for(var n;n=this.pluginViews.pop();)n.destroy&&n.destroy()};kn.prototype.updatePluginViews=function(n){if(!n||n.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(var a=0;a<this.directPlugins.length;a++){var c=this.directPlugins[a];c.spec.view&&this.pluginViews.push(c.spec.view(this))}for(var u=0;u<this.state.plugins.length;u++){var A=this.state.plugins[u];A.spec.view&&this.pluginViews.push(A.spec.view(this))}}else for(var g=0;g<this.pluginViews.length;g++){var E=this.pluginViews[g];E.update&&E.update(this,n)}};kn.prototype.someProp=function(n,a){var c=this._props&&this._props[n],u;if(c!=null&&(u=a?a(c):c))return u;for(var A=0;A<this.directPlugins.length;A++){var g=this.directPlugins[A].props[n];if(g!=null&&(u=a?a(g):g))return u}var E=this.state.plugins;if(E)for(var I=0;I<E.length;I++){var C=E[I].props[n];if(C!=null&&(u=a?a(C):C))return u}};kn.prototype.hasFocus=function(){return this.root.activeElement==this.dom};kn.prototype.focus=function(){this.domObserver.stop(),this.editable&&aH(this.dom),rc(this),this.domObserver.start()};Of.root.get=function(){var o=this._root;if(o==null){for(var n=this.dom.parentNode;n;n=n.parentNode)if(n.nodeType==9||n.nodeType==11&&n.host)return n.getSelection||(Object.getPrototypeOf(n).getSelection=function(){return document.getSelection()}),this._root=n}return o||document};kn.prototype.posAtCoords=function(n){return hH(this,n)};kn.prototype.coordsAtPos=function(n,a){return a===void 0&&(a=1),ak(this,n,a)};kn.prototype.domAtPos=function(n,a){return a===void 0&&(a=0),this.docView.domFromPos(n,a)};kn.prototype.nodeDOM=function(n){var a=this.docView.descAt(n);return a?a.nodeDOM:null};kn.prototype.posAtDOM=function(n,a,c){c===void 0&&(c=-1);var u=this.docView.posFromDOM(n,a,c);if(u==null)throw new RangeError("DOM position not inside the editor");return u};kn.prototype.endOfTextblock=function(n,a){return mH(this,a||this.state,n)};kn.prototype.destroy=function(){!this.docView||(qH(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],uv(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null)};Of.isDestroyed.get=function(){return this.docView==null};kn.prototype.dispatchEvent=function(n){return zH(this,n)};kn.prototype.dispatch=function(n){var a=this._props.dispatchTransaction;a?a.call(this,n):this.updateState(this.state.apply(n))};Object.defineProperties(kn.prototype,Of);function Mk(o){var n=Object.create(null);return n.class="ProseMirror",n.contenteditable=String(o.editable),n.translate="no",o.someProp("attributes",function(a){if(typeof a=="function"&&(a=a(o.state)),a)for(var c in a)c=="class"&&(n.class+=" "+a[c]),c=="style"?n.style=(n.style?n.style+";":"")+a[c]:!n[c]&&c!="contenteditable"&&c!="nodeName"&&(n[c]=String(a[c]))}),[On.node(0,o.state.doc.content.size,n)]}function Uk(o){if(o.markCursor){var n=document.createElement("img");n.className="ProseMirror-separator",n.setAttribute("mark-placeholder","true"),o.cursorWrapper={dom:n,deco:On.widget(o.state.selection.head,n,{raw:!0,marks:o.markCursor})}}else o.cursorWrapper=null}function xk(o){return!o.someProp("editable",function(n){return n(o.state)===!1})}function hK(o,n){var a=Math.min(o.$anchor.sharedDepth(o.head),n.$anchor.sharedDepth(n.head));return o.$anchor.start(a)!=n.$anchor.start(a)}function Fk(o){var n={};return o.someProp("nodeViews",function(a){for(var c in a)Object.prototype.hasOwnProperty.call(n,c)||(n[c]=a[c])}),n}function pK(o,n){var a=0,c=0;for(var u in o){if(o[u]!=n[u])return!0;a++}for(var A in n)c++;return a!=c}function Qk(o){if(o.spec.state||o.spec.filterTransaction||o.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var $a={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",229:"q"},uf={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"',229:"Q"},_O=typeof navigator!="undefined"&&/Chrome\/(\d+)/.exec(navigator.userAgent),AK=typeof navigator!="undefined"&&/Apple Computer/.test(navigator.vendor),fK=typeof navigator!="undefined"&&/Gecko\/\d+/.test(navigator.userAgent),IO=typeof navigator!="undefined"&&/Mac/.test(navigator.platform),gK=typeof navigator!="undefined"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),mK=_O&&(IO||+_O[1]<57)||fK&&IO;for(var ii=0;ii<10;ii++)$a[48+ii]=$a[96+ii]=String(ii);for(var ii=1;ii<=24;ii++)$a[ii+111]="F"+ii;for(var ii=65;ii<=90;ii++)$a[ii]=String.fromCharCode(ii+32),uf[ii]=String.fromCharCode(ii);for(var q_ in $a)uf.hasOwnProperty(q_)||(uf[q_]=$a[q_]);function EK(o){var n=mK&&(o.ctrlKey||o.altKey||o.metaKey)||(AK||gK)&&o.shiftKey&&o.key&&o.key.length==1,a=!n&&o.key||(o.shiftKey?uf:$a)[o.keyCode]||o.key||"Unidentified";return a=="Esc"&&(a="Escape"),a=="Del"&&(a="Delete"),a=="Left"&&(a="ArrowLeft"),a=="Up"&&(a="ArrowUp"),a=="Right"&&(a="ArrowRight"),a=="Down"&&(a="ArrowDown"),a}var _K=typeof navigator!="undefined"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!1;function IK(o){var n=o.split(/-(?!$)/),a=n[n.length-1];a=="Space"&&(a=" ");for(var c,u,A,g,E=0;E<n.length-1;E++){var I=n[E];if(/^(cmd|meta|m)$/i.test(I))g=!0;else if(/^a(lt)?$/i.test(I))c=!0;else if(/^(c|ctrl|control)$/i.test(I))u=!0;else if(/^s(hift)?$/i.test(I))A=!0;else if(/^mod$/i.test(I))_K?g=!0:u=!0;else throw new Error("Unrecognized modifier name: "+I)}return c&&(a="Alt-"+a),u&&(a="Ctrl-"+a),g&&(a="Meta-"+a),A&&(a="Shift-"+a),a}function vK(o){var n=Object.create(null);for(var a in o)n[IK(a)]=o[a];return n}function J_(o,n,a){return n.altKey&&(o="Alt-"+o),n.ctrlKey&&(o="Ctrl-"+o),n.metaKey&&(o="Meta-"+o),a!==!1&&n.shiftKey&&(o="Shift-"+o),o}function CK(o){return new Fn({props:{handleKeyDown:Vk(o)}})}function Vk(o){var n=vK(o);return function(a,c){var u=EK(c),A=u.length==1&&u!=" ",g,E=n[J_(u,c,!A)];if(E&&E(a.state,a.dispatch,a))return!0;if(A&&(c.shiftKey||c.altKey||c.metaKey||u.charCodeAt(0)>127)&&(g=$a[c.keyCode])&&g!=u){var I=n[J_(g,c,!0)];if(I&&I(a.state,a.dispatch,a))return!0}else if(A&&c.shiftKey){var C=n[J_(u,c,!0)];if(C&&C(a.state,a.dispatch,a))return!0}return!1}}function SK(o){return Object.prototype.toString.call(o).slice(8,-1)}function z_(o){return SK(o)!=="Object"?!1:o.constructor===Object&&Object.getPrototypeOf(o)===Object.prototype}function kf(o,n){const a=Nt({},o);return z_(o)&&z_(n)&&Object.keys(n).forEach(c=>{z_(n[c])?c in o?a[c]=kf(o[c],n[c]):Object.assign(a,{[c]:n[c]}):Object.assign(a,{[c]:n[c]})}),a}function Gk(o){return typeof o=="function"}function Ge(o,n=void 0,...a){return Gk(o)?n?o.bind(n)(...a):o(...a):o}function ee(o,n,a){return o.config[n]===void 0&&o.parent?ee(o.parent,n,a):typeof o.config[n]=="function"?o.config[n].bind(zn(Nt({},a),{parent:o.parent?ee(o.parent,n,a):null})):o.config[n]}class Xn{constructor(n={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config=Nt(Nt({},this.config),n),this.name=this.config.name,n.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=Ge(ee(this,"addOptions",{name:this.name}))),this.storage=Ge(ee(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(n={}){return new Xn(n)}configure(n={}){const a=this.extend();return a.options=kf(this.options,n),a.storage=Ge(ee(a,"addStorage",{name:a.name,options:a.options})),a}extend(n={}){const a=new Xn(n);return a.parent=this,this.child=a,a.name=n.name?n.name:a.parent.name,n.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${a.name}".`),a.options=Ge(ee(a,"addOptions",{name:a.name})),a.storage=Ge(ee(a,"addStorage",{name:a.name,options:a.options})),a}}function jk(o,n,a){const{from:c,to:u}=n,{blockSeparator:A=`

`,textSerializers:g={}}=a||{};let E="",I=!0;return o.nodesBetween(c,u,(C,b,N,L)=>{var Q;const G=g==null?void 0:g[C.type.name];G?(C.isBlock&&!I&&(E+=A,I=!0),E+=G({node:C,pos:b,parent:N,index:L})):C.isText?(E+=(Q=C==null?void 0:C.text)===null||Q===void 0?void 0:Q.slice(Math.max(c,b)-b,u-b),I=!1):C.isBlock&&!I&&(E+=A,I=!0)}),E}function Hk(o){return Object.fromEntries(Object.entries(o.nodes).filter(([,n])=>n.spec.toText).map(([n,a])=>[n,a.spec.toText]))}const TK=Xn.create({name:"clipboardTextSerializer",addProseMirrorPlugins(){return[new Fn({key:new Ti("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:o}=this,{state:n,schema:a}=o,{doc:c,selection:u}=n,{ranges:A}=u,g=Math.min(...A.map(b=>b.$from.pos)),E=Math.max(...A.map(b=>b.$to.pos)),I=Hk(a);return jk(c,{from:g,to:E},{textSerializers:I})}}})]}}),RK=()=>({editor:o,view:n})=>(requestAnimationFrame(()=>{var a;o.isDestroyed||(n.dom.blur(),(a=window==null?void 0:window.getSelection())===null||a===void 0||a.removeAllRanges())}),!0);var yK=Object.freeze({__proto__:null,blur:RK});const wK=(o=!1)=>({commands:n})=>n.setContent("",o);var bK=Object.freeze({__proto__:null,clearContent:wK});const NK=()=>({state:o,tr:n,dispatch:a})=>{const{selection:c}=n,{ranges:u}=c;return a&&u.forEach(({$from:A,$to:g})=>{o.doc.nodesBetween(A.pos,g.pos,(E,I)=>{if(E.type.isText)return;const{doc:C,mapping:b}=n,N=C.resolve(b.map(I)),L=C.resolve(b.map(I+E.nodeSize)),Q=N.blockRange(L);if(!Q)return;const G=Td(Q);if(E.type.isTextblock){const{defaultType:Z}=N.parent.contentMatchAt(N.index());n.setNodeMarkup(Q.start,Z)}(G||G===0)&&n.lift(Q,G)})}),!0};var OK=Object.freeze({__proto__:null,clearNodes:NK});const kK=o=>n=>o(n);var DK=Object.freeze({__proto__:null,command:kK});const LK=()=>({state:o,dispatch:n})=>$2(o,n);var PK=Object.freeze({__proto__:null,createParagraphNear:LK});function Zn(o,n){if(typeof o=="string"){if(!n.nodes[o])throw Error(`There is no node type named '${o}'. Maybe you forgot to add the extension?`);return n.nodes[o]}return o}const BK=o=>({tr:n,state:a,dispatch:c})=>{const u=Zn(o,a.schema),A=n.selection.$anchor;for(let g=A.depth;g>0;g-=1)if(A.node(g).type===u){if(c){const I=A.before(g),C=A.after(g);n.delete(I,C).scrollIntoView()}return!0}return!1};var MK=Object.freeze({__proto__:null,deleteNode:BK});const UK=o=>({tr:n,dispatch:a})=>{const{from:c,to:u}=o;return a&&n.delete(c,u),!0};var xK=Object.freeze({__proto__:null,deleteRange:UK});const FK=()=>({state:o,dispatch:n})=>YI(o,n);var QK=Object.freeze({__proto__:null,deleteSelection:FK});const VK=()=>({commands:o})=>o.keyboardShortcut("Enter");var GK=Object.freeze({__proto__:null,enter:VK});const jK=()=>({state:o,dispatch:n})=>Z2(o,n);var HK=Object.freeze({__proto__:null,exitCode:jK});function nc(o,n){if(typeof o=="string"){if(!n.marks[o])throw Error(`There is no mark type named '${o}'. Maybe you forgot to add the extension?`);return n.marks[o]}return o}function hv(o){return Object.prototype.toString.call(o)==="[object RegExp]"}function hf(o,n,a={strict:!0}){const c=Object.keys(n);return c.length?c.every(u=>a.strict?n[u]===o[u]:hv(n[u])?n[u].test(o[u]):n[u]===o[u]):!0}function CI(o,n,a={}){return o.find(c=>c.type===n&&hf(c.attrs,a))}function KK(o,n,a={}){return!!CI(o,n,a)}function pv(o,n,a={}){if(!o||!n)return;const c=o.parent.childAfter(o.parentOffset);if(!c.node)return;const u=CI(c.node.marks,n,a);if(!u)return;let A=o.index(),g=o.start()+c.offset,E=A+1,I=g+c.node.nodeSize;for(CI(c.node.marks,n,a);A>0&&u.isInSet(o.parent.child(A-1).marks);)A-=1,g-=o.parent.child(A).nodeSize;for(;E<o.parent.childCount&&KK(o.parent.child(E).marks,n,a);)I+=o.parent.child(E).nodeSize,E+=1;return{from:g,to:I}}const WK=(o,n={})=>({tr:a,state:c,dispatch:u})=>{const A=nc(o,c.schema),{doc:g,selection:E}=a,{$from:I,from:C,to:b}=E;if(u){const N=pv(I,A,n);if(N&&N.from<=C&&N.to>=b){const L=rr.create(g,N.from,N.to);a.setSelection(L)}}return!0};var YK=Object.freeze({__proto__:null,extendMarkRange:WK});const qK=o=>n=>{const a=typeof o=="function"?o(n):o;for(let c=0;c<a.length;c+=1)if(a[c](n))return!0;return!1};var JK=Object.freeze({__proto__:null,first:qK});function zK(o){var n;return((n=o.constructor)===null||n===void 0?void 0:n.toString().substring(0,5))==="class"}function Kk(o){return o&&typeof o=="object"&&!Array.isArray(o)&&!zK(o)}function Wk(o){return Kk(o)&&o instanceof rr}function Av(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}function ma(o=0,n=0,a=0){return Math.min(Math.max(o,n),a)}function Yk(o,n=null){if(!n)return null;const a=De.atStart(o),c=De.atEnd(o);if(n==="start"||n===!0)return a;if(n==="end")return c;const u=a.from,A=c.to;return n==="all"?rr.create(o,ma(0,u,A),ma(o.content.size,u,A)):rr.create(o,ma(n,u,A),ma(n,u,A))}const XK=(o=null,n)=>({editor:a,view:c,tr:u,dispatch:A})=>{n=Nt({scrollIntoView:!0},n);const g=()=>{Av()&&c.dom.focus(),requestAnimationFrame(()=>{a.isDestroyed||(c.focus(),(n==null?void 0:n.scrollIntoView)&&a.commands.scrollIntoView())})};if(c.hasFocus()&&o===null||o===!1)return!0;if(A&&o===null&&!Wk(a.state.selection))return g(),!0;const E=Yk(a.state.doc,o)||a.state.selection,I=a.state.selection.eq(E);return A&&(I||u.setSelection(E),I&&u.storedMarks&&u.setStoredMarks(u.storedMarks),g()),!0};var ZK=Object.freeze({__proto__:null,focus:XK});const $K=(o,n)=>a=>o.every((c,u)=>n(c,zn(Nt({},a),{index:u})));var tW=Object.freeze({__proto__:null,forEach:$K});const eW=(o,n)=>({tr:a,commands:c})=>c.insertContentAt({from:a.selection.from,to:a.selection.to},o,n);var rW=Object.freeze({__proto__:null,insertContent:eW});function vO(o){const n=`<body>${o}</body>`;return new window.DOMParser().parseFromString(n,"text/html").body}function pf(o,n,a){if(a=Nt({slice:!0,parseOptions:{}},a),typeof o=="object"&&o!==null)try{return Array.isArray(o)?bt.fromArray(o.map(c=>n.nodeFromJSON(c))):n.nodeFromJSON(o)}catch(c){return console.warn("[tiptap warn]: Invalid content.","Passed value:",o,"Error:",c),pf("",n,a)}if(typeof o=="string"){const c=hs.fromSchema(n);return a.slice?c.parseSlice(vO(o),a.parseOptions).content:c.parse(vO(o),a.parseOptions)}return pf("",n,a)}function nW(o,n,a){const c=o.steps.length-1;if(c<n)return;const u=o.steps[c];if(!(u instanceof Sa||u instanceof to))return;const A=o.mapping.maps[c];let g=0;A.forEach((E,I,C,b)=>{g===0&&(g=b)}),o.setSelection(De.near(o.doc.resolve(g),a))}const iW=o=>o.toString().startsWith("<"),oW=(o,n,a)=>({tr:c,dispatch:u,editor:A})=>{if(u){a=Nt({parseOptions:{},updateSelection:!0},a);const g=pf(n,A.schema,{parseOptions:Nt({preserveWhitespace:"full"},a.parseOptions)});if(g.toString()==="<>")return!0;let{from:E,to:I}=typeof o=="number"?{from:o,to:o}:o,C=!0,b=!0;if((iW(g)?g:[g]).forEach(L=>{L.check(),C=C?L.isText&&L.marks.length===0:!1,b=b?L.isBlock:!1}),E===I&&b){const{parent:L}=c.doc.resolve(E);L.isTextblock&&!L.type.spec.code&&!L.childCount&&(E-=1,I+=1)}C?c.insertText(n,E,I):c.replaceWith(E,I,g),a.updateSelection&&nW(c,c.steps.length-1,-1)}return!0};var sW=Object.freeze({__proto__:null,insertContentAt:oW});const aW=()=>({state:o,dispatch:n})=>K2(o,n);var cW=Object.freeze({__proto__:null,joinBackward:aW});const lW=()=>({state:o,dispatch:n})=>q2(o,n);var dW=Object.freeze({__proto__:null,joinForward:lW});function qk(){return typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1}function uW(o){const n=o.split(/-(?!$)/);let a=n[n.length-1];a==="Space"&&(a=" ");let c,u,A,g;for(let E=0;E<n.length-1;E+=1){const I=n[E];if(/^(cmd|meta|m)$/i.test(I))g=!0;else if(/^a(lt)?$/i.test(I))c=!0;else if(/^(c|ctrl|control)$/i.test(I))u=!0;else if(/^s(hift)?$/i.test(I))A=!0;else if(/^mod$/i.test(I))Av()||qk()?g=!0:u=!0;else throw new Error(`Unrecognized modifier name: ${I}`)}return c&&(a=`Alt-${a}`),u&&(a=`Ctrl-${a}`),g&&(a=`Meta-${a}`),A&&(a=`Shift-${a}`),a}const hW=o=>({editor:n,view:a,tr:c,dispatch:u})=>{const A=uW(o).split(/-(?!$)/),g=A.find(C=>!["Alt","Ctrl","Meta","Shift"].includes(C)),E=new KeyboardEvent("keydown",{key:g==="Space"?" ":g,altKey:A.includes("Alt"),ctrlKey:A.includes("Ctrl"),metaKey:A.includes("Meta"),shiftKey:A.includes("Shift"),bubbles:!0,cancelable:!0}),I=n.captureTransaction(()=>{a.someProp("handleKeyDown",C=>C(a,E))});return I==null||I.steps.forEach(C=>{const b=C.map(c.mapping);b&&u&&c.maybeStep(b)}),!0};var pW=Object.freeze({__proto__:null,keyboardShortcut:hW});function Ah(o,n,a={}){const{from:c,to:u,empty:A}=o.selection,g=n?Zn(n,o.schema):null,E=[];o.doc.nodesBetween(c,u,(N,L)=>{if(N.isText)return;const Q=Math.max(c,L),G=Math.min(u,L+N.nodeSize);E.push({node:N,from:Q,to:G})});const I=u-c,C=E.filter(N=>g?g.name===N.node.type.name:!0).filter(N=>hf(N.node.attrs,a,{strict:!1}));return A?!!C.length:C.reduce((N,L)=>N+L.to-L.from,0)>=I}const AW=(o,n={})=>({state:a,dispatch:c})=>{const u=Zn(o,a.schema);return Ah(a,u,n)?Vj(a,c):!1};var fW=Object.freeze({__proto__:null,lift:AW});const gW=()=>({state:o,dispatch:n})=>tk(o,n);var mW=Object.freeze({__proto__:null,liftEmptyBlock:gW});const EW=o=>({state:n,dispatch:a})=>{const c=Zn(o,n.schema);return zj(c)(n,a)};var _W=Object.freeze({__proto__:null,liftListItem:EW});const IW=()=>({state:o,dispatch:n})=>X2(o,n);var vW=Object.freeze({__proto__:null,newlineInCode:IW});function Df(o,n){return n.nodes[o]?"node":n.marks[o]?"mark":null}function CO(o,n){const a=typeof n=="string"?[n]:n;return Object.keys(o).reduce((c,u)=>(a.includes(u)||(c[u]=o[u]),c),{})}const CW=(o,n)=>({tr:a,state:c,dispatch:u})=>{let A=null,g=null;const E=Df(typeof o=="string"?o:o.name,c.schema);return E?(E==="node"&&(A=Zn(o,c.schema)),E==="mark"&&(g=nc(o,c.schema)),u&&a.selection.ranges.forEach(I=>{c.doc.nodesBetween(I.$from.pos,I.$to.pos,(C,b)=>{A&&A===C.type&&a.setNodeMarkup(b,void 0,CO(C.attrs,n)),g&&C.marks.length&&C.marks.forEach(N=>{g===N.type&&a.addMark(b,b+C.nodeSize,g.create(CO(N.attrs,n)))})})}),!0):!1};var SW=Object.freeze({__proto__:null,resetAttributes:CW});const TW=()=>({tr:o,dispatch:n})=>(n&&o.scrollIntoView(),!0);var RW=Object.freeze({__proto__:null,scrollIntoView:TW});const yW=()=>({tr:o,commands:n})=>n.setTextSelection({from:0,to:o.doc.content.size});var wW=Object.freeze({__proto__:null,selectAll:yW});const bW=()=>({state:o,dispatch:n})=>W2(o,n);var NW=Object.freeze({__proto__:null,selectNodeBackward:bW});const OW=()=>({state:o,dispatch:n})=>J2(o,n);var kW=Object.freeze({__proto__:null,selectNodeForward:OW});const DW=()=>({state:o,dispatch:n})=>jj(o,n);var LW=Object.freeze({__proto__:null,selectParentNode:DW});const PW=()=>({state:o,dispatch:n})=>zI(o,n);var BW=Object.freeze({__proto__:null,selectTextblockEnd:PW});const MW=()=>({state:o,dispatch:n})=>JI(o,n);var UW=Object.freeze({__proto__:null,selectTextblockStart:MW});function Jk(o,n,a={}){return pf(o,n,{slice:!1,parseOptions:a})}const xW=(o,n=!1,a={})=>({tr:c,editor:u,dispatch:A})=>{const{doc:g}=c,E=Jk(o,u.schema,a),I=rr.create(g,0,g.content.size);return A&&c.setSelection(I).replaceSelectionWith(E,!1).setMeta("preventUpdate",!n),!0};var FW=Object.freeze({__proto__:null,setContent:xW});function zk(o,n){const a=nc(n,o.schema),{from:c,to:u,empty:A}=o.selection,g=[];A?(o.storedMarks&&g.push(...o.storedMarks),g.push(...o.selection.$head.marks())):o.doc.nodesBetween(c,u,I=>{g.push(...I.marks)});const E=g.find(I=>I.type.name===a.name);return E?Nt({},E.attrs):{}}const QW=(o,n={})=>({tr:a,state:c,dispatch:u})=>{const{selection:A}=a,{empty:g,ranges:E}=A,I=nc(o,c.schema);if(u)if(g){const C=zk(c,I);a.addStoredMark(I.create(Nt(Nt({},C),n)))}else E.forEach(C=>{const b=C.$from.pos,N=C.$to.pos;c.doc.nodesBetween(b,N,(L,Q)=>{const G=Math.max(Q,b),Z=Math.min(Q+L.nodeSize,N);L.marks.find(lt=>lt.type===I)?L.marks.forEach(lt=>{I===lt.type&&a.addMark(G,Z,I.create(Nt(Nt({},lt.attrs),n)))}):a.addMark(G,Z,I.create(n))})});return!0};var VW=Object.freeze({__proto__:null,setMark:QW});const GW=(o,n)=>({tr:a})=>(a.setMeta(o,n),!0);var jW=Object.freeze({__proto__:null,setMeta:GW});const HW=(o,n={})=>({state:a,dispatch:c,chain:u})=>{const A=Zn(o,a.schema);return A.isTextblock?u().command(({commands:g})=>qN(A,n)(a)?!0:g.clearNodes()).command(({state:g})=>qN(A,n)(g,c)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)};var KW=Object.freeze({__proto__:null,setNode:HW});const WW=o=>({tr:n,dispatch:a})=>{if(a){const{doc:c}=n,u=De.atStart(c).from,A=De.atEnd(c).to,g=ma(o,u,A),E=ke.create(c,g);n.setSelection(E)}return!0};var YW=Object.freeze({__proto__:null,setNodeSelection:WW});const qW=o=>({tr:n,dispatch:a})=>{if(a){const{doc:c}=n,{from:u,to:A}=typeof o=="number"?{from:o,to:o}:o,g=rr.atStart(c).from,E=rr.atEnd(c).to,I=ma(u,g,E),C=ma(A,g,E),b=rr.create(c,I,C);n.setSelection(b)}return!0};var JW=Object.freeze({__proto__:null,setTextSelection:qW});const zW=o=>({state:n,dispatch:a})=>{const c=Zn(o,n.schema);return $j(c)(n,a)};var XW=Object.freeze({__proto__:null,sinkListItem:zW});function ZA(o,n,a){return Object.fromEntries(Object.entries(a).filter(([c])=>{const u=o.find(A=>A.type===n&&A.name===c);return u?u.attribute.keepOnSplit:!1}))}function ZW(o){for(let n=0;n<o.edgeCount;n+=1){const{type:a}=o.edge(n);if(a.isTextblock&&!a.hasRequiredAttrs())return a}return null}function SO(o,n){const a=o.storedMarks||o.selection.$to.parentOffset&&o.selection.$from.marks();if(a){const c=a.filter(u=>n==null?void 0:n.includes(u.type.name));o.tr.ensureMarks(c)}}const $W=({keepMarks:o=!0}={})=>({tr:n,state:a,dispatch:c,editor:u})=>{const{selection:A,doc:g}=n,{$from:E,$to:I}=A,C=u.extensionManager.attributes,b=ZA(C,E.node().type.name,E.node().attrs);if(A instanceof ke&&A.node.isBlock)return!E.parentOffset||!Ia(g,E.pos)?!1:(c&&(o&&SO(a,u.extensionManager.splittableMarks),n.split(E.pos).scrollIntoView()),!0);if(!E.parent.isBlock)return!1;if(c){const N=I.parentOffset===I.parent.content.size;A instanceof rr&&n.deleteSelection();const L=E.depth===0?void 0:ZW(E.node(-1).contentMatchAt(E.indexAfter(-1)));let Q=N&&L?[{type:L,attrs:b}]:void 0,G=Ia(n.doc,n.mapping.map(E.pos),1,Q);if(!Q&&!G&&Ia(n.doc,n.mapping.map(E.pos),1,L?[{type:L}]:void 0)&&(G=!0,Q=L?[{type:L,attrs:b}]:void 0),G&&(n.split(n.mapping.map(E.pos),1,Q),L&&!N&&!E.parentOffset&&E.parent.type!==L)){const Z=n.mapping.map(E.before()),dt=n.doc.resolve(Z);E.node(-1).canReplaceWith(dt.index(),dt.index()+1,L)&&n.setNodeMarkup(n.mapping.map(E.before()),L)}o&&SO(a,u.extensionManager.splittableMarks),n.scrollIntoView()}return!0};var tY=Object.freeze({__proto__:null,splitBlock:$W});const eY=o=>({tr:n,state:a,dispatch:c,editor:u})=>{var A;const g=Zn(o,a.schema),{$from:E,$to:I}=a.selection,C=a.selection.node;if(C&&C.isBlock||E.depth<2||!E.sameParent(I))return!1;const b=E.node(-1);if(b.type!==g)return!1;const N=u.extensionManager.attributes;if(E.parent.content.size===0&&E.node(-1).childCount===E.indexAfter(-1)){if(E.depth===2||E.node(-3).type!==g||E.index(-2)!==E.node(-2).childCount-1)return!1;if(c){let dt=bt.empty;const lt=E.index(-1)?1:E.index(-2)?2:3;for(let ce=E.depth-lt;ce>=E.depth-3;ce-=1)dt=bt.from(E.node(ce).copy(dt));const et=E.indexAfter(-1)<E.node(-2).childCount?1:E.indexAfter(-2)<E.node(-3).childCount?2:3,Dt=ZA(N,E.node().type.name,E.node().attrs),J=((A=g.contentMatch.defaultType)===null||A===void 0?void 0:A.createAndFill(Dt))||void 0;dt=dt.append(bt.from(g.createAndFill(null,J)||void 0));const Ft=E.before(E.depth-(lt-1));n.replace(Ft,E.after(-et),new Kt(dt,4-lt,0));let Ot=-1;n.doc.nodesBetween(Ft,n.doc.content.size,(ce,ge)=>{if(Ot>-1)return!1;ce.isTextblock&&ce.content.size===0&&(Ot=ge+1)}),Ot>-1&&n.setSelection(rr.near(n.doc.resolve(Ot))),n.scrollIntoView()}return!0}const L=I.pos===E.end()?b.contentMatchAt(0).defaultType:null,Q=ZA(N,b.type.name,b.attrs),G=ZA(N,E.node().type.name,E.node().attrs);n.delete(E.pos,I.pos);const Z=L?[{type:g,attrs:Q},{type:L,attrs:G}]:[{type:g,attrs:Q}];return Ia(n.doc,E.pos,2)?(c&&n.split(E.pos,2,Z).scrollIntoView(),!0):!1};var rY=Object.freeze({__proto__:null,splitListItem:eY});function nY(o,n){for(let a=o.depth;a>0;a-=1){const c=o.node(a);if(n(c))return{pos:a>0?o.before(a):0,start:o.start(a),depth:a,node:c}}}function fv(o){return n=>nY(n.$from,o)}function Lf(o){const n=o.filter(u=>u.type==="extension"),a=o.filter(u=>u.type==="node"),c=o.filter(u=>u.type==="mark");return{baseExtensions:n,nodeExtensions:a,markExtensions:c}}function TO(o,n){const{nodeExtensions:a}=Lf(n),c=a.find(g=>g.name===o);if(!c)return!1;const u={name:c.name,options:c.options,storage:c.storage},A=Ge(ee(c,"group",u));return typeof A!="string"?!1:A.split(" ").includes("list")}const RO=(o,n)=>{const a=fv(g=>g.type===n)(o.selection);if(!a)return!0;const c=o.doc.resolve(Math.max(0,a.pos-1)).before(a.depth);if(c===void 0)return!0;const u=o.doc.nodeAt(c);return a.node.type===(u==null?void 0:u.type)&&vh(o.doc,a.pos)&&o.join(a.pos),!0},yO=(o,n)=>{const a=fv(g=>g.type===n)(o.selection);if(!a)return!0;const c=o.doc.resolve(a.start).after(a.depth);if(c===void 0)return!0;const u=o.doc.nodeAt(c);return a.node.type===(u==null?void 0:u.type)&&vh(o.doc,c)&&o.join(c),!0},iY=(o,n)=>({editor:a,tr:c,state:u,dispatch:A,chain:g,commands:E,can:I})=>{const{extensions:C}=a.extensionManager,b=Zn(o,u.schema),N=Zn(n,u.schema),{selection:L}=u,{$from:Q,$to:G}=L,Z=Q.blockRange(G);if(!Z)return!1;const dt=fv(lt=>TO(lt.type.name,C))(L);if(Z.depth>=1&&dt&&Z.depth-dt.depth<=1){if(dt.node.type===b)return E.liftListItem(N);if(TO(dt.node.type.name,C)&&b.validContent(dt.node.content)&&A)return g().command(()=>(c.setNodeMarkup(dt.pos,b),!0)).command(()=>RO(c,b)).command(()=>yO(c,b)).run()}return g().command(()=>I().wrapInList(b)?!0:E.clearNodes()).wrapInList(b).command(()=>RO(c,b)).command(()=>yO(c,b)).run()};var oY=Object.freeze({__proto__:null,toggleList:iY});function SI(o,n,a={}){const{empty:c,ranges:u}=o.selection,A=n?nc(n,o.schema):null;if(c)return!!(o.storedMarks||o.selection.$from.marks()).filter(N=>A?A.name===N.type.name:!0).find(N=>hf(N.attrs,a,{strict:!1}));let g=0;const E=[];if(u.forEach(({$from:N,$to:L})=>{const Q=N.pos,G=L.pos;o.doc.nodesBetween(Q,G,(Z,dt)=>{if(!Z.isText&&!Z.marks.length)return;const lt=Math.max(Q,dt),et=Math.min(G,dt+Z.nodeSize);g+=et-lt,E.push(...Z.marks.map(J=>({mark:J,from:lt,to:et})))})}),g===0)return!1;const I=E.filter(N=>A?A.name===N.mark.type.name:!0).filter(N=>hf(N.mark.attrs,a,{strict:!1})).reduce((N,L)=>N+L.to-L.from,0),C=E.filter(N=>A?N.mark.type!==A&&N.mark.type.excludes(A):!0).reduce((N,L)=>N+L.to-L.from,0);return(I>0?I+C:I)>=g}const sY=(o,n={},a={})=>({state:c,commands:u})=>{const{extendEmptyMarkRange:A=!1}=a,g=nc(o,c.schema);return SI(c,g,n)?u.unsetMark(g,{extendEmptyMarkRange:A}):u.setMark(g,n)};var aY=Object.freeze({__proto__:null,toggleMark:sY});const cY=(o,n,a={})=>({state:c,commands:u})=>{const A=Zn(o,c.schema),g=Zn(n,c.schema);return Ah(c,A,a)?u.setNode(g):u.setNode(A,a)};var lY=Object.freeze({__proto__:null,toggleNode:cY});const dY=(o,n={})=>({state:a,commands:c})=>{const u=Zn(o,a.schema);return Ah(a,u,n)?c.lift(u):c.wrapIn(u,n)};var uY=Object.freeze({__proto__:null,toggleWrap:dY});const hY=()=>({state:o,dispatch:n})=>{const a=o.plugins;for(let c=0;c<a.length;c+=1){const u=a[c];let A;if(u.spec.isInputRules&&(A=u.getState(o))){if(n){const g=o.tr,E=A.transform;for(let I=E.steps.length-1;I>=0;I-=1)g.step(E.steps[I].invert(E.docs[I]));if(A.text){const I=g.doc.resolve(A.from).marks();g.replaceWith(A.from,A.to,o.schema.text(A.text,I))}else g.delete(A.from,A.to)}return!0}}return!1};var pY=Object.freeze({__proto__:null,undoInputRule:hY});const AY=()=>({tr:o,dispatch:n})=>{const{selection:a}=o,{empty:c,ranges:u}=a;return c||n&&u.forEach(A=>{o.removeMark(A.$from.pos,A.$to.pos)}),!0};var fY=Object.freeze({__proto__:null,unsetAllMarks:AY});const gY=(o,n={})=>({tr:a,state:c,dispatch:u})=>{var A;const{extendEmptyMarkRange:g=!1}=n,{selection:E}=a,I=nc(o,c.schema),{$from:C,empty:b,ranges:N}=E;if(!u)return!0;if(b&&g){let{from:L,to:Q}=E;const G=(A=C.marks().find(dt=>dt.type===I))===null||A===void 0?void 0:A.attrs,Z=pv(C,I,G);Z&&(L=Z.from,Q=Z.to),a.removeMark(L,Q,I)}else N.forEach(L=>{a.removeMark(L.$from.pos,L.$to.pos,I)});return a.removeStoredMark(I),!0};var mY=Object.freeze({__proto__:null,unsetMark:gY});const EY=(o,n={})=>({tr:a,state:c,dispatch:u})=>{let A=null,g=null;const E=Df(typeof o=="string"?o:o.name,c.schema);return E?(E==="node"&&(A=Zn(o,c.schema)),E==="mark"&&(g=nc(o,c.schema)),u&&a.selection.ranges.forEach(I=>{const C=I.$from.pos,b=I.$to.pos;c.doc.nodesBetween(C,b,(N,L)=>{A&&A===N.type&&a.setNodeMarkup(L,void 0,Nt(Nt({},N.attrs),n)),g&&N.marks.length&&N.marks.forEach(Q=>{if(g===Q.type){const G=Math.max(L,C),Z=Math.min(L+N.nodeSize,b);a.addMark(G,Z,g.create(Nt(Nt({},Q.attrs),n)))}})})}),!0):!1};var _Y=Object.freeze({__proto__:null,updateAttributes:EY});const IY=(o,n={})=>({state:a,dispatch:c})=>{const u=Zn(o,a.schema);return Wj(u,n)(a,c)};var vY=Object.freeze({__proto__:null,wrapIn:IY});const CY=(o,n={})=>({state:a,dispatch:c})=>{const u=Zn(o,a.schema);return qj(u,n)(a,c)};var SY=Object.freeze({__proto__:null,wrapInList:CY});const TY=Xn.create({name:"commands",addCommands(){return Nt(Nt(Nt(Nt(Nt(Nt(Nt(Nt(Nt(Nt(Nt(Nt(Nt(Nt(Nt(Nt(Nt(Nt(Nt(Nt(Nt(Nt(Nt(Nt(Nt(Nt(Nt(Nt(Nt(Nt(Nt(Nt(Nt(Nt(Nt(Nt(Nt(Nt(Nt(Nt(Nt(Nt(Nt(Nt(Nt(Nt(Nt(Nt(Nt(Nt({},yK),bK),OK),DK),PK),MK),xK),QK),GK),HK),YK),JK),ZK),tW),rW),sW),cW),dW),pW),fW),mW),_W),vW),SW),RW),wW),NW),kW),LW),BW),UW),FW),VW),jW),KW),YW),JW),XW),tY),rY),oY),aY),lY),uY),pY),fY),mY),_Y),vY),SY)}}),RY=Xn.create({name:"editable",addProseMirrorPlugins(){return[new Fn({key:new Ti("editable"),props:{editable:()=>this.editor.options.editable}})]}}),yY=Xn.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:o}=this;return[new Fn({key:new Ti("focusEvents"),props:{handleDOMEvents:{focus:(n,a)=>{o.isFocused=!0;const c=o.state.tr.setMeta("focus",{event:a}).setMeta("addToHistory",!1);return n.dispatch(c),!1},blur:(n,a)=>{o.isFocused=!1;const c=o.state.tr.setMeta("blur",{event:a}).setMeta("addToHistory",!1);return n.dispatch(c),!1}}}})]}});function Pf(o){const{state:n,transaction:a}=o;let{selection:c}=a,{doc:u}=a,{storedMarks:A}=a;return zn(Nt({},n),{schema:n.schema,plugins:n.plugins,apply:n.apply.bind(n),applyTransaction:n.applyTransaction.bind(n),reconfigure:n.reconfigure.bind(n),toJSON:n.toJSON.bind(n),get storedMarks(){return A},get selection(){return c},get doc(){return u},get tr(){return c=a.selection,u=a.doc,A=a.storedMarks,a}})}class Bf{constructor(n){this.editor=n.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=n.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:n,editor:a,state:c}=this,{view:u}=a,{tr:A}=c,g=this.buildProps(A);return Object.fromEntries(Object.entries(n).map(([E,I])=>[E,(...b)=>{const N=I(...b)(g);return!A.getMeta("preventDispatch")&&!this.hasCustomState&&u.dispatch(A),N}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(n,a=!0){const{rawCommands:c,editor:u,state:A}=this,{view:g}=u,E=[],I=!!n,C=n||A.tr,b=()=>(!I&&a&&!C.getMeta("preventDispatch")&&!this.hasCustomState&&g.dispatch(C),E.every(L=>L===!0)),N=zn(Nt({},Object.fromEntries(Object.entries(c).map(([L,Q])=>[L,(...Z)=>{const dt=this.buildProps(C,a),lt=Q(...Z)(dt);return E.push(lt),N}]))),{run:b});return N}createCan(n){const{rawCommands:a,state:c}=this,u=void 0,A=n||c.tr,g=this.buildProps(A,u),E=Object.fromEntries(Object.entries(a).map(([I,C])=>[I,(...b)=>C(...b)(zn(Nt({},g),{dispatch:u}))]));return zn(Nt({},E),{chain:()=>this.createChain(A,u)})}buildProps(n,a=!0){const{rawCommands:c,editor:u,state:A}=this,{view:g}=u;A.storedMarks&&n.setStoredMarks(A.storedMarks);const E={tr:n,editor:u,view:g,state:Pf({state:A,transaction:n}),dispatch:a?()=>{}:void 0,chain:()=>this.createChain(n),can:()=>this.createCan(n),get commands(){return Object.fromEntries(Object.entries(c).map(([I,C])=>[I,(...b)=>C(...b)(E)]))}};return E}}const wY=Xn.create({name:"keymap",addKeyboardShortcuts(){const o=()=>this.editor.commands.first(({commands:g})=>[()=>g.undoInputRule(),()=>g.command(({tr:E})=>{const{selection:I,doc:C}=E,{empty:b,$anchor:N}=I,{pos:L,parent:Q}=N,G=De.atStart(C).from===L;return!b||!G||!Q.type.isTextblock||Q.textContent.length?!1:g.clearNodes()}),()=>g.deleteSelection(),()=>g.joinBackward(),()=>g.selectNodeBackward()]),n=()=>this.editor.commands.first(({commands:g})=>[()=>g.deleteSelection(),()=>g.joinForward(),()=>g.selectNodeForward()]),c={Enter:()=>this.editor.commands.first(({commands:g})=>[()=>g.newlineInCode(),()=>g.createParagraphNear(),()=>g.liftEmptyBlock(),()=>g.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:o,"Mod-Backspace":o,"Shift-Backspace":o,Delete:n,"Mod-Delete":n,"Mod-a":()=>this.editor.commands.selectAll()},u=zn(Nt({},c),{Home:()=>this.editor.commands.selectTextblockStart(),End:()=>this.editor.commands.selectTextblockEnd()}),A=zn(Nt({},c),{"Ctrl-h":o,"Alt-Backspace":o,"Ctrl-d":n,"Ctrl-Alt-Backspace":n,"Alt-Delete":n,"Alt-d":n,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()});return Av()||qk()?A:u},addProseMirrorPlugins(){return[new Fn({key:new Ti("clearDocument"),appendTransaction:(o,n,a)=>{if(!(o.some(G=>G.docChanged)&&!n.doc.eq(a.doc)))return;const{empty:u,from:A,to:g}=n.selection,E=De.atStart(n.doc).from,I=De.atEnd(n.doc).to,C=A===E&&g===I,b=a.doc.textBetween(0,a.doc.content.size," "," ").length===0;if(u||!C||!b)return;const N=a.tr,L=Pf({state:a,transaction:N}),{commands:Q}=new Bf({editor:this.editor,state:L});if(Q.clearNodes(),!!N.steps.length)return N}})]}}),bY=Xn.create({name:"tabindex",addProseMirrorPlugins(){return[new Fn({key:new Ti("tabindex"),props:{attributes:()=>{if(this.editor.isEditable)return{tabindex:"0"}}}})]}});var NY=Object.freeze({__proto__:null,ClipboardTextSerializer:TK,Commands:TY,Editable:RY,FocusEvents:yY,Keymap:wY,Tabindex:bY});function OY(o,n){const a=Zn(n,o.schema),{from:c,to:u}=o.selection,A=[];o.doc.nodesBetween(c,u,E=>{A.push(E)});const g=A.reverse().find(E=>E.type.name===a.name);return g?Nt({},g.attrs):{}}function kY(o,n){const a=Df(typeof n=="string"?n:n.name,o.schema);return a==="node"?OY(o,n):a==="mark"?zk(o,n):{}}function DY(o,n,a={}){if(!n)return Ah(o,null,a)||SI(o,null,a);const c=Df(n,o.schema);return c==="node"?Ah(o,n,a):c==="mark"?SI(o,n,a):!1}function LY(o,n){const a=ai.fromSchema(n).serializeFragment(o),u=document.implementation.createHTMLDocument().createElement("div");return u.appendChild(a),u.innerHTML}function PY(o,n){const a={from:0,to:o.content.size};return jk(o,a,n)}function BY(o){var n;const a=(n=o.type.createAndFill())===null||n===void 0?void 0:n.toJSON(),c=o.toJSON();return JSON.stringify(a)===JSON.stringify(c)}function MY(o){const n=document.querySelector("style[data-tiptap-style]");if(n!==null)return n;const a=document.createElement("style");return a.setAttribute("data-tiptap-style",""),a.innerHTML=o,document.getElementsByTagName("head")[0].appendChild(a),a}class Mf{constructor(n){this.find=n.find,this.handler=n.handler}}const UY=(o,n)=>{if(hv(n))return n.exec(o);const a=n(o);if(!a)return null;const c=[];return c.push(a.text),c.index=a.index,c.input=o,c.data=a.data,a.replaceWith&&(a.text.includes(a.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),c.push(a.replaceWith)),c};function X_(o){var n;const{editor:a,from:c,to:u,text:A,rules:g,plugin:E}=o,{view:I}=a;if(I.composing)return!1;const C=I.state.doc.resolve(c);if(C.parent.type.spec.code||!!((n=C.nodeBefore||C.nodeAfter)===null||n===void 0?void 0:n.marks.find(Q=>Q.type.spec.code)))return!1;let b=!1;const N=500,L=C.parent.textBetween(Math.max(0,C.parentOffset-N),C.parentOffset,void 0," ")+A;return g.forEach(Q=>{if(b)return;const G=UY(L,Q.find);if(!G)return;const Z=I.state.tr,dt=Pf({state:I.state,transaction:Z}),lt={from:c-(G[0].length-A.length),to:u},{commands:et,chain:Dt,can:J}=new Bf({editor:a,state:dt});Q.handler({state:dt,range:lt,match:G,commands:et,chain:Dt,can:J})===null||!Z.steps.length||(Z.setMeta(E,{transform:Z,from:c,to:u,text:A}),I.dispatch(Z),b=!0)}),b}function xY(o){const{editor:n,rules:a}=o,c=new Fn({state:{init(){return null},apply(u,A){const g=u.getMeta(this);return g||(u.selectionSet||u.docChanged?null:A)}},props:{handleTextInput(u,A,g,E){return X_({editor:n,from:A,to:g,text:E,rules:a,plugin:c})},handleDOMEvents:{compositionend:u=>(setTimeout(()=>{const{$cursor:A}=u.state.selection;A&&X_({editor:n,from:A.pos,to:A.pos,text:"",rules:a,plugin:c})}),!1)},handleKeyDown(u,A){if(A.key!=="Enter")return!1;const{$cursor:g}=u.state.selection;return g?X_({editor:n,from:g.pos,to:g.pos,text:`
`,rules:a,plugin:c}):!1}},isInputRules:!0});return c}function FY(o){return typeof o=="number"}class QY{constructor(n){this.find=n.find,this.handler=n.handler}}const VY=(o,n)=>{if(hv(n))return[...o.matchAll(n)];const a=n(o);return a?a.map(c=>{const u=[];return u.push(c.text),u.index=c.index,u.input=o,u.data=c.data,c.replaceWith&&(c.text.includes(c.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),u.push(c.replaceWith)),u}):[]};function GY(o){const{editor:n,state:a,from:c,to:u,rule:A}=o,{commands:g,chain:E,can:I}=new Bf({editor:n,state:a}),C=[];return a.doc.nodesBetween(c,u,(N,L)=>{if(!N.isTextblock||N.type.spec.code)return;const Q=Math.max(c,L),G=Math.min(u,L+N.content.size),Z=N.textBetween(Q-L,G-L,void 0,"\uFFFC");VY(Z,A.find).forEach(lt=>{if(lt.index===void 0)return;const et=Q+lt.index+1,Dt=et+lt[0].length,J={from:a.tr.mapping.map(et),to:a.tr.mapping.map(Dt)},Ft=A.handler({state:a,range:J,match:lt,commands:g,chain:E,can:I});C.push(Ft)})}),C.every(N=>N!==null)}function jY(o){const{editor:n,rules:a}=o;let c=null,u=!1,A=!1;return a.map(E=>new Fn({view(I){const C=b=>{var N;c=((N=I.dom.parentElement)===null||N===void 0?void 0:N.contains(b.target))?I.dom.parentElement:null};return window.addEventListener("dragstart",C),{destroy(){window.removeEventListener("dragstart",C)}}},props:{handleDOMEvents:{drop:I=>(A=c===I.dom.parentElement,!1),paste:(I,C)=>{var b;const N=(b=C.clipboardData)===null||b===void 0?void 0:b.getData("text/html");return u=!!(N==null?void 0:N.includes("data-pm-slice")),!1}}},appendTransaction:(I,C,b)=>{const N=I[0],L=N.getMeta("uiEvent")==="paste"&&!u,Q=N.getMeta("uiEvent")==="drop"&&!A;if(!L&&!Q)return;const G=C.doc.content.findDiffStart(b.doc.content),Z=C.doc.content.findDiffEnd(b.doc.content);if(!FY(G)||!Z||G===Z.b)return;const dt=b.tr,lt=Pf({state:b,transaction:dt});if(!(!GY({editor:n,state:lt,from:Math.max(G-1,0),to:Z.b,rule:E})||!dt.steps.length))return dt}}))}function Xk(o){const n=[],{nodeExtensions:a,markExtensions:c}=Lf(o),u=[...a,...c],A={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0};return o.forEach(g=>{const E={name:g.name,options:g.options,storage:g.storage},I=ee(g,"addGlobalAttributes",E);if(!I)return;I().forEach(b=>{b.types.forEach(N=>{Object.entries(b.attributes).forEach(([L,Q])=>{n.push({type:N,name:L,attribute:Nt(Nt({},A),Q)})})})})}),u.forEach(g=>{const E={name:g.name,options:g.options,storage:g.storage},I=ee(g,"addAttributes",E);if(!I)return;const C=I();Object.entries(C).forEach(([b,N])=>{n.push({type:g.name,name:b,attribute:Nt(Nt({},A),N)})})}),n}function $n(...o){return o.filter(n=>!!n).reduce((n,a)=>{const c=Nt({},n);return Object.entries(a).forEach(([u,A])=>{if(!c[u]){c[u]=A;return}u==="class"?c[u]=[c[u],A].join(" "):u==="style"?c[u]=[c[u],A].join("; "):c[u]=A}),c},{})}function TI(o,n){return n.filter(a=>a.attribute.rendered).map(a=>a.attribute.renderHTML?a.attribute.renderHTML(o.attrs)||{}:{[a.name]:o.attrs[a.name]}).reduce((a,c)=>$n(a,c),{})}function HY(o={}){return Object.keys(o).length===0&&o.constructor===Object}function KY(o){return typeof o!="string"?o:o.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(o):o==="true"?!0:o==="false"?!1:o}function wO(o,n){return o.style?o:zn(Nt({},o),{getAttrs:a=>{const c=o.getAttrs?o.getAttrs(a):o.attrs;if(c===!1)return!1;const u=n.reduce((A,g)=>{const E=g.attribute.parseHTML?g.attribute.parseHTML(a):KY(a.getAttribute(g.name));return E==null?A:zn(Nt({},A),{[g.name]:E})},{});return Nt(Nt({},c),u)}})}function bO(o){return Object.fromEntries(Object.entries(o).filter(([n,a])=>n==="attrs"&&HY(a)?!1:a!=null))}function WY(o){var n;const a=Xk(o),{nodeExtensions:c,markExtensions:u}=Lf(o),A=(n=c.find(I=>ee(I,"topNode")))===null||n===void 0?void 0:n.name,g=Object.fromEntries(c.map(I=>{const C=a.filter(dt=>dt.type===I.name),b={name:I.name,options:I.options,storage:I.storage},N=o.reduce((dt,lt)=>{const et=ee(lt,"extendNodeSchema",b);return Nt(Nt({},dt),et?et(I):{})},{}),L=bO(zn(Nt({},N),{content:Ge(ee(I,"content",b)),marks:Ge(ee(I,"marks",b)),group:Ge(ee(I,"group",b)),inline:Ge(ee(I,"inline",b)),atom:Ge(ee(I,"atom",b)),selectable:Ge(ee(I,"selectable",b)),draggable:Ge(ee(I,"draggable",b)),code:Ge(ee(I,"code",b)),defining:Ge(ee(I,"defining",b)),isolating:Ge(ee(I,"isolating",b)),attrs:Object.fromEntries(C.map(dt=>{var lt;return[dt.name,{default:(lt=dt==null?void 0:dt.attribute)===null||lt===void 0?void 0:lt.default}]}))})),Q=Ge(ee(I,"parseHTML",b));Q&&(L.parseDOM=Q.map(dt=>wO(dt,C)));const G=ee(I,"renderHTML",b);G&&(L.toDOM=dt=>G({node:dt,HTMLAttributes:TI(dt,C)}));const Z=ee(I,"renderText",b);return Z&&(L.toText=Z),[I.name,L]})),E=Object.fromEntries(u.map(I=>{const C=a.filter(Z=>Z.type===I.name),b={name:I.name,options:I.options,storage:I.storage},N=o.reduce((Z,dt)=>{const lt=ee(dt,"extendMarkSchema",b);return Nt(Nt({},Z),lt?lt(I):{})},{}),L=bO(zn(Nt({},N),{inclusive:Ge(ee(I,"inclusive",b)),excludes:Ge(ee(I,"excludes",b)),group:Ge(ee(I,"group",b)),spanning:Ge(ee(I,"spanning",b)),code:Ge(ee(I,"code",b)),attrs:Object.fromEntries(C.map(Z=>{var dt;return[Z.name,{default:(dt=Z==null?void 0:Z.attribute)===null||dt===void 0?void 0:dt.default}]}))})),Q=Ge(ee(I,"parseHTML",b));Q&&(L.parseDOM=Q.map(Z=>wO(Z,C)));const G=ee(I,"renderHTML",b);return G&&(L.toDOM=Z=>G({mark:Z,HTMLAttributes:TI(Z,C)})),[I.name,L]}));return new zc({topNode:A,nodes:g,marks:E})}function Z_(o,n){return n.nodes[o]||n.marks[o]||null}function NO(o,n){return Array.isArray(n)?n.some(a=>(typeof a=="string"?a:a.name)===o.name):n}function YY(o){const n=o.filter((a,c)=>o.indexOf(a)!==c);return[...new Set(n)]}class sd{constructor(n,a){this.splittableMarks=[],this.editor=a,this.extensions=sd.resolve(n),this.schema=WY(this.extensions),this.extensions.forEach(c=>{var u;this.editor.extensionStorage[c.name]=c.storage;const A={name:c.name,options:c.options,storage:c.storage,editor:this.editor,type:Z_(c.name,this.schema)};c.type==="mark"&&((u=Ge(ee(c,"keepOnSplit",A)))!==null&&u!==void 0?u:!0)&&this.splittableMarks.push(c.name);const g=ee(c,"onBeforeCreate",A);g&&this.editor.on("beforeCreate",g);const E=ee(c,"onCreate",A);E&&this.editor.on("create",E);const I=ee(c,"onUpdate",A);I&&this.editor.on("update",I);const C=ee(c,"onSelectionUpdate",A);C&&this.editor.on("selectionUpdate",C);const b=ee(c,"onTransaction",A);b&&this.editor.on("transaction",b);const N=ee(c,"onFocus",A);N&&this.editor.on("focus",N);const L=ee(c,"onBlur",A);L&&this.editor.on("blur",L);const Q=ee(c,"onDestroy",A);Q&&this.editor.on("destroy",Q)})}static resolve(n){const a=sd.sort(sd.flatten(n)),c=YY(a.map(u=>u.name));return c.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${c.map(u=>`'${u}'`).join(", ")}]. This can lead to issues.`),a}static flatten(n){return n.map(a=>{const c={name:a.name,options:a.options,storage:a.storage},u=ee(a,"addExtensions",c);return u?[a,...this.flatten(u())]:a}).flat(10)}static sort(n){return n.sort((c,u)=>{const A=ee(c,"priority")||100,g=ee(u,"priority")||100;return A>g?-1:A<g?1:0})}get commands(){return this.extensions.reduce((n,a)=>{const c={name:a.name,options:a.options,storage:a.storage,editor:this.editor,type:Z_(a.name,this.schema)},u=ee(a,"addCommands",c);return u?Nt(Nt({},n),u()):n},{})}get plugins(){const{editor:n}=this,a=sd.sort([...this.extensions].reverse()),c=[],u=[],A=a.map(g=>{const E={name:g.name,options:g.options,storage:g.storage,editor:n,type:Z_(g.name,this.schema)},I=[],C=ee(g,"addKeyboardShortcuts",E);if(C){const Q=Object.fromEntries(Object.entries(C()).map(([Z,dt])=>[Z,()=>dt({editor:n})])),G=CK(Q);I.push(G)}const b=ee(g,"addInputRules",E);NO(g,n.options.enableInputRules)&&b&&c.push(...b());const N=ee(g,"addPasteRules",E);NO(g,n.options.enablePasteRules)&&N&&u.push(...N());const L=ee(g,"addProseMirrorPlugins",E);if(L){const Q=L();I.push(...Q)}return I}).flat();return[xY({editor:n,rules:c}),...jY({editor:n,rules:u}),...A]}get attributes(){return Xk(this.extensions)}get nodeViews(){const{editor:n}=this,{nodeExtensions:a}=Lf(this.extensions);return Object.fromEntries(a.filter(c=>!!ee(c,"addNodeView")).map(c=>{const u=this.attributes.filter(I=>I.type===c.name),A={name:c.name,options:c.options,storage:c.storage,editor:n,type:Zn(c.name,this.schema)},g=ee(c,"addNodeView",A);if(!g)return[];const E=(I,C,b,N)=>{const L=TI(I,u);return g()({editor:n,node:I,getPos:b,decorations:N,HTMLAttributes:L,extension:c})};return[c.name,E]}))}}class qY{constructor(){this.callbacks={}}on(n,a){return this.callbacks[n]||(this.callbacks[n]=[]),this.callbacks[n].push(a),this}emit(n,...a){const c=this.callbacks[n];return c&&c.forEach(u=>u.apply(this,a)),this}off(n,a){const c=this.callbacks[n];return c&&(a?this.callbacks[n]=c.filter(u=>u!==a):delete this.callbacks[n]),this}removeAllListeners(){this.callbacks={}}}const JY=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 1px !important;
  height: 1px !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}

.tippy-box[data-animation=fade][data-state=hidden] {
  opacity: 0
}`;class zY extends qY{constructor(n={}){super();this.isFocused=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(n),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}))},0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=MY(JY))}setOptions(n={}){this.options=Nt(Nt({},this.options),n),!(!this.view||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(n){this.setOptions({editable:n})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(n,a){const c=Gk(a)?a(n,this.state.plugins):[...this.state.plugins,n],u=this.state.reconfigure({plugins:c});this.view.updateState(u)}unregisterPlugin(n){if(this.isDestroyed)return;const a=typeof n=="string"?`${n}$`:n.key,c=this.state.reconfigure({plugins:this.state.plugins.filter(u=>!u.key.startsWith(a))});this.view.updateState(c)}createExtensionManager(){const a=[...this.options.enableCoreExtensions?Object.values(NY):[],...this.options.extensions].filter(c=>["extension","node","mark"].includes(c==null?void 0:c.type));this.extensionManager=new sd(a,this)}createCommandManager(){this.commandManager=new Bf({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){const n=Jk(this.options.content,this.schema,this.options.parseOptions),a=Yk(n,this.options.autofocus);this.view=new kn(this.options.element,zn(Nt({},this.options.editorProps),{dispatchTransaction:this.dispatchTransaction.bind(this),state:vi.create({doc:n,selection:a})}));const c=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(c),this.createNodeViews();const u=this.view.dom;u.editor=this}createNodeViews(){this.view.setProps({nodeViews:this.extensionManager.nodeViews})}captureTransaction(n){this.isCapturingTransaction=!0,n(),this.isCapturingTransaction=!1;const a=this.capturedTransaction;return this.capturedTransaction=null,a}dispatchTransaction(n){if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=n;return}n.steps.forEach(g=>{var E;return(E=this.capturedTransaction)===null||E===void 0?void 0:E.step(g)});return}const a=this.state.apply(n),c=!this.state.selection.eq(a.selection);this.view.updateState(a),this.emit("transaction",{editor:this,transaction:n}),c&&this.emit("selectionUpdate",{editor:this,transaction:n});const u=n.getMeta("focus"),A=n.getMeta("blur");u&&this.emit("focus",{editor:this,event:u.event,transaction:n}),A&&this.emit("blur",{editor:this,event:A.event,transaction:n}),!(!n.docChanged||n.getMeta("preventUpdate"))&&this.emit("update",{editor:this,transaction:n})}getAttributes(n){return kY(this.state,n)}isActive(n,a){const c=typeof n=="string"?n:null,u=typeof n=="string"?a:n;return DY(this.state,c,u)}getJSON(){return this.state.doc.toJSON()}getHTML(){return LY(this.state.doc.content,this.schema)}getText(n){const{blockSeparator:a=`

`,textSerializers:c={}}=n||{};return PY(this.state.doc,{blockSeparator:a,textSerializers:Nt(Nt({},c),Hk(this.schema))})}get isEmpty(){return BY(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){this.emit("destroy"),this.view&&this.view.destroy(),this.removeAllListeners()}get isDestroyed(){var n;return!((n=this.view)===null||n===void 0?void 0:n.docView)}}class Ci{constructor(n={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config=Nt(Nt({},this.config),n),this.name=this.config.name,n.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=Ge(ee(this,"addOptions",{name:this.name}))),this.storage=Ge(ee(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(n={}){return new Ci(n)}configure(n={}){const a=this.extend();return a.options=kf(this.options,n),a.storage=Ge(ee(a,"addStorage",{name:a.name,options:a.options})),a}extend(n={}){const a=new Ci(n);return a.parent=this,this.child=a,a.name=n.name?n.name:a.parent.name,n.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${a.name}".`),a.options=Ge(ee(a,"addOptions",{name:a.name})),a.storage=Ge(ee(a,"addStorage",{name:a.name,options:a.options})),a}}class tc{constructor(n={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config=Nt(Nt({},this.config),n),this.name=this.config.name,n.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=Ge(ee(this,"addOptions",{name:this.name}))),this.storage=Ge(ee(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(n={}){return new tc(n)}configure(n={}){const a=this.extend();return a.options=kf(this.options,n),a.storage=Ge(ee(a,"addStorage",{name:a.name,options:a.options})),a}extend(n={}){const a=new tc(n);return a.parent=this,this.child=a,a.name=n.name?n.name:a.parent.name,n.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${a.name}".`),a.options=Ge(ee(a,"addOptions",{name:a.name})),a.storage=Ge(ee(a,"addStorage",{name:a.name,options:a.options})),a}}function XY(o){return new Mf({find:o.find,handler:({state:n,range:a,match:c})=>{const u=Ge(o.getAttributes,void 0,c)||{},{tr:A}=n,g=a.from;let E=a.to;if(c[1]){const I=c[0].lastIndexOf(c[1]);let C=g+I;C>E?C=E:E=C+c[1].length;const b=c[0][c[0].length-1];A.insertText(b,g+c[0].length-1),A.replaceWith(C,E,o.type.create(u))}else c[0]&&A.replaceWith(g,E,o.type.create(u))}})}function Zk(o,n,a){const c=[];return o===n?a.resolve(o).marks().forEach(u=>{const A=a.resolve(o-1),g=pv(A,u.type);!g||c.push(Nt({mark:u},g))}):a.nodesBetween(o,n,(u,A)=>{c.push(...u.marks.map(g=>({from:A,to:A+u.nodeSize,mark:g})))}),c}function qc(o){return new Mf({find:o.find,handler:({state:n,range:a,match:c})=>{const u=Ge(o.getAttributes,void 0,c);if(u===!1||u===null)return null;const{tr:A}=n,g=c[c.length-1],E=c[0];let I=a.to;if(g){const C=E.search(/\S/),b=a.from+E.indexOf(g),N=b+g.length;if(Zk(a.from,a.to,n.doc).filter(Q=>Q.mark.type.excluded.find(Z=>Z===o.type&&Z!==Q.mark.type)).filter(Q=>Q.to>b).length)return null;N<a.to&&A.delete(N,a.to),b>a.from&&A.delete(a.from+C,b),I=a.from+C+g.length,A.addMark(a.from+C,I,o.type.create(u||{})),A.removeStoredMark(o.type)}}})}function RI(o){return new Mf({find:o.find,handler:({state:n,range:a,match:c})=>{const u=n.doc.resolve(a.from),A=Ge(o.getAttributes,void 0,c)||{};if(!u.node(-1).canReplaceWith(u.index(-1),u.indexAfter(-1),o.type))return null;n.tr.delete(a.from,a.to).setBlockType(a.from,a.from,o.type,A)}})}function Uf(o){return new Mf({find:o.find,handler:({state:n,range:a,match:c})=>{const u=Ge(o.getAttributes,void 0,c)||{},A=n.tr.delete(a.from,a.to),E=A.doc.resolve(a.from).blockRange(),I=E&&VI(E,o.type,u);if(!I)return null;A.wrap(E,I);const C=A.doc.resolve(a.from-1).nodeBefore;C&&C.type===o.type&&vh(A.doc,a.from-1)&&(!o.joinPredicate||o.joinPredicate(c,C))&&A.join(a.from-1)}})}function Jc(o){return new QY({find:o.find,handler:({state:n,range:a,match:c})=>{const u=Ge(o.getAttributes,void 0,c);if(u===!1||u===null)return null;const{tr:A}=n,g=c[c.length-1],E=c[0];let I=a.to;if(g){const C=E.search(/\S/),b=a.from+E.indexOf(g),N=b+g.length;if(Zk(a.from,a.to,n.doc).filter(Q=>Q.mark.type.excluded.find(Z=>Z===o.type&&Z!==Q.mark.type)).filter(Q=>Q.to>b).length)return null;N<a.to&&A.delete(N,a.to),b>a.from&&A.delete(a.from+C,b),I=a.from+C+g.length,A.addMark(a.from+C,I,o.type.create(u||{})),A.removeStoredMark(o.type)}}})}function ZY(o){return Kk(o)&&o instanceof ke}function $k(o,n,a){const u=o.state.doc.content.size,A=ma(n,0,u),g=ma(a,0,u),E=o.coordsAtPos(A),I=o.coordsAtPos(g,-1),C=Math.min(E.top,I.top),b=Math.max(E.bottom,I.bottom),N=Math.min(E.left,I.left),L=Math.max(E.right,I.right),Q=L-N,G=b-C,lt={top:C,bottom:b,left:N,right:L,width:Q,height:G,x:N,y:C};return zn(Nt({},lt),{toJSON:()=>lt})}var Zi="top",Ko="bottom",Wo="right",$i="left",gv="auto",Rh=[Zi,Ko,Wo,$i],gd="start",fh="end",$Y="clippingParents",tD="viewport",Ku="popper",tq="reference",OO=Rh.reduce(function(o,n){return o.concat([n+"-"+gd,n+"-"+fh])},[]),eD=[].concat(Rh,[gv]).reduce(function(o,n){return o.concat([n,n+"-"+gd,n+"-"+fh])},[]),eq="beforeRead",rq="read",nq="afterRead",iq="beforeMain",oq="main",sq="afterMain",aq="beforeWrite",cq="write",lq="afterWrite",dq=[eq,rq,nq,iq,oq,sq,aq,cq,lq];function Fs(o){return o?(o.nodeName||"").toLowerCase():null}function gs(o){if(o==null)return window;if(o.toString()!=="[object Window]"){var n=o.ownerDocument;return n&&n.defaultView||window}return o}function md(o){var n=gs(o).Element;return o instanceof n||o instanceof Element}function Ho(o){var n=gs(o).HTMLElement;return o instanceof n||o instanceof HTMLElement}function rD(o){if(typeof ShadowRoot=="undefined")return!1;var n=gs(o).ShadowRoot;return o instanceof n||o instanceof ShadowRoot}function uq(o){var n=o.state;Object.keys(n.elements).forEach(function(a){var c=n.styles[a]||{},u=n.attributes[a]||{},A=n.elements[a];!Ho(A)||!Fs(A)||(Object.assign(A.style,c),Object.keys(u).forEach(function(g){var E=u[g];E===!1?A.removeAttribute(g):A.setAttribute(g,E===!0?"":E)}))})}function hq(o){var n=o.state,a={popper:{position:n.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(n.elements.popper.style,a.popper),n.styles=a,n.elements.arrow&&Object.assign(n.elements.arrow.style,a.arrow),function(){Object.keys(n.elements).forEach(function(c){var u=n.elements[c],A=n.attributes[c]||{},g=Object.keys(n.styles.hasOwnProperty(c)?n.styles[c]:a[c]),E=g.reduce(function(I,C){return I[C]="",I},{});!Ho(u)||!Fs(u)||(Object.assign(u.style,E),Object.keys(A).forEach(function(I){u.removeAttribute(I)}))})}}var nD={name:"applyStyles",enabled:!0,phase:"write",fn:uq,effect:hq,requires:["computeStyles"]};function Ms(o){return o.split("-")[0]}var Hc=Math.max,Af=Math.min,Ed=Math.round;function _d(o,n){n===void 0&&(n=!1);var a=o.getBoundingClientRect(),c=1,u=1;if(Ho(o)&&n){var A=o.offsetHeight,g=o.offsetWidth;g>0&&(c=Ed(a.width)/g||1),A>0&&(u=Ed(a.height)/A||1)}return{width:a.width/c,height:a.height/u,top:a.top/u,right:a.right/c,bottom:a.bottom/u,left:a.left/c,x:a.left/c,y:a.top/u}}function mv(o){var n=_d(o),a=o.offsetWidth,c=o.offsetHeight;return Math.abs(n.width-a)<=1&&(a=n.width),Math.abs(n.height-c)<=1&&(c=n.height),{x:o.offsetLeft,y:o.offsetTop,width:a,height:c}}function iD(o,n){var a=n.getRootNode&&n.getRootNode();if(o.contains(n))return!0;if(a&&rD(a)){var c=n;do{if(c&&o.isSameNode(c))return!0;c=c.parentNode||c.host}while(c)}return!1}function Ca(o){return gs(o).getComputedStyle(o)}function pq(o){return["table","td","th"].indexOf(Fs(o))>=0}function ic(o){return((md(o)?o.ownerDocument:o.document)||window.document).documentElement}function xf(o){return Fs(o)==="html"?o:o.assignedSlot||o.parentNode||(rD(o)?o.host:null)||ic(o)}function kO(o){return!Ho(o)||Ca(o).position==="fixed"?null:o.offsetParent}function Aq(o){var n=navigator.userAgent.toLowerCase().indexOf("firefox")!==-1,a=navigator.userAgent.indexOf("Trident")!==-1;if(a&&Ho(o)){var c=Ca(o);if(c.position==="fixed")return null}for(var u=xf(o);Ho(u)&&["html","body"].indexOf(Fs(u))<0;){var A=Ca(u);if(A.transform!=="none"||A.perspective!=="none"||A.contain==="paint"||["transform","perspective"].indexOf(A.willChange)!==-1||n&&A.willChange==="filter"||n&&A.filter&&A.filter!=="none")return u;u=u.parentNode}return null}function yh(o){for(var n=gs(o),a=kO(o);a&&pq(a)&&Ca(a).position==="static";)a=kO(a);return a&&(Fs(a)==="html"||Fs(a)==="body"&&Ca(a).position==="static")?n:a||Aq(o)||n}function Ev(o){return["top","bottom"].indexOf(o)>=0?"x":"y"}function eh(o,n,a){return Hc(o,Af(n,a))}function fq(o,n,a){var c=eh(o,n,a);return c>a?a:c}function oD(){return{top:0,right:0,bottom:0,left:0}}function sD(o){return Object.assign({},oD(),o)}function aD(o,n){return n.reduce(function(a,c){return a[c]=o,a},{})}var gq=function(n,a){return n=typeof n=="function"?n(Object.assign({},a.rects,{placement:a.placement})):n,sD(typeof n!="number"?n:aD(n,Rh))};function mq(o){var n,a=o.state,c=o.name,u=o.options,A=a.elements.arrow,g=a.modifiersData.popperOffsets,E=Ms(a.placement),I=Ev(E),C=[$i,Wo].indexOf(E)>=0,b=C?"height":"width";if(!(!A||!g)){var N=gq(u.padding,a),L=mv(A),Q=I==="y"?Zi:$i,G=I==="y"?Ko:Wo,Z=a.rects.reference[b]+a.rects.reference[I]-g[I]-a.rects.popper[b],dt=g[I]-a.rects.reference[I],lt=yh(A),et=lt?I==="y"?lt.clientHeight||0:lt.clientWidth||0:0,Dt=Z/2-dt/2,J=N[Q],Ft=et-L[b]-N[G],Ot=et/2-L[b]/2+Dt,ce=eh(J,Ot,Ft),ge=I;a.modifiersData[c]=(n={},n[ge]=ce,n.centerOffset=ce-Ot,n)}}function Eq(o){var n=o.state,a=o.options,c=a.element,u=c===void 0?"[data-popper-arrow]":c;u!=null&&(typeof u=="string"&&(u=n.elements.popper.querySelector(u),!u)||!iD(n.elements.popper,u)||(n.elements.arrow=u))}var _q={name:"arrow",enabled:!0,phase:"main",fn:mq,effect:Eq,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Id(o){return o.split("-")[1]}var Iq={top:"auto",right:"auto",bottom:"auto",left:"auto"};function vq(o){var n=o.x,a=o.y,c=window,u=c.devicePixelRatio||1;return{x:Ed(n*u)/u||0,y:Ed(a*u)/u||0}}function DO(o){var n,a=o.popper,c=o.popperRect,u=o.placement,A=o.variation,g=o.offsets,E=o.position,I=o.gpuAcceleration,C=o.adaptive,b=o.roundOffsets,N=o.isFixed,L=g.x,Q=L===void 0?0:L,G=g.y,Z=G===void 0?0:G,dt=typeof b=="function"?b({x:Q,y:Z}):{x:Q,y:Z};Q=dt.x,Z=dt.y;var lt=g.hasOwnProperty("x"),et=g.hasOwnProperty("y"),Dt=$i,J=Zi,Ft=window;if(C){var Ot=yh(a),ce="clientHeight",ge="clientWidth";if(Ot===gs(a)&&(Ot=ic(a),Ca(Ot).position!=="static"&&E==="absolute"&&(ce="scrollHeight",ge="scrollWidth")),Ot=Ot,u===Zi||(u===$i||u===Wo)&&A===fh){J=Ko;var he=N&&Ft.visualViewport?Ft.visualViewport.height:Ot[ce];Z-=he-c.height,Z*=I?1:-1}if(u===$i||(u===Zi||u===Ko)&&A===fh){Dt=Wo;var Te=N&&Ft.visualViewport?Ft.visualViewport.width:Ot[ge];Q-=Te-c.width,Q*=I?1:-1}}var Sr=Object.assign({position:E},C&&Iq),lr=b===!0?vq({x:Q,y:Z}):{x:Q,y:Z};if(Q=lr.x,Z=lr.y,I){var _r;return Object.assign({},Sr,(_r={},_r[J]=et?"0":"",_r[Dt]=lt?"0":"",_r.transform=(Ft.devicePixelRatio||1)<=1?"translate("+Q+"px, "+Z+"px)":"translate3d("+Q+"px, "+Z+"px, 0)",_r))}return Object.assign({},Sr,(n={},n[J]=et?Z+"px":"",n[Dt]=lt?Q+"px":"",n.transform="",n))}function Cq(o){var n=o.state,a=o.options,c=a.gpuAcceleration,u=c===void 0?!0:c,A=a.adaptive,g=A===void 0?!0:A,E=a.roundOffsets,I=E===void 0?!0:E,C={placement:Ms(n.placement),variation:Id(n.placement),popper:n.elements.popper,popperRect:n.rects.popper,gpuAcceleration:u,isFixed:n.options.strategy==="fixed"};n.modifiersData.popperOffsets!=null&&(n.styles.popper=Object.assign({},n.styles.popper,DO(Object.assign({},C,{offsets:n.modifiersData.popperOffsets,position:n.options.strategy,adaptive:g,roundOffsets:I})))),n.modifiersData.arrow!=null&&(n.styles.arrow=Object.assign({},n.styles.arrow,DO(Object.assign({},C,{offsets:n.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:I})))),n.attributes.popper=Object.assign({},n.attributes.popper,{"data-popper-placement":n.placement})}var Sq={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:Cq,data:{}},qA={passive:!0};function Tq(o){var n=o.state,a=o.instance,c=o.options,u=c.scroll,A=u===void 0?!0:u,g=c.resize,E=g===void 0?!0:g,I=gs(n.elements.popper),C=[].concat(n.scrollParents.reference,n.scrollParents.popper);return A&&C.forEach(function(b){b.addEventListener("scroll",a.update,qA)}),E&&I.addEventListener("resize",a.update,qA),function(){A&&C.forEach(function(b){b.removeEventListener("scroll",a.update,qA)}),E&&I.removeEventListener("resize",a.update,qA)}}var Rq={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:Tq,data:{}},yq={left:"right",right:"left",bottom:"top",top:"bottom"};function $A(o){return o.replace(/left|right|bottom|top/g,function(n){return yq[n]})}var wq={start:"end",end:"start"};function LO(o){return o.replace(/start|end/g,function(n){return wq[n]})}function _v(o){var n=gs(o),a=n.pageXOffset,c=n.pageYOffset;return{scrollLeft:a,scrollTop:c}}function Iv(o){return _d(ic(o)).left+_v(o).scrollLeft}function bq(o){var n=gs(o),a=ic(o),c=n.visualViewport,u=a.clientWidth,A=a.clientHeight,g=0,E=0;return c&&(u=c.width,A=c.height,/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||(g=c.offsetLeft,E=c.offsetTop)),{width:u,height:A,x:g+Iv(o),y:E}}function Nq(o){var n,a=ic(o),c=_v(o),u=(n=o.ownerDocument)==null?void 0:n.body,A=Hc(a.scrollWidth,a.clientWidth,u?u.scrollWidth:0,u?u.clientWidth:0),g=Hc(a.scrollHeight,a.clientHeight,u?u.scrollHeight:0,u?u.clientHeight:0),E=-c.scrollLeft+Iv(o),I=-c.scrollTop;return Ca(u||a).direction==="rtl"&&(E+=Hc(a.clientWidth,u?u.clientWidth:0)-A),{width:A,height:g,x:E,y:I}}function vv(o){var n=Ca(o),a=n.overflow,c=n.overflowX,u=n.overflowY;return/auto|scroll|overlay|hidden/.test(a+u+c)}function cD(o){return["html","body","#document"].indexOf(Fs(o))>=0?o.ownerDocument.body:Ho(o)&&vv(o)?o:cD(xf(o))}function rh(o,n){var a;n===void 0&&(n=[]);var c=cD(o),u=c===((a=o.ownerDocument)==null?void 0:a.body),A=gs(c),g=u?[A].concat(A.visualViewport||[],vv(c)?c:[]):c,E=n.concat(g);return u?E:E.concat(rh(xf(g)))}function yI(o){return Object.assign({},o,{left:o.x,top:o.y,right:o.x+o.width,bottom:o.y+o.height})}function Oq(o){var n=_d(o);return n.top=n.top+o.clientTop,n.left=n.left+o.clientLeft,n.bottom=n.top+o.clientHeight,n.right=n.left+o.clientWidth,n.width=o.clientWidth,n.height=o.clientHeight,n.x=n.left,n.y=n.top,n}function PO(o,n){return n===tD?yI(bq(o)):md(n)?Oq(n):yI(Nq(ic(o)))}function kq(o){var n=rh(xf(o)),a=["absolute","fixed"].indexOf(Ca(o).position)>=0,c=a&&Ho(o)?yh(o):o;return md(c)?n.filter(function(u){return md(u)&&iD(u,c)&&Fs(u)!=="body"}):[]}function Dq(o,n,a){var c=n==="clippingParents"?kq(o):[].concat(n),u=[].concat(c,[a]),A=u[0],g=u.reduce(function(E,I){var C=PO(o,I);return E.top=Hc(C.top,E.top),E.right=Af(C.right,E.right),E.bottom=Af(C.bottom,E.bottom),E.left=Hc(C.left,E.left),E},PO(o,A));return g.width=g.right-g.left,g.height=g.bottom-g.top,g.x=g.left,g.y=g.top,g}function lD(o){var n=o.reference,a=o.element,c=o.placement,u=c?Ms(c):null,A=c?Id(c):null,g=n.x+n.width/2-a.width/2,E=n.y+n.height/2-a.height/2,I;switch(u){case Zi:I={x:g,y:n.y-a.height};break;case Ko:I={x:g,y:n.y+n.height};break;case Wo:I={x:n.x+n.width,y:E};break;case $i:I={x:n.x-a.width,y:E};break;default:I={x:n.x,y:n.y}}var C=u?Ev(u):null;if(C!=null){var b=C==="y"?"height":"width";switch(A){case gd:I[C]=I[C]-(n[b]/2-a[b]/2);break;case fh:I[C]=I[C]+(n[b]/2-a[b]/2);break}}return I}function gh(o,n){n===void 0&&(n={});var a=n,c=a.placement,u=c===void 0?o.placement:c,A=a.boundary,g=A===void 0?$Y:A,E=a.rootBoundary,I=E===void 0?tD:E,C=a.elementContext,b=C===void 0?Ku:C,N=a.altBoundary,L=N===void 0?!1:N,Q=a.padding,G=Q===void 0?0:Q,Z=sD(typeof G!="number"?G:aD(G,Rh)),dt=b===Ku?tq:Ku,lt=o.rects.popper,et=o.elements[L?dt:b],Dt=Dq(md(et)?et:et.contextElement||ic(o.elements.popper),g,I),J=_d(o.elements.reference),Ft=lD({reference:J,element:lt,strategy:"absolute",placement:u}),Ot=yI(Object.assign({},lt,Ft)),ce=b===Ku?Ot:J,ge={top:Dt.top-ce.top+Z.top,bottom:ce.bottom-Dt.bottom+Z.bottom,left:Dt.left-ce.left+Z.left,right:ce.right-Dt.right+Z.right},he=o.modifiersData.offset;if(b===Ku&&he){var Te=he[u];Object.keys(ge).forEach(function(Sr){var lr=[Wo,Ko].indexOf(Sr)>=0?1:-1,_r=[Zi,Ko].indexOf(Sr)>=0?"y":"x";ge[Sr]+=Te[_r]*lr})}return ge}function Lq(o,n){n===void 0&&(n={});var a=n,c=a.placement,u=a.boundary,A=a.rootBoundary,g=a.padding,E=a.flipVariations,I=a.allowedAutoPlacements,C=I===void 0?eD:I,b=Id(c),N=b?E?OO:OO.filter(function(G){return Id(G)===b}):Rh,L=N.filter(function(G){return C.indexOf(G)>=0});L.length===0&&(L=N);var Q=L.reduce(function(G,Z){return G[Z]=gh(o,{placement:Z,boundary:u,rootBoundary:A,padding:g})[Ms(Z)],G},{});return Object.keys(Q).sort(function(G,Z){return Q[G]-Q[Z]})}function Pq(o){if(Ms(o)===gv)return[];var n=$A(o);return[LO(o),n,LO(n)]}function Bq(o){var n=o.state,a=o.options,c=o.name;if(!n.modifiersData[c]._skip){for(var u=a.mainAxis,A=u===void 0?!0:u,g=a.altAxis,E=g===void 0?!0:g,I=a.fallbackPlacements,C=a.padding,b=a.boundary,N=a.rootBoundary,L=a.altBoundary,Q=a.flipVariations,G=Q===void 0?!0:Q,Z=a.allowedAutoPlacements,dt=n.options.placement,lt=Ms(dt),et=lt===dt,Dt=I||(et||!G?[$A(dt)]:Pq(dt)),J=[dt].concat(Dt).reduce(function(ro,no){return ro.concat(Ms(no)===gv?Lq(n,{placement:no,boundary:b,rootBoundary:N,padding:C,flipVariations:G,allowedAutoPlacements:Z}):no)},[]),Ft=n.rects.reference,Ot=n.rects.popper,ce=new Map,ge=!0,he=J[0],Te=0;Te<J.length;Te++){var Sr=J[Te],lr=Ms(Sr),_r=Id(Sr)===gd,Zr=[Zi,Ko].indexOf(lr)>=0,gr=Zr?"width":"height",Re=gh(n,{placement:Sr,boundary:b,rootBoundary:N,altBoundary:L,padding:C}),ln=Zr?_r?Wo:$i:_r?Ko:Zi;Ft[gr]>Ot[gr]&&(ln=$A(ln));var Dn=$A(ln),To=[];if(A&&To.push(Re[lr]<=0),E&&To.push(Re[ln]<=0,Re[Dn]<=0),To.every(function(ro){return ro})){he=Sr,ge=!1;break}ce.set(Sr,To)}if(ge)for(var Qn=G?3:1,Gs=function(no){var Bi=J.find(function(Ra){var Ln=ce.get(Ra);if(Ln)return Ln.slice(0,no).every(function(ya){return ya})});if(Bi)return he=Bi,"break"},Ro=Qn;Ro>0;Ro--){var js=Gs(Ro);if(js==="break")break}n.placement!==he&&(n.modifiersData[c]._skip=!0,n.placement=he,n.reset=!0)}}var Mq={name:"flip",enabled:!0,phase:"main",fn:Bq,requiresIfExists:["offset"],data:{_skip:!1}};function BO(o,n,a){return a===void 0&&(a={x:0,y:0}),{top:o.top-n.height-a.y,right:o.right-n.width+a.x,bottom:o.bottom-n.height+a.y,left:o.left-n.width-a.x}}function MO(o){return[Zi,Wo,Ko,$i].some(function(n){return o[n]>=0})}function Uq(o){var n=o.state,a=o.name,c=n.rects.reference,u=n.rects.popper,A=n.modifiersData.preventOverflow,g=gh(n,{elementContext:"reference"}),E=gh(n,{altBoundary:!0}),I=BO(g,c),C=BO(E,u,A),b=MO(I),N=MO(C);n.modifiersData[a]={referenceClippingOffsets:I,popperEscapeOffsets:C,isReferenceHidden:b,hasPopperEscaped:N},n.attributes.popper=Object.assign({},n.attributes.popper,{"data-popper-reference-hidden":b,"data-popper-escaped":N})}var xq={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:Uq};function Fq(o,n,a){var c=Ms(o),u=[$i,Zi].indexOf(c)>=0?-1:1,A=typeof a=="function"?a(Object.assign({},n,{placement:o})):a,g=A[0],E=A[1];return g=g||0,E=(E||0)*u,[$i,Wo].indexOf(c)>=0?{x:E,y:g}:{x:g,y:E}}function Qq(o){var n=o.state,a=o.options,c=o.name,u=a.offset,A=u===void 0?[0,0]:u,g=eD.reduce(function(b,N){return b[N]=Fq(N,n.rects,A),b},{}),E=g[n.placement],I=E.x,C=E.y;n.modifiersData.popperOffsets!=null&&(n.modifiersData.popperOffsets.x+=I,n.modifiersData.popperOffsets.y+=C),n.modifiersData[c]=g}var Vq={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:Qq};function Gq(o){var n=o.state,a=o.name;n.modifiersData[a]=lD({reference:n.rects.reference,element:n.rects.popper,strategy:"absolute",placement:n.placement})}var jq={name:"popperOffsets",enabled:!0,phase:"read",fn:Gq,data:{}};function Hq(o){return o==="x"?"y":"x"}function Kq(o){var n=o.state,a=o.options,c=o.name,u=a.mainAxis,A=u===void 0?!0:u,g=a.altAxis,E=g===void 0?!1:g,I=a.boundary,C=a.rootBoundary,b=a.altBoundary,N=a.padding,L=a.tether,Q=L===void 0?!0:L,G=a.tetherOffset,Z=G===void 0?0:G,dt=gh(n,{boundary:I,rootBoundary:C,padding:N,altBoundary:b}),lt=Ms(n.placement),et=Id(n.placement),Dt=!et,J=Ev(lt),Ft=Hq(J),Ot=n.modifiersData.popperOffsets,ce=n.rects.reference,ge=n.rects.popper,he=typeof Z=="function"?Z(Object.assign({},n.rects,{placement:n.placement})):Z,Te=typeof he=="number"?{mainAxis:he,altAxis:he}:Object.assign({mainAxis:0,altAxis:0},he),Sr=n.modifiersData.offset?n.modifiersData.offset[n.placement]:null,lr={x:0,y:0};if(!!Ot){if(A){var _r,Zr=J==="y"?Zi:$i,gr=J==="y"?Ko:Wo,Re=J==="y"?"height":"width",ln=Ot[J],Dn=ln+dt[Zr],To=ln-dt[gr],Qn=Q?-ge[Re]/2:0,Gs=et===gd?ce[Re]:ge[Re],Ro=et===gd?-ge[Re]:-ce[Re],js=n.elements.arrow,ro=Q&&js?mv(js):{width:0,height:0},no=n.modifiersData["arrow#persistent"]?n.modifiersData["arrow#persistent"].padding:oD(),Bi=no[Zr],Ra=no[gr],Ln=eh(0,ce[Re],ro[Re]),ya=Dt?ce[Re]/2-Qn-Ln-Bi-Te.mainAxis:Gs-Ln-Bi-Te.mainAxis,ms=Dt?-ce[Re]/2+Qn+Ln+Ra+Te.mainAxis:Ro+Ln+Ra+Te.mainAxis,Vn=n.elements.arrow&&yh(n.elements.arrow),$c=Vn?J==="y"?Vn.clientTop||0:Vn.clientLeft||0:0,Vr=(_r=Sr==null?void 0:Sr[J])!=null?_r:0,Ir=ln+ya-Vr-$c,wa=ln+ms-Vr,Hs=eh(Q?Af(Dn,Ir):Dn,ln,Q?Hc(To,wa):To);Ot[J]=Hs,lr[J]=Hs-ln}if(E){var sc,ac=J==="x"?Zi:$i,ti=J==="x"?Ko:Wo,Pn=Ot[Ft],Jo=Ft==="y"?"height":"width",Ks=Pn+dt[ac],Es=Pn-dt[ti],ba=[Zi,$i].indexOf(lt)!==-1,cc=(sc=Sr==null?void 0:Sr[Ft])!=null?sc:0,lc=ba?Ks:Pn-ce[Jo]-ge[Jo]-cc+Te.altAxis,zo=ba?Pn+ce[Jo]+ge[Jo]-cc-Te.altAxis:Es,dc=Q&&ba?fq(lc,Pn,zo):eh(Q?lc:Ks,Pn,Q?zo:Es);Ot[Ft]=dc,lr[Ft]=dc-Pn}n.modifiersData[c]=lr}}var Wq={name:"preventOverflow",enabled:!0,phase:"main",fn:Kq,requiresIfExists:["offset"]};function Yq(o){return{scrollLeft:o.scrollLeft,scrollTop:o.scrollTop}}function qq(o){return o===gs(o)||!Ho(o)?_v(o):Yq(o)}function Jq(o){var n=o.getBoundingClientRect(),a=Ed(n.width)/o.offsetWidth||1,c=Ed(n.height)/o.offsetHeight||1;return a!==1||c!==1}function zq(o,n,a){a===void 0&&(a=!1);var c=Ho(n),u=Ho(n)&&Jq(n),A=ic(n),g=_d(o,u),E={scrollLeft:0,scrollTop:0},I={x:0,y:0};return(c||!c&&!a)&&((Fs(n)!=="body"||vv(A))&&(E=qq(n)),Ho(n)?(I=_d(n,!0),I.x+=n.clientLeft,I.y+=n.clientTop):A&&(I.x=Iv(A))),{x:g.left+E.scrollLeft-I.x,y:g.top+E.scrollTop-I.y,width:g.width,height:g.height}}function Xq(o){var n=new Map,a=new Set,c=[];o.forEach(function(A){n.set(A.name,A)});function u(A){a.add(A.name);var g=[].concat(A.requires||[],A.requiresIfExists||[]);g.forEach(function(E){if(!a.has(E)){var I=n.get(E);I&&u(I)}}),c.push(A)}return o.forEach(function(A){a.has(A.name)||u(A)}),c}function Zq(o){var n=Xq(o);return dq.reduce(function(a,c){return a.concat(n.filter(function(u){return u.phase===c}))},[])}function $q(o){var n;return function(){return n||(n=new Promise(function(a){Promise.resolve().then(function(){n=void 0,a(o())})})),n}}function tJ(o){var n=o.reduce(function(a,c){var u=a[c.name];return a[c.name]=u?Object.assign({},u,c,{options:Object.assign({},u.options,c.options),data:Object.assign({},u.data,c.data)}):c,a},{});return Object.keys(n).map(function(a){return n[a]})}var UO={placement:"bottom",modifiers:[],strategy:"absolute"};function xO(){for(var o=arguments.length,n=new Array(o),a=0;a<o;a++)n[a]=arguments[a];return!n.some(function(c){return!(c&&typeof c.getBoundingClientRect=="function")})}function eJ(o){o===void 0&&(o={});var n=o,a=n.defaultModifiers,c=a===void 0?[]:a,u=n.defaultOptions,A=u===void 0?UO:u;return function(E,I,C){C===void 0&&(C=A);var b={placement:"bottom",orderedModifiers:[],options:Object.assign({},UO,A),modifiersData:{},elements:{reference:E,popper:I},attributes:{},styles:{}},N=[],L=!1,Q={state:b,setOptions:function(lt){var et=typeof lt=="function"?lt(b.options):lt;Z(),b.options=Object.assign({},A,b.options,et),b.scrollParents={reference:md(E)?rh(E):E.contextElement?rh(E.contextElement):[],popper:rh(I)};var Dt=Zq(tJ([].concat(c,b.options.modifiers)));return b.orderedModifiers=Dt.filter(function(J){return J.enabled}),G(),Q.update()},forceUpdate:function(){if(!L){var lt=b.elements,et=lt.reference,Dt=lt.popper;if(!!xO(et,Dt)){b.rects={reference:zq(et,yh(Dt),b.options.strategy==="fixed"),popper:mv(Dt)},b.reset=!1,b.placement=b.options.placement,b.orderedModifiers.forEach(function(Te){return b.modifiersData[Te.name]=Object.assign({},Te.data)});for(var J=0;J<b.orderedModifiers.length;J++){if(b.reset===!0){b.reset=!1,J=-1;continue}var Ft=b.orderedModifiers[J],Ot=Ft.fn,ce=Ft.options,ge=ce===void 0?{}:ce,he=Ft.name;typeof Ot=="function"&&(b=Ot({state:b,options:ge,name:he,instance:Q})||b)}}}},update:$q(function(){return new Promise(function(dt){Q.forceUpdate(),dt(b)})}),destroy:function(){Z(),L=!0}};if(!xO(E,I))return Q;Q.setOptions(C).then(function(dt){!L&&C.onFirstUpdate&&C.onFirstUpdate(dt)});function G(){b.orderedModifiers.forEach(function(dt){var lt=dt.name,et=dt.options,Dt=et===void 0?{}:et,J=dt.effect;if(typeof J=="function"){var Ft=J({state:b,name:lt,instance:Q,options:Dt}),Ot=function(){};N.push(Ft||Ot)}})}function Z(){N.forEach(function(dt){return dt()}),N=[]}return Q}}var rJ=[Rq,jq,Sq,nD,Vq,Mq,Wq,_q,xq],nJ=eJ({defaultModifiers:rJ}),iJ="tippy-box",dD="tippy-content",oJ="tippy-backdrop",uD="tippy-arrow",hD="tippy-svg-arrow",Uc={passive:!0,capture:!0},pD=function(){return document.body};function $_(o,n,a){if(Array.isArray(o)){var c=o[n];return c==null?Array.isArray(a)?a[n]:a:c}return o}function Cv(o,n){var a={}.toString.call(o);return a.indexOf("[object")===0&&a.indexOf(n+"]")>-1}function AD(o,n){return typeof o=="function"?o.apply(void 0,n):o}function FO(o,n){if(n===0)return o;var a;return function(c){clearTimeout(a),a=setTimeout(function(){o(c)},n)}}function sJ(o){return o.split(/\s+/).filter(Boolean)}function id(o){return[].concat(o)}function QO(o,n){o.indexOf(n)===-1&&o.push(n)}function aJ(o){return o.filter(function(n,a){return o.indexOf(n)===a})}function cJ(o){return o.split("-")[0]}function ff(o){return[].slice.call(o)}function VO(o){return Object.keys(o).reduce(function(n,a){return o[a]!==void 0&&(n[a]=o[a]),n},{})}function nh(){return document.createElement("div")}function Ff(o){return["Element","Fragment"].some(function(n){return Cv(o,n)})}function lJ(o){return Cv(o,"NodeList")}function dJ(o){return Cv(o,"MouseEvent")}function uJ(o){return!!(o&&o._tippy&&o._tippy.reference===o)}function hJ(o){return Ff(o)?[o]:lJ(o)?ff(o):Array.isArray(o)?o:ff(document.querySelectorAll(o))}function tI(o,n){o.forEach(function(a){a&&(a.style.transitionDuration=n+"ms")})}function GO(o,n){o.forEach(function(a){a&&a.setAttribute("data-state",n)})}function pJ(o){var n,a=id(o),c=a[0];return c!=null&&(n=c.ownerDocument)!=null&&n.body?c.ownerDocument:document}function AJ(o,n){var a=n.clientX,c=n.clientY;return o.every(function(u){var A=u.popperRect,g=u.popperState,E=u.props,I=E.interactiveBorder,C=cJ(g.placement),b=g.modifiersData.offset;if(!b)return!0;var N=C==="bottom"?b.top.y:0,L=C==="top"?b.bottom.y:0,Q=C==="right"?b.left.x:0,G=C==="left"?b.right.x:0,Z=A.top-c+N>I,dt=c-A.bottom-L>I,lt=A.left-a+Q>I,et=a-A.right-G>I;return Z||dt||lt||et})}function eI(o,n,a){var c=n+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(u){o[c](u,a)})}function jO(o,n){for(var a=n;a;){var c;if(o.contains(a))return!0;a=a.getRootNode==null||(c=a.getRootNode())==null?void 0:c.host}return!1}var Ps={isTouch:!1},HO=0;function fJ(){Ps.isTouch||(Ps.isTouch=!0,window.performance&&document.addEventListener("mousemove",fD))}function fD(){var o=performance.now();o-HO<20&&(Ps.isTouch=!1,document.removeEventListener("mousemove",fD)),HO=o}function gJ(){var o=document.activeElement;if(uJ(o)){var n=o._tippy;o.blur&&!n.state.isVisible&&o.blur()}}function mJ(){document.addEventListener("touchstart",fJ,Uc),window.addEventListener("blur",gJ)}var EJ=typeof window!="undefined"&&typeof document!="undefined",_J=EJ?!!window.msCrypto:!1,IJ={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},vJ={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},us=Object.assign({appendTo:pD,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},IJ,vJ),CJ=Object.keys(us),SJ=function(n){var a=Object.keys(n);a.forEach(function(c){us[c]=n[c]})};function gD(o){var n=o.plugins||[],a=n.reduce(function(c,u){var A=u.name,g=u.defaultValue;if(A){var E;c[A]=o[A]!==void 0?o[A]:(E=us[A])!=null?E:g}return c},{});return Object.assign({},o,a)}function TJ(o,n){var a=n?Object.keys(gD(Object.assign({},us,{plugins:n}))):CJ,c=a.reduce(function(u,A){var g=(o.getAttribute("data-tippy-"+A)||"").trim();if(!g)return u;if(A==="content")u[A]=g;else try{u[A]=JSON.parse(g)}catch{u[A]=g}return u},{});return c}function KO(o,n){var a=Object.assign({},n,{content:AD(n.content,[o])},n.ignoreAttributes?{}:TJ(o,n.plugins));return a.aria=Object.assign({},us.aria,a.aria),a.aria={expanded:a.aria.expanded==="auto"?n.interactive:a.aria.expanded,content:a.aria.content==="auto"?n.interactive?null:"describedby":a.aria.content},a}var RJ=function(){return"innerHTML"};function wI(o,n){o[RJ()]=n}function WO(o){var n=nh();return o===!0?n.className=uD:(n.className=hD,Ff(o)?n.appendChild(o):wI(n,o)),n}function YO(o,n){Ff(n.content)?(wI(o,""),o.appendChild(n.content)):typeof n.content!="function"&&(n.allowHTML?wI(o,n.content):o.textContent=n.content)}function bI(o){var n=o.firstElementChild,a=ff(n.children);return{box:n,content:a.find(function(c){return c.classList.contains(dD)}),arrow:a.find(function(c){return c.classList.contains(uD)||c.classList.contains(hD)}),backdrop:a.find(function(c){return c.classList.contains(oJ)})}}function mD(o){var n=nh(),a=nh();a.className=iJ,a.setAttribute("data-state","hidden"),a.setAttribute("tabindex","-1");var c=nh();c.className=dD,c.setAttribute("data-state","hidden"),YO(c,o.props),n.appendChild(a),a.appendChild(c),u(o.props,o.props);function u(A,g){var E=bI(n),I=E.box,C=E.content,b=E.arrow;g.theme?I.setAttribute("data-theme",g.theme):I.removeAttribute("data-theme"),typeof g.animation=="string"?I.setAttribute("data-animation",g.animation):I.removeAttribute("data-animation"),g.inertia?I.setAttribute("data-inertia",""):I.removeAttribute("data-inertia"),I.style.maxWidth=typeof g.maxWidth=="number"?g.maxWidth+"px":g.maxWidth,g.role?I.setAttribute("role",g.role):I.removeAttribute("role"),(A.content!==g.content||A.allowHTML!==g.allowHTML)&&YO(C,o.props),g.arrow?b?A.arrow!==g.arrow&&(I.removeChild(b),I.appendChild(WO(g.arrow))):I.appendChild(WO(g.arrow)):b&&I.removeChild(b)}return{popper:n,onUpdate:u}}mD.$$tippy=!0;var yJ=1,JA=[],rI=[];function wJ(o,n){var a=KO(o,Object.assign({},us,gD(VO(n)))),c,u,A,g=!1,E=!1,I=!1,C=!1,b,N,L,Q=[],G=FO(Ir,a.interactiveDebounce),Z,dt=yJ++,lt=null,et=aJ(a.plugins),Dt={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},J={id:dt,reference:o,popper:nh(),popperInstance:lt,props:a,state:Dt,plugins:et,clearDelayTimeouts:lc,setProps:zo,setContent:dc,show:Vf,hide:yd,hideWithInteractivity:wh,enable:ba,disable:cc,unmount:Gf,destroy:jf};if(!a.render)return J;var Ft=a.render(J),Ot=Ft.popper,ce=Ft.onUpdate;Ot.setAttribute("data-tippy-root",""),Ot.id="tippy-"+J.id,J.popper=Ot,o._tippy=J,Ot._tippy=J;var ge=et.map(function(Tt){return Tt.fn(J)}),he=o.hasAttribute("aria-expanded");return Vn(),Qn(),ln(),Dn("onCreate",[J]),a.showOnCreate&&Ks(),Ot.addEventListener("mouseenter",function(){J.props.interactive&&J.state.isVisible&&J.clearDelayTimeouts()}),Ot.addEventListener("mouseleave",function(){J.props.interactive&&J.props.trigger.indexOf("mouseenter")>=0&&Zr().addEventListener("mousemove",G)}),J;function Te(){var Tt=J.props.touch;return Array.isArray(Tt)?Tt:[Tt,0]}function Sr(){return Te()[0]==="hold"}function lr(){var Tt;return!!((Tt=J.props.render)!=null&&Tt.$$tippy)}function _r(){return Z||o}function Zr(){var Tt=_r().parentNode;return Tt?pJ(Tt):document}function gr(){return bI(Ot)}function Re(Tt){return J.state.isMounted&&!J.state.isVisible||Ps.isTouch||b&&b.type==="focus"?0:$_(J.props.delay,Tt?0:1,us.delay)}function ln(Tt){Tt===void 0&&(Tt=!1),Ot.style.pointerEvents=J.props.interactive&&!Tt?"":"none",Ot.style.zIndex=""+J.props.zIndex}function Dn(Tt,re,_e){if(_e===void 0&&(_e=!0),ge.forEach(function(or){or[Tt]&&or[Tt].apply(or,re)}),_e){var dr;(dr=J.props)[Tt].apply(dr,re)}}function To(){var Tt=J.props.aria;if(!!Tt.content){var re="aria-"+Tt.content,_e=Ot.id,dr=id(J.props.triggerTarget||o);dr.forEach(function(or){var Sn=or.getAttribute(re);if(J.state.isVisible)or.setAttribute(re,Sn?Sn+" "+_e:_e);else{var Mi=Sn&&Sn.replace(_e,"").trim();Mi?or.setAttribute(re,Mi):or.removeAttribute(re)}})}}function Qn(){if(!(he||!J.props.aria.expanded)){var Tt=id(J.props.triggerTarget||o);Tt.forEach(function(re){J.props.interactive?re.setAttribute("aria-expanded",J.state.isVisible&&re===_r()?"true":"false"):re.removeAttribute("aria-expanded")})}}function Gs(){Zr().removeEventListener("mousemove",G),JA=JA.filter(function(Tt){return Tt!==G})}function Ro(Tt){if(!(Ps.isTouch&&(I||Tt.type==="mousedown"))){var re=Tt.composedPath&&Tt.composedPath()[0]||Tt.target;if(!(J.props.interactive&&jO(Ot,re))){if(id(J.props.triggerTarget||o).some(function(_e){return jO(_e,re)})){if(Ps.isTouch||J.state.isVisible&&J.props.trigger.indexOf("click")>=0)return}else Dn("onClickOutside",[J,Tt]);J.props.hideOnClick===!0&&(J.clearDelayTimeouts(),J.hide(),E=!0,setTimeout(function(){E=!1}),J.state.isMounted||Bi())}}}function js(){I=!0}function ro(){I=!1}function no(){var Tt=Zr();Tt.addEventListener("mousedown",Ro,!0),Tt.addEventListener("touchend",Ro,Uc),Tt.addEventListener("touchstart",ro,Uc),Tt.addEventListener("touchmove",js,Uc)}function Bi(){var Tt=Zr();Tt.removeEventListener("mousedown",Ro,!0),Tt.removeEventListener("touchend",Ro,Uc),Tt.removeEventListener("touchstart",ro,Uc),Tt.removeEventListener("touchmove",js,Uc)}function Ra(Tt,re){ya(Tt,function(){!J.state.isVisible&&Ot.parentNode&&Ot.parentNode.contains(Ot)&&re()})}function Ln(Tt,re){ya(Tt,re)}function ya(Tt,re){var _e=gr().box;function dr(or){or.target===_e&&(eI(_e,"remove",dr),re())}if(Tt===0)return re();eI(_e,"remove",N),eI(_e,"add",dr),N=dr}function ms(Tt,re,_e){_e===void 0&&(_e=!1);var dr=id(J.props.triggerTarget||o);dr.forEach(function(or){or.addEventListener(Tt,re,_e),Q.push({node:or,eventType:Tt,handler:re,options:_e})})}function Vn(){Sr()&&(ms("touchstart",Vr,{passive:!0}),ms("touchend",wa,{passive:!0})),sJ(J.props.trigger).forEach(function(Tt){if(Tt!=="manual")switch(ms(Tt,Vr),Tt){case"mouseenter":ms("mouseleave",wa);break;case"focus":ms(_J?"focusout":"blur",Hs);break;case"focusin":ms("focusout",Hs);break}})}function $c(){Q.forEach(function(Tt){var re=Tt.node,_e=Tt.eventType,dr=Tt.handler,or=Tt.options;re.removeEventListener(_e,dr,or)}),Q=[]}function Vr(Tt){var re,_e=!1;if(!(!J.state.isEnabled||sc(Tt)||E)){var dr=((re=b)==null?void 0:re.type)==="focus";b=Tt,Z=Tt.currentTarget,Qn(),!J.state.isVisible&&dJ(Tt)&&JA.forEach(function(or){return or(Tt)}),Tt.type==="click"&&(J.props.trigger.indexOf("mouseenter")<0||g)&&J.props.hideOnClick!==!1&&J.state.isVisible?_e=!0:Ks(Tt),Tt.type==="click"&&(g=!_e),_e&&!dr&&Es(Tt)}}function Ir(Tt){var re=Tt.target,_e=_r().contains(re)||Ot.contains(re);if(!(Tt.type==="mousemove"&&_e)){var dr=Jo().concat(Ot).map(function(or){var Sn,Mi=or._tippy,Na=(Sn=Mi.popperInstance)==null?void 0:Sn.state;return Na?{popperRect:or.getBoundingClientRect(),popperState:Na,props:a}:null}).filter(Boolean);AJ(dr,Tt)&&(Gs(),Es(Tt))}}function wa(Tt){var re=sc(Tt)||J.props.trigger.indexOf("click")>=0&&g;if(!re){if(J.props.interactive){J.hideWithInteractivity(Tt);return}Es(Tt)}}function Hs(Tt){J.props.trigger.indexOf("focusin")<0&&Tt.target!==_r()||J.props.interactive&&Tt.relatedTarget&&Ot.contains(Tt.relatedTarget)||Es(Tt)}function sc(Tt){return Ps.isTouch?Sr()!==Tt.type.indexOf("touch")>=0:!1}function ac(){ti();var Tt=J.props,re=Tt.popperOptions,_e=Tt.placement,dr=Tt.offset,or=Tt.getReferenceClientRect,Sn=Tt.moveTransition,Mi=lr()?bI(Ot).arrow:null,Na=or?{getBoundingClientRect:or,contextElement:or.contextElement||_r()}:o,bh={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(Oa){var _s=Oa.state;if(lr()){var bd=gr(),uc=bd.box;["placement","reference-hidden","escaped"].forEach(function(tl){tl==="placement"?uc.setAttribute("data-placement",_s.placement):_s.attributes.popper["data-popper-"+tl]?uc.setAttribute("data-"+tl,""):uc.removeAttribute("data-"+tl)}),_s.attributes.popper={}}}},Gn=[{name:"offset",options:{offset:dr}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!Sn}},bh];lr()&&Mi&&Gn.push({name:"arrow",options:{element:Mi,padding:3}}),Gn.push.apply(Gn,(re==null?void 0:re.modifiers)||[]),J.popperInstance=nJ(Na,Ot,Object.assign({},re,{placement:_e,onFirstUpdate:L,modifiers:Gn}))}function ti(){J.popperInstance&&(J.popperInstance.destroy(),J.popperInstance=null)}function Pn(){var Tt=J.props.appendTo,re,_e=_r();J.props.interactive&&Tt===pD||Tt==="parent"?re=_e.parentNode:re=AD(Tt,[_e]),re.contains(Ot)||re.appendChild(Ot),J.state.isMounted=!0,ac()}function Jo(){return ff(Ot.querySelectorAll("[data-tippy-root]"))}function Ks(Tt){J.clearDelayTimeouts(),Tt&&Dn("onTrigger",[J,Tt]),no();var re=Re(!0),_e=Te(),dr=_e[0],or=_e[1];Ps.isTouch&&dr==="hold"&&or&&(re=or),re?c=setTimeout(function(){J.show()},re):J.show()}function Es(Tt){if(J.clearDelayTimeouts(),Dn("onUntrigger",[J,Tt]),!J.state.isVisible){Bi();return}if(!(J.props.trigger.indexOf("mouseenter")>=0&&J.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(Tt.type)>=0&&g)){var re=Re(!1);re?u=setTimeout(function(){J.state.isVisible&&J.hide()},re):A=requestAnimationFrame(function(){J.hide()})}}function ba(){J.state.isEnabled=!0}function cc(){J.hide(),J.state.isEnabled=!1}function lc(){clearTimeout(c),clearTimeout(u),cancelAnimationFrame(A)}function zo(Tt){if(!J.state.isDestroyed){Dn("onBeforeUpdate",[J,Tt]),$c();var re=J.props,_e=KO(o,Object.assign({},re,VO(Tt),{ignoreAttributes:!0}));J.props=_e,Vn(),re.interactiveDebounce!==_e.interactiveDebounce&&(Gs(),G=FO(Ir,_e.interactiveDebounce)),re.triggerTarget&&!_e.triggerTarget?id(re.triggerTarget).forEach(function(dr){dr.removeAttribute("aria-expanded")}):_e.triggerTarget&&o.removeAttribute("aria-expanded"),Qn(),ln(),ce&&ce(re,_e),J.popperInstance&&(ac(),Jo().forEach(function(dr){requestAnimationFrame(dr._tippy.popperInstance.forceUpdate)})),Dn("onAfterUpdate",[J,Tt])}}function dc(Tt){J.setProps({content:Tt})}function Vf(){var Tt=J.state.isVisible,re=J.state.isDestroyed,_e=!J.state.isEnabled,dr=Ps.isTouch&&!J.props.touch,or=$_(J.props.duration,0,us.duration);if(!(Tt||re||_e||dr)&&!_r().hasAttribute("disabled")&&(Dn("onShow",[J],!1),J.props.onShow(J)!==!1)){if(J.state.isVisible=!0,lr()&&(Ot.style.visibility="visible"),ln(),no(),J.state.isMounted||(Ot.style.transition="none"),lr()){var Sn=gr(),Mi=Sn.box,Na=Sn.content;tI([Mi,Na],0)}L=function(){var Gn;if(!(!J.state.isVisible||C)){if(C=!0,Ot.offsetHeight,Ot.style.transition=J.props.moveTransition,lr()&&J.props.animation){var wd=gr(),Oa=wd.box,_s=wd.content;tI([Oa,_s],or),GO([Oa,_s],"visible")}To(),Qn(),QO(rI,J),(Gn=J.popperInstance)==null||Gn.forceUpdate(),Dn("onMount",[J]),J.props.animation&&lr()&&Ln(or,function(){J.state.isShown=!0,Dn("onShown",[J])})}},Pn()}}function yd(){var Tt=!J.state.isVisible,re=J.state.isDestroyed,_e=!J.state.isEnabled,dr=$_(J.props.duration,1,us.duration);if(!(Tt||re||_e)&&(Dn("onHide",[J],!1),J.props.onHide(J)!==!1)){if(J.state.isVisible=!1,J.state.isShown=!1,C=!1,g=!1,lr()&&(Ot.style.visibility="hidden"),Gs(),Bi(),ln(!0),lr()){var or=gr(),Sn=or.box,Mi=or.content;J.props.animation&&(tI([Sn,Mi],dr),GO([Sn,Mi],"hidden"))}To(),Qn(),J.props.animation?lr()&&Ra(dr,J.unmount):J.unmount()}}function wh(Tt){Zr().addEventListener("mousemove",G),QO(JA,G),G(Tt)}function Gf(){J.state.isVisible&&J.hide(),!!J.state.isMounted&&(ti(),Jo().forEach(function(Tt){Tt._tippy.unmount()}),Ot.parentNode&&Ot.parentNode.removeChild(Ot),rI=rI.filter(function(Tt){return Tt!==J}),J.state.isMounted=!1,Dn("onHidden",[J]))}function jf(){J.state.isDestroyed||(J.clearDelayTimeouts(),J.unmount(),$c(),delete o._tippy,J.state.isDestroyed=!0,Dn("onDestroy",[J]))}}function Rd(o,n){n===void 0&&(n={});var a=us.plugins.concat(n.plugins||[]);mJ();var c=Object.assign({},n,{plugins:a}),u=hJ(o),A=u.reduce(function(g,E){var I=E&&wJ(E,c);return I&&g.push(I),g},[]);return Ff(o)?A[0]:A}Rd.defaultProps=us;Rd.setDefaultProps=SJ;Rd.currentInput=Ps;Object.assign({},nD,{effect:function(n){var a=n.state,c={popper:{position:a.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(a.elements.popper.style,c.popper),a.styles=c,a.elements.arrow&&Object.assign(a.elements.arrow.style,c.arrow)}});Rd.setDefaultProps({render:mD});class bJ{constructor({editor:n,element:a,view:c,tippyOptions:u={},shouldShow:A}){this.preventHide=!1,this.shouldShow=({view:g,state:E,from:I,to:C})=>{const{doc:b,selection:N}=E,{empty:L}=N,Q=!b.textBetween(I,C).length&&Wk(E.selection);return!(!g.hasFocus()||L||Q)},this.mousedownHandler=()=>{this.preventHide=!0},this.dragstartHandler=()=>{this.hide()},this.focusHandler=()=>{setTimeout(()=>this.update(this.editor.view))},this.blurHandler=({event:g})=>{var E;if(this.preventHide){this.preventHide=!1;return}(g==null?void 0:g.relatedTarget)&&((E=this.element.parentNode)===null||E===void 0?void 0:E.contains(g.relatedTarget))||this.hide()},this.editor=n,this.element=a,this.view=c,A&&(this.shouldShow=A),this.element.addEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.view.dom.addEventListener("dragstart",this.dragstartHandler),this.editor.on("focus",this.focusHandler),this.editor.on("blur",this.blurHandler),this.tippyOptions=u,this.element.remove(),this.element.style.visibility="visible"}createTooltip(){const{element:n}=this.editor.options,a=!!n.parentElement;this.tippy||!a||(this.tippy=Rd(n,Nt({duration:0,getReferenceClientRect:null,content:this.element,interactive:!0,trigger:"manual",placement:"top",hideOnClick:"toggle"},this.tippyOptions)),this.tippy.popper.firstChild&&this.tippy.popper.firstChild.addEventListener("blur",c=>{this.blurHandler({event:c})}))}update(n,a){var c,u;const{state:A,composing:g}=n,{doc:E,selection:I}=A,C=a&&a.doc.eq(E)&&a.selection.eq(I);if(g||C)return;this.createTooltip();const{ranges:b}=I,N=Math.min(...b.map(G=>G.$from.pos)),L=Math.max(...b.map(G=>G.$to.pos));if(!((c=this.shouldShow)===null||c===void 0?void 0:c.call(this,{editor:this.editor,view:n,state:A,oldState:a,from:N,to:L}))){this.hide();return}(u=this.tippy)===null||u===void 0||u.setProps({getReferenceClientRect:()=>{if(ZY(A.selection)){const G=n.nodeDOM(N);if(G)return G.getBoundingClientRect()}return $k(n,N,L)}}),this.show()}show(){var n;(n=this.tippy)===null||n===void 0||n.show()}hide(){var n;(n=this.tippy)===null||n===void 0||n.hide()}destroy(){var n;(n=this.tippy)===null||n===void 0||n.destroy(),this.element.removeEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.view.dom.removeEventListener("dragstart",this.dragstartHandler),this.editor.off("focus",this.focusHandler),this.editor.off("blur",this.blurHandler)}}const ED=o=>new Fn({key:typeof o.pluginKey=="string"?new Ti(o.pluginKey):o.pluginKey,view:n=>new bJ(Nt({view:n},o))});Xn.create({name:"bubbleMenu",addOptions(){return{element:null,tippyOptions:{},pluginKey:"bubbleMenu",shouldShow:null}},addProseMirrorPlugins(){return this.options.element?[ED({pluginKey:this.options.pluginKey,editor:this.editor,element:this.options.element,tippyOptions:this.options.tippyOptions,shouldShow:this.options.shouldShow})]:[]}});class NJ{constructor({editor:n,element:a,view:c,tippyOptions:u={},shouldShow:A}){this.preventHide=!1,this.shouldShow=({view:g,state:E})=>{const{selection:I}=E,{$anchor:C,empty:b}=I,N=C.depth===1,L=C.parent.isTextblock&&!C.parent.type.spec.code&&!C.parent.textContent;return!(!g.hasFocus()||!b||!N||!L)},this.mousedownHandler=()=>{this.preventHide=!0},this.focusHandler=()=>{setTimeout(()=>this.update(this.editor.view))},this.blurHandler=({event:g})=>{var E;if(this.preventHide){this.preventHide=!1;return}(g==null?void 0:g.relatedTarget)&&((E=this.element.parentNode)===null||E===void 0?void 0:E.contains(g.relatedTarget))||this.hide()},this.editor=n,this.element=a,this.view=c,A&&(this.shouldShow=A),this.element.addEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.editor.on("focus",this.focusHandler),this.editor.on("blur",this.blurHandler),this.tippyOptions=u,this.element.remove(),this.element.style.visibility="visible"}createTooltip(){const{element:n}=this.editor.options,a=!!n.parentElement;this.tippy||!a||(this.tippy=Rd(n,Nt({duration:0,getReferenceClientRect:null,content:this.element,interactive:!0,trigger:"manual",placement:"right",hideOnClick:"toggle"},this.tippyOptions)),this.tippy.popper.firstChild&&this.tippy.popper.firstChild.addEventListener("blur",c=>{this.blurHandler({event:c})}))}update(n,a){var c,u;const{state:A}=n,{doc:g,selection:E}=A,{from:I,to:C}=E;if(a&&a.doc.eq(g)&&a.selection.eq(E))return;if(this.createTooltip(),!((c=this.shouldShow)===null||c===void 0?void 0:c.call(this,{editor:this.editor,view:n,state:A,oldState:a}))){this.hide();return}(u=this.tippy)===null||u===void 0||u.setProps({getReferenceClientRect:()=>$k(n,I,C)}),this.show()}show(){var n;(n=this.tippy)===null||n===void 0||n.show()}hide(){var n;(n=this.tippy)===null||n===void 0||n.hide()}destroy(){var n;(n=this.tippy)===null||n===void 0||n.destroy(),this.element.removeEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.editor.off("focus",this.focusHandler),this.editor.off("blur",this.blurHandler)}}const _D=o=>new Fn({key:typeof o.pluginKey=="string"?new Ti(o.pluginKey):o.pluginKey,view:n=>new NJ(Nt({view:n},o))});Xn.create({name:"floatingMenu",addOptions(){return{element:null,tippyOptions:{},pluginKey:"floatingMenu",shouldShow:null}},addProseMirrorPlugins(){return this.options.element?[_D({pluginKey:this.options.pluginKey,editor:this.editor,element:this.options.element,tippyOptions:this.options.tippyOptions,shouldShow:this.options.shouldShow})]:[]}});_h({name:"BubbleMenu",props:{pluginKey:{type:null,default:"bubbleMenu"},editor:{type:Object,required:!0},tippyOptions:{type:Object,default:()=>({})},shouldShow:{type:Function,default:null}},setup(o,{slots:n}){const a=Wc(null);return LI(()=>{const{pluginKey:c,editor:u,tippyOptions:A,shouldShow:g}=o;u.registerPlugin(ED({pluginKey:c,editor:u,element:a.value,tippyOptions:A,shouldShow:g}))}),PI(()=>{const{pluginKey:c,editor:u}=o;u.unregisterPlugin(c)}),()=>{var c;return Qc("div",{ref:a},(c=n.default)===null||c===void 0?void 0:c.call(n))}}});function qO(o){return EG((n,a)=>({get(){return n(),o},set(c){o=c,requestAnimationFrame(()=>{requestAnimationFrame(()=>{a()})})}}))}class OJ extends zY{constructor(n={}){super(n);return this.vueRenderers=Yu(new Map),this.contentComponent=null,this.reactiveState=qO(this.view.state),this.reactiveExtensionStorage=qO(this.extensionStorage),this.on("transaction",()=>{this.reactiveState.value=this.view.state,this.reactiveExtensionStorage.value=this.extensionStorage}),_G(this)}get state(){return this.reactiveState?this.reactiveState.value:this.view.state}get storage(){return this.reactiveExtensionStorage?this.reactiveExtensionStorage.value:super.storage}registerPlugin(n,a){super.registerPlugin(n,a),this.reactiveState.value=this.view.state}unregisterPlugin(n){super.unregisterPlugin(n),this.reactiveState.value=this.view.state}}const kJ=_h({name:"EditorContent",props:{editor:{default:null,type:Object}},setup(o){const n=Wc(),a=CG();return IG(()=>{const c=o.editor;c&&c.options.element&&n.value&&o2(()=>{if(!n.value||!c.options.element.firstChild)return;const u=ds(n.value);n.value.append(...c.options.element.childNodes),c.contentComponent=a.ctx._,c.setOptions({element:u}),c.createNodeViews()})}),PI(()=>{const c=o.editor;if(!c||(c.isDestroyed||c.view.setProps({nodeViews:{}}),c.contentComponent=null,!c.options.element.firstChild))return;const u=document.createElement("div");u.append(...c.options.element.childNodes),c.setOptions({element:u})}),{rootEl:n}},render(){const o=[];return this.editor&&this.editor.vueRenderers.forEach(n=>{const a=Qc(vG,{to:n.teleportElement,key:n.id},Qc(n.component,Nt({ref:n.id},n.props)));o.push(a)}),Qc("div",{ref:n=>{this.rootEl=n}},...o)}});_h({name:"FloatingMenu",props:{pluginKey:{type:null,default:"floatingMenu"},editor:{type:Object,required:!0},tippyOptions:{type:Object,default:()=>({})},shouldShow:{type:Function,default:null}},setup(o,{slots:n}){const a=Wc(null);return LI(()=>{const{pluginKey:c,editor:u,tippyOptions:A,shouldShow:g}=o;u.registerPlugin(_D({pluginKey:c,editor:u,element:a.value,tippyOptions:A,shouldShow:g}))}),PI(()=>{const{pluginKey:c,editor:u}=o;u.unregisterPlugin(c)}),()=>{var c;return Qc("div",{ref:a},(c=n.default)===null||c===void 0?void 0:c.call(n))}}});_h({props:{as:{type:String,default:"div"}},inject:["onDragStart","decorationClasses"],render(){var o,n;return Qc(this.as,{class:this.decorationClasses.value,style:{whiteSpace:"normal"},"data-node-view-wrapper":"",onDragstart:this.onDragStart},(n=(o=this.$slots).default)===null||n===void 0?void 0:n.call(o))}});_h({props:{as:{type:String,default:"div"}},render(){return Qc(this.as,{style:{whiteSpace:"pre-wrap"},"data-node-view-content":""})}});const DJ=/^\s*>\s$/,LJ=Ci.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:o}){return["blockquote",$n(this.options.HTMLAttributes,o),0]},addCommands(){return{setBlockquote:()=>({commands:o})=>o.wrapIn(this.name),toggleBlockquote:()=>({commands:o})=>o.toggleWrap(this.name),unsetBlockquote:()=>({commands:o})=>o.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[Uf({find:DJ,type:this.type})]}}),PJ=/(?:^|\s)((?:\*\*)((?:[^*]+))(?:\*\*))$/,BJ=/(?:^|\s)((?:\*\*)((?:[^*]+))(?:\*\*))/g,MJ=/(?:^|\s)((?:__)((?:[^__]+))(?:__))$/,UJ=/(?:^|\s)((?:__)((?:[^__]+))(?:__))/g,xJ=tc.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:o=>o.style.fontWeight!=="normal"&&null},{style:"font-weight",getAttrs:o=>/^(bold(er)?|[5-9]\d{2,})$/.test(o)&&null}]},renderHTML({HTMLAttributes:o}){return["strong",$n(this.options.HTMLAttributes,o),0]},addCommands(){return{setBold:()=>({commands:o})=>o.setMark(this.name),toggleBold:()=>({commands:o})=>o.toggleMark(this.name),unsetBold:()=>({commands:o})=>o.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[qc({find:PJ,type:this.type}),qc({find:MJ,type:this.type})]},addPasteRules(){return[Jc({find:BJ,type:this.type}),Jc({find:UJ,type:this.type})]}}),FJ=/^\s*([-+*])\s$/,QJ=Ci.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:o}){return["ul",$n(this.options.HTMLAttributes,o),0]},addCommands(){return{toggleBulletList:()=>({commands:o})=>o.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){return[Uf({find:FJ,type:this.type})]}}),VJ=/(?:^|\s)((?:`)((?:[^`]+))(?:`))$/,GJ=/(?:^|\s)((?:`)((?:[^`]+))(?:`))/g,jJ=tc.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:o}){return["code",$n(this.options.HTMLAttributes,o),0]},addCommands(){return{setCode:()=>({commands:o})=>o.setMark(this.name),toggleCode:()=>({commands:o})=>o.toggleMark(this.name),unsetCode:()=>({commands:o})=>o.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[qc({find:VJ,type:this.type})]},addPasteRules(){return[Jc({find:GJ,type:this.type})]}}),HJ=/^```([a-z]+)?[\s\n]$/,KJ=/^~~~([a-z]+)?[\s\n]$/,WJ=Ci.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:null,parseHTML:o=>{var n;const{languageClassPrefix:a}=this.options,A=[...((n=o.firstElementChild)===null||n===void 0?void 0:n.classList)||[]].filter(g=>g.startsWith(a)).map(g=>g.replace(a,""))[0];return A||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:o,HTMLAttributes:n}){return["pre",$n(this.options.HTMLAttributes,n),["code",{class:o.attrs.language?this.options.languageClassPrefix+o.attrs.language:null},0]]},addCommands(){return{setCodeBlock:o=>({commands:n})=>n.setNode(this.name,o),toggleCodeBlock:o=>({commands:n})=>n.toggleNode(this.name,"paragraph",o)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:o,$anchor:n}=this.editor.state.selection,a=n.pos===1;return!o||n.parent.type.name!==this.name?!1:a||!n.parent.textContent.length?this.editor.commands.clearNodes():!1},Enter:({editor:o})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:n}=o,{selection:a}=n,{$from:c,empty:u}=a;if(!u||c.parent.type!==this.type)return!1;const A=c.parentOffset===c.parent.nodeSize-2,g=c.parent.textContent.endsWith(`

`);return!A||!g?!1:o.chain().command(({tr:E})=>(E.delete(c.pos-2,c.pos),!0)).exitCode().run()},ArrowDown:({editor:o})=>{if(!this.options.exitOnArrowDown)return!1;const{state:n}=o,{selection:a,doc:c}=n,{$from:u,empty:A}=a;if(!A||u.parent.type!==this.type||!(u.parentOffset===u.parent.nodeSize-2))return!1;const E=u.after();return E===void 0||c.nodeAt(E)?!1:o.commands.exitCode()}}},addInputRules(){return[RI({find:HJ,type:this.type,getAttributes:o=>({language:o[1]})}),RI({find:KJ,type:this.type,getAttributes:o=>({language:o[1]})})]},addProseMirrorPlugins(){return[new Fn({key:new Ti("codeBlockVSCodeHandler"),props:{handlePaste:(o,n)=>{if(!n.clipboardData||this.editor.isActive(this.type.name))return!1;const a=n.clipboardData.getData("text/plain"),c=n.clipboardData.getData("vscode-editor-data"),u=c?JSON.parse(c):void 0,A=u==null?void 0:u.mode;if(!a||!A)return!1;const{tr:g}=o.state;return g.replaceSelectionWith(this.type.create({language:A})),g.setSelection(rr.near(g.doc.resolve(Math.max(0,g.selection.from-2)))),g.insertText(a.replace(/\r\n?/g,`
`)),g.setMeta("paste",!0),o.dispatch(g),!0}}})]}}),YJ=Ci.create({name:"doc",topNode:!0,content:"block+"});function qJ(o){return o===void 0&&(o={}),new Fn({view:function(a){return new Vs(a,o)}})}var Vs=function(n,a){var c=this;this.editorView=n,this.width=a.width||1,this.color=a.color||"black",this.class=a.class,this.cursorPos=null,this.element=null,this.timeout=null,this.handlers=["dragover","dragend","drop","dragleave"].map(function(u){var A=function(g){return c[u](g)};return n.dom.addEventListener(u,A),{name:u,handler:A}})};Vs.prototype.destroy=function(){var n=this;this.handlers.forEach(function(a){var c=a.name,u=a.handler;return n.editorView.dom.removeEventListener(c,u)})};Vs.prototype.update=function(n,a){this.cursorPos!=null&&a.doc!=n.state.doc&&(this.cursorPos>n.state.doc.content.size?this.setCursor(null):this.updateOverlay())};Vs.prototype.setCursor=function(n){n!=this.cursorPos&&(this.cursorPos=n,n==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())};Vs.prototype.updateOverlay=function(){var n=this.editorView.state.doc.resolve(this.cursorPos),a;if(!n.parent.inlineContent){var c=n.nodeBefore,u=n.nodeAfter;if(c||u){var A=this.editorView.nodeDOM(this.cursorPos-(c?c.nodeSize:0)).getBoundingClientRect(),g=c?A.bottom:A.top;c&&u&&(g=(g+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),a={left:A.left,right:A.right,top:g-this.width/2,bottom:g+this.width/2}}}if(!a){var E=this.editorView.coordsAtPos(this.cursorPos);a={left:E.left-this.width/2,right:E.left+this.width/2,top:E.top,bottom:E.bottom}}var I=this.editorView.dom.offsetParent;this.element||(this.element=I.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none; background-color: "+this.color);var C,b;if(!I||I==document.body&&getComputedStyle(I).position=="static")C=-pageXOffset,b=-pageYOffset;else{var N=I.getBoundingClientRect();C=N.left-I.scrollLeft,b=N.top-I.scrollTop}this.element.style.left=a.left-C+"px",this.element.style.top=a.top-b+"px",this.element.style.width=a.right-a.left+"px",this.element.style.height=a.bottom-a.top+"px"};Vs.prototype.scheduleRemoval=function(n){var a=this;clearTimeout(this.timeout),this.timeout=setTimeout(function(){return a.setCursor(null)},n)};Vs.prototype.dragover=function(n){if(!!this.editorView.editable){var a=this.editorView.posAtCoords({left:n.clientX,top:n.clientY}),c=a&&a.inside>=0&&this.editorView.state.doc.nodeAt(a.inside),u=c&&c.type.spec.disableDropCursor,A=typeof u=="function"?u(this.editorView,a):u;if(a&&!A){var g=a.pos;if(this.editorView.dragging&&this.editorView.dragging.slice&&(g=M2(this.editorView.state.doc,g,this.editorView.dragging.slice),g==null))return this.setCursor(null);this.setCursor(g),this.scheduleRemoval(5e3)}}};Vs.prototype.dragend=function(){this.scheduleRemoval(20)};Vs.prototype.drop=function(){this.scheduleRemoval(20)};Vs.prototype.dragleave=function(n){(n.target==this.editorView.dom||!this.editorView.dom.contains(n.relatedTarget))&&this.setCursor(null)};const JJ=Xn.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:null}},addProseMirrorPlugins(){return[qJ(this.options)]}});var fs=function(o){function n(a){o.call(this,a,a)}return o&&(n.__proto__=o),n.prototype=Object.create(o&&o.prototype),n.prototype.constructor=n,n.prototype.map=function(c,u){var A=c.resolve(u.map(this.head));return n.valid(A)?new n(A):o.near(A)},n.prototype.content=function(){return Kt.empty},n.prototype.eq=function(c){return c instanceof n&&c.head==this.head},n.prototype.toJSON=function(){return{type:"gapcursor",pos:this.head}},n.fromJSON=function(c,u){if(typeof u.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new n(c.resolve(u.pos))},n.prototype.getBookmark=function(){return new gf(this.anchor)},n.valid=function(c){var u=c.parent;if(u.isTextblock||!zJ(c)||!XJ(c))return!1;var A=u.type.spec.allowGapCursor;if(A!=null)return A;var g=u.contentMatchAt(c.index()).defaultType;return g&&g.isTextblock},n.findFrom=function(c,u,A){t:for(;;){if(!A&&n.valid(c))return c;for(var g=c.pos,E=null,I=c.depth;;I--){var C=c.node(I);if(u>0?c.indexAfter(I)<C.childCount:c.index(I)>0){E=C.child(u>0?c.indexAfter(I):c.index(I)-1);break}else if(I==0)return null;g+=u;var b=c.doc.resolve(g);if(n.valid(b))return b}for(;;){var N=u>0?E.firstChild:E.lastChild;if(!N){if(E.isAtom&&!E.isText&&!ke.isSelectable(E)){c=c.doc.resolve(g+E.nodeSize*u),A=!1;continue t}break}E=N,g+=u;var L=c.doc.resolve(g);if(n.valid(L))return L}return null}},n}(De);fs.prototype.visible=!1;De.jsonID("gapcursor",fs);var gf=function(n){this.pos=n};gf.prototype.map=function(n){return new gf(n.map(this.pos))};gf.prototype.resolve=function(n){var a=n.resolve(this.pos);return fs.valid(a)?new fs(a):De.near(a)};function zJ(o){for(var n=o.depth;n>=0;n--){var a=o.index(n),c=o.node(n);if(a==0){if(c.type.spec.isolating)return!0;continue}for(var u=c.child(a-1);;u=u.lastChild){if(u.childCount==0&&!u.inlineContent||u.isAtom||u.type.spec.isolating)return!0;if(u.inlineContent)return!1}}return!0}function XJ(o){for(var n=o.depth;n>=0;n--){var a=o.indexAfter(n),c=o.node(n);if(a==c.childCount){if(c.type.spec.isolating)return!0;continue}for(var u=c.child(a);;u=u.firstChild){if(u.childCount==0&&!u.inlineContent||u.isAtom||u.type.spec.isolating)return!0;if(u.inlineContent)return!1}}return!0}var ZJ=function(){return new Fn({props:{decorations:ez,createSelectionBetween:function(n,a,c){if(a.pos==c.pos&&fs.valid(c))return new fs(c)},handleClick:tz,handleKeyDown:$J}})},$J=Vk({ArrowLeft:zA("horiz",-1),ArrowRight:zA("horiz",1),ArrowUp:zA("vert",-1),ArrowDown:zA("vert",1)});function zA(o,n){var a=o=="vert"?n>0?"down":"up":n>0?"right":"left";return function(c,u,A){var g=c.selection,E=n>0?g.$to:g.$from,I=g.empty;if(g instanceof rr){if(!A.endOfTextblock(a)||E.depth==0)return!1;I=!1,E=c.doc.resolve(n>0?E.after():E.before())}var C=fs.findFrom(E,n,I);return C?(u&&u(c.tr.setSelection(new fs(C))),!0):!1}}function tz(o,n,a){if(!o.editable)return!1;var c=o.state.doc.resolve(n);if(!fs.valid(c))return!1;var u=o.posAtCoords({left:a.clientX,top:a.clientY}),A=u.inside;return A>-1&&ke.isSelectable(o.state.doc.nodeAt(A))?!1:(o.dispatch(o.state.tr.setSelection(new fs(c))),!0)}function ez(o){if(!(o.selection instanceof fs))return null;var n=document.createElement("div");return n.className="ProseMirror-gapcursor",Nr.create(o.doc,[On.widget(o.selection.head,n,{key:"gapcursor"})])}const rz=Xn.create({name:"gapCursor",addProseMirrorPlugins(){return[ZJ()]},extendNodeSchema(o){var n;const a={name:o.name,options:o.options,storage:o.storage};return{allowGapCursor:(n=Ge(ee(o,"allowGapCursor",a)))!==null&&n!==void 0?n:null}}}),nz=Ci.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:o}){return["br",$n(this.options.HTMLAttributes,o)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:o,chain:n,state:a,editor:c})=>o.first([()=>o.exitCode(),()=>o.command(()=>{const{selection:u,storedMarks:A}=a;if(u.$from.parent.type.spec.isolating)return!1;const{keepMarks:g}=this.options,{splittableMarks:E}=c.extensionManager,I=A||u.$to.parentOffset&&u.$from.marks();return n().insertContent({type:this.name}).command(({tr:C,dispatch:b})=>{if(b&&I&&g){const N=I.filter(L=>E.includes(L.type.name));C.ensureMarks(N)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),iz=Ci.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(o=>({tag:`h${o}`,attrs:{level:o}}))},renderHTML({node:o,HTMLAttributes:n}){return[`h${this.options.levels.includes(o.attrs.level)?o.attrs.level:this.options.levels[0]}`,$n(this.options.HTMLAttributes,n),0]},addCommands(){return{setHeading:o=>({commands:n})=>this.options.levels.includes(o.level)?n.setNode(this.name,o):!1,toggleHeading:o=>({commands:n})=>this.options.levels.includes(o.level)?n.toggleNode(this.name,"paragraph",o):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((o,n)=>zn(Nt({},o),{[`Mod-Alt-${n}`]:()=>this.editor.commands.toggleHeading({level:n})}),{})},addInputRules(){return this.options.levels.map(o=>RI({find:new RegExp(`^(#{1,${o}})\\s$`),type:this.type,getAttributes:{level:o}}))}});var mf=200,si=function(){};si.prototype.append=function(n){return n.length?(n=si.from(n),!this.length&&n||n.length<mf&&this.leafAppend(n)||this.length<mf&&n.leafPrepend(this)||this.appendInner(n)):this};si.prototype.prepend=function(n){return n.length?si.from(n).append(this):this};si.prototype.appendInner=function(n){return new oz(this,n)};si.prototype.slice=function(n,a){return n===void 0&&(n=0),a===void 0&&(a=this.length),n>=a?si.empty:this.sliceInner(Math.max(0,n),Math.min(this.length,a))};si.prototype.get=function(n){if(!(n<0||n>=this.length))return this.getInner(n)};si.prototype.forEach=function(n,a,c){a===void 0&&(a=0),c===void 0&&(c=this.length),a<=c?this.forEachInner(n,a,c,0):this.forEachInvertedInner(n,a,c,0)};si.prototype.map=function(n,a,c){a===void 0&&(a=0),c===void 0&&(c=this.length);var u=[];return this.forEach(function(A,g){return u.push(n(A,g))},a,c),u};si.from=function(n){return n instanceof si?n:n&&n.length?new ID(n):si.empty};var ID=function(o){function n(c){o.call(this),this.values=c}o&&(n.__proto__=o),n.prototype=Object.create(o&&o.prototype),n.prototype.constructor=n;var a={length:{configurable:!0},depth:{configurable:!0}};return n.prototype.flatten=function(){return this.values},n.prototype.sliceInner=function(u,A){return u==0&&A==this.length?this:new n(this.values.slice(u,A))},n.prototype.getInner=function(u){return this.values[u]},n.prototype.forEachInner=function(u,A,g,E){for(var I=A;I<g;I++)if(u(this.values[I],E+I)===!1)return!1},n.prototype.forEachInvertedInner=function(u,A,g,E){for(var I=A-1;I>=g;I--)if(u(this.values[I],E+I)===!1)return!1},n.prototype.leafAppend=function(u){if(this.length+u.length<=mf)return new n(this.values.concat(u.flatten()))},n.prototype.leafPrepend=function(u){if(this.length+u.length<=mf)return new n(u.flatten().concat(this.values))},a.length.get=function(){return this.values.length},a.depth.get=function(){return 0},Object.defineProperties(n.prototype,a),n}(si);si.empty=new ID([]);var oz=function(o){function n(a,c){o.call(this),this.left=a,this.right=c,this.length=a.length+c.length,this.depth=Math.max(a.depth,c.depth)+1}return o&&(n.__proto__=o),n.prototype=Object.create(o&&o.prototype),n.prototype.constructor=n,n.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},n.prototype.getInner=function(c){return c<this.left.length?this.left.get(c):this.right.get(c-this.left.length)},n.prototype.forEachInner=function(c,u,A,g){var E=this.left.length;if(u<E&&this.left.forEachInner(c,u,Math.min(A,E),g)===!1||A>E&&this.right.forEachInner(c,Math.max(u-E,0),Math.min(this.length,A)-E,g+E)===!1)return!1},n.prototype.forEachInvertedInner=function(c,u,A,g){var E=this.left.length;if(u>E&&this.right.forEachInvertedInner(c,u-E,Math.max(A,E)-E,g+E)===!1||A<E&&this.left.forEachInvertedInner(c,Math.min(u,E),A,g)===!1)return!1},n.prototype.sliceInner=function(c,u){if(c==0&&u==this.length)return this;var A=this.left.length;return u<=A?this.left.slice(c,u):c>=A?this.right.slice(c-A,u-A):this.left.slice(c,A).append(this.right.slice(0,u-A))},n.prototype.leafAppend=function(c){var u=this.right.leafAppend(c);if(u)return new n(this.left,u)},n.prototype.leafPrepend=function(c){var u=this.left.leafPrepend(c);if(u)return new n(u,this.right)},n.prototype.appendInner=function(c){return this.left.depth>=Math.max(this.right.depth,c.depth)+1?new n(this.left,new n(this.right,c)):new n(this,c)},n}(si),vD=si,sz=500,li=function(n,a){this.items=n,this.eventCount=a};li.prototype.popEvent=function(n,a){var c=this;if(this.eventCount==0)return null;for(var u=this.items.length;;u--){var A=this.items.get(u-1);if(A.selection){--u;break}}var g,E;a&&(g=this.remapping(u,this.items.length),E=g.maps.length);var I=n.tr,C,b,N=[],L=[];return this.items.forEach(function(Q,G){if(!Q.step){g||(g=c.remapping(u,G+1),E=g.maps.length),E--,L.push(Q);return}if(g){L.push(new Us(Q.map));var Z=Q.step.map(g.slice(E)),dt;Z&&I.maybeStep(Z).doc&&(dt=I.mapping.maps[I.mapping.maps.length-1],N.push(new Us(dt,null,null,N.length+L.length))),E--,dt&&g.appendMap(dt,E)}else I.maybeStep(Q.step);if(Q.selection)return C=g?Q.selection.map(g.slice(E)):Q.selection,b=new li(c.items.slice(0,u).append(L.reverse().concat(N)),c.eventCount-1),!1},this.items.length,0),{remaining:b,transform:I,selection:C}};li.prototype.addTransform=function(n,a,c,u){for(var A=[],g=this.eventCount,E=this.items,I=!u&&E.length?E.get(E.length-1):null,C=0;C<n.steps.length;C++){var b=n.steps[C].invert(n.docs[C]),N=new Us(n.mapping.maps[C],b,a),L=void 0;(L=I&&I.merge(N))&&(N=L,C?A.pop():E=E.slice(0,E.length-1)),A.push(N),a&&(g++,a=null),u||(I=N)}var Q=g-c.depth;return Q>cz&&(E=az(E,Q),g-=Q),new li(E.append(A),g)};li.prototype.remapping=function(n,a){var c=new Ii;return this.items.forEach(function(u,A){var g=u.mirrorOffset!=null&&A-u.mirrorOffset>=n?c.maps.length-u.mirrorOffset:null;c.appendMap(u.map,g)},n,a),c};li.prototype.addMaps=function(n){return this.eventCount==0?this:new li(this.items.append(n.map(function(a){return new Us(a)})),this.eventCount)};li.prototype.rebased=function(n,a){if(!this.eventCount)return this;var c=[],u=Math.max(0,this.items.length-a),A=n.mapping,g=n.steps.length,E=this.eventCount;this.items.forEach(function(Q){Q.selection&&E--},u);var I=a;this.items.forEach(function(Q){var G=A.getMirror(--I);if(G!=null){g=Math.min(g,G);var Z=A.maps[G];if(Q.step){var dt=n.steps[G].invert(n.docs[G]),lt=Q.selection&&Q.selection.map(A.slice(I+1,G));lt&&E++,c.push(new Us(Z,dt,lt))}else c.push(new Us(Z))}},u);for(var C=[],b=a;b<g;b++)C.push(new Us(A.maps[b]));var N=this.items.slice(0,u).append(C).append(c),L=new li(N,E);return L.emptyItemCount()>sz&&(L=L.compress(this.items.length-c.length)),L};li.prototype.emptyItemCount=function(){var n=0;return this.items.forEach(function(a){a.step||n++}),n};li.prototype.compress=function(n){n===void 0&&(n=this.items.length);var a=this.remapping(0,n),c=a.maps.length,u=[],A=0;return this.items.forEach(function(g,E){if(E>=n)u.push(g),g.selection&&A++;else if(g.step){var I=g.step.map(a.slice(c)),C=I&&I.getMap();if(c--,C&&a.appendMap(C,c),I){var b=g.selection&&g.selection.map(a.slice(c));b&&A++;var N=new Us(C.invert(),I,b),L,Q=u.length-1;(L=u.length&&u[Q].merge(N))?u[Q]=L:u.push(N)}}else g.map&&c--},this.items.length,0),new li(vD.from(u.reverse()),A)};li.empty=new li(vD.empty,0);function az(o,n){var a;return o.forEach(function(c,u){if(c.selection&&n--==0)return a=u,!1}),o.slice(a)}var Us=function(n,a,c,u){this.map=n,this.step=a,this.selection=c,this.mirrorOffset=u};Us.prototype.merge=function(n){if(this.step&&n.step&&!n.selection){var a=n.step.merge(this.step);if(a)return new Us(a.getMap().invert(),a,this.selection)}};var qa=function(n,a,c,u){this.done=n,this.undone=a,this.prevRanges=c,this.prevTime=u},cz=20;function lz(o,n,a,c){var u=a.getMeta(za),A;if(u)return u.historyState;a.getMeta(uz)&&(o=new qa(o.done,o.undone,null,0));var g=a.getMeta("appendedTransaction");if(a.steps.length==0)return o;if(g&&g.getMeta(za))return g.getMeta(za).redo?new qa(o.done.addTransform(a,null,c,tf(n)),o.undone,JO(a.mapping.maps[a.steps.length-1]),o.prevTime):new qa(o.done,o.undone.addTransform(a,null,c,tf(n)),null,o.prevTime);if(a.getMeta("addToHistory")!==!1&&!(g&&g.getMeta("addToHistory")===!1)){var E=o.prevTime==0||!g&&(o.prevTime<(a.time||0)-c.newGroupDelay||!dz(a,o.prevRanges)),I=g?nI(o.prevRanges,a.mapping):JO(a.mapping.maps[a.steps.length-1]);return new qa(o.done.addTransform(a,E?n.selection.getBookmark():null,c,tf(n)),li.empty,I,a.time)}else return(A=a.getMeta("rebased"))?new qa(o.done.rebased(a,A),o.undone.rebased(a,A),nI(o.prevRanges,a.mapping),o.prevTime):new qa(o.done.addMaps(a.mapping.maps),o.undone.addMaps(a.mapping.maps),nI(o.prevRanges,a.mapping),o.prevTime)}function dz(o,n){if(!n)return!1;if(!o.docChanged)return!0;var a=!1;return o.mapping.maps[0].forEach(function(c,u){for(var A=0;A<n.length;A+=2)c<=n[A+1]&&u>=n[A]&&(a=!0)}),a}function JO(o){var n=[];return o.forEach(function(a,c,u,A){return n.push(u,A)}),n}function nI(o,n){if(!o)return null;for(var a=[],c=0;c<o.length;c+=2){var u=n.map(o[c],1),A=n.map(o[c+1],-1);u<=A&&a.push(u,A)}return a}function CD(o,n,a,c){var u=tf(n),A=za.get(n).spec.config,g=(c?o.undone:o.done).popEvent(n,u);if(!!g){var E=g.selection.resolve(g.transform.doc),I=(c?o.done:o.undone).addTransform(g.transform,n.selection.getBookmark(),A,u),C=new qa(c?I:g.remaining,c?g.remaining:I,null,0);a(g.transform.setSelection(E).setMeta(za,{redo:c,historyState:C}).scrollIntoView())}}var iI=!1,zO=null;function tf(o){var n=o.plugins;if(zO!=n){iI=!1,zO=n;for(var a=0;a<n.length;a++)if(n[a].spec.historyPreserveItems){iI=!0;break}}return iI}var za=new Ti("history"),uz=new Ti("closeHistory");function hz(o){return o={depth:o&&o.depth||100,newGroupDelay:o&&o.newGroupDelay||500},new Fn({key:za,state:{init:function(){return new qa(li.empty,li.empty,null,0)},apply:function(a,c,u){return lz(c,u,a,o)}},config:o,props:{handleDOMEvents:{beforeinput:function(a,c){var u=c.inputType=="historyUndo"?SD(a.state,a.dispatch):c.inputType=="historyRedo"?TD(a.state,a.dispatch):!1;return u&&c.preventDefault(),u}}}})}function SD(o,n){var a=za.getState(o);return!a||a.done.eventCount==0?!1:(n&&CD(a,o,n,!1),!0)}function TD(o,n){var a=za.getState(o);return!a||a.undone.eventCount==0?!1:(n&&CD(a,o,n,!0),!0)}const pz=Xn.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:o,dispatch:n})=>SD(o,n),redo:()=>({state:o,dispatch:n})=>TD(o,n)}},addProseMirrorPlugins(){return[hz(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Mod-y":()=>this.editor.commands.redo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-\u044F":()=>this.editor.commands.undo(),"Shift-Mod-\u044F":()=>this.editor.commands.redo()}}}),Az=Ci.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:o}){return["hr",$n(this.options.HTMLAttributes,o)]},addCommands(){return{setHorizontalRule:()=>({chain:o})=>o().insertContent({type:this.name}).command(({tr:n,dispatch:a})=>{var c;if(a){const{$to:u}=n.selection,A=u.end();if(u.nodeAfter)n.setSelection(rr.create(n.doc,u.pos));else{const g=(c=u.parent.type.contentMatch.defaultType)===null||c===void 0?void 0:c.create();g&&(n.insert(A,g),n.setSelection(rr.create(n.doc,A)))}n.scrollIntoView()}return!0}).run()}},addInputRules(){return[XY({find:/^(?:---|—-|___\s|\*\*\*\s)$/,type:this.type})]}}),fz=/(?:^|\s)((?:\*)((?:[^*]+))(?:\*))$/,gz=/(?:^|\s)((?:\*)((?:[^*]+))(?:\*))/g,mz=/(?:^|\s)((?:_)((?:[^_]+))(?:_))$/,Ez=/(?:^|\s)((?:_)((?:[^_]+))(?:_))/g,_z=tc.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:o=>o.style.fontStyle!=="normal"&&null},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:o}){return["em",$n(this.options.HTMLAttributes,o),0]},addCommands(){return{setItalic:()=>({commands:o})=>o.setMark(this.name),toggleItalic:()=>({commands:o})=>o.toggleMark(this.name),unsetItalic:()=>({commands:o})=>o.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[qc({find:fz,type:this.type}),qc({find:mz,type:this.type})]},addPasteRules(){return[Jc({find:gz,type:this.type}),Jc({find:Ez,type:this.type})]}}),Iz=Ci.create({name:"listItem",addOptions(){return{HTMLAttributes:{}}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:o}){return["li",$n(this.options.HTMLAttributes,o),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),vz=/^(\d+)\.\s$/,Cz=Ci.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:o=>o.hasAttribute("start")?parseInt(o.getAttribute("start")||"",10):1}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:o}){const c=o,{start:n}=c,a=BN(c,["start"]);return n===1?["ol",$n(this.options.HTMLAttributes,a),0]:["ol",$n(this.options.HTMLAttributes,o),0]},addCommands(){return{toggleOrderedList:()=>({commands:o})=>o.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){return[Uf({find:vz,type:this.type,getAttributes:o=>({start:+o[1]}),joinPredicate:(o,n)=>n.childCount+n.attrs.start===+o[1]})]}}),Sz=Ci.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:o}){return["p",$n(this.options.HTMLAttributes,o),0]},addCommands(){return{setParagraph:()=>({commands:o})=>o.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),Tz=/(?:^|\s)((?:~~)((?:[^~]+))(?:~~))$/,Rz=/(?:^|\s)((?:~~)((?:[^~]+))(?:~~))/g,yz=tc.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:o=>o.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:o}){return["s",$n(this.options.HTMLAttributes,o),0]},addCommands(){return{setStrike:()=>({commands:o})=>o.setMark(this.name),toggleStrike:()=>({commands:o})=>o.toggleMark(this.name),unsetStrike:()=>({commands:o})=>o.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-x":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[qc({find:Tz,type:this.type})]},addPasteRules(){return[Jc({find:Rz,type:this.type})]}}),wz=Ci.create({name:"text",group:"inline"}),bz=Xn.create({name:"starterKit",addExtensions(){var o,n,a,c,u,A,g,E,I,C,b,N,L,Q,G,Z,dt,lt;const et=[];return this.options.blockquote!==!1&&et.push(LJ.configure((o=this.options)===null||o===void 0?void 0:o.blockquote)),this.options.bold!==!1&&et.push(xJ.configure((n=this.options)===null||n===void 0?void 0:n.bold)),this.options.bulletList!==!1&&et.push(QJ.configure((a=this.options)===null||a===void 0?void 0:a.bulletList)),this.options.code!==!1&&et.push(jJ.configure((c=this.options)===null||c===void 0?void 0:c.code)),this.options.codeBlock!==!1&&et.push(WJ.configure((u=this.options)===null||u===void 0?void 0:u.codeBlock)),this.options.document!==!1&&et.push(YJ.configure((A=this.options)===null||A===void 0?void 0:A.document)),this.options.dropcursor!==!1&&et.push(JJ.configure((g=this.options)===null||g===void 0?void 0:g.dropcursor)),this.options.gapcursor!==!1&&et.push(rz.configure((E=this.options)===null||E===void 0?void 0:E.gapcursor)),this.options.hardBreak!==!1&&et.push(nz.configure((I=this.options)===null||I===void 0?void 0:I.hardBreak)),this.options.heading!==!1&&et.push(iz.configure((C=this.options)===null||C===void 0?void 0:C.heading)),this.options.history!==!1&&et.push(pz.configure((b=this.options)===null||b===void 0?void 0:b.history)),this.options.horizontalRule!==!1&&et.push(Az.configure((N=this.options)===null||N===void 0?void 0:N.horizontalRule)),this.options.italic!==!1&&et.push(_z.configure((L=this.options)===null||L===void 0?void 0:L.italic)),this.options.listItem!==!1&&et.push(Iz.configure((Q=this.options)===null||Q===void 0?void 0:Q.listItem)),this.options.orderedList!==!1&&et.push(Cz.configure((G=this.options)===null||G===void 0?void 0:G.orderedList)),this.options.paragraph!==!1&&et.push(Sz.configure((Z=this.options)===null||Z===void 0?void 0:Z.paragraph)),this.options.strike!==!1&&et.push(yz.configure((dt=this.options)===null||dt===void 0?void 0:dt.strike)),this.options.text!==!1&&et.push(wz.configure((lt=this.options)===null||lt===void 0?void 0:lt.text)),et}}),Nz=(o,n)=>{let a=0,c=0;for(;a<o.length&&a<n.length&&o[a]===n[a];)a++;if(a!==o.length||a!==n.length)for(;c+a<o.length&&c+a<n.length&&o[o.length-c-1]===n[n.length-c-1];)c++;return{index:a,remove:o.length-a-c,insert:n.slice(a,n.length-c)}},Oz=Nz,fn=new Ti("y-sync"),Kc=new Ti("y-undo"),XA=new Ti("yjs-cursor"),Ef=(o,n)=>n===void 0?!o.deleted:n.sv.has(o.id.client)&&n.sv.get(o.id.client)>o.id.clock&&!xG(n.ds,o.id),kz=[{light:"#ecd44433",dark:"#ecd444"}],Dz=(o,n,a)=>{if(!o.has(a)){if(o.size<n.length){const c=WG();o.forEach(u=>c.add(u)),n=n.filter(u=>!c.has(u))}o.set(a,jG(n))}return o.get(a)},Lz=(o,{colors:n=kz,colorMapping:a=new Map,permanentUserData:c=null}={})=>{let u=!1;const A=new Fn({props:{editable:g=>{const E=fn.getState(g);return E.snapshot==null&&E.prevSnapshot==null}},key:fn,state:{init:(g,E)=>({type:o,doc:o.doc,binding:null,snapshot:null,prevSnapshot:null,isChangeOrigin:!1,colors:n,colorMapping:a,permanentUserData:c}),apply:(g,E)=>{const I=g.getMeta(fn);if(I!==void 0){E=Object.assign({},E);for(const C in I)E[C]=I[C]}return E.isChangeOrigin=I!==void 0&&!!I.isChangeOrigin,E.binding!==null&&I!==void 0&&(I.snapshot!=null||I.prevSnapshot!=null)&&setTimeout(()=>{I.restore==null?E.binding._renderSnapshot(I.snapshot,I.prevSnapshot,E):(E.binding._renderSnapshot(I.snapshot,I.snapshot,E),delete E.restore,delete E.snapshot,delete E.prevSnapshot,E.binding._prosemirrorChanged(E.binding.prosemirrorView.state.doc))},0),E}},view:g=>{const E=new Bz(o,g);return setTimeout(()=>{E._forceRerender(),g.dispatch(g.state.tr.setMeta(fn,{binding:E}))},0),{update:()=>{const I=A.getState(g.state);I.snapshot==null&&I.prevSnapshot==null&&(u||g.state.doc.content.findDiffStart(g.state.doc.type.createAndFill().content)!==null)&&(u=!0,E._prosemirrorChanged(g.state.doc))},destroy:()=>{E.destroy()}}}});return A},Pz=(o,n,a)=>{if(n!==null&&n.anchor!==null&&n.head!==null){const c=Eh(a.doc,a.type,n.anchor,a.mapping),u=Eh(a.doc,a.type,n.head,a.mapping);c!==null&&u!==null&&(o=o.setSelection(rr.create(o.doc,c,u)))}},NI=(o,n)=>({anchor:If(n.selection.anchor,o.type,o.mapping),head:If(n.selection.head,o.type,o.mapping)});class Bz{constructor(n,a){this.type=n,this.prosemirrorView=a,this.mux=PG(),this.mapping=new Map,this._observeFunction=this._typeChanged.bind(this),this.doc=n.doc,this.beforeTransactionSelection=null,this.beforeAllTransactions=()=>{this.beforeTransactionSelection===null&&(this.beforeTransactionSelection=NI(this,a.state))},this.afterAllTransactions=()=>{this.beforeTransactionSelection=null},this.doc.on("beforeAllTransactions",this.beforeAllTransactions),this.doc.on("afterAllTransactions",this.afterAllTransactions),n.observeDeep(this._observeFunction),this._domSelectionInView=null}_isLocalCursorInView(){return this.prosemirrorView.hasFocus()?(BG&&this._domSelectionInView===null&&(setTimeout(()=>{this._domSelectionInView=null},0),this._domSelectionInView=this._isDomSelectionInView()),this._domSelectionInView):!1}_isDomSelectionInView(){const n=this.prosemirrorView._root.getSelection(),a=this.prosemirrorView._root.createRange();a.setStart(n.anchorNode,n.anchorOffset),a.setEnd(n.focusNode,n.focusOffset),a.getClientRects().length===0&&a.startContainer&&a.collapsed&&a.selectNodeContents(a.startContainer);const u=a.getBoundingClientRect(),A=MG.documentElement;return u.bottom>=0&&u.right>=0&&u.left<=(window.innerWidth||A.clientWidth||0)&&u.top<=(window.innerHeight||A.clientHeight||0)}renderSnapshot(n,a){a||(a=VG(GG(),new Map)),this.prosemirrorView.dispatch(this.prosemirrorView.state.tr.setMeta(fn,{snapshot:n,prevSnapshot:a}))}unrenderSnapshot(){this.mapping=new Map,this.mux(()=>{const n=this.type.toArray().map(c=>ef(c,this.prosemirrorView.state.schema,this.mapping)).filter(c=>c!==null),a=this.prosemirrorView.state.tr.replace(0,this.prosemirrorView.state.doc.content.size,new Kt(new bt(n),0,0));a.setMeta(fn,{snapshot:null,prevSnapshot:null}),this.prosemirrorView.dispatch(a)})}_forceRerender(){this.mapping=new Map,this.mux(()=>{const n=this.type.toArray().map(c=>ef(c,this.prosemirrorView.state.schema,this.mapping)).filter(c=>c!==null),a=this.prosemirrorView.state.tr.replace(0,this.prosemirrorView.state.doc.content.size,new Kt(new bt(n),0,0));this.prosemirrorView.dispatch(a.setMeta(fn,{isChangeOrigin:!0}))})}_renderSnapshot(n,a,c){n||(n=UG(this.doc)),this.mapping=new Map,this.mux(()=>{this.doc.transact(u=>{const A=c.permanentUserData;A&&A.dss.forEach(C=>{MN(u,C,b=>{})});const g=(C,b)=>{const N=C==="added"?A.getUserByClientId(b.client):A.getUserByDeletedId(b);return{user:N,type:C,color:Dz(c.colorMapping,c.colors,N)}},E=d2(this.type,new u2(a.ds,n.sv)).map(C=>!C._item.deleted||Ef(C._item,n)||Ef(C._item,a)?ef(C,this.prosemirrorView.state.schema,new Map,n,a,g):null).filter(C=>C!==null),I=this.prosemirrorView.state.tr.replace(0,this.prosemirrorView.state.doc.content.size,new Kt(new bt(E),0,0));this.prosemirrorView.dispatch(I.setMeta(fn,{isChangeOrigin:!0}))},fn)})}_typeChanged(n,a){const c=fn.getState(this.prosemirrorView.state);if(n.length===0||c.snapshot!=null||c.prevSnapshot!=null){this.renderSnapshot(c.snapshot,c.prevSnapshot);return}this.mux(()=>{const u=(E,I)=>this.mapping.delete(I);MN(a,a.deleteSet,E=>E.constructor===h2&&this.mapping.delete(E.content.type)),a.changed.forEach(u),a.changedParentTypes.forEach(u);const A=this.type.toArray().map(E=>RD(E,this.prosemirrorView.state.schema,this.mapping)).filter(E=>E!==null);let g=this.prosemirrorView.state.tr.replace(0,this.prosemirrorView.state.doc.content.size,new Kt(new bt(A),0,0));Pz(g,this.beforeTransactionSelection,this),g=g.setMeta(fn,{isChangeOrigin:!0}),this.beforeTransactionSelection!==null&&this._isLocalCursorInView()&&g.scrollIntoView(),this.prosemirrorView.dispatch(g)})}_prosemirrorChanged(n){this.mux(()=>{this.doc.transact(()=>{kI(this.doc,this.type,n,this.mapping),this.beforeTransactionSelection=NI(this,this.prosemirrorView.state)},fn)})}destroy(){this.type.unobserveDeep(this._observeFunction),this.doc.off("beforeAllTransactions",this.beforeAllTransactions),this.doc.off("afterAllTransactions",this.afterAllTransactions)}}const RD=(o,n,a,c,u,A)=>{const g=a.get(o);if(g===void 0){if(o instanceof ga)return ef(o,n,a,c,u,A);throw FG()}return g},ef=(o,n,a,c,u,A)=>{const g=[],E=I=>{if(I.constructor===ga){const C=RD(I,n,a,c,u,A);C!==null&&g.push(C)}else{const C=Mz(I,n,a,c,u,A);C!==null&&C.forEach(b=>{b!==null&&g.push(b)})}};c===void 0||u===void 0?o.toArray().forEach(E):d2(o,new u2(u.ds,c.sv)).forEach(E);try{const I=o.getAttributes(c);c!==void 0&&(Ef(o._item,c)?Ef(o._item,u)||(I.ychange=A?A("added",o._item.id):{type:"added"}):I.ychange=A?A("removed",o._item.id):{type:"removed"});const C=n.node(o.nodeName,I,g);return a.set(o,C),C}catch{return o.doc.transact(C=>{o._item.delete(C)},fn),a.delete(o),null}},Mz=(o,n,a,c,u,A)=>{const g=[],E=o.toDelta(c,u,A);try{for(let I=0;I<E.length;I++){const C=E[I],b=[];for(const N in C.attributes)b.push(n.mark(N,C.attributes[N]));g.push(n.text(C.insert,b))}}catch{return o.doc.transact(C=>{o._item.delete(C)},fn),null}return g},Uz=(o,n)=>{const a=new Ja,c=o.map(u=>({insert:u.text,attributes:wD(u.marks)}));return a.applyDelta(c),n.set(a,o),a},xz=(o,n)=>{const a=new ga(o.type.name);for(const c in o.attrs){const u=o.attrs[c];u!==null&&c!=="ychange"&&a.setAttribute(c,u)}return a.insert(0,Qf(o).map(c=>OI(c,n))),n.set(a,o),a},OI=(o,n)=>o instanceof Array?Uz(o,n):xz(o,n),XO=o=>typeof o=="object"&&o!==null,Sv=(o,n)=>{const a=Object.keys(o).filter(u=>o[u]!==null);let c=a.length===Object.keys(n).filter(u=>n[u]!==null).length;for(let u=0;u<a.length&&c;u++){const A=a[u],g=o[A],E=n[A];c=A==="ychange"||g===E||XO(g)&&XO(E)&&Sv(g,E)}return c},Qf=o=>{const n=o.content.content,a=[];for(let c=0;c<n.length;c++){const u=n[c];if(u.isText){const A=[];for(let g=n[c];c<n.length&&g.isText;g=n[++c])A.push(g);c--,a.push(A)}else a.push(u)}return a},yD=(o,n)=>{const a=o.toDelta();return a.length===n.length&&a.every((c,u)=>c.insert===n[u].text&&QG(c.attributes||{}).length===n[u].marks.length&&n[u].marks.every(A=>Sv(c.attributes[A.type.name]||{},A.attrs)))},mh=(o,n)=>{if(o instanceof ga&&!(n instanceof Array)&&DI(o,n)){const a=Qf(n);return o._length===a.length&&Sv(o.getAttributes(),n.attrs)&&o.toArray().every((c,u)=>mh(c,a[u]))}return o instanceof Ja&&n instanceof Array&&yD(o,n)},_f=(o,n)=>o===n||o instanceof Array&&n instanceof Array&&o.length===n.length&&o.every((a,c)=>n[c]===a),ZO=(o,n,a)=>{const c=o.toArray(),u=Qf(n),A=u.length,g=c.length,E=Ju(g,A);let I=0,C=0,b=!1;for(;I<E;I++){const N=c[I],L=u[I];if(_f(a.get(N),L))b=!0;else if(!mh(N,L))break}for(;I+C<E;C++){const N=c[g-C-1],L=u[A-C-1];if(_f(a.get(N),L))b=!0;else if(!mh(N,L))break}return{equalityFactor:I+C,foundMappedChild:b}},Fz=o=>{let n="",a=o._start;const c={};for(;a!==null;)a.deleted||(a.countable&&a.content instanceof HG?n+=a.content.str:a.content instanceof KG&&(c[a.content.key]=null)),a=a.right;return{str:n,nAttrs:c}},Qz=(o,n,a)=>{a.set(o,n);const{nAttrs:c,str:u}=Fz(o),A=n.map(C=>({insert:C.text,attributes:Object.assign({},c,wD(C.marks))})),{insert:g,remove:E,index:I}=Oz(u,A.map(C=>C.insert).join(""));o.delete(I,E),o.insert(I,g),o.applyDelta(A.map(C=>({retain:C.insert.length,attributes:C.attributes})))},wD=o=>{const n={};return o.forEach(a=>{a.type.name!=="ychange"&&(n[a.type.name]=a.attrs)}),n},kI=(o,n,a,c)=>{if(n instanceof ga&&n.nodeName!==a.type.name)throw new Error("node name mismatch!");if(c.set(n,a),n instanceof ga){const N=n.getAttributes(),L=a.attrs;for(const Q in L)L[Q]!==null?N[Q]!==L[Q]&&Q!=="ychange"&&n.setAttribute(Q,L[Q]):n.removeAttribute(Q);for(const Q in N)L[Q]===void 0&&n.removeAttribute(Q)}const u=Qf(a),A=u.length,g=n.toArray(),E=g.length,I=Ju(A,E);let C=0,b=0;for(;C<I;C++){const N=g[C],L=u[C];if(!_f(c.get(N),L))if(mh(N,L))c.set(N,L);else break}for(;b+C+1<I;b++){const N=g[E-b-1],L=u[A-b-1];if(!_f(c.get(N),L))if(mh(N,L))c.set(N,L);else break}o.transact(()=>{for(;E-C-b>0&&A-C-b>0;){const L=g[C],Q=u[C],G=g[E-b-1],Z=u[A-b-1];if(L instanceof Ja&&Q instanceof Array)yD(L,Q)||Qz(L,Q,c),C+=1;else{let dt=L instanceof ga&&DI(L,Q),lt=G instanceof ga&&DI(G,Z);if(dt&&lt){const et=ZO(L,Q,c),Dt=ZO(G,Z,c);et.foundMappedChild&&!Dt.foundMappedChild?lt=!1:!et.foundMappedChild&&Dt.foundMappedChild||et.equalityFactor<Dt.equalityFactor?dt=!1:lt=!1}dt?(kI(o,L,Q,c),C+=1):lt?(kI(o,G,Z,c),b+=1):(n.delete(C,1),n.insert(C,[OI(Q,c)]),C+=1)}}const N=E-C-b;if(N>0&&n.delete(C,N),C+b<A){const L=[];for(let Q=C;Q<A-b;Q++)L.push(OI(u[Q],c));n.insert(C,L)}},fn)},DI=(o,n)=>!(n instanceof Array)&&o.nodeName===n.type.name;let ih=null;const Vz=()=>{const o=ih;ih=null,o.forEach((n,a)=>{const c=a.state.tr;n.forEach((u,A)=>{c.setMeta(A,u)}),a.dispatch(c)})},Gz=(o,n,a)=>{ih||(ih=new Map,cj(0,Vz)),XG(ih,o,ZG).set(n,a)},If=(o,n,a)=>{if(o===0)return L_(n,0);let c=n._first===null?null:n._first.content.type;for(;c!==null&&n!==c;){if(c instanceof Ja){if(c._length>=o)return L_(c,o);if(o-=c._length,c._item!==null&&c._item.next!==null)c=c._item.next.content.type;else{do c=c._item===null?null:c._item.parent,o--;while(c!==n&&c!==null&&c._item!==null&&c._item.next===null);c!==null&&c!==n&&(c=c._item===null?null:c._item.next.content.type)}}else{const u=(a.get(c)||{nodeSize:0}).nodeSize;if(c._first!==null&&o<u)c=c._first.content.type,o--;else{if(o===1&&c._length===0&&u>1)return new aI(c._item===null?null:c._item.id,c._item===null?cI(c):null,null);if(o-=u,c._item!==null&&c._item.next!==null)c=c._item.next.content.type;else{if(o===0)return c=c._item===null?c:c._item.parent,new aI(c._item===null?null:c._item.id,c._item===null?cI(c):null,null);do c=c._item.parent,o--;while(c!==n&&c._item.next===null);c!==n&&(c=c._item.next.content.type)}}}if(c===null)throw YG();if(o===0&&c.constructor!==Ja&&c!==n)return jz(c._item.parent,c._item)}return L_(n,n._length)},jz=(o,n)=>{let a=null,c=null;return o._item===null?c=cI(o):a=qG(o._item.id.client,o._item.id.clock),new aI(a,c,n.id)},Eh=(o,n,a,c)=>{const u=JG(a,o);if(u===null||u.type!==n&&!zG(n,u.type._item))return null;let A=u.type,g=0;if(A.constructor===Ja)g=u.index;else if(A._item===null||!A._item.deleted){let E=A._first,I=0;for(;I<A._length&&I<u.index&&E!==null;){if(!E.deleted){const C=E.content.type;I++,C instanceof Ja?g+=C._length:g+=c.get(C).nodeSize}E=E.right}g+=1}for(;A!==n&&A._item!==null;){const E=A._item.parent;if(E._item===null||!E._item.deleted){g+=1;let I=E._first;for(;I!==null;){const C=I.content.type;if(C===A)break;I.deleted||(C instanceof Ja?g+=C._length:g+=c.get(C).nodeSize),I=I.right}}A=E}return g-1},Hz=o=>{const n=document.createElement("span");n.classList.add("ProseMirror-yjs-cursor"),n.setAttribute("style",`border-color: ${o.color}`);const a=document.createElement("div");return a.setAttribute("style",`background-color: ${o.color}`),a.insertBefore(document.createTextNode(o.name),null),n.insertBefore(a,null),n},Kz=/^#[0-9a-fA-F]{6}$/,$O=(o,n,a)=>{const c=fn.getState(o),u=c.doc,A=[];return c.snapshot!=null||c.prevSnapshot!=null||c.binding===null?Nr.create(o.doc,[]):(n.getStates().forEach((g,E)=>{if(E!==u.clientID&&g.cursor!=null){const I=g.user||{};I.color==null?I.color="#ffa500":Kz.test(I.color)||console.warn("A user uses an unsupported color format",I),I.name==null&&(I.name=`User: ${E}`);let C=Eh(u,c.type,zu(g.cursor.anchor),c.binding.mapping),b=Eh(u,c.type,zu(g.cursor.head),c.binding.mapping);if(C!==null&&b!==null){const N=UN(o.doc.content.size-1,0);C=Ju(C,N),b=Ju(b,N),A.push(On.widget(b,()=>a(I),{key:E+"",side:10}));const L=Ju(C,b),Q=UN(C,b);A.push(On.inline(L,Q,{style:`background-color: ${I.color}70`},{inclusiveEnd:!0,inclusiveStart:!1}))}}}),Nr.create(o.doc,A))},Wz=(o,{cursorBuilder:n=Hz,getSelection:a=u=>u.selection}={},c="cursor")=>new Fn({key:XA,state:{init(u,A){return $O(A,o,n)},apply(u,A,g,E){const I=fn.getState(E),C=u.getMeta(XA);return I&&I.isChangeOrigin||C&&C.awarenessUpdated?$O(E,o,n):A.map(u.mapping,u.doc)}},props:{decorations:u=>XA.getState(u)},view:u=>{const A=()=>{u.docView&&Gz(u,XA,{awarenessUpdated:!0})},g=()=>{const E=fn.getState(u.state),I=o.getLocalState()||{};if(u.hasFocus()&&E.binding!==null){const C=a(u.state),b=If(C.anchor,E.type,E.binding.mapping),N=If(C.head,E.type,E.binding.mapping);(I.cursor==null||!xN(zu(I.cursor.anchor),b)||!xN(zu(I.cursor.head),N))&&o.setLocalStateField(c,{anchor:b,head:N})}else I.cursor!=null&&Eh(E.doc,E.type,zu(I.cursor.anchor),E.binding.mapping)!==null&&o.setLocalStateField(c,null)};return o.on("change",A),u.dom.addEventListener("focusin",g),u.dom.addEventListener("focusout",g),{update:g,destroy:()=>{u.dom.removeEventListener("focusin",g),u.dom.removeEventListener("focusout",g),o.off("change",A),o.setLocalStateField(c,null)}}}}),Yz=o=>{const n=Kc.getState(o).undoManager;if(n!=null)return n.undo(),!0},qz=o=>{const n=Kc.getState(o).undoManager;if(n!=null)return n.redo(),!0},Jz=new Set(["paragraph"]),zz=(o,n)=>!(o instanceof h2)||!(o.content instanceof tj)||!(o.content.type instanceof ej||o.content.type instanceof ga&&n.has(o.content.type.nodeName))||o.content.type._length===0,Xz=({protectedNodes:o=Jz,trackedOrigins:n=[],undoManager:a=null}={})=>new Fn({key:Kc,state:{init:(c,u)=>{const A=fn.getState(u),g=a||new $G(A.type,{trackedOrigins:new Set([fn].concat(n)),deleteFilter:E=>zz(E,o)});return{undoManager:g,prevSel:null,hasUndoOps:g.undoStack.length>0,hasRedoOps:g.redoStack.length>0}},apply:(c,u,A,g)=>{const E=fn.getState(g).binding,I=u.undoManager,C=I.undoStack.length>0,b=I.redoStack.length>0;return E?{undoManager:I,prevSel:NI(E,A),hasUndoOps:C,hasRedoOps:b}:C!==u.hasUndoOps||b!==u.hasRedoOps?Object.assign({},u,{hasUndoOps:I.undoStack.length>0,hasRedoOps:I.redoStack.length>0}):u}},view:c=>{const u=fn.getState(c.state),A=Kc.getState(c.state).undoManager;return A.on("stack-item-added",({stackItem:g})=>{const E=u.binding;E&&g.meta.set(E,Kc.getState(c.state).prevSel)}),A.on("stack-item-popped",({stackItem:g})=>{const E=u.binding;E&&(E.beforeTransactionSelection=g.meta.get(E)||E.beforeTransactionSelection)}),{destroy:()=>{A.destroy()}}}}),Zz=Xn.create({name:"collaboration",priority:1e3,addOptions(){return{document:null,field:"default",fragment:null}},onCreate(){this.editor.extensionManager.extensions.find(o=>o.name==="history")&&console.warn('[tiptap warn]: "@tiptap/extension-collaboration" comes with its own history support and is not compatible with "@tiptap/extension-history".')},addCommands(){return{undo:()=>({tr:o,state:n,dispatch:a})=>(o.setMeta("preventDispatch",!0),Kc.getState(n).undoManager.undoStack.length===0?!1:a?Yz(n):!0),redo:()=>({tr:o,state:n,dispatch:a})=>(o.setMeta("preventDispatch",!0),Kc.getState(n).undoManager.redoStack.length===0?!1:a?qz(n):!0)}},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Mod-y":()=>this.editor.commands.redo(),"Shift-Mod-z":()=>this.editor.commands.redo()}},addProseMirrorPlugins(){const o=this.options.fragment?this.options.fragment:this.options.document.getXmlFragment(this.options.field);return[Lz(o),Xz()]}}),t2=o=>Array.from(o.entries()).map(([n,a])=>Nt({clientId:n},a.user)),e2=()=>null,$z=Xn.create({name:"collaborationCursor",addOptions(){return{provider:null,user:{name:null,color:null},render:o=>{const n=document.createElement("span");n.classList.add("collaboration-cursor__caret"),n.setAttribute("style",`border-color: ${o.color}`);const a=document.createElement("div");return a.classList.add("collaboration-cursor__label"),a.setAttribute("style",`background-color: ${o.color}`),a.insertBefore(document.createTextNode(o.name),null),n.insertBefore(a,null),n},onUpdate:e2}},onCreate(){this.options.onUpdate!==e2&&console.warn('[tiptap warn]: DEPRECATED: The "onUpdate" option is deprecated. Please use `editor.storage.collaborationCursor.users` instead. Read more: https://tiptap.dev/api/extensions/collaboration-cursor')},addStorage(){return{users:[]}},addCommands(){return{updateUser:o=>()=>(this.options.user=o,this.options.provider.awareness.setLocalStateField("user",this.options.user),!0),user:o=>({editor:n})=>(console.warn('[tiptap warn]: DEPRECATED: The "user" command is deprecated. Please use "updateUser" instead. Read more: https://tiptap.dev/api/extensions/collaboration-cursor'),n.commands.updateUser(o))}},addProseMirrorPlugins(){return[Wz((()=>(this.options.provider.awareness.setLocalStateField("user",this.options.user),this.storage.users=t2(this.options.provider.awareness.states),this.options.provider.awareness.on("update",()=>{this.storage.users=t2(this.options.provider.awareness.states)}),this.options.provider.awareness))(),{cursorBuilder:this.options.render})]}}),tX=Ci.create({name:"taskList",addOptions(){return{itemTypeName:"taskItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:o}){return["ul",$n(this.options.HTMLAttributes,o,{"data-type":this.name}),0]},addCommands(){return{toggleTaskList:()=>({commands:o})=>o.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}}),eX=/^\s*(\[([ |x])\])\s$/,rX=Ci.create({name:"taskItem",addOptions(){return{nested:!1,HTMLAttributes:{}}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:o=>o.getAttribute("data-checked")==="true",renderHTML:o=>({"data-checked":o.checked})}}},parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:o,HTMLAttributes:n}){return["li",$n(this.options.HTMLAttributes,n,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:o.attrs.checked?"checked":null}],["span"]],["div",0]]},addKeyboardShortcuts(){const o={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?zn(Nt({},o),{Tab:()=>this.editor.commands.sinkListItem(this.name)}):o},addNodeView(){return({node:o,HTMLAttributes:n,getPos:a,editor:c})=>{const u=document.createElement("li"),A=document.createElement("label"),g=document.createElement("span"),E=document.createElement("input"),I=document.createElement("div");return A.contentEditable="false",E.type="checkbox",E.addEventListener("change",C=>{if(!c.isEditable){E.checked=!E.checked;return}const{checked:b}=C.target;c.isEditable&&typeof a=="function"&&c.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:N})=>{const L=a(),Q=N.doc.nodeAt(L);return N.setNodeMarkup(L,void 0,zn(Nt({},Q==null?void 0:Q.attrs),{checked:b})),!0}).run()}),Object.entries(this.options.HTMLAttributes).forEach(([C,b])=>{u.setAttribute(C,b)}),u.dataset.checked=o.attrs.checked,o.attrs.checked&&E.setAttribute("checked","checked"),A.append(E,g),u.append(A,I),Object.entries(n).forEach(([C,b])=>{u.setAttribute(C,b)}),{dom:u,contentDOM:I,update:C=>C.type!==this.type?!1:(u.dataset.checked=C.attrs.checked,C.attrs.checked?E.setAttribute("checked","checked"):E.removeAttribute("checked"),!0)}}},addInputRules(){return[Uf({find:eX,type:this.type,getAttributes:o=>({checked:o[o.length-1]==="x"})})]}}),nX=/(?:^|\s)((?:==)((?:[^~=]+))(?:==))$/,iX=/(?:^|\s)((?:==)((?:[^~=]+))(?:==))/g,oX=tc.create({name:"highlight",addOptions(){return{multicolor:!1,HTMLAttributes:{}}},addAttributes(){return this.options.multicolor?{color:{default:null,parseHTML:o=>o.getAttribute("data-color")||o.style.backgroundColor,renderHTML:o=>o.color?{"data-color":o.color,style:`background-color: ${o.color}`}:{}}}:{}},parseHTML(){return[{tag:"mark"}]},renderHTML({HTMLAttributes:o}){return["mark",$n(this.options.HTMLAttributes,o),0]},addCommands(){return{setHighlight:o=>({commands:n})=>n.setMark(this.name,o),toggleHighlight:o=>({commands:n})=>n.toggleMark(this.name,o),unsetHighlight:()=>({commands:o})=>o.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-h":()=>this.editor.commands.toggleHighlight()}},addInputRules(){return[qc({find:nX,type:this.type})]},addPasteRules(){return[Jc({find:iX,type:this.type})]}}),sX=Xn.create({name:"characterCount",addOptions(){return{limit:null,mode:"textSize"}},addStorage(){return{characters:()=>0,words:()=>0}},onBeforeCreate(){this.storage.characters=o=>{const n=(o==null?void 0:o.node)||this.editor.state.doc;return((o==null?void 0:o.mode)||this.options.mode)==="textSize"?n.textBetween(0,n.content.size,void 0," ").length:n.nodeSize},this.storage.words=o=>{const n=(o==null?void 0:o.node)||this.editor.state.doc;return n.textBetween(0,n.content.size," "," ").split(" ").filter(u=>u!=="").length}},addProseMirrorPlugins(){return[new Fn({key:new Ti("characterCount"),filterTransaction:(o,n)=>{const a=this.options.limit;if(!o.docChanged||a===0||a===null||a===void 0)return!0;const c=this.storage.characters({node:n.doc}),u=this.storage.characters({node:o.doc});if(u<=a||c>a&&u>a&&u<=c)return!0;if(c>a&&u>a&&u>c||!o.getMeta("paste"))return!1;const g=o.selection.$head.pos,E=u-a,I=g-E,C=g;return o.deleteRange(I,C),!(this.storage.characters({node:o.doc})>a)}})]}});const aX={props:{icon:{type:String,required:!0},title:{type:String,required:!0},action:{type:Function,required:!0},isActive:{type:Function,default:null}},components:{SvgIcon:Vc}},cX=["title"];function lX(o,n,a,c,u,A){const g=oh("SvgIcon");return vn(),ki("button",{class:ad(["menu-item",{"is-active":a.isActive?a.isActive():null}]),onClick:n[0]||(n[0]=(...E)=>a.action&&a.action(...E)),title:a.title},[Oi(g,{name:"tiptap-"+a.icon},null,8,["name"])],10,cX)}var dX=Ih(aX,[["render",lX],["__scopeId","data-v-d2d2a634"]]);const uX={components:{MenuItem:dX},props:{editor:{type:Object,required:!0}},data(){return{items:[{icon:"bold",title:"Bold",action:()=>this.editor.chain().focus().toggleBold().run(),isActive:()=>this.editor.isActive("bold")},{icon:"italic",title:"Italic",action:()=>this.editor.chain().focus().toggleItalic().run(),isActive:()=>this.editor.isActive("italic")},{icon:"strikethrough",title:"Strike",action:()=>this.editor.chain().focus().toggleStrike().run(),isActive:()=>this.editor.isActive("strike")},{icon:"code-view",title:"Code",action:()=>this.editor.chain().focus().toggleCode().run(),isActive:()=>this.editor.isActive("code")},{icon:"mark-pen-line",title:"Highlight",action:()=>this.editor.chain().focus().toggleHighlight().run(),isActive:()=>this.editor.isActive("highlight")},{type:"divider"},{icon:"h-1",title:"Heading 1",action:()=>this.editor.chain().focus().toggleHeading({level:1}).run(),isActive:()=>this.editor.isActive("heading",{level:1})},{icon:"h-2",title:"Heading 2",action:()=>this.editor.chain().focus().toggleHeading({level:2}).run(),isActive:()=>this.editor.isActive("heading",{level:2})},{icon:"paragraph",title:"Paragraph",action:()=>this.editor.chain().focus().setParagraph().run(),isActive:()=>this.editor.isActive("paragraph")},{icon:"list-unordered",title:"Bullet List",action:()=>this.editor.chain().focus().toggleBulletList().run(),isActive:()=>this.editor.isActive("bulletList")},{icon:"list-ordered",title:"Ordered List",action:()=>this.editor.chain().focus().toggleOrderedList().run(),isActive:()=>this.editor.isActive("orderedList")},{icon:"list-check-2",title:"Task List",action:()=>this.editor.chain().focus().toggleTaskList().run(),isActive:()=>this.editor.isActive("taskList")},{icon:"code-box-line",title:"Code Block",action:()=>this.editor.chain().focus().toggleCodeBlock().run(),isActive:()=>this.editor.isActive("codeBlock")},{type:"divider"},{icon:"double-quotes-l",title:"Blockquote",action:()=>this.editor.chain().focus().toggleBlockquote().run(),isActive:()=>this.editor.isActive("blockquote")},{icon:"separator",title:"Horizontal Rule",action:()=>this.editor.chain().focus().setHorizontalRule().run()},{type:"divider"},{icon:"text-wrap",title:"Hard Break",action:()=>this.editor.chain().focus().setHardBreak().run()},{icon:"format-clear",title:"Clear Format",action:()=>this.editor.chain().focus().clearNodes().unsetAllMarks().run()},{type:"divider"},{icon:"arrow-go-back-line",title:"Undo",action:()=>this.editor.chain().focus().undo().run()},{icon:"arrow-go-forward-line",title:"Redo",action:()=>this.editor.chain().focus().redo().run()}]}}};function hX(o,n,a,c,u,A){const g=oh("menu-item");return vn(),ki("div",null,[(vn(!0),ki(Ea,null,BI(u.items,(E,I)=>(vn(),ki(Ea,null,[E.type==="divider"?(vn(),ki("div",{class:"divider",key:`divider${I}`})):(vn(),ud(g,SG({key:1,key:I},E),null,16))],64))),256))])}var pX=Ih(uX,[["render",hX],["__scopeId","data-v-1ebce63e"]]);const r2=MI(),n2=o=>o[Math.floor(Math.random()*o.length)],AX={components:{EditorContent:kJ,MenuBar:pX},data(){return{currentUser:JSON.parse(localStorage.getItem("currentUser"))||{name:this.getRandomName(),color:this.getRandomColor()},provider:null,editor:null,users:[],status:"connecting"}},mounted(){const o=new rj;this.provider=new nj("wss://ws1.hookin.fun","f452c7864b7a575cf23e0850cf0c9291",o),this.provider.on("status",n=>{this.status=n.status}),this.editor=new OJ({extensions:[bz.configure({history:!1}),oX,tX,rX,Zz.configure({document:o}),$z.configure({provider:this.provider,user:this.currentUser}),sX.configure({limit:1e4})]})},methods:{setName(){const o=(window.prompt("Name")||"").trim().substring(0,32);if(o)return this.updateCurrentUser({name:o})},updateCurrentUser(o){this.currentUser=Nt(Nt({},this.currentUser),o),this.editor.chain().focus().user(this.currentUser).run(),localStorage.setItem("currentUser",JSON.stringify(this.currentUser))},getRandomColor(){return n2(["#958DF1","#F98181","#FBBC88","#FAF594","#70CFF8","#94FADB","#B9F18D"])},getRandomName(){return r2.uid==0?n2(["\u6BB5\u8A89","\u6728\u5A49\u6E05","\u865A\u7AF9","\u674E\u6E05\u9732","\u6653\u857E","\u6BB5\u6B63\u660E","\u9EC4\u7709\u50E7","\u65E0\u5D16\u5B50","\u7384\u9EC4\u5B50","\u5353\u4E0D\u51E1","\u53F8\u9A6C\u6797","\u674E\u767D","\u9646\u6E38","\u674E\u6E05\u7167","\u675C\u752B","\u767D\u5C45\u6613","\u675C\u7267","\u82CF\u8F7C","\u738B\u5B89\u77F3","\u6768\u4E07\u91CC","\u5B5F\u6D69\u7136","\u8F9B\u5F03\u75BE","\u8303\u4EF2\u6DF9","\u738B\u7EF4","\u6B27\u9633\u4FEE"]):r2.name}},beforeUnmount(){this.editor.destroy(),this.provider.destroy()}},fX={key:0,class:"editor"},gX={class:"editor__footer"},mX=s2(" \u8FDE\u63A5\u4E2D\u2026\u2026 "),EX={class:"editor__name"};function _X(o,n,a,c,u,A){const g=oh("menu-bar"),E=oh("editor-content");return u.editor?(vn(),ki("div",fX,[Oi(g,{class:"editor__header",editor:u.editor},null,8,["editor"]),Oi(E,{class:"editor__content",editor:u.editor},null,8,["editor"]),br("div",gX,[br("div",{class:ad(`editor__status editor__status--${u.status}`)},[u.status==="connected"?(vn(),ki(Ea,{key:0},[s2(qu(u.editor.storage.collaborationCursor.users.length)+" user"+qu(u.editor.storage.collaborationCursor.users.length===1?"":"s"),1)],64)):(vn(),ki(Ea,{key:1},[mX],64))],2),br("div",EX,[br("button",{onClick:n[0]||(n[0]=(...I)=>A.setName&&A.setName(...I))},qu(u.currentUser.name),1)])])])):sI("",!0)}var IX=Ih(AX,[["render",_X],["__scopeId","data-v-f9ecf2a6"]]);const vX={setup(o){const n=Yu([{name:"\u97F3\u9891",value:0},{name:"\u89C6\u9891",value:1}]),a=Wc(0),c=u=>{a.value=u};return(u,A)=>(vn(),ud(ds(yG),{onChange:c},{default:cd(()=>[Oi(ds(RG),{class:"flex p-1 space-x-1 bg-indigo-500 rounded-lg dark border dark:border-gray-600 transition"},{default:cd(()=>[(vn(!0),ki(Ea,null,BI(ds(n),g=>(vn(),ud(ds(TG),{as:"template",key:g.value},{default:cd(({selected:E})=>[br("button",{class:ad(["w-full py-1 text-sm leading-5 font-mediumtext-white text-white font-bold rounded-md","focus:outline-none focus:ring-2 ring-offset-2 ring-offset-indigo-300",E?"bg-white shadow text-indigo-700":"hover:bg-white/[0.12]"])},qu(g.name),3)]),_:2},1024))),128))]),_:1})]),_:1}))}};const oc=o=>(a2("data-v-294d886e"),o=o(),c2(),o),CX={as:"nav",class:"bg-gray-800 rounded-b-md fixed top-0 w-full z-10"},SX={class:"max-w-7xl mx-auto px-2 sm:px-6 lg:px-8"},TX={class:"relative flex items-center justify-between h-16"},RX={class:"flex-1 flex items-center justify-center sm:justify-start"},yX={class:"absolute inset-y-0 inset-x-0 right-0 flex items-center px-2 sm:static sm:inset-auto sm:pr-0"},wX={class:"video-btn mr-4"},bX=oc(()=>br("span",{class:"sr-only"},"Open live",-1)),NX={class:"w-80"},OX=oc(()=>br("div",null,"\u656C\u8BF7\u671F\u5F85~",-1)),kX=oc(()=>br("hr",{class:"my-4"},null,-1)),DX={class:"flex items-center"},LX=oc(()=>br("div",{class:"w-24 text-right"},"\u5206\u4EAB\u6A21\u5F0F\uFF1A",-1)),PX={class:"w-40"},BX=oc(()=>br("button",{class:"close-btn"},"\u5173\u95ED",-1)),MX=oc(()=>br("div",{class:"flex-grow"},null,-1)),UX=oc(()=>br("span",{class:"sr-only"},"Copy Share Link",-1)),xX=oc(()=>br("div",{class:"leave-btn"},"\u79BB\u5F00",-1)),FX={setup(o){const n=window.location.href,a=()=>{navigator.clipboard.writeText(n)};return(c,u)=>{const A=oh("Popover");return vn(),ki("nav",CX,[br("div",SX,[br("div",TX,[br("div",RX,[Oi(Vc,{name:"logo",class:"h-8 w-8"})]),br("div",yX,[Oi(A,null,{content:cd(()=>[br("div",NX,[OX,kX,br("div",DX,[LX,br("div",PX,[Oi(vX)]),BX])])]),default:cd(()=>[br("button",wX,[bX,Oi(Vc,{name:"toolbar-live",class:"h-6 w-6"})])]),_:1}),MX,br("button",{title:"\u70B9\u51FB\u5206\u4EAB\u6B64\u623F\u95F4 share",class:"text-gray-300 hover:text-white cursor-pointer mr-4",onClick:a},[UX,Oi(Vc,{name:"toolbar-share",class:"inline-block h-5 w-5"})]),xX])])])])}}};var QX=Ih(FX,[["__scopeId","data-v-294d886e"]]);const VX=o=>(a2("data-v-16c6c8e9"),o=o(),c2(),o),GX={class:"z-10 absolute flex left-0 right-0 group-hover:bg-gray-800 text-white p-1 transition"},jX={class:"sm-btn w-5 bg-indigo-600 text-center overflow-hidden",title:"\u540D\u79F0"},HX=["title"],KX=["title"],WX=VX(()=>br("div",{class:"flex-1"},null,-1)),YX=["id","onClick"],qX={directives:{drag:{mounted(o){const n=window.getComputedStyle(o,null);o.onmousedown=a=>{const c=a.clientX,u=a.clientY,A=+n.right.replace(/\px/g,""),g=+n.bottom.replace(/\px/g,""),E=+n.width.replace(/\px/g,""),I=+n.height.replace(/\px/g,""),C=window.innerWidth,b=window.innerHeight;document.onmousemove=function(N){const L=N.clientX-c,Q=N.clientY-u,G=A-L,Z=g-Q;G<0||Z<0||G>C-E||Z>b-I||(o.style.right=G+"px",o.style.bottom=Z+"px")},document.onmouseup=function(N){document.onmousemove=null,document.onmouseup=null}}}}}},JX=Object.assign(qX,{props:{name:{type:String,default:"\u6211"},liveUser:{type:Object},className:{type:String,default:"h-[8rem] bottom-2"}},emits:["close","video","audio"],setup(o,{emit:n}){const a=o,c=Wc(null);wG(window,"resize",()=>{const A=window.getComputedStyle(c.value,null),g=+A.left.replace(/\px/g,""),E=+A.top.replace(/\px/g,"");(g<0||E<0)&&(c.value.style.right="8px",c.value.style.bottom="8px")});const u=()=>{};return l2(()=>{}),(A,g)=>{const E=bG("drag");return NG((vn(),ki("div",{ref_key:"target",ref:c,class:ad(["fixed cursor-move min-w-[10rem] min-h-[2.5rem] right-2 select-none z-10 bg-gray-100 rounded overflow-hidden border-4 border-indigo-300 shadow-md hover:shadow-lg transition group",o.className]),style:kG(o.liveUser.hasOpenVideo?"":"height:0;")},[br("div",GX,[br("div",jX,qu(a.name[0]),1),br("button",{class:ad(["sm-btn",o.liveUser.hasOpenVideo?"":"active"]),title:o.liveUser.hasOpenVideo?"\u505C\u6B62\u5F55\u50CF":"\u5F00\u59CB\u5F55\u50CF",onClick:g[0]||(g[0]=I=>A.$emit("video",o.name))},[Oi(Vc,{name:"live-camera-off",class:"w-5 h-5"})],10,HX),br("button",{class:ad(["sm-btn",o.liveUser.hasOpenAudio?"":"active"]),title:o.liveUser.hasOpenAudio?"\u505C\u6B62\u5F55\u97F3":"\u5F00\u59CB\u5F55\u97F3",onClick:g[1]||(g[1]=I=>A.$emit("audio",o.name))},[Oi(Vc,{name:"live-mic-off",class:"w-5 h-5"})],10,KX),WX,br("button",{class:"close-btn",onClick:g[2]||(g[2]=I=>A.$emit("close",o.name)),title:"\u5173\u95ED"},[Oi(Vc,{name:"close",class:"h-5 w-5"})])]),br("div",{class:"player",id:"player-"+o.liveUser.uid,onClick:OG(u,["stop"])},null,8,YX)],6)),[[E]])}}});var i2=Ih(JX,[["__scopeId","data-v-16c6c8e9"]]),bD={exports:{}};(function(o,n){(function(a,c){o.exports=c()})(D_,function(){var a=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof D_!="undefined"?D_:typeof self!="undefined"?self:{};function c(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var u=function(e){try{return!!e()}catch{return!0}},A=!u(function(){var e=function(){}.bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),g=A,E=Function.prototype,I=E.bind,C=E.call,b=g&&I.bind(C,C),N=g?function(e){return e&&b(e)}:function(e){return e&&function(){return C.apply(e,arguments)}},L=N({}.isPrototypeOf),Q=function(e){return e&&e.Math==Math&&e},G=Q(typeof globalThis=="object"&&globalThis)||Q(typeof window=="object"&&window)||Q(typeof self=="object"&&self)||Q(typeof a=="object"&&a)||function(){return this}()||Function("return this")(),Z=A,dt=Function.prototype,lt=dt.apply,et=dt.call,Dt=typeof Reflect=="object"&&Reflect.apply||(Z?et.bind(lt):function(){return et.apply(lt,arguments)}),J=function(e){return typeof e=="function"},Ft={},Ot=!u(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),ce=A,ge=Function.prototype.call,he=ce?ge.bind(ge):function(){return ge.apply(ge,arguments)},Te={},Sr={}.propertyIsEnumerable,lr=Object.getOwnPropertyDescriptor,_r=lr&&!Sr.call({1:2},1);Te.f=_r?function(e){var t=lr(this,e);return!!t&&t.enumerable}:Sr;var Zr,gr,Re=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},ln=N,Dn=ln({}.toString),To=ln("".slice),Qn=function(e){return To(Dn(e),8,-1)},Gs=N,Ro=u,js=Qn,ro=G.Object,no=Gs("".split),Bi=Ro(function(){return!ro("z").propertyIsEnumerable(0)})?function(e){return js(e)=="String"?no(e,""):ro(e)}:ro,Ra=G.TypeError,Ln=function(e){if(e==null)throw Ra("Can't call method on "+e);return e},ya=Bi,ms=Ln,Vn=function(e){return ya(ms(e))},$c=J,Vr=function(e){return typeof e=="object"?e!==null:$c(e)},Ir={},wa=Ir,Hs=G,sc=J,ac=function(e){return sc(e)?e:void 0},ti=function(e,t){return arguments.length<2?ac(wa[e])||ac(Hs[e]):wa[e]&&wa[e][t]||Hs[e]&&Hs[e][t]},Pn=ti("navigator","userAgent")||"",Jo=G,Ks=Pn,Es=Jo.process,ba=Jo.Deno,cc=Es&&Es.versions||ba&&ba.version,lc=cc&&cc.v8;lc&&(gr=(Zr=lc.split("."))[0]>0&&Zr[0]<4?1:+(Zr[0]+Zr[1])),!gr&&Ks&&(!(Zr=Ks.match(/Edge\/(\d+)/))||Zr[1]>=74)&&(Zr=Ks.match(/Chrome\/(\d+)/))&&(gr=+Zr[1]);var zo=gr,dc=zo,Vf=u,yd=!!Object.getOwnPropertySymbols&&!Vf(function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&dc&&dc<41}),wh=yd&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Gf=ti,jf=J,Tt=L,re=wh,_e=G.Object,dr=re?function(e){return typeof e=="symbol"}:function(e){var t=Gf("Symbol");return jf(t)&&Tt(t.prototype,_e(e))},or=G.String,Sn=function(e){try{return or(e)}catch{return"Object"}},Mi=J,Na=Sn,bh=G.TypeError,Gn=function(e){if(Mi(e))return e;throw bh(Na(e)+" is not a function")},wd=Gn,Oa=function(e,t){var r=e[t];return r==null?void 0:wd(r)},_s=he,bd=J,uc=Vr,tl=G.TypeError,Nh={exports:{}},Tv=G,ND=Object.defineProperty,OD=function(e,t){try{ND(Tv,e,{value:t,configurable:!0,writable:!0})}catch{Tv[e]=t}return t},Rv="__core-js_shared__",Hf=G[Rv]||OD(Rv,{}),yv=Hf;(Nh.exports=function(e,t){return yv[e]||(yv[e]=t!==void 0?t:{})})("versions",[]).push({version:"3.20.3",mode:"pure",copyright:"\xA9 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.20.3/LICENSE",source:"https://github.com/zloirock/core-js"});var kD=Ln,DD=G.Object,io=function(e){return DD(kD(e))},LD=io,PD=N({}.hasOwnProperty),gn=Object.hasOwn||function(e,t){return PD(LD(e),t)},BD=N,MD=0,UD=Math.random(),xD=BD(1 .toString),Oh=function(e){return"Symbol("+(e===void 0?"":e)+")_"+xD(++MD+UD,36)},FD=G,QD=Nh.exports,wv=gn,VD=Oh,bv=yd,Nv=wh,Nd=QD("wks"),hc=FD.Symbol,Ov=hc&&hc.for,GD=Nv?hc:hc&&hc.withoutSetter||VD,en=function(e){if(!wv(Nd,e)||!bv&&typeof Nd[e]!="string"){var t="Symbol."+e;bv&&wv(hc,e)?Nd[e]=hc[e]:Nd[e]=Nv&&Ov?Ov(t):GD(t)}return Nd[e]},jD=he,kv=Vr,Dv=dr,HD=Oa,KD=function(e,t){var r,i;if(t==="string"&&bd(r=e.toString)&&!uc(i=_s(r,e))||bd(r=e.valueOf)&&!uc(i=_s(r,e))||t!=="string"&&bd(r=e.toString)&&!uc(i=_s(r,e)))return i;throw tl("Can't convert object to primitive value")},WD=en,YD=G.TypeError,qD=WD("toPrimitive"),JD=function(e,t){if(!kv(e)||Dv(e))return e;var r,i=HD(e,qD);if(i){if(t===void 0&&(t="default"),r=jD(i,e,t),!kv(r)||Dv(r))return r;throw YD("Can't convert object to primitive value")}return t===void 0&&(t="number"),KD(e,t)},zD=dr,kh=function(e){var t=JD(e,"string");return zD(t)?t:t+""},Lv=Vr,Kf=G.document,XD=Lv(Kf)&&Lv(Kf.createElement),Wf=function(e){return XD?Kf.createElement(e):{}},ZD=Wf,Pv=!Ot&&!u(function(){return Object.defineProperty(ZD("div"),"a",{get:function(){return 7}}).a!=7}),$D=Ot,tL=he,eL=Te,rL=Re,nL=Vn,iL=kh,oL=gn,sL=Pv,Bv=Object.getOwnPropertyDescriptor;Ft.f=$D?Bv:function(e,t){if(e=nL(e),t=iL(t),sL)try{return Bv(e,t)}catch{}if(oL(e,t))return rL(!tL(eL.f,e,t),e[t])};var aL=u,cL=J,lL=/#|\.prototype\./,Od=function(e,t){var r=uL[dL(e)];return r==pL||r!=hL&&(cL(t)?aL(t):!!t)},dL=Od.normalize=function(e){return String(e).replace(lL,".").toLowerCase()},uL=Od.data={},hL=Od.NATIVE="N",pL=Od.POLYFILL="P",Mv=Od,AL=Gn,fL=A,gL=N(N.bind),Ws=function(e,t){return AL(e),t===void 0?e:fL?gL(e,t):function(){return e.apply(t,arguments)}},Ui={},Uv=Ot&&u(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),xv=G,mL=Vr,EL=xv.String,_L=xv.TypeError,xi=function(e){if(mL(e))return e;throw _L(EL(e)+" is not an object")},IL=Ot,vL=Pv,CL=Uv,Dh=xi,Fv=kh,SL=G.TypeError,Yf=Object.defineProperty,TL=Object.getOwnPropertyDescriptor,RL="enumerable",yL="configurable",wL="writable";Ui.f=IL?CL?function(e,t,r){if(Dh(e),t=Fv(t),Dh(r),typeof e=="function"&&t==="prototype"&&"value"in r&&wL in r&&!r.writable){var i=TL(e,t);i&&i.writable&&(e[t]=r.value,r={configurable:yL in r?r.configurable:i.configurable,enumerable:RL in r?r.enumerable:i.enumerable,writable:!1})}return Yf(e,t,r)}:Yf:function(e,t,r){if(Dh(e),t=Fv(t),Dh(r),vL)try{return Yf(e,t,r)}catch{}if("get"in r||"set"in r)throw SL("Accessors not supported");return"value"in r&&(e[t]=r.value),e};var bL=Ui,NL=Re,ka=Ot?function(e,t,r){return bL.f(e,t,NL(1,r))}:function(e,t,r){return e[t]=r,e},Lh=G,OL=Dt,kL=N,DL=J,LL=Ft.f,PL=Mv,el=Ir,BL=Ws,rl=ka,Qv=gn,ML=function(e){var t=function(r,i,s){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(r);case 2:return new e(r,i)}return new e(r,i,s)}return OL(e,this,arguments)};return t.prototype=e.prototype,t},Ae=function(e,t){var r,i,s,l,d,h,p,m,f=e.target,_=e.global,v=e.stat,T=e.proto,R=_?Lh:v?Lh[f]:(Lh[f]||{}).prototype,w=_?el:el[f]||rl(el,f,{})[f],O=w.prototype;for(s in t)r=!PL(_?s:f+(v?".":"#")+s,e.forced)&&R&&Qv(R,s),d=w[s],r&&(h=e.noTargetGet?(m=LL(R,s))&&m.value:R[s]),l=r&&h?h:t[s],r&&typeof d==typeof l||(p=e.bind&&r?BL(l,Lh):e.wrap&&r?ML(l):T&&DL(l)?kL(l):l,(e.sham||l&&l.sham||d&&d.sham)&&rl(p,"sham",!0),rl(w,s,p),T&&(Qv(el,i=f+"Prototype")||rl(el,i,{}),rl(el[i],s,l),e.real&&O&&!O[s]&&rl(O,s,l)))},UL=Qn,kd=Array.isArray||function(e){return UL(e)=="Array"},xL=Math.ceil,FL=Math.floor,nl=function(e){var t=+e;return t!=t||t===0?0:(t>0?FL:xL)(t)},QL=nl,VL=Math.min,Ph=function(e){return e>0?VL(QL(e),9007199254740991):0},GL=Ph,yo=function(e){return GL(e.length)},jL=kh,HL=Ui,KL=Re,il=function(e,t,r){var i=jL(t);i in e?HL.f(e,i,KL(0,r)):e[i]=r},Vv={};Vv[en("toStringTag")]="z";var qf=String(Vv)==="[object z]",WL=G,YL=qf,qL=J,Bh=Qn,JL=en("toStringTag"),zL=WL.Object,XL=Bh(function(){return arguments}())=="Arguments",Is=YL?Bh:function(e){var t,r,i;return e===void 0?"Undefined":e===null?"Null":typeof(r=function(s,l){try{return s[l]}catch{}}(t=zL(e),JL))=="string"?r:XL?Bh(t):(i=Bh(t))=="Object"&&qL(t.callee)?"Arguments":i},ZL=J,Jf=Hf,$L=N(Function.toString);ZL(Jf.inspectSource)||(Jf.inspectSource=function(e){return $L(e)});var zf=Jf.inspectSource,tP=N,eP=u,Gv=J,rP=Is,nP=zf,jv=function(){},iP=[],Hv=ti("Reflect","construct"),Xf=/^\s*(?:class|function)\b/,oP=tP(Xf.exec),sP=!Xf.exec(jv),Dd=function(e){if(!Gv(e))return!1;try{return Hv(jv,iP,e),!0}catch{return!1}},Kv=function(e){if(!Gv(e))return!1;switch(rP(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return sP||!!oP(Xf,nP(e))}catch{return!0}};Kv.sham=!0;var Mh=!Hv||eP(function(){var e;return Dd(Dd.call)||!Dd(Object)||!Dd(function(){e=!0})||e})?Kv:Dd,aP=G,Wv=kd,cP=Mh,lP=Vr,dP=en("species"),Yv=aP.Array,uP=function(e){var t;return Wv(e)&&(t=e.constructor,(cP(t)&&(t===Yv||Wv(t.prototype))||lP(t)&&(t=t[dP])===null)&&(t=void 0)),t===void 0?Yv:t},Zf=function(e,t){return new(uP(e))(t===0?0:t)},hP=u,pP=zo,AP=en("species"),Ld=function(e){return pP>=51||!hP(function(){var t=[];return(t.constructor={})[AP]=function(){return{foo:1}},t[e](Boolean).foo!==1})},fP=Ae,gP=G,mP=u,EP=kd,_P=Vr,IP=io,vP=yo,qv=il,CP=Zf,SP=Ld,TP=zo,Jv=en("isConcatSpreadable"),zv=9007199254740991,Xv="Maximum allowed index exceeded",Zv=gP.TypeError,RP=TP>=51||!mP(function(){var e=[];return e[Jv]=!1,e.concat()[0]!==e}),yP=SP("concat"),wP=function(e){if(!_P(e))return!1;var t=e[Jv];return t!==void 0?!!t:EP(e)};fP({target:"Array",proto:!0,forced:!RP||!yP},{concat:function(e){var t,r,i,s,l,d=IP(this),h=CP(d,0),p=0;for(t=-1,i=arguments.length;t<i;t++)if(wP(l=t===-1?d:arguments[t])){if(p+(s=vP(l))>zv)throw Zv(Xv);for(r=0;r<s;r++,p++)r in l&&qv(h,p,l[r])}else{if(p>=zv)throw Zv(Xv);qv(h,p++,l)}return h.length=p,h}});var bP=Ir,$r=function(e){return bP[e+"Prototype"]},NP=$r("Array").concat,OP=L,kP=NP,$f=Array.prototype,k=function(e){var t=e.concat;return e===$f||OP($f,e)&&t===$f.concat?kP:t},DP=Ae,LP=ti,PP=Dt,Pd=N,BP=u,MP=G.Array,Uh=LP("JSON","stringify"),xh=Pd(/./.exec),$v=Pd("".charAt),UP=Pd("".charCodeAt),xP=Pd("".replace),FP=Pd(1 .toString),QP=/[\uD800-\uDFFF]/g,tC=/^[\uD800-\uDBFF]$/,eC=/^[\uDC00-\uDFFF]$/,VP=function(e,t,r){var i=$v(r,t-1),s=$v(r,t+1);return xh(tC,e)&&!xh(eC,s)||xh(eC,e)&&!xh(tC,i)?"\\u"+FP(UP(e,0),16):e},GP=BP(function(){return Uh("\uDF06\uD834")!=='"\\udf06\\ud834"'||Uh("\uDEAD")!=='"\\udead"'});Uh&&DP({target:"JSON",stat:!0,forced:GP},{stringify:function(e,t,r){for(var i=0,s=arguments.length,l=MP(s);i<s;i++)l[i]=arguments[i];var d=PP(Uh,null,l);return typeof d=="string"?xP(d,QP,VP):d}});var tg=Ir,jP=Dt;tg.JSON||(tg.JSON={stringify:JSON.stringify});var St=function(e,t,r){return jP(tg.JSON.stringify,null,arguments)},rC={exports:{}},Bd={},HP=nl,KP=Math.max,WP=Math.min,Md=function(e,t){var r=HP(e);return r<0?KP(r+t,0):WP(r,t)},YP=Vn,qP=Md,JP=yo,nC=function(e){return function(t,r,i){var s,l=YP(t),d=JP(l),h=qP(i,d);if(e&&r!=r){for(;d>h;)if((s=l[h++])!=s)return!0}else for(;d>h;h++)if((e||h in l)&&l[h]===r)return e||h||0;return!e&&-1}},eg={includes:nC(!0),indexOf:nC(!1)},Ud={},rg=gn,zP=Vn,XP=eg.indexOf,ZP=Ud,iC=N([].push),oC=function(e,t){var r,i=zP(e),s=0,l=[];for(r in i)!rg(ZP,r)&&rg(i,r)&&iC(l,r);for(;t.length>s;)rg(i,r=t[s++])&&(~XP(l,r)||iC(l,r));return l},ng=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],$P=oC,tB=ng,Fh=Object.keys||function(e){return $P(e,tB)},eB=Ot,rB=Uv,nB=Ui,iB=xi,oB=Vn,sB=Fh;Bd.f=eB&&!rB?Object.defineProperties:function(e,t){iB(e);for(var r,i=oB(t),s=sB(t),l=s.length,d=0;l>d;)nB.f(e,r=s[d++],i[r]);return e};var aB=Ae,cB=Ot,sC=Bd.f;aB({target:"Object",stat:!0,forced:Object.defineProperties!==sC,sham:!cB},{defineProperties:sC});var aC=Ir.Object,lB=rC.exports=function(e,t){return aC.defineProperties(e,t)};aC.defineProperties.sham&&(lB.sham=!0);var ur=rC.exports,dB=Is,uB=G.String,Fi=function(e){if(dB(e)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return uB(e)},cC=`	
\v\f\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF`,hB=Ln,pB=Fi,lC=N("".replace),Qh=`[	
\v\f\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]`,AB=RegExp("^"+Qh+Qh+"*"),fB=RegExp(Qh+Qh+"*$"),ig=function(e){return function(t){var r=pB(hB(t));return 1&e&&(r=lC(r,AB,"")),2&e&&(r=lC(r,fB,"")),r}},dC={start:ig(1),end:ig(2),trim:ig(3)},uC=G,gB=u,mB=N,EB=Fi,_B=dC.trim,hC=cC,xd=uC.parseInt,pC=uC.Symbol,AC=pC&&pC.iterator,fC=/^[+-]?0x/i,IB=mB(fC.exec),gC=xd(hC+"08")!==8||xd(hC+"0x16")!==22||AC&&!gB(function(){xd(Object(AC))})?function(e,t){var r=_B(EB(e));return xd(r,t>>>0||(IB(fC,r)?16:10))}:xd;Ae({global:!0,forced:parseInt!=gC},{parseInt:gC});var Tr=Ir.parseInt,mC={exports:{}},vB=Ae,CB=Ot,EC=Ui.f;vB({target:"Object",stat:!0,forced:Object.defineProperty!==EC,sham:!CB},{defineProperty:EC});var _C=Ir.Object,SB=mC.exports=function(e,t,r){return _C.defineProperty(e,t,r)};_C.defineProperty.sham&&(SB.sham=!0);var IC=mC.exports,ie=IC,TB=Gn,RB=io,yB=Bi,wB=yo,bB=G.TypeError,vC=function(e){return function(t,r,i,s){TB(r);var l=RB(t),d=yB(l),h=wB(l),p=e?h-1:0,m=e?-1:1;if(i<2)for(;;){if(p in d){s=d[p],p+=m;break}if(p+=m,e?p<0:h<=p)throw bB("Reduce of empty array with no initial value")}for(;e?p>=0:h>p;p+=m)p in d&&(s=r(s,d[p],p,l));return s}},NB={left:vC(!1),right:vC(!0)},OB=u,pc=function(e,t){var r=[][e];return!!r&&OB(function(){r.call(null,t||function(){throw 1},1)})},Vh=Qn(G.process)=="process",kB=NB.left,CC=zo,DB=Vh;Ae({target:"Array",proto:!0,forced:!pc("reduce")||!DB&&CC>79&&CC<83},{reduce:function(e){var t=arguments.length;return kB(this,e,t,t>1?arguments[1]:void 0)}});var LB=$r("Array").reduce,PB=L,BB=LB,og=Array.prototype,Gh=function(e){var t=e.reduce;return e===og||PB(og,e)&&t===og.reduce?BB:t},MB=io,SC=Fh;Ae({target:"Object",stat:!0,forced:u(function(){SC(1)})},{keys:function(e){return SC(MB(e))}});var ae=Ir.Object.keys,jh={};jh.f=Object.getOwnPropertySymbols;var TC=Ot,UB=N,xB=he,FB=u,sg=Fh,QB=jh,VB=Te,GB=io,jB=Bi,ol=Object.assign,RC=Object.defineProperty,HB=UB([].concat),yC=!ol||FB(function(){if(TC&&ol({b:1},ol(RC({},"a",{enumerable:!0,get:function(){RC(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},r=Symbol(),i="abcdefghijklmnopqrst";return e[r]=7,i.split("").forEach(function(s){t[s]=s}),ol({},e)[r]!=7||sg(ol({},t)).join("")!=i})?function(e,t){for(var r=GB(e),i=arguments.length,s=1,l=QB.f,d=VB.f;i>s;)for(var h,p=jB(arguments[s++]),m=l?HB(sg(p),l(p)):sg(p),f=m.length,_=0;f>_;)h=m[_++],TC&&!xB(d,p,h)||(r[h]=p[h]);return r}:ol,wC=yC;Ae({target:"Object",stat:!0,forced:Object.assign!==wC},{assign:wC});var Hh,Fd,Kh,hr=Ir.Object.assign,sl={},KB=J,WB=zf,bC=G.WeakMap,NC=KB(bC)&&/native code/.test(WB(bC)),YB=Nh.exports,qB=Oh,OC=YB("keys"),Wh=function(e){return OC[e]||(OC[e]=qB(e))},JB=NC,kC=G,ag=N,zB=Vr,XB=ka,cg=gn,lg=Hf,ZB=Wh,$B=Ud,DC="Object already initialized",dg=kC.TypeError,tM=kC.WeakMap;if(JB||lg.state){var Ac=lg.state||(lg.state=new tM),eM=ag(Ac.get),LC=ag(Ac.has),rM=ag(Ac.set);Hh=function(e,t){if(LC(Ac,e))throw new dg(DC);return t.facade=e,rM(Ac,e,t),t},Fd=function(e){return eM(Ac,e)||{}},Kh=function(e){return LC(Ac,e)}}else{var al=ZB("state");$B[al]=!0,Hh=function(e,t){if(cg(e,al))throw new dg(DC);return t.facade=e,XB(e,al,t),t},Fd=function(e){return cg(e,al)?e[al]:{}},Kh=function(e){return cg(e,al)}}var Yh,oo={set:Hh,get:Fd,has:Kh,enforce:function(e){return Kh(e)?Fd(e):Hh(e,{})},getterFor:function(e){return function(t){var r;if(!zB(t)||(r=Fd(t)).type!==e)throw dg("Incompatible receiver, "+e+" required");return r}}},ug=Ot,nM=gn,PC=Function.prototype,iM=ug&&Object.getOwnPropertyDescriptor,hg=nM(PC,"name"),BC={EXISTS:hg,PROPER:hg&&function(){}.name==="something",CONFIGURABLE:hg&&(!ug||ug&&iM(PC,"name").configurable)},MC=ti("document","documentElement"),oM=xi,sM=Bd,UC=ng,aM=Ud,cM=MC,lM=Wf,xC=Wh("IE_PROTO"),pg=function(){},FC=function(e){return"<script>"+e+"<\/script>"},QC=function(e){e.write(FC("")),e.close();var t=e.parentWindow.Object;return e=null,t},qh=function(){try{Yh=new ActiveXObject("htmlfile")}catch{}var e,t;qh=typeof document!="undefined"?document.domain&&Yh?QC(Yh):((t=lM("iframe")).style.display="none",cM.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(FC("document.F=Object")),e.close(),e.F):QC(Yh);for(var r=UC.length;r--;)delete qh.prototype[UC[r]];return qh()};aM[xC]=!0;var fc,VC,GC,gc=Object.create||function(e,t){var r;return e!==null?(pg.prototype=oM(e),r=new pg,pg.prototype=null,r[xC]=e):r=qh(),t===void 0?r:sM.f(r,t)},jC=!u(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),dM=G,uM=gn,hM=J,pM=io,AM=jC,HC=Wh("IE_PROTO"),Ag=dM.Object,fM=Ag.prototype,Jh=AM?Ag.getPrototypeOf:function(e){var t=pM(e);if(uM(t,HC))return t[HC];var r=t.constructor;return hM(r)&&t instanceof r?r.prototype:t instanceof Ag?fM:null},gM=ka,cl=function(e,t,r,i){i&&i.enumerable?e[t]=r:gM(e,t,r)},mM=u,EM=J,_M=gc,KC=Jh,IM=cl,fg=en("iterator"),WC=!1;[].keys&&("next"in(GC=[].keys())?(VC=KC(KC(GC)))!==Object.prototype&&(fc=VC):WC=!0);var vM=fc==null||mM(function(){var e={};return fc[fg].call(e)!==e});EM((fc=vM?{}:_M(fc))[fg])||IM(fc,fg,function(){return this});var YC={IteratorPrototype:fc,BUGGY_SAFARI_ITERATORS:WC},CM=Is,SM=qf?{}.toString:function(){return"[object "+CM(this)+"]"},TM=qf,RM=Ui.f,yM=ka,wM=gn,bM=SM,qC=en("toStringTag"),Da=function(e,t,r,i){if(e){var s=r?e:e.prototype;wM(s,qC)||RM(s,qC,{configurable:!0,value:t}),i&&!TM&&yM(s,"toString",bM)}},NM=YC.IteratorPrototype,OM=gc,kM=Re,DM=Da,LM=sl,PM=function(){return this},JC=function(e,t,r,i){var s=t+" Iterator";return e.prototype=OM(NM,{next:kM(+!i,r)}),DM(e,s,!1,!0),LM[s]=PM,e},zC=G,BM=J,MM=zC.String,UM=zC.TypeError,xM=N,FM=xi,QM=function(e){if(typeof e=="object"||BM(e))return e;throw UM("Can't set "+MM(e)+" as a prototype")},XC=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=xM(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(r,[]),t=r instanceof Array}catch{}return function(i,s){return FM(i),QM(s),t?e(i,s):i.__proto__=s,i}}():void 0),VM=Ae,GM=he,jM=JC,HM=Jh,KM=Da,ZC=cl,$C=sl,WM=BC.PROPER,zh=YC.BUGGY_SAFARI_ITERATORS,gg=en("iterator"),tS="keys",Xh="values",eS="entries",YM=function(){return this},mg=function(e,t,r,i,s,l,d){jM(r,t,i);var h,p,m,f=function(B){if(B===s&&w)return w;if(!zh&&B in T)return T[B];switch(B){case tS:case Xh:case eS:return function(){return new r(this,B)}}return function(){return new r(this)}},_=t+" Iterator",v=!1,T=e.prototype,R=T[gg]||T["@@iterator"]||s&&T[s],w=!zh&&R||f(s),O=t=="Array"&&T.entries||R;if(O&&(h=HM(O.call(new e)))!==Object.prototype&&h.next&&(KM(h,_,!0,!0),$C[_]=YM),WM&&s==Xh&&R&&R.name!==Xh&&(v=!0,w=function(){return GM(R,this)}),s)if(p={values:f(Xh),keys:l?w:f(tS),entries:f(eS)},d)for(m in p)(zh||v||!(m in T))&&ZC(T,m,p[m]);else VM({target:t,proto:!0,forced:zh||v},p);return d&&T[gg]!==w&&ZC(T,gg,w,{name:s}),$C[t]=w,p},qM=Vn,rS=sl,nS=oo;Ui.f;var JM=mg,iS="Array Iterator",zM=nS.set,XM=nS.getterFor(iS);JM(Array,"Array",function(e,t){zM(this,{type:iS,target:qM(e),index:0,kind:t})},function(){var e=XM(this),t=e.target,r=e.kind,i=e.index++;return!t||i>=t.length?(e.target=void 0,{value:void 0,done:!0}):r=="keys"?{value:i,done:!1}:r=="values"?{value:t[i],done:!1}:{value:[i,t[i]],done:!1}},"values"),rS.Arguments=rS.Array;var ZM={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},$M=G,tU=Is,eU=ka,oS=sl,sS=en("toStringTag");for(var Eg in ZM){var aS=$M[Eg],_g=aS&&aS.prototype;_g&&tU(_g)!==sS&&eU(_g,sS,Eg),oS[Eg]=oS.Array}var rU=Ws,nU=Bi,iU=io,oU=yo,sU=Zf,cS=N([].push),La=function(e){var t=e==1,r=e==2,i=e==3,s=e==4,l=e==6,d=e==7,h=e==5||l;return function(p,m,f,_){for(var v,T,R=iU(p),w=nU(R),O=rU(m,f),B=oU(w),K=0,j=_||sU,nt=t?j(p,B):r||d?j(p,0):void 0;B>K;K++)if((h||K in w)&&(T=O(v=w[K],K,R),e))if(t)nt[K]=T;else if(T)switch(e){case 3:return!0;case 5:return v;case 6:return K;case 2:cS(nt,v)}else switch(e){case 4:return!1;case 7:cS(nt,v)}return l?-1:i||s?s:nt}},Xo={forEach:La(0),map:La(1),filter:La(2),some:La(3),every:La(4),find:La(5),findIndex:La(6),filterReject:La(7)},aU=Xo.forEach,lS=pc("forEach")?[].forEach:function(e){return aU(this,e,arguments.length>1?arguments[1]:void 0)};Ae({target:"Array",proto:!0,forced:[].forEach!=lS},{forEach:lS});var cU=$r("Array").forEach,lU=Is,dU=gn,uU=L,hU=cU,Ig=Array.prototype,pU={DOMTokenList:!0,NodeList:!0},V=function(e){var t=e.forEach;return e===Ig||uU(Ig,e)&&t===Ig.forEach||dU(pU,lU(e))?hU:t},AU=Vr,fU=Qn,gU=en("match"),mU=function(e){var t;return AU(e)&&((t=e[gU])!==void 0?!!t:fU(e)=="RegExp")},EU=G.TypeError,vg=function(e){if(mU(e))throw EU("The method doesn't accept regular expressions");return e},_U=en("match"),Cg=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[_U]=!1,"/./"[e](t)}catch{}}return!1},IU=Ae,dS=N,vU=Ph,uS=Fi,CU=vg,SU=Ln,TU=Cg,hS=dS("".endsWith),RU=dS("".slice),yU=Math.min;IU({target:"String",proto:!0,forced:!TU("endsWith")},{endsWith:function(e){var t=uS(SU(this));CU(e);var r=arguments.length>1?arguments[1]:void 0,i=t.length,s=r===void 0?i:yU(vU(r),i),l=uS(e);return hS?hS(t,l,s):RU(t,s-l.length,s)===l}});var wU=$r("String").endsWith,bU=L,NU=wU,Sg=String.prototype,pS=function(e){var t=e.endsWith;return typeof e=="string"||e===Sg||bU(Sg,e)&&t===Sg.endsWith?NU:t},Qd={exports:{}},Vd={},OU=oC,kU=ng.concat("length","prototype");Vd.f=Object.getOwnPropertyNames||function(e){return OU(e,kU)};var Tg={},AS=Md,DU=yo,LU=il,PU=G.Array,BU=Math.max,Rg=function(e,t,r){for(var i=DU(e),s=AS(t,i),l=AS(r===void 0?i:r,i),d=PU(BU(l-s,0)),h=0;s<l;s++,h++)LU(d,h,e[s]);return d.length=h,d},MU=Qn,UU=Vn,fS=Vd.f,xU=Rg,gS=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];Tg.f=function(e){return gS&&MU(e)=="Window"?function(t){try{return fS(t)}catch{return xU(gS)}}(e):fS(UU(e))};var FU=u(function(){if(typeof ArrayBuffer=="function"){var e=new ArrayBuffer(8);Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8})}}),QU=u,VU=Vr,GU=Qn,mS=FU,Zh=Object.isExtensible,ES=QU(function(){Zh(1)})||mS?function(e){return!!VU(e)&&(!mS||GU(e)!="ArrayBuffer")&&(!Zh||Zh(e))}:Zh,jU=!u(function(){return Object.isExtensible(Object.preventExtensions({}))}),HU=Ae,KU=N,WU=Ud,YU=Vr,yg=gn,qU=Ui.f,_S=Vd,JU=Tg,wg=ES,zU=jU,IS=!1,Ys=Oh("meta"),XU=0,bg=function(e){qU(e,Ys,{value:{objectID:"O"+XU++,weakData:{}}})},ZU=Qd.exports={enable:function(){ZU.enable=function(){},IS=!0;var e=_S.f,t=KU([].splice),r={};r[Ys]=1,e(r).length&&(_S.f=function(i){for(var s=e(i),l=0,d=s.length;l<d;l++)if(s[l]===Ys){t(s,l,1);break}return s},HU({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:JU.f}))},fastKey:function(e,t){if(!YU(e))return typeof e=="symbol"?e:(typeof e=="string"?"S":"P")+e;if(!yg(e,Ys)){if(!wg(e))return"F";if(!t)return"E";bg(e)}return e[Ys].objectID},getWeakData:function(e,t){if(!yg(e,Ys)){if(!wg(e))return!0;if(!t)return!1;bg(e)}return e[Ys].weakData},onFreeze:function(e){return zU&&IS&&wg(e)&&!yg(e,Ys)&&bg(e),e}};WU[Ys]=!0;var $U=sl,tx=en("iterator"),ex=Array.prototype,vS=function(e){return e!==void 0&&($U.Array===e||ex[tx]===e)},rx=Is,CS=Oa,nx=sl,ix=en("iterator"),$h=function(e){if(e!=null)return CS(e,ix)||CS(e,"@@iterator")||nx[rx(e)]},ox=he,sx=Gn,ax=xi,cx=Sn,lx=$h,dx=G.TypeError,Ng=function(e,t){var r=arguments.length<2?lx(e):t;if(sx(r))return ax(ox(r,e));throw dx(cx(e)+" is not iterable")},ux=he,SS=xi,hx=Oa,TS=function(e,t,r){var i,s;SS(e);try{if(!(i=hx(e,"return"))){if(t==="throw")throw r;return r}i=ux(i,e)}catch(l){s=!0,i=l}if(t==="throw")throw r;if(s)throw i;return SS(i),r},px=Ws,Ax=he,fx=xi,gx=Sn,mx=vS,Ex=yo,RS=L,_x=Ng,Ix=$h,yS=TS,vx=G.TypeError,tp=function(e,t){this.stopped=e,this.result=t},wS=tp.prototype,mc=function(e,t,r){var i,s,l,d,h,p,m,f=r&&r.that,_=!(!r||!r.AS_ENTRIES),v=!(!r||!r.IS_ITERATOR),T=!(!r||!r.INTERRUPTED),R=px(t,f),w=function(B){return i&&yS(i,"normal",B),new tp(!0,B)},O=function(B){return _?(fx(B),T?R(B[0],B[1],w):R(B[0],B[1])):T?R(B,w):R(B)};if(v)i=e;else{if(!(s=Ix(e)))throw vx(gx(e)+" is not iterable");if(mx(s)){for(l=0,d=Ex(e);d>l;l++)if((h=O(e[l]))&&RS(wS,h))return h;return new tp(!1)}i=_x(e,s)}for(p=i.next;!(m=Ax(p,i)).done;){try{h=O(m.value)}catch(B){yS(i,"throw",B)}if(typeof h=="object"&&h&&RS(wS,h))return h}return new tp(!1)},Cx=L,Sx=G.TypeError,ll=function(e,t){if(Cx(t,e))return e;throw Sx("Incorrect invocation")},Tx=Ae,Rx=G,yx=Qd.exports,wx=u,bx=ka,Nx=mc,Ox=ll,kx=J,Dx=Vr,Lx=Da,Px=Ui.f,Bx=Xo.forEach,Mx=Ot,Ux=oo.set,xx=oo.getterFor,bS=function(e,t,r){var i,s=e.indexOf("Map")!==-1,l=e.indexOf("Weak")!==-1,d=s?"set":"add",h=Rx[e],p=h&&h.prototype,m={};if(Mx&&kx(h)&&(l||p.forEach&&!wx(function(){new h().entries().next()}))){var f=(i=t(function(v,T){Ux(Ox(v,f),{type:e,collection:new h}),T!=null&&Nx(T,v[d],{that:v,AS_ENTRIES:s})})).prototype,_=xx(e);Bx(["add","clear","delete","forEach","get","has","set","keys","values","entries"],function(v){var T=v=="add"||v=="set";!(v in p)||l&&v=="clear"||bx(f,v,function(R,w){var O=_(this).collection;if(!T&&l&&!Dx(R))return v=="get"&&void 0;var B=O[v](R===0?0:R,w);return T?this:B})}),l||Px(f,"size",{configurable:!0,get:function(){return _(this).collection.size}})}else i=r.getConstructor(t,e,s,d),yx.enable();return Lx(i,e,!1,!0),m[e]=i,Tx({global:!0,forced:!0},m),l||r.setStrong(i,e,s),i},Fx=cl,Gd=function(e,t,r){for(var i in t)r&&r.unsafe&&e[i]?e[i]=t[i]:Fx(e,i,t[i],r);return e},Qx=ti,Vx=Ui,Gx=Ot,NS=en("species"),OS=function(e){var t=Qx(e),r=Vx.f;Gx&&t&&!t[NS]&&r(t,NS,{configurable:!0,get:function(){return this}})},jx=Ui.f,Hx=gc,kS=Gd,Kx=Ws,Wx=ll,Yx=mc,qx=mg,Jx=OS,jd=Ot,DS=Qd.exports.fastKey,LS=oo.set,Og=oo.getterFor;bS("Map",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},{getConstructor:function(e,t,r,i){var s=e(function(m,f){Wx(m,l),LS(m,{type:t,index:Hx(null),first:void 0,last:void 0,size:0}),jd||(m.size=0),f!=null&&Yx(f,m[i],{that:m,AS_ENTRIES:r})}),l=s.prototype,d=Og(t),h=function(m,f,_){var v,T,R=d(m),w=p(m,f);return w?w.value=_:(R.last=w={index:T=DS(f,!0),key:f,value:_,previous:v=R.last,next:void 0,removed:!1},R.first||(R.first=w),v&&(v.next=w),jd?R.size++:m.size++,T!=="F"&&(R.index[T]=w)),m},p=function(m,f){var _,v=d(m),T=DS(f);if(T!=="F")return v.index[T];for(_=v.first;_;_=_.next)if(_.key==f)return _};return kS(l,{clear:function(){for(var m=d(this),f=m.index,_=m.first;_;)_.removed=!0,_.previous&&(_.previous=_.previous.next=void 0),delete f[_.index],_=_.next;m.first=m.last=void 0,jd?m.size=0:this.size=0},delete:function(m){var f=this,_=d(f),v=p(f,m);if(v){var T=v.next,R=v.previous;delete _.index[v.index],v.removed=!0,R&&(R.next=T),T&&(T.previous=R),_.first==v&&(_.first=T),_.last==v&&(_.last=R),jd?_.size--:f.size--}return!!v},forEach:function(m){for(var f,_=d(this),v=Kx(m,arguments.length>1?arguments[1]:void 0);f=f?f.next:_.first;)for(v(f.value,f.key,this);f&&f.removed;)f=f.previous},has:function(m){return!!p(this,m)}}),kS(l,r?{get:function(m){var f=p(this,m);return f&&f.value},set:function(m,f){return h(this,m===0?0:m,f)}}:{add:function(m){return h(this,m=m===0?0:m,m)}}),jd&&jx(l,"size",{get:function(){return d(this).size}}),s},setStrong:function(e,t,r){var i=t+" Iterator",s=Og(t),l=Og(i);qx(e,t,function(d,h){LS(this,{type:i,target:d,state:s(d),kind:h,last:void 0})},function(){for(var d=l(this),h=d.kind,p=d.last;p&&p.removed;)p=p.previous;return d.target&&(d.last=p=p?p.next:d.state.first)?h=="keys"?{value:p.key,done:!1}:h=="values"?{value:p.value,done:!1}:{value:[p.key,p.value],done:!1}:(d.target=void 0,{value:void 0,done:!0})},r?"entries":"values",!r,!0),Jx(t)}});var kg=N,zx=nl,Xx=Fi,Zx=Ln,$x=kg("".charAt),PS=kg("".charCodeAt),t3=kg("".slice),BS=function(e){return function(t,r){var i,s,l=Xx(Zx(t)),d=zx(r),h=l.length;return d<0||d>=h?e?"":void 0:(i=PS(l,d))<55296||i>56319||d+1===h||(s=PS(l,d+1))<56320||s>57343?e?$x(l,d):i:e?t3(l,d,d+2):s-56320+(i-55296<<10)+65536}},MS={codeAt:BS(!1),charAt:BS(!0)},e3=MS.charAt,r3=Fi,US=oo,n3=mg,xS="String Iterator",i3=US.set,o3=US.getterFor(xS);n3(String,"String",function(e){i3(this,{type:xS,string:r3(e),index:0})},function(){var e,t=o3(this),r=t.string,i=t.index;return i>=r.length?{value:void 0,done:!0}:(e=e3(r,i),t.index+=e.length,{value:e,done:!1})});var $t=Ir.Map;let FS=!0,QS=!0;function Hd(e,t,r){const i=e.match(t);return i&&i.length>=r&&Tr(i[r],10)}function dl(e,t,r){if(!e.RTCPeerConnection)return;const i=e.RTCPeerConnection.prototype,s=i.addEventListener;i.addEventListener=function(d,h){if(d!==t)return s.apply(this,arguments);const p=m=>{const f=r(m);f&&h(f)};return this._eventMap=this._eventMap||{},this._eventMap[h]=p,s.apply(this,[d,p])};const l=i.removeEventListener;i.removeEventListener=function(d,h){if(d!==t||!this._eventMap||!this._eventMap[h])return l.apply(this,arguments);const p=this._eventMap[h];return delete this._eventMap[h],l.apply(this,[d,p])},ie(i,"on"+t,{get(){return this["_on"+t]},set(d){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),d&&this.addEventListener(t,this["_on"+t]=d)},enumerable:!0,configurable:!0})}function s3(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(FS=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function a3(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(QS=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function Dg(){if(typeof window=="object"){if(FS)return;typeof console!="undefined"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function ep(e,t){QS&&console.warn(e+" is deprecated, please use "+t+" instead.")}function qs(e){const{navigator:t}=e,r={browser:null,version:null};if(e===void 0||!e.navigator)return r.browser="Not a browser.",r;if(t.mozGetUserMedia)r.browser="firefox",r.version=Hd(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||e.isSecureContext===!1&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)r.browser="chrome",r.version=Hd(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))r.browser="edge",r.version=Hd(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return r.browser="Not a supported browser.",r;r.browser="safari",r.version=Hd(t.userAgent,/AppleWebKit\/(\d+)\./,1),r.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return r}function VS(e){return Object.prototype.toString.call(e)==="[object Object]"}function GS(e){var t;return VS(e)?Gh(t=ae(e)).call(t,function(r,i){const s=VS(e[i]),l=s?GS(e[i]):e[i],d=s&&!ae(l).length;return l===void 0||d?r:hr(r,{[i]:l})},{}):e}function jS(e,t,r){const i=r?"outbound-rtp":"inbound-rtp",s=new $t;if(t===null)return s;const l=[];return V(e).call(e,d=>{d.type==="track"&&d.trackIdentifier===t.id&&l.push(d)}),V(l).call(l,d=>{V(e).call(e,h=>{h.type===i&&h.trackId===d.id&&function p(m,f,_){var v;f&&!_.has(f.id)&&(_.set(f.id,f),V(v=ae(f)).call(v,T=>{if(pS(T).call(T,"Id"))p(m,m.get(f[T]),_);else if(pS(T).call(T,"Ids")){var R;V(R=f[T]).call(R,w=>{p(m,m.get(w),_)})}}))}(e,h,s)})}),s}var c3=Ae,l3=Xo.find,d3="find",HS=!0;d3 in[]&&Array(1).find(function(){HS=!1}),c3({target:"Array",proto:!0,forced:HS},{find:function(e){return l3(this,e,arguments.length>1?arguments[1]:void 0)}});var u3=$r("Array").find,h3=L,p3=u3,Lg=Array.prototype,ft=function(e){var t=e.find;return e===Lg||h3(Lg,e)&&t===Lg.find?p3:t},Kd=N([].slice),A3=Ae,f3=G,KS=kd,g3=Mh,m3=Vr,WS=Md,E3=yo,_3=Vn,I3=il,v3=en,C3=Kd,S3=Ld("slice"),T3=v3("species"),Pg=f3.Array,R3=Math.max;A3({target:"Array",proto:!0,forced:!S3},{slice:function(e,t){var r,i,s,l=_3(this),d=E3(l),h=WS(e,d),p=WS(t===void 0?d:t,d);if(KS(l)&&(r=l.constructor,(g3(r)&&(r===Pg||KS(r.prototype))||m3(r)&&(r=r[T3])===null)&&(r=void 0),r===Pg||r===void 0))return C3(l,h,p);for(i=new(r===void 0?Pg:r)(R3(p-h,0)),s=0;h<p;h++,s++)h in l&&I3(i,s,l[h]);return i.length=s,i}});var y3=$r("Array").slice,w3=L,b3=y3,Bg=Array.prototype,rn=function(e){var t=e.slice;return e===Bg||w3(Bg,e)&&t===Bg.slice?b3:t},N3=Ae,O3=eg.indexOf,k3=pc,Mg=N([].indexOf),YS=!!Mg&&1/Mg([1],1,-0)<0,D3=k3("indexOf");N3({target:"Array",proto:!0,forced:YS||!D3},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return YS?Mg(this,e,t)||0:O3(this,e,t)}});var L3=$r("Array").indexOf,P3=L,B3=L3,Ug=Array.prototype,xt=function(e){var t=e.indexOf;return e===Ug||P3(Ug,e)&&t===Ug.indexOf?B3:t},M3=Ae,U3=G,x3=Md,F3=nl,Q3=yo,V3=io,G3=Zf,j3=il,H3=Ld("splice"),K3=U3.TypeError,W3=Math.max,Y3=Math.min,q3=9007199254740991,J3="Maximum allowed length exceeded";M3({target:"Array",proto:!0,forced:!H3},{splice:function(e,t){var r,i,s,l,d,h,p=V3(this),m=Q3(p),f=x3(e,m),_=arguments.length;if(_===0?r=i=0:_===1?(r=0,i=m-f):(r=_-2,i=Y3(W3(F3(t),0),m-f)),m+r-i>q3)throw K3(J3);for(s=G3(p,i),l=0;l<i;l++)(d=f+l)in p&&j3(s,l,p[d]);if(s.length=i,r<i){for(l=f;l<m-i;l++)h=l+r,(d=l+i)in p?p[h]=p[d]:delete p[h];for(l=m;l>m-i+r;l--)delete p[l-1]}else if(r>i)for(l=m-i;l>f;l--)h=l+r-1,(d=l+i-1)in p?p[h]=p[d]:delete p[h];for(l=0;l<r;l++)p[l+f]=arguments[l+2];return p.length=m-i+r,s}});var z3=$r("Array").splice,X3=L,Z3=z3,xg=Array.prototype,Ye=function(e){var t=e.splice;return e===xg||X3(xg,e)&&t===xg.splice?Z3:t},$3=Xo.map;Ae({target:"Array",proto:!0,forced:!Ld("map")},{map:function(e){return $3(this,e,arguments.length>1?arguments[1]:void 0)}});var tF=$r("Array").map,eF=L,rF=tF,Fg=Array.prototype,pt=function(e){var t=e.map;return e===Fg||eF(Fg,e)&&t===Fg.map?rF:t},nF=ti,iF=Vd,oF=jh,sF=xi,aF=N([].concat),qS=nF("Reflect","ownKeys")||function(e){var t=iF.f(sF(e)),r=oF.f;return r?aF(t,r(e)):t},JS=gn,cF=qS,lF=Ft,dF=Ui,uF=N("".replace),hF=String(Error("zxcasd").stack),zS=/\n\s*at [^:]*:[^\n]*/,pF=zS.test(hF),AF=Vr,fF=ka,gF=Fi,mF=Re,EF=!u(function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",mF(1,7)),e.stack!==7)}),_F=Ae,IF=G,vF=L,CF=Jh,rp=XC,SF=function(e,t,r){for(var i=cF(t),s=dF.f,l=lF.f,d=0;d<i.length;d++){var h=i[d];JS(e,h)||r&&JS(r,h)||s(e,h,l(t,h))}},XS=gc,np=ka,Qg=Re,TF=function(e,t){if(pF&&typeof e=="string")for(;t--;)e=uF(e,zS,"");return e},RF=function(e,t){AF(t)&&"cause"in t&&fF(e,"cause",t.cause)},yF=mc,wF=function(e,t){return e===void 0?arguments.length<2?"":t:gF(e)},bF=EF,NF=en("toStringTag"),ip=IF.Error,OF=[].push,Wd=function(e,t){var r,i=arguments.length>2?arguments[2]:void 0,s=vF(Vg,this);rp?r=rp(new ip,s?CF(this):Vg):(r=s?this:XS(Vg),np(r,NF,"Error")),t!==void 0&&np(r,"message",wF(t)),bF&&np(r,"stack",TF(r.stack,1)),RF(r,i);var l=[];return yF(e,OF,{that:l}),np(r,"errors",l),r};rp?rp(Wd,ip):SF(Wd,ip,{name:!0});var Vg=Wd.prototype=XS(ip.prototype,{constructor:Qg(1,Wd),message:Qg(1,""),name:Qg(1,"AggregateError")});_F({global:!0},{AggregateError:Wd});var ZS=G.Promise,$S=en("iterator"),tT=!1;try{var kF=0,eT={next:function(){return{done:!!kF++}},return:function(){tT=!0}};eT[$S]=function(){return this},Array.from(eT,function(){throw 2})}catch{}var Yd,ul,rT,Gg,nT=function(e,t){if(!t&&!tT)return!1;var r=!1;try{var i={};i[$S]=function(){return{next:function(){return{done:r=!0}}}},e(i)}catch{}return r},DF=Mh,LF=Sn,PF=G.TypeError,iT=xi,BF=function(e){if(DF(e))return e;throw PF(LF(e)+" is not a constructor")},MF=en("species"),oT=function(e,t){var r,i=iT(e).constructor;return i===void 0||(r=iT(i)[MF])==null?t:BF(r)},sT=/(?:ipad|iphone|ipod).*applewebkit/i.test(Pn),so=G,UF=Dt,xF=Ws,aT=J,FF=gn,QF=u,cT=MC,VF=Kd,lT=Wf,GF=sT,jF=Vh,jg=so.setImmediate,Hg=so.clearImmediate,HF=so.process,Kg=so.Dispatch,KF=so.Function,dT=so.MessageChannel,WF=so.String,Wg=0,qd={},YF="onreadystatechange";try{Yd=so.location}catch{}var Yg=function(e){if(FF(qd,e)){var t=qd[e];delete qd[e],t()}},qg=function(e){return function(){Yg(e)}},uT=function(e){Yg(e.data)},hT=function(e){so.postMessage(WF(e),Yd.protocol+"//"+Yd.host)};jg&&Hg||(jg=function(e){var t=VF(arguments,1);return qd[++Wg]=function(){UF(aT(e)?e:KF(e),void 0,t)},ul(Wg),Wg},Hg=function(e){delete qd[e]},jF?ul=function(e){HF.nextTick(qg(e))}:Kg&&Kg.now?ul=function(e){Kg.now(qg(e))}:dT&&!GF?(Gg=(rT=new dT).port2,rT.port1.onmessage=uT,ul=xF(Gg.postMessage,Gg)):so.addEventListener&&aT(so.postMessage)&&!so.importScripts&&Yd&&Yd.protocol!=="file:"&&!QF(hT)?(ul=hT,so.addEventListener("message",uT,!1)):ul=YF in lT("script")?function(e){cT.appendChild(lT("script")).onreadystatechange=function(){cT.removeChild(this),Yg(e)}}:function(e){setTimeout(qg(e),0)});var Jd,Ec,zd,hl,Jg,zg,Xg,pT,AT={set:jg,clear:Hg},qF=G,JF=/ipad|iphone|ipod/i.test(Pn)&&qF.Pebble!==void 0,zF=/web0s(?!.*chrome)/i.test(Pn),_c=G,fT=Ws,XF=Ft.f,Zg=AT.set,ZF=sT,$F=JF,tQ=zF,$g=Vh,gT=_c.MutationObserver||_c.WebKitMutationObserver,mT=_c.document,ET=_c.process,op=_c.Promise,_T=XF(_c,"queueMicrotask"),IT=_T&&_T.value;IT||(Jd=function(){var e,t;for($g&&(e=ET.domain)&&e.exit();Ec;){t=Ec.fn,Ec=Ec.next;try{t()}catch(r){throw Ec?hl():zd=void 0,r}}zd=void 0,e&&e.enter()},ZF||$g||tQ||!gT||!mT?!$F&&op&&op.resolve?((Xg=op.resolve(void 0)).constructor=op,pT=fT(Xg.then,Xg),hl=function(){pT(Jd)}):$g?hl=function(){ET.nextTick(Jd)}:(Zg=fT(Zg,_c),hl=function(){Zg(Jd)}):(Jg=!0,zg=mT.createTextNode(""),new gT(Jd).observe(zg,{characterData:!0}),hl=function(){zg.data=Jg=!Jg}));var eQ=IT||function(e){var t={fn:e,next:void 0};zd&&(zd.next=t),Ec||(Ec=t,hl()),zd=t},pl={},vT=Gn,rQ=function(e){var t,r;this.promise=new e(function(i,s){if(t!==void 0||r!==void 0)throw TypeError("Bad Promise constructor");t=i,r=s}),this.resolve=vT(t),this.reject=vT(r)};pl.f=function(e){return new rQ(e)};var nQ=xi,iQ=Vr,oQ=pl,CT=function(e,t){if(nQ(e),iQ(t)&&t.constructor===e)return t;var r=oQ.f(e);return(0,r.resolve)(t),r.promise},sQ=G,sp=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},ST=function(){this.head=null,this.tail=null};ST.prototype={add:function(e){var t={item:e,next:null};this.head?this.tail.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item}};var tm,TT,em,aQ=typeof window=="object",ap=Ae,Js=G,cQ=ti,Pa=he,rm=ZS,lQ=Gd,dQ=Da,uQ=OS,nm=Gn,cp=J,hQ=Vr,pQ=ll,AQ=zf,RT=mc,fQ=nT,gQ=oT,yT=AT.set,im=eQ,mQ=CT,EQ=function(e,t){var r=sQ.console;r&&r.error&&(arguments.length==1?r.error(e):r.error(e,t))},wT=pl,om=sp,_Q=ST,sm=oo,IQ=Mv,vQ=aQ,lp=Vh,bT=zo,CQ=en("species"),vs="Promise",NT=sm.getterFor(vs),SQ=sm.set,TQ=sm.getterFor(vs),RQ=rm&&rm.prototype,Cs=rm,dp=RQ,OT=Js.TypeError,am=Js.document,cm=Js.process,Al=wT.f,yQ=Al,wQ=!!(am&&am.createEvent&&Js.dispatchEvent),kT=cp(Js.PromiseRejectionEvent),DT="unhandledrejection",up=IQ(vs,function(){var e=AQ(Cs),t=e!==String(Cs);if(!t&&bT===66||!dp.finally)return!0;if(bT>=51&&/native code/.test(e))return!1;var r=new Cs(function(s){s(1)}),i=function(s){s(function(){},function(){})};return(r.constructor={})[CQ]=i,!(r.then(function(){})instanceof i)||!t&&vQ&&!kT}),bQ=up||!fQ(function(e){Cs.all(e).catch(function(){})}),LT=function(e){var t;return!(!hQ(e)||!cp(t=e.then))&&t},PT=function(e,t){var r,i,s,l=t.value,d=t.state==1,h=d?e.ok:e.fail,p=e.resolve,m=e.reject,f=e.domain;try{h?(d||(t.rejection===2&&OQ(t),t.rejection=1),h===!0?r=l:(f&&f.enter(),r=h(l),f&&(f.exit(),s=!0)),r===e.promise?m(OT("Promise-chain cycle")):(i=LT(r))?Pa(i,r,p,m):p(r)):m(l)}catch(_){f&&!s&&f.exit(),m(_)}},BT=function(e,t){e.notified||(e.notified=!0,im(function(){for(var r,i=e.reactions;r=i.get();)PT(r,e);e.notified=!1,t&&!e.rejection&&NQ(e)}))},MT=function(e,t,r){var i,s;wQ?((i=am.createEvent("Event")).promise=t,i.reason=r,i.initEvent(e,!1,!0),Js.dispatchEvent(i)):i={promise:t,reason:r},!kT&&(s=Js["on"+e])?s(i):e===DT&&EQ("Unhandled promise rejection",r)},NQ=function(e){Pa(yT,Js,function(){var t,r=e.facade,i=e.value;if(UT(e)&&(t=om(function(){lp?cm.emit("unhandledRejection",i,r):MT(DT,r,i)}),e.rejection=lp||UT(e)?2:1,t.error))throw t.value})},UT=function(e){return e.rejection!==1&&!e.parent},OQ=function(e){Pa(yT,Js,function(){var t=e.facade;lp?cm.emit("rejectionHandled",t):MT("rejectionhandled",t,e.value)})},fl=function(e,t,r){return function(i){e(t,i,r)}},gl=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,BT(e,!0))},lm=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw OT("Promise can't be resolved itself");var i=LT(t);i?im(function(){var s={done:!1};try{Pa(i,t,fl(lm,s,e),fl(gl,s,e))}catch(l){gl(s,l,e)}}):(e.value=t,e.state=1,BT(e,!1))}catch(s){gl({done:!1},s,e)}}};up&&(dp=(Cs=function(e){pQ(this,dp),nm(e),Pa(tm,this);var t=NT(this);try{e(fl(lm,t),fl(gl,t))}catch(r){gl(t,r)}}).prototype,(tm=function(e){SQ(this,{type:vs,done:!1,notified:!1,parent:!1,reactions:new _Q,rejection:!1,state:0,value:void 0})}).prototype=lQ(dp,{then:function(e,t){var r=TQ(this),i=Al(gQ(this,Cs));return r.parent=!0,i.ok=!cp(e)||e,i.fail=cp(t)&&t,i.domain=lp?cm.domain:void 0,r.state==0?r.reactions.add(i):im(function(){PT(i,r)}),i.promise},catch:function(e){return this.then(void 0,e)}}),TT=function(){var e=new tm,t=NT(e);this.promise=e,this.resolve=fl(lm,t),this.reject=fl(gl,t)},wT.f=Al=function(e){return e===Cs||e===em?new TT(e):yQ(e)}),ap({global:!0,wrap:!0,forced:up},{Promise:Cs}),dQ(Cs,vs,!1,!0),uQ(vs),em=cQ(vs),ap({target:vs,stat:!0,forced:up},{reject:function(e){var t=Al(this);return Pa(t.reject,void 0,e),t.promise}}),ap({target:vs,stat:!0,forced:!0},{resolve:function(e){return mQ(this===em?Cs:this,e)}}),ap({target:vs,stat:!0,forced:bQ},{all:function(e){var t=this,r=Al(t),i=r.resolve,s=r.reject,l=om(function(){var d=nm(t.resolve),h=[],p=0,m=1;RT(e,function(f){var _=p++,v=!1;m++,Pa(d,t,f).then(function(T){v||(v=!0,h[_]=T,--m||i(h))},s)}),--m||i(h)});return l.error&&s(l.value),r.promise},race:function(e){var t=this,r=Al(t),i=r.reject,s=om(function(){var l=nm(t.resolve);RT(e,function(d){Pa(l,t,d).then(r.resolve,i)})});return s.error&&i(s.value),r.promise}});var kQ=he,DQ=Gn,LQ=pl,PQ=sp,BQ=mc;Ae({target:"Promise",stat:!0},{allSettled:function(e){var t=this,r=LQ.f(t),i=r.resolve,s=r.reject,l=PQ(function(){var d=DQ(t.resolve),h=[],p=0,m=1;BQ(e,function(f){var _=p++,v=!1;m++,kQ(d,t,f).then(function(T){v||(v=!0,h[_]={status:"fulfilled",value:T},--m||i(h))},function(T){v||(v=!0,h[_]={status:"rejected",reason:T},--m||i(h))})}),--m||i(h)});return l.error&&s(l.value),r.promise}});var MQ=Gn,UQ=ti,xQ=he,FQ=pl,QQ=sp,VQ=mc,xT="No one promise resolved";Ae({target:"Promise",stat:!0},{any:function(e){var t=this,r=UQ("AggregateError"),i=FQ.f(t),s=i.resolve,l=i.reject,d=QQ(function(){var h=MQ(t.resolve),p=[],m=0,f=1,_=!1;VQ(e,function(v){var T=m++,R=!1;f++,xQ(h,t,v).then(function(w){R||_||(_=!0,s(w))},function(w){R||_||(R=!0,p[T]=w,--f||l(new r(p,xT)))})}),--f||l(new r(p,xT))});return d.error&&l(d.value),i.promise}});var FT=ZS,GQ=ti,jQ=J,HQ=oT,QT=CT;Ae({target:"Promise",proto:!0,real:!0,forced:!!FT&&u(function(){FT.prototype.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=HQ(this,GQ("Promise")),r=jQ(e);return this.then(r?function(i){return QT(t,e()).then(function(){return i})}:e,r?function(i){return QT(t,e()).then(function(){throw i})}:e)}});var VT=Ir.Promise,ct=VT,KQ=Xo.filter;Ae({target:"Array",proto:!0,forced:!Ld("filter")},{filter:function(e){return KQ(this,e,arguments.length>1?arguments[1]:void 0)}});var WQ=$r("Array").filter,YQ=L,qQ=WQ,dm=Array.prototype,kt=function(e){var t=e.filter;return e===dm||YQ(dm,e)&&t===dm.filter?qQ:t},GT={exports:{}},JQ=Ae,zQ=u,XQ=Vn,jT=Ft.f,HT=Ot,ZQ=zQ(function(){jT(1)});JQ({target:"Object",stat:!0,forced:!HT||ZQ,sham:!HT},{getOwnPropertyDescriptor:function(e,t){return jT(XQ(e),t)}});var KT=Ir.Object,$Q=GT.exports=function(e,t){return KT.getOwnPropertyDescriptor(e,t)};KT.getOwnPropertyDescriptor.sham&&($Q.sham=!0);var jt=GT.exports,t4=Xo.some;Ae({target:"Array",proto:!0,forced:!pc("some")},{some:function(e){return t4(this,e,arguments.length>1?arguments[1]:void 0)}});var e4=$r("Array").some,r4=L,n4=e4,um=Array.prototype,Ss=function(e){var t=e.some;return e===um||r4(um,e)&&t===um.some?n4:t},i4=eg.includes;Ae({target:"Array",proto:!0},{includes:function(e){return i4(this,e,arguments.length>1?arguments[1]:void 0)}});var o4=$r("Array").includes,s4=Ae,a4=vg,c4=Ln,WT=Fi,l4=Cg,d4=N("".indexOf);s4({target:"String",proto:!0,forced:!l4("includes")},{includes:function(e){return!!~d4(WT(c4(this)),WT(a4(e)),arguments.length>1?arguments[1]:void 0)}});var u4=$r("String").includes,YT=L,h4=o4,p4=u4,hm=Array.prototype,pm=String.prototype,qt=function(e){var t=e.includes;return e===hm||YT(hm,e)&&t===hm.includes?h4:typeof e=="string"||e===pm||YT(pm,e)&&t===pm.includes?p4:t},qT=N,A4=Gn,f4=Vr,g4=gn,JT=Kd,m4=A,zT=G.Function,E4=qT([].concat),_4=qT([].join),Am={},I4=function(e,t,r){if(!g4(Am,t)){for(var i=[],s=0;s<t;s++)i[s]="a["+s+"]";Am[t]=zT("C,a","return new C("+_4(i,",")+")")}return Am[t](e,r)},XT=m4?zT.bind:function(e){var t=A4(this),r=t.prototype,i=JT(arguments,1),s=function(){var l=E4(i,JT(arguments));return this instanceof s?I4(t,l.length,l):t.apply(e,l)};return f4(r)&&(s.prototype=r),s};Ae({target:"Function",proto:!0,forced:Function.bind!==XT},{bind:XT});var v4=$r("Function").bind,C4=L,S4=v4,fm=Function.prototype,Lr=function(e){var t=e.bind;return e===fm||C4(fm,e)&&t===fm.bind?S4:t};const ZT=Dg;function $T(e){const t=e&&e.navigator;if(!t.mediaDevices)return;const r=qs(e),i=function(p){var m;if(typeof p!="object"||p.mandatory||p.optional)return p;const f={};var _;return V(m=ae(p)).call(m,v=>{if(v==="require"||v==="advanced"||v==="mediaSource")return;const T=typeof p[v]=="object"?p[v]:{ideal:p[v]};T.exact!==void 0&&typeof T.exact=="number"&&(T.min=T.max=T.exact);const R=function(O,B){return O?O+B.charAt(0).toUpperCase()+rn(B).call(B,1):B==="deviceId"?"sourceId":B};if(T.ideal!==void 0){f.optional=f.optional||[];let O={};typeof T.ideal=="number"?(O[R("min",v)]=T.ideal,f.optional.push(O),O={},O[R("max",v)]=T.ideal,f.optional.push(O)):(O[R("",v)]=T.ideal,f.optional.push(O))}var w;T.exact!==void 0&&typeof T.exact!="number"?(f.mandatory=f.mandatory||{},f.mandatory[R("",v)]=T.exact):V(w=["min","max"]).call(w,O=>{T[O]!==void 0&&(f.mandatory=f.mandatory||{},f.mandatory[R(O,v)]=T[O])})}),p.advanced&&(f.optional=k(_=f.optional||[]).call(_,p.advanced)),f},s=function(p,m){if(r.version>=61)return m(p);if((p=JSON.parse(St(p)))&&typeof p.audio=="object"){const f=function(_,v,T){v in _&&!(T in _)&&(_[T]=_[v],delete _[v])};f((p=JSON.parse(St(p))).audio,"autoGainControl","googAutoGainControl"),f(p.audio,"noiseSuppression","googNoiseSuppression"),p.audio=i(p.audio)}if(p&&typeof p.video=="object"){let f=p.video.facingMode;f=f&&(typeof f=="object"?f:{ideal:f});const _=r.version<66;if(f&&(f.exact==="user"||f.exact==="environment"||f.ideal==="user"||f.ideal==="environment")&&(!t.mediaDevices.getSupportedConstraints||!t.mediaDevices.getSupportedConstraints().facingMode||_)){let v;if(delete p.video.facingMode,f.exact==="environment"||f.ideal==="environment"?v=["back","rear"]:f.exact!=="user"&&f.ideal!=="user"||(v=["front"]),v)return t.mediaDevices.enumerateDevices().then(T=>{T=kt(T).call(T,w=>w.kind==="videoinput");let R=ft(T).call(T,w=>Ss(v).call(v,O=>{var B;return qt(B=w.label.toLowerCase()).call(B,O)}));return!R&&T.length&&qt(v).call(v,"back")&&(R=T[T.length-1]),R&&(p.video.deviceId=f.exact?{exact:R.deviceId}:{ideal:R.deviceId}),p.video=i(p.video),ZT("chrome: "+St(p)),m(p)})}p.video=i(p.video)}return ZT("chrome: "+St(p)),m(p)},l=function(p){return r.version>=64?p:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[p.name]||p.name,message:p.message,constraint:p.constraint||p.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},d=function(p,m,f){s(p,_=>{t.webkitGetUserMedia(_,m,v=>{f&&f(l(v))})})};if(t.getUserMedia=Lr(d).call(d,t),t.mediaDevices.getUserMedia){var h;const p=Lr(h=t.mediaDevices.getUserMedia).call(h,t.mediaDevices);t.mediaDevices.getUserMedia=function(m){return s(m,f=>p(f).then(_=>{var v;if(f.audio&&!_.getAudioTracks().length||f.video&&!_.getVideoTracks().length)throw V(v=_.getTracks()).call(v,T=>{T.stop()}),new DOMException("","NotFoundError");return _},_=>ct.reject(l(_))))}}}function t1(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function e1(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){ie(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(r){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=r)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{var i;r.stream.addEventListener("addtrack",s=>{let l;var d;e.RTCPeerConnection.prototype.getReceivers?l=ft(d=this.getReceivers()).call(d,p=>p.track&&p.track.id===s.track.id):l={track:s.track};const h=new Event("track");h.track=s.track,h.receiver=l,h.transceiver={receiver:l},h.streams=[r.stream],this.dispatchEvent(h)}),V(i=r.stream.getTracks()).call(i,s=>{let l;var d;e.RTCPeerConnection.prototype.getReceivers?l=ft(d=this.getReceivers()).call(d,p=>p.track&&p.track.id===s.id):l={track:s};const h=new Event("track");h.track=s,h.receiver=l,h.transceiver={receiver:l},h.streams=[r.stream],this.dispatchEvent(h)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else dl(e,"track",t=>(t.transceiver||ie(t,"transceiver",{value:{receiver:t.receiver}}),t))}function r1(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(s,l){return{track:l,get dtmf(){return this._dtmf===void 0&&(l.kind==="audio"?this._dtmf=s.createDTMFSender(l):this._dtmf=null),this._dtmf},_pc:s}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){var d;return this._senders=this._senders||[],rn(d=this._senders).call(d)};const s=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(d,h){let p=s.apply(this,arguments);return p||(p=t(this,d),this._senders.push(p)),p};const l=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(d){var h;l.apply(this,arguments);const p=xt(h=this._senders).call(h,d);var m;p!==-1&&Ye(m=this._senders).call(m,p,1)}}const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(s){var l;this._senders=this._senders||[],r.apply(this,[s]),V(l=s.getTracks()).call(l,d=>{this._senders.push(t(this,d))})};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(s){var l;this._senders=this._senders||[],i.apply(this,[s]),V(l=s.getTracks()).call(l,d=>{var h;const p=ft(h=this._senders).call(h,_=>_.track===d);var m,f;p&&Ye(m=this._senders).call(m,xt(f=this._senders).call(f,p),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const r=t.apply(this,[]);return V(r).call(r,i=>i._pc=this),r},ie(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function n1(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[r,i,s]=arguments;if(arguments.length>0&&typeof r=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof r!="function"))return t.apply(this,[]);const l=function(h){const p={},m=h.result();return V(m).call(m,f=>{var _;const v={id:f.id,timestamp:f.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[f.type]||f.type};V(_=f.names()).call(_,T=>{v[T]=f.stat(T)}),p[v.id]=v}),p},d=function(h){var p;return new $t(pt(p=ae(h)).call(p,m=>[m,h[m]]))};if(arguments.length>=2){const h=function(p){i(d(l(p)))};return t.apply(this,[h,r])}return new ct((h,p)=>{t.apply(this,[function(m){h(d(l(m)))},p])}).then(i,s)}}function i1(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const r=e.RTCPeerConnection.prototype.getSenders;r&&(e.RTCPeerConnection.prototype.getSenders=function(){const s=r.apply(this,[]);return V(s).call(s,l=>l._pc=this),s});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const s=i.apply(this,arguments);return s._pc=this,s}),e.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(l=>jS(l,s.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){const i=r.apply(this,[]);return V(i).call(i,s=>s._pc=this),i}),dl(e,"track",i=>(i.receiver._pc=i.srcElement,i)),e.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(s=>jS(s,i.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var r,i;const s=arguments[0];let l,d,h;return V(r=this.getSenders()).call(r,p=>{p.track===s&&(l?h=!0:l=p)}),V(i=this.getReceivers()).call(i,p=>(p.track===s&&(d?h=!0:d=p),p.track===s)),h||l&&d?ct.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):l?l.getStats():d?d.getStats():ct.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function o1(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var l;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},pt(l=ae(this._shimmedLocalStreams)).call(l,d=>this._shimmedLocalStreams[d][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(l,d){var h;if(!d)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const p=t.apply(this,arguments);return this._shimmedLocalStreams[d.id]?xt(h=this._shimmedLocalStreams[d.id]).call(h,p)===-1&&this._shimmedLocalStreams[d.id].push(p):this._shimmedLocalStreams[d.id]=[d,p],p};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(l){var d,h,p;this._shimmedLocalStreams=this._shimmedLocalStreams||{},V(d=l.getTracks()).call(d,_=>{var v;if(ft(v=this.getSenders()).call(v,T=>T.track===_))throw new DOMException("Track already exists.","InvalidAccessError")});const m=this.getSenders();r.apply(this,arguments);const f=kt(h=this.getSenders()).call(h,_=>xt(m).call(m,_)===-1);this._shimmedLocalStreams[l.id]=k(p=[l]).call(p,f)};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(l){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[l.id],i.apply(this,arguments)};const s=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(l){var d;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},l&&V(d=ae(this._shimmedLocalStreams)).call(d,h=>{var p;const m=xt(p=this._shimmedLocalStreams[h]).call(p,l);var f;m!==-1&&Ye(f=this._shimmedLocalStreams[h]).call(f,m,1),this._shimmedLocalStreams[h].length===1&&delete this._shimmedLocalStreams[h]}),s.apply(this,arguments)}}function s1(e){var t;if(!e.RTCPeerConnection)return;const r=qs(e);if(e.RTCPeerConnection.prototype.addTrack&&r.version>=65)return o1(e);const i=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const f=i.apply(this);return this._reverseStreams=this._reverseStreams||{},pt(f).call(f,_=>this._reverseStreams[_.id])};const s=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(f){var _;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},V(_=f.getTracks()).call(_,v=>{var T;if(ft(T=this.getSenders()).call(T,R=>R.track===v))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[f.id]){const v=new e.MediaStream(f.getTracks());this._streams[f.id]=v,this._reverseStreams[v.id]=f,f=v}s.apply(this,[f])};const l=e.RTCPeerConnection.prototype.removeStream;function d(f,_){var v;let T=_.sdp;return V(v=ae(f._reverseStreams||[])).call(v,R=>{const w=f._reverseStreams[R],O=f._streams[w.id];T=T.replace(new RegExp(O.id,"g"),w.id)}),new RTCSessionDescription({type:_.type,sdp:T})}function h(f,_){var v;let T=_.sdp;return V(v=ae(f._reverseStreams||[])).call(v,R=>{const w=f._reverseStreams[R],O=f._streams[w.id];T=T.replace(new RegExp(w.id,"g"),O.id)}),new RTCSessionDescription({type:_.type,sdp:T})}e.RTCPeerConnection.prototype.removeStream=function(f){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},l.apply(this,[this._streams[f.id]||f]),delete this._reverseStreams[this._streams[f.id]?this._streams[f.id].id:f.id],delete this._streams[f.id]},e.RTCPeerConnection.prototype.addTrack=function(f,_){var v,T,R;if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const w=rn([]).call(arguments,1);if(w.length!==1||!ft(v=w[0].getTracks()).call(v,K=>K===f))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(ft(T=this.getSenders()).call(T,K=>K.track===f))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const B=this._streams[_.id];if(B)B.addTrack(f),ct.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const K=new e.MediaStream([f]);this._streams[_.id]=K,this._reverseStreams[K.id]=_,this.addStream(K)}return ft(R=this.getSenders()).call(R,K=>K.track===f)},V(t=["createOffer","createAnswer"]).call(t,function(f){const _=e.RTCPeerConnection.prototype[f],v={[f](){const T=arguments;return arguments.length&&typeof arguments[0]=="function"?_.apply(this,[R=>{const w=d(this,R);T[0].apply(null,[w])},R=>{T[1]&&T[1].apply(null,R)},arguments[2]]):_.apply(this,arguments).then(R=>d(this,R))}};e.RTCPeerConnection.prototype[f]=v[f]});const p=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=h(this,arguments[0]),p.apply(this,arguments)):p.apply(this,arguments)};const m=jt(e.RTCPeerConnection.prototype,"localDescription");ie(e.RTCPeerConnection.prototype,"localDescription",{get(){const f=m.get.apply(this);return f.type===""?f:d(this,f)}}),e.RTCPeerConnection.prototype.removeTrack=function(f){var _;if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!f._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(f._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let v;this._streams=this._streams||{},V(_=ae(this._streams)).call(_,T=>{var R;ft(R=this._streams[T].getTracks()).call(R,w=>f.track===w)&&(v=this._streams[T])}),v&&(v.getTracks().length===1?this.removeStream(this._reverseStreams[v.id]):v.removeTrack(f.track),this.dispatchEvent(new Event("negotiationneeded")))}}function gm(e){const t=qs(e);if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),!e.RTCPeerConnection)return;var r;t.version<53&&V(r=["setLocalDescription","setRemoteDescription","addIceCandidate"]).call(r,function(s){const l=e.RTCPeerConnection.prototype[s],d={[s](){return arguments[0]=new(s==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),l.apply(this,arguments)}};e.RTCPeerConnection.prototype[s]=d[s]});const i=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?t.version<78&&arguments[0]&&arguments[0].candidate===""?ct.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),ct.resolve())}}function a1(e){dl(e,"negotiationneeded",t=>{if(t.target.signalingState==="stable")return t})}var c1=Object.freeze({__proto__:null,shimMediaStream:t1,shimOnTrack:e1,shimGetSendersWithDtmf:r1,shimGetStats:n1,shimSenderReceiverGetStats:i1,shimAddTrackRemoveTrackWithNative:o1,shimAddTrackRemoveTrack:s1,shimPeerConnection:gm,fixNegotiationNeeded:a1,shimGetUserMedia:$T,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then(i=>{const s=r.video&&r.video.width,l=r.video&&r.video.height,d=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:d||3}},s&&(r.video.mandatory.maxWidth=s),l&&(r.video.mandatory.maxHeight=l),e.navigator.mediaDevices.getUserMedia(r)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}}),T4=Ae,l1=N,R4=Ph,d1=Fi,y4=vg,w4=Ln,b4=Cg,u1=l1("".startsWith),N4=l1("".slice),O4=Math.min;T4({target:"String",proto:!0,forced:!b4("startsWith")},{startsWith:function(e){var t=d1(w4(this));y4(e);var r=R4(O4(arguments.length>1?arguments[1]:void 0,t.length)),i=d1(e);return u1?u1(t,i,r):N4(t,r,r+i.length)===i}});var k4=$r("String").startsWith,D4=L,L4=k4,mm=String.prototype,ml=function(e){var t=e.startsWith;return typeof e=="string"||e===mm||D4(mm,e)&&t===mm.startsWith?L4:t},P4=BC.PROPER,B4=u,h1=cC,M4=dC.trim;Ae({target:"String",proto:!0,forced:function(e){return B4(function(){return!!h1[e]()||"\u200B\x85\u180E"[e]()!=="\u200B\x85\u180E"||P4&&h1[e].name!==e})}("trim")},{trim:function(){return M4(this)}});var U4=$r("String").trim,x4=L,F4=U4,Em=String.prototype,Ic=function(e){var t=e.trim;return typeof e=="string"||e===Em||x4(Em,e)&&t===Em.trim?F4:t},_m={exports:{}};(function(e){var t={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};t.localCName=t.generateIdentifier(),t.splitLines=function(r){var i;return pt(i=Ic(r).call(r).split(`
`)).call(i,function(s){return Ic(s).call(s)})},t.splitSections=function(r){var i=r.split(`
m=`);return pt(i).call(i,function(s,l){var d;return Ic(d=l>0?"m="+s:s).call(d)+`\r
`})},t.getDescription=function(r){var i=t.splitSections(r);return i&&i[0]},t.getMediaSections=function(r){var i=t.splitSections(r);return i.shift(),i},t.matchPrefix=function(r,i){var s;return kt(s=t.splitLines(r)).call(s,function(l){return xt(l).call(l,i)===0})},t.parseCandidate=function(r){for(var i,s={foundation:(i=xt(r).call(r,"a=candidate:")===0?r.substring(12).split(" "):r.substring(10).split(" "))[0],component:Tr(i[1],10),protocol:i[2].toLowerCase(),priority:Tr(i[3],10),ip:i[4],address:i[4],port:Tr(i[5],10),type:i[7]},l=8;l<i.length;l+=2)switch(i[l]){case"raddr":s.relatedAddress=i[l+1];break;case"rport":s.relatedPort=Tr(i[l+1],10);break;case"tcptype":s.tcpType=i[l+1];break;case"ufrag":s.ufrag=i[l+1],s.usernameFragment=i[l+1];break;default:s[i[l]]=i[l+1]}return s},t.writeCandidate=function(r){var i=[];i.push(r.foundation),i.push(r.component),i.push(r.protocol.toUpperCase()),i.push(r.priority),i.push(r.address||r.ip),i.push(r.port);var s=r.type;return i.push("typ"),i.push(s),s!=="host"&&r.relatedAddress&&r.relatedPort&&(i.push("raddr"),i.push(r.relatedAddress),i.push("rport"),i.push(r.relatedPort)),r.tcpType&&r.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(r.tcpType)),(r.usernameFragment||r.ufrag)&&(i.push("ufrag"),i.push(r.usernameFragment||r.ufrag)),"candidate:"+i.join(" ")},t.parseIceOptions=function(r){return r.substr(14).split(" ")},t.parseRtpMap=function(r){var i=r.substr(9).split(" "),s={payloadType:Tr(i.shift(),10)};return i=i[0].split("/"),s.name=i[0],s.clockRate=Tr(i[1],10),s.channels=i.length===3?Tr(i[2],10):1,s.numChannels=s.channels,s},t.writeRtpMap=function(r){var i=r.payloadType;r.preferredPayloadType!==void 0&&(i=r.preferredPayloadType);var s=r.channels||r.numChannels||1;return"a=rtpmap:"+i+" "+r.name+"/"+r.clockRate+(s!==1?"/"+s:"")+`\r
`},t.parseExtmap=function(r){var i,s=r.substr(9).split(" ");return{id:Tr(s[0],10),direction:xt(i=s[0]).call(i,"/")>0?s[0].split("/")[1]:"sendrecv",uri:s[1]}},t.writeExtmap=function(r){return"a=extmap:"+(r.id||r.preferredId)+(r.direction&&r.direction!=="sendrecv"?"/"+r.direction:"")+" "+r.uri+`\r
`},t.parseFmtp=function(r){for(var i,s={},l=r.substr(xt(r).call(r," ")+1).split(";"),d=0;d<l.length;d++){var h,p;i=Ic(h=l[d]).call(h).split("="),s[Ic(p=i[0]).call(p)]=i[1]}return s},t.writeFmtp=function(r){var i="",s=r.payloadType;if(r.preferredPayloadType!==void 0&&(s=r.preferredPayloadType),r.parameters&&ae(r.parameters).length){var l,d=[];V(l=ae(r.parameters)).call(l,function(h){r.parameters[h]?d.push(h+"="+r.parameters[h]):d.push(h)}),i+="a=fmtp:"+s+" "+d.join(";")+`\r
`}return i},t.parseRtcpFb=function(r){var i=r.substr(xt(r).call(r," ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},t.writeRtcpFb=function(r){var i,s="",l=r.payloadType;return r.preferredPayloadType!==void 0&&(l=r.preferredPayloadType),r.rtcpFeedback&&r.rtcpFeedback.length&&V(i=r.rtcpFeedback).call(i,function(d){s+="a=rtcp-fb:"+l+" "+d.type+(d.parameter&&d.parameter.length?" "+d.parameter:"")+`\r
`}),s},t.parseSsrcMedia=function(r){var i=xt(r).call(r," "),s={ssrc:Tr(r.substr(7,i-7),10)},l=xt(r).call(r,":",i);return l>-1?(s.attribute=r.substr(i+1,l-i-1),s.value=r.substr(l+1)):s.attribute=r.substr(i+1),s},t.parseSsrcGroup=function(r){var i=r.substr(13).split(" ");return{semantics:i.shift(),ssrcs:pt(i).call(i,function(s){return Tr(s,10)})}},t.getMid=function(r){var i=t.matchPrefix(r,"a=mid:")[0];if(i)return i.substr(6)},t.parseFingerprint=function(r){var i=r.substr(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1]}},t.getDtlsParameters=function(r,i){var s=t.matchPrefix(r+i,"a=fingerprint:");return{role:"auto",fingerprints:pt(s).call(s,t.parseFingerprint)}},t.writeDtlsParameters=function(r,i){var s,l="a=setup:"+i+`\r
`;return V(s=r.fingerprints).call(s,function(d){l+="a=fingerprint:"+d.algorithm+" "+d.value+`\r
`}),l},t.getIceParameters=function(r,i){var s=t.splitLines(r);return s=k(s).call(s,t.splitLines(i)),{usernameFragment:kt(s).call(s,function(l){return xt(l).call(l,"a=ice-ufrag:")===0})[0].substr(12),password:kt(s).call(s,function(l){return xt(l).call(l,"a=ice-pwd:")===0})[0].substr(10)}},t.writeIceParameters=function(r){return"a=ice-ufrag:"+r.usernameFragment+`\r
a=ice-pwd:`+r.password+`\r
`},t.parseRtpParameters=function(r){for(var i,s={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},l=t.splitLines(r)[0].split(" "),d=3;d<l.length;d++){var h=l[d],p=t.matchPrefix(r,"a=rtpmap:"+h+" ")[0];if(p){var m,f=t.parseRtpMap(p),_=t.matchPrefix(r,"a=fmtp:"+h+" ");switch(f.parameters=_.length?t.parseFmtp(_[0]):{},f.rtcpFeedback=pt(m=t.matchPrefix(r,"a=rtcp-fb:"+h+" ")).call(m,t.parseRtcpFb),s.codecs.push(f),f.name.toUpperCase()){case"RED":case"ULPFEC":s.fecMechanisms.push(f.name.toUpperCase())}}}return V(i=t.matchPrefix(r,"a=extmap:")).call(i,function(v){s.headerExtensions.push(t.parseExtmap(v))}),s},t.writeRtpDescription=function(r,i){var s,l,d,h="";h+="m="+r+" ",h+=i.codecs.length>0?"9":"0",h+=" UDP/TLS/RTP/SAVPF ",h+=pt(s=i.codecs).call(s,function(f){return f.preferredPayloadType!==void 0?f.preferredPayloadType:f.payloadType}).join(" ")+`\r
`,h+=`c=IN IP4 0.0.0.0\r
`,h+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,V(l=i.codecs).call(l,function(f){h+=t.writeRtpMap(f),h+=t.writeFmtp(f),h+=t.writeRtcpFb(f)});var p,m=0;return V(d=i.codecs).call(d,function(f){f.maxptime>m&&(m=f.maxptime)}),m>0&&(h+="a=maxptime:"+m+`\r
`),h+=`a=rtcp-mux\r
`,i.headerExtensions&&V(p=i.headerExtensions).call(p,function(f){h+=t.writeExtmap(f)}),h},t.parseRtpEncodingParameters=function(r){var i,s,l,d,h,p,m,f=[],_=t.parseRtpParameters(r),v=xt(i=_.fecMechanisms).call(i,"RED")!==-1,T=xt(s=_.fecMechanisms).call(s,"ULPFEC")!==-1,R=kt(l=pt(d=t.matchPrefix(r,"a=ssrc:")).call(d,function(nt){return t.parseSsrcMedia(nt)})).call(l,function(nt){return nt.attribute==="cname"}),w=R.length>0&&R[0].ssrc,O=pt(h=t.matchPrefix(r,"a=ssrc-group:FID")).call(h,function(nt){var It=nt.substr(17).split(" ");return pt(It).call(It,function(vt){return Tr(vt,10)})});O.length>0&&O[0].length>1&&O[0][0]===w&&(m=O[0][1]),V(p=_.codecs).call(p,function(nt){if(nt.name.toUpperCase()==="RTX"&&nt.parameters.apt){var It={ssrc:w,codecPayloadType:Tr(nt.parameters.apt,10)};w&&m&&(It.rtx={ssrc:m}),f.push(It),v&&((It=JSON.parse(St(It))).fec={ssrc:w,mechanism:T?"red+ulpfec":"red"},f.push(It))}}),f.length===0&&w&&f.push({ssrc:w});var B,K,j=t.matchPrefix(r,"b=");return j.length&&(j=xt(B=j[0]).call(B,"b=TIAS:")===0?Tr(j[0].substr(7),10):xt(K=j[0]).call(K,"b=AS:")===0?1e3*Tr(j[0].substr(5),10)*.95-16e3:void 0,V(f).call(f,function(nt){nt.maxBitrate=j})),f},t.parseRtcpParameters=function(r){var i,s,l={},d=kt(i=pt(s=t.matchPrefix(r,"a=ssrc:")).call(s,function(m){return t.parseSsrcMedia(m)})).call(i,function(m){return m.attribute==="cname"})[0];d&&(l.cname=d.value,l.ssrc=d.ssrc);var h=t.matchPrefix(r,"a=rtcp-rsize");l.reducedSize=h.length>0,l.compound=h.length===0;var p=t.matchPrefix(r,"a=rtcp-mux");return l.mux=p.length>0,l},t.parseMsid=function(r){var i,s,l,d=t.matchPrefix(r,"a=msid:");if(d.length===1)return{stream:(l=d[0].substr(7).split(" "))[0],track:l[1]};var h=kt(i=pt(s=t.matchPrefix(r,"a=ssrc:")).call(s,function(p){return t.parseSsrcMedia(p)})).call(i,function(p){return p.attribute==="msid"});return h.length>0?{stream:(l=h[0].value.split(" "))[0],track:l[1]}:void 0},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(r,i,s){var l=i!==void 0?i:2;return`v=0\r
o=`+(s||"thisisadapterortc")+" "+(r||t.generateSessionId())+" "+l+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.writeMediaSection=function(r,i,s,l){var d=t.writeRtpDescription(r.kind,i);if(d+=t.writeIceParameters(r.iceGatherer.getLocalParameters()),d+=t.writeDtlsParameters(r.dtlsTransport.getLocalParameters(),s==="offer"?"actpass":"active"),d+="a=mid:"+r.mid+`\r
`,r.direction?d+="a="+r.direction+`\r
`:r.rtpSender&&r.rtpReceiver?d+=`a=sendrecv\r
`:r.rtpSender?d+=`a=sendonly\r
`:r.rtpReceiver?d+=`a=recvonly\r
`:d+=`a=inactive\r
`,r.rtpSender){var h="msid:"+l.id+" "+r.rtpSender.track.id+`\r
`;d+="a="+h,d+="a=ssrc:"+r.sendEncodingParameters[0].ssrc+" "+h,r.sendEncodingParameters[0].rtx&&(d+="a=ssrc:"+r.sendEncodingParameters[0].rtx.ssrc+" "+h,d+="a=ssrc-group:FID "+r.sendEncodingParameters[0].ssrc+" "+r.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return d+="a=ssrc:"+r.sendEncodingParameters[0].ssrc+" cname:"+t.localCName+`\r
`,r.rtpSender&&r.sendEncodingParameters[0].rtx&&(d+="a=ssrc:"+r.sendEncodingParameters[0].rtx.ssrc+" cname:"+t.localCName+`\r
`),d},t.getDirection=function(r,i){for(var s=t.splitLines(r),l=0;l<s.length;l++)switch(s[l]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return s[l].substr(2)}return i?t.getDirection(i):"sendrecv"},t.getKind=function(r){return t.splitLines(r)[0].split(" ")[0].substr(2)},t.isRejected=function(r){return r.split(" ",2)[1]==="0"},t.parseMLine=function(r){var i=t.splitLines(r)[0].substr(2).split(" ");return{kind:i[0],port:Tr(i[1],10),protocol:i[2],fmt:rn(i).call(i,3).join(" ")}},t.parseOLine=function(r){var i=t.matchPrefix(r,"o=")[0].substr(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:Tr(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},t.isValidSDP=function(r){if(typeof r!="string"||r.length===0)return!1;for(var i=t.splitLines(r),s=0;s<i.length;s++)if(i[s].length<2||i[s].charAt(1)!=="=")return!1;return!0},e.exports=t})(_m);var hp=_m.exports,Ee=_m.exports;function p1(e,t,r,i,s){var l=Ee.writeRtpDescription(e.kind,t);if(l+=Ee.writeIceParameters(e.iceGatherer.getLocalParameters()),l+=Ee.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),r==="offer"?"actpass":s||"active"),l+="a=mid:"+e.mid+`\r
`,e.rtpSender&&e.rtpReceiver?l+=`a=sendrecv\r
`:e.rtpSender?l+=`a=sendonly\r
`:e.rtpReceiver?l+=`a=recvonly\r
`:l+=`a=inactive\r
`,e.rtpSender){var d=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=d;var h="msid:"+(i?i.id:"-")+" "+d+`\r
`;l+="a="+h,l+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+h,e.sendEncodingParameters[0].rtx&&(l+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+h,l+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return l+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+Ee.localCName+`\r
`,e.rtpSender&&e.sendEncodingParameters[0].rtx&&(l+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+Ee.localCName+`\r
`),l}function pp(e,t){var r={codecs:[],headerExtensions:[],fecMechanisms:[]},i=function(l,d){l=parseInt(l,10);for(var h=0;h<d.length;h++)if(d[h].payloadType===l||d[h].preferredPayloadType===l)return d[h]},s=function(l,d,h,p){var m=i(l.parameters.apt,h),f=i(d.parameters.apt,p);return m&&f&&m.name.toLowerCase()===f.name.toLowerCase()};return e.codecs.forEach(function(l){for(var d=0;d<t.codecs.length;d++){var h=t.codecs[d];if(l.name.toLowerCase()===h.name.toLowerCase()&&l.clockRate===h.clockRate){if(l.name.toLowerCase()==="rtx"&&l.parameters&&h.parameters.apt&&!s(l,h,e.codecs,t.codecs))continue;(h=JSON.parse(JSON.stringify(h))).numChannels=Math.min(l.numChannels,h.numChannels),r.codecs.push(h),h.rtcpFeedback=h.rtcpFeedback.filter(function(p){for(var m=0;m<l.rtcpFeedback.length;m++)if(l.rtcpFeedback[m].type===p.type&&l.rtcpFeedback[m].parameter===p.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(l){for(var d=0;d<t.headerExtensions.length;d++){var h=t.headerExtensions[d];if(l.uri===h.uri){r.headerExtensions.push(h);break}}}),r}function A1(e,t,r){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(r)!==-1}function Im(e,t){var r=e.getRemoteCandidates().find(function(i){return t.foundation===i.foundation&&t.ip===i.ip&&t.port===i.port&&t.priority===i.priority&&t.protocol===i.protocol&&t.type===i.type});return r||e.addRemoteCandidate(t),!r}function di(e,t){var r=new Error(t);return r.name=e,r.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],r}var Q4=function(e,t){function r(d,h){h.addTrack(d),h.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:d}))}function i(d,h,p,m){var f=new Event("track");f.track=h,f.receiver=p,f.transceiver={receiver:p},f.streams=m,e.setTimeout(function(){d._dispatchEvent("track",f)})}var s=function(d){var h=this,p=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(f){h[f]=p[f].bind(p)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",d=JSON.parse(JSON.stringify(d||{})),this.usingBundle=d.bundlePolicy==="max-bundle",d.rtcpMuxPolicy==="negotiate")throw di("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(d.rtcpMuxPolicy||(d.rtcpMuxPolicy="require"),d.iceTransportPolicy){case"all":case"relay":break;default:d.iceTransportPolicy="all"}switch(d.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:d.bundlePolicy="balanced"}if(d.iceServers=function(f,_){var v=!1;return(f=JSON.parse(JSON.stringify(f))).filter(function(T){if(T&&(T.urls||T.url)){var R=T.urls||T.url;T.url&&!T.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var w=typeof R=="string";return w&&(R=[R]),R=R.filter(function(O){return O.indexOf("turn:")!==0||O.indexOf("transport=udp")===-1||O.indexOf("turn:[")!==-1||v?O.indexOf("stun:")===0&&_>=14393&&O.indexOf("?transport=udp")===-1:(v=!0,!0)}),delete T.url,T.urls=w?R[0]:R,!!R.length}})}(d.iceServers||[],t),this._iceGatherers=[],d.iceCandidatePoolSize)for(var m=d.iceCandidatePoolSize;m>0;m--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:d.iceServers,gatherPolicy:d.iceTransportPolicy}));else d.iceCandidatePoolSize=0;this._config=d,this.transceivers=[],this._sdpSessionId=Ee.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(s.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(s.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),s.prototype.onicecandidate=null,s.prototype.onaddstream=null,s.prototype.ontrack=null,s.prototype.onremovestream=null,s.prototype.onsignalingstatechange=null,s.prototype.oniceconnectionstatechange=null,s.prototype.onconnectionstatechange=null,s.prototype.onicegatheringstatechange=null,s.prototype.onnegotiationneeded=null,s.prototype.ondatachannel=null,s.prototype._dispatchEvent=function(d,h){this._isClosed||(this.dispatchEvent(h),typeof this["on"+d]=="function"&&this["on"+d](h))},s.prototype._emitGatheringStateChange=function(){var d=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",d)},s.prototype.getConfiguration=function(){return this._config},s.prototype.getLocalStreams=function(){return this.localStreams},s.prototype.getRemoteStreams=function(){return this.remoteStreams},s.prototype._createTransceiver=function(d,h){var p=this.transceivers.length>0,m={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:d,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&p)m.iceTransport=this.transceivers[0].iceTransport,m.dtlsTransport=this.transceivers[0].dtlsTransport;else{var f=this._createIceAndDtlsTransports();m.iceTransport=f.iceTransport,m.dtlsTransport=f.dtlsTransport}return h||this.transceivers.push(m),m},s.prototype.addTrack=function(d,h){if(this._isClosed)throw di("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var p;if(this.transceivers.find(function(f){return f.track===d}))throw di("InvalidAccessError","Track already exists.");for(var m=0;m<this.transceivers.length;m++)this.transceivers[m].track||this.transceivers[m].kind!==d.kind||(p=this.transceivers[m]);return p||(p=this._createTransceiver(d.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(h)===-1&&this.localStreams.push(h),p.track=d,p.stream=h,p.rtpSender=new e.RTCRtpSender(d,p.dtlsTransport),p.rtpSender},s.prototype.addStream=function(d){var h=this;if(t>=15025)d.getTracks().forEach(function(m){h.addTrack(m,d)});else{var p=d.clone();d.getTracks().forEach(function(m,f){var _=p.getTracks()[f];m.addEventListener("enabled",function(v){_.enabled=v.enabled})}),p.getTracks().forEach(function(m){h.addTrack(m,p)})}},s.prototype.removeTrack=function(d){if(this._isClosed)throw di("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(d instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var h=this.transceivers.find(function(m){return m.rtpSender===d});if(!h)throw di("InvalidAccessError","Sender was not created by this connection.");var p=h.stream;h.rtpSender.stop(),h.rtpSender=null,h.track=null,h.stream=null,this.transceivers.map(function(m){return m.stream}).indexOf(p)===-1&&this.localStreams.indexOf(p)>-1&&this.localStreams.splice(this.localStreams.indexOf(p),1),this._maybeFireNegotiationNeeded()},s.prototype.removeStream=function(d){var h=this;d.getTracks().forEach(function(p){var m=h.getSenders().find(function(f){return f.track===p});m&&h.removeTrack(m)})},s.prototype.getSenders=function(){return this.transceivers.filter(function(d){return!!d.rtpSender}).map(function(d){return d.rtpSender})},s.prototype.getReceivers=function(){return this.transceivers.filter(function(d){return!!d.rtpReceiver}).map(function(d){return d.rtpReceiver})},s.prototype._createIceGatherer=function(d,h){var p=this;if(h&&d>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var m=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(m,"state",{value:"new",writable:!0}),this.transceivers[d].bufferedCandidateEvents=[],this.transceivers[d].bufferCandidates=function(f){var _=!f.candidate||Object.keys(f.candidate).length===0;m.state=_?"completed":"gathering",p.transceivers[d].bufferedCandidateEvents!==null&&p.transceivers[d].bufferedCandidateEvents.push(f)},m.addEventListener("localcandidate",this.transceivers[d].bufferCandidates),m},s.prototype._gather=function(d,h){var p=this,m=this.transceivers[h].iceGatherer;if(!m.onlocalcandidate){var f=this.transceivers[h].bufferedCandidateEvents;this.transceivers[h].bufferedCandidateEvents=null,m.removeEventListener("localcandidate",this.transceivers[h].bufferCandidates),m.onlocalcandidate=function(_){if(!(p.usingBundle&&h>0)){var v=new Event("icecandidate");v.candidate={sdpMid:d,sdpMLineIndex:h};var T=_.candidate,R=!T||Object.keys(T).length===0;if(R)m.state!=="new"&&m.state!=="gathering"||(m.state="completed");else{m.state==="new"&&(m.state="gathering"),T.component=1,T.ufrag=m.getLocalParameters().usernameFragment;var w=Ee.writeCandidate(T);v.candidate=Object.assign(v.candidate,Ee.parseCandidate(w)),v.candidate.candidate=w,v.candidate.toJSON=function(){return{candidate:v.candidate.candidate,sdpMid:v.candidate.sdpMid,sdpMLineIndex:v.candidate.sdpMLineIndex,usernameFragment:v.candidate.usernameFragment}}}var O=Ee.getMediaSections(p._localDescription.sdp);O[v.candidate.sdpMLineIndex]+=R?`a=end-of-candidates\r
`:"a="+v.candidate.candidate+`\r
`,p._localDescription.sdp=Ee.getDescription(p._localDescription.sdp)+O.join("");var B=p.transceivers.every(function(K){return K.iceGatherer&&K.iceGatherer.state==="completed"});p.iceGatheringState!=="gathering"&&(p.iceGatheringState="gathering",p._emitGatheringStateChange()),R||p._dispatchEvent("icecandidate",v),B&&(p._dispatchEvent("icecandidate",new Event("icecandidate")),p.iceGatheringState="complete",p._emitGatheringStateChange())}},e.setTimeout(function(){f.forEach(function(_){m.onlocalcandidate(_)})},0)}},s.prototype._createIceAndDtlsTransports=function(){var d=this,h=new e.RTCIceTransport(null);h.onicestatechange=function(){d._updateIceConnectionState(),d._updateConnectionState()};var p=new e.RTCDtlsTransport(h);return p.ondtlsstatechange=function(){d._updateConnectionState()},p.onerror=function(){Object.defineProperty(p,"state",{value:"failed",writable:!0}),d._updateConnectionState()},{iceTransport:h,dtlsTransport:p}},s.prototype._disposeIceAndDtlsTransports=function(d){var h=this.transceivers[d].iceGatherer;h&&(delete h.onlocalcandidate,delete this.transceivers[d].iceGatherer);var p=this.transceivers[d].iceTransport;p&&(delete p.onicestatechange,delete this.transceivers[d].iceTransport);var m=this.transceivers[d].dtlsTransport;m&&(delete m.ondtlsstatechange,delete m.onerror,delete this.transceivers[d].dtlsTransport)},s.prototype._transceive=function(d,h,p){var m=pp(d.localCapabilities,d.remoteCapabilities);h&&d.rtpSender&&(m.encodings=d.sendEncodingParameters,m.rtcp={cname:Ee.localCName,compound:d.rtcpParameters.compound},d.recvEncodingParameters.length&&(m.rtcp.ssrc=d.recvEncodingParameters[0].ssrc),d.rtpSender.send(m)),p&&d.rtpReceiver&&m.codecs.length>0&&(d.kind==="video"&&d.recvEncodingParameters&&t<15019&&d.recvEncodingParameters.forEach(function(f){delete f.rtx}),d.recvEncodingParameters.length?m.encodings=d.recvEncodingParameters:m.encodings=[{}],m.rtcp={compound:d.rtcpParameters.compound},d.rtcpParameters.cname&&(m.rtcp.cname=d.rtcpParameters.cname),d.sendEncodingParameters.length&&(m.rtcp.ssrc=d.sendEncodingParameters[0].ssrc),d.rtpReceiver.receive(m))},s.prototype.setLocalDescription=function(d){var h,p,m=this;if(["offer","answer"].indexOf(d.type)===-1)return Promise.reject(di("TypeError",'Unsupported type "'+d.type+'"'));if(!A1("setLocalDescription",d.type,m.signalingState)||m._isClosed)return Promise.reject(di("InvalidStateError","Can not set local "+d.type+" in state "+m.signalingState));if(d.type==="offer")h=Ee.splitSections(d.sdp),p=h.shift(),h.forEach(function(_,v){var T=Ee.parseRtpParameters(_);m.transceivers[v].localCapabilities=T}),m.transceivers.forEach(function(_,v){m._gather(_.mid,v)});else if(d.type==="answer"){h=Ee.splitSections(m._remoteDescription.sdp),p=h.shift();var f=Ee.matchPrefix(p,"a=ice-lite").length>0;h.forEach(function(_,v){var T=m.transceivers[v],R=T.iceGatherer,w=T.iceTransport,O=T.dtlsTransport,B=T.localCapabilities,K=T.remoteCapabilities;if(!(Ee.isRejected(_)&&Ee.matchPrefix(_,"a=bundle-only").length===0)&&!T.rejected){var j=Ee.getIceParameters(_,p),nt=Ee.getDtlsParameters(_,p);f&&(nt.role="server"),m.usingBundle&&v!==0||(m._gather(T.mid,v),w.state==="new"&&w.start(R,j,f?"controlling":"controlled"),O.state==="new"&&O.start(nt));var It=pp(B,K);m._transceive(T,It.codecs.length>0,!1)}})}return m._localDescription={type:d.type,sdp:d.sdp},d.type==="offer"?m._updateSignalingState("have-local-offer"):m._updateSignalingState("stable"),Promise.resolve()},s.prototype.setRemoteDescription=function(d){var h=this;if(["offer","answer"].indexOf(d.type)===-1)return Promise.reject(di("TypeError",'Unsupported type "'+d.type+'"'));if(!A1("setRemoteDescription",d.type,h.signalingState)||h._isClosed)return Promise.reject(di("InvalidStateError","Can not set remote "+d.type+" in state "+h.signalingState));var p={};h.remoteStreams.forEach(function(w){p[w.id]=w});var m=[],f=Ee.splitSections(d.sdp),_=f.shift(),v=Ee.matchPrefix(_,"a=ice-lite").length>0,T=Ee.matchPrefix(_,"a=group:BUNDLE ").length>0;h.usingBundle=T;var R=Ee.matchPrefix(_,"a=ice-options:")[0];return h.canTrickleIceCandidates=!!R&&R.substr(14).split(" ").indexOf("trickle")>=0,f.forEach(function(w,O){var B=Ee.splitLines(w),K=Ee.getKind(w),j=Ee.isRejected(w)&&Ee.matchPrefix(w,"a=bundle-only").length===0,nt=B[0].substr(2).split(" ")[2],It=Ee.getDirection(w,_),vt=Ee.parseMsid(w),Rt=Ee.getMid(w)||Ee.generateIdentifier();if(j||K==="application"&&(nt==="DTLS/SCTP"||nt==="UDP/DTLS/SCTP"))h.transceivers[O]={mid:Rt,kind:K,protocol:nt,rejected:!0};else{var X,rt,H,W,U,Ct,Et,gt,Mt;!j&&h.transceivers[O]&&h.transceivers[O].rejected&&(h.transceivers[O]=h._createTransceiver(K,!0));var Y,$,mt=Ee.parseRtpParameters(w);j||(Y=Ee.getIceParameters(w,_),($=Ee.getDtlsParameters(w,_)).role="client"),Et=Ee.parseRtpEncodingParameters(w);var ot=Ee.parseRtcpParameters(w),Lt=Ee.matchPrefix(w,"a=end-of-candidates",_).length>0,at=Ee.matchPrefix(w,"a=candidate:").map(function(F){return Ee.parseCandidate(F)}).filter(function(F){return F.component===1});if((d.type==="offer"||d.type==="answer")&&!j&&T&&O>0&&h.transceivers[O]&&(h._disposeIceAndDtlsTransports(O),h.transceivers[O].iceGatherer=h.transceivers[0].iceGatherer,h.transceivers[O].iceTransport=h.transceivers[0].iceTransport,h.transceivers[O].dtlsTransport=h.transceivers[0].dtlsTransport,h.transceivers[O].rtpSender&&h.transceivers[O].rtpSender.setTransport(h.transceivers[0].dtlsTransport),h.transceivers[O].rtpReceiver&&h.transceivers[O].rtpReceiver.setTransport(h.transceivers[0].dtlsTransport)),d.type!=="offer"||j)d.type==="answer"&&!j&&(rt=(X=h.transceivers[O]).iceGatherer,H=X.iceTransport,W=X.dtlsTransport,U=X.rtpReceiver,Ct=X.sendEncodingParameters,gt=X.localCapabilities,h.transceivers[O].recvEncodingParameters=Et,h.transceivers[O].remoteCapabilities=mt,h.transceivers[O].rtcpParameters=ot,at.length&&H.state==="new"&&(!v&&!Lt||T&&O!==0?at.forEach(function(F){Im(X.iceTransport,F)}):H.setRemoteCandidates(at)),T&&O!==0||(H.state==="new"&&H.start(rt,Y,"controlling"),W.state==="new"&&W.start($)),!pp(X.localCapabilities,X.remoteCapabilities).codecs.filter(function(F){return F.name.toLowerCase()==="rtx"}).length&&X.sendEncodingParameters[0].rtx&&delete X.sendEncodingParameters[0].rtx,h._transceive(X,It==="sendrecv"||It==="recvonly",It==="sendrecv"||It==="sendonly"),!U||It!=="sendrecv"&&It!=="sendonly"?delete X.rtpReceiver:(Mt=U.track,vt?(p[vt.stream]||(p[vt.stream]=new e.MediaStream),r(Mt,p[vt.stream]),m.push([Mt,U,p[vt.stream]])):(p.default||(p.default=new e.MediaStream),r(Mt,p.default),m.push([Mt,U,p.default]))));else{(X=h.transceivers[O]||h._createTransceiver(K)).mid=Rt,X.iceGatherer||(X.iceGatherer=h._createIceGatherer(O,T)),at.length&&X.iceTransport.state==="new"&&(!Lt||T&&O!==0?at.forEach(function(F){Im(X.iceTransport,F)}):X.iceTransport.setRemoteCandidates(at)),gt=e.RTCRtpReceiver.getCapabilities(K),t<15019&&(gt.codecs=gt.codecs.filter(function(F){return F.name!=="rtx"})),Ct=X.sendEncodingParameters||[{ssrc:1001*(2*O+2)}];var y,M=!1;It==="sendrecv"||It==="sendonly"?(M=!X.rtpReceiver,U=X.rtpReceiver||new e.RTCRtpReceiver(X.dtlsTransport,K),M&&(Mt=U.track,vt&&vt.stream==="-"||(vt?(p[vt.stream]||(p[vt.stream]=new e.MediaStream,Object.defineProperty(p[vt.stream],"id",{get:function(){return vt.stream}})),Object.defineProperty(Mt,"id",{get:function(){return vt.track}}),y=p[vt.stream]):(p.default||(p.default=new e.MediaStream),y=p.default)),y&&(r(Mt,y),X.associatedRemoteMediaStreams.push(y)),m.push([Mt,U,y]))):X.rtpReceiver&&X.rtpReceiver.track&&(X.associatedRemoteMediaStreams.forEach(function(F){var ut=F.getTracks().find(function(Vt){return Vt.id===X.rtpReceiver.track.id});ut&&function(Vt,xe){xe.removeTrack(Vt),xe.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:Vt}))}(ut,F)}),X.associatedRemoteMediaStreams=[]),X.localCapabilities=gt,X.remoteCapabilities=mt,X.rtpReceiver=U,X.rtcpParameters=ot,X.sendEncodingParameters=Ct,X.recvEncodingParameters=Et,h._transceive(h.transceivers[O],!1,M)}}}),h._dtlsRole===void 0&&(h._dtlsRole=d.type==="offer"?"active":"passive"),h._remoteDescription={type:d.type,sdp:d.sdp},d.type==="offer"?h._updateSignalingState("have-remote-offer"):h._updateSignalingState("stable"),Object.keys(p).forEach(function(w){var O=p[w];if(O.getTracks().length){if(h.remoteStreams.indexOf(O)===-1){h.remoteStreams.push(O);var B=new Event("addstream");B.stream=O,e.setTimeout(function(){h._dispatchEvent("addstream",B)})}m.forEach(function(K){var j=K[0],nt=K[1];O.id===K[2].id&&i(h,j,nt,[O])})}}),m.forEach(function(w){w[2]||i(h,w[0],w[1],[])}),e.setTimeout(function(){h&&h.transceivers&&h.transceivers.forEach(function(w){w.iceTransport&&w.iceTransport.state==="new"&&w.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),w.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},s.prototype.close=function(){this.transceivers.forEach(function(d){d.iceTransport&&d.iceTransport.stop(),d.dtlsTransport&&d.dtlsTransport.stop(),d.rtpSender&&d.rtpSender.stop(),d.rtpReceiver&&d.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},s.prototype._updateSignalingState=function(d){this.signalingState=d;var h=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",h)},s.prototype._maybeFireNegotiationNeeded=function(){var d=this;this.signalingState==="stable"&&this.needNegotiation!==!0&&(this.needNegotiation=!0,e.setTimeout(function(){if(d.needNegotiation){d.needNegotiation=!1;var h=new Event("negotiationneeded");d._dispatchEvent("negotiationneeded",h)}},0))},s.prototype._updateIceConnectionState=function(){var d,h={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(m){m.iceTransport&&!m.rejected&&h[m.iceTransport.state]++}),d="new",h.failed>0?d="failed":h.checking>0?d="checking":h.disconnected>0?d="disconnected":h.new>0?d="new":h.connected>0?d="connected":h.completed>0&&(d="completed"),d!==this.iceConnectionState){this.iceConnectionState=d;var p=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",p)}},s.prototype._updateConnectionState=function(){var d,h={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(m){m.iceTransport&&m.dtlsTransport&&!m.rejected&&(h[m.iceTransport.state]++,h[m.dtlsTransport.state]++)}),h.connected+=h.completed,d="new",h.failed>0?d="failed":h.connecting>0?d="connecting":h.disconnected>0?d="disconnected":h.new>0?d="new":h.connected>0&&(d="connected"),d!==this.connectionState){this.connectionState=d;var p=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",p)}},s.prototype.createOffer=function(){var d=this;if(d._isClosed)return Promise.reject(di("InvalidStateError","Can not call createOffer after close"));var h=d.transceivers.filter(function(v){return v.kind==="audio"}).length,p=d.transceivers.filter(function(v){return v.kind==="video"}).length,m=arguments[0];if(m){if(m.mandatory||m.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");m.offerToReceiveAudio!==void 0&&(h=m.offerToReceiveAudio===!0?1:m.offerToReceiveAudio===!1?0:m.offerToReceiveAudio),m.offerToReceiveVideo!==void 0&&(p=m.offerToReceiveVideo===!0?1:m.offerToReceiveVideo===!1?0:m.offerToReceiveVideo)}for(d.transceivers.forEach(function(v){v.kind==="audio"?--h<0&&(v.wantReceive=!1):v.kind==="video"&&--p<0&&(v.wantReceive=!1)});h>0||p>0;)h>0&&(d._createTransceiver("audio"),h--),p>0&&(d._createTransceiver("video"),p--);var f=Ee.writeSessionBoilerplate(d._sdpSessionId,d._sdpSessionVersion++);d.transceivers.forEach(function(v,T){var R=v.track,w=v.kind,O=v.mid||Ee.generateIdentifier();v.mid=O,v.iceGatherer||(v.iceGatherer=d._createIceGatherer(T,d.usingBundle));var B=e.RTCRtpSender.getCapabilities(w);t<15019&&(B.codecs=B.codecs.filter(function(j){return j.name!=="rtx"})),B.codecs.forEach(function(j){j.name==="H264"&&j.parameters["level-asymmetry-allowed"]===void 0&&(j.parameters["level-asymmetry-allowed"]="1"),v.remoteCapabilities&&v.remoteCapabilities.codecs&&v.remoteCapabilities.codecs.forEach(function(nt){j.name.toLowerCase()===nt.name.toLowerCase()&&j.clockRate===nt.clockRate&&(j.preferredPayloadType=nt.payloadType)})}),B.headerExtensions.forEach(function(j){(v.remoteCapabilities&&v.remoteCapabilities.headerExtensions||[]).forEach(function(nt){j.uri===nt.uri&&(j.id=nt.id)})});var K=v.sendEncodingParameters||[{ssrc:1001*(2*T+1)}];R&&t>=15019&&w==="video"&&!K[0].rtx&&(K[0].rtx={ssrc:K[0].ssrc+1}),v.wantReceive&&(v.rtpReceiver=new e.RTCRtpReceiver(v.dtlsTransport,w)),v.localCapabilities=B,v.sendEncodingParameters=K}),d._config.bundlePolicy!=="max-compat"&&(f+="a=group:BUNDLE "+d.transceivers.map(function(v){return v.mid}).join(" ")+`\r
`),f+=`a=ice-options:trickle\r
`,d.transceivers.forEach(function(v,T){f+=p1(v,v.localCapabilities,"offer",v.stream,d._dtlsRole),f+=`a=rtcp-rsize\r
`,!v.iceGatherer||d.iceGatheringState==="new"||T!==0&&d.usingBundle||(v.iceGatherer.getLocalCandidates().forEach(function(R){R.component=1,f+="a="+Ee.writeCandidate(R)+`\r
`}),v.iceGatherer.state==="completed"&&(f+=`a=end-of-candidates\r
`))});var _=new e.RTCSessionDescription({type:"offer",sdp:f});return Promise.resolve(_)},s.prototype.createAnswer=function(){var d=this;if(d._isClosed)return Promise.reject(di("InvalidStateError","Can not call createAnswer after close"));if(d.signalingState!=="have-remote-offer"&&d.signalingState!=="have-local-pranswer")return Promise.reject(di("InvalidStateError","Can not call createAnswer in signalingState "+d.signalingState));var h=Ee.writeSessionBoilerplate(d._sdpSessionId,d._sdpSessionVersion++);d.usingBundle&&(h+="a=group:BUNDLE "+d.transceivers.map(function(f){return f.mid}).join(" ")+`\r
`),h+=`a=ice-options:trickle\r
`;var p=Ee.getMediaSections(d._remoteDescription.sdp).length;d.transceivers.forEach(function(f,_){if(!(_+1>p)){if(f.rejected)return f.kind==="application"?f.protocol==="DTLS/SCTP"?h+=`m=application 0 DTLS/SCTP 5000\r
`:h+="m=application 0 "+f.protocol+` webrtc-datachannel\r
`:f.kind==="audio"?h+=`m=audio 0 UDP/TLS/RTP/SAVPF 0\r
a=rtpmap:0 PCMU/8000\r
`:f.kind==="video"&&(h+=`m=video 0 UDP/TLS/RTP/SAVPF 120\r
a=rtpmap:120 VP8/90000\r
`),void(h+=`c=IN IP4 0.0.0.0\r
a=inactive\r
a=mid:`+f.mid+`\r
`);var v;f.stream&&(f.kind==="audio"?v=f.stream.getAudioTracks()[0]:f.kind==="video"&&(v=f.stream.getVideoTracks()[0]),v&&t>=15019&&f.kind==="video"&&!f.sendEncodingParameters[0].rtx&&(f.sendEncodingParameters[0].rtx={ssrc:f.sendEncodingParameters[0].ssrc+1}));var T=pp(f.localCapabilities,f.remoteCapabilities);!T.codecs.filter(function(R){return R.name.toLowerCase()==="rtx"}).length&&f.sendEncodingParameters[0].rtx&&delete f.sendEncodingParameters[0].rtx,h+=p1(f,T,"answer",f.stream,d._dtlsRole),f.rtcpParameters&&f.rtcpParameters.reducedSize&&(h+=`a=rtcp-rsize\r
`)}});var m=new e.RTCSessionDescription({type:"answer",sdp:h});return Promise.resolve(m)},s.prototype.addIceCandidate=function(d){var h,p=this;return d&&d.sdpMLineIndex===void 0&&!d.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(m,f){if(!p._remoteDescription)return f(di("InvalidStateError","Can not add ICE candidate without a remote description"));if(d&&d.candidate!==""){var _=d.sdpMLineIndex;if(d.sdpMid){for(var v=0;v<p.transceivers.length;v++)if(p.transceivers[v].mid===d.sdpMid){_=v;break}}var T=p.transceivers[_];if(!T)return f(di("OperationError","Can not add ICE candidate"));if(T.rejected)return m();var R=Object.keys(d.candidate).length>0?Ee.parseCandidate(d.candidate):{};if(R.protocol==="tcp"&&(R.port===0||R.port===9)||R.component&&R.component!==1)return m();if((_===0||_>0&&T.iceTransport!==p.transceivers[0].iceTransport)&&!Im(T.iceTransport,R))return f(di("OperationError","Can not add ICE candidate"));var w=d.candidate.trim();w.indexOf("a=")===0&&(w=w.substr(2)),(h=Ee.getMediaSections(p._remoteDescription.sdp))[_]+="a="+(R.type?w:"end-of-candidates")+`\r
`,p._remoteDescription.sdp=Ee.getDescription(p._remoteDescription.sdp)+h.join("")}else for(var O=0;O<p.transceivers.length&&(p.transceivers[O].rejected||(p.transceivers[O].iceTransport.addRemoteCandidate({}),(h=Ee.getMediaSections(p._remoteDescription.sdp))[O]+=`a=end-of-candidates\r
`,p._remoteDescription.sdp=Ee.getDescription(p._remoteDescription.sdp)+h.join(""),!p.usingBundle));O++);m()})},s.prototype.getStats=function(d){if(d&&d instanceof e.MediaStreamTrack){var h=null;if(this.transceivers.forEach(function(m){m.rtpSender&&m.rtpSender.track===d?h=m.rtpSender:m.rtpReceiver&&m.rtpReceiver.track===d&&(h=m.rtpReceiver)}),!h)throw di("InvalidAccessError","Invalid selector.");return h.getStats()}var p=[];return this.transceivers.forEach(function(m){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(f){m[f]&&p.push(m[f].getStats())})}),Promise.all(p).then(function(m){var f=new Map;return m.forEach(function(_){_.forEach(function(v){f.set(v.id,v)})}),f})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(d){var h=e[d];if(h&&h.prototype&&h.prototype.getStats){var p=h.prototype.getStats;h.prototype.getStats=function(){return p.apply(this).then(function(m){var f=new Map;return Object.keys(m).forEach(function(_){var v;m[_].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(v=m[_]).type]||v.type,f.set(_,m[_])}),f})}}});var l=["createOffer","createAnswer"];return l.forEach(function(d){var h=s.prototype[d];s.prototype[d]=function(){var p=arguments;return typeof p[0]=="function"||typeof p[1]=="function"?h.apply(this,[arguments[2]]).then(function(m){typeof p[0]=="function"&&p[0].apply(null,[m])},function(m){typeof p[1]=="function"&&p[1].apply(null,[m])}):h.apply(this,arguments)}}),(l=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(d){var h=s.prototype[d];s.prototype[d]=function(){var p=arguments;return typeof p[1]=="function"||typeof p[2]=="function"?h.apply(this,arguments).then(function(){typeof p[1]=="function"&&p[1].apply(null)},function(m){typeof p[2]=="function"&&p[2].apply(null,[m])}):h.apply(this,arguments)}}),["getStats"].forEach(function(d){var h=s.prototype[d];s.prototype[d]=function(){var p=arguments;return typeof p[1]=="function"?h.apply(this,arguments).then(function(){typeof p[1]=="function"&&p[1].apply(null)}):h.apply(this,arguments)}}),s};function f1(e){var t;const r=e&&e.navigator,i=Lr(t=r.mediaDevices.getUserMedia).call(t,r.mediaDevices);r.mediaDevices.getUserMedia=function(s){return i(s).catch(l=>ct.reject(function(d){return{name:{PermissionDeniedError:"NotAllowedError"}[d.name]||d.name,message:d.message,constraint:d.constraint,toString(){return this.name}}}(l)))}}function g1(e){var t;"getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=Lr(t=e.navigator.getDisplayMedia).call(t,e.navigator)))}function vm(e){const t=qs(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(i){return i}),e.RTCSessionDescription||(e.RTCSessionDescription=function(i){return i}),t.version<15025)){const i=jt(e.MediaStreamTrack.prototype,"enabled");ie(e.MediaStreamTrack.prototype,"enabled",{set(s){i.set.call(this,s);const l=new Event("enabled");l.enabled=s,this.dispatchEvent(l)}})}e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)&&ie(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=new e.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);const r=Q4(e,t.version);e.RTCPeerConnection=function(i){return i&&i.iceServers&&(i.iceServers=function(s,l){let d=!1;return s=JSON.parse(St(s)),kt(s).call(s,h=>{if(h&&(h.urls||h.url)){var p=h.urls||h.url;h.url&&!h.urls&&ep("RTCIceServer.url","RTCIceServer.urls");const m=typeof p=="string";return m&&(p=[p]),p=kt(p).call(p,f=>{if(xt(f).call(f,"stun:")===0)return!1;const _=ml(f).call(f,"turn")&&!ml(f).call(f,"turn:[")&&qt(f).call(f,"transport=udp");return _&&!d?(d=!0,!0):_&&!d}),delete h.url,h.urls=m?p[0]:p,!!p.length}})}(i.iceServers,t.version),Dg("ICE servers after filtering:",i.iceServers)),new r(i)},e.RTCPeerConnection.prototype=r.prototype}function m1(e){e.RTCRtpSender&&!("replaceTrack"in e.RTCRtpSender.prototype)&&(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}var E1=Object.freeze({__proto__:null,shimPeerConnection:vm,shimReplaceTrack:m1,shimGetUserMedia:f1,shimGetDisplayMedia:g1});function _1(e){const t=qs(e),r=e&&e.navigator,i=e&&e.MediaStreamTrack;if(r.getUserMedia=function(l,d,h){ep("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(l).then(d,h)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){var s;const l=function(h,p,m){p in h&&!(m in h)&&(h[m]=h[p],delete h[p])},d=Lr(s=r.mediaDevices.getUserMedia).call(s,r.mediaDevices);if(r.mediaDevices.getUserMedia=function(h){return typeof h=="object"&&typeof h.audio=="object"&&(h=JSON.parse(St(h)),l(h.audio,"autoGainControl","mozAutoGainControl"),l(h.audio,"noiseSuppression","mozNoiseSuppression")),d(h)},i&&i.prototype.getSettings){const h=i.prototype.getSettings;i.prototype.getSettings=function(){const p=h.apply(this,arguments);return l(p,"mozAutoGainControl","autoGainControl"),l(p,"mozNoiseSuppression","noiseSuppression"),p}}if(i&&i.prototype.applyConstraints){const h=i.prototype.applyConstraints;i.prototype.applyConstraints=function(p){return this.kind==="audio"&&typeof p=="object"&&(p=JSON.parse(St(p)),l(p,"autoGainControl","mozAutoGainControl"),l(p,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[p])}}}}function I1(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&ie(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Cm(e){const t=qs(e);if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;var r;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&V(r=["setLocalDescription","setRemoteDescription","addIceCandidate"]).call(r,function(d){const h=e.RTCPeerConnection.prototype[d],p={[d](){return arguments[0]=new(d==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),h.apply(this,arguments)}};e.RTCPeerConnection.prototype[d]=p[d]});const i=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?t.version<68&&arguments[0]&&arguments[0].candidate===""?ct.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),ct.resolve())};const s={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},l=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[d,h,p]=arguments;return l.apply(this,[d||null]).then(m=>{if(t.version<53&&!h)try{V(m).call(m,f=>{f.type=s[f.type]||f.type})}catch(f){if(f.name!=="TypeError")throw f;V(m).call(m,(_,v)=>{m.set(v,hr({},_,{type:s[_.type]||_.type}))})}return m}).then(h,p)}}function v1(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const i=t.apply(this,[]);return V(i).call(i,s=>s._pc=this),i});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const i=r.apply(this,arguments);return i._pc=this,i}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):ct.resolve(new $t)}}function C1(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const r=t.apply(this,[]);return V(r).call(r,i=>i._pc=this),r}),dl(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function S1(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){var r;ep("removeStream","removeTrack"),V(r=this.getSenders()).call(r,i=>{var s;i.track&&qt(s=t.getTracks()).call(s,i.track)&&this.removeTrack(i)})})}function T1(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}var R1=Object.freeze({__proto__:null,shimOnTrack:I1,shimPeerConnection:Cm,shimSenderGetStats:v1,shimReceiverGetStats:C1,shimRemoveStream:S1,shimRTCDataChannel:T1,shimGetUserMedia:_1,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,ct.reject(i)}return r.video===!0?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})}});function y1(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(r){var i,s,l;this._localStreams||(this._localStreams=[]),qt(i=this._localStreams).call(i,r)||this._localStreams.push(r),V(s=r.getAudioTracks()).call(s,d=>t.call(this,d,r)),V(l=r.getVideoTracks()).call(l,d=>t.call(this,d,r))},e.RTCPeerConnection.prototype.addTrack=function(r,i){var s;return i&&(this._localStreams?qt(s=this._localStreams).call(s,i)||this._localStreams.push(i):this._localStreams=[i]),t.call(this,r,i)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){var r,i,s;this._localStreams||(this._localStreams=[]);const l=xt(r=this._localStreams).call(r,t);if(l===-1)return;Ye(i=this._localStreams).call(i,l,1);const d=t.getTracks();V(s=this.getSenders()).call(s,h=>{qt(d).call(d,h.track)&&this.removeTrack(h)})})}}function w1(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){ie(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(r){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=r),this.addEventListener("track",this._onaddstreampoly=i=>{var s;V(s=i.streams).call(s,l=>{var d;if(this._remoteStreams||(this._remoteStreams=[]),qt(d=this._remoteStreams).call(d,l))return;this._remoteStreams.push(l);const h=new Event("addstream");h.stream=l,this.dispatchEvent(h)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){var s;V(s=i.streams).call(s,l=>{var d;if(r._remoteStreams||(r._remoteStreams=[]),xt(d=r._remoteStreams).call(d,l)>=0)return;r._remoteStreams.push(l);const h=new Event("addstream");h.stream=l,r.dispatchEvent(h)})}),t.apply(r,arguments)}}}function b1(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,r=t.createOffer,i=t.createAnswer,s=t.setLocalDescription,l=t.setRemoteDescription,d=t.addIceCandidate;t.createOffer=function(p,m){const f=arguments.length>=2?arguments[2]:arguments[0],_=r.apply(this,[f]);return m?(_.then(p,m),ct.resolve()):_},t.createAnswer=function(p,m){const f=arguments.length>=2?arguments[2]:arguments[0],_=i.apply(this,[f]);return m?(_.then(p,m),ct.resolve()):_};let h=function(p,m,f){const _=s.apply(this,[p]);return f?(_.then(m,f),ct.resolve()):_};t.setLocalDescription=h,h=function(p,m,f){const _=l.apply(this,[p]);return f?(_.then(m,f),ct.resolve()):_},t.setRemoteDescription=h,h=function(p,m,f){const _=d.apply(this,[p]);return f?(_.then(m,f),ct.resolve()):_},t.addIceCandidate=h}function N1(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var r;const s=t.mediaDevices,l=Lr(r=s.getUserMedia).call(r,s);t.mediaDevices.getUserMedia=d=>l(O1(d))}var i;!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=Lr(i=function(s,l,d){t.mediaDevices.getUserMedia(s).then(l,d)}).call(i,t))}function O1(e){return e&&e.video!==void 0?hr({},e,{video:GS(e.video)}):e}function k1(e){const t=e.RTCPeerConnection;e.RTCPeerConnection=function(r,i){if(r&&r.iceServers){const s=[];for(let l=0;l<r.iceServers.length;l++){let d=r.iceServers[l];!d.hasOwnProperty("urls")&&d.hasOwnProperty("url")?(ep("RTCIceServer.url","RTCIceServer.urls"),d=JSON.parse(St(d)),d.urls=d.url,delete d.url,s.push(d)):s.push(r.iceServers[l])}r.iceServers=s}return new t(r,i)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&ie(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function D1(e){typeof e=="object"&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver&&ie(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function L1(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(r){if(r){var i,s;r.offerToReceiveAudio!==void 0&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const l=ft(i=this.getTransceivers()).call(i,h=>h.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&l?l.direction==="sendrecv"?l.setDirection?l.setDirection("sendonly"):l.direction="sendonly":l.direction==="recvonly"&&(l.setDirection?l.setDirection("inactive"):l.direction="inactive"):r.offerToReceiveAudio!==!0||l||this.addTransceiver("audio"),r.offerToReceiveVideo!==void 0&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const d=ft(s=this.getTransceivers()).call(s,h=>h.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&d?d.direction==="sendrecv"?d.setDirection?d.setDirection("sendonly"):d.direction="sendonly":d.direction==="recvonly"&&(d.setDirection?d.setDirection("inactive"):d.direction="inactive"):r.offerToReceiveVideo!==!0||d||this.addTransceiver("video")}return t.apply(this,arguments)}}var P1=Object.freeze({__proto__:null,shimLocalStreamsAPI:y1,shimRemoteStreamsAPI:w1,shimCallbacksAPI:b1,shimGetUserMedia:N1,shimConstraints:O1,shimRTCIceServerUrls:k1,shimTrackEventTransceiver:D1,shimCreateOfferLegacy:L1});function Ap(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(r){var i;if(typeof r=="object"&&r.candidate&&xt(i=r.candidate).call(i,"a=")===0&&((r=JSON.parse(St(r))).candidate=r.candidate.substr(2)),r.candidate&&r.candidate.length){const s=new t(r),l=hp.parseCandidate(r.candidate),d=hr(s,l);return d.toJSON=function(){return{candidate:d.candidate,sdpMid:d.sdpMid,sdpMLineIndex:d.sdpMLineIndex,usernameFragment:d.usernameFragment}},d}return new t(r)},e.RTCIceCandidate.prototype=t.prototype,dl(e,"icecandidate",r=>(r.candidate&&ie(r,"candidate",{value:new e.RTCIceCandidate(r.candidate),writable:"false"}),r))}function Xd(e){if(!e.RTCPeerConnection)return;const t=qs(e);"sctp"in e.RTCPeerConnection.prototype||ie(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const r=function(h){if(!h||!h.sdp)return!1;const p=hp.splitSections(h.sdp);return p.shift(),Ss(p).call(p,m=>{var f;const _=hp.parseMLine(m);return _&&_.kind==="application"&&xt(f=_.protocol).call(f,"SCTP")!==-1})},i=function(h){const p=h.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(p===null||p.length<2)return-1;const m=Tr(p[1],10);return m!=m?-1:m},s=function(h){let p=65536;return t.browser==="firefox"&&(p=t.version<57?h===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),p},l=function(h,p){let m=65536;t.browser==="firefox"&&t.version===57&&(m=65535);const f=hp.matchPrefix(h.sdp,"a=max-message-size:");return f.length>0?m=Tr(f[0].substr(19),10):t.browser==="firefox"&&p!==-1&&(m=2147483637),m},d=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:h}=this.getConfiguration();h==="plan-b"&&ie(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){const h=i(arguments[0]),p=s(h),m=l(arguments[0],h);let f;f=p===0&&m===0?Number.POSITIVE_INFINITY:p===0||m===0?Math.max(p,m):Math.min(p,m);const _={};ie(_,"maxMessageSize",{get:()=>f}),this._sctp=_}return d.apply(this,arguments)}}function Zd(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(i,s){const l=i.send;i.send=function(){const d=arguments[0],h=d.length||d.size||d.byteLength;if(i.readyState==="open"&&s.sctp&&h>s.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+s.sctp.maxMessageSize+" bytes)");return l.apply(i,arguments)}}const r=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const i=r.apply(this,arguments);return t(i,this),i},dl(e,"datachannel",i=>(t(i.channel,i.target),i))}function Sm(e){var t;if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const r=e.RTCPeerConnection.prototype;ie(r,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),ie(r,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),V(t=["setLocalDescription","setRemoteDescription"]).call(t,i=>{const s=r[i];r[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=l=>{const d=l.target;if(d._lastConnectionState!==d.connectionState){d._lastConnectionState=d.connectionState;const h=new Event("connectionstatechange",l);d.dispatchEvent(h)}return l},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),s.apply(this,arguments)}})}function Tm(e){if(!e.RTCPeerConnection)return;const t=qs(e);if(t.browser==="chrome"&&t.version>=71)return;const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(i){var s,l;return i&&i.sdp&&xt(s=i.sdp).call(s,`
a=extmap-allow-mixed`)!==-1&&(i.sdp=kt(l=i.sdp.split(`
`)).call(l,d=>Ic(d).call(d)!=="a=extmap-allow-mixed").join(`
`)),r.apply(this,arguments)}}var mn,ye,V4=Object.freeze({__proto__:null,shimRTCIceCandidate:Ap,shimMaxMessageSize:Xd,shimSendThrowTypeError:Zd,shimConnectionState:Sm,removeAllowExtmapMixed:Tm});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};const r=Dg,i=qs(e),s={browserDetails:i,commonShim:V4,extractVersion:Hd,disableLog:s3,disableWarnings:a3};switch(i.browser){case"chrome":if(!c1||!gm||!t.shimChrome)return r("Chrome shim is not included in this adapter release."),s;r("adapter.js shimming chrome."),s.browserShim=c1,$T(e),t1(e),gm(e),e1(e),s1(e),r1(e),n1(e),i1(e),a1(e),Ap(e),Sm(e),Xd(e),Zd(e),Tm(e);break;case"firefox":if(!R1||!Cm||!t.shimFirefox)return r("Firefox shim is not included in this adapter release."),s;r("adapter.js shimming firefox."),s.browserShim=R1,_1(e),Cm(e),I1(e),S1(e),v1(e),C1(e),T1(e),Ap(e),Sm(e),Xd(e),Zd(e);break;case"edge":if(!E1||!vm||!t.shimEdge)return r("MS edge shim is not included in this adapter release."),s;r("adapter.js shimming edge."),s.browserShim=E1,f1(e),g1(e),vm(e),m1(e),Xd(e),Zd(e);break;case"safari":if(!P1||!t.shimSafari)return r("Safari shim is not included in this adapter release."),s;r("adapter.js shimming safari."),s.browserShim=P1,k1(e),L1(e),b1(e),y1(e),w1(e),D1(e),N1(e),Ap(e),Xd(e),Zd(e),Tm(e);break;default:r("Unsupported browser!")}})({window}),function(e){e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot"}(mn||(mn={})),function(e){e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger"}(ye||(ye={}));var Rm={exports:{}};/*!@license
	 * UAParser.js v0.7.28
	 * Lightweight JavaScript-based User-Agent string parser
	 * https://github.com/faisalman/ua-parser-js
	 *
	 * Copyright © 2012-2021 Faisal Salman <f@faisalman.com>
	 * Licensed under MIT License
	 */(function(e,t){(function(r,i){var s="function",l="object",d="string",h="model",p="name",m="type",f="vendor",_="version",v="architecture",T="console",R="mobile",w="tablet",O="smarttv",B="wearable",K="embedded",j={extend:function(H,W){var U={};for(var Ct in H)W[Ct]&&W[Ct].length%2==0?U[Ct]=W[Ct].concat(H[Ct]):U[Ct]=H[Ct];return U},has:function(H,W){return typeof H===d&&W.toLowerCase().indexOf(H.toLowerCase())!==-1},lowerize:function(H){return H.toLowerCase()},major:function(H){return typeof H===d?H.replace(/[^\d\.]/g,"").split(".")[0]:i},trim:function(H,W){return H=H.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),W===void 0?H:H.substring(0,255)}},nt={rgx:function(H,W){for(var U,Ct,Et,gt,Mt,Y,$=0;$<W.length&&!Mt;){var mt=W[$],ot=W[$+1];for(U=Ct=0;U<mt.length&&!Mt;)if(Mt=mt[U++].exec(H))for(Et=0;Et<ot.length;Et++)Y=Mt[++Ct],typeof(gt=ot[Et])===l&&gt.length>0?gt.length==2?typeof gt[1]==s?this[gt[0]]=gt[1].call(this,Y):this[gt[0]]=gt[1]:gt.length==3?typeof gt[1]!==s||gt[1].exec&&gt[1].test?this[gt[0]]=Y?Y.replace(gt[1],gt[2]):i:this[gt[0]]=Y?gt[1].call(this,Y,gt[2]):i:gt.length==4&&(this[gt[0]]=Y?gt[3].call(this,Y.replace(gt[1],gt[2])):i):this[gt]=Y||i;$+=2}},str:function(H,W){for(var U in W)if(typeof W[U]===l&&W[U].length>0){for(var Ct=0;Ct<W[U].length;Ct++)if(j.has(W[U][Ct],H))return U==="?"?i:U}else if(j.has(W[U],H))return U==="?"?i:U;return H}},It={browser:{oldSafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}},oldEdge:{version:{.1:"12.",21:"13.",31:"14.",39:"15.",41:"16.",42:"17.",44:"18."}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},vt={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[_,[p,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[_,[p,"Edge"]],[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]{3,6})\b.+version\/([\w\.-]+)/i,/(opera)(?:.+version\/|[\/\s]+)([\w\.]+)/i],[p,_],[/opios[\/\s]+([\w\.]+)/i],[_,[p,"Opera Mini"]],[/\sopr\/([\w\.]+)/i],[_,[p,"Opera"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]*)/i,/(avant\s|iemobile|slim)(?:browser)?[\/\s]?([\w\.]*)/i,/(ba?idubrowser)[\/\s]?([\w\.]+)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon)\/([\w\.-]+)/i,/(rekonq|puffin|brave|whale|qqbrowserlite|qq)\/([\w\.]+)/i,/(weibo)__([\d\.]+)/i],[p,_],[/(?:[\s\/]uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],[_,[p,"UCBrowser"]],[/(?:windowswechat)?\sqbcore\/([\w\.]+)\b.*(?:windowswechat)?/i],[_,[p,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[_,[p,"WeChat"]],[/konqueror\/([\w\.]+)/i],[_,[p,"Konqueror"]],[/trident.+rv[:\s]([\w\.]{1,9})\b.+like\sgecko/i],[_,[p,"IE"]],[/yabrowser\/([\w\.]+)/i],[_,[p,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[p,/(.+)/,"$1 Secure Browser"],_],[/focus\/([\w\.]+)/i],[_,[p,"Firefox Focus"]],[/opt\/([\w\.]+)/i],[_,[p,"Opera Touch"]],[/coc_coc_browser\/([\w\.]+)/i],[_,[p,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[_,[p,"Dolphin"]],[/coast\/([\w\.]+)/i],[_,[p,"Opera Coast"]],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[_,[p,"MIUI Browser"]],[/fxios\/([\w\.-]+)/i],[_,[p,"Firefox"]],[/(qihu|qhbrowser|qihoobrowser|360browser)/i],[[p,"360 Browser"]],[/(oculus|samsung|sailfish)browser\/([\w\.]+)/i],[[p,/(.+)/,"$1 Browser"],_],[/(comodo_dragon)\/([\w\.]+)/i],[[p,/_/g," "],_],[/\s(electron)\/([\w\.]+)\ssafari/i,/(tesla)(?:\sqtcarbrowser|\/(20[12]\d\.[\w\.-]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/\s]?([\w\.]+)/i],[p,_],[/(MetaSr)[\/\s]?([\w\.]+)/i,/(LBBROWSER)/i],[p],[/;fbav\/([\w\.]+);/i],[_,[p,"Facebook"]],[/FBAN\/FBIOS|FB_IAB\/FB4A/i],[[p,"Facebook"]],[/safari\s(line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/\s]([\w\.-]+)/i],[p,_],[/\bgsa\/([\w\.]+)\s.*safari\//i],[_,[p,"GSA"]],[/headlesschrome(?:\/([\w\.]+)|\s)/i],[_,[p,"Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[p,"Chrome WebView"],_],[/droid.+\sversion\/([\w\.]+)\b.+(?:mobile\ssafari|safari)/i],[_,[p,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],[p,_],[/version\/([\w\.]+)\s.*mobile\/\w+\s(safari)/i],[_,[p,"Mobile Safari"]],[/version\/([\w\.]+)\s.*(mobile\s?safari|safari)/i],[_,p],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[p,[_,nt.str,It.browser.oldSafari.version]],[/(webkit|khtml)\/([\w\.]+)/i],[p,_],[/(navigator|netscape)\/([\w\.-]+)/i],[[p,"Netscape"],_],[/ile\svr;\srv:([\w\.]+)\).+firefox/i],[_,[p,"Firefox Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([\w\.-]+)$/i,/(firefox)\/([\w\.]+)\s[\w\s\-]+\/[\w\.]+$/i,/(mozilla)\/([\w\.]+)\s.+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]*)/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[p,_]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[v,"amd64"]],[/(ia32(?=;))/i],[[v,j.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[v,"ia32"]],[/\b(aarch64|armv?8e?l?)\b/i],[[v,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[v,"armhf"]],[/windows\s(ce|mobile);\sppc;/i],[[v,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[v,/ower/,"",j.lowerize]],[/(sun4\w)[;\)]/i],[[v,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?:64|(?=v(?:[1-7]|[5-7]1)l?|;|eabi))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[v,j.lowerize]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[pt]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus\s10)/i],[h,[f,"Samsung"],[m,w]],[/\b((?:s[cgp]h|gt|sm)-\w+|galaxy\snexus)/i,/\ssamsung[\s-]([\w-]+)/i,/sec-(sgh\w+)/i],[h,[f,"Samsung"],[m,R]],[/\((ip(?:hone|od)[\s\w]*);/i],[h,[f,"Apple"],[m,R]],[/\((ipad);[\w\s\),;-]+apple/i,/applecoremedia\/[\w\.]+\s\((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[h,[f,"Apple"],[m,w]],[/\b((?:agr|ags[23]|bah2?|sht?)-a?[lw]\d{2})/i],[h,[f,"Huawei"],[m,w]],[/d\/huawei([\w\s-]+)[;\)]/i,/\b(nexus\s6p|vog-[at]?l\d\d|ane-[at]?l[x\d]\d|eml-a?l\d\da?|lya-[at]?l\d[\dc]|clt-a?l\d\di?|ele-l\d\d)/i,/\b(\w{2,4}-[atu][ln][01259][019])[;\)\s]/i],[h,[f,"Huawei"],[m,R]],[/\b(poco[\s\w]+)(?:\sbuild|\))/i,/\b;\s(\w+)\sbuild\/hm\1/i,/\b(hm[\s\-_]?note?[\s_]?(?:\d\w)?)\sbuild/i,/\b(redmi[\s\-_]?(?:note|k)?[\w\s_]+)(?:\sbuild|\))/i,/\b(mi[\s\-_]?(?:a\d|one|one[\s_]plus|note lte)?[\s_]?(?:\d?\w?)[\s_]?(?:plus)?)\sbuild/i],[[h,/_/g," "],[f,"Xiaomi"],[m,R]],[/\b(mi[\s\-_]?(?:pad)(?:[\w\s_]+))(?:\sbuild|\))/i],[[h,/_/g," "],[f,"Xiaomi"],[m,w]],[/;\s(\w+)\sbuild.+\soppo/i,/\s(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007)\b/i],[h,[f,"OPPO"],[m,R]],[/\svivo\s(\w+)(?:\sbuild|\))/i,/\s(v[12]\d{3}\w?[at])(?:\sbuild|;)/i],[h,[f,"Vivo"],[m,R]],[/\s(rmx[12]\d{3})(?:\sbuild|;)/i],[h,[f,"Realme"],[m,R]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?:?(\s4g)?)\b[\w\s]+build\//i,/\smot(?:orola)?[\s-](\w*)/i,/((?:moto[\s\w\(\)]+|xt\d{3,4}|nexus\s6)(?=\sbuild|\)))/i],[h,[f,"Motorola"],[m,R]],[/\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[h,[f,"Motorola"],[m,w]],[/((?=lg)?[vl]k\-?\d{3})\sbuild|\s3\.[\s\w;-]{10}lg?-([06cv9]{3,4})/i],[h,[f,"LG"],[m,w]],[/(lm-?f100[nv]?|nexus\s[45])/i,/lg[e;\s\/-]+((?!browser|netcast)\w+)/i,/\blg(\-?[\d\w]+)\sbuild/i],[h,[f,"LG"],[m,R]],[/(ideatab[\w\-\s]+)/i,/lenovo\s?(s(?:5000|6000)(?:[\w-]+)|tab(?:[\s\w]+)|yt[\d\w-]{6}|tb[\d\w-]{6})/i],[h,[f,"Lenovo"],[m,w]],[/(?:maemo|nokia).*(n900|lumia\s\d+)/i,/nokia[\s_-]?([\w\.-]*)/i],[[h,/_/g," "],[f,"Nokia"],[m,R]],[/droid.+;\s(pixel\sc)[\s)]/i],[h,[f,"Google"],[m,w]],[/droid.+;\s(pixel[\s\daxl]{0,6})(?:\sbuild|\))/i],[h,[f,"Google"],[m,R]],[/droid.+\s([c-g]\d{4}|so[-l]\w+|xq-a\w[4-7][12])(?=\sbuild\/|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[h,[f,"Sony"],[m,R]],[/sony\stablet\s[ps]\sbuild\//i,/(?:sony)?sgp\w+(?:\sbuild\/|\))/i],[[h,"Xperia Tablet"],[f,"Sony"],[m,w]],[/\s(kb2005|in20[12]5|be20[12][59])\b/i,/\ba000(1)\sbuild/i,/\boneplus\s(a\d{4})[\s)]/i],[h,[f,"OnePlus"],[m,R]],[/(alexa)webm/i,/(kf[a-z]{2}wi)(\sbuild\/|\))/i,/(kf[a-z]+)(\sbuild\/|\)).+silk\//i],[h,[f,"Amazon"],[m,w]],[/(sd|kf)[0349hijorstuw]+(\sbuild\/|\)).+silk\//i],[[h,"Fire Phone"],[f,"Amazon"],[m,R]],[/\((playbook);[\w\s\),;-]+(rim)/i],[h,f,[m,w]],[/((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10;\s(\w+)/i],[h,[f,"BlackBerry"],[m,R]],[/(?:\b|asus_)(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus\s7|padfone|p00[cj])/i],[h,[f,"ASUS"],[m,w]],[/\s(z[es]6[027][01][km][ls]|zenfone\s\d\w?)\b/i],[h,[f,"ASUS"],[m,R]],[/(nexus\s9)/i],[h,[f,"HTC"],[m,w]],[/(htc)[;_\s-]{1,2}([\w\s]+(?=\)|\sbuild)|\w+)/i,/(zte)-(\w*)/i,/(alcatel|geeksphone|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]*)/i],[f,[h,/_/g," "],[m,R]],[/droid[x\d\.\s;]+\s([ab][1-7]\-?[0178a]\d\d?)/i],[h,[f,"Acer"],[m,w]],[/droid.+;\s(m[1-5]\snote)\sbuild/i,/\bmz-([\w-]{2,})/i],[h,[f,"Meizu"],[m,R]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]*)/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i,/(microsoft);\s(lumia[\s\w]+)/i,/(lenovo)[_\s-]?([\w-]+)/i,/linux;.+(jolla);/i,/droid.+;\s(oppo)\s?([\w\s]+)\sbuild/i],[f,h,[m,R]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i,/[;\/]\s?(le[\s\-]+pan)[\s\-]+(\w{1,9})\sbuild/i,/[;\/]\s?(trinity)[\-\s]*(t\d{3})\sbuild/i,/\b(gigaset)[\s\-]+(q\w{1,9})\sbuild/i,/\b(vodafone)\s([\w\s]+)(?:\)|\sbuild)/i],[f,h,[m,w]],[/\s(surface\sduo)\s/i],[h,[f,"Microsoft"],[m,w]],[/droid\s[\d\.]+;\s(fp\du?)\sbuild/i],[h,[f,"Fairphone"],[m,R]],[/\s(u304aa)\sbuild/i],[h,[f,"AT&T"],[m,R]],[/sie-(\w*)/i],[h,[f,"Siemens"],[m,R]],[/[;\/]\s?(rct\w+)\sbuild/i],[h,[f,"RCA"],[m,w]],[/[;\/\s](venue[\d\s]{2,7})\sbuild/i],[h,[f,"Dell"],[m,w]],[/[;\/]\s?(q(?:mv|ta)\w+)\sbuild/i],[h,[f,"Verizon"],[m,w]],[/[;\/]\s(?:barnes[&\s]+noble\s|bn[rt])([\w\s\+]*)\sbuild/i],[h,[f,"Barnes & Noble"],[m,w]],[/[;\/]\s(tm\d{3}\w+)\sbuild/i],[h,[f,"NuVision"],[m,w]],[/;\s(k88)\sbuild/i],[h,[f,"ZTE"],[m,w]],[/;\s(nx\d{3}j)\sbuild/i],[h,[f,"ZTE"],[m,R]],[/[;\/]\s?(gen\d{3})\sbuild.*49h/i],[h,[f,"Swiss"],[m,R]],[/[;\/]\s?(zur\d{3})\sbuild/i],[h,[f,"Swiss"],[m,w]],[/[;\/]\s?((zeki)?tb.*\b)\sbuild/i],[h,[f,"Zeki"],[m,w]],[/[;\/]\s([yr]\d{2})\sbuild/i,/[;\/]\s(dragon[\-\s]+touch\s|dt)(\w{5})\sbuild/i],[[f,"Dragon Touch"],h,[m,w]],[/[;\/]\s?(ns-?\w{0,9})\sbuild/i],[h,[f,"Insignia"],[m,w]],[/[;\/]\s?((nxa|Next)-?\w{0,9})\sbuild/i],[h,[f,"NextBook"],[m,w]],[/[;\/]\s?(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05]))\sbuild/i],[[f,"Voice"],h,[m,R]],[/[;\/]\s?(lvtel\-)?(v1[12])\sbuild/i],[[f,"LvTel"],h,[m,R]],[/;\s(ph-1)\s/i],[h,[f,"Essential"],[m,R]],[/[;\/]\s?(v(100md|700na|7011|917g).*\b)\sbuild/i],[h,[f,"Envizen"],[m,w]],[/[;\/]\s?(trio[\s\w\-\.]+)\sbuild/i],[h,[f,"MachSpeed"],[m,w]],[/[;\/]\s?tu_(1491)\sbuild/i],[h,[f,"Rotor"],[m,w]],[/(shield[\w\s]+)\sbuild/i],[h,[f,"Nvidia"],[m,w]],[/(sprint)\s(\w+)/i],[f,h,[m,R]],[/(kin\.[onetw]{3})/i],[[h,/\./g," "],[f,"Microsoft"],[m,R]],[/droid\s[\d\.]+;\s(cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[h,[f,"Zebra"],[m,w]],[/droid\s[\d\.]+;\s(ec30|ps20|tc[2-8]\d[kx])\)/i],[h,[f,"Zebra"],[m,R]],[/\s(ouya)\s/i,/(nintendo)\s([wids3utch]+)/i],[f,h,[m,T]],[/droid.+;\s(shield)\sbuild/i],[h,[f,"Nvidia"],[m,T]],[/(playstation\s[345portablevi]+)/i],[h,[f,"Sony"],[m,T]],[/[\s\(;](xbox(?:\sone)?(?!;\sxbox))[\s\);]/i],[h,[f,"Microsoft"],[m,T]],[/smart-tv.+(samsung)/i],[f,[m,O]],[/hbbtv.+maple;(\d+)/i],[[h,/^/,"SmartTV"],[f,"Samsung"],[m,O]],[/(?:linux;\snetcast.+smarttv|lg\snetcast\.tv-201\d)/i],[[f,"LG"],[m,O]],[/(apple)\s?tv/i],[f,[h,"Apple TV"],[m,O]],[/crkey/i],[[h,"Chromecast"],[f,"Google"],[m,O]],[/droid.+aft([\w])(\sbuild\/|\))/i],[h,[f,"Amazon"],[m,O]],[/\(dtv[\);].+(aquos)/i],[h,[f,"Sharp"],[m,O]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[f,j.trim],[h,j.trim],[m,O]],[/[\s\/\(](android\s|smart[-\s]?|opera\s)tv[;\)\s]/i],[[m,O]],[/((pebble))app\/[\d\.]+\s/i],[f,h,[m,B]],[/droid.+;\s(glass)\s\d/i],[h,[f,"Google"],[m,B]],[/droid\s[\d\.]+;\s(wt63?0{2,3})\)/i],[h,[f,"Zebra"],[m,B]],[/(tesla)(?:\sqtcarbrowser|\/20[12]\d\.[\w\.-]+)/i],[f,[m,K]],[/droid .+?; ([^;]+?)(?: build|\) applewebkit).+? mobile safari/i],[h,[m,R]],[/droid .+?;\s([^;]+?)(?: build|\) applewebkit).+?(?! mobile) safari/i],[h,[m,w]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[m,j.lowerize]],[/(android[\w\.\s\-]{0,9});.+build/i],[h,[f,"Generic"]],[/(phone)/i],[[m,R]]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[_,[p,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[_,[p,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[p,_],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[_,p]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[p,_],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s\w]*)/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)(?!.+xbox)/i],[p,[_,nt.str,It.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[p,"Windows"],[_,nt.str,It.os.windows.version]],[/ip[honead]{2,4}\b(?:.*os\s([\w]+)\slike\smac|;\sopera)/i,/cfnetwork\/.+darwin/i],[[_,/_/g,"."],[p,"iOS"]],[/(mac\sos\sx)\s?([\w\s\.]*)/i,/(macintosh|mac(?=_powerpc)\s)(?!.+haiku)/i],[[p,"Mac OS"],[_,/_/g,"."]],[/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|sailfish|contiki)[\/\s-]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/\s]([\w\.]+)/i,/\((series40);/i],[p,_],[/\(bb(10);/i],[_,[p,"BlackBerry"]],[/(?:symbian\s?os|symbos|s60(?=;)|series60)[\/\s-]?([\w\.]*)/i],[_,[p,"Symbian"]],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[p,"Firefox OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[_,[p,"webOS"]],[/crkey\/([\d\.]+)/i],[_,[p,"Chromecast"]],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[p,"Chromium OS"],_],[/(nintendo|playstation)\s([wids345portablevuch]+)/i,/(xbox);\s+xbox\s([^\);]+)/i,/(mint)[\/\s\(\)]?(\w*)/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?=\slinux)|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus|raspbian)(?:\sgnu\/linux)?(?:\slinux)?[\/\s-]?(?!chrom|package)([\w\.-]*)/i,/(hurd|linux)\s?([\w\.]*)/i,/(gnu)\s?([\w\.]*)/i,/\s([frentopc-]{0,4}bsd|dragonfly)\s?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku)\s(\w+)/i],[p,_],[/(sunos)\s?([\w\.\d]*)/i],[[p,"Solaris"],_],[/((?:open)?solaris)[\/\s-]?([\w\.]*)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.])*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms|fuchsia)/i,/(unix)\s?([\w\.]*)/i],[p,_]]},Rt=function(H,W){if(typeof H=="object"&&(W=H,H=i),!(this instanceof Rt))return new Rt(H,W).getResult();var U=H||(r!==void 0&&r.navigator&&r.navigator.userAgent?r.navigator.userAgent:""),Ct=W?j.extend(vt,W):vt;return this.getBrowser=function(){var Et={name:i,version:i};return nt.rgx.call(Et,U,Ct.browser),Et.major=j.major(Et.version),Et},this.getCPU=function(){var Et={architecture:i};return nt.rgx.call(Et,U,Ct.cpu),Et},this.getDevice=function(){var Et={vendor:i,model:i,type:i};return nt.rgx.call(Et,U,Ct.device),Et},this.getEngine=function(){var Et={name:i,version:i};return nt.rgx.call(Et,U,Ct.engine),Et},this.getOS=function(){var Et={name:i,version:i};return nt.rgx.call(Et,U,Ct.os),Et},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return U},this.setUA=function(Et){return U=typeof Et===d&&Et.length>255?j.trim(Et,255):Et,this},this.setUA(U),this};Rt.VERSION="0.7.28",Rt.BROWSER={NAME:p,MAJOR:"major",VERSION:_},Rt.CPU={ARCHITECTURE:v},Rt.DEVICE={MODEL:h,VENDOR:f,TYPE:m,CONSOLE:T,MOBILE:R,SMARTTV:O,TABLET:w,WEARABLE:B,EMBEDDED:K},Rt.ENGINE={NAME:p,VERSION:_},Rt.OS={NAME:p,VERSION:_},e.exports&&(t=e.exports=Rt),t.UAParser=Rt;var X=r!==void 0&&(r.jQuery||r.Zepto);if(X&&!X.ua){var rt=new Rt;X.ua=rt.getResult(),X.ua.get=function(){return rt.getUA()},X.ua.set=function(H){rt.setUA(H);var W=rt.getResult();for(var U in W)X.ua[U]=W[U]}}})(typeof window=="object"?window:a)})(Rm,Rm.exports);const ym=new Rm.exports;let zs=ym.getResult();function Se(e){return e&&ym.setUA(e),zs=ym.getResult(),{name:G4(zs),version:j4(zs),os:H4(zs),osVersion:zs.os.version}}function G4(e){if(e.engine.name==="Blink"&&e.browser.name!=="WeChat")return ye.CHROME;switch(e.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return ye.CHROME;case"Safari":case"Mobile Safari":return ye.SAFARI;case"Edge":return ye.EDGE;case"Firefox":return ye.FIREFOX;case"QQBrowser":return ye.QQ;case"Opera":return ye.OPERA;case"WeChat":return ye.WECHAT;default:return e.browser.name||""}}function j4(e){let t;return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",t.split(".")[0]}function H4(e){switch(e.os.name){case"Windows":return e.os.version?e.os.name+" "+e.os.version:e.os.name;default:return e.os.name||""}}function fp(){return Se().os}function $d(){const e=Se();return!!(zs.engine.name==="WebKit"&&e.os===mn.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==ye.SAFARI||ui()&&e.name!==ye.SAFARI)}function K4(){const e=Se();if($d()){if(e.os===mn.MAC_OS)return!0;if(e.os===mn.IOS){const t=zs.os.version&&zs.os.version.split(".");if(t&&Number(t[0])===14&&t[1]&&Number(t[1])>=3||t&&Number(t[0])>14)return!0}}return!1}function W4(){return zs.engine.name==="WebKit"}function tu(){return Se().name===ye.CHROME}function Ri(){return Se().name===ye.SAFARI}function Gr(){return Se().name===ye.FIREFOX}function ui(){return Se().os===mn.IOS}function Xs(){const e=Se();if(e.os!==mn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15}function B1(){const e=Se();if(e.os!==mn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])===0}function M1(){const e=Se();if(e.os!==mn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function gp(){const e=Se();if(e.os!==mn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=2}function Zo(){return Ri()&&navigator.maxTouchPoints>0}function mp(){return Se().name===ye.WECHAT}function U1(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function El(){const e=Se();return e.name===ye.EDGE||e.name===ye.SAFARI?!1:!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}var Y4=Ae,q4=N,x1=G.Date,J4=q4(x1.prototype.getTime);Y4({target:"Date",stat:!0},{now:function(){return J4(new x1)}});var ht=Ir.Date.now,z4=Ae,wm=G,X4=Dt,Z4=J,$4=Kd,t5=/MSIE .\./.test(Pn),e5=wm.Function,F1=function(e){return function(t,r){var i=arguments.length>2,s=i?$4(arguments,2):void 0;return e(i?function(){X4(Z4(t)?t:e5(t),this,s)}:t,r)}};z4({global:!0,bind:!0,forced:t5},{setTimeout:F1(wm.setTimeout),setInterval:F1(wm.setInterval)});var ar=Ir.setTimeout,bm={exports:{}},Q1=function(e,t){return function(){for(var r=new Array(arguments.length),i=0;i<r.length;i++)r[i]=arguments[i];return e.apply(t,r)}},r5=Q1,n5=function(e){return e!=null&&e.constructor!=null&&typeof e.constructor.isBuffer=="function"&&e.constructor.isBuffer(e)},_l=Object.prototype.toString;function V1(e){return _l.call(e)==="[object Array]"}function G1(e){return e!==null&&typeof e=="object"}function j1(e){return _l.call(e)==="[object Function]"}function Ep(e,t){if(e!=null)if(typeof e!="object"&&(e=[e]),V1(e))for(var r=0,i=e.length;r<i;r++)t.call(null,e[r],r,e);else for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.call(null,e[s],s,e)}var ao={isArray:V1,isArrayBuffer:function(e){return _l.call(e)==="[object ArrayBuffer]"},isBuffer:n5,isFormData:function(e){return typeof FormData!="undefined"&&e instanceof FormData},isArrayBufferView:function(e){return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return typeof e=="string"},isNumber:function(e){return typeof e=="number"},isObject:G1,isUndefined:function(e){return e===void 0},isDate:function(e){return _l.call(e)==="[object Date]"},isFile:function(e){return _l.call(e)==="[object File]"},isBlob:function(e){return _l.call(e)==="[object Blob]"},isFunction:j1,isStream:function(e){return G1(e)&&j1(e.pipe)},isURLSearchParams:function(e){return typeof URLSearchParams!="undefined"&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return(typeof navigator=="undefined"||navigator.product!=="ReactNative"&&navigator.product!=="NativeScript"&&navigator.product!=="NS")&&typeof window!="undefined"&&typeof document!="undefined"},forEach:Ep,merge:function e(){var t={};function r(l,d){typeof t[d]=="object"&&typeof l=="object"?t[d]=e(t[d],l):t[d]=l}for(var i=0,s=arguments.length;i<s;i++)Ep(arguments[i],r);return t},deepMerge:function e(){var t={};function r(l,d){typeof t[d]=="object"&&typeof l=="object"?t[d]=e(t[d],l):t[d]=typeof l=="object"?e({},l):l}for(var i=0,s=arguments.length;i<s;i++)Ep(arguments[i],r);return t},extend:function(e,t,r){return Ep(t,function(i,s){e[s]=r&&typeof i=="function"?r5(i,r):i}),e},trim:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}},Il=ao;function H1(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var K1=function(e,t,r){if(!t)return e;var i;if(r)i=r(t);else if(Il.isURLSearchParams(t))i=t.toString();else{var s=[];Il.forEach(t,function(d,h){d!=null&&(Il.isArray(d)?h+="[]":d=[d],Il.forEach(d,function(p){Il.isDate(p)?p=p.toISOString():Il.isObject(p)&&(p=JSON.stringify(p)),s.push(H1(h)+"="+H1(p))}))}),i=s.join("&")}if(i){var l=e.indexOf("#");l!==-1&&(e=e.slice(0,l)),e+=(e.indexOf("?")===-1?"?":"&")+i}return e},i5=ao;function _p(){this.handlers=[]}_p.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},_p.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},_p.prototype.forEach=function(e){i5.forEach(this.handlers,function(t){t!==null&&e(t)})};var o5=_p,s5=ao,W1=function(e){return!(!e||!e.__CANCEL__)},a5=ao,c5=function(e,t,r,i,s){return e.config=t,r&&(e.code=r),e.request=i,e.response=s,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e},Y1=function(e,t,r,i,s){var l=new Error(e);return c5(l,t,r,i,s)},l5=Y1,Nm=ao,d5=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],q1=ao,u5=q1.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");function i(s){var l=s;return t&&(r.setAttribute("href",l),l=r.href),r.setAttribute("href",l),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:r.pathname.charAt(0)==="/"?r.pathname:"/"+r.pathname}}return e=i(window.location.href),function(s){var l=q1.isString(s)?i(s):s;return l.protocol===e.protocol&&l.host===e.host}}():function(){return!0},Ip=ao,h5=Ip.isStandardBrowserEnv()?{write:function(e,t,r,i,s,l){var d=[];d.push(e+"="+encodeURIComponent(t)),Ip.isNumber(r)&&d.push("expires="+new Date(r).toGMTString()),Ip.isString(i)&&d.push("path="+i),Ip.isString(s)&&d.push("domain="+s),l===!0&&d.push("secure"),document.cookie=d.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},Om=ao,p5=function(e,t,r){var i=r.config.validateStatus;!i||i(r.status)?e(r):t(l5("Request failed with status code "+r.status,r.config,null,r.request,r))},A5=K1,f5=function(e){var t,r,i,s={};return e&&Nm.forEach(e.split(`
`),function(l){if(i=l.indexOf(":"),t=Nm.trim(l.substr(0,i)).toLowerCase(),r=Nm.trim(l.substr(i+1)),t){if(s[t]&&d5.indexOf(t)>=0)return;s[t]=t==="set-cookie"?(s[t]?s[t]:[]).concat([r]):s[t]?s[t]+", "+r:r}}),s},g5=u5,km=Y1,m5=function(e){return new Promise(function(t,r){var i=e.data,s=e.headers;Om.isFormData(i)&&delete s["Content-Type"];var l=new XMLHttpRequest;if(e.auth){var d=e.auth.username||"",h=e.auth.password||"";s.Authorization="Basic "+btoa(d+":"+h)}if(l.open(e.method.toUpperCase(),A5(e.url,e.params,e.paramsSerializer),!0),l.timeout=e.timeout,l.onreadystatechange=function(){if(l&&l.readyState===4&&(l.status!==0||l.responseURL&&l.responseURL.indexOf("file:")===0)){var f="getAllResponseHeaders"in l?f5(l.getAllResponseHeaders()):null,_={data:e.responseType&&e.responseType!=="text"?l.response:l.responseText,status:l.status,statusText:l.statusText,headers:f,config:e,request:l};p5(t,r,_),l=null}},l.onabort=function(){l&&(r(km("Request aborted",e,"ECONNABORTED",l)),l=null)},l.onerror=function(){r(km("Network Error",e,null,l)),l=null},l.ontimeout=function(){r(km("timeout of "+e.timeout+"ms exceeded",e,"ECONNABORTED",l)),l=null},Om.isStandardBrowserEnv()){var p=h5,m=(e.withCredentials||g5(e.url))&&e.xsrfCookieName?p.read(e.xsrfCookieName):void 0;m&&(s[e.xsrfHeaderName]=m)}if("setRequestHeader"in l&&Om.forEach(s,function(f,_){i===void 0&&_.toLowerCase()==="content-type"?delete s[_]:l.setRequestHeader(_,f)}),e.withCredentials&&(l.withCredentials=!0),e.responseType)try{l.responseType=e.responseType}catch(f){if(e.responseType!=="json")throw f}typeof e.onDownloadProgress=="function"&&l.addEventListener("progress",e.onDownloadProgress),typeof e.onUploadProgress=="function"&&l.upload&&l.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then(function(f){l&&(l.abort(),r(f),l=null)}),i===void 0&&(i=null),l.send(i)})},Qi=ao,J1=function(e,t){a5.forEach(e,function(r,i){i!==t&&i.toUpperCase()===t.toUpperCase()&&(e[t]=r,delete e[i])})},E5={"Content-Type":"application/x-www-form-urlencoded"};function z1(e,t){!Qi.isUndefined(e)&&Qi.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var X1,vp={adapter:((typeof process!="undefined"&&Object.prototype.toString.call(process)==="[object process]"||typeof XMLHttpRequest!="undefined")&&(X1=m5),X1),transformRequest:[function(e,t){return J1(t,"Accept"),J1(t,"Content-Type"),Qi.isFormData(e)||Qi.isArrayBuffer(e)||Qi.isBuffer(e)||Qi.isStream(e)||Qi.isFile(e)||Qi.isBlob(e)?e:Qi.isArrayBufferView(e)?e.buffer:Qi.isURLSearchParams(e)?(z1(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):Qi.isObject(e)?(z1(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if(typeof e=="string")try{e=JSON.parse(e)}catch{}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(e){return e>=200&&e<300}};vp.headers={common:{Accept:"application/json, text/plain, */*"}},Qi.forEach(["delete","get","head"],function(e){vp.headers[e]={}}),Qi.forEach(["post","put","patch"],function(e){vp.headers[e]=Qi.merge(E5)});var Z1=vp,$1=ao,Dm=function(e,t,r){return s5.forEach(r,function(i){e=i(e,t)}),e},_5=W1,I5=Z1,v5=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)},C5=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e};function Lm(e){e.cancelToken&&e.cancelToken.throwIfRequested()}var vc=ao,tR=function(e,t){t=t||{};var r={};return vc.forEach(["url","method","params","data"],function(i){t[i]!==void 0&&(r[i]=t[i])}),vc.forEach(["headers","auth","proxy"],function(i){vc.isObject(t[i])?r[i]=vc.deepMerge(e[i],t[i]):t[i]!==void 0?r[i]=t[i]:vc.isObject(e[i])?r[i]=vc.deepMerge(e[i]):e[i]!==void 0&&(r[i]=e[i])}),vc.forEach(["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","maxContentLength","validateStatus","maxRedirects","httpAgent","httpsAgent","cancelToken","socketPath"],function(i){t[i]!==void 0?r[i]=t[i]:e[i]!==void 0&&(r[i]=e[i])}),r},Cp=ao,S5=K1,eR=o5,T5=function(e){return Lm(e),e.baseURL&&!v5(e.url)&&(e.url=C5(e.baseURL,e.url)),e.headers=e.headers||{},e.data=Dm(e.data,e.headers,e.transformRequest),e.headers=$1.merge(e.headers.common||{},e.headers[e.method]||{},e.headers||{}),$1.forEach(["delete","get","head","post","put","patch","common"],function(t){delete e.headers[t]}),(e.adapter||I5.adapter)(e).then(function(t){return Lm(e),t.data=Dm(t.data,t.headers,e.transformResponse),t},function(t){return _5(t)||(Lm(e),t&&t.response&&(t.response.data=Dm(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)})},rR=tR;function eu(e){this.defaults=e,this.interceptors={request:new eR,response:new eR}}eu.prototype.request=function(e){typeof e=="string"?(e=arguments[1]||{}).url=arguments[0]:e=e||{},(e=rR(this.defaults,e)).method=e.method?e.method.toLowerCase():"get";var t=[T5,void 0],r=Promise.resolve(e);for(this.interceptors.request.forEach(function(i){t.unshift(i.fulfilled,i.rejected)}),this.interceptors.response.forEach(function(i){t.push(i.fulfilled,i.rejected)});t.length;)r=r.then(t.shift(),t.shift());return r},eu.prototype.getUri=function(e){return e=rR(this.defaults,e),S5(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},Cp.forEach(["delete","get","head","options"],function(e){eu.prototype[e]=function(t,r){return this.request(Cp.merge(r||{},{method:e,url:t}))}}),Cp.forEach(["post","put","patch"],function(e){eu.prototype[e]=function(t,r,i){return this.request(Cp.merge(i||{},{method:e,url:t,data:r}))}});var R5=eu;function Pm(e){this.message=e}Pm.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},Pm.prototype.__CANCEL__=!0;var nR=Pm,y5=nR;function Sp(e){if(typeof e!="function")throw new TypeError("executor must be a function.");var t;this.promise=new Promise(function(i){t=i});var r=this;e(function(i){r.reason||(r.reason=new y5(i),t(r.reason))})}Sp.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},Sp.source=function(){var e;return{token:new Sp(function(t){e=t}),cancel:e}};var w5=Sp,iR=ao,b5=Q1,Tp=R5,N5=tR;function oR(e){var t=new Tp(e),r=b5(Tp.prototype.request,t);return iR.extend(r,Tp.prototype,t),iR.extend(r,t),r}var Ts=oR(Z1);Ts.Axios=Tp,Ts.create=function(e){return oR(N5(Ts.defaults,e))},Ts.Cancel=nR,Ts.CancelToken=w5,Ts.isCancel=W1,Ts.all=function(e){return Promise.all(e)},Ts.spread=function(e){return function(t){return e.apply(null,t)}},bm.exports=Ts,bm.exports.default=Ts;var wo=bm.exports;function Bm(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const co={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},Rp=ht(),Mm=e=>{for(const t in co)if(Object.prototype.hasOwnProperty.call(co,t)&&co[t]===e)return t;return"DEFAULT"},S=new class{constructor(){this.logLevel=co.DEBUG,this.uploadState="collecting",this.uploadLogWaitingList=[],this.uploadLogUploadingList=[],this.uploadErrorCount=0,this.currentLogID=0}debug(){for(var e,t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];const s=k(e=[co.DEBUG]).call(e,r);this.log.apply(this,s)}info(){for(var e,t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];const s=k(e=[co.INFO]).call(e,r);this.log.apply(this,s)}warning(){for(var e,t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];const s=k(e=[co.WARNING]).call(e,r);this.log.apply(this,s)}error(){for(var e,t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];const s=k(e=[co.ERROR]).call(e,r);this.log.apply(this,s)}upload(){for(var e,t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];const s=k(e=[co.DEBUG]).call(e,r);this.uploadLog.apply(this,s)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){jr("UPLOAD_LOG",!0)}disableLogUpload(){jr("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}log(){for(var e,t,r,i,s=arguments.length,l=new Array(s),d=0;d<s;d++)l[d]=arguments[d];if(ht()-Rp<100)return void ar(()=>{this.log(...l)},ht()-Rp);const h=Math.max(0,Math.min(4,l[0]));if(l[0]=Bm()+" Agora-SDK [".concat(Mm(h),"]:"),this.appendLogToWaitingList(h,l),h<this.logLevel)return;const p=Bm()+" %cAgora-SDK [".concat(Mm(h),"]:");let m=[];switch(h){case co.DEBUG:m=k(e=[p,"color: #64B5F6;"]).call(e,rn(l).call(l,1)),console.log.apply(console,m);break;case co.INFO:m=k(t=[p,"color: #1E88E5; font-weight: bold;"]).call(t,rn(l).call(l,1)),console.log.apply(console,m);break;case co.WARNING:m=k(r=[p,"color: #FB8C00; font-weight: bold;"]).call(r,rn(l).call(l,1)),console.warn.apply(console,m);break;case co.ERROR:m=k(i=[p,"color: #B00020; font-weight: bold;"]).call(i,rn(l).call(l,1)),console.error.apply(console,m)}}uploadLog(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(ht()-Rp<100)return void ar(()=>{this.uploadLog(...t)},ht()-Rp);const i=Math.max(0,Math.min(4,t[0]));t[0]=Bm()+" Agora-SDK [".concat(Mm(i),"]:"),this.appendLogToWaitingList(i,t)}appendLogToWaitingList(e){if(!it("UPLOAD_LOG"))return;let t="";for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];V(i).call(i,l=>{typeof l=="object"&&(l=St(l)),t+="".concat(l," ")}),this.uploadLogWaitingList.push({payload_str:t,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){var e;const t=this.uploadLogUploadingList,r={sdk_version:Tn,process_id:it("PROCESS_ID"),payload:St(t)},i=await wo.post(this.url||(this.proxyServerURL?k(e="https://".concat(this.proxyServerURL,"/ls/?h=")).call(e,it("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(it("LOG_UPLOAD_SERVER"),"/upload/v1")),r,{responseType:"text"});if(i.data!=="OK")throw new Error("unexpected upload log response: "+i.data);this.uploadLogUploadingList=[]}uploadLogInterval(){if(this.uploadLogUploadingList.length!==0||this.uploadLogWaitingList.length!==0){var e;this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=Ye(e=this.uploadLogWaitingList).call(e,0,10)),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&ar(()=>this.uploadLogInterval(),3e3)}).catch(t=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?ar(()=>this.uploadLogInterval(),200):ar(()=>this.uploadLogInterval(),1e3)})}}},vl="v4.8.2-0-gac13671f-dirty(1/27/2022, 7:56:46 PM)",Tn=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(t&&t[1]&&t[2]){var r;const l=t[1],d=t[2];return k(r="".concat(l,".")).call(r,d)}const i=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(i&&i[1]&&i[2]){var s;const l=i[1],d=i[2];return k(s="".concat(l,".")).call(s,100*(Number(d)+1))}return"4.0.0.999"}("4.8.2"),ru=function(){try{return JSON.parse("true")===!0}catch{return!0}}(),qe={username:"test",password:"111111",turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1},O5={"90p":me(160,90),"90p_1":me(160,90),"120p":me(160,120,15,30,65),"120p_1":me(160,120,15,30,65),"120p_3":me(120,120,15,30,50),"120p_4":me(212,120),"180p":me(320,180,15,30,140),"180p_1":me(320,180,15,30,140),"180p_3":me(180,180,15,30,100),"180p_4":me(240,180,15,30,120),"240p":me(320,240,15,40,200),"240p_1":me(320,240,15,40,200),"240p_3":me(240,240,15,40,140),"240p_4":me(424,240,15,40,220),"360p":me(640,360,15,80,400),"360p_1":me(640,360,15,80,400),"360p_3":me(360,360,15,80,260),"360p_4":me(640,360,30,80,600),"360p_6":me(360,360,30,80,400),"360p_7":me(480,360,15,80,320),"360p_8":me(480,360,30,80,490),"360p_9":me(640,360,15,80,800),"360p_10":me(640,360,24,80,800),"360p_11":me(640,360,24,80,1e3),"480p":me(640,480,15,100,500),"480p_1":me(640,480,15,100,500),"480p_2":me(640,480,30,100,1e3),"480p_3":me(480,480,15,100,400),"480p_4":me(640,480,30,100,750),"480p_6":me(480,480,30,100,600),"480p_8":me(848,480,15,100,610),"480p_9":me(848,480,30,100,930),"480p_10":me(640,480,10,100,400),"720p":me(1280,720,15,120,1130),"720p_1":me(1280,720,15,120,1130),"720p_2":me(1280,720,30,120,2e3),"720p_3":me(1280,720,30,120,1710),"720p_5":me(960,720,15,120,910),"720p_6":me(960,720,30,120,1380),"1080p":me(1920,1080,15,120,2080),"1080p_1":me(1920,1080,15,120,2080),"1080p_2":me(1920,1080,30,120,3e3),"1080p_3":me(1920,1080,30,120,3150),"1080p_5":me(1920,1080,60,120,4780),"1440p":me(2560,1440,30,120,4850),"1440p_1":me(2560,1440,30,120,4850),"1440p_2":me(2560,1440,60,120,7350),"4k":me(3840,2160,30,120,8910),"4k_1":me(3840,2160,30,120,8910),"4k_3":me(3840,2160,60,120,13500)},k5={"480p":bo(640,480,5),"480p_1":bo(640,480,5),"480p_2":bo(640,480,30),"480p_3":bo(640,480,15),"720p":bo(1280,720,5),"720p_1":bo(1280,720,5),"720p_2":bo(1280,720,30),"720p_3":bo(1280,720,15),"1080p":bo(1920,1080,5),"1080p_1":bo(1920,1080,5),"1080p_2":bo(1920,1080,30),"1080p_3":bo(1920,1080,15)},D5={"1SL1TL":xm(1,1),"3SL3TL":xm(3,3),"2SL3TL":xm(2,3)};function $o(e){return typeof e=="string"?hr({},O5[e]):e}function nu(e){return typeof e=="string"?hr({},k5[e]):e}function Ba(e){return typeof e=="string"?hr({},D5[e]):e}const L5={speech_low_quality:Cl(16e3,!1),speech_standard:Cl(32e3,!1,18),music_standard:Cl(48e3,!1),standard_stereo:Cl(48e3,!0,56),high_quality:Cl(48e3,!1,128),high_quality_stereo:Cl(48e3,!0,192)};function Cc(e){return typeof e=="string"?hr({},L5[e]):e}function jr(e,t,r){var i,s;qt(i=ae(hi)).call(i,e)&&(!r&&qt(s=ae(Um)).call(s,e)||(hi[e]=t))}function it(e){return hi[e]}const hi={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],SUBSCRIBE_TCC:!0,PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,USE_RTX:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,SDK_FALLBACK:!0,ENUMERATE_DEVICES_INTERVAL:!0,H264_PROFILE_LEVEL_ID:"",SDP_LOGGING:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},USE_NEW_TOKEN:!0},Um={};function Cl(e,t,r){return{sampleRate:e,stereo:t,bitrate:r}}function me(e,t,r,i,s){return{width:e,height:t,frameRate:r,bitrateMin:i,bitrateMax:s}}function bo(e,t,r,i,s){return{width:{max:e},height:{max:t},frameRate:r,bitrateMin:i,bitrateMax:s}}function xm(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}ru||(hi.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],hi.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],hi.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],hi.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],hi.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],hi.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],hi.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",hi.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",hi.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",hi.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",hi.AREAS=["NORTH_AMERICA","OVERSEA"]);const sR=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],ts=[],Zs=[];function aR(e){qt(ts).call(ts,e)||ts.push(e)}function cR(e){const t=xt(ts).call(ts,e);t!==-1&&Ye(ts).call(ts,t,1)}function lR(e){qt(Zs).call(Zs,e)||Zs.push(e)}function dR(e){const t=xt(Zs).call(Zs,e);t!==-1&&Ye(Zs).call(Zs,t,1)}Ae({target:"Array",stat:!0},{isArray:kd});var tn=Ir.Array.isArray,uR=Rg,P5=Math.floor,Fm=function(e,t){var r=e.length,i=P5(r/2);return r<8?B5(e,t):M5(e,Fm(uR(e,0,i),t),Fm(uR(e,i),t),t)},B5=function(e,t){for(var r,i,s=e.length,l=1;l<s;){for(i=l,r=e[l];i&&t(e[i-1],r)>0;)e[i]=e[--i];i!==l++&&(e[i]=r)}return e},M5=function(e,t,r,i){for(var s=t.length,l=r.length,d=0,h=0;d<s||h<l;)e[d+h]=d<s&&h<l?i(t[d],r[h])<=0?t[d++]:r[h++]:d<s?t[d++]:r[h++];return e},hR=Fm,pR=Pn.match(/firefox\/(\d+)/i),U5=!!pR&&+pR[1],x5=/MSIE|Trident/.test(Pn),AR=Pn.match(/AppleWebKit\/(\d+)\./),F5=!!AR&&+AR[1],Q5=Ae,fR=N,V5=Gn,G5=io,j5=yo,gR=Fi,Qm=u,H5=hR,K5=pc,mR=U5,W5=x5,ER=zo,_R=F5,Ma=[],IR=fR(Ma.sort),Y5=fR(Ma.push),q5=Qm(function(){Ma.sort(void 0)}),J5=Qm(function(){Ma.sort(null)}),z5=K5("sort"),vR=!Qm(function(){if(ER)return ER<70;if(!(mR&&mR>3)){if(W5)return!0;if(_R)return _R<603;var e,t,r,i,s="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(i=0;i<47;i++)Ma.push({k:t+i,v:r})}for(Ma.sort(function(l,d){return d.v-l.v}),i=0;i<Ma.length;i++)t=Ma[i].k.charAt(0),s.charAt(s.length-1)!==t&&(s+=t);return s!=="DGBEFHACIJK"}});Q5({target:"Array",proto:!0,forced:q5||!J5||!z5||!vR},{sort:function(e){e!==void 0&&V5(e);var t=G5(this);if(vR)return e===void 0?IR(t):IR(t,e);var r,i,s=[],l=j5(t);for(i=0;i<l;i++)i in t&&Y5(s,t[i]);for(H5(s,function(d){return function(h,p){return p===void 0?-1:h===void 0?1:d!==void 0?+d(h,p)||0:gR(h)>gR(p)?1:-1}}(e)),r=s.length,i=0;i<r;)t[i]=s[i++];for(;i<l;)delete t[i++];return t}});var D,CR,Bn,X5=$r("Array").sort,Z5=L,$5=X5,Vm=Array.prototype,Ua=function(e){var t=e.sort;return e===Vm||Z5(Vm,e)&&t===Vm.sort?$5:t};(function(e){e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P"})(D||(D={}));class P extends Error{constructor(t){var r;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",s=arguments.length>2?arguments[2]:void 0;super(i),this.name="AgoraRTCException",this.code=t,this.message=k(r="AgoraRTCError ".concat(this.code,": ")).call(r,i),this.data=s}toString(){var t;return this.data?k(t="data: ".concat(St(this.data),`
`)).call(t,this.stack):"".concat(this.stack)}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return t==="error"&&S.error(this.toString()),t==="warning"&&S.warning(this.toString()),this}throw(){throw this.print(),this}}function Sc(e,t){if(typeof e!="boolean")throw new P(D.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function Pr(e,t,r){var i;if(!qt(r).call(r,e))throw new P(D.INVALID_PARAMS,k(i="".concat(t," can only be set as ")).call(i,St(r)))}function Ie(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4,s=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e<r||e>i||s&&!tV(e)){var l,d;throw new P(D.INVALID_PARAMS,k(l=k(d="invalid ".concat(t,": the value range is [")).call(d,r,", ")).call(l,i,"]. integer only"))}}function pr(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,s=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new P(D.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));var l,d,h;if(!SR(e,r,i,s))throw new P(D.INVALID_PARAMS,k(l=k(d=k(h="Invalid ".concat(t||"string param",": Length of the string: [")).call(h,r,",")).call(d,i,"].")).call(l,s?" ASCII characters only.":""))}function yp(e,t){if(!tn(e))throw new P(D.INVALID_PARAMS,"".concat(t," should be an array"))}function wp(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw S.error("Invalid Channel Name ".concat(e)),new P(D.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function bp(e){var t,r;if(r=e,!(typeof r=="number"&&Math.floor(r)===r&&0<=r&&r<=4294967295||SR(e,1,255)))throw S.error(k(t="Invalid UID ".concat(e," ")).call(t,typeof e)),new P(D.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");typeof e=="string"&&S.warning("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}function $e(e){return e==null}function SR(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,i=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=r&&e.length>=t&&(!i||eV(e))}function tV(e){return typeof e=="number"&&e%1==0}function eV(e){if(typeof e!="string")return!1;for(let t=0;t<e.length;t+=1){const r=e.charCodeAt(t);if(r<0||r>255)return!1}return!0}(function(e){e.FREE="free",e.UPLOADING="uploading"})(CR||(CR={})),function(e){e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata"}(Bn||(Bn={}));const Gm={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};Ae({target:"Number",stat:!0},{MIN_SAFE_INTEGER:-9007199254740991});var TR=-9007199254740991;Ae({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991});var RR=9007199254740991;function rV(e){return pr(e.reportId,"params.reportId",0,100,!1),pr(e.category,"params.category",0,100,!1),pr(e.event,"params.event",0,100,!1),pr(e.label,"params.label",0,100,!1),Ie(e.value,"params.value",TR,RR,!1),!0}const nV={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};var Mn,kr,yR,Ht,Wt,Tc,$s,Sl,iu,Vi,jn,ne,Ve,pi,un,Ce,Fe,No,tr,wR,Oo;function bR(e){return Ie(e.timeout,"config.timeout",0,1e5),Ie(e.timeoutFactor,"config.timeoutFactor",0,100,!1),Ie(e.maxRetryCount,"config.maxRetryConfig",0,1/0),Ie(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}function iV(e){return Pr(e.codec,"config.codec",["vp8","vp9","av1","h264"]),Pr(e.mode,"config.mode",["rtc","live"]),e.proxyServer!==void 0&&pr(e.proxyServer,"config.proxyServer",1,1e4),e.turnServer!==void 0&&NR(e.turnServer),e.httpRetryConfig!==void 0&&bR(e.httpRetryConfig),e.websocketRetryConfig!==void 0&&bR(e.websocketRetryConfig),!0}function Np(e){if(!tn(e)||e.length<1)return!1;try{V(e).call(e,t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function NR(e){return pr(e.turnServerURL,"turnServerURL"),pr(e.username,"username"),pr(e.password,"password"),e.udpport&&Ie(e.udpport,"udpport",1,99999,!0),e.forceturn&&Sc(e.forceturn,"forceturn"),e.security&&Sc(e.security,"security"),e.tcpport&&Ie(e.tcpport,"tcpport",1,99999,!0),!0}function OR(e){return e.level!==void 0&&Pr(e.level,"level",[1,2,3]),!0}(function(e){e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics"})(Mn||(Mn={})),function(e){e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAT="io.agora.pb.Wrtc.JoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed"}(kr||(kr={})),function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}(yR||(yR={})),function(e){e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.ADD_INJECT_STREAM_URL="Client.addInjectStreamUrl",e.REMOVE_INJECT_STREAM_URL="Client.removeInjectStreamUrl",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage"}(Ht||(Ht={})),function(e){e.TRACER="tracer"}(Wt||(Wt={})),function(e){e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND"}(Tc||(Tc={})),function(e){e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged"}($s||($s={})),function(e){e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR"}(Sl||(Sl={})),function(e){e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR"}(iu||(iu={})),function(e){e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND"}(Vi||(Vi={})),function(e){e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV"}(jn||(jn={})),function(e){e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY"}(ne||(ne={})),function(e){e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.INJECT_STREAM_STATUS="stream-inject-status",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost"}(Ve||(Ve={})),function(e){e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED"}(pi||(pi={})),function(e){e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed"}(un||(un={})),function(e){e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response"}(Ce||(Ce={})),function(e){e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.SUBSCRIBE="subscribe",e.UNSUBSCRIBE="unsubscribe",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc"}(Fe||(Fe={})),function(e){e.PUBLISH_STATS="publish_stats",e.PUBLISH_RELATED_STATS="publish_related_stats",e.SUBSCRIBE_STATS="subscribe_stats",e.SUBSCRIBE_RELATED_STATS="subscribe_related_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length"}(No||(No={})),function(e){e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio"}(tr||(tr={})),function(e){e.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",e.NEED_ANSWER="NEED_ANSWER",e.NEED_RENEGOTIATE="NEED_RENEGOTIATE",e.P2P_LOST="P2P_LOST",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NEED_UNPUB="NEED_UNPUB",e.NEED_UNSUB="NEED_UNSUB",e.NEED_UPLOAD="NEED_UPLOAD",e.NEED_CONTROL="NEED_CONTROL",e.START_RECONNECT="START_RECONNECT",e.END_RECONNECT="END_RECONNECT",e.NEED_SIGNAL_RTT="NEED_SIGNAL_RTT"}(wR||(wR={})),function(e){e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer"}(Oo||(Oo={}));const ou={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,currentPacketLossRate:0},su={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},Op={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},jm={uplinkNetworkQuality:0,downlinkNetworkQuality:0},kp={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};var Je,Hr;(function(e){e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls"})(Je||(Je={})),function(e){e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e.INJECT="inject_streaming"}(Hr||(Hr={}));const oV={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},Hm={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function Km(e,t){pr(e.url,"".concat(t,".url"),1,1e3,!1),$e(e.x)||Ie(e.x,"".concat(t,".x"),0,1e4),$e(e.y)||Ie(e.y,"".concat(t,".y"),0,1e4),$e(e.width)||Ie(e.width,"".concat(t,".width"),0,1e4),$e(e.height)||Ie(e.height,"".concat(t,".height"),0,1e4),$e(e.zOrder)||Ie(e.zOrder,"".concat(t,".zOrder"),0,255),$e(e.alpha)||Ie(e.alpha,"".concat(t,".alpha"),0,1,!1)}const sV={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},aV={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};var ko,Tl,Or,kR,Hn,Kr,vr,Yt,Kn,ta,Rl;function DR(e){if(!e.channelName)throw new P(D.INVALID_PARAMS,"invalid channelName in info");if(!e.uid||typeof e.uid!="number")throw new P(D.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&pr(e.token,"info.token",1,2047),bp(e.uid),wp(e.channelName),!0}function LR(e){return Pr(e,"mediaSource",["screen","window","application"]),!0}(function(e){e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.INJECT_STREAM_STATUS="@live_uap-inject-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address"})(ko||(ko={})),function(e){e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager"}(Tl||(Tl={})),function(e){e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(Or||(Or={})),function(e){e.CONNECT_FAILED="connect failed",e.CONNECT_TIMEOUT="connect timeout",e.WS_DISCONNECTED="websocket disconnected",e.REQUEST_TIMEOUT="request timeout",e.REQUEST_FAILED="request failed",e.WAIT_STATUS_TIMEOUT="wait status timeout",e.WAIT_STATUS_ERROR="wait status error",e.BAD_STATE="bad state",e.WS_ABORT="ws abort",e.AP_REQUEST_TIMEOUT="AP request timeout",e.AP_JSON_PARSE_ERROR="AP json parse error",e.AP_REQUEST_ERROR="AP request error",e.AP_REQUEST_ABORT="AP request abort"}(kR||(kR={})),function(e){e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile"}(Hn||(Hn={})),function(e){e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low"}(Kr||(Kr={})),function(e){e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response"}(vr||(vr={})),function(e){e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track"}(Yt||(Yt={})),function(e){e.SCREEN_TRACK="screen_track",e.LOW_STREAM="low_stream"}(Kn||(Kn={})),function(e){e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status"}(ta||(ta={})),function(e){e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status"}(Rl||(Rl={}));const PR=["AFRICA","ASIA","CHINA","EUROPE","GLOBAL","INDIA","JAPAN","NORTH_AMERICA","OCEANIA","OVERSEA","SOUTH_AMERICA","KOREA"];var En;(function(e){e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL"})(En||(En={}));const Wm={CHINA:{},ASIA:{CODE:En.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:En.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:En.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:En.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","	uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:En.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:En.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:En.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:En.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:En.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:En.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:En.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]}};var au,BR,er,Ut,Gi,ze,lo,yl;ru&&(Wm.CHINA={CODE:En.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),function(e){e.UPDATE_BITRATE_LIMIT="update_bitrate_limit"}(au||(au={}));class Wr{constructor(){this._events={},this.addListener=this.on}getListeners(t){var r;return this._events[t]?pt(r=this._events[t]).call(r,i=>i.listener):[]}on(t,r){this._events[t]||(this._events[t]=[]);const i=this._events[t];this._indexOfListener(i,r)===-1&&i.push({listener:r,once:!1})}once(t,r){this._events[t]||(this._events[t]=[]);const i=this._events[t];this._indexOfListener(i,r)===-1&&i.push({listener:r,once:!0})}off(t,r){if(!this._events[t])return;const i=this._events[t],s=this._indexOfListener(i,r);s!==-1&&Ye(i).call(i,s,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){var r;this._events[t]||(this._events[t]=[]);const i=pt(r=this._events[t]).call(r,h=>h);for(var s=arguments.length,l=new Array(s>1?s-1:0),d=1;d<s;d++)l[d-1]=arguments[d];for(let h=0;h<i.length;h+=1){const p=i[h];p.once&&this.off(t,p.listener),p.listener.apply(this,l||[])}}_indexOfListener(t,r){let i=t.length;for(;i--;)if(t[i].listener===r)return i;return-1}}class MR extends Wr{constructor(t,r){super()}}(function(e){e.SEND="sendonly",e.RECV="recvonly",e.SENDRECV="sendrecv",e.INACTIVE="inactive"})(BR||(BR={})),function(e){e.VIDEO="video",e.AUDIO="audio"}(er||(er={})),function(e){e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack"}(Ut||(Ut={})),function(e){e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected"}(Gi||(Gi={})),function(e){e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost"}(ze||(ze={})),function(e){e.ONLINE="ONLINE",e.OFFLINE="OFFLINE"}(lo||(lo={})),function(e){e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE"}(yl||(yl={}));const cV={join:["startJoin","startRequestAp","startJoinGateway","finishJoin"],publish:["startPublish"]},Ai={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1};function Dr(){return Ai}var cu={},lV=en;cu.f=lV;var UR=Ir,dV=gn,uV=cu,hV=Ui.f,_n=function(e){var t=UR.Symbol||(UR.Symbol={});dV(t,e)||hV(t,e,{value:uV.f(e)})},wl=Ae,Ym=G,pV=ti,AV=Dt,lu=he,fV=N,bl=Ot,Rc=yd,qm=u,Rn=gn,gV=kd,mV=J,EV=Vr,_V=L,Jm=dr,zm=xi,IV=io,Dp=Vn,Xm=kh,xR=Fi,Zm=Re,du=gc,FR=Fh,vV=Vd,QR=Tg,$m=jh,VR=Ft,GR=Ui,CV=Bd,jR=Te,SV=Kd,tE=cl,uu=Nh.exports,HR=Ud,KR=Oh,WR=en,TV=cu,RV=_n,yV=Da,YR=oo,Lp=Xo.forEach,ji=Wh("hidden"),Pp="Symbol",qR=WR("toPrimitive"),wV=YR.set,JR=YR.getterFor(Pp),es=Object.prototype,xa=Ym.Symbol,yc=xa&&xa.prototype,zR=Ym.TypeError,eE=Ym.QObject,hu=pV("JSON","stringify"),XR=VR.f,Fa=GR.f,ZR=QR.f,bV=jR.f,$R=fV([].push),ea=uu("symbols"),pu=uu("op-symbols"),rE=uu("string-to-symbol-registry"),nE=uu("symbol-to-string-registry"),NV=uu("wks"),iE=!eE||!eE.prototype||!eE.prototype.findChild,oE=bl&&qm(function(){return du(Fa({},"a",{get:function(){return Fa(this,"a",{value:7}).a}})).a!=7})?function(e,t,r){var i=XR(es,t);i&&delete es[t],Fa(e,t,r),i&&e!==es&&Fa(es,t,i)}:Fa,sE=function(e,t){var r=ea[e]=du(yc);return wV(r,{type:Pp,tag:e,description:t}),bl||(r.description=t),r},Bp=function(e,t,r){e===es&&Bp(pu,t,r),zm(e);var i=Xm(t);return zm(r),Rn(ea,i)?(r.enumerable?(Rn(e,ji)&&e[ji][i]&&(e[ji][i]=!1),r=du(r,{enumerable:Zm(0,!1)})):(Rn(e,ji)||Fa(e,ji,Zm(1,{})),e[ji][i]=!0),oE(e,i,r)):Fa(e,i,r)},aE=function(e,t){zm(e);var r=Dp(t),i=FR(r).concat(cE(r));return Lp(i,function(s){bl&&!lu(ty,r,s)||Bp(e,s,r[s])}),e},ty=function(e){var t=Xm(e),r=lu(bV,this,t);return!(this===es&&Rn(ea,t)&&!Rn(pu,t))&&(!(r||!Rn(this,t)||!Rn(ea,t)||Rn(this,ji)&&this[ji][t])||r)},ey=function(e,t){var r=Dp(e),i=Xm(t);if(r!==es||!Rn(ea,i)||Rn(pu,i)){var s=XR(r,i);return!s||!Rn(ea,i)||Rn(r,ji)&&r[ji][i]||(s.enumerable=!0),s}},ry=function(e){var t=ZR(Dp(e)),r=[];return Lp(t,function(i){Rn(ea,i)||Rn(HR,i)||$R(r,i)}),r},cE=function(e){var t=e===es,r=ZR(t?pu:Dp(e)),i=[];return Lp(r,function(s){!Rn(ea,s)||t&&!Rn(es,s)||$R(i,ea[s])}),i};if(Rc||(tE(yc=(xa=function(){if(_V(yc,this))throw zR("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?xR(arguments[0]):void 0,t=KR(e),r=function(i){this===es&&lu(r,pu,i),Rn(this,ji)&&Rn(this[ji],t)&&(this[ji][t]=!1),oE(this,t,Zm(1,i))};return bl&&iE&&oE(es,t,{configurable:!0,set:r}),sE(t,e)}).prototype,"toString",function(){return JR(this).tag}),tE(xa,"withoutSetter",function(e){return sE(KR(e),e)}),jR.f=ty,GR.f=Bp,CV.f=aE,VR.f=ey,vV.f=QR.f=ry,$m.f=cE,TV.f=function(e){return sE(WR(e),e)},bl&&Fa(yc,"description",{configurable:!0,get:function(){return JR(this).description}})),wl({global:!0,wrap:!0,forced:!Rc,sham:!Rc},{Symbol:xa}),Lp(FR(NV),function(e){RV(e)}),wl({target:Pp,stat:!0,forced:!Rc},{for:function(e){var t=xR(e);if(Rn(rE,t))return rE[t];var r=xa(t);return rE[t]=r,nE[r]=t,r},keyFor:function(e){if(!Jm(e))throw zR(e+" is not a symbol");if(Rn(nE,e))return nE[e]},useSetter:function(){iE=!0},useSimple:function(){iE=!1}}),wl({target:"Object",stat:!0,forced:!Rc,sham:!bl},{create:function(e,t){return t===void 0?du(e):aE(du(e),t)},defineProperty:Bp,defineProperties:aE,getOwnPropertyDescriptor:ey}),wl({target:"Object",stat:!0,forced:!Rc},{getOwnPropertyNames:ry,getOwnPropertySymbols:cE}),wl({target:"Object",stat:!0,forced:qm(function(){$m.f(1)})},{getOwnPropertySymbols:function(e){return $m.f(IV(e))}}),hu&&wl({target:"JSON",stat:!0,forced:!Rc||qm(function(){var e=xa();return hu([e])!="[null]"||hu({a:e})!="{}"||hu(Object(e))!="{}"})},{stringify:function(e,t,r){var i=SV(arguments),s=t;if((EV(t)||e!==void 0)&&!Jm(e))return gV(t)||(t=function(l,d){if(mV(s)&&(d=lu(s,this,l,d)),!Jm(d))return d}),i[1]=t,AV(hu,null,i)}}),!yc[qR]){var OV=yc.valueOf;tE(yc,qR,function(e){return lu(OV,this)})}yV(xa,Pp),HR[ji]=!0;var Xt=Ir.Object.getOwnPropertySymbols,kV=qS,DV=Vn,LV=Ft,PV=il;Ae({target:"Object",stat:!0,sham:!Ot},{getOwnPropertyDescriptors:function(e){for(var t,r,i=DV(e),s=LV.f,l=kV(i),d={},h=0;l.length>h;)(r=s(i,t=l[h++]))!==void 0&&PV(d,t,r);return d}});var Zt=Ir.Object.getOwnPropertyDescriptors,ny={exports:{}},BV=IC;(function(e){var t=BV;e.exports=function(r,i,s){return i in r?t(r,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[i]=s,r},e.exports.__esModule=!0,e.exports.default=e.exports})(ny);var ei,mr=c(ny.exports);(function(e){e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5"})(ei||(ei={}));var be=Ir.setInterval,MV=xi,UV=TS,xV=Ws,FV=he,QV=io,VV=function(e,t,r,i){try{return i?t(MV(r)[0],r[1]):t(r)}catch(s){UV(e,"throw",s)}},GV=vS,jV=Mh,HV=yo,iy=il,KV=Ng,WV=$h,oy=G.Array,sy=function(e){var t=QV(e),r=jV(this),i=arguments.length,s=i>1?arguments[1]:void 0,l=s!==void 0;l&&(s=xV(s,i>2?arguments[2]:void 0));var d,h,p,m,f,_,v=WV(t),T=0;if(!v||this==oy&&GV(v))for(d=HV(t),h=r?new this(d):oy(d);d>T;T++)_=l?s(t[T],T):t[T],iy(h,T,_);else for(f=(m=KV(t,v)).next,h=r?new this:[];!(p=FV(f,m)).done;T++)_=l?VV(m,s,[p.value,T],!0):p.value,iy(h,T,_);return h.length=T,h},YV=sy;Ae({target:"Array",stat:!0,forced:!nT(function(e){Array.from(e)})},{from:YV});var Qe=Ir.Array.from,qV=$r("Array").entries,JV=Is,zV=gn,XV=L,ZV=qV,lE=Array.prototype,$V={DOMTokenList:!0,NodeList:!0},nn=function(e){var t=e.entries;return e===lE||XV(lE,e)&&t===lE.entries||zV($V,JV(e))?ZV:t},t8=$r("Array").keys,e8=Is,r8=gn,n8=L,i8=t8,dE=Array.prototype,o8={DOMTokenList:!0,NodeList:!0},wc=function(e){var t=e.keys;return e===dE||n8(dE,e)&&t===dE.keys||r8(o8,e8(e))?i8:t};function ay(e,t){var r=ae(e);if(Xt){var i=Xt(e);t&&(i=kt(i).call(i,function(s){return jt(e,s).enumerable})),r.push.apply(r,i)}return r}function cy(e){for(var t=1;t<arguments.length;t++){var r,i,s=arguments[t]!=null?arguments[t]:{};t%2?V(r=ay(Object(s),!0)).call(r,function(l){mr(e,l,s[l])}):Zt?ur(e,Zt(s)):V(i=ay(Object(s))).call(i,function(l){ie(e,l,jt(s,l))})}return e}let Mp=0,uE=0;function yn(e,t,r){return new ct((i,s)=>{t.timeout=t.timeout||it("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!r?(t.data=St(t.data),Mp+=Bl(t.data)):r&&(t.data.size?Mp+=t.data.size:t.data instanceof FormData?Mp+=function(l){let d=0;return/DingTalk/i.test(navigator.userAgent)&&l.realFormData&&(l=l.realFormData),V(l).call(l,h=>{d+=typeof h=="string"?Bl(h):h.size}),d+138}(t.data):Mp+=Bl(St(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,wo.request(t).then(l=>{typeof l.data=="string"?uE+=Bl(l.data):l.data instanceof ArrayBuffer||l.data instanceof Uint8Array?uE+=l.data.byteLength:uE+=Bl(St(l.data)),i(l.data)}).catch(l=>{wo.isCancel(l)?s(new P(D.OPERATION_ABORTED,"cancel token canceled")):l.code==="ECONNABORTED"?s(new P(D.NETWORK_TIMEOUT,l.message)):l.response?s(new P(D.NETWORK_RESPONSE_ERROR,l.response.status)):s(new P(D.NETWORK_ERROR,l.message))})})}async function ly(e,t){const r=new Blob([t.data],{type:"buffer"});return await yn(e,cy(cy({},t),{},{data:r,headers:{"Content-Type":"application/octet-stream"}}),!0)}const Rr=new class extends Wr{constructor(){super(),this._moduleName="network-indicator",this._networkState=lo.ONLINE,window.addEventListener("online",()=>{this.networkState=lo.ONLINE}),window.addEventListener("offline",()=>{this.networkState=lo.OFFLINE})}set networkState(e){S.info("[".concat(this._moduleName,"]")+"network state changed, "+this._networkState+" -> "+e),this.emit(yl.NETWORK_STATE_CHANGE,e,this._networkState),e===lo.ONLINE?this.emit(yl.ONLINE):e===lo.OFFLINE&&(this.onlineWaiter=new ct(t=>{this.once(yl.ONLINE,()=>{this.onlineWaiter=void 0,t(lo.ONLINE)})}),this.emit(yl.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}},Ne={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function hE(e,t){const r=t.timeout*Math.pow(t.timeoutFactor,e);return Math.min(t.maxRetryTimeout,r)}function Wn(e,t,r,i){const s=hr({},Ne,i);let l=s.timeout;const d=async()=>{await Mr(l),l*=s.timeoutFactor,l=Math.min(s.maxRetryTimeout,l)};let h=!1;const p=new ct(async(m,f)=>{t=t||(()=>!1),r=r||(()=>!0);for(let _=0;_<s.maxRetryCount;_+=1){if(h)return f(new P(D.OPERATION_ABORTED));try{const v=await e();if(!t(v,_)||_+1===s.maxRetryCount)return m(v);await d()}catch(v){if(!r(v,_)||_+1===s.maxRetryCount)return f(v);await d()}}});return p.cancel=()=>h=!0,p}let pE=!1;const Hi=new class extends Wr{};function dy(){const e=Se();if(!pE){const t=r=>{r.preventDefault(),pE=!1,e.os!=="Android"||e.name!=="Chrome"&&e.name!==ye.WECHAT?(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0)):document.body.removeEventListener("click",t,!0)};pE=!0,e.os!=="Android"||e.name!=="Chrome"&&e.name!==ye.WECHAT?(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)):document.body.addEventListener("click",t,!0),S.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Hi.onAutoplayFailed?Hi.onAutoplayFailed():Hi.onAudioAutoplayFailed?S.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):S.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Hi.emit("autoplay-failed")}}function uy(e,t){var r=ae(e);if(Xt){var i=Xt(e);t&&(i=kt(i).call(i,function(s){return jt(e,s).enumerable})),r.push.apply(r,i)}return r}function fe(e){for(var t=1;t<arguments.length;t++){var r,i,s=arguments[t]!=null?arguments[t]:{};t%2?V(r=uy(Object(s),!0)).call(r,function(l){mr(e,l,s[l])}):Zt?ur(e,Zt(s)):V(i=uy(Object(s))).call(i,function(l){ie(e,l,jt(s,l))})}return e}function Au(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{report:At};return function(t,r,i){const s=t[r];if(typeof s=="function"){const l=t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name;i.value=function(){for(var d,h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];const f=e.report.reportApiInvoke(this._sessionId||null,{name:k(d="".concat(l,".")).call(d,r),options:p,tag:Wt.TRACER});try{const _=s.apply(this,p);return f.onSuccess(),_}catch(_){throw f.onError(_),_}}}return i}}function Up(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{report:At};return function(t,r,i){const s=t[r];if(typeof s=="function"){const l=t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name;i.value=async function(){for(var d,h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];const f=e.report.reportApiInvoke(this._sessionId||null,{name:k(d="".concat(l,".")).call(d,r),options:p,tag:Wt.TRACER});try{const _=await s.apply(this,p);return f.onSuccess(),_}catch(_){throw f.onError(_),_}}}return i}}const At=new class{constructor(){var e,t;this.baseInfoMap=new $t,this.clientList=ts,this.keyEventUploadPendingItems=[],this.normalEventUploadPendingItems=[],this.apiInvokeUploadPendingItems=[],this.apiInvokeCount=0,this.ltsList=[],this.lastSendNormalEventTime=ht(),this.customReportCount=0,this.eventUploadTimer=be(Lr(e=this.doSend).call(e,this),it("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=be(Lr(t=this.appendSessionId).call(t,this),it("EVENT_REPORT_SEND_INTERVAL"))}reportApiInvoke(e,t,r){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;const i=ht();this.apiInvokeCount+=1;const s=this.apiInvokeCount,l=()=>({tag:t.tag,invokeId:s,sid:e,name:t.name,apiInvokeTime:i,options:t.options,states:t.states||null}),d=!!it("SHOW_REPORT_INVOKER_LOG");d&&S.info("".concat(t.name," start"),t.options);let h=!1;Mr(t.timeout).then(()=>{h||(this.sendApiInvoke(fe(fe({},l()),{},{error:D.API_INVOKE_TIMEOUT,success:!1})),S.debug("".concat(t.name," timeout")))});const p=new P(D.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:m=>{const f=()=>{if(h)throw p;return h=!0,this.sendApiInvoke(fe(fe({},l()),{},{success:!0},t.reportResult&&{result:m})),d&&S.info("".concat(t.name," onSuccess")),m};return r?Yp(f,t.name+"Success",r,()=>h=!0):f()},onError:m=>{const f=()=>{if(h)throw m;h=!0,this.sendApiInvoke(fe(fe({},l()),{},{success:!1,error:m.toString()})),d&&S.info("".concat(t.name," onFailure"),m.toString())};return r?Yp(f,t.name+"Error",r,()=>h=!0):f()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const r=ht(),i=this.createBaseInfo(e,r);i.cname=t.cname;const s=hr({},{willUploadConsoleLog:it("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:ru?"global":"oversea",areas:it("AREAS")&&it("AREAS").join(",")},t.extend),l=ht(),d=fe(fe({},i),{},{eventType:Mn.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,build:vl,lts:l,elapse:l-r,extend:St(s),mode:t.mode,process:it("PROCESS_ID"),success:!0,version:Tn});this.send({type:kr.SESSION,data:d},!0)}joinChooseServer(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=ht(),l=fe(fe({},i),{},{eventType:Mn.JOIN_CHOOSE_SERVER,lts:s,eventElapse:s-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:s-r.startTime,success:t.succ,chooseServerAddrList:St(t.serverList),uid:t.uid?Tr(t.uid):null,cid:t.cid?Tr(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0});this.send({type:kr.JOIN_CHOOSE_SERVER,data:l},!0)}reqUserAccount(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=ht(),l=fe(fe({},i),{},{eventType:Mn.REQ_USER_ACCOUNT,lts:s,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:s-r.startTime,eventElapse:s-t.lts,extend:St(t.extend)});this.send({type:kr.REQ_USER_ACCOUNT,data:l},!0)}joinGateway(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info;t.vid&&(i.vid=t.vid),i.uid=t.uid,i.cid=t.cid;const s=ht(),l=fe(fe({},i),{},{eventType:Mn.JOIN_GATEWAY,lts:s,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,elapse:s-r.startTime,eventElapse:s-t.lts});t.succ&&(r.lastJoinSuccessTime=s),this.send({type:kr.JOIN_GATEWAT,data:l},!0)}joinChannelTimeout(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const i=ht(),s=fe(fe({},r.info),{},{lts:i,timeout:t,elapse:i-r.startTime});this.send({type:kr.JOIN_CHANNEL_TIMEOUT,data:s},!0)}publish(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=ht(),l=fe(fe({},i),{},{eventType:Mn.PUBLISH,lts:s,eventElapse:t.eventElapse,elapse:s-r.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:kr.PUBLISH,data:l},!0)}subscribe(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=ht(),l=fe(fe({},i),{},{eventType:Mn.SUBSCRIBE,lts:s,eventElapse:t.eventElapse,elapse:s-r.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid});typeof t.peerid=="string"?l.peerSuid=t.peerid:l.peer=t.peerid,this.send({type:kr.SUBSCRIBE,data:l},!0)}wsCompressorInit(e){var t;const r=[...wc(t=this.baseInfoMap).call(t)],i=r.length?r[0]:"UnableToGetSid",s=this.baseInfoMap.get(i);if(!s)return;const l=s.info,d=ht(),h=fe(fe({},l),{},{eventType:Mn.WS_COMPRESSOR_INIT,lts:d,eventElapse:e.eventElapse,elapse:d-s.startTime,status:e.status?1:2});this.send({type:kr.WS_COMPRESSOR_INIT,data:h},!0)}firstRemoteFrame(e,t,r,i){const s=this.baseInfoMap.get(e);if(!s)return;const l=s.info,d=ht(),h=fe(fe(fe({},l),i),{},{elapse:d-s.startTime,eventType:t,lts:d});this.send({type:r,data:h},!0)}onGatewayStream(e,t,r,i){const s=this.baseInfoMap.get(e);if(!s)return;const l=s.info,d=ht(),h=fe(fe(fe({},l),i),{},{eventType:t,lts:d});this.send({type:r,data:h},!0)}streamSwitch(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=ht(),l=fe(fe({},i),{},{eventType:Mn.STREAM_SWITCH,lts:s,isDual:t.isdual,elapse:s-r.startTime,success:t.succ});this.send({type:kr.STREAM_SWITCH,data:l},!0)}requestProxyAppCenter(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=ht(),l=fe(fe({},i),{},{eventType:Mn.REQUEST_PROXY_APPCENTER,lts:s,eventElapse:s-t.lts,elapse:s-r.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:kr.REQUEST_PROXY_APPCENTER,data:l},!0)}requestProxyWorkerManager(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=ht(),l=fe(fe({},i),{},{eventType:Mn.REQUEST_PROXY_WORKER_MANAGER,lts:s,eventElapse:s-t.lts,elapse:s-r.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:kr.REQUEST_PROXY_WORKER_MANAGER,data:l},!0)}setProxyServer(e){this.proxyServer=e,e?S.debug("reportProxyServerurl: ".concat(e)):S.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=ht(),l=fe(fe({},i),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:s,elapse:s-r.startTime,joinChannelSuccessElapse:s-(r.lastJoinSuccessTime||s)});this.send({type:kr.PEER_PUBLISH_STATUS,data:l},!0)}workerEvent(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=ht(),l=My(fe(fe(fe({},i),t),{},{elapse:s-r.startTime,lts:s,productType:"WebRTC"}),"payload",1300);V(l).call(l,d=>this.send({type:kr.WORKER_EVENT,data:d},!0))}apworkerEvent(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=ht(),l=fe(fe(fe({},i),t),{},{elapse:s-r.startTime,lts:s});this.send({type:kr.AP_WORKER_EVENT,data:l},!0)}joinWebProxyAP(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=ht(),l=fe(fe(fe({},i),t),{},{elapse:s-r.startTime,lts:s,extend:t.extend||void 0});this.send({type:kr.JOIN_WEB_PROXY_AP,data:l},!0)}WebSocketQuit(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=ht(),l=fe(fe(fe({},i),t),{},{elapse:s-r.startTime,lts:s});this.send({type:kr.WEBSOCKET_QUIT,data:l},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>it("CUSTOM_REPORT_LIMIT"))throw new P(D.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=be(()=>{this.customReportCount=0},5e3));const r=pt(t).call(t,s=>({type:kr.USER_ANALYTICS,data:fe({sid:e},s)})),i={msgType:"EventMessages",sentTs:Math.round(ht()/1e3),payloads:pt(r).call(r,s=>St(s))};try{await this.postDataToStatsCollector(i)}catch(s){throw S.error("send custom report message failed",s.toString()),new P(D.CUSTOM_REPORT_SEND_FAILED,s.message)}}autoplayFailed(e,t,r,i){if(!e)return;const s=this.baseInfoMap.get(e);if(!s)return;const l=s.info,d=ht(),h=fe(fe({},l),{},{vid:l.vid===void 0?0:Number(l.vid),lts:d,elapse:d-s.startTime,cbRegistered:Hi.onAutoplayFailed||Hi.onAudioAutoplayFailed?1:-1,errorMsg:r,mediaType:t,trackId:i,extend:void 0});this.send({type:kr.AUTOPLAY_FAILED,data:h},!0)}sendApiInvoke(e){const t=it("NOT_REPORT_EVENT");if(e.tag&&qt(t)&&qt(t).call(t,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const r=this.baseInfoMap.get(e.sid);if(!r)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:i,uid:s,cid:l}=r.info;e.lts=e.lts||ht();const d={invokeId:e.invokeId,sid:e.sid,cname:i,cid:l,uid:s,lts:e.lts,success:e.success,elapse:e.lts-r.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?St(e.options):void 0,execStates:e.states?St(e.states):void 0,execResult:e.result?St(e.result):void 0,errorCode:e.error?St(e.error):void 0};return this.send({type:kr.API_INVOKE,data:d},!1),!0}appendSessionId(){var e;V(e=this.clientList).call(e,t=>{if(t._sessionId){const r=this.apiInvokeUploadPendingItems.length;for(let i=0;i<r;i++){const s=this.apiInvokeUploadPendingItems.shift();s&&(s.sid=t._sessionId,this.sendApiInvoke(hr({},s)))}}})}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);var r;this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>it("NORMAL_EVENT_QUEUE_CAPACITY")&&Ye(r=this.normalEventUploadPendingItems).call(r,0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&ht()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const r=[],i=[];for(;e.length;){const h=e.shift();r.length<20?r.push(h):i.push(h)}e.push(...i);for(const h of[...r]){var s,l;xt(s=this.ltsList).call(s,h.data.lts)!==-1?(h.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(h.data.lts)):(this.ltsList.push(h.data.lts),Ua(l=this.ltsList).call(l,(p,m)=>p-m))}t||(this.lastSendNormalEventTime=ht());const d={msgType:"EventMessages",sentTs:Math.round(ht()/1e3),payloads:pt(r).call(r,h=>St(h)),vid:(h=>{const p=h&&h.data.sid&&this.baseInfoMap.get(h.data.sid);return p&&p.info.vid&&+p.info.vid||0})(r[0])};return r.length&&this.postDataToStatsCollector(d).catch((h=>p=>{var m,f,_;it("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=k(m=this.keyEventUploadPendingItems).call(m,h):(this.normalEventUploadPendingItems=k(f=this.normalEventUploadPendingItems).call(f,h),this.normalEventUploadPendingItems.length>it("NORMAL_EVENT_QUEUE_CAPACITY")&&(Ye(_=this.normalEventUploadPendingItems).call(_,0,this.normalEventUploadPendingItems.length-it("NORMAL_EVENT_QUEUE_CAPACITY")),S.warning("report: drop normal events"))))})(r)),e}async postDataToStatsCollector(e){var t,r,i;let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1];Rr.networkState===lo.OFFLINE&&await ct.race([Rr.onlineWaiter,Mr(2*Ne.maxRetryTimeout)]);const l=s?"/events/proto-raws":"/events/messages";let d=this.url||(this.proxyServer?k(t=k(r="https://".concat(this.proxyServer,"/rs/?h=")).call(r,it("EVENT_REPORT_DOMAIN"),"&p=6443&d=")).call(t,l):k(i="https://".concat(it("EVENT_REPORT_DOMAIN"),":6443")).call(i,l));for(let f=0;f<2;f+=1){var h,p,m;f===1&&(d=this.backupUrl||(this.proxyServer?k(h=k(p="https://".concat(this.proxyServer,"/rs/?h=")).call(p,it("EVENT_REPORT_BACKUP_DOMAIN"),"&p=6443&d=")).call(h,l):k(m="https://".concat(it("EVENT_REPORT_BACKUP_DOMAIN"),":6443")).call(m,l)));try{s?await ly(d,{timeout:1e4,data:e}):await yn(d,{timeout:1e4,data:e})}catch(_){if(f===1)throw _;continue}return}}createBaseInfo(e,t){const r=hr({},nV);return r.sid=e,this.baseInfoMap.set(e,{info:r,startTime:t}),r}reportResourceTiming(e,t){const r=performance.getEntriesByName(e),i=r[r.length-1];i&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:i,tag:Wt.TRACER}).onSuccess()}};class hy extends Wr{constructor(t,r){super(),this._hints=[],this._isClosed=!1,this._ID=r||Pe(8,"track-"),this._originMediaStreamTrack=t,this._mediaStreamTrack=t,lR(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){if(!t){const r=At.reportApiInvoke(null,{name:Ht.GET_MEDIA_STREAM_TRACK,options:[],tag:Wt.TRACER});this._mediaStreamTrack&&typeof this._mediaStreamTrack.label=="string"?r.onSuccess(this._mediaStreamTrack.label):r.onSuccess("")}return this._mediaStreamTrack}close(){this._isClosed=!0,dR(this)}}let s8=1;class wn{constructor(t){var r;this.lockingPromise=ct.resolve(),this.locks=0,this.name="",this.lockId=s8++,t&&(this.name=t),S.debug(k(r="[lock-".concat(this.name,"-")).call(r,this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(t){var r,i,s;let l;this.locks+=1,S.debug(k(r=k(i=k(s="[lock-".concat(this.name,"-")).call(s,this.lockId,"] is locked, current queue ")).call(i,this.locks,". ")).call(r,typeof t=="string"?t:""));const d=new ct(p=>{l=()=>{var m,f,_;this.locks-=1,S.debug(k(m=k(f=k(_="[lock-".concat(this.name,"-")).call(_,this.lockId,"] is not locked, current queue ")).call(f,this.locks,". ")).call(m,typeof t=="string"?t:"")),p()}}),h=this.lockingPromise.then(()=>l);return this.lockingPromise=this.lockingPromise.then(()=>d),h}}function Nl(e,t){return function(r,i,s){const l=r[i];if(typeof l!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){var d;const h=this[t];var p;if(!h)throw new Error(k(p="mutex property key ".concat(t," doesn't exist on ")).call(p,e));const m=await h.lock(k(d="From ".concat(e,".")).call(d,i));try{for(var f=arguments.length,_=new Array(f),v=0;v<f;v++)_[v]=arguments[v];return await l.apply(this,_)}finally{m()}},s}}class ra extends hy{constructor(t,r){super(t,r),this._enabled=!0,this._muted=!1,this._isClosed=!1,this._trackProcessors=[],this._handleTrackEnded=()=>{this.onTrackEnded()},this._enabledMutex=new wn("".concat(r)),t.addEventListener("ended",this._handleTrackEnded)}get muted(){return this._muted}get enabled(){return this._enabled}getTrackLabel(){return this._originMediaStreamTrack.label}close(){var t;this._isClosed||(this.stop(),V(t=this._trackProcessors).call(t,r=>r.destroy()),this._trackProcessors=[],this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,S.debug("[".concat(this.getTrackId(),"] close")),this.emit(Yt.NEED_CLOSE),super.close())}async _registerTrackProcessor(t){var r;if(xt(r=this._trackProcessors).call(r,t)!==-1)return;const i=this._trackProcessors[this._trackProcessors.length-1];this._trackProcessors.push(t),t.onOutputChange=async()=>{const s=t.output||this._originMediaStreamTrack;this._mediaStreamTrack=s,this._updatePlayerSource(),await Xe(this,Yt.NEED_REPLACE_TRACK,this)},i?(i.onOutputChange=async()=>{i.output&&await t.setInput(i.output)},await t.setInput(i.output||i.input||this._originMediaStreamTrack)):await t.setInput(this._originMediaStreamTrack)}_getOutputFromProcessors(){if(this._trackProcessors.length===0)return this._originMediaStreamTrack;const t=this._trackProcessors[this._trackProcessors.length-1];return t.output||t.input||this._originMediaStreamTrack}async _updateOriginMediaStreamTrack(t,r){if(t!==this._originMediaStreamTrack){if(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop(),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._trackProcessors.length>0){await this._trackProcessors[0].setInput(t);const i=this._getOutputFromProcessors();this._mediaStreamTrack=i}else this._mediaStreamTrack=this._originMediaStreamTrack;this._updatePlayerSource(),await Xe(this,Yt.NEED_REPLACE_TRACK,this)}}_getDefaultPlayerConfig(){return{}}onTrackEnded(){S.debug("[".concat(this.getTrackId(),"] track ended")),this.emit(ta.TRACK_ENDED)}stateCheck(t,r){var i,s,l;if(S.debug(k(i=k(s=k(l="check track state, [muted: ".concat(this._muted,", enabled: ")).call(l,this._enabled,"] to [")).call(s,t,": ")).call(i,r,"]")),Sc(r,t),this._enabled&&this._muted&&t==="enabled"&&r===!1)throw new P(D.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print();if(!this._enabled&&!this._muted&&t==="muted"&&r===!0)throw new P(D.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print()}}var yr;(function(e){e.IOS_15_INTERRUPTION_START="ios15-interruption-start",e.IOS_15_INTERRUPTION_END="ios15-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change"})(yr||(yr={}));const py=window.AudioContext||window.webkitAudioContext;let Do=null;const le=new class extends Wr{constructor(){super(...arguments),this.onLocalAudioTrackMute=()=>{S.info("ios15-interruption-start"),this.emit(yr.IOS_15_INTERRUPTION_START)},this.onLocalAudioTrackUnmute=async()=>{S.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?S.info("ios15-interruption-end-canceled"):(Do&&await Do.suspend(),this.emit(yr.IOS_15_INTERRUPTION_END))}}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){S.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){S.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function a8(){py?(S.info("create audio context"),Do=new py,le.curState=Do.state,Do.onstatechange=()=>{var e;le.prevState=le.curState,le.curState=Do?Do.state:void 0,(ui()||Zo())&&le.prevState==="running"&&le.curState==="interrupted"&&(S.info("ios-interruption-start"),le.emit(yr.IOS_INTERRUPTION_START)),(ui()||Zo())&&le.prevState==="interrupted"&&le.curState==="running"&&(S.info("ios-interruption-end"),le.emit(yr.IOS_INTERRUPTION_END)),le.prevState!==le.curState&&(S.debug("AudioContext State Change",k(e="".concat(le.prevState,"=>")).call(e,le.curState)),le.emit(yr.STATE_CHANGE))},async function(e){const t=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let r,i=!1,s=!1,l=!1;function d(w){e.state==="running"?h(!1):ui()||Zo()?e.state==="suspended"&&(h(!0),w&&e.resume().then(m,m)):e.state!=="closed"&&(h(!0),w&&e.resume().then(m,m))}function h(w){if(i!==w){i=w;for(let O=0,B=t;O<B.length;O+=1){const K=B[O];w?window.addEventListener(K,f,{capture:!0,passive:!0}):window.removeEventListener(K,f,{capture:!0,passive:!0})}}}function p(){d(!0)}function m(){d(!1)}function f(){d(!0)}function _(w){if(!l)if(r.paused)if(w){v(!1),l=!0;let O;try{O=r.play(),O?O.then(T,T):(r.addEventListener("playing",T),r.addEventListener("abort",T),r.addEventListener("error",T))}catch{T()}}else v(!0);else v(!1)}function v(w){if(s!==w){s=w;for(let O=0,B=t;O<B.length;O++){const K=B[O];w?window.addEventListener(K,R,{capture:!0,passive:!0}):window.removeEventListener(K,R,{capture:!0,passive:!0})}}}function T(){r.removeEventListener("playing",T),r.removeEventListener("abort",T),r.removeEventListener("error",T),l=!1,_(!1)}function R(){_(!0)}if(ui()){const w=e.createMediaStreamDestination(),O=document.createElement("div");O.innerHTML="<audio x-webkit-airplay='deny'></audio>",r=O.children.item(0),r.controls=!1,r.disableRemotePlayback=!0,r.preload="auto",r.srcObject=w.stream,_(!0)}le.on(yr.STATE_CHANGE,p),d(!1)}(Do)):S.error("your browser is not support web audio")}function Ol(){if(!Do){if(a8(),!Do)throw new P(D.NOT_SUPPORTED,"can not create audio context");return Do}return Do}function fu(e){if(function(){if(AE!==null)return AE;const i=Ol(),s=i.createBufferSource(),l=i.createGain(),d=i.createGain();s.connect(l),s.connect(d),s.disconnect(l);let h=!1;try{s.disconnect(l)}catch{h=!0}return s.disconnect(),AE=h,h}())return;S.debug("polyfill audio node");const t=e.connect,r=e.disconnect;e.connect=(i,s,l)=>{var d;return e._inputNodes||(e._inputNodes=[]),qt(d=e._inputNodes).call(d,i)||(i instanceof AudioNode?(e._inputNodes.push(i),t.call(e,i,s,l)):t.call(e,i,s)),e},e.disconnect=(i,s,l)=>{r.call(e),i?na(e._inputNodes,i):e._inputNodes=[];for(const d of e._inputNodes)t.call(e,d)}}let AE=null;function xp(e,t){const r=1/t,i=Ol();let s=i.createGain();s.gain.value=0,s.connect(i.destination);let l=!1;const d=()=>{if(l)return void(s=null);const h=i.createOscillator();h.onended=d,h.connect(s),h.start(0),h.stop(i.currentTime+r),e(i.currentTime)};return d(),()=>{l=!0}}class Ay extends Wr{constructor(){super(),this.isPlayed=!1,this.audioOutputLevel=0,this.isDestroyed=!1,this.isNoAudioInput=!1,this._noAudioInputCount=0,this.context=Ol(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),fu(this.outputNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.smoothingTimeConstant=.4,this.analyserNode.fftSize=2048}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=r=>{this.emit(Oo.ON_AUDIO_BUFFER,function(i){for(let s=0;s<i.outputBuffer.numberOfChannels;s+=1){const l=i.outputBuffer.getChannelData(s);for(let d=0;d<l.length;d+=1)l[d]=0}return i.inputBuffer}(r))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Dr().webAudioMediaStreamDest)throw new P(D.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&sn(()=>{le.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){if(!this.context||ui()||Zo()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode)return 0;const t=new Uint8Array(this.analyserNode.frequencyBinCount);this.analyserNode.getByteFrequencyData(t);let r=0;for(let i=0;i<t.length;i++)r+=i<64?Math.abs(10*t[i]):Math.abs(6*t[i]/15);return r/t.length/255}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;if(ui()||Zo()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume(),!this.analyserNode)return!1;const r=new Uint8Array(this.analyserNode.frequencyBinCount);this.analyserNode.getByteFrequencyData(r);let i=!1;for(let s=0;s<r.length;s++)r[s]!==0&&(i=!0);return i?(this.isNoAudioInput=!1,!0):(await Mr(200),await this.checkHasAudioInput(t?t+1:1)&&i)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}setMute(t){t?(this.disconnect(),this.audioOutputLevel=0):this.connect()}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){this.sourceNode&&this.sourceNode.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){this.sourceNode&&this.sourceNode.connect(this.outputNode),this.outputNode.connect(this.analyserNode)}}class Fp extends Ay{constructor(t,r){var i;if(super(),this.isCurrentTrackCloned=!1,this.isRemoteTrack=!1,this.rebuildWebAudio=async()=>{if(S.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void S.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>S.info("resume success")),S.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const d=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?d.stop():this.isCurrentTrackCloned=!0;const h=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(h),fu(this.sourceNode),this.analyserNode=this.context.createAnalyser();const p=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(p,this.context.currentTime),fu(this.outputNode),this.connect(),this.audioElement.srcObject=h,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()},t.kind!=="audio")throw new P(D.UNEXPECTED_ERROR);this.track=t;const s=new MediaStream([this.track]);this.isRemoteTrack=!!r,this.sourceNode=this.context.createMediaStreamSource(s),fu(this.sourceNode),this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=s;const l=Se();r&&l.os===mn.IOS&&Number((i=l.osVersion)===null||i===void 0?void 0:i.split(".")[0])<15&&(le.on(yr.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(d=>{d||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}get isFreeze(){return!1}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;const r=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(r),fu(this.sourceNode),this.sourceNode.connect(this.outputNode),this.audioElement.srcObject=r}destroy(){this.audioElement.srcObject=null,this.audioElement.remove(),le.off("state-change",this.rebuildWebAudio),super.destroy()}}async function fy(e,t){const r=(s,l)=>s?typeof s!="number"?s.max||s.exact||s.ideal||s.min||l:s:l,i={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:r(t.height,1080),maxWidth:r(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(i.video.mandatory.maxFrameRate=t.frameRate.max,i.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(i.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(i)}async function c8(e){const t=await fE(e.mediaSource),r=await function(i){return new ct((s,l)=>{const d=document.createElement("div");d.innerText="share screen",d.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const h=document.createElement("div");h.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const p=document.createElement("div");p.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",p.setAttribute("style","height: 12%;");const m=document.createElement("div");m.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const f=document.createElement("div");f.setAttribute("style","text-align: right; padding: 16px 0;");const _=document.createElement("button");_.innerHTML="cancel",_.setAttribute("style","width: 85px;"),_.onclick=()=>{document.body.removeChild(v);const T=new Error("NotAllowedError");T.name="NotAllowedError",l(T)},f.appendChild(_),h.appendChild(p),h.appendChild(m),h.appendChild(f);const v=document.createElement("div");v.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),v.appendChild(d),v.appendChild(h),document.body.appendChild(v),pt(i).call(i,T=>{if(T.id){const R=document.createElement("div");R.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let w=T.thumbnail;const{width:O}=w.getSize();O>1920&&(w=w.resize({width:1920})),R.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+w.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+(T.name.replace(/[\u00A0-\u9999<>\&]/g,function(B){return"&#"+B.charCodeAt(0)+";"})+"</span>"),R.onclick=()=>{document.body.removeChild(v),s(T.id)},m.appendChild(R)}})})}(t);return await fy(r,e)}async function fE(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);const r=gy();if(!r)throw new P(D.ELECTRON_IS_NULL);let i=null;try{i=r.desktopCapturer.getSources({types:t})}catch{i=null}i&&i.then||(i=new ct((s,l)=>{r.desktopCapturer.getSources({types:t},(d,h)=>{d?l(d):s(h)})}));try{return await i}catch(s){throw new P(D.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,s.toString())}}let Qp=null;function gy(){if(Qp)return Qp;try{return Qp=window.require("electron"),Qp}catch{return null}}const gE=new wn("safari");let my=!1,Ey=!1;async function on(e,t){let r=0,i=null;for(;r<2;)try{i=await l8(e,t,r>0);break}catch(d){var s,l;if(d instanceof P)throw S.error(k(l="[".concat(t,"] ")).call(l,d.toString())),d;const h=Vp(d.name||d.code||d,d.message);if(h.code===D.MEDIA_OPTION_INVALID){S.debug("[".concat(t,"] detect media option invalid, retry")),r+=1,await Mr(500);continue}throw S.error(k(s="[".concat(t,"] ")).call(s,h.toString())),h}if(!i)throw new P(D.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return i}async function l8(e,t,r){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new P(D.NOT_SUPPORTED,"can not find getUserMedia");r&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const i=Dr(),s=new MediaStream;if(e.audioSource&&s.addTrack(e.audioSource),e.videoSource&&s.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return S.debug("Using Video Source/ Audio Source"),s;if(e.screen)if(gy())e.screen.sourceId?kl(s,await fy(e.screen.sourceId,e.screen)):kl(s,await c8(e.screen));else if(tu()&&e.screen.extensionId&&e.screen.mandatory){if(!i.getStreamFromExtension)throw new P(D.NOT_SUPPORTED,"This browser does not support screen sharing");S.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const _=await(d=e.screen.extensionId,h=t,new ct((v,T)=>{try{chrome.runtime.sendMessage(d,{getStream:!0},w=>{if(!w||!w.streamId)return S.error("[".concat(h,"] No response from Chrome Plugin. Plugin not installed properly"),w),void T(new P(D.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));v(w.streamId)})}catch(w){var R;S.error(k(R="[".concat(h,"] AgoraRTC screensharing plugin is not accessible(")).call(R,d,")"),w.toString()),T(new P(D.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=_,kl(s,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(i.getDisplayMedia){e.screen.mediaSource&&LR(e.screen.mediaSource);const _={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource};S.debug("[".concat(t,"] getDisplayMedia:"),St({video:_,audio:!!e.screenAudio})),kl(s,await navigator.mediaDevices.getDisplayMedia({video:_,audio:!!e.screenAudio}))}else{if(!Gr())throw S.error("[".concat(t,"] This browser does not support screenSharing")),new P(D.NOT_SUPPORTED,"This browser does not support screen sharing");{var l;e.screen.mediaSource&&LR(e.screen.mediaSource);const _={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};S.debug(k(l="[".concat(t,"] getUserMedia: ")).call(l,St(_))),kl(s,await navigator.mediaDevices.getUserMedia(_))}}var d,h;if(!e.video&&!e.audio)return s;const p={video:e.video,audio:e.audio};S.debug("[".concat(t,"] GetUserMedia"),St(p)),Se();let m,f=null;(Ri()||ui()||$d())&&(f=await gE.lock());try{m=await navigator.mediaDevices.getUserMedia(p)}catch(_){throw f&&f(),_}return p.audio&&(my=!0),p.video&&(Ey=!0),kl(s,m),f&&f(),s}function Vp(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":var r;return new P(D.MEDIA_OPTION_INVALID,k(r="".concat(e,": ")).call(r,t));case"NotFoundError":case"DevicesNotFoundError":var i;return new P(D.DEVICE_NOT_FOUND,k(i="".concat(e,": ")).call(i,t));case"NotSupportedError":var s;return new P(D.NOT_SUPPORTED,k(s="".concat(e,": ")).call(s,t));case"NotReadableError":var l;return new P(D.NOT_READABLE,k(l="".concat(e,": ")).call(l,t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":var d;return new P(D.PERMISSION_DENIED,k(d="".concat(e,": ")).call(d,t));case"ConstraintNotSatisfiedError":var h;return new P(D.CONSTRAINT_NOT_SATISFIED,k(h="".concat(e,": ")).call(h,t));default:var p;return S.error("getUserMedia unexpected error",e),new P(D.UNEXPECTED_ERROR,k(p="".concat(e,": ")).call(p,t))}}function kl(e,t){const r=e.getVideoTracks()[0],i=e.getAudioTracks()[0],s=t.getVideoTracks()[0],l=t.getAudioTracks()[0];l&&(i&&e.removeTrack(i),e.addTrack(l)),s&&(r&&e.removeTrack(r),e.addTrack(s))}const dn=new class extends Wr{constructor(){super(),this._state=Tc.IDLE,this.isAccessMicrophonePermission=!1,this.isAccessCameraPermission=!1,this.lastAccessMicrophonePermission=!1,this.lastAccessCameraPermission=!1,this.checkdeviceMatched=!1,this.deviceInfoMap=new $t,this.init().then(()=>{var e;navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",Lr(e=this.updateDevicesInfo).call(e,this)),be(()=>!mp()&&it("ENUMERATE_DEVICES_INTERVAL")&&this.updateDevicesInfo(),6e4)}).catch(e=>S.error(e.toString()))}get state(){return this._state}set state(e){e!==this._state&&(this.emit($s.STATE_CHANGE,e),this._state=e)}async enumerateDevices(e,t){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new P(D.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const i=await navigator.mediaDevices.enumerateDevices(),s=this.checkMediaDeviceInfoIsOk(i);let l=!this.isAccessMicrophonePermission&&e,d=!this.isAccessCameraPermission&&t;s.audio&&(l=!1),s.video&&(d=!1);let h=null,p=null,m=null;if(!r&&(l||d)){if(gE.isLocked&&(S.debug("[device manager] wait GUM lock"),(await gE.lock())(),S.debug("[device manager] GUM unlock")),my&&(l=!1,this.isAccessMicrophonePermission=!0),Ey&&(d=!1,this.isAccessCameraPermission=!0),S.debug("[device manager] check media device permissions",e,t,l,d),l&&d){try{m=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(O){const B=Vp(O.name||O.code||O,O.message);if(B.code===D.PERMISSION_DENIED)throw B;S.warning("getUserMedia failed in getDevices",B)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(l){try{h=await navigator.mediaDevices.getUserMedia({audio:e})}catch(O){const B=Vp(O.name||O.code||O,O.message);if(B.code===D.PERMISSION_DENIED)throw B;S.warning("getUserMedia failed in getDevices",B)}this.isAccessMicrophonePermission=!0}else if(d){try{p=await navigator.mediaDevices.getUserMedia({video:t})}catch(O){const B=Vp(O.name||O.code||O,O.message);if(B.code===D.PERMISSION_DENIED)throw B;S.warning("getUserMedia failed in getDevices",B)}this.isAccessCameraPermission=!0}S.debug("[device manager] mic permission",e,"cam permission",t)}try{var f,_,v;const O=await navigator.mediaDevices.enumerateDevices();return h&&V(f=h.getTracks()).call(f,B=>B.stop()),p&&V(_=p.getTracks()).call(_,B=>B.stop()),m&&V(v=m.getTracks()).call(v,B=>B.stop()),h=null,p=null,m=null,O}catch(O){var T,R,w;return h&&V(T=h.getTracks()).call(T,B=>B.stop()),p&&V(R=p.getTracks()).call(R,B=>B.stop()),m&&V(w=m.getTracks()).call(w,B=>B.stop()),h=null,p=null,m=null,new P(D.ENUMERATE_DEVICES_FAILED,O.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];const t=await this.enumerateDevices(!0,!1,e);return kt(t).call(t,r=>r.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];const t=await this.enumerateDevices(!1,!0,e);return kt(t).call(t,r=>r.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];const t=await this.enumerateDevices(!0,!1,e);return kt(t).call(t,r=>r.kind==="audiooutput")}searchDeviceNameById(e){const t=this.deviceInfoMap.get(e);return t?t.device.label||t.device.deviceId:null}searchDeviceIdByName(e){var t;let r=null;return V(t=this.deviceInfoMap).call(t,i=>{i.device.label===e&&(r=i.device.deviceId)}),r}async getDeviceById(e){const t=await this.enumerateDevices(!0,!0,!0),r=ft(t).call(t,i=>i.deviceId===e);if(!r)throw new P(D.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return r}async init(){this.state=Tc.INITING;try{await this.updateDevicesInfo(),this.state=Tc.INITEND}catch(e){throw S.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=Tc.IDLE,!function(){return typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1"}()&&new P(D.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){var e;const t=await this.enumerateDevices(!0,!0,!0),r=ht(),i=[];if(t[0]&&t[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const h=ft(t).call(t,m=>m.kind==="audioinput"&&m.deviceId==="default"),p=ft(t).call(t,m=>m.kind==="audiooutput"&&m.deviceId==="default");if(h&&p)if(p.groupId===h.groupId){var s;S.debug(k(s="[device-check] default input ".concat(h.label," and output ")).call(s,p.label," is the same group"))}else{var l;S.warning(k(l="[device-check] default input ".concat(h.label," and output ")).call(l,p.label," is not the same group"))}else S.debug("[device-check] default input or output not found")}const d=this.checkMediaDeviceInfoIsOk(t);if(V(t).call(t,h=>{if(!h.deviceId)return;const p=this.deviceInfoMap.get(h.deviceId);if((p?p.state:"INACTIVE")!=="ACTIVE"){const m={initAt:r,updateAt:r,device:h,state:"ACTIVE"};this.deviceInfoMap.set(h.deviceId,m),i.push(m)}p&&(p.updateAt=r)}),V(e=this.deviceInfoMap).call(e,(h,p)=>{h.state==="ACTIVE"&&h.updateAt!==r&&(h.state="INACTIVE",i.push(h))}),this.state!==Tc.INITEND)return d.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(d.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));V(i).call(i,h=>{switch(h.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit($s.RECORDING_DEVICE_CHANGED,h);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit($s.CAMERA_DEVICE_CHANGED,h);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit($s.PLAYOUT_DEVICE_CHANGED,h)}}),d.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),d.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=kt(e).call(e,s=>s.kind==="audioinput"),r=kt(e).call(e,s=>s.kind==="videoinput"),i={audio:!1,video:!1};for(const s of t)if(s.label&&s.deviceId){i.audio=!0;break}for(const s of r)if(s.label&&s.deviceId){i.video=!0;break}return i}},_y=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended"],Yr=new class{constructor(){this.elementMap=new $t,this.elementStateMap=new $t,this.elementsNeedToResume=[],this.sinkIdMap=new $t,this.autoResumeAfterInterruption=()=>{var e,t;V(e=Qe(nn(t=this.elementMap).call(t))).call(e,r=>{let[i,s]=r;const l=this.elementStateMap.get(i),d=s.srcObject.getAudioTracks()[0];Xs()?d&&d.readyState==="live"&&le.curState==="running"&&(S.debug("auto resume audio after interruption for iOS 15"),s.pause(),s.play()):l&&l==="paused"&&d&&d.readyState==="live"&&le.curState==="running"&&(S.debug("auto resume audio after interruption for iOS"),s.play())})},this.autoResumeAfterInterruptionOnIOS15=()=>{var e,t;V(e=Qe(nn(t=this.elementMap).call(t))).call(e,r=>{let[i,s]=r;const l=s.srcObject.getAudioTracks()[0];l&&l.readyState==="live"&&(S.debug("auto resume audio after interruption inside autoResumeAfterInterruptionOnIOS15"),s.pause(),s.play())})},this.autoResumeAudioElement(),le.on(yr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),le.on(yr.IOS_15_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15),le.on(yr.STATE_CHANGE,()=>{ui()&&le.prevState==="suspended"&&le.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){const r=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),r)try{await r.setSinkId(t)}catch(i){throw new P(D.PERMISSION_DENIED,"can not set sink id: "+i.toString())}}play(e,t,r,i){if(this.elementMap.has(t))return;const s=document.createElement("audio");s.autoplay=!0,s.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,s),this.elementMap.set(t,s),this.elementStateMap.set(t,Bn.INIT),this.setVolume(t,r);const l=this.sinkIdMap.get(t);if(l)try{s.setSinkId(l).catch(h=>{S.warning("[".concat(t,"] set sink id failed"),h.toString())})}catch(h){S.warning("[".concat(t,"] set sink id failed"),h.toString())}const d=s.play();d&&d.then&&d.catch(h=>{i&&At.autoplayFailed(i,"audio",h.message,t),S.warning("audio element play warning",h.toString()),this.elementMap.has(t)&&h.name==="NotAllowedError"&&(S.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(s),sn(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),dy()}))})}updateTrack(e,t){const r=this.elementMap.get(e);r&&(r.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)}setVolume(e,t){const r=this.elementMap.get(e);r&&(t=Math.max(0,Math.min(100,t)),r.volume=t/100)}stop(e){var t,r;const i=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!i)return;const s=xt(t=this.elementsNeedToResume).call(t,i);Ye(r=this.elementsNeedToResume).call(r,s,1),i.srcObject=null,i.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){V(_y).call(_y,r=>{t.addEventListener(r,i=>{var s,l;const d=this.elementStateMap.get(e),h=i.type==="pause"?"paused":i.type;S.debug(k(s=k(l="[".concat(e,"] audio-element-status change ")).call(l,d," => ")).call(s,h)),this.elementStateMap.set(e,h)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{var t;V(t=this.elementsNeedToResume).call(t,r=>{r.play().then(i=>{S.debug("Auto resume audio element success")}).catch(i=>{S.warning("Auto resume audio element failed!",i)})}),this.elementsNeedToResume=[]};new ct(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{const t=Se();t.os!=="Android"||t.name!=="Chrome"&&t.name!==ye.WECHAT?(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)):document.body.addEventListener("click",e,!0)})}};function Br(){return function(e,t,r){const i=e[t];typeof i=="function"&&(r.value=function(){this._isClosed&&new P(D.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning");for(var s=arguments.length,l=new Array(s),d=0;d<s;d++)l[d]=arguments[d];const h=i.apply(this,l);return h instanceof ct?new ct((p,m)=>{h.then(p).catch(m)}):h})}}function Iy(e,t){var r=ae(e);if(Xt){var i=Xt(e);t&&(i=kt(i).call(i,function(s){return jt(e,s).enumerable})),r.push.apply(r,i)}return r}function Gp(e){for(var t=1;t<arguments.length;t++){var r,i,s=arguments[t]!=null?arguments[t]:{};t%2?V(r=Iy(Object(s),!0)).call(r,function(l){mr(e,l,s[l])}):Zt?ur(e,Zt(s)):V(i=Iy(Object(s))).call(i,function(l){ie(e,l,jt(s,l))})}return e}var Ki=function(e,t,r,i){var s,l=arguments.length,d=l<3?t:i===null?i=jt(t,r):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(e,t,r,i);else for(var h=e.length-1;h>=0;h--)(s=e[h])&&(d=(l<3?s(d):l>3?s(t,r,d):s(t,r))||d);return l>3&&d&&ie(t,r,d),d},Le=function(e,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(e,t)};class qr extends ra{constructor(t,r,i){super(t,i),this.trackMediaType="audio",this._enabled=!0,this._volume=100,this._useAudioElement=!1,this._bypassWebAudio=!1,this._encoderConfig=r,this._source=new Fp(t)}get isPlaying(){return this._useAudioElement?Yr.isPlaying(this.getTrackId()):this._source.isPlayed}setVolume(t){Ie(t,"volume",0,1e3);const r=At.reportApiInvoke(null,{tag:Wt.TRACER,name:Ht.LOCAL_AUDIO_TRACK_SET_VOLUME,options:[this.getTrackId(),t]},300);this._volume=t,this._source.setVolume(t/100),this._useAudioElement&&Yr.setVolume(this.getTrackId(),t);try{if(this._bypassWebAudio)return S.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio.")),void r.onSuccess();const i=this._source.createOutputTrack();this._mediaStreamTrack!==i&&(this._mediaStreamTrack=i,Xe(this,Yt.NEED_REPLACE_TRACK,this).then(()=>{S.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(s=>{S.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),s)}))}catch{}r.onSuccess()}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}async setPlaybackDevice(t){const r=At.reportApiInvoke(null,{tag:Wt.TRACER,name:Ht.REMOTE_AUDIO_SET_OUTPUT_DEVICE,options:[this.getTrackId(),t]});if(!this._useAudioElement)throw new P(D.NOT_SUPPORTED,"your browser does not support setting the audio output device");try{await Yr.setSinkID(this.getTrackId(),t)}catch(i){throw r.onError(i),i}r.onSuccess()}async setEnabled(t,r,i){if(!i){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(S.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){this._originMediaStreamTrack.enabled=!0;try{var s;i||(this._enabled=!0),await Xe(this,Yt.NEED_ENABLE_TRACK,this),S.info(k(s="[".concat(this.getTrackId(),"] setEnabled to ")).call(s,t," success"))}catch(l){throw i||(this._enabled=!1),S.error("[".concat(this.getTrackId(),"] setEnabled to true error"),l.toString()),l}}else{this._originMediaStreamTrack.enabled=!1,i||(this._enabled=!1);try{await Xe(this,Yt.NEED_DISABLE_TRACK,this)}catch(l){throw i||(this._enabled=!0),S.error("[".concat(this.getTrackId(),"] setEnabled to false error"),l.toString()),l}}}async setMuted(t){var r;t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._mediaStreamTrack.enabled=!t,S.debug(k(r="[".concat(this.getTrackId(),"] start set muted: ")).call(r,t)),t?await Xe(this,Yt.NEED_MUTE_TRACK,this):await Xe(this,Yt.NEED_UNMUTE_TRACK,this))}getStats(){return ys(()=>{S.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),po(this,Yt.GET_STATS)||Gp({},ou)}setAudioFrameCallback(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(Oo.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(Oo.ON_AUDIO_BUFFER),this._source.on(Oo.ON_AUDIO_BUFFER,i=>t(i))}play(){const t=At.reportApiInvoke(null,{tag:Wt.TRACER,name:Ht.LOCAL_AUDIO_TRACK_PLAY,options:[this.getTrackId()]});S.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(S.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Yr.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play(),t.onSuccess()}stop(){const t=At.reportApiInvoke(null,{tag:Wt.TRACER,name:Ht.LOCAL_AUDIO_TRACK_STOP,options:[this.getTrackId()]});S.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Yr.stop(this.getTrackId()):this._source.stop(),t.onSuccess()}close(){super.close(),this._source.destroy()}_updatePlayerSource(){S.debug("[".concat(this.getTrackId(),"] update player source track")),this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Yr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(t,r){this._originMediaStreamTrack!==t&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t.addEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop(),this._originMediaStreamTrack=t,this._source.updateTrack(this._originMediaStreamTrack),this._mediaStreamTrack!==this._source.outputTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Xe(this,Yt.NEED_REPLACE_TRACK,this)))}renewMediaStreamTrack(){return ct.resolve(void 0)}}Ki([Br(),Le("design:type",Function),Le("design:paramtypes",[String]),Le("design:returntype",ct)],qr.prototype,"setPlaybackDevice",null),Ki([Nl("LocalAudioTrack","_enabledMutex"),Br(),Le("design:type",Function),Le("design:paramtypes",[Boolean,Object,Boolean]),Le("design:returntype",ct)],qr.prototype,"setEnabled",null),Ki([Nl("LocalAudioTrack","_enabledMutex"),Br(),Up({report:At}),Le("design:type",Function),Le("design:paramtypes",[Boolean]),Le("design:returntype",ct)],qr.prototype,"setMuted",null),Ki([Br(),Le("design:type",Function),Le("design:paramtypes",[]),Le("design:returntype",Object)],qr.prototype,"getStats",null),Ki([Br(),Le("design:type",Function),Le("design:paramtypes",[Object,Number]),Le("design:returntype",void 0)],qr.prototype,"setAudioFrameCallback",null),Ki([Br(),Le("design:type",Function),Le("design:paramtypes",[]),Le("design:returntype",void 0)],qr.prototype,"play",null),Ki([Br(),Le("design:type",Function),Le("design:paramtypes",[]),Le("design:returntype",void 0)],qr.prototype,"stop",null);class gu extends qr{constructor(t,r,i,s){super(t,r.encoderConfig?Cc(r.encoderConfig):{},s),this._deviceName="default",this._enabled=!0,this._config=r,this._constraints=i,this._deviceName=t.label,typeof r.bypassWebAudio=="boolean"&&(this._bypassWebAudio=r.bypassWebAudio),Xs()&&le.bindInterruptDetectorTrack(this)}async setDevice(t){var r,i;const s=At.reportApiInvoke(null,{tag:Wt.TRACER,name:Ht.MIC_AUDIO_TRACK_SET_DEVICE,options:[this.getTrackId(),t]});if(S.info(k(r="[".concat(this.getTrackId(),"] start set device to ")).call(r,t)),this._enabled)try{const l=await dn.getDeviceById(t),d={};d.audio=Gp({},this._constraints),d.audio.deviceId={exact:t},this._originMediaStreamTrack.stop();let h=null;try{h=await on(d,this.getTrackId())}catch(p){throw S.error("[".concat(this.getTrackId(),"] setDevice failed"),p.toString()),h=await on({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),p}await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),this._deviceName=l.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(l){throw s.onError(l),S.error("[".concat(this.getTrackId(),"] setDevice error"),l.toString()),l}else try{const l=await dn.getDeviceById(t);this._deviceName=l.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(l){throw s.onError(l),S.error("[".concat(this.getTrackId(),"] setDevice error"),l.toString()),l}s.onSuccess(),S.info(k(i="[".concat(this.getTrackId(),"] set device to ")).call(i,t," success"))}async setEnabled(t,r,i){if(r)return S.debug("[".concat(this.getTrackId,"] setEnabled false (do not close microphone)")),await super.setEnabled(t);if(!i){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(S.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),i||(this._enabled=!1);try{await Xe(this,Yt.NEED_DISABLE_TRACK,this)}catch(d){throw S.error("[".concat(this.getTrackId(),"] setEnabled false failed"),d.toString()),d}return}const s=Gp({},this._constraints),l=dn.searchDeviceIdByName(this._deviceName);l&&!s.deviceId&&(s.deviceId=l);try{i||(this._enabled=!0);const d=await on({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(d.getAudioTracks()[0],!1),await Xe(this,Yt.NEED_ENABLE_TRACK,this)}catch(d){throw i||(this._enabled=!1),S.error("[".concat(this.getTrackId(),"] setEnabled true failed"),d.toString()),d}S.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),Xs()&&le.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((ui()||Zo())&&this._enabled&&!this._isClosed&&le.duringInterruption){const t=async()=>{le.off(yr.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(S.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};le.on(yr.IOS_INTERRUPTION_END,t)}else S.debug("[".concat(this.getTrackId(),"] track ended")),this.emit(ta.TRACK_ENDED)}async renewMediaStreamTrack(){const t=Gp({},this._constraints),r=dn.searchDeviceIdByName(this._deviceName);r&&!t.deviceId&&(t.deviceId=r);const i=await on({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!0)}}Ki([Br(),Le("design:type",Function),Le("design:paramtypes",[String]),Le("design:returntype",ct)],gu.prototype,"setDevice",null),Ki([Nl("MicrophoneAudioTrack","_enabledMutex"),Br(),Le("design:type",Function),Le("design:paramtypes",[Boolean,Boolean,Boolean]),Le("design:returntype",ct)],gu.prototype,"setEnabled",null);class Dl extends qr{constructor(t,r,i,s){super(r.createOutputTrack(),i,s),this.source=t,this._bufferSource=r,this._bufferSource.on(Oo.AUDIO_SOURCE_STATE_CHANGE,l=>{this.emit(ta.SOURCE_STATE_CHANGE,l)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(t){const r=At.reportApiInvoke(null,{tag:Wt.TRACER,name:Ht.BUFFER_AUDIO_TRACK_START,options:[this.getTrackId(),t,this.duration]});t&&this._bufferSource.updateOptions(t),this._bufferSource.startProcessAudioBuffer(),r.onSuccess()}pauseProcessAudioBuffer(){const t=At.reportApiInvoke(null,{tag:Wt.TRACER,name:Ht.BUFFER_AUDIO_TRACK_PAUSE,options:[this.getTrackId()]});this._bufferSource.pauseProcessAudioBuffer(),t.onSuccess()}seekAudioBuffer(t){const r=At.reportApiInvoke(null,{tag:Wt.TRACER,name:Ht.BUFFER_AUDIO_TRACK_SEEK,options:[this.getTrackId()]});this._bufferSource.seekAudioBuffer(t),r.onSuccess()}resumeProcessAudioBuffer(){const t=At.reportApiInvoke(null,{tag:Wt.TRACER,name:Ht.BUFFER_AUDIO_TRACK_RESUME,options:[this.getTrackId()]});this._bufferSource.resumeProcessAudioBuffer(),t.onSuccess()}stopProcessAudioBuffer(){const t=At.reportApiInvoke(null,{tag:Wt.TRACER,name:Ht.BUFFER_AUDIO_TRACK_STOP,options:[this.getTrackId()]});this._bufferSource.stopProcessAudioBuffer(),t.onSuccess()}}Ki([Br(),Le("design:type",Function),Le("design:paramtypes",[Object]),Le("design:returntype",void 0)],Dl.prototype,"startProcessAudioBuffer",null),Ki([Br(),Le("design:type",Function),Le("design:paramtypes",[]),Le("design:returntype",void 0)],Dl.prototype,"pauseProcessAudioBuffer",null),Ki([Br(),Le("design:type",Function),Le("design:paramtypes",[Number]),Le("design:returntype",void 0)],Dl.prototype,"seekAudioBuffer",null),Ki([Br(),Le("design:type",Function),Le("design:paramtypes",[]),Le("design:returntype",void 0)],Dl.prototype,"resumeProcessAudioBuffer",null),Ki([Br(),Le("design:type",Function),Le("design:paramtypes",[]),Le("design:returntype",void 0)],Dl.prototype,"stopProcessAudioBuffer",null);class uo extends qr{constructor(){const t=Ol().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,Pe(8,"track-mix-"));try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}hasAudioTrack(t){var r;return xt(r=this.trackList).call(r,t)!==-1}addAudioTrack(t){var r;xt(r=this.trackList).call(r,t)===-1?(S.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):S.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){var r;if(xt(r=this.trackList).call(r,t)!==-1){S.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}na(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){var t;const r={};V(t=this.trackList).call(t,i=>{i._encoderConfig&&((i._encoderConfig.bitrate||0)>(r.bitrate||0)&&(r.bitrate=i._encoderConfig.bitrate),(i._encoderConfig.sampleRate||0)>(r.sampleRate||0)&&(r.sampleRate=i._encoderConfig.sampleRate),(i._encoderConfig.sampleSize||0)>(r.sampleSize||0)&&(r.sampleSize=i._encoderConfig.sampleSize),i._encoderConfig.stereo&&(r.stereo=!0))}),this._encoderConfig=r}}class d8 extends Wr{constructor(){super(...arguments),this.resultStorage=new $t}setLocalAudioStats(t,r,i){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(i,r)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(i,r))}setLocalVideoStats(t,r,i){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(i,r)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(i,r)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(i))}setRemoteAudioStats(t,r){const i=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",i,this.checkAudioOutputLevel(r))}setRemoteVideoStats(t,r){const i=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",i,this.checkVideoDecode(r))}record(t,r,i){this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const s=this.resultStorage.get(t);if(s&&(s.result.push(i),s.result.length>=5)){var l;const d=qt(l=s.result).call(l,!0);s.isPrevNormal&&!d&&this.emit("exception",vy[t],t,r),!s.isPrevNormal&&d&&this.emit("exception",vy[t]+2e3,t+"_RECOVER",r),s.isPrevNormal=d,s.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,r){return r instanceof uo&&!r.isActive||!!r.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,r){let i=null;r._encoderConfig&&r._encoderConfig.frameRate&&(i=Qa(r._encoderConfig.frameRate));const s=t.captureFrameRate;return!i||!s||!(i>10&&s<5||i<10&&i>=5&&s<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checkSendVideoBitrate(t,r){return!!r.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,r){return r instanceof uo&&!r.isActive||!!r.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}const vy={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},ho=new class{markSubscribeStart(e,t){var r;performance.mark(k(r="agora-web-sdk/".concat(e,"/subscribe-")).call(r,t))}markPublishStart(e,t){var r;performance.mark(k(r="agora-web-sdk/".concat(e,"/publish-")).call(r,t))}measureFromSubscribeStart(e,t){var r;const i=performance.getEntriesByName(k(r="agora-web-sdk/".concat(e,"/subscribe-")).call(r,t));if(i.length>0){const s=i[i.length-1];return performance.now()-s.startTime}return 0}measureFromPublishStart(e,t){var r;const i=performance.getEntriesByName(k(r="agora-web-sdk/".concat(e,"/publish-")).call(r,t));if(i.length>0){const s=i[i.length-1];return Math.round(performance.now()-s.startTime)}return 0}};function Cy(e,t){var r=ae(e);if(Xt){var i=Xt(e);t&&(i=kt(i).call(i,function(s){return jt(e,s).enumerable})),r.push.apply(r,i)}return r}function bc(e){for(var t=1;t<arguments.length;t++){var r,i,s=arguments[t]!=null?arguments[t]:{};t%2?V(r=Cy(Object(s),!0)).call(r,function(l){mr(e,l,s[l])}):Zt?ur(e,Zt(s)):V(i=Cy(Object(s))).call(i,function(l){ie(e,l,jt(s,l))})}return e}class Ll{constructor(t){this.localStats=new $t,this.remoteStats=new $t,this.trafficStatsPeerList=[],this.updateStats=()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))},this.store=t,this.updateStatsInterval=be(this.updateStats,1e3),this.exceptionMonitor=new d8,this.exceptionMonitor.on("exception",(r,i,s)=>{this.onStatsException&&this.onStatsException(r,i,s)})}reset(){this.localStats=new $t,this.remoteStats=new $t,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Ut.LocalAudioTrack)||bc({},ou)}getLocalVideoTrackStats(){return this.localStats.get(Ut.LocalVideoTrack)||bc({},su)}getRemoteAudioTrackStats(t){const r=(h,p)=>{var m;if(!this.trafficStats)return p;const f=ft(m=this.trafficStats.peer_delay).call(m,_=>_.peer_uid===h);return f&&(p.publishDuration=f.B_ppad+(ht()-this.trafficStats.timestamp)),p},i={};if(t){var s;const h=(s=this.remoteStats.get(t))===null||s===void 0?void 0:s.audioStats;h&&(i[t]=r(t,h))}else{var l,d;V(l=Qe(nn(d=this.remoteStats).call(d))).call(l,h=>{let[p,{audioStats:m}]=h;m&&(i[p]=r(p,m))})}return i}getRemoteNetworkQualityStats(t){const r={};if(t){var i;const d=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.networkStats;d&&(r[t]=d)}else{var s,l;V(s=Qe(nn(l=this.remoteStats).call(l))).call(s,d=>{let[h,{networkStats:p}]=d;p&&(r[h]=p)})}return r}getRemoteVideoTrackStats(t){const r=(h,p)=>{var m;if(!this.trafficStats)return p;const f=ft(m=this.trafficStats.peer_delay).call(m,_=>_.peer_uid===h);return f&&(p.publishDuration=f.B_ppvd+(ht()-this.trafficStats.timestamp)),p},i={};if(t){var s;const h=(s=this.remoteStats.get(t))===null||s===void 0?void 0:s.videoStats;h&&(i[t]=r(t,h))}else{var l,d;V(l=Qe(nn(d=this.remoteStats).call(d))).call(l,h=>{let[p,{videoStats:m}]=h;m&&(i[p]=r(p,m))})}return i}getRTCStats(){var t;let r=0,i=0,s=0,l=0;const d=this.localStats.get(Ut.LocalAudioTrack);d&&(r+=d.sendBytes,i+=d.sendBitrate);const h=this.localStats.get(Ut.LocalVideoTrack);h&&(r+=h.sendBytes,i+=h.sendBitrate);const p=this.localStats.get(Ut.LocalVideoLowTrack);p&&(r+=p.sendBytes,i+=p.sendBitrate),V(t=this.remoteStats).call(t,f=>{let{audioStats:_,videoStats:v}=f;_&&(s+=_.receiveBytes,l+=_.receiveBitrate),v&&(s+=v.receiveBytes,l+=v.receiveBitrate)});let m=1;return this.trafficStats&&(m+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:m,SendBitrate:i,SendBytes:r,RecvBytes:s,RecvBitrate:l,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){var r;const i=kt(r=t.peer_delay).call(r,s=>{var l;return xt(l=this.trafficStatsPeerList).call(l,s.peer_uid)===-1});V(i).call(i,s=>{var l;const d=(l=this.p2pChannel)===null||l===void 0?void 0:l.getRemoteMedia(s.peer_uid),h=d!=null&&d.videoSSRC?ho.measureFromSubscribeStart(this.store.clientId,d.videoSSRC):0,p=d!=null&&d.audioSSRC?ho.measureFromSubscribeStart(this.store.clientId,d.audioSSRC):0;s.B_ppad!==void 0&&s.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(s.peer_uid,s.B_ppad,s.B_ppvd,h>p?h:p),this.trafficStatsPeerList.push(s.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){var r;this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&S.debug(k(r="[".concat(this.store.clientId,"]: Period fir changes to ")).call(r,t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,r,i){if(!t)return!1;const s=!!i&&r.framesDecodeFreezeTime>i.framesDecodeFreezeTime,l=!i||r.framesDecodeCount>i.framesDecodeCount;return s||!l}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){var r,i;V(r=Qe(nn(i=this.localStats).call(i))).call(r,s=>{let[l,d]=s;switch(l){case Ut.LocalVideoTrack:case Ut.LocalVideoLowTrack:{const m=d,f=bc({},su),_=t.getStats(),v=t.getLocalMedia(l);if(_){var h;const T=ft(h=_.videoSend).call(h,R=>R.ssrc===(v==null?void 0:v.ssrcs[0].ssrcId));if(T){const R=t.getLocalVideoSize(),w=t.getEncoderConfig(Ut.LocalVideoTrack);T.codec!=="H264"&&T.codec!=="VP8"&&T.codec!=="VP9"&&T.codec!=="AV1X"||(f.codecType=T.codec),f.sendBytes=T.bytes,f.sendBitrate=m?8*Math.max(0,f.sendBytes-m.sendBytes):0,T.inputFrame?(f.captureFrameRate=T.inputFrame.frameRate,f.captureResolutionHeight=T.inputFrame.height,f.captureResolutionWidth=T.inputFrame.width):R&&(f.captureResolutionWidth=R.width,f.captureResolutionHeight=R.height),T.sentFrame?(f.sendFrameRate=T.sentFrame.frameRate,f.sendResolutionHeight=T.sentFrame.height,f.sendResolutionWidth=T.sentFrame.width):R&&(f.sendResolutionWidth=R.width,f.sendResolutionHeight=R.height),T.avgEncodeMs&&(f.encodeDelay=T.avgEncodeMs),w&&w.bitrateMax&&(f.targetSendBitrate=1e3*w.bitrateMax),f.sendPackets=T.packets,f.sendPacketsLost=T.packetsLost,f.totalDuration=m?m.totalDuration+1:1,f.totalFreezeTime=m?m.totalFreezeTime:0,this.isLocalVideoFreeze(T)&&(f.totalFreezeTime+=1)}this.trafficStats&&(f.sendPacketsLost=this.trafficStats.B_pvlr4/100)}this.localStats.set(l,f),f&&v&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,v.track,f);break}case Ut.LocalAudioTrack:{const m=d,f=bc({},ou),_=t.getStats(),v=t.getLocalMedia(l);if(_){var p;const T=ft(p=_.audioSend).call(p,R=>R.ssrc===(v==null?void 0:v.ssrcs[0].ssrcId));if(T){if(T.codec!=="opus"&&T.codec!=="aac"||(f.codecType=T.codec),T.inputLevel)f.sendVolumeLevel=Math.round(32767*T.inputLevel);else{const R=t.getLocalAudioVolume();R&&(f.sendVolumeLevel=Math.round(32767*R))}f.sendBytes=T.bytes,f.sendPackets=T.packets,f.sendPacketsLost=T.packetsLost,f.sendBitrate=m?8*Math.max(0,f.sendBytes-m.sendBytes):0}}this.trafficStats&&(f.sendPacketsLost=this.trafficStats.B_pvlr4/100),this.localStats.set(Ut.LocalAudioTrack,f),f&&v&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,v.track,f);break}}})}updateRemoteStats(t){var r,i;V(r=Qe(nn(i=this.remoteStats).call(i))).call(r,s=>{var l,d,h;let[p,{videoStats:m,audioStats:f,videoPcStats:_}]=s;const v=f,T=m,R=_,w=bc({},Op),O=bc({},kp),B=bc({},jm),{audioTrack:K,videoTrack:j,audioSSRC:nt,videoSSRC:It}=t.getRemoteMedia(p),vt=t.getStats(),Rt=vt==null?void 0:ft(l=vt.audioRecv).call(l,H=>H.ssrc===nt),X=vt==null?void 0:ft(d=vt.videoRecv).call(d,H=>H.ssrc===It),rt=this.trafficStats&&ft(h=this.trafficStats.peer_delay).call(h,H=>H.peer_uid===p);if(Rt&&(Rt.codec!=="opus"&&Rt.codec!=="aac"||(w.codecType=Rt.codec),Rt.outputLevel?w.receiveLevel=Math.round(32767*Rt.outputLevel):K&&(w.receiveLevel=Math.round(32767*K.getVolumeLevel())),w.receiveBytes=Rt.bytes,w.receivePackets=Rt.packets,w.receivePacketsLost=Rt.packetsLost,w.packetLossRate=w.receivePacketsLost/(w.receivePackets+w.receivePacketsLost),w.receiveBitrate=v?8*Math.max(0,w.receiveBytes-v.receiveBytes):0,w.totalDuration=v?v.totalDuration+1:1,w.totalFreezeTime=v?v.totalFreezeTime:0,w.freezeRate=w.totalFreezeTime/w.totalDuration,w.receiveDelay=Rt.jitterBufferMs,w.totalDuration>10&&Ll.isRemoteAudioFreeze(K)&&(w.totalFreezeTime+=1)),X){X.codec!=="H264"&&X.codec!=="VP8"&&X.codec!=="VP9"&&X.codec!=="AV1X"||(O.codecType=X.codec),O.receiveBytes=X.bytes,O.receiveBitrate=T?8*Math.max(0,O.receiveBytes-T.receiveBytes):0,O.decodeFrameRate=X.decodeFrameRate<0?0:X.decodeFrameRate,O.renderFrameRate=X.decodeFrameRate<0?0:X.decodeFrameRate,X.outputFrame&&(O.renderFrameRate=X.outputFrame.frameRate),X.receivedFrame?(O.receiveFrameRate=X.receivedFrame.frameRate,O.receiveResolutionHeight=X.receivedFrame.height,O.receiveResolutionWidth=X.receivedFrame.width):j&&(O.receiveResolutionHeight=j._videoHeight||0,O.receiveResolutionWidth=j._videoWidth||0),X.framesRateFirefox!==void 0&&(O.receiveFrameRate=Math.round(X.framesRateFirefox)),O.receivePackets=X.packets,O.receivePacketsLost=X.packetsLost,O.packetLossRate=O.receivePacketsLost/(O.receivePackets+O.receivePacketsLost),O.totalDuration=T?T.totalDuration+1:1,O.totalFreezeTime=T?T.totalFreezeTime:0,O.receiveDelay=X.jitterBufferMs||0;const H=!!It&&t.getRemoteVideoIsReady(It);j&&H&&Ll.isRemoteVideoFreeze(j,X,R)&&(O.totalFreezeTime+=1),O.freezeRate=O.totalFreezeTime/O.totalDuration}rt&&(w.end2EndDelay=rt.B_ad,O.end2EndDelay=rt.B_vd,w.transportDelay=rt.B_ed,O.transportDelay=rt.B_ed,w.currentPacketLossRate=rt.B_ealr4/100,O.currentPacketLossRate=rt.B_evlr4/100,B.uplinkNetworkQuality=rt.B_punq?rt.B_punq:0,B.downlinkNetworkQuality=rt.B_pdnq?rt.B_pdnq:0),this.remoteStats.set(p,{audioStats:w,videoStats:O,videoPcStats:X,networkStats:B}),K&&this.exceptionMonitor.setRemoteAudioStats(K,w),j&&this.exceptionMonitor.setRemoteVideoStats(j,O)})}}var u8=nl,h8=Fi,p8=Ln,A8=G.RangeError,Sy=N,f8=Ph,Ty=Fi,g8=Ln,m8=Sy(function(e){var t=h8(p8(this)),r="",i=u8(e);if(i<0||i==1/0)throw A8("Wrong number of repetitions");for(;i>0;(i>>>=1)&&(t+=t))1&i&&(r+=t);return r}),E8=Sy("".slice),_8=Math.ceil,Ry=function(e){return function(t,r,i){var s,l,d=Ty(g8(t)),h=f8(r),p=d.length,m=i===void 0?" ":Ty(i);return h<=p||m==""?d:((l=m8(m,_8((s=h-p)/m.length))).length>s&&(l=E8(l,0,s)),e?d+l:l+d)}},I8={start:Ry(!1),end:Ry(!0)},v8=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(Pn),C8=I8.start;Ae({target:"String",proto:!0,forced:v8},{padStart:function(e){return C8(this,e,arguments.length>1?arguments[1]:void 0)}});var S8=$r("String").padStart,T8=L,R8=S8,mE=String.prototype,y8=function(e){var t=e.padStart;return typeof e=="string"||e===mE||T8(mE,e)&&t===mE.padStart?R8:t};function yy(e){return new TextEncoder().encode(e)}const wy=async e=>{const t=mu(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),r=await window.crypto.subtle.importKey("spki",t,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),i=yy(e),s=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},r,i);return Nc(new Uint8Array(s))},w8=async e=>function(t,r){let i="";const s=new Uint8Array(t);return V(s).call(s,l=>{var d;i+=y8(d=l.toString(r)).call(d,2,"0")}),i}(await crypto.subtle.digest("SHA-256",yy(e)),16);function by(e,t){var r=ae(e);if(Xt){var i=Xt(e);t&&(i=kt(i).call(i,function(s){return jt(e,s).enumerable})),r.push.apply(r,i)}return r}function jp(e){for(var t=1;t<arguments.length;t++){var r,i,s=arguments[t]!=null?arguments[t]:{};t%2?V(r=by(Object(s),!0)).call(r,function(l){mr(e,l,s[l])}):Zt?ur(e,Zt(s)):V(i=by(Object(s))).call(i,function(l){ie(e,l,jt(s,l))})}return e}function b8(e){if(!e.address||!e.tcp)throw new P(D.UNEXPECTED_RESPONSE,"Invalid address format ".concat(e));return e.address.match(/^[\.\:\d]+$/)?"".concat(e.address.replace(/[^\d]/g,"-"),".edge.agora.io"):(S.info("Cannot recognized as IP address ".concat(e.address,". Used As Host instead")),k(t="".concat(e.address,":")).call(t,e.tcp));var t}function Ny(e){var t;return e.match(/^[\.\:\d]+$/)?k(t="".concat(e.replace(/[^\d]/g,"-"),".")).call(t,it("TURN_DOMAIN")):(S.info("Cannot recognized as IP address ".concat(e,". Used As Host instead")),e)}function Oy(e,t){var r;const i=it("GATEWAY_DOMAINS");let s=i[1]&&xt(t).call(t,i[1])!==-1?1:0;return e.addresses=e.addresses||[],{gatewayAddrs:pt(r=e.addresses).call(r,l=>{var d,h,p;return l.ip.match(/^[\.\:\d]+$/)?k(d=k(h="".concat(l.ip.replace(/[^\d]/g,"-"),".")).call(h,i[s++%i.length],":")).call(d,l.port):(S.info("Cannot recognized as IP address ".concat(l.ip,". Used As Host instead")),k(p="".concat(l.ip,":")).call(p,l.port))}),uid:e.uid,cid:e.cid,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function Qa(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function ky(e){var t;const r=e._encoderConfig;if(!r)return{};const i={resolution:r.width&&r.height?k(t="".concat(Qa(r.width),"x")).call(t,Qa(r.height)):void 0,maxVideoBW:r.bitrateMax,minVideoBW:r.bitrateMin};return typeof r.frameRate=="number"?(i.maxFrameRate=r.frameRate,i.minFrameRate=r.frameRate):r.frameRate&&(i.maxFrameRate=r.frameRate.max||r.frameRate.ideal||r.frameRate.exact||r.frameRate.min,i.minFrameRate=r.frameRate.min||r.frameRate.ideal||r.frameRate.exact||r.frameRate.max),i}function Dy(e,t,r){var i,s,l;const d=ft(i=t.videoSend).call(i,m=>m.ssrc===e);if(!d)return null;const h=r==null||(s=ft(l=r.videoSend).call(l,m=>m.ssrc===e))===null||s===void 0?void 0:s.inputFrame,p={id:Pe(10,""),timestamp:new Date(t.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:d.ssrc.toString()};return d.inputFrame&&(h&&d.inputFrame.height===h.height||(p.A_fhi=d.inputFrame.height?d.inputFrame.height.toString():"0"),h&&d.inputFrame.width===h.width||(p.A_fwi=d.inputFrame.width?d.inputFrame.width.toString():"0"),h&&d.inputFrame.frameRate===h.frameRate||(p.A_fri=d.inputFrame.frameRate?d.inputFrame.frameRate.toString():"0")),p}function Ly(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function EE(e,t){var r;let i,s,l;switch(t){case ei.CHOOSE_SERVER:i=4096,s="choose server";break;case ei.CLOUD_PROXY:i=1048576,s="proxy";break;case ei.CLOUD_PROXY_5:i=4194304,s="proxy5";break;default:throw new P(D.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(V(r=e.response_body).call(r,d=>{var h;d.buffer&&d.buffer.flag===i&&(l={code:d.buffer.code,addresses:pt(h=d.buffer.edges_services).call(h,p=>jp(jp({},p),{},{ticket:d.buffer.cert})),server_ts:e.enter_ts,uid:d.buffer.uid,cid:d.buffer.cid,cname:d.buffer.cname,detail:jp(jp({},d.buffer.detail),e.detail),flag:d.buffer.flag,opid:e.opid})}),!l)throw new P(D.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(s," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return l}async function N8(e,t){var r;return await ct.all(pt(r=e.addresses).call(r,async i=>({address:i.ip,tcpport:i.port,udpport:i.port,username:t?t.toString():qe.username,password:t?await w8(t.toString()):qe.password})))}function O8(e,t){const r=t._videoHeight||t.getMediaStreamTrack(!0).getSettings().height;return r?r/Qa(e.height):4}var Py;function By(e,t){var r=ae(e);if(Xt){var i=Xt(e);t&&(i=kt(i).call(i,function(s){return jt(e,s).enumerable})),r.push.apply(r,i)}return r}function Pl(e){for(var t=1;t<arguments.length;t++){var r,i,s=arguments[t]!=null?arguments[t]:{};t%2?V(r=By(Object(s),!0)).call(r,function(l){mr(e,l,s[l])}):Zt?ur(e,Zt(s)):V(i=By(Object(s))).call(i,function(l){ie(e,l,jt(s,l))})}return e}function Bl(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function My(e,t,r){const i=e[t];if(!i||typeof i!="string")return[e];e[t]="";const s=Bl(St(e));let l=0;const d=[];let h=0;for(let p=0;p<i.length;p++)h+=i.charCodeAt(p)<=127?1:3,h<=r-s||(d[d.length]=Pl(Pl({},e),{},{[t]:i.substring(l,p)}),l=p,h=i.charCodeAt(p)<=127?1:3);return l!==i.length-1&&(d[d.length]=Pl(Pl({},e),{},{[t]:i.substring(l)})),d}function Mr(e){return new ct(t=>{ar(t,e)})}function k8(e){const t=new P(D.TIMEOUT,"timeout");return new ct((r,i)=>{ar(()=>i(t),e)})}function Uy(e,t){return t===1/0?e:ct.race([e,k8(t)])}function Pe(){var e,t;let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,i=arguments.length>1?arguments[1]:void 0;const s=Math.random().toString(16).substr(2,r).toLowerCase();return s.length===r?k(e="".concat(i)).call(e,s):k(t="".concat(i)).call(t,s)+Pe(r-s.length,"")}function Hp(){return Pe(32,"").toUpperCase()}const Ml=()=>{};function Kp(e){return new ct((t,r)=>{let i=!1;const s=document.createElement("video");s.setAttribute("autoplay",""),s.setAttribute("muted",""),s.muted=!0,s.autoplay=!0,s.setAttribute("playsinline",""),s.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(s);const l=ui()?"canplay":"playing";s.addEventListener(l,()=>{const d=s.videoWidth,h=s.videoHeight;!d&&Gr()||(i=!0,s.srcObject=null,s.remove(),t([d,h]))}),s.srcObject=new MediaStream([e]),s.play().catch(Ml),ar(()=>{i||(s.srcObject=null,s.remove(),t([s.videoWidth,s.videoHeight]))},4e3)})}function Rs(e){return ct.all(pt(e).call(e,t=>t.then(r=>{throw r},r=>r))).then(t=>{throw t},t=>t)}function Ur(e,t){for(var r=arguments.length,i=new Array(r>2?r-2:0),s=2;s<r;s++)i[s-2]=arguments[s];return e.getListeners(t).length===0?ct.reject(new P(D.UNEXPECTED_ERROR,"can not emit promise")):new ct((l,d)=>{e.emit(t,...i,l,d)})}function Xe(e,t){if(e.getListeners(t).length===0)return ct.resolve();for(var r=arguments.length,i=new Array(r>2?r-2:0),s=2;s<r;s++)i[s-2]=arguments[s];return Ur(e,t,...i)}function po(e,t){if(e.getListeners(t).length===0)return null;for(var r=arguments.length,i=new Array(r>2?r-2:0),s=2;s<r;s++)i[s-2]=arguments[s];return Va(e,t,...i)}function Va(e,t){let r=null,i=null;for(var s=arguments.length,l=new Array(s>2?s-2:0),d=2;d<s;d++)l[d-2]=arguments[d];if(e.emit(t,...l,h=>{r=h},h=>{i=h}),i!==null)throw i;if(r===null)throw new P(D.UNEXPECTED_ERROR,"handler is not sync");return r}function na(e,t){const r=xt(e).call(e,t);r!==-1&&Ye(e).call(e,r,1)}function Wp(e){const t=[];return V(e).call(e,r=>{xt(t).call(t,r)===-1&&t.push(r)}),t}function sn(e){ct.resolve().then(e)}function In(e){return JSON.parse(St(e))}const xy={};function ys(e,t){xy[t]||(xy[t]=!0,e())}function mu(e){const t=window.atob(e),r=new Uint8Array(new ArrayBuffer(t.length));for(let i=0;i<t.length;i+=1)r[i]=t.charCodeAt(i);return r}function Nc(e){let t="";for(let r=0;r<e.length;r+=1)t+=String.fromCharCode(e[r]);return window.btoa(t)}const Fy=new class{constructor(){this.fnMap=new $t}throttleByKey(e,t,r,i){for(var s=arguments.length,l=new Array(s>4?s-4:0),d=4;d<s;d++)l[d-4]=arguments[d];if(this.fnMap.has(t)){const h=this.fnMap.get(t);if(h.threshold!==r){h.fn(...h.args),clearTimeout(h.timer);const p=ar(()=>{const m=this.fnMap.get(t);m&&m.fn(...m.args),this.fnMap.delete(t)},r);this.fnMap.set(t,{fn:e,threshold:r,timer:p,args:l,skipFn:i})}else h.skipFn&&h.skipFn(...h.args),this.fnMap.set(t,Pl(Pl({},h),{},{fn:e,args:l,skipFn:i}))}else{const h=ar(()=>{const p=this.fnMap.get(t);p&&p.fn(...p.args),this.fnMap.delete(t)},r);this.fnMap.set(t,{fn:e,threshold:r,timer:h,args:l,skipFn:i})}}},Yp=Lr(Py=Fy.throttleByKey).call(Py,Fy),Ao=async e=>{let{fragementLength:t,referenceList:r,asyncMapHandler:i,allFailedhandler:s,promisesCollector:l}=e,d=0;const h=t;let p,m=0;const f=async()=>{const _=(()=>{const v=d*h,T=v+h,R=rn(r).call(r,v,T);return pt(R).call(R,i)})();l&&l.push(..._);try{p=await Rs(_)}catch(v){if(m+=h,d++,!(m>=r.length))return void await f();s(v)}V(_).call(_,v=>v.cancel())};return await f(),p};var D8=$r("Array").values,L8=Is,P8=gn,B8=L,M8=D8,_E=Array.prototype,U8={DOMTokenList:!0,NodeList:!0},ia=function(e){var t=e.values;return e===_E||B8(_E,e)&&t===_E.values||P8(U8,L8(e))?M8:t};const x8={[Sl.ACCESS_POINT]:{[jn.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[jn.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[jn.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[jn.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[jn.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[jn.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voice service available",retry:!0},[jn.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[jn.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[jn.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[jn.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[jn.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[jn.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[jn.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[jn.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[jn.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[jn.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[Sl.UNILBS]:{[Vi.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Vi.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Vi.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Vi.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Vi.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Vi.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Vi.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Vi.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Vi.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Vi.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Vi.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Vi.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[Sl.STRING_UID_ALLOCATOR]:{[iu.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[iu.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[iu.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function oa(e){const t=x8[Math.floor(e/1e4)];if(!t)return{desc:"unkonw error",retry:!1};const r=t[e%1e4];if(!r){if(Math.floor(e/1e4)===Sl.ACCESS_POINT){const i=e%1e4;if(i.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(i.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unkonw error",retry:!1}}return r}const F8={[ne.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[ne.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[ne.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[ne.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[ne.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[ne.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[ne.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[ne.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[ne.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[ne.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[ne.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[ne.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[ne.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[ne.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[ne.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[ne.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[ne.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[ne.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[ne.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[ne.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[ne.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[ne.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[ne.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[ne.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[ne.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[ne.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[ne.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[ne.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[ne.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[ne.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[ne.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[ne.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[ne.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[ne.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[ne.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[ne.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[ne.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[ne.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[ne.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[ne.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[ne.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[ne.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[ne.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[ne.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[ne.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[ne.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[ne.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[ne.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[ne.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[ne.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[ne.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[ne.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[ne.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[ne.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[ne.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[ne.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"}};function qp(e){return F8[e]||{desc:"UNKNOW_ERROR_".concat(e),action:"failed"}}var Qy={exports:{}};(function(e,t){e.exports=function(){var r={d:function(z,x){for(var q in x)r.o(x,q)&&!r.o(z,q)&&Object.defineProperty(z,q,{enumerable:!0,get:x[q]})},o:function(z,x){return Object.prototype.hasOwnProperty.call(z,x)},r:function(z){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(z,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(z,"__esModule",{value:!0})}},i={};r.r(i),r.d(i,{DataViewIndexOutOfBoundsError:function(){return ut},DecodeError:function(){return nt},Decoder:function(){return wr},EXT_TIMESTAMP:function(){return It},Encoder:function(){return gt},ExtData:function(){return K},ExtensionCodec:function(){return U},decode:function(){return Jn},decodeArrayStream:function(){return mi},decodeAsync:function(){return zr},decodeMulti:function(){return cs},decodeMultiStream:function(){return ls},decodeStream:function(){return Aa},decodeTimestampExtension:function(){return H},decodeTimestampToTimeSpec:function(){return rt},encode:function(){return Y},encodeDateToTimeSpec:function(){return Rt},encodeTimeSpecToTimestamp:function(){return vt},encodeTimestampExtension:function(){return X}});var s=4294967295;function l(z,x,q){var st=Math.floor(q/4294967296),tt=q;z.setUint32(x,st),z.setUint32(x+4,tt)}function d(z,x){return 4294967296*z.getInt32(x)+z.getUint32(x+4)}var h=function(z,x){var q=typeof Symbol=="function"&&z[Symbol.iterator];if(!q)return z;var st,tt,yt=q.call(z),_t=[];try{for(;(x===void 0||x-- >0)&&!(st=yt.next()).done;)_t.push(st.value)}catch(Qt){tt={error:Qt}}finally{try{st&&!st.done&&(q=yt.return)&&q.call(yt)}finally{if(tt)throw tt.error}}return _t},p=function(z,x){for(var q=0,st=x.length,tt=z.length;q<st;q++,tt++)z[tt]=x[q];return z},m=typeof TextEncoder!="undefined"&&typeof TextDecoder!="undefined";function f(z){for(var x=z.length,q=0,st=0;st<x;){var tt=z.charCodeAt(st++);if((4294967168&tt)!=0)if((4294965248&tt)==0)q+=2;else{if(tt>=55296&&tt<=56319&&st<x){var yt=z.charCodeAt(st);(64512&yt)==56320&&(++st,tt=((1023&tt)<<10)+(1023&yt)+65536)}q+=(4294901760&tt)==0?3:4}else q++}return q}var _=m?new TextEncoder:void 0,v=m?typeof process!="undefined"?200:0:s,T=(_==null?void 0:_.encodeInto)?function(z,x,q){_.encodeInto(z,x.subarray(q))}:function(z,x,q){x.set(_.encode(z),q)};function R(z,x,q){for(var st=x,tt=st+q,yt=[],_t="";st<tt;){var Qt=z[st++];if((128&Qt)==0)yt.push(Qt);else if((224&Qt)==192){var se=63&z[st++];yt.push((31&Qt)<<6|se)}else if((240&Qt)==224){se=63&z[st++];var pe=63&z[st++];yt.push((31&Qt)<<12|se<<6|pe)}else if((248&Qt)==240){var Pt=(7&Qt)<<18|(se=63&z[st++])<<12|(pe=63&z[st++])<<6|63&z[st++];Pt>65535&&(Pt-=65536,yt.push(Pt>>>10&1023|55296),Pt=56320|1023&Pt),yt.push(Pt)}else yt.push(Qt);yt.length>=4096&&(_t+=String.fromCharCode.apply(String,p([],h(yt))),yt.length=0)}return yt.length>0&&(_t+=String.fromCharCode.apply(String,p([],h(yt)))),_t}var w,O=m?new TextDecoder:null,B=m?typeof process!="undefined"?200:0:s,K=function(z,x){this.type=z,this.data=x},j=(w=function(z,x){return(w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(q,st){q.__proto__=st}||function(q,st){for(var tt in st)Object.prototype.hasOwnProperty.call(st,tt)&&(q[tt]=st[tt])})(z,x)},function(z,x){if(typeof x!="function"&&x!==null)throw new TypeError("Class extends value "+String(x)+" is not a constructor or null");function q(){this.constructor=z}w(z,x),z.prototype=x===null?Object.create(x):(q.prototype=x.prototype,new q)}),nt=function(z){function x(q){var st=z.call(this,q)||this,tt=Object.create(x.prototype);return Object.setPrototypeOf(st,tt),Object.defineProperty(st,"name",{configurable:!0,enumerable:!1,value:x.name}),st}return j(x,z),x}(Error),It=-1;function vt(z){var x,q=z.sec,st=z.nsec;if(q>=0&&st>=0&&q<=17179869183){if(st===0&&q<=4294967295){var tt=new Uint8Array(4);return(x=new DataView(tt.buffer)).setUint32(0,q),tt}var yt=q/4294967296,_t=4294967295&q;return tt=new Uint8Array(8),(x=new DataView(tt.buffer)).setUint32(0,st<<2|3&yt),x.setUint32(4,_t),tt}return tt=new Uint8Array(12),(x=new DataView(tt.buffer)).setUint32(0,st),l(x,4,q),tt}function Rt(z){var x=z.getTime(),q=Math.floor(x/1e3),st=1e6*(x-1e3*q),tt=Math.floor(st/1e9);return{sec:q+tt,nsec:st-1e9*tt}}function X(z){return z instanceof Date?vt(Rt(z)):null}function rt(z){var x=new DataView(z.buffer,z.byteOffset,z.byteLength);switch(z.byteLength){case 4:return{sec:x.getUint32(0),nsec:0};case 8:var q=x.getUint32(0);return{sec:4294967296*(3&q)+x.getUint32(4),nsec:q>>>2};case 12:return{sec:d(x,4),nsec:x.getUint32(0)};default:throw new nt("Unrecognized data size for timestamp (expected 4, 8, or 12): "+z.length)}}function H(z){var x=rt(z);return new Date(1e3*x.sec+x.nsec/1e6)}var W={type:It,encode:X,decode:H},U=function(){function z(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(W)}return z.prototype.register=function(x){var q=x.type,st=x.encode,tt=x.decode;if(q>=0)this.encoders[q]=st,this.decoders[q]=tt;else{var yt=1+q;this.builtInEncoders[yt]=st,this.builtInDecoders[yt]=tt}},z.prototype.tryToEncode=function(x,q){for(var st=0;st<this.builtInEncoders.length;st++)if((tt=this.builtInEncoders[st])!=null&&(yt=tt(x,q))!=null)return new K(-1-st,yt);for(st=0;st<this.encoders.length;st++){var tt,yt;if((tt=this.encoders[st])!=null&&(yt=tt(x,q))!=null)return new K(st,yt)}return x instanceof K?x:null},z.prototype.decode=function(x,q,st){var tt=q<0?this.builtInDecoders[-1-q]:this.decoders[q];return tt?tt(x,q,st):new K(q,x)},z.defaultCodec=new z,z}();function Ct(z){return z instanceof Uint8Array?z:ArrayBuffer.isView(z)?new Uint8Array(z.buffer,z.byteOffset,z.byteLength):z instanceof ArrayBuffer?new Uint8Array(z):Uint8Array.from(z)}var Et=function(z){var x=typeof Symbol=="function"&&Symbol.iterator,q=x&&z[x],st=0;if(q)return q.call(z);if(z&&typeof z.length=="number")return{next:function(){return z&&st>=z.length&&(z=void 0),{value:z&&z[st++],done:!z}}};throw new TypeError(x?"Object is not iterable.":"Symbol.iterator is not defined.")},gt=function(){function z(x,q,st,tt,yt,_t,Qt,se){x===void 0&&(x=U.defaultCodec),q===void 0&&(q=void 0),st===void 0&&(st=100),tt===void 0&&(tt=2048),yt===void 0&&(yt=!1),_t===void 0&&(_t=!1),Qt===void 0&&(Qt=!1),se===void 0&&(se=!1),this.extensionCodec=x,this.context=q,this.maxDepth=st,this.initialBufferSize=tt,this.sortKeys=yt,this.forceFloat32=_t,this.ignoreUndefined=Qt,this.forceIntegerToFloat=se,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}return z.prototype.getUint8Array=function(){return this.bytes.subarray(0,this.pos)},z.prototype.reinitializeState=function(){this.pos=0},z.prototype.encode=function(x){return this.reinitializeState(),this.doEncode(x,1),this.getUint8Array()},z.prototype.doEncode=function(x,q){if(q>this.maxDepth)throw new Error("Too deep objects in depth "+q);x==null?this.encodeNil():typeof x=="boolean"?this.encodeBoolean(x):typeof x=="number"?this.encodeNumber(x):typeof x=="string"?this.encodeString(x):this.encodeObject(x,q)},z.prototype.ensureBufferSizeToWrite=function(x){var q=this.pos+x;this.view.byteLength<q&&this.resizeBuffer(2*q)},z.prototype.resizeBuffer=function(x){var q=new ArrayBuffer(x),st=new Uint8Array(q),tt=new DataView(q);st.set(this.bytes),this.view=tt,this.bytes=st},z.prototype.encodeNil=function(){this.writeU8(192)},z.prototype.encodeBoolean=function(x){x===!1?this.writeU8(194):this.writeU8(195)},z.prototype.encodeNumber=function(x){Number.isSafeInteger(x)&&!this.forceIntegerToFloat?x>=0?x<128?this.writeU8(x):x<256?(this.writeU8(204),this.writeU8(x)):x<65536?(this.writeU8(205),this.writeU16(x)):x<4294967296?(this.writeU8(206),this.writeU32(x)):(this.writeU8(207),this.writeU64(x)):x>=-32?this.writeU8(224|x+32):x>=-128?(this.writeU8(208),this.writeI8(x)):x>=-32768?(this.writeU8(209),this.writeI16(x)):x>=-2147483648?(this.writeU8(210),this.writeI32(x)):(this.writeU8(211),this.writeI64(x)):this.forceFloat32?(this.writeU8(202),this.writeF32(x)):(this.writeU8(203),this.writeF64(x))},z.prototype.writeStringHeader=function(x){if(x<32)this.writeU8(160+x);else if(x<256)this.writeU8(217),this.writeU8(x);else if(x<65536)this.writeU8(218),this.writeU16(x);else{if(!(x<4294967296))throw new Error("Too long string: "+x+" bytes in UTF-8");this.writeU8(219),this.writeU32(x)}},z.prototype.encodeString=function(x){if(x.length>v){var q=f(x);this.ensureBufferSizeToWrite(5+q),this.writeStringHeader(q),T(x,this.bytes,this.pos),this.pos+=q}else q=f(x),this.ensureBufferSizeToWrite(5+q),this.writeStringHeader(q),function(st,tt,yt){for(var _t=st.length,Qt=yt,se=0;se<_t;){var pe=st.charCodeAt(se++);if((4294967168&pe)!=0){if((4294965248&pe)==0)tt[Qt++]=pe>>6&31|192;else{if(pe>=55296&&pe<=56319&&se<_t){var Pt=st.charCodeAt(se);(64512&Pt)==56320&&(++se,pe=((1023&pe)<<10)+(1023&Pt)+65536)}(4294901760&pe)==0?(tt[Qt++]=pe>>12&15|224,tt[Qt++]=pe>>6&63|128):(tt[Qt++]=pe>>18&7|240,tt[Qt++]=pe>>12&63|128,tt[Qt++]=pe>>6&63|128)}tt[Qt++]=63&pe|128}else tt[Qt++]=pe}}(x,this.bytes,this.pos),this.pos+=q},z.prototype.encodeObject=function(x,q){var st=this.extensionCodec.tryToEncode(x,this.context);if(st!=null)this.encodeExtension(st);else if(Array.isArray(x))this.encodeArray(x,q);else if(ArrayBuffer.isView(x))this.encodeBinary(x);else{if(typeof x!="object")throw new Error("Unrecognized object: "+Object.prototype.toString.apply(x));this.encodeMap(x,q)}},z.prototype.encodeBinary=function(x){var q=x.byteLength;if(q<256)this.writeU8(196),this.writeU8(q);else if(q<65536)this.writeU8(197),this.writeU16(q);else{if(!(q<4294967296))throw new Error("Too large binary: "+q);this.writeU8(198),this.writeU32(q)}var st=Ct(x);this.writeU8a(st)},z.prototype.encodeArray=function(x,q){var st,tt,yt=x.length;if(yt<16)this.writeU8(144+yt);else if(yt<65536)this.writeU8(220),this.writeU16(yt);else{if(!(yt<4294967296))throw new Error("Too large array: "+yt);this.writeU8(221),this.writeU32(yt)}try{for(var _t=Et(x),Qt=_t.next();!Qt.done;Qt=_t.next()){var se=Qt.value;this.doEncode(se,q+1)}}catch(pe){st={error:pe}}finally{try{Qt&&!Qt.done&&(tt=_t.return)&&tt.call(_t)}finally{if(st)throw st.error}}},z.prototype.countWithoutUndefined=function(x,q){var st,tt,yt=0;try{for(var _t=Et(q),Qt=_t.next();!Qt.done;Qt=_t.next())x[Qt.value]!==void 0&&yt++}catch(se){st={error:se}}finally{try{Qt&&!Qt.done&&(tt=_t.return)&&tt.call(_t)}finally{if(st)throw st.error}}return yt},z.prototype.encodeMap=function(x,q){var st,tt,yt=Object.keys(x);this.sortKeys&&yt.sort();var _t=this.ignoreUndefined?this.countWithoutUndefined(x,yt):yt.length;if(_t<16)this.writeU8(128+_t);else if(_t<65536)this.writeU8(222),this.writeU16(_t);else{if(!(_t<4294967296))throw new Error("Too large map object: "+_t);this.writeU8(223),this.writeU32(_t)}try{for(var Qt=Et(yt),se=Qt.next();!se.done;se=Qt.next()){var pe=se.value,Pt=x[pe];this.ignoreUndefined&&Pt===void 0||(this.encodeString(pe),this.doEncode(Pt,q+1))}}catch(Gt){st={error:Gt}}finally{try{se&&!se.done&&(tt=Qt.return)&&tt.call(Qt)}finally{if(st)throw st.error}}},z.prototype.encodeExtension=function(x){var q=x.data.length;if(q===1)this.writeU8(212);else if(q===2)this.writeU8(213);else if(q===4)this.writeU8(214);else if(q===8)this.writeU8(215);else if(q===16)this.writeU8(216);else if(q<256)this.writeU8(199),this.writeU8(q);else if(q<65536)this.writeU8(200),this.writeU16(q);else{if(!(q<4294967296))throw new Error("Too large extension object: "+q);this.writeU8(201),this.writeU32(q)}this.writeI8(x.type),this.writeU8a(x.data)},z.prototype.writeU8=function(x){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,x),this.pos++},z.prototype.writeU8a=function(x){var q=x.length;this.ensureBufferSizeToWrite(q),this.bytes.set(x,this.pos),this.pos+=q},z.prototype.writeI8=function(x){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,x),this.pos++},z.prototype.writeU16=function(x){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,x),this.pos+=2},z.prototype.writeI16=function(x){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,x),this.pos+=2},z.prototype.writeU32=function(x){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,x),this.pos+=4},z.prototype.writeI32=function(x){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,x),this.pos+=4},z.prototype.writeF32=function(x){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,x),this.pos+=4},z.prototype.writeF64=function(x){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,x),this.pos+=8},z.prototype.writeU64=function(x){this.ensureBufferSizeToWrite(8),function(q,st,tt){var yt=tt/4294967296,_t=tt;q.setUint32(st,yt),q.setUint32(st+4,_t)}(this.view,this.pos,x),this.pos+=8},z.prototype.writeI64=function(x){this.ensureBufferSizeToWrite(8),l(this.view,this.pos,x),this.pos+=8},z}(),Mt={};function Y(z,x){return x===void 0&&(x=Mt),new gt(x.extensionCodec,x.context,x.maxDepth,x.initialBufferSize,x.sortKeys,x.forceFloat32,x.ignoreUndefined,x.forceIntegerToFloat).encode(z)}function $(z){return(z<0?"-":"")+"0x"+Math.abs(z).toString(16).padStart(2,"0")}var mt=function(){function z(x,q){x===void 0&&(x=16),q===void 0&&(q=16),this.maxKeyLength=x,this.maxLengthPerKey=q,this.hit=0,this.miss=0,this.caches=[];for(var st=0;st<this.maxKeyLength;st++)this.caches.push([])}return z.prototype.canBeCached=function(x){return x>0&&x<=this.maxKeyLength},z.prototype.find=function(x,q,st){var tt,yt,_t=this.caches[st-1];try{t:for(var Qt=function(te){var We=typeof Symbol=="function"&&Symbol.iterator,An=We&&te[We],Ni=0;if(An)return An.call(te);if(te&&typeof te.length=="number")return{next:function(){return te&&Ni>=te.length&&(te=void 0),{value:te&&te[Ni++],done:!te}}};throw new TypeError(We?"Object is not iterable.":"Symbol.iterator is not defined.")}(_t),se=Qt.next();!se.done;se=Qt.next()){for(var pe=se.value,Pt=pe.bytes,Gt=0;Gt<st;Gt++)if(Pt[Gt]!==x[q+Gt])continue t;return pe.str}}catch(te){tt={error:te}}finally{try{se&&!se.done&&(yt=Qt.return)&&yt.call(Qt)}finally{if(tt)throw tt.error}}return null},z.prototype.store=function(x,q){var st=this.caches[x.length-1],tt={bytes:x,str:q};st.length>=this.maxLengthPerKey?st[Math.random()*st.length|0]=tt:st.push(tt)},z.prototype.decode=function(x,q,st){var tt=this.find(x,q,st);if(tt!=null)return this.hit++,tt;this.miss++;var yt=R(x,q,st),_t=Uint8Array.prototype.slice.call(x,q,q+st);return this.store(_t,yt),yt},z}(),ot=function(z,x){var q,st,tt,yt,_t={label:0,sent:function(){if(1&tt[0])throw tt[1];return tt[1]},trys:[],ops:[]};return yt={next:Qt(0),throw:Qt(1),return:Qt(2)},typeof Symbol=="function"&&(yt[Symbol.iterator]=function(){return this}),yt;function Qt(se){return function(pe){return function(Pt){if(q)throw new TypeError("Generator is already executing.");for(;_t;)try{if(q=1,st&&(tt=2&Pt[0]?st.return:Pt[0]?st.throw||((tt=st.return)&&tt.call(st),0):st.next)&&!(tt=tt.call(st,Pt[1])).done)return tt;switch(st=0,tt&&(Pt=[2&Pt[0],tt.value]),Pt[0]){case 0:case 1:tt=Pt;break;case 4:return _t.label++,{value:Pt[1],done:!1};case 5:_t.label++,st=Pt[1],Pt=[0];continue;case 7:Pt=_t.ops.pop(),_t.trys.pop();continue;default:if(!((tt=(tt=_t.trys).length>0&&tt[tt.length-1])||Pt[0]!==6&&Pt[0]!==2)){_t=0;continue}if(Pt[0]===3&&(!tt||Pt[1]>tt[0]&&Pt[1]<tt[3])){_t.label=Pt[1];break}if(Pt[0]===6&&_t.label<tt[1]){_t.label=tt[1],tt=Pt;break}if(tt&&_t.label<tt[2]){_t.label=tt[2],_t.ops.push(Pt);break}tt[2]&&_t.ops.pop(),_t.trys.pop();continue}Pt=x.call(z,_t)}catch(Gt){Pt=[6,Gt],st=0}finally{q=tt=0}if(5&Pt[0])throw Pt[1];return{value:Pt[0]?Pt[1]:void 0,done:!0}}([se,pe])}}},Lt=function(z){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var x,q=z[Symbol.asyncIterator];return q?q.call(z):(z=typeof __values=="function"?__values(z):z[Symbol.iterator](),x={},st("next"),st("throw"),st("return"),x[Symbol.asyncIterator]=function(){return this},x);function st(tt){x[tt]=z[tt]&&function(yt){return new Promise(function(_t,Qt){(function(se,pe,Pt,Gt){Promise.resolve(Gt).then(function(te){se({value:te,done:Pt})},pe)})(_t,Qt,(yt=z[tt](yt)).done,yt.value)})}}},at=function(z){return this instanceof at?(this.v=z,this):new at(z)},y=function(z,x,q){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var st,tt=q.apply(z,x||[]),yt=[];return st={},_t("next"),_t("throw"),_t("return"),st[Symbol.asyncIterator]=function(){return this},st;function _t(Gt){tt[Gt]&&(st[Gt]=function(te){return new Promise(function(We,An){yt.push([Gt,te,We,An])>1||Qt(Gt,te)})})}function Qt(Gt,te){try{(We=tt[Gt](te)).value instanceof at?Promise.resolve(We.value.v).then(se,pe):Pt(yt[0][2],We)}catch(An){Pt(yt[0][3],An)}var We}function se(Gt){Qt("next",Gt)}function pe(Gt){Qt("throw",Gt)}function Pt(Gt,te){Gt(te),yt.shift(),yt.length&&Qt(yt[0][0],yt[0][1])}},M=new DataView(new ArrayBuffer(0)),F=new Uint8Array(M.buffer),ut=function(){try{M.getInt8(0)}catch(z){return z.constructor}throw new Error("never reached")}(),Vt=new ut("Insufficient data"),xe=new mt,wr=function(){function z(x,q,st,tt,yt,_t,Qt,se){x===void 0&&(x=U.defaultCodec),q===void 0&&(q=void 0),st===void 0&&(st=s),tt===void 0&&(tt=s),yt===void 0&&(yt=s),_t===void 0&&(_t=s),Qt===void 0&&(Qt=s),se===void 0&&(se=xe),this.extensionCodec=x,this.context=q,this.maxStrLength=st,this.maxBinLength=tt,this.maxArrayLength=yt,this.maxMapLength=_t,this.maxExtLength=Qt,this.keyDecoder=se,this.totalPos=0,this.pos=0,this.view=M,this.bytes=F,this.headByte=-1,this.stack=[]}return z.prototype.reinitializeState=function(){this.totalPos=0,this.headByte=-1,this.stack.length=0},z.prototype.setBuffer=function(x){this.bytes=Ct(x),this.view=function(q){if(q instanceof ArrayBuffer)return new DataView(q);var st=Ct(q);return new DataView(st.buffer,st.byteOffset,st.byteLength)}(this.bytes),this.pos=0},z.prototype.appendBuffer=function(x){if(this.headByte!==-1||this.hasRemaining(1)){var q=this.bytes.subarray(this.pos),st=Ct(x),tt=new Uint8Array(q.length+st.length);tt.set(q),tt.set(st,q.length),this.setBuffer(tt)}else this.setBuffer(x)},z.prototype.hasRemaining=function(x){return this.view.byteLength-this.pos>=x},z.prototype.createExtraByteError=function(x){var q=this.view,st=this.pos;return new RangeError("Extra "+(q.byteLength-st)+" of "+q.byteLength+" byte(s) found at buffer["+x+"]")},z.prototype.decode=function(x){this.reinitializeState(),this.setBuffer(x);var q=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return q},z.prototype.decodeMulti=function(x){return ot(this,function(q){switch(q.label){case 0:this.reinitializeState(),this.setBuffer(x),q.label=1;case 1:return this.hasRemaining(1)?[4,this.doDecodeSync()]:[3,3];case 2:return q.sent(),[3,1];case 3:return[2]}})},z.prototype.decodeAsync=function(x){var q,st,tt,yt,_t,Qt,se,pe;return _t=this,Qt=void 0,pe=function(){var Pt,Gt,te,We,An,Ni,Io,Cr;return ot(this,function(Go){switch(Go.label){case 0:Pt=!1,Go.label=1;case 1:Go.trys.push([1,6,7,12]),q=Lt(x),Go.label=2;case 2:return[4,q.next()];case 3:if((st=Go.sent()).done)return[3,5];if(te=st.value,Pt)throw this.createExtraByteError(this.totalPos);this.appendBuffer(te);try{Gt=this.doDecodeSync(),Pt=!0}catch(kN){if(!(kN instanceof ut))throw kN}this.totalPos+=this.pos,Go.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return We=Go.sent(),tt={error:We},[3,12];case 7:return Go.trys.push([7,,10,11]),st&&!st.done&&(yt=q.return)?[4,yt.call(q)]:[3,9];case 8:Go.sent(),Go.label=9;case 9:return[3,11];case 10:if(tt)throw tt.error;return[7];case 11:return[7];case 12:if(Pt){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return[2,Gt]}throw Ni=(An=this).headByte,Io=An.pos,Cr=An.totalPos,new RangeError("Insufficient data in parsing "+$(Ni)+" at "+Cr+" ("+Io+" in the current buffer)")}})},new((se=void 0)||(se=Promise))(function(Pt,Gt){function te(Ni){try{An(pe.next(Ni))}catch(Io){Gt(Io)}}function We(Ni){try{An(pe.throw(Ni))}catch(Io){Gt(Io)}}function An(Ni){var Io;Ni.done?Pt(Ni.value):(Io=Ni.value,Io instanceof se?Io:new se(function(Cr){Cr(Io)})).then(te,We)}An((pe=pe.apply(_t,Qt||[])).next())})},z.prototype.decodeArrayStream=function(x){return this.decodeMultiAsync(x,!0)},z.prototype.decodeStream=function(x){return this.decodeMultiAsync(x,!1)},z.prototype.decodeMultiAsync=function(x,q){return y(this,arguments,function(){var st,tt,yt,_t,Qt,se,pe,Pt,Gt;return ot(this,function(te){switch(te.label){case 0:st=q,tt=-1,te.label=1;case 1:te.trys.push([1,13,14,19]),yt=Lt(x),te.label=2;case 2:return[4,at(yt.next())];case 3:if((_t=te.sent()).done)return[3,12];if(Qt=_t.value,q&&tt===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(Qt),st&&(tt=this.readArraySize(),st=!1,this.complete()),te.label=4;case 4:te.trys.push([4,9,,10]),te.label=5;case 5:return[4,at(this.doDecodeSync())];case 6:return[4,te.sent()];case 7:return te.sent(),--tt==0?[3,8]:[3,5];case 8:return[3,10];case 9:if(!((se=te.sent())instanceof ut))throw se;return[3,10];case 10:this.totalPos+=this.pos,te.label=11;case 11:return[3,2];case 12:return[3,19];case 13:return pe=te.sent(),Pt={error:pe},[3,19];case 14:return te.trys.push([14,,17,18]),_t&&!_t.done&&(Gt=yt.return)?[4,at(Gt.call(yt))]:[3,16];case 15:te.sent(),te.label=16;case 16:return[3,18];case 17:if(Pt)throw Pt.error;return[7];case 18:return[7];case 19:return[2]}})})},z.prototype.doDecodeSync=function(){t:for(;;){var x=this.readHeadByte(),q=void 0;if(x>=224)q=x-256;else if(x<192)if(x<128)q=x;else if(x<144){if((tt=x-128)!=0){this.pushMapState(tt),this.complete();continue t}q={}}else if(x<160){if((tt=x-144)!=0){this.pushArrayState(tt),this.complete();continue t}q=[]}else{var st=x-160;q=this.decodeUtf8String(st,0)}else if(x===192)q=null;else if(x===194)q=!1;else if(x===195)q=!0;else if(x===202)q=this.readF32();else if(x===203)q=this.readF64();else if(x===204)q=this.readU8();else if(x===205)q=this.readU16();else if(x===206)q=this.readU32();else if(x===207)q=this.readU64();else if(x===208)q=this.readI8();else if(x===209)q=this.readI16();else if(x===210)q=this.readI32();else if(x===211)q=this.readI64();else if(x===217)st=this.lookU8(),q=this.decodeUtf8String(st,1);else if(x===218)st=this.lookU16(),q=this.decodeUtf8String(st,2);else if(x===219)st=this.lookU32(),q=this.decodeUtf8String(st,4);else if(x===220){if((tt=this.readU16())!==0){this.pushArrayState(tt),this.complete();continue t}q=[]}else if(x===221){if((tt=this.readU32())!==0){this.pushArrayState(tt),this.complete();continue t}q=[]}else if(x===222){if((tt=this.readU16())!==0){this.pushMapState(tt),this.complete();continue t}q={}}else if(x===223){if((tt=this.readU32())!==0){this.pushMapState(tt),this.complete();continue t}q={}}else if(x===196){var tt=this.lookU8();q=this.decodeBinary(tt,1)}else if(x===197)tt=this.lookU16(),q=this.decodeBinary(tt,2);else if(x===198)tt=this.lookU32(),q=this.decodeBinary(tt,4);else if(x===212)q=this.decodeExtension(1,0);else if(x===213)q=this.decodeExtension(2,0);else if(x===214)q=this.decodeExtension(4,0);else if(x===215)q=this.decodeExtension(8,0);else if(x===216)q=this.decodeExtension(16,0);else if(x===199)tt=this.lookU8(),q=this.decodeExtension(tt,1);else if(x===200)tt=this.lookU16(),q=this.decodeExtension(tt,2);else{if(x!==201)throw new nt("Unrecognized type byte: "+$(x));tt=this.lookU32(),q=this.decodeExtension(tt,4)}this.complete();for(var yt=this.stack;yt.length>0;){var _t=yt[yt.length-1];if(_t.type===0){if(_t.array[_t.position]=q,_t.position++,_t.position!==_t.size)continue t;yt.pop(),q=_t.array}else{if(_t.type===1){if((Qt=typeof q)!="string"&&Qt!=="number")throw new nt("The type of key must be string or number but "+typeof q);if(q==="__proto__")throw new nt("The key __proto__ is not allowed");_t.key=q,_t.type=2;continue t}if(_t.map[_t.key]=q,_t.readCount++,_t.readCount!==_t.size){_t.key=null,_t.type=1;continue t}yt.pop(),q=_t.map}}return q}var Qt},z.prototype.readHeadByte=function(){return this.headByte===-1&&(this.headByte=this.readU8()),this.headByte},z.prototype.complete=function(){this.headByte=-1},z.prototype.readArraySize=function(){var x=this.readHeadByte();switch(x){case 220:return this.readU16();case 221:return this.readU32();default:if(x<160)return x-144;throw new nt("Unrecognized array type byte: "+$(x))}},z.prototype.pushMapState=function(x){if(x>this.maxMapLength)throw new nt("Max length exceeded: map length ("+x+") > maxMapLengthLength ("+this.maxMapLength+")");this.stack.push({type:1,size:x,key:null,readCount:0,map:{}})},z.prototype.pushArrayState=function(x){if(x>this.maxArrayLength)throw new nt("Max length exceeded: array length ("+x+") > maxArrayLength ("+this.maxArrayLength+")");this.stack.push({type:0,size:x,array:new Array(x),position:0})},z.prototype.decodeUtf8String=function(x,q){var st;if(x>this.maxStrLength)throw new nt("Max length exceeded: UTF-8 byte length ("+x+") > maxStrLength ("+this.maxStrLength+")");if(this.bytes.byteLength<this.pos+q+x)throw Vt;var tt,yt=this.pos+q;return tt=this.stateIsMapKey()&&((st=this.keyDecoder)===null||st===void 0?void 0:st.canBeCached(x))?this.keyDecoder.decode(this.bytes,yt,x):x>B?function(_t,Qt,se){var pe=_t.subarray(Qt,Qt+se);return O.decode(pe)}(this.bytes,yt,x):R(this.bytes,yt,x),this.pos+=q+x,tt},z.prototype.stateIsMapKey=function(){return this.stack.length>0&&this.stack[this.stack.length-1].type===1},z.prototype.decodeBinary=function(x,q){if(x>this.maxBinLength)throw new nt("Max length exceeded: bin length ("+x+") > maxBinLength ("+this.maxBinLength+")");if(!this.hasRemaining(x+q))throw Vt;var st=this.pos+q,tt=this.bytes.subarray(st,st+x);return this.pos+=q+x,tt},z.prototype.decodeExtension=function(x,q){if(x>this.maxExtLength)throw new nt("Max length exceeded: ext length ("+x+") > maxExtLength ("+this.maxExtLength+")");var st=this.view.getInt8(this.pos+q),tt=this.decodeBinary(x,q+1);return this.extensionCodec.decode(tt,st,this.context)},z.prototype.lookU8=function(){return this.view.getUint8(this.pos)},z.prototype.lookU16=function(){return this.view.getUint16(this.pos)},z.prototype.lookU32=function(){return this.view.getUint32(this.pos)},z.prototype.readU8=function(){var x=this.view.getUint8(this.pos);return this.pos++,x},z.prototype.readI8=function(){var x=this.view.getInt8(this.pos);return this.pos++,x},z.prototype.readU16=function(){var x=this.view.getUint16(this.pos);return this.pos+=2,x},z.prototype.readI16=function(){var x=this.view.getInt16(this.pos);return this.pos+=2,x},z.prototype.readU32=function(){var x=this.view.getUint32(this.pos);return this.pos+=4,x},z.prototype.readI32=function(){var x=this.view.getInt32(this.pos);return this.pos+=4,x},z.prototype.readU64=function(){var x,q,st=(x=this.view,q=this.pos,4294967296*x.getUint32(q)+x.getUint32(q+4));return this.pos+=8,st},z.prototype.readI64=function(){var x=d(this.view,this.pos);return this.pos+=8,x},z.prototype.readF32=function(){var x=this.view.getFloat32(this.pos);return this.pos+=4,x},z.prototype.readF64=function(){var x=this.view.getFloat64(this.pos);return this.pos+=8,x},z}(),Ke={};function Jn(z,x){return x===void 0&&(x=Ke),new wr(x.extensionCodec,x.context,x.maxStrLength,x.maxBinLength,x.maxArrayLength,x.maxMapLength,x.maxExtLength).decode(z)}function cs(z,x){return x===void 0&&(x=Ke),new wr(x.extensionCodec,x.context,x.maxStrLength,x.maxBinLength,x.maxArrayLength,x.maxMapLength,x.maxExtLength).decodeMulti(z)}var gi=function(z,x){var q,st,tt,yt,_t={label:0,sent:function(){if(1&tt[0])throw tt[1];return tt[1]},trys:[],ops:[]};return yt={next:Qt(0),throw:Qt(1),return:Qt(2)},typeof Symbol=="function"&&(yt[Symbol.iterator]=function(){return this}),yt;function Qt(se){return function(pe){return function(Pt){if(q)throw new TypeError("Generator is already executing.");for(;_t;)try{if(q=1,st&&(tt=2&Pt[0]?st.return:Pt[0]?st.throw||((tt=st.return)&&tt.call(st),0):st.next)&&!(tt=tt.call(st,Pt[1])).done)return tt;switch(st=0,tt&&(Pt=[2&Pt[0],tt.value]),Pt[0]){case 0:case 1:tt=Pt;break;case 4:return _t.label++,{value:Pt[1],done:!1};case 5:_t.label++,st=Pt[1],Pt=[0];continue;case 7:Pt=_t.ops.pop(),_t.trys.pop();continue;default:if(!((tt=(tt=_t.trys).length>0&&tt[tt.length-1])||Pt[0]!==6&&Pt[0]!==2)){_t=0;continue}if(Pt[0]===3&&(!tt||Pt[1]>tt[0]&&Pt[1]<tt[3])){_t.label=Pt[1];break}if(Pt[0]===6&&_t.label<tt[1]){_t.label=tt[1],tt=Pt;break}if(tt&&_t.label<tt[2]){_t.label=tt[2],_t.ops.push(Pt);break}tt[2]&&_t.ops.pop(),_t.trys.pop();continue}Pt=x.call(z,_t)}catch(Gt){Pt=[6,Gt],st=0}finally{q=tt=0}if(5&Pt[0])throw Pt[1];return{value:Pt[0]?Pt[1]:void 0,done:!0}}([se,pe])}}},Nn=function(z){return this instanceof Nn?(this.v=z,this):new Nn(z)},Mc=function(z,x,q){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var st,tt=q.apply(z,x||[]),yt=[];return st={},_t("next"),_t("throw"),_t("return"),st[Symbol.asyncIterator]=function(){return this},st;function _t(Gt){tt[Gt]&&(st[Gt]=function(te){return new Promise(function(We,An){yt.push([Gt,te,We,An])>1||Qt(Gt,te)})})}function Qt(Gt,te){try{(We=tt[Gt](te)).value instanceof Nn?Promise.resolve(We.value.v).then(se,pe):Pt(yt[0][2],We)}catch(An){Pt(yt[0][3],An)}var We}function se(Gt){Qt("next",Gt)}function pe(Gt){Qt("throw",Gt)}function Pt(Gt,te){Gt(te),yt.shift(),yt.length&&Qt(yt[0][0],yt[0][1])}};function pa(z){if(z==null)throw new Error("Assertion Failure: value must not be null nor undefined")}function an(z){return z[Symbol.asyncIterator]!=null?z:function(x){return Mc(this,arguments,function(){var q,st,tt,yt;return gi(this,function(_t){switch(_t.label){case 0:q=x.getReader(),_t.label=1;case 1:_t.trys.push([1,,9,10]),_t.label=2;case 2:return[4,Nn(q.read())];case 3:return st=_t.sent(),tt=st.done,yt=st.value,tt?[4,Nn(void 0)]:[3,5];case 4:return[2,_t.sent()];case 5:return pa(yt),[4,Nn(yt)];case 6:return[4,_t.sent()];case 7:return _t.sent(),[3,2];case 8:return[3,10];case 9:return q.releaseLock(),[7];case 10:return[2]}})})}(z)}function zr(z,x){return x===void 0&&(x=Ke),q=this,st=void 0,yt=function(){var _t;return function(Qt,se){var pe,Pt,Gt,te,We={label:0,sent:function(){if(1&Gt[0])throw Gt[1];return Gt[1]},trys:[],ops:[]};return te={next:An(0),throw:An(1),return:An(2)},typeof Symbol=="function"&&(te[Symbol.iterator]=function(){return this}),te;function An(Ni){return function(Io){return function(Cr){if(pe)throw new TypeError("Generator is already executing.");for(;We;)try{if(pe=1,Pt&&(Gt=2&Cr[0]?Pt.return:Cr[0]?Pt.throw||((Gt=Pt.return)&&Gt.call(Pt),0):Pt.next)&&!(Gt=Gt.call(Pt,Cr[1])).done)return Gt;switch(Pt=0,Gt&&(Cr=[2&Cr[0],Gt.value]),Cr[0]){case 0:case 1:Gt=Cr;break;case 4:return We.label++,{value:Cr[1],done:!1};case 5:We.label++,Pt=Cr[1],Cr=[0];continue;case 7:Cr=We.ops.pop(),We.trys.pop();continue;default:if(!((Gt=(Gt=We.trys).length>0&&Gt[Gt.length-1])||Cr[0]!==6&&Cr[0]!==2)){We=0;continue}if(Cr[0]===3&&(!Gt||Cr[1]>Gt[0]&&Cr[1]<Gt[3])){We.label=Cr[1];break}if(Cr[0]===6&&We.label<Gt[1]){We.label=Gt[1],Gt=Cr;break}if(Gt&&We.label<Gt[2]){We.label=Gt[2],We.ops.push(Cr);break}Gt[2]&&We.ops.pop(),We.trys.pop();continue}Cr=se.call(Qt,We)}catch(Go){Cr=[6,Go],Pt=0}finally{pe=Gt=0}if(5&Cr[0])throw Cr[1];return{value:Cr[0]?Cr[1]:void 0,done:!0}}([Ni,Io])}}}(this,function(Qt){return _t=an(z),[2,new wr(x.extensionCodec,x.context,x.maxStrLength,x.maxBinLength,x.maxArrayLength,x.maxMapLength,x.maxExtLength).decodeAsync(_t)]})},new((tt=void 0)||(tt=Promise))(function(_t,Qt){function se(Gt){try{Pt(yt.next(Gt))}catch(te){Qt(te)}}function pe(Gt){try{Pt(yt.throw(Gt))}catch(te){Qt(te)}}function Pt(Gt){var te;Gt.done?_t(Gt.value):(te=Gt.value,te instanceof tt?te:new tt(function(We){We(te)})).then(se,pe)}Pt((yt=yt.apply(q,st||[])).next())});var q,st,tt,yt}function mi(z,x){x===void 0&&(x=Ke);var q=an(z);return new wr(x.extensionCodec,x.context,x.maxStrLength,x.maxBinLength,x.maxArrayLength,x.maxMapLength,x.maxExtLength).decodeArrayStream(q)}function ls(z,x){x===void 0&&(x=Ke);var q=an(z);return new wr(x.extensionCodec,x.context,x.maxStrLength,x.maxBinLength,x.maxArrayLength,x.maxMapLength,x.maxExtLength).decodeStream(q)}function Aa(z,x){return x===void 0&&(x=Ke),ls(z,x)}return i}()})(Qy);var Q8=Dt,V8=Vn,G8=nl,j8=yo,H8=pc,K8=Math.min,IE=[].lastIndexOf,Vy=!!IE&&1/[1].lastIndexOf(1,-0)<0,W8=H8("lastIndexOf"),Gy=Vy||!W8?function(e){if(Vy)return Q8(IE,this,arguments)||0;var t=V8(this),r=j8(t),i=r-1;for(arguments.length>1&&(i=K8(i,G8(arguments[1]))),i<0&&(i=r+i);i>=0;i--)if(i in t&&t[i]===e)return i||0;return-1}:IE;Ae({target:"Array",proto:!0,forced:Gy!==[].lastIndexOf},{lastIndexOf:Gy});var Y8=$r("Array").lastIndexOf,q8=L,J8=Y8,vE=Array.prototype,z8=function(e){var t=e.lastIndexOf;return e===vE||q8(vE,e)&&t===vE.lastIndexOf?J8:t},X8=N,jy=Gd,Jp=Qd.exports.getWeakData,Z8=xi,CE=Vr,$8=ll,t6=mc,Hy=gn,e6=oo.set,r6=oo.getterFor,n6=Xo.find,i6=Xo.findIndex,o6=X8([].splice),s6=0,zp=function(e){return e.frozen||(e.frozen=new Ky)},Ky=function(){this.entries=[]},SE=function(e,t){return n6(e.entries,function(r){return r[0]===t})};Ky.prototype={get:function(e){var t=SE(this,e);if(t)return t[1]},has:function(e){return!!SE(this,e)},set:function(e,t){var r=SE(this,e);r?r[1]=t:this.entries.push([e,t])},delete:function(e){var t=i6(this.entries,function(r){return r[0]===e});return~t&&o6(this.entries,t,1),!!~t}};var Eu,a6={getConstructor:function(e,t,r,i){var s=e(function(p,m){$8(p,l),e6(p,{type:t,id:s6++,frozen:void 0}),m!=null&&t6(m,p[i],{that:p,AS_ENTRIES:r})}),l=s.prototype,d=r6(t),h=function(p,m,f){var _=d(p),v=Jp(Z8(m),!0);return v===!0?zp(_).set(m,f):v[_.id]=f,p};return jy(l,{delete:function(p){var m=d(this);if(!CE(p))return!1;var f=Jp(p);return f===!0?zp(m).delete(p):f&&Hy(f,m.id)&&delete f[m.id]},has:function(p){var m=d(this);if(!CE(p))return!1;var f=Jp(p);return f===!0?zp(m).has(p):f&&Hy(f,m.id)}}),jy(l,r?{get:function(p){var m=d(this);if(CE(p)){var f=Jp(p);return f===!0?zp(m).get(p):f?f[m.id]:void 0}},set:function(p,m){return h(this,p,m)}}:{add:function(p){return h(this,p,!0)}}),s}},Wy=G,Xp=N,c6=Gd,l6=Qd.exports,d6=bS,Yy=a6,Zp=Vr,$p=ES,tA=oo.enforce,u6=NC,h6=!Wy.ActiveXObject&&"ActiveXObject"in Wy,qy=function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},p6=d6("WeakMap",qy,Yy);if(u6&&h6){Eu=Yy.getConstructor(qy,"WeakMap",!0),l6.enable();var _u=p6.prototype,Jy=Xp(_u.delete),eA=Xp(_u.has),zy=Xp(_u.get),Xy=Xp(_u.set);c6(_u,{delete:function(e){if(Zp(e)&&!$p(e)){var t=tA(this);return t.frozen||(t.frozen=new Eu),Jy(this,e)||t.frozen.delete(e)}return Jy(this,e)},has:function(e){if(Zp(e)&&!$p(e)){var t=tA(this);return t.frozen||(t.frozen=new Eu),eA(this,e)||t.frozen.has(e)}return eA(this,e)},get:function(e){if(Zp(e)&&!$p(e)){var t=tA(this);return t.frozen||(t.frozen=new Eu),eA(this,e)?zy(this,e):t.frozen.get(e)}return zy(this,e)},set:function(e,t){if(Zp(e)&&!$p(e)){var r=tA(this);r.frozen||(r.frozen=new Eu),eA(this,e)?Xy(this,e,t):r.frozen.set(e,t)}else Xy(this,e,t);return this}})}var A6=Xo.every;Ae({target:"Array",proto:!0,forced:!pc("every")},{every:function(e){return A6(this,e,arguments.length>1?arguments[1]:void 0)}});var f6=$r("Array").every,g6=L,m6=f6,TE=Array.prototype,E6=function(e){var t=e.every;return e===TE||g6(TE,e)&&t===TE.every?m6:t},_6=io,RE=Md,I6=yo,v6=Math.min;Ae({target:"Array",proto:!0},{copyWithin:[].copyWithin||function(e,t){var r=_6(this),i=I6(r),s=RE(e,i),l=RE(t,i),d=arguments.length>2?arguments[2]:void 0,h=v6((d===void 0?i:RE(d,i))-l,i-s),p=1;for(l<s&&s<l+h&&(p=-1,l+=h-1,s+=h-1);h-- >0;)l in r?r[s]=r[l]:delete r[s],s+=p,l+=p;return r}});var C6=$r("Array").copyWithin,S6=L,T6=C6,yE=Array.prototype,R6=function(e){var t=e.copyWithin;return e===yE||S6(yE,e)&&t===yE.copyWithin?T6:t};const y6=()=>function(e){var t;const r=pt(t=window.atob(e).split("")).call(t,i=>i.charCodeAt(0));return new Uint8Array(r,0,r.length/Uint8Array.BYTES_PER_ELEMENT)}("AGFzbQEAAAABMAlgA39/fwF/YAF/AGACf38AYAF/AX9gAn9/AX9gA39/fwBgBH9/f38AYAABf2AAAAI6AgNlbnYWZW1zY3JpcHRlbl9yZXNpemVfaGVhcAADA2VudhVlbXNjcmlwdGVuX21lbWNweV9iaWcAAAMjIggAAAAAAQEDAQEEBAQEAQEGAQYCBQUAAgAHAwEDAAIHAQMEBQFwAQYGBQYBAYACgAIGCQF/AUHQ48ACCweUAQoGbWVtb3J5AgARX193YXNtX2NhbGxfY3RvcnMAAhlfX2luZGlyZWN0X2Z1bmN0aW9uX3RhYmxlAQAGbWFsbG9jABwEZnJlZQAdEF9fZXJybm9fbG9jYXRpb24AGwx6bGliQ29tcHJlc3MAGglzdGFja1NhdmUAIQxzdGFja1Jlc3RvcmUAIgpzdGFja0FsbG9jACMJCwEAQQELBRgZDA0PCq6FAiIDAAELpQcBBH8gAEH//wNxIQMgAEEQdiEEQQEhACACQQFGBEAgAyABLQAAaiIAQfH/A2sgACAAQfD/A0sbIgAgBGoiA0EQdCIEQYCAPGogBCADQfD/A0sbIAByDwsgAQR/IAJBEE8EQAJAAkACQCACQa8rSwRAA0AgAkGwK2shAkHbAiEFIAEhAANAIAMgAC0AAGoiAyAEaiADIAAtAAFqIgNqIAMgAC0AAmoiA2ogAyAALQADaiIDaiADIAAtAARqIgNqIAMgAC0ABWoiA2ogAyAALQAGaiIDaiADIAAtAAdqIgNqIAMgAC0ACGoiA2ogAyAALQAJaiIDaiADIAAtAApqIgNqIAMgAC0AC2oiA2ogAyAALQAMaiIDaiADIAAtAA1qIgNqIAMgAC0ADmoiA2ogAyAALQAPaiIDaiEEIABBEGohACAFQQFrIgUNAAsgBEHx/wNwIQQgA0Hx/wNwIQMgAUGwK2ohASACQa8rSw0ACyACRQ0DIAJBEEkNAQsDQCADIAEtAABqIgAgBGogACABLQABaiIAaiAAIAEtAAJqIgBqIAAgAS0AA2oiAGogACABLQAEaiIAaiAAIAEtAAVqIgBqIAAgAS0ABmoiAGogACABLQAHaiIAaiAAIAEtAAhqIgBqIAAgAS0ACWoiAGogACABLQAKaiIAaiAAIAEtAAtqIgBqIAAgAS0ADGoiAGogACABLQANaiIAaiAAIAEtAA5qIgBqIAAgAS0AD2oiA2ohBCABQRBqIQEgAkEQayICQQ9LDQALIAJFDQELIAJBAWshBiACQQNxIgUEQCABIQADQCACQQFrIQIgAyAALQAAaiIDIARqIQQgAEEBaiIBIQAgBUEBayIFDQALCyAGQQNJDQADQCADIAEtAABqIgAgAS0AAWoiBSABLQACaiIGIAEtAANqIgMgBiAFIAAgBGpqamohBCABQQRqIQEgAkEEayICDQALCyAEQfH/A3AhBCADQfH/A3AhAwsgBEEQdCADcg8LAkAgAkUNACACQQFrIQYgAkEDcSIFBEAgASEAA0AgAkEBayECIAMgAC0AAGoiAyAEaiEEIABBAWoiASEAIAVBAWsiBQ0ACwsgBkEDSQ0AA0AgAyABLQAAaiIAIAEtAAFqIgUgAS0AAmoiBiABLQADaiIDIAYgBSAAIARqampqIQQgAUEEaiEBIAJBBGsiAg0ACwsgBEHx/wNwQRB0IANB8f8DayADIANB8P8DSxtyBSAACwsKACAAIAEgAhADC4UJAQJ/IAFFBEBBAA8LIABBf3MhAAJAIAJFDQAgAUEDcUUNACABLQAAIABB/wFxc0ECdEGACGooAgAgAEEIdnMhACACQQFrIgRBACABQQFqIgNBA3EbRQRAIAMhASAEIQIMAQsgAS0AASAAQf8BcXNBAnRBgAhqKAIAIABBCHZzIQAgAUECaiEDAkAgAkECayIERQ0AIANBA3FFDQAgAS0AAiAAQf8BcXNBAnRBgAhqKAIAIABBCHZzIQAgAUEDaiEDAkAgAkEDayIERQ0AIANBA3FFDQAgAS0AAyAAQf8BcXNBAnRBgAhqKAIAIABBCHZzIQAgAkEEayECIAFBBGohAQwCCyADIQEgBCECDAELIAMhASAEIQILIAJBH0sEQANAIAEoAhwgASgCGCABKAIUIAEoAhAgASgCDCABKAIIIAEoAgQgASgCACAAcyIAQQZ2QfwHcUGAGGooAgAgAEH/AXFBAnRBgCBqKAIAcyAAQQ52QfwHcUGAEGooAgBzIABBFnZB/AdxQYAIaigCAHNzIgBBBnZB/AdxQYAYaigCACAAQf8BcUECdEGAIGooAgBzIABBDnZB/AdxQYAQaigCAHMgAEEWdkH8B3FBgAhqKAIAc3MiAEEGdkH8B3FBgBhqKAIAIABB/wFxQQJ0QYAgaigCAHMgAEEOdkH8B3FBgBBqKAIAcyAAQRZ2QfwHcUGACGooAgBzcyIAQQZ2QfwHcUGAGGooAgAgAEH/AXFBAnRBgCBqKAIAcyAAQQ52QfwHcUGAEGooAgBzIABBFnZB/AdxQYAIaigCAHNzIgBBBnZB/AdxQYAYaigCACAAQf8BcUECdEGAIGooAgBzIABBDnZB/AdxQYAQaigCAHMgAEEWdkH8B3FBgAhqKAIAc3MiAEEGdkH8B3FBgBhqKAIAIABB/wFxQQJ0QYAgaigCAHMgAEEOdkH8B3FBgBBqKAIAcyAAQRZ2QfwHcUGACGooAgBzcyIAQQZ2QfwHcUGAGGooAgAgAEH/AXFBAnRBgCBqKAIAcyAAQQ52QfwHcUGAEGooAgBzIABBFnZB/AdxQYAIaigCAHNzIgBBBnZB/AdxQYAYaigCACAAQf8BcUECdEGAIGooAgBzIABBDnZB/AdxQYAQaigCAHMgAEEWdkH8B3FBgAhqKAIAcyEAIAFBIGohASACQSBrIgJBH0sNAAsLIAJBA0sEQANAIAEoAgAgAHMiAEEGdkH8B3FBgBhqKAIAIABB/wFxQQJ0QYAgaigCAHMgAEEOdkH8B3FBgBBqKAIAcyAAQRZ2QfwHcUGACGooAgBzIQAgAUEEaiEBIAJBBGsiAkEDSw0ACwsCQCACRQ0AIAJBAXEEfyABLQAAIABB/wFxc0ECdEGACGooAgAgAEEIdnMhACABQQFqIQEgAkEBawUgAgshAyACQQFGDQADQCABLQABIAEtAAAgAEH/AXFzQQJ0QYAIaigCACAAQQh2cyIAQf8BcXNBAnRBgAhqKAIAIABBCHZzIQAgAUECaiEBIANBAmsiAw0ACwsgAEF/cwsKACAAIAEgAhAFC9wEAQN/AkBByN8ALQAAQTFHDQAgAEUNACAAQQA2AhggACgCICIBRQRAIABBADYCKCAAQQE2AiBBASEBCyAAKAIkRQRAIABBAjYCJAsgACgCKEEBQcQtIAERAAAiAUUNACAAIAE2AhwgAUEPNgIwIAFBADYCHCABQQA2AhggAUEqNgIEIAEgADYCACABQQs2AlAgAUGAgAI2AiwgAUH//wE2AjQgAUGAEDYCTCABQQQ2AlggAUH/DzYCVCABIAAoAihBgIACQQIgACgCIBEAADYCOCABIAAoAiggASgCLEECIAAoAiARAAA2AkAgACgCKCABKAJMQQIgACgCIBEAACECIAFBADYCwC0gASACNgJEIAFBgAg2ApwtIAEgACgCKEGACEEEIAAoAiARAAAiAjYCCCABIAEoApwtIgNBAnQ2AgwCQAJAIAEoAjhFDQAgASgCQEUNACACRQ0AIAEoAkQNAQsgAUGaBTYCBCAAQbjfACgCADYCGCAAEAgPCyABQQA2AogBIAFBCTYChAEgAUEIOgAkIAEgAiADQQNsajYCmC0gASACIANBfnFqNgKkLSAAEAkNACAAKAIcIgAgACgCLEEBdDYCPCAAKAJEIgEgACgCTEEBdEECayIDakEAOwEAIAEgAxAgIABBADYCtC0gAEKAgICAIDcCdCAAQgA3AmggAEKAgICAIDcCXCAAQQA2AkggACAAKAKEAUEMbCIBQYTIAGovAQA2ApABIAAgAUGAyABqLwEANgKMASAAIAFBgsgAai8BADYCgAEgACABQYbIAGovAQA2AnwLC6kCAQN/AkAgAEUNACAAKAIgRQ0AIAAoAiQiA0UNACAAKAIcIgFFDQAgASgCACAARw0AAkACQCABKAIEIgJBOWsOOQECAgICAgICAgICAgECAgIBAgICAgICAgICAgICAgICAgIBAgICAgICAgICAgIBAgICAgICAgICAQALIAJBmgVGDQAgAkEqRw0BCwJ/An8CfyABKAIIIgIEQCAAKAIoIAIgAxECACAAKAIcIQELIAEoAkQiAgsEQCAAKAIoIAIgACgCJBECACAAKAIcIQELIAEoAkAiAgsEQCAAKAIoIAIgACgCJBECACAAKAIcIQELIAEoAjgiAgsEQCAAKAIoIAIgACgCJBECACAAKAIcIQELIAAoAiggASAAKAIkEQIAIABBADYCHAsLlgIBA39BfiECAkAgAEUNACAAKAIgRQ0AIAAoAiRFDQAgACgCHCIBRQ0AIAEoAgAgAEcNAAJAAkAgASgCBCIDQTlrDjkBAgICAgICAgICAgIBAgICAQICAgICAgICAgICAgICAgICAQICAgICAgICAgICAQICAgICAgICAgEACyADQZoFRg0AIANBKkcNAQsgAEECNgIsIABBADYCCCAAQgA3AhQgAUEANgIUIAEgASgCCDYCECABKAIYIgJBf0wEQCABQQAgAmsiAjYCGAsgAUE5QSpB8QAgAhsgAkECRhs2AgQgAAJ/IAJBAkYEQEEAQQBBABAGDAELQQBBAEEAEAQLNgIwQQAhAiABQQA2AiggARAQCyACC9wIAQt/IAAoAiwiB0GGAmshCyAAKAJ0IQUgByEBA0AgACgCPCAFayAAKAJsIghrIQYgASALaiAITQRAIAAoAjgiASABIAdqIAcgBmsQHxogACAAKAJwIAdrNgJwIAAgACgCbCAHayIINgJsIAAgACgCXCAHazYCXCAAKAJMIgRBAWshCiAAKAJEIARBAXRqIQMgACgCLCEBIARBA3EiAgRAA0AgA0ECayIDQQAgAy8BACIFIAFrIgkgBSAJSRs7AQAgBEEBayEEIAJBAWsiAg0ACwsgCkEDTwRAA0AgA0ECayICQQAgAi8BACICIAFrIgUgAiAFSRs7AQAgA0EEayICQQAgAi8BACICIAFrIgUgAiAFSRs7AQAgA0EGayICQQAgAi8BACICIAFrIgUgAiAFSRs7AQAgA0EIayIDQQAgAy8BACICIAFrIgUgAiAFSRs7AQAgBEEEayIEDQALCyABQQFrIQogACgCQCABQQF0aiEDIAEhBCABQQNxIgIEQANAIANBAmsiA0EAIAMvAQAiBSABayIJIAUgCUkbOwEAIARBAWshBCACQQFrIgINAAsLIApBA08EQANAIANBAmsiAkEAIAIvAQAiAiABayIFIAIgBUkbOwEAIANBBGsiAkEAIAIvAQAiAiABayIFIAIgBUkbOwEAIANBBmsiAkEAIAIvAQAiAiABayIFIAIgBUkbOwEAIANBCGsiA0EAIAMvAQAiAiABayIFIAIgBUkbOwEAIARBBGsiBA0ACwsgBiAHaiEGCwJAIAAoAgAiASgCBCIERQ0AIAAoAnQhAiAGIAQgBCAGSxsiAwRAIAAoAjghBSABIAQgA2s2AgQgBSAIaiACaiABKAIAIAMQHyEEAkACQAJAIAEoAhwoAhhBAWsOAgABAgsgASABKAIwIAQgAxAENgIwDAELIAEgASgCMCAEIAMQBjYCMAsgASABKAIAIANqNgIAIAEgASgCCCADajYCCCAAKAJ0IQILIAAgAiADaiIFNgJ0AkAgACgCtC0iAyAFakEDSQ0AIAAgACgCOCIJIAAoAmwgA2siAWoiBC0AACICNgJIIAAgACgCVCIIIAQtAAEgAiAAKAJYIgZ0c3EiBDYCSANAIANFDQEgACABIAlqLQACIAQgBnRzIAhxIgQ2AkggACgCQCAAKAI0IAFxQQF0aiAAKAJEIARBAXRqIgIvAQA7AQAgAiABOwEAIAAgA0EBayIDNgK0LSABQQFqIQEgAyAFakECSw0ACwsgBUGFAksNACAAKAIAKAIERQ0AIAAoAiwhAQwBCwsCQCAAKAI8IgQgACgCwC0iAU0NACAAKAJ0IAAoAmxqIgMgAUsEQCAAKAI4IANqIAQgA2siAUGCAiABQYICSRsiARAgIAAgASADajYCwC0PCyADQYICaiIDIAFNDQAgACgCOCABaiAEIAFrIgQgAyABayIBIAEgBEsbIgEQICAAIAAoAsAtIAFqNgLALQsLsSwBCn8CQCAARQ0AIAAoAiBFDQAgACgCJEUNACAAKAIcIgFFDQAgASgCACAARw0AAkACQCABKAIEIgNBOWsOOQECAgICAgICAgICAgECAgIBAgICAgICAgICAgICAgICAgIBAgICAgICAgICAgIBAgICAgICAgICAQALIANBmgVGDQAgA0EqRw0BCwJAAkAgACgCDEUNACAAKAIEIgIEQCAAKAIARQ0BCyADQZoFRw0BCyAAQbDfACgCADYCGA8LIAAoAhBFBEAgAEG83wAoAgA2AhgPCyABKAIoIQUgAUEDNgIoAkAgASgCFARAIAEQEwJAIAAoAhAiAyABKAIUIgQgAyAESRsiAkUNACAAKAIMIAEoAhAgAhAfGiAAIAAoAgwgAmo2AgwgASABKAIQIAJqNgIQIAAgACgCFCACajYCFCAAIAAoAhAgAmsiAzYCECABIAEoAhQgAmsiBDYCFCAEDQAgASABKAIINgIQQQAhBAsgAwRAIAEoAgQhAwwCCyABQX82AigPCyACDQAgBUEBdEF3QQAgBUEEShtqQQZIDQAgAEG83wAoAgA2AhgPCwJAAkACQAJAAn8CQAJAAkACQAJAAkAgA0EqRwRAIANBmgVHDQEgACgCBEUNAiAAQbzfACgCADYCGA8LIAEoAjBBDHRBgPABayEDQQAhAgJAIAEoAogBQQFKDQAgASgChAEiBUECSA0AQcAAIQIgBUEGSA0AQYABQcABIAVBBkYbIQILIAEgBEEBajYCFCABKAIIIARqIAIgA3IiAkEgciACIAEoAmwbIgJBCHY6AAAgASABKAIUIgNBAWo2AhQgAyABKAIIaiACQR9wIAJyQR9zOgAAIAEoAmwEQCAAKAIwIQIgASABKAIUIgNBAWo2AhQgAyABKAIIaiACQRh2OgAAIAEgASgCFCIDQQFqNgIUIAMgASgCCGogAkEQdjoAACAAKAIwIQIgASABKAIUIgNBAWo2AhQgAyABKAIIaiACQQh2OgAAIAEgASgCFCIDQQFqNgIUIAMgASgCCGogAjoAAAsgAEEAQQBBABAENgIwIAFB8QA2AgQgACgCHCICEBMCQCAAKAIQIgMgAigCFCIEIAMgBEkbIgNFDQAgACgCDCACKAIQIAMQHxogACAAKAIMIANqNgIMIAIgAigCECADajYCECAAIAAoAhQgA2o2AhQgACAAKAIQIANrNgIQIAIgAigCFCADayIDNgIUIAMNACACIAIoAgg2AhALIAEoAhQNBCABKAIEIQMLAkACQAJAAkACQAJAAkAgA0E5RgR/IABBAEEAQQAQBjYCMCABIAEoAhQiAkEBajYCFCACIAEoAghqQR86AAAgASABKAIUIgJBAWo2AhQgAiABKAIIakGLAToAACABIAEoAhQiAkEBajYCFCACIAEoAghqQQg6AAAgASgCHCICDQIgASABKAIUIgJBAWo2AhQgAiABKAIIakEAOgAAIAEgASgCFCICQQFqNgIUIAIgASgCCGpBADoAACABIAEoAhQiAkEBajYCFCACIAEoAghqQQA6AAAgASABKAIUIgJBAWo2AhQgAiABKAIIakEAOgAAIAEgASgCFCICQQFqNgIUIAIgASgCCGpBADoAAEECIQIgASgChAEiA0EJRwRAQQQgASgCiAFBAUpBAnQgA0ECSBshAgsgASABKAIUIgNBAWo2AhQgAyABKAIIaiACOgAAIAEgASgCFCICQQFqNgIUIAIgASgCCGpBAzoAACABQfEANgIEIAAoAhwiAhATAkAgACgCECIDIAIoAhQiBCADIARJGyIDRQ0AIAAoAgwgAigCECADEB8aIAAgACgCDCADajYCDCACIAIoAhAgA2o2AhAgACAAKAIUIANqNgIUIAAgACgCECADazYCECACIAIoAhQgA2siAzYCFCADDQAgAiACKAIINgIQCyABKAIUDQEgASgCBAUgAwtBxQBrDiMCBgYGAwYGBgYGBgYGBgYGBgYGBgYGBAYGBgYGBgYGBgYGBQYLIAFBfzYCKA8LIAIoAiQhAyACKAIcIQQgAigCECEFIAIoAiwhBiACKAIAIQggASABKAIUIgdBAWo2AhRBAiECIAcgASgCCGogBkEAR0EBdCAIQQBHciAFQQBHQQJ0ciAEQQBHQQN0ciADQQBHQQR0cjoAACABKAIcKAIEIQMgASABKAIUIgRBAWo2AhQgBCABKAIIaiADOgAAIAEoAhwoAgQhAyABIAEoAhQiBEEBajYCFCAEIAEoAghqIANBCHY6AAAgASgCHC8BBiEDIAEgASgCFCIEQQFqNgIUIAQgASgCCGogAzoAACABKAIcLQAHIQMgASABKAIUIgRBAWo2AhQgBCABKAIIaiADOgAAIAEoAoQBIgNBCUcEQEEEIAEoAogBQQFKQQJ0IANBAkgbIQILIAEgASgCFCIDQQFqNgIUIAMgASgCCGogAjoAACABKAIcKAIMIQIgASABKAIUIgNBAWo2AhQgAyABKAIIaiACOgAAIAEoAhwiAigCEAR/IAIoAhQhAiABIAEoAhQiA0EBajYCFCADIAEoAghqIAI6AAAgASgCHCgCFCECIAEgASgCFCIDQQFqNgIUIAMgASgCCGogAkEIdjoAACABKAIcBSACCygCLARAIAAgACgCMCABKAIIIAEoAhQQBjYCMAsgAUHFADYCBCABQQA2AiALIAEoAhwiBCgCECIDBEAgASgCFCICIAQvARQgASgCICIGayIFaiABKAIMIgRLBEADQCABKAIIIAJqIAMgBmogBCACayIEEB8aIAEgASgCDCIDNgIUAkAgAiADTw0AIAEoAhwoAixFDQAgACAAKAIwIAEoAgggAmogAyACaxAGNgIwCyABIAEoAiAgBGo2AiAgACgCHCICEBMCQCAAKAIQIgMgAigCFCIGIAMgBkkbIgNFDQAgACgCDCACKAIQIAMQHxogACAAKAIMIANqNgIMIAIgAigCECADajYCECAAIAAoAhQgA2o2AhQgACAAKAIQIANrNgIQIAIgAigCFCADayIDNgIUIAMNACACIAIoAgg2AhALIAEoAhQEQCABQX82AigPCyABKAIgIQYgASgCHCgCECEDQQAhAiAFIARrIgUgASgCDCIESw0ACwsgASgCCCACaiADIAZqIAUQHxogASABKAIUIAVqIgM2AhQCQCACIANPDQAgASgCHCgCLEUNACAAIAAoAjAgASgCCCACaiADIAJrEAY2AjALIAFBADYCIAsgAUHJADYCBAsgASgCHCgCHARAIAEoAhQiAiEFA0ACQCACIAEoAgxHDQACQCACIAVNDQAgASgCHCgCLEUNACAAIAAoAjAgASgCCCAFaiACIAVrEAY2AjALIAAoAhwiAhATAkAgACgCECIDIAIoAhQiBCADIARJGyIDRQ0AIAAoAgwgAigCECADEB8aIAAgACgCDCADajYCDCACIAIoAhAgA2o2AhAgACAAKAIUIANqNgIUIAAgACgCECADazYCECACIAIoAhQgA2siAzYCFCADDQAgAiACKAIINgIQC0EAIQJBACEFIAEoAhRFDQAgAUF/NgIoDwsgASgCHCgCHCEDIAEgASgCICIEQQFqNgIgIAMgBGotAAAhAyABIAJBAWo2AhQgASgCCCACaiADOgAAIAMEQCABKAIUIQIMAQsLAkAgASgCHCgCLEUNACABKAIUIgIgBU0NACAAIAAoAjAgASgCCCAFaiACIAVrEAY2AjALIAFBADYCIAsgAUHbADYCBAsCQCABKAIcKAIkRQ0AIAEoAhQiAiEFA0ACQCACIAEoAgxHDQACQCACIAVNDQAgASgCHCgCLEUNACAAIAAoAjAgASgCCCAFaiACIAVrEAY2AjALIAAoAhwiAhATAkAgACgCECIDIAIoAhQiBCADIARJGyIDRQ0AIAAoAgwgAigCECADEB8aIAAgACgCDCADajYCDCACIAIoAhAgA2o2AhAgACAAKAIUIANqNgIUIAAgACgCECADazYCECACIAIoAhQgA2siAzYCFCADDQAgAiACKAIINgIQC0EAIQJBACEFIAEoAhRFDQAgAUF/NgIoDwsgASgCHCgCJCEDIAEgASgCICIEQQFqNgIgIAMgBGotAAAhAyABIAJBAWo2AhQgASgCCCACaiADOgAAIAMEQCABKAIUIQIMAQsLIAEoAhwoAixFDQAgASgCFCICIAVNDQAgACAAKAIwIAEoAgggBWogAiAFaxAGNgIwCyABQecANgIECyABKAIcKAIsBEAgASgCDCABKAIUIgJBAmpJBEAgACgCHCICEBMCQCAAKAIQIgMgAigCFCIEIAMgBEkbIgNFDQAgACgCDCACKAIQIAMQHxogACAAKAIMIANqNgIMIAIgAigCECADajYCECAAIAAoAhQgA2o2AhQgACAAKAIQIANrNgIQIAIgAigCFCADayIDNgIUIAMNACACIAIoAgg2AhALIAEoAhQNBUEAIQILIAAoAjAhAyABIAJBAWo2AhQgASgCCCACaiADOgAAIAAoAjAhAiABIAEoAhQiA0EBajYCFCADIAEoAghqIAJBCHY6AAAgAEEAQQBBABAGNgIwCyABQfEANgIEIAAoAhwiAhATAkAgACgCECIDIAIoAhQiBCADIARJGyIDRQ0AIAAoAgwgAigCECADEB8aIAAgACgCDCADajYCDCACIAIoAhAgA2o2AhAgACAAKAIUIANqNgIUIAAgACgCECADazYCECACIAIoAhQgA2siAzYCFCADDQAgAiACKAIINgIQCyABKAIURQ0AIAFBfzYCKA8LIAAoAgQNAQsgASgCdA0AIAEoAgRBmgVGDQgLIAEoAoQBIgJFBEAgAUEDEAwMBAsCQAJAIAEoAogBQQJrDgIAAQQLA0ACQAJAIAEoAnQNACABEAogASgCdA0AIAFBADYCtC0MAQsgAUEANgJgIAEoAjggASgCbGotAAAhAiABKAKkLSABKAKgLSIDQQF0akEAOwEAIAEgA0EBajYCoC0gAyABKAKYLWogAjoAACABIAJBAnRqQZQBaiICIAIvAQBBAWo7AQAgASABKAJ0QQFrNgJ0IAEgASgCbEEBaiICNgJsIAEoAqAtIAEoApwtQQFrRw0BIAEgASgCXCIEQQBOBH8gASgCOCAEagVBAAsgAiAEa0EAEBQgASABKAJsNgJcIAEoAgAiAigCHCIDEBMCQCACKAIQIgQgAygCFCIFIAQgBUkbIgRFDQAgAigCDCADKAIQIAQQHxogAiACKAIMIARqNgIMIAMgAygCECAEajYCECACIAIoAhQgBGo2AhQgAiACKAIQIARrNgIQIAMgAygCFCAEayICNgIUIAINACADIAMoAgg2AhALIAEoAgAoAhANAQwHCwsgASgCoC1FDQcgASABKAJcIgNBAE4EfyABKAI4IANqBUEACyABKAJsIANrQQAQFCABIAEoAmw2AlwgASgCACICKAIcIgMQEwJAIAIoAhAiBCADKAIUIgUgBCAFSRsiBEUNACACKAIMIAMoAhAgBBAfGiACIAIoAgwgBGo2AgwgAyADKAIQIARqNgIQIAIgAigCFCAEajYCFCACIAIoAhAgBGs2AhAgAyADKAIUIARrIgI2AhQgAg0AIAMgAygCCDYCEAsgASgCACgCEEUNBQwHCwNAAkACQAJAIAEoAnQiAkGDAk8EQCABQQA2AmAMAQsgARAKIAEoAnQiAgRAIAFBADYCYCACQQJLDQEgASgCbCEDDAILIAFBADYCtC0gASgCoC1FDQogASABKAJcIgNBAE4EfyABKAI4IANqBUEACyABKAJsIANrQQAQFCABIAEoAmw2AlwgASgCACICKAIcIgMQEwJAIAIoAhAiBCADKAIUIgUgBCAFSRsiBEUNACACKAIMIAMoAhAgBBAfGiACIAIoAgwgBGo2AgwgAyADKAIQIARqNgIQIAIgAigCFCAEajYCFCACIAIoAhAgBGs2AhAgAyADKAIUIARrIgI2AhQgAg0AIAMgAygCCDYCEAsgASgCACgCEEUNCAwKCyABKAJsIgNFBEBBACEDDAELIAEoAjggA2oiBkEBayIFLQAAIgQgBi0AAEcNACAEIAUtAAJHDQAgBCAFLQADRw0AIAZBggJqIQlBfyEIAkACQAJAAkACQAJAA0AgBiAIaiIFLQAEIARGBEAgBCAFLQAFRw0CIAQgBS0ABkcNAyAEIAUtAAdHDQQgBCAGIAhBCGoiCmoiBy0AAEcNByAEIAUtAAlHDQUgBCAFLQAKRw0GIAVBC2ohByAIQfYBSg0HIAohCCAEIActAABGDQEMBwsLIAVBBGohBwwFCyAFQQVqIQcMBAsgBUEGaiEHDAMLIAVBB2ohBwwCCyAFQQlqIQcMAQsgBUEKaiEHCyABIAIgByAJa0GCAmoiBCACIARJGyICNgJgIAJBA0kNACABKAKkLSABKAKgLSIDQQF0akEBOwEAIAEgA0EBajYCoC0gAyABKAKYLWogAkEDayICOgAAIAJB/wFxQYDNAGotAABBAnQgAWpBmAlqIgIgAi8BAEEBajsBACABQYDJAC0AAEECdGpBiBNqIgIgAi8BAEEBajsBACABKAJgIQIgAUEANgJgIAEgASgCdCACazYCdCABIAIgASgCbGoiAjYCbCABKAKgLSABKAKcLUEBa0cNAgwBCyABKAI4IANqLQAAIQIgASgCpC0gASgCoC0iA0EBdGpBADsBACABIANBAWo2AqAtIAMgASgCmC1qIAI6AAAgASACQQJ0akGUAWoiAiACLwEAQQFqOwEAIAEgASgCdEEBazYCdCABIAEoAmxBAWoiAjYCbCABKAKgLSABKAKcLUEBa0cNAQsgASABKAJcIgRBAE4EfyABKAI4IARqBUEACyACIARrQQAQFCABIAEoAmw2AlwgASgCACICKAIcIgMQEwJAIAIoAhAiBCADKAIUIgUgBCAFSRsiBEUNACACKAIMIAMoAhAgBBAfGiACIAIoAgwgBGo2AgwgAyADKAIQIARqNgIQIAIgAigCFCAEajYCFCACIAIoAhAgBGs2AhAgAyADKAIUIARrIgI2AhQgAg0AIAMgAygCCDYCEAsgASgCACgCEA0ACwwECyABQX82AigPCyABQX82AigPCyABQQMgAkEMbEGIyABqKAIAEQQACyICQX5xQQJGBEAgAUGaBTYCBAsgAkF9cQ0BCyAAKAIQDQMgAUF/NgIoDwsgAkEBRw0BCyABQQBBAEEAEBIgASgCRCICIAEoAkxBAXRBAmsiA2pBADsBACACIAMQICABKAJ0RQRAIAFBADYCtC0gAUEANgJcIAFBADYCbAsgACgCHCICEBMCQCAAKAIQIgQgAigCFCIDIAMgBEsbIgNFDQAgACgCDCACKAIQIAMQHxogACAAKAIMIANqNgIMIAIgAigCECADajYCECAAIAAoAhQgA2o2AhQgACAAKAIQIANrIgQ2AhAgAiACKAIUIANrIgM2AhQgAw0AIAIgAigCCDYCEAsgBA0AIAFBfzYCKAsLC7YNAQt/IAAoAgAiBCgCBCEJQQEhCAJAIAQoAhAiAyAAKAK8LUEqakEDdSICSQ0AIAAoAiwiBSAAKAIMQQVrIgYgBSAGSRshCiABQQRHIQsDQCAKIAMgAmsiAyAAKAJsIAAoAlxrIgYgBCgCBGoiAkH//wMgAkH//wNJGyIFIAMgBUkbIgNLBEAgAiADRw0CIAFFDQIgCyADRXENAgsgAEEAQQAgAUEERiACIANGcSIHEBIgACgCFCAAKAIIakEEayADOgAAIAAoAhQgACgCCGpBA2sgA0EIdjoAACAAKAIUIAAoAghqQQJrIANBf3MiAjoAACAAKAIUIAAoAghqQQFrIAJBCHY6AAAgACgCACICKAIcIgQQEwJAIAIoAhAiBSAEKAIUIgwgBSAMSRsiBUUNACACKAIMIAQoAhAgBRAfGiACIAIoAgwgBWo2AgwgBCAEKAIQIAVqNgIQIAIgAigCFCAFajYCFCACIAIoAhAgBWs2AhAgBCAEKAIUIAVrIgI2AhQgAg0AIAQgBCgCCDYCEAsCfyAGBEAgACgCACgCDCAAKAI4IAAoAlxqIAMgBiADIAZJGyICEB8aIAAoAgAiBCAEKAIMIAJqNgIMIAQgBCgCECACazYCECAEIAQoAhQgAmo2AhQgACAAKAJcIAJqNgJcIAMgAmshAwsgAwsEQCAAKAIAIgIoAgwhBSADIAIoAgQiBiADIAZJGyIEBEAgAiAGIARrNgIEIAUgAigCACAEEB8hBQJAAkACQCACKAIcKAIYQQFrDgIAAQILIAIgAigCMCAFIAQQBDYCMAwBCyACIAIoAjAgBSAEEAY2AjALIAIgAigCACAEajYCACACIAIoAgggBGo2AgggACgCACICKAIMIQULIAIgAyAFajYCDCACIAIoAhAgA2s2AhAgAiACKAIUIANqNgIUCyAAKAIAIQQgBwRAQQAhCAwCCyAEKAIQIgMgACgCvC1BKmpBA3UiAk8NAAsLAkAgCSAEKAIEayIDRQRAIAAoAmwhAgwBCwJAIAAoAiwiAiADTQRAIABBAjYCsC0gACgCOCAEKAIAIAJrIAIQHxogACAAKAIsIgQ2AmwgBCECDAELAkAgACgCPCAAKAJsIgRrIANLDQAgACAEIAJrIgQ2AmwgACgCOCIFIAIgBWogBBAfGiAAKAKwLSICQQFLDQAgACACQQFqNgKwLQsgACgCOCAAKAJsaiAAKAIAKAIAIANrIAMQHxogACAAKAJsIANqIgI2AmwgACgCLCEECyAAIAI2AlwgACAEIAAoArQtIgVrIgQgAyADIARLGyAFajYCtC0LIAIgACgCwC1LBEAgACACNgLALQtBAyEDAkAgCEUNACAAKAIAIgQoAgQhAwJAAkAgAUF7cUUNACADDQBBASEDIAIgACgCXEYNAiAAKAI8IAJBf3NqIQVBACEDDAELIAMgACgCPCACQX9zaiIFTQ0AIAAoAlwiByAAKAIsIgZIDQAgACACIAZrIgM2AmwgACAHIAZrNgJcIAAoAjgiAiACIAZqIAMQHxogACgCsC0iA0EBTQRAIAAgA0EBajYCsC0LIAAoAiwgBWohBSAAKAIAIgQoAgQhAwsCQCADIAUgAyAFSRsiAkUEQCAAKAJsIQMMAQsgACgCbCEFIAAoAjghBiAEIAMgAms2AgQgBSAGaiAEKAIAIAIQHyEDAkACQAJAIAQoAhwoAhhBAWsOAgABAgsgBCAEKAIwIAMgAhAENgIwDAELIAQgBCgCMCADIAIQBjYCMAsgBCAEKAIAIAJqNgIAIAQgBCgCCCACajYCCCAAIAAoAmwgAmoiAzYCbAsgAyAAKALALUsEQCAAIAM2AsAtCyADIAAoAlwiBmsiBCAAKAIsIgMgACgCDCAAKAK8LUEqakEDdWsiAkH//wMgAkH//wNJGyICIAIgA0sbSQRAQQAhAyABRQ0BIAFBBEYgBEEAR3JFDQEgAiAESQ0BIAAoAgAoAgQNAQtBACEFIAAgACgCOCAGaiACIAQgAiAESRsiAwJ/IAFBBEYEQCAAKAIAKAIERSACIARPcSEFCyAFCxASIAAgACgCXCADajYCXCAAKAIAIgAoAhwiAxATAkAgACgCECICIAMoAhQiBCACIARJGyICRQ0AIAAoAgwgAygCECACEB8aIAAgACgCDCACajYCDCADIAMoAhAgAmo2AhAgACAAKAIUIAJqNgIUIAAgACgCECACazYCECADIAMoAhQgAmsiADYCFCAADQAgAyADKAIINgIQC0ECQQAgBRshAwsgAwu5CwENfwJAA0ACQAJAIAAoAnRBhQJNBEAgABAKIAAoAnQhAgJAIAENACACQYYCTw0AQQAPCyACRQ0EIAJBA0kNAQsgACAAKAJUIAAoAmwiAiAAKAI4ai0AAiAAKAJIIAAoAlh0c3EiAzYCSCAAKAJAIAIgACgCNHFBAXRqIAAoAkQgA0EBdGoiBC8BACIDOwEAIAQgAjsBACADRQ0AIAAoAixBhgJrIAIgA2tJDQAgACAAIAMQDiICNgJgDAELIAAoAmAhAgsCQCACQQNPBEAgACgCpC0gACgCoC0iA0EBdGogACgCbCAAKAJwayIEOwEAIAAgA0EBajYCoC0gAyAAKAKYLWogAkEDayICOgAAIAJB/wFxQYDNAGotAABBAnQgAGpBmAlqIgIgAi8BAEEBajsBACAAIARBAWtB//8DcSICIAJBB3ZBgAJqIAJBgAJJG0GAyQBqLQAAQQJ0akGIE2oiAiACLwEAQQFqOwEAIAAgACgCdCAAKAJgIgJrIgM2AnQgACgCnC1BAWshBiAAKAKgLSEHAkAgA0EDSQ0AIAIgACgCgAFLDQAgACACQQFrIgM2AmAgACgCSCEEIAAoAmwhAiAAKAI0IQggACgCQCEJIAAoAkQhCiAAKAJUIQsgACgCOCEMIAAoAlghDQNAIAAgAiIFQQFqIgI2AmwgACAFIAxqLQADIAQgDXRzIAtxIgQ2AkggCSACIAhxQQF0aiAKIARBAXRqIg4vAQA7AQAgDiACOwEAIAAgA0EBayIDNgJgIAMNAAsgACAFQQJqIgI2AmwgBiAHRw0DDAILIABBADYCYCAAIAAoAmwgAmoiAjYCbCAAIAAoAjggAmoiAy0AACIENgJIIAAgACgCVCADLQABIAQgACgCWHRzcTYCSCAGIAdHDQIMAQsgACgCOCAAKAJsai0AACECIAAoAqQtIAAoAqAtIgNBAXRqQQA7AQAgACADQQFqNgKgLSADIAAoApgtaiACOgAAIAAgAkECdGpBlAFqIgIgAi8BAEEBajsBACAAIAAoAnRBAWs2AnQgACAAKAJsQQFqIgI2AmwgACgCoC0gACgCnC1BAWtHDQELQQAhAyAAIAAoAlwiBEEATgR/IAAoAjggBGoFIAMLIAIgBGtBABAUIAAgACgCbDYCXCAAKAIAIgIoAhwiAxATAkAgAigCECIEIAMoAhQiBSAEIAVJGyIERQ0AIAIoAgwgAygCECAEEB8aIAIgAigCDCAEajYCDCADIAMoAhAgBGo2AhAgAiACKAIUIARqNgIUIAIgAigCECAEazYCECADIAMoAhQgBGsiAjYCFCACDQAgAyADKAIINgIQCyAAKAIAKAIQDQALQQAPCyAAIAAoAmwiAkECIAJBAkkbNgK0LSABQQRGBEBBACEDIAAgACgCXCIEQQBOBH8gACgCOCAEagUgAwsgAiAEa0EBEBQgACAAKAJsNgJcIAAoAgAiAigCHCIDEBMCQCACKAIQIgQgAygCFCIFIAQgBUkbIgRFDQAgAigCDCADKAIQIAQQHxogAiACKAIMIARqNgIMIAMgAygCECAEajYCECACIAIoAhQgBGo2AhQgAiACKAIQIARrNgIQIAMgAygCFCAEayICNgIUIAINACADIAMoAgg2AhALQQNBAiAAKAIAKAIQGw8LAkAgACgCoC1FDQBBACEDIAAgACgCXCIEQQBOBH8gACgCOCAEagUgAwsgAiAEa0EAEBQgACAAKAJsNgJcIAAoAgAiAigCHCIDEBMCQCACKAIQIgQgAygCFCIFIAQgBUkbIgRFDQAgAigCDCADKAIQIAQQHxogAiACKAIMIARqNgIMIAMgAygCECAEajYCECACIAIoAhQgBGo2AhQgAiACKAIQIARrNgIQIAMgAygCFCAEayICNgIUIAINACADIAMoAgg2AhALIAAoAgAoAhANAEEADwtBAQukBAEQfyAAKAJ8IgMgA0ECdiAAKAJ4IgQgACgCjAFJGyEJQQAgACgCbCIDIAAoAixrQYYCaiICIAIgA0sbIQwgACgCdCIHIAAoApABIgIgAiAHSxshDSAAKAI4Ig4gA2oiBUGCAmohDyAEIAVqIgMtAAAhCiADQQFrLQAAIQsgACgCNCEQIAAoAkAhEQNAAkACQCABIA5qIgMgBGoiAi0AACAKRw0AIAJBAWstAAAgC0cNACADLQAAIAUtAABHDQBBAiEGIAMtAAEgBS0AAUcNAAJAAkACQAJAAkACQAJAA0AgBSAGaiICLQABIAMtAANHDQYgAi0AAiADLQAERw0FIAItAAMgAy0ABUcNBCACLQAEIAMtAAZHDQMgAi0ABSADLQAHRw0CIAItAAYgAy0ACEcNASACLQAHIAMtAAlGBEAgBkH5AUshCCAFIAZBCGoiBmohAiAIDQggAy0ACiEIIANBCGohAyACLQAAIAhGDQEMCAsLIAJBB2ohAgwGCyACQQZqIQIMBQsgAkEFaiECDAQLIAJBBGohAgwDCyACQQNqIQIMAgsgAkECaiECDAELIAJBAWohAgsgAiAPayICQYICaiIDIARMDQAgACABNgJwIAMgDU4EQCADIQQMAgsgAyAFai0AACEKIAIgBWotAIECIQsgAyEECyAJQQFrIglFDQAgDCARIAEgEHFBAXRqLwEAIgFJDQELCyAHIAQgBCAHSxsL3Q4BB38DQAJAAkACQCAAKAJ0QYUCSw0AIAAQCiAAKAJ0IQICQCABDQAgAkGGAk8NAEEADwsgAkUNAiACQQJLDQAgACAAKAJgIgI2AnggACAAKAJwNgJkQQIhAyAAQQI2AmAMAQtBAiEDIAAgACgCVCAAKAJsIgIgACgCOGotAAIgACgCSCAAKAJYdHNxIgQ2AkggACgCQCACIAAoAjRxQQF0aiAAKAJEIARBAXRqIgUvAQAiBDsBACAFIAI7AQAgACAAKAJgIgI2AnggACAAKAJwNgJkIABBAjYCYCAERQ0AAkAgAiAAKAKAAU8NACAAKAIsQYYCayAAKAJsIARrSQ0AIAAgACAEEA4iAzYCYCADQQVLDQAgACgCiAFBAUcEQCADQQNHDQFBAyEDIAAoAmwgACgCcGtBgSBJDQELQQIhAyAAQQI2AmALIAAoAnghAgsCQCACQQNJDQAgAiADSQ0AIAAoAnQhBCAAKAKkLSAAKAKgLSIDQQF0aiAAKAJsIgUgACgCZEF/c2oiBjsBACAAIANBAWo2AqAtIAMgACgCmC1qIAJBA2siAjoAACACQf8BcUGAzQBqLQAAQQJ0IABqQZgJaiICIAIvAQBBAWo7AQAgACAGQQFrQf//A3EiAiACQQd2QYACaiACQYACSRtBgMkAai0AAEECdGpBiBNqIgIgAi8BAEEBajsBACAAIAAoAngiAkECayIDNgJ4IAAgACgCdCACa0EBajYCdCAEIAVqQQNrIQUgACgCnC1BAWshByAAKAJsIQIgACgCoC0hCANAIAAgAiIEQQFqIgI2AmwgAiAFTQRAIAAgACgCVCAEIAAoAjhqLQADIAAoAkggACgCWHRzcSIGNgJIIAAoAkAgACgCNCACcUEBdGogACgCRCAGQQF0aiIGLwEAOwEAIAYgAjsBAAsgACADQQFrIgM2AnggAw0ACyAAQQI2AmAgAEEANgJoIAAgBEECaiICNgJsIAcgCEcNAkEAIQMgACAAKAJcIgRBAE4EfyAAKAI4IARqBSADCyACIARrQQAQFCAAIAAoAmw2AlwgACgCACICKAIcIgMQEwJAIAIoAhAiBCADKAIUIgUgBCAFSRsiBEUNACACKAIMIAMoAhAgBBAfGiACIAIoAgwgBGo2AgwgAyADKAIQIARqNgIQIAIgAigCFCAEajYCFCACIAIoAhAgBGs2AhAgAyADKAIUIARrIgI2AhQgAg0AIAMgAygCCDYCEAsgACgCACgCEA0CQQAPCyAAKAJoBEAgACgCbCAAKAI4akEBay0AACECIAAoAqQtIAAoAqAtIgNBAXRqQQA7AQAgACADQQFqNgKgLSADIAAoApgtaiACOgAAIAAgAkECdGpBlAFqIgIgAi8BAEEBajsBAAJAIAAoAqAtIAAoApwtQQFrRw0AQQAhAyAAIAAoAlwiAkEATgR/IAAoAjggAmoFIAMLIAAoAmwgAmtBABAUIAAgACgCbDYCXCAAKAIAIgIoAhwiAxATIAIoAhAiBCADKAIUIgUgBCAFSRsiBEUNACACKAIMIAMoAhAgBBAfGiACIAIoAgwgBGo2AgwgAyADKAIQIARqNgIQIAIgAigCFCAEajYCFCACIAIoAhAgBGs2AhAgAyADKAIUIARrIgI2AhQgAg0AIAMgAygCCDYCEAsgACAAKAJsQQFqNgJsIAAgACgCdEEBazYCdCAAKAIAKAIQDQJBAA8FIABBATYCaCAAIAAoAmxBAWo2AmwgACAAKAJ0QQFrNgJ0DAILAAsLIAAoAmgEQCAAKAJsIAAoAjhqQQFrLQAAIQIgACgCpC0gACgCoC0iA0EBdGpBADsBACAAIANBAWo2AqAtIAMgACgCmC1qIAI6AAAgACACQQJ0akGUAWoiAiACLwEAQQFqOwEAIABBADYCaAsgACAAKAJsIgJBAiACQQJJGzYCtC0gAUEERgRAQQAhAyAAIAAoAlwiBEEATgR/IAAoAjggBGoFIAMLIAIgBGtBARAUIAAgACgCbDYCXCAAKAIAIgIoAhwiAxATAkAgAigCECIEIAMoAhQiBSAEIAVJGyIERQ0AIAIoAgwgAygCECAEEB8aIAIgAigCDCAEajYCDCADIAMoAhAgBGo2AhAgAiACKAIUIARqNgIUIAIgAigCECAEazYCECADIAMoAhQgBGsiAjYCFCACDQAgAyADKAIINgIQC0EDQQIgACgCACgCEBsPCwJAIAAoAqAtRQ0AQQAhAyAAIAAoAlwiBEEATgR/IAAoAjggBGoFIAMLIAIgBGtBABAUIAAgACgCbDYCXCAAKAIAIgIoAhwiAxATAkAgAigCECIEIAMoAhQiBSAEIAVJGyIERQ0AIAIoAgwgAygCECAEEB8aIAIgAigCDCAEajYCDCADIAMoAhAgBGo2AhAgAiACKAIUIARqNgIUIAIgAigCECAEazYCECADIAMoAhQgBGsiAjYCFCACDQAgAyADKAIINgIQCyAAKAIAKAIQDQBBAA8LQQELYQAgAEEANgK8LSAAQQA7AbgtIABBuBZqQajPADYCACAAIABB/BRqNgKwFiAAQawWakGUzwA2AgAgACAAQYgTajYCpBYgAEGgFmpBgM8ANgIAIAAgAEGUAWo2ApgWIAAQEQvwBAEDfyAAQZQBaiECA0AgAiABQQJ0IgNqQQA7AQAgAiADQQRyakEAOwEAIAFBAmoiAUGeAkcNAAsgAEEAOwH8FCAAQQA7AYgTIABBxBVqQQA7AQAgAEHAFWpBADsBACAAQbwVakEAOwEAIABBuBVqQQA7AQAgAEG0FWpBADsBACAAQbAVakEAOwEAIABBrBVqQQA7AQAgAEGoFWpBADsBACAAQaQVakEAOwEAIABBoBVqQQA7AQAgAEGcFWpBADsBACAAQZgVakEAOwEAIABBlBVqQQA7AQAgAEGQFWpBADsBACAAQYwVakEAOwEAIABBiBVqQQA7AQAgAEGEFWpBADsBACAAQYAVakEAOwEAIABB/BNqQQA7AQAgAEH4E2pBADsBACAAQfQTakEAOwEAIABB8BNqQQA7AQAgAEHsE2pBADsBACAAQegTakEAOwEAIABB5BNqQQA7AQAgAEHgE2pBADsBACAAQdwTakEAOwEAIABB2BNqQQA7AQAgAEHUE2pBADsBACAAQdATakEAOwEAIABBzBNqQQA7AQAgAEHIE2pBADsBACAAQcQTakEAOwEAIABBwBNqQQA7AQAgAEG8E2pBADsBACAAQbgTakEAOwEAIABBtBNqQQA7AQAgAEGwE2pBADsBACAAQawTakEAOwEAIABBqBNqQQA7AQAgAEGkE2pBADsBACAAQaATakEAOwEAIABBnBNqQQA7AQAgAEGYE2pBADsBACAAQZQTakEAOwEAIABBkBNqQQA7AQAgAEGME2pBADsBACAAQgA3AqwtIABBlAlqQQE7AQAgAEEANgKoLSAAQQA2AqAtC7IDAQJ/IAAgAC8BuC0gA0H//wNxIgUgACgCvC0iBHRyIgM7AbgtAkACQAJ/IARBDk4EQCAAIAAoAhQiBEEBajYCFCAEIAAoAghqIAM6AAAgACAAKAIUIgNBAWo2AhQgAyAAKAIIaiAAQbktai0AADoAACAAIAVBECAAKAK8LSIEa3YiAzsBuC0gBEENawwBCyAEQQNqCyIEQQlOBEAgACAAKAIUIgRBAWo2AhQgBCAAKAIIaiADOgAAIAAgACgCFCIDQQFqNgIUIAMgACgCCGohBCAAQbktai0AACEDDAELIARBAUgNASAAIAAoAhQiBEEBajYCFCAEIAAoAghqIQQLIAQgAzoAAAsgAEEANgK8LSAAQQA7AbgtIAAgACgCFCIDQQFqNgIUIAMgACgCCGogAjoAACAAIAAoAhQiA0EBajYCFCADIAAoAghqIAJBCHY6AAAgACAAKAIUIgNBAWo2AhQgAyAAKAIIaiACQX9zIgM6AAAgACAAKAIUIgRBAWo2AhQgBCAAKAIIaiADQQh2OgAAIAAoAgggACgCFGogASACEB8aIAAgACgCFCACajYCFAusAQEBfwJAIAACfyAAKAK8LSIBQRBGBEAgACAAKAIUIgFBAWo2AhQgASAAKAIIaiAALQC4LToAACAAIAAoAhQiAUEBajYCFCABIAAoAghqIABBuS1qLQAAOgAAIABBADsBuC1BAAwBCyABQQhIDQEgACAAKAIUIgFBAWo2AhQgASAAKAIIaiAALQC4LToAACAAIABBuS1qLQAAOwG4LSAAKAK8LUEIaws2ArwtCwuhEwENfwJ/AkACQAJAIAAoAoQBQQFOBEAgACgCACIGKAIsQQJHDQNB/4D/n38hBANAAkAgBEEBcUUNACAAIAVBAnRqLwGUAUUNAEEAIQQMBAsCQCAEQQJxRQ0AIAAgBUECdEEEcmovAZQBRQ0AQQAhBAwECyAEQQJ2IQQgBUECaiIFQSBHDQALDAELIAJBBWoiBQwDCwJAIAAvAbgBDQAgAC8BvAENACAALwHIAQ0AQSAhBQNAIAAgBUECdCIEai8BlAENASAAIARBBHJqLwGUAQ0BIAAgBEEIcmovAZQBDQEgACAEQQxyai8BlAENAUEAIQQgBUEEaiIFQYACRw0ACwwBC0EBIQQLIAYgBDYCLAsgACAAQZgWahAVIAAgAEGkFmoQFSAALwGWASEEIAAgAEGcFmooAgAiCkECdGpB//8DOwGaASAKQQBOBEBBB0GKASAEGyEJQQRBAyAEGyELIABBwBVqIQ4gAEHEFWohDyAAQbwVaiEQQX8hDANAIAQhBSAAIAgiDUEBaiIIQQJ0ai8BlgEhBAJAAkAgB0EBaiIGIAlODQAgBCAFRw0AIAYhBwwBCwJ/IAYgC0gEQCAAIAVBAnRqQfwUaiIHLwEAIAZqDAELIAUEQCAFIAxHBEAgACAFQQJ0akH8FGoiBiAGLwEAQQFqOwEACyAQIgcvAQBBAWoMAQsgB0EJTARAIA4iBy8BAEEBagwBCyAPIgcvAQBBAWoLIQYgByAGOwEAQQAhBwJ/IARFBEBBAyELQYoBDAELQQNBBCAEIAVGIgYbIQtBBkEHIAYbCyEJIAUhDAsgCiANRw0ACwsgAEGKE2ovAQAhBCAAIABBqBZqKAIAIgpBAnRqQY4TakH//wM7AQBBACEHIApBAE4EQEEHQYoBIAQbIQlBBEEDIAQbIQsgAEHAFWohDiAAQcQVaiEPIABBvBVqIRBBfyEMQQAhCANAIAQhBSAAIAgiDUEBaiIIQQJ0akGKE2ovAQAhBAJAAkAgB0EBaiIGIAlODQAgBCAFRw0AIAYhBwwBCwJ/IAYgC0gEQCAAIAVBAnRqQfwUaiIHLwEAIAZqDAELIAUEQCAFIAxHBEAgACAFQQJ0akH8FGoiBiAGLwEAQQFqOwEACyAQIgcvAQBBAWoMAQsgB0EJTARAIA4iBy8BAEEBagwBCyAPIgcvAQBBAWoLIQYgByAGOwEAQQAhBwJ/IARFBEBBAyELQYoBDAELQQNBBCAEIAVGIgYbIQtBBkEHIAYbCyEJIAUhDAsgCiANRw0ACwsgACAAQbAWahAVIAAgACgCqC0Cf0ESIABBuhVqLwEADQAaQREgAEGCFWovAQANABpBECAAQbYVai8BAA0AGkEPIABBhhVqLwEADQAaQQ4gAEGyFWovAQANABpBDSAAQYoVai8BAA0AGkEMIABBrhVqLwEADQAaQQsgAEGOFWovAQANABpBCiAAQaoVai8BAA0AGkEJIABBkhVqLwEADQAaQQggAEGmFWovAQANABpBByAAQZYVai8BAA0AGkEGIABBohVqLwEADQAaQQUgAEGaFWovAQANABpBBCAAQZ4Vai8BAA0AGkEDQQIgAEH+FGovAQAbCyIIQQNsaiIEQRFqNgKoLSAEQRtqQQN2IgQgACgCrC1BCmpBA3YiBSAEIAVJGwshBAJAAkAgAUUNACACQQRqIARLDQAgACABIAIgAxASDAELIAAoArwtIQYCQCAEIAVHBEAgACgCiAFBBEcNAQsgACAALwG4LSADQQJqQf//A3EiBCAGdHIiBTsBuC0gAAJ/IAZBDk4EQCAAIAAoAhQiBkEBajYCFCAGIAAoAghqIAU6AAAgACAAKAIUIgVBAWo2AhQgBSAAKAIIaiAAQbktai0AADoAACAAIARBECAAKAK8LSIFa3Y7AbgtIAVBDWsMAQsgBkEDags2ArwtIABBwM8AQcDYABAWDAELIAAvAbgtIANBBGpB//8DcSIHIAZ0ciEFAkAgBkEOTgRAIAAgBTsBuC0gACAAKAIUIgRBAWo2AhQgBCAAKAIIaiAFOgAAIAAgACgCFCIEQQFqNgIUIAQgACgCCGogAEG5LWotAAA6AAAgACgCvC0iBUENayEEIAdBECAFa3YhBQwBCyAGQQNqIQQLIAAgBDYCvC0gAEGcFmooAgAiCkGA/gNqQf//A3EiByAEdCEGIABBqBZqKAIAIQkCfyAEQQxOBEAgACAFIAZyIgQ7AbgtIAAgACgCFCIFQQFqNgIUIAUgACgCCGogBDoAACAAIAAoAhQiBEEBajYCFCAEIAAoAghqIABBuS1qLQAAOgAAIAAoArwtIgVBC2shBCAHQRAgBWt2DAELIARBBWohBCAFIAZyCyEFIAAgBDYCvC0gCUH//wNxIgcgBHQhBgJ/IARBDE4EQCAAIAUgBnIiBDsBuC0gACAAKAIUIgVBAWo2AhQgBSAAKAIIaiAEOgAAIAAgACgCFCIEQQFqNgIUIAQgACgCCGogAEG5LWotAAA6AAAgACgCvC0iBUELayEEIAdBECAFa3YMAQsgBEEFaiEEIAUgBnILIQUgACAENgK8LSAIQf3/A2pB//8DcSIHIAR0IQYCfyAEQQ1OBEAgACAFIAZyIgQ7AbgtIAAgACgCFCIFQQFqNgIUIAUgACgCCGogBDoAACAAIAAoAhQiBEEBajYCFCAEIAAoAghqIABBuS1qLQAAOgAAIAAoArwtIgVBDGshBCAHQRAgBWt2DAELIARBBGohBCAFIAZyCyEGIAAgBDYCvC1BACEFIABBuS1qIQ0DQCAAIAYgACAFQZDcAGotAABBAnRqQf4Uai8BACIHIAR0ciIGOwG4LSAAAn8gBEEOTgRAIAAgACgCFCIEQQFqNgIUIAQgACgCCGogBjoAACAAIAAoAhQiBEEBajYCFCAEIAAoAghqIA0tAAA6AAAgACAHQRAgACgCvC0iBGt2IgY7AbgtIARBDWsMAQsgBEEDagsiBDYCvC0gBSAIRyEHIAVBAWohBSAHDQALIAAgAEGUAWoiBCAKEBcgACAAQYgTaiIFIAkQFyAAIAQgBRAWCyAAEBEgAwRAAkACfyAAKAK8LSIEQQlOBEAgACAAKAIUIgRBAWo2AhQgBCAAKAIIaiAALQC4LToAACAAIAAoAhQiBEEBajYCFCAEIAAoAghqIQQgAEG5LWotAAAMAQsgBEEBSA0BIAAgACgCFCIEQQFqNgIUIAQgACgCCGohBCAALQC4LQshBSAEIAU6AAALIABBADYCvC0gAEEAOwG4LQsLsRUBFX8jAEEgayEKIAEoAgAhCSABKAIIIgIoAgAhBSACKAIMIQ0gAEKAgICA0McANwLQKEF/IRACQCANQQBKBEBBACECA0ACQCAJIAJBAnRqIgMvAQAEQCAAIAAoAtAoQQFqIgM2AtAoIAAgA0ECdGpB3BZqIAI2AgAgACACakHYKGpBADoAACACIRAMAQsgA0EAOwECCyACQQFqIgIgDUcNAAsgACgC0CgiBEEBSg0BCwNAIAAgBEEBaiICNgLQKCAAIAJBAnRqQdwWaiAQQQFqIgNBACAQQQJIIgQbIgI2AgAgCSACQQJ0IgdqQQE7AQAgACACakHYKGpBADoAACAAIAAoAqgtQQFrNgKoLSAFBEAgACAAKAKsLSAFIAdqLwECazYCrC0LIAMgECAEGyEQIAAoAtAoIgRBAkgNAAsLIAEgEDYCBCAEQQF2IQgDQCAAIAhBAnRqQdwWaigCACELAkAgCCICQQF0IgMgBEoNACAAIAtqQdgoaiEPIAkgC0ECdGohBiAIIQUDQAJAIAMgBE4EQCADIQIMAQsgCSAAQdwWaiICIANBAXIiBEECdGooAgAiDkECdGovAQAiByAJIAIgA0ECdGooAgAiDEECdGovAQAiAk8EQCACIAdHBEAgAyECDAILIAMhAiAAQdgoaiIDIA5qLQAAIAMgDGotAABLDQELIAQhAgsgBi8BACIEIAkgACACQQJ0akHcFmooAgAiA0ECdGovAQAiB0kEQCAFIQIMAgsCQCAEIAdHDQAgDy0AACAAIANqQdgoai0AAEsNACAFIQIMAgsgACAFQQJ0akHcFmogAzYCACACIQUgAkEBdCIDIAAoAtAoIgRMDQALCyAAIAJBAnRqQdwWaiALNgIAIAhBAk4EQCAIQQFrIQggACgC0CghBAwBCwsgACgC0CghAwNAIA0hCCAAIANBAWsiBDYC0CggACgC4BYhCyAAIAAgA0ECdGpB3BZqKAIAIg02AuAWQQEhAgJAIANBA0gNACAAIA1qQdgoaiEPQQIhAyAJIA1BAnRqIQZBASEFA0ACQCADIAROBEAgAyECDAELIAkgAEHcFmoiAiADQQFyIgRBAnRqKAIAIg5BAnRqLwEAIgcgCSACIANBAnRqKAIAIgxBAnRqLwEAIgJPBEAgAiAHRwRAIAMhAgwCCyADIQIgAEHYKGoiAyAOai0AACADIAxqLQAASw0BCyAEIQILIAYvAQAiBCAJIAAgAkECdGpB3BZqKAIAIgNBAnRqLwEAIgdJBEAgBSECDAILAkAgBCAHRw0AIA8tAAAgACADakHYKGotAABLDQAgBSECDAILIAAgBUECdGpB3BZqIAM2AgAgAiEFIAJBAXQiAyAAKALQKCIETA0ACwtBAiEDIABB3BZqIgYgAkECdGogDTYCACAAIAAoAtQoQQFrIgQ2AtQoIAAoAuAWIQIgBiAEQQJ0aiALNgIAIAAgACgC1ChBAWsiBDYC1CggBiAEQQJ0aiACNgIAIAkgCEECdGoiDiAJIAJBAnRqIgQvAQAgCSALQQJ0aiIFLwEAajsBACAAQdgoaiIMIAhqIg8gAiAMai0AACICIAsgDGotAAAiByACIAdLG0EBajoAACAEIAg7AQIgBSAIOwECIAAgCDYC4BZBASEFQQEhAgJAIAAoAtAoIgRBAkgNAANAAn8gAyADIARODQAaIAkgBiADQQFyIgRBAnRqKAIAIgtBAnRqLwEAIgIgCSAGIANBAnRqKAIAIg1BAnRqLwEAIgdPBEAgAyACIAdHDQEaIAMgCyAMai0AACAMIA1qLQAASw0BGgsgBAshAiAOLwEAIgQgCSAAIAJBAnRqQdwWaigCACIDQQJ0ai8BACIHSQRAIAUhAgwCCwJAIAQgB0cNACAPLQAAIAAgA2pB2ChqLQAASw0AIAUhAgwCCyAAIAVBAnRqQdwWaiADNgIAIAIhBSACQQF0IgMgACgC0CgiBEwNAAsLIAhBAWohDSAAIAJBAnRqQdwWaiAINgIAIAAoAtAoIgNBAUoNAAsgACAAKALUKEEBayICNgLUKCAAQdwWaiIDIAJBAnRqIAAoAuAWNgIAIAEoAgQhByABKAIIIgIoAhAhBiACKAIIIREgAigCBCETIAIoAgAhEiABKAIAIQwgAEHUFmoiAUIANwEAIABBzBZqIhRCADcBACAAQcQWaiIVQgA3AQAgAEG8FmoiFkIANwEAQQAhCCAMIAMgACgC1ChBAnRqKAIAQQJ0akEAOwECAkAgACgC1CgiAkG7BEoNACACQQFqIQJBACEOA0AgDCAAIAJBAnRqQdwWaigCACIEQQJ0Ig1qIgUgDCAFLwECQQJ0ai8BAiIDQQFqIAYgAyAGSBsiDzsBAiADIAZOIQMCQCAEIAdKDQAgACAPQQF0akG8FmoiCyALLwEAQQFqOwEAQQAhCyAEIBFOBEAgEyAEIBFrQQJ0aigCACELCyAAIAAoAqgtIAUvAQAiBCALIA9qbGo2AqgtIBJFDQAgACAAKAKsLSALIA0gEmovAQJqIARsajYCrC0LIAMgDmohDiACQQFqIgJBvQRHDQALIA5FDQAgACAGQQF0akG8FmohDwNAIAYhAgNAIAAgAiIDQQFrIgJBAXRqQbwWaiIELwEAIgVFDQALIAQgBUEBazsBACAAIANBAXRqQbwWaiICIAIvAQBBAmo7AQAgDyAPLwEAQQFrIgI7AQAgDkECSiEDIA5BAmshDiADDQALIAZFDQBBvQQhBQNAIAJB//8DcSEDIAUhAgNAIAMEQCAAIAJBAWsiAkECdGpB3BZqKAIAIgQgB0oNASAMIARBAnRqIgQvAQIiBSAGRwRAIAAgACgCqC0gBC8BACAGIAVrbGo2AqgtIAQgBjsBAgsgA0EBayEDIAIhBQwBCwsgBkEBayIGRQ0BIAAgBkEBdGpBvBZqLwEAIQIMAAsACyAKIBYvAQBBAXQiAjsBAiAKIAIgAEG+FmovAQBqQQF0IgI7AQQgCiACIABBwBZqLwEAakEBdCICOwEGIAogAiAAQcIWai8BAGpBAXQiAjsBCCAKIAIgFS8BAGpBAXQiAjsBCiAKIAIgAEHGFmovAQBqQQF0IgI7AQwgCiACIABByBZqLwEAakEBdCICOwEOIAogAiAAQcoWai8BAGpBAXQiAjsBECAKIAIgFC8BAGpBAXQiAjsBEiAKIAIgAEHOFmovAQBqQQF0IgI7ARQgCiACIABB0BZqLwEAakEBdCICOwEWIAogAiAAQdIWai8BAGpBAXQiAjsBGCAKIAEvAQAgAmpBAXQiAjsBGiAKIABB1hZqLwEAIAJqQQF0IgI7ARwgCiACIABB2BZqLwEAakEBdDsBHiAQQQBOBEADQCAJIAhBAnRqIgcvAQIiBARAIAogBEEBdGoiACAALwEAIgBBAWo7AQAgBEEDcSEDQQAhAiAEQQFrQQNPBEAgBEH8/wNxIQUDQCAAQQN2QQFxIABBAnZBAXEgAEECcSACIABBAXFyQQJ0cnJBAXRyIgRBAXQhAiAAQQR2IQAgBUEEayIFDQALCyADBEADQCACIABBAXFyIgRBAXQhAiAAQQF2IQAgA0EBayIDDQALCyAHIAQ7AQALIAggEEchACAIQQFqIQggAA0ACwsL2QgBCn8CQCAAKAKgLUUEQCAAKAK8LSEDDAELIABBuS1qIQgDQCAEQQFqIQogACgCmC0gBGotAAAhBQJAIAACfyAAKAKkLSAEQQF0ai8BACIHRQRAIAEgBUECdGoiAy8BAiEEIAAgAC8BuC0gAy8BACIFIAAoArwtIgN0ciIHOwG4LUEQIARrIANIBEAgACAAKAIUIgNBAWo2AhQgAyAAKAIIaiAHOgAAIAAgACgCFCIDQQFqNgIUIAMgACgCCGogCC0AADoAACAAIAVBECAAKAK8LSIDa3Y7AbgtIAMgBGpBEGsMAgsgAyAEagwBCyAFQYDNAGotAAAiC0ECdCIJQYAIciABaiIDLwEGIQQgACAALwG4LSADLwEEIgwgACgCvC0iBnRyIgM7AbgtIAACf0EQIARrIAZIBEAgACAAKAIUIgZBAWo2AhQgBiAAKAIIaiADOgAAIAAgACgCFCIDQQFqNgIUIAMgACgCCGogCC0AADoAACAAIAxBECAAKAK8LSIGa3YiAzsBuC0gBCAGakEQawwBCyAEIAZqCyIENgK8LSALQQhrQRNNBEAgACADIAUgCUGw3ABqKAIAa0H//wNxIgYgBHRyIgM7AbgtIAACf0EQIAlBwNkAaigCACIFayAESARAIAAgACgCFCIEQQFqNgIUIAQgACgCCGogAzoAACAAIAAoAhQiBEEBajYCFCAEIAAoAghqIAgtAAA6AAAgACAGQRAgACgCvC0iBGt2IgM7AbgtIAQgBWpBEGsMAQsgBCAFagsiBDYCvC0LIAIgB0EBayIFIAVBB3ZBgAJqIAVBgAJJG0GAyQBqLQAAIgtBAnQiCWoiBi8BAiEHIAAgAyAGLwEAIgwgBHRyIgY7AbgtIAACf0EQIAdrIARIBEAgACAAKAIUIgRBAWo2AhQgBCAAKAIIaiAGOgAAIAAgACgCFCIEQQFqNgIUIAQgACgCCGogCC0AADoAACAAIAxBECAAKAK8LSIEa3YiBjsBuC0gBCAHakEQawwBCyAEIAdqCyIDNgK8LSALQQRJDQEgACAGIAUgCUGw3QBqKAIAa0H//wNxIgUgA3RyIgc7AbgtQRAgCUHA2gBqKAIAIgRrIANIBEAgACAAKAIUIgNBAWo2AhQgAyAAKAIIaiAHOgAAIAAgACgCFCIDQQFqNgIUIAMgACgCCGogCC0AADoAACAAIAVBECAAKAK8LSIDa3Y7AbgtIAMgBGpBEGsMAQsgAyAEagsiAzYCvC0LIAoiBCAAKAKgLUkNAAsLIAFBgghqLwEAIQQgACAALwG4LSABLwGACCIKIAN0ciIFOwG4LUEQIARrIANIBEAgACAAKAIUIgNBAWo2AhQgAyAAKAIIaiAFOgAAIAAgACgCFCIDQQFqNgIUIAMgACgCCGogAEG5LWotAAA6AAAgACAKQRAgACgCvC0iA2t2OwG4LSAAIAMgBGpBEGs2ArwtDwsgACADIARqNgK8LQuXCwEMfyACQQBOBEBBBEEDIAEvAQIiChshBkEHQYoBIAobIQMgAEG5LWohCEF/IQcDQCAKIQkgASALIgxBAWoiC0ECdGovAQIhCgJAAkAgBUEBaiIEIANODQAgCSAKRw0AIAQhBQwBCwJAIAQgBkgEQCAAIAlBAnRqIgVB/BRqIQ0gBUH+FGohDiAAKAK8LSEFA0AgDi8BACEDIAAgAC8BuC0gDS8BACIGIAV0ciIHOwG4LSAAAn9BECADayAFSARAIAAgACgCFCIFQQFqNgIUIAUgACgCCGogBzoAACAAIAAoAhQiBUEBajYCFCAFIAAoAghqIAgtAAA6AAAgACAGQRAgACgCvC0iBWt2OwG4LSADIAVqQRBrDAELIAMgBWoLIgU2ArwtIARBAWsiBA0ACwwBCyAAAn8gCQRAAkAgByAJRgRAIAAoArwtIQMgBCEFDAELIAAgCUECdGoiBEH+FGovAQAhAyAAIAAvAbgtIARB/BRqLwEAIgYgACgCvC0iBHRyIgc7AbgtIAACf0EQIANrIARIBEAgACAAKAIUIgRBAWo2AhQgBCAAKAIIaiAHOgAAIAAgACgCFCIEQQFqNgIUIAQgACgCCGogCC0AADoAACAAIAZBECAAKAK8LSIEa3Y7AbgtIAMgBGpBEGsMAQsgAyAEagsiAzYCvC0LIAAvAbgtIAAvAbwVIgcgA3RyIQQCQEEQIAAvAb4VIgZrIANIBEAgACAEOwG4LSAAIAAoAhQiA0EBajYCFCADIAAoAghqIAQ6AAAgACAAKAIUIgNBAWo2AhQgAyAAKAIIaiAILQAAOgAAIAYgACgCvC0iBGpBEGshAyAHQRAgBGt2IQQMAQsgAyAGaiEDCyAAIAM2ArwtIAAgBCAFQf3/A2pB//8DcSIFIAN0ciIEOwG4LSADQQ9OBEAgACAAKAIUIgNBAWo2AhQgAyAAKAIIaiAEOgAAIAAgACgCFCIDQQFqNgIUIAMgACgCCGogCC0AADoAACAAIAVBECAAKAK8LSIDa3Y7AbgtIANBDmsMAgsgA0ECagwBCyAFQQlMBEAgAC8BuC0gAC8BwBUiByAAKAK8LSIDdHIhBAJAQRAgAC8BwhUiBmsgA0gEQCAAIAQ7AbgtIAAgACgCFCIDQQFqNgIUIAMgACgCCGogBDoAACAAIAAoAhQiA0EBajYCFCADIAAoAghqIAgtAAA6AAAgBiAAKAK8LSIEakEQayEDIAdBECAEa3YhBAwBCyADIAZqIQMLIAAgAzYCvC0gACAEIAVB/v8DakH//wNxIgUgA3RyIgQ7AbgtIANBDk4EQCAAIAAoAhQiA0EBajYCFCADIAAoAghqIAQ6AAAgACAAKAIUIgNBAWo2AhQgAyAAKAIIaiAILQAAOgAAIAAgBUEQIAAoArwtIgNrdjsBuC0gA0ENawwCCyADQQNqDAELIAAvAbgtIAAvAcQVIgcgACgCvC0iA3RyIQQCQEEQIAAvAcYVIgZrIANIBEAgACAEOwG4LSAAIAAoAhQiA0EBajYCFCADIAAoAghqIAQ6AAAgACAAKAIUIgNBAWo2AhQgAyAAKAIIaiAILQAAOgAAIAYgACgCvC0iBGpBEGshAyAHQRAgBGt2IQQMAQsgAyAGaiEDCyAAIAM2ArwtIAAgBCAFQfb/A2pB//8DcSIFIAN0ciIEOwG4LSADQQpOBEAgACAAKAIUIgNBAWo2AhQgAyAAKAIIaiAEOgAAIAAgACgCFCIDQQFqNgIUIAMgACgCCGogCC0AADoAACAAIAVBECAAKAK8LSIDa3Y7AbgtIANBCWsMAQsgA0EHags2ArwtC0EAIQUCfyAKRQRAQYoBIQNBAwwBC0EGQQcgCSAKRiIEGyEDQQNBBCAEGwshBiAJIQcLIAIgDEcNAAsLCwkAIAEgAmwQHAsGACABEB0LXwEBfyMAQUBqIgMkACADQQA2AjAgA0IANwMoIAMgADYCCCADIAI2AhQgAyABNgIMIAMgAUEDbDYCGCADQQhqEAcgA0EIahALIANBCGoQCCADKAIcIQEgA0FAayQAIAELBgBB1N8AC6QuAQx/IwBBEGsiDCQAAkACQAJAAkACQAJAAkACQAJAAkACQAJAIABB9AFNBEBB2N8AKAIAIgZBECAAQQtqQXhxIABBC0kbIgRBA3YiAXYiAEEDcQRAIABBf3NBAXEgAWoiAkEDdCIDQYjgAGooAgAiAUEIaiEAAkAgASgCCCIEIANBgOAAaiIDRgRAQdjfACAGQX4gAndxNgIADAELIAQgAzYCDCADIAQ2AggLIAEgAkEDdCICQQNyNgIEIAEgAmoiASABKAIEQQFyNgIEDA0LIARB4N8AKAIAIghNDQEgAARAAkAgACABdEECIAF0IgBBACAAa3JxIgBBACAAa3FBAWsiACAAQQx2QRBxIgB2IgFBBXZBCHEiAiAAciABIAJ2IgBBAnZBBHEiAXIgACABdiIAQQF2QQJxIgFyIAAgAXYiAEEBdkEBcSIBciAAIAF2aiICQQN0IgNBiOAAaigCACIBKAIIIgAgA0GA4ABqIgNGBEBB2N8AIAZBfiACd3EiBjYCAAwBCyAAIAM2AgwgAyAANgIICyABQQhqIQAgASAEQQNyNgIEIAEgBGoiAyACQQN0IgUgBGsiAkEBcjYCBCABIAVqIAI2AgAgCARAIAhBA3YiBUEDdEGA4ABqIQRB7N8AKAIAIQECfyAGQQEgBXQiBXFFBEBB2N8AIAUgBnI2AgAgBAwBCyAEKAIICyEFIAQgATYCCCAFIAE2AgwgASAENgIMIAEgBTYCCAtB7N8AIAM2AgBB4N8AIAI2AgAMDQtB3N8AKAIAIglFDQEgCUEAIAlrcUEBayIAIABBDHZBEHEiAHYiAUEFdkEIcSICIAByIAEgAnYiAEECdkEEcSIBciAAIAF2IgBBAXZBAnEiAXIgACABdiIAQQF2QQFxIgFyIAAgAXZqQQJ0QYjiAGooAgAiAygCBEF4cSAEayEBIAMhAgNAAkAgAigCECIARQRAIAIoAhQiAEUNAQsgACgCBEF4cSAEayICIAEgASACSyICGyEBIAAgAyACGyEDIAAhAgwBCwsgAyAEaiILIANNDQIgAygCGCEKIAMgAygCDCIFRwRAIAMoAggiAEHo3wAoAgBJGiAAIAU2AgwgBSAANgIIDAwLIANBFGoiAigCACIARQRAIAMoAhAiAEUNBCADQRBqIQILA0AgAiEHIAAiBUEUaiICKAIAIgANACAFQRBqIQIgBSgCECIADQALIAdBADYCAAwLC0F/IQQgAEG/f0sNACAAQQtqIgBBeHEhBEHc3wAoAgAiCEUNAEEfIQcgBEH///8HTQRAIABBCHYiACAAQYD+P2pBEHZBCHEiAHQiASABQYDgH2pBEHZBBHEiAXQiAiACQYCAD2pBEHZBAnEiAnRBD3YgACABciACcmsiAEEBdCAEIABBFWp2QQFxckEcaiEHC0EAIARrIQECQAJAAkAgB0ECdEGI4gBqKAIAIgJFBEBBACEADAELQQAhACAEQQBBGSAHQQF2ayAHQR9GG3QhAwNAAkAgAigCBEF4cSAEayIGIAFPDQAgAiEFIAYiAQ0AQQAhASACIQAMAwsgACACKAIUIgYgBiACIANBHXZBBHFqKAIQIgJGGyAAIAYbIQAgA0EBdCEDIAINAAsLIAAgBXJFBEBBAiAHdCIAQQAgAGtyIAhxIgBFDQMgAEEAIABrcUEBayIAIABBDHZBEHEiAHYiAkEFdkEIcSIDIAByIAIgA3YiAEECdkEEcSICciAAIAJ2IgBBAXZBAnEiAnIgACACdiIAQQF2QQFxIgJyIAAgAnZqQQJ0QYjiAGooAgAhAAsgAEUNAQsDQCAAKAIEQXhxIARrIgYgAUkhAyAGIAEgAxshASAAIAUgAxshBSAAKAIQIgIEfyACBSAAKAIUCyIADQALCyAFRQ0AIAFB4N8AKAIAIARrTw0AIAQgBWoiByAFTQ0BIAUoAhghCSAFIAUoAgwiA0cEQCAFKAIIIgBB6N8AKAIASRogACADNgIMIAMgADYCCAwKCyAFQRRqIgIoAgAiAEUEQCAFKAIQIgBFDQQgBUEQaiECCwNAIAIhBiAAIgNBFGoiAigCACIADQAgA0EQaiECIAMoAhAiAA0ACyAGQQA2AgAMCQsgBEHg3wAoAgAiAE0EQEHs3wAoAgAhAQJAIAAgBGsiAkEQTwRAQeDfACACNgIAQezfACABIARqIgM2AgAgAyACQQFyNgIEIAAgAWogAjYCACABIARBA3I2AgQMAQtB7N8AQQA2AgBB4N8AQQA2AgAgASAAQQNyNgIEIAAgAWoiACAAKAIEQQFyNgIECyABQQhqIQAMCwsgBEHk3wAoAgAiA0kEQEHk3wAgAyAEayIBNgIAQfDfAEHw3wAoAgAiACAEaiICNgIAIAIgAUEBcjYCBCAAIARBA3I2AgQgAEEIaiEADAsLQQAhACAEQS9qIggCf0Gw4wAoAgAEQEG44wAoAgAMAQtBvOMAQn83AgBBtOMAQoCggICAgAQ3AgBBsOMAIAxBDGpBcHFB2KrVqgVzNgIAQcTjAEEANgIAQZTjAEEANgIAQYAgCyIBaiIGQQAgAWsiB3EiBSAETQ0KQZDjACgCACIBBEBBiOMAKAIAIgIgBWoiCSACTQ0LIAEgCUkNCwtBlOMALQAAQQRxDQUCQAJAQfDfACgCACIBBEBBmOMAIQADQCABIAAoAgAiAk8EQCACIAAoAgRqIAFLDQMLIAAoAggiAA0ACwtBABAeIgNBf0YNBiAFIQZBtOMAKAIAIgBBAWsiASADcQRAIAUgA2sgASADakEAIABrcWohBgsgBCAGTw0GIAZB/v///wdLDQZBkOMAKAIAIgAEQEGI4wAoAgAiASAGaiICIAFNDQcgACACSQ0HCyAGEB4iACADRw0BDAgLIAYgA2sgB3EiBkH+////B0sNBSAGEB4iAyAAKAIAIAAoAgRqRg0EIAMhAAsCQCAEQTBqIAZNDQAgAEF/Rg0AQbjjACgCACIBIAggBmtqQQAgAWtxIgFB/v///wdLBEAgACEDDAgLIAEQHkF/RwRAIAEgBmohBiAAIQMMCAtBACAGaxAeGgwFCyAAIQMgAEF/Rw0GDAQLAAtBACEFDAcLQQAhAwwFCyADQX9HDQILQZTjAEGU4wAoAgBBBHI2AgALIAVB/v///wdLDQEgBRAeIgNBABAeIgBPDQEgA0F/Rg0BIABBf0YNASAAIANrIgYgBEEoak0NAQtBiOMAQYjjACgCACAGaiIANgIAQYzjACgCACAASQRAQYzjACAANgIACwJAAkACQEHw3wAoAgAiAQRAQZjjACEAA0AgAyAAKAIAIgIgACgCBCIFakYNAiAAKAIIIgANAAsMAgtB6N8AKAIAIgBBACAAIANNG0UEQEHo3wAgAzYCAAtBACEAQZzjACAGNgIAQZjjACADNgIAQfjfAEF/NgIAQfzfAEGw4wAoAgA2AgBBpOMAQQA2AgADQCAAQQN0IgFBiOAAaiABQYDgAGoiAjYCACABQYzgAGogAjYCACAAQQFqIgBBIEcNAAtB5N8AIAZBKGsiAEF4IANrQQdxQQAgA0EIakEHcRsiAWsiAjYCAEHw3wAgASADaiIBNgIAIAEgAkEBcjYCBCAAIANqQSg2AgRB9N8AQcDjACgCADYCAAwCCyABIANPDQAgASACSQ0AIAAoAgxBCHENACAAIAUgBmo2AgRB8N8AIAFBeCABa0EHcUEAIAFBCGpBB3EbIgBqIgI2AgBB5N8AQeTfACgCACAGaiIDIABrIgA2AgAgAiAAQQFyNgIEIAEgA2pBKDYCBEH03wBBwOMAKAIANgIADAELQejfACgCACADSwRAQejfACADNgIACyADIAZqIQJBmOMAIQACQAJAAkACQAJAAkADQCACIAAoAgBHBEAgACgCCCIADQEMAgsLIAAtAAxBCHFFDQELQZjjACEAA0AgASAAKAIAIgJPBEAgAiAAKAIEaiICIAFLDQMLIAAoAgghAAwACwALIAAgAzYCACAAIAAoAgQgBmo2AgQgA0F4IANrQQdxQQAgA0EIakEHcRtqIgcgBEEDcjYCBCACQXggAmtBB3FBACACQQhqQQdxG2oiBiAHayAEayECIAQgB2ohBCABIAZGBEBB8N8AIAQ2AgBB5N8AQeTfACgCACACaiIANgIAIAQgAEEBcjYCBAwDCyAGQezfACgCAEYEQEHs3wAgBDYCAEHg3wBB4N8AKAIAIAJqIgA2AgAgBCAAQQFyNgIEIAAgBGogADYCAAwDCyAGKAIEIgBBA3FBAUYEQCAAQXhxIQgCQCAAQf8BTQRAIAYoAggiASAAQQN2IgVBA3RBgOAAakYaIAEgBigCDCIARgRAQdjfAEHY3wAoAgBBfiAFd3E2AgAMAgsgASAANgIMIAAgATYCCAwBCyAGKAIYIQkCQCAGIAYoAgwiA0cEQCAGKAIIIgAgAzYCDCADIAA2AggMAQsCQCAGQRRqIgAoAgAiAQ0AIAZBEGoiACgCACIBDQBBACEDDAELA0AgACEFIAEiA0EUaiIAKAIAIgENACADQRBqIQAgAygCECIBDQALIAVBADYCAAsgCUUNAAJAIAYgBigCHCIBQQJ0QYjiAGoiACgCAEYEQCAAIAM2AgAgAw0BQdzfAEHc3wAoAgBBfiABd3E2AgAMAgsgCUEQQRQgCSgCECAGRhtqIAM2AgAgA0UNAQsgAyAJNgIYIAYoAhAiAARAIAMgADYCECAAIAM2AhgLIAYoAhQiAEUNACADIAA2AhQgACADNgIYCyAGIAhqIQYgAiAIaiECCyAGIAYoAgRBfnE2AgQgBCACQQFyNgIEIAIgBGogAjYCACACQf8BTQRAIAJBA3YiAUEDdEGA4ABqIQACf0HY3wAoAgAiAkEBIAF0IgFxRQRAQdjfACABIAJyNgIAIAAMAQsgACgCCAshASAAIAQ2AgggASAENgIMIAQgADYCDCAEIAE2AggMAwtBHyEAIAJB////B00EQCACQQh2IgAgAEGA/j9qQRB2QQhxIgB0IgEgAUGA4B9qQRB2QQRxIgF0IgMgA0GAgA9qQRB2QQJxIgN0QQ92IAAgAXIgA3JrIgBBAXQgAiAAQRVqdkEBcXJBHGohAAsgBCAANgIcIARCADcCECAAQQJ0QYjiAGohAQJAQdzfACgCACIDQQEgAHQiBXFFBEBB3N8AIAMgBXI2AgAgASAENgIAIAQgATYCGAwBCyACQQBBGSAAQQF2ayAAQR9GG3QhACABKAIAIQMDQCADIgEoAgRBeHEgAkYNAyAAQR12IQMgAEEBdCEAIAEgA0EEcWpBEGoiBSgCACIDDQALIAUgBDYCACAEIAE2AhgLIAQgBDYCDCAEIAQ2AggMAgtB5N8AIAZBKGsiAEF4IANrQQdxQQAgA0EIakEHcRsiBWsiBzYCAEHw3wAgAyAFaiIFNgIAIAUgB0EBcjYCBCAAIANqQSg2AgRB9N8AQcDjACgCADYCACABIAJBJyACa0EHcUEAIAJBJ2tBB3EbakEvayIAIAAgAUEQakkbIgVBGzYCBCAFQaDjACkCADcCECAFQZjjACkCADcCCEGg4wAgBUEIajYCAEGc4wAgBjYCAEGY4wAgAzYCAEGk4wBBADYCACAFQRhqIQADQCAAQQc2AgQgAEEIaiEDIABBBGohACACIANLDQALIAEgBUYNAyAFIAUoAgRBfnE2AgQgASAFIAFrIgZBAXI2AgQgBSAGNgIAIAZB/wFNBEAgBkEDdiICQQN0QYDgAGohAAJ/QdjfACgCACIDQQEgAnQiAnFFBEBB2N8AIAIgA3I2AgAgAAwBCyAAKAIICyECIAAgATYCCCACIAE2AgwgASAANgIMIAEgAjYCCAwEC0EfIQAgAUIANwIQIAZB////B00EQCAGQQh2IgAgAEGA/j9qQRB2QQhxIgB0IgIgAkGA4B9qQRB2QQRxIgJ0IgMgA0GAgA9qQRB2QQJxIgN0QQ92IAAgAnIgA3JrIgBBAXQgBiAAQRVqdkEBcXJBHGohAAsgASAANgIcIABBAnRBiOIAaiECAkBB3N8AKAIAIgNBASAAdCIFcUUEQEHc3wAgAyAFcjYCACACIAE2AgAgASACNgIYDAELIAZBAEEZIABBAXZrIABBH0YbdCEAIAIoAgAhAwNAIAMiAigCBEF4cSAGRg0EIABBHXYhAyAAQQF0IQAgAiADQQRxakEQaiIFKAIAIgMNAAsgBSABNgIAIAEgAjYCGAsgASABNgIMIAEgATYCCAwDCyABKAIIIgAgBDYCDCABIAQ2AgggBEEANgIYIAQgATYCDCAEIAA2AggLIAdBCGohAAwFCyACKAIIIgAgATYCDCACIAE2AgggAUEANgIYIAEgAjYCDCABIAA2AggLQeTfACgCACIAIARNDQBB5N8AIAAgBGsiATYCAEHw3wBB8N8AKAIAIgAgBGoiAjYCACACIAFBAXI2AgQgACAEQQNyNgIEIABBCGohAAwDC0HU3wBBMDYCAEEAIQAMAgsCQCAJRQ0AAkAgBSgCHCICQQJ0QYjiAGoiACgCACAFRgRAIAAgAzYCACADDQFB3N8AIAhBfiACd3EiCDYCAAwCCyAJQRBBFCAJKAIQIAVGG2ogAzYCACADRQ0BCyADIAk2AhggBSgCECIABEAgAyAANgIQIAAgAzYCGAsgBSgCFCIARQ0AIAMgADYCFCAAIAM2AhgLAkAgAUEPTQRAIAUgASAEaiIAQQNyNgIEIAAgBWoiACAAKAIEQQFyNgIEDAELIAUgBEEDcjYCBCAHIAFBAXI2AgQgASAHaiABNgIAIAFB/wFNBEAgAUEDdiIBQQN0QYDgAGohAAJ/QdjfACgCACICQQEgAXQiAXFFBEBB2N8AIAEgAnI2AgAgAAwBCyAAKAIICyEBIAAgBzYCCCABIAc2AgwgByAANgIMIAcgATYCCAwBC0EfIQAgAUH///8HTQRAIAFBCHYiACAAQYD+P2pBEHZBCHEiAHQiAiACQYDgH2pBEHZBBHEiAnQiBCAEQYCAD2pBEHZBAnEiBHRBD3YgACACciAEcmsiAEEBdCABIABBFWp2QQFxckEcaiEACyAHIAA2AhwgB0IANwIQIABBAnRBiOIAaiECAkACQCAIQQEgAHQiBHFFBEBB3N8AIAQgCHI2AgAgAiAHNgIAIAcgAjYCGAwBCyABQQBBGSAAQQF2ayAAQR9GG3QhACACKAIAIQQDQCAEIgIoAgRBeHEgAUYNAiAAQR12IQQgAEEBdCEAIAIgBEEEcWpBEGoiAygCACIEDQALIAMgBzYCACAHIAI2AhgLIAcgBzYCDCAHIAc2AggMAQsgAigCCCIAIAc2AgwgAiAHNgIIIAdBADYCGCAHIAI2AgwgByAANgIICyAFQQhqIQAMAQsCQCAKRQ0AAkAgAygCHCICQQJ0QYjiAGoiACgCACADRgRAIAAgBTYCACAFDQFB3N8AIAlBfiACd3E2AgAMAgsgCkEQQRQgCigCECADRhtqIAU2AgAgBUUNAQsgBSAKNgIYIAMoAhAiAARAIAUgADYCECAAIAU2AhgLIAMoAhQiAEUNACAFIAA2AhQgACAFNgIYCwJAIAFBD00EQCADIAEgBGoiAEEDcjYCBCAAIANqIgAgACgCBEEBcjYCBAwBCyADIARBA3I2AgQgCyABQQFyNgIEIAEgC2ogATYCACAIBEAgCEEDdiIEQQN0QYDgAGohAkHs3wAoAgAhAAJ/QQEgBHQiBCAGcUUEQEHY3wAgBCAGcjYCACACDAELIAIoAggLIQQgAiAANgIIIAQgADYCDCAAIAI2AgwgACAENgIIC0Hs3wAgCzYCAEHg3wAgATYCAAsgA0EIaiEACyAMQRBqJAAgAAvMDAEHfwJAIABFDQAgAEEIayICIABBBGsoAgAiAUF4cSIAaiEFAkAgAUEBcQ0AIAFBA3FFDQEgAiACKAIAIgFrIgJB6N8AKAIASQ0BIAAgAWohACACQezfACgCAEcEQCABQf8BTQRAIAIoAggiBCABQQN2IgdBA3RBgOAAakYaIAQgAigCDCIBRgRAQdjfAEHY3wAoAgBBfiAHd3E2AgAMAwsgBCABNgIMIAEgBDYCCAwCCyACKAIYIQYCQCACIAIoAgwiA0cEQCACKAIIIgEgAzYCDCADIAE2AggMAQsCQCACQRRqIgEoAgAiBA0AIAJBEGoiASgCACIEDQBBACEDDAELA0AgASEHIAQiA0EUaiIBKAIAIgQNACADQRBqIQEgAygCECIEDQALIAdBADYCAAsgBkUNAQJAIAIgAigCHCIEQQJ0QYjiAGoiASgCAEYEQCABIAM2AgAgAw0BQdzfAEHc3wAoAgBBfiAEd3E2AgAMAwsgBkEQQRQgBigCECACRhtqIAM2AgAgA0UNAgsgAyAGNgIYIAIoAhAiAQRAIAMgATYCECABIAM2AhgLIAIoAhQiAUUNASADIAE2AhQgASADNgIYDAELIAUoAgQiAUEDcUEDRw0AQeDfACAANgIAIAUgAUF+cTYCBCACIABBAXI2AgQgACACaiAANgIADwsgAiAFTw0AIAUoAgQiAUEBcUUNAAJAIAFBAnFFBEAgBUHw3wAoAgBGBEBB8N8AIAI2AgBB5N8AQeTfACgCACAAaiIANgIAIAIgAEEBcjYCBCACQezfACgCAEcNA0Hg3wBBADYCAEHs3wBBADYCAA8LIAVB7N8AKAIARgRAQezfACACNgIAQeDfAEHg3wAoAgAgAGoiADYCACACIABBAXI2AgQgACACaiAANgIADwsgAUF4cSAAaiEAAkAgAUH/AU0EQCAFKAIIIgQgAUEDdiIHQQN0QYDgAGpGGiAEIAUoAgwiAUYEQEHY3wBB2N8AKAIAQX4gB3dxNgIADAILIAQgATYCDCABIAQ2AggMAQsgBSgCGCEGAkAgBSAFKAIMIgNHBEAgBSgCCCIBQejfACgCAEkaIAEgAzYCDCADIAE2AggMAQsCQCAFQRRqIgEoAgAiBA0AIAVBEGoiASgCACIEDQBBACEDDAELA0AgASEHIAQiA0EUaiIBKAIAIgQNACADQRBqIQEgAygCECIEDQALIAdBADYCAAsgBkUNAAJAIAUgBSgCHCIEQQJ0QYjiAGoiASgCAEYEQCABIAM2AgAgAw0BQdzfAEHc3wAoAgBBfiAEd3E2AgAMAgsgBkEQQRQgBigCECAFRhtqIAM2AgAgA0UNAQsgAyAGNgIYIAUoAhAiAQRAIAMgATYCECABIAM2AhgLIAUoAhQiAUUNACADIAE2AhQgASADNgIYCyACIABBAXI2AgQgACACaiAANgIAIAJB7N8AKAIARw0BQeDfACAANgIADwsgBSABQX5xNgIEIAIgAEEBcjYCBCAAIAJqIAA2AgALIABB/wFNBEAgAEEDdiIBQQN0QYDgAGohAAJ/QdjfACgCACIEQQEgAXQiAXFFBEBB2N8AIAEgBHI2AgAgAAwBCyAAKAIICyEBIAAgAjYCCCABIAI2AgwgAiAANgIMIAIgATYCCA8LQR8hASACQgA3AhAgAEH///8HTQRAIABBCHYiASABQYD+P2pBEHZBCHEiAXQiBCAEQYDgH2pBEHZBBHEiBHQiAyADQYCAD2pBEHZBAnEiA3RBD3YgASAEciADcmsiAUEBdCAAIAFBFWp2QQFxckEcaiEBCyACIAE2AhwgAUECdEGI4gBqIQQCQAJAAkBB3N8AKAIAIgNBASABdCIFcUUEQEHc3wAgAyAFcjYCACAEIAI2AgAgAiAENgIYDAELIABBAEEZIAFBAXZrIAFBH0YbdCEBIAQoAgAhAwNAIAMiBCgCBEF4cSAARg0CIAFBHXYhAyABQQF0IQEgBCADQQRxakEQaiIFKAIAIgMNAAsgBSACNgIAIAIgBDYCGAsgAiACNgIMIAIgAjYCCAwBCyAEKAIIIgAgAjYCDCAEIAI2AgggAkEANgIYIAIgBDYCDCACIAA2AggLQfjfAEH43wAoAgBBAWsiAkF/IAIbNgIACwtVAQJ/QdDfACgCACIBIABBA2pBfHEiAmohAAJAIAJBAU5BACAAIAFNGw0APwBBEHQgAEkEQCAAEABFDQELQdDfACAANgIAIAEPC0HU3wBBMDYCAEF/C4IEAQN/IAJBgARPBEAgACABIAIQARogAA8LIAAgAmohAwJAIAAgAXNBA3FFBEACQCACQQFIBEAgACECDAELIABBA3FFBEAgACECDAELIAAhAgNAIAIgAS0AADoAACABQQFqIQEgAkEBaiICIANPDQEgAkEDcQ0ACwsCQCADQXxxIgRBwABJDQAgAiAEQUBqIgVLDQADQCACIAEoAgA2AgAgAiABKAIENgIEIAIgASgCCDYCCCACIAEoAgw2AgwgAiABKAIQNgIQIAIgASgCFDYCFCACIAEoAhg2AhggAiABKAIcNgIcIAIgASgCIDYCICACIAEoAiQ2AiQgAiABKAIoNgIoIAIgASgCLDYCLCACIAEoAjA2AjAgAiABKAI0NgI0IAIgASgCODYCOCACIAEoAjw2AjwgAUFAayEBIAJBQGsiAiAFTQ0ACwsgAiAETw0BA0AgAiABKAIANgIAIAFBBGohASACQQRqIgIgBEkNAAsMAQsgA0EESQRAIAAhAgwBCyAAIANBBGsiBEsEQCAAIQIMAQsgACECA0AgAiABLQAAOgAAIAIgAS0AAToAASACIAEtAAI6AAIgAiABLQADOgADIAFBBGohASACQQRqIgIgBE0NAAsLIAIgA0kEQANAIAIgAS0AADoAACABQQFqIQEgAkEBaiICIANHDQALCyAAC9YCAQJ/AkAgAUUNACAAIAFqIgJBAWtBADoAACAAQQA6AAAgAUEDSQ0AIAJBAmtBADoAACAAQQA6AAEgAkEDa0EAOgAAIABBADoAAiABQQdJDQAgAkEEa0EAOgAAIABBADoAAyABQQlJDQAgAEEAIABrQQNxIgNqIgJBADYCACACIAEgA2tBfHEiA2oiAUEEa0EANgIAIANBCUkNACACQQA2AgggAkEANgIEIAFBCGtBADYCACABQQxrQQA2AgAgA0EZSQ0AIAJBADYCGCACQQA2AhQgAkEANgIQIAJBADYCDCABQRBrQQA2AgAgAUEUa0EANgIAIAFBGGtBADYCACABQRxrQQA2AgAgAyACQQRxQRhyIgNrIgFBIEkNACACIANqIQIDQCACQgA3AxggAkIANwMQIAJCADcDCCACQgA3AwAgAkEgaiECIAFBIGsiAUEfSw0ACwsLBAAjAAsGACAAJAALEAAjACAAa0FwcSIAJAAgAAsLvVYIAEGECAvxQJYwB3csYQ7uulEJmRnEbQeP9GpwNaVj6aOVZJ4yiNsOpLjceR7p1eCI2dKXK0y2Cb18sX4HLbjnkR2/kGQQtx3yILBqSHG5895BvoR91Noa6+TdbVG11PTHhdODVphsE8Coa2R6+WL97Mllik9cARTZbAZjYz0P+vUNCI3IIG47XhBpTORBYNVycWei0eQDPEfUBEv9hQ3Sa7UKpfqotTVsmLJC1sm720D5vKzjbNgydVzfRc8N1txZPdGrrDDZJjoA3lGAUdfIFmHQv7X0tCEjxLNWmZW6zw+lvbieuAIoCIgFX7LZDMYk6Quxh3xvLxFMaFirHWHBPS1mtpBB3HYGcdsBvCDSmCoQ1e+JhbFxH7W2BqXkv58z1LjooskHeDT5AA+OqAmWGJgO4bsNan8tPW0Il2xkkQFcY+b0UWtrYmFsHNgwZYVOAGLy7ZUGbHulARvB9AiCV8QP9cbZsGVQ6bcS6ri+i3yIufzfHd1iSS3aFfN804xlTNT7WGGyTc5RtTp0ALyj4jC71EGl30rXldg9bcTRpPv01tNq6WlD/NluNEaIZ63QuGDacy0EROUdAzNfTAqqyXwN3TxxBVCqQQInEBALvoYgDMkltWhXs4VvIAnUZrmf5GHODvneXpjJ2SkimNCwtKjXxxc9s1mBDbQuO1y9t61susAgg7jttrO/mgzitgOa0rF0OUfV6q930p0VJtsEgxbccxILY+OEO2SUPmptDahaanoLzw7knf8JkyeuAAqxngd9RJMP8NKjCIdo8gEe/sIGaV1XYvfLZ2WAcTZsGecGa252G9T+4CvTiVp62hDMSt1nb9+5+fnvvo5DvrcX1Y6wYOij1tZ+k9GhxMLYOFLy30/xZ7vRZ1e8pt0GtT9LNrJI2isN2EwbCq/2SgM2YHoEQcPvYN9V32eo745uMXm+aUaMs2HLGoNmvKDSbyU24mhSlXcMzANHC7u5FgIiLyYFVb47usUoC72yklq0KwRqs1yn/9fCMc/QtYue2Swdrt5bsMJkmybyY+yco2p1CpNtAqkGCZw/Ng7rhWcHchNXAAWCSr+VFHq44q4rsXs4G7YMm47Skg2+1eW379x8Id/bC9TS04ZC4tTx+LPdaG6D2h/NFr6BWya59uF3sG93R7cY5loIiHBqD//KOwZmXAsBEf+eZY9prmL40/9rYUXPbBZ44gqg7tIN11SDBE7CswM5YSZnp/cWYNBNR2lJ23duPkpq0a7cWtbZZgvfQPA72DdTrrypxZ673n/Pskfp/7UwHPK9vYrCusowk7NTpqO0JAU20LqTBtfNKVfeVL9n2SMuemazuEphxAIbaF2UK28qN74LtKGODMMb3wVaje8CLQAAAABBMRsZgmI2MsNTLSsExWxkRfR3fYanWlbHlkFPCIrZyEm7wtGK6O/6y9n04wxPtaxNfq61ji2Dns8cmIdREsJKECPZU9Nw9HiSQe9hVdeuLhTmtTfXtZgcloSDBVmYG4IYqQCb2/otsJrLNqldXXfmHGxs/98/QdSeDlrNoiSEleMVn4wgRrKnYXepvqbh6PHn0PPoJIPew2Wyxdqqrl1d659GRCjMa29p/XB2rmsxOe9aKiAsCQcLbTgcEvM2Rt+yB13GcVRw7TBla/T38yq7tsIxonWRHIk0oAeQ+7yfF7qNhA553qklOO+yPP9583O+SOhqfRvFQTwq3lgFT3nwRH5i6YctT8LGHFTbAYoVlEC7Do2D6COmwtk4vw3FoDhM9Lshj6eWCs6WjRMJAMxcSDHXRYti+m7KU+F3VF27uhVsoKPWP42Ilw6WkVCY194RqczH0vrh7JPL+vVc12JyHeZ5a961VECfhE9ZWBIOFhkjFQ/acDgkm0EjPadr/WXmWuZ8JQnLV2Q40E6jrpEB4p+KGCHMpzNg/bwqr+Ekre7QP7QtgxKfbLIJhqskSMnqFVPQKUZ++2h3ZeL2eT8vt0gkNnQbCR01KhIE8rxTS7ONSFJw3mV5Me9+YP7z5ue/wv3+fJHQ1T2gy8z6NoqDuweRmnhUvLE5ZaeoS5iDOwqpmCLJ+rUJiMuuEE9d718ObPRGzT/ZbYwOwnRDElrzAiNB6sFwbMGAQXfYR9c2lwbmLY7FtQClhIQbvBqKQXFbu1pomOh3Q9nZbFoeTy0VX342DJwtGyfdHAA+EgCYuVMxg6CQYq6L0VO1khbF9N1X9O/ElKfC79WW2fbpvAeuqI0ct2veMZwq7yqF7XlryqxIcNNvG134LipG4eE23magB8V/Y1ToVCJl803l87ICpMKpG2eRhDAmoJ8puK7F5Pmf3v06zPPWe/3oz7xrqYD9WrKZPgmfsn84hKuwJBws8RUHNTJGKh5zdzEHtOFwSPXQa1E2g0Z6d7JdY07X+ssP5uHSzLXM+Y2E1+BKEpavCyONtshwoJ2JQbuERl0jAwdsOBrEPxUxhQ4OKEKYT2cDqVR+wPp5VYHLYkwfxTiBXvQjmJ2nDrPclhWqGwBU5VoxT/yZYmLX2FN5zhdP4UlWfvpQlS3Xe9QczGITio0tUruWNJHoux/Q2aAG7PN+Xq3CZUdukUhsL6BTdeg2EjqpBwkjalQkCCtlPxHkeaeWpUi8j2YbkaQnKoq94LzL8qGN0Oti3v3AI+/m2b3hvBT80KcNP4OKJn6ykT+5JNBw+BXLaTtG5kJ6d/1btWtl3PRafsU3CVPudjhI97GuCbjwnxKhM8w/inL9JJMAAAAAN2rCAW7UhANZvkYC3KgJB+vCywayfI0EhRZPBbhREw6PO9EP1oWXDeHvVQxk+RoJU5PYCAotngo9R1wLcKMmHEfJ5B0ed6IfKR1gHqwLLxubYe0awt+rGPW1aRnI8jUS/5j3E6YmsRGRTHMQFFo8FSMw/hR6jrgWTeR6F+BGTTjXLI85jpLJO7n4Czo87kQ/C4SGPlI6wDxlUAI9WBdeNm99nDc2w9o1AakYNIS/VzGz1ZUw6mvTMt0BETOQ5Wskp4+pJf4x7yfJWy0mTE1iI3snoCIimeYgFfMkISi0eCof3rorRmD8KXEKPij0HHEtw3azLJrI9S6tojcvwI2acPfnWHGuWR5zmTPcchwlk3crT1F2cvEXdEWb1XV43Il+T7ZLfxYIDX0hYs98pHSAeZMeQnjKoAR6/crGe7AuvGyHRH5t3vo4b+mQ+m5shrVrW+x3agJSMWg1OPNpCH+vYj8VbWNmqythUcHpYNTXpmXjvWRkugMiZo1p4Gcgy9dIF6EVSU4fU0t5dZFK/GPeT8sJHE6St1pMpd2YTZiaxEav8AZH9k5ARcEkgkREMs1Bc1gPQCrmSUIdjItDUGjxVGcCM1U+vHVXCda3VozA+FO7qjpS4hR8UNV+vlHoOeJa31MgW4btZlmxh6RYNJHrXQP7KVxaRW9ebS+tX4AbNeG3cffg7s+x4tmlc+Ncszzma9n+5zJnuOUFDXrkOEom7w8g5O5WnqLsYfRg7eTiL+jTiO3pijar671caerwuBP9x9LR/J5sl/6pBlX/LBAa+ht62PtCxJ75da5c+EjpAPN/g8LyJj2E8BFXRvGUQQn0oyvL9fqVjffN/0/2YF142Vc3utgOifzaOeM+27z1cd6Ln7Pf0iH13eVLN9zYDGvX72ap1rbY79SBsi3VBKRi0DPOoNFqcObTXRok0hD+XsUnlJzEfiraxklAGMfMVlfC+zyVw6KC08GV6BHAqK9Ny5/Fj8rGe8nI8RELyXQHRMxDbYbNGtPAzy25As5Alq+Rd/xtkC5CK5IZKOmTnD6mlqtUZJfy6iKVxYDglPjHvJ/PrX6elhM4nKF5+p0kb7WYEwV3mUq7MZt90fOaMDWJjQdfS4xe4Q2OaYvPj+ydgIrb90KLgkkEibUjxoiIZJqDvw5YguawHoDR2tyBVMyThGOmUYU6GBeHDXLVhqDQ4qmXuiCozgRmqvlupKt8eOuuSxIprxKsb60lxq2sGIHxpy/rM6Z2VXWkQT+3pcQp+KDzQzqhqv18o52XvqLQc8S15xkGtL6nQLaJzYK3DNvNsjuxD7NiD0mxVWWLsGgi17tfSBW6BvZTuDGckbm0it68g+AcvdpeWr/tNJi+AAAAAGVnvLiLyAmq7q+1EleXYo8y8N433F9rJbk4153vKLTFik8IfWTgvW8BhwHXuL/WSt3YavIzd9/gVhBjWJ9XGVD6MKXoFJ8Q+nH4rELIwHvfrafHZ0MIcnUmb87NcH+tlRUYES37t6Q/ntAYhyfozxpCj3OirCDGsMlHegg+rzKgW8iOGLVnOwrQAIeyaThQLwxf7Jfi8FmFh5flPdGHhmW04DrdWk+Pzz8oM3eGEOTq43dYUg3Y7UBov1H4ofgr8MSfl0gqMCJaT1ee4vZvSX+TCPXHfadA1RjA/G1O0J81K7cjjcUYlp+gfyonGUf9unwgQQKSj/QQ9+hIqD1YFJtYP6gjtpAdMdP3oYlqz3YUD6jKrOEHf76EYMMG0nCgXrcXHOZZuKn0PN8VTIXnwtHggH5pDi/Le2tId8OiDw3Lx2ixcynHBGFMoLjZ9ZhvRJD/0/x+UGbuGzfaVk0nuQ4oQAW2xu+wpKOIDBwasNuBf9dnOZF40iv0H26TA/cmO2aQmoOIPy+R7ViTKVRgRLQxB/gM36hNHrrP8abs35L+ibguRmcXm1QCcCfsu0jwcd4vTMkwgPnbVedFY5ygP2v5x4PTF2g2wXIPinnLN13krlDhXED/VE4lmOj2c4iLrhbvNxb4QIIEnSc+vCQf6SFBeFWZr9fgi8qwXDM7tlntXtHlVbB+UEfVGez/bCE7YglGh9rn6TLIgo6OcNSe7Six+VGQX1bkgjoxWDqDCY+n5m4zHwjBhg1tpjq1pOFAvcGG/AUvKUkXSk71r/N2IjKWEZ6KeL4rmB3ZlyBLyfR4Lq5IwMAB/dKlZkFqHF6W93k5Kk+Xlp9d8vEj5QUZa01gftf1jtFi5+u23l9SjgnCN+m1etlGAGi8IbzQ6jHfiI9WYzBh+dYiBJ5qmr2mvQfYwQG/Nm60rVMJCBWaTnId/ynOpRGGe7d04ccPzdkQkqi+rCpGERk4I3algHVmxtgQAXpg/q7PcpvJc8oi8aRXR5YY76k5rf3MXhFFBu5NdmOJ8c6NJkTc6EH4ZFF5L/k0HpNB2rEmU7/WmuvpxvmzjKFFC2IO8BkHaUyhvlGbPNs2J4Q1mZKWUP4uLpm5VCb83uieEnFdjHcW4TTOLjapq0mKEUXmPwMggYO7dpHg4xP2XFv9WelJmD5V8SEGgmxEYT7Uqs6Lxs+pN344QX/WXSbDbrOJdnzW7srEb9YdWQqxoeHkHhTzgXmoS9dpyxOyDnerXKHCuTnGfgGA/qmc5ZkVJAs2oDZuURyOpxZmhsJx2j4s3m8sSbnTlPCBBAmV5rixe0kNox4usRtIPtJDLVlu+8P22+mmkWdRH6mwzHrODHSUYblm8QYF3gAAAAB3BzCW7g5hLJkJUboHbcQZcGr0j+ljpTWeZJWjDtuIMnncuKTg1ekel9LZiAm2TCt+sXy957gtB5C/HZEdtxBkarAg8vO5cUiEvkHeGtrUfW3d5Ov01LVRg9OFxxNsmFZka6jA/WL5eoplyewUAVxPYwZs2foPPWONCA31O24gyExpEF7VYEHkomdxcjwD5NFLBNRH0g2F/aUKtWs1taj6QrKYbNu7ydasvPlAMths40XfXHXc1g3Pq9E9WSbZMKxR3gA6yNdRgL/QYRYhtPS1VrPEI8+6lZm4vaUPKAK4nl8FiAjGDNmysQvpJC9vfIdYaEwRwWEdq7ZmLT123EGQAdtxBpjSILzv1RAqcbGFiQa2tR+fv+Sl6LjUM3gHyaIPAPk0lgmojuEOmBh/ag27CG09LZFkbJfmY1wBa2tR9BxsYWKFZTDY8mIATmwGle0bAaV7ggj0wfUPxFdlsNnGErfpUIu+uOr8uYh8Yt0d3xXaLUmM03zz+9RMZU2yYVg6tVHOo7wAdNS7MOJK36VBPdiV16TRxG3T1vT7Q2npajRu2fytZ4hG2mC40EQELXMzAx3lqgpMX90NfMlQBXE8JwJBqr4LEBDJDCCGV2i1JSBvhbO5ZtQJzmHkn17e+Q4p2cmYsNCYIsfXqLRZsz0XLrQNgbe9XDvAumyt7biDIJq/s7YDtuIMdLHSmurVRzmd0nevBNsmFXPcFoPjYwsSlGQ7hA1taj56alqo5A7PC5MJ/50KAK4nfQeesfAPk0SHCKPSHgHyaGkGwv73YlddgGVnyxlsNnFuawbn/tQbdonTK+AQ2npaZ91KzPm532+Ovu/5F7e+Q2CwjtXW1qPoodGTfjjYwsRP3/JS0btn8aa8V2c/tQbdSLI2S9gNK9qvChtMNgNK9kEEemDfYO/DqGffVTFuju9Gab55y2GzjLxmgxolb9KgUmjiNswMd5W7C0cDIgIWuVUFJi/Fuju+sr0LKCu0WpJcs2oEwtf/p7XQzzEs2Z6LW96uHZtkwrDsY/ImdWqjnAJtkwqcCQap6w42P3IHZ4UFAFcTlb9KguK4ehR7sSuuDLYbOJLSjpvl1b4NfNzvtwvb3yGG09LU8dTiQmjds/gf2oNugb4Wzfa5JltvsHfhGLdHd4gIWub/D2pwZgY7yhEBC1yPZZ7/+GKuaWFr/9MWbM9FoArieNcN0u5OBINUOQOzwqdnJmHQYBb3SWlHTT5ud9uu0WpK2dZa3EDfC2Y32DvwqbyuU967nsVHss9/MLX/6b298hzKusKKU7OTMCS0o6a60DYFzdcGk1TeVykj2We/s2Z6LsRhSrhdaBsCKm8rlLQLvjfDDI6hWgXfGy0C740AAAAAGRsxQTI2YoIrLVPDZGzFBH139EVWWqeGT0GWx8jZigjRwrtJ+u/oiuP02custU8Mta5+TZ6DLY6HmBzPSsISUVPZIxB49HDTYe9Bki6u11U3teYUHJi11wWDhJaCG5hZmwCpGLAt+tupNsua5nddXf9sbBzUQT/fzVoOnpWEJKKMnxXjp7JGIL6pd2Hx6OGm6PPQ58PegyTaxbJlXV2uqkRGn+tva8wodnD9aTkxa64gKlrvCwcJLBIcOG3fRjbzxl0Hsu1wVHH0a2Uwuyrz96IxwraJHJF1kAegNBefvPsOhI26JaneeTyy7zhz83n/auhIvkHFG31Y3io88HlPBelifkTCTy2H21QcxpQVigGNDrtApiPog7842cI4oMUNIbv0TAqWp48TjZbOXMwACUXXMUhu+mKLd+FTyrq7XVSjoGwViI0/1pGWDpfe15hQx8ypEezh+tL1+suTcmLXXGt55h1AVLXeWU+EnxYOElgPFSMZJDhw2j0jQZtl/WunfOZa5lfLCSVO0DhkAZGuoxiKn+Izp8whKrz9YK0k4a+0P9DunxKDLYYJsmzJSCSr0FMV6vt+RiniZXdoLz959jYkSLcdCRt0BBIqNUtTvPJSSI2zeWXecGB+7zHn5vP+/v3Cv9XQkXzMy6A9g4o2+pqRB7uxvFR4qKdlOTuDmEsimKkKCbX6yRCuy4hf711PRvRsDm3ZP810wg6M81oSQ+pBIwLBbHDB2HdBgJc210eOLeYGpQC1xbwbhIRxQYoaaFq7W0N36JhabNnZFS1PHgw2fl8nGy2cPgAc3bmYABKggzFTi65ikJK1U9Hd9MUWxO/0V+/Cp5T22ZbVrge86bccjaicMd5rhSrvKspree3TcEis+F0bb+FGKi5m3jbhf8UHoFToVGNN82UiArLz5RupwqQwhJFnKZ+gJuTFrrj93p/51vPMOs/o/XuAqWu8mbJa/bKfCT6rhDh/LBwksDUHFfEeKkYyBzF3c0hw4bRRa9D1ekaDNmNdsnfL+tdO0uHmD/nMtczg14SNr5YSSraNIwudoHDIhLtBiQMjXUYaOGwHMRU/xCgODoVnT5hCflSpA1V5+sBMYsuBgTjFH5gj9F6zDqedqhWW3OVUABv8TzFa12Jimc55U9hJ4U8XUPp+VnvXLZVizBzULY2KEzSWu1Ifu+iRBqDZ0F5+8+xHZcKtbEiRbnVToC86EjboIwkHqQgkVGoRP2Urlqd55I+8SKWkkRtmvYoqJ/LLvODr0I2hwP3eYtnm7yMUvOG9DafQ/CaKgz8/kbJ+cNAkuWnLFfhC5kY7W/13etxla7XFflr07lMJN/dIOHa4Ca6xoRKf8Io/zDOTJP1yAAAAAAHCajcDhNRuAka+WQcJqNwGy8LrBI18sgVPFoUOE1G4D9E7jw2XhdYMVe/hCRr5ZAjYk1MKni0KC1xHPRwmo3Ad5MlHH6J3Hh5gHSkbLwusGu1hmxir38IZabX1EjXyyBP3mP8RsSamEHNMkRU8WhQU/jAjFriOehd65E04TUbgOY8s1zvJko46C/i5P0TuPD6GhAs8wDpSPQJQZTZeF1g3nH1vNdrDNjQYqQExV7+EMJXVszLTa+ozEQHdJGvlkCWpj6cn7zH+Ji1bySNiTUwioCd7IOaZIiEk8xUqeLQoK7reHyn8YEYoPgpxLXEc9CyzdsMu9ciaLzeirXCajcBxWOf3cx5ZrnLcM5l3kyUcdlFPK3QX8XJ11ZtFfonceH9Ltk99DQgWfM9iIXmAdKR4Qh6TegSgynvGyv1svC6wbX5Eh284+t5u+pDpa7WGbGp37FtoMVICafM4NWKvfwhjbRU/YSurZmDpwVFlptfUZGS942YiA7pn4GmNSNfLIEkVoRdLUx9OSpF1eU/eY/xOHAnLTFq3kk2Y3aVGxJqYRwbwr0VATvZEgiTBQc0yREAPWHNCSeYqQ4uMHVTxaFBVMwJnV3W8Pla31glT+MCMUjqqu1B8FOJRvn7VWuI56FsgU99ZZu2GWKSHsV3rkTRcKfsDXm9FWl+tL23hNRuA4Pdxt+Kxz+7jc6XZ5jyzXOf+2WvluGcy5HoNBe8mSjju5CAP7KKeVu1g9GHoL+Lk6e2I0+urNorqaVy9/RO48PzR0sf+l2ye/1UGqfoaECz72Hob+Z7EQvhcrnXzAOlI8sKDf/CEPSbxRlcR9AlBlPXLK6P3jZX69k//zdl4XWDYujdX2vyJDts+4znecfW837Ofi931IdLcN0vl12sM2NapZu/U79i21S2ygdBipATRoM4z0+ZwatIkGl3FXv4QxJyUJ8baKn7HGEBJwldWzMOVPPvB04KiwBHolctNr6jKj8WfyMl7xskLEfHMRAd0zYZtQ8/A0xrOArktka+WQJBt/HeSK0Iuk+koGZamPpyXZFSrlSLq8pTggMWfvMf4nn6tz5w4E5ad+nmhmLVvJJl3BRObMbtKmvPRfY2JNTCMS18Hjg3hXo/Pi2mKgJ3si0L324kESYKIxiO1g5pkiIJYDr+AHrDmgdza0YSTzFSFUaZjhxcYOobVcg2p4tCgqCC6l6pmBM6rpG75rut4fK8pEkutb6wSrK3GJafxgRimM+svpHVVdqW3P0Gg+CnEoTpD86N8/aqivpedtcRz0LQGGee2QKe+t4LNibLN2wyzD7E7sUkPYrCLZVW71yJouhVIX7hT9ga5kZwxvN6KtL0c4IO/Wl7avpg07QAAAAC4vGdlqgnIixK1r+6PYpdXN97wMiVrX9yd1zi5xbQo730IT4pvveBk1wGHAUrWv7jyatjd4N93M1hjEFZQGVef6KUw+voQnxRCrPhx33vAyGfHp611cghDzc5vJpWtf3AtERgVP6S3+4cY0J4az+gnonOPQrDGIKwIekfJoDKvPhiOyFsKO2e1socA0C9QOGmX7F8MhVnw4j3ll4dlhofR3TrgtM+PT1p3Myg/6uQQhlJYd+NA7dgN+FG/aPAr+KFIl5/EWiIwKuKeV09/SW/2x/UIk9VAp31t/MAYNZ/QTo0jtyuflhjFJyp/oLr9RxkCQSB8EPSPkqhI6PebFFg9I6g/WDEdkLaJoffTFHbPaqzKqA++fwfhBsNghF6gcNLmHBe39Km4WUwV3zzRwueFaX6A4HvLLw7Dd0hryw0PonOxaMdhBMcp2bigTERvmPX80/+Q7mZQflbaNxsOuSdNtgVAKKSw78YcDIijgduwGjln138r0niRk24f9Dsm9wODmpBmkS8/iCmTWO20RGBUDPgHMR5NqN+m8c+6/pLf7EYuuIlUmxdn7CdwAnHwSLvJTC/e2/mAMGNF51VrP6Cc04PH+cE2aBd5ig9y5F03y1zhUK5OVP9A9uiYJa6LiHMWN+8WBIJA+Lw+J50h6R8kmVV4QYvg168zXLDK7Vm2O1Xl0V5HUH6w/+wZ1WI7IWzah0YJyDLp53COjoIo7Z7UkFH5sYLkVl86WDE6p48Jgx8zbuYNhsEItTqmbb1A4aQF/IbBF0kpL6/1TkoyInbzip4Rlpgrvnggl9kdePTJS8BIri7S/QHAakFmpfeWXhxPKjl5XZ+Wl+Uj8fJNaxkF9dd+YOdi0Y5f3rbrwgmOUnq16TdoAEbZ0LwhvIjfMeowY1aPItb5YZpqngQHvaa9vwHB2K20bjYVCAlTHXJOmqXOKf+3e4YRD8fhdJIQ2c0qrL6oOBkRRoCldiPYxmZ1YHoBEHLPrv7Kc8mbV6TxIu8Ylkf9rTmpRRFezHZN7gbO8Ylj3EQmjWT4Qej5L3lRQZMeNFMmsdrrmta/s/nG6QtFoYwZ8A5ioUxpBzybUb6EJzbblpKZNS4u/lAmVLmZnuje/IxdcRI04RZ3qTYuzhGKSasDP+ZFu4OBIOPgkXZbXPYTSelZ/fFVPphsggYh1D5hRMaLzqp+N6nP1n9BOG7DJl18domzxMru1lkd1m/hobEK8xQe5EuoeYETy2nXq3cOsrnCoVwBfsY5nKn+gCQVmeU2oDYLjhxRboZmFqc+2nHCLG/eLJTTuUkJBIHwsbjmlaMNSXsbsS4eQ9I+SPtuWS3p2/bDUWeRpsywqR90DM56ZrlhlN4FBvEAAAAAAAAAAAMAAAAEAAQACAAEAAQAAAAEAAUAEAAIAAQAAAAEAAYAIAAgAAQAAAAEAAQAEAAQAAUAAAAIABAAIAAgAAUAAAAIABAAgACAAAUAAAAIACAAgAAAAQUAAAAgAIAAAgEABAUAAAAgAAIBAgEAEAUAQYHJAAu2EAECAwQEBQUGBgYGBwcHBwgICAgICAgICQkJCQkJCQkKCgoKCgoKCgoKCgoKCgoKCwsLCwsLCwsLCwsLCwsLCwwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDwAAEBESEhMTFBQUFBUVFRUWFhYWFhYWFhcXFxcXFxcXGBgYGBgYGBgYGBgYGBgYGBkZGRkZGRkZGRkZGRkZGRkaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHB0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0AAQIDBAUGBwgICQkKCgsLDAwMDA0NDQ0ODg4ODw8PDxAQEBAQEBAQERERERERERESEhISEhISEhMTExMTExMTFBQUFBQUFBQUFBQUFBQUFBUVFRUVFRUVFRUVFRUVFRUWFhYWFhYWFhYWFhYWFhYWFxcXFxcXFxcXFxcXFxcXFxgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxsbGxscwCcAAMAsAAABAQAAHgEAAA8AAABALAAAQC0AAAAAAAAeAAAADwAAAAAAAADALQAAAAAAABMAAAAHAAAAAAAAAAwACACMAAgATAAIAMwACAAsAAgArAAIAGwACADsAAgAHAAIAJwACABcAAgA3AAIADwACAC8AAgAfAAIAPwACAACAAgAggAIAEIACADCAAgAIgAIAKIACABiAAgA4gAIABIACACSAAgAUgAIANIACAAyAAgAsgAIAHIACADyAAgACgAIAIoACABKAAgAygAIACoACACqAAgAagAIAOoACAAaAAgAmgAIAFoACADaAAgAOgAIALoACAB6AAgA+gAIAAYACACGAAgARgAIAMYACAAmAAgApgAIAGYACADmAAgAFgAIAJYACABWAAgA1gAIADYACAC2AAgAdgAIAPYACAAOAAgAjgAIAE4ACADOAAgALgAIAK4ACABuAAgA7gAIAB4ACACeAAgAXgAIAN4ACAA+AAgAvgAIAH4ACAD+AAgAAQAIAIEACABBAAgAwQAIACEACAChAAgAYQAIAOEACAARAAgAkQAIAFEACADRAAgAMQAIALEACABxAAgA8QAIAAkACACJAAgASQAIAMkACAApAAgAqQAIAGkACADpAAgAGQAIAJkACABZAAgA2QAIADkACAC5AAgAeQAIAPkACAAFAAgAhQAIAEUACADFAAgAJQAIAKUACABlAAgA5QAIABUACACVAAgAVQAIANUACAA1AAgAtQAIAHUACAD1AAgADQAIAI0ACABNAAgAzQAIAC0ACACtAAgAbQAIAO0ACAAdAAgAnQAIAF0ACADdAAgAPQAIAL0ACAB9AAgA/QAIABMACQATAQkAkwAJAJMBCQBTAAkAUwEJANMACQDTAQkAMwAJADMBCQCzAAkAswEJAHMACQBzAQkA8wAJAPMBCQALAAkACwEJAIsACQCLAQkASwAJAEsBCQDLAAkAywEJACsACQArAQkAqwAJAKsBCQBrAAkAawEJAOsACQDrAQkAGwAJABsBCQCbAAkAmwEJAFsACQBbAQkA2wAJANsBCQA7AAkAOwEJALsACQC7AQkAewAJAHsBCQD7AAkA+wEJAAcACQAHAQkAhwAJAIcBCQBHAAkARwEJAMcACQDHAQkAJwAJACcBCQCnAAkApwEJAGcACQBnAQkA5wAJAOcBCQAXAAkAFwEJAJcACQCXAQkAVwAJAFcBCQDXAAkA1wEJADcACQA3AQkAtwAJALcBCQB3AAkAdwEJAPcACQD3AQkADwAJAA8BCQCPAAkAjwEJAE8ACQBPAQkAzwAJAM8BCQAvAAkALwEJAK8ACQCvAQkAbwAJAG8BCQDvAAkA7wEJAB8ACQAfAQkAnwAJAJ8BCQBfAAkAXwEJAN8ACQDfAQkAPwAJAD8BCQC/AAkAvwEJAH8ACQB/AQkA/wAJAP8BCQAAAAcAQAAHACAABwBgAAcAEAAHAFAABwAwAAcAcAAHAAgABwBIAAcAKAAHAGgABwAYAAcAWAAHADgABwB4AAcABAAHAEQABwAkAAcAZAAHABQABwBUAAcANAAHAHQABwADAAgAgwAIAEMACADDAAgAIwAIAKMACABjAAgA4wAIAAAABQAQAAUACAAFABgABQAEAAUAFAAFAAwABQAcAAUAAgAFABIABQAKAAUAGgAFAAYABQAWAAUADgAFAB4ABQABAAUAEQAFAAkABQAZAAUABQAFABUABQANAAUAHQAFAAMABQATAAUACwAFABsABQAHAAUAFwAFAEHg2QALTQEAAAABAAAAAQAAAAEAAAACAAAAAgAAAAIAAAACAAAAAwAAAAMAAAADAAAAAwAAAAQAAAAEAAAABAAAAAQAAAAFAAAABQAAAAUAAAAFAEHQ2gALZQEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAUAAAAGAAAABgAAAAcAAAAHAAAACAAAAAgAAAAJAAAACQAAAAoAAAAKAAAACwAAAAsAAAAMAAAADAAAAA0AAAANAEGA3AALIwIAAAADAAAABwAAAAAAAAAQERIACAcJBgoFCwQMAw0CDgEPAEG03AALaQEAAAACAAAAAwAAAAQAAAAFAAAABgAAAAcAAAAIAAAACgAAAAwAAAAOAAAAEAAAABQAAAAYAAAAHAAAACAAAAAoAAAAMAAAADgAAABAAAAAUAAAAGAAAABwAAAAgAAAAKAAAADAAAAA4ABBtN0AC5oCAQAAAAIAAAADAAAABAAAAAYAAAAIAAAADAAAABAAAAAYAAAAIAAAADAAAABAAAAAYAAAAIAAAADAAAAAAAEAAIABAAAAAgAAAAMAAAAEAAAABgAAAAgAAAAMAAAAEAAAABgAAAAgAAAAMAAAAEAAAABgAABuZWVkIGRpY3Rpb25hcnkAc3RyZWFtIGVuZAAAZmlsZSBlcnJvcgBzdHJlYW0gZXJyb3IAZGF0YSBlcnJvcgBpbnN1ZmZpY2llbnQgbWVtb3J5AGJ1ZmZlciBlcnJvcgBpbmNvbXBhdGlibGUgdmVyc2lvbgAAAAAoLwAAOC8AAEMvAABELwAATy8AAFwvAABnLwAAey8AAIgvAABDLwAAMS4yLjExAEHQ3wALA9AxUA==");let wE,sa;async function w6(){var e,t;if(wE)return wE;const r={};let i,s={};for(i in r)Object.prototype.hasOwnProperty.call(r,i)&&(s[i]=r[i]);let l=!1,d=!1;l=typeof window=="object",d=typeof importScripts=="function",typeof process=="object"&&typeof process.versions=="object"&&process.versions.node;let h="";(l||d)&&(d?h=self.location.href:typeof document!="undefined"&&document.currentScript&&(h=document.currentScript.src),h=xt(h).call(h,"blob:")!==0?h.substr(0,z8(h).call(h,"/")+1):""),r.print||Lr(e=console.log).call(e,console);const p=r.printErr||Lr(t=console.warn).call(t,console);for(i in s)Object.prototype.hasOwnProperty.call(s,i)&&(r[i]=s[i]);let m;s=null,r.arguments,r.thisProgram,r.quit,r.wasmBinary,r.noExitRuntime,typeof WebAssembly!="object"&&Rt("no native wasm support detected");let f=!1;function _(ot){const Lt=r["_"+ot];var at;return at="Cannot call unknown function "+ot+", make sure it is exported",Lt||Rt("Assertion failed: "+at),Lt}function v(ot,Lt,at,y,M){const F={string:function(Ke){let Jn=0;if(Ke!=null&&Ke!==0){const cs=1+(Ke.length<<2);Jn=$(cs),function(gi,Nn,Mc){(function(pa,an,zr,mi){if(!(mi>0))return 0;const ls=zr+mi-1;for(let Aa=0;Aa<pa.length;++Aa){let z=pa.charCodeAt(Aa);if(z>=55296&&z<=57343&&(z=65536+((1023&z)<<10)|1023&pa.charCodeAt(++Aa)),z<=127){if(zr>=ls)break;an[zr++]=z}else if(z<=2047){if(zr+1>=ls)break;an[zr++]=192|z>>6,an[zr++]=128|63&z}else if(z<=65535){if(zr+2>=ls)break;an[zr++]=224|z>>12,an[zr++]=128|z>>6&63,an[zr++]=128|63&z}else{if(zr+3>=ls)break;an[zr++]=240|z>>18,an[zr++]=128|z>>12&63,an[zr++]=128|z>>6&63,an[zr++]=128|63&z}}an[zr]=0})(gi,w,Nn,Mc)}(Ke,Jn,cs)}return Jn},array:function(Ke){const Jn=$(Ke.length);var cs,gi;return cs=Ke,gi=Jn,R.set(cs,gi),Jn}},ut=_(ot),Vt=[];let xe=0;if(y)for(let Ke=0;Ke<y.length;Ke++){const Jn=F[at[Ke]];Jn?(xe===0&&(xe=Mt()),Vt[Ke]=Jn(y[Ke])):Vt[Ke]=y[Ke]}let wr=ut.apply(null,Vt);return wr=function(Ke){return Lt==="string"?(Jn=Ke)?function(gi,Nn,Mc){const pa=Nn+Mc;let an=Nn,zr="";for(;gi[an]&&!(an>=pa);)++an;if(an-Nn>16&&gi.subarray&&T)return T.decode(gi.subarray(Nn,an));for(;Nn<an;){let mi=gi[Nn++];if(!(128&mi)){zr+=String.fromCharCode(mi);continue}const ls=63&gi[Nn++];if((224&mi)==192){zr+=String.fromCharCode((31&mi)<<6|ls);continue}const Aa=63&gi[Nn++];if(mi=(240&mi)==224?(15&mi)<<12|ls<<6|Aa:(7&mi)<<18|ls<<12|Aa<<6|63&gi[Nn++],mi<65536)zr+=String.fromCharCode(mi);else{const z=mi-65536;zr+=String.fromCharCode(55296|z>>10,56320|1023&z)}}return zr}(w,Jn,cs):"":Lt==="boolean"?Boolean(Ke):Ke;var Jn,cs}(wr),xe!==0&&Y(xe),wr}const T=typeof TextDecoder!="undefined"?new TextDecoder("utf8"):void 0;let R,w,O;typeof TextDecoder!="undefined"&&new TextDecoder("utf-16le"),r.INITIAL_MEMORY;const B=[],K=[],j=[],nt=[];K.push({func:function(){Ct()}});let It=0,vt=null;function Rt(ot){throw r.onAbort&&r.onAbort(ot),p(ot+=""),f=!0,ot="abort("+ot+"). Build with -s ASSERTIONS=1 for more info.",new WebAssembly.RuntimeError(ot)}r.preloadedImages={},r.preloadedAudios={};let X="deflate.wasm";var rt,H;function W(ot){for(;ot.length>0;){const Lt=ot.shift();if(typeof Lt=="function"){Lt(r);continue}const at=Lt.func;typeof at=="number"?Lt.arg===void 0?O.get(at)():O.get(at)(Lt.arg):at(Lt.arg===void 0?null:Lt.arg)}}H="data:application/octet-stream;base64,",ml(rt=X).call(rt,H)||(X=function(ot){return r.locateFile?r.locateFile(ot,h):h+ot}(X));const U={emscripten_memcpy_big:function(ot,Lt,at){R6(w).call(w,ot,Lt,Lt+at)},emscripten_resize_heap:function(ot){Rt("OOM")}};await async function(){const ot={env:U,wasi_snapshot_preview1:U};function Lt(M,F){const ut=M.exports;var Vt;r.asm=ut,m=r.asm.memory,Vt=m.buffer,r.HEAP8=R=new Int8Array(Vt),r.HEAP16=new Int16Array(Vt),r.HEAP32=new Int32Array(Vt),r.HEAPU8=w=new Uint8Array(Vt),r.HEAPU16=new Uint16Array(Vt),r.HEAPU32=new Uint32Array(Vt),r.HEAPF32=new Float32Array(Vt),r.HEAPF64=new Float64Array(Vt),O=r.asm.__indirect_function_table,function(xe){if(It--,r.monitorRunDependencies&&r.monitorRunDependencies(It),It==0&&vt){const wr=vt;vt=null,wr()}}()}function at(M){Lt(M.instance)}function y(M){return new ct((F,ut)=>{F(y6().buffer)}).then(function(F){return WebAssembly.instantiate(F,ot)}).then(M,function(F){p("failed to asynchronously prepare wasm: "+F),Rt(F)})}if(It++,r.monitorRunDependencies&&r.monitorRunDependencies(It),r.instantiateWasm)try{return r.instantiateWasm(ot,Lt)}catch(M){return p("Module.instantiateWasm callback failed with error: "+M),!1}return await y(at),{}}();let Ct=r.___wasm_call_ctors=function(){return(Ct=r.___wasm_call_ctors=r.asm.__wasm_call_ctors).apply(null,arguments)},Et=r._malloc=function(){return(Et=r._malloc=r.asm.malloc).apply(null,arguments)};r._free=function(){return(r._free=r.asm.free).apply(null,arguments)},r.___errno_location=function(){return(r.___errno_location=r.asm.__errno_location).apply(null,arguments)},r._zlibCompress=function(){return(r._zlibCompress=r.asm.zlibCompress).apply(null,arguments)};let gt,Mt=r.stackSave=function(){return(Mt=r.stackSave=r.asm.stackSave).apply(null,arguments)},Y=r.stackRestore=function(){return(Y=r.stackRestore=r.asm.stackRestore).apply(null,arguments)},$=r.stackAlloc=function(){return($=r.stackAlloc=r.asm.stackAlloc).apply(null,arguments)};function mt(ot){function Lt(){gt||(gt=!0,r.calledRun=!0,f||(W(K),W(j),r.onRuntimeInitialized&&r.onRuntimeInitialized(),function(){if(r.postRun)for(typeof r.postRun=="function"&&(r.postRun=[r.postRun]);r.postRun.length;)at=r.postRun.shift(),nt.unshift(at);var at;W(nt)}()))}It>0||(function(){if(r.preRun)for(typeof r.preRun=="function"&&(r.preRun=[r.preRun]);r.preRun.length;)at=r.preRun.shift(),B.unshift(at);var at;W(B)}(),It>0||(r.setStatus?(r.setStatus("Running..."),ar(function(){ar(function(){r.setStatus("")},1),Lt()},1)):Lt()))}if(r.ccall=v,r.cwrap=function(ot,Lt,at,y){const M=E6(at=at||[]).call(at,function(F){return F==="number"});return Lt!=="string"&&M&&!y?_(ot):function(){return v(ot,Lt,at,arguments)}},r.allocate=function(ot,Lt){let at;return at=Lt==1?$(ot.length):Et(ot.length),ot.subarray||rn(ot)?w.set(ot,at):w.set(new Uint8Array(ot),at),at},vt=function ot(){gt||mt(),gt||(vt=ot)},r.run=mt,r.preInit)for(typeof r.preInit=="function"&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();return mt(),wE=r,r}const Zy=Uint8Array.BYTES_PER_ELEMENT,b6={bytesReceived:"br",frameDropped:"fd",frameReceived:"fr",googJitterReceived:"jr",isAudioMute:"am",isFreeze:"fz",mediaType:"mt",packetsLost:"pl",packetsReceived:"pr",peerId:"pid",id:"id",ssrc:"ssrc",timestamp:"ts",type:"tp",frameRateInput:"fi",frameRateSent:"fs",googRtt:"rt",isVideoMute:"vm"},N6={stats:"sts",state:"st",stream_id:"stid",session_id:"seid",stream_type:"stt",app_id:"aid",channel_key:"ck",channel_name:"cn",sdk_version:"sv",browser:"b",process_id:"pcid",mode:"m",codec:"c",role:"r",has_changed_gateway:"hcg",ap_response:"ar",extends:"es",details:"d",features:"ft",p2p_id:"ppid",sdp:"sdp",audio:"a",video:"v",attributes:"at",hq:"h",lq:"l",stereo:"str",speech:"spe",extend:"e",pingpongElapse:"ppe"},O6={_message:"m",_type:"t",_id:"id"},k6={join_v2:"j2",publish:"pub",publish_related_stats:"prs",ping:"pi",traffic_stats:"ts",ping_back:"pib",publish_stats:"pubs"};let bE;class D6{constructor(){}async init(){bE||(bE=(await(async()=>(sa||(sa=await w6()),{zlibCompress:r=>{var i;const s=new Uint8Array(r),l=Zy*s.byteLength,d=sa._malloc(l),h=sa._malloc(3*l);for(let f=0;f<l;f++)sa.HEAP8[d/Zy+f]=s[f];const p=sa._zlibCompress(d,l,h),m=new Uint8Array(rn(i=sa.HEAP8).call(i,h,h+p));return sa._free(d),sa._free(h),m}}))()).zlibCompress),this.zlibCompress=bE}msgPackCompress(t){return Qy.exports.encode(t)}compress(t){const r=ht(),i=this.compressKeyAndValue(JSON.parse(St(t))),s=this.msgPackCompress(i),l=this.zlibCompress(s),d=new Uint8Array([49,49,49,50,...Qe(l)]);return{origin:hr({},t),originLength:St(t).length,shortKeyAndValue:i,msgpackSer:s,compressed:d,compressedLength:d.length,time:ht()-r}}compressKeyAndValue(t){return this._ObjectKeyCompress(this._typeCompress(t))}_typeCompress(t){const r=t._type;if(!r)return t;const i=k6[r];return t._type=i||r,t}_ObjectKeyCompress(t){const r=t._message;if(r){const i=r.stats;i&&(r.stats=this._statsCompress(i)),t._message=this._messageCompress(r)}return this._reportCompress(t)}_statsCompress(t){return this._keyCompress(t,b6)}_messageCompress(t){return this._keyCompress(t,N6)}_reportCompress(t){return this._keyCompress(t,O6)}_keyCompress(t,r){const i={},s=ae(t);return Gh(s).call(s,(l,d)=>{const h=t[d];return r[d]?i[r[d]]=h:i[d]=h,i},i),i}}class L6 extends Wr{constructor(t){super(),this.lowPriorityQueue=[],this.highPriorityQueue=[],this.AgoraWebSocketManager=t}get queue(){return[...this.highPriorityQueue,...this.lowPriorityQueue]}reset(){this.lowPriorityQueue=[],this.highPriorityQueue=[]}pushMessage(t){arguments.length>1&&arguments[1]!==void 0&&arguments[1]?this.highPriorityQueue.push(t):this.lowPriorityQueue.push(t),this.sendMessage()}sendMessage(){const t=this.queue.length;let r=0;r=t<5?15*t:60+3*(t-4),ar(()=>{this._sendMessage()},r)}_sendMessage(){var t;if(!this.queue.length)return;const r=this.AgoraWebSocketManager.getConnection();if(!r||r.readyState!==1)return;const i=this.queue.shift();return qt(t=this.lowPriorityQueue).call(t,i)?this.lowPriorityQueue.shift():this.highPriorityQueue.shift(),r.send(i.compressed),i}}class rA extends Wr{constructor(t,r){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2],s=arguments.length>3&&arguments[3]!==void 0&&arguments[3];super(),this.connectionID=0,this.currentURLIndex=0,this.reconnectMode="tryNext",this._state="closed",this.reconnectCount=0,this.isCompressorInitSuccess=!1,this.tryDoubleDomain=!1,this.wsInflateLength=0,this.wsDeflateLength=0,this.closeEstablishingWs=()=>{},this.name=t,this.retryConfig=r,this.useCompress=i,this.tryDoubleDomain=s}get url(){return this.websocket?this.websocket.url:null}get ipPortTuple(){if(!this.url)return[void 0,void 0];const t=/^wss:\/\/(\d+-\d+-\d+-\d+)\..+:(\d+)\/?$/.exec(this.url);return t&&t[1]&&t[2]?[t[1].split("-").join("."),t[2]]:[void 0,void 0]}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(Je.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Je.CONNECTED):this._state==="closed"?this.emit(Je.CLOSED):this._state==="failed"&&this.emit(Je.FAILED))}getConnection(){return this.websocket||void 0}init(t){const r=(i,s)=>{this.urls=t;const l=this.urls[this.currentURLIndex];this.state="connecting",this.messageSender=new L6(this),this.createWebSocketConnection(l).then(i).catch(s),this.once(Je.CLOSED,()=>s(new P(D.WS_DISCONNECT))),this.once(Je.CONNECTED,()=>i())};return new ct((i,s)=>{this.compressor=new D6,this.compressor.init().then(()=>{var l;S.debug("websocket compressor initialized successfully"),At.wsCompressorInit({status:!0,ec:null,eventElapse:1}),this.isCompressorInitSuccess=!0,this.compress=Lr(l=this.compressor.compress).call(l,this.compressor),r(i,s)}).catch(l=>{r(i,s),S.debug("websocket compressor failed to initialize"),At.wsCompressorInit({status:!1,ec:l?l.message||l.toString():"Empty Error",eventElapse:1})})})}close(t,r){if(this.currentURLIndex=0,this.reconnectCount=0,this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const i=this.websocket;r?ar(()=>i.close(),500):i.close(),this.websocket=void 0}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,r){if(!this.websocket)return void S.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),S.debug("[".concat(this.name,"] reconnect is triggered initiative"));const i=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),i&&Lr(i).call(i,this.websocket)({code:9999,reason:r})}sendMessage(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new P(D.WS_ABORT,"websocket is not ready");try{let i=null;if(this.isCompressorInitSuccess&&this.useCompress&&it("WEBSOCKET_COMPRESS"))i=this.compress(t),this.setWsInflateData(i);else{if(this.isCompressorInitSuccess&&this.useCompress){const l=this.compress(t);this.setWsInflateData(l)}const s=St(t);i={compressed:s,compressedLength:s.length,origin:t}}r?this.websocket.send(i.compressed):this.messageSender.pushMessage(i)}catch(i){throw new P(D.WS_ERR,"send websocket message error"+i.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,r=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:r}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t,r){return this.connectionID+=1,this.connectionID,new ct((i,s)=>{var l,d;const h=()=>{S.debug("[".concat(this.name,"] websocket opened:"),t),this.reconnectMode="retry",this.state="connected",this.reconnectCount=0,i()},p=async f=>{var _,v,T,R;if(S.debug(k(_=k(v=k(T=k(R="[".concat(this.name,"] websocket close ")).call(R,this.websocket&&this.websocket.url,", code: ")).call(T,f.code,", reason: ")).call(v,f.reason,", current mode: ")).call(_,this.reconnectMode)),this.reconnectCount<this.retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=f.reason,this.state="reconnecting");const w=po(this,Je.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,O=await this.reconnectWithAction(w);if(this.state==="closed")return void S.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!O)return s(new P(D.WS_DISCONNECT,"websocket reconnect failed: ".concat(f.code))),void this.close(!0);i()}else s(new P(D.WS_DISCONNECT,"websocket close: ".concat(f.code))),this.close()},m=f=>{this.emit(Je.ON_MESSAGE,f)};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),it("GATEWAY_WSS_ADDRESS")&&ml(l=this.name).call(l,"gateway")&&(t=it("GATEWAY_WSS_ADDRESS")),S.debug(k(d="[".concat(this.name,"] start connect, url: ")).call(d,t)),this.chooseBestWebsocketConnection(t,!!r).then(f=>{this.websocket=f,h&&h(),f.onclose=p,f.onmessage=m}).catch(f=>{if(this.state!=="closed"){if(f instanceof P&&f.code===D.WS_ERR){var _;const v=new P(D.WS_ERR,"init websocket failed! Error: ".concat(f.toString()));return S.error(k(_="[".concat(this.name,"]")).call(_,v)),void s(v)}p&&p(f)}else s(new P(D.WS_DISCONNECT,"websocket is closed: ".concat(f.toString())))})})}async reconnectWithAction(t,r){var i,s;if(!r&&this.reconnectCount>=this.retryConfig.maxRetryCount||!this.urls||this.state==="closed")return!1;this.onlineReconnectListener||Rr.networkState!==lo.OFFLINE||(this.onlineReconnectListener=Rr.onlineWaiter&&Rr.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));const l=hE(this.reconnectCount,this.retryConfig);if(S.debug(k(i=k(s="[".concat(this.name,"] wait ")).call(s,l,"ms to reconnect websocket, mode: ")).call(i,t)),await ct.race([Mr(l),this.onlineReconnectListener||new ct(()=>{})]),this.state==="closed")return!1;this.reconnectCount+=1;try{if(t==="retry"){const p=this.urls[this.currentURLIndex];await this.createWebSocketConnection(p)}else if(t==="tryNext"){var d,h;if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return await this.reconnectWithAction("recover");S.debug(k(d=k(h="[".concat(this.name,"] websocket url length: ")).call(h,this.urls.length," current index: ")).call(d,this.currentURLIndex));const p=this.urls[this.currentURLIndex];await this.createWebSocketConnection(p)}else if(t==="recover"){S.debug("[".concat(this.name,"] request new urls")),this.urls=await Ur(this,Je.REQUEST_NEW_URLS),this.currentURLIndex=0;const p=this.urls[this.currentURLIndex];await this.createWebSocketConnection(p)}return!0}catch(p){return S.error("[".concat(this.name,"] reconnect failed"),p.toString()),await this.reconnectWithAction(t)}}async chooseBestWebsocketConnection(t,r){return new ct((i,s)=>{let l=!1;const d=[];this.closeEstablishingWs=()=>{S.debug("[choose-best-ws] close establishing websockets"),V(d).call(d,T=>{T.onclose=null,T.onopen=null,T.onmessage=null,T.close()}),s(new P(D.WS_ABORT,"choose best websocket aborted"))};const h=it("GATEWAY_DOMAINS");let p;const m=xt(t).call(t,"?h="),f=ft(h).call(h,T=>m!==-1?qt(t).call(t,T,m):qt(t).call(t,T));S.debug("[choose-best-ws] currentDomain: ",f,", domains: ",h);let _=!this.tryDoubleDomain||r||!f;if(!_&&f){try{V(h).call(h,T=>{const R=m===-1?t.replace(f,T):t.substr(0,m)+t.substr(m).replace(f,T),w=new WebSocket(R);w.binaryType="arraybuffer",d.push(w),S.debug("[choose-best-ws] ws is connecting:",w.url)})}catch{for(S.debug("[choose-best-ws] ws create failed, fallback to single url"),V(d).call(d,R=>R.close());d.length;)d.pop();_=!0}V(d).call(d,T=>{T.onopen=()=>{var R;l||(V(R=kt(d).call(d,w=>w!==T)).call(R,w=>{S.debug("[choose-best-ws]close backup websocket: ".concat(w.url)),w.close()}),l=!0,i(T))},T.onclose=R=>{p=R,!l&&(ft(d).call(d,w=>!(w.readyState===WebSocket.CLOSED||w.readyState===WebSocket.CLOSING))||(S.debug("[choose-best-ws] all websocket is closed"),l=!0,s(p)))},T.onmessage=R=>{var w;S.debug(k(w="[choose-best-ws]".concat(T.url," onmessage: ")).call(w,R.data))}}),Mr(5e3).then(()=>{V(d).call(d,T=>{T.readyState!==WebSocket.OPEN&&T.close()})})}if(_){let T;S.debug("[choose-best-ws] use single url: ",t);try{T=new WebSocket(t),d.push(T),T.binaryType="arraybuffer"}catch(R){var v;const w=new P(D.WS_ERR,"init websocket failed! Error: ".concat(R.toString()));return S.error(k(v="[".concat(this.name,"]")).call(v,w)),void s(w)}T.onopen=()=>{i(T)},T.onclose=R=>{s(R)},T.onmessage=R=>{var w;S.debug(k(w="[choose-best-ws]".concat(T.url," onmessage: ")).call(w,R.data))},Mr(5e3).then(()=>{T&&T.readyState!==WebSocket.OPEN&&T.close()})}}).then(i=>(this.closeEstablishingWs=void 0,i)).catch(i=>{throw this.closeEstablishingWs=void 0,i})}}class $y{constructor(t){this.input=[],this.size=t}add(t){var r;this.input.push(t),this.input.length>this.size&&Ye(r=this.input).call(r,0,1)}mean(){var t;return this.input.length===0?0:Gh(t=this.input).call(t,(r,i)=>r+i)/this.input.length}}class P6 extends Wr{constructor(t){super(),this._connectionState=un.CLOSED,this.openConnectionTime=ht(),this.lastMsgTime=ht(),this.uploadCache=[],this.rttRolling=new $y(5),this.pingpongTimeoutCount=0,this.onWebsocketMessage=r=>{if(r.data instanceof ArrayBuffer)return void this.emit(Ce.ON_BINARY_DATA,r.data);const i=JSON.parse(r.data);if(this.lastMsgTime=ht(),Object.prototype.hasOwnProperty.call(i,"_id")){const s="res-@".concat(i._id);this.emit(s,i._result,i._message)}else if(Object.prototype.hasOwnProperty.call(i,"_type")&&(this.emit(i._type,i._message),i._type===tr.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===tr.ON_USER_BANNED))switch(i._message.error_code){case 14:this.close("UID_BANNED");break;case 15:this.close("IP_BANNED");break;case 16:this.close("CHANNEL_BANNED")}},this.clientId=t.clientId,this.spec=t,this.websocket=new rA("gateway-".concat(this.clientId),this.spec.retryConfig,!0,!0),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===un.CONNECTED&&this.reconnect("retry",pi.OFFLINE)})}get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===un.CONNECTED?this.emit(Ce.WS_CONNECTED):t===un.RECONNECTING?this.emit(Ce.WS_RECONNECTING,this._websocketReconnectReason):t===un.CLOSED&&this.emit(Ce.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}async request(t,r,i,s){var l,d,h,p,m;const f=Pe(6,""),_={_id:f,_type:t,_message:r},v=this.websocket.connectionID,T=()=>new ct((j,nt)=>{if(this.connectionState===un.CONNECTED)return j();const It=()=>{this.off(Ce.WS_CLOSED,vt),j()},vt=()=>{this.off(Ce.WS_CONNECTED,It),nt(new P(D.WS_ABORT))};this.once(Ce.WS_CONNECTED,It),this.once(Ce.WS_CLOSED,vt),t!==Fe.PUBLISH&&t!==Fe.SUBSCRIBE&&t!==Fe.UNSUBSCRIBE&&t!==Fe.UNPUBLISH&&t!==Fe.CONTROL||this.once(Ce.DISCONNECT_P2P,()=>{nt(new P(D.DISCONNECT_P2P))})});if(this.connectionState!==un.CONNECTING&&this.connectionState!==un.RECONNECTING||t===Fe.JOIN||t===Fe.REJOIN||await T(),this.websocket.sendMessage(_,!0),s)return;const R=new ct((j,nt)=>{let It=!1;const vt=(X,rt)=>{It=!0,j({isSuccess:X==="success",message:rt||{}}),this.off(Ce.WS_CLOSED,Rt),this.off(Ce.WS_RECONNECTING,Rt),this.emit(Ce.REQUEST_SUCCESS,t,r)};this.once("res-@".concat(f),vt);const Rt=()=>{nt(new P(D.WS_ABORT,"type: ".concat(t))),this.off(Ce.WS_CLOSED,Rt),this.off(Ce.WS_RECONNECTING,Rt),this.off("res-@".concat(f),vt)};this.once(Ce.WS_CLOSED,Rt),this.once(Ce.WS_RECONNECTING,Rt),Mr(it("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==v||It||(S.warning("ws request timeout, type: ".concat(t)),this.emit(Ce.REQUEST_TIMEOUT,t,r))})});let w=null;try{w=await R}catch(j){if(this.connectionState===un.CLOSED||t===Fe.LEAVE)throw new P(D.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?j.throw():t===Fe.JOIN||t===Fe.REJOIN?null:(await T(),await this.request(t,r))}if(w.isSuccess)return w.message;const O=Number(w.message.error_code||w.message.code),B=qp(O),K=new P(D.UNEXPECTED_RESPONSE,k(l="".concat(B.desc,": ")).call(l,w.message.error_str),{code:O,data:w.message});return B.action==="success"?w.message:(S.warning(k(d=k(h=k(p=k(m="[".concat(this.websocket.connectionID,"] unexpected response from type ")).call(m,t,", error_code: ")).call(p,O,", message: ")).call(h,B.desc,", action: ")).call(d,B.action)),B.action==="failed"?K.throw():B.action==="quit"?(this.initError=K,this.close(),K.throw()):(O===ne.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=w.message.option,S.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",pi.MULTI_IP)):this.reconnect(B.action,pi.SERVER_ERROR),t===Fe.JOIN||t===Fe.REJOIN?null:await this.request(t,r)))}waitMessage(t,r){return new ct(i=>{const s=l=>{(!r||r(l))&&(this.off(t,s),i(l))};this.on(t,s)})}upload(t,r){const i={_type:t,_message:r};try{this.websocket.sendMessage(i)}catch{const d=it("MAX_UPLOAD_CACHE")||50;var s;this.uploadCache.push(i),this.uploadCache.length>d&&Ye(s=this.uploadCache).call(s,0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=be(()=>{var h;if(this.connectionState!==un.CONNECTED)return;const p=Ye(h=this.uploadCache).call(h,0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(p._type,p._message)},it("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,r){const i={_type:t,_message:r};this.websocket.sendMessage(i)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,new ct((r,i)=>{this.once(Ce.WS_CONNECTED,()=>r(this.joinResponse)),this.once(Ce.WS_CLOSED,()=>i(this.initError||new P(D.WS_ABORT))),this.connectionState=un.CONNECTING,this.websocket.init(t).catch(i),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=be(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||"LEAVE",this.connectionState=un.CLOSED,this.websocket.close()}async join(){var t;if(!this.joinResponse){const r=await Ur(this,Ce.REQUEST_JOIN_INFO),i=await this.request(Fe.JOIN,r);if(!i)return this.emit(Ce.REPORT_JOIN_GATEWAY,D.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(Ce.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=un.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=be(Lr(t=this.handlePingPong).call(t,this),3e3),!0}async rejoin(){var t,r;if(!this.reconnectToken)throw new P(D.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const i=Va(this,Ce.REQUEST_REJOIN_INFO);i.token=this.reconnectToken;const s=await this.request(Fe.REJOIN,i);return!!s&&(this.connectionState=un.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=be(Lr(t=this.handlePingPong).call(t,this),3e3),s.peers&&V(r=s.peers).call(r,l=>{this.emit(tr.ON_USER_ONLINE,{uid:l.uid}),l.audio_mute?this.emit(tr.MUTE_AUDIO,{uid:l.uid}):this.emit(tr.UNMUTE_AUDIO,{uid:l.uid}),l.video_mute?this.emit(tr.MUTE_VIDEO,{uid:l.uid}):this.emit(tr.UNMUTE_VIDEO,{uid:l.uid}),l.audio_enable_local?this.emit(tr.ENABLE_LOCAL_AUDIO,{uid:l.uid}):this.emit(tr.DISABLE_LOCAL_AUDIO,{uid:l.uid}),l.video_enable_local?this.emit(tr.ENABLE_LOCAL_VIDEO,{uid:l.uid}):this.emit(tr.DISABLE_LOCAL_VIDEO,{uid:l.uid}),l.audio||l.video||this.emit(tr.ON_REMOVE_STREAM,{uid:l.uid,uint_id:l.uint_id}),l.audio&&this.emit(tr.ON_ADD_AUDIO_STREAM,{uid:l.uid,uint_id:l.uint_id,audio:!0}),l.video&&this.emit(tr.ON_ADD_VIDEO_STREAM,{uid:l.uid,uint_id:l.uint_id,video:!0})}),!0)}reconnect(t,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,r)}handleNotification(t){S.debug("[".concat(this.clientId,"] receive notification: "),t);const r=qp(t.code);if(r.action!=="success"){if(r.action!=="failed")return r.action==="quit"?(r.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close("UID_BANNED"),void this.close()):void this.reconnect(r.action,pi.SERVER_ERROR);S.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=it("PING_PONG_TIME_OUT"),r=ht();this.pingpongTimeoutCount>=t&&(S.warning("PINGPONG Timeout. Last Socket Message: ".concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>it("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",pi.TIMEOUT):this.request(Fe.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=ht()-r;this.rttRolling.add(i),it("REPORT_STATS")&&this.send(Fe.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:r}=this.websocket.getWsInflateData();t!==0&&r!==0&&this.upload(No.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:r,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(Je.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Je.CLOSED,()=>{this.connectionState=un.CLOSED}),this.websocket.on(Je.FAILED,()=>{this._disconnectedReason="NETWORK_ERROR",this.connectionState=un.CLOSED}),this.websocket.on(Je.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===un.CONNECTED?this.connectionState=un.RECONNECTING:this.connectionState=un.CONNECTING}),this.websocket.on(Je.WILL_RECONNECT,(t,r)=>{if(Va(this,Ce.IS_P2P_DISCONNECTED)&&t==="retry")return this.reconnectToken=void 0,this.emit(Ce.NEED_RENEW_SESSION),this.emit(Ce.DISCONNECT_P2P),r("tryNext");t!=="retry"&&(this.reconnectToken=void 0,this.emit(Ce.NEED_RENEW_SESSION),this.emit(Ce.DISCONNECT_P2P)),r(t)}),this.websocket.on(Je.CONNECTED,()=>{this.openConnectionTime=ht(),this.reconnectToken?this.rejoin().catch(t=>{var r;S.warning(k(r="[".concat(this.clientId,"] rejoin failed ")).call(r,t)),this.reconnect("tryNext",pi.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(Ce.REPORT_JOIN_GATEWAY,t.message||t.code,this.url||""),t instanceof P&&t.code===D.UNEXPECTED_RESPONSE&&t.data.code===ne.ERR_NO_AUTHORIZED)return S.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",pi.SERVER_ERROR);S.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",pi.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(Je.REQUEST_NEW_URLS,(t,r)=>{Ur(this,Ce.REQUEST_RECOVER,this.multiIpOption).then(t).catch(r)})}}function t0(e,t){var r=ae(e);if(Xt){var i=Xt(e);t&&(i=kt(i).call(i,function(s){return jt(e,s).enumerable})),r.push.apply(r,i)}return r}function Ul(e){for(var t=1;t<arguments.length;t++){var r,i,s=arguments[t]!=null?arguments[t]:{};t%2?V(r=t0(Object(s),!0)).call(r,function(l){mr(e,l,s[l])}):Zt?ur(e,Zt(s)):V(i=t0(Object(s))).call(i,function(l){ie(e,l,jt(s,l))})}return e}const NE=new $t;class B6 extends Wr{constructor(t,r){super(),this.inChannelInfo={joinAt:null,duration:0},this._state="DISCONNECTED",this.isSignalRecover=!1,this.hasChangeBGPAddress=!1,this.joinGatewayStartTime=0,this._signalTimeout=!1,this.store=t,this.spec=r,this.signal=new P6(Ul(Ul({},r),{},{retryConfig:r.websocketRetryConfig})),this._statsCollector=r.statsCollector,this.role=r.role||"audience",this._clientRoleOptions=r.clientRoleOptions,this.handleSignalEvents()}get state(){return this._state}set state(t){if(t===this._state)return;const r=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(vr.CONNECTION_STATE_CHANGE,t,r,this._disconnectedReason):this.emit(vr.CONNECTION_STATE_CHANGE,t,r)}async join(t,r){var i,s;this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const l=ht();let d=NE.get(t.cname);if(d||(d=new $t,NE.set(t.cname,d)),d.has(t.uid)){const m=new P(D.UID_CONFLICT);throw At.joinGateway(t.sid,{lts:l,succ:!1,ec:m.message,addr:null,uid:t.uid,cid:t.cid}),m}d.set(t.uid,!0),this.joinInfo=t,this.key=r;const h=t.proxyServer?pt(i=t.gatewayAddrs).call(i,m=>{var f,_;const v=m.split(":");return k(f=k(_="wss://".concat(t.proxyServer,"/ws/?h=")).call(_,v[0],"&p=")).call(f,v[1])}):pt(s=t.gatewayAddrs).call(s,m=>"wss://".concat(m));let p=0;this.joinGatewayStartTime=l;try{p=(await this.signal.init(h)).uid}catch(m){throw S.error("[".concat(this.store.clientId,"] User join failed"),m.toString()),At.joinGateway(t.sid,{lts:l,succ:!1,ec:m.message,addr:this.signal.url,uid:t.uid,cid:t.cid}),d.delete(t.uid),this.signal.close(),m}return this.state="CONNECTED",this.inChannelInfo.joinAt=ht(),S.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=be(()=>{this.updateTrafficStats().catch(m=>{S.warning("[".concat(this.store.clientId,"] get traffic stats error"),m.toString())})},3e3),this.networkQualityInterval=be(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(vr.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(vr.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(vr.NETWORK_QUALITY,{uplinkNetworkQuality:Ly(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:Ly(this._statsCollector.trafficStats.B_dnq)}):this.emit(vr.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),p}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];if(this.state!=="DISCONNECTED"){this.state="DISCONNECTING";try{t||this.signal.connectionState!==un.CONNECTED||await Uy(this.signal.request(Fe.LEAVE,void 0,!0),3e3)}catch(r){S.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),r)}this.signal.close(),this.reset(),this.state="DISCONNECTED"}}async publish(t,r,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new P(D.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const s={state:"offer",p2p_id:this.store.p2pId,ortc:r,mode:this.spec.mode,extend:it("PUB_EXTEND")};try{return(await this.signal.request(Fe.PUBLISH,s,!0))._message}catch(l){if(i&&l.data&&l.data.code===ne.ERR_PUBLISH_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),l.toString()),await this.tryUnpubBeforeRepub(t,r),this.publish(t,r,!1);throw l}}async unpublish(t,r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new P(D.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Fe.UNPUBLISH,{stream_id:r,ortc:t},!0)}catch(i){S.warning("unpublish warning: ",i)}}async subscribe(t,r,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new P(D.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const s={stream_id:t,stream_type:r.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,tcc:!!it("SUBSCRIBE_TCC"),extend:it("SUB_EXTEND"),ssrcId:r.ssrcId};try{return(await this.signal.request(Fe.SUBSCRIBE,s,!0))._message}catch(l){if(i&&l.data&&l.data.code===ne.ERR_SUBSCRIBE_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),l.toString()),await this.tryUnsubBeforeResub(t,r),await this.subscribe(t,r,!1);throw l}}async unsubscribe(t,r){try{await this.signal.request(Fe.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:r},!0)}catch(i){S.warning("unsubscribe warning: ",i)}}async reconnectPC(t){const{iceParameters:r,dtlsParameters:i,rtpCapabilities:s}=t;return{gatewayEstablishParams:await this.signal.request(Fe.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:r,dtlsParameters:i,rtpCapabilities:s}},!0)}}getGatewayInfo(){return this.signal.request(Fe.GATEWAY_INFO)}renewToken(t){return this.signal.request(Fe.RENEW_TOKEN,t)}async setClientRole(t,r){if(r&&(this._clientRoleOptions=hr({},r)),this.state!=="CONNECTED")return void(this.role=t);let i;i=t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:0,await this.signal.request(Fe.SET_CLIENT_ROLE,{role:t,level:i}),this.role=t}async setRemoteVideoStreamType(t,r){await this.signal.request(Fe.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:r})}async setStreamFallbackOption(t,r){await this.signal.request(Fe.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:r})}async pickSVCLayer(t,r){await this.signal.request(Fe.PICK_SVC_LAYER,{stream_id:t,spatial_layer:r.spatialLayer,temporal_layer:r.temporalLayer})}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=ht()-this.inChannelInfo.joinAt),Ul({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Fe.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=ht()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=NE.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=function(r){const i=r.match(/(wss\:\/\/)?([^:]+):(\d+)/);return i?{username:qe.username,password:qe.password,turnServerURL:i[2],tcpport:Tr(i[3])+30,udpport:Tr(i[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex])||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Ul(Ul({},qe),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){var t;if(this.state!=="CONNECTED")return;const r=await this.signal.request(Fe.TRAFFIC_STATS,void 0,!0);r.timestamp=ht(),V(t=r.peer_delay).call(t,i=>{var s;const l=this._statsCollector.trafficStats&&ft(s=this._statsCollector.trafficStats.peer_delay).call(s,d=>d.peer_uid===i.peer_uid);l&&l.B_st!==i.B_st&&sn(()=>{this.emit(vr.STREAM_TYPE_CHANGE,i.peer_uid,i.B_st)})}),this._statsCollector.updateTrafficStats(r)}getJoinMessage(t){if(!this.joinInfo||!this.key)throw new P(D.UNEXPECTED_ERROR,"can not generate join message, no join info");const r=hr({},this.joinInfo.apResponse);let i=it("REPORT_APP_SCENARIO");if(typeof i!="string")try{i=St(i)}catch{i=void 0}i&&i.length>128&&(i=void 0);const s=Ul({p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Tn,browser:navigator.userAgent,process_id:it("PROCESS_ID"),mode:this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:r,extend:it("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:i},t);return this.joinInfo.stringUid&&(s.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(s.aes_mode=this.joinInfo.aesmode,it("ENCRYPT_AES")?(s.aes_secret=this.joinInfo.aespassword,s.aes_encrypt=!0):s.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(s.aes_salt=this.joinInfo.aessalt)),r.addresses[this.signal.websocket.currentURLIndex]&&(s.ap_response.ticket=r.addresses[this.signal.websocket.currentURLIndex].ticket,delete r.addresses),s}getRejoinMessage(){if(!this.joinInfo)throw new P(D.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Ce.WS_RECONNECTING,t=>{this.joinInfo&&At.WebSocketQuit(this.joinInfo.sid,{lts:ht(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||pi.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",At.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode}),this.isSignalRecover=!1,this.joinGatewayStartTime=ht())}),this.signal.on(Ce.WS_CLOSED,t=>{let r;switch(t){case"LEAVE":r=pi.LEAVE;break;case"UID_BANNED":case"IP_BANNED":case"CHANNEL_BANNED":case"SERVER_ERROR":r=pi.SERVER_ERROR;break;default:r=pi.NETWORK_ERROR}S.debug("[signal] websocket closed, reason: ".concat(r||"undefined -> "+pi.NETWORK_ERROR)),this.joinInfo&&At.WebSocketQuit(this.joinInfo.sid,{lts:ht(),succ:t==="LEAVE"?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r}),this.reset(),this._disconnectedReason=t,this.state="DISCONNECTED"}),this.signal.on(Ce.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){var t,r,i;if(this.role==="audience"&&this._clientRoleOptions&&this._clientRoleOptions.level&&(S.debug(k(t=k(r=k(i="[".concat(this.store.clientId,"] patch to send set client role, role: ")).call(i,this.role,", mode: ")).call(r,this.spec.mode,", level: ")).call(t,this._clientRoleOptions&&this._clientRoleOptions.level)),this.setClientRole(this.role,this._clientRoleOptions)),At.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid}),this.joinInfo.useLocalAccessPoint){const l=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);var s;if(!l)return void S.error(k(s="[".concat(this.store.clientId,"] set local access point after joined failed: ")).call(s,l));jr("EVENT_REPORT_DOMAIN",l[1]),jr("EVENT_REPORT_BACKUP_DOMAIN",l[1]),jr("LOG_UPLOAD_SERVER","".concat(l[1],":6444"))}}}),this.signal.on(tr.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(Ce.REQUEST_RECOVER,(t,r,i)=>{if(!this.joinInfo)return i(new P(D.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Ur(this,vr.REQUEST_NEW_GATEWAY_LIST).then(r).catch(i)}),this.signal.on(Ce.REQUEST_JOIN_INFO,async t=>{var r;this.updateTurnConfigFromSignal();const{iceParameters:i,dtlsParameters:s,rtpCapabilities:l}=await Ur(this,vr.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:(r=this.joinInfo)===null||r===void 0?void 0:r.turnServer});t(this.getJoinMessage({ortc:{iceParameters:i,dtlsParameters:s,rtpCapabilities:l}}))}),this.signal.on(Ce.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(Ce.REPORT_JOIN_GATEWAY,(t,r)=>{this.joinInfo&&At.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:t,addr:r,uid:this.joinInfo.uid,cid:this.joinInfo.cid})}),this.signal.on(Ce.IS_P2P_DISCONNECTED,t=>{t(Va(this,vr.IS_P2P_DISCONNECTED))}),this.signal.on(Ce.DISCONNECT_P2P,()=>{this.emit(vr.DISCONNECT_P2P)}),this.signal.on(Ce.NEED_RENEW_SESSION,()=>{this.emit(vr.NEED_RENEW_SESSION)}),this.signal.on(Ce.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Ce.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Ce.JOIN_RESPONSE,t=>{this.emit(vr.JOIN_RESPONSE,t)})}async tryUnsubBeforeResub(t,r){try{await this.signal.request(Fe.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[r]},!0)}catch(i){throw S.warning("unsubscribe warning",i),i}}async tryUnpubBeforeRepub(t,r){try{await this.signal.request(Fe.UNPUBLISH,{stream_id:t,ortc:r},!0)}catch(i){throw S.warning("unpublish warning: ",i),i}}async muteLocal(t,r){const i={action:ft(t).call(t,s=>s.stream_type===Kr.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:r};try{await this.signal.request(Fe.CONTROL,i,!0,!0)}catch(s){throw S.warning("gateway unmuteLocal warning: ",s),s}}async unmuteLocal(t,r){const i={action:ft(t).call(t,s=>s.stream_type===Kr.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:r};try{await this.signal.request(Fe.CONTROL,i,!0,!0)}catch(s){throw S.warning("gateway muteLocal warning: ",s),s}}uploadStats(t,r){this.signal.upload(t,r)}getSignalRTT(){return this.signal.rtt}async restartICE(t){const r={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return{response:await this.signal.request(Fe.RESTART_ICE,r,!0)}}catch(i){throw S.warning("P2PChannel.restartICE warning: ",i),i}}reconnect(){this.state==="CONNECTED"&&this.signal.reconnect(void 0,pi.P2P_FAILED)}}var M6=u,U6=en("iterator"),e0=!M6(function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,r="";return e.pathname="c%20d",t.forEach(function(i,s){t.delete("b"),r+=s+i}),!e.toJSON||!t.sort||e.href!=="http://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[U6]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://\u0442\u0435\u0441\u0442").host!=="xn--e1aybc"||new URL("http://a#\u0431").hash!=="#%D0%B1"||r!=="a1c3"||new URL("http://x",void 0).host!=="x"}),Oc=N,OE=2147483647,x6=/[^\0-\u007E]/,r0=/[.\u3002\uFF0E\uFF61]/g,n0="Overflow: input needs wider integers to process",i0=G.RangeError,F6=Oc(r0.exec),xl=Math.floor,kE=String.fromCharCode,o0=Oc("".charCodeAt),s0=Oc([].join),Ga=Oc([].push),Q6=Oc("".replace),V6=Oc("".split),G6=Oc("".toLowerCase),a0=function(e){return e+22+75*(e<26)},j6=function(e,t,r){var i=0;for(e=r?xl(e/700):e>>1,e+=xl(e/t);e>455;)e=xl(e/35),i+=36;return xl(i+36*e/(e+38))},H6=function(e){var t,r,i=[],s=(e=function(B){for(var K=[],j=0,nt=B.length;j<nt;){var It=o0(B,j++);if(It>=55296&&It<=56319&&j<nt){var vt=o0(B,j++);(64512&vt)==56320?Ga(K,((1023&It)<<10)+(1023&vt)+65536):(Ga(K,It),j--)}else Ga(K,It)}return K}(e)).length,l=128,d=0,h=72;for(t=0;t<e.length;t++)(r=e[t])<128&&Ga(i,kE(r));var p=i.length,m=p;for(p&&Ga(i,"-");m<s;){var f=OE;for(t=0;t<e.length;t++)(r=e[t])>=l&&r<f&&(f=r);var _=m+1;if(f-l>xl((OE-d)/_))throw i0(n0);for(d+=(f-l)*_,l=f,t=0;t<e.length;t++){if((r=e[t])<l&&++d>OE)throw i0(n0);if(r==l){for(var v=d,T=36;;){var R=T<=h?1:T>=h+26?26:T-h;if(v<R)break;var w=v-R,O=36-R;Ga(i,kE(a0(R+w%O))),v=xl(w/O),T+=36}Ga(i,kE(a0(v))),h=j6(d,_,m==p),d=0,m++}}d++,l++}return s0(i,"")},K6=G.TypeError,DE=Ae,nA=G,LE=ti,iA=he,ws=N,c0=e0,l0=cl,W6=Gd,Y6=Da,q6=JC,PE=oo,d0=ll,BE=J,J6=gn,z6=Ws,X6=Is,Z6=xi,u0=Vr,fo=Fi,$6=gc,h0=Re,ME=Ng,t9=$h,Fl=function(e,t){if(e<t)throw K6("Not enough arguments");return e},e9=hR,r9=en("iterator"),oA="URLSearchParams",p0="URLSearchParamsIterator",A0=PE.set,rs=PE.getterFor(oA),n9=PE.getterFor(p0),f0=LE("fetch"),sA=LE("Request"),Iu=LE("Headers"),UE=sA&&sA.prototype,g0=Iu&&Iu.prototype,i9=nA.RegExp,o9=nA.TypeError,m0=nA.decodeURIComponent,s9=nA.encodeURIComponent,a9=ws("".charAt),E0=ws([].join),kc=ws([].push),xE=ws("".replace),c9=ws([].shift),_0=ws([].splice),I0=ws("".split),l9=ws("".slice),d9=/\+/g,v0=Array(4),u9=function(e){return v0[e-1]||(v0[e-1]=i9("((?:%[\\da-f]{2}){"+e+"})","gi"))},h9=function(e){try{return m0(e)}catch{return e}},C0=function(e){var t=xE(e,d9," "),r=4;try{return m0(t)}catch{for(;r;)t=xE(t,u9(r--),h9);return t}},p9=/[!'()~]|%20/g,A9={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},f9=function(e){return A9[e]},S0=function(e){return xE(s9(e),p9,f9)},FE=q6(function(e,t){A0(this,{type:p0,iterator:ME(rs(e).entries),kind:t})},"Iterator",function(){var e=n9(this),t=e.kind,r=e.iterator.next(),i=r.value;return r.done||(r.value=t==="keys"?i.key:t==="values"?i.value:[i.key,i.value]),r},!0),T0=function(e){this.entries=[],this.url=null,e!==void 0&&(u0(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?a9(e,0)==="?"?l9(e,1):e:fo(e)))};T0.prototype={type:oA,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,r,i,s,l,d,h,p=t9(e);if(p)for(r=(t=ME(e,p)).next;!(i=iA(r,t)).done;){if(l=(s=ME(Z6(i.value))).next,(d=iA(l,s)).done||(h=iA(l,s)).done||!iA(l,s).done)throw o9("Expected sequence with length 2");kc(this.entries,{key:fo(d.value),value:fo(h.value)})}else for(var m in e)J6(e,m)&&kc(this.entries,{key:m,value:fo(e[m])})},parseQuery:function(e){if(e)for(var t,r,i=I0(e,"&"),s=0;s<i.length;)(t=i[s++]).length&&(r=I0(t,"="),kc(this.entries,{key:C0(c9(r)),value:C0(E0(r,"="))}))},serialize:function(){for(var e,t=this.entries,r=[],i=0;i<t.length;)e=t[i++],kc(r,S0(e.key)+"="+S0(e.value));return E0(r,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var aA=function(){d0(this,vu);var e=arguments.length>0?arguments[0]:void 0;A0(this,new T0(e))},vu=aA.prototype;if(W6(vu,{append:function(e,t){Fl(arguments.length,2);var r=rs(this);kc(r.entries,{key:fo(e),value:fo(t)}),r.updateURL()},delete:function(e){Fl(arguments.length,1);for(var t=rs(this),r=t.entries,i=fo(e),s=0;s<r.length;)r[s].key===i?_0(r,s,1):s++;t.updateURL()},get:function(e){Fl(arguments.length,1);for(var t=rs(this).entries,r=fo(e),i=0;i<t.length;i++)if(t[i].key===r)return t[i].value;return null},getAll:function(e){Fl(arguments.length,1);for(var t=rs(this).entries,r=fo(e),i=[],s=0;s<t.length;s++)t[s].key===r&&kc(i,t[s].value);return i},has:function(e){Fl(arguments.length,1);for(var t=rs(this).entries,r=fo(e),i=0;i<t.length;)if(t[i++].key===r)return!0;return!1},set:function(e,t){Fl(arguments.length,1);for(var r,i=rs(this),s=i.entries,l=!1,d=fo(e),h=fo(t),p=0;p<s.length;p++)(r=s[p]).key===d&&(l?_0(s,p--,1):(l=!0,r.value=h));l||kc(s,{key:d,value:h}),i.updateURL()},sort:function(){var e=rs(this);e9(e.entries,function(t,r){return t.key>r.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,r=rs(this).entries,i=z6(e,arguments.length>1?arguments[1]:void 0),s=0;s<r.length;)i((t=r[s++]).value,t.key,this)},keys:function(){return new FE(this,"keys")},values:function(){return new FE(this,"values")},entries:function(){return new FE(this,"entries")}},{enumerable:!0}),l0(vu,r9,vu.entries,{name:"entries"}),l0(vu,"toString",function(){return rs(this).serialize()},{enumerable:!0}),Y6(aA,oA),DE({global:!0,forced:!c0},{URLSearchParams:aA}),!c0&&BE(Iu)){var g9=ws(g0.has),m9=ws(g0.set),R0=function(e){if(u0(e)){var t,r=e.body;if(X6(r)===oA)return t=e.headers?new Iu(e.headers):new Iu,g9(t,"content-type")||m9(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),$6(e,{body:h0(0,fo(r)),headers:h0(0,t)})}return e};if(BE(f0)&&DE({global:!0,enumerable:!0,forced:!0},{fetch:function(e){return f0(e,arguments.length>1?R0(arguments[1]):{})}}),BE(sA)){var QE=function(e){return d0(this,UE),new sA(e,arguments.length>1?R0(arguments[1]):{})};UE.constructor=QE,QE.prototype=UE,DE({global:!0,forced:!0},{Request:QE})}}var Lo,E9={URLSearchParams:aA,getState:rs},_9=Ae,VE=Ot,I9=e0,GE=G,y0=Ws,Po=N,v9=Bd.f,cA=cl,C9=ll,jE=gn,HE=yC,Ql=sy,ns=Rg,S9=MS.codeAt,T9=function(e){var t,r,i=[],s=V6(Q6(G6(e),r0,"."),".");for(t=0;t<s.length;t++)r=s[t],Ga(i,F6(x6,r)?"xn--"+H6(r):r);return s0(i,".")},aa=Fi,R9=Da,w0=E9,b0=oo,y9=b0.set,lA=b0.getterFor("URL"),w9=w0.URLSearchParams,b9=w0.getState,Cu=GE.URL,KE=GE.TypeError,dA=GE.parseInt,N9=Math.floor,N0=Math.pow,Bo=Po("".charAt),is=Po(/./.exec),Su=Po([].join),O9=Po(1 .toString),k9=Po([].pop),Vl=Po([].push),O0=Po("".replace),D9=Po([].shift),L9=Po("".split),Tu=Po("".slice),uA=Po("".toLowerCase),P9=Po([].unshift),WE="Invalid scheme",Dc="Invalid host",k0="Invalid port",D0=/[a-z]/i,B9=/[\d+-.a-z]/i,YE=/\d/,M9=/^0x/i,U9=/^[0-7]+$/,x9=/^\d+$/,L0=/^[\da-f]+$/i,F9=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Q9=/[\0\t\n\r #/:<>?@[\\\]^|]/,V9=/^[\u0000-\u0020]+|[\u0000-\u0020]+$/g,G9=/[\t\n\r]/g,Ru=function(e){var t,r,i,s;if(typeof e=="number"){for(t=[],r=0;r<4;r++)P9(t,e%256),e=N9(e/256);return Su(t,".")}if(typeof e=="object"){for(t="",i=function(l){for(var d=null,h=1,p=null,m=0,f=0;f<8;f++)l[f]!==0?(m>h&&(d=p,h=m),p=null,m=0):(p===null&&(p=f),++m);return m>h&&(d=p,h=m),d}(e),r=0;r<8;r++)s&&e[r]===0||(s&&(s=!1),i===r?(t+=r?":":"::",s=!0):(t+=O9(e[r],16),r<7&&(t+=":")));return"["+t+"]"}return e},hA={},P0=HE({},hA,{" ":1,'"':1,"<":1,">":1,"`":1}),B0=HE({},P0,{"#":1,"?":1,"{":1,"}":1}),qE=HE({},B0,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),ja=function(e,t){var r=S9(e,0);return r>32&&r<127&&!jE(t,e)?e:encodeURIComponent(e)},pA={ftp:21,file:null,http:80,https:443,ws:80,wss:443},yu=function(e,t){var r;return e.length==2&&is(D0,Bo(e,0))&&((r=Bo(e,1))==":"||!t&&r=="|")},M0=function(e){var t;return e.length>1&&yu(Tu(e,0,2))&&(e.length==2||(t=Bo(e,2))==="/"||t==="\\"||t==="?"||t==="#")},j9=function(e){return e==="."||uA(e)==="%2e"},JE={},U0={},zE={},x0={},F0={},XE={},Q0={},V0={},AA={},fA={},ZE={},$E={},t_={},e_={},G0={},r_={},Gl={},bs={},j0={},Lc={},ca={},n_=function(e,t,r){var i,s,l,d=aa(e);if(t){if(s=this.parse(d))throw KE(s);this.searchParams=null}else{if(r!==void 0&&(i=new n_(r,!0)),s=this.parse(d,null,i))throw KE(s);(l=b9(new w9)).bindURL(this),this.searchParams=l}};n_.prototype={type:"URL",parse:function(e,t,r){var i,s,l,d,h,p=this,m=t||JE,f=0,_="",v=!1,T=!1,R=!1;for(e=aa(e),t||(p.scheme="",p.username="",p.password="",p.host=null,p.port=null,p.path=[],p.query=null,p.fragment=null,p.cannotBeABaseURL=!1,e=O0(e,V9,"")),e=O0(e,G9,""),i=Ql(e);f<=i.length;){switch(s=i[f],m){case JE:if(!s||!is(D0,s)){if(t)return WE;m=zE;continue}_+=uA(s),m=U0;break;case U0:if(s&&(is(B9,s)||s=="+"||s=="-"||s=="."))_+=uA(s);else{if(s!=":"){if(t)return WE;_="",m=zE,f=0;continue}if(t&&(p.isSpecial()!=jE(pA,_)||_=="file"&&(p.includesCredentials()||p.port!==null)||p.scheme=="file"&&!p.host))return;if(p.scheme=_,t)return void(p.isSpecial()&&pA[p.scheme]==p.port&&(p.port=null));_="",p.scheme=="file"?m=e_:p.isSpecial()&&r&&r.scheme==p.scheme?m=x0:p.isSpecial()?m=V0:i[f+1]=="/"?(m=F0,f++):(p.cannotBeABaseURL=!0,Vl(p.path,""),m=j0)}break;case zE:if(!r||r.cannotBeABaseURL&&s!="#")return WE;if(r.cannotBeABaseURL&&s=="#"){p.scheme=r.scheme,p.path=ns(r.path),p.query=r.query,p.fragment="",p.cannotBeABaseURL=!0,m=ca;break}m=r.scheme=="file"?e_:XE;continue;case x0:if(s!="/"||i[f+1]!="/"){m=XE;continue}m=AA,f++;break;case F0:if(s=="/"){m=fA;break}m=bs;continue;case XE:if(p.scheme=r.scheme,s==Lo)p.username=r.username,p.password=r.password,p.host=r.host,p.port=r.port,p.path=ns(r.path),p.query=r.query;else if(s=="/"||s=="\\"&&p.isSpecial())m=Q0;else if(s=="?")p.username=r.username,p.password=r.password,p.host=r.host,p.port=r.port,p.path=ns(r.path),p.query="",m=Lc;else{if(s!="#"){p.username=r.username,p.password=r.password,p.host=r.host,p.port=r.port,p.path=ns(r.path),p.path.length--,m=bs;continue}p.username=r.username,p.password=r.password,p.host=r.host,p.port=r.port,p.path=ns(r.path),p.query=r.query,p.fragment="",m=ca}break;case Q0:if(!p.isSpecial()||s!="/"&&s!="\\"){if(s!="/"){p.username=r.username,p.password=r.password,p.host=r.host,p.port=r.port,m=bs;continue}m=fA}else m=AA;break;case V0:if(m=AA,s!="/"||Bo(_,f+1)!="/")continue;f++;break;case AA:if(s!="/"&&s!="\\"){m=fA;continue}break;case fA:if(s=="@"){v&&(_="%40"+_),v=!0,l=Ql(_);for(var w=0;w<l.length;w++){var O=l[w];if(O!=":"||R){var B=ja(O,qE);R?p.password+=B:p.username+=B}else R=!0}_=""}else if(s==Lo||s=="/"||s=="?"||s=="#"||s=="\\"&&p.isSpecial()){if(v&&_=="")return"Invalid authority";f-=Ql(_).length+1,_="",m=ZE}else _+=s;break;case ZE:case $E:if(t&&p.scheme=="file"){m=r_;continue}if(s!=":"||T){if(s==Lo||s=="/"||s=="?"||s=="#"||s=="\\"&&p.isSpecial()){if(p.isSpecial()&&_=="")return Dc;if(t&&_==""&&(p.includesCredentials()||p.port!==null))return;if(d=p.parseHost(_))return d;if(_="",m=Gl,t)return;continue}s=="["?T=!0:s=="]"&&(T=!1),_+=s}else{if(_=="")return Dc;if(d=p.parseHost(_))return d;if(_="",m=t_,t==$E)return}break;case t_:if(!is(YE,s)){if(s==Lo||s=="/"||s=="?"||s=="#"||s=="\\"&&p.isSpecial()||t){if(_!=""){var K=dA(_,10);if(K>65535)return k0;p.port=p.isSpecial()&&K===pA[p.scheme]?null:K,_=""}if(t)return;m=Gl;continue}return k0}_+=s;break;case e_:if(p.scheme="file",s=="/"||s=="\\")m=G0;else{if(!r||r.scheme!="file"){m=bs;continue}if(s==Lo)p.host=r.host,p.path=ns(r.path),p.query=r.query;else if(s=="?")p.host=r.host,p.path=ns(r.path),p.query="",m=Lc;else{if(s!="#"){M0(Su(ns(i,f),""))||(p.host=r.host,p.path=ns(r.path),p.shortenPath()),m=bs;continue}p.host=r.host,p.path=ns(r.path),p.query=r.query,p.fragment="",m=ca}}break;case G0:if(s=="/"||s=="\\"){m=r_;break}r&&r.scheme=="file"&&!M0(Su(ns(i,f),""))&&(yu(r.path[0],!0)?Vl(p.path,r.path[0]):p.host=r.host),m=bs;continue;case r_:if(s==Lo||s=="/"||s=="\\"||s=="?"||s=="#"){if(!t&&yu(_))m=bs;else if(_==""){if(p.host="",t)return;m=Gl}else{if(d=p.parseHost(_))return d;if(p.host=="localhost"&&(p.host=""),t)return;_="",m=Gl}continue}_+=s;break;case Gl:if(p.isSpecial()){if(m=bs,s!="/"&&s!="\\")continue}else if(t||s!="?")if(t||s!="#"){if(s!=Lo&&(m=bs,s!="/"))continue}else p.fragment="",m=ca;else p.query="",m=Lc;break;case bs:if(s==Lo||s=="/"||s=="\\"&&p.isSpecial()||!t&&(s=="?"||s=="#")){if((h=uA(h=_))===".."||h==="%2e."||h===".%2e"||h==="%2e%2e"?(p.shortenPath(),s=="/"||s=="\\"&&p.isSpecial()||Vl(p.path,"")):j9(_)?s=="/"||s=="\\"&&p.isSpecial()||Vl(p.path,""):(p.scheme=="file"&&!p.path.length&&yu(_)&&(p.host&&(p.host=""),_=Bo(_,0)+":"),Vl(p.path,_)),_="",p.scheme=="file"&&(s==Lo||s=="?"||s=="#"))for(;p.path.length>1&&p.path[0]==="";)D9(p.path);s=="?"?(p.query="",m=Lc):s=="#"&&(p.fragment="",m=ca)}else _+=ja(s,B0);break;case j0:s=="?"?(p.query="",m=Lc):s=="#"?(p.fragment="",m=ca):s!=Lo&&(p.path[0]+=ja(s,hA));break;case Lc:t||s!="#"?s!=Lo&&(s=="'"&&p.isSpecial()?p.query+="%27":p.query+=s=="#"?"%23":ja(s,hA)):(p.fragment="",m=ca);break;case ca:s!=Lo&&(p.fragment+=ja(s,P0))}f++}},parseHost:function(e){var t,r,i;if(Bo(e,0)=="["){if(Bo(e,e.length-1)!="]"||!(t=function(s){var l,d,h,p,m,f,_,v=[0,0,0,0,0,0,0,0],T=0,R=null,w=0,O=function(){return Bo(s,w)};if(O()==":"){if(Bo(s,1)!=":")return;w+=2,R=++T}for(;O();){if(T==8)return;if(O()!=":"){for(l=d=0;d<4&&is(L0,O());)l=16*l+dA(O(),16),w++,d++;if(O()=="."){if(d==0||(w-=d,T>6))return;for(h=0;O();){if(p=null,h>0){if(!(O()=="."&&h<4))return;w++}if(!is(YE,O()))return;for(;is(YE,O());){if(m=dA(O(),10),p===null)p=m;else{if(p==0)return;p=10*p+m}if(p>255)return;w++}v[T]=256*v[T]+p,++h!=2&&h!=4||T++}if(h!=4)return;break}if(O()==":"){if(w++,!O())return}else if(O())return;v[T++]=l}else{if(R!==null)return;w++,R=++T}}if(R!==null)for(f=T-R,T=7;T!=0&&f>0;)_=v[T],v[T--]=v[R+f-1],v[R+--f]=_;else if(T!=8)return;return v}(Tu(e,1,-1))))return Dc;this.host=t}else if(this.isSpecial()){if(e=T9(e),is(F9,e)||(t=function(s){var l,d,h,p,m,f,_,v=L9(s,".");if(v.length&&v[v.length-1]==""&&v.length--,(l=v.length)>4)return s;for(d=[],h=0;h<l;h++){if((p=v[h])=="")return s;if(m=10,p.length>1&&Bo(p,0)=="0"&&(m=is(M9,p)?16:8,p=Tu(p,m==8?1:2)),p==="")f=0;else{if(!is(m==10?x9:m==8?U9:L0,p))return s;f=dA(p,m)}Vl(d,f)}for(h=0;h<l;h++)if(f=d[h],h==l-1){if(f>=N0(256,5-l))return null}else if(f>255)return null;for(_=k9(d),h=0;h<d.length;h++)_+=d[h]*N0(256,3-h);return _}(e))===null)return Dc;this.host=t}else{if(is(Q9,e))return Dc;for(t="",r=Ql(e),i=0;i<r.length;i++)t+=ja(r[i],hA);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return jE(pA,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme=="file"&&t==1&&yu(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,r=e.username,i=e.password,s=e.host,l=e.port,d=e.path,h=e.query,p=e.fragment,m=t+":";return s!==null?(m+="//",e.includesCredentials()&&(m+=r+(i?":"+i:"")+"@"),m+=Ru(s),l!==null&&(m+=":"+l)):t=="file"&&(m+="//"),m+=e.cannotBeABaseURL?d[0]:d.length?"/"+Su(d,"/"):"",h!==null&&(m+="?"+h),p!==null&&(m+="#"+p),m},setHref:function(e){var t=this.parse(e);if(t)throw KE(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e=="blob")try{return new jl(e.path[0]).origin}catch{return"null"}return e!="file"&&this.isSpecial()?e+"://"+Ru(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(aa(e)+":",JE)},getUsername:function(){return this.username},setUsername:function(e){var t=Ql(aa(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var r=0;r<t.length;r++)this.username+=ja(t[r],qE)}},getPassword:function(){return this.password},setPassword:function(e){var t=Ql(aa(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var r=0;r<t.length;r++)this.password+=ja(t[r],qE)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?Ru(e):Ru(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,ZE)},getHostname:function(){var e=this.host;return e===null?"":Ru(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,$E)},getPort:function(){var e=this.port;return e===null?"":aa(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=aa(e))==""?this.port=null:this.parse(e,t_))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+Su(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Gl))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=aa(e))==""?this.query=null:(Bo(e,0)=="?"&&(e=Tu(e,1)),this.query="",this.parse(e,Lc)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=aa(e))!=""?(Bo(e,0)=="#"&&(e=Tu(e,1)),this.fragment="",this.parse(e,ca)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var jl=function(e){var t=C9(this,gA),r=arguments.length>1?arguments[1]:void 0,i=y9(t,new n_(e,!1,r));VE||(t.href=i.serialize(),t.origin=i.getOrigin(),t.protocol=i.getProtocol(),t.username=i.getUsername(),t.password=i.getPassword(),t.host=i.getHost(),t.hostname=i.getHostname(),t.port=i.getPort(),t.pathname=i.getPathname(),t.search=i.getSearch(),t.searchParams=i.getSearchParams(),t.hash=i.getHash())},gA=jl.prototype,Mo=function(e,t){return{get:function(){return lA(this)[e]()},set:t&&function(r){return lA(this)[t](r)},configurable:!0,enumerable:!0}};if(VE&&v9(gA,{href:Mo("serialize","setHref"),origin:Mo("getOrigin"),protocol:Mo("getProtocol","setProtocol"),username:Mo("getUsername","setUsername"),password:Mo("getPassword","setPassword"),host:Mo("getHost","setHost"),hostname:Mo("getHostname","setHostname"),port:Mo("getPort","setPort"),pathname:Mo("getPathname","setPathname"),search:Mo("getSearch","setSearch"),searchParams:Mo("getSearchParams"),hash:Mo("getHash","setHash")}),cA(gA,"toJSON",function(){return lA(this).serialize()},{enumerable:!0}),cA(gA,"toString",function(){return lA(this).serialize()},{enumerable:!0}),Cu){var H0=Cu.createObjectURL,K0=Cu.revokeObjectURL;H0&&cA(jl,"createObjectURL",y0(H0,Cu)),K0&&cA(jl,"revokeObjectURL",y0(K0,Cu))}R9(jl,"URL"),_9({global:!0,forced:!I9,sham:!VE},{URL:jl});var W0=Ir.URL;function Y0(e,t){var r=ae(e);if(Xt){var i=Xt(e);t&&(i=kt(i).call(i,function(s){return jt(e,s).enumerable})),r.push.apply(r,i)}return r}function q0(e){for(var t=1;t<arguments.length;t++){var r,i,s=arguments[t]!=null?arguments[t]:{};t%2?V(r=Y0(Object(s),!0)).call(r,function(l){mr(e,l,s[l])}):Zt?ur(e,Zt(s)):V(i=Y0(Object(s))).call(i,function(l){ie(e,l,jt(s,l))})}return e}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function t(Y){var $=0;return function(){return $<Y.length?{done:!1,value:Y[$++]}:{done:!0}}}var r=typeof Object.defineProperties=="function"?Object.defineProperty:function(Y,$,mt){return Y==Array.prototype||Y==Object.prototype||(Y[$]=mt.value),Y},i,s=function(Y){Y=[typeof globalThis=="object"&&globalThis,Y,typeof window=="object"&&window,typeof self=="object"&&self,typeof a=="object"&&a];for(var $=0;$<Y.length;++$){var mt=Y[$];if(mt&&mt.Math==Math)return mt}throw Error("Cannot find global object")}(this);function l(Y,$){if($)t:{var mt=s;Y=Y.split(".");for(var ot=0;ot<Y.length-1;ot++){var Lt=Y[ot];if(!(Lt in mt))break t;mt=mt[Lt]}($=$(ot=mt[Y=Y[Y.length-1]]))!=ot&&$!=null&&r(mt,Y,{configurable:!0,writable:!0,value:$})}}function d(Y){return(Y={next:Y})[Symbol.iterator]=function(){return this},Y}function h(Y){var $=typeof Symbol!="undefined"&&Symbol.iterator&&Y[Symbol.iterator];return $?$.call(Y):{next:t(Y)}}if(l("Symbol",function(Y){function $(Lt,at){this.A=Lt,r(this,"description",{configurable:!0,writable:!0,value:at})}if(Y)return Y;$.prototype.toString=function(){return this.A};var mt="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",ot=0;return function Lt(at){if(this instanceof Lt)throw new TypeError("Symbol is not a constructor");return new $(mt+(at||"")+"_"+ot++,at)}}),l("Symbol.iterator",function(Y){if(Y)return Y;Y=Symbol("Symbol.iterator");for(var $="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),mt=0;mt<$.length;mt++){var ot=s[$[mt]];typeof ot=="function"&&typeof ot.prototype[Y]!="function"&&r(ot.prototype,Y,{configurable:!0,writable:!0,value:function(){return d(t(this))}})}return Y}),typeof Object.setPrototypeOf=="function")i=Object.setPrototypeOf;else{var p;t:{var m={};try{m.__proto__={a:!0},p=m.a;break t}catch{}p=!1}i=p?function(Y,$){if(Y.__proto__=$,Y.__proto__!==$)throw new TypeError(Y+" is not extensible");return Y}:null}var f=i;function _(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function v(Y){if(Y.m)throw new TypeError("Generator is already running");Y.m=!0}function T(Y,$){return Y.h=3,{value:$}}function R(Y){this.g=new _,this.G=Y}function w(Y,$,mt,ot){try{var Lt=$.call(Y.g.j,mt);if(!(Lt instanceof Object))throw new TypeError("Iterator result "+Lt+" is not an object");if(!Lt.done)return Y.g.m=!1,Lt;var at=Lt.value}catch(y){return Y.g.j=null,Y.g.s(y),O(Y)}return Y.g.j=null,ot.call(Y.g,at),O(Y)}function O(Y){for(;Y.g.h;)try{var $=Y.G(Y.g);if($)return Y.g.m=!1,{value:$.value,done:!1}}catch(mt){Y.g.v=void 0,Y.g.s(mt)}if(Y.g.m=!1,Y.g.l){if($=Y.g.l,Y.g.l=null,$.F)throw $.D;return{value:$.return,done:!0}}return{value:void 0,done:!0}}function B(Y){this.next=function($){return Y.o($)},this.throw=function($){return Y.s($)},this.return=function($){return function(mt,ot){v(mt.g);var Lt=mt.g.j;return Lt?w(mt,"return"in Lt?Lt.return:function(at){return{value:at,done:!0}},ot,mt.g.return):(mt.g.return(ot),O(mt))}(Y,$)},this[Symbol.iterator]=function(){return this}}function K(Y,$){return $=new B(new R($)),f&&Y.prototype&&f($,Y.prototype),$}if(_.prototype.o=function(Y){this.v=Y},_.prototype.s=function(Y){this.l={D:Y,F:!0},this.h=this.C||this.u},_.prototype.return=function(Y){this.l={return:Y},this.h=this.u},R.prototype.o=function(Y){return v(this.g),this.g.j?w(this,this.g.j.next,Y,this.g.o):(this.g.o(Y),O(this))},R.prototype.s=function(Y){return v(this.g),this.g.j?w(this,this.g.j.throw,Y,this.g.o):(this.g.s(Y),O(this))},l("Array.prototype.entries",function(Y){return Y||function(){return function($,mt){$ instanceof String&&($+="");var ot=0,Lt=!1,at={next:function(){if(!Lt&&ot<$.length){var y=ot++;return{value:mt(y,$[y]),done:!1}}return Lt=!0,{done:!0,value:void 0}}};return at[Symbol.iterator]=function(){return at},at}(this,function($,mt){return[$,mt]})}}),typeof Blob!="undefined"&&(typeof FormData=="undefined"||!FormData.prototype.keys)){var j=function(Y,$){for(var mt=0;mt<Y.length;mt++)$(Y[mt])},nt=function(Y){return Y.replace(/\r?\n|\r/g,`\r
`)},It=function(Y,$,mt){return $ instanceof Blob?(mt=mt!==void 0?String(mt+""):typeof $.name=="string"?$.name:"blob",$.name===mt&&Object.prototype.toString.call($)!=="[object Blob]"||($=new File([$],mt)),[String(Y),$]):[String(Y),String($)]},vt=function(Y,$){if(Y.length<$)throw new TypeError($+" argument required, but only "+Y.length+" present.")},Rt=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,X=Rt.FormData,rt=Rt.XMLHttpRequest&&Rt.XMLHttpRequest.prototype.send,H=Rt.Request&&Rt.fetch,W=Rt.navigator&&Rt.navigator.sendBeacon,U=Rt.Element&&Rt.Element.prototype,Ct=Rt.Symbol&&Symbol.toStringTag;Ct&&(Blob.prototype[Ct]||(Blob.prototype[Ct]="Blob"),"File"in Rt&&!File.prototype[Ct]&&(File.prototype[Ct]="File"));try{new File([],"")}catch{Rt.File=function($,mt,ot){return $=new Blob($,ot||{}),Object.defineProperties($,{name:{value:mt},lastModified:{value:+(ot&&ot.lastModified!==void 0?new Date(ot.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),Ct&&Object.defineProperty($,Ct,{value:"File"}),$}}var Et=function(Y){return Y.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},gt=function(Y){this.i=[];var $=this;Y&&j(Y.elements,function(mt){if(mt.name&&!mt.disabled&&mt.type!=="submit"&&mt.type!=="button"&&!mt.matches("form fieldset[disabled] *"))if(mt.type==="file"){var ot=mt.files&&mt.files.length?mt.files:[new File([],"",{type:"application/octet-stream"})];j(ot,function(Lt){$.append(mt.name,Lt)})}else mt.type==="select-multiple"||mt.type==="select-one"?j(mt.options,function(Lt){!Lt.disabled&&Lt.selected&&$.append(mt.name,Lt.value)}):mt.type==="checkbox"||mt.type==="radio"?mt.checked&&$.append(mt.name,mt.value):(ot=mt.type==="textarea"?nt(mt.value):mt.value,$.append(mt.name,ot))})};if((e=gt.prototype).append=function(Y,$,mt){vt(arguments,2),this.i.push(It(Y,$,mt))},e.delete=function(Y){vt(arguments,1);var $=[];Y=String(Y),j(this.i,function(mt){mt[0]!==Y&&$.push(mt)}),this.i=$},e.entries=function Y(){var $,mt=this;return K(Y,function(ot){if(ot.h==1&&($=0),ot.h!=3)return $<mt.i.length?ot=T(ot,mt.i[$]):(ot.h=0,ot=void 0),ot;$++,ot.h=2})},e.forEach=function(Y,$){vt(arguments,1);for(var mt=h(this),ot=mt.next();!ot.done;ot=mt.next()){var Lt=h(ot.value);ot=Lt.next().value,Lt=Lt.next().value,Y.call($,Lt,ot,this)}},e.get=function(Y){vt(arguments,1);var $=this.i;Y=String(Y);for(var mt=0;mt<$.length;mt++)if($[mt][0]===Y)return $[mt][1];return null},e.getAll=function(Y){vt(arguments,1);var $=[];return Y=String(Y),j(this.i,function(mt){mt[0]===Y&&$.push(mt[1])}),$},e.has=function(Y){vt(arguments,1),Y=String(Y);for(var $=0;$<this.i.length;$++)if(this.i[$][0]===Y)return!0;return!1},e.keys=function Y(){var $,mt,ot,Lt,at=this;return K(Y,function(y){if(y.h==1&&($=h(at),mt=$.next()),y.h!=3)return mt.done?void(y.h=0):(ot=mt.value,Lt=h(ot),T(y,Lt.next().value));mt=$.next(),y.h=2})},e.set=function(Y,$,mt){vt(arguments,2),Y=String(Y);var ot=[],Lt=It(Y,$,mt),at=!0;j(this.i,function(y){y[0]===Y?at&&(at=!ot.push(Lt)):ot.push(y)}),at&&ot.push(Lt),this.i=ot},e.values=function Y(){var $,mt,ot,Lt,at=this;return K(Y,function(y){if(y.h==1&&($=h(at),mt=$.next()),y.h!=3)return mt.done?void(y.h=0):(ot=mt.value,(Lt=h(ot)).next(),T(y,Lt.next().value));mt=$.next(),y.h=2})},gt.prototype._asNative=function(){for(var Y=new X,$=h(this),mt=$.next();!mt.done;mt=$.next()){var ot=h(mt.value);mt=ot.next().value,ot=ot.next().value,Y.append(mt,ot)}return Y},gt.prototype._blob=function(){var Y="----formdata-polyfill-"+Math.random(),$=[],mt="--"+Y+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(ot,Lt){return typeof ot=="string"?$.push(mt+Et(nt(Lt))+`"\r
\r
`+nt(ot)+`\r
`):$.push(mt+Et(nt(Lt))+'"; filename="'+Et(ot.name)+`"\r
Content-Type: `+(ot.type||"application/octet-stream")+`\r
\r
`,ot,`\r
`)}),$.push("--"+Y+"--"),new Blob($,{type:"multipart/form-data; boundary="+Y})},gt.prototype[Symbol.iterator]=function(){return this.entries()},gt.prototype.toString=function(){return"[object FormData]"},U&&!U.matches&&(U.matches=U.matchesSelector||U.mozMatchesSelector||U.msMatchesSelector||U.oMatchesSelector||U.webkitMatchesSelector||function(Y){for(var $=(Y=(this.document||this.ownerDocument).querySelectorAll(Y)).length;0<=--$&&Y.item($)!==this;);return-1<$}),Ct&&(gt.prototype[Ct]="FormData"),rt){var Mt=Rt.XMLHttpRequest.prototype.setRequestHeader;Rt.XMLHttpRequest.prototype.setRequestHeader=function(Y,$){Mt.call(this,Y,$),Y.toLowerCase()==="content-type"&&(this.B=!0)},Rt.XMLHttpRequest.prototype.send=function(Y){Y instanceof gt?(Y=Y._blob(),this.B||this.setRequestHeader("Content-Type",Y.type),rt.call(this,Y)):rt.call(this,Y)}}H&&(Rt.fetch=function(Y,$){return $&&$.body&&$.body instanceof gt&&($.body=$.body._blob()),H.call(this,Y,$)}),W&&(Rt.navigator.sendBeacon=function(Y,$){return $ instanceof gt&&($=$._asNative()),W.call(this,Y,$)}),Rt.FormData=gt}})();let i_=1;function H9(e,t,r,i,s){i_+=1;const l={sid:r.sid,command:"convergeAllocateEdge",uid:"666",appId:r.appId,ts:Math.floor(ht()/1e3),seq:i_,requestId:i_,version:Tn,cname:r.cname},d={service_name:t,json_body:St(l)};let h,p,m=e[0];return Wn(async()=>{h=ht();const f=await yn(m,{data:d,cancelToken:i,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(p=ht()-h,f.code!==0){const R=new P(D.UNEXPECTED_RESPONSE,"live streaming ap error, code"+f.code,{retry:!0,responseTime:p});throw S.error(R.toString()),R}const _=JSON.parse(f.json_body);if(_.code!==200){var v;const R=new P(D.UNEXPECTED_RESPONSE,k(v="live streaming app center error, code: ".concat(_.code,", reason: ")).call(v,_.reason),{code:_.code,responseTime:p});throw S.error(R.toString()),R}if(!_.servers||_.servers.length===0){const R=new P(D.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:_.code,responseTime:p});throw S.error(R.toString()),R}const T=function(R,w){var O;return{addressList:pt(O=R.servers).call(O,B=>{var K,j,nt;return k(K=k(j=k(nt="wss://".concat(B.address.replace(/\./g,"-"),".")).call(nt,it("WORKER_DOMAIN"),":")).call(j,B.wss,"?serviceName=")).call(K,encodeURIComponent(w))}),workerToken:R.workerToken,vid:R.vid}}(_,t);return it("LIVE_STREAMING_ADDRESS")&&(T.addressList=it("LIVE_STREAMING_ADDRESS")instanceof Array?it("LIVE_STREAMING_ADDRESS"):[it("LIVE_STREAMING_ADDRESS")]),q0(q0({},T),{},{responseTime:p})},(f,_)=>(At.apworkerEvent(r.sid,{success:!0,sc:200,serviceName:t,responseDetail:St(f.addressList),firstSuccess:_===0,responseTime:p,serverIp:e[_%e.length]}),!1),(f,_)=>(At.apworkerEvent(r.sid,{success:!1,sc:f.data&&f.data.code||200,serviceName:t,responseTime:p,serverIp:e[_%e.length]}),!!(f.code!==D.OPERATION_ABORTED&&f.code!==D.UNEXPECTED_RESPONSE||f.data&&f.data.retry)&&(m=e[(_+1)%e.length],!0)),s)}let o_=1;function J0(e,t,r,i){let{url:s,areaCode:l}=e;const d=ht(),[h,p]=$0(t,l,[ei.CHOOSE_SERVER]);let m=Rr.networkState;return Wn(async()=>{m&&Rr.networkState===lo.OFFLINE&&Rr.onlineWaiter&&await ct.race([Rr.onlineWaiter,Mr(i&&i.maxRetryTimeout||Ne.maxRetryTimeout)]),m=Rr.networkState;const f=await yn(s,{data:h,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0);At.reportResourceTiming(s,t.sid),X0(f,s,t,d,[ei.CHOOSE_SERVER]);const _=EE(f,ei.CHOOSE_SERVER);return Z0(_),Oy(_,s)},f=>(f&&At.joinChooseServer(t.sid,{lts:d,succ:!0,csAddr:s,opid:p,serverList:f.gatewayAddrs,ec:null,cid:f.cid.toString(),uid:f.uid.toString(),csIp:f.csIp,unilbsServerIds:[ei.CHOOSE_SERVER].toString()}),!1),f=>f.code!==D.OPERATION_ABORTED&&(f.code===D.CAN_NOT_GET_GATEWAY_SERVER?f.data.retry:(At.joinChooseServer(t.sid,{lts:d,succ:!1,csAddr:s,serverList:null,opid:p,ec:f.code,csIp:f.data&&f.data.csIp,unilbsServerIds:[ei.CHOOSE_SERVER].toString(),extend:St({networkState:m})}),S.warning("[".concat(t.clientId,"] Choose server network error, retry"),f),!0)),i)}function z0(e,t,r,i){let{url:s,areaCode:l,serviceIds:d}=e;const h=ht(),[p,m]=$0(t,l,d);let f;return Wn(async()=>{f&&Rr.networkState===lo.OFFLINE&&Rr.onlineWaiter&&await ct.race([Rr.onlineWaiter,Mr(i&&i.maxRetryTimeout||Ne.maxRetryTimeout)]),f=Rr.networkState;const _=await yn(s,{data:p,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0);At.reportResourceTiming(s,t.sid),X0(_,s,t,h,d);const v=EE(_,ei.CHOOSE_SERVER),T=EE(_,t.cloudProxyServer==="proxy5"?ei.CLOUD_PROXY_5:ei.CLOUD_PROXY);return Z0(v),{gatewayInfo:Oy(v,s),proxyInfo:T,url:s}},_=>{var v;return _.gatewayInfo&&At.joinChooseServer(t.sid,{lts:h,succ:!0,csAddr:s,serverList:_.gatewayInfo.gatewayAddrs,ec:null,opid:m,cid:_.gatewayInfo.cid.toString(),uid:_.gatewayInfo.uid.toString(),csIp:_.gatewayInfo.csIp,unilbsServerIds:d.toString()}),_.proxyInfo&&At.joinWebProxyAP(t.sid,{lts:h,sucess:1,apServerAddr:s,turnServerAddrList:pt(v=_.proxyInfo.addresses).call(v,T=>T.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:d.toString()}),!1},_=>_.code!==D.OPERATION_ABORTED&&(_.code===D.CAN_NOT_GET_GATEWAY_SERVER?_.data.retry:(At.joinWebProxyAP(t.sid,{lts:h,sucess:0,apServerAddr:s,turnServerAddrList:null,errorCode:_.code,eventType:t.cloudProxyServer,unilbsServerIds:d.toString(),extend:St({networkState:f})}),S.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),_),!0)),i)}const X0=(e,t,r,i,s)=>{var l,d,h;const p=[];if(V(l=e.response_body).call(l,m=>{const f=m.buffer.code;if(f!==0){const _=oa(f),v={error:new P(D.CAN_NOT_GET_GATEWAY_SERVER,_.desc,{retry:_.retry,csIp:e.detail[502]}),flag:m.buffer.flag};p.push(v),v.flag===4096?At.joinChooseServer(r.sid,{lts:i,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:v.error.message,csIp:v.error.data&&v.error.data.csIp,unilbsServerIds:s.toString()}):v.flag!==1048576&&v.flag!==4194304||At.joinWebProxyAP(r.sid,{lts:i,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:v.error.code,eventType:r.cloudProxyServer,unilbsServerIds:s.toString()})}}),p.length)throw S.warning(k(d=k(h="[".concat(r.clientId,"] multi unilbs ")).call(h,t," failed, ")).call(d,pt(p).call(p,m=>{var f,_;return k(f=k(_="flag: ".concat(m.flag,", message: ")).call(_,m.error.message,", retry: ")).call(f,m.error.data.retry)}).join(" | "))),new P(D.CAN_NOT_GET_GATEWAY_SERVER,pt(p).call(p,m=>{var f;return k(f="flag: ".concat(m.flag,", message: ")).call(f,m.error.message)}).join(" | "),{retry:!!ft(p).call(p,m=>m.error.data.retry),csIp:e.detail[502]})},Z0=e=>{if(e.addresses&&e.addresses.length===0&&e.code===0)throw new P(D.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(it("GATEWAY_ADDRESS")&&it("GATEWAY_ADDRESS").length>0){var t;S.debug("assign gateway address to",it("GATEWAY_ADDRESS"));const r=pt(t=it("GATEWAY_ADDRESS")).call(t,i=>({ip:i.ip,port:i.port,ticket:e.addresses[0]&&e.addresses[0].ticket}));e.addresses=r}},K9=(e,t)=>{if(e.response_body&&e.response_body.length){const i=e.response_body[0];if(i.buffer.code!==0){var r;const s=oa(i.buffer.code);throw new P(D.UPDATE_TICKET_FAILED,k(r="[".concat(i.buffer.code,"]: ")).call(r,s.desc),{retry:s.retry})}return i.buffer.ticket}throw S.debug("update ticket request received ap response without response body:",t),new P(D.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},$0=(e,t,r)=>{var i;const s=Math.floor(Math.random()*1e12),l={appid:e.appId,client_ts:ht(),opid:s,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:{6:e.stringUid,11:t,12:it("USE_NEW_TOKEN")?"1":void 0},key:e.token,service_ids:r,uid:e.uid||0}}]};V(i=l.request_bodies).call(i,h=>{e.multiIP&&e.multiIP.gateway_ip&&(h.buffer.detail[5]=St({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const d=new FormData;return d.append("request",St(l)),[d,s]},W9=(e,t)=>{var r;const i=Math.floor(Math.random()*1e12),s={appid:e.appId,client_ts:ht(),opid:i,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:pt(r=e.apResponse.addresses).call(r,d=>({ip:d.ip,port:d.port}))}}]},l=new FormData;return l.append("request",St(s)),[l,i]},Ns=()=>{const e=it("AREAS");return e.length===0&&e.push("GLOBAL"),Gh(e).call(e,(t,r,i)=>{const s=Y9(r);var l;return s?i===0?s:k(l="".concat(t,",")).call(l,s):t},"")},Y9=e=>{var t,r,i,s,l;return e==="OVERSEA"?k(t=k(r=k(i=k(s=k(l="".concat(En.ASIA,",")).call(l,En.EUROPE,",")).call(s,En.AFRICA,",")).call(i,En.NORTH_AMERICA,",")).call(r,En.SOUTH_AMERICA,",")).call(t,En.OCEANIA):En[e]},mA={GLOBAL:{ASIA:["CHINA","JAPAN","INDIA","KOREA"],EUROPE:[],NORTH_AMERICA:[],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},Hl=ae(mA.GLOBAL),EA=["CHINA","NORTH_AMERICA","EUROPE","ASIA","JAPAN","INDIA","OCEANIA","SOUTH_AMERICA","AFRICA","KOREA"],q9=function(e,t){let r=[];if(qt(e).call(e,"GLOBAL")){const s=["GLOBAL","OVERSEA"],l=ae(Wm);if(t==="GLOBAL")throw new P(D.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t==="CHINA")r=["OVERSEA"];else if(i=t,qt(Hl).call(Hl,i)){const d=mA.GLOBAL[t]||[],h=[...s,t,...d];r=kt(l).call(l,p=>!qt(h).call(h,p))}else if(function(d){let h=!1;return V(Hl).call(Hl,p=>{var m;qt(m=mA.GLOBAL[p]).call(m,d)&&(h=!0)}),h}(t)){const d=function(p){let m;return V(Hl).call(Hl,f=>{var _;qt(_=mA.GLOBAL[f]).call(_,p)&&(m=f)}),m}(t),h=[...s,d,t];r=kt(l).call(l,p=>!qt(h).call(h,p))}else r=e;r=function(d){const h=[];return V(EA).call(EA,p=>{qt(d).call(d,p)&&h.push(p)}),k(h).call(h,kt(d).call(d,p=>!qt(EA).call(EA,p)))}(r)}else r=e;var i;return r};function tw(e){const t=At.reportApiInvoke(null,{name:Ht.SET_AREA,options:e,tag:Wt.TRACER});try{var r;let i=[];if(typeof e=="string"&&(i=[e]),tn(e)&&(V(e).call(e,l=>{if(!qt(PR).call(PR,l))throw new P(D.INVALID_PARAMS,"invalid area code")}),i=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:l,excludedArea:d}=e;if(!l)throw new P(D.INVALID_PARAMS,"area code is needed");let h=l;typeof l=="string"&&(h=[l]),i=d?q9(h,d):h}jr("AREAS",i);const s=(l=>{const d={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return pt(l).call(l,h=>{const p=Wm[h],m=ae(p);m&&pt(m).call(m,f=>{var _;f!=="CODE"&&(d[f]=k(_=d[f]).call(_,p[f]))})}),d})(i);pt(r=ae(s)).call(r,l=>{l==="LOG_UPLOAD_SERVER"||l==="EVENT_REPORT_DOMAIN"||l==="EVENT_REPORT_BACKUP_DOMAIN"||l==="PROXY_SERVER_TYPE3"?jr(l,s[l][0]):jr(l,s[l])}),S.debug("set area success:",i.join(","))}catch(i){throw t.onError(i),i}t.onSuccess()}async function wu(e,t,r){return{gatewayInfo:await async function(s,l,d){var h,p;const m=pt(h=rn(p=it("WEBCS_DOMAIN")).call(p,0,it("AJAX_REQUEST_CONCURRENT"))).call(h,R=>{var w;return{url:s.proxyServer?k(w="https://".concat(s.proxyServer,"/ap/?url=")).call(w,R+"/api/v2/transpond/webrtc?v=2"):"https://".concat(R,"/api/v2/transpond/webrtc?v=2"),areaCode:Ns()}});let f=null;const _=[],v=async()=>await Ao({fragementLength:it("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:R=>(S.debug("[".concat(s.clientId,"] Connect to choose_server:"),R.url),J0(R,s,l,d)),allFailedhandler:R=>{throw R[0]},promisesCollector:_}),T=async()=>{var R;if(await Mr(1e3),f!==null)return f;const w=pt(R=it("WEBCS_DOMAIN_BACKUP_LIST")).call(R,O=>{var B;return{url:s.proxyServer?k(B="https://".concat(s.proxyServer,"/ap/?url=")).call(B,O+"/api/v2/transpond/webrtc?v=2"):"https://".concat(O,"/api/v2/transpond/webrtc?v=2"),areaCode:Ns()}});return await Ao({fragementLength:it("FRAGEMENT_LENGTH"),referenceList:w,asyncMapHandler:O=>(S.debug("[".concat(s.clientId,"] Connect to backup choose_server:"),O.url),J0(O,s,l,d)),allFailedhandler:O=>{throw O[0]},promisesCollector:_})};try{return f=await Rs([v(),T()]),_.length&&V(_).call(_,R=>R.cancel&&typeof R.cancel=="function"&&R.cancel()),f}catch(R){throw R[0]}}(e,t,r)}}async function s_(e,t,r,i){var s,l;if(e.cloudProxyServer==="disabled")return i?await wu(e,t,r):void 0;let d;if(e.cloudProxyServer==="443only"||e.cloudProxyServer==="normal"){var h;let p;i?e.cloudProxyServer!=="normal"?[p,d]=await ct.all([_A(e,t,r),wu(e,t,r)]):(p=await _A(e,t,r),e.proxyServer=p.addresses[0],At.setProxyServer(e.proxyServer),S.setProxyServer(e.proxyServer),d=await wu(e,t,r)):(d=void 0,e.cloudProxyServer!=="normal"?p=await _A(e,t,r):(p=await _A(e,t,r),e.proxyServer=p.addresses[0],At.setProxyServer(e.proxyServer),S.setProxyServer(e.proxyServer))),e.turnServer={mode:"manual",servers:pt(h=p.addresses).call(h,m=>({turnServerURL:m,tcpport:e.cloudProxyServer==="proxy3"?void 0:p.serverResponse.tcpport?p.serverResponse.tcpport:qe.tcpport,udpport:e.cloudProxyServer==="proxy4"?void 0:p.serverResponse.udpport?p.serverResponse.udpport:qe.udpport,username:p.serverResponse.username||qe.username,password:p.serverResponse.password||qe.password,forceturn:e.cloudProxyServer!=="proxy4"&&e.cloudProxyServer!=="proxy5",security:e.cloudProxyServer==="proxy5"}))}}else{const{proxyInfo:p,gatewayInfo:m}=await async function(f,_,v){var T,R;const w=it("PROXY_SERVER_TYPE3"),O=(rt,H)=>{var W;let U=w;return tn(U)&&(U=H%2==0?w[1]:w[0]),k(W="https://".concat(U,"/ap/?url=")).call(W,rt)},B=pt(T=rn(R=it("WEBCS_DOMAIN")).call(R,0,it("AJAX_REQUEST_CONCURRENT"))).call(T,(rt,H)=>({url:O("".concat(rt,"/api/v2/transpond/webrtc?v=2"),H),areaCode:Ns(),serviceIds:[ei.CHOOSE_SERVER,f.cloudProxyServer==="proxy5"?ei.CLOUD_PROXY_5:ei.CLOUD_PROXY]}));let K=null;const j=[],nt=async()=>await Ao({fragementLength:it("FRAGEMENT_LENGTH"),referenceList:B,asyncMapHandler:rt=>(S.debug("[".concat(f.clientId,"] Connect to choose_server:"),rt.url),z0(rt,f,_,v)),allFailedhandler:rt=>{throw rt[0]},promisesCollector:j}),It=async()=>{var rt;if(await Mr(1e3),K!==null)return K;const H=pt(rt=it("WEBCS_DOMAIN_BACKUP_LIST")).call(rt,(W,U)=>({url:O("".concat(W,"/api/v2/transpond/webrtc?v=2"),U),areaCode:Ns(),serviceIds:[11,18]}));return await Ao({fragementLength:it("FRAGEMENT_LENGTH"),referenceList:H,asyncMapHandler:W=>(S.debug("[".concat(f.clientId,"] Connect to backup choose_server:"),W.url),z0(W,f,_,v)),allFailedhandler:W=>{throw W[0]},promisesCollector:j})};let vt,Rt,X;try{({gatewayInfo:vt,proxyInfo:Rt,url:X}=await Rs([nt(),It()]))}catch(rt){throw rt[0]}if(j.length&&V(j).call(j,rt=>rt.cancel&&typeof rt.cancel=="function"&&rt.cancel()),!vt||!Rt)throw new P(D.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(tn(w)&&X){const rt=new W0(X).host;qt(w).call(w,rt)&&(f.proxyServer=rt,S.setProxyServer(rt),At.setProxyServer(rt))}return K={gatewayInfo:vt,proxyInfo:await N8(Rt,vt.uid)},K}(e,t,r);d={gatewayInfo:m},e.turnServer={mode:"manual",servers:pt(p).call(p,f=>({turnServerURL:f.address,tcpport:e.cloudProxyServer==="proxy3"?void 0:f.tcpport?f.tcpport:qe.tcpport,udpport:e.cloudProxyServer==="proxy4"?void 0:f.udpport?f.udpport:qe.udpport,username:f.username||qe.username,password:f.password||qe.password,forceturn:e.cloudProxyServer!=="proxy4"&&e.cloudProxyServer!=="proxy5",security:e.cloudProxyServer==="proxy5"}))}}return S.debug(k(s=k(l="[".concat(e.clientId,"] set proxy server: ")).call(l,e.proxyServer,", mode: ")).call(s,e.cloudProxyServer)),d}async function a_(e,t,r,i){var s;const l=rn(s=it("ACCOUNT_REGISTER")).call(s,0,it("AJAX_REQUEST_CONCURRENT"));let d=[];return d=t.proxyServer?pt(l).call(l,h=>{var p;return k(p="https://".concat(t.proxyServer,"/ap/?url=")).call(p,h+"/api/v1")}):pt(l).call(l,h=>"https://".concat(h,"/api/v1")),(await async function(h,p,m,f,_){const v=ht(),T={sid:m.sid,opid:10,appid:m.appId,string_uid:p};let R=h[0];const w=await Wn(()=>yn(R+"".concat(xt(R).call(R,"?")===-1?"?":"&","action=stringuid"),{data:T,cancelToken:f,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(O,B)=>{if(O.code===0){var K;if(O.uid<=0||O.uid>=Math.pow(2,32))throw S.error(k(K="Invalid Uint Uid ".concat(p," => ")).call(K,O.uid),O),At.reqUserAccount(T.sid,{lts:v,success:!1,serverAddr:R,stringUid:T.string_uid,uid:O.uid,errorCode:D.INVALID_UINT_UID_FROM_STRING_UID,extend:T}),new P(D.INVALID_UINT_UID_FROM_STRING_UID);return At.reqUserAccount(T.sid,{lts:v,success:!0,serverAddr:R,stringUid:T.string_uid,uid:O.uid,errorCode:null,extend:T}),!1}const j=oa(O.code);return j.retry&&(R=h[(B+1)%h.length]),At.reqUserAccount(T.sid,{lts:v,success:!1,serverAddr:R,stringUid:T.string_uid,uid:O.uid,errorCode:j.desc,extend:T}),j.retry},(O,B)=>O.code!==D.OPERATION_ABORTED&&(At.reqUserAccount(T.sid,{lts:v,success:!1,serverAddr:R,stringUid:T.string_uid,uid:null,errorCode:O.code,extend:T}),R=h[(B+1)%h.length],!0),_);if(w.code!==0){const O=oa(w.code);throw new P(D.UNEXPECTED_RESPONSE,O.desc)}return w}(d,e,t,r,i)).uid}async function _A(e,t,r){var i,s;let l=ht();const d=pt(i=it(e.cloudProxyServer==="normal"?"PROXY_CS":"WEBCS_DOMAIN")).call(i,v=>{var T;return e.proxyServer?k(T="https://".concat(e.proxyServer,"/ap/?url=")).call(T,v+"/api/v1"):"https://".concat(v,"/api/v1")});if(e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"||e.cloudProxyServer==="proxy5"){const v=pt(d).call(d,w=>({url:w,areaCode:Ns()}));let T=null;T=await Ao({fragementLength:it("FRAGEMENT_LENGTH"),referenceList:v,asyncMapHandler:w=>function(O,B,K,j){let{url:nt,areaCode:It}=O;const vt=ht(),Rt={opid:133,flag:B.cloudProxyServer==="proxy5"?4194304:1048576,ts:+new Date,key:B.token,cname:B.cname,sid:B.sid,detail:{6:B.stringUid,11:It},uid:B.uid||0};return Wn(async()=>await yn(nt,{data:Rt,cancelToken:K,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":69}}),X=>{var rt;if(X.code===0)return At.joinWebProxyAP(B.sid,{lts:vt,sucess:1,apServerAddr:nt,turnServerAddrList:pt(rt=X.addresses).call(rt,W=>W.ip).join(","),errorCode:null,eventType:B.cloudProxyServer}),!1;const H=oa(X.code);throw new P(D.CAN_NOT_GET_GATEWAY_SERVER,H.desc,{retry:H.retry})},X=>{return X.code!==D.OPERATION_ABORTED&&(X.code===D.CAN_NOT_GET_GATEWAY_SERVER?(At.joinWebProxyAP(Rt.sid,{lts:vt,sucess:0,apServerAddr:nt,turnServerAddrList:null,errorCode:X.code,eventType:B.cloudProxyServer}),S.warning(k(rt=k(H=k(W="[".concat(B.clientId,"] proxy ap server ")).call(W,nt," failed, message: ")).call(H,X.message,", retry: ")).call(rt,X.data.retry)),X.data.retry):(At.joinWebProxyAP(Rt.sid,{lts:vt,sucess:0,apServerAddr:nt,turnServerAddrList:null,errorCode:X.code,eventType:B.cloudProxyServer}),!0));var rt,H,W},j)}(w,e,t,r),allFailedhandler:()=>{throw S.error("[".concat(e.clientId,"] can not get proxy server after trying several times")),new P(D.CAN_NOT_GET_PROXY_SERVER)}});const R=T.addresses;if(!R||R.length===0)throw S.error("[".concat(e.clientId,"] can not get proxy server, empty proxy server list")),new P(D.CAN_NOT_GET_PROXY_SERVER,"empty proxy server list");return{addresses:pt(R).call(R,w=>w.ip),serverResponse:{tcpport:R[0].port||443,udpport:R[0].port||qe.udpport,username:qe.username,password:qe.password}}}let h=null;h=await Ao({fragementLength:it("FRAGEMENT_LENGTH"),referenceList:d,asyncMapHandler:v=>function(T,R,w,O){const B=ht(),K={command:"convergeAllocateEdge",sid:R.sid,appId:R.appId,token:R.token,uid:R.uid,cname:R.cname,ts:Math.floor(ht()/1e3),version:Tn,seq:0,requestId:1};return Wn(async()=>({res:await yn(T,{data:{service_name:"webrtc_proxy",json_body:St(K)},cancelToken:w,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}}),url:T}),j=>{if(!j.res.json_body)throw S.debug("[".concat(R.clientId,"] Get proxy server failed: no json_body")),new P(D.UNEXPECTED_RESPONSE,St(j.res));const nt=JSON.parse(j.res.json_body);var It,vt;if(nt.code!==200)throw S.debug(k(It=k(vt="[".concat(R.clientId,"] Get proxy server failed: response code [")).call(vt,nt.code,"], reason [")).call(It,nt.reason,"]")),new P(D.UNEXPECTED_RESPONSE,St(j.res));return S.debug("[".concat(R.clientId,"] App return server length"),nt.servers.length),!1},j=>j.code!==D.OPERATION_ABORTED&&(At.requestProxyAppCenter(K.sid,{lts:B,succ:!1,APAddr:T,workerManagerList:null,ec:j.code,response:j.message}),!0),O)}(v,e,t,r),allFailedhandler:()=>{throw S.error("[".concat(e.clientId,"] can not get proxy server after trying several times")),new P(D.CAN_NOT_GET_PROXY_SERVER)}});const p=JSON.parse(h.res.json_body),m=pt(s=p.servers).call(s,b8);if(e.cloudProxyServer==="443only")return{addresses:m,serverResponse:{tcpport:443,udpport:qe.udpport,username:qe.username,password:qe.password}};At.requestProxyAppCenter(e.sid,{lts:l,succ:!0,APAddr:h.url,workerManagerList:St(m),ec:null,response:St(h.res)}),l=ht();const f=pt(m).call(m,v=>function(T,R,w,O){const B=ht();let K=T;ml(T).call(T,"http")||(K="https://".concat(T,":4000/v2/machine"));const j={command:"request",gatewayType:"http",appId:R.appId,cname:R.cname,uid:(R.uid||"").toString(),sdkVersion:"2.3.1",sid:R.sid,seq:1,ts:ht(),requestId:3,clientRequest:{appId:R.appId,cname:R.cname,uid:(R.uid||"").toString(),sid:R.sid}};return Wn(async()=>({res:await yn(K,{data:j,cancelToken:w}),url:T}),nt=>{if(!nt.res.serverResponse)throw new P(D.UNEXPECTED_RESPONSE,"requeet worker manager server failed: serverResponse is undefined");return!1},nt=>nt.code!==D.OPERATION_ABORTED&&(At.requestProxyWorkerManager(j.sid,{lts:B,succ:!1,workerManagerAddr:T,ec:nt.code,response:nt.message}),!0),O)}(v,e,t,r));let _=null;try{_=await Rs(f)}catch{throw S.error("[".concat(e.clientId,"] can not get worker manager after trying several times")),new P(D.CAN_NOT_GET_PROXY_SERVER)}return V(f).call(f,v=>v.cancel()),At.requestProxyWorkerManager(e.sid,{lts:l,succ:!0,workerManagerAddr:_.url,ec:null,response:St(_.res)}),{addresses:[_.url],serverResponse:_.res.serverResponse}}async function J9(e,t,r){var i,s;const l=pt(i=rn(s=it("CDS_AP")).call(s,0,it("AJAX_REQUEST_CONCURRENT"))).call(i,f=>{var _;return e.proxyServer?k(_="https://".concat(e.proxyServer,"/ap/?url=")).call(_,f+"/api/v1"):"https://".concat(f,"/api/v1?action=config")}),d=pt(l).call(l,f=>function(_,v,T,R){const w=Se(),O={flag:64,cipher_method:0,features:{device:w.name,system:w.os,system_general:navigator.userAgent,vendor:v.appId,version:Tn,cname:v.cname,sid:v.sid,session_id:v.sid,detail:"",proxyServer:v.proxyServer}};return Wn(()=>yn(_,{data:O,timeout:1e3,cancelToken:T,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,B=>B.code!==D.OPERATION_ABORTED,R)}(f,e,t,r));let h=null,p=null,m={};try{h=await Rs(d)}catch(f){if(f.code===D.OPERATION_ABORTED)throw f;p=f}if(V(d).call(d,f=>f.cancel()),At.reportApiInvoke(e.sid,{name:Ht.REQUEST_CONFIG_DISTRIBUTE,options:{error:p,res:h}}).onSuccess(),h&&h.test_tags)try{m=function(f){if(!f.test_tags)return{};const _=f.test_tags,v=ae(_),T={};return V(v).call(v,R=>{var w;const O=Ic(w=rn(R).call(R,4)).call(w),B=JSON.parse(_[R])[1];T[O]=B}),T}(h)}catch{}return m}async function ew(e,t,r,i){var s,l;const d=pt(s=rn(l=it("UAP_AP")).call(l,0,it("AJAX_REQUEST_CONCURRENT"))).call(s,h=>{var p;return t.proxyServer?k(p="https://".concat(t.proxyServer,"/ap/?url=")).call(p,h+"/api/v1?action=uap"):"https://".concat(h,"/api/v1?action=uap")});return await H9(d,e,t,r,i)}async function z9(e,t,r){var i,s;const l=pt(i=rn(s=it("UAP_AP")).call(s,0,it("AJAX_REQUEST_CONCURRENT"))).call(i,h=>{var p;return e.proxyServer?k(p="https://".concat(e.proxyServer,"/ap/?url=")).call(p,h+"/api/v1?action=uap"):"https://".concat(h,"/api/v1?action=uap")}),d=pt(l).call(l,h=>function(p,m,f,_){const v={command:"convergeAllocateEdge",sid:m.sid,appId:m.appId,token:m.token,ts:ht(),version:Tn,cname:m.cname,uid:m.uid.toString(),requestId:o_,seq:o_};o_+=1;const T={service_name:"tele_channel",json_body:St(v)};return Wn(async()=>{var R;const w=await yn(p,{data:T,cancelToken:f,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(w.code!==0){const K=new P(D.UNEXPECTED_RESPONSE,"cross channel ap error, code"+w.code,{retry:!0});throw S.error(K.toString()),K}const O=JSON.parse(w.json_body);if(O.code!==200){var B;const K=new P(D.UNEXPECTED_RESPONSE,k(B="cross channel app center error, code: ".concat(O.code,", reason: ")).call(B,O.reason));throw S.error(K.toString()),K}if(!O.servers||O.servers.length===0){const K=new P(D.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw S.error(K.toString()),K}return{vid:O.vid,workerToken:O.workerToken,addressList:pt(R=O.servers).call(R,K=>{var j,nt;return k(j=k(nt="wss://".concat(K.address.replace(/\./g,"-"),".")).call(nt,it("WORKER_DOMAIN"),":")).call(j,K.wss)})}},void 0,R=>!!(R.code!==D.OPERATION_ABORTED&&R.code!==D.UNEXPECTED_RESPONSE||R.data&&R.data.retry),_)}(h,e,t,r));try{const h=await Rs(d);return V(d).call(d,p=>p.cancel()),h}catch(h){throw h[0]}}async function X9(e,t,r){let i=null;const s=[],l=async d=>{var h;const p=pt(h=it(d?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN")).call(h,m=>{var f;return e.proxyServer?k(f="https://".concat(e.proxyServer,"/ap/?url=")).call(f,m+"/api/v2/transpond/webrtc?v=2"):"https://".concat(m,"/api/v2/transpond/webrtc?v=2")});return d&&(await Mr(1e3),i!==null)?i:await Ao({fragementLength:it("FRAGEMENT_LENGTH"),referenceList:p,asyncMapHandler:m=>{var f;return S.debug(k(f="[".concat(e.clientId,"] update ticket, Connect to ")).call(f,d?"backup":""," choose_server:"),m),function(_,v,T,R){const[w]=W9(v,[ei.CHOOSE_SERVER]);let O=Rr.networkState;return Wn(async()=>{O&&Rr.networkState===lo.OFFLINE&&Rr.onlineWaiter&&await ct.race([Rr.onlineWaiter,Mr(R&&R.maxRetryTimeout||Ne.maxRetryTimeout)]),O=Rr.networkState;const B=await yn(_,{data:w,cancelToken:T,headers:{"Content-Type":"multipart/form-data;"}},!0);return K9(B,_)},()=>!1,B=>B.code!==D.OPERATION_ABORTED&&(B.code===D.UPDATE_TICKET_FAILED?B.data.retry:(S.warning("[".concat(v.clientId,"] update ticket network error, retry"),B),!0)),R)}(m,e,t,r)},allFailedhandler:m=>{throw m[0]},promisesCollector:s})};try{return i=await Rs([l(!1),l(!0)]),s.length&&V(s).call(s,d=>d.cancel&&typeof d.cancel=="function"&&d.cancel()),i}catch(d){throw d[0]}}function rw(e,t){var r=ae(e);if(Xt){var i=Xt(e);t&&(i=kt(i).call(i,function(s){return jt(e,s).enumerable})),r.push.apply(r,i)}return r}function nw(e){for(var t=1;t<arguments.length;t++){var r,i,s=arguments[t]!=null?arguments[t]:{};t%2?V(r=rw(Object(s),!0)).call(r,function(l){mr(e,l,s[l])}):Zt?ur(e,Zt(s)):V(i=rw(Object(s))).call(i,function(l){ie(e,l,jt(s,l))})}return e}class iw extends Wr{constructor(){super(),this.retryConfig={timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4},this.mutex=new wn("config-distribute"),this.mutableParamsRead=!1}startGetConfigDistribute(t,r){this.joinInfo=t,this.cancelToken=r,this.interval&&this.stopGetConfigDistribute(),this.updateConfigDistribute(),this.interval=be(()=>{this.updateConfigDistribute()},it("CONFIG_DISTRIBUTE_INTERVAL"))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){!this.mutex.isLocked||(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,At.reportApiInvoke(null,{options:void 0,name:Ht.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Wt.TRACER}).onSuccess(St(Um))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void S.debug("[config-distribute] get config distribute interrupted have no joininfo");let t;const r=await this.mutex.lock();try{t=await J9(this.joinInfo,this.cancelToken,this.retryConfig),S.debug("[config-distribute] get config distribute",St(t)),t.limit_bitrate&&this.handleBitrateLimit(t.limit_bitrate),this.cacheGlobalParameterConfig(t),this.configs=t}catch(i){const s=new P(D.NETWORK_RESPONSE_ERROR,i);S.warning("[config-distribute] ".concat(s.toString()))}finally{r()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(t){var r;(r=t)&&r.uplink&&r.id&&r.uplink.max_bitrate!==void 0&&r.uplink.min_bitrate!==void 0&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==t.id&&this.emit(au.UPDATE_BITRATE_LIMIT,t):this.emit(au.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&nw({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(t){var r,i;const s=Ua(r=kt(i=ae(t)).call(i,d=>/^webrtc_ng_global_parameter/.test(d))).call(r);for(let d=0;d<s.length;d++)for(let h=s.length-1;h>d;h--){const p=s[h];if(typeof t[p].__priority=="number"){const m=t[p].__priority,f=s[h-1];if(typeof t[f].__priority=="number"){if(!(m>t[f].__priority))continue;{const _=p;s[h]=s[h-1],s[h-1]=_}}else{const _=p;s[h]=s[h-1],s[h-1]=_}}}const l={};V(s).call(s,d=>{var h;const p=t[d],m=p.__expires;V(h=ae(p)).call(h,f=>{f!=="__priority"&&f!=="__expires"&&!Object.prototype.hasOwnProperty.call(l,f)&&p[f]&&(l[f]=nw({value:p[f]},m&&{expires:m}))})});try{const d=St(l),h=window.btoa(d);window.localStorage.setItem("websdk_ng_global_parameter",h),S.debug("Caching global parameters ".concat(d))}catch(d){S.error("Error caching global parameters:",d.message)}}}function ow(e,t){var r=ae(e);if(Xt){var i=Xt(e);t&&(i=kt(i).call(i,function(s){return jt(e,s).enumerable})),r.push.apply(r,i)}return r}function bu(e){for(var t=1;t<arguments.length;t++){var r,i,s=arguments[t]!=null?arguments[t]:{};t%2?V(r=ow(Object(s),!0)).call(r,function(l){mr(e,l,s[l])}):Zt?ur(e,Zt(s)):V(i=ow(Object(s))).call(i,function(l){ie(e,l,jt(s,l))})}return e}class Z9 extends Wr{constructor(t,r,i,s){super(),this.reconnectMode="retry",this.reqId=0,this.commandReqId=0,this.handleWebSocketOpen=()=>{this.reconnectMode="retry",this.startPingPong()},this.handleWebSocketMessage=l=>{if(!l.data)return;const d=JSON.parse(l.data);var h;d.requestId?this.emit(k(h="@".concat(d.requestId,"-")).call(h,d.sid),d):this.serviceMode===Hr.INJECT?this.emit(ko.INJECT_STREAM_STATUS,d):(At.workerEvent(this.spec.sid,{actionType:"status",serverCode:d.code,workerType:this.serviceMode===Hr.TRANSCODE?1:2}),this.emit(ko.PUBLISH_STREAM_STATUS,d))},this.spec=r,this.token=t,this.serviceMode=s,this.websocket=new rA("live-streaming",i),this.websocket.on(Je.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Je.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Je.REQUEST_NEW_URLS,(l,d)=>{Ur(this,ko.REQUEST_NEW_ADDRESS).then(l).catch(d)}),this.websocket.on(Je.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,r,i,s){this.reqId+=1,t==="request"&&(this.commandReqId+=1);const l=this.commandReqId,d=this.reqId;if(!d||!this.websocket)throw new P(D.UNEXPECTED_ERROR);const h=bu({command:t,sdkVersion:Tn==="4.8.2"?"0.0.1":Tn,seq:d,requestId:d,allocate:i,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(ht()/1e3)},r);if(this.websocket.state==="closed")throw new P(D.WS_DISCONNECT);const p=()=>new ct((v,T)=>{this.websocket.once(Je.CLOSED,()=>T(new P(D.WS_ABORT))),this.websocket.once(Je.CONNECTED,v)});this.websocket.state!=="connected"&&await p(),h.clientRequest&&(h.clientRequest.workerToken=this.token);const m=new ct((v,T)=>{var R;const w=()=>{T(new P(D.WS_ABORT))};this.websocket.once(Je.RECONNECTING,w),this.websocket.once(Je.CLOSED,w),this.once(k(R="@".concat(d,"-")).call(R,this.spec.sid),O=>{v(O)})});s&&At.workerEvent(this.spec.sid,bu(bu({},s),{},{requestId:l,actionType:"request",payload:St(r.clientRequest),serverCode:0,code:0}));const f=ht();this.websocket.sendMessage(h);let _=null;try{_=await m}catch(v){if(this.websocket.state==="closed")throw v;return await p(),await this.request(t,r,i)}return s&&At.workerEvent(this.spec.sid,bu(bu({},s),{},{requestId:l,actionType:"response",payload:St(_.serverResponse),serverCode:_.code,success:_.code===200,responseTime:ht()-f})),_.code!==200&&this.handleResponseError(_),_}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t=Tn==="4.8.2"?"0.0.1":Tn;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(ht()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case Or.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void S.warning("live stream response already exists stream");case Or.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Or.LIVE_STREAM_RESPONSE_BAD_STREAM:case Or.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new P(D.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case Or.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;throw new P(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Or.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new P(D.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case Or.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const r=new P(D.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(ko.WARNING,r,t.serverResponse.url)}case Or.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const r=new P(D.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(ko.WARNING,r,t.serverResponse.url)}case Or.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new P(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Or.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new P(D.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case Or.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const r=new P(D.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(ko.WARNING,r,t.serverResponse.url)}case Or.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new P(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case Or.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new P(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Or.LIVE_STREAM_RESPONSE_WORKER_LOST:case Or.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;throw new P(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Or.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new P(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new P(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Or.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Or.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Or.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Or.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new P(D.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=be(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(Ml)},6e3)}}function sw(e,t){var r=ae(e);if(Xt){var i=Xt(e);t&&(i=kt(i).call(i,function(s){return jt(e,s).enumerable})),r.push.apply(r,i)}return r}function ri(e){for(var t=1;t<arguments.length;t++){var r,i,s=arguments[t]!=null?arguments[t]:{};t%2?V(r=sw(Object(s),!0)).call(r,function(l){mr(e,l,s[l])}):Zt?ur(e,Zt(s)):V(i=sw(Object(s))).call(i,function(l){ie(e,l,jt(s,l))})}return e}class aw extends Wr{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ne,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Ne;super(),this.retryTimeout=1e4,this.streamingTasks=new $t,this.isStartingStreamingTask=!1,this.taskMutex=new wn("live-streaming"),this.cancelToken=wo.CancelToken.source(),this.injectConfig=ri({},aV),this.injectLoopTimes=0,this.lastTaskId=1,this.statusError=new $t,this.spec=t,this.httpRetryConfig=i,this.wsRetryConfig=r}async setTranscodingConfig(t){var r;const i=ri(ri({},sV),t);var s,l;i.videoCodecProfile!==66&&i.videoCodecProfile!==77&&i.videoCodecProfile!==100&&(S.debug(k(s="[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ")).call(s,i.videoCodecProfile," -> 100")),i.videoCodecProfile=100),i.transcodingUsers||(i.transcodingUsers=i.userConfigs),i.transcodingUsers&&(i.transcodingUsers=pt(l=i.transcodingUsers).call(l,w=>ri(ri(ri({},oV),w),{},{zOrder:w.zOrder?w.zOrder+1:1}))),function(w){var O,B;$e(w.width)||Ie(w.width,"config.width",0,1e4),$e(w.height)||Ie(w.height,"config.height",0,1e4),$e(w.videoBitrate)||Ie(w.videoBitrate,"config.videoBitrate",1,1e6),$e(w.videoFrameRate)||Ie(w.videoFrameRate,"config.videoFrameRate"),$e(w.lowLatency)||Sc(w.lowLatency,"config.lowLatency"),$e(w.audioSampleRate)||Pr(w.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),$e(w.audioBitrate)||Ie(w.audioBitrate,"config.audioBitrate",1,128),$e(w.audioChannels)||Pr(w.audioChannels,"config.audioChannels",[1,2,3,4,5]),$e(w.videoGop)||Ie(w.videoGop,"config.videoGop"),$e(w.videoCodecProfile)||Pr(w.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),$e(w.userCount)||Ie(w.userCount,"config.userCount",0,17),$e(w.backgroundColor)||Ie(w.backgroundColor,"config.backgroundColor",0,16777215),$e(w.userConfigExtraInfo)||pr(w.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),w.transcodingUsers&&!$e(w.transcodingUsers)&&(yp(w.transcodingUsers,"config.transcodingUsers"),V(O=w.transcodingUsers).call(O,(K,j)=>{bp(K.uid),$e(K.x)||Ie(K.x,"transcodingUser[".concat(j,"].x"),0,1e4),$e(K.y)||Ie(K.y,"transcodingUser[".concat(j,"].y"),0,1e4),$e(K.width)||Ie(K.width,"transcodingUser[".concat(j,"].width"),0,1e4),$e(K.height)||Ie(K.height,"transcodingUser[".concat(j,"].height"),0,1e4),$e(K.zOrder)||Ie(K.zOrder-1,"transcodingUser[".concat(j,"].zOrder"),0,100),$e(K.alpha)||Ie(K.alpha,"transcodingUser[".concat(j,"].alpha"),0,1,!1)})),$e(w.watermark)||Km(w.watermark,"watermark"),$e(w.backgroundImage)||Km(w.backgroundImage,"backgroundImage"),w.images&&!$e(w.images)&&(yp(w.images,"config.images"),V(B=w.images).call(B,(K,j)=>{Km(K,"images[".concat(j,"]"))}))}(i);const d=[];var h,p;i.images&&d.push(...pt(h=i.images).call(h,w=>ri(ri(ri({},Hm),w),{},{zOrder:255}))),i.backgroundImage&&(d.push(ri(ri(ri({},Hm),i.backgroundImage),{},{zOrder:0})),delete i.backgroundImage),i.watermark&&(d.push(ri(ri(ri({},Hm),i.watermark),{},{zOrder:255})),delete i.watermark),i.images=d,i.transcodingUsers&&(i.userConfigs=pt(p=i.transcodingUsers).call(p,w=>ri({},w)),i.userCount=i.transcodingUsers.length,delete i.transcodingUsers);const m=pt(r=i.userConfigs||[]).call(r,w=>typeof w.uid=="number"?ct.resolve(w.uid):a_(w.uid,this.spec,this.cancelToken.token,this.httpRetryConfig)),f=await ct.all(m);if(V(f).call(f,(w,O)=>{i.userConfigs&&i.userConfigs[O]&&(i.userConfigs[O].uid=w)}),this.transcodingConfig=i,this.connection)try{var _,v,T;const w=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:pt(_=Qe(ia(v=this.streamingTasks).call(v))).call(_,O=>O.taskId).join("#")});S.debug(k(T="[".concat(this.spec.clientId,"] update live transcoding config success, code: ")).call(T,w.code,", config:"),St(this.transcodingConfig))}catch(w){var R;if(!w.data||!w.data.retry)throw w;w.data.changeAddress&&this.connection.tryNextAddress(),V(R=this.streamingTasks).call(R,O=>{S.warning("[".concat(this.spec.clientId,"] live streaming receive error"),w.toString(),"try to republish",O.url),this.startLiveStreamingTask(O.url,O.mode,w).then(()=>{var B;S.debug(k(B="[".concat(this.spec.clientId,"] live streaming republish ")).call(B,O.url," success"))}).catch(B=>{S.error("[".concat(this.spec.clientId,"] live streaming republish failed"),O.url,B.toString()),this.onLiveStreamError&&this.onLiveStreamError(O.url,B)})})}}setInjectStreamConfig(t,r){this.injectConfig=hr({},this.injectConfig,t),this.injectLoopTimes=r}async startLiveStreamingTask(t,r,i){var s,l,d,h;if(ft(s=Qe(ia(l=this.streamingTasks).call(l))).call(s,v=>v.mode===Hr.INJECT)&&r===Hr.INJECT)return new P(D.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!this.transcodingConfig&&r===Hr.TRANSCODE)throw new P(D.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let p={command:"PublishStream",ts:ht(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};S.debug(k(d=k(h="[".concat(this.spec.clientId,"] start live streaming ")).call(h,t,", mode: ")).call(d,r));const m=await this.taskMutex.lock();if(!this.connection&&i)return void m();if(this.streamingTasks.get(t)&&!i)return m(),new P(D.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(r))}catch(v){throw m(),v}switch(r){case Hr.TRANSCODE:p.transcodingConfig=ri({},this.transcodingConfig);break;case Hr.RAW:break;case Hr.INJECT:p={cname:this.spec.cname,command:"InjectStream",sid:this.spec.sid,transcodingConfig:this.injectConfig,ts:ht(),url:t,loopTimes:this.injectLoopTimes}}this.uapResponse&&this.uapResponse.vid&&(p.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const f=this.lastTaskId++;try{var _;const v=new ct((R,w)=>{Mr(this.retryTimeout).then(()=>{if(i)return w(i);const O=this.statusError.get(t);return O?(this.statusError.delete(t),w(O)):void 0})}),T=await ct.race([this.connection.request("request",{clientRequest:p},!0,{url:t,command:"PublishStream",workerType:r===Hr.TRANSCODE?1:2,requestByUser:!i,tid:f.toString()}),v]);this.isStartingStreamingTask=!1,S.debug(k(_="[".concat(this.spec.clientId,"] live streaming started, code: ")).call(_,T.code)),this.streamingTasks.set(t,{clientRequest:p,mode:r,url:t,taskId:f}),m()}catch(v){if(m(),this.isStartingStreamingTask=!1,!v.data||!v.data.retry||i)throw v;return v.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,r,v)):await this.startLiveStreamingTask(t,r,v)}}stopLiveStreamingTask(t){return new ct((r,i)=>{const s=this.streamingTasks.get(t);if(!s||!this.connection)return new P(D.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const l=s.mode;s.abortTask=()=>{S.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),r()},this.connection.request("request",{clientRequest:{command:l===Hr.INJECT?"UninjectStream":"UnpublishStream",url:s.url}},!1,{url:t,command:"UnPublishStream",workerType:l===Hr.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(d=>{var h;S.debug(k(h="[".concat(this.spec.clientId,"] stop live streaming success, code: ")).call(h,d.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&l!==Hr.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),r(),l===Hr.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(5,this.spec.uid,t)}).catch(i)})}async controlInjectStream(t,r,i,s){const l=this.streamingTasks.get(t);if(!l||!this.connection||l.mode!==Hr.INJECT)throw new P(D.INVALID_OPERATION,"can not find inject stream task to control");return(await this.connection.request("request",{clientRequest:{command:"ControlStream",url:t,control:r,audioVolume:i,position:s}})).serverResponse}resetAllTask(){var t;const r=Qe(ia(t=this.streamingTasks).call(t));this.terminate();for(const i of r)this.startLiveStreamingTask(i.url,i.mode).catch(s=>{this.onLiveStreamError&&this.onLiveStreamError(i.url,s)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new $t,this.isStartingStreamingTask=!1,this.statusError=new $t,this.cancelToken=wo.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new P(D.UNEXPECTED_ERROR,"live streaming connection has already connected");const r=await Ur(this,Tl.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=r,this.connection=new Z9(r.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(ko.WARNING,(i,s)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(s,i)),this.connection.on(ko.PUBLISH_STREAM_STATUS,i=>this.handlePublishStreamServer(i)),this.connection.on(ko.INJECT_STREAM_STATUS,i=>this.handleInjectStreamServerStatus(i)),this.connection.on(ko.REQUEST_NEW_ADDRESS,(i,s)=>{if(!this.connection)return s(new P(D.UNEXPECTED_ERROR,"can not get new live streaming address list"));Ur(this,Tl.REQUEST_WORKER_MANAGER_LIST,t).then(l=>{this.uapResponse=l,i(l.addressList)}).catch(s)}),await this.connection.init(r.addressList),this.connection}handlePublishStreamServer(t){const r=t.serverStatus&&t.serverStatus.url||"empty_url",i=this.streamingTasks.get(r),s=t.reason;switch(t.code){case Or.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Or.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Or.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Or.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const d=new P(D.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(i)return S.error(d.toString()),this.onLiveStreamError&&this.onLiveStreamError(r,d);if(!this.isStartingStreamingTask)return;this.statusError.set(r,d)}case Or.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const d=new P(D.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,s);return this.onLiveStreamWarning&&this.onLiveStreamWarning(r,d)}case Or.LIVE_STREAM_RESPONSE_WORKER_LOST:case Or.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var l;if(!this.connection)return;this.connection.tryNextAddress();const d=Qe(ia(l=this.streamingTasks).call(l));for(const h of d)h.abortTask?h.abortTask():(S.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",h.url),this.startLiveStreamingTask(h.url,h.mode,new P(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{S.debug("[".concat(this.spec.clientId,"] republish live stream success"),h.url)}).catch(p=>{S.error(p.toString()),this.onLiveStreamError&&this.onLiveStreamError(h.url,p)}));return}}}handleInjectStreamServerStatus(t){const r=Number(t.uid),i=t.serverStatus&&t.serverStatus.url;switch(t.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(0,r,i));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(1,r,i),void this.streamingTasks.delete(i);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(2,r,i),void this.streamingTasks.delete(i);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(10,r,i),void this.streamingTasks.delete(i);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(3,r,i),void this.streamingTasks.delete(i);default:return void S.debug("inject stream server status",t)}}hasUrl(t){return this.streamingTasks.has(t)}}class cw{constructor(){this.destChannelMediaInfos=new $t}setSrcChannelInfo(t){DR(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){DR(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){wp(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function IA(e){if(!(e instanceof cw))return new P(D.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),r=e.getDestChannelMediaInfo();if(!t)return new P(D.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(r.size===0)return new P(D.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class $9 extends Wr{constructor(t,r,i){super(),this.requestId=1,this.onOpen=()=>{this.emit("open"),this.startHeartBeatCheck()},this.onClose=s=>{this.emit("close"),this.dispose()},this.onMessage=s=>{const l=JSON.parse(s.data);if(!l||l.command!=="serverResponse"||!l.requestId)return l&&l.command==="serverStatus"&&l.serverStatus&&l.serverStatus.command?(this.emit("status",l.serverStatus),void this.emit(l.serverStatus.command,l.serverStatus)):void 0;this.emit("req_".concat(l.requestId),l)},this.joinInfo=t,this.clientId=r,this.ws=new rA("cross-channel-".concat(this.clientId),i),this.ws.on(Je.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Je.CONNECTED,this.onOpen),this.ws.on(Je.ON_MESSAGE,this.onMessage),this.ws.on(Je.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){const r=this.requestId++;return t.requestId=r,t.seq=r,this.ws.sendMessage(t),r}waitStatus(t){return new ct((r,i)=>{const s=ar(()=>{i(new P(D.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,l=>{window.clearTimeout(s),l.state&&l.state!==0?i(new P(D.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):r(void 0)}),this.once("dispose",()=>{window.clearTimeout(s),i(new P(D.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new P(D.WS_DISCONNECT);const r=()=>new ct((d,h)=>{this.ws.once(Je.CLOSED,()=>h(new P(D.WS_ABORT))),this.ws.once(Je.CONNECTED,d)});this.ws.state!=="connected"&&await r();const i=this.sendMessage(t),s=new ct((d,h)=>{const p=()=>{h(new P(D.WS_ABORT))};this.ws.once(Je.RECONNECTING,p),this.ws.once(Je.CLOSED,p),this.once("req_".concat(i),d),Mr(3e3).then(()=>{this.removeAllListeners("req_".concat(i)),this.ws.off(Je.RECONNECTING,p),this.ws.off(Je.CLOSED,p),h(new P(D.TIMEOUT,"cross channel ws request timeout"))})}),l=await s;if(!l||l.code!==200)throw new P(D.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(St(l)));return l}async connect(t){this.ws.removeAllListeners(Je.REQUEST_NEW_URLS),this.ws.on(Je.REQUEST_NEW_URLS,r=>{r(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){const r=this.requestId++;return t.requestId=r,this.ws.sendMessage(t),r}startHeartBeatCheck(){this.heartBeatTimer=be(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class lw extends Wr{constructor(t,r,i,s){super(),this.cancelToken=wo.CancelToken.source(),this.requestId=0,this._state="RELAY_STATE_IDLE",this.errorCode="RELAY_OK",this.onStatus=l=>{var d;S.debug(k(d="[".concat(this.clientId,"] ChannelMediaStatus: ")).call(d,St(l))),l&&l.command&&(l.command==="onAudioPacketReceived"&&this.emit("event","PACKET_RECEIVED_AUDIO_FROM_SRC"),l.command==="onVideoPacketReceived"&&this.emit("event","PACKET_RECEIVED_VIDEO_FROM_SRC"),l.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode="SRC_TOKEN_EXPIRED",this.state="RELAY_STATE_FAILURE"),l.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode="DEST_TOKEN_EXPIRED",this.state="RELAY_STATE_FAILURE"))},this.onReconnect=async()=>{S.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event","NETWORK_DISCONNECTED"),this.state="RELAY_STATE_IDLE",this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(l=>{this.state!=="RELAY_STATE_IDLE"&&(S.error("auto restart channel media relay failed",l.toString()),this.errorCode="SERVER_CONNECTION_LOST",this.state="RELAY_STATE_FAILURE")})},this.joinInfo=t,this.clientId=r,this.signal=new $9(this.joinInfo,this.clientId,i),this.httpRetryConfig=s}set state(t){t!==this._state&&(t!=="RELAY_STATE_FAILURE"&&(this.errorCode="RELAY_OK"),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}async startChannelMediaRelay(t){if(this.state!=="RELAY_STATE_IDLE")throw new P(D.INVALID_OPERATION);this.state="RELAY_STATE_CONNECTING",await this.connect(),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(r){throw r.data&&r.data.serverResponse&&r.data.serverResponse.command==="SetSourceChannel"?new P(D.CROSS_CHANNEL_FAILED_JOIN_SRC):r.data&&r.data.serverResponse&&r.serverResponse.command==="SetDestChannelStatus"?new P(D.CROSS_CHANNEL_FAILED_JOIN_DEST):r.data&&r.data.serverResponse&&r.serverResponse.command==="StartPacketTransfer"?new P(D.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):r}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!=="RELAY_STATE_RUNNING")throw new P(D.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),S.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state="RELAY_STATE_IDLE",this.dispose()}dispose(){S.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=wo.CancelToken.source(),this.state="RELAY_STATE_IDLE",this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const t=await z9(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event","NETWORK_CONNECTED"),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){const r=this.genMessage(Hn.StopPacketTransfer);await this.signal.request(r),await this.signal.waitStatus("Normal Quit"),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const i=this.genMessage(Hn.SetSdkProfile,t);await this.signal.request(i),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const s=this.genMessage(Hn.SetSourceChannel,t);await this.signal.request(s),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event","PACKET_JOINED_SRC_CHANNEL"),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const l=this.genMessage(Hn.SetSourceUserId,t);await this.signal.request(l),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const d=this.genMessage(Hn.SetDestChannel,t);await this.signal.request(d),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event","PACKET_JOINED_DEST_CHANNEL"),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const h=this.genMessage(Hn.StartPacketTransfer,t);await this.signal.request(h),this.emit("event","PACKET_SENT_TO_DEST_CHANNEL"),this.state="RELAY_STATE_RUNNING",S.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success"))}async sendUpdateMessage(t){const r=this.genMessage(Hn.UpdateDestChannel,t);await this.signal.request(r),this.emit("event","PACKET_UPDATE_DEST_CHANNEL"),S.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const t=this.genMessage(Hn.StopPacketTransfer);await this.signal.request(t),S.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,r){const i=[],s=[],l=[];this.requestId+=1;const d={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Tn,sid:this.joinInfo.sid,ts:ht(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};d.sdkVersion==="4.8.2"&&(d.sdkVersion="0.0.1");let h=null,p=null;switch(t){case Hn.SetSdkProfile:return d.clientRequest={command:"SetSdkProfile",type:"multi_channel"},d;case Hn.SetSourceChannel:if(p=r&&r.getSrcChannelMediaInfo(),!p)throw new P(D.UNEXPECTED_ERROR,"can not find source config");return d.clientRequest={command:"SetSourceChannel",uid:"0",channelName:p.channelName,token:p.token||this.joinInfo.appId},d;case Hn.SetSourceUserId:if(p=r&&r.getSrcChannelMediaInfo(),!p)throw new P(D.UNEXPECTED_ERROR,"can not find source config");return d.clientRequest={command:"SetSourceUserId",uid:p.uid+""},d;case Hn.SetDestChannel:if(h=r&&r.getDestChannelMediaInfo(),!h)throw new P(D.UNEXPECTED_ERROR,"can not find dest config");return V(h).call(h,m=>{i.push(m.channelName),s.push(m.uid+""),l.push(m.token||this.joinInfo.appId)}),d.clientRequest={command:"SetDestChannel",channelName:i,uid:s,token:l},d;case Hn.StartPacketTransfer:return d.clientRequest={command:"StartPacketTransfer"},d;case Hn.Reconnect:return d.clientRequest={command:"Reconnect"},d;case Hn.StopPacketTransfer:return d.clientRequest={command:"StopPacketTransfer"},d;case Hn.UpdateDestChannel:if(h=r&&r.getDestChannelMediaInfo(),!h)throw new P(D.UNEXPECTED_ERROR,"can not find dest config");return V(h).call(h,m=>{i.push(m.channelName),s.push(m.uid+""),l.push(m.token||this.joinInfo.appId)}),d.clientRequest={command:"UpdateDestChannel",channelName:i,uid:s,token:l},d}return d}}class vA{constructor(t){this.freezeTimeCounterList=[],this.timeUpdatedCount=0,this.freezeTime=0,this.playbackTime=0,this.lastTimeUpdatedTime=0,this._videoElementStatus=Bn.NONE,this.isGettingVideoDimensions=!1,this.handleVideoEvents=r=>{switch(r.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=Bn.PLAYING;break;case"loadeddata":this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded();break;case"canplay":this.videoElementStatus=Bn.CANPLAY;break;case"stalled":this.videoElementStatus=Bn.STALLED;break;case"suspend":this.videoElementStatus=Bn.SUSPEND;break;case"pause":this.videoElementStatus=Bn.PAUSED,!ui()&&!Zo()&&this.videoElement&&this.videoTrack&&this.videoTrack.readyState==="live"&&(S.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Bn.WAITING;break;case"abort":this.videoElementStatus=Bn.ABORT;break;case"ended":this.videoElementStatus=Bn.ENDED;break;case"emptied":this.videoElementStatus=Bn.EMPTIED;break;case"timeupdate":{const i=ht();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=i);const s=i-this.lastTimeUpdatedTime;for(this.lastTimeUpdatedTime=i,s>500&&(this.freezeTime+=s),this.playbackTime+=s;this.playbackTime>=6e3;)this.playbackTime-=6e3,this.freezeTimeCounterList.push(Math.min(6e3,this.freezeTime)),this.freezeTime=Math.max(0,this.freezeTime-6e3);break}}},this.startGetVideoDimensions=()=>{const r=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement&&this.videoElement.videoWidth*this.videoElement.videoHeight>4)return S.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);ar(r,500)};!this.isGettingVideoDimensions&&r()},this.autoResumeAfterInterruption=()=>{this.videoElement&&this.videoTrack&&this.videoTrack.readyState==="live"&&le.curState==="running"&&(gp()?(S.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15.2")),this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):M1()?(S.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15.1")),this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):B1()?(S.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15.0")),this.videoElement.pause(),this.videoElement.play()):(S.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 14")),this.videoElement.play()))},this.autoResumeAfterInterruptionOnIOS15=()=>{this.videoElement&&this.videoTrack&&this.videoTrack.readyState==="live"&&(gp()?(S.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15.2")),this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):M1()?(S.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15.1")),this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):B1()&&(S.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15.0")),this.videoElement.pause(),this.videoElement.play()))},this.slot=t.element,this.trackId=t.trackId,this.updateConfig(t),le.on(yr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),le.on(yr.IOS_15_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15)}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(t){var r,i;t!==this._videoElementStatus&&(S.debug(k(r=k(i="[".concat(this.trackId,"] video-element-status change ")).call(i,this._videoElementStatus," => ")).call(r,t)),this._videoElementStatus=t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const r=t.element;r!==this.slot&&(this.destroy(),this.slot=r),this.createElements()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){if(this.videoElement){const r=this.videoElement.play();r&&r.catch&&r.catch(s=>{t&&At.autoplayFailed(t,"video",s.message,this.trackId),s.name==="NotAllowedError"?(S.warning("detected video element autoplay failed",s),this.handleAutoPlayFailed()):S.warning("[".concat(this.trackId,"] play warning: "),s)});const i=Se();if((i.name==="Safari"&&Number(i.version)===15||Xs())&&r&&r.then&&r.catch){const s=()=>{this.config.mirror&&this.videoElement&&(this.videoElement.style.transform="rotateY(180deg)")};r.then(s).catch(s)}}}getCurrentFrame(){if(!this.videoElement)return new ImageData(2,2);const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const r=t.getContext("2d");if(!r)return S.error("create canvas context failed!"),new ImageData(2,2);r.drawImage(this.videoElement,0,0,t.width,t.height);const i=r.getImageData(0,0,t.width,t.height);return t.remove(),i}destroy(){if(le.off(yr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),le.off(yr.IOS_15_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15),this.videoElement&&(this.videoElement.srcObject=null,this.videoElement.remove(),this.videoElement=void 0),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}this.freezeTimeCounterList=[]}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",this.createVideoElement(),this.container.appendChild(this.videoElement)):this.removeVideoElement(),this.slot.appendChild(this.container)}createVideoElement(){this.videoElement||(this.videoElementStatus=Bn.INIT,this.videoElement=document.createElement("video"),this.videoElement.onerror=()=>this.videoElementStatus=Bn.ERROR,this.container&&this.container.appendChild(this.videoElement),V(CA).call(CA,i=>{this.videoElement&&this.videoElement.addEventListener(i,this.handleVideoEvents)}),this.videoElementCheckInterval=be(()=>{!document.getElementById("video_".concat(this.trackId))&&this.videoElement&&(this.videoElementStatus=Bn.DESTROYED)},1e3)),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),this.videoElement.style.left="0",this.videoElement.style.top="0";const t=Se();t.name==="Safari"&&Number(t.version)===15||Xs()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Gr()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Gr()&&this.videoElement.load());const r=this.videoElement.play();r!==void 0&&r.catch(i=>{S.debug("[".concat(this.trackId,"] playback interrupted"),i.toString())})}removeVideoElement(){if(this.videoElement){V(CA).call(CA,t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0);try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=void 0,this.videoElementStatus=Bn.NONE}}handleAutoPlayFailed(){const t=Se();if(this.videoElement){const r=i=>{i.preventDefault(),this.videoElement&&(this.videoElement.play().then(()=>{var s;S.debug(k(s="[".concat(this.trackId,"] Video element for trackId:")).call(s,this.trackId," autoplay resumed."))}).catch(s=>{S.error(s)}),t.os!=="Android"||t.name!=="Chrome"&&t.name!==ye.WECHAT?(document.body.removeEventListener("touchstart",r,!0),document.body.removeEventListener("mousedown",r,!0)):document.body.removeEventListener("click",r,!0))};t.os!=="Android"||t.name!=="Chrome"&&t.name!==ye.WECHAT?(document.body.addEventListener("touchstart",r,!0),document.body.addEventListener("mousedown",r,!0)):document.body.addEventListener("click",r,!0),dy()}}getVideoElement(){return this.videoElement}getContainerElement(){return this.container}}const CA=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate"];function t7(e,t,r){const i=e.createShader(r);if(!i)return new P(D.WEBGL_INTERNAL_ERROR,"can not create shader").throw();if(e.shaderSource(i,t),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS)){const s=e.getShaderInfoLog(i);return e.deleteShader(i),new P(D.WEBGL_INTERNAL_ERROR,"error compiling shader:"+s).throw()}return i}function e7(e,t,r,i){const s=[];for(let l=0;l<t.length;++l){const d=l===0?e.VERTEX_SHADER:e.FRAGMENT_SHADER;s.push(t7(e,t[l],d))}return function(l,d,h,p){const m=l.createProgram();if(!m)throw new P(D.WEBGL_INTERNAL_ERROR,"can not create webgl program");if(V(d).call(d,f=>{l.attachShader(m,f)}),h&&V(h).call(h,(f,_)=>{l.bindAttribLocation(m,p?p[_]:_,f)}),l.linkProgram(m),!l.getProgramParameter(m,l.LINK_STATUS)){const f=l.getProgramInfoLog(m);throw l.deleteProgram(m),new P(D.WEBGL_INTERNAL_ERROR,"error in program linking:"+f)}return m}(e,s,r,i)}var dw;!document.documentMode&&!!window.StyleMedia&&(HTMLCanvasElement.prototype.getContext=(dw=HTMLCanvasElement.prototype.getContext,function(){let e=arguments;return e[0]==="webgl"&&(e=rn([]).call(arguments),e[0]="experimental-webgl"),dw.apply(null,e)}));const r7=[31,222,239,159,192,236,164,81,54,227,176,149,2,247,75,141,183,54,213,216,158,92,111,49,228,111,150,6,135,79,35,212,4,155,200,168,37,107,243,110,144,179,51,81,55,78,223,242,191,211,74,119,203,151,142,62,31,41,132,22,35,155,87,123,119,117,216,57,201,53,228,67,201,40,106,24,80,176,187,253,60,63,136,100,20,12,177,99,64,38,101,143,111,176,251,211,145,136,34,23,79,136,202,95,105,199,125,67,180,44,210,179,228,4,85,160,188,64,26,46,6,61,201,103,248,18,97,254,140,36,115,106,48,124,102,216,155,120,36,227,165,217,7,227,191,128,212,157,80,37,117,175,24,214,47,221,183,211,51,174,251,223,159,167,152,53,36,107,199,223,91,62,46,194,11,80,121,188,219,2,99,99,232,229,173,234,21,30,236,177,243,142,97,48,108,56,62,172,56,216,3,42,79,138,23,88,182,39,5,118,68,135,178,56,9,94,189,44,104,9,238,231,174,122,85,247,231,86,74,8,189,147,218,180,58,76,227,17,46,90,194,100,51,178,72,163,151,243,166,130,85,1,223,130,152,242,85,255,28,173,97,252,119,215,177,119,86,104,136,82,40,72,53,11,18,26,240,188,76,110,39,31,189];function uw(e){const t=new Uint8Array([99,114,121,112,116,105,105]),r=t.length,i=e,s=i.length,l=new Uint8Array(s),d=new Uint8Array(256);for(let _=0;_<256;_++)d[_]=_;let h=0;for(let _=0;_<256;_++)h=(h+d[_]+t[_%r])%256,[d[_],d[h]]=[d[h],d[_]];let p,m=0;h=0;for(let _=0;_<0+s;_++)m=(m+1)%256,h=(h+d[m])%256,[d[m],d[h]]=[d[h],d[m]],p=d[(d[m]+d[h])%256],_>=0&&(l[_-0]=i[_-0]^p);const f=String.fromCharCode.apply(null,Qe(l));return Function("var winSize = 5; return `"+f+"`")()}const n7=[11,196,242,139,198,252,188,5,59,170,161,152,17,229,24,141,133,54,214,206,133,26,66,126,255,11,245,10,146,92,52,134,108,152,221,191,124,116,248,106,130,251,59,105,43,91,135,199,181,223,10,51,134,194,240,46,9,3,141,22,35,146,76,23,109,117,208,41,201,45,218,76,203,105,51,58,97,154,145,236,49,18,183,127,27,12,210,122,73,42,37,143,36,207,251,211,145,191,56,10,88,222,181,125,22,238,123,71,177,107,218,254,173,28,34,253,249,67,83,97,73,111,219,43,181,82,38,230,136,109,22,67];class hw{constructor(t,r){this.gl=t,this.kernel=r||n7,this.program=function(i,s){const l=uw(s),d=e7(i,[uw(r7),l]);{const h=i.getAttribLocation(d,"a_position"),p=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,p),i.bufferData(i.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),i.STATIC_DRAW),i.enableVertexAttribArray(h);const m=2,f=i.FLOAT,_=!1,v=0,T=0;i.vertexAttribPointer(h,m,f,_,v,T)}{const h=i.getAttribLocation(d,"a_texCoord"),p=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,p),i.bufferData(i.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),i.STATIC_DRAW),i.enableVertexAttribArray(h);const m=2,f=i.FLOAT,_=!1,v=0,T=0;i.vertexAttribPointer(h,m,f,_,v,T)}return d}(this.gl,this.kernel)}setUniforms(){const t=this.gl.getUniformLocation(this.program,"u_flipY");this.gl.uniform1f(t,1)}}class la extends hw{constructor(t,r,i,s){super(t,r),this.denoiseLevel=5,this.xOffset=1/i,this.yOffset=1/s}setUniforms(){const t=this.gl.getUniformLocation(this.program,"u_flipY"),r=this.gl.getUniformLocation(this.program,"u_singleStepOffset"),i=this.gl.getUniformLocation(this.program,"u_denoiseLevel");this.gl.uniform2f(r,this.xOffset,this.yOffset),this.gl.uniform1f(i,this.denoiseLevel),this.gl.uniform1f(t,1)}setParameters(t){t.denoiseLevel!==void 0&&(this.denoiseLevel=t.denoiseLevel)}setSize(t,r){this.xOffset=1/t,this.yOffset=1/r}}const i7=[11,196,242,139,198,252,188,5,59,170,161,152,17,229,24,141,133,54,214,206,133,26,66,126,255,11,245,10,146,92,52,134,108,155,210,164,99,114,228,96,130,251,59,105,43,91,135,199,181,223,10,51,133,194,247,34,31,39,142,28,2,130,18,109,84,124,223,62,140,52,128,47,208,47,115,39,4,200,220,171,53,36,150,101,10,75,247,121,74,36,35,143,108,176,235,211,135,164,36,11,88,160,148,35,6,221,41,32,166,109,205,171,228,4,26,169,244,82,119,102,86,61,201,103,248,18,97,242,182,34,121,70,28,71,126,197,223,126,14,244,149,192,12,176,187,149,212,156,22,44,36,133,10,216,63,198,213,154,116,230,253,154,154,249,215,55,60,34,196,229,76,50,44,135,22,77,113,247,142,94,60,23,172,145,175,218,81,86,162,239,180,205,63,118,3,110,123,224,127,158,124,15,127,157,27,66,176,33,24,51,53,194,178,56,6,74,191,111,51,78,174,157,229,17,22,178,231,92,25,23,191,157,137,188,54,64,176,13,22,81,207,45,108,203,83,186,130,237,186,153,110,8,196,168,152,161,28,238,46,184,36,185,20,203,183,98,95,41,149,93,105,37,116,91,68,105,164,217,30,42,60,53,173,213,177,216,195,53,204,173,128,243,42,122,205,65,97,129,194,68,218,91,141,11,224,124,132,138,119,36,220,161,39,214,146,183,193,225,23,177,201,243,128,160,33,75,86,126,139,254,232,14,13,85,2,112,17,150,36,180,86,226,225,126,197,17,228,225,142,245,37,170,39,96,187,190,2,35,85,237,11,189,1,79,237,2,1,114,246,109,190,66,54,153,43,218,204,70,6,204,162,247,18,130,123,30,60,165,130,142,210,133,91,127,117,71,38,145,172,7,5,16,220,222,111,98,141,239,208,125,26,238,28,0,216,89,13,7,119,134,194,75,41,67,174,1,217,80,101,40,26,59,28,59,46,108,138,38,157,167,28,234,73,177,42,42,102,108,26,181,27,178,42,43,52,28,110,117,198,173,176,178,101,225,150,36,139,108,105,10,237,222,3,143,126,18,144,115,74,56,114,134,231,159,212,62,126,80,173,216,167,4,81,18,52,17,144,218,32,139,207,104,128,229,99,84,120,31,87,227,154,91,196,63,123,111,125,36,52,57,168,113,150,189,204,24,104,196,237,86,163,68,197,202,170,212,191,81,193,111,255,162,181,202,156,146,196,96,16,118,117,55,71,156,31,163,242,204,239,11,150,27,126,115,154,107,247,134,158,125,255,146,35,183,209,36,116,87,215,172,5,251,133,114,254,141,195,6,145,4,111,182,167,74,154,152,68,18,146,88,106,200,154,15,176,94,86,66,178,101,219,35,188,129,66,28,41,110,174,53,88,174,64,191,206,127,48,126,214,216,93,119,2,166,99,181,222,29,218,28,195,219,125,44,50,16,99,174,225,51,133,120,184,159,168,75,242,162,124,255,81,25,153,109,69,220,176,4,237,196,233,19,8,240,160,39,122,81,29,188,144,249,170,174,137,30,10,93,133,151,199,248,175,38,41,144,229,245,149,25,240,138,179,114,182,84,50,103,95,31,199,31,87,208,203,199,135,49,211,43,52,36,74,59,37,22,136,171,244,126,18,251,39,159,241,66,206,127,149,159,182,143,232,199,136,46,150,32,51,221,74,22,102,93,22,44,132,140,199,43,69,249,77,75,140,70,4,252,98,235,77,190,125,18,56,21,10,244,42,2,246,62,127,241,123,137,22,247,219,177,160,84,18,10,84,97,251,127,102,16,209,181,100,94,56,238,209,207,76,189,95,15,165,139,143,189,96,225,55,112,178,27,218,198,223,251,52,123,94,130,220,142,216,116,237,18,254,49,59,128,41,29,15,179,164,85,76,167,166,151,39,221,2,190,68,167,26,177,114,141,4,67,25,69,182,38,166,160,27,151,148,108,48,227,60,112,48,22,159,76,127,251,63,254,177,113,217,197,95,179,109,128,138,99,27,249,10,174,155,129,80,39,165,252,85,60,131,183,98,107,68,207,19,233,231,55,225,126,77,49,53,145,203,113,29,208,64,237,182,229,165,7,11,169,106,253,116,141,200,62,16,38,121,55,148,91,83,160,140,126,121,12,79,189,72,172,31,243,240,209,229,32,220,91,229,81,94,247,121,153,151,232,182,171,198,50,31,152,245,172,151,130,55,62,125,38,155,229,78,207,148,201,2,78,63,119,107,168,78,139,141,163,177,191,239,141,39,182,174,40,76,226,62,125,209,6,6,34,37,147,85,204,103,51,191,36,248,17,175,20,1,53,16,35,143,237,177,125,86,29,219,235,20,121,205,59,5,250,107,109,32,224,30,152,143,113,151,95,85,19,254,164,135,124,68,136,199,29,31,244,91,10,84,127,101,210,70,226,195,140,70,166,54,217,165,84,42,165,175,100,234,124,121,105,53,101,118,174,101,220,147,68,161,37,0,182,220,142,221,155,230,115,164,10,214,208,120,91,152,66,27,81,184,48,84,70,7,128,153,217,218,249,226,70,130,200,156,61,227,21,164,137,193,221,119,10,134,204,23,20,17,90,94,105,204,39,99,1,64,153,45,213,19,247,97,194,49,35,125,255,195,139,63,209,175,208,147,189,244,204,24,211,99,142,18,92,130,254,182,231,235,93,10,127,175,87,35,62,110,137,184,39,114,200,150,11,190,40,162,168,223,203,110,242,192,234,26,11,54,155,38,48,79,109,101,119,165,187,223,5,20,168,171,241,20,243,108,199,3,155,69,244,149,0,187,110,12,233,42,151,189,139,133,104,3,30,16,200,69,4,123,103,144,12,106,182,1,127,91,125,158,12,144,238,232,209,101,159,56,163,240,179,50,169,120,219,176,87,77,45,247,153,190,82,132,50,137,209,97,19,35,247,161,62,77,16,71,152,72,61,50,99,157,154,56,58,175,27,73,121,229,195,228,132,69,233,169,100,21,123,17,3,164,6,146,106,196,29,3,250,217,164,23,171,203,14,242,239,249,169,116,138,209,98,113,181,122,35,162,216,46,230,4,155,142,118,216,232,229,28,12,158,153,126,149,171,172,231,99,211,57,114,136,183,114,74,35,233,115,127,253,157,38,49,136,141,25,161,255,232,110,101,208,166,186,226,12,185,19,155,53,93,155,39,161,7,124,213,52,223,125,211,242,253,22,13,131,115,167,198,188,90,209,63,224,92,112,118,220,165,31,164,43,58,197,77,17,247,77,164,74,77,218,18,187,41,76,189,127,98,18,226,231,71,115,236,68,183,111,50,168,88,247,9,123,65,180,88,74,44,101,101,173,11];class o7 extends la{constructor(t,r,i){super(t,i7,r,i)}}const s7=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,165,108,122,254,125,130,229,55,109,113,11,210,238,163,213,86,116,156,248,215,63,20,48,173,31,55,133,18,105,32,16,204,35,128,38,212,87,200,97,114,40,12,210,193,171,59,33,158,108,14,75,228,74,65,32,57,192,112,156,234,250,140,189,40,20,6,230,135,52,17,200,123,68,183,44,215,187,234,2,13,169,234,94,115,60,6,107,224,118,254,88,2,235,134,36,120,5,85,94,126,222,223,101,105,227,147,199,64,185,246,143,183,210,30,37,127,226,79,156,118,147,208,131,51,248,232,217,206,181,218,58,61,112,244,227,68,45,41,206,69,12,45,163,205,75,6,23,167,145,250,237,92,84,164,240,253,216,54,85,7,108,62,255,42,217,3,27,0,196,94,28,241,120,80,92,89,135,228,125,2,3,242,39,116,64,248,216,177,122,66,178,180,9,7,33,186,208,213,188,59,78,243,95,123,28,142,45,99,130,7,167,194,156,238,199,10,71,141,251,221,158,16,255,38,181,36,184,20,136,240,55,27,51,191,82,105,55,97,78,74,121,191,161,91,126,105,103,174,139,223,145,150,120,156,240,252,182,105,104,205,65,97,129,194,68,218,91,141,11,224,124,132,138,119,36,201,211,39,203,146,225,246,252,21,161,250,188,137,190,42,4,90,126,211,171,240,113,67,28,92,57,77,200,125,224,19,178,142,112,202,5,233,229,128,235,105,239,102,52,179,224,87,45,68,211,10,187,9,38,190,86,25,43,175,56,231,11,108,220,36,129,131,19,93,163,239,169,118,205,50,77,121,139,139,141,197,170,20,44,39,19,97,205,228,8,106,67,210,135,111,127,141,185,175,123,26,226,42,29,217,16,99,9,46,157,232,22,3,105,174,73,144,23,110,55,84,46,4,116,39,113,205,58,158,242,7,208,75,162,55,115,35,52,124,235,114,178,55,43,98,17,100,33,134,237,190,230,60,184,192,104,146,52,58,79,174,180,81,155,114,0,153,113,90,51,86,150,254,136,205,104,39,11,190,187,233,80,81,81,56,18,222,148,116,155,156,33,132,226,127,84,34,83,28,249,153,18,197,10,116,102,125,45,47,36,235,46,212,166,209,3,125,132,237,124,163,68,197,202,232,152,234,75,235,103,248,160,241,213,151,144,130,37,23,51,48,55,12,227,31,163,242,251,245,22,129,77,20,35,150,20,181,203,138,69,233,215,109,178,209,52,85,96,221,179,56,249,138,111,250,141,134,95,152,92,109,183,174,104,151,156,31,66,211,10,57,141,167,18,177,27,126,74,252,29,143,121,173,203,8,27,44,123,148,57,88,163,68,228,158,62,98,121,192,228,94,92,72,241,33,230,173,0,197,1,194,144,111,91,60,0,106,181,203,51,133,120,250,158,184,93,216,184,126,253,21,22,155,99,80,205,227,69,231,141,165,71,70,252,223,105,51,93,22,165,135,233,177,164,139,53,5,85,151,134,214,165,249,100,24,186,207,245,149,68,218,204,252,32,190,90,48,76,57,31,201,15,52,130,135,152,206,63,198,100,126,36,2,104,116,0,160,163,186,2,91,165,57,149,163,12,239,121,152,209,224,136,248,135,136,46,150,32,51,154,6,105,0,71,30,44,175,147,139,34,91,184,78,31,145,18,3,250,122,166,47,252,109,19,40,10,123,163,99,76,133,119,37,180,38,207,79,171,185,188];class a7 extends la{constructor(t,r,i){super(t,s7,r,i)}}const c7=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,160,96,121,255,120,207,227,114,120,38,72,149,145,165,227,75,122,158,250,232,46,34,52,135,9,30,144,17,110,126,110,130,71,156,46,210,67,202,51,119,97,3,211,214,227,45,109,151,97,21,10,229,53,80,26,51,202,119,128,230,197,140,135,40,14,88,128,202,95,21,208,96,83,185,98,216,242,224,15,25,224,233,86,96,46,80,120,220,48,187,86,30,240,140,46,95,81,48,90,117,140,177,51,107,235,158,137,5,241,191,154,149,219,30,126,85,175,10,216,63,139,216,151,122,251,224,202,220,227,221,53,122,34,213,224,94,45,14,200,68,31,61,175,208,17,120,82,244,138,208,165,21,19,236,232,180,217,50,74,70,126,114,227,62,192,124,9,85,148,33,77,255,117,75,102,87,151,255,87,74,74,181,111,108,9,249,220,174,59,80,254,168,29,30,94,171,133,133,195,105,64,254,68,65,18,158,54,73,203,65,175,151,170,236,138,17,119,128,237,214,189,28,250,38,149,97,242,81,212,254,57,18,120,155,64,96,108,75,78,74,121,191,243,30,42,60,103,165,196,160,195,216,99,182,173,214,182,105,53,231,3,45,212,144,101,217,65,141,44,230,125,151,154,123,57,134,223,98,133,156,238,137,181,80,175,230,167,131,180,13,69,77,44,156,165,252,14,27,85,71,1,82,196,64,243,26,167,146,98,201,6,195,247,200,224,44,177,104,109,187,231,83,118,28,159,92,179,28,14,162,81,84,21,168,34,156,21,127,215,88,218,208,11,92,161,239,239,82,221,59,86,83,201,199,216,151,139,23,54,39,52,103,204,247,24,102,94,157,138,42,49,131,183,208,50,95,236,54,6,211,26,68,72,56,212,134,24,91,114,132,1,217,80,38,47,29,47,0,107,102,99,129,33,140,243,74,251,89,247,103,12,114,58,113,240,72,188,39,48,72,89,45,102,206,245,247,231,56,167,129,122,222,47,40,78,227,159,64,206,34,127,203,127,87,40,108,152,238,147,231,46,104,89,182,180,232,86,89,91,57,10,222,202,59,199,135,60,199,189,40,84,125,28,84,162,210,91,143,34,106,117,118,3,125,126,237,60,131,173,153,69,49,212,204,117,163,31,239,202,232,152,234,3,162,32,176,184,184,196,154,131,144,115,6,53,122,55,69,166,19,230,183,175,244,1,156,11,37,121,134,121,152,142,158,125,229,150,44,183,216,109,7,65,222,169,56,222,140,110,233,157,138,66,208,6,111,166,188,76,208,222,4,104,211,10,57,141,243,65,228,86,85,88,169,91,237,56,249,133,77,21,32,37,230,55,0,184,110,228,158,62,98,45,147,177,19,119,89,164,103,132,239,84,139,68,204,157,49,41,50,89,113,159,203,51,133,120,184,210,237,15,249,187,100,253,50,16,154,112,64,193,254,10,235,200,253,84,31,169,171,39,122,70,46,186,139,212,162,173,158,41,23,86,148,172,196,237,242,58,102,180,150,238,191,25,240,204,252,125,148,29,124,51,95,10,196,55,49,159,138,144,255,126,205,43,49,42,17,59,60,77,139,177,239,64,36,224,98,205,234,70,199,103,139,218,206,207,178,217,255,32,134,59,25,221,74,22,102,82,19,20,170,142,134,42,106,249,64,80,222,28,21,169,50,235,4,237,56,81,87,76,32,251,42,6,173,105,54,191,8,136,5,245,206,239,176,9,116,24];class l7 extends la{constructor(t,r,i){super(t,c7,r,i)}}const d7=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,190,100,112,230,97,199,225,96,74,99,94,248,222,162,213,95,122,158,212,233,42,22,37,217,115,36,152,30,123,116,104,212,109,129,41,220,77,213,97,124,45,4,219,197,171,40,18,149,104,20,4,248,102,64,9,50,217,124,131,180,188,159,170,63,1,84,130,150,117,14,212,118,67,165,97,207,242,251,15,30,187,188,77,79,122,67,101,252,109,244,82,37,191,227,35,114,87,57,71,99,218,155,54,101,239,138,197,13,226,228,176,157,158,87,98,55,251,79,150,64,138,200,135,40,132,135,207,146,252,222,57,58,111,151,225,78,59,36,210,70,29,121,160,210,31,109,67,167,194,177,236,91,108,164,229,130,211,59,66,93,18,107,226,54,210,51,8,77,217,19,73,187,33,30,59,9,135,162,49,5,11,225,111,119,11,247,218,129,115,83,205,170,21,4,69,210,133,134,245,109,15,177,9,81,81,203,105,42,158,12,255,151,165,230,205,5,92,196,251,211,187,27,214,43,186,91,233,85,192,229,15,71,38,220,20,38,101,44,78,7,60,251,186,75,103,108,53,166,220,186,208,194,120,207,230,159,248,22,32,142,124,96,157,222,60,191,65,145,6,239,125,151,147,50,58,130,207,110,131,223,231,137,238,28,182,216,167,198,191,37,67,76,1,144,232,218,79,72,28,65,101,43,216,64,253,16,173,179,123,140,27,233,245,199,230,36,181,102,114,247,162,18,34,20,212,25,171,24,28,143,80,94,40,167,34,209,61,117,130,1,198,196,7,21,252,180,255,92,128,119,9,48,156,138,136,151,143,23,44,52,3,40,197,228,31,123,67,163,140,32,54,204,187,149,80,19,255,82,120,195,12,110,65,56,212,143,22,78,44,234,72,140,29,118,103,18,36,7,122,50,37,139,47,142,243,25,208,88,237,126,50,103,127,19,183,29,169,29,1,55,23,100,32,129,239,243,160,61,178,197,117,199,45,57,26,165,135,92,218,59,0,197,54,13,96,40,141,212,221,131,103,46,22,228,191,167,73,20,86,62,11,147,217,116,205,203,110,134,249,51,6,123,23,86,231,157,8,144,83,126,115,118,35,96,36,229,36,220,228,143,71,45,223,129,48,236,5,145,202,188,208,184,70,241,104,255,188,181,146,210,206,144,53,77,101,120,38,8,245,80,230,165,160,183,83,202,79,127,57,214,126,242,150,208,40,239,148,35,163,201,97,74,70,214,181,63,240,147,33,253,149,140,77,197,82,126,189,231,7,196,212,80,14,151,24,57,144,243,81,234,66,24,19,236,2,137,121,246,129,65,7,99,110,174,54,74,182,81,234,142,37,72,110,220,255,64,119,10,188,111,191,228,1,205,9,204,143,56,62,125,84,106,225,131,97,192,43,240,157,161,75,168,247,44,175,65,81,192,48,21,157,167,80,191,130,161,75,85,186,174,42,117,1,68,252,204,138,254,203,152,21,13,64,144,195,207,238,229,54,103,247,159,245,211,85,191,141,168,32,234,85,46,118,12,5,199,4,19,217,203,202,156,33,143,114,116,60,66,40,58,77,208,237,171,26,72,175,114,205,248,87,137,62,210,143,151,197,167,210,241,122,150,104,122,154,2,70,102,83,19,36,141,136,199,42,79,229,71,86,194,109,31,236,80,166,17,230,109,1,40,28,46,224,56,20,230,47,100,254,116,208,76,169,157,241,175,3,70,85,31,38,245,58,33,80,145,237,8,22,71,224,158,156,31,249,81,87,247,230,199,237,96,167,123,63,243,79,156,206,203,160,54,124,68,253,215,132,235,57,185,92,238,55,59,210,104,71,26,183,180,71,12,255,224,192,65,154,72,244,8,164,10,248,46,207,30,92,1,80,244,31,189,138,88,216,218,63,100,227,116,57,119,94,135,5,126,255,32,191,163,61,209,194,88,248,112,139,173,43,69,134,3,160,151,137,25,98,239,166,19,123,208,180,31,120,30,191,75,183,179,126,180,125,92,107,105,206,138,28,67,139,3,188,230,184,255,121,13,181,45,160,114,202,194,123,87,55,124,97,164,82,95,232,216,117,62,5,90,176,82,167,52,160,153,174,168,105,146,91,248,81,79,249,97,138,133,170,245,229,132,61,5,149,224,246,194,213,61,12,109,44,136,235,95,219,133,220,27,93,36,93,124,180,81,141,152,220,170,163,229,197,124,171,232,48,70,251,106,119,150,20,16,49,119,247,42,132,36,76,254,124,177,66,175,9,1,39,92,127,195,171,198,34,2,64,144,179,72,40,151,110,89,229,42,125,33,238,16,220,228,51,203,8,1,68,145,253,133,118,93,163,129,22,13,248,65,12,4,63,101,210,70,170,138,203,14,246,54,194,195,27,107,241,175,35,171,49,52,106,121,45,36,152,85,215,132,78,167,34,18,167,245,152,133,134,170,120,182,10,146,191,37,2,205,47,125,20,203,44,88,81,32,150,223,220,218,238,254,30,212,167,221,115,156,82,226,137,220,221,97,3,139,202,33,9,27,26,126,40,215,25,126,9,82,208,49,217,14,161,81,196,61,60,87,254,213,194,81,216,161,151,209,166,222,230,24,128,117,140,92,4,203,254,170,253,249,88,90,112,226,18,44,122,39,158,158,56,69,204,159,5,179,51,197,233,139,216,102,226,206,248,15,78,112,214,126,67,28,40,38,98,190,178,206,67,94,245,254,160,101,176,32,157,26,132,83,252,228,87,242,32,127,160,112,210,224,133,149,115,41,30,16,200,69,89,81,77,144,12,106,182,73,54,28,53,195,28,216,179,179,136,35,141,102,234,177,240,34,186,106,145,245,3,84,48,251,157,245,11,217,111,227,138,42,67,114,211,177,37,103,16,71,152,72,117,123,36,213,202,56,124,227,84,8,45,229,149,165,214,69,244,169,55,68,62,94,104,228,74,205,123,222,17,7,172,158,227,74,206,149,67,175,171,251,185,121,151,223,63,35,229,32,49,190,209,120,137,69,213,214,19,150,187,177,28,12,158,153,126,149,171,167,234,120,129,109,32,157,180,75,66,56,233,115,127,230,157,32,34,143,156,31,230,168,174,125,118,195,249,243,165,81,246,10,144,15,103,139,55,173,7,59,136,69,172,54,132,165,140,78,77,230,33,169,129,188,71,209,109,161,8,57,57,199,143,31,164,43,58,130,1,110,145,31,229,13,46,149,94,244,106,76,238,105,107,1,183,177,10,61,225,94,185,116,58,183,95,225,22,119,19,248,28,13,123,125,108,158,64,184,77,245,153,162,217,227,208,41,185,211,235,41,153,181,54,166,165,11,154,55,21,184,209,192,249,44,164,160,29,229,159,82,156,198,241,183,114,83,137,186,151,148,31,21,197,216,145,32,13,50,22,241,137,39,71,28,142,160,215,107,221,45,202,104,227,110,186,12,150,145,240,51,49,44,196,115,224,238,149,189,134,99,67,241,62,157,240,114,247,195,26,200,141,97,147,249,23,150,174,10,13,219,81,73,58,242,96,250,243,15,49,218,58,230,104,252,175,150,123,86,185,84,90,198,6,36,0,99,72,28,166,238,115,231,171,249,179,71,174,68,156,227,17,198,79,73,142,99,144,20,80,62,80,191,142,46,71,9,243,6,8,214,116,72,190,106,161,19,185,100,9,187,64,94,86,203,174,156,245,222,95,54,30,148,19,11,50,112,96,61,237,159,173,7,154,127,175,79,48,97,89,78,126,66,171,204,158,195,27,226,205,222,157,89,251,90,125,37,212,27,97,3,141,247,175,50,121,7,187,68,196,181,202,167,189,57,84,81,222,23,27,84,130,176,98,66,240,207,18,23,28,163,163,194,45,37,129,202,170,97,189,0,81,238,0,39,199,163,35,211,206,247,65,29,116,242,67,102,235,13,136,232,230,114,146,187,7,254,142,26,121,16,237,5,160,201,114,94,178,199,95,212,241,45,112,180,188,72,86,114,189,155,149,149,163,210,112,101,12,69,225,75,202,223,28,242,90,215,156,169,224,245,135,128,92,148,217,131,208,255,25,135,117,136,5,104,185,249,161,228,214,16,105,204,9,182,135,153,220,101,244,160,207,58,182,118,185,240,57,245,123,13,112,182,106,229,220,90,29,86,215,96,147,232,2,55,131,225,137,68,245,89,141,252,97,3,129,155,216,223,98,116,45,78,85,141,161,74,215,7,150,171,225,59,78,221,152,236,14,117,100,208,158,86,13,185,124,87,157,111,40,187,182,124,173,71,173,23,199,52,155,190,134,11,23,64,25,215,39,115,231,173,77,72,114,54,252,116,178,59,221,106,241,119,254,30,226,241,204,233,113,197,96,146,0,41,67,3,231,126,12,218,202,22,171,114,249,176,134,160,19,216,31,229,118,226,62,242,126,126,42,127,130,68,218,218,81,202,106,217,191,25,177,82,97,81,36,232,137,58,90,216,190,117,235,20,194,144,76,178,27,213,13,208,18,29,118,126,49,98,203,179,128,237,100,32,242,189,212,6,210,210,188,161,205,13,124,119,13,215,112,41,183,176,215,168,210,182,111,1,115,2,239,141,8,177,124,112,48,197,2,239,11,99,4,36,77,69,47,244,19,153,61,19,2,96,176,7,112,122,131,169,25,189,116,171,49,12,121,162,79,154,74,251,50,233,182,63,180,224,118,49,253,21,20,16,31,144,184,93,174,231,244,183,13,49,225,189,211,73,185,49,110,142,25,226,45,176,233,204,74,33,16,205,88,131,92,157,170,175,68,170,61,53,116,165,16,27,182,160,181,87,241,15,151,85,107,76,167,129,25,172,127,184,138,153,222,228,125,64,44,45,32,12,227,148,106,152,83,240,166,54,235,32,190,12,242,164,123,189,53,194,141,104,43,202,110,4,168,119,245,232,179,178,198,1,224,87,86,160,31,19,140,233,102,191,204,4,98,138,163,191,106,24,213,47,208,82,137,132,131,16,253,84,25,144,90,159,148,16,196,84,166,61,160,101,229,227,93,118,59,87,66,16,128,59,96,131,250,20,184,150,205,91,227,201,62,35,79,180,172,173,85,197,106,153,238,229,60,204,65,193,230,94,101,177,134,6,165,53,171,142,208,155,2,11,4,202,127,54,17,142,117,227,121,128,204,192,147,147,92,189,5,224,148,72,18,83,101,126,124,228,153,242,123,229,247,92,221,6,73,227,250,87,167,194,129,187,73,38,185,109,217,240,193,88,50,178,180,151,54,197,187,137,190,166,233,1,103,204,88,31,127,185,29,65,1,29,254,223,14,83,167,215,114,248,30,173,89,173,187,69,5,105,117,15,106,94,173,63,227,25,230,190,136,168,177,175,107,91,126,254,34,188,25,118,48,12,226,130,153,162,57,47,181,212,79,160,97,64,157,246,90,53,43,149,76,102,15,195,107,58,242,84,172,29,81,198,113,81,251,138,182,154,111,30,171,129,56,17,45,214,153,112,117,203,174,40,38,234,236,32,4,112,225,26,187,195,246,252,9,218,69,160,223,178,54,148,81,8,134,151,75,248,63,224,240,48,75,250,221,85,46,100,50,3,70,64,102,111,160,155,233,59,147,184,57,61,6,126,79,176,16,185,94,166,33,135,78,42,75,140,208,140,44,153,187,64,103,119,160,236,16,239,74,218,219,212,207,110,53,30,76,248,40,111,98,44,20,113,204,233,109,135,96,107,39,163,203,125,45,157,152,71,239,175,174,159,147,80,111,93,38,253,228,154,225,181,101,12,241,127,65,49,189,5,85,151,237,213,143,14,104,138,54,52,27,4,132,67,35,156,86,157,73,16,229,222,245,110,79,165,179,56,179,53,218,229,100,58,87,149,48,231,64,63,115,67,3,172,6,186,115,154,60,53,214,152,149,89,234,37,143,82,255,64,28,183,93,112,39,70,185,57,0,199,9,61,175,219,41,76,37,176,82,125,65,53,160,214,105,62,153,244,222,96,205,6,178,85,41,240,113,0,96,149,38,3,195,18,152,41,246,3,103,29,110,134,30,101,75,46,103,199,184,20,230,8,55,120,4,229,168,35,43,7,28,161,143,87,27,87,79,255,186,44,195,158,155,181,119,81,172,217,107,95,98,55,243,186,66,105,48,224,123,232,84,156,20,10,156,208,204,52,34,228,136,97,242,200,246,211,67,202,40,241,91,92,253,9,54,72,131,221,106,178,32,44,182,4,225,193,37,20,249,249,231,10,206,18,71,254,221,187,172,88,204,6,127,138,102,7,208,75,147,219,199,177,79,36,170,101,207,177,109,95,143,217,41,199,80,183,201,2,254,12,55,23,198,14,255,69,245,138,155,129,227,167,168,130,156,135,14,96,93,48,99,143,107,126,92,117,143,112,108,193,228,84,13,41,186,27,172,92,201,149,116,19,112,197,116,209,128,102,1,55,152,177,28,37,34,50,83,41,199,74,178,59,111,67,118,35,252,36,33,87,28,170,17,215,47,90,154,124,137,15,14,211,59,75,59,30,77,0,49,37,225,191,87,101,127,214,227,160,99,174,234,82,148,235,16,241,219,147,170,127,221,250,116,39,218,156,72,227,172,55,0,79,188,76,51,222,232,24,36,62,94,154,3,61,230,146,114,253,0,128,58,253,90,72,211,242,38,39,133,153,161,119,105,195,152,225,208,105,140,80,217,186,196,157,21,116,230,116,139,25,159,143,118,128,77,201,238,247,228,15,168,4,133,148,21,148,12,44,241,7,115,17,129,176,202,46,130,122,129,235,141,223,85,21,199,65,181,169,52,174,161,153,62,25,164,115,213,89,138,199,103,79,200,165,135,249,244,27,209,178,240,129,211,61,9,111,157,147,119,36,119,255,110,130,84,49,210,225,247,100,26,121,127,163,160,26,79,99,24,77,65,32,178,109,36,27,253,173,110,183,11,14,211,57,130,254,124,104,165,219,31,70,97,14,194,39,61,26,141,125,228,126,194,184,101,160,204,106,128,144,106,103,171,18,246,129,220,85,172,151,123,5,73,155,192,175,91,157,239,61,237,116,170,65,233,56,19,49,114,168,190,3,214,53,250,90,213,244,88,101,30,229,248,124,15,71,141,27,172,235,21,129,211,72,61,172,112,170,128,135,96,196,221,255,27,176,105,188,183,121,33,37,149,53,131,226,233,29,167,234,218,109,53,185,152,36,248,53,61,235,78,21,201,214,210,163,12,251,187,45,188,137,126,127,237,92,234,91,240,225,38,194,57,213,251,237,171,30,99,52,14,49,84,101,252,237,7,166,122,114,32,107,32,207,239,136,168,178,12,11,241,233,230,146,132,18,83,233,41,172,17,6,161,42,113,87,40,255,185,1,146,128,5,240,126,131,71,42,54,124,205,2,122,71,30,222,229,40,134,142,102,97,239,151,177,1,230,231,49,123,219,28,129,91,152,112,13,154,81,197,226,255,112,158,178,177,55,181,108,138,185,245,29,186,21,73,188,209,154,200,89,116,235,198,144,36,87,248,22,7,200,122,7,148,44,42,87,140,238,204,95,231,252,0,136,0,22,39,70,123,125,165,113,227,172,146,163,128,158,36,52,91,19,36,245,27,150,138,141,11,67,239,224,65,24,116,101,7,39,46,142,172,164,243,148,0,33,226,59,47,203,137,156,241,66,250,157,30,204,101,143,134,98,238,155,226,25,184,136,219,89,100,193,11,143,71,139,243,230,151,0,249,1,78,26,32,93,104,157,67,97,164,248,86,124,146,93,74,222,228,167,55,53,100,135,216,109,13,64,37,106,177,200,200,182,92,251,69,31,243,89,80,198,14,132,203,72,103,28,104,217,24,97,223,113,11,29,178,191,210,46,162,255,68,99,8,237,213,162,152,193,183,121,203,19,108,182,29,86,26,192,103,220,103,205,154,179,197,9,22,73,127,175,146,38,119,210,0,24,180,21,245,215,204,91,186,119,138,183,239,15,155,231,248,133,39,24,101,144,236,10,230,54,174,227,73,21,110,10,160,241,232,131,14,212,127,232,59,122,65,146,54,163,9,189,190,121,88,170,62,194,14,204,152,245,38,131,37,91,81,72,114,29,115,239,182,56,44,156,159,177,180,82,160,93,97,86,183,236,50,95,85,39,71,181,225,152,143,63,123,117,34,44,109,160,166,229,240,91,138,102,54,180,173,44,50,80,42,124,7,50,124,211,239,21,94,197,185,239,213,107,142,64,95,124,125,17,180,97,189,101,52,48,19,112,12,70,9,212,177,54,118,66,84,147,236,248,26,124,95,103,135,254,124,49,112,186,99,120,90,8,194,191,88,57,242,65,61,10,104,246,197,252,19,159,58,194,75,173,242,103,8,115,84,69,238,149,26,15,159,182,141,132,119,70,29,53,20,143,46,163,204,6,236,59,45,185,172,89,119,83,38,144,36,222,96,151,26,99,195,163,170,133,92,159,214,53,150,116,90,176,69,145,130,15,172,140,217,215,101,163,115,161,65,101,8,7,183,113,213,134,58,175,130,251,143,173,248,168,135,60,159,30,194,68,208,119,120,2,40,178,227,247,161,77,47,136,46,244,163,72,65,158,25,225,195,61,132,182,204,177,186,200,81,2,65,105,212,72,94,203,232,217,182,123,251,228,160,1,161,204,123,20,37,1,77,208,179,45,149,181,122,102,190,123,213,164,231,41,216,130,234,248,208,251,252,220,84,209,67,47,61,220,5,142,162,26,236,121,142,248,132,255,65,122,203,196,102,191,187,2,195,127,255,193,92,49,91,186,154,39,156,29,211,172,49,104,245,114,153,223,211,199,249,35,130,160,128,0,152,176,183,20,236,113,193,108,26,255,11,237,102,133,245,94,115,114,10,89,229,214,221,99,149,30,99,37,246,10,26,26,39,92,123,170,73,211,127,227,54,30,86,133,159,112,225,91,148,100,174,149,75,143,14,140,20,44,64,212,5,243,8,116,63,30,97,42,123,20,73,212,85,207,83,122,27,251,233,84,10,17,236,232,83,200,127,119,143,163,204,220,167,59,231,20,106,186,222,191,8,40,234,21,25,180,13,116,250,152,224,174,75,3,205,38,173,215,236,151,185,121,254,244,154,239,17,53,106,164,61,49,116,216,118,94,150,35,181,26,238,66,49,211,221,132,146,166,115,39,136,36,205,230,179,31,197,51,148,165,109,38,70,37,148,52,44,209,250,98,58,246,225,103,198,101,26,25,196,207,8,166,21,88,252,175,253,10,88,107,157,19,225,61,12,246,221,37,239,186,167,137,142,135,222,128,174,62,95,216,38,141,157,45,232,97,217,173,203,234,116,129,69,206,189,94,221,12,54,139,186,247,184,16,200,121,244,104,8,7,35,111,47,188,10,140,92,73,143,206,203,72,122,184,20,102,197,130,64,150,63,96,239,8,132,111,217,84,91,198,32,43,100,138,241,15,160,42,190,253,193,184,164,124,29,210,96,67,224,221,182,29,218,129,149,29,128,174,98,88,88,125,56,40,255,120,5,0,87,174,42,150,90,112,201,183,169,19,57,195,191,12,58,244,235,132,25,145,72,146,214,8,125,100,135,12,5,102,97,248,174,24,159,90,33,43,187,6,61,212,241,225,190,219,252,197,123,129,164,108,123,55,230,4,153,166,105,234,15,85,216,23,56,32,3,41,110,68,146,172,133,202,98,41,7,47,152,35,255,168,106,241,226,222,77,244,52,185,65,252,227,32,66,38,11,172,60,28,28,103,84,1,1,205,182,190,28,189,102,253,43,1,191,148,116,10,227,18,81,93,80,239,157,232,215,180,163,165,161,109,177,71,150,244,144,208,160,110,22,174,60,206,43,103,121,55,103,114,115,173,238,13,10,227,251,41,176,216,158,229,216,55,234,128,128,20,167,106,181,86,163,130,215,110,149,191,10,227,215,8,214,154,178,181,15,19,0,247,250,97,74,43,157,55,94,174,41,41,9,199,97,20,91,32,18,10,43,98,240,247,203,20,250,117,160,44,229,202,187,64,54,124,15,184,169,129,27,160,240,26,61,255,60,166,60,144,209,84,55,187,186,168,13,124,125,29,17,100,249,227,62,205,78,179,163,168,139,168,21,38,83,239,151,74,43,66,2,92,72,71,94,216,134,238,20,45,158,213,164,73,57,80,47,198,184,130,223,227,71,132,133,235,177,85,174,142,124,172,200,54,229,40,126,60,76,92,216,153,56,241,174,66,141,90,226,3,30,68,234,71,187,163,112,146,255,22,143,170,204,3,127,179,81,139,160,37,77,246,128,220,196,158,153,73,177,65,199,119,29,197,144,130,248,206,155,253,108,213,124,7,223,221,162,146,134,242,65,99,162,107,120,247,214,207,96,150,169,131,208,218,221,28,24,112,208,23,1,130,142,232,56,104,45,33,158,95,255,123,31,74,76,120,178,155,213,6,195,164,8,8,69,241,197,127,83,169,21,167,19,94,143,252,33,159,248,241,170,153,147,1,149,199,201,131,170,79,236,212,209,143,107,98,24,123,56,33,193,85,247,64,225,135,210,78,145,57,16,145,71,170,20,133,87,235,4,166,239,100,82,235,81,50,223,9,193,52,49,86,129,190,196,82,165,107,63,115,161,98,33,20,193,29,42,151,205,252,124,72,245,48,181,67,7,13,21,127,59,226,188,144,129,112,244,192,121,213,80,42,196,1,13,107,108,78,0,40,121,225,148,237,234,209,216,238,9,147,226,254,96,89,212,72,193,106,75,135,74,227,67,255,92,191,81,188,124,226,149,152,142,15,159,195,238,114,55,255,166,157,230,59,148,170,166,151,65,213,104,253,253,112,150,82,147,137,27,214,100,247,65,81,92,47,86,217,7,45,120,81,130,31,236,243,76,78,3,45,105,172,220,71,48,220,94,196,249,163,193,133,50,236,205,20,55,2,63,14,127,69,113,212,204,12,58,79,89,86,29,61,199,201,64,149,6,144,182,150,129,31,18,167,120,248,82,107,25,143,128,27,161,28,25,153,183,217,238,78,186,106,92,27,202,219,165,96,0,216,234,169,73,101,39,182,113,217,240,170,116,172,221,250,233,48,49,242,83,227,92,181,184,72,230,180,21,15,108,135,25,38,153,25,124,227,26,149,73,236,39,211,244,149,58,183,132,26,223,219,174,144,117,233,219,165,205,157,159,222,184,52,47,241,201,123,65,24,44,55,215,177,168,250,179,115,190,227,123,158,163,179,224,69,196,66,207,254,243,101,221,193,140,250,4,28,222,52,96,138,160,33,218,64,118,214,234,201,152,148,91,178,111,107,144,142,6,182,102,72,188,34,213,181,26,223,58,255,103,81,17,47,169,11,245,224,123,148,215,237,186,107,75,152,90,202,166,22,149,197,5,246,238,78,76,229,106,199,94,127,195,0,45,82,6,159,103,96,138,231,71,46,107,59,216,39,43,12,221,27,214,56,155,145,66,187,169,250,235,78,211,179,239,183,198,163,93,5,196,24,174,143,225,106,139,89,98,13,127,207,184,194,30,1,165,198,169,8,197,118,86,163,221,138,23,209,61,116,79,99,233,43,130,60,244,85,229,243,172,123,148,200,120,192,127,211,52,11,159,41,95,212,230,188,169,156,137,29,212,12,148,168,148,133,243,44,241,139,127,24,246,220,227,125,209,97,60,52,162,192,146,49,161,92,138,112,189,128,59,126,125,46,207,60,79,231,174,152,209,68,223,205,2,38,14,91,116,159,255,28,27,178,248,164,104,158,79,69,214,234,157,12,75,163,83,253,245,202,61,213,176,6,197,230,29,208,166,253,194,254,235,29,141,241,70,249,15,62,0,148,163,135,52,122,40,96,87,31,179,152,51,216,133,184,122,198,203,60,115,218,191,193,16,178,25,148,252,112,104,103,252,36,92,221,28,179,43,199,198,151,128,100,252,217,161,249,34,201,172,118,52,180,252,104,7,223,44,116,102,212,21,40,224,184,55,163,210,21,207,161,239,51,54,155,41,133,18,67,48,3,165,130,251,4,79,214,57,72,130,157,212,144],u7=[0,1,3,4,6,7,9,10,12,13,15,16,18,19,21,22,24,26,29,31,34,36,39,41,44,46,49,51,54,56,59,61,64,65,66,67,68,69,70,72,73,74,75,76,77,79,80,81,82,83,84,85,87,88,89,90,91,92,94,95,96,97,98,99,101,102,103,104,105,106,107,109,110,111,112,113,114,116,117,118,119,120,121,123,124,125,126,127,128,129,131,132,133,134,135,136,138,139,140,141,142,143,145,146,147,148,149,150,151,153,154,155,156,157,158,160,161,162,163,164,165,166,168,169,170,171,172,173,175,176,177,178,179,180,182,183,184,185,186,187,188,190,191,192,193,194,195,197,198,199,200,201,202,204,205,206,207,208,209,210,212,213,214,215,216,217,219,220,221,222,223,224,226,226,226,227,227,227,228,228,228,229,229,229,230,230,231,231,231,232,232,232,233,233,233,234,234,235,235,235,236,236,236,237,237,237,238,238,239,239,239,240,240,240,241,241,241,242,242,243,243,243,244,244,244,245,245,245,246,246,246,247,247,247,248,248,248,249,249,249,250,250,250,251,251,251,252,252,252,253,253,253,254,254,254,255],pw=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,32,33,35,36,37,39,40,42,43,44,46,47,49,50,51,53,54,56,57,58,59,61,62,63,64,66,67,68,69,71,72,73,74,76,77,78,79,81,82,83,84,86,87,88,90,91,92,93,95,96,97,98,100,101,102,103,105,106,107,108,110,111,112,113,115,116,117,118,120,121,122,124,125,126,127,129,130,131,132,134,135,136,137,139,140,141,142,144,145,146,147,149,150,151,152,154,155,156,158,159,160,161,163,164,165,166,168,169,170,171,173,174,175,176,178,179,180,181,183,184,185,186,188,189,190,192,193,194,195,197,198,199,200,202,203,204,205,207,208,209,210,212,213,214,215,217,218,219,220,222,223,224,226,226,226,227,227,228,228,229,229,230,230,231,231,232,232,233,233,234,234,234,235,235,236,236,237,237,238,238,239,239,240,240,241,241,242,242,243,243,243,244,244,244,245,245,245,246,246,246,247,247,247,248,248,248,249,249,249,250,250,250,251,251,251,252,252,252,253,253,253,254,254,254,255],h7=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,35,36,37,38,39,40,41,43,44,45,46,47,48,50,51,52,53,54,55,56,58,59,60,61,62,63,65,66,67,68,69,70,72,73,74,76,77,78,80,81,83,84,85,87,88,89,91,92,94,95,96,98,99,100,102,103,105,106,107,109,110,111,113,114,116,117,118,120,121,122,124,125,127,128,129,131,132,133,135,136,138,139,140,142,143,144,146,147,149,150,151,153,154,155,157,158,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,192,193,193,194,195,195,196,197,197,198,199,199,200,201,201,202,203,203,204,205,205,206,207,207,208,209,209,210,211,211,212,213,213,214,215,215,216,217,217,218,219,219,220,221,221,222,223,223,224,225,225,226,227,227,228,229,229,230,231,231,232,233,233,234,235,235,236,237,237,238,239,239,240,241,241,242,243,243,244,245,245,246,247,247,248,249,249,250,251,251,252,253,253,254,255];class p7 extends la{constructor(t,r,i,s){super(t,d7,i,s),this.lightLevel=.1,this.rednessLevel=.5,this.mskin_he_max=175/180*3.141593,this.mskin_he_min=115/180*3.141593,this.mskin_hc_max=173/180*3.141593,this.mskin_hc_min=116/180*3.141593,this.mskin_hc_axis=2.04203545,this.mfacts_rotate_c=0,this.mfacts_rotate_le=0,this.mfacts_rotate_ge=0,this.tab_addr=null,this.lutTextures=[],this.inputTexture=r,this.init()}setUniforms(){const t=this.gl.getUniformLocation(this.program,"u_flipY"),r=this.gl.getUniformLocation(this.program,"u_denoiseLevel");this.gl.uniform1f(r,this.denoiseLevel),this.gl.uniform1f(t,1);const i=this.gl.getUniformLocation(this.program,"light");this.gl.uniform1f(i,this.lightLevel);const s=this.gl.getUniformLocation(this.program,"redness");this.gl.uniform1f(s,this.rednessLevel);const l=this.gl.getUniformLocation(this.program,"skin_he_max"),d=this.gl.getUniformLocation(this.program,"skin_he_min"),h=this.gl.getUniformLocation(this.program,"skin_hc_max"),p=this.gl.getUniformLocation(this.program,"skin_hc_min"),m=this.gl.getUniformLocation(this.program,"skin_hc_axis"),f=this.gl.getUniformLocation(this.program,"facts_rotate_c"),_=this.gl.getUniformLocation(this.program,"facts_rotate_le"),v=this.gl.getUniformLocation(this.program,"facts_rotate_ge");this.gl.uniform1f(l,this.mskin_he_max),this.gl.uniform1f(d,this.mskin_he_min),this.gl.uniform1f(h,this.mskin_hc_max),this.gl.uniform1f(p,this.mskin_hc_min),this.gl.uniform1f(m,this.mskin_hc_axis),this.gl.uniform1f(f,this.mfacts_rotate_c),this.gl.uniform1f(_,this.mfacts_rotate_le),this.gl.uniform1f(v,this.mfacts_rotate_ge);const T=this.gl.getUniformLocation(this.program,"u_originImage");this.gl.activeTexture(this.gl.TEXTURE2),this.gl.bindTexture(this.gl.TEXTURE_2D,this.inputTexture),this.gl.uniform1i(T,2);const R=["lighten_lut"],w=[this.gl.TEXTURE3];for(let O=0;O<R.length;O++){const B=this.gl.getUniformLocation(this.program,R[O]);this.gl.activeTexture(w[O]),this.gl.bindTexture(this.gl.TEXTURE_2D,this.lutTextures[O]),this.gl.uniform1i(B,O+3)}}setParameters(t){t.denoiseLevel!==void 0&&(this.denoiseLevel=t.denoiseLevel),t.lightLevel!==void 0&&(this.lightLevel=t.lightLevel),t.rednessLevel!==void 0&&(this.rednessLevel=t.rednessLevel,this.updateRedness(this.rednessLevel)),t.lighteningContrastLevel&&this.updateLut(t.lighteningContrastLevel)}init(){this.tab_addr=new Uint8Array(pw);const t=[this.tab_addr],r=[256],i=[1];for(let s=0;s<t.length;s++){const l=this.gl.createTexture();if(!l)throw new P(D.WEBGL_INTERNAL_ERROR,"create lut texture failed");this.gl.bindTexture(this.gl.TEXTURE_2D,l),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.LUMINANCE,r[s],i[s],0,this.gl.LUMINANCE,this.gl.UNSIGNED_BYTE,t[s]),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.lutTextures.push(l)}}updateRedness(t){let i,s,l=t,d=l;l>1&&(l=1),l<0&&(l=0),d>1&&(d=1),d<0&&(d=0),this.mfacts_rotate_c=.8*l,d<.8&&(d=0),this.mskin_he_max=175/180*3.141593,this.mskin_hc_max=173/180*3.141593,this.mskin_he_min=(115-4*d)/180*3.141593,this.mskin_hc_min=(116-4*d)/180*3.141593,this.mskin_hc_axis=(117-4*d)/180*3.141593,this.mskin_hc_axis<this.mskin_hc_min&&(this.mskin_hc_axis=this.mskin_hc_min),this.mskin_hc_min<3.141593/2&&(this.mskin_hc_min=3.141593/2),this.mskin_hc_axis<3.141593/2&&(this.mskin_hc_axis=3.141593/2),this.mskin_he_min<3.141593/2&&(this.mskin_he_min=3.141593/2),this.mskin_hc_max>3.141593&&(this.mskin_hc_max=3.141593),this.mskin_hc_axis>3.141593&&(this.mskin_hc_axis=3.141593),this.mskin_he_max>3.141593&&(this.mskin_he_max=3.141593),i=this.mskin_he_max-this.mskin_hc_max,s=this.mskin_hc_max-this.mskin_hc_axis,this.mfacts_rotate_ge=i>.01?this.mfacts_rotate_c*s/i:this.mfacts_rotate_c,i=this.mskin_hc_min-this.mskin_he_min,s=this.mskin_hc_axis-this.mskin_hc_min,this.mfacts_rotate_le=i>.01?this.mfacts_rotate_c*s/i:this.mfacts_rotate_c}updateLut(t){let r=null;if(t===0&&(r=pw),t===1&&(r=h7),t===2&&(r=u7),!r)throw new P(D.WEBGL_INTERNAL_ERROR,"invalid ylut_table value:"+t);this.tab_addr=new Uint8Array(r);const i=[this.tab_addr],s=[256],l=[1];for(let d=0;d<i.length;d++)this.gl.bindTexture(this.gl.TEXTURE_2D,this.lutTextures[d]),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.LUMINANCE,s[d],l[d],0,this.gl.LUMINANCE,this.gl.UNSIGNED_BYTE,i[d])}}class A7{constructor(){this.gl=null,this.canvas=null,this.programs=[],this.commonProgram=null,this.inputTexture=null,this.outputTextures=[],this.fbos=[],this.originalFrameWidth=0,this.originalFrameHeight=0,this.enableBeauty=!1,this.denoiseLevel=5,this.lightLevel=.35,this.rednessLevel=.5,this.lighteningContrastLevel=1}setEnableBeauty(t){this.enableBeauty=!!t}init(t,r,i){if(!Dr().supportWebGL)throw new P(D.NOT_SUPPORTED,"your browser is not support webGL");if(this.gl=i.getContext("webgl"),!this.gl)throw new P(D.WEBGL_INTERNAL_ERROR,"can not get webgl context");if(this.initGL(t,r),!this.inputTexture)throw new P(D.WEBGL_INTERNAL_ERROR,"can not find input texture");this.canvas=i,this.programs.push(new hw(this.gl)),this.programs.push(new o7(this.gl,t,r)),this.programs.push(new a7(this.gl,t,r)),this.programs.push(new l7(this.gl,t,r)),this.programs.push(new p7(this.gl,this.inputTexture,t,r)),this.commonProgram=this.programs[0].program,this.setDenoiseLevel(this.denoiseLevel),this.setLightLevel(this.lightLevel),this.setRednessLevel(this.rednessLevel),this.setContrastLevel(this.lighteningContrastLevel)}render(t){if(!this.gl||!this.commonProgram||!this.canvas)return void S.warning("video effect manager is not init!");let r=0;if(this.originalFrameHeight===t.videoWidth&&this.originalFrameWidth===t.videoHeight)r=2;else if(this.originalFrameHeight!==t.videoHeight||this.originalFrameWidth!==t.videoWidth){var i,s,l;if(S.debug(k(i=k(s=k(l="beauty effect: resolution changed ".concat(this.originalFrameWidth,"x")).call(l,this.originalFrameHeight," -> ")).call(s,t.videoWidth,"x")).call(i,t.videoHeight)),t.videoHeight===0||t.videoWidth===0)return void S.debug("beauty effect: skip 0 resolution frame");this.canvas.width=t.videoWidth,this.canvas.height=t.videoHeight,t.setAttribute("width",t.videoWidth.toString()),t.setAttribute("height",t.videoHeight.toString()),this.release(),this.init(t.videoWidth,t.videoHeight,this.canvas)}this.gl.viewport(0,0,t.videoWidth,t.videoHeight),this.gl.bindTexture(this.gl.TEXTURE_2D,this.inputTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,t);const d=this.enableBeauty?this.programs.length-1:0;for(let p=0;p<=d;p++){const m=this.programs[p].program;this.gl.useProgram(m);const f=this.gl.getUniformLocation(m,"u_image");this.programs[p].setUniforms(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.fbos[r+p%2]),this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.drawArrays(this.gl.TRIANGLES,0,6),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.outputTextures[r+p%2]),this.gl.uniform1i(f,0)}this.gl.useProgram(this.commonProgram);const h=this.gl.getUniformLocation(this.commonProgram,"u_flipY");this.gl.uniform1f(h,-1),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.drawArrays(this.gl.TRIANGLES,0,6)}setDenoiseLevel(t){var r;V(r=this.programs).call(r,i=>{i instanceof la&&i.setParameters({denoiseLevel:t})}),this.denoiseLevel=t}setLightLevel(t){var r;V(r=this.programs).call(r,i=>{i instanceof la&&i.setParameters({lightLevel:t})}),this.lightLevel=t}setRednessLevel(t){var r;V(r=this.programs).call(r,i=>{i instanceof la&&i.setParameters({rednessLevel:t})}),this.rednessLevel=t}setContrastLevel(t){var r;V(r=this.programs).call(r,i=>{i instanceof la&&i.setParameters({lighteningContrastLevel:t})}),this.lighteningContrastLevel=t}setSize(t,r){var i;V(i=this.programs).call(i,s=>{s instanceof la&&s.setSize(t,r)})}release(){this.gl=null,this.commonProgram=null,this.inputTexture=null,this.programs=[],this.outputTextures=[],this.fbos=[]}initGL(t,r){if(!this.gl)throw new P(D.WEBGL_INTERNAL_ERROR,"can not find webgl context");this.inputTexture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.inputTexture),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR);for(let i=0;i<4;i++){const s=this.gl.createTexture();if(!s)throw new P(D.WEBGL_INTERNAL_ERROR,"create texture failed");this.gl.bindTexture(this.gl.TEXTURE_2D,s),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),i<2?this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,t,r,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null):this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,r,t,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null);const l=this.gl.createFramebuffer();if(!l)throw new P(D.WEBGL_INTERNAL_ERROR,"create frame buffer failed");this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,l),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,s,0),this.outputTextures.push(s),this.fbos.push(l)}this.gl.viewport(0,0,t,r),this.originalFrameWidth=t,this.originalFrameHeight=r}}class f7{constructor(){this.targetFrameRate=0,this.recordedFrameCount=0,this.recordingTime=2}async startRecordBeautyEffectOutput(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4;if(this.recordID)throw new P(D.UNEXPECTED_ERROR,"another beauty effect recording is in progress");const i=Pe(6,"");return this.recordID=i,this.targetFrameRate=t,this.recordedFrameCount=0,this.recordingTime=r,await Mr(1e3*this.recordingTime),this.recordID!==i?(this.recordID=void 0,!0):(this.recordID=void 0,this.recordedFrameCount<this.targetFrameRate*this.recordingTime/2?(S.warning("detect beauty effect overload, current framerate",this.recordedFrameCount/2),!1):(S.debug("beauty effect current framerate",this.recordedFrameCount/2),!0))}stopRecordBeautyEffectOutput(){this.targetFrameRate=0,this.recordedFrameCount=0,this.recordID=void 0}addFrame(){this.recordID&&(this.recordedFrameCount+=1)}}class Aw extends class{get output(){return this._output}async setInput(t){if(t!==this.input){if(t.kind!==this.kind)throw new P(D.UNEXPECTED_ERROR);this.input&&this.removeInput(),this.input=t,await this._setInput(t)}}removeInput(){this.input=void 0,this._removeInput()}async updateOutput(t){this.output!==t&&(this._output=t,this.onOutputChange&&await this.onOutputChange())}replaceOriginMediaStream(t,r){var i,s;const l=ft(i=t.getTracks()).call(i,h=>h.kind===this.kind);l&&t.removeTrack(l);const d=ft(s=r.getTracks()).call(s,h=>h.kind===this.kind);this.output===void 0&&d&&t.addTrack(d),this.output&&(S.debug("replace ".concat(this.output.kind," track to origin media stream")),t.addTrack(this.output))}}{constructor(){super(),this.kind="video",this.fps=15,this.overloadDetector=new f7,this.enabled=!1,this.stopChromeBackgroundLoop=null,this.lastRenderTime=0,this.fps=30,this.manager=new A7}async setBeautyEffectOptions(t,r){if(function(i){i.smoothnessLevel!==void 0&&Ie(i.smoothnessLevel,"options.smoothnessLevel",0,1,!1),i.lighteningLevel!==void 0&&Ie(i.lighteningLevel,"options.lighteningLevel",0,1,!1),i.rednessLevel!==void 0&&Ie(i.rednessLevel,"options.rednessLevel",0,1,!1),i.lighteningContrastLevel!==void 0&&Pr(i.lighteningContrastLevel,"options.lighteningContrastLevel",[0,1,2])}(r),r.smoothnessLevel!==void 0){const i=Math.max(.1,10*r.smoothnessLevel);this.manager.setDenoiseLevel(i)}if(r.lighteningLevel!==void 0){const i=Math.max(.1,r.lighteningLevel/2);this.manager.setLightLevel(i)}if(r.rednessLevel!==void 0){const i=Math.max(.01,r.rednessLevel);this.manager.setRednessLevel(i)}if(r.lighteningContrastLevel!==void 0){const i=r.lighteningContrastLevel;this.manager.setContrastLevel(i)}this.enabled!==t&&(this.manager.setEnableBeauty(t),this.enabled=t,t?this.input&&await this.startEffect():await this.stopEffect())}destroy(){this.onOutputChange=void 0,this.stopEffect(),this.enabled=!1}async startEffect(){const t=Se();if(!this.input)return void S.warning("video track is null, fail to start video effect!");if(this.input&&this.output&&this.input!==this.output)return void S.warning("video effect is already enabled");const r=await this.renderWithWebGL();await this.updateOutput(r),S.info("start video effect, output:",this.output),this.overloadDetector.startRecordBeautyEffectOutput(this.fps).then(s=>{s||this.onOverload&&this.onOverload()});const i=()=>{this.enabled&&requestAnimationFrame(i);const s=ht(),l=1e3/this.fps,d=this.lastRenderTime?s-this.lastRenderTime:l;d<l||(this.lastRenderTime=s-(d-l),this.video&&this.video.paused&&this.video.play(),this.enabled&&this.video&&(this.manager.render(this.video),this.output&&this.output.requestFrame&&this.output.requestFrame(),this.overloadDetector.addFrame()))};requestAnimationFrame(i),t.name===ye.CHROME&&document.addEventListener("visibilitychange",()=>{document.hidden?this.stopChromeBackgroundLoop=xp(()=>{this.enabled&&this.video&&this.manager.render(this.video),this.output&&this.output.requestFrame&&this.output.requestFrame(),this.overloadDetector.addFrame()},this.fps):this.stopChromeBackgroundLoop&&(this.stopChromeBackgroundLoop(),this.stopChromeBackgroundLoop=null)},!1)}async stopEffect(){S.info("stop video effect"),this.overloadDetector.stopRecordBeautyEffectOutput(),this.manager.release(),this.canvas&&this.canvas.remove(),this.video&&this.video.remove(),this.canvas=void 0,this.video=void 0,await this.updateOutput(this.input)}async _setInput(t){this.enabled&&!this.video&&await this.startEffect()}_removeInput(){this.stopEffect()}async renderWithWebGL(){var t;if(!this.input)throw new P(D.BEAUTY_PROCESSOR_INTERNAL_ERROR,"can not renderWithWebGL, no input");this.canvas&&(this.canvas.remove(),this.canvas=void 0),this.video&&(this.video.remove(),this.video=void 0),this.canvas=document.createElement("canvas"),this.video=document.createElement("video"),this.video.setAttribute("autoplay",""),this.video.setAttribute("muted",""),this.video.muted=!0,this.video.setAttribute("playsinline",""),this.video.setAttribute("style","display:none"),this.video.srcObject=new MediaStream([this.input]);const r=new ct(h=>{const p=()=>{this.video&&this.video.removeEventListener("playing",p),h(void 0)};this.video&&this.video.addEventListener("playing",p)});this.video.play(),await r;const i=this.input.getSettings(),s=i.width||this.video.videoWidth,l=i.height||this.video.videoHeight;if(i.frameRate&&this.fps!==i.frameRate&&(this.fps=i.frameRate,S.debug("beauty video processor: set fps to",this.fps)),S.debug(k(t="beauty video processor: width ".concat(s," height ")).call(t,l)),!s||!l)throw new P(D.BEAUTY_PROCESSOR_INTERNAL_ERROR,"can not get track resolution");this.canvas.width=s,this.canvas.height=l,this.video.setAttribute("width",s.toString()),this.video.setAttribute("height",l.toString()),this.manager.init(s,l,this.canvas);const d=Dr();return this.canvas.captureStream(d.supportRequestFrame?0:this.fps).getVideoTracks()[0]}}function Kl(e){const t={};if(e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId}),!e.encoderConfig)return t;const r=$o(e.encoderConfig);return t.width=r.width,t.height=r.height,!U1()&&r.frameRate&&(t.frameRate=r.frameRate),Se().name===ye.EDGE&&typeof t.frameRate=="object"&&(t.frameRate.max=60),Gr()&&(t.frameRate={ideal:30,max:30}),t}function fw(e){const t={};e.screenSourceType&&(t.mediaSource=e.screenSourceType),e.extensionId&&tu()&&(t.extensionId=e.extensionId),e.electronScreenSourceId&&(t.sourceId=e.electronScreenSourceId);const r=e.encoderConfig?nu(e.encoderConfig):null;return t.mandatory={chromeMediaSource:"desktop",maxWidth:r?r.width:void 0,maxHeight:r?r.height:void 0},r&&r.frameRate&&(typeof r.frameRate=="number"?(t.mandatory.maxFrameRate=r.frameRate,t.mandatory.minFrameRate=r.frameRate):(t.mandatory.maxFrameRate=r.frameRate.max||r.frameRate.ideal||r.frameRate.exact||void 0,t.mandatory.minFrameRate=r.frameRate.min||r.frameRate.ideal||r.frameRate.exact||void 0),t.frameRate=r.frameRate),r&&r.width&&(t.width=r.width),r&&r.height&&(t.height=r.height),t}function SA(e){const t={};if(U1()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC,tu()&&(t.googAutoGainControl=e.AGC,t.googAutoGainControl2=e.AGC)),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,tu()&&(t.googNoiseSuppression=e.ANS))),e.encoderConfig){const r=Cc(e.encoderConfig);t.channelCount=r.stereo?2:1,t.sampleRate=r.sampleRate,t.sampleSize=r.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),tu()&&t.channelCount===2&&(t.googAutoGainControl=!1,t.googAutoGainControl2=!1,t.echoCancellation=!1,t.googNoiseSuppression=!1),Se().os===mn.ANDROID&&(t.sampleRate=void 0),t}var Wl,TA;(function(e){e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE"})(Wl||(Wl={})),function(e){e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT"}(TA||(TA={}));var c_=new class{constructor(){this._clientSize=null,this.getClientWidth=()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth,this.getClientHeight=()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight,this.getStyle=e=>window.getComputedStyle(e,null),this.checkCssVisibleProperty=e=>{var t;let r=!0;const i=this.getStyle(e),{display:s,visibility:l,opacity:d,filter:h}=i;if((s==="none"||qt(t=["hidden","collapse"]).call(t,l)||Number(d)<.1)&&(r=!1),!r)return!1;if(h){var p;const m=kt(p=h.split(" ")).call(p,_=>{var v;const T=_.split("(")[0];return qt(v=["brightness","blur","opacity"]).call(v,T)}),f=pt(m).call(m,_=>{const[v,T]=_.split(/\(|\)/);return[v,Number(T.match(/^[0-9\.]+/))]});V(f).call(f,_=>{const[v,T]=_;switch(v){case"brightness":(T<.1||T>3)&&(r=!1);break;case"blur":T>3&&(r=!1);break;case"opacity":T<.1&&(r=!1)}})}return r},this.checkPropertyUpToAllParentNodes=(e,t)=>{let r=!0,i=!0;const s=d=>t(d);let l=e;for(;l&&i;)s(l)||(r=!1,i=!1),l=l.parentElement,l||(i=!1);return r},this.checkActualCssVisibleIncludeInherit=e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty),this.getSizeAboutClient=e=>{const{width:t,height:r,left:i,right:s,top:l,bottom:d}=e.getBoundingClientRect(),h=this.getClientWidth(),p=this.getClientHeight();return{width:t,height:r,left:i,right:s,top:l,bottom:d,clientWidth:h,clientHeight:p,clientMin:Math.min(h,p)}},this.checkActualSize=()=>{const{width:e,height:t,clientMin:r}=this._clientSize;return this.checkSizeIsVisible(e,t,r)},this.elementFromPoint=(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null,this.checkCoverForAPoint=(e,t,r)=>{const i=this.elementFromPoint(e,t);return i!==null&&i!==r},this.getPointPositionList=()=>{const{width:e,height:t,left:r,top:i}=this._clientSize,s=e/6,l=t/6,d=[],h=10**6;for(let p=0;p<5;p++)for(let m=0;m<5;m++){const f=(r*h+(p===0?.1:p===4?(s*p*h-1e5)/h:s*p)*h)/h,_=(i*h+(m===0?.1:m===4?(l*m*h-1e5)/h:l*m)*h)/h;d.push({x:f,y:_})}return[...d]},this.checkElementCover=e=>{var t;const r=this.getPointPositionList();return kt(t=pt(r).call(r,i=>this.checkCoverForAPoint(i.x,i.y,e))).call(t,i=>!!i).length>6},this.checkSizeIsVisible=(e,t,r)=>(e>50||r/e<=10)&&(t>50||r/t<=10),this.checkSizeOfPartInClient=()=>{const{left:e,right:t,top:r,bottom:i,clientHeight:s,clientWidth:l,clientMin:d}=this._clientSize;let h,p,m,f;if(e<0)h=0;else{if(!(e<l))return!1;h=e}if(t<0)return!1;if(p=t<l?t:l,r<0)m=0;else{if(!(r<s))return!1;m=r}if(i<0)return!1;f=i<s?i:s;const _=p-h,v=f-m;return this.checkSizeIsVisible(_,v,d)},this.returnHiddenResult=e=>(this._clientSize=null,{visible:!1,reason:e}),this.checkOneElementVisible=e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(Wl.COVERED);{const t=this.checkActualSize(),r=this.checkSizeOfPartInClient();return t&&!r?this.returnHiddenResult(Wl.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Wl.SIZE)}}return this.returnHiddenResult(Wl.STYLE)}return this.returnHiddenResult(TA.UNMOUNTED)}return this.returnHiddenResult(TA.INVALID_HTML_ELEMENT)},this.checkElementIsMountedOnDom=e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement)}};function gw(e,t){var r=ae(e);if(Xt){var i=Xt(e);t&&(i=kt(i).call(i,function(s){return jt(e,s).enumerable})),r.push.apply(r,i)}return r}function Pc(e){for(var t=1;t<arguments.length;t++){var r,i,s=arguments[t]!=null?arguments[t]:{};t%2?V(r=gw(Object(s),!0)).call(r,function(l){mr(e,l,s[l])}):Zt?ur(e,Zt(s)):V(i=gw(Object(s))).call(i,function(l){ie(e,l,jt(s,l))})}return e}var go=function(e,t,r,i){var s,l=arguments.length,d=l<3?t:i===null?i=jt(t,r):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(e,t,r,i);else for(var h=e.length-1;h>=0;h--)(s=e[h])&&(d=(l<3?s(d):l>3?s(t,r,d):s(t,r))||d);return l>3&&d&&ie(t,r,d),d},je=function(e,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(e,t)};class cr extends ra{constructor(t,r,i,s,l){super(t,l),this.trackMediaType="video",this._videoVisibleTimer=null,this._scalabiltyMode={numSpatialLayers:1,numTemporalLayers:1},this._enabled=!0,this.updateMediaStreamTrackResolution(),this._encoderConfig=r,this._scalabiltyMode=i,this._optimizationMode=s}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Bn.PLAYING)}play(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=At.reportApiInvoke(null,{tag:Wt.TRACER,name:Ht.LOCAL_VIDEO_TRACK_PLAY,options:[this.getTrackId(),typeof t=="string"?t:"HTMLElement",r]});if(!(t instanceof HTMLElement)){const d=document.getElementById(t.toString());var s;d?t=d:(S.warning(k(s="[".concat(this.getTrackId(),'] can not find "#')).call(s,t,'" element, use document.body')),t=document.body)}S.debug("[".concat(this.getTrackId(),"] start video playback"),St(r));const l=Pc(Pc(Pc({},this._getDefaultPlayerConfig()),r),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(l):(this._player=new vA(l),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=be(()=>{try{const d=this.getVideoElementVisibleStatus();this.emit(ta.VIDEO_ELEMENT_VISIBLE_STATUS,d)}catch{}},it("CHECK_VIDEO_VISIBLE_INTERVAL")),i.onSuccess()}stop(){const t=At.reportApiInvoke(null,{tag:Wt.TRACER,name:Ht.LOCAL_VIDEO_TRACK_STOP,options:[this.getTrackId()]});if(!this._player)return t.onSuccess();this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._player.destroy(),this._player=void 0,S.debug("[".concat(this.getTrackId(),"] stop video playback")),t.onSuccess()}async setEnabled(t,r){if(!r){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(S.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await Xe(this,Yt.NEED_DISABLE_TRACK,this)}catch(i){throw S.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}return r||(this._enabled=!1),void S.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await Xe(this,Yt.NEED_ENABLE_TRACK,this)}catch(i){throw S.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}S.info("[".concat(this.getTrackId(),"] setEnabled to true success")),r||(this._enabled=!0)}async setMuted(t){var r;t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._mediaStreamTrack.enabled=!t,S.debug(k(r="[".concat(this.getTrackId(),"] start set muted: ")).call(r,t)),t?await Xe(this,Yt.NEED_MUTE_TRACK,this):await Xe(this,Yt.NEED_UNMUTE_TRACK,this))}getStats(){return ys(()=>{S.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),po(this,Yt.GET_STATS)||Pc({},su)}async setBeautyEffect(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=At.reportApiInvoke(null,{tag:Wt.TRACER,name:Ht.LOCAL_VIDEO_TRACK_BEAUTY,options:[this.getTrackId(),t,r]});if(t||this._videoBeautyProcessor){if(fp()===mn.IOS||fp()===mn.ANDROID){const s=new P(D.INVALID_OPERATION,"can not enable beauty effect on mobile device");throw i.onError(s),s}if(!this._enabled&&t){const s=new P(D.TRACK_IS_DISABLED,"can not enable beauty effect when track is disabled");throw i.onError(s),s}S.info("[".concat(this.getTrackId(),"] start setBeautyEffect"),t,St(r));try{this._videoBeautyProcessor?await this._videoBeautyProcessor.setBeautyEffectOptions(t,r):(this._videoBeautyProcessor=new Aw,this._videoBeautyProcessor.onOverload=()=>{sn(()=>this.emit(ta.BEAUTY_EFFECT_OVERLOAD))},await this._videoBeautyProcessor.setBeautyEffectOptions(t,r),await this._registerTrackProcessor(this._videoBeautyProcessor))}catch(s){throw S.error("[".concat(this.getTrackId(),"] setBeautyEffect error"),s.toString()),i.onError(s),s}S.info("[".concat(this.getTrackId(),"] setBeautyEffect success")),i.onSuccess()}}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}clone(t,r,i,s){const l=this._mediaStreamTrack.clone();return new cr(l,t,r,i,s)}async setBitrateLimit(t){var r;if(S.debug(k(r="[".concat(this.getTrackId(),"] set bitrate limit, ")).call(r,St(t))),t){this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate);try{await Xe(this,Yt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw()}}}async setOptimizationMode(t){var r;if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void S.error(D.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const i=this._optimizationMode;try{this._optimizationMode=t,await Xe(this,Yt.SET_OPTIMIZATION_MODE,this)}catch(s){throw this._optimizationMode=i,S.error("[".concat(this.getTrackId(),"] set optimization mode failed"),s.toString()),s}S.info(k(r="[".concat(this.getTrackId(),"] set optimization mode success (")).call(r,t,")"))}setScalabiltyMode(t){var r;if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return S.error(D.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabiltyMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabiltyMode=t,S.info(k(r="[".concat(this.getTrackId(),"] set scalability mode success (")).call(r,t,")"))}updateMediaStreamTrackResolution(){Kp(this._originMediaStreamTrack).then(t=>{let[r,i]=t;this._videoHeight=i,this._videoWidth=r}).catch(Ml)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}getVideoElementVisibleStatus(){try{var t,r;const i=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),s={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:l,slot:d}=s;if(this.isPlaying&&l instanceof HTMLVideoElement&&d instanceof HTMLElement){const h=c_.checkOneElementVisible(l),p=hr({},h);return p.visible||At.reportApiInvoke(null,{tag:Wt.TRACER,name:Ht.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]}).onSuccess("Not visible because of ".concat(p.reason)),p}return}catch(i){throw new P(D.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}async renewMediaStreamTrack(){}}go([Br(),je("design:type",Function),je("design:paramtypes",[Object,Object]),je("design:returntype",void 0)],cr.prototype,"play",null),go([Nl("LocalVideoTrack","_enabledMutex"),Br(),je("design:type",Function),je("design:paramtypes",[Boolean,Boolean]),je("design:returntype",ct)],cr.prototype,"setEnabled",null),go([Nl("LocalVideoTrack","_enabledMutex"),Br(),Up({report:At}),je("design:type",Function),je("design:paramtypes",[Boolean]),je("design:returntype",ct)],cr.prototype,"setMuted",null),go([Br(),je("design:type",Function),je("design:paramtypes",[]),je("design:returntype",Object)],cr.prototype,"getStats",null),go([Br(),je("design:type",Function),je("design:paramtypes",[Boolean,Object]),je("design:returntype",ct)],cr.prototype,"setBeautyEffect",null),go([Br(),je("design:type",Function),je("design:paramtypes",[]),je("design:returntype",ImageData)],cr.prototype,"getCurrentFrameData",null),go([Br(),je("design:type",Function),je("design:paramtypes",[Object]),je("design:returntype",ct)],cr.prototype,"setBitrateLimit",null),go([Br(),je("design:type",Function),je("design:paramtypes",[String]),je("design:returntype",ct)],cr.prototype,"setOptimizationMode",null),go([Br(),je("design:type",Function),je("design:paramtypes",[Object]),je("design:returntype",void 0)],cr.prototype,"setScalabiltyMode",null),go([Br(),je("design:type",Function),je("design:paramtypes",[]),je("design:returntype",void 0)],cr.prototype,"updateMediaStreamTrackResolution",null);class Nu extends cr{constructor(t,r,i,s,l,d){super(t,r.encoderConfig?$o(r.encoderConfig):{},s,l,d),this._enabled=!0,this._deviceName="default",this.tryResumeVideoForIOS15WeChat=async()=>{Xs()&&!gp()&&mp()&&this._enabled&&!this._isClosed&&(S.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())},this._config=r,this._constraints=i,this._deviceName=t.label,this._config.encoderConfig&&(this._encoderConfig=$o(this._config.encoderConfig)),le.on(yr.IOS_15_INTERRUPTION_END,this.tryResumeVideoForIOS15WeChat),le.on(yr.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15WeChat)}async setDevice(t){var r;const i=At.reportApiInvoke(null,{tag:Wt.TRACER,name:Ht.CAM_VIDEO_TRACK_SET_DEVICE,options:[this.getTrackId(),t]});if(S.info(k(r="[".concat(this.getTrackId(),"] set device to ")).call(r,t)),this._enabled)try{const s=await dn.getDeviceById(t),l={};l.video=Pc({},this._constraints),l.video.deviceId={exact:t},l.video.facingMode=void 0,this._originMediaStreamTrack.stop();let d=null;try{d=await on(l,this.getTrackId())}catch(h){throw S.error("[".concat(this.getTrackId(),"] setDevice failed"),h.toString()),d=await on({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(d.getVideoTracks()[0],!1),h}await this._updateOriginMediaStreamTrack(d.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=s.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(s){throw i.onError(s),S.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}else try{const s=await dn.getDeviceById(t);this._deviceName=s.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(s){throw i.onError(s),S.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}S.info("[".concat(this.getTrackId(),"] setDevice success")),i.onSuccess()}async setEnabled(t,r){if(!r){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(S.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),r||(this._enabled=!1);try{await Xe(this,Yt.NEED_DISABLE_TRACK,this)}catch(l){throw S.error("[".concat(this.getTrackId(),"] setEnabled to false error"),l.toString()),l}return void S.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}const i=Pc({},this._constraints),s=dn.searchDeviceIdByName(this._deviceName);s&&!i.deviceId&&(i.deviceId={exact:s});try{const l=await on({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(l.getVideoTracks()[0],!1),await Xe(this,Yt.NEED_ENABLE_TRACK,this)}catch(l){throw S.error("[".concat(this.getTrackId(),"] setEnabled true error"),l.toString()),l}this.updateMediaStreamTrackResolution(),S.info("[".concat(this.getTrackId(),"] setEnabled to true success")),r||(this._enabled=!0)}async setEncoderConfiguration(t,r){const i=At.reportApiInvoke(null,{tag:Wt.TRACER,name:Ht.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG,options:[this.getTrackId(),t]});if(!this._enabled){const d=new P(D.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");throw i.onError(d),d}t=$o(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin);const s=In(this._config);s.encoderConfig=t;const l=Kl(s);(Ri()||ui()||Zo())&&(l.deviceId=void 0),S.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),St(t),St(l));try{await this._originMediaStreamTrack.applyConstraints(l),this.updateMediaStreamTrackResolution()}catch(d){const h=new P(D.UNEXPECTED_ERROR,d.toString());throw S.error("[".concat(this.getTrackId(),"] applyConstraints error"),h.toString()),i.onError(h),h}this._config=s,this._constraints=l,this._encoderConfig=t;try{await Xe(this,Yt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(d){return i.onError(d),d.throw()}i.onSuccess()}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((ui()||Zo())&&this._enabled&&!this._isClosed&&le.duringInterruption){const t=async()=>{le.off(yr.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(S.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};le.on(yr.IOS_INTERRUPTION_END,t)}else S.debug("[".concat(this.getTrackId(),"] track ended")),this.emit(ta.TRACK_ENDED)}async renewMediaStreamTrack(){const t=Pc({},this._constraints),r=dn.searchDeviceIdByName(this._deviceName);r&&!t.deviceId&&(t.deviceId={exact:r});const i=await on({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}close(){super.close(),le.off(yr.IOS_15_INTERRUPTION_END,this.tryResumeVideoForIOS15WeChat),le.off(yr.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15WeChat)}}go([Br(),je("design:type",Function),je("design:paramtypes",[String]),je("design:returntype",ct)],Nu.prototype,"setDevice",null),go([Nl("CameraVideoTrack","_enabledMutex"),Br(),je("design:type",Function),je("design:paramtypes",[Boolean,Boolean]),je("design:returntype",ct)],Nu.prototype,"setEnabled",null),go([Br(),je("design:type",Function),je("design:paramtypes",[Object,Boolean]),je("design:returntype",ct)],Nu.prototype,"setEncoderConfiguration",null);class Yl{constructor(t,r){this._trust_in_room_=!0,this._trust_audio_enabled_state_=!0,this._trust_video_enabled_state_=!0,this._trust_audio_mute_state_=!0,this._trust_video_mute_state_=!0,this._trust_stream_added_state_=!0,this._audio_muted_=!1,this._video_muted_=!1,this._audio_enabled_=!0,this._video_enabled_=!0,this._audio_added_=!1,this._video_added_=!1,this.uid=t,this._uintid=r}get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio)return this._audioTrack}get videoTrack(){if(this.hasVideo)return this._videoTrack}}var mw={exports:{}},Ew={exports:{}},g7=VT,m7=pl,E7=sp;Ae({target:"Promise",stat:!0},{try:function(e){var t=m7.f(this),r=E7(e);return(r.error?t.reject:t.resolve)(r.value),t.promise}});var _w=g7;_n("asyncIterator"),_n("hasInstance"),_n("isConcatSpreadable"),_n("iterator"),_n("match"),_n("matchAll"),_n("replace"),_n("search"),_n("species"),_n("split"),_n("toPrimitive"),_n("toStringTag"),_n("unscopables"),Da(G.JSON,"JSON",!0);var Iw=Ir.Symbol,_7=Iw;_n("asyncDispose"),_n("dispose"),_n("matcher"),_n("metadata"),_n("observable"),_n("patternMatch"),_n("replaceAll");var vw=_7,Cw=cu.f("asyncIterator"),I7=Cw,l_={exports:{}};(function(e){e.exports=function(t){this.wrapped=t},e.exports.__esModule=!0,e.exports.default=e.exports})(l_),function(e){var t=_w,r=vw,i=I7,s=l_.exports;function l(d){var h,p;function m(_,v){try{var T=d[_](v),R=T.value,w=R instanceof s;t.resolve(w?R.wrapped:R).then(function(O){w?m(_==="return"?"return":"next",O):f(T.done?"return":"normal",O)},function(O){m("throw",O)})}catch(O){f("throw",O)}}function f(_,v){switch(_){case"return":h.resolve({value:v,done:!0});break;case"throw":h.reject(v);break;default:h.resolve({value:v,done:!1})}(h=h.next)?m(h.key,h.arg):p=null}this._invoke=function(_,v){return new t(function(T,R){var w={key:_,arg:v,resolve:T,reject:R,next:null};p?p=p.next=w:(h=p=w,m(_,v))})},typeof d.return!="function"&&(this.return=void 0)}l.prototype[typeof r=="function"&&i||"@@asyncIterator"]=function(){return this},l.prototype.next=function(d){return this._invoke("next",d)},l.prototype.throw=function(d){return this._invoke("throw",d)},l.prototype.return=function(d){return this._invoke("return",d)},e.exports=l,e.exports.__esModule=!0,e.exports.default=e.exports}(Ew),function(e){var t=Ew.exports;e.exports=function(r){return function(){return new t(r.apply(this,arguments))}},e.exports.__esModule=!0,e.exports.default=e.exports}(mw);var Ou=c(mw.exports),Sw={exports:{}};(function(e){var t=l_.exports;e.exports=function(r){return new t(r)},e.exports.__esModule=!0,e.exports.default=e.exports})(Sw);var hn=c(Sw.exports),Tw={exports:{}},Rw=cu.f("iterator"),v7=Rw;(function(e){var t=_w,r=vw,i=v7;e.exports=function(s,l){var d={},h=!1;function p(m,f){return h=!0,f=new t(function(_){_(s[m](f))}),{done:!1,value:l(f)}}return d[r!==void 0&&i||"@@iterator"]=function(){return this},d.next=function(m){return h?(h=!1,m):p("next",m)},typeof s.throw=="function"&&(d.throw=function(m){if(h)throw h=!1,m;return p("throw",m)}),typeof s.return=="function"&&(d.return=function(m){return h?(h=!1,m):p("return",m)}),d},e.exports.__esModule=!0,e.exports.default=e.exports})(Tw);var yw=c(Tw.exports),RA=Iw,C7=Cw,ww=Rw,S7=Ae,T7=Xo.findIndex,R7="findIndex",bw=!0;R7 in[]&&Array(1).findIndex(function(){bw=!1}),S7({target:"Array",proto:!0,forced:bw},{findIndex:function(e){return T7(this,e,arguments.length>1?arguments[1]:void 0)}});var y7=$r("Array").findIndex,w7=L,b7=y7,d_=Array.prototype,Yn=function(e){var t=e.findIndex;return e===d_||w7(d_,e)&&t===d_.findIndex?b7:t},mo={exports:{}};function Nw(e,t){var r=ae(e);if(Xt){var i=Xt(e);t&&(i=kt(i).call(i,function(s){return jt(e,s).enumerable})),r.push.apply(r,i)}return r}function yA(e){for(var t=1;t<arguments.length;t++){var r,i,s=arguments[t]!=null?arguments[t]:{};t%2?V(r=Nw(Object(s),!0)).call(r,function(l){mr(e,l,s[l])}):Zt?ur(e,Zt(s)):V(i=Nw(Object(s))).call(i,function(l){ie(e,l,jt(s,l))})}return e}function Ow(e,t,r,i,s){var l;let d=[],h=[],p=[],m=[],f=!1,_=!1;const v=mo.exports.parse(e);if(V(l=v.mediaDescriptions).call(l,T=>{T.media.mediaType!=="video"||f||(h=T.attributes.payloads,m=T.attributes.extmaps,f=!0),T.media.mediaType!=="audio"||_||(d=T.attributes.payloads,p=T.attributes.extmaps,_=!0)}),!m||h.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!p||d.length===0)throw new Error("Cannot get audio capabilities from SDP.");return V(h).call(h,T=>{var R;(R=T.rtpMap)!==null&&R!==void 0&&R.clockRate&&(T.rtpMap.clockRate=Tr(T.rtpMap.clockRate))}),V(d).call(d,T=>{var R;(R=T.rtpMap)!==null&&R!==void 0&&R.clockRate&&(T.rtpMap.clockRate=Tr(T.rtpMap.clockRate))}),t&&(d=kt(d).call(d,T=>{var R;return((R=T.rtpMap)===null||R===void 0?void 0:R.encodingName.toLowerCase())!=="rtx"}),h=kt(h).call(h,T=>{var R;return((R=T.rtpMap)===null||R===void 0?void 0:R.encodingName.toLowerCase())!=="rtx"})),r&&(h=kt(h).call(h,T=>{var R;return!/(red)|(ulpfec)|(flexfec)/i.test(((R=T.rtpMap)===null||R===void 0?void 0:R.encodingName)||"")})),i&&(i==null?void 0:i.length)>0&&(d=kt(d).call(d,T=>{var R;return qt(i).call(i,((R=T.rtpMap)===null||R===void 0?void 0:R.encodingName.toLowerCase())||"")})),s&&(s==null?void 0:s.length)>0&&(h=kt(h).call(h,T=>{var R;return qt(s).call(s,((R=T.rtpMap)===null||R===void 0?void 0:R.encodingName.toLowerCase())||"")})),{audioCodecs:d,videoCodecs:h,audioExtensions:p,videoExtensions:m}}function wA(e){const t=mo.exports.parse(e);let r,i;for(const s of t.mediaDescriptions){if(!r){const l=s.attributes.iceUfrag,d=s.attributes.icePwd;if(!l||!d)throw new Error("Cannot get iceUfrag or icePwd from SDP.");r={iceUfrag:l,icePwd:d}}if(!i){const l=s.attributes.fingerprints;l.length>0&&(i={fingerprints:l})}}if(!i&&t.attributes.fingerprints.length>0&&(i={fingerprints:t.attributes.fingerprints}),!i||!r)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:r,dtlsParameters:i}}function kw(e){var t,r,i;const{dtls:s,ice:l,rtpCapabilities:d,cname:h}=e,{candidates:p,defaultIp:m,defaultPort:f}=Bw(l.candidates),_={fingerprints:pt(t=s.fingerprints).call(t,R=>({hashFunction:R.algorithm,fingerprint:R.fingerprint}))},v={iceUfrag:l.iceUfrag,icePwd:l.icePwd};let T;switch(s.role){case"server":T="passive";break;case"client":T="active";break;case"auto":T="actpass"}return V(r=d.audioCodecs).call(r,R=>{tn(R.rtcpFeedbacks)||(R.rtcpFeedbacks=[])}),V(i=d.videoCodecs).call(i,R=>{tn(R.rtcpFeedbacks)||(R.rtcpFeedbacks=[])}),d.audioExtensions||(d.audioExtensions=[]),d.videoExtensions||(d.videoExtensions=[]),{dtlsParameters:_,iceParameters:v,candidates:p,rtpCapabilities:d,setup:T,cname:h,defaultIp:m,defaultPort:f}}function ql(e,t,r){const i=[],s=[];return V(e).call(e,l=>{var d;let{ssrcId:h,rtx:p}=l;const m=Pe(8,"track-"),f={ssrcId:h,attributes:yA({label:m,mslabel:r=r||Pe(10,""),msid:k(d="".concat(r," ")).call(d,m)},t&&{cname:t})};if(i.push(f),p!==void 0){var _;const v={ssrcId:p,attributes:yA({label:m,mslabel:r,msid:k(_="".concat(r," ")).call(_,m)},t&&{cname:t})};i.push(v),s.push({semantic:"FID",ssrcIds:[h,p]})}}),e.length>1&&s.push({semantic:"SIM",ssrcIds:pt(e).call(e,l=>{let{ssrcId:d}=l;return d})}),{ssrcs:i,ssrcGroups:s}}function bA(e,t){var r;t instanceof qr&&V(r=e.attributes.payloads).call(r,i=>{var s;if(((s=i.rtpMap)===null||s===void 0?void 0:s.encodingName.toLowerCase())!=="opus")return;i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters.minptime="10",i.fmtp.parameters.useinbandfec="1";const l=t._encoderConfig;l&&(l.bitrate&&!Gr()&&(i.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*l.bitrate))),l.sampleRate&&(i.fmtp.parameters.maxplaybackrate="".concat(l.sampleRate),i.fmtp.parameters["sprop-maxcapturerate"]="".concat(l.sampleRate)),l.stereo&&(i.fmtp.parameters.stereo="1",i.fmtp.parameters["sprop-stereo"]="1"))})}function Dw(e){var t;const r=Yn(t=e.attributes.unrecognized).call(t,s=>s.attField==="x-google-flag"&&s.attValue==="conference");var i;r!==-1&&Ye(i=e.attributes.unrecognized).call(i,r,1)}function Lw(e,t){var r,i;if(!(t instanceof cr&&t._encoderConfig&&xt(r=t._hints).call(r,Kn.SCREEN_TRACK)===-1))return;const s=t._encoderConfig;var l,d;Dr().supportMinBitrate&&s.bitrateMin&&V(l=e.attributes.payloads).call(l,h=>{var p,m;qt(p=["h264","vp8","vp9","av1"]).call(p,((m=h.rtpMap)===null||m===void 0?void 0:m.encodingName.toLowerCase())||"")&&(h.fmtp||(h.fmtp={parameters:{}}),h.fmtp.parameters["x-google-min-bitrate"]="".concat(s.bitrateMin))}),Dr().supportMinBitrate&&!qt(i=t._hints).call(i,Kn.LOW_STREAM)&&s.bitrateMax&&V(d=e.attributes.payloads).call(d,h=>{var p,m;qt(p=["h264","vp8","vp9","av1"]).call(p,((m=h.rtpMap)===null||m===void 0?void 0:m.encodingName.toLowerCase())||"")&&(h.fmtp||(h.fmtp={parameters:{}}),h.fmtp.parameters["x-google-start-bitrate"]="".concat(Math.floor(s.bitrateMax)))})}function Pw(e,t,r){if(!t)return;let i,s;if(e.media.mediaType==="video"?(i=r.videoExtensions,s=r.videoCodecs):(i=r.audioExtensions,s=r.audioCodecs),t.tcc===!0){const T=ft(i).call(i,R=>R.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");if(T){var l;ft(l=e.attributes.extmaps).call(l,w=>w.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")||e.attributes.extmaps.push({entry:T.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"});const R=function(w,O){return kt(O).call(O,B=>!!ft(w).call(w,K=>{var j;return K.payloadType===B.payloadType&&!!ft(j=K.rtcpFeedbacks).call(j,nt=>nt.type==="transport-cc")}))}(s,e.attributes.payloads);V(R).call(R,w=>{var O;ft(O=w.rtcpFeedbacks).call(O,B=>B.type==="transport-cc")||w.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(t.tcc===!1){var d,h;const T=Yn(d=e.attributes.extmaps).call(d,R=>R.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");var p;T!==-1&&Ye(p=e.attributes.extmaps).call(p,T,1),V(h=e.attributes.payloads).call(h,R=>{var w;const O=Yn(w=R.rtcpFeedbacks).call(w,K=>K.type==="transport-cc");var B;O!==-1&&Ye(B=R.rtcpFeedbacks).call(B,O,1)})}if(t.remb===!0){const T=ft(i).call(i,R=>R.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");if(T){var m;ft(m=e.attributes.extmaps).call(m,w=>w.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time")||e.attributes.extmaps.push({entry:T.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"});const R=function(w,O){return kt(O).call(O,B=>!!ft(w).call(w,K=>{var j;return K.payloadType===B.payloadType&&!!ft(j=K.rtcpFeedbacks).call(j,nt=>nt.type==="goog-remb")}))}(s,e.attributes.payloads);V(R).call(R,w=>{var O;ft(O=w.rtcpFeedbacks).call(O,B=>B.type==="goog-remb")||w.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(t.remb===!1){var f,_;const T=Yn(f=e.attributes.extmaps).call(f,R=>R.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");var v;T!==-1&&Ye(v=e.attributes.extmaps).call(v,T,1),V(_=e.attributes.payloads).call(_,R=>{var w;const O=Yn(w=R.rtcpFeedbacks).call(w,K=>K.type==="goog-remb");var B;O!==-1&&Ye(B=R.rtcpFeedbacks).call(B,O,1)})}}function Bw(e){var t;const r=[];V(e).call(e,l=>{const d={foundation:l.foundation,componentId:"1",transport:l.protocol,priority:l.priority.toString(),connectionAddress:l.ip,port:l.port.toString(),type:l.type,extension:{}};r.push(d),r.push(yA(yA({},d),{},{componentId:"2"}))});const i=r[0].connectionAddress||"0.0.0.0",s=r[0].port||"9";return S.debug(k(t="choose highest priority candidate IP:port ".concat(i,":")).call(t,s," as default ICE connection address")),{candidates:r,defaultIp:i,defaultPort:s}}(function(e,t){e.exports=(()=>{var r={8:(l,d,h)=>{h.r(d),h.d(d,{Parser:()=>W,Printer:()=>Mt,parse:()=>ot,print:()=>Lt});const p=`
`,m="".concat("\r").concat(p),f=" ";let _;function v(at){return at>="0"&&at<="9"}function T(at){return at>="!"&&at<="~"}function R(at){return T(at)||at>="\x80"&&at<="\xFF"}function w(at){return at==="!"||at>="#"&&at<="'"||at>="*"&&at<="+"||at>="-"&&at<="."||at>="0"&&at<="9"||at>="A"&&at<="Z"||at>="^"&&at<="~"}function O(at){return at>="1"&&at<="9"}function B(at){return at>="A"&&at<="Z"||at>="a"&&at<="z"}function K(at){return at==="d"||at==="h"||at==="m"||at==="s"}function j(at){return at>""&&at<"	"||at>"\v"&&at<"\f"||at>""&&at<"\xFF"}function nt(at){return B(at)||v(at)||at==="+"||at==="/"}function It(at){return v(at)||B(at)||at==="+"||at==="/"||at==="-"||at==="_"}function vt(at){return B(at)||v(at)||at==="+"||at==="/"}function Rt(at,y){var M=Object.keys(at);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(at);y&&(F=F.filter(function(ut){return Object.getOwnPropertyDescriptor(at,ut).enumerable})),M.push.apply(M,F)}return M}function X(at){for(var y=1;y<arguments.length;y++){var M=arguments[y]!=null?arguments[y]:{};y%2?Rt(Object(M),!0).forEach(function(F){rt(at,F,M[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(at,Object.getOwnPropertyDescriptors(M)):Rt(Object(M)).forEach(function(F){Object.defineProperty(at,F,Object.getOwnPropertyDescriptor(M,F))})}return at}function rt(at,y,M){return y in at?Object.defineProperty(at,y,{value:M,enumerable:!0,configurable:!0,writable:!0}):at[y]=M,at}(function(at){at.VERSION="v",at.ORIGIN="o",at.SESSION_NAME="s",at.INFORMATION="i",at.URI="u",at.EMAIL="e",at.PHONE="p",at.CONNECTION="c",at.BANDWIDTH="b",at.TIME="t",at.REPEAT="r",at.ZONE_ADJUSTMENTS="z",at.KEY="k",at.ATTRIBUTE="a",at.MEDIA="m"})(_||(_={}));class H{consumeText(y,M){let F=M;for(;F<y.length;){const ut=y[F];if(ut==="\0"||ut==="\r"||ut===p)break;F+=1}if(F-M==0)throw new Error("Invalid text, at ".concat(y));return F}consumeUnicastAddress(y,M,F){return this.consumeTill(y,M,f)}consumeOneOrMore(y,M,F){let ut=M;for(;F(y[ut]);)ut++;if(ut-M==0)throw new Error("Invalid rule at ".concat(M,"."));return ut}consumeSpace(y,M){if(y[M]===f)return M+1;throw new Error("Invalid space at ".concat(M,"."))}consumeIP4Address(y,M){let F=M;for(let ut=0;ut<4;ut++)if(F=this.consumeDecimalUChar(y,F),ut!==3){if(y[F]!==".")throw new Error("Invalid IP4 address.");F++}return F}consumeDecimalUChar(y,M){let F=M;for(let Vt=0;Vt<3&&v(y[F]);Vt++,F++);if(F-M==0)throw new Error("Invalid decimal uchar.");const ut=parseInt(y.slice(M,F));if(ut>=0&&ut<=255)return F;throw new Error("Invalid decimal uchar")}consumeIP6Address(y,M){let F=this.consumeHexpart(y,M);return y[F]===":"&&(F+=1,F=this.consumeIP4Address(y,F)),F}consumeHexpart(y,M){let F=M;if(y[F]===":"&&y[F+1]===":"){F+=2;try{F=this.consumeHexseq(y,F)}catch{}return F}if(F=this.consumeHexseq(y,F),y[F]===":"&&y[F+1]===":"){F+=2;try{F=this.consumeHexseq(y,F)}catch{}return F}return F}consumeHexseq(y,M){let F=M;for(;F=this.consumeHex4(y,F),y[F]===":"&&y[F+1]!==":";)F+=1;return F}consumeHex4(y,M){let F=0;for(;F<4;F++)if(!((ut=y[M+F])>="0"&&ut<="9"||ut>="a"&&ut<="f"||ut>="A"&&ut<="F")){if(F===0)throw new Error("Invalid hex 4");break}var ut;return M+F}consumeFQDN(y,M){let F=M;for(;v(y[F])||B(y[F])||y[F]==="-"||y[F]===".";)F+=1;if(F-M<4)throw new Error("Invalid FQDN");return F}consumeExtnAddr(y,M){return this.consumeOneOrMore(y,M,R)}consumeMulticastAddress(y,M,F){switch(F){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(y,M);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(y,M);default:try{return this.consumeFQDN(y,M)}catch{return this.consumeExtnAddr(y,M)}}}consumeIP6MulticastAddress(y,M){const F=this.consumeHexpart(y,M);return y[F]==="/"?this.consumeInteger(y,F+1):F}consumeIP4MulticastAddress(y,M){let F=M+3;const ut=y.slice(M,F),Vt=parseInt(ut);if(Vt<224||Vt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let xe=0;xe<3;xe++){if(y[F]!==".")throw new Error("Invalid IP4 multicast address.");F+=1,F=this.consumeDecimalUChar(y,F)}return y[F]==="/"&&(F+=1),F=this.consumeTTL(y,F),y[F]==="/"&&(F=this.consumeInteger(y,F)),F}consumeInteger(y,M){if(!O(y[M]))throw new Error("Invalid integer.");for(M+=1;v(y[M]);)M+=1;return M}consumeTTL(y,M){if(y[M]==="0")return M+1;if(!O(y[M]))throw new Error("Invalid TTL.");M+=1;for(let F=0;F<2&&v(y[M]);F++)M+=1;return M}consumeToken(y,M){return this.consumeOneOrMore(y,M,w)}consumeTime(y,M){let F=M;if(y[F]==="0")return F+1;for(O(y[F])&&(F+=1);v(y[F]);)F++;if(F-M<10)throw new Error("Invalid time");return F}consumeAddress(y,M){return this.consumeTill(y,M,f)}consumeTypedTime(y,M){let F=M;return F=this.consumeOneOrMore(y,F,v),K(y[F])?F+1:F}consumeRepeatInterval(y,M){if(!O(y[M]))throw new Error("Invalid repeat interval");for(M+=1;v(y[M]);)M+=1;return K(y[M])&&(M+=1),M}consumePort(y,M){return this.consumeOneOrMore(y,M,v)}consume(y,M,F){for(let ut=0;ut<F.length;ut++){if(M+ut>=y.length)throw new Error("consume exceeding value length");if(y[M+ut]!==F[ut])throw new Error("consume ".concat(F," failed at ").concat(ut))}return M+F.length}consumeTill(y,M,F){let ut=M;for(;ut<y.length&&(typeof F!="string"||y[ut]!==F)&&(typeof F!="function"||!F(y[ut]));)ut++;return ut}}class W extends H{constructor(){super(),rt(this,"records",[]),rt(this,"currentLine",0)}parse(y){const M=this.probeEOL(y);this.records=y.split(M).filter(zr=>!!zr.trim()).map(this.parseLine),this.currentLine=0;const F=this.parseVersion(),ut=this.parseOrigin(),Vt=this.parseSessionName(),xe=this.parseInformation(),wr=this.parseUri(),Ke=this.parseEmail(),Jn=this.parsePhone(),cs=this.parseConnection(),gi=this.parseBandWidth(),Nn=this.parseTimeFields(),Mc=this.parseKey(),pa=this.parseSessionAttribute(),an=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:F,origin:ut,sessionName:Vt,information:xe,uri:wr,emails:Ke,phones:Jn,connection:cs,bandwidths:gi,timeFields:Nn,key:Mc,attributes:pa,mediaDescriptions:an}}getCurrentRecord(){const y=this.records[this.currentLine];if(!y)throw new Error("Record doesn't exit.");return y}probeEOL(y){for(let M=0;M<y.length;M++)if(y[M]===p)return y[M-1]==="\r"?m:p;throw new Error("Invalid newline character.")}parseLine(y,M){if(y.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const F=y[0];if(y[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:F,value:y.slice(2),line:M,cur:0}}parseSessionAttribute(){const y=new Ct;for(;this.currentLine<this.records.length;){const M=this.getCurrentRecord();if(M.type!==_.ATTRIBUTE)break;const F={attField:this.extractOneOrMore(M,ut=>w(ut)&&ut!==":"),_cur:0};M.value[M.cur]===":"&&(M.cur+=1,F.attValue=this.extractOneOrMore(M,j)),y.parse(F),this.currentLine++}return y.digest()}parseMediaAttributes(y){const M=new Et(y);for(;this.currentLine<this.records.length;){const F=this.getCurrentRecord();if(F.type!==_.ATTRIBUTE)break;const ut={attField:this.extractOneOrMore(F,Vt=>w(Vt)&&Vt!==":"),_cur:0};F.value[F.cur]===":"&&(F.cur+=1,ut.attValue=this.extractOneOrMore(F,j)),M.parse(ut),this.currentLine++}return M.digest()}parseKey(){const y=this.getCurrentRecord();if(y.type===_.KEY){if(y.value==="prompt"||y.value==="clear:"||y.value==="base64:"||y.value==="uri:")return y.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const y=this.getCurrentRecord();if(y.type===_.ZONE_ADJUSTMENTS){const M=[];for(;;)try{const F=this.extract(y,this.consumeTime);this.consumeSpaceForRecord(y);let ut=!1;y.value[y.cur]==="-"&&(ut=!0,y.cur+=1);const Vt=this.extract(y,this.consumeTypedTime);M.push({time:F,typedTime:Vt,back:ut})}catch{break}if(M.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,M}return[]}parseRepeat(){const y=[];for(;;){const M=this.getCurrentRecord();if(M.type!==_.REPEAT)break;{const F=this.extract(M,this.consumeRepeatInterval),ut=this.parseTypedTime(M);y.push({repeatInterval:F,typedTimes:ut}),this.currentLine++}}return y}parseTypedTime(y){const M=[];for(;;)try{this.consumeSpaceForRecord(y),M.push(this.extract(y,this.consumeTypedTime))}catch{break}if(M.length===0)throw new Error("Invalid typed time.");return M}parseTime(){const y=this.getCurrentRecord(),M=this.extract(y,this.consumeTime);this.consumeSpaceForRecord(y);const F=this.extract(y,this.consumeTime);return this.currentLine++,{startTime:M,stopTime:F}}parseBandWidth(){const y=[];for(;this.currentLine<this.records.length;){const M=this.getCurrentRecord();if(M.type!==_.BANDWIDTH)break;{const F=this.extractOneOrMore(M,w);if(M.value[M.cur]!==":")throw new Error("Invalid bandwidth field.");M.cur++;const ut=this.extractOneOrMore(M,v);y.push({bwtype:F,bandwidth:ut}),this.currentLine++}}return y}parseVersion(){const y=this.getCurrentRecord();if(y.type!==_.VERSION)throw new Error("first sdp record must be version");const M=y.value.slice(0,this.consumeOneOrMore(y.value,0,v));if(M.length!==y.value.length)throw new Error('invalid proto version, "v='.concat(y.value,'"'));return this.currentLine++,M}parseOrigin(){const y=this.getCurrentRecord();if(y.type!==_.ORIGIN)throw new Error("second line of sdp must be origin");const M=this.extractOneOrMore(y,R);this.consumeSpaceForRecord(y);const F=this.extractOneOrMore(y,v);this.consumeSpaceForRecord(y);const ut=this.extractOneOrMore(y,v);this.consumeSpaceForRecord(y);const Vt=this.extractOneOrMore(y,w);this.consumeSpaceForRecord(y);const xe=this.extractOneOrMore(y,w);this.consumeSpaceForRecord(y);const wr=this.extract(y,this.consumeUnicastAddress);return this.currentLine++,{username:M,sessId:F,sessVersion:ut,nettype:Vt,addrtype:xe,unicastAddress:wr}}parseSessionName(){const y=this.getCurrentRecord();if(y.type===_.SESSION_NAME){const M=this.extract(y,this.consumeText);return this.currentLine++,M}}parseInformation(){const y=this.getCurrentRecord();if(y.type!==_.INFORMATION)return;const M=this.extract(y,this.consumeText);return this.currentLine++,M}parseUri(){const y=this.getCurrentRecord();if(y.type===_.URI)return this.currentLine++,y.value}parseEmail(){const y=[];for(;;){const M=this.getCurrentRecord();if(M.type!==_.EMAIL)break;y.push(M.value),this.currentLine++}return y}parsePhone(){const y=[];for(;;){const M=this.getCurrentRecord();if(M.type!==_.PHONE)break;y.push(M.value),this.currentLine++}return y}parseConnection(){const y=this.getCurrentRecord();if(y.type===_.CONNECTION){const M=this.extractOneOrMore(y,w);this.consumeSpaceForRecord(y);const F=this.extractOneOrMore(y,w);this.consumeSpaceForRecord(y);const ut=this.extract(y,this.consumeAddress);return this.currentLine++,{nettype:M,addrtype:F,address:ut}}}parseMedia(){const y=this.getCurrentRecord(),M=this.extract(y,this.consumeToken);this.consumeSpaceForRecord(y);let F=this.extract(y,this.consumePort);y.value[y.cur]==="/"&&(y.cur+=1,F+=this.extract(y,this.consumeInteger)),this.consumeSpaceForRecord(y);const ut=[];for(ut.push(this.extract(y,this.consumeToken));y.value[y.cur]==="/";)y.cur+=1,ut.push(this.extract(y,this.consumeToken));if(ut.length===0)throw new Error("Invalid proto");const Vt=this.parseFmt(y);return this.currentLine++,{mediaType:M,port:F,protos:ut,fmts:Vt}}parseTimeFields(){const y=[];for(;this.getCurrentRecord().type===_.TIME;){const M=this.parseTime(),F=this.parseRepeat(),ut=this.parseZone();y.push({time:M,repeats:F,zones:ut})}return y}parseMediaDescription(){const y=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===_.MEDIA;){const M=this.parseMedia(),F=this.parseInformation(),ut=this.parseConnections(),Vt=this.parseBandWidth(),xe=this.parseKey(),wr=this.parseMediaAttributes(M);y.push({media:M,information:F,connections:ut,bandwidths:Vt,key:xe,attributes:wr})}return y}parseConnections(){const y=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===_.CONNECTION;)y.push(this.parseConnection());return y}parseFmt(y){const M=[];for(;;)try{this.consumeSpaceForRecord(y),M.push(this.extract(y,this.consumeToken))}catch{break}if(M.length===0)throw new Error("Invalid fmts");return M}extract(y,M,...F){const ut=M.call(this,y.value,y.cur,...F),Vt=y.value.slice(y.cur,ut);return y.cur=ut,Vt}extractOneOrMore(y,M){const F=this.consumeOneOrMore(y.value,y.cur,M),ut=y.value.slice(y.cur,F);return y.cur=F,ut}consumeSpaceForRecord(y){if(y.value[y.cur]!==f)throw new Error("Invalid space at ".concat(y.cur,"."));y.cur+=1}}class U extends H{constructor(...y){super(...y),rt(this,"attributes",void 0),rt(this,"digested",!1)}extractOneOrMore(y,M,F){const ut=this.consumeOneOrMore(y.attValue,y._cur,M),Vt=y.attValue.slice(y._cur,ut),[xe,wr]=F||[];if(typeof xe=="number"&&Vt.length<xe)throw new Error("error in length, should be more or equal than ".concat(xe," characters."));if(typeof wr=="number"&&Vt.length>wr)throw new Error("error in length, should be less or equal than ".concat(wr," characters."));return y._cur=ut,Vt}consumeAttributeSpace(y){if(y.attValue[y._cur]!==f)throw new Error("Invalid space at ".concat(y._cur,"."));y._cur+=1}extract(y,M,...F){if(!y.attValue)throw new Error("Nothing to extract from attValue.");const ut=M.call(this,y.attValue,y._cur,...F),Vt=y.attValue.slice(y._cur,ut);return y._cur=ut,Vt}atEnd(y){if(!y.attValue)throw new Error;return y._cur>=y.attValue.length}peekChar(y){if(!y.attValue)throw new Error;return y.attValue[y._cur]}peek(y,M){if(!y.attValue)throw new Error;for(let F=0;F<M.length;F++)if(M[F]!==y.attValue[y._cur+F])return!1;return!0}parseIceUfrag(y){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(y,nt,[4,256])}parseIcePwd(y){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(y,nt,[22,256])}parseIceOptions(y){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const M=[];for(;!this.atEnd(y);){M.push(this.extractOneOrMore(y,nt));try{this.consumeAttributeSpace(y)}catch(F){if(this.atEnd(y))break;throw F}}this.attributes.iceOptions=M}parseFingerprint(y){const M=this.extract(y,this.consumeToken);this.consumeAttributeSpace(y);const F=this.extract(y,this.consumeTill);this.attributes.fingerprints.push({hashFunction:M,fingerprint:F})}parseExtmap(y){const M=this.extractOneOrMore(y,v);let F;this.peekChar(y)==="/"&&(this.extract(y,this.consume,"/"),F=this.extract(y,this.consumeToken)),this.consumeAttributeSpace(y);const ut=this.extract(y,this.consumeTill,f),Vt=X(X({entry:parseInt(M,10)},F&&{direction:F}),{},{extensionName:ut});this.peekChar(y)===f&&(this.consumeAttributeSpace(y),Vt.extensionAttributes=this.extract(y,this.consumeTill)),this.attributes.extmaps.push(Vt)}parseSetup(y){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const M=this.extract(y,this.consumeTill);if(M!=="active"&&M!=="passive"&&M!=="actpass"&&M!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=M}}class Ct extends U{constructor(...y){super(...y),rt(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(y){if(this.digested)throw new Error("already digested");try{switch(y.attField){case"group":this.parseGroup(y);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(y);break;case"ice-pwd":this.parseIcePwd(y);break;case"ice-options":this.parseIceOptions(y);break;case"fingerprint":this.parseFingerprint(y);break;case"setup":this.parseSetup(y);break;case"tls-id":this.parseTlsId(y);break;case"identity":this.parseIdentity(y);break;case"extmap":this.parseExtmap(y);break;case"msid-semantic":this.parseMsidSemantic(y);break;default:y.ignored=!0,this.attributes.unrecognized.push(y)}}catch(M){throw console.error("parsing session attribute ".concat(y.attField,' error, "a=').concat(y.attField,":").concat(y.attValue,'"')),M}if(!y.ignored&&y.attValue&&!this.atEnd(y))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(y){const M=this.extract(y,this.consumeToken),F=[];for(;!this.atEnd(y)&&this.peekChar(y)===f;)this.consumeAttributeSpace(y),F.push(this.extract(y,this.consumeToken));this.attributes.groups.push({semantic:M,identificationTag:F})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(y){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(y,It)}parseIdentity(y){const M=this.extractOneOrMore(y,vt),F=[];for(;!this.atEnd(y)&&this.peekChar(y)===f;){this.consumeAttributeSpace(y);const ut=this.extract(y,this.consumeToken);this.extract(y,this.consume,"=");const Vt=this.extractOneOrMore(y,xe=>xe!==f&&j(xe));F.push({name:ut,value:Vt})}this.attributes.identities.push({assertionValue:M,extensions:F})}parseMsidSemantic(y){this.peekChar(y)===f&&this.consumeAttributeSpace(y);const M={semantic:this.extract(y,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(y)}catch{break}if(this.peekChar(y)==="*"){this.extract(y,this.consume,"*"),M.applyForAll=!0;break}{const F=this.extract(y,this.consumeTill,f);M.identifierList.push(F)}}this.attributes.msidSemantic=M}}class Et extends U{constructor(y){super(),rt(this,"attributes",void 0),y.protos.indexOf("RTP")!==-1||y.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(y){if(this.digested)throw new Error("already digested");try{switch(y.attField){case"extmap":this.parseExtmap(y);break;case"setup":this.parseSetup(y);break;case"ice-ufrag":this.parseIceUfrag(y);break;case"ice-pwd":this.parseIcePwd(y);break;case"ice-options":this.parseIceOptions(y);break;case"candidate":this.parseCandidate(y);break;case"remote-candidate":this.parseRemoteCandidate(y);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(y);break;case"rtpmap":this.parseRtpmap(y);break;case"ptime":this.parsePtime(y);break;case"maxptime":this.parseMaxPtime(y);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(y);break;case"ssrc":this.parseSSRC(y);break;case"fmtp":this.parseFmtp(y);break;case"rtcp-fb":this.parseRtcpFb(y);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(y);break;case"mid":this.parseMid(y);break;case"msid":this.parseMsid(y);break;case"imageattr":this.parseImageAttr(y);break;case"rid":this.parseRid(y);break;case"simulcast":this.parseSimulcast(y);break;case"sctp-port":this.parseSctpPort(y);break;case"max-message-size":this.parseMaxMessageSize(y);break;case"ssrc-group":this.parseSSRCGroup(y);break;default:y.ignored=!0,this.attributes.unrecognized.push(y)}}catch(M){throw console.error("parsing media attribute ".concat(y.attField,' error, "a=').concat(y.attField,":").concat(y.attValue,'"')),M}if(!y.ignored&&y.attValue&&!this.atEnd(y))throw new Error("attribute parsing error")}parseCandidate(y){const M=this.extractOneOrMore(y,nt,[1,32]);this.consumeAttributeSpace(y);const F=this.extractOneOrMore(y,v,[1,5]);this.consumeAttributeSpace(y);const ut=this.extract(y,this.consumeToken);this.consumeAttributeSpace(y);const Vt=this.extractOneOrMore(y,v,[1,10]);this.consumeAttributeSpace(y);const xe=this.extract(y,this.consumeAddress);this.consumeAttributeSpace(y);const wr=this.extract(y,this.consumePort);this.consumeAttributeSpace(y),this.extract(y,this.consume,"typ"),this.consumeAttributeSpace(y);const Ke={foundation:M,componentId:F,transport:ut,priority:Vt,connectionAddress:xe,port:wr,type:this.extract(y,this.consumeToken),extension:{}};for(this.peek(y," raddr")&&(this.extract(y,this.consume," raddr"),this.consumeAttributeSpace(y),Ke.relAddr=this.extract(y,this.consumeAddress)),this.peek(y," rport")&&(this.extract(y,this.consume," rport"),this.consumeAttributeSpace(y),Ke.relPort=this.extract(y,this.consumePort));this.peekChar(y)===f;){this.consumeAttributeSpace(y);const Jn=this.extract(y,this.consumeToken);this.consumeAttributeSpace(y),Ke.extension[Jn]=this.extractOneOrMore(y,T)}this.attributes.candidates.push(Ke)}parseRemoteCandidate(y){const M=[];for(;;){const F=this.extractOneOrMore(y,v,[1,5]);this.consumeAttributeSpace(y);const ut=this.extract(y,this.consumeAddress);this.consumeAttributeSpace(y);const Vt=this.extract(y,this.consumePort);M.push({componentId:F,connectionAddress:ut,port:Vt});try{this.consumeAttributeSpace(y)}catch{break}}this.attributes.remoteCandidatesList.push(M)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(y){const M=this.extract(y,this.consumeToken);this.consumeAttributeSpace(y);const F=this.extract(y,this.consumeTill,"/");this.extract(y,this.consume,"/");const ut={encodingName:F,clockRate:this.extractOneOrMore(y,v)};this.atEnd(y)||this.peekChar(y)!=="/"||(this.extract(y,this.consume,"/"),ut.encodingParameters=parseInt(this.extract(y,this.consumeTill),10));const Vt=this.attributes.payloads.find(xe=>xe.payloadType===parseInt(M,10));Vt?Vt.rtpMap=ut:this.attributes.payloads.push({payloadType:parseInt(M,10),rtpMap:ut,rtcpFeedbacks:[]})}parsePtime(y){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(y,this.consumeTill)}parseMaxPtime(y){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(y,this.consumeTill)}parseDirection(y){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=y.attField}parseSSRC(y){const M=this.extractOneOrMore(y,v);this.consumeAttributeSpace(y);const F=this.extract(y,this.consumeTill,":");let ut;this.peekChar(y)===":"&&(this.extract(y,this.consume,":"),ut=this.extract(y,this.consumeTill));const Vt=this.attributes.ssrcs.find(xe=>xe.ssrcId===parseInt(M,10));Vt?Vt.attributes[F]=ut:this.attributes.ssrcs.push({ssrcId:parseInt(M,10),attributes:{[F]:ut}})}parseFmtp(y){const M=this.extract(y,this.consumeTill,f);this.consumeAttributeSpace(y);const F=this.extract(y,this.consumeTill),ut={};F.split(";").forEach(xe=>{let[wr,Ke]=xe.split("=");wr=wr.trim(),Ke=typeof Ke=="string"?Ke.trim():Ke,typeof wr=="string"&&wr.length>0&&(ut[wr]=Ke)});const Vt=this.attributes.payloads.find(xe=>xe.payloadType===parseInt(M,10));Vt?Vt.fmtp={parameters:ut}:this.attributes.payloads.push({payloadType:parseInt(M,10),rtcpFeedbacks:[],fmtp:{parameters:ut}})}parseFmtParameters(y){const M={},F=this.extract(y,this.consumeTill,"=");y._cur++;const ut=this.extract(y,this.consumeTill,";");for(M[F]=ut;y.attValue[y._cur]===";";){const Vt=this.extract(y,this.consumeTill,"=");y._cur++;const xe=this.extract(y,this.consumeTill,";");M[Vt]=xe}return M}parseRtcpFb(y){let M="";M=this.peekChar(y)==="*"?this.extract(y,this.consume,"*"):this.extract(y,this.consumeTill,f),this.consumeAttributeSpace(y);const F=this.extract(y,this.consumeTill,f);let ut;switch(F){case"trr-int":ut={type:F,interval:this.extract(y,this.consumeTill)};break;case"ack":case"nack":default:{const Vt={type:F};this.peekChar(y)===f&&(this.consumeAttributeSpace(y),Vt.parameter=this.extract(y,this.consumeToken),this.peekChar(y)===f&&(Vt.additional=this.extract(y,this.consumeTill))),ut=Vt}}if(M==="*")this.attributes.rtcpFeedbackWildcards.push(ut);else{const Vt=this.attributes.payloads.find(xe=>xe.payloadType===parseInt(M,10));Vt?Vt.rtcpFeedbacks.push(ut):this.attributes.payloads.push({payloadType:parseInt(M,10),rtcpFeedbacks:[ut]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(y){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const M={port:this.extract(y,this.consumePort)};this.peekChar(y)===f&&(this.consumeAttributeSpace(y),M.netType=this.extractOneOrMore(y,w),this.consumeAttributeSpace(y),M.addressType=this.extractOneOrMore(y,w),this.consumeAttributeSpace(y),M.address=this.extract(y,this.consumeAddress)),this.attributes.rtcp=M}parseMsid(y){const M={id:this.extractOneOrMore(y,w,[1,64])};this.peekChar(y)===f&&(this.consumeAttributeSpace(y),M.appdata=this.extractOneOrMore(y,w,[1,64])),this.attributes.msids.push(M)}parseImageAttr(y){this.attributes.imageattr.push(y.attValue)}parseRid(y){const M=this.extractOneOrMore(y,ut=>B(ut)||v(ut)||ut==="_"||ut==="-");this.consumeAttributeSpace(y);const F={id:M,direction:this.extract(y,this.consumeToken),params:[]};if(this.peekChar(y)===f){if(this.consumeAttributeSpace(y),this.peek(y,"pt=")){this.extract(y,this.consume,"pt=");const ut=[];for(;;){const Vt=this.extract(y,this.consumeToken);ut.push(Vt);try{this.extract(y,this.consume,",")}catch{break}}F.payloads=ut,this.peekChar(y)===f&&this.extract(y,this.consume,f)}for(;;){const ut=this.extract(y,this.consumeToken);switch(ut){case"depend":{const Vt={type:ut,rids:this.extract(y,this.consume,"=").split(",")};F.params.push(Vt);break}case"max-width":case"height-width":case"max-fps":case"max-fs":case"max-br":case"max-pps":case"max-bpp":default:{const Vt={type:ut};this.peekChar(y)==="="&&(this.extract(y,this.consume,"="),Vt.val=this.extract(y,this.consumeTill,";")),F.params.push(Vt)}}try{this.extract(y,this.consume,";")}catch{break}}}this.attributes.rids.push(F)}parseSimulcast(y){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=y.attValue,this.extract(y,this.consumeTill)}parseSctpPort(y){this.attributes.sctpPort=this.extractOneOrMore(y,v,[1,5])}parseMaxMessageSize(y){this.attributes.maxMessageSize=this.extractOneOrMore(y,v,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(y){this.attributes.mid=this.extract(y,this.consumeToken)}parseSSRCGroup(y){const M=this.extract(y,this.consumeToken),F=[];for(;;)try{this.consumeAttributeSpace(y);const ut=this.extract(y,this.consumeInteger);F.push(parseInt(ut,10))}catch{break}this.attributes.ssrcGroups.push({semantic:M,ssrcIds:F})}}function gt(at,y,M){return y in at?Object.defineProperty(at,y,{value:M,enumerable:!0,configurable:!0,writable:!0}):at[y]=M,at}class Mt{constructor(){gt(this,"eol",m)}print(y,M){let F="";return M&&(this.eol=M),F+=this.printVersion(y.version),F+=this.printOrigin(y.origin),F+=this.printSessionName(y.sessionName),F+=this.printInformation(y.information),F+=this.printUri(y.uri),F+=this.printEmail(y.emails),F+=this.printPhone(y.phones),F+=this.printConnection(y.connection),F+=this.printBandwidth(y.bandwidths),F+=this.printTimeFields(y.timeFields),F+=this.printKey(y.key),F+=this.printSessionAttributes(y.attributes),F+=this.printMediaDescription(y.mediaDescriptions),F}printVersion(y){return"v=".concat(y).concat(this.eol)}printOrigin(y){return"o=".concat(y.username," ").concat(y.sessId," ").concat(y.sessVersion," ").concat(y.nettype," ").concat(y.addrtype," ").concat(y.unicastAddress).concat(this.eol)}printSessionName(y){return y?"s=".concat(y).concat(this.eol):""}printInformation(y){return y?"i=".concat(y).concat(this.eol):""}printUri(y){return y?"u=".concat(y).concat(this.eol):""}printEmail(y){let M="";for(const F of y)M+="e=".concat(F).concat(this.eol);return M}printPhone(y){let M="";for(const F of y)M+="e=".concat(F).concat(this.eol);return M}printConnection(y){return y?"c=".concat(y.nettype," ").concat(y.addrtype," ").concat(y.address).concat(this.eol):""}printBandwidth(y){let M="";for(const F of y)M+="b=".concat(F.bwtype,":").concat(F.bandwidth).concat(this.eol);return M}printTimeFields(y){let M="";for(const F of y){M+="t=".concat(F.time.startTime," ").concat(F.time.startTime).concat(this.eol);for(const ut of F.repeats)M+="r=".concat(ut.repeatInterval," ").concat(ut.typedTimes.join(" ")).concat(this.eol);F.zoneAdjustments&&(M+="z=",M+="z=".concat(F.zoneAdjustments.map(ut=>"".concat(ut.time," ").concat(ut.back?"-":""," ").concat(ut.typedTime)).join(" ")).concat(this.eol),M+=this.eol)}return M}printKey(y){return y?"k=".concat(y).concat(this.eol):""}printAttributes(y){let M="";for(const F of y)M+="a=".concat(F.attField).concat(F.attValue?":".concat(F.attValue):"").concat(this.eol);return M}printMediaDescription(y){let M="";for(const F of y)M+=this.printMedia(F.media),M+=this.printInformation(F.information),M+=this.printConnections(F.connections),M+=this.printBandwidth(F.bandwidths),M+=this.printKey(F.key),M+=this.printMediaAttributes(F);return M}printConnections(y){let M="";for(const F of y)M+=this.printConnection(F);return M}printMedia(y){return"m=".concat(y.mediaType," ").concat(y.port," ").concat(y.protos.join("/")," ").concat(y.fmts.join(" ")).concat(this.eol)}printSessionAttributes(y){return new $(this.eol).print(y)}printMediaAttributes(y){return new mt(this.eol).print(y)}}class Y{constructor(y){gt(this,"eol",void 0),this.eol=y}printIceUfrag(y){return y===void 0?"":"a=ice-ufrag:".concat(y).concat(this.eol)}printIcePwd(y){return y===void 0?"":"a=ice-pwd:".concat(y).concat(this.eol)}printIceOptions(y){return y===void 0?"":"a=ice-options:".concat(y.join(f)).concat(this.eol)}printFingerprints(y){return y.length>0?y.map(M=>"a=fingerprint:".concat(M.hashFunction).concat(f).concat(M.fingerprint)).join(this.eol)+this.eol:""}printExtmap(y){return y.map(M=>"a=extmap:".concat(M.entry).concat(M.direction?"/".concat(M.direction):"").concat(f).concat(M.extensionName).concat(M.extensionAttributes?"".concat(f).concat(M.extensionAttributes):"").concat(this.eol)).join("")}printSetup(y){return y===void 0?"":"a=setup:".concat(y).concat(this.eol)}printUnrecognized(y){return y.map(M=>"a=".concat(M.attField).concat(M.attValue?":".concat(M.attValue):"").concat(this.eol)).join("")}}class $ extends Y{print(y){let M="";return M+=this.printGroups(y.groups),M+=this.printMsidSemantic(y.msidSemantic),M+=this.printIceLite(y.iceLite),M+=this.printIceUfrag(y.iceUfrag),M+=this.printIcePwd(y.icePwd),M+=this.printIceOptions(y.iceOptions),M+=this.printFingerprints(y.fingerprints),M+=this.printSetup(y.setup),M+=this.printTlsId(y.tlsId),M+=this.printIdentity(y.identities),M+=this.printExtmap(y.extmaps),M+=this.printUnrecognized(y.unrecognized),M}printGroups(y){let M="";return y.length>0&&(M+=y.map(F=>"a=group:".concat(F.semantic).concat(F.identificationTag.map(ut=>"".concat(f).concat(ut)).join("")).concat(this.eol)).join("")),M}printIceLite(y){return y===void 0?"":"a=ice-lite"+this.eol}printTlsId(y){return y?"a=tls-id:".concat(y).concat(this.eol):""}printIdentity(y){return y.length===0?"":y.map(M=>"a=identity:".concat(M.assertionValue).concat(M.extensions.map(F=>"".concat(f).concat(F.name).concat(F.value?"=".concat(F.value):"")))).join(this.eol)+this.eol}printMsidSemantic(y){if(!y)return"";let M="a=msid-semantic:".concat(y.semantic);return y.applyForAll?M+="".concat(f,"*"):y.identifierList.length>0&&(M+=y.identifierList.map(F=>"".concat(f).concat(F))),M+this.eol}}class mt extends Y{print(y){const M=y.attributes;let F="";return F+=this.printRTCP(M.rtcp),F+=this.printIceUfrag(M.iceUfrag),F+=this.printIcePwd(M.icePwd),F+=this.printIceOptions(M.iceOptions),F+=this.printCandidates(M.candidates),F+=this.printRemoteCandidatesList(M.remoteCandidatesList),F+=this.printEndOfCandidates(M.endOfCandidates),F+=this.printFingerprints(M.fingerprints),F+=this.printSetup(M.setup),F+=this.printMid(M.mid),F+=this.printExtmap(M.extmaps),F+=this.printRTPRelated(M),F+=this.printPtime(M.ptime),F+=this.printMaxPtime(M.maxPtime),F+=this.printDirection(M.direction),F+=this.printSSRCGroups(M.ssrcGroups),F+=this.printSSRC(M.ssrcs),F+=this.printRTCPMux(M.rtcpMux),F+=this.printRTCPMuxOnly(M.rtcpMuxOnly),F+=this.printRTCPRsize(M.rtcpRsize),F+=this.printMSId(M.msids),F+=this.printImageattr(M.imageattr),F+=this.printRid(M.rids),F+=this.printSimulcast(M.simulcast),F+=this.printSCRPPort(M.sctpPort),F+=this.printMaxMessageSize(M.maxMessageSize),F+=this.printUnrecognized(M.unrecognized),F}printCandidates(y){return y.map(M=>"a=candidate:".concat(M.foundation).concat(f).concat(M.componentId).concat(f).concat(M.transport).concat(f).concat(M.priority).concat(f).concat(M.connectionAddress).concat(f).concat(M.port).concat(f,"typ").concat(f).concat(M.type).concat(M.relAddr?"".concat(f,"raddr").concat(f).concat(M.relAddr):"").concat(M.relPort?"".concat(f,"rport").concat(f).concat(M.relPort):"").concat(Object.keys(M.extension).map(F=>"".concat(f).concat(F).concat(f).concat(M.extension[F])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(y){return y.map(M=>"a=remote-candidates:".concat(M.join(f)).concat(this.eol)).join("")}printEndOfCandidates(y){return y===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(y){if(!y.payloads)return"";const M=y.payloads;let F="";F+=y.rtcpFeedbackWildcards.map(ut=>this.printRTCPFeedback("*",ut)).join("");for(const ut of M)F+=this.printRtpMap(ut.payloadType,ut.rtpMap),F+=this.printFmtp(ut.payloadType,ut.fmtp),F+=ut.rtcpFeedbacks.map(Vt=>this.printRTCPFeedback(ut.payloadType,Vt)).join("");return F}printFmtp(y,M){if(!M)return"";const F=Object.keys(M.parameters);return F.length===1&&M.parameters[F[0]]===void 0?"a=fmtp:".concat(y).concat(f).concat(F[0]).concat(this.eol):"a=fmtp:".concat(y).concat(f).concat(Object.keys(M.parameters).map(ut=>"".concat(ut,"=").concat(M.parameters[ut])).join(";")).concat(this.eol)}printRtpMap(y,M){return M?"a=rtpmap:".concat(y).concat(f).concat(M.encodingName,"/").concat(M.clockRate).concat(M.encodingParameters?"/".concat(M.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(y,M){let F="a=rtcp-fb:".concat(y).concat(f),ut=M;switch(ut.type){case"trr-int":F+="ttr-int".concat(f).concat(ut.interval);break;case"ack":case"nack":default:ut=ut,F+="".concat(ut.type),ut.parameter&&(F+="".concat(f).concat(ut.parameter),ut.additional&&(F+="".concat(f).concat(ut.additional)))}return F+this.eol}printPtime(y){return y===void 0?"":"a=ptime:".concat(y).concat(this.eol)}printMaxPtime(y){return y===void 0?"":"a=maxptime:".concat(y).concat(this.eol)}printDirection(y){return y===void 0?"":"a=".concat(y).concat(this.eol)}printSSRC(y){return y.map(M=>Object.keys(M.attributes).map(F=>"a=ssrc:".concat(M.ssrcId.toString(10)).concat(f).concat(F).concat(M.attributes[F]?":".concat(M.attributes[F]):"").concat(this.eol)).join("")).join("")}printRTCPMux(y){return y===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(y){return y===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(y){return y===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(y){if(y===void 0)return"";let M="a=rtcp:".concat(y.port);return y.netType&&(M+="".concat(f).concat(y.netType)),y.addressType&&(M+="".concat(f).concat(y.addressType)),y.address&&(M+="".concat(f).concat(y.address)),M+this.eol}printMSId(y){return y.map(M=>"a=msid:".concat(M.id).concat(M.appdata?"".concat(f).concat(M.appdata):"").concat(this.eol)).join("")}printImageattr(y){return y.map(M=>"a=imageattr:".concat(M).concat(this.eol)).join("")}printRid(y){return y.map(M=>{let F="a=rid:".concat(M.id).concat(f).concat(M.direction);return M.payloads&&(F+="".concat(f,"pt=").concat(M.payloads.join(","))),M.params.length>0&&(F+="".concat(f).concat(M.params.map(ut=>ut.type==="depend"?"depend=".concat(ut.rids.join(",")):"".concat(ut.type,"=").concat(ut.val)).join(";"))),F+this.eol}).join("")}printSimulcast(y){return y===void 0?"":"a=simulcast:".concat(y).concat(this.eol)}printSCRPPort(y){return y===void 0?"":"a=sctp-port:".concat(y).concat(this.eol)}printMaxMessageSize(y){return y===void 0?"":"a=max-message-size:".concat(y)}printMid(y){return y===void 0?"":"a=mid:".concat(y).concat(this.eol)}printSSRCGroups(y){return y.map(M=>"a=ssrc-group:".concat(M.semantic).concat(M.ssrcIds.map(F=>"".concat(f).concat(F.toString(10))).join("")).concat(this.eol)).join("")}}function ot(at){return new W().parse(at)}function Lt(at,y){return new Mt().print(at,y)}}},i={};function s(l){if(i[l])return i[l].exports;var d=i[l]={exports:{}};return r[l](d,d.exports,s),d.exports}return s.d=(l,d)=>{for(var h in d)s.o(d,h)&&!s.o(l,h)&&Object.defineProperty(l,h,{enumerable:!0,get:d[h]})},s.o=(l,d)=>Object.prototype.hasOwnProperty.call(l,d),s.r=l=>{typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(l,"__esModule",{value:!0})},s(8)})()})(mo);class N7{constructor(t){t=In(t);const{remoteIceParameters:r,remoteDtlsParameters:i,candidates:s,remoteRTPCapabilities:l,remoteSetup:d,localCapabilities:h,sdkCodec:p,cname:m,ip:f,port:_}=t,v=mo.exports.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=l,this.candidates=s,this.iceParameters=r,this.dtlsParameters=i,this.setup=d,this.localCapabilities=h,this.cname=m,this.ip=f,this.port=_,this.addressType=xt(f).call(f,":")===-1?"IP4":"IP6";for(let B=0;B<v.mediaDescriptions.length;B++){var T;const K=v.mediaDescriptions[B];if(K.media.port=this.port,V(T=K.connections).call(T,j=>{j.address=this.ip,j.addrtype=this.addressType}),K.attributes.rtcp?(K.attributes.rtcp.address=this.ip,K.attributes.rtcp.port=this.port,K.attributes.rtcp.addressType=this.addressType):K.attributes.rtcp={port:_,address:f,netType:"IN",addressType:this.addressType},K.attributes.iceUfrag=r.iceUfrag,K.attributes.icePwd=r.icePwd,K.attributes.fingerprints=i.fingerprints,K.attributes.candidates=s,K.attributes.setup=d,K.media.mediaType==="video"){var R,w;K.media.fmts=pt(R=l.videoCodecs).call(R,nt=>nt.payloadType.toString(10));const j=kt(w=l.videoCodecs).call(w,nt=>{var It,vt;return(It=nt.rtpMap)===null||It===void 0?void 0:qt(vt=It.encodingName.toLowerCase()).call(vt,p)});if(j.length===0)throw new Error("Codec ".concat(p," not supported by remote SDP."));K.attributes.payloads=j,K.attributes.extmaps=l.videoExtensions}var O;K.media.mediaType==="audio"&&(K.media.fmts=pt(O=l.audioCodecs).call(O,j=>j.payloadType.toString(10)),K.attributes.payloads=l.audioCodecs,K.attributes.extmaps=l.audioExtensions),v.mediaDescriptions[B]=this.mungMediaDesc(K)}this.sessionDesc=v,this.currentMidIndex=v.mediaDescriptions.length-1}toString(){return mo.exports.print(this.sessionDesc)}send(t,r,i){var s,l,d;const{ssrcs:h,ssrcGroups:p}=ql(r,this.cname),m=ft(s=this.sessionDesc.mediaDescriptions).call(s,v=>t===er.VIDEO?v.media.mediaType==="video":v.media.mediaType==="audio"),f=h[0].attributes.label,_=h[0].attributes.mslabel;return m.attributes.ssrcs=k(l=m.attributes.ssrcs).call(l,h),m.attributes.ssrcGroups=k(d=m.attributes.ssrcGroups).call(d,p),{id:f,mslabel:_}}stopSending(t){var r;V(r=this.sessionDesc.mediaDescriptions).call(r,i=>{var s,l;const d=[],h=[],p=[];V(s=i.attributes.ssrcs).call(s,m=>{qt(t).call(t,m.attributes.label||"")?p.push(m):d.push(m)}),V(l=i.attributes.ssrcGroups).call(l,m=>{var f;qt(f=pt(p).call(p,_=>_.ssrcId)).call(f,m.ssrcIds[0])||h.push(m)}),i.attributes.ssrcs=d,i.attributes.ssrcGroups=h})}mute(t){var r;const i=ft(r=this.sessionDesc.mediaDescriptions).call(r,s=>s.attributes.mid===t);if(!i)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));i.attributes.direction="inactive"}unmute(t){var r;const i=ft(r=this.sessionDesc.mediaDescriptions).call(r,s=>s.attributes.mid===t);if(!i)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));i.attributes.direction="sendonly"}receive(t,r,i){V(t).call(t,(s,l)=>{var d;const h=s._mediaStreamTrack,p=Yn(d=this.sessionDesc.mediaDescriptions).call(d,f=>f.attributes.mid===h.kind),m=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[p],s);this.sessionDesc.mediaDescriptions[p]=m})}stopReceiving(t){}restartICE(t,r,i,s){var l;t=In(t),r=In(r),this.iceParameters=t,this.candidates=r,this.ip=i,this.port=s,this.addressType=xt(i).call(i,":")===-1?"IP4":"IP6",V(l=this.sessionDesc.mediaDescriptions).call(l,d=>{var h;d.media.port=this.port,V(h=d.connections).call(h,p=>{p.address=i,p.addrtype=this.addressType}),d.attributes.rtcp?(d.attributes.rtcp.address=this.ip,d.attributes.rtcp.port=this.port,d.attributes.rtcp.addressType=this.addressType):d.attributes.rtcp={port:s,address:i,netType:"IN",addressType:this.addressType},d.attributes.iceUfrag=t.iceUfrag,d.attributes.icePwd=t.icePwd,d.attributes.candidates=this.candidates})}predictReceivingMids(t){const r=[];for(let i=0;i<t;i++)r.push((this.currentMidIndex+i+1).toString(10));return r}mungRecvMediaDsec(t,r){const i=In(t);return bA(i,r),Lw(i,r),i}updateRecvMedia(t,r){var i;const s=Yn(i=this.sessionDesc.mediaDescriptions).call(i,l=>l.attributes.mid===t);if(s!==-1){const l=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],r);this.sessionDesc.mediaDescriptions[s]=l}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,r,i){var s;const l=ft(s=this.sessionDesc.mediaDescriptions).call(s,p=>t===er.VIDEO?p.attributes.mid==="video":p.attributes.mid==="audio");if(l){var d;const p=ft(d=l.attributes.ssrcs).call(d,m=>m.attributes.label===r);var h;p&&(p.attributes.label=i,(h=p.attributes.msid)===null||h===void 0||h.replace(r,i))}}mungMediaDesc(t){const r=In(t);return Dw(r),function(i){var s,l;const d=ft(s=i.attributes.extmaps).call(s,m=>m.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");var h,p;d&&Ye(h=i.attributes.extmaps).call(h,xt(p=i.attributes.extmaps).call(p,d),1),V(l=i.attributes.payloads).call(l,m=>{var f;const _=Yn(f=m.rtcpFeedbacks).call(f,T=>T.type==="transport-cc");var v;_!==-1&&Ye(v=m.rtcpFeedbacks).call(v,_,1)})}(r),r}}function Uo(e){if(Array.isArray(e))return e.map(function(i){return i});if(!Mw(e))return e;var t={};for(var r in e)Mw(e[r])||Array.isArray(e[r])?t[r]=Uo(e[r]):t[r]=e[r];return t}function Mw(e){return!(typeof e!="object"||Array.isArray(e)||!e)}var u_=function(){function e(t){this.input=[],this.size=t}return e.prototype.add=function(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)},e.prototype.diffMean=function(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length},e}(),Uw=function(e,t){return(Uw=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])})(e,t)};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation. All rights reserved.
	Licensed under the Apache License, Version 2.0 (the "License"); you may not use
	this file except in compliance with the License. You may obtain a copy of the
	License at http://www.apache.org/licenses/LICENSE-2.0

	THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
	KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
	WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
	MERCHANTABLITY OR NON-INFRINGEMENT.

	See the Apache Version 2.0 License for specific language governing permissions
	and limitations under the License.
	***************************************************************************** */function h_(e,t){function r(){this.constructor=e}Uw(e,t),e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var p_=function(){return(p_=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)};function A_(e,t,r,i){return new(r||(r=Promise))(function(s,l){function d(m){try{p(i.next(m))}catch(f){l(f)}}function h(m){try{p(i.throw(m))}catch(f){l(f)}}function p(m){m.done?s(m.value):new r(function(f){f(m.value)}).then(d,h)}p((i=i.apply(e,t||[])).next())})}function f_(e,t){var r,i,s,l,d={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return l={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function h(p){return function(m){return function(f){if(r)throw new TypeError("Generator is already executing.");for(;d;)try{if(r=1,i&&(s=2&f[0]?i.return:f[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,f[1])).done)return s;switch(i=0,s&&(f=[2&f[0],s.value]),f[0]){case 0:case 1:s=f;break;case 4:return d.label++,{value:f[1],done:!1};case 5:d.label++,i=f[1],f=[0];continue;case 7:f=d.ops.pop(),d.trys.pop();continue;default:if(s=d.trys,!((s=s.length>0&&s[s.length-1])||f[0]!==6&&f[0]!==2)){d=0;continue}if(f[0]===3&&(!s||f[1]>s[0]&&f[1]<s[3])){d.label=f[1];break}if(f[0]===6&&d.label<s[1]){d.label=s[1],s=f;break}if(s&&d.label<s[2]){d.label=s[2],d.ops.push(f);break}s[2]&&d.ops.pop(),d.trys.pop();continue}f=t.call(e,d)}catch(_){f=[6,_],i=0}finally{r=s=0}if(5&f[0])throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}([p,m])}}}var Ha,ku={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[]},xw={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0},Fw={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0},Qw={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0},Vw={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0},g_=function(){function e(t,r){var i=this;this.videoIsReady=!1,this.videoIsReady2={},this.stats=Uo(ku),this.isFirstVideoReceived={},this.isFirstVideoDecoded={},this.isFirstAudioReceived={},this.isFirstAudioDecoded={},this.lossRateWindowStats=[],this.pc=t,this.options=r,this.intervalTimer=window.setInterval(function(){return A_(i,void 0,void 0,function(){return f_(this,function(s){return this.updateStats(),[2]})})},this.options.updateInterval)}return e.prototype.getStats=function(){return this.stats},e.prototype.setVideoIsReady=function(t){this.videoIsReady=t},e.prototype.setVideoIsReady2=function(t,r){this.videoIsReady2[t]=r},e.prototype.getVideoIsReady=function(t){return this.videoIsReady2[t]||!1},e.prototype.setIsFirstAudioDecoded=function(t){},e.prototype.destroy=function(){window.clearInterval(this.intervalTimer),this.pc=void 0},e.prototype.calcLossRate=function(t){var r=this;this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);for(var i=this.lossRateWindowStats.length,s=0,l=0,d=0,h=0,p=function(_){t[_].forEach(function(v,T){if(r.lossRateWindowStats[i-1][_][T]&&r.lossRateWindowStats[0][_][T]){var R=r.lossRateWindowStats[i-1][_][T].packets-r.lossRateWindowStats[0][_][T].packets,w=r.lossRateWindowStats[i-1][_][T].packetsLost-r.lossRateWindowStats[0][_][T].packetsLost;_==="videoSend"||_==="audioSend"?(s+=R,d+=w):(l+=R,h+=w),Number.isNaN(R)||Number.isNaN(R)?v.packetLostRate=0:v.packetLostRate=R<=0||w<=0?0:w/(R+w)}})},m=0,f=["videoSend","audioSend","videoRecv","audioRecv"];m<f.length;m++)p(f[m]);t.sendPacketLossRate=s<=0||d<=0?0:d/(s+d),t.recvPacketLossRate=l<=0||h<=0?0:h/(l+h)},e}(),O7=function(e){function t(){var r=e!==null&&e.apply(this,arguments)||this;return r._stats=ku,r.lastDecodeVideoReceiverStats=new Map,r}return h_(t,e),t.prototype.updateStats=function(){return A_(this,void 0,void 0,function(){var r,i,s,l;return f_(this,function(d){switch(d.label){case 0:return[4,this._getStats()];case 1:return r=d.sent(),i=this.statsResponsesToObjects(r),this._stats=Uo(ku),s=i.filter(function(h){return h.type==="ssrc"}),this.processSSRCStats(s),(l=i.find(function(h){return h.type==="VideoBwe"}))&&this.processBandwidthStats(l),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats,[2]}})})},t.prototype.processBandwidthStats=function(r){this._stats.bitrate={actualEncoded:Number(r.googActualEncBitrate),targetEncoded:Number(r.googTargetEncBitrate),retransmit:Number(r.googRetransmitBitrate),transmit:Number(r.googTransmitBitrate)},this._stats.sendBandwidth=Number(r.googAvailableSendBandwidth)},t.prototype.processSSRCStats=function(r){var i=this;r.forEach(function(s){var l=s.id.includes("send");switch(s.mediaType+"_"+(l?"send":"recv")){case"video_send":var d=Uo(Fw);d.codec=s.googCodecName,d.adaptionChangeReason="none",s.googCpuLimitedResolution&&(d.adaptionChangeReason="cpu"),s.googBandwidthLimitedResolution&&(d.adaptionChangeReason="bandwidth"),d.avgEncodeMs=Number(s.googAvgEncodeMs),d.inputFrame={width:Number(s.googFrameWidthInput)||Number(s.googFrameWidthSent),height:Number(s.googFrameHeightInput)||Number(s.googFrameHeightSent),frameRate:Number(s.googFrameRateInput)},d.sentFrame={width:Number(s.googFrameWidthSent),height:Number(s.googFrameHeightSent),frameRate:Number(s.googFrameRateInput)},d.firsCount=Number(s.googFirReceived),d.nacksCount=Number(s.googNacksReceived),d.plisCount=Number(s.googPlisReceived),d.frameCount=Number(s.framesEncoded),d.bytes=Number(s.bytesSent),d.packets=Number(s.packetsSent),d.packetsLost=Number(s.packetsLost),d.ssrc=Number(s.ssrc),d.rttMs=Number(s.googRtt||0),i._stats.videoSend.push(d),i._stats.rtt=d.rttMs;break;case"video_recv":var h=Uo(xw),p=i.lastDecodeVideoReceiverStats.get(Number(s.ssrc));if(h.codec=s.googCodecName,h.targetDelayMs=Number(s.googTargetDelayMs),h.renderDelayMs=Number(s.googRenderDelayMs),h.currentDelayMs=Number(s.googCurrentDelayMs),h.minPlayoutDelayMs=Number(s.googMinPlayoutDelayMs),h.decodeMs=Number(s.googDecodeMs),h.maxDecodeMs=Number(s.googMaxDecodeMs),h.receivedFrame={width:Number(s.googFrameWidthReceived),height:Number(s.googFrameHeightReceived),frameRate:Number(s.googFrameRateReceived)},h.decodedFrame={width:Number(s.googFrameWidthReceived),height:Number(s.googFrameHeightReceived),frameRate:Number(s.googFrameRateDecoded)},h.outputFrame={width:Number(s.googFrameWidthReceived),height:Number(s.googFrameHeightReceived),frameRate:Number(s.googFrameRateOutput)},h.jitterBufferMs=Number(s.googJitterBufferMs),h.firsCount=Number(s.googFirsSent),h.nacksCount=Number(s.googNacksSent),h.plisCount=Number(s.googPlisSent),h.framesDecodeCount=Number(s.framesDecoded),h.bytes=Number(s.bytesReceived),h.packets=Number(s.packetsReceived),h.packetsLost=Number(s.packetsLost),h.ssrc=Number(s.ssrc),h.packets>0&&!i.isFirstVideoReceived[h.ssrc]&&(i.onFirstVideoReceived&&i.onFirstVideoReceived(h.ssrc),i.isFirstVideoReceived[h.ssrc]=!0),h.framesDecodeCount>0&&!i.isFirstVideoDecoded[h.ssrc]&&(i.onFirstVideoDecoded&&i.onFirstVideoDecoded(h.ssrc,h.decodedFrame.width,h.decodedFrame.height),i.isFirstVideoDecoded[h.ssrc]=!0),p){var m=p.stats,f=Date.now()-p.lts;h.framesDecodeFreezeTime=m.framesDecodeFreezeTime,h.framesDecodeInterval=m.framesDecodeInterval,h.framesDecodeCount>m.framesDecodeCount&&i.isFirstVideoDecoded?(p.lts=Date.now(),h.framesDecodeInterval=f,h.framesDecodeInterval>=i.options.freezeRateLimit&&(i.getVideoIsReady(parseInt(s.ssrc,10))?h.framesDecodeFreezeTime+=h.framesDecodeInterval:i.setVideoIsReady2(parseInt(s.ssrc,10),!0))):h.framesDecodeCount<p.stats.framesDecodeCount&&(h.framesDecodeInterval=0)}i.lastDecodeVideoReceiverStats.set(h.ssrc,{stats:p_({},h),lts:Date.now()}),i._stats.videoRecv.push(h);break;case"audio_recv":var _=Uo(Vw);_.codec=s.googCodecName,_.outputLevel=Math.abs(Number(s.audioOutputLevel))/32767,_.decodingCNG=Number(s.googDecodingCNG),_.decodingCTN=Number(s.googDecodingCTN),_.decodingCTSG=Number(s.googDecodingCTSG),_.decodingNormal=Number(s.googDecodingNormal),_.decodingPLC=Number(s.googDecodingPLC),_.decodingPLCCNG=Number(s.googDecodingPLCCNG),_.expandRate=Number(s.googExpandRate),_.accelerateRate=Number(s.googAccelerateRate),_.preemptiveExpandRate=Number(s.googPreemptiveExpandRate),_.secondaryDecodedRate=Number(s.googSecondaryDecodedRate),_.speechExpandRate=Number(s.googSpeechExpandRate),_.preferredJitterBufferMs=Number(s.googPreferredJitterBufferMs),_.jitterBufferMs=Number(s.googJitterBufferMs),_.jitterMs=Number(s.googJitterReceived),_.bytes=Number(s.bytesReceived),_.packets=Number(s.packetsReceived),_.packetsLost=Number(s.packetsLost),_.ssrc=Number(s.ssrc),_.receivedFrames=Number(s.googDecodingCTN)||Number(s.packetsReceived),_.droppedFrames=Number(s.googDecodingPLC)+Number(s.googDecodingPLCCNG)||Number(s.packetsLost),_.receivedFrames>0&&!i.isFirstAudioReceived[_.ssrc]&&(i.onFirstAudioReceived&&i.onFirstAudioReceived(_.ssrc),i.isFirstAudioReceived[_.ssrc]=!0),_.decodingNormal>0&&!i.isFirstAudioDecoded[_.ssrc]&&(i.onFirstAudioDecoded&&i.onFirstAudioDecoded(_.ssrc),i.isFirstAudioDecoded[_.ssrc]=!0),i._stats.audioRecv.push(_);break;case"audio_send":var v=Uo(Qw);v.codec=s.googCodecName,v.inputLevel=Math.abs(Number(s.audioInputLevel))/32767,v.aecReturnLoss=Number(s.googEchoCancellationReturnLoss||0),v.aecReturnLossEnhancement=Number(s.googEchoCancellationReturnLossEnhancement||0),v.residualEchoLikelihood=Number(s.googResidualEchoLikelihood||0),v.residualEchoLikelihoodRecentMax=Number(s.googResidualEchoLikelihoodRecentMax||0),v.bytes=Number(s.bytesSent),v.packets=Number(s.packetsSent),v.packetsLost=Number(s.packetsLost),v.ssrc=Number(s.ssrc),v.rttMs=Number(s.googRtt||0),i._stats.rtt=v.rttMs,i._stats.audioSend.push(v)}})},t.prototype._getStats=function(){var r=this;return new Promise(function(i,s){r.pc.getStats(i,s)})},t.prototype.statsResponsesToObjects=function(r){var i=[];return r.result().forEach(function(s){var l={id:s.id,timestamp:s.timestamp.valueOf().toString(),type:s.type};s.names().forEach(function(d){l[d]=s.stat(d)}),i.push(l)}),i},t}(g_);(function(e){e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver"})(Ha||(Ha={}));var Gw=function(e){function t(){var r=e!==null&&e.apply(this,arguments)||this;return r._stats=ku,r.lastDecodeVideoReceiverStats=new Map,r.lastVideoFramesRecv=new Map,r.lastVideoFramesSent=new Map,r.lastVideoFramesDecode=new Map,r.lastVideoJBDelay=new Map,r.lastAudioJBDelay=new Map,r.mediaBytesSent=new Map,r.mediaBytesRetransmit=new Map,r.mediaBytesTargetEncode=new Map,r.lastEncoderMs=new Map,r}return h_(t,e),t.prototype.updateStats=function(){return A_(this,void 0,void 0,function(){var r,i=this;return f_(this,function(s){switch(s.label){case 0:return r=this,[4,this.pc.getStats()];case 1:return r.report=s.sent(),this._stats=Uo(ku),this.report.forEach(function(l){switch(l.type){case Ha.OUTBOUND:l.mediaType==="audio"?i.processAudioOutboundStats(l):l.mediaType==="video"&&i.processVideoOutboundStats(l);break;case Ha.INBOUND:l.mediaType==="audio"?i.processAudioInboundStats(l):l.mediaType==="video"&&i.processVideoInboundStats(l);break;case Ha.TRANSPORT:var d=i.report.get(l.selectedCandidatePairId);d&&i.processCandidatePairStats(d);break;case Ha.CANDIDATE_PAIR:l.selected&&i.processCandidatePairStats(l)}}),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats,[2]}})})},t.prototype.processCandidatePairStats=function(r){this._stats.sendBandwidth=r.availableOutgoingBitrate||0,r.currentRoundTripTime&&(this._stats.rtt=1e3*r.currentRoundTripTime),this._stats.videoSend.forEach(function(i){!i.rttMs&&r.currentRoundTripTime&&(i.rttMs=1e3*r.currentRoundTripTime)}),this._stats.audioSend.forEach(function(i){!i.rttMs&&r.currentRoundTripTime&&(i.rttMs=1e3*r.currentRoundTripTime)})},t.prototype.processAudioInboundStats=function(r){var i=this._stats.audioRecv.find(function(s){return s.ssrc===r.ssrc});i||(i=Uo(Vw),this._stats.audioRecv.push(i)),i.ssrc=r.ssrc,i.packets=r.packetsReceived,i.packetsLost=r.packetsLost,i.bytes=r.bytesReceived,i.jitterMs=1e3*r.jitter,r.trackId&&this.processAudioTrackReceiverStats(r.trackId,i),r.codecId&&(i.codec=this.getCodecFromCodecStats(r.codecId)),i.receivedFrames||(i.receivedFrames=r.packetsReceived),i.droppedFrames||(i.droppedFrames=r.packetsLost),i.receivedFrames>0&&!this.isFirstAudioReceived[i.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(i.ssrc),this.isFirstAudioReceived[i.ssrc]=!0),i.outputLevel&&i.outputLevel>0&&!this.isFirstAudioDecoded[i.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(i.ssrc),this.isFirstAudioDecoded[i.ssrc]=!0)},t.prototype.processVideoInboundStats=function(r){var i=this._stats.videoRecv.find(function(_){return _.ssrc===r.ssrc});i||(i=Uo(xw),this._stats.videoRecv.push(i)),i.ssrc=r.ssrc,i.packets=r.packetsReceived,i.packetsLost=r.packetsLost,i.bytes=r.bytesReceived,i.firsCount=r.firCount,i.nacksCount=r.nackCount,i.plisCount=r.pliCount,i.framesDecodeCount=r.framesDecoded;var s=this.lastDecodeVideoReceiverStats.get(i.ssrc),l=this.lastVideoFramesDecode.get(i.ssrc),d=Date.now();if(i.framesDecodeCount>0&&!this.isFirstVideoDecoded[i.ssrc]){var h=i.decodedFrame?i.decodedFrame.width:0,p=i.decodedFrame?i.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(i.ssrc,h,p),this.isFirstVideoDecoded[i.ssrc]=!0}if(s){var m=s.stats,f=d-s.lts;i.framesDecodeFreezeTime=m.framesDecodeFreezeTime,i.framesDecodeInterval=m.framesDecodeInterval,i.framesDecodeCount>m.framesDecodeCount&&this.isFirstVideoDecoded?(s.lts=Date.now(),i.framesDecodeInterval=f,i.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(r.ssrc))?i.framesDecodeFreezeTime+=i.framesDecodeInterval:this.setVideoIsReady2(parseInt(r.ssrc,10),!0))):i.framesDecodeCount<m.framesDecodeCount&&(i.framesDecodeInterval=0)}l&&d-l.lts>=800?(i.decodeFrameRate=Math.round((i.framesDecodeCount-l.count)/((d-l.lts)/1e3)),this.lastVideoFramesDecode.set(i.ssrc,{count:i.framesDecodeCount,lts:d,rate:i.decodeFrameRate})):l?i.decodeFrameRate=l.rate:this.lastVideoFramesDecode.set(i.ssrc,{count:i.framesDecodeCount,lts:d,rate:0}),r.totalDecodeTime&&(i.decodeMs=1e3*r.totalDecodeTime),r.trackId&&this.processVideoTrackReceiverStats(r.trackId,i),r.codecId&&(i.codec=this.getCodecFromCodecStats(r.codecId)),r.framerateMean&&(i.framesRateFirefox=r.framerateMean),i.packets>0&&!this.isFirstVideoReceived[i.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(i.ssrc),this.isFirstVideoReceived[i.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(i.ssrc,{stats:p_({},i),lts:s?s.lts:Date.now()})},t.prototype.processVideoOutboundStats=function(r){var i=this._stats.videoSend.find(function(v){return v.ssrc===r.ssrc});i||(i=Uo(Fw),this._stats.videoSend.push(i));var s=this.mediaBytesSent.get(r.ssrc);if(s?s.add(r.bytesSent):((d=new u_(10)).add(r.bytesSent),this.mediaBytesSent.set(r.ssrc,d)),r.retransmittedBytesSent!==void 0){var l=this.mediaBytesRetransmit.get(r.ssrc);l?l.add(r.retransmittedBytesSent):((d=new u_(10)).add(r.retransmittedBytesSent),this.mediaBytesRetransmit.set(r.ssrc,d))}if(r.totalEncodedBytesTarget){var d,h=this.mediaBytesTargetEncode.get(r.ssrc);h?h.add(r.totalEncodedBytesTarget):((d=new u_(10)).add(r.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(r.ssrc,d))}if(i.ssrc=r.ssrc,i.bytes=r.bytesSent,i.packets=r.packetsSent,i.firsCount=r.firCount,i.nacksCount=r.nackCount,i.plisCount=r.pliCount,i.frameCount=r.framesEncoded,i.adaptionChangeReason=r.qualityLimitationReason,r.totalEncodeTime&&r.framesEncoded){var p=this.lastEncoderMs.get(r.ssrc);if(!p||p.lastFrameCount>r.framesEncoded)i.avgEncodeMs=1e3*r.totalEncodeTime/r.framesEncoded;else{var m=r.framesEncoded-p.lastFrameCount,f=r.totalEncodeTime-p.lastEncoderTime;i.avgEncodeMs=1e3*f/m}this.lastEncoderMs.set(r.ssrc,{lastFrameCount:r.framesEncoded,lastEncoderTime:r.totalEncodeTime,lts:Date.now()})}if(r.codecId&&(i.codec=this.getCodecFromCodecStats(r.codecId)),r.mediaSourceId&&this.processVideoMediaSource(r.mediaSourceId,i),r.trackId&&this.processVideoTrackSenderStats(r.trackId,i),r.remoteId)this.processRemoteInboundStats(r.remoteId,i);else{var _=this.findRemoteStatsId(r.ssrc,Ha.REMOTE_INBOUND);_&&this.processRemoteInboundStats(_,i)}},t.prototype.processAudioOutboundStats=function(r){var i=this._stats.audioSend.find(function(l){return l.ssrc===r.ssrc});if(i||(i=Uo(Qw),this._stats.audioSend.push(i)),i.ssrc=r.ssrc,i.packets=r.packetsSent,i.bytes=r.bytesSent,r.mediaSourceId&&this.processAudioMediaSource(r.mediaSourceId,i),r.codecId&&(i.codec=this.getCodecFromCodecStats(r.codecId)),r.trackId&&this.processAudioTrackSenderStats(r.trackId,i),r.remoteId)this.processRemoteInboundStats(r.remoteId,i);else{var s=this.findRemoteStatsId(r.ssrc,Ha.REMOTE_INBOUND);s&&this.processRemoteInboundStats(s,i)}},t.prototype.findRemoteStatsId=function(r,i){var s=Array.from(this.report.values()).find(function(l){return l.type===i&&l.ssrc===r});return s?s.id:null},t.prototype.processVideoMediaSource=function(r,i){var s=this.report.get(r);s&&s.width&&s.height&&s.framesPerSecond&&(i.inputFrame={width:s.width,height:s.height,frameRate:s.framesPerSecond})},t.prototype.processAudioMediaSource=function(r,i){var s=this.report.get(r);s&&(i.inputLevel=s.audioLevel)},t.prototype.processVideoTrackSenderStats=function(r,i){var s=this.report.get(r);if(s){var l=0,d=Date.now(),h=this.lastVideoFramesSent.get(i.ssrc);h&&d-h.lts>=800?(l=Math.round((s.framesSent-h.count)/((d-h.lts)/1e3)),this.lastVideoFramesSent.set(i.ssrc,{count:s.framesSent,lts:d,rate:l})):h?l=h.rate:this.lastVideoFramesSent.set(i.ssrc,{count:s.framesSent,lts:d,rate:0}),i.sentFrame={width:s.frameWidth,height:s.frameHeight,frameRate:l}}},t.prototype.processVideoTrackReceiverStats=function(r,i){var s=this.report.get(r);if(s){var l=this.lastVideoFramesRecv.get(i.ssrc),d=Date.now();i.framesReceivedCount=s.framesReceived;var h=0;if(l&&d-l.lts>=800?(h=Math.round((s.framesReceived-l.count)/((d-l.lts)/1e3)),this.lastVideoFramesRecv.set(i.ssrc,{count:s.framesReceived,lts:d,rate:h})):l?h=l.rate:this.lastVideoFramesRecv.set(i.ssrc,{count:s.framesReceived,lts:d,rate:0}),i.receivedFrame={width:s.frameWidth||0,height:s.frameHeight||0,frameRate:h||0},i.decodedFrame={width:s.frameWidth||0,height:s.frameHeight||0,frameRate:i.decodeFrameRate||0},i.outputFrame={width:s.frameWidth||0,height:s.frameHeight||0,frameRate:i.decodeFrameRate||0},s.jitterBufferDelay&&s.jitterBufferEmittedCount){var p=this.lastVideoJBDelay.get(i.ssrc);this.lastVideoJBDelay.set(i.ssrc,{jitterBufferDelay:s.jitterBufferDelay,jitterBufferEmittedCount:s.jitterBufferEmittedCount}),p||(p={jitterBufferDelay:0,jitterBufferEmittedCount:0});var m=1e3*(s.jitterBufferDelay-p.jitterBufferDelay)/(s.jitterBufferEmittedCount-p.jitterBufferEmittedCount);i.jitterBufferMs=m,i.currentDelayMs=Math.round(m)}}},t.prototype.processAudioTrackSenderStats=function(r,i){var s=this.report.get(r);s&&(i.aecReturnLoss=s.echoReturnLoss||0,i.aecReturnLossEnhancement=s.echoReturnLossEnhancement||0)},t.prototype.processAudioTrackReceiverStats=function(r,i){var s=this.report.get(r);if(s){if(s.removedSamplesForAcceleration&&s.totalSamplesReceived&&(i.accelerateRate=s.removedSamplesForAcceleration/s.totalSamplesReceived),s.jitterBufferDelay&&s.jitterBufferEmittedCount){var l=this.lastAudioJBDelay.get(i.ssrc);this.lastAudioJBDelay.set(i.ssrc,{jitterBufferDelay:s.jitterBufferDelay,jitterBufferEmittedCount:s.jitterBufferEmittedCount}),l||(l={jitterBufferDelay:0,jitterBufferEmittedCount:0});var d=1e3*(s.jitterBufferDelay-l.jitterBufferDelay)/(s.jitterBufferEmittedCount-l.jitterBufferEmittedCount);i.jitterBufferMs=Math.round(d)}i.outputLevel=s.audioLevel;var h=1920;s.totalSamplesDuration&&s.totalSamplesReceived&&(h=s.totalSamplesReceived/s.totalSamplesDuration/50,i.receivedFrames=Math.round(s.totalSamplesReceived/h)),s.concealedSamples&&(i.droppedFrames=Math.round(s.concealedSamples/h))}},t.prototype.processRemoteInboundStats=function(r,i){var s=this.report.get(r);s&&(i.packetsLost=s.packetsLost,s.roundTripTime&&(i.rttMs=1e3*s.roundTripTime))},t.prototype.getCodecFromCodecStats=function(r){var i=this.report.get(r);if(!i)return"";var s=i.mimeType.match(/\/(.*)$/);return s&&s[1]?s[1]:""},t.prototype.updateSendBitrate=function(){var r=0,i=null,s=null;this.mediaBytesSent.forEach(function(d){r+=d.diffMean()}),this.mediaBytesRetransmit.forEach(function(d){i=i===null?d.diffMean():i+d.diffMean()}),this.mediaBytesTargetEncode.forEach(function(d){s=s===null?d.diffMean():s+d.diffMean()});var l=i!==null?r-i:r;this._stats.bitrate={actualEncoded:8*l/(this.options.updateInterval/1e3),transmit:8*r/(this.options.updateInterval/1e3)},i!==null&&(this._stats.bitrate.retransmit=8*i/(this.options.updateInterval/1e3)),s!==null&&(this._stats.bitrate.targetEncoded=8*s/(this.options.updateInterval/1e3))},t}(g_),k7=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return h_(t,e),t.prototype.updateStats=function(){return Promise.resolve()},t}(g_);function jw(e,t,r,i){t===void 0&&(t=250),r===void 0&&(r=8),i===void 0&&(i=500);var s,l=(s=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i))&&s[0]?Number(s[0].split("/")[1]):null;return l?l<76?new O7(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:i}):new Gw(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:i}):function(d){return!!window.RTCStatsReport&&d.getStats()instanceof Promise}(e)?new Gw(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:i}):new k7(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:i})}function Hw(e,t){var r=ae(e);if(Xt){var i=Xt(e);t&&(i=kt(i).call(i,function(s){return jt(e,s).enumerable})),r.push.apply(r,i)}return r}function Kw(e){for(var t=1;t<arguments.length;t++){var r,i,s=arguments[t]!=null?arguments[t]:{};t%2?V(r=Hw(Object(s),!0)).call(r,function(l){mr(e,l,s[l])}):Zt?ur(e,Zt(s)):V(i=Hw(Object(s))).call(i,function(l){ie(e,l,jt(s,l))})}return e}var Wi=function(e,t,r,i){var s,l=arguments.length,d=l<3?t:i===null?i=jt(t,r):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(e,t,r,i);else for(var h=e.length-1;h>=0;h--)(s=e[h])&&(d=(l<3?s(d):l>3?s(t,r,d):s(t,r))||d);return l>3&&d&&ie(t,r,d),d},Be=function(e,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(e,t)};class Un extends MR{constructor(t,r){super(t,r),this.useRTX=!1,this.localCandidateCount=0,this.allCandidatesReceived=!1,this.mutex=new wn("P2PConnection-mutex"),this.store=r,this.peerConnection=new RTCPeerConnection(Un.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=jw(this.peerConnection,void 0,void 0,Gr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}async establish(){try{const t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=wA(t.sdp),i=Ow(t.sdp,!this.useRTX,!1,["opus"]);return this.localCapabilities=i,this.initialOffer=t,Kw(Kw({},r),{},{rtpCapabilities:i,offerSDP:t.sdp})}catch(t){throw new P(D.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(t,r,i,s,l,d,h,p){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new N7({remoteIceParameters:t,remoteDtlsParameters:r,candidates:i,remoteRTPCapabilities:s,remoteSetup:l,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec,cname:d,ip:h,port:p});const m=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(m){throw new P(D.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(m.toString()))}}send(t,r){var i=this;return Ou(function*(){const s=yield hn(i.mutex.lock());try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const l=pt(t).call(t,v=>i.peerConnection.addTrack(v._mediaStreamTrack)),d=yield hn(i.peerConnection.createOffer()),h=mo.exports.parse(d.sdp),p=pt(t).call(t,v=>{var T;const R=v._mediaStreamTrack,w=ft(T=h.mediaDescriptions).call(T,O=>O.attributes.mid===R.kind);if(!w)throw new Error("Cannot extract ssrc from mediaDescription.");return function(O,B,K){var j;const nt=kt(j=O.attributes.ssrcs).call(j,vt=>vt.attributes.label===B),It=O.attributes.ssrcGroups;if(nt.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(It&&nt.length>1){const vt=ft(It).call(It,Rt=>{var X;return xt(X=Rt.ssrcIds).call(X,nt[0].ssrcId)!==-1});return vt?[{ssrcId:vt.ssrcIds[0],rtx:K?vt.ssrcIds[1]:void 0}]:[{ssrcId:nt[0].ssrcId}]}return[{ssrcId:nt[0].ssrcId}]}(w,R.id,i.useRTX)});let m;try{m=yield p}catch(v){throw V(l).call(l,T=>{Ri()&&T.replaceTrack(null),i.peerConnection.removeTrack(T)}),v}const f=i.mungSendOfferSDP(d.sdp,t);i.remoteSDP.receive(t,r,m);const _=i.remoteSDP.toString();return yield hn(i.peerConnection.setLocalDescription({type:"offer",sdp:f})),yield hn(i.applySendEncodings(l,t)),yield hn(i.peerConnection.setRemoteDescription({type:"answer",sdp:_})),pt(t).call(t,(v,T)=>{const R=v._mediaStreamTrack.id;return{localSSRC:p[T],id:R}})}catch(l){throw new P(D.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(l.toString()))}finally{s()}})()}async stopSending(t){try{var r;if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=kt(r=this.peerConnection.getSenders()).call(r,d=>{var h;return xt(t).call(t,((h=d.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");pt(i).call(i,d=>{Ri()&&d.replaceTrack(null),this.peerConnection.removeTrack(d)});const s=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(t);const l=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(i){throw new P(D.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}}async receive(t,r,i,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{id:l,mslabel:d}=this.remoteSDP.send(t,r,s),h=new ct((f,_)=>{const v=ar(()=>{_(new Error("Cannot receive track, id: ".concat(l)))},1e4),T=R=>{const w=Se();if(w.name==="Safari"&&Number(w.version)===11&&R.track.id!==l&&R.streams[0].id===d){var O;const B=R.streams[0].getTracks()[0];return(O=this.remoteSDP)===null||O===void 0||O.updateTrackLabel(t,l,R.track.id),this.peerConnection.removeEventListener("track",T),clearTimeout(v),void f(B)}if(R.track.id===l)return this.peerConnection.removeEventListener("track",T),clearTimeout(v),void f(R.track)};this.peerConnection.addEventListener("track",T)}),p=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:p});const m=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(m),{track:await h,id:l}}catch(l){throw new P(D.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const i=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(i)}catch(r){throw new P(D.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{var r;if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=kt(r=this.peerConnection.getSenders()).call(r,s=>{var l;return xt(t).call(t,((l=s.track)===null||l===void 0?void 0:l.id)||"")!==-1});if(i.length!==t.length)throw new Error("sender' length doesn't match mids' length.");pt(i).call(i,s=>{if(Ri()&&s.track)s.track.enabled=!1;else{var l;const d=s.getParameters();V(l=d.encodings).call(l,h=>h.active=!1),s.setParameters(d)}})}catch(i){throw new P(D.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(t){try{var r;if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=kt(r=this.peerConnection.getSenders()).call(r,d=>{var h;return xt(t).call(t,((h=d.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(i.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");pt(i).call(i,async d=>{if(Ri()&&d.track)d.track.enabled=!0;else{var h;const p=d.getParameters();V(h=p.encodings).call(h,m=>m.active=!0),await d.setParameters(p)}});const s=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(s);const l=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(i){throw new P(D.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}async reEstablish(){const t=await this.peerConnection.createOffer({iceRestart:!0});if(!t.sdp)throw new Error("Cannot get SDP from restart offer.");return{iceParameters:wA(t.sdp).iceParameters,restartICE:async(r,i,s,l)=>this.restartICE(t,r,i,s,l),restartOfferSDP:t.sdp}}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),s=this.mungSendOfferSDP(i.sdp,[r]);this.remoteSDP.updateRecvMedia(r._mediaStreamTrack.kind,r);const l=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(i){throw new P(D.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,r){var i;const s=kt(i=this.peerConnection.getSenders()).call(i,l=>{var d;return((d=l.track)===null||d===void 0?void 0:d.id)===t});s.length===1&&await this.applySendEncodings(s,[r])}setStatsRemoteVideoIsReady(t,r){this.statsFilter.setVideoIsReady2(t,r)}async replaceTrack(t,r){var i;const s=ft(i=this.peerConnection.getSenders()).call(i,l=>{var d;return((d=l.track)===null||d===void 0?void 0:d.id)===r});s&&await s.replaceTrack(t._mediaStreamTrack)}async restartICE(t,r,i,s,l){try{if(!this.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");this.remoteSDP.restartICE(r,i,s,l);const d=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(t),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(d){throw new P(D.EXCHANGE_SDP_FAILED,"P2PConnection.restartICE failed; ".concat(d.toString()))}}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,S.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},ar(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,S.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},it("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const r={iceServers:[],sdpSemantics:"plan-b"};var i,s;return t.iceServers?r.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Np(t.turnServer.servers)?r.iceServers=t.turnServer.servers:(r.iceServers&&r.iceServers.push(...Un.turnServerConfigToIceServers(t.turnServer.servers)),r.iceServers&&t.turnServer.serversFromGateway&&r.iceServers.push(...Un.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),V(i=k(s=t.turnServer.servers).call(s,t.turnServer.serversFromGateway||[])).call(i,l=>{l.forceturn&&(r.iceTransportPolicy="relay")}))),r}static turnServerConfigToIceServers(t){const r=[];return V(t).call(t,i=>{if(i.security){var s;i.tcpport&&r.push({username:i.username,credential:i.password,credentialType:"password",urls:k(s="turns:".concat(Ny(i.turnServerURL),":")).call(s,i.tcpport,"?transport=tcp")})}else{var l,d;i.udpport&&r.push({username:i.username,credential:i.password,credentialType:"password",urls:k(l="turn:".concat(i.turnServerURL,":")).call(l,i.udpport,"?transport=udp")}),i.tcpport&&r.push({username:i.username,credential:i.password,credentialType:"password",urls:k(d="turn:".concat(i.turnServerURL,":")).call(d,i.tcpport,"?transport=tcp")})}}),r}async applySendEncodings(t,r){try{if(!Dr().supportSetRtpSenderParameters||t.length!==r.length)return;for(let l=0;l<t.length;l++){var i;const d=t[l],h=r[l];if(!h)continue;const p={},m={};if(h instanceof cr)switch(h._optimizationMode){case"motion":p.degradationPreference="maintain-framerate";break;case"detail":p.degradationPreference="maintain-resolution";break;default:p.degradationPreference="balanced"}if(it("DSCP_TYPE")&&El()){var s;const v=it("DSCP_TYPE");qt(s=["very-low","low","medium","high"]).call(s,v)&&(m.networkPriority=v)}const f=d.getParameters(),_=(i=f.encodings)===null||i===void 0?void 0:i[0];_&&hr(_,m),hr(f,p),await d.setParameters(f)}}catch{S.debug("Apply RTPSendEncodings failed.")}}mungSendOfferSDP(t,r){const i=mo.exports.parse(t);return V(r).call(r,(s,l)=>{var d;const h=s._mediaStreamTrack,p=ft(d=i.mediaDescriptions).call(d,m=>m.attributes.mid===h.kind);p&&bA(p,s)}),mo.exports.print(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,r,i)=>{var s;(s=this.onFirstVideoDecoded)===null||s===void 0||s.call(this,t,r,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0}}function Yi(e,t,r){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const s=this.mutex,l=await s.lock("Locking from P2PConnection.".concat(t));try{for(var d=arguments.length,h=new Array(d),p=0;p<d;p++)h[p]=arguments[p];return await i.apply(this,h)}finally{l()}},r}Wi([Yi,Be("design:type",Function),Be("design:paramtypes",[Object,Object,Array,Object,String,String,String,String]),Be("design:returntype",ct)],Un.prototype,"connect",null),Wi([Yi,Be("design:type",Function),Be("design:paramtypes",[Array]),Be("design:returntype",ct)],Un.prototype,"stopSending",null),Wi([Yi,Be("design:type",Function),Be("design:paramtypes",[String,Array,String,Object]),Be("design:returntype",ct)],Un.prototype,"receive",null),Wi([Yi,Be("design:type",Function),Be("design:paramtypes",[Array]),Be("design:returntype",ct)],Un.prototype,"stopReceiving",null),Wi([Yi,Be("design:type",Function),Be("design:paramtypes",[String]),Be("design:returntype",ct)],Un.prototype,"muteRemote",null),Wi([Yi,Be("design:type",Function),Be("design:paramtypes",[String]),Be("design:returntype",ct)],Un.prototype,"unmuteRemote",null),Wi([Yi,Be("design:type",Function),Be("design:paramtypes",[Array]),Be("design:returntype",ct)],Un.prototype,"muteLocal",null),Wi([Yi,Be("design:type",Function),Be("design:paramtypes",[Array]),Be("design:returntype",ct)],Un.prototype,"unmuteLocal",null),Wi([Yi,Be("design:type",Function),Be("design:paramtypes",[]),Be("design:returntype",ct)],Un.prototype,"reEstablish",null),Wi([Yi,Be("design:type",Function),Be("design:paramtypes",[]),Be("design:returntype",void 0)],Un.prototype,"close",null),Wi([Yi,Be("design:type",Function),Be("design:paramtypes",[String,ra]),Be("design:returntype",ct)],Un.prototype,"updateEncoderConfig",null),Wi([Yi,Be("design:type",Function),Be("design:paramtypes",[String,ra]),Be("design:returntype",ct)],Un.prototype,"updateSendParameters",null),Wi([Yi,Be("design:type",Function),Be("design:paramtypes",[ra,String]),Be("design:returntype",ct)],Un.prototype,"replaceTrack",null),Wi([Yi,Be("design:type",Function),Be("design:paramtypes",[Object,Object,Array,String,String]),Be("design:returntype",ct)],Un.prototype,"restartICE",null);const Ww=4e4;class D7{constructor(t){t=In(t);const{remoteIceParameters:r,remoteDtlsParameters:i,candidates:s,remoteRTPCapabilities:l,remoteSetup:d,localCapabilities:h,cname:p,ip:m,port:f}=t,_=mo.exports.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`);this._rtpCapabilities=l,this._candidates=s,this._iceParameters=r,this._dtlsParameters=i,this._localCapabilities=h,this.setup=d,this.cname=p,this.ip=m,this.port=f,this.addressType=xt(m).call(m,":")===-1?"IP4":"IP6";for(const w of _.mediaDescriptions){var v,T,R;if(w.media.port=this.port,V(v=w.connections).call(v,O=>{O.address=this.ip,O.addrtype=this.addressType}),w.attributes.rtcp?(w.attributes.rtcp.address=this.ip,w.attributes.rtcp.port=this.port,w.attributes.rtcp.addressType=this.addressType):w.attributes.rtcp={port:f,address:m,netType:"IN",addressType:this.addressType},w.attributes.iceUfrag=r.iceUfrag,w.attributes.icePwd=r.icePwd,w.attributes.fingerprints=i.fingerprints,w.attributes.candidates=s,w.attributes.setup=d,w.media.mediaType==="video"&&(w.media.fmts=pt(T=l.videoCodecs).call(T,O=>O.payloadType.toString(10)),w.attributes.payloads=l.videoCodecs,w.attributes.extmaps=l.videoExtensions,it("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:O,ssrcGroups:B}=ql([{ssrcId:Ww,rtx:it("USE_RTX")?40001:void 0}],this.cname);w.attributes.ssrcs=O,w.attributes.ssrcGroups=B}if(w.media.mediaType==="audio"&&(w.media.fmts=pt(R=l.audioCodecs).call(R,O=>O.payloadType.toString(10)),w.attributes.payloads=l.audioCodecs,w.attributes.extmaps=l.audioExtensions,it("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:O,ssrcGroups:B}=ql([{ssrcId:2e4}],this.cname);w.attributes.ssrcs=O,w.attributes.ssrcGroups=B}}this.sessionDesc=_,this.currentMidIndex=_.mediaDescriptions.length-1}get localCapabilities(){return In(this._localCapabilities)}get rtpCapabilities(){return In(this._rtpCapabilities)}get candidates(){return In(this._candidates)}get iceParameters(){return In(this._iceParameters)}get dtlsParameters(){return In(this._dtlsParameters)}preloadRemoteMedia(){const t=it("PRELOAD_MEDIA_COUNT"),r=this.rtpCapabilities,i=this.candidates,s=this.dtlsParameters,l=this.iceParameters;for(let p=1;p<t;p++){var d,h;const m=2*p+2e4,f=2*p+Ww,{ssrcs:_,ssrcGroups:v}=ql([{ssrcId:m}],this.cname),{ssrcs:T,ssrcGroups:R}=ql([{ssrcId:f,rtx:it("USE_RTX")?f+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:this.port,protos:["UDP","TLS","RTP","SAVPF"],fmts:pt(d=r.videoCodecs).call(d,w=>w.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:this.addressType,address:this.ip}],bandwidths:[],attributes:{iceUfrag:l.iceUfrag,icePwd:l.icePwd,unrecognized:[],candidates:i,extmaps:r.videoExtensions,fingerprints:s.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:T,ssrcGroups:R,rtcpFeedbackWildcards:[],payloads:r.videoCodecs,rtcp:{port:this.port,netType:"IN",addressType:this.addressType,address:this.ip},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*p)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:this.port,protos:["UDP","TLS","RTP","SAVPF"],fmts:pt(h=r.audioCodecs).call(h,w=>w.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:this.addressType,address:this.ip}],bandwidths:[],attributes:{iceUfrag:l.iceUfrag,icePwd:l.icePwd,unrecognized:[],candidates:i,extmaps:r.audioExtensions,fingerprints:s.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:_,ssrcGroups:v,rtcpFeedbackWildcards:[],payloads:r.audioCodecs,rtcp:{port:this.port,netType:"IN",addressType:this.addressType,address:this.ip},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*p+1)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return mo.exports.print(this.sessionDesc)}send(t,r,i,s){const{ssrcs:l,ssrcGroups:d}=ql(r,this.cname,i),h=this.findPreloadMediaDesc(l);if(h){if(s&&(s.tcc||s.remb)){var p;const m=xt(p=this.sessionDesc.mediaDescriptions).call(p,h);return this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(h,s),{mid:h.attributes.mid,needExchangeSDP:!0}}return{mid:h.attributes.mid,needExchangeSDP:!1}}{const m=this.findAvailableMediaIndex(t);if(Ri()){if(m!==-1&&m!==1){const f=In(this.sessionDesc.mediaDescriptions[m]);return f.attributes.direction="sendonly",f.attributes.ssrcs=l,f.attributes.ssrcGroups=d,this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(f,s),{mid:f.attributes.mid,needExchangeSDP:!0}}{const f=this.createOrRecycleSendMedia(t,l,d,"sendonly",s);return this.updateBundleMids(),{mid:f.attributes.mid,needExchangeSDP:!0}}}if(m!==-1){const f=In(this.sessionDesc.mediaDescriptions[m]);return f.attributes.direction="sendonly",f.attributes.ssrcs=l,f.attributes.ssrcGroups=d,this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(f,s),{mid:f.attributes.mid,needExchangeSDP:!0}}{const f=this.createOrRecycleSendMedia(t,l,d,"sendonly",s);return this.updateBundleMids(),{mid:f.attributes.mid,needExchangeSDP:!0}}}}stopSending(t){var r;const i=kt(r=this.sessionDesc.mediaDescriptions).call(r,s=>s.attributes.mid&&xt(t).call(t,s.attributes.mid)!==-1);if(i.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");V(i).call(i,s=>{s.attributes.mid==="0"||Gr()||Ri()?s.attributes.ssrcs=[]:(s.attributes.ssrcs=[],s.attributes.direction="inactive",s.media.port="0")}),this.updateBundleMids()}mute(t){var r;const i=ft(r=this.sessionDesc.mediaDescriptions).call(r,s=>s.attributes.mid===t);if(!i)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));i.attributes.direction="inactive"}unmute(t){var r;const i=ft(r=this.sessionDesc.mediaDescriptions).call(r,s=>s.attributes.mid===t);if(!i)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));i.attributes.direction="sendonly"}muteRemote(t){var r;const i=kt(r=this.sessionDesc.mediaDescriptions).call(r,s=>qt(t).call(t,s.attributes.mid||""));if(i.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");V(i).call(i,s=>{s.attributes.direction="inactive"})}unmuteRemote(t){var r;const i=kt(r=this.sessionDesc.mediaDescriptions).call(r,s=>qt(t).call(t,s.attributes.mid||""));if(i.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");V(i).call(i,s=>{s.attributes.direction="recvonly"})}receive(t,r,i){V(t).call(t,(s,l)=>{this.createOrRecycleRecvMedia(s,[],"recvonly",r,i[l])}),this.updateBundleMids()}stopReceiving(t){var r;const i=kt(r=this.sessionDesc.mediaDescriptions).call(r,s=>xt(t).call(t,s.attributes.mid)!==-1);if(i.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");V(i).call(i,s=>{s.media.port="0",s.attributes.direction="inactive"}),this.updateBundleMids()}restartICE(t,r,i,s){var l,d;t=In(t),r=In(r),this._iceParameters=t,this._candidates=r,this.ip=i,this.port=s,this.addressType=xt(l=this.ip).call(l,":")===-1?"IP4":"IP6",V(d=this.sessionDesc.mediaDescriptions).call(d,h=>{var p;h.media.port!=="0"&&(h.media.port=this.port),V(p=h.connections).call(p,m=>{m.address=this.ip,m.addrtype=this.addressType}),h.attributes.rtcp?(h.attributes.rtcp.address=this.ip,h.attributes.rtcp.port=this.port,h.attributes.rtcp.addressType=this.addressType):h.attributes.rtcp={port:s,address:i,netType:"IN",addressType:this.addressType},h.attributes.iceUfrag=t.iceUfrag,h.attributes.icePwd=t.icePwd,h.attributes.candidates=this.candidates})}predictReceivingMids(t){const r=[];for(let i=0;i<t;i++)r.push((this.currentMidIndex+i+1).toString(10));return r}findAvailableMediaIndex(t){var r;return Yn(r=this.sessionDesc.mediaDescriptions).call(r,i=>i.media.mediaType===t&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0)}createOrRecycleRecvMedia(t,r,i,s,l){const d=t._mediaStreamTrack.kind;let h;if(d===er.VIDEO){var p,m,f,_,v;it("H264_PROFILE_LEVEL_ID")&&s==="h264"&&(h=kt(m=this.rtpCapabilities.videoCodecs).call(m,K=>{var j,nt,It;return qt(j=((nt=K.rtpMap)===null||nt===void 0?void 0:nt.encodingName.toLowerCase())||"").call(j,s)&&(K==null||(It=K.fmtp)===null||It===void 0?void 0:It.parameters["profile-level-id"])===it("H264_PROFILE_LEVEL_ID")})),(!h||((p=h)===null||p===void 0?void 0:p.length)===0)&&(h=kt(f=this.rtpCapabilities.videoCodecs).call(f,K=>{var j,nt;return qt(j=((nt=K.rtpMap)===null||nt===void 0?void 0:nt.encodingName.toLowerCase())||"").call(j,s)})),h.length===0&&(S.warning(k(_="codec ".concat(s," not included in rtpCapabilities, fallback to default payloads: ")).call(_,(v=this.rtpCapabilities.videoCodecs[0].rtpMap)===null||v===void 0?void 0:v.encodingName)),h=this.rtpCapabilities.videoCodecs)}else h=this.rtpCapabilities.audioCodecs;const T=d===er.VIDEO?this.rtpCapabilities.videoExtensions:this.rtpCapabilities.audioExtensions;this.currentMidIndex+=1;const R="".concat(this.currentMidIndex);let w={media:{mediaType:d,port:this.port,protos:["UDP","TLS","RTP","SAVPF"],fmts:pt(h).call(h,K=>K.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:this.addressType,address:this.ip}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:T,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:h,rtcp:{port:this.port,netType:"IN",addressType:this.addressType,address:this.ip},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(R)}};w=this.mungRecvMediaDsec(w,t,l);const O=this.findFirstClosedMedia(d);if(O){var B;const K=xt(B=this.sessionDesc.mediaDescriptions).call(B,O);this.sessionDesc.mediaDescriptions[K]=w}else this.sessionDesc.mediaDescriptions.push(w);return w}createOrRecycleSendMedia(t,r,i,s,l){const d=t===er.VIDEO?this.rtpCapabilities.videoCodecs:this.rtpCapabilities.audioCodecs,h=t===er.VIDEO?this.rtpCapabilities.videoExtensions:this.rtpCapabilities.audioExtensions;this.currentMidIndex+=1;const p="".concat(this.currentMidIndex);let m={media:{mediaType:t,port:this.port,protos:["UDP","TLS","RTP","SAVPF"],fmts:pt(d).call(d,v=>v.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:this.addressType,address:this.ip}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:h,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:d,rtcp:{port:this.port,netType:"IN",addressType:this.addressType,address:this.ip},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(p)}};m=this.mungSendMediaDesc(m,l);const f=this.findFirstClosedMedia(t);if(f){var _;const v=xt(_=this.sessionDesc.mediaDescriptions).call(_,f);this.sessionDesc.mediaDescriptions[v]=m}else this.sessionDesc.mediaDescriptions.push(m);return m}updateBundleMids(){var t,r;this.sessionDesc.attributes.groups[0].identificationTag=pt(t=kt(r=this.sessionDesc.mediaDescriptions).call(r,i=>i.media.port!=="0")).call(t,i=>i.attributes.mid)}mungRecvMediaDsec(t,r,i){const s=In(t);return Dw(s),bA(s,r),Lw(s,r),function(l){var d;if(l.media.mediaType!=="video")return;const h=Se();if(h.name!==ye.SAFARI&&h.os!==mn.IOS)return;const p=Yn(d=l.attributes.extmaps).call(d,f=>/video-orientation/g.test(f.extensionName));var m;p!==-1&&Ye(m=l.attributes.extmaps).call(m,p,1)}(s),Pw(s,i,this.localCapabilities),s}mungSendMediaDesc(t,r){const i=In(t);return Pw(i,r,this.localCapabilities),i}updateRecvMedia(t,r){var i;const s=Yn(i=this.sessionDesc.mediaDescriptions).call(i,l=>l.attributes.mid===t);if(s!==-1){const l=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],r);this.sessionDesc.mediaDescriptions[s]=l}}bumpMid(t){this.currentMidIndex+=t}findFirstClosedMedia(t){var r;return ft(r=this.sessionDesc.mediaDescriptions).call(r,i=>Gr()?i.media.port==="0"&&i.media.mediaType===t:i.media.port==="0")}findPreloadMediaDesc(t){var r;return ft(r=this.sessionDesc.mediaDescriptions).call(r,i=>{var s,l;return((s=i.attributes)===null||s===void 0||(l=s.ssrcs[0])===null||l===void 0?void 0:l.ssrcId)===t[0].ssrcId})}}function Yw(e,t){var r=ae(e);if(Xt){var i=Xt(e);t&&(i=kt(i).call(i,function(s){return jt(e,s).enumerable})),r.push.apply(r,i)}return r}function qw(e){for(var t=1;t<arguments.length;t++){var r,i,s=arguments[t]!=null?arguments[t]:{};t%2?V(r=Yw(Object(s),!0)).call(r,function(l){mr(e,l,s[l])}):Zt?ur(e,Zt(s)):V(i=Yw(Object(s))).call(i,function(l){ie(e,l,jt(s,l))})}return e}var qi=function(e,t,r,i){var s,l=arguments.length,d=l<3?t:i===null?i=jt(t,r):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(e,t,r,i);else for(var h=e.length-1;h>=0;h--)(s=e[h])&&(d=(l<3?s(d):l>3?s(t,r,d):s(t,r))||d);return l>3&&d&&ie(t,r,d),d},Me=function(e,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(e,t)};class xn extends MR{constructor(t,r){super(t,r),this.useRTX=it("USE_RTX"),this.localCandidateCount=0,this.allCandidatesReceived=!1,this.mutex=new wn("P2PConnection-mutex"),this.store=r,this.peerConnection=new RTCPeerConnection(xn.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=jw(this.peerConnection,void 0,void 0,Gr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const t=await this.peerConnection.createOffer();if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=wA(t.sdp),i=await async function(s,l,d,h){const p=new RTCPeerConnection;p.addTransceiver("video",{direction:"sendrecv"}),p.addTransceiver("audio",{direction:"sendrecv"});const m=await p.createOffer();if(!m.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const f=Ow(m.sdp,s,l,d,h);try{p.close()}catch{}return f}(!this.useRTX,!1,["opus"]);return this.localCapabilities=i,this.initialOffer=t,qw(qw({},r),{},{rtpCapabilities:i,offerSDP:t.sdp})}catch(t){throw new P(D.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(t,r,i,s,l,d,h,p){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new D7({remoteIceParameters:t,remoteDtlsParameters:r,candidates:i,remoteRTPCapabilities:s,remoteSetup:l,localCapabilities:this.localCapabilities,cname:d,ip:h,port:p});const m=this.remoteSDP.toString(),f=this.logSDPExchange(this.initialOffer.sdp||"","offer","local","connect");await this.peerConnection.setLocalDescription(this.initialOffer),f==null||f(m),await this.peerConnection.setRemoteDescription({type:"answer",sdp:m});const _=this.peerConnection.getTransceivers()[0];if(_!=null&&_.receiver&&this.tryBindTransportEvents(_.receiver),it("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia();const v=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:v});const T=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(T)}}catch(m){throw new P(D.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(m.toString()))}}send(t,r){var i=this;return Ou(function*(){const s=yield hn(i.mutex.lock());try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const l=[];V(t).call(t,R=>{const w=i.peerConnection.addTransceiver(R._mediaStreamTrack,{direction:"sendonly"});l.push(w)}),Gr()&&it("SIMULCAST")===!0&&(yield hn(i.applySimulcastForFirefox(l,t)));const d=yield hn(i.peerConnection.createOffer()),h=i.remoteSDP.predictReceivingMids(t.length),p=i.mungSendOfferSDP(d.sdp,t,h),m=mo.exports.parse(p),f=pt(h).call(h,R=>{var w;const O=ft(w=m.mediaDescriptions).call(w,B=>B.attributes.mid===R);if(!O)throw new Error("Cannot extract ssrc from mediaDescription.");return function(B,K){var j,nt;const It=[],vt=kt(j=B.attributes.ssrcGroups).call(j,H=>H.semantic==="FID"),Rt=ft(nt=B.attributes.ssrcGroups).call(nt,H=>H.semantic==="SIM"),X=B.attributes.ssrcs;var rt;if(Rt)V(rt=Rt.ssrcIds).call(rt,H=>{var W;const U=(W=ft(vt).call(vt,Ct=>Ct.ssrcIds[0]===H))===null||W===void 0?void 0:W.ssrcIds[1];It.push({ssrcId:H,rtx:K?U:void 0})});else if(vt.length>0){const H=vt[0].ssrcIds[0],W=vt[0].ssrcIds[1];It.push({ssrcId:H,rtx:K?W:void 0})}else{if(X.length===0)throw new Error("No ssrcs found on local media description.");It.push({ssrcId:X[0].ssrcId})}return It}(O,i.useRTX)});let _;try{_=yield f}catch(R){throw V(l).call(l,w=>{var O;return(O=w.stop)===null||O===void 0?void 0:O.call(w)}),i.remoteSDP.bumpMid(l.length),R}i.remoteSDP.receive(t,r,_);const v=i.remoteSDP.toString(),T=i.logSDPExchange(p,"offer","local","send");return yield hn(i.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield hn(i.applySimulcastEncodings(l,t)),yield hn(i.applySendEncodings(l,t)),T==null||T(v),yield hn(i.peerConnection.setRemoteDescription({type:"answer",sdp:v})),pt(l).call(l,(R,w)=>{const O=h[w];return{localSSRC:f[w],id:O,transceiver:R}})}catch(l){throw new P(D.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(l.toString()))}finally{s()}})()}async stopSending(t){try{var r;if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=kt(r=this.peerConnection.getTransceivers()).call(r,h=>xt(t).call(t,h.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");pt(i).call(i,h=>{var p;h.direction="inactive",(p=h.stop)===null||p===void 0||p.call(h)});const s=await this.peerConnection.createOffer(),l=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(t);const d=this.remoteSDP.toString();l==null||l(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(i){throw new P(D.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}}async receive(t,r,i,s){try{var l;if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:d,needExchangeSDP:h}=this.remoteSDP.send(t,r,i,s);if(h){const m=this.remoteSDP.toString(),f=this.logSDPExchange(m,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:m});const _=await this.peerConnection.createAnswer();f==null||f(_.sdp||""),await this.peerConnection.setLocalDescription(_),S.debug("[P2PConnection] receive ".concat(t," by exchanging SDP."))}else S.debug("[P2PConnection] receive ".concat(t," no need to exchange SDP."));const p=ft(l=this.peerConnection.getTransceivers()).call(l,m=>m.mid===d);if(!p)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:p.receiver.track,id:d}}catch(d){throw new P(D.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const r=this.remoteSDP.toString(),i=this.logSDPExchange(r,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(r){throw new P(D.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const r=this.remoteSDP.toString(),i=this.logSDPExchange(r,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(r){throw new P(D.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(r.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const r=this.remoteSDP.toString(),i=this.logSDPExchange(r,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(r){throw new P(D.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(r.toString()))}}async muteLocal(t){try{var r;if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=kt(r=this.peerConnection.getTransceivers()).call(r,h=>h.mid&&xt(t).call(t,h.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");pt(i).call(i,h=>{h.direction="inactive"});const s=await this.peerConnection.createOffer(),l=this.logSDPExchange(s.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.muteRemote(t);const d=this.remoteSDP.toString();l==null||l(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(i){throw new P(D.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(t){try{var r;if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=kt(r=this.peerConnection.getTransceivers()).call(r,h=>h.mid&&xt(t).call(t,h.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");pt(i).call(i,async(h,p)=>{h.direction="sendonly"});const s=await this.peerConnection.createOffer(),l=this.logSDPExchange(s.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.unmuteRemote(t);const d=this.remoteSDP.toString();l==null||l(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(i){throw new P(D.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}async reEstablish(){const t=await this.peerConnection.createOffer({iceRestart:!0});if(!t.sdp)throw new Error("Cannot get SDP from restart offer.");return{iceParameters:wA(t.sdp).iceParameters,restartICE:async(r,i,s,l)=>this.restartICE(t,r,i,s,l),restartOfferSDP:t.sdp}}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),s=this.mungSendOfferSDP(i.sdp,[r],[t]);this.remoteSDP.updateRecvMedia(t,r);const l=this.remoteSDP.toString(),d=this.logSDPExchange(s,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),d==null||d(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(i){throw new P(D.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,r){var i;const s=kt(i=this.peerConnection.getTransceivers()).call(i,l=>l.mid===t);s.length===1&&(this.isVP8Simulcast(r)?Gr()||await this.applySimulcastEncodings(s,[r]):await this.applySendEncodings(s,[r]))}setStatsRemoteVideoIsReady(t,r){this.statsFilter.setVideoIsReady2(t,r)}async replaceTrack(t,r){var i;const s=ft(i=this.peerConnection.getTransceivers()).call(i,l=>l.mid===r);s&&await s.sender.replaceTrack(t._mediaStreamTrack)}async restartICE(t,r,i,s,l){try{if(!this.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");this.remoteSDP.restartICE(r,i,s,l);const d=this.remoteSDP.toString(),h=this.logSDPExchange(t.sdp||"","offer","local","restartICE");await this.peerConnection.setLocalDescription(t),h==null||h(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(d){throw new P(D.EXCHANGE_SDP_FAILED,"P2PConnection.restartICE failed; ".concat(d.toString()))}}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,S.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},ar(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,S.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},it("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const r={iceServers:[]};var i,s;return t.iceServers?r.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Np(t.turnServer.servers)?r.iceServers=t.turnServer.servers:(r.iceServers&&r.iceServers.push(...xn.turnServerConfigToIceServers(t.turnServer.servers)),r.iceServers&&t.turnServer.serversFromGateway&&r.iceServers.push(...xn.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),V(i=k(s=t.turnServer.servers).call(s,t.turnServer.serversFromGateway||[])).call(i,l=>{l.forceturn&&(r.iceTransportPolicy="relay")}))),r}static turnServerConfigToIceServers(t){const r=[];return V(t).call(t,i=>{if(i.security){var s;i.tcpport&&r.push({username:i.username,credential:i.password,credentialType:"password",urls:k(s="turns:".concat(Ny(i.turnServerURL),":")).call(s,i.tcpport,"?transport=tcp")})}else{var l,d;i.udpport&&r.push({username:i.username,credential:i.password,credentialType:"password",urls:k(l="turn:".concat(i.turnServerURL,":")).call(l,i.udpport,"?transport=udp")}),i.tcpport&&r.push({username:i.username,credential:i.password,credentialType:"password",urls:k(d="turn:".concat(i.turnServerURL,":")).call(d,i.tcpport,"?transport=tcp")})}}),r}tryBindTransportEvents(t){t.transport&&(this.transportEventReceiver=t,t.transport.onstatechange=()=>{var r,i;(r=t.transport)!==null&&r!==void 0&&r.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,t.transport.state))},t.transport.onerror=r=>{var i;(i=this.onDTLSTransportError)===null||i===void 0||i.call(this,r.error)},t.transport.iceTransport&&(t.transport.iceTransport.onstatechange=()=>{var r,i,s;(r=t.transport)!==null&&r!==void 0&&r.iceTransport.state&&((i=this.onICETransportStateChange)===null||i===void 0||i.call(this,(s=t.transport)===null||s===void 0?void 0:s.iceTransport.state))}))}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async applySendEncodings(t,r){try{if(!Dr().supportSetRtpSenderParameters||t.length!==r.length)return;for(let _=0;_<t.length;_++){const v=t[_],T=r[_];if(T&&T instanceof cr){var i,s,l;if(this.isVP8Simulcast(T))continue;const R={},w={};switch(T._optimizationMode){case"motion":R.degradationPreference="maintain-framerate";break;case"detail":R.degradationPreference="maintain-resolution";break;default:R.degradationPreference="balanced"}var d,h,p,m;if((i=T._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&(w.maxBitrate=1e3*((d=T._encoderConfig)===null||d===void 0?void 0:d.bitrateMax)),qt(s=T._hints).call(s,Kn.LOW_STREAM)&&((h=T._encoderConfig)!==null&&h!==void 0&&h.frameRate&&(w.maxFramerate=Qa(T._encoderConfig.frameRate)),(p=T._encoderConfig)!==null&&p!==void 0&&p.scaleResolutionDownBy&&((m=T._encoderConfig)===null||m===void 0?void 0:m.scaleResolutionDownBy)>1&&(w.scaleResolutionDownBy=T._encoderConfig.scaleResolutionDownBy)),it("DSCP_TYPE")&&El()){var f;const K=it("DSCP_TYPE");qt(f=["very-low","low","medium","high"]).call(f,K)&&(w.networkPriority=K)}const O=v.sender.getParameters(),B=(l=O.encodings)===null||l===void 0?void 0:l[0];Gr()&&!B&&(R.encodings=[w]),B&&hr(B,w),hr(O,R),await v.sender.setParameters(O)}}}catch{S.debug("Apply RTPSendEncodings failed.")}}mungSendOfferSDP(t,r,i){const s=mo.exports.parse(t);return V(r).call(r,(l,d)=>{var h;const p=i[d],m=ft(h=s.mediaDescriptions).call(h,f=>f.attributes.mid===p);m&&(bA(m,l),function(f,_,v){var T;if(Gr()||f.media.mediaType!=="video"||!(_ instanceof cr)||v!=="vp9"&&v!=="vp8"||v==="vp8"&&!it("SIMULCAST")||_._scalabiltyMode===void 0||_._scalabiltyMode.numSpatialLayers<=1)return;const R=v==="vp8"?2:_._scalabiltyMode.numSpatialLayers,w=f.attributes.ssrcs[0],O=ft(T=f.attributes.ssrcGroups).call(T,K=>K.semantic==="FID"&&K.ssrcIds[0]===w.ssrcId),B={semantic:"SIM",ssrcIds:[w.ssrcId]};for(let K=1;K<R;K++)f.attributes.ssrcs.push({ssrcId:w.ssrcId+K,attributes:In(w.attributes)}),B.ssrcIds.push(w.ssrcId+K),O&&(f.attributes.ssrcs.push({ssrcId:O.ssrcIds[1]+K,attributes:In(w.attributes)}),f.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[w.ssrcId+K,O.ssrcIds[1]+K]}));f.attributes.ssrcGroups.unshift(B)}(m,l,this.store.codec))}),mo.exports.print(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,r,i)=>{var s;(s=this.onFirstVideoDecoded)===null||s===void 0||s.call(this,t,r,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0}async applySimulcastForFirefox(t,r){if(t.length===r.length)for(let p=0;p<t.length;p++){var i,s,l,d,h;const m=t[p],f=r[p];if(f instanceof cr&&!qt(i=f._hints).call(i,Kn.LOW_STREAM)&&(s=f._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((l=f._encoderConfig)===null||l===void 0?void 0:l.bitrateMax)>200&&(d=f._scalabiltyMode)!==null&&d!==void 0&&d.numSpatialLayers&&((h=f._scalabiltyMode)===null||h===void 0?void 0:h.numSpatialLayers)>1&&this.store.codec==="vp8"){const _={},v={high:1e3*(f._encoderConfig.bitrateMax-50),medium:5e4};_.encodings=[{rid:"m",active:!0,maxBitrate:v.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:v.high}];const T=m.sender.getParameters();await m.sender.setParameters(hr(T,_))}}}async applySimulcastEncodings(t,r){if(!Gr()&&t.length===r.length)for(let i=0;i<t.length;i++){const s=r[i];if(s instanceof cr&&this.isVP8Simulcast(s)){const l=t[i],d={},h={high:1e3*(s._encoderConfig.bitrateMax-50),medium:5e4};d.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:h.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:h.medium,scaleResolutionDownBy:4}];const p=l.sender.getParameters();await l.sender.setParameters(hr(p,d))}}}isVP8Simulcast(t){var r,i,s,l,d;return t instanceof cr&&it("SIMULCAST")&&this.store.codec==="vp8"&&!qt(r=t._hints).call(r,Kn.LOW_STREAM)&&((i=t._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)&&((s=t._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&((l=t._scalabiltyMode)===null||l===void 0?void 0:l.numSpatialLayers)&&((d=t._scalabiltyMode)===null||d===void 0?void 0:d.numSpatialLayers)>1}logSDPExchange(t,r,i,s){var l,d;if((it("UPLOAD_LOG")||it("SDP_LOGGING"))&&(S.upload(k(l=k(d="exchanging ".concat(i," ")).call(d,r," SDP during P2PConnection.")).call(l,s,`
`),t),r==="offer"))return h=>{this.logSDPExchange(h,"answer",i==="local"?"remote":"local",s)}}}function Ji(e,t,r){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const s=this.mutex,l=await s.lock("Locking from P2PConnection.".concat(t));try{for(var d=arguments.length,h=new Array(d),p=0;p<d;p++)h[p]=arguments[p];return await i.apply(this,h)}finally{l()}},r}function Jw(e,t){let r=document.createElement("video"),i=document.createElement("canvas");r.setAttribute("style","display:none"),i.setAttribute("style","display:none"),r.setAttribute("muted",""),r.muted=!0,r.setAttribute("autoplay",""),r.autoplay=!0,r.setAttribute("playsinline",""),i.width=Qa(t.width),i.height=Qa(t.height);const s=Qa(t.framerate||15);document.body.append(r),document.body.append(i);let l=e._mediaStreamTrack;r.srcObject=new MediaStream([l]),r.play();const d=i.getContext("2d");if(!d)throw new P(D.UNEXPECTED_ERROR,"can not get canvas context");const h=Dr(),p=i.captureStream(h.supportRequestFrame?0:s).getVideoTracks()[0],m=xp(()=>(()=>{if(r.paused&&r.play(),r.videoHeight>2&&r.videoWidth>2){const R=r.videoWidth,w=r.videoHeight/R,O=i.width*w;var _,v,T;Math.abs(O-i.height)>=2&&(S.debug("adjust low stream resolution",k(_=k(v=k(T="".concat(i.width,"x")).call(T,i.height," -> ")).call(v,i.width,"x")).call(_,O)),i.height=O)}d.drawImage(r,0,0,i.width,i.height),p.requestFrame&&p.requestFrame(),l!==e._mediaStreamTrack&&(l=e._mediaStreamTrack,r.srcObject=new MediaStream([l]))})(),s),f=p.stop;return p.stop=()=>{f.call(p),m(),r.remove(),i.width=0,i.remove(),i=null,r=null,S.debug("clean low stream renderer")},p}function zw(e,t){var r=ae(e);if(Xt){var i=Xt(e);t&&(i=kt(i).call(i,function(s){return jt(e,s).enumerable})),r.push.apply(r,i)}return r}function NA(e){for(var t=1;t<arguments.length;t++){var r,i,s=arguments[t]!=null?arguments[t]:{};t%2?V(r=zw(Object(s),!0)).call(r,function(l){mr(e,l,s[l])}):Zt?ur(e,Zt(s)):V(i=zw(Object(s))).call(i,function(l){ie(e,l,jt(s,l))})}return e}qi([Ji,Me("design:type",Function),Me("design:paramtypes",[Object,Object,Array,Object,String,String,String,String]),Me("design:returntype",ct)],xn.prototype,"connect",null),qi([Ji,Me("design:type",Function),Me("design:paramtypes",[Array]),Me("design:returntype",ct)],xn.prototype,"stopSending",null),qi([Ji,Me("design:type",Function),Me("design:paramtypes",[String,Array,String,Object]),Me("design:returntype",ct)],xn.prototype,"receive",null),qi([Ji,Me("design:type",Function),Me("design:paramtypes",[Array]),Me("design:returntype",ct)],xn.prototype,"stopReceiving",null),qi([Ji,Me("design:type",Function),Me("design:paramtypes",[String]),Me("design:returntype",ct)],xn.prototype,"muteRemote",null),qi([Ji,Me("design:type",Function),Me("design:paramtypes",[String]),Me("design:returntype",ct)],xn.prototype,"unmuteRemote",null),qi([Ji,Me("design:type",Function),Me("design:paramtypes",[Array]),Me("design:returntype",ct)],xn.prototype,"muteLocal",null),qi([Ji,Me("design:type",Function),Me("design:paramtypes",[Array]),Me("design:returntype",ct)],xn.prototype,"unmuteLocal",null),qi([Ji,Me("design:type",Function),Me("design:paramtypes",[]),Me("design:returntype",ct)],xn.prototype,"reEstablish",null),qi([Ji,Me("design:type",Function),Me("design:paramtypes",[]),Me("design:returntype",void 0)],xn.prototype,"close",null),qi([Ji,Me("design:type",Function),Me("design:paramtypes",[String,ra]),Me("design:returntype",ct)],xn.prototype,"updateEncoderConfig",null),qi([Ji,Me("design:type",Function),Me("design:paramtypes",[String,ra]),Me("design:returntype",ct)],xn.prototype,"updateSendParameters",null),qi([Ji,Me("design:type",Function),Me("design:paramtypes",[ra,String]),Me("design:returntype",ct)],xn.prototype,"replaceTrack",null),qi([Ji,Me("design:type",Function),Me("design:paramtypes",[Object,Object,Array,String,String]),Me("design:returntype",ct)],xn.prototype,"restartICE",null);class Xw extends hy{constructor(t,r,i,s){var l,d,h;super(t,k(l=k(d=k(h="track-".concat(t.kind,"-")).call(h,r,"-")).call(d,s.clientId,"_")).call(l,Pe(5,""))),this._isDestroyed=!1,this._userId=r,this._uintId=i,this.store=s}getUserId(){return this._userId}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource()}_destroy(){this._isDestroyed=!0,S.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}}class m_ extends Xw{constructor(t,r,i,s){super(t,r,i,s),this._videoVisibleTimer=null,this.trackMediaType="video",this.updateMediaStreamTrackResolution()}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Bn.PLAYING)}getStats(){return ys(()=>{S.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),po(this,Yt.GET_STATS)||NA({},kp)}play(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=At.reportApiInvoke(null,{tag:Wt.TRACER,name:Ht.REMOTE_VIDEO_TRACK_PLAY,options:[this.getTrackId(),typeof t=="string"?t:"HTMLElement",r]});if(typeof t=="string"){const d=document.getElementById(t);var s;d?t=d:(S.warning(k(s="[".concat(this.getTrackId(),'] can not find "#')).call(s,t,'" element, use document.body')),t=document.body)}S.debug("[".concat(this.getTrackId(),"] start video playback"),St(r));const l=NA(NA({fit:"cover"},r),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(l):(this._player=new vA(l),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,performance.now()),this.emit(Rl.FIRST_FRAME_DECODED)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=be(()=>{try{const d=this.getVideoElementVisibleStatus();this.emit(Rl.VIDEO_ELEMENT_VISIBLE_STATUS,d)}catch{}},it("CHECK_VIDEO_VISIBLE_INTERVAL")),i.onSuccess()}stop(){const t=At.reportApiInvoke(null,{tag:Wt.TRACER,name:Ht.REMOTE_VIDEO_TRACK_STOP,options:[this.getTrackId()]});if(!this._player)return t.onSuccess();this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._player.destroy(),this._player=void 0,S.debug("[".concat(this.getTrackId(),"] stop video playback")),t.onSuccess()}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){Kp(this._originMediaStreamTrack).then(t=>{let[r,i]=t;this._videoHeight=i,this._videoWidth=r}).catch(Ml)}_updatePlayerSource(){S.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var t,r;const i=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),s={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:l,slot:d}=s;if(this.isPlaying&&l instanceof HTMLVideoElement&&d instanceof HTMLElement){const h=c_.checkOneElementVisible(l),p=hr({},h);return p.visible||At.reportApiInvoke(null,{tag:Wt.TRACER,name:Ht.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]}).onSuccess("Not visible because of ".concat(p.reason)),p}return}catch(i){throw new P(D.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}}class E_ extends Xw{constructor(t,r,i,s){super(t,r,i,s),this.trackMediaType="audio",this._useAudioElement=!0,this._volume=100,this._source=new Fp(t,!0),this._source.once(Oo.RECEIVE_TRACK_BUFFER,()=>{this.emit(Rl.FIRST_FRAME_DECODED)})}get isPlaying(){return this._useAudioElement?Yr.isPlaying(this.getTrackId()):this._source.isPlayed}setAudioFrameCallback(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(Oo.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(Oo.ON_AUDIO_BUFFER),this._source.on(Oo.ON_AUDIO_BUFFER,i=>t(i))}setVolume(t){const r=At.reportApiInvoke(null,{tag:Wt.TRACER,name:Ht.REMOTE_AUDIO_SET_VOLUME,options:[this.getTrackId(),t]},300);this._volume=t,this._useAudioElement?Yr.setVolume(this.getTrackId(),t):this._source.setVolume(t/100),r.onSuccess()}async setPlaybackDevice(t){const r=At.reportApiInvoke(null,{tag:Wt.TRACER,name:Ht.REMOTE_AUDIO_SET_OUTPUT_DEVICE,options:[this.getTrackId(),t]});if(!this._useAudioElement)throw new P(D.NOT_SUPPORTED,"your browser does not support setting the audio output device");try{await Yr.setSinkID(this.getTrackId(),t)}catch(i){throw r.onError(i),i}r.onSuccess()}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return ys(()=>{S.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),po(this,Yt.GET_STATS)||NA({},Op)}play(){const t=At.reportApiInvoke(null,{tag:Wt.TRACER,name:Ht.REMOTE_AUDIO_TRACK_PLAY,options:[this.getTrackId()]});S.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(S.debug("[".concat(this.getTrackId(),"] use audio element to play")),Yr.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play(),t.onSuccess()}stop(){const t=At.reportApiInvoke(null,{tag:Wt.TRACER,name:Ht.REMOTE_AUDIO_TRACK_STOP,options:[this.getTrackId()]});S.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Yr.stop(this.getTrackId()):this._source.stop(),t.onSuccess()}_destroy(){super._destroy(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){S.debug("[".concat(this.getTrackId(),"] update player source track")),this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Yr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}}function Zw(e,t){var r=ae(e);if(Xt){var i=Xt(e);t&&(i=kt(i).call(i,function(s){return jt(e,s).enumerable})),r.push.apply(r,i)}return r}function $w(e){for(var t=1;t<arguments.length;t++){var r,i,s=arguments[t]!=null?arguments[t]:{};t%2?V(r=Zw(Object(s),!0)).call(r,function(l){mr(e,l,s[l])}):Zt?ur(e,Zt(s)):V(i=Zw(Object(s))).call(i,function(l){ie(e,l,jt(s,l))})}return e}class L7 extends Wr{constructor(){super(),this.uploadUnplinkStarted=!1,this.uploadDownlinkStarted=!1}startUploadUplinkStats(){this.uploadUnplinkStarted||(this.uploadUnplinkStarted=!0,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkStatsUploadInterval=be(()=>{var t;const r=(t=this.requestStats)===null||t===void 0?void 0:t.call(this);r&&(this.uploadUplinkStats(r,this.lastStats),this.lastStats=r)},3e3),this.uplinkStatsUploadSlowInterval&&window.clearInterval(this.uplinkStatsUploadSlowInterval),this.uplinkStatsUploadSlowInterval=be(()=>{var t;const r=(t=this.requestStats)===null||t===void 0?void 0:t.call(this);r&&this.uploadSlowUplinkStats(r)},6e4),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkRelatedStatsUploadInterval=be(()=>{var t;const r=(t=this.requestStats)===null||t===void 0?void 0:t.call(this);r&&this.uploadRelatedUplinkStats(r,this.lastStats),this.lastStats=r},1e3))}uploadUplinkStats(t,r){var i;const s=((i=this.requestLocalMedia)===null||i===void 0?void 0:i.call(this))||[];V(s).call(s,l=>{let[d,{track:h,ssrcs:p}]=l;switch(d){case Ut.LocalVideoLowTrack:case Ut.LocalVideoTrack:{const f=function(v,T,R){var w,O;const B=ft(w=T.videoSend).call(w,j=>j.ssrc===v);if(!B)return null;const K={id:Pe(10,""),timestamp:new Date(T.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:B.ssrc.toString()};switch(K.A_vstd=R._originMediaStreamTrack&&!R._originMediaStreamTrack.enabled||!R._mediaStreamTrack.enabled?"1":"0",B.sentFrame&&(K.A_fhs=B.sentFrame.height.toString(),K.A_frs=B.sentFrame.frameRate.toString(),K.A_fws=B.sentFrame.width.toString()),B.adaptionChangeReason){case"none":K.A_ac="0";break;case"cpu":K.A_ac="1";break;case"bandwidth":K.A_ac="2";break;case"other":K.A_ac="3"}return K.A_lvps=Gm[R._player?R._player.videoElementStatus:"uninit"].toString(),K.A_nr=(O=B.nacksCount)===null||O===void 0?void 0:O.toString(),B.avgEncodeMs&&(K.A_aem=B.avgEncodeMs.toFixed(0).toString()),K}(p[0].ssrcId,t,h),_=Dy(p[0].ssrcId,t,r);f&&sn(()=>{var v;return(v=this.requestUpload)===null||v===void 0?void 0:v.call(this,No.PUBLISH_STATS,{stream_type:d===Ut.LocalVideoLowTrack?"low":"high",stats:$w($w({},f),_)})});break}case Ut.LocalAudioTrack:{const f=function(_,v,T){var R;const w=ft(R=v.audioSend).call(R,B=>B.ssrc===_);if(!w)return null;const O={id:Pe(10,""),timestamp:new Date(v.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:w.ssrc.toString()};return O.A_astd=T._originMediaStreamTrack.enabled&&T._mediaStreamTrack.enabled?"0":"1",w.inputLevel?O.A_ail=Math.round(100*w.inputLevel).toString():O.A_ail=Math.round(100*T._source.getAccurateVolumeLevel()).toString(),O.A_apil=Math.round(100*T._source.getAccurateVolumeLevel()).toString(),O}(p[0].ssrcId,t,h);f&&sn(()=>{var _;return(_=this.requestUpload)===null||_===void 0?void 0:_.call(this,No.PUBLISH_STATS,{stream_type:"high",stats:f})});break}}const m=function(f){const _={id:"bweforvideo",timestamp:new Date(f.timestamp).toISOString(),type:"VideoBwe"};return f.bitrate.retransmit&&(_.A_rb=f.bitrate.retransmit.toString()),f.bitrate.targetEncoded&&(_.A_teb=f.bitrate.targetEncoded.toString()),_.A_aeb=f.bitrate.actualEncoded.toString(),_.A_tb=f.bitrate.transmit.toString(),f.sendBandwidth!==void 0&&(_.A_asb=f.sendBandwidth.toString()),_}(t);m&&sn(()=>{var f;return(f=this.requestUpload)===null||f===void 0?void 0:f.call(this,No.PUBLISH_STATS,{stream_type:d===Ut.LocalVideoLowTrack?"low":"high",stats:m})})})}uploadSlowUplinkStats(t){var r,i;const s=kt(r=((i=this.requestLocalMedia)===null||i===void 0?void 0:i.call(this))||[]).call(r,l=>{let[d]=l;return d===Ut.LocalVideoLowTrack||d===Ut.LocalVideoTrack});V(s).call(s,l=>{let[d,{ssrcs:h}]=l;const p=Dy(h[0].ssrcId,t);p&&sn(()=>{var m;return(m=this.requestUpload)===null||m===void 0?void 0:m.call(this,No.PUBLISH_STATS,{stream_type:d===Ut.LocalVideoLowTrack?"low":"high",stats:p})})})}uploadRelatedUplinkStats(t,r){var i,s;const l=kt(i=((s=this.requestLocalMedia)===null||s===void 0?void 0:s.call(this))||[]).call(i,d=>{let[h]=d;return h===Ut.LocalVideoLowTrack||h===Ut.LocalVideoTrack});V(l).call(l,d=>{let[h,{ssrcs:p}]=d;const m=function(f,_){var v;const T=ft(v=_.videoSend).call(v,R=>R.ssrc===f);return T?{mediaType:"video",isVideoMute:!1,frameRateInput:T.inputFrame&&T.inputFrame.frameRate.toString(),frameRateSent:T.sentFrame&&T.sentFrame.frameRate.toString(),googRtt:T.rttMs.toString()}:null}(p[0].ssrcId,t);m&&sn(()=>{var f;(f=this.requestUpload)===null||f===void 0||f.call(this,No.PUBLISH_RELATED_STATS,{stream_type:h===Ut.LocalVideoLowTrack?"low":"high",stats:m})})})}stopUploadUplinkStats(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkStatsUploadInterval=void 0,this.uplinkRelatedStatsUploadInterval=void 0)}startUploadDownlinkStats(){this.uploadDownlinkStarted||(this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval),this.downlinkStatsUploadInterval=be(()=>{var t;const r=(t=this.requestStats)===null||t===void 0?void 0:t.call(this);r&&(this.uploadDownlinkStats(r,this.lastStats),this.lastStats=r)},3e3),this.downlinkStatsUploadSlowInterval&&window.clearInterval(this.downlinkStatsUploadSlowInterval),this.downlinkStatsUploadSlowInterval=be(()=>{var t;const r=(t=this.requestStats)===null||t===void 0?void 0:t.call(this);r&&this.uploadSlowDownlinkStats(r)},6e4),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkRelatedStatsUploadInterval=be(()=>{var t;const r=(t=this.requestStats)===null||t===void 0?void 0:t.call(this);r&&(this.uploadRelatedDownlinkStats(r,this.lastStats),this.lastStats=r)},1e3))}uploadDownlinkStats(t,r){var i;const s=((i=this.requestRemoteMedia)===null||i===void 0?void 0:i.call(this))||[];V(s).call(s,l=>{let[d,h]=l;if(h.has(er.VIDEO)&&d.videoTrack){const p=d.videoTrack?function(m,f,_){var v;const T=ft(v=f.videoRecv).call(v,O=>O.ssrc===m);if(!T)return null;const R={id:Pe(10,""),timestamp:new Date(f.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:T.ssrc.toString()};var w;return R.bytesReceived=T.bytes.toString(),R.packetsLost=T.packetsLost.toString(),R.packetsReceived=T.packets.toString(),T.framesRateFirefox&&(R.A_frr=T.framesRateFirefox.toString()),T.receivedFrame&&(R.A_frr=T.receivedFrame.frameRate.toString()),R.A_frd=T.decodeFrameRate.toString(),T.outputFrame&&(R.A_fro=T.outputFrame.frameRate.toString()),T.jitterBufferMs!==void 0&&(R.A_jbm=Math.floor(T.jitterBufferMs).toString()),T.currentDelayMs!==void 0&&(R.A_cdm=Math.floor(T.currentDelayMs).toString()),R.A_fs=T.firsCount.toString(),R.A_ns=T.nacksCount.toString(),R.A_ps=T.plisCount.toString(),_&&(R.A_vrtd=_._originMediaStreamTrack.enabled&&_._mediaStreamTrack.enabled?"0":"1"),_._player&&_._player.freezeTimeCounterList.length>0&&(R.A_vrft=Ye(w=_._player.freezeTimeCounterList).call(w,0,1)[0].toString()),R.A_rvps=Gm[_._player?_._player.videoElementStatus:"uninit"].toString(),R}(d._videoSSRC,t,d.videoTrack):void 0;p&&sn(()=>{var m;return(m=this.requestUpload)===null||m===void 0?void 0:m.call(this,No.SUBSCRIBE_STATS,{stream_id:d.uid,stats:p})})}if(h.has(er.AUDIO)&&d.audioTrack){const p=d.audioTrack?function(m,f,_){var v;const T=ft(v=f.audioRecv).call(v,w=>w.ssrc===m);if(!T)return null;const R={id:Pe(10,""),timestamp:new Date(f.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:T.ssrc.toString()};return R.bytesReceived=T.bytes.toString(),R.packetsLost=T.packetsLost.toString(),R.packetsReceived=T.packets.toString(),T.outputLevel?R.A_aol=Math.round(100*T.outputLevel).toString():R.A_aol=Math.round(100*_._source.getAccurateVolumeLevel()).toString(),R.A_apol=Math.round(100*_._source.getAccurateVolumeLevel()).toString(),_&&(R.A_artd=_._originMediaStreamTrack.enabled&&_._mediaStreamTrack.enabled?"0":"1"),R.A_jr=T.jitterMs.toString(),R.A_jbm=Math.floor(T.jitterBufferMs).toString(),R.A_cdm=Math.floor(T.jitterBufferMs).toString(),R.A_raps=Gm[Yr.getPlayerState(_.getTrackId())].toString(),R}(d._audioSSRC,t,d.audioTrack):void 0;p&&sn(()=>{var m;return(m=this.requestUpload)===null||m===void 0?void 0:m.call(this,No.SUBSCRIBE_STATS,{stream_id:d.uid,stats:p})})}})}uploadSlowDownlinkStats(t){}uploadRelatedDownlinkStats(t,r){var i;const s=((i=this.requestRemoteMedia)===null||i===void 0?void 0:i.call(this))||[];V(s).call(s,l=>{let[d,h]=l;if(h.has(er.VIDEO)&&d.videoTrack){var p;const m=(d._videoSSRC&&((p=this.requestVideoIsReady)===null||p===void 0?void 0:p.call(this,d._videoSSRC))||!1)===!0,f=function(_,v,T,R,w,O){var B,K;const j=ft(B=T.videoRecv).call(B,Rt=>Rt.ssrc===_),nt=w?ft(K=w.videoRecv).call(K,Rt=>Rt.ssrc===_):void 0;if(!j)return null;const It=Ll.isRemoteVideoFreeze(O,j,nt)&&v,vt={mediaType:"video",isVideoMute:!1,peerId:R,frameRateReceived:j.receivedFrame&&j.receivedFrame.frameRate.toString(),frameRateDecoded:j.decodedFrame&&j.decodedFrame.frameRate.toString(),isFreeze:It,bytesReceived:j.bytes.toString(),packetsReceived:j.packets.toString(),packetsLost:j.packetsLost.toString()};return j.framesRateFirefox&&(vt.frameRateDecoded=j.framesRateFirefox.toString(),vt.frameRateReceived=j.framesRateFirefox.toString()),vt}(d._videoSSRC,m,t,d.uid,r,d.videoTrack);f&&sn(()=>{var _;(_=this.requestUpload)===null||_===void 0||_.call(this,No.SUBSCRIBE_RELATED_STATS,{stream_id:d.uid,stats:f})})}if(h.has(er.AUDIO)&&d.audioTrack){const m=function(f,_,v,T){var R;const w=ft(R=_.audioRecv).call(R,B=>B.ssrc===f);if(!w)return null;const O=Ll.isRemoteAudioFreeze(T);return{mediaType:"audio",isAudioMute:!1,peerId:v,googJitterReceived:w.jitterMs.toString(),isFreeze:O,bytesReceived:w.bytes.toString(),packetsReceived:w.packets.toString(),packetsLost:w.packetsLost.toString(),frameReceived:w.receivedFrames.toString(),frameDropped:w.droppedFrames.toString()}}(d._audioSSRC,t,d.uid,d.audioTrack);m&&sn(()=>{var f;(f=this.requestUpload)===null||f===void 0||f.call(this,No.SUBSCRIBE_RELATED_STATS,{stream_id:d.uid,stats:m})})}})}stopUploadDownlinkStats(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkStatsUploadInterval=void 0,this.downlinkRelatedStatsUploadInterval=void 0)}}function tb(e,t){var r=ae(e);if(Xt){var i=Xt(e);t&&(i=kt(i).call(i,function(s){return jt(e,s).enumerable})),r.push.apply(r,i)}return r}function Ka(e){for(var t=1;t<arguments.length;t++){var r,i,s=arguments[t]!=null?arguments[t]:{};t%2?V(r=tb(Object(s),!0)).call(r,function(l){mr(e,l,s[l])}):Zt?ur(e,Zt(s)):V(i=tb(Object(s))).call(i,function(l){ie(e,l,jt(s,l))})}return e}function eb(e){var t,r,i,s=2;for(RA!==void 0&&(r=C7,i=ww);s--;){if(r&&(t=e[r])!=null)return t.call(e);if(i&&(t=e[i])!=null)return new __(t.call(e));r="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function __(e){function t(r){if(Object(r)!==r)return ct.reject(new TypeError(r+" is not an object."));var i=r.done;return ct.resolve(r.value).then(function(s){return{value:s,done:i}})}return(__=function(r){this.s=r,this.n=r.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(r){var i=this.s.return;return i===void 0?ct.resolve({value:r,done:!0}):t(i.apply(this.s,arguments))},throw:function(r){var i=this.s.return;return i===void 0?ct.reject(r):t(i.apply(this.s,arguments))}},new __(e)}var ss=function(e,t,r,i){var s,l=arguments.length,d=l<3?t:i===null?i=jt(t,r):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(e,t,r,i);else for(var h=e.length-1;h>=0;h--)(s=e[h])&&(d=(l<3?s(d):l>3?s(t,r,d):s(t,r))||d);return l>3&&d&&ie(t,r,d),d},Ar=function(e,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(e,t)};class xo extends Wr{constructor(t,r){super(),this.localTrackMap=new $t,this.remoteUserMap=new $t,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.isPlanB=!1,this.iceFailedCount=0,this.dtlsFailedCount=0,this.mutex=new wn("P2PChannel-mutex"),this._state=Gi.Disconnected,this.handleMuteLocalTrack=async(i,s,l)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection)return void l(new P(D.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));await this.waitTillConnected();const h=this.filterTobeMutedTracks(i);if(h.length===0)return void s();await this.connection.muteLocal(pt(h).call(h,m=>{let[,{id:f}]=m;return f}));const p=this.createMuteMessage(h);await Xe(this,ze.RequestMuteLocal,p),s()}catch(h){l(h)}finally{d()}},this.handleUnmuteLocalTrack=async(i,s,l)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection)return void l(new P(D.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));await this.waitTillConnected();const h=this.filterTobeUnmutedTracks(i);if(h.length===0)return void s();await this.connection.unmuteLocal(pt(h).call(h,m=>{let[,{id:f}]=m;return f}));const p=this.createUnmuteMessage(h);await Xe(this,ze.RequestUnmuteLocal,p),s()}catch(h){l(h)}finally{d()}},this.handleUpdateVideoEncoder=async(i,s,l)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const h=this.localTrackMap.get(Ut.LocalVideoTrack);if(!this.connection||!h||h.track!==i)return void s();await this.waitTillConnected();const{id:p,track:m}=h;await this.connection.updateSendParameters(p,m),await this.connection.updateEncoderConfig(p,m),s()}catch(h){l(h)}finally{d()}},this.handleSetOptimizationMode=async(i,s,l)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleSetOptimizationMode");try{const h=this.localTrackMap.get(Ut.LocalVideoTrack);if(!this.connection||!h||h.track!==i)return;await this.waitTillConnected();const{id:p,track:m}=h;await this.connection.updateSendParameters(p,m),s()}catch(h){l(h)}finally{d()}},this.handleReplaceTrack=async(i,s,l)=>{try{var d,h;const p=ft(d=Qe(nn(h=this.localTrackMap).call(h))).call(d,m=>{let[,{track:f}]=m;return i===f});if(!this.connection||!p)return void s();if(await this.waitTillConnected(),await this.connection.replaceTrack(i,p[1].id),this.isPlanB){const m=p[1];m.id=i._mediaStreamTrack.id,this.localTrackMap.set(p[0],m)}s()}catch(p){l(p)}},this.handleGetLocalVideoStats=i=>{i(this.statsCollector.getLocalVideoTrackStats())},this.handleGetLocalAudioStats=i=>{i(this.statsCollector.getLocalAudioTrackStats())},this.handleGetRemoteVideoStats=i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid],this.handleGetRemoteAudioStats=i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid],this.store=t,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new L7,this.bindStatsUploaderEvents(),this.isPlanB=!Dr().supportUnifiedPlan||it("CHROME_FORCE_PLAN_B")&&El()}get state(){return this._state}set state(t){const r=this._state;this._state=t,this.emit(ze.StateChange,r,this._state)}async startP2PConnection(t){return this.state=Gi.New,this.connection=this.isPlanB?new Un(t,this.store):new xn(t,this.store),this.bindConnectionEvents(this.connection),this.store.peerConnectionStart(),this.connection.establish()}async connect(t,r,i,s,l,d,h,p){if(!this.connection)throw new P(D.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");await this.connection.connect(t,r,i,s,l,d,h,p),this.state=Gi.Connected}publish(t,r,i){var s=this;return Ou(function*(){const l=yield hn(s.mutex.lock("From P2PChannel.publish"));if(s.connection){s.store.pubId=s.store.pubId+1,ho.markPublishStart(s.store.clientId,s.store.pubId);try{yield hn(s.waitTillConnected());const h=s.filterTobePublishedTracks(t,r,i);if(h.length===0)return;yield*yw(eb(s.doPublish(s.connection,h)),hn)}finally{l()}}else{var d;if(s.state===Gi.Disconnected)throw new P(D.UNEXPECTED_ERROR,"PeerConnection already disconnected.");s.throwIfTrackTypeNotMatch(t);const h=kt(t).call(t,p=>{var m;return xt(m=s.pendingLocalTracks).call(m,p)===-1});s.pendingLocalTracks=k(d=s.pendingLocalTracks).call(d,h)}})()}doPublish(t,r){var i=this;return Ou(function*(){V(r).call(r,f=>{let{track:_,type:v}=f;const T=performance.now();i.store.publish(_.getTrackId(),v===Ut.LocalAudioTrack?"audio":"video",T)});const s=yield hn(t.send(pt(r).call(r,f=>{let{track:_}=f;return _}),i.store.codec)),l=(yield hn(s.next())).value,d=i.createGatewayPublishMessage(r,l);let h;try{h=yield d}catch(f){throw s.throw(f),(f==null?void 0:f.code)===D.WS_ABORT&&V(r).call(r,_=>{var v;let{track:T}=_;xt(v=i.pendingLocalTracks).call(v,T)===-1&&i.pendingLocalTracks.push(T)}),f}const p=i.mapPubResToRemoteConfig(d,h),m=(yield hn(s.next(p))).value;V(r).call(r,f=>{let{type:_}=f;i.statsCollector.addLocalStats(_)}),i.bindLocalTrackEvents(r),i.assignLocalTracks(r,m),i.statsUploader.startUploadUplinkStats(),V(r).call(r,f=>{let{track:_,type:v}=f;const T=performance.now();i.store.publish(_.getTrackId(),v===Ut.LocalAudioTrack?"audio":"video",void 0,T)})})()}publishLowStream(t){var r=this;return Ou(function*(){if(!r.connection)return;const i=yield hn(r.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const l=r.localTrackMap.get(Ut.LocalVideoTrack);if(!l)throw new P(D.UNEXPECTED_ERROR,"Could not find high stream");if(r.localTrackMap.has(Ut.LocalVideoLowTrack))throw new P(D.UNEXPECTED_ERROR,"[".concat(r.store.clientId,"] Can't publish low stream when stream already publish"));yield hn(r.waitTillConnected());const d=[{track:r.getLowVideoTrack(l.track,t),type:Ut.LocalVideoLowTrack}];if(yield*yw(eb(r.doPublish(r.connection,d)),hn),l.track.muted||!l.track.enabled){var s;const h=(s=r.localTrackMap.get(Ut.LocalVideoLowTrack))===null||s===void 0?void 0:s.id;h!==void 0&&(yield hn(r.connection.muteLocal([h])))}}finally{i()}})()}async republish(){this.pendingLocalTracks.length>0&&(S.debug("Emit P2PChannelEvents.RequestRePublish to republish tracks."),await Ur(this,ze.RequestRePublish,this.pendingLocalTracks),this.emit(ze.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async reSubscribe(t){var r;for(let s=this.pendingRemoteTracks.length-1;s>=0;s--){const{user:l,kind:d}=this.pendingRemoteTracks[s];var i;(d!==er.AUDIO||l._audio_added_&&l._audioSSRC)&&(d!==er.VIDEO||l._video_added_&&l._videoSSRC)||Ye(i=this.pendingRemoteTracks).call(i,s,1)}if(t)await Ur(this,ze.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:s,kind:l}of this.pendingRemoteTracks)await this.subscribe(s,l,l===er.VIDEO?s._videoSSRC:s._audioSSRC);V(r=this.pendingRemoteTracks).call(r,s=>{let{user:l}=s;this.emit(ze.MediaReconnectEnd,l.uid)}),this.pendingRemoteTracks=[]}async unpublish(t){if(!this.connection)return void V(t).call(t,i=>{var s;const l=xt(s=this.pendingLocalTracks).call(s,i);var d;l!==-1&&Ye(d=this.pendingLocalTracks).call(d,l,1)});await this.waitTillConnected();const r=this.filterTobeUnpublishedTracks(t);return r.length!==0?this.doUnpublish(this.connection,r):void 0}async unpublishLowStream(){if(!this.connection)return;const t=this.localTrackMap.get(Ut.LocalVideoLowTrack);if(!t)return;await this.waitTillConnected();const r=[[Ut.LocalVideoLowTrack,t]];return this.doUnpublish(this.connection,r)}async doUnpublish(t,r){const i=this.createGatewayUnpublishMessage(r);return await t.stopSending(pt(r).call(r,s=>{let[,{id:l}]=s;return l})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r),V(r).call(r,s=>{let[l]=s;this.statsCollector.removeLocalStats(l)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadUplinkStats(),i}async subscribe(t,r,i,s){var l,d;if(!this.connection)throw new P(D.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((l=this.remoteUserMap.get(t))!==null&&l!==void 0&&l.has(r))return;let h,p;if(await this.waitTillConnected(),s){const O=ft(s).call(s,K=>{let{stream_type:j}=K;return j===r});var m,f;if(!O)throw new P(D.UNEXPECTED_ERROR,k(m=k(f="Cannot subscribe to remote ".concat(r," for user: ")).call(f,t.uid," because subscribe answer from gateway does not contain stream_type: ")).call(m,r,"."));const B=await this.connection.receive(r,O.ssrcs,String(t.uid),O.attributes);h=B.track,p=B.id}else{const O=await this.connection.receive(r,[{ssrcId:i}],String(t.uid),void 0);h=O.track,p=O.id}var _,v;r===er.AUDIO?t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(h):(t._audioTrack=new E_(h,t.uid,t._uintid,this.store),S.info(k(_="[".concat(this.store.p2pId,"] create remote audio track: ")).call(_,t._audioTrack.getTrackId())),this.bindRemoteTrackEvents(t,t._audioTrack)):t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(h):(t._videoTrack=new m_(h,t.uid,t._uintid,this.store),S.info(k(v="[".concat(this.store.p2pId,"] create remote video track: ")).call(v,t._videoTrack.getTrackId())),this.bindRemoteTrackEvents(t,t._videoTrack));const T=this.remoteUserMap.get(t);T?T.set(r,p):this.remoteUserMap.set(t,new $t([[r,p]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadDownlinkStats();const R=Yn(d=this.pendingRemoteTracks).call(d,O=>{let{user:B,kind:K}=O;return B.uid===t.uid&&r===K});var w;R!==-1&&(Ye(w=this.pendingRemoteTracks).call(w,R,1),this.emit(ze.MediaReconnectEnd,t.uid))}async unsubscribe(t,r){var i;const s=kt(i=this.pendingRemoteTracks).call(i,h=>{let{user:p,kind:m}=h;return r!==void 0?p.uid===t.uid&&r===m:p.uid===t.uid});if(V(s).call(s,h=>{var p,m;const f=xt(p=this.pendingRemoteTracks).call(p,h);Ye(m=this.pendingRemoteTracks).call(m,f,1)}),!this.connection)return void V(s).call(s,h=>{let{kind:p}=h;var m;if(p===er.AUDIO)(m=t._audioTrack)===null||m===void 0||m._destroy(),t._audioTrack=void 0;else if(p===er.VIDEO){var f;(f=t._videoTrack)===null||f===void 0||f._destroy(),t._videoTrack=void 0}});const l=this.filterTobeUnSubscribedTracks(t,r);if(l.length===0)return;await this.connection.stopReceiving(pt(l).call(l,h=>{let[,{id:p}]=h;return p}));const d=this.createUnsubscribeMessage(l);return this.withdrawRemoteTracks(l),this.remoteUserMap.size===0&&this.statsUploader.stopUploadDownlinkStats(),V(l).call(l,h=>{let[p,{kind:m}]=h;var f,_;if(m===er.VIDEO&&p._videoSSRC&&((f=this.connection)===null||f===void 0||f.setStatsRemoteVideoIsReady(p._videoSSRC,!1)),m===er.VIDEO)this.unbindRemoteTrackEvents(p._videoTrack),(_=p._videoTrack)===null||_===void 0||_._destroy(),p._videoTrack=void 0;else if(m===er.AUDIO){var v;this.unbindRemoteTrackEvents(p._audioTrack),(v=p._audioTrack)===null||v===void 0||v._destroy(),p._audioTrack=void 0}}),d}async muteRemote(t,r){if(!this.connection)return;const i=this.remoteUserMap.get(t);if(!i)return void S.warning("P2PChannel.unmuteRemote has no remote user ".concat(t.uid,"."));const s=i.get(r);var l;if(!s)return void S.warning(k(l="P2PChannel.unmuteRemote has no remote user ".concat(t.uid," media type ")).call(l,r,"."));const d=r===er.VIDEO?t._videoSSRC:t._audioSSRC;d!==void 0&&this.connection.setStatsRemoteVideoIsReady(d,!1),await this.connection.muteRemote(s)}async unmuteRemote(t,r){if(!this.connection)return;const i=this.remoteUserMap.get(t);if(!i)return void S.warning("P2PChannel.unmuteRemote has no remote user ".concat(t.uid,"."));const s=i.get(r);var l;s?await this.connection.unmuteRemote(s):S.warning(k(l="P2PChannel.unmuteRemote has no remote user ".concat(t.uid," media type ")).call(l,r,"."))}getAllTracks(t){const r=this.localTrackMap.get(Ut.LocalAudioTrack);if((r==null?void 0:r.track)instanceof uo){var i,s,l,d,h;const _=r.track;return k(i=pt(s=kt(l=kt(d=Qe(nn(h=this.localTrackMap).call(h))).call(d,v=>{let[T]=v;return T!==Ut.LocalAudioTrack})).call(l,v=>{let[T]=v;return!(t&&T===Ut.LocalVideoLowTrack)})).call(s,v=>{let[,{track:T}]=v;return T})).call(i,_.trackList)}var p,m,f;return pt(p=kt(m=Qe(nn(f=this.localTrackMap).call(f))).call(m,_=>{let[v]=_;return!(t&&v===Ut.LocalVideoLowTrack)})).call(p,_=>{let[,{track:v}]=_;return v})}reportPublishEvent(t,r,i,s,l){if(t){var d;const m=this.localTrackMap.get(Ut.LocalAudioTrack),f=s?this.localTrackMap.get(Ut.LocalVideoLowTrack):this.localTrackMap.get(Ut.LocalVideoTrack);At.publish(this.store.sessionId,{eventElapse:ho.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:m==null?void 0:m.track.getTrackLabel(),videoName:f==null?void 0:f.track.getTrackLabel(),screenshare:(f==null?void 0:xt(d=f.track._hints).call(d,Kn.SCREEN_TRACK))!==-1,audio:!!m,video:!!f,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:l})}else{var h,p;i||(i=[]);const m=ft(i).call(i,_=>_ instanceof qr),f=s?(h=this.localTrackMap.get(Ut.LocalVideoTrack))===null||h===void 0?void 0:h.track:ft(i).call(i,_=>_ instanceof cr);At.publish(this.store.sessionId,{eventElapse:ho.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:m==null?void 0:m.getTrackLabel(),videoName:f==null?void 0:f.getTrackLabel(),screenshare:(f==null?void 0:xt(p=f._hints).call(p,Kn.SCREEN_TRACK))!==-1,audio:!!m,video:!!f,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:l})}}reportSubscribeEvent(t,r,i,s){const l=s===er.VIDEO?i._videoSSRC:i._audioSSRC;l&&At.subscribe(this.store.sessionId,{succ:t,ec:r,video:s===er.VIDEO,audio:s===er.AUDIO,peerid:i.uid,subscribeRequestid:s===er.VIDEO?i._videoSSRC:i._audioSSRC,p2pid:this.store.p2pId,eventElapse:ho.measureFromSubscribeStart(this.store.clientId,l)})}reset(){S.debug("P2PChannel.reset"),this.mutex=new wn("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.state=Gi.Disconnected}getStats(){var t;return(t=this.connection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(t){var r;return((r=this.connection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(Ut.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(Ut.LocalVideoTrack);if(t)return{width:t.track._videoWidth||0,height:t.track._videoHeight||0}}getEncoderConfig(t){const r=this.localTrackMap.get(t);return r&&r.track instanceof cr||r&&r.track instanceof qr?r.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,r){if(!t)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(t);return!!i&&(!r||i.has(r))}getRemoteMedia(t){var r,i;const s=ft(r=Qe(wc(i=this.remoteUserMap).call(i))).call(r,l=>l.uid===t);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){var t,r;let i=pt(t=Qe(nn(r=this.remoteUserMap).call(r))).call(t,l=>{let[d]=l;return{uid:d.uid,level:d.audioTrack?100*d.audioTrack._source.getAccurateVolumeLevel():0}});const s=this.localTrackMap.get(Ut.LocalAudioTrack);return s&&i.push({level:100*s.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),i=Ua(i).call(i,(l,d)=>l.level-d.level),i}async disconnectForReconnect(){if(this.connection){var t,r,i,s;S.debug("P2PChannel.disconnectForReconnect closing P2PConnection"),this.state=Gi.Reconnecting,this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.localTrackMap.size!==0&&(V(t=Qe(nn(r=this.localTrackMap).call(r))).call(t,l=>{var d;let[h,{track:p}]=l;switch(h){case Ut.LocalVideoTrack:qt(d=p._hints).call(d,Kn.LOW_STREAM)?p.close():this.pendingLocalTracks.push(p);break;case Ut.LocalAudioTrack:var m;p instanceof uo?this.pendingLocalTracks=k(m=this.pendingLocalTracks).call(m,p.trackList):this.pendingLocalTracks.push(p);break;case Ut.LocalVideoLowTrack:}}),this.emit(ze.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&V(i=Qe(nn(s=this.remoteUserMap).call(s))).call(i,l=>{var d;let[h,p]=l;V(d=Qe(wc(p).call(p))).call(d,m=>{this.setPendingRemoteMedia(h,m)}),this.emit(ze.MediaReconnectStart,h.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),S.debug("P2PChannel disconnected, waiting to reconnect.")}}hasPendingRemoteMedia(t,r){for(const i of this.pendingRemoteTracks){const{user:s,kind:l}=i;if((t instanceof Yl?t.uid:t)===s.uid&&r===l)return!0}return!1}setPendingRemoteMedia(t,r){this.hasPendingRemoteMedia(t,r)||this.pendingRemoteTracks.push({user:t,kind:r})}async reEstablish(){if(this.connection)return this.connection.reEstablish()}getUplinkNetworkQuality(){var t,r,i;if(!this.connection)return 0;const s=this.connection.getStats(),l=this.localTrackMap.get(Ut.LocalVideoTrack),d=this.localTrackMap.get(Ut.LocalAudioTrack),h=ft(t=s.videoSend).call(t,B=>B.ssrc===(l==null?void 0:l.ssrcs[0].ssrcId)),p=ft(r=s.audioSend).call(r,B=>B.ssrc===(d==null?void 0:d.ssrcs[0].ssrcId));if(!h||!p)return 1;const m=po(this,ze.NeedSignalRTT),f=h?h.rttMs:void 0,_=p?p.rttMs:void 0,v=f&&_?(f+_)/2:f||_,T=(v&&m?(v+m)/2:v||m)||0,R=100*s.sendPacketLossRate*.7/50+.3*T/1500,w=R<.17?1:R<.36?2:R<.59?3:R<.1?4:5,O=l==null?void 0:l.track;if(O&&O._encoderConfig&&xt(i=O._hints).call(i,Kn.SCREEN_TRACK)===-1){const B=O._encoderConfig.bitrateMax,K=s.bitrate.actualEncoded;if(B&&K){const j=(1e3*B-K)/(1e3*B);return sR[j<.15?0:j<.3?1:j<.45?2:j<.6?3:4][w]}}return w}getDownlinkNetworkQuality(){var t,r;if(!this.connection)return 0;const i=this.connection.getStats();let s=0;return V(t=Qe(nn(r=this.remoteUserMap).call(r))).call(t,l=>{var d,h;let[p]=l;const m=p._audioSSRC,f=p._videoSSRC,_=ft(d=i.audioRecv).call(d,j=>j.ssrc===m),v=ft(h=i.videoRecv).call(h,j=>j.ssrc===f);if(!_&&!v)return void(s+=1);const T=po(this,ze.NeedSignalRTT),R=i.rtt,w=(R&&T?(R+T)/2:R||T)||0,O=_?_.jitterMs:void 0,B=i.recvPacketLossRate;let K=.7*B*100/50+.3*w/1500;O&&(K=.6*B*100/50+.2*w/1500+.2*O/400),s+=K<.1?1:K<.17?2:K<.36?3:K<.59?4:5}),this.remoteUserMap.size>0?Math.round(s/this.remoteUserMap.size):s}async muteLocalTrack(t){return new ct((r,i)=>{this.handleMuteLocalTrack(t,r,i)})}filterTobePublishedTracks(t,r,i){const s=[],l=Dr(),d=this.getAllTracks();t=Wp(t=kt(t).call(t,m=>xt(d).call(d,m)===-1));let h=!1,p=!1;for(const m of t){if(m instanceof cr&&(this.localTrackMap.has(Ut.LocalVideoTrack)||h?new P(D.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(s.push({track:m,type:Ut.LocalVideoTrack}),h=!0),r)){const f=this.getLowVideoTrack(m,i);s.push({track:f,type:Ut.LocalVideoLowTrack})}if(m instanceof qr){const f=this.localTrackMap.get(Ut.LocalAudioTrack);if(f){if(!(f.track instanceof uo))throw new P(D.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(m._bypassWebAudio)throw new P(D.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");f.track.addAudioTrack(m),this.bindLocalAudioTrackEvents(m,!0)}else if(p){const _=ft(s).call(s,v=>{let{type:T}=v;return T===Ut.LocalAudioTrack});if(!(_.track instanceof uo))throw new P(D.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(m._bypassWebAudio)throw new P(D.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");_.track.addAudioTrack(m)}else{if(!l.webAudioMediaStreamDest||m instanceof uo||m._bypassWebAudio)s.push({track:m,type:Ut.LocalAudioTrack});else{const _=new uo;_.addAudioTrack(m),s.push({track:_,type:Ut.LocalAudioTrack})}p=!0}}}return s}filterTobeUnpublishedTracks(t){const r=[],i=this.getAllTracks();t=Wp(t=kt(t).call(t,s=>xt(i).call(i,s)!==-1));for(const s of t){if(s instanceof qr){const l=this.localTrackMap.get(Ut.LocalAudioTrack);if(!l)continue;l.track instanceof uo?(l.track.removeAudioTrack(s),this.unbindLocalAudioTrackEvents(s),l.track.trackList.length===0&&(r.push([Ut.LocalAudioTrack,l]),l.track.close())):r.push([Ut.LocalAudioTrack,l])}if(s instanceof cr){const l=this.localTrackMap.get(Ut.LocalVideoTrack);if(!l)continue;r.push([Ut.LocalVideoTrack,l]);const d=this.localTrackMap.get(Ut.LocalVideoLowTrack);d&&r.push([Ut.LocalVideoLowTrack,d])}}return r}bindLocalTrackEvents(t){V(t).call(t,r=>{let{track:i,type:s}=r;switch(s){case Ut.LocalVideoTrack:i.addListener(Yt.GET_STATS,this.handleGetLocalVideoStats),i.addListener(Yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(Yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(Yt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(Yt.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),i.addListener(Yt.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(Yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(Yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ut.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);break;case Ut.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,r){var i;t instanceof uo?V(i=t.trackList).call(i,s=>{s.addListener(Yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Yt.GET_STATS,this.handleGetLocalAudioStats),s.addListener(Yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(Yt.GET_STATS,this.handleGetLocalAudioStats),t.addListener(Yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(Yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(Yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(Yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||t.addListener(Yt.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t){var r;t||(t=Qe(nn(r=this.localTrackMap).call(r))),V(t).call(t,i=>{let[s,{track:l}]=i;switch(s){case Ut.LocalVideoTrack:l.off(Yt.GET_STATS,this.handleGetLocalVideoStats),l.off(Yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),l.off(Yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),l.off(Yt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),l.off(Yt.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),l.off(Yt.NEED_REPLACE_TRACK,this.handleReplaceTrack),l.off(Yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),l.off(Yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ut.LocalAudioTrack:this.unbindLocalAudioTrackEvents(l);break;case Ut.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){var r;t instanceof uo?V(r=t.trackList).call(r,i=>{i.off(Yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(Yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(Yt.GET_STATS,this.handleGetLocalAudioStats),i.off(Yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(Yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(Yt.GET_STATS,this.handleGetLocalAudioStats),t.off(Yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Yt.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(Yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,r){r instanceof m_&&r.addListener(Yt.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(t))}),r instanceof E_&&r.addListener(Yt.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(Yt.GET_STATS)}unbindAllRemoteTrackEvents(){var t,r;V(t=Qe(nn(r=this.remoteUserMap).call(r))).call(t,i=>{let[s,l]=i;l.has(er.AUDIO)&&this.unbindRemoteTrackEvents(s._audioTrack),l.has(er.VIDEO)&&this.unbindRemoteTrackEvents(s._videoTrack)})}createGatewayPublishMessage(t,r){return pt(t).call(t,(i,s)=>{var l;let d,h,{track:p,type:m}=i;switch(m){case Ut.LocalAudioTrack:d=Kr.Audio,h={dtx:p instanceof gu&&p._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Ut.LocalVideoTrack:d=qt(l=p._hints).call(l,Kn.SCREEN_TRACK)?Kr.Screen:Kr.High,h=Ka(Ka({},ky(p)),{},{codec:this.store.codec});break;case Ut.LocalVideoLowTrack:d=Kr.Low,h=Ka(Ka({},ky(p)),{},{codec:this.store.codec})}return{stream_type:d,attributes:h,ssrcs:r[s]}})}createGatewayUnpublishMessage(t){return pt(t).call(t,r=>{var i;let s,[l,{track:d,ssrcs:h,id:p}]=r;switch(l){case Ut.LocalVideoTrack:s=qt(i=d._hints).call(i,Kn.SCREEN_TRACK)?Kr.Screen:Kr.High;break;case Ut.LocalAudioTrack:s=Kr.Audio;break;case Ut.LocalVideoLowTrack:s=Kr.Low}return{stream_type:s,ssrcs:h,mid:p}})}assignLocalTracks(t,r){V(t).call(t,(i,s)=>{let{track:l,type:d}=i;this.localTrackMap.set(d,{track:l,id:r[s].id,ssrcs:r[s].localSSRC})})}withdrawLocalTracks(t){V(t).call(t,r=>{let[i]=r;this.localTrackMap.delete(i)})}async waitTillConnected(){return new ct((t,r)=>{switch(this.state){case Gi.New:case Gi.Reconnecting:{const i=(s,l)=>l===Gi.Disconnected?(this.off(ze.StateChange,i),void r(new P(D.UNEXPECTED_ERROR,"PeerConnection already disconnected."))):l===Gi.Connected?(this.off(ze.StateChange,i),void t(void 0)):void 0;this.on(ze.StateChange,i);break}case Gi.Connected:t(void 0);break;case Gi.Disconnected:r(new P(D.UNEXPECTED_ERROR,"PeerConnection already disconnected."))}})}bindConnectionEvents(t){t.onConnectionStateChange=async r=>{var i;S.info(k(i="[p2pId: ".concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(")).call(i,r,")")),this.emit(ze.PeerConnectionStateChange,r),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="failed"&&(t.iceConnectionState==="failed"?(ar(()=>this.emit(ze.P2PLost),0),this.iceFailedCount+=1,await Mr(hE(this.iceFailedCount,Ne)),this.emit(ze.RequestRestartICE)):await this.requestReconnect())},t.onICEConnectionStateChange=r=>{var i;S.info(k(i="[p2pId: ".concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(")).call(i,r,")")),this.emit(ze.IceConnectionStateChange,r)},t.onICETransportStateChange=r=>{var i;S.info(k(i="[p2pId: ".concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(")).call(i,r,")"))},t.onDTLSTransportStateChange=r=>{var i;S.info(k(i="[p2pId: ".concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(")).call(i,r,")"))},t.onDTLSTransportError=r=>{var i;S.info(k(i="[p2pId: ".concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(")).call(i,r,")"))},t.onFirstAudioDecoded=r=>{var i,s;const l=ft(i=Qe(wc(s=this.remoteUserMap).call(s))).call(i,h=>h._audioSSRC===r);var d;l&&((d=l.audioTrack)===null||d===void 0||d.emit(Rl.FIRST_FRAME_DECODED),At.firstRemoteFrame(this.store.sessionId,Mn.FIRST_AUDIO_DECODE,kr.FIRST_AUDIO_DECODE,{peer:l._uintid,subscribeElapse:ho.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=r=>{var i,s;const l=ft(i=Qe(wc(s=this.remoteUserMap).call(s))).call(i,d=>d._audioSSRC===r);l&&At.firstRemoteFrame(this.store.sessionId,Mn.FIRST_AUDIO_RECEIVED,kr.FIRST_AUDIO_RECEIVED,{peer:l._uintid,subscribeElapse:ho.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(r,i,s)=>{var l,d;const h=ft(l=Qe(wc(d=this.remoteUserMap).call(d))).call(l,p=>p._videoSSRC===r);h&&At.firstRemoteFrame(this.store.sessionId,Mn.FIRST_VIDEO_DECODE,kr.FIRST_VIDEO_DECODE,{peer:h._uintid,videowidth:i,videoheight:s,subscribeElapse:ho.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onFirstVideoReceived=r=>{var i,s;const l=ft(i=Qe(wc(s=this.remoteUserMap).call(s))).call(i,d=>d._videoSSRC===r);l&&At.firstRemoteFrame(this.store.sessionId,Mn.FIRST_VIDEO_RECEIVED,kr.FIRST_VIDEO_RECEIVED,{peer:l._uintid,subscribeElapse:ho.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0}filterTobeMutedTracks(t){var r,i;const s=[],l=this.getAllTracks();if(xt(l).call(l,t)===-1)return s;const d=this.localTrackMap.get(Ut.LocalAudioTrack);if(t instanceof qr&&(d==null?void 0:d.track)instanceof uo)return d.track.isActive||s.push([Ut.LocalAudioTrack,d]),s;const h=ft(r=Qe(nn(i=this.localTrackMap).call(i))).call(r,p=>{let[,{track:m}]=p;return t===m});if(h&&(s.push(h),h[0]===Ut.LocalVideoTrack)){const p=this.localTrackMap.get(Ut.LocalVideoLowTrack);p&&s.push([Ut.LocalVideoLowTrack,p])}return s}filterTobeUnmutedTracks(t){var r,i;const s=[],l=this.localTrackMap.get(Ut.LocalAudioTrack);if(t instanceof qr&&(l==null?void 0:l.track)instanceof uo)return l.track.isActive&&s.push([Ut.LocalAudioTrack,l]),s;const d=ft(r=Qe(nn(i=this.localTrackMap).call(i))).call(r,h=>{let[,{track:p}]=h;return t===p});if(d)if(d[0]===Ut.LocalVideoTrack){s.push(d);const h=this.localTrackMap.get(Ut.LocalVideoLowTrack);h&&s.push([Ut.LocalVideoLowTrack,h])}else s.push(d);return s}createMuteMessage(t){return pt(t).call(t,r=>{var i;let s,[l,{track:d,ssrcs:h,id:p}]=r;switch(l){case Ut.LocalAudioTrack:s=Kr.Audio;break;case Ut.LocalVideoTrack:s=qt(i=d._hints).call(i,Kn.SCREEN_TRACK)?Kr.Screen:Kr.High;break;case Ut.LocalVideoLowTrack:s=Kr.Low}return{stream_type:s,ssrcs:h,mid:p}})}createUnmuteMessage(t){return pt(t).call(t,r=>{var i;let s,[l,{track:d,ssrcs:h,id:p}]=r;switch(l){case Ut.LocalAudioTrack:s=Kr.Audio;break;case Ut.LocalVideoTrack:s=qt(i=d._hints).call(i,Kn.SCREEN_TRACK)?Kr.Screen:Kr.High;break;case Ut.LocalVideoLowTrack:s=Kr.Low}return{stream_type:s,ssrcs:h,mid:p}})}filterTobeUnSubscribedTracks(t,r){const i=[],s=this.remoteUserMap.get(t);if(!s)return i;if(r){const d=s.get(r);if(!d)return i;i.push([t,{kind:r,id:d}])}else{var l;V(l=Qe(nn(s).call(s))).call(l,d=>{let[h,p]=d;i.push([t,{kind:h,id:p}])})}return i}createUnsubscribeMessage(t){const r=[];return V(t).call(t,i=>{let[s,{kind:l,id:d}]=i;switch(l){case er.VIDEO:return void(s._videoSSRC&&r.push({stream_type:er.VIDEO,ssrcId:s._videoSSRC}));case er.AUDIO:return void(s._audioSSRC&&r.push({stream_type:er.AUDIO,ssrcId:s._audioSSRC}))}}),r}withdrawRemoteTracks(t){V(t).call(t,r=>{let[i,{kind:s}]=r;const l=this.remoteUserMap.get(i);l&&(l.delete(s),Qe(nn(l).call(l)).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(t){const r=this.localTrackMap.get(Ut.LocalVideoTrack),i=this.localTrackMap.get(Ut.LocalVideoLowTrack);r&&await r.track.setBitrateLimit(t.uplink),i&&t.low_stream_uplink&&await i.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(t,r){return pt(t).call(t,(i,s)=>{var l;let{stream_type:d}=i;return(l=ft(r).call(r,h=>{let{stream_type:p}=h;return d===p}))===null||l===void 0?void 0:l.attributes})}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>{var t;return Qe(nn(t=this.localTrackMap).call(t))},this.statsUploader.requestRemoteMedia=()=>{var t;return Qe(nn(t=this.remoteUserMap).call(t))},this.statsUploader.requestVideoIsReady=t=>{var r;return!((r=this.connection)===null||r===void 0||!r.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,r)=>this.emit(ze.RequestUploadStats,t,r)}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Mr(hE(this.dtlsFailedCount,Ne)),this.emit(ze.RequestReconnect)}async reconnectP2P(){var t,r;const i=Qe(nn(t=this.localTrackMap).call(t)),s=this.createGatewayUnpublishMessage(i);Qe(nn(r=this.remoteUserMap).call(r)),s.length>0&&await Ur(this,ze.RequestUnpublishForReconnectPC,s),this.disconnectForReconnect(),this.emit(ze.RequestReconnectPC)}canPublishLowStream(){var t;return this.localTrackMap.has(Ut.LocalVideoTrack)||Ss(t=this.pendingLocalTracks).call(t,r=>r instanceof cr)}throwIfTrackTypeNotMatch(t){if(kt(t).call(t,l=>l instanceof cr).length>1)throw new P(D.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(kt(t).call(t,l=>l instanceof qr).length>1&&(Ss(t).call(t,l=>l instanceof qr&&l._bypassWebAudio)||!Dr().webAudioMediaStreamDest))throw new P(D.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const l of t){var r,i,s;if(l instanceof cr&&Ss(r=this.pendingLocalTracks).call(r,d=>d instanceof cr))throw new P(D.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(l instanceof qr&&Ss(i=this.pendingLocalTracks).call(i,d=>d instanceof qr)&&(!Dr().webAudioMediaStreamDest||l._bypassWebAudio||Ss(s=this.pendingLocalTracks).call(s,d=>d instanceof qr&&d._bypassWebAudio)))throw new P(D.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,r){const i=Dr().supportDualStreamEncoding,s=Ka(Ka({},{width:160,height:120,framerate:15,bitrate:50}),r);let l;l=i?t._mediaStreamTrack.clone():Jw(t,s);const d=new cr(l,Ka(Ka({},i&&{scaleResolutionDownBy:O8(s,t)}),{},{frameRate:s.framerate,bitrateMax:s.bitrate,bitrateMin:s.bitrate}));return d._hints.push(Kn.LOW_STREAM),d}}function as(e,t,r){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const s=this.mutex,l=await s.lock("From P2PChannel.".concat(t));try{for(var d=arguments.length,h=new Array(d),p=0;p<d;p++)h[p]=arguments[p];return await i.apply(this,h)}finally{l()}},r}ss([as,Ar("design:type",Function),Ar("design:paramtypes",[Object]),Ar("design:returntype",ct)],xo.prototype,"startP2PConnection",null),ss([as,Ar("design:type",Function),Ar("design:paramtypes",[Object,Object,Array,Object,String,String,String,String]),Ar("design:returntype",ct)],xo.prototype,"connect",null),ss([as,Ar("design:type",Function),Ar("design:paramtypes",[Array]),Ar("design:returntype",ct)],xo.prototype,"unpublish",null),ss([as,Ar("design:type",Function),Ar("design:paramtypes",[]),Ar("design:returntype",ct)],xo.prototype,"unpublishLowStream",null),ss([as,Ar("design:type",Function),Ar("design:paramtypes",[Yl,String,Number,Array]),Ar("design:returntype",ct)],xo.prototype,"subscribe",null),ss([as,Ar("design:type",Function),Ar("design:paramtypes",[Yl,String]),Ar("design:returntype",ct)],xo.prototype,"unsubscribe",null),ss([as,Ar("design:type",Function),Ar("design:paramtypes",[Yl,String]),Ar("design:returntype",ct)],xo.prototype,"muteRemote",null),ss([as,Ar("design:type",Function),Ar("design:paramtypes",[Yl,String]),Ar("design:returntype",ct)],xo.prototype,"unmuteRemote",null),ss([as,Ar("design:type",Function),Ar("design:paramtypes",[]),Ar("design:returntype",ct)],xo.prototype,"disconnectForReconnect",null),ss([as,Ar("design:type",Function),Ar("design:paramtypes",[]),Ar("design:returntype",ct)],xo.prototype,"reEstablish",null),ss([as,Ar("design:type",Function),Ar("design:paramtypes",[Object]),Ar("design:returntype",ct)],xo.prototype,"updateBitrateLimit",null);var P7=io,rb=Jh,B7=jC;Ae({target:"Object",stat:!0,forced:u(function(){rb(1)}),sham:!B7},{getPrototypeOf:function(e){return rb(P7(e))}});var I_=Ir.Object.getPrototypeOf;function Fo(e){return"Minified Redux error #"+e+"; visit https://redux.js.org/Errors?code="+e+" for the full message or use the non-minified dev environment for full errors. "}var Er,nb=typeof RA=="function"&&RA.observable||"@@observable",v_=function(){return Math.random().toString(36).substring(7).split("").join(".")},ib={INIT:"@@redux/INIT"+v_(),REPLACE:"@@redux/REPLACE"+v_(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+v_()}};function M7(e){if(typeof e!="object"||e===null)return!1;for(var t=e;I_(t)!==null;)t=I_(t);return I_(e)===t}function ob(e,t,r){var i;if(typeof t=="function"&&typeof r=="function"||typeof r=="function"&&typeof arguments[3]=="function")throw new Error(Fo(0));if(typeof t=="function"&&r===void 0&&(r=t,t=void 0),r!==void 0){if(typeof r!="function")throw new Error(Fo(1));return r(ob)(e,t)}if(typeof e!="function")throw new Error(Fo(2));var s=e,l=t,d=[],h=d,p=!1;function m(){h===d&&(h=rn(d).call(d))}function f(){if(p)throw new Error(Fo(3));return l}function _(w){if(typeof w!="function")throw new Error(Fo(4));if(p)throw new Error(Fo(5));var O=!0;return m(),h.push(w),function(){if(O){if(p)throw new Error(Fo(6));O=!1,m();var B=xt(h).call(h,w);Ye(h).call(h,B,1),d=null}}}function v(w){if(!M7(w))throw new Error(Fo(7));if(w.type===void 0)throw new Error(Fo(8));if(p)throw new Error(Fo(9));try{p=!0,l=s(l,w)}finally{p=!1}for(var O=d=h,B=0;B<O.length;B++)(0,O[B])();return w}function T(w){if(typeof w!="function")throw new Error(Fo(10));s=w,v({type:ib.REPLACE})}function R(){var w,O=_;return(w={subscribe:function(B){if(typeof B!="object"||B===null)throw new Error(Fo(11));function K(){B.next&&B.next(f())}return K(),{unsubscribe:O(K)}}})[nb]=function(){return this},w}return v({type:ib.INIT}),(i={dispatch:v,subscribe:_,getState:f,replaceReducer:T})[nb]=R,i}function sb(e,t){var r=ae(e);if(Xt){var i=Xt(e);t&&(i=kt(i).call(i,function(s){return jt(e,s).enumerable})),r.push.apply(r,i)}return r}function Jt(e){for(var t=1;t<arguments.length;t++){var r,i,s=arguments[t]!=null?arguments[t]:{};t%2?V(r=sb(Object(s),!0)).call(r,function(l){mr(e,l,s[l])}):Zt?ur(e,Zt(s)):V(i=sb(Object(s))).call(i,function(l){ie(e,l,jt(s,l))})}return e}(function(e){e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_UID="SET_UID",e.SET_PUB_ID="SET_PUB_ID",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE"})(Er||(Er={}));class U7{constructor(t,r,i){const s={codec:t,mode:r,clientId:i,sessionId:null,p2pId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[]}};this.reducer=function(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:s,d=arguments.length>1?arguments[1]:void 0;switch(d.type){case Er.SET_SESSION_ID:return Jt(Jt({},l),{},{sessionId:d.sessionId});case Er.SET_P2P_ID:return Jt(Jt({},l),{},{p2pId:d.p2pId});case Er.SET_UID:return Jt(Jt({},l),{},{uid:d.uid});case Er.SET_PUB_ID:return Jt(Jt({},l),{},{pubId:d.pubId});case Er.KEY_METRIC_CLIENT_CREATED:return Jt(Jt({},l),{},{keyMetrics:Jt(Jt({},l.keyMetrics),{},{clientCreated:d.metric})});case Er.KEY_METRIC_JOIN_START:return Jt(Jt({},l),{},{keyMetrics:Jt(Jt({},l.keyMetrics),{},{joinStart:d.metric})});case Er.KEY_METRIC_JOIN_END:return Jt(Jt({},l),{},{keyMetrics:Jt(Jt({},l.keyMetrics),{},{joinEnd:d.metric})});case Er.KEY_METRIC_REQUEST_AP_START:return Jt(Jt({},l),{},{keyMetrics:Jt(Jt({},l.keyMetrics),{},{requestAPStart:d.metric})});case Er.KEY_METRIC_REQUEST_AP_END:return Jt(Jt({},l),{},{keyMetrics:Jt(Jt({},l.keyMetrics),{},{requestAPEnd:d.metric})});case Er.KEY_METRIC_JOIN_GATEWAY_START:return Jt(Jt({},l),{},{keyMetrics:Jt(Jt({},l.keyMetrics),{},{joinGatewayStart:d.metric})});case Er.KEY_METRIC_JOIN_GATEWAY_END:return Jt(Jt({},l),{},{keyMetrics:Jt(Jt({},l.keyMetrics),{},{joinGatewayEnd:d.metric})});case Er.KEY_METRIC_PEER_CONNECTION_START:return Jt(Jt({},l),{},{keyMetrics:Jt(Jt({},l.keyMetrics),{},{peerConnectionStart:d.metric})});case Er.KEY_METRIC_PEER_CONNECTION_END:return Jt(Jt({},l),{},{keyMetrics:Jt(Jt({},l.keyMetrics),{},{peerConnectionEnd:d.metric})});case Er.KEY_METRIC_PUBLISH:{const h=l.keyMetrics.publish,p=Yn(h).call(h,m=>m.trackId===d.metric.trackId);return p!==-1?(h[p]=Jt(Jt({},h[p]),d.metric),Jt(Jt({},l),{},{keyMetrics:Jt(Jt({},l.keyMetrics),{},{publish:[...h]})})):Jt(Jt({},l),{},{keyMetrics:Jt(Jt({},l.keyMetrics),{},{publish:[...l.keyMetrics.publish,d.metric]})})}case Er.KEY_METRIC_SUBSCRIBE:{const h=l.keyMetrics.subscribe,p=Yn(h).call(h,m=>m.userId===d.metric.userId&&m.type===d.metric.type);return p!==-1?(h[p]=Jt(Jt({},h[p]),d.metric),Jt(Jt({},l),{},{keyMetrics:Jt(Jt({},l.keyMetrics),{},{subscribe:[...h]})})):Jt(Jt({},l),{},{keyMetrics:Jt(Jt({},l.keyMetrics),{},{subscribe:[...l.keyMetrics.subscribe,d.metric]})})}default:return l}},this.store=ob(this.reducer)}set sessionId(t){this.store.dispatch({type:Er.SET_SESSION_ID,sessionId:t})}get sessionId(){return this.store.getState().sessionId}get codec(){return this.store.getState().codec}get clientId(){return this.store.getState().clientId}set p2pId(t){this.store.dispatch({type:Er.SET_P2P_ID,p2pId:t})}get p2pId(){return this.store.getState().p2pId}set uid(t){this.store.dispatch({type:Er.SET_UID,uid:t})}get uid(){return this.store.getState().uid}set pubId(t){this.store.dispatch({type:Er.SET_PUB_ID,pubId:t})}get pubId(){return this.store.getState().pubId}clientCreated(){this.store.dispatch({type:Er.KEY_METRIC_CLIENT_CREATED,metric:performance.now()})}joinStart(){this.store.dispatch({type:Er.KEY_METRIC_JOIN_START,metric:performance.now()})}joinEnd(){this.store.dispatch({type:Er.KEY_METRIC_JOIN_END,metric:performance.now()})}requestAPStart(){this.store.dispatch({type:Er.KEY_METRIC_REQUEST_AP_START,metric:performance.now()})}requestAPEnd(){this.store.dispatch({type:Er.KEY_METRIC_REQUEST_AP_END,metric:performance.now()})}joinGatewayStart(){this.store.dispatch({type:Er.KEY_METRIC_JOIN_GATEWAY_START,metric:performance.now()})}joinGatewayEnd(){this.store.dispatch({type:Er.KEY_METRIC_JOIN_GATEWAY_END,metric:performance.now()})}peerConnectionStart(){this.store.dispatch({type:Er.KEY_METRIC_PEER_CONNECTION_START,metric:performance.now()})}peerConnectionEnd(){this.store.dispatch({type:Er.KEY_METRIC_PEER_CONNECTION_END,metric:performance.now()})}publish(t,r,i,s){this.store.dispatch({type:Er.KEY_METRIC_PUBLISH,metric:Jt(Jt({trackId:t,type:r},i&&{publishStart:i}),s&&{publishEnd:s})})}subscribe(t,r,i,s,l){this.store.dispatch({type:Er.KEY_METRIC_SUBSCRIBE,metric:Jt(Jt(Jt({userId:t,type:r},i&&{subscribeStart:i}),s&&{subscribeEnd:s}),l&&{firstFrame:l})})}get keyMetrics(){return this.store.getState().keyMetrics}}let OA;const ab=()=>(OA||OA||(OA=(window.location.protocol.split(":")[0]||"").toUpperCase(),OA))==="HTTPS",kA=()=>window.isSecureContext!==void 0;class x7{constructor(t,r){var i;this.name=t,this.time=performance.now(),this.sequence=xt(i=cV[r]).call(i,t)}setElapse(t){this.elapse=t}}const F7=new $t;function cb(e,t){const r=new Q7(e,t);return F7.set(e,r),r}class Q7{constructor(t,r){this.records=[],this._id=t,this._group=r,this._localTimeStamp=ht(),this._performanceTimeStamp=performance.now()}checkPoint(t){var r;const i=new x7(t,this._group);i.sequence===-1&&S.warning("[".concat(this._id,"] check point record failed, cannot get the sequence")),this.records.push(i);const s=ft(r=this.records).call(r,l=>l.sequence===i.sequence-1);s&&i.setElapse(i.time-s.time)}getRecord(t){var r;return ft(r=this.records).call(r,i=>i&&i.name===t)}resetRecords(){this.records.length=0}}function lb(e,t){var r=ae(e);if(Xt){var i=Xt(e);t&&(i=kt(i).call(i,function(s){return jt(e,s).enumerable})),r.push.apply(r,i)}return r}function Jl(e){for(var t=1;t<arguments.length;t++){var r,i,s=arguments[t]!=null?arguments[t]:{};t%2?V(r=lb(Object(s),!0)).call(r,function(l){mr(e,l,s[l])}):Zt?ur(e,Zt(s)):V(i=lb(Object(s))).call(i,function(l){ie(e,l,jt(s,l))})}return e}var we,yi,DA,zl,db,LA,Du=function(e,t,r,i){var s,l=arguments.length,d=l<3?t:i===null?i=jt(t,r):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(e,t,r,i);else for(var h=e.length-1;h>=0;h--)(s=e[h])&&(d=(l<3?s(d):l>3?s(t,r,d):s(t,r))||d);return l>3&&d&&ie(t,r,d),d},wi=function(e,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(e,t)};class Xl extends Wr{constructor(t){var r,i,s,l;let d;if(super(),this._users=[],this._sessionId=null,this._leaveMutex=new wn("client-leave"),this._publishMutex=new wn("client-publish"),this._renewTokenMutex=new wn("client-renewtoken"),this._subscribeMutex=new $t,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._turnServer={servers:[],mode:"auto"},this._cloudProxyServerMode="disabled",this._isDualStreamEnabled=!1,this._streamFallbackTypeCacheMap=new $t,this._remoteStreamTypeCacheMap=new $t,this._axiosCancelSource=wo.CancelToken.source(),this._networkQualitySensitivity="normal",this._useLocalAccessPoint=!1,this._joinAndNotLeaveYet=!1,this._handleLocalTrackEnable=(p,m,f)=>{this.publish(p,!1).then(m).catch(f)},this._handleLocalTrackDisable=(p,m,f)=>{this.unpublish(p,!1).then(m).catch(f)},this._handleUserOnline=p=>{var m;this.isStringUID&&typeof p.uid!="string"&&S.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const f=ft(m=this._users).call(m,_=>_.uid===p.uid);if(f)f._trust_in_room_=!0;else{const _=new Yl(p.uid,p.uint_id||p.uid);this._users.push(_),S.debug("[".concat(this._clientId,"] user online"),p.uid),this.emit(Ve.USER_JOINED,_)}},this._handleUserOffline=p=>{var m;const f=ft(m=this._users).call(m,_=>_.uid===p.uid);f&&(this._handleRemoveStream(p),na(this._users,f),this._remoteStreamTypeCacheMap.delete(f.uid),this._streamFallbackTypeCacheMap.delete(f.uid),S.debug("[".concat(this._clientId,"] user offline"),p.uid,"reason:",p.reason),this.emit(Ve.USER_LEAVED,f,p.reason))},this._handleAddAudioOrVideoStream=(p,m,f,_,v,T)=>{var R,w,O;const B=ft(R=this._users).call(R,It=>It.uid===m);if(!B)return void S.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));S.debug(k(w=k(O="[".concat(this._clientId,"] stream added with uid ")).call(O,m,", type ")).call(w,p));const K=p==="audio"?B.hasAudio:B.hasVideo;var j,nt;B._uintid||(B._uintid=v||m),B._trust_stream_added_state_=!0,p==="audio"?(B._audio_added_=!0,f!==void 0&&(B._audioSSRC=f),_!==void 0&&(B._cname=_),T&&(B._audioOrtc=T)):(B._video_added_=!0,f!==void 0&&(B._videoSSRC=f),_!==void 0&&(B._cname=_),T&&(B._videoOrtc=T)),(p==="audio"?B.hasAudio:B.hasVideo)&&!K&&(S.info(k(j=k(nt="[".concat(this._clientId,"] remote user ")).call(nt,B.uid," published ")).call(j,p)),this.emit(Ve.USER_PUBLISHED,B,p)),p==="video"?At.onGatewayStream(this._sessionId,Mn.ON_ADD_VIDEO_STREAM,kr.ON_ADD_VIDEO_STREAM,{peer:v||m}):At.onGatewayStream(this._sessionId,Mn.ON_ADD_AUDIO_STREAM,kr.ON_ADD_AUDIO_STREAM,{peer:v||m}),this._p2pChannel.hasPendingRemoteMedia(B,p)&&this.subscribe(B,p).catch(It=>{S.error("[".concat(this._clientId,"] resubscribe error"),It.toString())})},this._handleRemoveStream=async p=>{var m,f;const _=ft(m=this._users).call(m,R=>R.uid===p.uid);if(!_)return void S.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));S.debug(k(f="[".concat(this._clientId,"] stream removed with uid ")).call(f,p.uid));let v=()=>{};_.hasAudio&&_.hasVideo?v=()=>{var R,w;S.info(k(R="[".concat(this._clientId,"] remote user ")).call(R,_.uid," unpublished audio track")),this.emit(Ve.USER_UNPUBLISHED,_,"audio"),S.info(k(w="[".concat(this._clientId,"] remote user ")).call(w,_.uid," unpublished video track")),this.emit(Ve.USER_UNPUBLISHED,_,"video")}:_.hasVideo?v=()=>{var R;S.info(k(R="[".concat(this._clientId,"] remote user ")).call(R,_.uid," unpublished video track")),this.emit(Ve.USER_UNPUBLISHED,_,"video")}:_.hasAudio&&(v=()=>{var R;S.info(k(R="[".concat(this._clientId,"] remote user ")).call(R,_.uid," unpublished audio track")),this.emit(Ve.USER_UNPUBLISHED,_,"audio")}),_._trust_stream_added_state_=!0,_._audio_added_=!1,_._video_added_=!1;const T=await this._p2pChannel.unsubscribe(_);T&&await this._gateway.unsubscribe(T,_.uid),_._audioSSRC=void 0,_._videoSSRC=void 0,_._audioOrtc=void 0,_._videoOrtc=void 0,At.onGatewayStream(this._sessionId,Mn.ON_REMOVE_STREAM,kr.ON_REMOVE_STREAM,{peer:p.uint_id||p.uid}),v()},this._handleSetStreamLocalEnable=async(p,m,f)=>{var _,v,T,R;const w=ft(_=this._users).call(_,H=>H.uid===m);if(!w)return void S.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));S.debug(k(v=k(T=k(R="[".concat(this._clientId,"] local ")).call(R,p," ")).call(T,f?"enabled":"disabled"," with uid ")).call(v,m));const O=p==="audio"?w.hasAudio:w.hasVideo;if(p==="audio"){w._trust_audio_enabled_state_=!0;const H=w._audio_enabled_;if(w._audio_enabled_=f,w._audio_enabled_===H)return;{var B,K;const W=w._audio_enabled_?"enable-local-audio":"disable-local-audio";S.debug(k(B=k(K="[".concat(this._clientId,"] user-info-updated, uid: ")).call(K,m,", msg: ")).call(B,W)),this.emit(Ve.USER_INFO_UPDATED,m,W)}}else{w._trust_video_enabled_state_=!0;const H=w._video_enabled_;if(w._video_enabled_=f,w._video_enabled_===H)return;{var j,nt;const W=w._video_enabled_?"enable-local-video":"disable-local-video";S.debug(k(j=k(nt="[".concat(this._clientId,"] user-info-update, uid: ")).call(nt,m,", msg: ")).call(j,W)),this.emit(Ve.USER_INFO_UPDATED,m,W)}}const It=p==="audio"?w.hasAudio:w.hasVideo;var vt,Rt,X,rt;return O!==It?!O&&It?(S.info(k(vt=k(Rt="[".concat(this._clientId,"] remote user ")).call(Rt,m," published ")).call(vt,p)),void this.emit(Ve.USER_PUBLISHED,w,p)):(p==="video"&&w._videoTrack&&w._videoTrack._destroy(),p==="audio"&&w._audioTrack,await this._p2pChannel.muteRemote(w,p),S.info(k(X=k(rt="[".concat(this._clientId,"] remote user ")).call(rt,m," unpublished ")).call(X,p)),void this.emit(Ve.USER_UNPUBLISHED,w,p)):void 0},this._handleMuteStream=async(p,m,f)=>{var _;S.debug("[".concat(this._clientId,"] receive mute message"),p,m,f);const v=ft(_=this._users).call(_,X=>X.uid===p);var T;if(!v)return void S.warning(k(T="[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ")).call(T,p));const R=m==="audio"?v.hasAudio:v.hasVideo;if(m==="audio"){v._trust_audio_mute_state_=!0;const X=v._audio_muted_;if(v._audio_muted_=f,v._audio_muted_===X)return;{var w,O;const rt=v._audio_muted_?"mute-audio":"unmute-audio";S.debug(k(w=k(O="[".concat(this._clientId,"] user-info-update, uid: ")).call(O,p,", msg: ")).call(w,rt)),this.emit(Ve.USER_INFO_UPDATED,p,rt)}}else{v._trust_video_mute_state_=!0;const X=v._video_muted_;if(v._video_muted_=f,v._video_muted_===X)return;{var B,K;const rt=v._video_muted_?"mute-video":"unmute-video";S.debug(k(B=k(K="[".concat(this._clientId,"] user-info-update, uid: ")).call(K,p,", msg: ")).call(B,rt)),this.emit(Ve.USER_INFO_UPDATED,p,rt)}}const j=m==="audio"?v.hasAudio:v.hasVideo;var nt,It,vt,Rt;return R!==j?!R&&j?(S.info(k(nt=k(It="[".concat(this._clientId,"] remote user ")).call(It,p," published ")).call(nt,m)),void this.emit(Ve.USER_PUBLISHED,v,m)):(m==="video"&&v._videoTrack&&v._videoTrack._destroy(),m==="audio"&&v._audioTrack,await this._p2pChannel.muteRemote(v,m),S.info(k(vt=k(Rt="[".concat(this._clientId,"] remote user ")).call(Rt,p," unpublished ")).call(vt,m)),void this.emit(Ve.USER_UNPUBLISHED,v,m)):void 0},this._handleP2PLost=async p=>{S.debug("[".concat(this._clientId,"] receive p2p lost"),p),Tr(p.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():S.warning("P2PLost stream not found",p)},this._handleTokenWillExpire=()=>{S.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.emit(Ve.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)},this._handleBeforeUnload=p=>{p.type==="beforeunload"&&p.returnValue!==void 0&&p.returnValue!==""||(this.leave(),S.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))},this._handleUpdateNetworkQuality=()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.emit(Ve.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const p={downlinkNetworkQuality:0,uplinkNetworkQuality:0};p.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),p.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.emit(Ve.NETWORK_QUALITY,p)},this._codec=t.codec,this._mode=t.mode,t.proxyServer&&(this._proxyServer=t.proxyServer,At.setProxyServer(this._proxyServer),S.setProxyServer(this._proxyServer)),t.turnServer&&(this._turnServer=Jl(Jl({},this._turnServer),{},{mode:"manual"},t.turnServer)),this._clientId=Pe(5,"client-"),this.store=new U7(t.codec,t.mode,this._clientId),this.store.clientCreated(),S.info(k(r=k(i=k(s=k(l="[".concat(this._clientId,"] Initializing AgoraRTC client v")).call(l,Tn," build: ")).call(s,vl,", mode: ")).call(i,this._mode,", codec: ")).call(r,this._codec)),this._performanceRecorder=cb(this._clientId,"join"),t.clientRoleOptions)try{OR(t.clientRoleOptions),d=hr({},t.clientRoleOptions)}catch(p){var h;S.warning(k(h="[".concat(this._clientId,"] ")).call(h,p.toString()))}this._statsCollector=new Ll(this.store),this._statsCollector.onStatsException=(p,m,f)=>{var _,v,T;S.debug(k(_=k(v=k(T="[".concat(this._clientId,"] receive exception msg, code: ")).call(T,p,", msg: ")).call(v,m,", uid: ")).call(_,f)),this.emit(Ve.EXCEPTION,{code:p,msg:m,uid:f})},this._statsCollector.onUploadPublishDuration=(p,m,f,_)=>{var v;const T=ft(v=this._users).call(v,R=>R.uid===p);T&&At.peerPublishStatus(this._sessionId,{subscribeElapse:_,audioPublishDuration:m,videoPublishDuration:f,peer:T._uintid})},this._gateway=new B6(this.store,{clientId:this._clientId,mode:this._mode,codec:this._codec,websocketRetryConfig:t.websocketRetryConfig||Ne,httpRetryConfig:t.httpRetryConfig||Ne,forceWaitGatewayResponse:t.forceWaitGatewayResponse===void 0||t.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:t.role,clientRoleOptions:d}),this._config=t,this._configDistribute=new iw,this._p2pChannel=new xo(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents()}get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}async join(t,r,i,s,l){var d;this._performanceRecorder.checkPoint("startJoin"),this.store.joinStart();const h=ab(),p=kA()?window.isSecureContext:"Browser Not Support",m=()=>{S.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser")};kA()?window.isSecureContext||m():h||m();const f=At.reportApiInvoke(this._sessionId,{name:Ht.JOIN,options:[t,r,i,s],states:{isHttps:h,isSecureContext:p},tag:Wt.TRACER});try{if(!i&&i!==null)throw new P(D.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&pr(i,"token",1,2047),pr(t,"appid",1,2047),wp(r),s&&bp(s),l&&pr(l,"optionalInfo",1,2047)}catch(w){throw f.onError(w),w}if(S.info(k(d="[".concat(this._clientId,"] start join channel ")).call(d,r)),this._leaveMutex.isLocked&&(S.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),S.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const w=new P(D.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw f.onError(w),w}this._sessionId||(this._sessionId=Hp(),this.store.sessionId=this._sessionId),this._gateway.state="CONNECTING";const _={clientId:this._clientId,appId:t,sid:this._sessionId,cname:r,uid:typeof s!="string"?s:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:i||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:l,useLocalAccessPoint:this._useLocalAccessPoint};if(typeof s=="string"&&(_.stringUid=s,this._uintUid?(_.uid=this._uintUid,this._uintUid=void 0):_.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(_.aesmode=this._encryptionMode,_.aespassword=await wy(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new P(D.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(_.aessalt=this._encryptionSalt)}this._startSession(this._sessionId,{channel:r,appId:t}),ar(()=>{this.connectionState==="CONNECTING"&&At.joinChannelTimeout(this._sessionId,5)},5e3);try{var v;let w;if(_.cloudProxyServer==="443only")_.proxyServer=it("PROXY_SERVER_TYPE2");else if(_.cloudProxyServer==="proxy3"||_.cloudProxyServer==="proxy4"||_.cloudProxyServer==="proxy5"){const B=it("PROXY_SERVER_TYPE3");tn(B)?_.proxyServer=B[0]:_.proxyServer=B}if(At.setProxyServer(_.proxyServer),S.setProxyServer(_.proxyServer),this._performanceRecorder.checkPoint("startRequestAp"),this.store.requestAPStart(),_.stringUid&&!_.uid&&_.cloudProxyServer==="normal"){var T;await s_(_,this._axiosCancelSource.token,this._config.httpRetryConfig||Ne,!1);const B=await a_(_.stringUid,_,this._axiosCancelSource.token,this._config.httpRetryConfig||Ne);S.debug(k(T="getUserAccount Success ".concat(_.stringUid," => ")).call(T,B)),_.uid=B,w=await wu(_,this._axiosCancelSource.token,this._config.httpRetryConfig||Ne)}else if(_.stringUid&&!_.uid){var R;const B=await a_(_.stringUid,_,this._axiosCancelSource.token,this._config.httpRetryConfig||Ne);S.debug(k(R="getUserAccount Success ".concat(_.stringUid," => ")).call(R,B)),_.uid=B,w=await s_(_,this._axiosCancelSource.token,this._config.httpRetryConfig||Ne,!0)}else w=await s_(_,this._axiosCancelSource.token,this._config.httpRetryConfig||Ne,!0);if(!this._joinAndNotLeaveYet)throw new P(D.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this.store.requestAPEnd(),this._performanceRecorder.checkPoint("startJoinGateway"),this._configDistribute.startGetConfigDistribute(_,this._axiosCancelSource.token),this._configDistribute.on(au.UPDATE_BITRATE_LIMIT,B=>{this._p2pChannel.updateBitrateLimit(B)}),this._key=i||t,this._joinInfo=Jl(Jl({},_),{},{cid:w.gatewayInfo.cid,uid:_.uid?_.uid:w.gatewayInfo.uid,vid:w.gatewayInfo.vid,apResponse:w.gatewayInfo.res,uni_lbs_ip:w.gatewayInfo.uni_lbs_ip,gatewayAddrs:w.gatewayInfo.gatewayAddrs});const O=await this._gateway.join(this._joinInfo,this._key);if(!this._joinAndNotLeaveYet)throw new P(D.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));return f.onSuccess(O),this._appId=t,this._channelName=_.cname,this._uid=O,this.store.uid=O,this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=be(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Ri()?"beforeunload":"pagehide",this._handleBeforeUnload),S.info(k(v="[".concat(this._clientId,"] Joining channel success: ")).call(v,r)),ar(()=>{S.startUpload()},5e3),this._performanceRecorder.checkPoint("finishJoin"),this.store.joinEnd(),aR(this),O}catch(w){const O=tn(w)?w[0]:w;throw S.error("[".concat(this._clientId,"] Joining channel failed, rollback"),O),O.code!==D.OPERATION_ABORTED&&(this._gateway.state="DISCONNECTED",this._reset()),f.onError(O),O}}async leave(){const t=At.reportApiInvoke(this._sessionId,{name:Ht.LEAVE,options:[],tag:Wt.TRACER});S.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Ri()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),cR(this);const r=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return S.info("[".concat(this._clientId,"] Leaving channel repeated, success")),r(),t.onSuccess();await this._gateway.leave(this.connectionState!=="CONNECTED"),S.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,r(),t.onSuccess()}async publish(t){var r;let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];tn(t)||(t=[t]);const s=At.reportApiInvoke(this._sessionId,{name:Ht.PUBLISH,options:pt(t).call(t,h=>h?Object(h).toString():"null"),tag:Wt.TRACER});if(t.length===0){const h=new P(D.INVALID_PARAMS,"track list is empty");return s.onError(h),h.throw()}if(this._gateway.role==="audience"){const h=new P(D.INVALID_OPERATION,"audience can not publish stream");return s.onError(h),h.throw()}for(const h of t){if(!(h instanceof ra)){const p=new P(D.INVALID_PARAMS,"parameter is not local track");return s.onError(p),p.throw()}if(!h._enabled&&i){const p=new P(D.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(h.getTrackId()));return s.onError(p),p.throw()}}S.info(k(r="[".concat(this._clientId,"] Publishing tracks, id ")).call(r,pt(t).call(t,h=>"".concat(h.getTrackId()," ")))),await this._configDistribute.awaitConfigDistributeComplete(),i&&V(t).call(t,h=>{const p=this._configDistribute.getBitrateLimit();h instanceof cr&&p&&h.setBitrateLimit(p.uplink)});const l=await this._publishMutex.lock();try{var d;await this._publishHighStream(t),s.onSuccess(pt(t).call(t,h=>h.trackMediaType+":"+h.getTrackLabel()).toString()),S.info(k(d="[".concat(this._clientId,"] Publish success, id ")).call(d,pt(t).call(t,h=>"".concat(h.getTrackId()," "))))}catch(h){throw s.onError(h),S.error("[".concat(this._clientId,"] publish error"),h.toString()),h}finally{l()}}async unpublish(t){var r;if(!this._joinInfo||this._uid===void 0)throw new P(D.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");t?tn(t)||(t=[t]):t=this._p2pChannel.getAllTracks();const i=At.reportApiInvoke(this._sessionId,{name:Ht.UNPUBLISH,options:pt(t).call(t,d=>d.getTrackId()),tag:Wt.TRACER});S.info(k(r="[".concat(this._clientId,"] Unpublish tracks, tracks ")).call(r,pt(t).call(t,d=>"".concat(d.getTrackId()," "))," "));const s=await this._publishMutex.lock();try{var l;const d=await this._p2pChannel.unpublish(t);d&&await this._gateway.unpublish(d,this._uid),S.info(k(l="[".concat(this._clientId,"] Unpublish success,tracks ")).call(l,pt(t).call(t,h=>"".concat(h.getTrackId())))),i.onSuccess()}catch(d){throw i.onError(d),S.error("[".concat(this._clientId,"] unpublish error"),d.toString()),d}finally{s&&s()}}async subscribe(t,r){var i,s,l;Pr(r,"mediaType",["audio","video"]);const d=At.reportApiInvoke(this._sessionId,{name:Ht.SUBSCRIBE,options:[t.uid,r],tag:Wt.TRACER});if(!this._joinInfo){const j=new P(D.INVALID_OPERATION,"Can't subscribe stream, not joined");throw d.onError(j),j}if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING"){const j=new P(D.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));throw d.onError(j),j}if(!ft(i=this._users).call(i,j=>j===t)){var h;const j=new P(D.INVALID_REMOTE_USER,"user is not in the channel");throw S.error(k(h="[".concat(this._clientId,"] can not subscribe ")).call(h,t.uid,", this user is not in the channel")),d.onError(j),j}if(!t.hasAudio&&!t.hasVideo){var p;const j=new P(D.INVALID_REMOTE_USER,"user is not published");throw S.error(k(p="[".concat(this._clientId,"] can not subscribe ")).call(p,t.uid,", user is not published")),d.onError(j),j}if(r==="audio"&&(!t.hasAudio||t._audioSSRC===void 0)||r==="video"&&(!t.hasVideo||t._videoSSRC===void 0)){var m,f;const j=new P(D.REMOTE_USER_IS_NOT_PUBLISHED);throw S.error(k(m=k(f="[".concat(this._clientId,"] can not subscribe ")).call(f,t.uid," with mediaType ")).call(m,r,", remote track is not published")),d.onError(j),j}const _=r==="audio"?t._audioSSRC:t._videoSSRC,v=r==="audio"?t._audioOrtc:t._videoOrtc,T={stream_type:r==="audio"?er.AUDIO:er.VIDEO,ssrcId:_};let R=this._subscribeMutex.get(t.uid);R||(R=new wn("sub-".concat(t.uid)),this._subscribeMutex.set(t.uid,R)),S.info(k(s=k(l="[".concat(this._clientId,"] subscribe user ")).call(l,t.uid,", mediaType: ")).call(s,r));const w=await R.lock();try{var O,B;if(this._p2pChannel.hasRemoteMedia(t,r))await this._p2pChannel.unmuteRemote(t,r);else try{ho.markSubscribeStart(this.store.clientId,_),this.store.subscribe(t.uid,r,performance.now()),await this._p2pChannel.subscribe(t,r,_,v),await this._gateway.subscribe(t.uid,T,!0),this.store.subscribe(t.uid,r,void 0,performance.now()),this._p2pChannel.reportSubscribeEvent(!0,null,t,r)}catch(nt){if(this._p2pChannel.reportSubscribeEvent(!1,nt==null?void 0:nt.code,t,r),(nt==null?void 0:nt.code)!==D.WS_ABORT)throw nt;this._p2pChannel.setPendingRemoteMedia(t,r)}S.info(k(O=k(B="[".concat(this._clientId,"] subscribe success user ")).call(B,t.uid,", mediaType: ")).call(O,r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(nt=>{S.warning("[".concat(this._clientId,"] auto set fallback failed"),nt)});const j=r==="audio"?t._audioTrack:t._videoTrack;if(!j){const nt=new P(D.UNEXPECTED_ERROR,"can not find remote track in user object");return d.onError(nt),nt.throw()}return d.onSuccess(j.getTrackId()),j}catch(j){var K;throw d.onError(j),S.error(k(K="[".concat(this._clientId,"] subscribe user ")).call(K,t.uid," error"),j),j}finally{w()}}async unsubscribe(t,r){var i,s,l;if(r&&Pr(r,"mediaType",["audio","video"]),!this._joinInfo)throw new P(D.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");const d=At.reportApiInvoke(this._sessionId,{name:Ht.UNSUBSCRIBE,options:[t.uid,r],tag:Wt.TRACER});if(!ft(i=this._users).call(i,T=>T===t)){var h;const T=new P(D.INVALID_REMOTE_USER,"user is not in the channel");throw S.error(k(h="[".concat(this._clientId,"] can not subscribe ")).call(h,t.uid,", user is not in the channel")),d.onError(T),T}S.info(k(s=k(l="[".concat(this._clientId,"] unsubscribe uid: ")).call(l,t.uid,", mediaType: ")).call(s,r));let p=this._subscribeMutex.get(t.uid);p||(p=new wn("sub-".concat(t.uid)),this._subscribeMutex.set(t.uid,p));const m=await p.lock();try{var f,_;const T=await this._p2pChannel.unsubscribe(t,r);T&&await this._gateway.unsubscribe(T,t.uid),S.info(k(f=k(_="[".concat(this._clientId,"] unsubscribe success uid: ")).call(_,t.uid,", mediaType: ")).call(f,r)),d.onSuccess()}catch(T){if(T.code===D.DISCONNECT_P2P)return void S.warning("disconnecting p2p, abort unsubscribe request.");var v;throw S.error(k(v="[".concat(this._clientId,"] unsubscribe user ")).call(v,t.uid," error"),T.toString()),T}finally{m()}}setLowStreamParameter(t){(function(s){if(!s)throw new P(D.INVALID_PARAMS);$e(s.width)||Ie(s.width,"streamParameter.width"),$e(s.height)||Ie(s.height,"streamParameter.height"),$e(s.framerate)||Ie(s.framerate,"streamParameter.framerate"),$e(s.bitrate)||Ie(s.bitrate,"streamParameter.bitrate")})(t);const r=At.reportApiInvoke(this._sessionId,{name:Ht.SET_LOW_STREAM_PARAMETER,options:[t],tag:Wt.TRACER});(!t.width&&t.height||t.width&&!t.height)&&S.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),S.info("[".concat(this._clientId,"] set low stream parameter to"),St(t));const i=this._configDistribute.getLowStreamConfigDistribute();i&&i.bitrate&&t.bitrate&&i.bitrate<t.bitrate&&(t.bitrate=i.bitrate),this._lowStreamParameter=t,r.onSuccess()}async enableDualStream(){const t=At.reportApiInvoke(this._sessionId,{name:Ht.ENABLE_DUAL_STREAM,options:[],tag:Wt.TRACER});if(!Dr().supportDualStream){At.streamSwitch(this._sessionId,{lts:ht(),isdual:!0,succ:!1});const r=new P(D.NOT_SUPPORTED,"Your browser is not support dual stream");throw t.onError(r),r}if(this._isDualStreamEnabled){const r=new P(D.INVALID_OPERATION,"Dual stream is already enabled");throw t.onError(r),r}if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(r){throw At.streamSwitch(this._sessionId,{lts:ht(),isdual:!0,succ:!1}),t.onError(r),r}this._isDualStreamEnabled=!0,At.streamSwitch(this._sessionId,{lts:ht(),isdual:!0,succ:!0}),S.info("[".concat(this._clientId,"] enable dual stream")),t.onSuccess()}async disableDualStream(){if(!this._isDualStreamEnabled)return;if(!this._joinInfo)throw new P(D.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");const t=At.reportApiInvoke(this._sessionId,{name:Ht.DISABLE_DUAL_STREAM,options:[],tag:Wt.TRACER});if(this._p2pChannel.getLocalMedia(Ut.LocalVideoLowTrack))try{const r=await this._p2pChannel.unpublishLowStream();r&&await this._gateway.unpublish(r,this._joinInfo.stringUid||this._joinInfo.uid)}catch(r){throw At.streamSwitch(this._sessionId,{lts:ht(),isdual:!1,succ:!1}),t.onError(r),r}this._isDualStreamEnabled=!1,At.streamSwitch(this._sessionId,{lts:ht(),isdual:!1,succ:!0}),S.info("[".concat(this._clientId,"] disable dual stream")),t.onSuccess()}async setClientRole(t,r){(function(d){Pr(d,"role",["audience","host"])})(t),r&&OR(r);const i=At.reportApiInvoke(this._sessionId,{name:Ht.SET_CLIENT_ROLE,options:[t,r],tag:Wt.TRACER});if(this._mode==="rtc"){S.warning("[".concat(this._clientId,"]rtc mode can not use setClientRole"));const d=new P(D.INVALID_OPERATION,"rtc mode can not use setClientRole");return i.onError(d),d.throw()}if(r&&r.level&&t==="host"){const d=new P(D.INVALID_OPERATION,"host mode can not set audience latency level");return i.onError(d),d.throw()}try{var s,l;if(t==="audience"&&this._p2pChannel.hasLocalMedia()){const d=new P(D.INVALID_OPERATION,"can not set client role to audience when publishing stream");return i.onError(d),d.throw()}await this._gateway.setClientRole(t,r),S.info(k(s=k(l="[".concat(this._clientId,"] set client role to ")).call(l,t,", level: ")).call(s,r&&r.level)),i.onSuccess()}catch(d){throw i.onError(d),d}}setProxyServer(t){if(pr(t,"proxyServer"),this.connectionState!=="DISCONNECTED")throw new P(D.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new P(D.INVALID_OPERATION,"You have already set the proxy");this._proxyServer=t,At.setProxyServer(this._proxyServer),S.setProxyServer(this._proxyServer)}setTurnServer(t){if(tn(t)||(t=[t]),this.connectionState!=="DISCONNECTED")throw new P(D.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new P(D.INVALID_OPERATION,"You have already set the proxy");var r;if(Np(t))return this._turnServer={servers:t,mode:"original-manual"},void S.info(k(r="[".concat(this._clientId,"] Set original turnserver success: ")).call(r,pt(t).call(t,i=>i.urls).join(","),"."));V(t).call(t,i=>NR(i)),this._turnServer={servers:t,mode:"manual"},S.info("[".concat(this._clientId,"] Set turnserver success."))}startProxyServer(t){const r=At.reportApiInvoke(this._sessionId,{name:Ht.START_PROXY_SERVER,options:[],tag:Wt.TRACER});if(this.connectionState!=="DISCONNECTED"){const s=new P(D.INVALID_OPERATION,"Start proxy server before join channel");throw r.onError(s),s}if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint){const s=new P(D.INVALID_OPERATION,"You have already set the proxy");throw r.onError(s),s}const i=[1,2,3,4,5];switch(t===void 0&&(t=1),t){case 1:this._cloudProxyServerMode="normal";break;case 2:this._cloudProxyServerMode="443only";break;case 3:this._cloudProxyServerMode="proxy3";break;case 4:this._cloudProxyServerMode="proxy4";break;case 5:this._cloudProxyServerMode="proxy5";break;default:{const s=new P(D.INVALID_PARAMS,"proxy server mode must be ".concat(i.join("|")));throw r.onError(s),s}}S.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),r.onSuccess()}stopProxyServer(){const t=At.reportApiInvoke(this._sessionId,{name:Ht.STOP_PROXY_SERVER,options:[],tag:Wt.TRACER});if(this.connectionState!=="DISCONNECTED")throw new P(D.INVALID_OPERATION,"Stop proxy server after leave channel");At.setProxyServer(),S.setProxyServer(),this._cloudProxyServerMode="disabled",S.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]},t.onSuccess()}setLocalAccessPoints(t,r){if(yp(t,"serverList"),pr(r,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new P(D.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const i=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;t=pt(t).call(t,s=>{var l;return i.test(s)?k(l="".concat(s.replace(/\./g,"-"),".")).call(l,r):s}),this._useLocalAccessPoint=!0,jr("WEBCS_DOMAIN",t),jr("WEBCS_DOMAIN_BACKUP_LIST",t),jr("GATEWAY_DOMAINS",[r]),jr("EVENT_REPORT_DOMAIN",t[0]),jr("EVENT_REPORT_BACKUP_DOMAIN",t[1]||t[0]),jr("LOG_UPLOAD_SERVER","".concat(t[0],":6444")),S.info("set local access point success")}async setRemoteVideoStreamType(t,r){var i,s;Pr(r,"streamType",[0,1]);const l=At.reportApiInvoke(this._sessionId,{name:Ht.SET_REMOTE_VIDEO_STREAM_TYPE,options:[t,r],tag:Wt.TRACER});try{await this._gateway.setRemoteVideoStreamType(t,r),ar(()=>{var d;const h=ft(d=this._users).call(d,p=>p.uid===t);h&&h.videoTrack&&h.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(d){throw l.onError(d),S.error("[".concat(this._clientId,"] set remote video stream type error"),d.toString()),d}S.info(k(i=k(s="[".concat(this._clientId,"] set remote ")).call(s,t," video stream type to ")).call(i,r)),this._remoteStreamTypeCacheMap.set(t,r),l.onSuccess()}async setStreamFallbackOption(t,r){var i,s;Pr(r,"fallbackType",[0,1,2]);const l=At.reportApiInvoke(this._sessionId,{name:Ht.SET_STREAM_FALLBACK_OPTION,options:["too long to show",r],tag:Wt.TRACER});try{await this._gateway.setStreamFallbackOption(t,r)}catch(d){throw l.onError(d),S.error("[".concat(this._clientId,"] set stream fallback option"),d.toString()),d}S.info(k(i=k(s="[".concat(this._clientId,"] set remote ")).call(s,t," stream fallback type to ")).call(i,r)),this._streamFallbackTypeCacheMap.set(t,r),l.onSuccess()}setEncryptionConfig(t,r,i){(function(l){Pr(l,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(t),pr(r,"secret");const s=["aes-128-gcm2","aes-256-gcm2"];if(qt(s).call(s,t)){if(!i||!(i instanceof Uint8Array&&i.length===32))throw new P(D.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(i)throw new P(D.INVALID_PARAMS,"current encrypt mode does not need salt");new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(r)||S.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=t,this._encryptionSecret=r,i&&(this._encryptionSalt=Nc(i))}async renewToken(t){pr(t,"token",1,2047);const r=At.reportApiInvoke(this._sessionId,{name:Ht.RENEW_TOKEN,options:[t],tag:Wt.TRACER});if(!this._key||!this._joinInfo){const l=new P(D.INVALID_OPERATION,"renewToken should not be called before user join");return r.onError(l),l.throw()}const i=this._key;this._key=t,this._joinInfo&&(this._joinInfo.token=t);const s=await this._renewTokenMutex.lock();try{if(it("USE_NEW_TOKEN")){S.debug("start renew token with ticket from unilbs");const l=await X9(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Ne);S.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:t,ticket:l})}else S.debug("start renew token without ticket"),await this._gateway.renewToken({token:t});S.debug("[".concat(this._clientId,"] renewToken success")),r.onSuccess()}catch(l){throw this._key=i,this._joinInfo.token=i,r.onError(l),S.error("[".concat(this._clientId,"] renewToken failed"),l.toString()),l}finally{s()}}enableAudioVolumeIndicator(){const t=At.reportApiInvoke(this._sessionId,{name:Ht.ENABLE_AUDIO_VOLUME_INDICATOR,options:[],tag:Wt.TRACER});if(this._audioVolumeIndicationInterval)return S.warning("you have already enabled audio volume indicator!"),t.onSuccess();this._audioVolumeIndicationInterval=be(()=>{const r=this._p2pChannel.getAudioLevels();this.emit(Ve.VOLUME_INDICATOR,r)},it("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3),t.onSuccess()}getRTCStats(){const t=this._statsCollector.getRTCStats(),r=this._gateway.getInChannelInfo();return t.Duration=Math.round(r.duration/1e3),t}startLiveStreaming(t,r){const i=At.reportApiInvoke(this._sessionId,{name:Ht.START_LIVE_STREAMING,options:[t,r],tag:Wt.TRACER});if(!r){if(this._codec!=="h264"){const l=new P(D.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");return i.onError(l),ct.reject(l)}if(!this._p2pChannel.hasLocalMedia()){const l=new P(D.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming");return i.onError(l),ct.reject(l)}}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t)){const l=new P(D.LIVE_STREAMING_TASK_CONFLICT);return i.onError(l),ct.reject(l)}const s=r?Hr.TRANSCODE:Hr.RAW;return this._createLiveStreamingClient(s).startLiveStreamingTask(t,s).then(()=>i.onSuccess()).catch(l=>{throw i.onError(l),l})}setLiveTranscoding(t){const r=At.reportApiInvoke(this._sessionId,{name:Ht.SET_LIVE_TRANSCODING,options:[t],tag:Wt.TRACER});return this._createLiveStreamingClient(Hr.TRANSCODE).setTranscodingConfig(t).then(()=>r.onSuccess()).catch(i=>{throw r.onError(i),i})}stopLiveStreaming(t){var r;const i=At.reportApiInvoke(this._sessionId,{name:Ht.STOP_LIVE_STREAMING,options:[t],tag:Wt.TRACER}),s=kt(r=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient]).call(r,l=>l&&l.hasUrl(t));if(!s.length){const l=new P(D.INVALID_PARAMS,"can not find live streaming url to stop");return i.onError(l),ct.reject(l)}return ct.all(pt(s).call(s,l=>l&&l.stopLiveStreamingTask(t))).then(()=>i.onSuccess()).catch(l=>{throw i.onError(l),l})}async addInjectStreamUrl(t,r){const i=At.reportApiInvoke(this._sessionId,{name:Ht.ADD_INJECT_STREAM_URL,options:[t,r],tag:Wt.TRACER});try{if(!this._joinInfo)throw new P(D.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");const s=this._createLiveStreamingClient(Hr.INJECT);s.setInjectStreamConfig(r,0),await s.startLiveStreamingTask(t,Hr.INJECT)}catch(s){throw i.onError(s),s}i.onSuccess()}async removeInjectStreamUrl(){const t=At.reportApiInvoke(this._sessionId,{name:Ht.REMOVE_INJECT_STREAM_URL,options:[],tag:Wt.TRACER});try{var r,i;const s=this._createLiveStreamingClient(Hr.INJECT),l=ft(r=Qe(ia(i=s.streamingTasks).call(i))).call(r,d=>d.mode===Hr.INJECT);if(!this._joinInfo||!l)throw new P(D.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");await s.stopLiveStreamingTask(l.url)}catch(s){throw t.onError(s),s}t.onSuccess()}async startChannelMediaRelay(t){const r=At.reportApiInvoke(this._sessionId,{name:Ht.START_CHANNEL_MEDIA_RELAY,options:[t],tag:Wt.TRACER});try{IA(t),await this._createChannelMediaRelayClient().startChannelMediaRelay(t)}catch(i){return r.onError(i),i.throw()}r.onSuccess()}async updateChannelMediaRelay(t){const r=At.reportApiInvoke(this._sessionId,{name:Ht.UPDATE_CHANNEL_MEDIA_RELAY,options:[t],tag:Wt.TRACER});try{IA(t),await this._createChannelMediaRelayClient().updateChannelMediaRelay(t)}catch(i){return r.onError(i),i.throw()}r.onSuccess()}async stopChannelMediaRelay(){const t=At.reportApiInvoke(this._sessionId,{name:Ht.STOP_CHANNEL_MEDIA_RELAY,options:[],tag:Wt.TRACER});try{await this._createChannelMediaRelayClient().stopChannelMediaRelay()}catch(r){return t.onError(r),r.throw()}t.onSuccess()}sendStreamMessage(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new P(D.INVALID_OPERATION,"can not send data stream, not joined");if(typeof t=="string"&&(t=new TextEncoder().encode(t)),new Blob([t]).size>1024)throw new P(D.INVALID_PARAMS,"stream message out of range.");return this._gateway.signal.request(Fe.DATA_STREAM,{payload:Nc(t)},!r)}sendMetadata(t){if(!this._joinInfo)throw new P(D.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([t]).size>1024)throw new P(D.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Fe.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Nc(t)})}async sendCustomReportMessage(t){tn(t)||(t=[t]),V(t).call(t,rV);const r=At.reportApiInvoke(this._sessionId,{name:Ht.SEND_CUSTOM_REPORT_MESSAGE,options:[St(t)],tag:Wt.TRACER});if(!this._joinInfo){const i=new P(D.INVALID_OPERATION,"can not send custom report, not joined");return r.onError(i),i.throw()}await At.sendCustomReportMessage(this._joinInfo.sid,t),r.onSuccess()}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(t,r){Pr(r.spatialLayer,"spatialLayer",[0,1,2,3]),Pr(r.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(t,r)}catch(i){throw S.error("[".concat(this._clientId,"] pick SVC layer failed"),i.toString()),i}}_reset(){var t;S.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=wo.CancelToken.source(),this._streamFallbackTypeCacheMap=new $t,this._remoteStreamTypeCacheMap=new $t,this._configDistribute.stopGetConfigDistribute(),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,V(t=this._users).call(t,r=>{r._audioTrack&&r._audioTrack._destroy(),r._videoTrack&&r._videoTrack._destroy()}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._p2pChannel.reset(),this._publishMutex=new wn("client-publish"),this._subscribeMutex=new $t,this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0)}_startSession(t,r){var i,s,l;const d=t||Hp();t?S.debug(k(i="[".concat(this._clientId,"] new Session ")).call(i,d)):S.debug(k(s=k(l="[".concat(this._clientId,"] renewSession ")).call(l,this._sessionId," => ")).call(s,d)),this._sessionId=d,this.store.sessionId=d,r?At.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:r.channel,appid:r.appId,mode:this._mode}):this._joinInfo?At.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:this._joinInfo.cname,appid:this._joinInfo.appId,mode:this._mode}):this._gateway.joinInfo&&At.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId,mode:this._mode}),this._joinInfo&&(this._joinInfo.sid=d),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=d)}async _publishHighStream(t){if(!this._joinInfo||this._uid===void 0)throw new P(D.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new P(D.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&it("FORCE_TURN")&&!it("TURN_ENABLE_TCP")&&!it("TURN_ENABLE_UDP"))throw new P(D.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");S.debug("[".concat(this._clientId,"] publish high stream"));try{const i=await this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter),s=(await i.next()).value;if(s){var r;let l;try{l=await this._gateway.publish(this._uid,s,!0)}catch(d){if(d.code!==D.DISCONNECT_P2P)throw i.throw(d),d}await i.next(((r=l)===null||r===void 0?void 0:r.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const l of t)l.muted&&await this._p2pChannel.muteLocalTrack(l)}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,t),(i==null?void 0:i.code)===D.WS_ABORT)return;throw i}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new P(D.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new P(D.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));S.debug("[".concat(this._clientId,"] publish low stream"));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t.bitrate));try{const i=await this._p2pChannel.publishLowStream(this._lowStreamParameter),s=(await i.next()).value;if(s){var r;let l;try{l=await this._gateway.publish(this._uid,s,!0)}catch(d){if(d.code!==D.DISCONNECT_P2P)throw i.throw(d),d}i.next(((r=l)===null||r===void 0?void 0:r.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,void 0,!0),(i==null?void 0:i.code)===D.WS_ABORT)return;throw i}}_createLiveStreamingClient(t){if(!this._joinInfo||!this._appId)return new P(D.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const r=()=>new aw(this._joinInfo,this._config.websocketRetryConfig||Ne,this._config.httpRetryConfig||Ne),i=s=>{s.onLiveStreamError=(l,d)=>{At.reportApiInvoke(this._sessionId,{name:Ht.ON_LIVE_STREAM_ERROR,options:[l,d],tag:Wt.TRACER}).onSuccess(),this.emit(Ve.LIVE_STREAMING_ERROR,l,d)},s.onLiveStreamWarning=(l,d)=>{At.reportApiInvoke(this._sessionId,{name:Ht.ON_LIVE_STREAM_WARNING,options:[l,d],tag:Wt.TRACER}).onSuccess(),this.emit(Ve.LIVE_STREAMING_WARNING,l,d)},s.on(Tl.REQUEST_WORKER_MANAGER_LIST,(l,d,h)=>{if(!this._joinInfo)return h(new P(D.INVALID_OPERATION,"can not find join info to get worker manager"));ew(l,this._joinInfo,this._axiosCancelSource.token,Ne).then(d).catch(h)})};switch(t){case Hr.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=r(),i(this._liveRawStreamingClient)),this._liveRawStreamingClient;case Hr.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=r(),i(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case Hr.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=r(),this._injectStreamingClient.on(Tl.REQUEST_WORKER_MANAGER_LIST,(s,l,d)=>{if(!this._joinInfo)return d(new P(D.INVALID_OPERATION,"can not find join info to get worker manager"));ew(s,this._joinInfo,this._axiosCancelSource.token,Ne).then(l).catch(d)}),this._injectStreamingClient.onInjectStatusChange=(s,l,d)=>{this.emit(Ve.INJECT_STREAM_STATUS,s,l,d)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){return this._joinInfo?(this._channelMediaRelayClient||(this._channelMediaRelayClient=new lw(this._joinInfo,this._clientId,this._config.websocketRetryConfig||Ne,this._config.httpRetryConfig||Ne),this._channelMediaRelayClient.on("state",t=>{t==="RELAY_STATE_FAILURE"&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.emit(Ve.CHANNEL_MEDIA_RELAY_STATE,t)}),this._channelMediaRelayClient.on("event",t=>{this.emit(Ve.CHANNEL_MEDIA_RELAY_EVENT,t)})),this._channelMediaRelayClient):new P(D.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw()}_handleGatewayEvents(){this._gateway.on(vr.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(vr.CONNECTION_STATE_CHANGE,(t,r,i)=>{var s,l;const d=()=>{this.emit(Ve.CONNECTION_STATE_CHANGE,t,r,i)};if(At.reportApiInvoke(this._sessionId,{name:Ht.CONNECTION_STATE_CHANGE,options:[t,r,i],tag:Wt.TRACER}).onSuccess(St({cur:t,prev:r,reason:i})),S.info(k(s=k(l="[".concat(this._clientId,"] connection state change: ")).call(l,r," -> ")).call(s,t)),t==="DISCONNECTED")return this._reset(),void d();var h;if(t==="RECONNECTING")V(h=this._users).call(h,f=>{f._trust_in_room_=!1,f._trust_audio_enabled_state_=!1,f._trust_video_enabled_state_=!1,f._trust_audio_mute_state_=!1,f._trust_video_mute_state_=!1,f._trust_stream_added_state_=!1}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(t==="CONNECTED"){var p,m;V(p=this._streamFallbackTypeCacheMap).call(p,(f,_)=>{this._gateway.setStreamFallbackOption(_,f).catch(v=>S.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),v))}),V(m=this._remoteStreamTypeCacheMap).call(m,(f,_)=>{this._gateway.setRemoteVideoStreamType(_,f).catch(v=>S.warning("[".concat(this._clientId,"] auto set remote stream type failed"),v))}),this._p2pChannel.republish(),this._userOfflineTimeout=ar(()=>{var f;if(this.connectionState!=="CONNECTED")return;this._userOfflineTimeout=void 0;const _=kt(f=this._users).call(f,v=>!v._trust_in_room_);V(_).call(_,v=>{var T;S.debug(k(T="[".concat(this._clientId,"] user offline timeout, emit user offline ")).call(T,v.uid)),this._handleUserOffline({uid:v.uid})})},3e3),this._streamRemovedTimeout=ar(()=>{var f;this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,V(f=this._users).call(f,_=>{var v,T,R,w,O;_._trust_audio_mute_state_||(S.debug(k(v="[".concat(this._clientId,"] auto dispatch audio unmute event ")).call(v,_.uid)),this._handleMuteStream(_.uid,"audio",!1)),_._trust_video_mute_state_||(S.debug(k(T="[".concat(this._clientId,"] auto dispatch video unmute event ")).call(T,_.uid)),this._handleMuteStream(_.uid,"video",!1)),_._trust_audio_enabled_state_||(S.debug(k(R="[".concat(this._clientId,"] auto dispatch enable local audio ")).call(R,_.uid)),this._handleSetStreamLocalEnable("audio",_.uid,!0)),!_._trust_video_enabled_state_&&_._video_enabled_&&(S.debug(k(w="[".concat(this._clientId,"] auto dispatch enable local video ")).call(w,_.uid)),this._handleSetStreamLocalEnable("video",_.uid,!0)),_._trust_stream_added_state_||(S.debug(k(O="[".concat(this._clientId,"] auto dispatch stream remove ")).call(O,_.uid)),this._handleRemoveStream({uid:_.uid,uint_id:_._uintid}))}))},1e3)}d()}),this._gateway.on(vr.REQUEST_NEW_GATEWAY_LIST,(t,r)=>{if(!this._joinInfo)return r(new P(D.UNEXPECTED_ERROR,"can not recover, no join info"));wu(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Ne).then(i=>{var s;this._joinInfo&&(this._joinInfo.apResponse=i.gatewayInfo.res),t(pt(s=i.gatewayInfo.gatewayAddrs).call(s,l=>{if(this._joinInfo&&this._joinInfo.proxyServer){var d,h;const p=l.split(":");return k(d=k(h="wss://".concat(this._joinInfo.proxyServer,"/ws/?h=")).call(h,p[0],"&p=")).call(d,p[1])}return"wss://".concat(l)}))}).catch(r)}),this._gateway.on(vr.NETWORK_QUALITY,t=>{this._networkQualitySensitivity==="normal"&&this.emit(Ve.NETWORK_QUALITY,t)}),this._gateway.on(vr.STREAM_TYPE_CHANGE,(t,r)=>{this.emit(Ve.STREAM_TYPE_CHANGED,t,r),At.reportApiInvoke(this._sessionId,{name:Ht.STREAM_TYPE_CHANGE,options:[t,r],tag:Wt.TRACER}).onSuccess(St({uid:t,streamType:r}))}),this._gateway.on(vr.IS_P2P_DISCONNECTED,t=>{this._p2pChannel.isP2PDisconnected()?t(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?t(!1):t(!0)}),this._gateway.on(vr.NEED_RENEW_SESSION,()=>{this._startSession()}),this._gateway.on(vr.REQUEST_P2P_CONNECTION_PARAMS,async(t,r,i)=>{try{r(await this._p2pChannel.startP2PConnection(t))}catch(s){i(s)}}),this._gateway.on(vr.JOIN_RESPONSE,t=>{const{dtlsParameters:r,iceParameters:i,candidates:s,rtpCapabilities:l,setup:d,cname:h,defaultIp:p,defaultPort:m}=kw(t.ortc);this._p2pChannel.connect(i,r,s,l,d,h,p,m)}),this._gateway.signal.on(tr.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(tr.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(tr.ON_ADD_AUDIO_STREAM,t=>this._handleAddAudioOrVideoStream("audio",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc)),this._gateway.signal.on(tr.ON_ADD_VIDEO_STREAM,t=>this._handleAddAudioOrVideoStream("video",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc)),this._gateway.signal.on(tr.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(tr.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(tr.MUTE_AUDIO,t=>this._handleMuteStream(t.uid,"audio",!0)),this._gateway.signal.on(tr.UNMUTE_AUDIO,t=>this._handleMuteStream(t.uid,"audio",!1)),this._gateway.signal.on(tr.MUTE_VIDEO,t=>this._handleMuteStream(t.uid,"video",!0)),this._gateway.signal.on(tr.UNMUTE_VIDEO,t=>this._handleMuteStream(t.uid,"video",!1)),this._gateway.signal.on(tr.RECEIVE_METADATA,t=>{const r=mu(t.metadata);this.emit(Ve.RECEIVE_METADATA,t.uid,r)}),this._gateway.signal.on(tr.ON_DATA_STREAM,t=>{t.seq&&delete t.seq,t.payload=mu(t.payload),this.emit(Ve.STREAM_MESSAGE,t.uid,t.payload),this.onStreamMessage&&this.onStreamMessage(t)}),this._gateway.signal.on(tr.ON_CRYPT_ERROR,()=>{ys(()=>{S.warning("[".concat(this._clientId,"] on crypt error")),this.emit(Ve.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(tr.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(tr.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{S.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0),this.emit(Ve.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(tr.ON_STREAM_FALLBACK_UPDATE,t=>{var r,i;S.debug(k(r=k(i="[".concat(this._clientId,"] stream fallback peerId: ")).call(i,t.stream_id,", attr: ")).call(r,t.stream_type)),this.emit(Ve.STREAM_FALLBACK,t.stream_id,t.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(tr.ON_PUBLISH_STREAM,t=>{var r;this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,St({proxy:t.proxy})),S.info(k(r="[".concat(this._clientId,"] on publish stream, ")).call(r,St(t))),t.proxy!==void 0&&this.emit(Ve.IS_USING_CLOUD_PROXY,!!t.proxy))}),this._gateway.signal.on(tr.ENABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!0)}),this._gateway.signal.on(tr.DISABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!1)}),this._gateway.signal.on(Ce.REQUEST_TIMEOUT,(t,r)=>{if(this._joinInfo)switch(t){case Fe.PUBLISH:{if(!r)return;const h=(r=r).ortc;if(h){var i,s,l,d;const p=Ss(h).call(h,_=>{let{stream_type:v}=_;return v===Kr.Audio}),m=Ss(h).call(h,_=>{let{stream_type:v}=_;return v!==Kr.Audio}),f=Ss(h).call(h,_=>{let{stream_type:v}=_;return v===Kr.Screen||v===Kr.ScreenLow});r.state==="offer"&&At.publish(this._joinInfo.sid,{eventElapse:ho.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:D.TIMEOUT,audio:p,video:m,p2pid:r.p2p_id,publishRequestid:this.store.pubId,screenshare:f,audioName:p?(i=ft(h).call(h,_=>{let{stream_type:v}=_;return v===Kr.Audio}))===null||i===void 0||(s=i.ssrcs[0])===null||s===void 0?void 0:s.ssrcId.toString():void 0,videoName:m?(l=ft(h).call(h,_=>{let{stream_type:v}=_;return v!==Kr.Audio}))===null||l===void 0||(d=l.ssrcs[0])===null||d===void 0?void 0:d.ssrcId.toString():void 0})}break}case Fe.SUBSCRIBE:(r=r)&&At.subscribe(this._joinInfo.sid,{succ:!1,ec:D.TIMEOUT,audio:r.stream_type===er.AUDIO,video:r.stream_type===er.VIDEO,peerid:r.stream_id,subscribeRequestid:r.ssrcId,p2pid:this.store.p2pId,eventElapse:ho.measureFromSubscribeStart(this.store.clientId,r.ssrcId)})}}),this._gateway.signal.on(tr.ON_P2P_OK,t=>{this.uid===this._uid&&t.proxy!==void 0&&this.emit(Ve.IS_USING_CLOUD_PROXY,!!t.proxy)})}_handleP2PChannelEvents(){this._p2pChannel.on(ze.RequestMuteLocal,async(t,r,i)=>{if(this._joinInfo)try{await this._gateway.muteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(s){s.code===D.DISCONNECT_P2P?r():i(s)}else r()}),this._p2pChannel.on(ze.RequestUnmuteLocal,async(t,r,i)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(s){s.code===D.DISCONNECT_P2P?r():i(s)}else r()}),this._p2pChannel.on(ze.RequestRePublish,(t,r,i)=>{this.publish(t,!1).then(r).catch(i)}),this._p2pChannel.on(ze.RequestReSubscribe,async(t,r,i)=>{try{for(const{user:s,kind:l}of t)l===er.VIDEO?await this.subscribe(s,"video"):await this.subscribe(s,"audio");r()}catch(s){i(s)}}),this._p2pChannel.on(ze.RequestUploadStats,(t,r)=>{this._gateway.uploadStats(t,r)}),this._p2pChannel.on(ze.MediaReconnectStart,t=>{this.emit(Ve.MEDIA_RECONNECT_START,t)}),this._p2pChannel.on(ze.MediaReconnectEnd,t=>{this.emit(Ve.MEDIA_RECONNECT_END,t)}),this._p2pChannel.on(ze.NeedSignalRTT,t=>{t(this._gateway.getSignalRTT())}),this._p2pChannel.on(ze.RequestRestartICE,async()=>{const t=await this._p2pChannel.reEstablish();if(t){const{response:r}=await this._gateway.restartICE({iceParameters:t.iceParameters}),{candidates:i,iceParameters:s,defaultIp:l,defaultPort:d}=function(h){const p=h.ice,{candidates:m,defaultIp:f,defaultPort:_}=Bw(p.candidates);return{candidates:m,iceParameters:{iceUfrag:p.iceUfrag,icePwd:p.icePwd},defaultIp:f,defaultPort:_}}(r);await t.restartICE(s,i,l,d)}}),this._p2pChannel.on(ze.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(ze.RequestReconnectPC,async()=>{var t;const{iceParameters:r,dtlsParameters:i,rtpCapabilities:s}=await this._p2pChannel.startP2PConnection({turnServer:(t=this._joinInfo)===null||t===void 0?void 0:t.turnServer}),{gatewayEstablishParams:l}=await this._gateway.reconnectPC({iceParameters:r,dtlsParameters:i,rtpCapabilities:s}),{dtlsParameters:d,iceParameters:h,candidates:p,rtpCapabilities:m,setup:f,cname:_,defaultIp:v,defaultPort:T}=kw(l);await this._p2pChannel.connect(h,d,p,m,f,_,v,T),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(ze.RequestUnpublishForReconnectPC,async(t,r,i)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(t,this._uid),r()):i()}),this._p2pChannel.on(ze.P2PLost,()=>{this.emit(Ve.P2P_LOST,this.store.uid)})}getKeyMetrics(){return this.store.keyMetrics}}function ub(e){return Ie(e.timeout,"config.timeout",0,1e5),Ie(e.timeoutFactor,"config.timeoutFactor",0,100,!1),Ie(e.maxRetryCount,"config.maxRetryConfig",0,1/0),Ie(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}function V7(e){return Pr(e.codec,"config.codec",["vp8","vp9","av1","h264"]),Pr(e.mode,"config.mode",["rtc","live"]),e.proxyServer!==void 0&&pr(e.proxyServer,"config.proxyServer",1,1e4),e.turnServer!==void 0&&hb(e.turnServer),e.httpRetryConfig!==void 0&&ub(e.httpRetryConfig),e.websocketRetryConfig!==void 0&&ub(e.websocketRetryConfig),!0}function hb(e){return pr(e.turnServerURL,"turnServerURL"),pr(e.username,"username"),pr(e.password,"password"),e.udpport&&Ie(e.udpport,"udpport",1,99999,!0),e.forceturn&&Sc(e.forceturn,"forceturn"),e.security&&Sc(e.security,"security"),e.tcpport&&Ie(e.tcpport,"tcpport",1,99999,!0),!0}function pb(e){return e.level!==void 0&&Pr(e.level,"level",[1,2,3]),!0}function G7(e){return pr(e.reportId,"params.reportId",0,100,!1),pr(e.category,"params.category",0,100,!1),pr(e.event,"params.event",0,100,!1),pr(e.label,"params.label",0,100,!1),Ie(e.value,"params.value",TR,RR,!1),!0}Du([Au({report:At}),wi("design:type",Function),wi("design:paramtypes",[String]),wi("design:returntype",void 0)],Xl.prototype,"setProxyServer",null),Du([Au(),wi("design:type",Function),wi("design:paramtypes",[Object]),wi("design:returntype",void 0)],Xl.prototype,"setTurnServer",null),Du([Au({report:At}),wi("design:type",Function),wi("design:paramtypes",[Array,String]),wi("design:returntype",void 0)],Xl.prototype,"setLocalAccessPoints",null),Du([Au({report:At}),wi("design:type",Function),wi("design:paramtypes",[String,String,Uint8Array]),wi("design:returntype",void 0)],Xl.prototype,"setEncryptionConfig",null),Du([Up({report:At}),wi("design:type",Function),wi("design:paramtypes",[Object,Object]),wi("design:returntype",ct)],Xl.prototype,"pickSVCLayer",null),function(e){e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.INJECT_STREAM_STATUS="stream-inject-status",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost"}(we||(we={})),function(e){e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE"}(yi||(yi={})),function(e){e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot"}(DA||(DA={})),function(e){e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger"}(zl||(zl={})),function(e){e.FREE="free",e.UPLOADING="uploading"}(db||(db={})),function(e){e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied"}(LA||(LA={}));const j7={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};var qn,Jr,Ab,de,zt,fb,gb,mb,Eb,_b,Ib,Zl,pn,Oe,fr,Qo,nr,oe,Os;(function(e){e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics"})(qn||(qn={})),function(e){e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAT="io.agora.pb.Wrtc.JoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics"}(Jr||(Jr={})),function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}(Ab||(Ab={})),function(e){e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.ADD_INJECT_STREAM_URL="Client.addInjectStreamUrl",e.REMOVE_INJECT_STREAM_URL="Client.removeInjectStreamUrl",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange"}(de||(de={})),function(e){e.TRACER="tracer"}(zt||(zt={})),function(e){e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND"}(fb||(fb={})),function(e){e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged"}(gb||(gb={})),function(e){e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR"}(mb||(mb={})),function(e){e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR"}(Eb||(Eb={})),function(e){e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND"}(_b||(_b={})),function(e){e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV"}(Ib||(Ib={})),function(e){e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY"}(Zl||(Zl={})),function(e){e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed"}(pn||(pn={})),function(e){e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success"}(Oe||(Oe={})),function(e){e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v2",e.REJOIN="rejoin",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.SUBSCRIBE="subscribe",e.UNSUBSCRIBE="unsubscribe",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer"}(fr||(fr={})),function(e){e.PUBLISH_STATS="publish_stats",e.PUBLISH_RELATED_STATS="publish_related_stats",e.SUBSCRIBE_STATS="subscribe_stats",e.SUBSCRIBE_RELATED_STATS="subscribe_related_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length"}(Qo||(Qo={})),function(e){e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio"}(nr||(nr={})),function(e){e.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",e.NEED_ANSWER="NEED_ANSWER",e.NEED_RENEGOTIATE="NEED_RENEGOTIATE",e.P2P_LOST="P2P_LOST",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NEED_UNPUB="NEED_UNPUB",e.NEED_UNSUB="NEED_UNSUB",e.NEED_UPLOAD="NEED_UPLOAD",e.NEED_CONTROL="NEED_CONTROL",e.START_RECONNECT="START_RECONNECT",e.END_RECONNECT="END_RECONNECT",e.NEED_SIGNAL_RTT="NEED_SIGNAL_RTT"}(oe||(oe={})),function(e){e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer"}(Os||(Os={}));const vb={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,currentPacketLossRate:0},Cb={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},H7={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},K7={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};var da,Vo,Sb,PA,Tb,Ze,Rb,yb,Eo,ue,ks,$l,Lu,zi,C_,Pu,wb;function bb(e,t){var r=ae(e);if(Xt){var i=Xt(e);t&&(i=kt(i).call(i,function(s){return jt(e,s).enumerable})),r.push.apply(r,i)}return r}function ve(e){for(var t=1;t<arguments.length;t++){var r,i,s=arguments[t]!=null?arguments[t]:{};t%2?V(r=bb(Object(s),!0)).call(r,function(l){mr(e,l,s[l])}):Zt?ur(e,Zt(s)):V(i=bb(Object(s))).call(i,function(l){ie(e,l,jt(s,l))})}return e}(function(e){e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls"})(da||(da={})),function(e){e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e.INJECT="inject_streaming"}(Vo||(Vo={})),function(e){e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.INJECT_STREAM_STATUS="@live_uap-inject-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address"}(Sb||(Sb={})),function(e){e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager"}(PA||(PA={})),function(e){e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(Tb||(Tb={})),function(e){e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.CAN_NOT_PUBLISH_MULTIPLE_AUDIO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_AUDIO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN"}(Ze||(Ze={})),function(e){e.CONNECT_FAILED="connect failed",e.CONNECT_TIMEOUT="connect timeout",e.WS_DISCONNECTED="websocket disconnected",e.REQUEST_TIMEOUT="request timeout",e.REQUEST_FAILED="request failed",e.WAIT_STATUS_TIMEOUT="wait status timeout",e.WAIT_STATUS_ERROR="wait status error",e.BAD_STATE="bad state",e.WS_ABORT="ws abort",e.AP_REQUEST_TIMEOUT="AP request timeout",e.AP_JSON_PARSE_ERROR="AP json parse error",e.AP_REQUEST_ERROR="AP request error",e.AP_REQUEST_ABORT="AP request abort"}(Rb||(Rb={})),function(e){e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile"}(yb||(yb={})),function(e){e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid"}(Eo||(Eo={})),function(e){e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_CLOSE="@need_close",e.NEED_ADD_TRACK="@need_add_track",e.NEED_REMOVE_TRACK="@need_remove_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.SET_VIDEO_TRACK_MUTED="@set_video_track_muted",e.SET_AUDIO_TRACK_MUTED="@set_audio_track_muted"}(ue||(ue={})),function(e){e.SCREEN_TRACK="screen_track",e.LOW_STREAM="low_stream"}(ks||(ks={})),function(e){e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload"}($l||($l={})),function(e){e.FIRST_FRAME_DECODED="first-frame-decoded"}(Lu||(Lu={})),function(e){e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL"}(zi||(zi={})),zi.ASIA,zi.NORTH_AMERICA,zi.EUROPE,zi.JAPAN,zi.INDIA,zi.KOREA,zi.OVERSEA,zi.GLOBAL,zi.OCEANIA,zi.SOUTH_AMERICA,zi.AFRICA,ru&&zi.CHINA,function(e){e.UPDATE_BITRATE_LIMIT="update_bitrate_limit"}(C_||(C_={})),function(e){e.ONLINE="ONLINE",e.OFFLINE="OFFLINE"}(Pu||(Pu={})),function(e){e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE"}(wb||(wb={}));function BA(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{report:wt};return function(t,r,i){const s=t[r];if(typeof s=="function"){const l=t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name;i.value=function(){for(var d,h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];const f=e.report.reportApiInvoke(this._sessionId||null,{name:k(d="".concat(l,".")).call(d,r),options:p,tag:zt.TRACER});try{const _=s.apply(this,p);return f.onSuccess(),_}catch(_){throw f.onError(_),_}}}return i}}function Nb(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{report:wt};return function(t,r,i){const s=t[r];if(typeof s=="function"){const l=t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name;i.value=async function(){for(var d,h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];const f=e.report.reportApiInvoke(this._sessionId||null,{name:k(d="".concat(l,".")).call(d,r),options:p,tag:zt.TRACER});try{const _=await s.apply(this,p);return f.onSuccess(),_}catch(_){throw f.onError(_),_}}}return i}}const wt=new class{constructor(){var e,t;this.baseInfoMap=new $t,this.clientList=ts,this.keyEventUploadPendingItems=[],this.normalEventUploadPendingItems=[],this.apiInvokeUploadPendingItems=[],this.apiInvokeCount=0,this.ltsList=[],this.lastSendNormalEventTime=ht(),this.customReportCount=0,this.eventUploadTimer=be(Lr(e=this.doSend).call(e,this),it("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=be(Lr(t=this.appendSessionId).call(t,this),it("EVENT_REPORT_SEND_INTERVAL"))}reportApiInvoke(e,t,r){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;const i=ht();this.apiInvokeCount+=1;const s=this.apiInvokeCount,l=()=>({tag:t.tag,invokeId:s,sid:e,name:t.name,apiInvokeTime:i,options:t.options,states:t.states||null}),d=!!it("SHOW_REPORT_INVOKER_LOG");d&&S.info("".concat(t.name," start"),t.options);let h=!1;Mr(t.timeout).then(()=>{h||(this.sendApiInvoke(ve(ve({},l()),{},{error:D.API_INVOKE_TIMEOUT,success:!1})),S.debug("".concat(t.name," timeout")))});const p=new P(D.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:m=>{const f=()=>{if(h)throw p;return h=!0,this.sendApiInvoke(ve(ve({},l()),{},{success:!0},t.reportResult&&{result:m})),d&&S.info("".concat(t.name," onSuccess")),m};return r?Yp(f,t.name+"Success",r,()=>h=!0):f()},onError:m=>{const f=()=>{if(h)throw m;h=!0,this.sendApiInvoke(ve(ve({},l()),{},{success:!1,error:m.toString()})),d&&S.info("".concat(t.name," onFailure"),m.toString())};return r?Yp(f,t.name+"Error",r,()=>h=!0):f()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const r=ht(),i=this.createBaseInfo(e,r);i.cname=t.cname;const s=hr({},{willUploadConsoleLog:it("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:ru?"global":"oversea",areas:it("AREAS")&&it("AREAS").join(",")},t.extend),l=ht(),d=ve(ve({},i),{},{eventType:qn.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,build:vl,lts:l,elapse:l-r,extend:St(s),mode:t.mode,process:it("PROCESS_ID"),success:!0,version:Tn});this.send({type:Jr.SESSION,data:d},!0)}joinChooseServer(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=ht(),l=ve(ve({},i),{},{eventType:qn.JOIN_CHOOSE_SERVER,lts:s,eventElapse:s-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:s-r.startTime,success:t.succ,chooseServerAddrList:St(t.serverList),uid:t.uid?Tr(t.uid):null,cid:t.cid?Tr(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0});this.send({type:Jr.JOIN_CHOOSE_SERVER,data:l},!0)}reqUserAccount(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=ht(),l=ve(ve({},i),{},{eventType:qn.REQ_USER_ACCOUNT,lts:s,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:s-r.startTime,eventElapse:s-t.lts,extend:St(t.extend)});this.send({type:Jr.REQ_USER_ACCOUNT,data:l},!0)}joinGateway(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info;t.vid&&(i.vid=t.vid),i.uid=t.uid,i.cid=t.cid;const s=ht(),l=ve(ve({},i),{},{eventType:qn.JOIN_GATEWAY,lts:s,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,elapse:s-r.startTime,eventElapse:s-t.lts});t.succ&&(r.lastJoinSuccessTime=s),this.send({type:Jr.JOIN_GATEWAT,data:l},!0)}joinChannelTimeout(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const i=ht(),s=ve(ve({},r.info),{},{lts:i,timeout:t,elapse:i-r.startTime});this.send({type:Jr.JOIN_CHANNEL_TIMEOUT,data:s},!0)}publish(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=ht(),l=ve(ve({},i),{},{eventType:qn.PUBLISH,lts:s,eventElapse:s-t.lts,elapse:s-r.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:Jr.PUBLISH,data:l},!0)}subscribe(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=ht(),l=ve(ve({},i),{},{eventType:qn.SUBSCRIBE,lts:s,eventElapse:s-t.lts,elapse:s-r.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid});typeof t.peerid=="string"?l.peerSuid=t.peerid:l.peer=t.peerid,this.send({type:Jr.SUBSCRIBE,data:l},!0)}firstRemoteFrame(e,t,r,i){const s=this.baseInfoMap.get(e);if(!s)return;const l=s.info,d=ht(),h=ve(ve(ve({},l),i),{},{elapse:d-s.startTime,eventType:t,lts:d});this.send({type:r,data:h},!0)}onGatewayStream(e,t,r,i){const s=this.baseInfoMap.get(e);if(!s)return;const l=s.info,d=ht(),h=ve(ve(ve({},l),i),{},{eventType:t,lts:d});this.send({type:r,data:h},!0)}streamSwitch(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=ht(),l=ve(ve({},i),{},{eventType:qn.STREAM_SWITCH,lts:s,isDual:t.isdual,elapse:s-r.startTime,success:t.succ});this.send({type:Jr.STREAM_SWITCH,data:l},!0)}requestProxyAppCenter(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=ht(),l=ve(ve({},i),{},{eventType:qn.REQUEST_PROXY_APPCENTER,lts:s,eventElapse:s-t.lts,elapse:s-r.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Jr.REQUEST_PROXY_APPCENTER,data:l},!0)}requestProxyWorkerManager(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=ht(),l=ve(ve({},i),{},{eventType:qn.REQUEST_PROXY_WORKER_MANAGER,lts:s,eventElapse:s-t.lts,elapse:s-r.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Jr.REQUEST_PROXY_WORKER_MANAGER,data:l},!0)}setProxyServer(e){this.proxyServer=e,e?S.debug("reportProxyServerurl: ".concat(e)):S.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=ht(),l=ve(ve({},i),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:s,elapse:s-r.startTime,joinChannelSuccessElapse:s-(r.lastJoinSuccessTime||s)});this.send({type:Jr.PEER_PUBLISH_STATUS,data:l},!0)}workerEvent(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=ht(),l=My(ve(ve(ve({},i),t),{},{elapse:s-r.startTime,lts:s,productType:"WebRTC"}),"payload",1300);V(l).call(l,d=>this.send({type:Jr.WORKER_EVENT,data:d},!0))}apworkerEvent(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=ht(),l=ve(ve(ve({},i),t),{},{elapse:s-r.startTime,lts:s});this.send({type:Jr.AP_WORKER_EVENT,data:l},!0)}joinWebProxyAP(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=ht(),l=ve(ve(ve({},i),t),{},{elapse:s-r.startTime,lts:s,extend:t.extend||void 0});this.send({type:Jr.JOIN_WEB_PROXY_AP,data:l},!0)}WebSocketQuit(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=ht(),l=ve(ve(ve({},i),t),{},{elapse:s-r.startTime,lts:s});this.send({type:Jr.WEBSOCKET_QUIT,data:l},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>it("CUSTOM_REPORT_LIMIT"))throw new P(D.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=be(()=>{this.customReportCount=0},5e3));const r=pt(t).call(t,s=>({type:Jr.USER_ANALYTICS,data:ve({sid:e},s)})),i={msgType:"EventMessages",sentTs:Math.round(ht()/1e3),payloads:pt(r).call(r,s=>St(s))};try{await this.postDataToStatsCollector(i)}catch(s){throw S.error("send custom report message failed",s.toString()),new P(D.CUSTOM_REPORT_SEND_FAILED,s.message)}}sendApiInvoke(e){const t=it("NOT_REPORT_EVENT");if(e.tag&&qt(t)&&qt(t).call(t,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const r=this.baseInfoMap.get(e.sid);if(!r)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:i,uid:s,cid:l}=r.info;e.lts=e.lts||ht();const d={invokeId:e.invokeId,sid:e.sid,cname:i,cid:l,uid:s,lts:e.lts,success:e.success,elapse:e.lts-r.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?St(e.options):void 0,execStates:e.states?St(e.states):void 0,execResult:e.result?St(e.result):void 0,errorCode:e.error?St(e.error):void 0};return this.send({type:Jr.API_INVOKE,data:d},!1),!0}appendSessionId(){var e;V(e=this.clientList).call(e,t=>{if(t._sessionId){const r=this.apiInvokeUploadPendingItems.length;for(let i=0;i<r;i++){const s=this.apiInvokeUploadPendingItems.shift();s&&(s.sid=t._sessionId,this.sendApiInvoke(hr({},s)))}}})}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);var r;this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>it("NORMAL_EVENT_QUEUE_CAPACITY")&&Ye(r=this.normalEventUploadPendingItems).call(r,0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&ht()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const r=[],i=[];for(;e.length;){const h=e.shift();r.length<20?r.push(h):i.push(h)}e.push(...i);for(const h of[...r]){var s,l;xt(s=this.ltsList).call(s,h.data.lts)!==-1?(h.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(h.data.lts)):(this.ltsList.push(h.data.lts),Ua(l=this.ltsList).call(l,(p,m)=>p-m))}t||(this.lastSendNormalEventTime=ht());const d={msgType:"EventMessages",sentTs:Math.round(ht()/1e3),payloads:pt(r).call(r,h=>St(h)),vid:(h=>{const p=h&&h.data.sid&&this.baseInfoMap.get(h.data.sid);return p&&p.info.vid&&+p.info.vid||0})(r[0])};return r.length&&this.postDataToStatsCollector(d).catch((h=>p=>{var m,f,_;it("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=k(m=this.keyEventUploadPendingItems).call(m,h):(this.normalEventUploadPendingItems=k(f=this.normalEventUploadPendingItems).call(f,h),this.normalEventUploadPendingItems.length>it("NORMAL_EVENT_QUEUE_CAPACITY")&&(Ye(_=this.normalEventUploadPendingItems).call(_,0,this.normalEventUploadPendingItems.length-it("NORMAL_EVENT_QUEUE_CAPACITY")),S.warning("report: drop normal events"))))})(r)),e}async postDataToStatsCollector(e){var t,r,i;let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1];Rr.networkState===Pu.OFFLINE&&await ct.race([Rr.onlineWaiter,Mr(2*Ne.maxRetryTimeout)]);const l=s?"/events/proto-raws":"/events/messages";let d=this.url||(this.proxyServer?k(t=k(r="https://".concat(this.proxyServer,"/rs/?h=")).call(r,it("EVENT_REPORT_DOMAIN"),"&p=6443&d=")).call(t,l):k(i="https://".concat(it("EVENT_REPORT_DOMAIN"),":6443")).call(i,l));for(let f=0;f<2;f+=1){var h,p,m;f===1&&(d=this.backupUrl||(this.proxyServer?k(h=k(p="https://".concat(this.proxyServer,"/rs/?h=")).call(p,it("EVENT_REPORT_BACKUP_DOMAIN"),"&p=6443&d=")).call(h,l):k(m="https://".concat(it("EVENT_REPORT_BACKUP_DOMAIN"),":6443")).call(m,l)));try{s?await ly(d,{timeout:1e4,data:e}):await yn(d,{timeout:1e4,data:e})}catch(_){if(f===1)throw _;continue}return}}createBaseInfo(e,t){const r=hr({},j7);return r.sid=e,this.baseInfoMap.set(e,{info:r,startTime:t}),r}};class W7 extends Wr{constructor(t){super(),this._connectionState=pn.CLOSED,this.openConnectionTime=ht(),this.lastMsgTime=ht(),this.uploadCache=[],this.rttRolling=new $y(5),this.pingpongTimeoutCount=0,this.onWebsocketMessage=r=>{if(r.data instanceof ArrayBuffer)return void this.emit(Oe.ON_BINARY_DATA,r.data);const i=JSON.parse(r.data);if(this.lastMsgTime=ht(),Object.prototype.hasOwnProperty.call(i,"_id")){const s="res-@".concat(i._id);this.emit(s,i._result,i._message)}else if(Object.prototype.hasOwnProperty.call(i,"_type")&&(this.emit(i._type,i._message),i._type===nr.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===nr.ON_USER_BANNED))switch(i._message.error_code){case 14:this.close("UID_BANNED");break;case 15:this.close("IP_BANNED");break;case 16:this.close("CHANNEL_BANNED")}},this.clientId=t.clientId,this.spec=t,this.websocket=new rA("gateway-".concat(this.clientId),this.spec.retryConfig,!0),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===pn.CONNECTED&&this.reconnect("retry",yi.OFFLINE)})}get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===pn.CONNECTED?this.emit(Oe.WS_CONNECTED):t===pn.RECONNECTING?this.emit(Oe.WS_RECONNECTING,this._websocketReconnectReason):t===pn.CLOSED&&this.emit(Oe.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}async request(t,r,i,s){var l,d,h,p,m;const f=Pe(6,""),_={_id:f,_type:t,_message:r},v=this.websocket.connectionID,T=()=>new ct((j,nt)=>{if(this.connectionState===pn.CONNECTED)return j();const It=()=>{this.off(Oe.WS_CLOSED,vt),j()},vt=()=>{this.off(Oe.WS_CONNECTED,It),nt(new P(Ze.WS_ABORT))};this.once(Oe.WS_CONNECTED,It),this.once(Oe.WS_CLOSED,vt)});if(this.connectionState!==pn.CONNECTING&&this.connectionState!==pn.RECONNECTING||t===fr.JOIN||t===fr.REJOIN||await T(),this.websocket.sendMessage(_,!0),s)return;const R=new ct((j,nt)=>{let It=!1;const vt=(X,rt)=>{It=!0,j({isSuccess:X==="success",message:rt||{}}),this.off(Oe.WS_CLOSED,Rt),this.off(Oe.WS_RECONNECTING,Rt),this.emit(Oe.REQUEST_SUCCESS,t,r)};this.once("res-@".concat(f),vt);const Rt=()=>{nt(new P(Ze.WS_ABORT,"type: ".concat(t))),this.off(Oe.WS_CLOSED,Rt),this.off(Oe.WS_RECONNECTING,Rt),this.off("res-@".concat(f),vt)};this.once(Oe.WS_CLOSED,Rt),this.once(Oe.WS_RECONNECTING,Rt),Mr(it("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==v||It||(S.warning("ws request timeout, type: ".concat(t)),this.emit(Oe.REQUEST_TIMEOUT,t,r))})});let w=null;try{w=await R}catch(j){if(this.connectionState===pn.CLOSED||t===fr.LEAVE)throw new P(Ze.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?j.throw():t===fr.JOIN||t===fr.REJOIN?null:(await T(),await this.request(t,r))}if(w.isSuccess)return w.message;const O=Number(w.message.error_code||w.message.code),B=qp(O),K=new P(Ze.UNEXPECTED_RESPONSE,k(l="".concat(B.desc,": ")).call(l,w.message.error_str),{code:O,data:w.message});return B.action==="success"?w.message:(S.warning(k(d=k(h=k(p=k(m="[".concat(this.websocket.connectionID,"] unexpected response from type ")).call(m,t,", error_code: ")).call(p,O,", message: ")).call(h,B.desc,", action: ")).call(d,B.action)),B.action==="failed"?K.throw():B.action==="quit"?(this.initError=K,this.close(),K.throw()):(O===Zl.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=w.message.option,S.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",yi.MULTI_IP)):this.reconnect(B.action,yi.SERVER_ERROR),t===fr.JOIN||t===fr.REJOIN?null:await this.request(t,r)))}waitMessage(t,r){return new ct(i=>{const s=l=>{(!r||r(l))&&(this.off(t,s),i(l))};this.on(t,s)})}upload(t,r){const i={_type:t,_message:r};try{this.websocket.sendMessage(i)}catch{const d=it("MAX_UPLOAD_CACHE")||50;var s;this.uploadCache.push(i),this.uploadCache.length>d&&Ye(s=this.uploadCache).call(s,0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=be(()=>{var h;if(this.connectionState!==pn.CONNECTED)return;const p=Ye(h=this.uploadCache).call(h,0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(p._type,p._message)},it("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,r){const i={_type:t,_message:r};this.websocket.sendMessage(i)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,new ct((r,i)=>{this.once(Oe.WS_CONNECTED,()=>r(this.joinResponse)),this.once(Oe.WS_CLOSED,()=>i(this.initError||new P(Ze.WS_ABORT))),this.connectionState=pn.CONNECTING,this.websocket.init(t).catch(i),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=be(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||"LEAVE",this.connectionState=pn.CLOSED,this.websocket.close()}async join(){var t;if(!this.joinResponse){const r=Va(this,Oe.REQUEST_JOIN_INFO),i=await this.request(fr.JOIN,r);if(!i)return this.emit(Oe.REPORT_JOIN_GATEWAY,Ze.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=pn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=be(Lr(t=this.handlePingPong).call(t,this),3e3),!0}async rejoin(){var t,r;if(!this.reconnectToken)throw new P(Ze.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const i=Va(this,Oe.REQUEST_REJOIN_INFO);i.token=this.reconnectToken;const s=await this.request(fr.REJOIN,i);return!!s&&(this.connectionState=pn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=be(Lr(t=this.handlePingPong).call(t,this),3e3),s.peers&&V(r=s.peers).call(r,l=>{this.emit(nr.ON_USER_ONLINE,{uid:l.uid}),l.audio_mute?this.emit(nr.MUTE_AUDIO,{uid:l.uid}):this.emit(nr.UNMUTE_AUDIO,{uid:l.uid}),l.video_mute?this.emit(nr.MUTE_VIDEO,{uid:l.uid}):this.emit(nr.UNMUTE_VIDEO,{uid:l.uid}),l.audio_enable_local?this.emit(nr.ENABLE_LOCAL_AUDIO,{uid:l.uid}):this.emit(nr.DISABLE_LOCAL_AUDIO,{uid:l.uid}),l.video_enable_local?this.emit(nr.ENABLE_LOCAL_VIDEO,{uid:l.uid}):this.emit(nr.DISABLE_LOCAL_VIDEO,{uid:l.uid}),l.audio||l.video||this.emit(nr.ON_REMOVE_STREAM,{uid:l.uid,uint_id:l.uint_id}),l.audio&&this.emit(nr.ON_ADD_AUDIO_STREAM,{uid:l.uid,uint_id:l.uint_id,audio:!0}),l.video&&this.emit(nr.ON_ADD_VIDEO_STREAM,{uid:l.uid,uint_id:l.uint_id,video:!0})}),!0)}reconnect(t,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,r)}handleNotification(t){S.debug("[".concat(this.clientId,"] receive notification: "),t);const r=qp(t.code);if(r.action!=="success"){if(r.action!=="failed")return r.action==="quit"?(r.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close("UID_BANNED"),void this.close()):void this.reconnect(r.action,yi.SERVER_ERROR);S.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=it("PING_PONG_TIME_OUT"),r=ht();this.pingpongTimeoutCount>=t&&(S.warning("PINGPONG Timeout. Last Socket Message: ".concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>it("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",yi.TIMEOUT):this.request(fr.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=ht()-r;this.rttRolling.add(i),it("REPORT_STATS")&&this.send(fr.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:r}=this.websocket.getWsInflateData();t!==0&&r!==0&&this.upload(Qo.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:r,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(da.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(da.CLOSED,()=>{this.connectionState=pn.CLOSED}),this.websocket.on(da.FAILED,()=>{this._disconnectedReason="NETWORK_ERROR",this.connectionState=pn.CLOSED}),this.websocket.on(da.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===pn.CONNECTED?this.connectionState=pn.RECONNECTING:this.connectionState=pn.CONNECTING}),this.websocket.on(da.WILL_RECONNECT,(t,r)=>{if(Va(this,Oe.IS_P2P_DISCONNECTED)&&t==="retry")return this.reconnectToken=void 0,this.emit(Oe.NEED_RENEW_SESSION),this.emit(Oe.DISCONNECT_P2P),r("tryNext");t!=="retry"&&(this.reconnectToken=void 0,this.emit(Oe.NEED_RENEW_SESSION),this.emit(Oe.DISCONNECT_P2P)),r(t)}),this.websocket.on(da.CONNECTED,()=>{this.openConnectionTime=ht(),this.reconnectToken?this.rejoin().catch(t=>{var r;S.warning(k(r="[".concat(this.clientId,"] rejoin failed ")).call(r,t)),this.reconnect("tryNext",yi.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(Oe.REPORT_JOIN_GATEWAY,t.message||t.code,this.url||""),t instanceof P&&t.code===Ze.UNEXPECTED_RESPONSE&&t.data.code===Zl.ERR_NO_AUTHORIZED)return S.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",yi.SERVER_ERROR);S.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",yi.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(da.REQUEST_NEW_URLS,(t,r)=>{Ur(this,Oe.REQUEST_RECOVER,this.multiIpOption).then(t).catch(r)})}}var fi,MA;(function(e){e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5"})(fi||(fi={}));class Ob extends Wr{constructor(t,r){super(),this._hints=[],this._isClosed=!1,this._ID=r||Pe(8,"track-"),this._originMediaStreamTrack=t,this._mediaStreamTrack=t,lR(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){if(!t){const r=wt.reportApiInvoke(null,{name:de.GET_MEDIA_STREAM_TRACK,options:[],tag:zt.TRACER});this._mediaStreamTrack&&typeof this._mediaStreamTrack.label=="string"?r.onSuccess(this._mediaStreamTrack.label):r.onSuccess("")}return this._mediaStreamTrack}close(){this._isClosed=!0,dR(this)}}class UA extends Ob{constructor(t,r){super(t,r),this._enabled=!0,this._muted=!1,this._isClosed=!1,this._trackProcessors=[],this._handleTrackEnded=()=>{this.onTrackEnded()},this._enabledMutex=new wn("".concat(r)),t.addEventListener("ended",this._handleTrackEnded)}get muted(){return this._muted}get enabled(){return this._enabled}getTrackLabel(){return this._originMediaStreamTrack.label}close(){var t;this._isClosed||(this.stop(),V(t=this._trackProcessors).call(t,r=>r.destroy()),this._trackProcessors=[],this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,S.debug("[".concat(this.getTrackId(),"] close")),this.emit(Yt.NEED_CLOSE),super.close())}async _registerTrackProcessor(t){var r;if(xt(r=this._trackProcessors).call(r,t)!==-1)return;const i=this._trackProcessors[this._trackProcessors.length-1];this._trackProcessors.push(t),t.onOutputChange=async()=>{const s=t.output||this._originMediaStreamTrack;this._mediaStreamTrack=s,this._updatePlayerSource(),await Xe(this,Yt.NEED_REPLACE_TRACK,this._mediaStreamTrack)},i?(i.onOutputChange=async()=>{i.output&&await t.setInput(i.output)},await t.setInput(i.output||i.input||this._originMediaStreamTrack)):await t.setInput(this._originMediaStreamTrack)}_getOutputFromProcessors(){if(this._trackProcessors.length===0)return this._originMediaStreamTrack;const t=this._trackProcessors[this._trackProcessors.length-1];return t.output||t.input||this._originMediaStreamTrack}async _updateOriginMediaStreamTrack(t,r){if(t!==this._originMediaStreamTrack){if(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop(),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._trackProcessors.length>0){await this._trackProcessors[0].setInput(t);const i=this._getOutputFromProcessors();this._mediaStreamTrack=i}else this._mediaStreamTrack=this._originMediaStreamTrack;this._updatePlayerSource(),await Xe(this,Yt.NEED_REPLACE_TRACK,this._mediaStreamTrack)}}_getDefaultPlayerConfig(){return{}}onTrackEnded(){S.debug("[".concat(this.getTrackId(),"] track ended")),this.emit(ta.TRACK_ENDED)}stateCheck(t,r){var i,s,l;if(S.debug(k(i=k(s=k(l="check track state, [muted: ".concat(this._muted,", enabled: ")).call(l,this._enabled,"] to [")).call(s,t,": ")).call(i,r,"]")),t==="muted"&&!Dr().webAudioMediaStreamDest)throw new P(D.NOT_SUPPORTED,"current environment does not support set mute").print();if(Sc(r,t),this._enabled&&this._muted&&t==="enabled"&&r===!1)throw new P(D.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print();if(!this._enabled&&!this._muted&&t==="muted"&&r===!0)throw new P(D.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print()}}function xr(){return function(e,t,r){const i=e[t];typeof i=="function"&&(r.value=function(){this._isClosed&&new P(D.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning");for(var s=arguments.length,l=new Array(s),d=0;d<s;d++)l[d]=arguments[d];const h=i.apply(this,l);return h instanceof ct?new ct((p,m)=>{h.then(p).catch(m)}):h})}}function kb(e,t){var r=ae(e);if(Xt){var i=Xt(e);t&&(i=kt(i).call(i,function(s){return jt(e,s).enumerable})),r.push.apply(r,i)}return r}function xA(e){for(var t=1;t<arguments.length;t++){var r,i,s=arguments[t]!=null?arguments[t]:{};t%2?V(r=kb(Object(s),!0)).call(r,function(l){mr(e,l,s[l])}):Zt?ur(e,Zt(s)):V(i=kb(Object(s))).call(i,function(l){ie(e,l,jt(s,l))})}return e}(function(e){e.IOS_15_INTERRUPTION_START="ios15-interruption-start",e.IOS_15_INTERRUPTION_END="ios15-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end"})(MA||(MA={}));var Xi=function(e,t,r,i){var s,l=arguments.length,d=l<3?t:i===null?i=jt(t,r):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(e,t,r,i);else for(var h=e.length-1;h>=0;h--)(s=e[h])&&(d=(l<3?s(d):l>3?s(t,r,d):s(t,r))||d);return l>3&&d&&ie(t,r,d),d},Ue=function(e,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(e,t)};class bn extends UA{constructor(t,r,i){super(t,i),this.trackMediaType="audio",this._enabled=!0,this._volume=100,this._useAudioElement=!1,this._bypassWebAudio=!1,this._encoderConfig=r,this._source=new Fp(t)}get isPlaying(){return this._useAudioElement?Yr.isPlaying(this.getTrackId()):this._source.isPlayed}setVolume(t){Ie(t,"volume",0,1e3);const r=At.reportApiInvoke(null,{tag:zt.TRACER,name:de.LOCAL_AUDIO_TRACK_SET_VOLUME,options:[this.getTrackId(),t]},300);this._volume=t,this._source.setVolume(t/100),this._useAudioElement&&Yr.setVolume(this.getTrackId(),t);try{if(this._bypassWebAudio)return void S.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const i=this._source.createOutputTrack();this._mediaStreamTrack!==i&&(this._mediaStreamTrack=i,Xe(this,ue.NEED_REPLACE_TRACK,this._mediaStreamTrack).then(()=>{S.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(s=>{S.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),s)}))}catch{}r.onSuccess()}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}async setPlaybackDevice(t){const r=At.reportApiInvoke(null,{tag:zt.TRACER,name:de.REMOTE_AUDIO_SET_OUTPUT_DEVICE,options:[this.getTrackId(),t]});if(!this._useAudioElement)throw new P(D.NOT_SUPPORTED,"your browser does not support setting the audio output device");try{await Yr.setSinkID(this.getTrackId(),t)}catch(i){throw r.onError(i),i}r.onSuccess()}async setEnabled(t,r,i){var s;if(!i){if(t===this._enabled)return;this.stateCheck("enabled",t)}S.info("[".concat(this.getTrackId(),"] start setEnabled"),t);const l=await this._enabledMutex.lock();if(!t){this._originMediaStreamTrack.enabled=!1;try{await Xe(this,ue.NEED_REMOVE_TRACK,this)}catch(d){throw S.error("[".concat(this.getTrackId(),"] setEnabled to false error"),d.toString()),l(),d}return i||(this._enabled=!1),l()}this._originMediaStreamTrack.enabled=!0;try{await Xe(this,ue.NEED_ADD_TRACK,this)}catch(d){throw S.error("[".concat(this.getTrackId(),"] setEnabled to true error"),d.toString()),l(),d}S.info(k(s="[".concat(this.getTrackId(),"] setEnabled to ")).call(s,t," success")),i||(this._enabled=!0),l()}async setMuted(t){var r,i;if(this._bypassWebAudio)return S.debug(k(i="[".concat(this.getTrackId(),"] setMuted:")).call(i,t," fallback to setEnabled because no pass through.")),void await this.setEnabled(!t);if(t!==this._muted){if(this.stateCheck("muted",t),this._muted=t,Se().name===zl.FIREFOX)return S.debug("[".concat(this.getTrackId(),"] firefox set mute fallback to set enabled")),void await this.setEnabled(!t,void 0,!0);this._mediaStreamTrack.enabled=!t,S.debug(k(r="[".concat(this.getTrackId(),"] start set muted: ")).call(r,t)),await Xe(this,ue.SET_AUDIO_TRACK_MUTED,{track:this,muted:t})}}getStats(){return ys(()=>{S.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),po(this,ue.GET_STATS)||xA({},vb)}setAudioFrameCallback(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(Os.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(Os.ON_AUDIO_BUFFER),this._source.on(Os.ON_AUDIO_BUFFER,i=>t(i))}play(){const t=At.reportApiInvoke(null,{tag:zt.TRACER,name:de.LOCAL_AUDIO_TRACK_PLAY,options:[this.getTrackId()]});S.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(S.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Yr.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play(),t.onSuccess()}stop(){const t=At.reportApiInvoke(null,{tag:zt.TRACER,name:de.LOCAL_AUDIO_TRACK_STOP,options:[this.getTrackId()]});S.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Yr.stop(this.getTrackId()):this._source.stop(),t.onSuccess()}close(){super.close(),this._source.destroy()}_updatePlayerSource(){S.debug("[".concat(this.getTrackId(),"] update player source track")),this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Yr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(t,r){this._originMediaStreamTrack!==t&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t.addEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop(),this._originMediaStreamTrack=t,this._source.updateTrack(this._originMediaStreamTrack),this._mediaStreamTrack!==this._source.outputTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Xe(this,ue.NEED_REPLACE_TRACK,this._mediaStreamTrack)))}renewMediaStreamTrack(){return ct.resolve(void 0)}}Xi([xr(),Ue("design:type",Function),Ue("design:paramtypes",[String]),Ue("design:returntype",ct)],bn.prototype,"setPlaybackDevice",null),Xi([xr(),Ue("design:type",Function),Ue("design:paramtypes",[Boolean,Object,Boolean]),Ue("design:returntype",ct)],bn.prototype,"setEnabled",null),Xi([xr(),Up({report:At}),Ue("design:type",Function),Ue("design:paramtypes",[Boolean]),Ue("design:returntype",ct)],bn.prototype,"setMuted",null),Xi([xr(),Ue("design:type",Function),Ue("design:paramtypes",[]),Ue("design:returntype",Object)],bn.prototype,"getStats",null),Xi([xr(),Ue("design:type",Function),Ue("design:paramtypes",[Object,Number]),Ue("design:returntype",void 0)],bn.prototype,"setAudioFrameCallback",null),Xi([xr(),Ue("design:type",Function),Ue("design:paramtypes",[]),Ue("design:returntype",void 0)],bn.prototype,"play",null),Xi([xr(),Ue("design:type",Function),Ue("design:paramtypes",[]),Ue("design:returntype",void 0)],bn.prototype,"stop",null);class Bu extends bn{constructor(t,r,i,s){super(t,r.encoderConfig?Cc(r.encoderConfig):{},s),this._deviceName="default",this._enabled=!0,this._config=r,this._constraints=i,this._deviceName=t.label,typeof r.bypassWebAudio=="boolean"&&(this._bypassWebAudio=r.bypassWebAudio),Xs()&&le.bindInterruptDetectorTrack(this)}async setDevice(t){var r,i;const s=At.reportApiInvoke(null,{tag:zt.TRACER,name:de.MIC_AUDIO_TRACK_SET_DEVICE,options:[this.getTrackId(),t]});if(S.info(k(r="[".concat(this.getTrackId(),"] start set device to ")).call(r,t)),this._enabled)try{const l=await dn.getDeviceById(t),d={};d.audio=xA({},this._constraints),d.audio.deviceId={exact:t},this._originMediaStreamTrack.stop();let h=null;try{h=await on(d,this.getTrackId())}catch(p){throw S.error("[".concat(this.getTrackId(),"] setDevice failed"),p.toString()),h=await on({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),p}await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),this._deviceName=l.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(l){throw s.onError(l),S.error("[".concat(this.getTrackId(),"] setDevice error"),l.toString()),l}else try{const l=await dn.getDeviceById(t);this._deviceName=l.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(l){throw s.onError(l),S.error("[".concat(this.getTrackId(),"] setDevice error"),l.toString()),l}s.onSuccess(),S.info(k(i="[".concat(this.getTrackId(),"] set device to ")).call(i,t," success"))}async setEnabled(t,r,i){if(r)return S.debug("[".concat(this.getTrackId,"] setEnabled false (do not close microphone)")),await super.setEnabled(t);if(!i){if(t===this._enabled)return;this.stateCheck("enabled",t)}S.info("[".concat(this.getTrackId(),"] start setEnabled"),t);const s=await this._enabledMutex.lock();if(!t){this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),i||(this._enabled=!1);try{await Xe(this,ue.NEED_REMOVE_TRACK,this)}catch(h){throw S.error("[".concat(this.getTrackId(),"] setEnabled false failed"),h.toString()),s(),h}return void s()}const l=xA({},this._constraints),d=dn.searchDeviceIdByName(this._deviceName);d&&!l.deviceId&&(l.deviceId=d);try{const h=await on({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),await Xe(this,ue.NEED_ADD_TRACK,this)}catch(h){throw s(),S.error("[".concat(this.getTrackId(),"] setEnabled true failed"),h.toString()),h}i||(this._enabled=!0),S.info("[".concat(this.getTrackId(),"] setEnabled success")),s()}close(){super.close(),Xs()&&le.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((ui()||Zo())&&this._enabled&&!this._isClosed&&le.duringInterruption){const t=async()=>{le.off(MA.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(S.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};le.on(MA.IOS_INTERRUPTION_END,t)}else S.debug("[".concat(this.getTrackId(),"] track ended")),this.emit($l.TRACK_ENDED)}async renewMediaStreamTrack(){const t=xA({},this._constraints),r=dn.searchDeviceIdByName(this._deviceName);r&&!t.deviceId&&(t.deviceId=r);const i=await on({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!0)}}Xi([xr(),Ue("design:type",Function),Ue("design:paramtypes",[String]),Ue("design:returntype",ct)],Bu.prototype,"setDevice",null),Xi([xr(),Ue("design:type",Function),Ue("design:paramtypes",[Boolean,Boolean,Boolean]),Ue("design:returntype",ct)],Bu.prototype,"setEnabled",null);class td extends bn{constructor(t,r,i,s){super(r.createOutputTrack(),i,s),this.source=t,this._bufferSource=r,this._bufferSource.on(Os.AUDIO_SOURCE_STATE_CHANGE,l=>{this.emit($l.SOURCE_STATE_CHANGE,l)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(t){const r=At.reportApiInvoke(null,{tag:zt.TRACER,name:de.BUFFER_AUDIO_TRACK_START,options:[this.getTrackId(),t,this.duration]});t&&this._bufferSource.updateOptions(t),this._bufferSource.startProcessAudioBuffer(),r.onSuccess()}pauseProcessAudioBuffer(){const t=At.reportApiInvoke(null,{tag:zt.TRACER,name:de.BUFFER_AUDIO_TRACK_PAUSE,options:[this.getTrackId()]});this._bufferSource.pauseProcessAudioBuffer(),t.onSuccess()}seekAudioBuffer(t){const r=At.reportApiInvoke(null,{tag:zt.TRACER,name:de.BUFFER_AUDIO_TRACK_SEEK,options:[this.getTrackId()]});this._bufferSource.seekAudioBuffer(t),r.onSuccess()}resumeProcessAudioBuffer(){const t=At.reportApiInvoke(null,{tag:zt.TRACER,name:de.BUFFER_AUDIO_TRACK_RESUME,options:[this.getTrackId()]});this._bufferSource.resumeProcessAudioBuffer(),t.onSuccess()}stopProcessAudioBuffer(){const t=At.reportApiInvoke(null,{tag:zt.TRACER,name:de.BUFFER_AUDIO_TRACK_STOP,options:[this.getTrackId()]});this._bufferSource.stopProcessAudioBuffer(),t.onSuccess()}}Xi([xr(),Ue("design:type",Function),Ue("design:paramtypes",[Object]),Ue("design:returntype",void 0)],td.prototype,"startProcessAudioBuffer",null),Xi([xr(),Ue("design:type",Function),Ue("design:paramtypes",[]),Ue("design:returntype",void 0)],td.prototype,"pauseProcessAudioBuffer",null),Xi([xr(),Ue("design:type",Function),Ue("design:paramtypes",[Number]),Ue("design:returntype",void 0)],td.prototype,"seekAudioBuffer",null),Xi([xr(),Ue("design:type",Function),Ue("design:paramtypes",[]),Ue("design:returntype",void 0)],td.prototype,"resumeProcessAudioBuffer",null),Xi([xr(),Ue("design:type",Function),Ue("design:paramtypes",[]),Ue("design:returntype",void 0)],td.prototype,"stopProcessAudioBuffer",null);class ni extends bn{constructor(){const t=Ol().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,Pe(8,"track-mix-"));try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}get isActive(){var t;return!(!this.trackList.length||!ft(t=this.trackList).call(t,r=>!r.muted))}getSubTrackLabels(){var t;return pt(t=this.trackList).call(t,r=>r.getTrackLabel())}hasAudioTrack(t){var r;return xt(r=this.trackList).call(r,t)!==-1}addAudioTrack(t){var r;xt(r=this.trackList).call(r,t)===-1?(S.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):S.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){var r;if(xt(r=this.trackList).call(r,t)!==-1){S.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}na(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){var t;const r={};V(t=this.trackList).call(t,i=>{i._encoderConfig&&((i._encoderConfig.bitrate||0)>(r.bitrate||0)&&(r.bitrate=i._encoderConfig.bitrate),(i._encoderConfig.sampleRate||0)>(r.sampleRate||0)&&(r.sampleRate=i._encoderConfig.sampleRate),(i._encoderConfig.sampleSize||0)>(r.sampleSize||0)&&(r.sampleSize=i._encoderConfig.sampleSize),i._encoderConfig.stereo&&(r.stereo=!0))}),this._encoderConfig=r}}class Y7 extends Wr{constructor(){super(...arguments),this.resultStorage=new $t}setLocalAudioStats(t,r,i){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(i,r)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(i,r))}setLocalVideoStats(t,r,i){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(i,r)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(i,r)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(i))}setRemoteAudioStats(t,r){const i=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",i,this.checkAudioOutputLevel(r))}setRemoteVideoStats(t,r){const i=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",i,this.checkVideoDecode(r))}record(t,r,i){this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const s=this.resultStorage.get(t);if(s&&(s.result.push(i),s.result.length>=5)){var l;const d=qt(l=s.result).call(l,!0);s.isPrevNormal&&!d&&this.emit("exception",Db[t],t,r),!s.isPrevNormal&&d&&this.emit("exception",Db[t]+2e3,t+"_RECOVER",r),s.isPrevNormal=d,s.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,r){return r instanceof ni&&!r.isActive||!!r.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,r){let i=null;r._encoderConfig&&r._encoderConfig.frameRate&&(i=Mu(r._encoderConfig.frameRate));const s=t.captureFrameRate;return!i||!s||!(i>10&&s<5||i<10&&i>=5&&s<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checkSendVideoBitrate(t,r){return!!r.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,r){return r instanceof ni&&!r.isActive||!!r.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}const Db={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003};function Lb(e,t){var r=ae(e);if(Xt){var i=Xt(e);t&&(i=kt(i).call(i,function(s){return jt(e,s).enumerable})),r.push.apply(r,i)}return r}function Ds(e){for(var t=1;t<arguments.length;t++){var r,i,s=arguments[t]!=null?arguments[t]:{};t%2?V(r=Lb(Object(s),!0)).call(r,function(l){mr(e,l,s[l])}):Zt?ur(e,Zt(s)):V(i=Lb(Object(s))).call(i,function(l){ie(e,l,jt(s,l))})}return e}class ed{constructor(t){this.localConnectionsMap=new $t,this.remoteConnectionsMap=new $t,this.trafficStatsPeerList=[],this.updateStats=()=>{var r,i;V(r=this.remoteConnectionsMap).call(r,s=>{var l;const d=s.audioStats,h=s.videoStats,p=s.pcStats,m=Ds({},Op),f=Ds({},kp),_=Ds({},jm),v=s.connection.pc.getStats(),T=v.audioRecv[0],R=v.videoRecv[0],w=p?p.videoRecv[0]:void 0,O=s.connection.pc._statsFilter.videoIsReady===!0,B=this.trafficStats&&ft(l=this.trafficStats.peer_delay).call(l,K=>K.peer_uid===s.connection.getUserId());if(T){T.codec!=="opus"&&T.codec!=="aac"||(m.codecType=T.codec),T.outputLevel?m.receiveLevel=Math.round(32767*T.outputLevel):s.connection.user.audioTrack&&(m.receiveLevel=Math.round(32767*s.connection.user.audioTrack.getVolumeLevel())),m.receiveBytes=T.bytes,m.receivePackets=T.packets,m.receivePacketsLost=T.packetsLost,m.packetLossRate=m.receivePacketsLost/(m.receivePackets+m.receivePacketsLost),m.receiveBitrate=d?8*Math.max(0,m.receiveBytes-d.receiveBytes):0,m.totalDuration=d?d.totalDuration+1:1,m.totalFreezeTime=d?d.totalFreezeTime:0,m.freezeRate=m.totalFreezeTime/m.totalDuration,m.receiveDelay=T.jitterBufferMs;const K=s.connection.user.audioTrack;m.totalDuration>10&&ed.isRemoteAudioFreeze(K)&&(m.totalFreezeTime+=1)}if(R){R.codec!=="H264"&&R.codec!=="VP8"&&R.codec!=="VP9"&&R.codec!=="AV1X"||(f.codecType=R.codec),f.receiveBytes=R.bytes,f.receiveBitrate=h?8*Math.max(0,f.receiveBytes-h.receiveBytes):0,f.decodeFrameRate=R.decodeFrameRate,f.renderFrameRate=R.decodeFrameRate,R.outputFrame&&(f.renderFrameRate=R.outputFrame.frameRate),R.receivedFrame?(f.receiveFrameRate=R.receivedFrame.frameRate,f.receiveResolutionHeight=R.receivedFrame.height,f.receiveResolutionWidth=R.receivedFrame.width):s.connection.user.videoTrack&&(f.receiveResolutionHeight=s.connection.user.videoTrack._videoHeight||0,f.receiveResolutionWidth=s.connection.user.videoTrack._videoWidth||0),R.framesRateFirefox!==void 0&&(f.receiveFrameRate=Math.round(R.framesRateFirefox)),f.receivePackets=R.packets,f.receivePacketsLost=R.packetsLost,f.packetLossRate=f.receivePacketsLost/(f.receivePackets+f.receivePacketsLost),f.totalDuration=h?h.totalDuration+1:1,f.totalFreezeTime=h?h.totalFreezeTime:0,f.receiveDelay=R.jitterBufferMs||0;const K=s.connection.user.videoTrack;s.connection.subscribeOptions.video&&O&&ed.isRemoteVideoFreeze(K,R,w)&&(f.totalFreezeTime+=1),f.freezeRate=f.totalFreezeTime/f.totalDuration}B&&(m.end2EndDelay=B.B_ad,f.end2EndDelay=B.B_vd,m.transportDelay=B.B_ed,f.transportDelay=B.B_ed,m.currentPacketLossRate=B.B_ealr4/100,f.currentPacketLossRate=B.B_evlr4/100,_.uplinkNetworkQuality=B.B_punq?B.B_punq:0,_.downlinkNetworkQuality=B.B_pdnq?B.B_punq:0),s.audioStats=m,s.videoStats=f,s.pcStats=v,s.networkStats=_,s.connection.user.audioTrack&&this.exceptionMonitor.setRemoteAudioStats(s.connection.user.audioTrack,m),s.connection.user.videoTrack&&this.exceptionMonitor.setRemoteVideoStats(s.connection.user.videoTrack,f)}),V(i=this.localConnectionsMap).call(i,s=>{const l=s.audioStats,d=s.videoStats,h=Ds({},ou),p=Ds({},su),m=s.connection.pc.getStats(),f=m.audioSend[0],_=m.videoSend[0],v=s.connection.getUserId();f&&(f.codec!=="opus"&&f.codec!=="aac"||(h.codecType=f.codec),f.inputLevel?h.sendVolumeLevel=Math.round(32767*f.inputLevel):s.connection.audioTrack&&(h.sendVolumeLevel=Math.round(32767*s.connection.audioTrack.getVolumeLevel())),h.sendBytes=f.bytes,h.sendPackets=f.packets,h.sendPacketsLost=f.packetsLost,h.sendBitrate=l?8*Math.max(0,h.sendBytes-l.sendBytes):0),_&&(_.codec!=="H264"&&_.codec!=="VP8"&&_.codec!=="VP9"&&_.codec!=="AV1X"||(p.codecType=_.codec),p.sendBytes=_.bytes,p.sendBitrate=d?8*Math.max(0,p.sendBytes-d.sendBytes):0,_.inputFrame?(p.captureFrameRate=_.inputFrame.frameRate,p.captureResolutionHeight=_.inputFrame.height,p.captureResolutionWidth=_.inputFrame.width):s.connection.videoTrack&&(p.captureResolutionWidth=s.connection.videoTrack._videoWidth||0,p.captureResolutionHeight=s.connection.videoTrack._videoHeight||0),_.sentFrame?(p.sendFrameRate=_.sentFrame.frameRate,p.sendResolutionHeight=_.sentFrame.height,p.sendResolutionWidth=_.sentFrame.width):s.connection.videoTrack&&(p.sendResolutionWidth=s.connection.videoTrack._videoWidth||0,p.sendResolutionHeight=s.connection.videoTrack._videoHeight||0),_.avgEncodeMs&&(p.encodeDelay=_.avgEncodeMs),s.connection.videoTrack&&s.connection.videoTrack._encoderConfig&&s.connection.videoTrack._encoderConfig.bitrateMax&&(p.targetSendBitrate=1e3*s.connection.videoTrack._encoderConfig.bitrateMax),p.sendPackets=_.packets,p.sendPacketsLost=_.packetsLost,p.totalDuration=d?d.totalDuration+1:1,p.totalFreezeTime=d?d.totalFreezeTime:0,this.isLocalVideoFreeze(_)&&(p.totalFreezeTime+=1)),this.trafficStats&&(h.sendPacketsLost=this.trafficStats.B_palr4/100,p.sendPacketsLost=this.trafficStats.B_pvlr4/100),s.audioStats=h,s.videoStats=p,s.audioStats&&s.connection.audioTrack&&this.exceptionMonitor.setLocalAudioStats(v,s.connection.audioTrack,s.audioStats),s.videoStats&&s.connection.videoTrack&&this.exceptionMonitor.setLocalVideoStats(v,s.connection.videoTrack,s.videoStats)})},this.clientId=t,this.updateStatsInterval=be(this.updateStats,1e3),this.exceptionMonitor=new Y7,this.exceptionMonitor.on("exception",(r,i,s)=>{this.onStatsException&&this.onStatsException(r,i,s)})}reset(){this.localConnectionsMap=new $t,this.remoteConnectionsMap=new $t,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(t){const r=this.localConnectionsMap.get(t);return r&&r.audioStats?r.audioStats:Ds({},ou)}getLocalVideoTrackStats(t){const r=this.localConnectionsMap.get(t);return r&&r.videoStats?r.videoStats:Ds({},su)}getRemoteAudioTrackStats(t){var r;const i=this.remoteConnectionsMap.get(t);if(!i||!i.audioStats)return Ds({},Op);if(!this.trafficStats)return i.audioStats;const s=ft(r=this.trafficStats.peer_delay).call(r,l=>l.peer_uid===i.connection.user.uid);return s&&(i.audioStats.publishDuration=s.B_ppad+(ht()-this.trafficStats.timestamp)),i.audioStats}getRemoteNetworkQualityStats(t){const r=this.remoteConnectionsMap.get(t);return r&&r.networkStats?r.networkStats:Ds({},jm)}getRemoteVideoTrackStats(t){var r;const i=this.remoteConnectionsMap.get(t);if(!i||!i.videoStats)return Ds({},kp);if(!this.trafficStats)return i.videoStats;const s=ft(r=this.trafficStats.peer_delay).call(r,l=>l.peer_uid===i.connection.user.uid);return s&&(i.videoStats.publishDuration=s.B_ppvd+(ht()-this.trafficStats.timestamp)),i.videoStats}getRTCStats(){var t,r;let i=0,s=0,l=0,d=0;V(t=this.localConnectionsMap).call(t,p=>{p.audioStats&&(i+=p.audioStats.sendBytes,s+=p.audioStats.sendBitrate),p.videoStats&&(i+=p.videoStats.sendBytes,s+=p.videoStats.sendBitrate)}),V(r=this.remoteConnectionsMap).call(r,p=>{p.audioStats&&(l+=p.audioStats.receiveBytes,d+=p.audioStats.receiveBitrate),p.videoStats&&(l+=p.videoStats.receiveBytes,d+=p.videoStats.receiveBitrate)});let h=1;return this.trafficStats&&(h+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:h,SendBitrate:s,SendBytes:i,RecvBytes:l,RecvBitrate:d,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}removeConnection(t){this.localConnectionsMap.delete(t),this.remoteConnectionsMap.delete(t)}addLocalConnection(t){const r=t.connectionId;this.localConnectionsMap.has(r)||this.localConnectionsMap.set(r,{connection:t})}addRemoteConnection(t){const r=t.connectionId;this.remoteConnectionsMap.has(r)||this.remoteConnectionsMap.set(r,{connection:t})}updateTrafficStats(t){var r;const i=kt(r=t.peer_delay).call(r,s=>{var l;return xt(l=this.trafficStatsPeerList).call(l,s.peer_uid)===-1});V(i).call(i,s=>{var l,d;const h=ft(l=Qe(ia(d=this.remoteConnectionsMap).call(d))).call(l,p=>p.connection._userId===s.peer_uid);s.B_ppad!==void 0&&s.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(s.peer_uid,s.B_ppad,s.B_ppvd,h?ht()-h.connection.startTime:0),this.trafficStatsPeerList.push(s.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){var r;this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&S.debug(k(r="[".concat(this.clientId,"]: Period fir changes to ")).call(r,t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,r,i){if(!t)return!1;const s=!!i&&r.framesDecodeFreezeTime>i.framesDecodeFreezeTime,l=!i||r.framesDecodeCount>i.framesDecodeCount;return s||!l}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}}function Pb(e,t){var r=ae(e);if(Xt){var i=Xt(e);t&&(i=kt(i).call(i,function(s){return jt(e,s).enumerable})),r.push.apply(r,i)}return r}function FA(e){for(var t=1;t<arguments.length;t++){var r,i,s=arguments[t]!=null?arguments[t]:{};t%2?V(r=Pb(Object(s),!0)).call(r,function(l){mr(e,l,s[l])}):Zt?ur(e,Zt(s)):V(i=Pb(Object(s))).call(i,function(l){ie(e,l,jt(s,l))})}return e}function q7(e){if(!e.address||!e.tcp)throw new P(D.UNEXPECTED_RESPONSE,"Invalid address format ".concat(e));return e.address.match(/^[\.\:\d]+$/)?"".concat(e.address.replace(/[^\d]/g,"-"),".edge.agora.io"):(S.info("Cannot recognized as IP address ".concat(e.address,". Used As Host instead")),k(t="".concat(e.address,":")).call(t,e.tcp));var t}function Bb(e,t){var r;const i=it("GATEWAY_DOMAINS");let s=i[1]&&xt(t).call(t,i[1])!==-1?1:0;return e.addresses=e.addresses||[],{gatewayAddrs:pt(r=e.addresses).call(r,l=>{var d,h,p;return l.ip.match(/^[\.\:\d]+$/)?k(d=k(h="".concat(l.ip.replace(/[^\d]/g,"-"),".")).call(h,i[s++%i.length],":")).call(d,l.port):(S.info("Cannot recognized as IP address ".concat(l.ip,". Used As Host instead")),k(p="".concat(l.ip,":")).call(p,l.port))}),uid:e.uid,cid:e.cid,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function Mu(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function Mb(e,t){const r=e.videoSend[0];if(!r)return null;const i=t&&t.videoSend[0]?t.videoSend[0].inputFrame:void 0,s={id:Pe(10,""),timestamp:new Date(e.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:r.ssrc.toString()};return r.inputFrame&&(i&&r.inputFrame.height===i.height||(s.A_fhi=r.inputFrame.height?r.inputFrame.height.toString():"0"),i&&r.inputFrame.width===i.width||(s.A_fwi=r.inputFrame.width?r.inputFrame.width.toString():"0"),i&&r.inputFrame.frameRate===i.frameRate||(s.A_fri=r.inputFrame.frameRate?r.inputFrame.frameRate.toString():"0")),s}function Ub(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function J7(e,t){const r={};if(e.height&&e.width){const i=t._videoHeight||t.getMediaStreamTrack(!0).getSettings().height;r.scaleResolutionDownBy=i?i/Mu(e.height):4}return r.maxFramerate=e.framerate?Mu(e.framerate):void 0,r.maxBitrate=e.bitrate?1e3*e.bitrate:void 0,r}function S_(e,t){var r;let i,s,l;switch(t){case fi.CHOOSE_SERVER:i=4096,s="choose server";break;case fi.CLOUD_PROXY:i=1048576,s="proxy";break;case fi.CLOUD_PROXY_5:i=4194304,s="proxy5";break;default:throw new P(D.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(V(r=e.response_body).call(r,d=>{var h;d.buffer&&d.buffer.flag===i&&(l={code:d.buffer.code,addresses:pt(h=d.buffer.edges_services).call(h,p=>FA(FA({},p),{},{ticket:d.buffer.cert})),server_ts:e.enter_ts,uid:d.buffer.uid,cid:d.buffer.cid,cname:d.buffer.cname,detail:FA(FA({},d.buffer.detail),e.detail),flag:d.buffer.flag,opid:e.opid})}),!l)throw new P(D.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(s," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return l}function z7(e){var t;return pt(t=e.addresses).call(t,r=>({address:r.ip,tcpport:r.port,udpport:r.port,username:qe.username,password:qe.password}))}function xb(e,t){var r=ae(e);if(Xt){var i=Xt(e);t&&(i=kt(i).call(i,function(s){return jt(e,s).enumerable})),r.push.apply(r,i)}return r}function Uu(e){for(var t=1;t<arguments.length;t++){var r,i,s=arguments[t]!=null?arguments[t]:{};t%2?V(r=xb(Object(s),!0)).call(r,function(l){mr(e,l,s[l])}):Zt?ur(e,Zt(s)):V(i=xb(Object(s))).call(i,function(l){ie(e,l,jt(s,l))})}return e}const T_=new $t;class X7 extends Wr{constructor(t){super(),this.inChannelInfo={joinAt:null,duration:0},this._state="DISCONNECTED",this.needToSendUnpubUnsub=new $t,this.isSignalRecover=!1,this.hasChangeBGPAddress=!1,this.joinGatewayStartTime=0,this._signalTimeout=!1,this.clientId=t.clientId,this.spec=t,this.signal=new W7(Uu(Uu({},t),{},{retryConfig:t.websocketRetryConfig})),this._statsCollector=t.statsCollector,this.role=t.role||"audience",this._clientRoleOptions=t.clientRoleOptions,this.handleSignalEvents()}get state(){return this._state}set state(t){if(t===this._state)return;const r=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(Eo.CONNECTION_STATE_CHANGE,t,r,this._disconnectedReason):this.emit(Eo.CONNECTION_STATE_CHANGE,t,r)}async join(t,r){var i,s;t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const l=ht();let d=T_.get(t.cname);if(d||(d=new $t,T_.set(t.cname,d)),d.has(t.uid)){const m=new P(D.UID_CONFLICT);throw wt.joinGateway(t.sid,{lts:l,succ:!1,ec:m.message,addr:null,uid:t.uid,cid:t.cid}),m}d.set(t.uid,!0),this.joinInfo=t,this.key=r;const h=t.proxyServer?pt(i=t.gatewayAddrs).call(i,m=>{var f,_;const v=m.split(":");return k(f=k(_="wss://".concat(t.proxyServer,"/ws/?h=")).call(_,v[0],"&p=")).call(f,v[1])}):pt(s=t.gatewayAddrs).call(s,m=>"wss://".concat(m));let p=0;this.joinGatewayStartTime=l;try{p=(await this.signal.init(h)).uid}catch(m){throw S.error("[".concat(this.clientId,"] User join failed"),m.toString()),wt.joinGateway(t.sid,{lts:l,succ:!1,ec:m.message,addr:this.signal.url,uid:t.uid,cid:t.cid}),d.delete(t.uid),this.signal.close(),m}return this.state="CONNECTED",this.inChannelInfo.joinAt=ht(),S.debug("[".concat(this.clientId,"] Connected to gateway server")),this.trafficStatsInterval=be(()=>{this.updateTrafficStats().catch(m=>{S.warning("[".concat(this.clientId,"] get traffic stats error"),m.toString())})},3e3),this.networkQualityInterval=be(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Eo.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Eo.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Eo.NETWORK_QUALITY,{uplinkNetworkQuality:Ub(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:Ub(this._statsCollector.trafficStats.B_dnq)}):this.emit(Eo.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),p}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];if(this.state!=="DISCONNECTED"){this.state="DISCONNECTING";try{t||this.signal.connectionState!==pn.CONNECTED||await Uy(this.signal.request(fr.LEAVE,void 0,!0),3e3)}catch(r){S.warning("[".concat(this.clientId,"] leave request failed, ignore"),r)}this.signal.close(),this.reset(),this.state="DISCONNECTED"}}async publish(t,r){if(!this.joinInfo)throw new P(D.UNEXPECTED_ERROR,"publish no joinInfo");const i=t.getUserId(),s=t.videoTrack?function(l){var d;const h=l._encoderConfig;if(!h)return{};const p={resolution:h.width&&h.height?k(d="".concat(Mu(h.width),"x")).call(d,Mu(h.height)):void 0,maxVideoBW:h.bitrateMax,minVideoBW:h.bitrateMin};return typeof h.frameRate=="number"?(p.maxFrameRate=h.frameRate,p.minFrameRate=h.frameRate):h.frameRate&&(p.maxFrameRate=h.frameRate.max||h.frameRate.ideal||h.frameRate.exact||h.frameRate.min,p.minFrameRate=h.frameRate.min||h.frameRate.ideal||h.frameRate.exact||h.frameRate.max),p}(t.videoTrack):{};if(t.on(oe.NEED_ANSWER,(l,d,h)=>{var p;const m={state:"offer",stream_type:r,p2p_id:t.pc.ID,sdp:St(l),audio:!!t.audioTrack,video:!!t.videoTrack,screen:t.videoTrack&&xt(p=t.videoTrack._hints).call(p,Kn.SCREEN_TRACK)!==-1,attributes:s,dtx:t.audioTrack instanceof Bu&&t.audioTrack._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1,mode:this.spec.mode,codec:this.spec.codec,extend:it("PUB_EXTEND")};if(t.audioTrack&&t.audioTrack instanceof ni&&t.audioTrack){const f={stream_id:this.joinInfo&&(this.joinInfo.stringUid||this.joinInfo.uid),action:""};t.audioTrack.isActive?f.action="unmute_local_audio":f.action="mute_local_audio",this.sendControl(f)}if(t.videoTrack){const f={stream_id:this.joinInfo&&(this.joinInfo.stringUid||this.joinInfo.uid),action:""};t.videoTrack.muted?f.action="mute_local_video":f.action="unmute_local_video",this.sendControl(f)}this.signal.request(fr.PUBLISH,m,!0).then(f=>{i&&this.needToSendUnpubUnsub.set(i,!0),d(JSON.parse(f.sdp))}).catch(f=>{if(l.retry&&f.data&&f.data.code===Zl.ERR_PUBLISH_REQUEST_INVALID)return S.warning("[".concat(this.clientId,"] receiver publish error code, retry"),f.toString()),Ur(t,oe.NEED_UNPUB).then(()=>{l.retry=!1,Ur(t,oe.NEED_ANSWER,l).then(d).catch(h)});f.code!==D.WS_ABORT&&h(f)})}),t.on(oe.NEED_RENEGOTIATE,(l,d,h)=>{const p={state:"negotiation",stream_type:r,p2p_id:t.pc.ID,sdp:l};this.signal.request(fr.PUBLISH,p,!0).then(m=>{d(JSON.parse(m.sdp))}).catch(m=>{m.code!==D.WS_ABORT&&h(m)})}),t.on(oe.NEED_UNPUB,l=>i&&!this.needToSendUnpubUnsub.has(i)?l(!1):this.state==="RECONNECTING"?l(!0):void this.signal.request(fr.UNPUBLISH,{stream_id:t.getUserId(),stream_type:r},!0).then(()=>l(!1)).catch(d=>{S.warning("unpublish warning: ",d),l(!0)})),t.on(oe.NEED_UPLOAD,(l,d)=>{this.signal.upload(l,{stream_type:r,stats:d})}),t.on(oe.NEED_SIGNAL_RTT,l=>{l(this.signal.rtt)}),t.on(oe.NEED_CONTROL,(l,d,h)=>{let p;if(l.type==="video"&&l.muted)p="mute_local_video";else if(l.type!=="video"||l.muted)if(l.type==="audio"&&l.muted)p="mute_local_audio";else{if(l.type!=="audio"||l.muted)return;p="unmute_local_audio"}else p="unmute_local_video";const m={stream_id:this.joinInfo&&(this.joinInfo.stringUid||this.joinInfo.uid),action:p};this.sendControl(m).then(d).catch(h)}),this.state!=="RECONNECTING"){if(this.state!=="CONNECTED")return new P(D.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state)).throw();await t.startP2PConnection()}else t.readyToReconnectPC()}async subscribe(t){if(!this.joinInfo)throw new P(D.UNEXPECTED_ERROR,"subscribe no joinInfo");const r=t.getUserId();if(t.on(oe.NEED_ANSWER,(i,s,l)=>{const d=t.subscribeOptions,h={stream_id:t.getUserId(),audio:!!d.audio,video:!!d.video,mode:this.spec.mode,codec:this.spec.codec,p2p_id:t.pc.ID,sdp:St(i),tcc:!!it("SUBSCRIBE_TCC"),extend:it("SUB_EXTEND")};this.signal.request(fr.SUBSCRIBE,h,!0).then(p=>{this.needToSendUnpubUnsub.set(r,!0),s(JSON.parse(p.sdp))}).catch(p=>{if(i.retry&&p.data&&p.data.code===Zl.ERR_SUBSCRIBE_REQUEST_INVALID)return S.warning("[".concat(this.clientId,"] receiver subscribe error code, retry"),p.toString()),Ur(t,oe.NEED_UNSUB).then(()=>{i.retry=!1,Ur(t,oe.NEED_ANSWER,i).then(s).catch(l)});p.code!==D.WS_ABORT&&l(p)})}),t.on(oe.NEED_UNSUB,i=>this.needToSendUnpubUnsub.has(r)?this.state==="RECONNECTING"?i(!0):void this.signal.request(fr.UNSUBSCRIBE,{stream_id:t.getUserId()},!0).then(()=>i(!1)).catch(s=>{S.warning("unsubscribe warning",s),i(!0)}):i(!1)),t.on(oe.NEED_UPLOAD,(i,s)=>{this.signal.upload(i,{stream_id:t.getUserId(),stats:s})}),t.on(oe.NEED_SIGNAL_RTT,i=>{i(this.signal.rtt)}),this.state!=="RECONNECTING"){if(this.state!=="CONNECTED")return new P(D.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state)).throw();await t.startP2PConnection()}else t.readyToReconnectPC()}async subscribeChange(t,r){var i,s;if(!this.joinInfo)throw new P(D.UNEXPECTED_ERROR,"subscribe no joinInfo");if(await t.setSubscribeOptions(r),this.state!=="RECONNECTING"){if(this.state!=="CONNECTED")return new P(D.INVALID_OPERATION,"can not subscribe change when connection state is ".concat(this.state)).throw();S.debug(k(i=k(s="[".concat(this.clientId,"] send subscribe change, audio: ")).call(s,r.audio,", video: ")).call(i,r.video)),await this.signal.request(fr.SUBSCRIBE_CHANGE,{stream_id:t.getUserId(),audio:!!r.audio,video:!!r.video},!0)}}async sendControl(t){this.signal.request(fr.CONTROL,t,!0,!0)}async unsubscribe(t){await t.closeP2PConnection()}getGatewayInfo(){return this.signal.request(fr.GATEWAY_INFO)}renewToken(t){return this.signal.request(fr.RENEW_TOKEN,{token:t})}async setClientRole(t,r){if(r&&(this._clientRoleOptions=hr({},r)),this.state!=="CONNECTED")return void(this.role=t);let i;i=t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:0,await this.signal.request(fr.SET_CLIENT_ROLE,{role:t,level:i}),this.role=t}async setRemoteVideoStreamType(t,r){await this.signal.request(fr.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:r})}async setStreamFallbackOption(t,r){await this.signal.request(fr.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:r})}async pickSVCLayer(t,r){await this.signal.request(fr.PICK_SVC_LAYER,{stream_id:t,spatial_layer:r.spatialLayer,temporal_layer:r.temporalLayer})}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=ht()-this.inChannelInfo.joinAt),Uu({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(fr.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=ht()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=T_.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.needToSendUnpubUnsub=new $t,this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=function(r){const i=r.match(/(wss\:\/\/)?([^:]+):(\d+)/);return i?{username:qe.username,password:qe.password,turnServerURL:i[2],tcpport:Tr(i[3])+30,udpport:Tr(i[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex])||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Uu(Uu({},qe),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){var t;if(this.state!=="CONNECTED")return;const r=await this.signal.request(fr.TRAFFIC_STATS,void 0,!0);r.timestamp=ht(),V(t=r.peer_delay).call(t,i=>{var s;const l=this._statsCollector.trafficStats&&ft(s=this._statsCollector.trafficStats.peer_delay).call(s,d=>d.peer_uid===i.peer_uid);l&&l.B_st!==i.B_st&&sn(()=>{this.emit(Eo.STREAM_TYPE_CHANGE,i.peer_uid,i.B_st)})}),this._statsCollector.updateTrafficStats(r)}getJoinMessage(){if(!this.joinInfo||!this.key)throw new P(D.UNEXPECTED_ERROR,"can not generate join message, no join info");const t=hr({},this.joinInfo.apResponse);let r=it("REPORT_APP_SCENARIO");if(typeof r!="string")try{r=St(r)}catch{r=void 0}r&&r.length>128&&(r=void 0);const i={session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Tn,browser:navigator.userAgent,process_id:it("PROCESS_ID"),mode:this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:t,extend:it("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:r};return this.joinInfo.stringUid&&(i.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(i.aes_mode=this.joinInfo.aesmode,it("ENCRYPT_AES")?(i.aes_secret=this.joinInfo.aespassword,i.aes_encrypt=!0):i.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(i.aes_salt=this.joinInfo.aessalt)),t.addresses[this.signal.websocket.currentURLIndex]&&(i.ap_response.ticket=t.addresses[this.signal.websocket.currentURLIndex].ticket,delete t.addresses),i}getRejoinMessage(){if(!this.joinInfo)throw new P(D.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Oe.WS_RECONNECTING,t=>{this.joinInfo&&wt.WebSocketQuit(this.joinInfo.sid,{lts:ht(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||yi.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",wt.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode}),this.isSignalRecover=!1,this.joinGatewayStartTime=ht())}),this.signal.on(Oe.WS_CLOSED,t=>{let r;switch(t){case"LEAVE":r=yi.LEAVE;break;case"UID_BANNED":case"IP_BANNED":case"CHANNEL_BANNED":case"SERVER_ERROR":r=yi.SERVER_ERROR;break;default:r=yi.NETWORK_ERROR}S.debug("[signal] websocket closed, reason: ".concat(r||"undefined -> "+yi.NETWORK_ERROR)),this.joinInfo&&wt.WebSocketQuit(this.joinInfo.sid,{lts:ht(),succ:t==="LEAVE"?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r}),this.reset(),this._disconnectedReason=t,this.state="DISCONNECTED"}),this.signal.on(Oe.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){var t,r,i;if(this.role==="audience"&&this._clientRoleOptions&&this._clientRoleOptions.level&&(S.debug(k(t=k(r=k(i="[".concat(this.clientId,"] patch to send set client role, role: ")).call(i,this.role,", mode: ")).call(r,this.spec.mode,", level: ")).call(t,this._clientRoleOptions&&this._clientRoleOptions.level)),this.setClientRole(this.role,this._clientRoleOptions)),wt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid}),this.joinInfo.useLocalAccessPoint){const l=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);var s;if(!l)return void S.error(k(s="[".concat(this.clientId,"] set local access point after joined failed: ")).call(s,l));jr("EVENT_REPORT_DOMAIN",l[1]),jr("EVENT_REPORT_BACKUP_DOMAIN",l[1]),jr("LOG_UPLOAD_SERVER","".concat(l[1],":6444"))}}}),this.signal.on(nr.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(Oe.REQUEST_RECOVER,(t,r,i)=>{if(!this.joinInfo)return i(new P(D.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Ur(this,Eo.REQUEST_NEW_GATEWAY_LIST).then(r).catch(i)}),this.signal.on(Oe.REQUEST_JOIN_INFO,t=>{t(this.getJoinMessage())}),this.signal.on(Oe.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(Oe.REPORT_JOIN_GATEWAY,(t,r)=>{this.joinInfo&&wt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:t,addr:r,uid:this.joinInfo.uid,cid:this.joinInfo.cid})}),this.signal.on(Oe.IS_P2P_DISCONNECTED,t=>{t(Va(this,Eo.IS_P2P_DISCONNECTED))}),this.signal.on(Oe.DISCONNECT_P2P,()=>{this.needToSendUnpubUnsub=new $t,this.emit(Eo.DISCONNECT_P2P)}),this.signal.on(Oe.NEED_RENEW_SESSION,()=>{this.emit(Eo.NEED_RENEW_SESSION)}),this.signal.on(Oe.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Oe.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0})}}function Fb(e,t){var r=ae(e);if(Xt){var i=Xt(e);t&&(i=kt(i).call(i,function(s){return jt(e,s).enumerable})),r.push.apply(r,i)}return r}function Qb(e){for(var t=1;t<arguments.length;t++){var r,i,s=arguments[t]!=null?arguments[t]:{};t%2?V(r=Fb(Object(s),!0)).call(r,function(l){mr(e,l,s[l])}):Zt?ur(e,Zt(s)):V(i=Fb(Object(s))).call(i,function(l){ie(e,l,jt(s,l))})}return e}let R_=1;function Z7(e,t,r,i,s){R_+=1;const l={sid:r.sid,command:"convergeAllocateEdge",uid:"666",appId:r.appId,ts:Math.floor(ht()/1e3),seq:R_,requestId:R_,version:Tn,cname:r.cname},d={service_name:t,json_body:St(l)};let h,p,m=e[0];return Wn(async()=>{h=ht();const f=await yn(m,{data:d,cancelToken:i,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(p=ht()-h,f.code!==0){const R=new P(D.UNEXPECTED_RESPONSE,"live streaming ap error, code"+f.code,{retry:!0,responseTime:p});throw S.error(R.toString()),R}const _=JSON.parse(f.json_body);if(_.code!==200){var v;const R=new P(D.UNEXPECTED_RESPONSE,k(v="live streaming app center error, code: ".concat(_.code,", reason: ")).call(v,_.reason),{code:_.code,responseTime:p});throw S.error(R.toString()),R}if(!_.servers||_.servers.length===0){const R=new P(D.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:_.code,responseTime:p});throw S.error(R.toString()),R}const T=function(R,w){var O;return{addressList:pt(O=R.servers).call(O,B=>{var K,j;return k(K=k(j="wss://".concat(B.address.replace(/\./g,"-"),".edge.agora.io:")).call(j,B.wss,"?serviceName=")).call(K,encodeURIComponent(w))}),workerToken:R.workerToken,vid:R.vid}}(_,t);return it("LIVE_STREAMING_ADDRESS")&&(T.addressList=it("LIVE_STREAMING_ADDRESS")instanceof Array?it("LIVE_STREAMING_ADDRESS"):[it("LIVE_STREAMING_ADDRESS")]),Qb(Qb({},T),{},{responseTime:p})},(f,_)=>(wt.apworkerEvent(r.sid,{success:!0,sc:200,serviceName:t,responseDetail:St(f.addressList),firstSuccess:_===0,responseTime:p,serverIp:e[_%e.length]}),!1),(f,_)=>(wt.apworkerEvent(r.sid,{success:!1,sc:f.data&&f.data.code||200,serviceName:t,responseTime:p,serverIp:e[_%e.length]}),!!(f.code!==D.OPERATION_ABORTED&&f.code!==D.UNEXPECTED_RESPONSE||f.data&&f.data.retry)&&(m=e[(_+1)%e.length],!0)),s)}function Vb(e,t,r,i){let{url:s,areaCode:l}=e;const d=ht(),[h,p]=Kb(t,l,[fi.CHOOSE_SERVER]);let m=Rr.networkState;return Wn(async()=>{m&&Rr.networkState===Pu.OFFLINE&&Rr.onlineWaiter&&await ct.race([Rr.onlineWaiter,Mr(i&&i.maxRetryTimeout||Ne.maxRetryTimeout)]),m=Rr.networkState;const f=await yn(s,{data:h,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0);jb(f,s,t,d,[fi.CHOOSE_SERVER]);const _=S_(f,fi.CHOOSE_SERVER);return Hb(_),Bb(_,s)},f=>(f&&wt.joinChooseServer(t.sid,{lts:d,succ:!0,csAddr:s,opid:p,serverList:f.gatewayAddrs,ec:null,cid:f.cid.toString(),uid:f.uid.toString(),csIp:f.csIp,unilbsServerIds:[fi.CHOOSE_SERVER].toString()}),!1),f=>f.code!==D.OPERATION_ABORTED&&(f.code===D.CAN_NOT_GET_GATEWAY_SERVER?f.data.retry:(wt.joinChooseServer(t.sid,{lts:d,succ:!1,csAddr:s,serverList:null,opid:p,ec:f.code,csIp:f.data&&f.data.csIp,unilbsServerIds:[fi.CHOOSE_SERVER].toString(),extend:St({networkState:m})}),S.warning("[".concat(t.clientId,"] Choose server network error, retry"),f),!0)),i)}function Gb(e,t,r,i){let{url:s,areaCode:l,serviceIds:d}=e;const h=ht(),[p,m]=Kb(t,l,d);let f;return Wn(async()=>{f&&Rr.networkState===Pu.OFFLINE&&Rr.onlineWaiter&&await ct.race([Rr.onlineWaiter,Mr(i&&i.maxRetryTimeout||Ne.maxRetryTimeout)]),f=Rr.networkState;const _=await yn(s,{data:p,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0);jb(_,s,t,h,d);const v=S_(_,fi.CHOOSE_SERVER),T=S_(_,t.cloudProxyServer==="proxy5"?fi.CLOUD_PROXY_5:fi.CLOUD_PROXY);return Hb(v),{gatewayInfo:Bb(v,s),proxyInfo:T,url:s}},_=>{var v;return _.gatewayInfo&&wt.joinChooseServer(t.sid,{lts:h,succ:!0,csAddr:s,serverList:_.gatewayInfo.gatewayAddrs,ec:null,opid:m,cid:_.gatewayInfo.cid.toString(),uid:_.gatewayInfo.uid.toString(),csIp:_.gatewayInfo.csIp,unilbsServerIds:d.toString()}),_.proxyInfo&&wt.joinWebProxyAP(t.sid,{lts:h,sucess:1,apServerAddr:s,turnServerAddrList:pt(v=_.proxyInfo.addresses).call(v,T=>T.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:d.toString()}),!1},_=>_.code!==D.OPERATION_ABORTED&&(_.code===D.CAN_NOT_GET_GATEWAY_SERVER?_.data.retry:(wt.joinWebProxyAP(t.sid,{lts:h,sucess:0,apServerAddr:s,turnServerAddrList:null,errorCode:_.code,eventType:t.cloudProxyServer,unilbsServerIds:d.toString(),extend:St({networkState:f})}),S.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),_),!0)),i)}const jb=(e,t,r,i,s)=>{var l,d,h;const p=[];if(V(l=e.response_body).call(l,m=>{const f=m.buffer.code;if(f!==0){const _=oa(f),v={error:new P(D.CAN_NOT_GET_GATEWAY_SERVER,_.desc,{retry:_.retry,csIp:e.detail[502]}),flag:m.buffer.flag};p.push(v),v.flag===4096?wt.joinChooseServer(r.sid,{lts:i,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:v.error.message,csIp:v.error.data&&v.error.data.csIp,unilbsServerIds:s.toString()}):v.flag!==1048576&&v.flag!==4194304||wt.joinWebProxyAP(r.sid,{lts:i,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:v.error.code,eventType:r.cloudProxyServer,unilbsServerIds:s.toString()})}}),p.length)throw S.warning(k(d=k(h="[".concat(r.clientId,"] multi unilbs ")).call(h,t," failed, ")).call(d,pt(p).call(p,m=>{var f,_;return k(f=k(_="flag: ".concat(m.flag,", message: ")).call(_,m.error.message,", retry: ")).call(f,m.error.data.retry)}).join(" | "))),new P(D.CAN_NOT_GET_GATEWAY_SERVER,pt(p).call(p,m=>{var f;return k(f="flag: ".concat(m.flag,", message: ")).call(f,m.error.message)}).join(" | "),{retry:!!ft(p).call(p,m=>m.error.data.retry),csIp:e.detail[502]})},Hb=e=>{if(e.addresses&&e.addresses.length===0&&e.code===0)throw new P(D.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(it("GATEWAY_ADDRESS")&&it("GATEWAY_ADDRESS").length>0){var t;S.debug("assign gateway address to",it("GATEWAY_ADDRESS"));const r=pt(t=it("GATEWAY_ADDRESS")).call(t,i=>({ip:i.ip,port:i.port,ticket:e.addresses[0]&&e.addresses[0].ticket}));e.addresses=r}},Kb=(e,t,r)=>{var i;const s=Math.floor(Math.random()*1e12),l={appid:e.appId,client_ts:ht(),opid:s,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:{6:e.stringUid,11:t},key:e.token,service_ids:r,uid:e.uid||0}}]};V(i=l.request_bodies).call(i,h=>{e.multiIP&&e.multiIP.gateway_ip&&(h.buffer.detail[5]=St({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const d=new FormData;return d.append("request",St(l)),[d,s]};async function xu(e,t,r){return{gatewayInfo:await async function(s,l,d){var h,p;const m=pt(h=rn(p=it("WEBCS_DOMAIN")).call(p,0,it("AJAX_REQUEST_CONCURRENT"))).call(h,R=>{var w;return{url:s.proxyServer?k(w="https://".concat(s.proxyServer,"/ap/?url=")).call(w,R+"/api/v2/transpond/webrtc?v=2"):"https://".concat(R,"/api/v2/transpond/webrtc?v=2"),areaCode:Ns()}});let f=null;const _=[],v=async()=>await Ao({fragementLength:it("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:R=>(S.debug("[".concat(s.clientId,"] Connect to choose_server:"),R.url),Vb(R,s,l,d)),allFailedhandler:R=>{throw R[0]},promisesCollector:_}),T=async()=>{var R;if(await Mr(1e3),f!==null)return f;const w=pt(R=it("WEBCS_DOMAIN_BACKUP_LIST")).call(R,O=>{var B;return{url:s.proxyServer?k(B="https://".concat(s.proxyServer,"/ap/?url=")).call(B,O+"/api/v2/transpond/webrtc?v=2"):"https://".concat(O,"/api/v2/transpond/webrtc?v=2"),areaCode:Ns()}});return await Ao({fragementLength:it("FRAGEMENT_LENGTH"),referenceList:w,asyncMapHandler:O=>(S.debug("[".concat(s.clientId,"] Connect to backup choose_server:"),O.url),Vb(O,s,l,d)),allFailedhandler:O=>{throw O[0]},promisesCollector:_})};return f=await Rs([v(),T()]),_.length&&V(_).call(_,R=>R.cancel&&typeof R.cancel=="function"&&R.cancel()),f}(e,t,r)}}async function y_(e,t,r,i){var s,l;if(e.cloudProxyServer==="disabled")return i?await xu(e,t,r):void 0;let d;if(e.cloudProxyServer==="443only"||e.cloudProxyServer==="normal"){var h;let p;i?e.cloudProxyServer!=="normal"?[p,d]=await ct.all([QA(e,t,r),xu(e,t,r)]):(p=await QA(e,t,r),e.proxyServer=p.addresses[0],wt.setProxyServer(e.proxyServer),S.setProxyServer(e.proxyServer),d=await xu(e,t,r)):(d=void 0,e.cloudProxyServer!=="normal"?p=await QA(e,t,r):(p=await QA(e,t,r),e.proxyServer=p.addresses[0],wt.setProxyServer(e.proxyServer),S.setProxyServer(e.proxyServer))),e.turnServer={mode:"manual",servers:pt(h=p.addresses).call(h,m=>({turnServerURL:m,tcpport:e.cloudProxyServer==="proxy3"?void 0:p.serverResponse.tcpport?p.serverResponse.tcpport:qe.tcpport,udpport:e.cloudProxyServer==="proxy4"?void 0:p.serverResponse.udpport?p.serverResponse.udpport:qe.udpport,username:p.serverResponse.username||qe.username,password:p.serverResponse.password||qe.password,forceturn:e.cloudProxyServer!=="proxy4"&&e.cloudProxyServer!=="proxy5",security:e.cloudProxyServer==="proxy5"}))}}else{const{proxyInfo:p,gatewayInfo:m}=await async function(f,_,v){var T,R;const w=it("PROXY_SERVER_TYPE3"),O=(rt,H)=>{var W;let U=w;return tn(U)&&(U=H%2==0?w[1]:w[0]),k(W="https://".concat(U,"/ap/?url=")).call(W,rt)},B=pt(T=rn(R=it("WEBCS_DOMAIN")).call(R,0,it("AJAX_REQUEST_CONCURRENT"))).call(T,(rt,H)=>({url:O("".concat(rt,"/api/v2/transpond/webrtc?v=2"),H),areaCode:Ns(),serviceIds:[fi.CHOOSE_SERVER,f.cloudProxyServer==="proxy5"?fi.CLOUD_PROXY_5:fi.CLOUD_PROXY]}));let K=null;const j=[],nt=async()=>await Ao({fragementLength:it("FRAGEMENT_LENGTH"),referenceList:B,asyncMapHandler:rt=>(S.debug("[".concat(f.clientId,"] Connect to choose_server:"),rt.url),Gb(rt,f,_,v)),allFailedhandler:rt=>{throw rt[0]},promisesCollector:j}),It=async()=>{var rt;if(await Mr(1e3),K!==null)return K;const H=pt(rt=it("WEBCS_DOMAIN_BACKUP_LIST")).call(rt,(W,U)=>({url:O("".concat(W,"/api/v2/transpond/webrtc?v=2"),U),areaCode:Ns(),serviceIds:[11,18]}));return await Ao({fragementLength:it("FRAGEMENT_LENGTH"),referenceList:H,asyncMapHandler:W=>(S.debug("[".concat(f.clientId,"] Connect to backup choose_server:"),W.url),Gb(W,f,_,v)),allFailedhandler:W=>{throw W[0]},promisesCollector:j})},{gatewayInfo:vt,proxyInfo:Rt,url:X}=await Rs([nt(),It()]);if(j.length&&V(j).call(j,rt=>rt.cancel&&typeof rt.cancel=="function"&&rt.cancel()),!vt||!Rt)throw new P(D.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(tn(w)&&X){const rt=new W0(X).host;qt(w).call(w,rt)&&(f.proxyServer=rt,S.setProxyServer(rt),wt.setProxyServer(rt))}return K={gatewayInfo:vt,proxyInfo:z7(Rt)},K}(e,t,r);d={gatewayInfo:m},e.turnServer={mode:"manual",servers:pt(p).call(p,f=>({turnServerURL:f.address,tcpport:e.cloudProxyServer==="proxy3"?void 0:f.tcpport?f.tcpport:qe.tcpport,udpport:e.cloudProxyServer==="proxy4"?void 0:f.udpport?f.udpport:qe.udpport,username:f.username||qe.username,password:f.password||qe.password,forceturn:e.cloudProxyServer!=="proxy4"&&e.cloudProxyServer!=="proxy5",security:e.cloudProxyServer==="proxy5"}))}}return S.debug(k(s=k(l="[".concat(e.clientId,"] set proxy server: ")).call(l,e.proxyServer,", mode: ")).call(s,e.cloudProxyServer)),d}async function Wb(e,t,r,i){var s;const l=rn(s=it("ACCOUNT_REGISTER")).call(s,0,it("AJAX_REQUEST_CONCURRENT"));let d=[];return d=t.proxyServer?pt(l).call(l,h=>{var p;return k(p="https://".concat(t.proxyServer,"/ap/?url=")).call(p,h+"/api/v1")}):pt(l).call(l,h=>"https://".concat(h,"/api/v1")),(await async function(h,p,m,f,_){const v=ht(),T={sid:m.sid,opid:10,appid:m.appId,string_uid:p};let R=h[0];const w=await Wn(()=>yn(R+"".concat(xt(R).call(R,"?")===-1?"?":"&","action=stringuid"),{data:T,cancelToken:f,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(O,B)=>{if(O.code===0){var K;if(O.uid<=0||O.uid>=Math.pow(2,32))throw S.error(k(K="Invalid Uint Uid ".concat(p," => ")).call(K,O.uid),O),wt.reqUserAccount(T.sid,{lts:v,success:!1,serverAddr:R,stringUid:T.string_uid,uid:O.uid,errorCode:D.INVALID_UINT_UID_FROM_STRING_UID,extend:T}),new P(D.INVALID_UINT_UID_FROM_STRING_UID);return wt.reqUserAccount(T.sid,{lts:v,success:!0,serverAddr:R,stringUid:T.string_uid,uid:O.uid,errorCode:null,extend:T}),!1}const j=oa(O.code);return j.retry&&(R=h[(B+1)%h.length]),wt.reqUserAccount(T.sid,{lts:v,success:!1,serverAddr:R,stringUid:T.string_uid,uid:O.uid,errorCode:j.desc,extend:T}),j.retry},(O,B)=>O.code!==D.OPERATION_ABORTED&&(wt.reqUserAccount(T.sid,{lts:v,success:!1,serverAddr:R,stringUid:T.string_uid,uid:null,errorCode:O.code,extend:T}),R=h[(B+1)%h.length],!0),_);if(w.code!==0){const O=oa(w.code);throw new P(D.UNEXPECTED_RESPONSE,O.desc)}return w}(d,e,t,r,i)).uid}async function QA(e,t,r){var i,s;let l=ht();const d=pt(i=it(e.cloudProxyServer==="normal"?"PROXY_CS":"WEBCS_DOMAIN")).call(i,v=>{var T;return e.proxyServer?k(T="https://".concat(e.proxyServer,"/ap/?url=")).call(T,v+"/api/v1"):"https://".concat(v,"/api/v1")});if(e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"||e.cloudProxyServer==="proxy5"){const v=pt(d).call(d,w=>({url:w,areaCode:Ns()}));let T=null;T=await Ao({fragementLength:it("FRAGEMENT_LENGTH"),referenceList:v,asyncMapHandler:w=>function(O,B,K,j){let{url:nt,areaCode:It}=O;const vt=ht(),Rt={opid:133,flag:B.cloudProxyServer==="proxy5"?4194304:1048576,ts:+new Date,key:B.token,cname:B.cname,sid:B.sid,detail:{6:B.stringUid,11:It},uid:B.uid||0};return Wn(async()=>await yn(nt,{data:Rt,cancelToken:K,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":69}}),X=>{var rt;if(X.code===0)return wt.joinWebProxyAP(B.sid,{lts:vt,sucess:1,apServerAddr:nt,turnServerAddrList:pt(rt=X.addresses).call(rt,W=>W.ip).join(","),errorCode:null,eventType:B.cloudProxyServer}),!1;const H=oa(X.code);throw new P(D.CAN_NOT_GET_GATEWAY_SERVER,H.desc,{retry:H.retry})},X=>{return X.code!==D.OPERATION_ABORTED&&(X.code===D.CAN_NOT_GET_GATEWAY_SERVER?(wt.joinWebProxyAP(Rt.sid,{lts:vt,sucess:0,apServerAddr:nt,turnServerAddrList:null,errorCode:X.code,eventType:B.cloudProxyServer}),S.warning(k(rt=k(H=k(W="[".concat(B.clientId,"] proxy ap server ")).call(W,nt," failed, message: ")).call(H,X.message,", retry: ")).call(rt,X.data.retry)),X.data.retry):(wt.joinWebProxyAP(Rt.sid,{lts:vt,sucess:0,apServerAddr:nt,turnServerAddrList:null,errorCode:X.code,eventType:B.cloudProxyServer}),!0));var rt,H,W},j)}(w,e,t,r),allFailedhandler:()=>{throw S.error("[".concat(e.clientId,"] can not get proxy server after trying several times")),new P(D.CAN_NOT_GET_PROXY_SERVER)}});const R=T.addresses;if(!R||R.length===0)throw S.error("[".concat(e.clientId,"] can not get proxy server, empty proxy server list")),new P(D.CAN_NOT_GET_PROXY_SERVER,"empty proxy server list");return{addresses:pt(R).call(R,w=>w.ip),serverResponse:{tcpport:R[0].port||443,udpport:R[0].port||qe.udpport,username:qe.username,password:qe.password}}}let h=null;h=await Ao({fragementLength:it("FRAGEMENT_LENGTH"),referenceList:d,asyncMapHandler:v=>function(T,R,w,O){const B=ht(),K={command:"convergeAllocateEdge",sid:R.sid,appId:R.appId,token:R.token,uid:R.uid,cname:R.cname,ts:Math.floor(ht()/1e3),version:Tn,seq:0,requestId:1};return Wn(async()=>({res:await yn(T,{data:{service_name:"webrtc_proxy",json_body:St(K)},cancelToken:w,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}}),url:T}),j=>{if(!j.res.json_body)throw S.debug("[".concat(R.clientId,"] Get proxy server failed: no json_body")),new P(D.UNEXPECTED_RESPONSE,St(j.res));const nt=JSON.parse(j.res.json_body);var It,vt;if(nt.code!==200)throw S.debug(k(It=k(vt="[".concat(R.clientId,"] Get proxy server failed: response code [")).call(vt,nt.code,"], reason [")).call(It,nt.reason,"]")),new P(D.UNEXPECTED_RESPONSE,St(j.res));return S.debug("[".concat(R.clientId,"] App return server length"),nt.servers.length),!1},j=>j.code!==D.OPERATION_ABORTED&&(wt.requestProxyAppCenter(K.sid,{lts:B,succ:!1,APAddr:T,workerManagerList:null,ec:j.code,response:j.message}),!0),O)}(v,e,t,r),allFailedhandler:()=>{throw S.error("[".concat(e.clientId,"] can not get proxy server after trying several times")),new P(D.CAN_NOT_GET_PROXY_SERVER)}});const p=JSON.parse(h.res.json_body),m=pt(s=p.servers).call(s,q7);if(e.cloudProxyServer==="443only")return{addresses:m,serverResponse:{tcpport:443,udpport:qe.udpport,username:qe.username,password:qe.password}};wt.requestProxyAppCenter(e.sid,{lts:l,succ:!0,APAddr:h.url,workerManagerList:St(m),ec:null,response:St(h.res)}),l=ht();const f=pt(m).call(m,v=>function(T,R,w,O){const B=ht();let K=T;ml(T).call(T,"http")||(K="https://".concat(T,":4000/v2/machine"));const j={command:"request",gatewayType:"http",appId:R.appId,cname:R.cname,uid:(R.uid||"").toString(),sdkVersion:"2.3.1",sid:R.sid,seq:1,ts:ht(),requestId:3,clientRequest:{appId:R.appId,cname:R.cname,uid:(R.uid||"").toString(),sid:R.sid}};return Wn(async()=>({res:await yn(K,{data:j,cancelToken:w}),url:T}),nt=>{if(!nt.res.serverResponse)throw new P(D.UNEXPECTED_RESPONSE,"requeet worker manager server failed: serverResponse is undefined");return!1},nt=>nt.code!==D.OPERATION_ABORTED&&(wt.requestProxyWorkerManager(j.sid,{lts:B,succ:!1,workerManagerAddr:T,ec:nt.code,response:nt.message}),!0),O)}(v,e,t,r));let _=null;try{_=await Rs(f)}catch{throw S.error("[".concat(e.clientId,"] can not get worker manager after trying several times")),new P(D.CAN_NOT_GET_PROXY_SERVER)}return V(f).call(f,v=>v.cancel()),wt.requestProxyWorkerManager(e.sid,{lts:l,succ:!0,workerManagerAddr:_.url,ec:null,response:St(_.res)}),{addresses:[_.url],serverResponse:_.res.serverResponse}}async function Yb(e,t,r,i){var s,l;const d=pt(s=rn(l=it("UAP_AP")).call(l,0,it("AJAX_REQUEST_CONCURRENT"))).call(s,h=>{var p;return t.proxyServer?k(p="https://".concat(t.proxyServer,"/ap/?url=")).call(p,h+"/api/v1?action=uap"):"https://".concat(h,"/api/v1?action=uap")});return await Z7(d,e,t,r,i)}Ae({target:"Object",stat:!0},{setPrototypeOf:XC});var $7=Ir.Object.setPrototypeOf;Ae({target:"Object",stat:!0,sham:!Ot},{create:gc});var tG=Ir.Object,eG=function(e,t){return tG.create(e,t)};Ae({target:"Number",stat:!0},{isNaN:function(e){return e!=e}});var qb=Ir.Number.isNaN,Jb={exports:{}};(function(e,t){(function(r){function i(X){if(tn(X))return pt(X).call(X,function(W){return W});if(!s(X))return X;var rt={};for(var H in X)s(X[H])||tn(X[H])?rt[H]=i(X[H]):rt[H]=X[H];return rt}function s(X){return!(typeof X!="object"||tn(X)||!X)}function l(){var X=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i);return X&&X[0]?Number(X[0].split("/")[1]):null}function d(X){return!!window.RTCStatsReport&&X.getStats()instanceof ct}var h=function(){function X(rt){this.input=[],this.size=rt}return X.prototype.add=function(rt){var H;this.input.push(rt),this.input.length>this.size&&Ye(H=this.input).call(H,0,1)},X.prototype.diffMean=function(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length},X}(),p=function(X,rt){return(p=$7||{__proto__:[]}instanceof Array&&function(H,W){H.__proto__=W}||function(H,W){for(var U in W)W.hasOwnProperty(U)&&(H[U]=W[U])})(X,rt)};/*! *****************************************************************************
	    Copyright (c) Microsoft Corporation. All rights reserved.
	    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
	    this file except in compliance with the License. You may obtain a copy of the
	    License at http://www.apache.org/licenses/LICENSE-2.0
	       THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
	    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
	    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
	    MERCHANTABLITY OR NON-INFRINGEMENT.
	       See the Apache Version 2.0 License for specific language governing permissions
	    and limitations under the License.
	    ***************************************************************************** */function m(X,rt){function H(){this.constructor=X}p(X,rt),X.prototype=rt===null?eG(rt):(H.prototype=rt.prototype,new H)}var f=function(){return(f=hr||function(X){for(var rt,H=1,W=arguments.length;H<W;H++)for(var U in rt=arguments[H])Object.prototype.hasOwnProperty.call(rt,U)&&(X[U]=rt[U]);return X}).apply(this,arguments)};function _(X,rt,H,W){return new(H||(H=ct))(function(U,Ct){function Et(Y){try{Mt(W.next(Y))}catch($){Ct($)}}function gt(Y){try{Mt(W.throw(Y))}catch($){Ct($)}}function Mt(Y){Y.done?U(Y.value):new H(function($){$(Y.value)}).then(Et,gt)}Mt((W=W.apply(X,rt||[])).next())})}function v(X,rt){var H,W,U,Ct,Et={label:0,sent:function(){if(1&U[0])throw U[1];return U[1]},trys:[],ops:[]};return Ct={next:gt(0),throw:gt(1),return:gt(2)},typeof RA=="function"&&(Ct[ww]=function(){return this}),Ct;function gt(Y){return function($){return Mt([Y,$])}}function Mt(Y){if(H)throw new TypeError("Generator is already executing.");for(;Et;)try{if(H=1,W&&(U=2&Y[0]?W.return:Y[0]?W.throw||((U=W.return)&&U.call(W),0):W.next)&&!(U=U.call(W,Y[1])).done)return U;switch(W=0,U&&(Y=[2&Y[0],U.value]),Y[0]){case 0:case 1:U=Y;break;case 4:return Et.label++,{value:Y[1],done:!1};case 5:Et.label++,W=Y[1],Y=[0];continue;case 7:Y=Et.ops.pop(),Et.trys.pop();continue;default:if(!((U=(U=Et.trys).length>0&&U[U.length-1])||Y[0]!==6&&Y[0]!==2)){Et=0;continue}if(Y[0]===3&&(!U||Y[1]>U[0]&&Y[1]<U[3])){Et.label=Y[1];break}if(Y[0]===6&&Et.label<U[1]){Et.label=U[1],U=Y;break}if(U&&Et.label<U[2]){Et.label=U[2],Et.ops.push(Y);break}U[2]&&Et.ops.pop(),Et.trys.pop();continue}Y=rt.call(X,Et)}catch($){Y=[6,$],W=0}finally{H=U=0}if(5&Y[0])throw Y[1];return{value:Y[0]?Y[1]:void 0,done:!0}}}var T,R={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[]},w={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0},O={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0},B={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0},K={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0},j=function(){function X(rt,H){var W=this;this.videoIsReady=!1,this.stats=i(R),this.isFirstVideoReceived=!1,this.isFirstVideoDecoded=!1,this.isFirstAudioReceived=!1,this.isFirstAudioDecoded=!1,this.lossRateWindowStats=[],this.pc=rt,this.options=H,this.intervalTimer=be(function(){return _(W,void 0,void 0,function(){return v(this,function(U){return this.updateStats(),[2]})})},this.options.updateInterval)}return X.prototype.getStats=function(){return this.stats},X.prototype.setVideoIsReady=function(rt){this.videoIsReady=rt},X.prototype.setIsFirstAudioDecoded=function(rt){this.isFirstAudioDecoded=rt},X.prototype.destroy=function(){window.clearInterval(this.intervalTimer),this.pc=void 0},X.prototype.calcLossRate=function(rt){var H,W=this;this.lossRateWindowStats.push(rt),this.lossRateWindowStats.length>this.options.lossRateInterval&&Ye(H=this.lossRateWindowStats).call(H,0,1);for(var U=this.lossRateWindowStats.length,Ct=0,Et=0,gt=0,Mt=0,Y=function(ot){var Lt;V(Lt=rt[ot]).call(Lt,function(at,y){if(W.lossRateWindowStats[U-1][ot][y]&&W.lossRateWindowStats[0][ot][y]){var M=W.lossRateWindowStats[U-1][ot][y].packets-W.lossRateWindowStats[0][ot][y].packets,F=W.lossRateWindowStats[U-1][ot][y].packetsLost-W.lossRateWindowStats[0][ot][y].packetsLost;ot==="videoSend"||ot==="audioSend"?(Ct+=M,gt+=F):(Et+=M,Mt+=F),qb(M)||qb(M)?at.packetLostRate=0:at.packetLostRate=M<=0||F<=0?0:F/(M+F)}})},$=0,mt=["videoSend","audioSend","videoRecv","audioRecv"];$<mt.length;$++)Y(mt[$]);rt.sendPacketLossRate=Ct<=0||gt<=0?0:gt/(Ct+gt),rt.recvPacketLossRate=Et<=0||Mt<=0?0:Mt/(Et+Mt)},X}(),nt=function(X){function rt(){var H=X!==null&&X.apply(this,arguments)||this;return H._stats=R,H.lastDecodeVideoReceiverStats=new $t,H}return m(rt,X),rt.prototype.updateStats=function(){return _(this,void 0,void 0,function(){var H,W,U,Ct;return v(this,function(Et){switch(Et.label){case 0:return[4,this._getStats()];case 1:return H=Et.sent(),W=this.statsResponsesToObjects(H),this._stats=i(R),U=kt(W).call(W,function(gt){return gt.type==="ssrc"}),this.processSSRCStats(U),(Ct=ft(W).call(W,function(gt){return gt.type==="VideoBwe"}))&&this.processBandwidthStats(Ct),this._stats.timestamp=ht(),this.calcLossRate(this._stats),this.stats=this._stats,[2]}})})},rt.prototype.processBandwidthStats=function(H){this._stats.bitrate={actualEncoded:Number(H.googActualEncBitrate),targetEncoded:Number(H.googTargetEncBitrate),retransmit:Number(H.googRetransmitBitrate),transmit:Number(H.googTransmitBitrate)},this._stats.sendBandwidth=Number(H.googAvailableSendBandwidth)},rt.prototype.processSSRCStats=function(H){var W=this;V(H).call(H,function(U){var Ct,Et=qt(Ct=U.id).call(Ct,"send");switch(U.mediaType+"_"+(Et?"send":"recv")){case"video_send":var gt=i(O);gt.codec=U.googCodecName,gt.adaptionChangeReason="none",U.googCpuLimitedResolution&&(gt.adaptionChangeReason="cpu"),U.googBandwidthLimitedResolution&&(gt.adaptionChangeReason="bandwidth"),gt.avgEncodeMs=Number(U.googAvgEncodeMs),gt.inputFrame={width:Number(U.googFrameWidthInput)||Number(U.googFrameWidthSent),height:Number(U.googFrameHeightInput)||Number(U.googFrameHeightSent),frameRate:Number(U.googFrameRateInput)},gt.sentFrame={width:Number(U.googFrameWidthSent),height:Number(U.googFrameHeightSent),frameRate:Number(U.googFrameRateInput)},gt.firsCount=Number(U.googFirReceived),gt.nacksCount=Number(U.googNacksReceived),gt.plisCount=Number(U.googPlisReceived),gt.frameCount=Number(U.framesEncoded),gt.bytes=Number(U.bytesSent),gt.packets=Number(U.packetsSent),gt.packetsLost=Number(U.packetsLost),gt.ssrc=Number(U.ssrc),gt.rttMs=Number(U.googRtt||0),W._stats.videoSend.push(gt),W._stats.rtt=gt.rttMs;break;case"video_recv":var Mt=i(w),Y=W.lastDecodeVideoReceiverStats.get(Number(U.ssrc));if(Mt.codec=U.googCodecName,Mt.targetDelayMs=Number(U.googTargetDelayMs),Mt.renderDelayMs=Number(U.googRenderDelayMs),Mt.currentDelayMs=Number(U.googCurrentDelayMs),Mt.minPlayoutDelayMs=Number(U.googMinPlayoutDelayMs),Mt.decodeMs=Number(U.googDecodeMs),Mt.maxDecodeMs=Number(U.googMaxDecodeMs),Mt.receivedFrame={width:Number(U.googFrameWidthReceived),height:Number(U.googFrameHeightReceived),frameRate:Number(U.googFrameRateReceived)},Mt.decodedFrame={width:Number(U.googFrameWidthReceived),height:Number(U.googFrameHeightReceived),frameRate:Number(U.googFrameRateDecoded)},Mt.outputFrame={width:Number(U.googFrameWidthReceived),height:Number(U.googFrameHeightReceived),frameRate:Number(U.googFrameRateOutput)},Mt.jitterBufferMs=Number(U.googJitterBufferMs),Mt.firsCount=Number(U.googFirsSent),Mt.nacksCount=Number(U.googNacksSent),Mt.plisCount=Number(U.googPlisSent),Mt.framesDecodeCount=Number(U.framesDecoded),Mt.bytes=Number(U.bytesReceived),Mt.packets=Number(U.packetsReceived),Mt.packetsLost=Number(U.packetsLost),Mt.ssrc=Number(U.ssrc),Mt.packets>0&&!W.isFirstVideoReceived&&(W.onFirstVideoReceived&&W.onFirstVideoReceived(),W.isFirstVideoReceived=!0),Mt.framesDecodeCount>0&&!W.isFirstVideoDecoded&&(W.onFirstVideoDecoded&&W.onFirstVideoDecoded(Mt.decodedFrame.width,Mt.decodedFrame.height),W.isFirstVideoDecoded=!0),Y){var $=Y.stats,mt=ht()-Y.lts;Mt.framesDecodeFreezeTime=$.framesDecodeFreezeTime,Mt.framesDecodeInterval=$.framesDecodeInterval,Mt.framesDecodeCount>$.framesDecodeCount&&W.isFirstVideoDecoded?(Y.lts=ht(),Mt.framesDecodeInterval=mt,Mt.framesDecodeInterval>=W.options.freezeRateLimit&&(W.videoIsReady?Mt.framesDecodeFreezeTime+=Mt.framesDecodeInterval:W.setVideoIsReady(!0))):Mt.framesDecodeCount<Y.stats.framesDecodeCount&&(Mt.framesDecodeInterval=0)}W.lastDecodeVideoReceiverStats.set(Mt.ssrc,{stats:f({},Mt),lts:ht()}),W._stats.videoRecv.push(Mt);break;case"audio_recv":var ot=i(K);ot.codec=U.googCodecName,ot.outputLevel=Math.abs(Number(U.audioOutputLevel))/32767,ot.decodingCNG=Number(U.googDecodingCNG),ot.decodingCTN=Number(U.googDecodingCTN),ot.decodingCTSG=Number(U.googDecodingCTSG),ot.decodingNormal=Number(U.googDecodingNormal),ot.decodingPLC=Number(U.googDecodingPLC),ot.decodingPLCCNG=Number(U.googDecodingPLCCNG),ot.expandRate=Number(U.googExpandRate),ot.accelerateRate=Number(U.googAccelerateRate),ot.preemptiveExpandRate=Number(U.googPreemptiveExpandRate),ot.secondaryDecodedRate=Number(U.googSecondaryDecodedRate),ot.speechExpandRate=Number(U.googSpeechExpandRate),ot.preferredJitterBufferMs=Number(U.googPreferredJitterBufferMs),ot.jitterBufferMs=Number(U.googJitterBufferMs),ot.jitterMs=Number(U.googJitterReceived),ot.bytes=Number(U.bytesReceived),ot.packets=Number(U.packetsReceived),ot.packetsLost=Number(U.packetsLost),ot.ssrc=Number(U.ssrc),ot.receivedFrames=Number(U.googDecodingCTN)||Number(U.packetsReceived),ot.droppedFrames=Number(U.googDecodingPLC)+Number(U.googDecodingPLCCNG)||Number(U.packetsLost),ot.receivedFrames>0&&!W.isFirstAudioReceived&&(W.onFirstAudioReceived&&W.onFirstAudioReceived(),W.isFirstAudioReceived=!0),ot.decodingNormal>0&&!W.isFirstAudioDecoded&&(W.onFirstAudioDecoded&&W.onFirstAudioDecoded(),W.isFirstAudioDecoded=!0),W._stats.audioRecv.push(ot);break;case"audio_send":var Lt=i(B);Lt.codec=U.googCodecName,Lt.inputLevel=Math.abs(Number(U.audioInputLevel))/32767,Lt.aecReturnLoss=Number(U.googEchoCancellationReturnLoss||0),Lt.aecReturnLossEnhancement=Number(U.googEchoCancellationReturnLossEnhancement||0),Lt.residualEchoLikelihood=Number(U.googResidualEchoLikelihood||0),Lt.residualEchoLikelihoodRecentMax=Number(U.googResidualEchoLikelihoodRecentMax||0),Lt.bytes=Number(U.bytesSent),Lt.packets=Number(U.packetsSent),Lt.packetsLost=Number(U.packetsLost),Lt.ssrc=Number(U.ssrc),Lt.rttMs=Number(U.googRtt||0),W._stats.rtt=Lt.rttMs,W._stats.audioSend.push(Lt)}})},rt.prototype._getStats=function(){var H=this;return new ct(function(W,U){H.pc.getStats(W,U)})},rt.prototype.statsResponsesToObjects=function(H){var W=[],U=H.result();return V(U).call(U,function(Ct){var Et,gt={id:Ct.id,timestamp:Ct.timestamp.valueOf().toString(),type:Ct.type};V(Et=Ct.names()).call(Et,function(Mt){gt[Mt]=Ct.stat(Mt)}),W.push(gt)}),W},rt}(j);(function(X){X.CERTIFICATE="certificate",X.CODEC="codec",X.CANDIDATE_PAIR="candidate-pair",X.LOCAL_CANDIDATE="local-candidate",X.REMOTE_CANDIDATE="remote-candidate",X.INBOUND="inbound-rtp",X.TRACK="track",X.OUTBOUND="outbound-rtp",X.PC="peer-connection",X.REMOTE_INBOUND="remote-inbound-rtp",X.REMOTE_OUTBOUND="remote-outbound-rtp",X.TRANSPORT="transport",X.CSRC="csrc",X.DATA_CHANNEL="data-channel",X.STREAM="stream",X.SENDER="sender",X.RECEIVER="receiver"})(T||(T={}));var It=function(X){function rt(){var H=X!==null&&X.apply(this,arguments)||this;return H._stats=R,H.lastDecodeVideoReceiverStats=new $t,H.lastVideoFramesRecv=new $t,H.lastVideoFramesSent=new $t,H.lastVideoFramesDecode=new $t,H.lastVideoJBDelay=new $t,H.lastAudioJBDelay=new $t,H.mediaBytesSent=new $t,H.mediaBytesRetransmit=new $t,H.mediaBytesTargetEncode=new $t,H.lastEncoderMs=new $t,H}return m(rt,X),rt.prototype.updateStats=function(){return _(this,void 0,void 0,function(){var H,W=this;return v(this,function(U){var Ct;switch(U.label){case 0:return H=this,[4,this.pc.getStats()];case 1:return H.report=U.sent(),this._stats=i(R),V(Ct=this.report).call(Ct,function(Et){switch(Et.type){case T.OUTBOUND:Et.mediaType==="audio"?W.processAudioOutboundStats(Et):Et.mediaType==="video"&&W.processVideoOutboundStats(Et);break;case T.INBOUND:Et.mediaType==="audio"?W.processAudioInboundStats(Et):Et.mediaType==="video"&&W.processVideoInboundStats(Et);break;case T.TRANSPORT:var gt=W.report.get(Et.selectedCandidatePairId);gt&&W.processCandidatePairStats(gt);break;case T.CANDIDATE_PAIR:Et.selected&&W.processCandidatePairStats(Et)}}),this.updateSendBitrate(),this._stats.timestamp=ht(),this.calcLossRate(this._stats),this.stats=this._stats,[2]}})})},rt.prototype.processCandidatePairStats=function(H){var W,U;this._stats.sendBandwidth=H.availableOutgoingBitrate||0,H.currentRoundTripTime&&(this._stats.rtt=1e3*H.currentRoundTripTime),V(W=this._stats.videoSend).call(W,function(Ct){!Ct.rttMs&&H.currentRoundTripTime&&(Ct.rttMs=1e3*H.currentRoundTripTime)}),V(U=this._stats.audioSend).call(U,function(Ct){!Ct.rttMs&&H.currentRoundTripTime&&(Ct.rttMs=1e3*H.currentRoundTripTime)})},rt.prototype.processAudioInboundStats=function(H){var W,U=ft(W=this._stats.audioRecv).call(W,function(Ct){return Ct.ssrc===H.ssrc});U||(U=i(K),this._stats.audioRecv.push(U)),U.ssrc=H.ssrc,U.packets=H.packetsReceived,U.packetsLost=H.packetsLost,U.bytes=H.bytesReceived,U.jitterMs=1e3*H.jitter,H.trackId&&this.processAudioTrackReceiverStats(H.trackId,U),H.codecId&&(U.codec=this.getCodecFromCodecStats(H.codecId)),U.receivedFrames||(U.receivedFrames=H.packetsReceived),U.droppedFrames||(U.droppedFrames=H.packetsLost),U.receivedFrames>0&&!this.isFirstAudioReceived&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(),this.isFirstAudioReceived=!0),U.outputLevel&&U.outputLevel>0&&!this.isFirstAudioDecoded&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(),this.isFirstAudioDecoded=!0)},rt.prototype.processVideoInboundStats=function(H){var W,U=ft(W=this._stats.videoRecv).call(W,function(ot){return ot.ssrc===H.ssrc});U||(U=i(w),this._stats.videoRecv.push(U)),U.ssrc=H.ssrc,U.packets=H.packetsReceived,U.packetsLost=H.packetsLost,U.bytes=H.bytesReceived,U.firsCount=H.firCount,U.nacksCount=H.nackCount,U.plisCount=H.pliCount,U.framesDecodeCount=H.framesDecoded;var Ct=this.lastDecodeVideoReceiverStats.get(U.ssrc),Et=this.lastVideoFramesDecode.get(U.ssrc),gt=ht();if(U.framesDecodeCount>0&&!this.isFirstVideoDecoded){var Mt=U.decodedFrame?U.decodedFrame.width:0,Y=U.decodedFrame?U.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(Mt,Y),this.isFirstVideoDecoded=!0}if(Ct){var $=Ct.stats,mt=gt-Ct.lts;U.framesDecodeFreezeTime=$.framesDecodeFreezeTime,U.framesDecodeInterval=$.framesDecodeInterval,U.framesDecodeCount>$.framesDecodeCount&&this.isFirstVideoDecoded?(Ct.lts=ht(),U.framesDecodeInterval=mt,U.framesDecodeInterval>=this.options.freezeRateLimit&&(this.videoIsReady?U.framesDecodeFreezeTime+=U.framesDecodeInterval:this.setVideoIsReady(!0))):U.framesDecodeCount<$.framesDecodeCount&&(U.framesDecodeInterval=0)}Et&&gt-Et.lts>=800?(U.decodeFrameRate=Math.round((U.framesDecodeCount-Et.count)/((gt-Et.lts)/1e3)),this.lastVideoFramesDecode.set(U.ssrc,{count:U.framesDecodeCount,lts:gt,rate:U.decodeFrameRate})):Et?U.decodeFrameRate=Et.rate:this.lastVideoFramesDecode.set(U.ssrc,{count:U.framesDecodeCount,lts:gt,rate:0}),H.totalDecodeTime&&(U.decodeMs=1e3*H.totalDecodeTime),H.trackId&&this.processVideoTrackReceiverStats(H.trackId,U),H.codecId&&(U.codec=this.getCodecFromCodecStats(H.codecId)),H.framerateMean&&(U.framesRateFirefox=H.framerateMean),U.packets>0&&!this.isFirstVideoReceived&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(),this.isFirstVideoReceived=!0),this.lastDecodeVideoReceiverStats.set(U.ssrc,{stats:f({},U),lts:Ct?Ct.lts:ht()})},rt.prototype.processVideoOutboundStats=function(H){var W,U=ft(W=this._stats.videoSend).call(W,function(Lt){return Lt.ssrc===H.ssrc});U||(U=i(O),this._stats.videoSend.push(U));var Ct=this.mediaBytesSent.get(H.ssrc);if(Ct?Ct.add(H.bytesSent):((gt=new h(10)).add(H.bytesSent),this.mediaBytesSent.set(H.ssrc,gt)),H.retransmittedBytesSent!==void 0){var Et=this.mediaBytesRetransmit.get(H.ssrc);Et?Et.add(H.retransmittedBytesSent):((gt=new h(10)).add(H.retransmittedBytesSent),this.mediaBytesRetransmit.set(H.ssrc,gt))}if(H.totalEncodedBytesTarget){var gt,Mt=this.mediaBytesTargetEncode.get(H.ssrc);Mt?Mt.add(H.totalEncodedBytesTarget):((gt=new h(10)).add(H.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(H.ssrc,gt))}if(U.ssrc=H.ssrc,U.bytes=H.bytesSent,U.packets=H.packetsSent,U.firsCount=H.firCount,U.nacksCount=H.nackCount,U.plisCount=H.pliCount,U.frameCount=H.framesEncoded,U.adaptionChangeReason=H.qualityLimitationReason,H.totalEncodeTime&&H.framesEncoded){var Y=this.lastEncoderMs.get(H.ssrc);if(!Y||Y.lastFrameCount>H.framesEncoded)U.avgEncodeMs=1e3*H.totalEncodeTime/H.framesEncoded;else{var $=H.framesEncoded-Y.lastFrameCount,mt=H.totalEncodeTime-Y.lastEncoderTime;U.avgEncodeMs=1e3*mt/$}this.lastEncoderMs.set(H.ssrc,{lastFrameCount:H.framesEncoded,lastEncoderTime:H.totalEncodeTime,lts:ht()})}if(H.codecId&&(U.codec=this.getCodecFromCodecStats(H.codecId)),H.mediaSourceId&&this.processVideoMediaSource(H.mediaSourceId,U),H.trackId&&this.processVideoTrackSenderStats(H.trackId,U),H.remoteId)this.processRemoteInboundStats(H.remoteId,U);else{var ot=this.findRemoteStatsId(H.ssrc,T.REMOTE_INBOUND);ot&&this.processRemoteInboundStats(ot,U)}},rt.prototype.processAudioOutboundStats=function(H){var W,U=ft(W=this._stats.audioSend).call(W,function(Et){return Et.ssrc===H.ssrc});if(U||(U=i(B),this._stats.audioSend.push(U)),U.ssrc=H.ssrc,U.packets=H.packetsSent,U.bytes=H.bytesSent,H.mediaSourceId&&this.processAudioMediaSource(H.mediaSourceId,U),H.codecId&&(U.codec=this.getCodecFromCodecStats(H.codecId)),H.trackId&&this.processAudioTrackSenderStats(H.trackId,U),H.remoteId)this.processRemoteInboundStats(H.remoteId,U);else{var Ct=this.findRemoteStatsId(H.ssrc,T.REMOTE_INBOUND);Ct&&this.processRemoteInboundStats(Ct,U)}},rt.prototype.findRemoteStatsId=function(H,W){var U,Ct,Et=ft(U=Qe(ia(Ct=this.report).call(Ct))).call(U,function(gt){return gt.type===W&&gt.ssrc===H});return Et?Et.id:null},rt.prototype.processVideoMediaSource=function(H,W){var U=this.report.get(H);U&&U.width&&U.height&&U.framesPerSecond&&(W.inputFrame={width:U.width,height:U.height,frameRate:U.framesPerSecond})},rt.prototype.processAudioMediaSource=function(H,W){var U=this.report.get(H);U&&(W.inputLevel=U.audioLevel)},rt.prototype.processVideoTrackSenderStats=function(H,W){var U=this.report.get(H);if(U){var Ct=0,Et=ht(),gt=this.lastVideoFramesSent.get(W.ssrc);gt&&Et-gt.lts>=800?(Ct=Math.round((U.framesSent-gt.count)/((Et-gt.lts)/1e3)),this.lastVideoFramesSent.set(W.ssrc,{count:U.framesSent,lts:Et,rate:Ct})):gt?Ct=gt.rate:this.lastVideoFramesSent.set(W.ssrc,{count:U.framesSent,lts:Et,rate:0}),W.sentFrame={width:U.frameWidth,height:U.frameHeight,frameRate:Ct}}},rt.prototype.processVideoTrackReceiverStats=function(H,W){var U=this.report.get(H);if(U){var Ct=this.lastVideoFramesRecv.get(W.ssrc),Et=ht();W.framesReceivedCount=U.framesReceived;var gt=0;if(Ct&&Et-Ct.lts>=800?(gt=Math.round((U.framesReceived-Ct.count)/((Et-Ct.lts)/1e3)),this.lastVideoFramesRecv.set(W.ssrc,{count:U.framesReceived,lts:Et,rate:gt})):Ct?gt=Ct.rate:this.lastVideoFramesRecv.set(W.ssrc,{count:U.framesReceived,lts:Et,rate:0}),W.receivedFrame={width:U.frameWidth||0,height:U.frameHeight||0,frameRate:gt||0},W.decodedFrame={width:U.frameWidth||0,height:U.frameHeight||0,frameRate:W.decodeFrameRate||0},W.outputFrame={width:U.frameWidth||0,height:U.frameHeight||0,frameRate:W.decodeFrameRate||0},U.jitterBufferDelay&&U.jitterBufferEmittedCount){var Mt=this.lastVideoJBDelay.get(W.ssrc);this.lastVideoJBDelay.set(W.ssrc,{jitterBufferDelay:U.jitterBufferDelay,jitterBufferEmittedCount:U.jitterBufferEmittedCount}),Mt||(Mt={jitterBufferDelay:0,jitterBufferEmittedCount:0});var Y=1e3*(U.jitterBufferDelay-Mt.jitterBufferDelay)/(U.jitterBufferEmittedCount-Mt.jitterBufferEmittedCount);W.jitterBufferMs=Y,W.currentDelayMs=Math.round(Y)}}},rt.prototype.processAudioTrackSenderStats=function(H,W){var U=this.report.get(H);U&&(W.aecReturnLoss=U.echoReturnLoss||0,W.aecReturnLossEnhancement=U.echoReturnLossEnhancement||0)},rt.prototype.processAudioTrackReceiverStats=function(H,W){var U=this.report.get(H);if(U){if(U.removedSamplesForAcceleration&&U.totalSamplesReceived&&(W.accelerateRate=U.removedSamplesForAcceleration/U.totalSamplesReceived),U.jitterBufferDelay&&U.jitterBufferEmittedCount){var Ct=this.lastAudioJBDelay.get(W.ssrc);this.lastAudioJBDelay.set(W.ssrc,{jitterBufferDelay:U.jitterBufferDelay,jitterBufferEmittedCount:U.jitterBufferEmittedCount}),Ct||(Ct={jitterBufferDelay:0,jitterBufferEmittedCount:0});var Et=1e3*(U.jitterBufferDelay-Ct.jitterBufferDelay)/(U.jitterBufferEmittedCount-Ct.jitterBufferEmittedCount);W.jitterBufferMs=Math.round(Et)}W.outputLevel=U.audioLevel;var gt=1920;U.totalSamplesDuration&&U.totalSamplesReceived&&(gt=U.totalSamplesReceived/U.totalSamplesDuration/50,W.receivedFrames=Math.round(U.totalSamplesReceived/gt)),U.concealedSamples&&(W.droppedFrames=Math.round(U.concealedSamples/gt))}},rt.prototype.processRemoteInboundStats=function(H,W){var U=this.report.get(H);U&&(W.packetsLost=U.packetsLost,U.roundTripTime&&(W.rttMs=1e3*U.roundTripTime))},rt.prototype.getCodecFromCodecStats=function(H){var W=this.report.get(H);if(!W)return"";var U=W.mimeType.match(/\/(.*)$/);return U&&U[1]?U[1]:""},rt.prototype.updateSendBitrate=function(){var H,W,U,Ct=0,Et=null,gt=null;V(H=this.mediaBytesSent).call(H,function(Y){Ct+=Y.diffMean()}),V(W=this.mediaBytesRetransmit).call(W,function(Y){Et=Et===null?Y.diffMean():Et+Y.diffMean()}),V(U=this.mediaBytesTargetEncode).call(U,function(Y){gt=gt===null?Y.diffMean():gt+Y.diffMean()});var Mt=Et!==null?Ct-Et:Ct;this._stats.bitrate={actualEncoded:8*Mt/(this.options.updateInterval/1e3),transmit:8*Ct/(this.options.updateInterval/1e3)},Et!==null&&(this._stats.bitrate.retransmit=8*Et/(this.options.updateInterval/1e3)),gt!==null&&(this._stats.bitrate.targetEncoded=8*gt/(this.options.updateInterval/1e3))},rt}(j),vt=function(X){function rt(){return X!==null&&X.apply(this,arguments)||this}return m(rt,X),rt.prototype.updateStats=function(){return ct.resolve()},rt}(j);function Rt(X,rt,H,W){rt===void 0&&(rt=250),H===void 0&&(H=8),W===void 0&&(W=500);var U=l();return U?U<76?new nt(X,{updateInterval:rt,lossRateInterval:H,freezeRateLimit:W}):new It(X,{updateInterval:rt,lossRateInterval:H,freezeRateLimit:W}):d(X)?new It(X,{updateInterval:rt,lossRateInterval:H,freezeRateLimit:W}):new vt(X,{updateInterval:rt,lossRateInterval:H,freezeRateLimit:W})}r.createWebRTCStatsFilter=Rt,r.AgoraWebRTCStatsFilter=j,ie(r,"__esModule",{value:!0})})(t)})(0,Jb.exports);class zb{constructor(t){this.localCandidateCount=0,this.allCandidateReceived=!1,this.audioTrack=null,this.videoTrack=null,this.mediaStream=new MediaStream,this.ID=Xb,Xb+=1,this.spec=t,this.createPeerConnection(),this.statsFilter=Jb.exports.createWebRTCStatsFilter(this.pc,void 0,void 0,Gr()?1200:void 0)}get _statsFilter(){return this.statsFilter}getStats(){return this.statsFilter.getStats()}async createOfferSDP(){try{const t=await this.pc.createOffer(this.offerOptions);if(!t.sdp)throw new Error("offer sdp is empty");return t.sdp}catch(t){throw S.error("create offer error:",t.toString()),new P(D.CREATE_OFFER_FAILED,t.toString())}}async setOfferSDP(t){try{await this.pc.setLocalDescription({type:"offer",sdp:t})}catch(r){throw S.error("set local offer error",r.toString()),new P(D.CREATE_OFFER_FAILED,r.toString())}}async setAnswerSDP(t){try{await this.pc.setRemoteDescription({type:"answer",sdp:t})}catch(r){if(r.name!=="InvalidStateError"||this.pc.signalingState!=="stable")throw S.error("set remote answer error",r.toString()),new P(D.SET_ANSWER_FAILED,r.toString());S.debug("[pc-".concat(this.ID,"] ignore invalidstate error"))}}close(){this.onICEConnectionStateChange=void 0,this.onConnectionStateChange=void 0;try{this.pc.oniceconnectionstatechange=null,this.pc.onconnectionstatechange=null,this.pc.onsignalingstatechange=null,this.pc.onicecandidateerror=null,this.pc.onicecandidate=null,this.pc.close(),this.pc=null,this.audioTransceiver=void 0,this.videoTransceiver=void 0}catch{}this.statsFilter.destroy()}createPeerConnection(){const t={iceServers:[]},r=l=>{const d=[];return V(l).call(l,h=>{if(h.security){var p;h.tcpport&&d.push({username:h.username,credential:h.password,credentialType:"password",urls:k(p="turns:".concat((_=h.turnServerURL,_.match(/^[\.\:\d]+$/)?"".concat(_.replace(/[^\d]/g,"-"),".edge.agora.io"):(S.info("Cannot recognized as IP address ".concat(_,". Used As Host instead")),_)),":")).call(p,h.tcpport,"?transport=tcp")})}else{var m,f;h.udpport&&d.push({username:h.username,credential:h.password,credentialType:"password",urls:k(m="turn:".concat(h.turnServerURL,":")).call(m,h.udpport,"?transport=udp")}),h.tcpport&&d.push({username:h.username,credential:h.password,credentialType:"password",urls:k(f="turn:".concat(h.turnServerURL,":")).call(f,h.tcpport,"?transport=tcp")})}var _}),d};var i,s;this.spec.iceServers?t.iceServers=this.spec.iceServers:this.spec.turnServer&&this.spec.turnServer.mode!=="off"&&(Np(this.spec.turnServer.servers)?t.iceServers=this.spec.turnServer.servers:(t.iceServers&&t.iceServers.push(...r(this.spec.turnServer.servers)),t.iceServers&&this.spec.turnServer.serversFromGateway&&t.iceServers.push(...r(this.spec.turnServer.serversFromGateway)),V(i=k(s=this.spec.turnServer.servers).call(s,this.spec.turnServer.serversFromGateway||[])).call(i,l=>{l.forceturn&&(t.iceTransportPolicy="relay")}))),it("CHROME_FORCE_PLAN_B")&&El()&&(t.sdpSemantics="plan-b",Dr().supportUnifiedPlan=!1),this.pc=new RTCPeerConnection(t,{optional:[{googDscp:!0}]}),this.pc.oniceconnectionstatechange=()=>{this.onICEConnectionStateChange&&this.onICEConnectionStateChange(this.pc.iceConnectionState)},this.pc.onconnectionstatechange=()=>{this.onConnectionStateChange&&this.onConnectionStateChange(this.pc.connectionState)},this.pc.onsignalingstatechange=()=>{this.pc&&this.pc.connectionState==="closed"&&this.onConnectionStateChange&&this.onConnectionStateChange(this.pc.connectionState)},this.pc.onicecandidate=l=>{if(!l.candidate)return this.pc.onicecandidate=null,this.allCandidateReceived=!0,void S.debug("[pc-".concat(this.ID,"] local candidate count"),this.localCandidateCount);this.localCandidateCount+=1},ar(()=>{this.allCandidateReceived||(this.allCandidateReceived=!0,S.debug("[pc-".concat(this.ID,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},it("CANDIDATE_TIMEOUT"))}}class rG extends zb{constructor(t){super(t)}async setOfferSDP(t){const r=it("CUSTOM_PUB_OFFER_MODIFIER");return r&&(t=r(t)),await super.setOfferSDP(t)}async setAnswerSDP(t){const r=it("CUSTOM_PUB_ANSWER_MODIFIER");return r&&(t=r(t)),await super.setAnswerSDP(t)}getAnswerSDP(){return this.pc.remoteDescription}getOfferSDP(){return this.pc.localDescription}async addStream(t){const r=t.getTracks();for(const i of r)await this.addTrack(i)}async replaceTrack(t){var r;if(!Dr().supportReplaceTrack){const l=t.kind==="audio"?this.audioTrack:this.videoTrack;if(!l)throw new P(D.UNEXPECTED_ERROR,"can not find replaced track");return await this.removeTrack(l),await this.addTrack(t),!0}const i=this.getSender(t.kind),s=ft(r=this.mediaStream.getTracks()).call(r,l=>l.kind===t.kind);s&&this.mediaStream.removeTrack(s),this.mediaStream.addTrack(t);try{await i.replaceTrack(t),t.kind==="audio"?this.audioTrack=t:this.videoTrack=t}catch(l){throw new P(D.SENDER_REPLACE_FAILED,l.toString())}return!1}async removeTrack(t){const r=this.getSender(t.kind);this.mediaStream.removeTrack(t);try{const i=Se();i.name==="Safari"&&i.version==="11"&&await r.replaceTrack(null),this.pc.removeTrack(r)}catch(i){S.warning("[pc-".concat(this.ID,"] remove track error, ignore"),i)}t.kind==="audio"?(this.audioTrack=null,this.audioSender=void 0,this.audioTransceiver&&(this.audioTransceiver.direction="inactive"),this.audioTransceiver=void 0):(this.videoTrack=null,this.videoSender=void 0,this.videoTransceiver&&(this.videoTransceiver.direction="inactive"),this.videoTransceiver=void 0)}onOfferSettled(t){let{videoActive:r,audioActive:i}=t;if(Gr())S.debug("firefox do not set sender parameter");else{if(this.audioSender){const s={networkQuality:void 0,active:!0};it("DSCP_TYPE")&&(s.networkQuality=it("DSCP_TYPE")),this.audioTrack&&(s.active=!!i),this.setAudioRtpEncodingParameters(s).catch(l=>{S.debug("set audio sender`s network priority failed")})}if(this.videoSender){const s={networkQuality:void 0,active:!0};it("DSCP_TYPE")&&(s.networkQuality=it("DSCP_TYPE")),this.videoTrack&&(s.active=!!r),this.setVideoRtpEncodingParameters(s).catch(l=>{S.debug("set video sender`s network priority failed")})}}}async addTrack(t){const r=Dr();if(t.kind==="audio"&&this.audioTrack||t.kind==="video"&&this.videoTrack)throw new P(D.UNEXPECTED_ERROR,"Can't add multiple stream");let i,s;this.mediaStream.addTrack(t),r.supportUnifiedPlan?(i=await async function(l,d,h){var p;const m=ft(p=l.getTransceivers()).call(p,f=>f.direction==="inactive"&&f.receiver.track.kind===d.kind);return m?(m.direction="sendrecv",await m.sender.replaceTrack(d),m):l.addTransceiver(d,{direction:"sendrecv",streams:[h]})}(this.pc,t,this.mediaStream),s=i.sender):s=this.pc.addTrack(t,this.mediaStream),t.kind==="audio"?(this.audioTrack=t,this.audioSender=s,this.audioTransceiver=i):(this.videoTrack=t,this.videoSender=s,this.videoTransceiver=i)}async setRtpSenderParameters(t,r){const i=this.videoSender||(this.videoTransceiver?this.videoTransceiver.sender:void 0);if(!i)return;const s=i.getParameters();s.degradationPreference=r;try{await i.setParameters(s)}catch(l){S.debug("[".concat(this.ID,"] ignore RtpSender.setParameters"),l.toString())}}async setVideoRtpEncodingParameters(t){const r=this.videoSender||(this.videoTransceiver?this.videoTransceiver.sender:void 0);if(!r)throw new P(D.LOW_STREAM_ENCODING_ERROR,"Low stream has no video sender.");const i=r.getParameters();if(!i.encodings||!i.encodings[0])throw new P(D.LOW_STREAM_ENCODING_ERROR,"Low stream RtpEncodingParameters is empty.");t.scaleResolutionDownBy&&(i.encodings[0].scaleResolutionDownBy=t.scaleResolutionDownBy),t.maxBitrate&&(i.encodings[0].maxBitrate=t.maxBitrate),t.maxFramerate&&(i.encodings[0].maxFramerate=t.maxFramerate),t.active!==void 0&&(S.debug("set video sender encoding active:",t.active),i.encodings[0].active=t.active);const s=["very-low","low","medium","high"];return t.networkPriority&&qt(s).call(s,t.networkPriority)&&(S.debug("set video sender network quality:",t.networkPriority),i.encodings[0].networkPriority=t.networkPriority),await r.setParameters(i),r.getParameters()}async setAudioRtpEncodingParameters(t){const r=this.audioSender||(this.audioTransceiver?this.audioTransceiver.sender:void 0);if(!r)throw new P(D.SET_ENCODING_PARAMETER_ERROR,"pc has no audio sender.");const i=r.getParameters();if(!i.encodings||!i.encodings[0])throw new P(D.SET_ENCODING_PARAMETER_ERROR,"pc RtpEncodingParameters is empty.");t.active!==void 0&&(S.debug("set audio sender encoding active:",t.active),i.encodings[0].active=t.active);const s=["very-low","low","medium","high"];return t.networkPriority&&qt(s).call(s,t.networkPriority)&&(S.debug("set audio sender network quality:",t.networkPriority),i.encodings[0].networkPriority=t.networkPriority),await r.setParameters(i),r.getParameters()}getSender(t){let r=null;if(Dr().supportUnifiedPlan){var i;const l=ft(i=this.pc.getTransceivers()).call(i,d=>d.sender.track&&d.sender.track.kind===t);r=l?l.sender:null}else{var s;r=ft(s=this.pc.getSenders()).call(s,l=>l.track&&l.track.kind===t)||null}if(!r)throw new P(D.SENDER_NOT_FOUND);return r}close(){this.audioSender=void 0,this.videoSender=void 0,super.close()}}class nG extends zb{constructor(t){super(t),this.statsFilter.onFirstAudioDecoded=()=>this.onFirstAudioDecoded&&this.onFirstAudioDecoded(),this.statsFilter.onFirstVideoDecoded=(r,i)=>this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r,i),this.statsFilter.onFirstAudioReceived=()=>this.onFirstAudioReceived&&this.onFirstAudioReceived(),this.statsFilter.onFirstVideoReceived=()=>this.onFirstVideoReceived&&this.onFirstVideoReceived(),Dr().supportUnifiedPlan?(this.audioTransceiver=this.pc.addTransceiver("audio",{direction:"recvonly"}),this.videoTransceiver=this.pc.addTransceiver("video",{direction:"recvonly"})):this.offerOptions={offerToReceiveAudio:!0,offerToReceiveVideo:!0},this.pc.ontrack=r=>{r.track.kind==="audio"?this.audioTrack=r.track:this.videoTrack=r.track,this.onTrack&&this.onTrack(r.track,r.streams[0])}}async setOfferSDP(t){const r=it("CUSTOM_SUB_OFFER_MODIFIER");return r&&(t=r(t)),await super.setOfferSDP(t)}async setAnswerSDP(t){const r=it("CUSTOM_SUB_ANSWER_MODIFIER");return r&&(t=r(t)),await super.setAnswerSDP(t)}}let Xb=1,Zb=1;class $b extends Wr{constructor(t,r){super(),this.startTime=ht(),this.createTime=ht(),this.readyToReconnect=!1,this._connectionState="disconnected",this.currentReconnectCount=0,this.ID=Zb,Zb+=1,this.joinInfo=t,this._userId=r,this.createPC()}get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this.emit(oe.CONNECTION_STATE_CHANGE,t,this._connectionState),this._connectionState=t)}get connectionId(){var t,r;return k(t=k(r="".concat(this.joinInfo.clientId,"-")).call(r,this.type?this.type:"sub(".concat(this._userId,")"),"-")).call(t,this.ID)}getUserId(){return this._userId}startUploadStats(){this.statsUploadInterval=be(()=>{const t=this.pc.getStats();this.uploadStats(t,this.lastUploadPCStats),this.lastUploadPCStats=t},3e3),this.statsUploadSlowInterval=be(()=>{const t=this.pc.getStats();this.uploadSlowStats(t)},6e4),this.relatedStatsUploadInterval=be(()=>{const t=this.pc.getStats();this.uploadRelatedStats(t,this.lastRelatedPcStats),this.lastRelatedPcStats=t},1e3)}stopUploadStats(){this.statsUploadInterval&&window.clearInterval(this.statsUploadInterval),this.relatedStatsUploadInterval&&window.clearInterval(this.relatedStatsUploadInterval),this.statsUploadInterval=void 0,this.relatedStatsUploadInterval=void 0}createWaitConnectionConnectedPromise(){return new ct((t,r)=>{this.connectionState==="disconnected"?r():this.connectionState==="connected"?t():this.once(oe.CONNECTION_STATE_CHANGE,i=>{i==="connected"?t():r()})})}async reconnectPC(t){if(this.readyToReconnect=!1,t&&this.onPCDisconnected(t),this.currentReconnectCount>1/0)throw S.debug("[".concat(this.connectionId,"] cannot reconnect pc")),t||new P(Ze.UNEXPECTED_ERROR);if(this.stopUploadStats(),S.debug("[".concat(this.connectionId,"] start reconnect pc")),this.connectionState="connecting",this.currentReconnectCount+=1,await this.closePC())return S.debug("[".concat(this.connectionId,"] abort reconnect pc, wait ws")),void this.readyToReconnectPC();this.createPC(),await this.startP2PConnection(),this.currentReconnectCount=0}readyToReconnectPC(){this.stopUploadStats(),this.readyToReconnect=!0,this.pc.onICEConnectionStateChange=void 0,this.connectionState="connecting"}updateICEPromise(){this.removeAllListeners(oe.GATEWAY_P2P_LOST),this.icePromise=new ct((t,r)=>{let i=!0;this.pc.onICEConnectionStateChange=s=>{var l,d;S.info(k(l=k(d="[".concat(this.connectionId,"] ice-state: ")).call(d,this.type," p2p ")).call(l,s)),s==="connected"&&t(),s!=="failed"&&s!=="closed"||(i&&this.emit(oe.P2P_LOST),i=!1,this.reconnectPC(new P(Ze.ICE_FAILED)).catch(h=>{r(h)}))},this.pc.onConnectionStateChange=s=>{var l,d;S.info(k(l=k(d="[".concat(this.connectionId,"] connection-state: ")).call(d,this.type," p2p ")).call(l,s)),s!=="failed"&&s!=="closed"||(i&&this.emit(oe.P2P_LOST),i=!1,this.reconnectPC(new P(Ze.PC_CLOSED)).catch(h=>{r(h)}))},this.removeAllListeners(oe.GATEWAY_P2P_LOST),this.once(oe.GATEWAY_P2P_LOST,s=>{var l;if(this.pc.ID.toString()===s.toString()){if(S.info(k(l="[".concat(this.connectionId,"] ")).call(l,this.type," p2p gateway lost")),i&&this.emit(oe.P2P_LOST),i=!1,this.pc.allCandidateReceived&&this.pc.localCandidateCount===0)return this.disconnectedReason=new P(Ze.NO_ICE_CANDIDATE,"can not get candidate in this pc"),void this.closeP2PConnection(!0);this.reconnectPC(new P(Ze.GATEWAY_P2P_LOST)).catch(d=>{r(d)})}})})}}function tN(e,t){var r=ae(e);if(Xt){var i=Xt(e);t&&(i=kt(i).call(i,function(s){return jt(e,s).enumerable})),r.push.apply(r,i)}return r}function Bc(e){for(var t=1;t<arguments.length;t++){var r,i,s=arguments[t]!=null?arguments[t]:{};t%2?V(r=tN(Object(s),!0)).call(r,function(l){mr(e,l,s[l])}):Zt?ur(e,Zt(s)):V(i=tN(Object(s))).call(i,function(l){ie(e,l,jt(s,l))})}return e}var _o=function(e,t,r,i){var s,l=arguments.length,d=l<3?t:i===null?i=jt(t,r):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(e,t,r,i);else for(var h=e.length-1;h>=0;h--)(s=e[h])&&(d=(l<3?s(d):l>3?s(t,r,d):s(t,r))||d);return l>3&&d&&ie(t,r,d),d},He=function(e,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(e,t)};class Fr extends UA{constructor(t,r,i,s,l){super(t,l),this.trackMediaType="video",this._scalabiltyMode={numSpatialLayers:1,numTemporalLayers:1},this._enabled=!0,this.updateMediaStreamTrackResolution(),this._encoderConfig=r,this._scalabiltyMode=i,this._optimizationMode=s}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==LA.PLAYING)}play(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=wt.reportApiInvoke(null,{tag:zt.TRACER,name:de.LOCAL_VIDEO_TRACK_PLAY,options:[this.getTrackId(),typeof t=="string"?t:"HTMLElement",r]});if(!(t instanceof HTMLElement)){const d=document.getElementById(t.toString());var s;d?t=d:(S.warning(k(s="[".concat(this.getTrackId(),'] can not find "#')).call(s,t,'" element, use document.body')),t=document.body)}S.debug("[".concat(this.getTrackId(),"] start video playback"),St(r));const l=Bc(Bc(Bc({},this._getDefaultPlayerConfig()),r),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(l):(this._player=new vA(l),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),i.onSuccess()}stop(){const t=wt.reportApiInvoke(null,{tag:zt.TRACER,name:de.LOCAL_VIDEO_TRACK_STOP,options:[this.getTrackId()]});if(!this._player)return t.onSuccess();this._player.destroy(),this._player=void 0,S.debug("[".concat(this.getTrackId(),"] stop video playback")),t.onSuccess()}async setEnabled(t,r){if(!r){if(t===this._enabled)return;this.stateCheck("enabled",t)}S.info("[".concat(this.getTrackId(),"] start setEnabled"),t);const i=await this._enabledMutex.lock();if(!t){this._originMediaStreamTrack.enabled=!1;try{await Xe(this,ue.NEED_REMOVE_TRACK,this)}catch(s){throw S.error("[".concat(this.getTrackId(),"] setEnabled to false error"),s.toString()),i(),s}return r||(this._enabled=!1),S.info("[".concat(this.getTrackId(),"] setEnabled to false success")),i()}this._originMediaStreamTrack.enabled=!0;try{await Xe(this,ue.NEED_ADD_TRACK,this)}catch(s){throw S.error("[".concat(this.getTrackId(),"] setEnabled to true error"),s.toString()),i(),s}S.info("[".concat(this.getTrackId(),"] setEnabled to true success")),r||(this._enabled=!0),i()}async setMuted(t){var r;if(t!==this._muted){if(this.stateCheck("muted",t),this._muted=t,Se().name===zl.FIREFOX)return S.debug("[".concat(this.getTrackId(),"] firefox set mute fallback to set enabled")),void await this.setEnabled(!t,!0);this._mediaStreamTrack.enabled=!t,S.debug(k(r="[".concat(this.getTrackId(),"] start set muted: ")).call(r,t)),await Xe(this,ue.SET_VIDEO_TRACK_MUTED,{track:this,muted:t})}}getStats(){return ys(()=>{S.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),po(this,ue.GET_STATS)||Bc({},Cb)}async setBeautyEffect(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=wt.reportApiInvoke(null,{tag:zt.TRACER,name:de.LOCAL_VIDEO_TRACK_BEAUTY,options:[this.getTrackId(),t,r]});if(t||this._videoBeautyProcessor){if(fp()===DA.IOS||fp()===DA.ANDROID){const s=new P(D.INVALID_OPERATION,"can not enable beauty effect on mobile device");throw i.onError(s),s}if(!this._enabled&&t){const s=new P(D.TRACK_IS_DISABLED,"can not enable beauty effect when track is disabled");throw i.onError(s),s}S.info("[".concat(this.getTrackId(),"] start setBeautyEffect"),t,St(r));try{this._videoBeautyProcessor?await this._videoBeautyProcessor.setBeautyEffectOptions(t,r):(this._videoBeautyProcessor=new Aw,this._videoBeautyProcessor.onOverload=()=>{sn(()=>this.emit($l.BEAUTY_EFFECT_OVERLOAD))},await this._videoBeautyProcessor.setBeautyEffectOptions(t,r),await this._registerTrackProcessor(this._videoBeautyProcessor))}catch(s){throw S.error("[".concat(this.getTrackId(),"] setBeautyEffect error"),s.toString()),i.onError(s),s}S.info("[".concat(this.getTrackId(),"] setBeautyEffect success")),i.onSuccess()}}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}clone(t,r,i,s){const l=this._mediaStreamTrack.clone();return new Fr(l,t,r,i,s)}async setBitrateLimit(t){var r;if(S.debug(k(r="[".concat(this.getTrackId(),"] set bitrate limit, ")).call(r,St(t))),t){this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate);try{await Xe(this,ue.NEED_RESET_REMOTE_SDP)}catch(i){return i.throw()}}}async setOptimizationMode(t){var r;if(t==="motion"||t==="detail"||t==="balanced"){try{this._optimizationMode=t,await Xe(this,ue.SET_OPTIMIZATION_MODE,t)}catch(i){throw S.error("[".concat(this.getTrackId(),"] set optimization mode failed"),i.toString()),i}S.info(k(r="[".concat(this.getTrackId(),"] set optimization mode success (")).call(r,t,")"))}else S.error(D.INVALID_PARAMS,"optimization mode must be motion, detail or balanced")}setScalabiltyMode(t){var r;if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return S.error(D.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabiltyMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabiltyMode=t,S.info(k(r="[".concat(this.getTrackId(),"] set scalability mode success (")).call(r,t,")"))}updateMediaStreamTrackResolution(){Kp(this._originMediaStreamTrack).then(t=>{let[r,i]=t;this._videoHeight=i,this._videoWidth=r}).catch(Ml)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async renewMediaStreamTrack(){}}_o([xr(),He("design:type",Function),He("design:paramtypes",[Object,Object]),He("design:returntype",void 0)],Fr.prototype,"play",null),_o([xr(),He("design:type",Function),He("design:paramtypes",[Boolean,Boolean]),He("design:returntype",ct)],Fr.prototype,"setEnabled",null),_o([xr(),Nb({report:wt}),He("design:type",Function),He("design:paramtypes",[Boolean]),He("design:returntype",ct)],Fr.prototype,"setMuted",null),_o([xr(),He("design:type",Function),He("design:paramtypes",[]),He("design:returntype",Object)],Fr.prototype,"getStats",null),_o([xr(),He("design:type",Function),He("design:paramtypes",[Boolean,Object]),He("design:returntype",ct)],Fr.prototype,"setBeautyEffect",null),_o([xr(),He("design:type",Function),He("design:paramtypes",[]),He("design:returntype",ImageData)],Fr.prototype,"getCurrentFrameData",null),_o([xr(),He("design:type",Function),He("design:paramtypes",[Object]),He("design:returntype",ct)],Fr.prototype,"setBitrateLimit",null),_o([xr(),He("design:type",Function),He("design:paramtypes",[String]),He("design:returntype",ct)],Fr.prototype,"setOptimizationMode",null),_o([xr(),He("design:type",Function),He("design:paramtypes",[Object]),He("design:returntype",void 0)],Fr.prototype,"setScalabiltyMode",null),_o([xr(),He("design:type",Function),He("design:paramtypes",[]),He("design:returntype",void 0)],Fr.prototype,"updateMediaStreamTrackResolution",null);class Fu extends Fr{constructor(t,r,i,s,l,d){super(t,r.encoderConfig?$o(r.encoderConfig):{},s,l,d),this._enabled=!0,this._deviceName="default",this.tryResumeVideoForIOS15WeChat=async()=>{Xs()&&!gp()&&mp()&&this._enabled&&!this._isClosed&&(S.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())},this._config=r,this._constraints=i,this._deviceName=t.label,this._config.encoderConfig&&(this._encoderConfig=$o(this._config.encoderConfig)),le.on(yr.IOS_15_INTERRUPTION_END,this.tryResumeVideoForIOS15WeChat),le.on(yr.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15WeChat)}async setDevice(t){var r;const i=wt.reportApiInvoke(null,{tag:zt.TRACER,name:de.CAM_VIDEO_TRACK_SET_DEVICE,options:[this.getTrackId(),t]});if(S.info(k(r="[".concat(this.getTrackId(),"] set device to ")).call(r,t)),this._enabled)try{const s=await dn.getDeviceById(t),l={};l.video=Bc({},this._constraints),l.video.deviceId={exact:t},l.video.facingMode=void 0,this._originMediaStreamTrack.stop();let d=null;try{d=await on(l,this.getTrackId())}catch(h){throw S.error("[".concat(this.getTrackId(),"] setDevice failed"),h.toString()),d=await on({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(d.getVideoTracks()[0],!1),h}await this._updateOriginMediaStreamTrack(d.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=s.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(s){throw i.onError(s),S.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}else try{const s=await dn.getDeviceById(t);this._deviceName=s.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(s){throw i.onError(s),S.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}S.info("[".concat(this.getTrackId(),"] setDevice success")),i.onSuccess()}async setEnabled(t,r){if(!r){if(t===this._enabled)return;this.stateCheck("enabled",t)}S.info("[".concat(this.getTrackId(),"] start setEnabled"),t);const i=await this._enabledMutex.lock();if(!t){this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),r||(this._enabled=!1);try{await Xe(this,ue.NEED_REMOVE_TRACK,this)}catch(d){throw S.error("[".concat(this.getTrackId(),"] setEnabled to false error"),d.toString()),i(),d}return S.info("[".concat(this.getTrackId(),"] setEnabled to false success")),i()}const s=Bc({},this._constraints),l=dn.searchDeviceIdByName(this._deviceName);l&&!s.deviceId&&(s.deviceId={exact:l});try{const d=await on({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(d.getVideoTracks()[0],!1),await Xe(this,ue.NEED_ADD_TRACK,this)}catch(d){throw S.error("[".concat(this.getTrackId(),"] setEnabled true error"),d.toString()),i(),d}this.updateMediaStreamTrackResolution(),S.info("[".concat(this.getTrackId(),"] setEnabled to true success")),r||(this._enabled=!0),i()}async setEncoderConfiguration(t,r){const i=wt.reportApiInvoke(null,{tag:zt.TRACER,name:de.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG,options:[this.getTrackId(),t]});if(!this._enabled){const d=new P(D.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");throw i.onError(d),d}t=$o(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin);const s=In(this._config);s.encoderConfig=t;const l=Kl(s);S.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),St(t),St(l));try{await this._originMediaStreamTrack.applyConstraints(l),this.updateMediaStreamTrackResolution()}catch(d){const h=new P(D.UNEXPECTED_ERROR,d.toString());throw S.error("[".concat(this.getTrackId(),"] applyConstraints error"),h.toString()),i.onError(h),h}this._config=s,this._constraints=l,this._encoderConfig=t;try{await Xe(this,ue.NEED_RENEGOTIATE)}catch(d){return i.onError(d),d.throw()}i.onSuccess()}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((ui()||Zo())&&this._enabled&&!this._isClosed&&le.duringInterruption){const t=async()=>{le.off(yr.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(S.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};le.on(yr.IOS_INTERRUPTION_END,t)}else S.debug("[".concat(this.getTrackId(),"] track ended")),this.emit($l.TRACK_ENDED)}async renewMediaStreamTrack(){const t=Bc({},this._constraints),r=dn.searchDeviceIdByName(this._deviceName);r&&!t.deviceId&&(t.deviceId={exact:r});const i=await on({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}close(){super.close(),le.off(yr.IOS_15_INTERRUPTION_END,this.tryResumeVideoForIOS15WeChat),le.off(yr.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15WeChat)}}function w_(e,t){const r=e.match(/a=rtpmap:(\d+) opus/);if(!r||!r[0]||!r[1])return e;const i=r[1],s=e.match("a=fmtp:".concat(i,`.*\r
`));if(!s||!s[0])return e;let l="a=fmtp:".concat(i," minptime=10;useinbandfec=1;");var d;return t.bitrate&&!Gr()&&(l+="maxaveragebitrate=".concat(Math.floor(1e3*t.bitrate),";")),t.sampleRate&&(l+=k(d="maxplaybackrate=".concat(t.sampleRate,";sprop-maxcapturerate=")).call(d,t.sampleRate,";")),t.stereo&&(l+="stereo=1;sprop-stereo-1;"),l+=`\r
`,e=e.replace(s[0],l)}function eN(e){return e.replace("minptime=10","minptime=10;stereo=1;sprop-stereo=1")}function rN(e,t,r){let i=!1;switch(t){case"h264":return e;case"vp8":if(!it("SIMULCAST"))return e;i=!0,r&&(r.numSpatialLayers=2);case"vp9":i=!0;case"av1":i=!0}if(i){var s;const K=Lr(s=RegExp.prototype.test).call(s,/^([a-z])=(.*)/),j=e.split("m=");let nt,It,vt=null,Rt=null,X=null,rt=[],H=[],W=[],U=[],Ct=null,Et=null,gt=0;const Mt=[],Y=[];for(let $=0;$<j.length;++$)if(vt=j[$].match(/a=msid-semantic:/),vt){vt=j[$];break}for(let $=0;$<j.length;++$)if(Rt=j[$].match(/audio /),Rt){nt=$,Rt="m="+j[$];break}for(let $=0;$<j.length;++$)if(X=j[$].match(/video /),X){It=$,X="m="+j[$];break}var l,d;if(vt&&(rt=kt(l=vt.split(/(\r\n|\r|\n)/)).call(l,K)),rt.length>0&&(U=k(U).call(U,rt)),Rt&&(H=kt(d=Rt.split(/(\r\n|\r|\n)/)).call(d,K)),!X)return e;{var h;W=kt(h=X.split(/(\r\n|\r|\n)/)).call(h,K);for(let ot=0;ot<W.length;++ot)if(Ct===null&&(Ct=W[ot].match(/cname:/),Ct!==null)){Ct="cname:"+W[ot].split("cname:")[1];break}for(let ot=0;ot<W.length;++ot)if(Et===null&&(Et=W[ot].match(/a=msid:/),Et!==null&&(Et="msid:"+W[ot].split(":")[1])),W[ot].match(/a=ssrc-group:FID/)){const Lt=W[ot].split(" ");gt=ot,Mt.push(Number(Lt[1])),Lt[2]&&Y.push(Number(Lt[2])),W.length=gt;break}for(let ot=1;ot<r.numSpatialLayers;++ot)Mt.push(Mt[0]+ot),Y.length>0&&Y.push(Y[0]+ot);let $="a=ssrc-group:SIM ";const mt="a=ssrc-group:FID ";for(let ot=0;ot<Mt.length;++ot)$=k($).call($,String(Mt[ot])),ot<Mt.length-1&&($=k($).call($," "));W.push($);for(let ot=0;ot<r.numSpatialLayers;++ot){var p,m;const Lt=k(p=k(m=mt.concat(String(Mt[ot]))).call(m," ")).call(p,String(Y[ot]));W.push(Lt)}for(let ot=0;ot<r.numSpatialLayers;++ot){var f,_,v,T;if(Ct===null||Et===null)return e;const Lt=k(f=k(_="a=ssrc:".concat(String(Mt[ot]))).call(_," ")).call(f,Ct),at=k(v=k(T="a=ssrc:".concat(String(Mt[ot]))).call(T," ")).call(v,Et);W.push(Lt),W.push(at)}for(let ot=0;ot<r.numSpatialLayers;++ot){var R,w,O,B;if(Ct===null||Et===null)return e;const Lt=k(R=k(w="a=ssrc:".concat(String(Y[ot]))).call(w," ")).call(R,Ct),at=k(O=k(B="a=ssrc:".concat(String(Y[ot]))).call(B," ")).call(O,Et);W.push(Lt),W.push(at)}}nt&&It&&nt>It?(U=k(U).call(U,W),U=k(U).call(U,H)):(U=k(U).call(U,H),U=k(U).call(U,W)),e=U.join(`\r
`)+`\r
`}return e}_o([xr(),He("design:type",Function),He("design:paramtypes",[String]),He("design:returntype",ct)],Fu.prototype,"setDevice",null),_o([xr(),He("design:type",Function),He("design:paramtypes",[Boolean,Boolean]),He("design:returntype",ct)],Fu.prototype,"setEnabled",null),_o([xr(),He("design:type",Function),He("design:paramtypes",[Object,Boolean]),He("design:returntype",ct)],Fu.prototype,"setEncoderConfiguration",null);const nN=(e,t)=>{let r=null;if(t==="h264"?r=e.match(/a=rtpmap:(\d+) H264.*\r\n/)||e.match(/a=rtpmap:(\d+) H264.*\n/):t==="vp8"?r=e.match(/a=rtpmap:(\d+) VP8.*\r\n/)||e.match(/a=rtpmap:(\d+) VP8.*\n/):t==="vp9"?r=e.match(/a=rtpmap:(\d+) VP9.*\r\n/)||e.match(/a=rtpmap:(\d+) VP9.*\n/):t==="av1"&&(r=e.match(/a=rtpmap:(\d+) AV1.*\r\n/)||e.match(/a=rtpmap:(\d+) AV1.*\n/)),r&&r[1])return r[1]};function b_(e,t){const r=(s,l)=>{const d=nN(s,l);return d?r(i(s,d),l):s},i=(s,l)=>{var d,h;const p=Lr(d=RegExp.prototype.test).call(d,/^([a-z])=(.*)/),m=["a=rtpmap:".concat(l),"a=rtcp-fb:".concat(l),"a=fmtp:".concat(l)],f=kt(h=s.split(/(\r\n|\r|\n)/)).call(h,p),_=[];V(f).call(f,(w,O)=>{V(m).call(m,B=>{qt(w).call(w,B)&&_.push(O)})});const v=Yn(f).call(f,w=>qt(w).call(w,"apt=".concat(l)));let T;if(v){_.push(v,v-1);const w=f[v-1].match(/a=rtpmap:(\d+) rtx.*/);T=w&&w[1]}V(_).call(_,w=>{f[w]=""});const R=Yn(f).call(f,w=>qt(w).call(w,"m=video"));return f[R]=f[R].replace(" ".concat(l),""),T&&(f[R]=f[R].replace(" ".concat(T),"")),kt(f).call(f,w=>!!w).join(`\r
`)+`\r
`};return V(t).call(t,s=>{e=r(e,s)}),e}function iN(e,t){var r=ae(e);if(Xt){var i=Xt(e);t&&(i=kt(i).call(i,function(s){return jt(e,s).enumerable})),r.push.apply(r,i)}return r}function VA(e){for(var t=1;t<arguments.length;t++){var r,i,s=arguments[t]!=null?arguments[t]:{};t%2?V(r=iN(Object(s),!0)).call(r,function(l){mr(e,l,s[l])}):Zt?ur(e,Zt(s)):V(i=iN(Object(s))).call(i,function(l){ie(e,l,jt(s,l))})}return e}class oN extends $b{constructor(t,r,i,s){super(r,r.stringUid||r.uid),this.suspendTracks=[],this.type="pub",this.detecting=!1,this._waitingSuccessResponse=!1,this.handleMuteVideoTrack=(l,d,h)=>{let{track:p,muted:m}=l;this.setVideoTrackMuteState(m).then(d).catch(h)},this.handleMuteAudioTrack=(l,d,h)=>{let{track:p,muted:m}=l;this.setAudioTrackMuteState(m,p).then(d).catch(h)},this.renegotiateWithGateway=async()=>(S.debug("[pc-".concat(this.pc.ID,"] renegotiate start")),new ct(async(l,d)=>{this.connectionState="connecting";const h=_=>{_==="connected"&&(this.off(oe.CONNECTION_STATE_CHANGE,h),l()),_==="disconnected"&&(this.off(oe.CONNECTION_STATE_CHANGE,h),d(new P(Ze.OPERATION_ABORTED,"renegotiate abort")))};this.on(oe.CONNECTION_STATE_CHANGE,h),Gr()&&it("SIMULCAST")&&this.videoTrack&&this.videoTrack._scalabiltyMode&&await this.addSimulcast4Firefox(this.videoTrack._scalabiltyMode);let p=await this.pc.createOfferSDP();if(this.audioTrack&&this.audioTrack._encoderConfig&&(p=w_(p,this.audioTrack._encoderConfig)),this.videoTrack&&this.videoTrack._scalabiltyMode&&(this.codec!=="vp9"&&this.codec!=="vp8"?(this.videoTrack._scalabiltyMode.numSpatialLayers=1,this.videoTrack._scalabiltyMode.numTemporalLayers=1):(this.videoTrack._scalabiltyMode.numSpatialLayers>1||this.videoTrack._scalabiltyMode.numTemporalLayers>1)&&(p=rN(p,this.codec,this.videoTrack._scalabiltyMode)),S.debug("renegoation spatial layers: ",this.videoTrack._scalabiltyMode.numSpatialLayers)),await this.pc.setOfferSDP(p),this.audioTrack instanceof ni){const _={videoActive:this.videoTrack&&!this.videoTrack.muted,audioActive:this.audioTrack&&this.audioTrack.isActive};this.pc.onOfferSettled(_)}const m=await Ur(this,oe.NEED_RENEGOTIATE,p);this.videoTrack&&!Gr()&&it("SIMULCAST")&&this.videoTrack._scalabiltyMode&&this.setSimulcastVideoRtpEncodingParameters(this.videoTrack._scalabiltyMode);const f=function(_,v){var T,R,w;const O=Lr(T=RegExp.prototype.test).call(T,/^([a-z])=(.*)/),B=kt(R=_.split(/(\r\n|\r|\n)/)).call(R,O),K=kt(w=v.split(/(\r\n|\r|\n)/)).call(w,O);let j=null;const nt=new $t;return V(B).call(B,It=>{const vt=It.match(/m=(audio|video)/);if(vt&&vt[1])return void(j=vt[1]);if(!j)return;const Rt=It.match(/\=(sendrecv|recvonly|sendonly|inactive)/);Rt&&Rt[1]&&nt.set(j,Rt[1])}),j=null,pt(K).call(K,It=>{const vt=It.match(/m=(audio|video)/);if(vt&&vt[1])return j=vt[1],It;if(!j)return It;const Rt=It.match(/\=(sendrecv|recvonly|sendonly|inactive)/);if(Rt&&Rt[1]){const X=nt.get(j);if(X&&X!==Rt[1])return It.replace(Rt[1],X)}return It}).join(`\r
`)+`\r
`}(p,this.updateAnswerSDP(m.sdp));await this.pc.setAnswerSDP(f),S.debug("[pc-".concat(this.pc.ID,"] renegotiate success")),this.connectionState="connected"})),this.handleStreamRenegotiate=(l,d)=>{this.connectionState==="connected"?this.renegotiateWithGateway().then(l).catch(d):l()},this.handleReplaceTrack=(l,d,h)=>{if(this.audioTrack instanceof ni&&l.kind==="audio")return d();this.pc.replaceTrack(l).then(p=>p?this.renegotiateWithGateway():ct.resolve()).then(d).catch(h)},this.handleCloseAudioTrack=l=>{},this.handleCloseVideoTrack=()=>{this.lowStreamConnection&&this.lowStreamConnection.videoTrack&&this.lowStreamConnection.videoTrack.close()},this.handleGetSessionID=l=>{l(this.joinInfo.sid)},this.handleGetLocalVideoStats=l=>{l(this.statsCollector.getLocalVideoTrackStats(this.connectionId))},this.handleGetLocalAudioStats=l=>{l(this.statsCollector.getLocalAudioTrackStats(this.connectionId))},this.handleSetOptimizationMode=(l,d,h)=>{this.videoTrack&&this.setRtpSenderParametersByTrackConfig(this.videoTrack).then(d).catch(h)},this.isLowStreamConnection=!!s,this.codec=i,this.statsCollector=t,this.statsCollector.addLocalConnection(this)}getAllTracks(){let t=[];return this.videoTrack&&t.push(this.videoTrack),this.audioTrack&&this.audioTrack instanceof ni?t=k(t).call(t,this.audioTrack.trackList):this.audioTrack&&t.push(this.audioTrack),t.push(...this.suspendTracks),t}async addTracks(t){const r=Dr();if(this.connectionState==="connecting")try{return await this.createWaitConnectionConnectedPromise(),await this.addTracks(t)}catch{throw new P(Ze.OPERATION_ABORTED,"publish abort")}let i=!1;const s=this.getAllTracks();t=Wp(t=kt(t).call(t,l=>xt(s).call(s,l)===-1));for(let l=0;l<t.length;l+=1){const d=t[l];if(!(d instanceof UA))return new P(Ze.INVALID_LOCAL_TRACK).throw();if(d instanceof Fr&&this.disabledVideoTrack){if(this.disabledVideoTrack!==d)return new P(Ze.EXIST_DISABLED_VIDEO_TRACK).throw();this.disabledVideoTrack=void 0}if(d instanceof Fr&&this.videoTrack)return new P(Ze.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw();if(d instanceof bn){if(this.audioTrack&&this.audioTrack._bypassWebAudio)throw S.error("One of the audio track was created with config bypassWebAudio set to true, there is no way to publish multiple audio tracks."),new P(Ze.CAN_NOT_PUBLISH_MULTIPLE_AUDIO_TRACKS);if(this.audioTrack instanceof ni)this.audioTrack.trackList.length===0&&await this.pc.setAudioRtpEncodingParameters({active:!0}),this.audioTrack.addAudioTrack(d);else if(r.webAudioMediaStreamDest)if(d._bypassWebAudio){if(this.audioTrack)throw S.error("Can not publish another audio track with bypassWebAudio set to true."),new P(Ze.CAN_NOT_PUBLISH_MULTIPLE_AUDIO_TRACKS);S.debug("[".concat(this.connectionId,"] audio track doesn't not pass through WebAudio, use original audio track to publish")),i=await this.addTrackWithPC(d)}else{const h=new ni;d.muted?this.suspendTracks.push(d):h.addAudioTrack(d),i=await this.addTrackWithPC(h)}else S.debug("[".concat(this.connectionId,"] your browser does not support mixing track, use original audio track to publish")),i=await this.addTrackWithPC(d)}else if(d instanceof Fr&&this.isLowStreamConnection){const h=VA(VA({},{width:160,height:120,framerate:15,bitrate:50}),this.lowStreamParameter);let p;if(r.supportDualStreamEncoding)S.debug("[".concat(this.connectionId,"] creating low stream using rtp encoding.")),this.lowStreamEncoding=J7(h,d),p=d.clone({bitrateMax:h.bitrate,bitrateMin:h.bitrate});else{S.debug("[".concat(this.connectionId,"] creating low stream using canvas."));const m=Jw(d,h);p=new Fr(m,{bitrateMax:h.bitrate,bitrateMin:h.bitrate})}p._hints.push(ks.LOW_STREAM),i=await this.addTrackWithPC(p),this.bindTrackEvents(p)}else this.detecting=!0,ar(()=>{this.detecting=!1},8e3),i=await this.addTrackWithPC(d)}await this.updateControlMessage(),i&&await this.renegotiateWithGateway(),V(t).call(t,l=>this.bindTrackEvents(l))}async removeTracks(t,r){const i=this.getAllTracks();t=Wp(t=kt(t).call(t,d=>xt(i).call(i,d)!==-1||d===this.disabledVideoTrack));const s=[];for(let d=0;d<t.length;d+=1){const h=t[d];if(this.unbindTrackEvents(h),this.audioTrack instanceof ni&&h instanceof bn)this.audioTrack.removeAudioTrack(h),na(this.suspendTracks,h),this.audioTrack.trackList.length===0&&(s.push(this.audioTrack),this.audioTrack=void 0);else if(h instanceof bn)s.push(h),this.audioTrack=void 0;else if(h instanceof Fr){if(r){if(this.disabledVideoTrack===h)return void(this.disabledVideoTrack=void 0)}else this.disabledVideoTrack=this.videoTrack;s.push(h),this.isLowStreamConnection&&h.close(),this.videoTrack=void 0}}if(this.videoTrack||this.audioTrack){if(s.length===0)return;if(this.connectionState==="connecting")try{await this.createWaitConnectionConnectedPromise()}catch{return}for(const d of s){var l;S.debug(k(l="[".concat(this.connectionId,"] remove ")).call(l,d.trackMediaType," from pc")),await this.pc.removeTrack(d._mediaStreamTrack);const h=Se();h.name==="Safari"&&h.version==="11"&&await d.renewMediaStreamTrack()}await this.renegotiateWithGateway()}else await this.closeP2PConnection()}async updateControlMessage(){this.audioTrack instanceof ni&&this.connectionState==="connected"&&(this.audioTrack&&await Ur(this,oe.NEED_CONTROL,{type:"audio",muted:!this.audioTrack.isActive}),this.videoTrack&&await Ur(this,oe.NEED_CONTROL,{type:"video",muted:this.videoTrack.muted}))}async setSimulcastVideoRtpEncodingParameters(t){const r=this.pc.getSender("video");if(!r)throw new P(Ze.LOW_STREAM_ENCODING_ERROR,"Low stream has no video sender.");const i=r.getParameters();if(!i.encodings||!i.encodings[0])throw new P(Ze.LOW_STREAM_ENCODING_ERROR,"Low stream RtpEncodingParameters is empty.");if(this.videoTrack&&this.videoTrack._encoderConfig&&this.videoTrack._encoderConfig.bitrateMax&&this.videoTrack._encoderConfig.bitrateMax>200&&t.numSpatialLayers>1){const s={high:1e3*(this.videoTrack._encoderConfig.bitrateMax-50),medium:5e4};i.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:s.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:s.medium,scaleResolutionDownBy:4}]}await r.setParameters(i)}startP2PConnection(){return new ct(async(t,r)=>{if(!this.audioTrack&&!this.videoTrack)return r(new P(Ze.UNEXPECTED_ERROR,"no track to publish"));const i=l=>{if(l==="connected"&&(this.off(oe.CONNECTION_STATE_CHANGE,i),t()),l==="disconnected"){if(this.off(oe.CONNECTION_STATE_CHANGE,i),this.disconnectedReason)return r(this.disconnectedReason);r(new P(Ze.OPERATION_ABORTED,"publish abort"))}};this.on(oe.CONNECTION_STATE_CHANGE,i),this.disconnectedReason=void 0,this.connectionState="connecting",this._waitingSuccessResponse=!0,this.startTime=ht();try{var s;!this.pc.audioTrack&&this.audioTrack&&await this.pc.addTrack(this.audioTrack._mediaStreamTrack),!this.pc.videoTrack&&this.videoTrack&&await this.pc.addTrack(this.videoTrack._mediaStreamTrack),Gr()&&it("SIMULCAST")&&this.videoTrack&&this.videoTrack._scalabiltyMode&&await this.addSimulcast4Firefox(this.videoTrack._scalabiltyMode);let l=await this.pc.createOfferSDP();it("REMOVE_NEW_CODECS")&&(l=this.codec==="vp9"?b_(l,["av1"]):this.codec==="av1"?b_(l,["vp9"]):b_(l,["vp9","av1"]));const d=function(f){const _={video:[],audio:[]};return f.match(/ VP8/i)&&_.video.push("VP8"),f.match(/ VP9/i)&&_.video.push("VP9"),f.match(/ AV1X/i)&&_.video.push("AV1"),f.match(/ H264/i)&&_.video.push("H264"),f.match(/ opus/i)&&_.audio.push("OPUS"),_}(l);if(this.videoTrack&&!qt(s=d.video).call(s,this.codec.toUpperCase())&&S.warning("current codec is not supported, support list: ".concat(d.video.join(","))),this.audioTrack&&this.audioTrack._encoderConfig&&(l=w_(l,this.audioTrack._encoderConfig)),this.videoTrack&&!Gr()&&this.videoTrack._scalabiltyMode&&(this.codec!=="vp9"&&this.codec!=="vp8"?(this.videoTrack._scalabiltyMode.numSpatialLayers=1,this.videoTrack._scalabiltyMode.numTemporalLayers=1):(this.videoTrack._scalabiltyMode.numSpatialLayers>1||this.videoTrack._scalabiltyMode.numTemporalLayers>1)&&(l=rN(l,this.codec,this.videoTrack._scalabiltyMode)),S.debug("spatial layers: ",this.videoTrack._scalabiltyMode.numSpatialLayers)),await this.pc.setOfferSDP(l),this.audioTrack instanceof ni){const f={videoActive:this.videoTrack&&!this.videoTrack.muted,audioActive:this.audioTrack&&this.audioTrack.isActive};this.pc.onOfferSettled(f)}this.videoTrack&&this.setRtpSenderParametersByTrackConfig(this.videoTrack),S.debug("[".concat(this.connectionId,"] create and set offer success"));const h={messageType:"OFFER",sdp:l,offererSessionId:104,retry:!0};Dr().supportDualStreamEncoding&&this.isLowStreamConnection&&this.lowStreamEncoding&&this.videoTrack&&await this.setLowStreamEncoding(this.lowStreamEncoding,this.videoTrack),this.videoTrack&&!Gr()&&it("SIMULCAST")&&this.videoTrack._scalabiltyMode&&this.setSimulcastVideoRtpEncodingParameters(this.videoTrack._scalabiltyMode);const p=await Ur(this,oe.NEED_ANSWER,h),m=this.updateAnswerSDP(p.sdp);await this.pc.setAnswerSDP(m),S.debug("[".concat(this.connectionId,"] set answer success")),await this.icePromise,this.connectionState="connected",this.startUploadStats()}catch(l){this.off(oe.CONNECTION_STATE_CHANGE,i),this.connectionState="disconnected",this.reportPublishEvent(!1,l.code),S.error("[".concat(this.connectionId,"] connection error"),l.toString()),r(l)}})}reportPublishEvent(t,r,i){var s;this._waitingSuccessResponse=!1,wt.publish(this.joinInfo.sid,{lts:this.startTime,succ:t,ec:r,audioName:this.audioTrack&&(this.audioTrack instanceof ni?this.audioTrack.getSubTrackLabels().join(","):this.audioTrack.getTrackLabel()),videoName:this.videoTrack&&this.videoTrack.getTrackLabel(),screenshare:!(!this.videoTrack||xt(s=this.videoTrack._hints).call(s,ks.SCREEN_TRACK)===-1),audio:!!this.audioTrack,video:!!this.videoTrack,p2pid:this.pc.ID,publishRequestid:this.ID,extend:i})}async closeP2PConnection(t){const r=this.getAllTracks();var i;V(r).call(r,s=>{this.unbindTrackEvents(s)}),this.isLowStreamConnection&&this.videoTrack&&this.videoTrack.close(),this.videoTrack=void 0,this.audioTrack instanceof ni&&(V(i=this.audioTrack.trackList).call(i,s=>{this.audioTrack.removeAudioTrack(s)}),this.audioTrack.close()),this.audioTrack=void 0,this.stopUploadStats(),this.statsCollector.removeConnection(this.connectionId),await this.closePC(t),this.connectionState="disconnected",this.removeAllListeners()}getNetworkQuality(){var t;const r=this.pc.getStats();if(!r.videoSend[0]&&!r.audioSend[0])return 1;const i=po(this,oe.NEED_SIGNAL_RTT),s=r.videoSend[0]?r.videoSend[0].rttMs:void 0,l=r.audioSend[0]?r.audioSend[0].rttMs:void 0,d=s&&l?(s+l)/2:s||l,h=(d&&i?(d+i)/2:d||i)||0,p=100*r.sendPacketLossRate*.7/50+.3*h/1500,m=p<.17?1:p<.36?2:p<.59?3:p<.1?4:5;if(this.videoTrack&&this.videoTrack._encoderConfig&&xt(t=this.videoTrack._hints).call(t,ks.SCREEN_TRACK)===-1){const f=this.videoTrack._encoderConfig.bitrateMax,_=r.bitrate.actualEncoded;if(f&&_){const v=(1e3*f-_)/(1e3*f);return sR[v<.15?0:v<.3?1:v<.45?2:v<.6?3:4][m]}}return m}handleUpdateBitrateLimit(t){this.videoTrack&&this.videoTrack.setBitrateLimit(t)}async setAudioTrackMuteState(t,r){if(!(this.audioTrack instanceof ni))return void S.debug("[".concat(this.connectionId,"] set audio mute in unsupported environment"));const i=this.audioTrack;try{if(t){var s;i.removeAudioTrack(r),i.trackList.length===0&&(S.debug(k(s="[".concat(this.connectionId,"] set audio encoding active, id: ")).call(s,r.getTrackId(),", state: ",!1)),await this.pc.setAudioRtpEncodingParameters({active:!1})),this.suspendTracks.push(r)}else await this.pc.setAudioRtpEncodingParameters({active:!0}),i.addAudioTrack(r),na(this.suspendTracks,r)}catch(d){var l;S.warning(k(l="[".concat(this.connectionId,"] set audio muted error ")).call(l,d,", fallback to set enabled"))}await Ur(this,oe.NEED_CONTROL,{type:"audio",muted:!(!this.audioTrack||this.audioTrack.isActive)})}async setVideoTrackMuteState(t){const r=!t;let i=!1;if(Se().name===zl.FIREFOX)i=!0;else try{var s,l;S.debug(k(s=k(l="[".concat(this.connectionId,"] set video encoding active, id: ")).call(l,this.videoTrack&&this.videoTrack.getTrackId(),", state: ")).call(s,r)),await this.pc.setVideoRtpEncodingParameters({active:r})}catch(m){var d;S.warning(k(d="[".concat(this.connectionId,"] set video encoding active error ")).call(d,m,", fallback to set enabled")),i=!0}var h,p;i&&this.videoTrack&&(S.debug(k(h=k(p="[".concat(this.connectionId,"] set video encoding active fallback to enabled on firefox, type: ")).call(p,this.videoTrack&&this.videoTrack.getTrackId(),", state: ")).call(h,r)),this.videoTrack.getMediaStreamTrack().enabled=r),this.lowStreamConnection&&this.lowStreamConnection.setVideoTrackMuteState(t),!this.isLowStreamConnection&&await Ur(this,oe.NEED_CONTROL,{type:"video",muted:t})}uploadStats(t,r){const i=this.audioTrack?function(h,p){const m=h.audioSend[0];if(!m)return null;const f={id:Pe(10,""),timestamp:new Date(h.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:m.ssrc.toString()};return f.A_astd=p._originMediaStreamTrack.enabled&&p._mediaStreamTrack.enabled?"0":"1",m.inputLevel?f.A_ail=Math.round(100*m.inputLevel).toString():f.A_ail=Math.round(100*p._source.getAccurateVolumeLevel()).toString(),f.A_apil=Math.round(100*p._source.getAccurateVolumeLevel()).toString(),f}(t,this.audioTrack):void 0,s=this.videoTrack?function(h,p){const m=h.videoSend[0];if(!m)return null;const f={id:Pe(10,""),timestamp:new Date(h.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:m.ssrc.toString()};switch(f.A_vstd=p._originMediaStreamTrack&&!p._originMediaStreamTrack.enabled||!p._mediaStreamTrack.enabled?"1":"0",m.sentFrame&&(f.A_fhs=m.sentFrame.height.toString(),f.A_frs=m.sentFrame.frameRate.toString(),f.A_fws=m.sentFrame.width.toString()),m.adaptionChangeReason){case"none":f.A_ac="0";break;case"cpu":f.A_ac="1";break;case"bandwidth":f.A_ac="2";break;case"other":f.A_ac="3"}return f.A_nr=m.nacksCount.toString(),m.avgEncodeMs&&(f.A_aem=m.avgEncodeMs.toFixed(0).toString()),f}(t,this.videoTrack):void 0,l=Mb(t,r),d=function(h){const p={id:"bweforvideo",timestamp:new Date(h.timestamp).toISOString(),type:"VideoBwe"};return h.bitrate.retransmit&&(p.A_rb=h.bitrate.retransmit.toString()),h.bitrate.targetEncoded&&(p.A_teb=h.bitrate.targetEncoded.toString()),p.A_aeb=h.bitrate.actualEncoded.toString(),p.A_tb=h.bitrate.transmit.toString(),h.sendBandwidth!==void 0&&(p.A_asb=h.sendBandwidth.toString()),p}(t);i&&sn(()=>this.emit(oe.NEED_UPLOAD,Qo.PUBLISH_STATS,i)),s&&sn(()=>this.emit(oe.NEED_UPLOAD,Qo.PUBLISH_STATS,VA(VA({},s),l))),d&&sn(()=>this.emit(oe.NEED_UPLOAD,Qo.PUBLISH_STATS,d))}uploadSlowStats(t){const r=Mb(t);r&&sn(()=>this.emit(oe.NEED_UPLOAD,Qo.PUBLISH_STATS,r))}uploadRelatedStats(t){const r=function(i){const s=i.videoSend[0];return s?{mediaType:"video",isVideoMute:!1,frameRateInput:s.inputFrame&&s.inputFrame.frameRate.toString(),frameRateSent:s.sentFrame&&s.sentFrame.frameRate.toString(),googRtt:s.rttMs.toString()}:null}(t);r&&(r.isVideoMute=!(!this.videoTrack||!this.videoTrack.muted),sn(()=>{this.emit(oe.NEED_UPLOAD,Qo.PUBLISH_RELATED_STATS,r)}))}async addSimulcast4Firefox(t){if(Gr()&&this.videoTrack&&this.videoTrack._encoderConfig&&this.videoTrack._encoderConfig.bitrateMax&&this.videoTrack._encoderConfig.bitrateMax>200&&t.numSpatialLayers>1&&this.codec==="vp8"){const r=this.pc.getSender("video");if(r){const i=r.getParameters();S.debug("getParameters : ",i),i||S.error("[".concat(this.connectionId,"] get sender parameter error."));const s={high:1e3*(this.videoTrack._encoderConfig.bitrateMax-50),medium:5e4};i.encodings=[{rid:"m",active:!0,maxBitrate:s.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:s.high}],await r.setParameters(i),S.debug("setParameters : ",i)}}}bindTrackEvents(t){var r;t.addListener(ue.NEED_RESET_REMOTE_SDP,Lr(r=this.handleResetRemoteSdp).call(r,this)),this.isLowStreamConnection||(t instanceof bn?(t.addListener(ue.GET_STATS,this.handleGetLocalAudioStats),t.addListener(ue.NEED_CLOSE,this.handleCloseAudioTrack),t.addListener(ue.SET_AUDIO_TRACK_MUTED,this.handleMuteAudioTrack)):t instanceof Fr&&(t.addListener(ue.GET_STATS,this.handleGetLocalVideoStats),t.addListener(ue.NEED_CLOSE,this.handleCloseVideoTrack),t.addListener(ue.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),t.addListener(ue.SET_VIDEO_TRACK_MUTED,this.handleMuteVideoTrack)),t.addListener(ue.NEED_RENEGOTIATE,this.handleStreamRenegotiate),t.addListener(ue.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(ue.NEED_SESSION_ID,this.handleGetSessionID))}unbindTrackEvents(t){this.isLowStreamConnection||(t instanceof bn?(t.off(ue.GET_STATS,this.handleGetLocalAudioStats),t.off(ue.NEED_CLOSE,this.handleCloseAudioTrack),t.off(ue.SET_AUDIO_TRACK_MUTED,this.handleMuteAudioTrack)):t instanceof Fr&&(t.off(ue.GET_STATS,this.handleGetLocalVideoStats),t.off(ue.NEED_CLOSE,this.handleCloseVideoTrack),t.off(ue.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),t.off(ue.SET_VIDEO_TRACK_MUTED,this.handleMuteVideoTrack)),t.off(ue.NEED_RENEGOTIATE,this.handleStreamRenegotiate),t.off(ue.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(ue.NEED_SESSION_ID,this.handleGetSessionID))}async addTrackWithPC(t){if(this.connectionState==="connecting")return new P(Ze.INVALID_OPERATION,"last publish operation has not finished").throw();const r=this.videoTrack;let i=!1;return this.audioTrack&&t instanceof ni?(this.audioTrack=t,S.debug("[".concat(this.connectionId,"] replace pc audio track")),i=await this.pc.replaceTrack(t._mediaStreamTrack)):this.videoTrack&&t instanceof Fr?(this.videoTrack=t,S.debug("[".concat(this.connectionId,"] replace pc video track")),i=await this.pc.replaceTrack(t._mediaStreamTrack)):t instanceof bn?(this.audioTrack=t,S.debug("[".concat(this.connectionId,"] add audio track to pc")),await this.pc.addTrack(t._mediaStreamTrack),i=!0):t instanceof Fr&&(this.videoTrack=t,S.debug("[".concat(this.connectionId,"] add video track to pc")),await this.pc.addTrack(t._mediaStreamTrack),i=!0),this.connectionState==="connected"&&this.videoTrack!==r&&this.videoTrack&&await this.setRtpSenderParametersByTrackConfig(this.videoTrack),this.connectionState!=="disconnected"&&i}handleResetRemoteSdp(){return new ct((t,r)=>{var i;S.info("[pc-".concat(this.pc.ID,"] start reset remote sdp"));const s=this.pc.getOfferSDP(),l=this.pc.getAnswerSDP();if(!l||!s)return t();const d=l.sdp;let h;this.videoTrack&&this.videoTrack._encoderConfig&&xt(i=this.videoTrack._hints).call(i,ks.SCREEN_TRACK)===-1&&(h=function(p,m){var f,_;const v=m.bitrateMin;let T=m.bitrateMax;const R=Lr(f=RegExp.prototype.test).call(f,/^([a-z])=(.*)/),w=kt(_=p.split(/(\r\n|\r|\n)/)).call(_,R);if(T){let B="AS";Se().name===ye.FIREFOX&&(T=1e3*(T>>>0),B="TIAS");const K=Yn(w).call(w,j=>qt(j).call(j,B));var O;K>0&&(w[K]=k(O="b=".concat(B,":")).call(O,T))}if(v){const B=Yn(w).call(w,K=>qt(K).call(K,"x-google-min-bitrate"));B>0&&(w[B]=w[B].replace(/x-google-min-bitrate=(.*)/,"x-google-min-bitrate=".concat(v)))}return w.join(`\r
`)+`\r
`}(d,this.videoTrack._encoderConfig)),d!==h?this.pc.setOfferSDP(s.sdp).then(()=>{if(h)return this.pc.setAnswerSDP(h)}).then(t).catch(p=>{var m;S.error(k(m="[pc-".concat(this.pc.ID,"] reset remote sdp error, ")).call(m,p)),r(p)}):S.debug("[pc-".concat(this.pc.ID,"] remote sdp have no not changed"))})}async setRtpSenderParametersByTrackConfig(t){if(!Dr().supportSetRtpSenderParameters)return void S.debug("[".concat(this.connectionId,"] do not support set pc rtp sender, skip"));const r={};let i="balanced";t._optimizationMode==="motion"?i="maintain-framerate":t._optimizationMode==="detail"&&(i="maintain-resolution"),S.debug("[".concat(this.connectionId,"] set pc rtp sender"),r,i),await this.pc.setRtpSenderParameters(r,i)}updateAnswerSDP(t){var r,i;return t=t.replace(/a=x-google-flag:conference\r\n/g,""),this.videoTrack&&xt(r=this.videoTrack._hints).call(r,ks.SCREEN_TRACK),this.videoTrack&&this.videoTrack._encoderConfig&&xt(i=this.videoTrack._hints).call(i,ks.SCREEN_TRACK)===-1&&(t=function(s,l,d){const h=Dr(),p=d.bitrateMin;let m=d.bitrateMax;const f=s.match(/m=video.*\r\n/)||s.match(/m=video.*\n/);if(f&&f.length>0&&h.supportMinBitrate&&p){const B=nN(s,l);if(B)if(it("SIMULCAST")){var _,v;const K=m?.7*m:300;s=s.replace(f[0],k(_=k(v="".concat(f[0],"a=fmtp:")).call(v,B," x-google-start-bitrate=")).call(_,K,`\r
`))}else{var T,R;s=s.replace(f[0],k(T=k(R="".concat(f[0],"a=fmtp:")).call(R,B," x-google-min-bitrate=")).call(T,p,`\r
`))}}if(f&&f.length>0&&m){var w,O;let B="AS";Se().name===ye.FIREFOX&&(m=1e3*(m>>>0),B="TIAS"),s=s.replace(f[0],k(w=k(O="".concat(f[0],"b=")).call(O,B,":")).call(w,m,`\r
`))}return s}(t,this.codec,this.videoTrack._encoderConfig)),this.audioTrack&&this.audioTrack._encoderConfig&&(t=w_(t,this.audioTrack._encoderConfig)),t=function(s){const l=Se();return l.name!==ye.SAFARI&&l.os!==mn.IOS?s:s.replace(/a=.*video-orientation\r\n/g,"")}(t)}createPC(){this.pc=new rG({turnServer:this.joinInfo.turnServer}),this.updateICEPromise()}async closePC(t){return this.pc.onICEConnectionStateChange=void 0,this.pc.close(),!t&&await Ur(this,oe.NEED_UNPUB)}onPCDisconnected(t){this.reportPublishEvent(!1,t.code)}async setLowStreamEncoding(t,r){try{const i=await this.pc.setVideoRtpEncodingParameters(t),s=r.getMediaStreamTrack();if(t.scaleResolutionDownBy&&i.encodings[0].scaleResolutionDownBy!==t.scaleResolutionDownBy){const l=r._videoHeight||s.getSettings().height,d=r._videoWidth||s.getSettings().width;l&&d&&await s.applyConstraints({height:l/t.scaleResolutionDownBy,width:d/t.scaleResolutionDownBy})}t.maxFramerate&&i.encodings[0].maxFramerate!==t.maxFramerate&&await s.applyConstraints({frameRate:t.maxFramerate})}catch(i){throw i instanceof P?i:new P(Ze.LOW_STREAM_ENCODING_ERROR,i.message)}}}function sN(e,t){var r=ae(e);if(Xt){var i=Xt(e);t&&(i=kt(i).call(i,function(s){return jt(e,s).enumerable})),r.push.apply(r,i)}return r}function GA(e){for(var t=1;t<arguments.length;t++){var r,i,s=arguments[t]!=null?arguments[t]:{};t%2?V(r=sN(Object(s),!0)).call(r,function(l){mr(e,l,s[l])}):Zt?ur(e,Zt(s)):V(i=sN(Object(s))).call(i,function(l){ie(e,l,jt(s,l))})}return e}class aN extends Ob{constructor(t,r,i,s){var l,d,h;super(t,k(l=k(d=k(h="track-".concat(t.kind,"-")).call(h,r,"-")).call(d,s,"_")).call(l,Pe(5,""))),this._isDestroyed=!1,this._userId=r,this._uintId=i}getUserId(){return this._userId}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource()}_destroy(){this._isDestroyed=!0,S.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}}class Qu extends aN{constructor(t,r,i,s){super(t,r,i,s),this.trackMediaType="video",this.updateMediaStreamTrackResolution()}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==LA.PLAYING)}getStats(){return ys(()=>{S.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),po(this,ue.GET_STATS)||GA({},K7)}play(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=wt.reportApiInvoke(null,{tag:zt.TRACER,name:Ht.REMOTE_VIDEO_TRACK_PLAY,options:[this.getTrackId(),typeof t=="string"?t:"HTMLElement",r]});if(typeof t=="string"){const d=document.getElementById(t);var s;d?t=d:(S.warning(k(s="[".concat(this.getTrackId(),'] can not find "#')).call(s,t,'" element, use document.body')),t=document.body)}S.debug("[".concat(this.getTrackId(),"] start video playback"),St(r));const l=GA(GA({fit:"cover"},r),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(l):(this._player=new vA(l),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.emit(Lu.FIRST_FRAME_DECODED)}),this._player.play(),i.onSuccess()}stop(){const t=wt.reportApiInvoke(null,{tag:zt.TRACER,name:Ht.REMOTE_VIDEO_TRACK_STOP,options:[this.getTrackId()]});if(!this._player)return t.onSuccess();this._player.destroy(),this._player=void 0,S.debug("[".concat(this.getTrackId(),"] stop video playback")),t.onSuccess()}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){Kp(this._originMediaStreamTrack).then(t=>{let[r,i]=t;this._videoHeight=i,this._videoWidth=r}).catch(Ml)}_updatePlayerSource(){S.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var t,r;const i=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),s={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:l,slot:d}=s;if(this.isPlaying&&l instanceof HTMLVideoElement&&d instanceof HTMLElement){const h=c_.checkOneElementVisible(l),p=hr({},h);return p.visible||wt.reportApiInvoke(null,{tag:zt.TRACER,name:Ht.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]}).onSuccess("Not visible because of ".concat(p.reason)),p}return}catch(i){throw new P(D.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}}class Vu extends aN{constructor(t,r,i,s){super(t,r,i,s),this.trackMediaType="audio",this._useAudioElement=!0,this._volume=100,this._source=new Fp(t,!0),this._source.once(Os.RECEIVE_TRACK_BUFFER,()=>{this.emit(Lu.FIRST_FRAME_DECODED)})}get isPlaying(){return this._useAudioElement?Yr.isPlaying(this.getTrackId()):this._source.isPlayed}setAudioFrameCallback(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(Os.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(Os.ON_AUDIO_BUFFER),this._source.on(Os.ON_AUDIO_BUFFER,i=>t(i))}setVolume(t){const r=wt.reportApiInvoke(null,{tag:zt.TRACER,name:Ht.REMOTE_AUDIO_SET_VOLUME,options:[this.getTrackId(),t]},300);this._volume=t,this._useAudioElement?Yr.setVolume(this.getTrackId(),t):this._source.setVolume(t/100),r.onSuccess()}async setPlaybackDevice(t){const r=wt.reportApiInvoke(null,{tag:zt.TRACER,name:Ht.REMOTE_AUDIO_SET_OUTPUT_DEVICE,options:[this.getTrackId(),t]});if(!this._useAudioElement)throw new P(D.NOT_SUPPORTED,"your browser does not support setting the audio output device");try{await Yr.setSinkID(this.getTrackId(),t)}catch(i){throw r.onError(i),i}r.onSuccess()}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return ys(()=>{S.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),po(this,ue.GET_STATS)||GA({},H7)}play(){const t=wt.reportApiInvoke(null,{tag:zt.TRACER,name:Ht.REMOTE_AUDIO_TRACK_PLAY,options:[this.getTrackId()]});S.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(S.debug("[".concat(this.getTrackId(),"] use audio element to play")),Yr.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play(),t.onSuccess()}stop(){const t=wt.reportApiInvoke(null,{tag:zt.TRACER,name:Ht.REMOTE_AUDIO_TRACK_STOP,options:[this.getTrackId()]});S.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Yr.stop(this.getTrackId()):this._source.stop(),t.onSuccess()}_destroy(){super._destroy(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){S.debug("[".concat(this.getTrackId(),"] update player source track")),this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Yr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}}class iG extends $b{constructor(t,r,i,s){super(i,t.uid),this.type="sub",this.unusedTracks=[],this.onTrack=l=>{var d,h;if(l.kind==="audio"&&!this.subscribeOptions.audio||l.kind==="video"&&!this.subscribeOptions.video)return this.unusedTracks.push(l),void S.debug(k(h="[".concat(this.connectionId,"] unused ontrack event, kind: ")).call(h,l.kind));S.debug(k(d="[".concat(this.connectionId,"] emit pc ontrack after subscribe ")).call(d,l.kind),l);const p=l.kind==="audio"?this.user._audioTrack:this.user._videoTrack;var m,f;p?p._updateOriginMediaStreamTrack(l):l.kind==="audio"?(this.pc._statsFilter.setIsFirstAudioDecoded(!1),this.user._audioTrack=new Vu(l,this.getUserId(),this.user._uintid,this.joinInfo.clientId),S.info(k(m="[".concat(this.connectionId,"] create remote audio track: ")).call(m,this.user._audioTrack.getTrackId())),this.bindTrackEvents(this.user._audioTrack)):(this.user._videoTrack=new Qu(l,this.getUserId(),this.user._uintid,this.joinInfo.clientId),S.info(k(f="[".concat(this.connectionId,"] create remote video track: ")).call(f,this.user._videoTrack.getTrackId())),this.bindTrackEvents(this.user._videoTrack))},this.handleGetRemoteAudioStats=l=>{l(this.statsCollector.getRemoteAudioTrackStats(this.connectionId))},this.handleGetRemoteVideoStats=l=>{l(this.statsCollector.getRemoteVideoTrackStats(this.connectionId))},this.handleGetSessionID=l=>{l(this.joinInfo.sid)},this.user=t,this.statsCollector=r,this.statsCollector.addRemoteConnection(this),this.subscribeOptions=s}async startP2PConnection(){return new ct(async(t,r)=>{const i=p=>{if(p==="connected"&&(wt.subscribe(this.joinInfo.sid,{lts:this.startTime,succ:!0,video:this.subscribeOptions.video,audio:this.subscribeOptions.audio,peerid:this.user.uid,ec:null,subscribeRequestid:this.ID,p2pid:this.pc.ID}),this.off(oe.CONNECTION_STATE_CHANGE,i),t()),p==="disconnected"){if(this.off(oe.CONNECTION_STATE_CHANGE,i),this.disconnectedReason)return r(this.disconnectedReason);r(new P(D.OPERATION_ABORTED,"subscribe abort"))}};if(this.on(oe.CONNECTION_STATE_CHANGE,i),this.disconnectedReason=void 0,this.connectionState="connecting",this.startTime=ht(),!this.subscribeOptions)return void r(new P(D.UNEXPECTED_ERROR,"no subscribe options"));const s=new MediaStream,l=new ct(p=>{this.pc.onTrack=(m,f)=>{var _,v;if(m.kind==="audio"&&!this.subscribeOptions.audio||m.kind==="video"&&!this.subscribeOptions.video)return this.unusedTracks.push(m),void S.debug(k(v="[".concat(this.connectionId,"] unused ontrack event ")).call(v,m.kind));s.addTrack(m);const T={audio:s.getAudioTracks().length>0,video:s.getVideoTracks().length>0};S.debug(k(_="[".concat(this.connectionId,"] subscribe ontrack: ")).call(_,m.kind),f,m),function(R,w){var O,B;const K=Ua(O=ae(R)).call(O),j=Ua(B=ae(w)).call(B);for(let nt=0;nt<K.length;nt+=1)if(K[nt]!==j[nt]||R[K[nt]]!==w[K[nt]])return!1;return!0}(T,this.subscribeOptions)&&(this.pc.onTrack=this.onTrack,S.debug("[".concat(this.connectionId,"] get all subscribed tracks")),p(s))}});try{const p=function(R){return Se().name!==ye.FIREFOX?R:R.replace("/recvonly http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"," http://www.webrtc.org/experiments/rtp-hdrext/playout-delay")}(eN(await this.pc.createOfferSDP()));await this.pc.setOfferSDP(p),S.debug("[".concat(this.connectionId,"] create and set offer success"));const m={messageType:"OFFER",sdp:p,offererSessionId:104,retry:!0},f=await Ur(this,oe.NEED_ANSWER,m);await this.pc.setAnswerSDP(eN(f.sdp)),S.debug("[".concat(this.connectionId,"] set answer success"));const _=await ct.all([l,this.icePromise]),v=_[0].getAudioTracks()[0],T=_[0].getVideoTracks()[0];var d,h;v&&(this.user._audioTrack?this.user._audioTrack._updateOriginMediaStreamTrack(v):(this.user._audioTrack=new Vu(v,this.getUserId(),this.user._uintid,this.joinInfo.clientId),S.info(k(d="[".concat(this.connectionId,"] create remote audio track: ")).call(d,this.user._audioTrack.getTrackId())),this.bindTrackEvents(this.user._audioTrack))),T&&(this.user._videoTrack?this.user._videoTrack._updateOriginMediaStreamTrack(T):(this.user._videoTrack=new Qu(T,this.getUserId(),this.user._uintid,this.joinInfo.clientId),S.info(k(h="[".concat(this.connectionId,"] create remote video track: ")).call(h,this.user._videoTrack.getTrackId())),this.bindTrackEvents(this.user._videoTrack))),this.connectionState="connected",this.startUploadStats()}catch(p){this.off(oe.CONNECTION_STATE_CHANGE,i),this.connectionState="disconnected",wt.subscribe(this.joinInfo.sid,{lts:this.startTime,succ:!1,video:this.subscribeOptions.video,audio:this.subscribeOptions.audio,peerid:this.user.uid,ec:p.code,subscribeRequestid:this.ID,p2pid:this.pc.ID}),r(p)}})}async closeP2PConnection(t){this.connectionState!=="disconnected"&&(this.stopUploadStats(),this.statsCollector.removeConnection(this.connectionId),this.connectionState="disconnected",await this.setSubscribeOptions({audio:!1,video:!1}),await this.closePC(t),this.removeAllListeners())}getNetworkQuality(){const t=this.pc.getStats();if(!t.audioRecv[0]&&!t.videoRecv[0])return 1;const r=po(this,oe.NEED_SIGNAL_RTT),i=t.rtt,s=(i&&r?(i+r)/2:i||r)||0,l=t.audioRecv[0]?t.audioRecv[0].jitterMs:void 0,d=t.recvPacketLossRate;let h=.7*d*100/50+.3*s/1500;return l&&(h=.6*d*100/50+.2*s/1500+.2*l/400),h<.1?1:h<.17?2:h<.36?3:h<.59?4:5}uploadStats(t){const r=this.user.audioTrack?function(s,l){const d=s.audioRecv[0];if(!d)return null;const h={id:Pe(10,""),timestamp:new Date(s.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:d.ssrc.toString()};return h.bytesReceived=d.bytes.toString(),h.packetsLost=d.packetsLost.toString(),h.packetsReceived=d.packets.toString(),d.outputLevel?h.A_aol=Math.round(100*d.outputLevel).toString():h.A_aol=Math.round(100*l._source.getAccurateVolumeLevel()).toString(),h.A_apol=Math.round(100*l._source.getAccurateVolumeLevel()).toString(),l&&(h.A_artd=l._originMediaStreamTrack.enabled&&l._mediaStreamTrack.enabled?"0":"1"),h.A_jr=d.jitterMs.toString(),h.A_jbm=Math.floor(d.jitterBufferMs).toString(),h.A_cdm=Math.floor(d.jitterBufferMs).toString(),h}(t,this.user.audioTrack):void 0,i=this.user.videoTrack?function(s,l){const d=s.videoRecv[0];if(!d)return null;const h={id:Pe(10,""),timestamp:new Date(s.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:d.ssrc.toString()};var p;return h.bytesReceived=d.bytes.toString(),h.packetsLost=d.packetsLost.toString(),h.packetsReceived=d.packets.toString(),d.framesRateFirefox&&(h.A_frr=d.framesRateFirefox.toString()),d.receivedFrame&&(h.A_frr=d.receivedFrame.frameRate.toString()),h.A_frd=d.decodeFrameRate.toString(),d.outputFrame&&(h.A_fro=d.outputFrame.frameRate.toString()),d.jitterBufferMs!==void 0&&(h.A_jbm=Math.floor(d.jitterBufferMs).toString()),d.currentDelayMs!==void 0&&(h.A_cdm=Math.floor(d.currentDelayMs).toString()),h.A_fs=d.firsCount.toString(),h.A_ns=d.nacksCount.toString(),h.A_ps=d.plisCount.toString(),l&&(h.A_vrtd=l._originMediaStreamTrack.enabled&&l._mediaStreamTrack.enabled?"0":"1"),l._player&&l._player.freezeTimeCounterList.length>0&&(h.A_vrft=Ye(p=l._player.freezeTimeCounterList).call(p,0,1)[0].toString()),h}(t,this.user.videoTrack):void 0;r&&sn(()=>this.emit(oe.NEED_UPLOAD,Qo.SUBSCRIBE_STATS,r)),i&&sn(()=>this.emit(oe.NEED_UPLOAD,Qo.SUBSCRIBE_STATS,i))}uploadSlowStats(t){}uploadRelatedStats(t,r){const i=this.pc._statsFilter.videoIsReady===!0,s=function(d,h,p){const m=d.audioRecv[0];if(!m)return null;const f=ed.isRemoteAudioFreeze(p);return{mediaType:"audio",isAudioMute:!1,peerId:h,googJitterReceived:m.jitterMs.toString(),isFreeze:f,bytesReceived:m.bytes.toString(),packetsReceived:m.packets.toString(),packetsLost:m.packetsLost.toString(),frameReceived:m.receivedFrames.toString(),frameDropped:m.droppedFrames.toString()}}(t,this.getUserId(),this.user.audioTrack),l=function(d,h,p,m,f){const _=h.videoRecv[0],v=m?m.videoRecv[0]:void 0;if(!_)return null;const T=ed.isRemoteVideoFreeze(f,_,v)&&d,R={mediaType:"video",isVideoMute:!1,peerId:p,frameRateReceived:_.receivedFrame&&_.receivedFrame.frameRate.toString(),frameRateDecoded:_.decodedFrame&&_.decodedFrame.frameRate.toString(),isFreeze:T,bytesReceived:_.bytes.toString(),packetsReceived:_.packets.toString(),packetsLost:_.packetsLost.toString()};return _.framesRateFirefox&&(R.frameRateDecoded=_.framesRateFirefox.toString(),R.frameRateReceived=_.framesRateFirefox.toString()),R}(i,t,this.getUserId(),r,this.user.videoTrack);s&&sn(()=>{this.emit(oe.NEED_UPLOAD,Qo.SUBSCRIBE_RELATED_STATS,s)}),l&&sn(()=>{this.emit(oe.NEED_UPLOAD,Qo.SUBSCRIBE_RELATED_STATS,l)})}emitOnTrackFromUnusedTracks(){if(!this.subscribeOptions)return;const t=this.subscribeOptions.video;if(this.subscribeOptions.audio){var r;const s=ft(r=this.unusedTracks).call(r,l=>l.kind==="audio"&&l.readyState==="live");na(this.unusedTracks,s),s&&this.onTrack(s)}if(t){var i;const s=ft(i=this.unusedTracks).call(i,l=>l.kind==="video"&&l.readyState==="live");na(this.unusedTracks,s),s&&this.onTrack(s)}}async setSubscribeOptions(t){var r,i,s,l;if(t.audio!==this.subscribeOptions.audio||t.video!==this.subscribeOptions.video){if(this.connectionState==="connecting")try{await this.createWaitConnectionConnectedPromise()}catch{throw new P(D.OPERATION_ABORTED,"can not update subscribe options, operation abort")}t.audio===this.subscribeOptions.audio&&t.video===this.subscribeOptions.video||(S.debug(k(r=k(i=k(s=k(l="[".concat(this.connectionId,"] update subscribe options [a: ")).call(l,this.subscribeOptions.audio,", v: ")).call(s,this.subscribeOptions.video,"] -> [a: ")).call(i,t.audio,", v: ")).call(r,t.video,"]")),this.subscribeOptions=t,!t.audio&&this.user._audioTrack&&(this.unusedTracks.push(this.user._audioTrack._originMediaStreamTrack),this.user._audioTrack._destroy(),this.unbindTrackEvents(this.user._audioTrack),this.user._audioTrack=void 0),!t.video&&this.user._videoTrack&&(this.unusedTracks.push(this.user._videoTrack._originMediaStreamTrack),this.user._videoTrack._destroy(),this.unbindTrackEvents(this.user._videoTrack),this.user._videoTrack=void 0),this.emitOnTrackFromUnusedTracks())}}createPC(){this.pc=new nG({turnServer:this.joinInfo.turnServer}),this.pc.onFirstAudioDecoded=()=>{this.user.audioTrack&&this.user.audioTrack.emit(Lu.FIRST_FRAME_DECODED),wt.firstRemoteFrame(this.joinInfo.sid,qn.FIRST_AUDIO_DECODE,Jr.FIRST_AUDIO_DECODE,{peer:this.user._uintid,subscribeElapse:ht()-this.startTime,subscribeRequestid:this.ID,p2pid:this.pc.ID})},this.pc.onFirstAudioReceived=()=>{wt.firstRemoteFrame(this.joinInfo.sid,qn.FIRST_AUDIO_RECEIVED,Jr.FIRST_AUDIO_RECEIVED,{peer:this.user._uintid,subscribeElapse:ht()-this.startTime,subscribeRequestid:this.ID,p2pid:this.pc.ID})},this.pc.onFirstVideoDecoded=(t,r)=>{wt.firstRemoteFrame(this.joinInfo.sid,qn.FIRST_VIDEO_DECODE,Jr.FIRST_VIDEO_DECODE,{peer:this.user._uintid,videowidth:t,videoheight:r,subscribeElapse:ht()-this.startTime,subscribeRequestid:this.ID,p2pid:this.pc.ID})},this.pc.onFirstVideoReceived=()=>{wt.firstRemoteFrame(this.joinInfo.sid,qn.FIRST_VIDEO_RECEIVED,Jr.FIRST_VIDEO_RECEIVED,{peer:this.user._uintid,subscribeElapse:ht()-this.startTime,subscribeRequestid:this.ID,p2pid:this.pc.ID})},this.updateICEPromise()}async closePC(t){return this.pc.audioTrack&&this.pc.audioTrack.stop(),this.pc.videoTrack&&this.pc.videoTrack.stop(),this.pc.onTrack=void 0,this.pc.onICEConnectionStateChange=void 0,this.pc.close(),t?!1:await Ur(this,oe.NEED_UNSUB)}onPCDisconnected(t){wt.subscribe(this.joinInfo.sid,{lts:this.startTime,succ:!1,video:this.subscribeOptions.video,audio:this.subscribeOptions.audio,peerid:this.user.uid,ec:t.code,subscribeRequestid:this.ID,p2pid:this.pc.ID})}bindTrackEvents(t){t instanceof Vu?t.addListener(ue.GET_STATS,this.handleGetRemoteAudioStats):t instanceof Qu&&t.addListener(ue.GET_STATS,this.handleGetRemoteVideoStats)}unbindTrackEvents(t){t instanceof Vu?t.off(ue.GET_STATS,this.handleGetRemoteAudioStats):t instanceof Qu&&t.off(ue.GET_STATS,this.handleGetRemoteVideoStats)}}class oG{constructor(t,r){this._trust_in_room_=!0,this._trust_audio_enabled_state_=!0,this._trust_video_enabled_state_=!0,this._trust_audio_mute_state_=!0,this._trust_video_mute_state_=!0,this._trust_stream_added_state_=!0,this._audio_muted_=!1,this._video_muted_=!1,this._audio_enabled_=!0,this._video_enabled_=!0,this._audio_added_=!1,this._video_added_=!1,this.uid=t,this._uintid=r}get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio)return this._audioTrack}get videoTrack(){if(this.hasVideo)return this._videoTrack}}function cN(e,t){var r=ae(e);if(Xt){var i=Xt(e);t&&(i=kt(i).call(i,function(s){return jt(e,s).enumerable})),r.push.apply(r,i)}return r}function ua(e){for(var t=1;t<arguments.length;t++){var r,i,s=arguments[t]!=null?arguments[t]:{};t%2?V(r=cN(Object(s),!0)).call(r,function(l){mr(e,l,s[l])}):Zt?ur(e,Zt(s)):V(i=cN(Object(s))).call(i,function(l){ie(e,l,jt(s,l))})}return e}var Gu=function(e,t,r,i){var s,l=arguments.length,d=l<3?t:i===null?i=jt(t,r):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(e,t,r,i);else for(var h=e.length-1;h>=0;h--)(s=e[h])&&(d=(l<3?s(d):l>3?s(t,r,d):s(t,r))||d);return l>3&&d&&ie(t,r,d),d},bi=function(e,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(e,t)};class rd extends Wr{constructor(t){var r,i,s,l;let d;if(super(),this._users=[],this._sessionId=null,this._bindEnabledTracks=[],this._leaveMutex=new wn("client-leave"),this._publishMutex=new wn("client-publish"),this._subscribeMutex=new $t,this._remoteStream=new $t,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._turnServer={servers:[],mode:"auto"},this._cloudProxyServerMode="disabled",this._isDualStreamEnabled=!1,this._streamFallbackTypeCacheMap=new $t,this._remoteStreamTypeCacheMap=new $t,this._axiosCancelSource=wo.CancelToken.source(),this._networkQualitySensitivity="normal",this._useLocalAccessPoint=!1,this._handleLocalTrackEnable=(p,m,f)=>{this.publish(p,!1).then(m).catch(f)},this._handleLocalTrackDisable=(p,m,f)=>{this.unpublish(p,!1).then(m).catch(f)},this._handleUserOnline=p=>{var m;this.isStringUID&&typeof p.uid!="string"&&S.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const f=ft(m=this._users).call(m,_=>_.uid===p.uid);if(f)f._trust_in_room_=!0;else{const _=new oG(p.uid,p.uint_id||p.uid);this._users.push(_),S.debug("[".concat(this._clientId,"] user online"),p.uid),this.emit(we.USER_JOINED,_)}},this._handleUserOffline=p=>{var m;const f=ft(m=this._users).call(m,_=>_.uid===p.uid);f&&(this._handleRemoveStream(p),na(this._users,f),this._remoteStreamTypeCacheMap.delete(f.uid),this._streamFallbackTypeCacheMap.delete(f.uid),S.debug("[".concat(this._clientId,"] user offline"),p.uid,"reason:",p.reason),this.emit(we.USER_LEAVED,f,p.reason))},this._handleAddAudioOrVideoStream=(p,m,f)=>{var _,v,T;const R=ft(_=this._users).call(_,j=>j.uid===m);if(!R)return void S.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));S.debug(k(v=k(T="[".concat(this._clientId,"] stream added with uid ")).call(T,m,", type ")).call(v,p));const w=p==="audio"?R.hasAudio:R.hasVideo;var O,B;R._uintid||(R._uintid=f||m),R._trust_stream_added_state_=!0,p==="audio"?R._audio_added_=!0:R._video_added_=!0,(p==="audio"?R.hasAudio:R.hasVideo)&&!w&&(S.info(k(O=k(B="[".concat(this._clientId,"] remote user ")).call(B,R.uid," published ")).call(O,p)),this.emit(we.USER_PUBLISHED,R,p)),p==="video"?wt.onGatewayStream(this._sessionId,qn.ON_ADD_VIDEO_STREAM,Jr.ON_ADD_VIDEO_STREAM,{peer:f||m}):wt.onGatewayStream(this._sessionId,qn.ON_ADD_AUDIO_STREAM,Jr.ON_ADD_AUDIO_STREAM,{peer:f||m});const K=this._remoteStream.get(m);K&&K.readyToReconnect&&K.connectionState==="connecting"&&K.reconnectPC().catch(j=>{S.error("[".concat(this._clientId,"] resubscribe error"),j.toString())})},this._handleRemoveStream=p=>{var m,f;const _=ft(m=this._users).call(m,R=>R.uid===p.uid);if(!_)return void S.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));S.debug(k(f="[".concat(this._clientId,"] stream removed with uid ")).call(f,p.uid));let v=()=>{};_.hasAudio&&_.hasVideo?v=()=>{var R,w;S.info(k(R="[".concat(this._clientId,"] remote user ")).call(R,_.uid," unpublished audio track")),this.emit(we.USER_UNPUBLISHED,_,"audio"),S.info(k(w="[".concat(this._clientId,"] remote user ")).call(w,_.uid," unpublished video track")),this.emit(we.USER_UNPUBLISHED,_,"video")}:_.hasVideo?v=()=>{var R;S.info(k(R="[".concat(this._clientId,"] remote user ")).call(R,_.uid," unpublished video track")),this.emit(we.USER_UNPUBLISHED,_,"video")}:_.hasAudio&&(v=()=>{var R;S.info(k(R="[".concat(this._clientId,"] remote user ")).call(R,_.uid," unpublished audio track")),this.emit(we.USER_UNPUBLISHED,_,"audio")}),_._trust_stream_added_state_=!0,_._audio_added_=!1,_._video_added_=!1;const T=this._remoteStream.get(_.uid);T&&(T.closeP2PConnection(),this._remoteStream.delete(_.uid)),wt.onGatewayStream(this._sessionId,qn.ON_REMOVE_STREAM,Jr.ON_REMOVE_STREAM,{peer:p.uint_id||p.uid}),v()},this._handleSetStreamLocalEnable=(p,m,f)=>{var _,v,T,R,w,O;const B=ft(_=this._users).call(_,W=>W.uid===m);if(!B)return void S.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));S.debug(k(v=k(T=k(R="[".concat(this._clientId,"] local ")).call(R,p," ")).call(T,f?"enabled":"disabled"," with uid ")).call(v,m));const K=p==="audio"?B.hasAudio:B.hasVideo;if(p==="audio"){B._trust_audio_enabled_state_=!0;const W=B._audio_enabled_;if(B._audio_enabled_=f,B._audio_enabled_===W)return;{var j,nt;const U=B._audio_enabled_?"enable-local-audio":"disable-local-audio";S.debug(k(j=k(nt="[".concat(this._clientId,"] user-info-updated, uid: ")).call(nt,m,", msg: ")).call(j,U)),this.emit(we.USER_INFO_UPDATED,m,U)}}else{B._trust_video_enabled_state_=!0;const W=B._video_enabled_;if(B._video_enabled_=f,B._video_enabled_===W)return;{var It,vt;const U=B._video_enabled_?"enable-local-video":"disable-local-video";S.debug(k(It=k(vt="[".concat(this._clientId,"] user-info-update, uid: ")).call(vt,m,", msg: ")).call(It,U)),this.emit(we.USER_INFO_UPDATED,m,U)}}const Rt=p==="audio"?B.hasAudio:B.hasVideo;if(K===Rt)return;var X,rt;if(!K&&Rt)return S.info(k(X=k(rt="[".concat(this._clientId,"] remote user ")).call(rt,m," published ")).call(X,p)),void this.emit(we.USER_PUBLISHED,B,p);const H=this._remoteStream.get(m);if(H){const W=ua({},H.subscribeOptions);W.audio=!!B.hasAudio&&W.audio,W.video=!!B.hasVideo&&W.video,W.audio||W.video?H.setSubscribeOptions(W):(H.closeP2PConnection().catch(U=>{S.warning("close sub pc error",U)}),this._remoteStream.delete(B.uid))}S.info(k(w=k(O="[".concat(this._clientId,"] remote user ")).call(O,B.uid," unpublished ")).call(w,p)),this.emit(we.USER_UNPUBLISHED,B,p)},this._handleMuteStream=(p,m,f)=>{var _,v,T;S.debug("[".concat(this._clientId,"] receive mute message"),p,m,f);const R=ft(_=this._users).call(_,rt=>rt.uid===p);var w;if(!R)return void S.warning(k(w="[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ")).call(w,p));const O=m==="audio"?R.hasAudio:R.hasVideo;if(m==="audio"){R._trust_audio_mute_state_=!0;const rt=R._audio_muted_;if(R._audio_muted_=f,R._audio_muted_===rt)return;{var B,K;const H=R._audio_muted_?"mute-audio":"unmute-audio";S.debug(k(B=k(K="[".concat(this._clientId,"] user-info-update, uid: ")).call(K,p,", msg: ")).call(B,H)),this.emit(we.USER_INFO_UPDATED,p,H)}}else{R._trust_video_mute_state_=!0;const rt=R._video_muted_;if(R._video_muted_=f,R._video_muted_===rt)return;{var j,nt;const H=R._video_muted_?"mute-video":"unmute-video";S.debug(k(j=k(nt="[".concat(this._clientId,"] user-info-update, uid: ")).call(nt,p,", msg: ")).call(j,H)),this.emit(we.USER_INFO_UPDATED,p,H)}}const It=m==="audio"?R.hasAudio:R.hasVideo;if(O===It)return;var vt,Rt;if(!O&&It)return S.info(k(vt=k(Rt="[".concat(this._clientId,"] remote user ")).call(Rt,p," published ")).call(vt,m)),void this.emit(we.USER_PUBLISHED,R,m);const X=this._remoteStream.get(p);if(X){const rt=ua({},X.subscribeOptions);rt.audio=!!R.hasAudio&&rt.audio,rt.video=!!R.hasVideo&&rt.video,m==="video"&&X.pc._statsFilter.setVideoIsReady(!1),rt.audio||rt.video?X.setSubscribeOptions(rt):(X.closeP2PConnection().catch(H=>{S.warning("close sub pc error",H)}),this._remoteStream.delete(R.uid))}S.info(k(v=k(T="[".concat(this._clientId,"] remote user ")).call(T,p," unpublished ")).call(v,m)),this.emit(we.USER_UNPUBLISHED,R,m)},this._handleP2PLost=p=>{S.debug("[".concat(this._clientId,"] receive p2p lost"),p);let m=null;if(this._highStream&&this._highStream.pc.ID===p.p2pid)m=this._highStream;else if(this._lowStream&&this._lowStream.pc.ID===p.p2pid)m=this._lowStream;else{var f;V(f=this._remoteStream).call(f,_=>{_.pc.ID===p.p2pid&&(m=_)})}m?m.emit(oe.GATEWAY_P2P_LOST,p.p2pid):S.warning("P2PLost stream not found",p)},this._handleTokenWillExpire=()=>{S.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.emit(we.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)},this._handleBeforeUnload=p=>{p.returnValue!==void 0&&p.returnValue!==""||(this.leave(),S.info("[".concat(this._clientId,"] auto leave onbeforeunload")))},this._handleUpdateNetworkQuality=()=>{var p;if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.emit(we.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const m={downlinkNetworkQuality:0,uplinkNetworkQuality:0};this._highStream&&!this._highStream.detecting&&(m.uplinkNetworkQuality=this._highStream.getNetworkQuality());let f=0;V(p=this._remoteStream).call(p,_=>f+=_.getNetworkQuality()),this._remoteStream.size>0&&(m.downlinkNetworkQuality=Math.round(f/this._remoteStream.size)),this.emit(we.NETWORK_QUALITY,m)},this._codec=t.codec,this._mode=t.mode,t.proxyServer&&(this._proxyServer=t.proxyServer,wt.setProxyServer(this._proxyServer),S.setProxyServer(this._proxyServer)),t.turnServer&&(this._turnServer=ua(ua({},this._turnServer),{},{mode:"manual"},t.turnServer)),this._clientId=Pe(5,"client-"),S.info(k(r=k(i=k(s=k(l="[".concat(this._clientId,"] Initializing AgoraRTC client v")).call(l,Tn," build: ")).call(s,vl,", mode: ")).call(i,this._mode,", codec: ")).call(r,this._codec)),this._performanceRecorder=cb(this._clientId,"join"),t.clientRoleOptions)try{pb(t.clientRoleOptions),d=hr({},t.clientRoleOptions)}catch(p){var h;S.warning(k(h="[".concat(this._clientId,"] ")).call(h,p.toString()))}this._statsCollector=new ed(this._clientId),this._statsCollector.onStatsException=(p,m,f)=>{var _,v,T;S.debug(k(_=k(v=k(T="[".concat(this._clientId,"] receive exception msg, code: ")).call(T,p,", msg: ")).call(v,m,", uid: ")).call(_,f)),this.emit(we.EXCEPTION,{code:p,msg:m,uid:f})},this._statsCollector.onUploadPublishDuration=(p,m,f,_)=>{var v;const T=ft(v=this._users).call(v,R=>R.uid===p);T&&wt.peerPublishStatus(this._sessionId,{subscribeElapse:_,audioPublishDuration:m,videoPublishDuration:f,peer:T._uintid})},this._gateway=new X7({clientId:this._clientId,mode:this._mode,codec:this._codec,websocketRetryConfig:t.websocketRetryConfig||Ne,httpRetryConfig:t.httpRetryConfig||Ne,forceWaitGatewayResponse:t.forceWaitGatewayResponse===void 0||t.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:t.role,clientRoleOptions:d}),this._config=t,this._configDistribute=new iw,this._handleGatewayEvents()}get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._highStream?this._highStream.getAllTracks():[]}get uid(){return this._uid}get channelName(){return this._channelName}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}async join(t,r,i,s,l){var d;this._performanceRecorder.checkPoint("startJoin");const h=ab(),p=kA()?window.isSecureContext:"Browser Not Support",m=()=>{S.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser")};kA()?window.isSecureContext||m():h||m();const f=wt.reportApiInvoke(this._sessionId,{name:de.JOIN,options:[t,r,i,s],states:{isHttps:h,isSecureContext:p},tag:zt.TRACER});try{if(!i&&i!==null)throw new P(D.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&pr(i,"token",1,2047),pr(t,"appid",1,2047),wp(r),s&&bp(s),l&&pr(l,"optionalInfo",1,2047)}catch(w){throw f.onError(w),w}if(S.info(k(d="[".concat(this._clientId,"] start join channel ")).call(d,r)),this._leaveMutex.isLocked&&(S.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),S.debug("[".concat(this._clientId,"] join: continue"))),this.connectionState!=="DISCONNECTED"){const w=new P(D.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw f.onError(w),w}this._sessionId||(this._sessionId=Hp()),this._gateway.state="CONNECTING";const _={clientId:this._clientId,appId:t,sid:this._sessionId,cname:r,uid:typeof s!="string"?s:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:i||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:l,useLocalAccessPoint:this._useLocalAccessPoint};typeof s=="string"&&(_.stringUid=s,this._uintUid?(_.uid=this._uintUid,this._uintUid=void 0):_.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret&&(_.aesmode=this._encryptionMode,_.aespassword=await wy(this._encryptionSecret),this._encryptionSalt&&(_.aessalt=this._encryptionSalt)),this._startSession(this._sessionId,{channel:r,appId:t}),ar(()=>{this.connectionState==="CONNECTING"&&wt.joinChannelTimeout(this._sessionId,5)},5e3);try{var v;let w;if(_.cloudProxyServer==="443only")_.proxyServer=it("PROXY_SERVER_TYPE2");else if(_.cloudProxyServer==="proxy3"||_.cloudProxyServer==="proxy4"||_.cloudProxyServer==="proxy5"){const B=it("PROXY_SERVER_TYPE3");tn(B)?_.proxyServer=B[0]:_.proxyServer=B}if(wt.setProxyServer(_.proxyServer),S.setProxyServer(_.proxyServer),this._performanceRecorder.checkPoint("startRequestAp"),_.stringUid&&!_.uid&&_.cloudProxyServer==="normal"){var T;await y_(_,this._axiosCancelSource.token,this._config.httpRetryConfig||Ne,!1);const B=await Wb(_.stringUid,_,this._axiosCancelSource.token,this._config.httpRetryConfig||Ne);S.debug(k(T="getUserAccount Success ".concat(_.stringUid," => ")).call(T,B)),_.uid=B,w=await xu(_,this._axiosCancelSource.token,this._config.httpRetryConfig||Ne)}else if(_.stringUid&&!_.uid){var R;const B=await Wb(_.stringUid,_,this._axiosCancelSource.token,this._config.httpRetryConfig||Ne);S.debug(k(R="getUserAccount Success ".concat(_.stringUid," => ")).call(R,B)),_.uid=B,w=await y_(_,this._axiosCancelSource.token,this._config.httpRetryConfig||Ne,!0)}else w=await y_(_,this._axiosCancelSource.token,this._config.httpRetryConfig||Ne,!0);this._performanceRecorder.checkPoint("startJoinGateway"),this._configDistribute.startGetConfigDistribute(_,this._axiosCancelSource.token),this._configDistribute.on(C_.UPDATE_BITRATE_LIMIT,B=>{this._highStream&&this._highStream.handleUpdateBitrateLimit(B.uplink),B.low_stream_uplink&&this._lowStream&&this._lowStream.handleUpdateBitrateLimit({max_bitrate:B.low_stream_uplink.bitrate,min_bitrate:B.low_stream_uplink.bitrate||0})}),this._key=i||t,this._joinInfo=ua(ua({},_),{},{cid:w.gatewayInfo.cid,uid:_.uid?_.uid:w.gatewayInfo.uid,vid:w.gatewayInfo.vid,apResponse:w.gatewayInfo.res,uni_lbs_ip:w.gatewayInfo.uni_lbs_ip,gatewayAddrs:w.gatewayInfo.gatewayAddrs});const O=await this._gateway.join(this._joinInfo,this._key);return f.onSuccess(O),this._appId=t,this._channelName=_.cname,this._uid=O,this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=be(this._handleUpdateNetworkQuality,2e3),window.addEventListener("beforeunload",this._handleBeforeUnload),S.info(k(v="[".concat(this._clientId,"] Joining channel success: ")).call(v,r)),ar(()=>{S.startUpload()},5e3),this._performanceRecorder.checkPoint("finishJoin"),aR(this),O}catch(w){const O=tn(w)?w[0]:w;throw S.error("[".concat(this._clientId,"] Joining channel failed, rollback"),O),O.code!==D.OPERATION_ABORTED&&(this._gateway.state="DISCONNECTED",this._reset()),f.onError(O),O}}async leave(){const t=wt.reportApiInvoke(this._sessionId,{name:de.LEAVE,options:[],tag:zt.TRACER});S.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener("beforeunload",this._handleBeforeUnload),this._reset(),cR(this);const r=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return S.info("[".concat(this._clientId,"] Leaving channel repeated, success")),r(),t.onSuccess();await this._gateway.leave(this.connectionState!=="CONNECTED"),S.info("[".concat(this._clientId,"] Leaving channel success")),r(),t.onSuccess()}async publish(t){var r,i;let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];tn(t)||(t=[t]);const l=wt.reportApiInvoke(this._sessionId,{name:de.PUBLISH,options:pt(t).call(t,h=>h?Object(h).toString():"null"),tag:zt.TRACER});if(t.length===0){const h=new P(D.INVALID_PARAMS,"track list is empty");return l.onError(h),h.throw()}if(this._gateway.role==="audience"){const h=new P(D.INVALID_OPERATION,"audience can not publish stream");return l.onError(h),h.throw()}for(const h of t){if(!(h instanceof UA)){const p=new P(D.INVALID_PARAMS,"pamameter is not local track");return l.onError(p),p.throw()}if(!h._enabled&&s){const p=new P(D.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(h.getTrackId()));return l.onError(p),p.throw()}}if(S.info(k(r="[".concat(this._clientId,"] Publishing tracks, id ")).call(r,pt(t).call(t,h=>"".concat(h.getTrackId()," ")))),await this._configDistribute.awaitConfigDistributeComplete(),s&&V(t).call(t,h=>{var p;const m=this._configDistribute.getBitrateLimit();var f;h instanceof Fr&&m&&h.setBitrateLimit(m.uplink),xt(p=this._bindEnabledTracks).call(p,h)===-1&&(h.addListener(ue.NEED_ADD_TRACK,this._handleLocalTrackEnable),h.addListener(ue.NEED_REMOVE_TRACK,this._handleLocalTrackDisable),this._bindEnabledTracks.push(h),Gr()&&h.muted&&S.debug(k(f="[".concat(this._clientId,"] on firefox publish a muted track ")).call(f,h.getTrackId(),", skip the pub operation and wait unmute")))}),Gr()&&(t=kt(t).call(t,h=>!h.muted)).length===0)return void l.onSuccess(pt(t).call(t,h=>h.trackMediaType+":"+h.getTrackLabel()).toString());const d=await this._publishMutex.lock();try{const h=await this._publishHighStream(t),p=(h.audioTrack,h.videoTrack);this._isDualStreamEnabled&&p&&!this._lowStream&&await this._publishLowStream(p),d(),l.onSuccess(pt(t).call(t,m=>m.trackMediaType+":"+m.getTrackLabel()).toString())}catch(h){throw d(),s&&V(t).call(t,p=>{var m,f;const _=xt(m=this._bindEnabledTracks).call(m,p);_!==-1&&(p.off(ue.NEED_ADD_TRACK,this._handleLocalTrackEnable),p.off(ue.NEED_REMOVE_TRACK,this._handleLocalTrackDisable),Ye(f=this._bindEnabledTracks).call(f,_,1))}),l.onError(h),S.error("[".concat(this._clientId,"] publish error"),h.toString()),h}S.info(k(i="[".concat(this._clientId,"] Publish success, id ")).call(i,pt(t).call(t,h=>"".concat(h.getTrackId()," "))))}async unpublish(t){var r;let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];const s=await this._publishMutex.lock();let l,d,h;try{var p,m;if(!this._highStream)return S.warning("[".concat(this._clientId,"] Could not find tracks to unpublish")),void(s&&s());if(l=this._highStream.getAllTracks(),t?tn(t)||(t=[t]):t=this._highStream.getAllTracks(),d=function(f,_){if(f.length!==_.length)return!1;for(let v=0;v<f.length;v+=1){const T=f[v];if(kt(f).call(f,R=>R===T).length!==kt(_).call(_,R=>R===T).length)return!1}return!0}(l,t),h=wt.reportApiInvoke(this._sessionId,{name:de.UNPUBLISH,options:pt(t).call(t,f=>f.getTrackId()),tag:zt.TRACER}),S.info(k(p=k(m="[".concat(this._clientId,"] Unpublish tracks, tracks ")).call(m,pt(t).call(t,f=>"".concat(f.getTrackId()," ")),", isClosePC: ")).call(p,d)),!this._highStream)return S.warning("[".concat(this._clientId,"] Could not find tracks to unpublish")),void(s&&s())}catch(f){throw s&&s(),f}try{this._lowStream&&kt(t).call(t,f=>f.trackMediaType==="video").length>0&&(await this._lowStream.closeP2PConnection(),this._lowStream=void 0),d?await this._highStream.closeP2PConnection():await this._highStream.removeTracks(t,i),s&&s()}catch(f){if(f.code!==D.OPERATION_ABORTED)throw h.onError(f),S.error("[".concat(this._clientId,"] unpublish error"),f.toString()),s&&s(),f;S.debug("[".concat(this._clientId,"] ignore unpub operation abort")),s&&s()}this._highStream&&this._highStream.connectionState==="disconnected"&&(this._highStream=void 0,this._lowStream=void 0),i&&V(t).call(t,f=>{var _,v;const T=xt(_=this._bindEnabledTracks).call(_,f);T!==-1&&(f.off(ue.NEED_ADD_TRACK,this._handleLocalTrackEnable),f.off(ue.NEED_REMOVE_TRACK,this._handleLocalTrackDisable),Ye(v=this._bindEnabledTracks).call(v,T,1))}),S.info(k(r="[".concat(this._clientId,"] Unpublish success,tracks ")).call(r,pt(t).call(t,f=>"".concat(f.getTrackId())))),h.onSuccess()}async subscribe(t,r){var i,s,l,d,h;Pr(r,"mediaType",["audio","video"]);const p=wt.reportApiInvoke(this._sessionId,{name:de.SUBSCRIBE,options:[t.uid,r],tag:zt.TRACER});if(!this._joinInfo){const j=new P(D.INVALID_OPERATION,"Can't subscribe stream, not joined");throw p.onError(j),j}if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING"){const j=new P(D.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));throw p.onError(j),j}if(!ft(i=this._users).call(i,j=>j===t)){var m;const j=new P(D.INVALID_REMOTE_USER,"user is not in the channel");throw S.error(k(m="[".concat(this._clientId,"] can not subscribe ")).call(m,t.uid,", this user is not in the channel")),p.onError(j),j}if(!t.hasAudio&&!t.hasVideo){var f;const j=new P(D.INVALID_REMOTE_USER,"user is not published");throw S.error(k(f="[".concat(this._clientId,"] can not subscribe ")).call(f,t.uid,", user is not published")),p.onError(j),j}const _={audio:r==="audio",video:r==="video"};if(!t.hasAudio&&_.audio||!t.hasVideo&&_.video){var v,T;const j=new P(D.REMOTE_USER_IS_NOT_PUBLISHED);throw S.error(k(v=k(T="[".concat(this._clientId,"] can not subscribe ")).call(T,t.uid," with mediaType ")).call(v,r,", remote track is not published")),p.onError(j),j}let R=this._subscribeMutex.get(t.uid);R||(R=new wn("sub-".concat(t.uid)),this._subscribeMutex.set(t.uid,R)),S.info(k(s=k(l="[".concat(this._clientId,"] subscribe user ")).call(l,t.uid,", mediaType: ")).call(s,r));const w=await R.lock();let O=this._remoteStream.get(t.uid);try{if(O)_.audio=_.audio||O.subscribeOptions.audio,_.video=_.video||O.subscribeOptions.video,await this._gateway.subscribeChange(O,_);else{O=new iG(t,this._statsCollector,this._joinInfo,_),this._remoteStream.set(t.uid,O);try{await this._gateway.subscribe(O)}catch(j){throw this._remoteStream.delete(t.uid),j}O.on(oe.CONNECTION_STATE_CHANGE,(j,nt)=>{j==="connecting"?this.emit(we.MEDIA_RECONNECT_START,t.uid):j==="connected"&&this.emit(we.MEDIA_RECONNECT_END,t.uid)})}w()}catch(j){var B;throw p.onError(j),w(),S.error(k(B="[".concat(this._clientId,"] subscribe user ")).call(B,t.uid," error"),j),j}S.info(k(d=k(h="[".concat(this._clientId,"] subscribe success user ")).call(h,t.uid,", mediaType: ")).call(d,r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(j=>{S.warning("[".concat(this._clientId,"] auto set fallback failed"),j)});const K=r==="audio"?t.audioTrack:t.videoTrack;if(!K){const j=new P(D.UNEXPECTED_ERROR,"can not find remote track in user object");return p.onError(j),j.throw()}return p.onSuccess(K.getTrackId()),K}async unsubscribe(t,r){var i,s,l,d,h;r&&Pr(r,"mediaType",["audio","video"]);const p=wt.reportApiInvoke(this._sessionId,{name:de.UNSUBSCRIBE,options:[t.uid,r],tag:zt.TRACER});if(!ft(i=this._users).call(i,O=>O===t)){var m;const O=new P(D.INVALID_REMOTE_USER,"user is not in the channel");throw S.error(k(m="[".concat(this._clientId,"] can not subscribe ")).call(m,t.uid,", user is not in the channel")),p.onError(O),O}S.info(k(s=k(l="[".concat(this._clientId,"] unsubscribe uid: ")).call(l,t.uid,", mediaType: ")).call(s,r));let f=this._subscribeMutex.get(t.uid);f||(f=new wn("sub-".concat(t.uid)),this._subscribeMutex.set(t.uid,f));const _=await f.lock(),v=this._remoteStream.get(t.uid);var T;if(!v)return S.warning(k(T="[".concat(this._clientId,"]: you have not subscribe the remote user ")).call(T,t.uid)),p.onSuccess(),void _();const R=ua({},v.subscribeOptions);r==="audio"?R.audio=!1:r==="video"?(R.video=!1,v.pc._statsFilter.setVideoIsReady(!1)):(R.audio=!1,R.video=!1);try{R.audio||R.video?await this._gateway.subscribeChange(v,R):(await v.closeP2PConnection(),this._remoteStream.delete(t.uid)),_()}catch(O){var w;if(O.code!==D.OPERATION_ABORTED)throw p.onError(O),_(),S.error(k(w="[".concat(this._clientId,"] unsubscribe user ")).call(w,t.uid," error"),O.toString()),O;_(),S.debug("[".concat(this._clientId,"] ignore unsub operation abort"))}S.info(k(d=k(h="[".concat(this._clientId,"] unsubscribe success uid: ")).call(h,t.uid,", mediaType: ")).call(d,r)),p.onSuccess()}setLowStreamParameter(t){(function(s){if(!s)throw new P(Ze.INVALID_PARAMS);$e(s.width)||Ie(s.width,"streamParameter.width"),$e(s.height)||Ie(s.height,"streamParameter.height"),$e(s.framerate)||Ie(s.framerate,"streamParameter.framerate"),$e(s.bitrate)||Ie(s.bitrate,"streamParameter.bitrate")})(t);const r=wt.reportApiInvoke(this._sessionId,{name:de.SET_LOW_STREAM_PARAMETER,options:[t],tag:zt.TRACER});(!t.width&&t.height||t.width&&!t.height)&&S.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),S.info("[".concat(this._clientId,"] set low stream parameter to"),St(t));const i=this._configDistribute.getLowStreamConfigDistribute();i&&i.bitrate&&t.bitrate&&i.bitrate<t.bitrate&&(t.bitrate=i.bitrate),this._lowStreamParameter=t,r.onSuccess()}async enableDualStream(){const t=wt.reportApiInvoke(this._sessionId,{name:de.ENABLE_DUAL_STREAM,options:[],tag:zt.TRACER});if(!Dr().supportDualStream){wt.streamSwitch(this._sessionId,{lts:ht(),isdual:!0,succ:!1});const r=new P(D.NOT_SUPPORTED,"Your browser is not support dual stream");throw t.onError(r),r}if(this._isDualStreamEnabled){const r=new P(D.INVALID_OPERATION,"Dual stream is already enabled");throw t.onError(r),r}if(this._highStream&&this._highStream.connectionState==="connected"&&this._highStream.videoTrack)try{await this._publishLowStream(this._highStream.videoTrack)}catch(r){throw wt.streamSwitch(this._sessionId,{lts:ht(),isdual:!0,succ:!1}),t.onError(r),r}this._isDualStreamEnabled=!0,wt.streamSwitch(this._sessionId,{lts:ht(),isdual:!0,succ:!0}),S.info("[".concat(this._clientId,"] enable dual stream")),t.onSuccess()}async disableDualStream(){const t=wt.reportApiInvoke(this._sessionId,{name:de.DISABLE_DUAL_STREAM,options:[],tag:zt.TRACER});if(this._lowStream)try{await this._lowStream.closeP2PConnection()}catch(r){throw wt.streamSwitch(this._sessionId,{lts:ht(),isdual:!1,succ:!1}),t.onError(r),r}this._lowStream=void 0,this._isDualStreamEnabled=!1,this._highStream&&(this._highStream.lowStreamConnection=void 0),wt.streamSwitch(this._sessionId,{lts:ht(),isdual:!1,succ:!0}),S.info("[".concat(this._clientId,"] disable dual stream")),t.onSuccess()}async setClientRole(t,r){(function(d){Pr(d,"role",["audience","host"])})(t),r&&pb(r);const i=wt.reportApiInvoke(this._sessionId,{name:de.SET_CLIENT_ROLE,options:[t,r],tag:zt.TRACER});if(this._mode==="rtc"){S.warning("[".concat(this._clientId,"]rtc mode can not use setClientRole"));const d=new P(D.INVALID_OPERATION,"rtc mode can not use setClientRole");return i.onError(d),d.throw()}if(r&&r.level&&t==="host"){const d=new P(D.INVALID_OPERATION,"host mode can not set audience latency level");return i.onError(d),d.throw()}try{var s,l;if(t==="audience"&&this._highStream){const d=new P(D.INVALID_OPERATION,"can not set client role to audience when publishing stream");return i.onError(d),d.throw()}await this._gateway.setClientRole(t,r),S.info(k(s=k(l="[".concat(this._clientId,"] set client role to ")).call(l,t,", level: ")).call(s,r&&r.level)),i.onSuccess()}catch(d){throw i.onError(d),d}}setProxyServer(t){if(pr(t,"proxyServer"),this.connectionState!=="DISCONNECTED")throw new P(D.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new P(D.INVALID_OPERATION,"You have already set the proxy");this._proxyServer=t,wt.setProxyServer(this._proxyServer),S.setProxyServer(this._proxyServer)}setTurnServer(t){if(tn(t)||(t=[t]),this.connectionState!=="DISCONNECTED")throw new P(D.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new P(D.INVALID_OPERATION,"You have already set the proxy");var r;if(function(i){if(!tn(i)||i.length<1)return!1;try{V(i).call(i,s=>{if(!s.urls)throw Error()})}catch{return!1}return!0}(t))return this._turnServer={servers:t,mode:"original-manual"},void S.info(k(r="[".concat(this._clientId,"] Set original turnserver success: ")).call(r,pt(t).call(t,i=>i.urls).join(","),"."));V(t).call(t,i=>hb(i)),this._turnServer={servers:t,mode:"manual"},S.info("[".concat(this._clientId,"] Set turnserver success."))}startProxyServer(t){const r=wt.reportApiInvoke(this._sessionId,{name:de.START_PROXY_SERVER,options:[],tag:zt.TRACER});if(this.connectionState!=="DISCONNECTED"){const s=new P(D.INVALID_OPERATION,"Start proxy server before join channel");throw r.onError(s),s}if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint){const s=new P(D.INVALID_OPERATION,"You have already set the proxy");throw r.onError(s),s}const i=[1,2,3,4,5];switch(t===void 0&&(t=1),t){case 1:this._cloudProxyServerMode="normal";break;case 2:this._cloudProxyServerMode="443only";break;case 3:this._cloudProxyServerMode="proxy3";break;case 4:this._cloudProxyServerMode="proxy4";break;case 5:this._cloudProxyServerMode="proxy5";break;default:{const s=new P(D.INVALID_PARAMS,"proxy server mode must be ".concat(i.join("|")));throw r.onError(s),s}}S.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),r.onSuccess()}stopProxyServer(){const t=wt.reportApiInvoke(this._sessionId,{name:de.STOP_PROXY_SERVER,options:[],tag:zt.TRACER});if(this.connectionState!=="DISCONNECTED")throw new P(D.INVALID_OPERATION,"Stop proxy server after leave channel");wt.setProxyServer(),S.setProxyServer(),this._cloudProxyServerMode="disabled",S.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]},t.onSuccess()}setLocalAccessPoints(t,r){if(yp(t,"serverList"),pr(r,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new P(D.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const i=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;t=pt(t).call(t,s=>{var l;return i.test(s)?k(l="".concat(s.replace(/\./g,"-"),".")).call(l,r):s}),this._useLocalAccessPoint=!0,jr("WEBCS_DOMAIN",t),jr("WEBCS_DOMAIN_BACKUP_LIST",t),jr("GATEWAY_DOMAINS",[r]),jr("EVENT_REPORT_DOMAIN",t[0]),jr("EVENT_REPORT_BACKUP_DOMAIN",t[1]||t[0]),jr("LOG_UPLOAD_SERVER","".concat(t[0],":6444")),S.info("set local access point success")}async setRemoteVideoStreamType(t,r){var i,s;Pr(r,"streamType",[0,1]);const l=wt.reportApiInvoke(this._sessionId,{name:de.SET_REMOTE_VIDEO_STREAM_TYPE,options:[t,r],tag:zt.TRACER});try{await this._gateway.setRemoteVideoStreamType(t,r),ar(()=>{var d;const h=ft(d=this._users).call(d,p=>p.uid===t);h&&h.videoTrack&&h.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(d){throw l.onError(d),S.error("[".concat(this._clientId,"] set remote video stream type error"),d.toString()),d}S.info(k(i=k(s="[".concat(this._clientId,"] set remote ")).call(s,t," video stream type to ")).call(i,r)),this._remoteStreamTypeCacheMap.set(t,r),l.onSuccess()}async setStreamFallbackOption(t,r){var i,s;Pr(r,"fallbackType",[0,1,2]);const l=wt.reportApiInvoke(this._sessionId,{name:de.SET_STREAM_FALLBACK_OPTION,options:["too long to show",r],tag:zt.TRACER});try{await this._gateway.setStreamFallbackOption(t,r)}catch(d){throw l.onError(d),S.error("[".concat(this._clientId,"] set stream fallback option"),d.toString()),d}S.info(k(i=k(s="[".concat(this._clientId,"] set remote ")).call(s,t," stream fallback type to ")).call(i,r)),this._streamFallbackTypeCacheMap.set(t,r),l.onSuccess()}setEncryptionConfig(t,r,i){(function(l){Pr(l,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(t),pr(r,"secret");const s=["aes-128-gcm2","aes-256-gcm2"];if(qt(s).call(s,t)){if(!i||!(i instanceof Uint8Array&&i.length===32))throw new P(D.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(i)throw new P(D.INVALID_PARAMS,"current encrypt mode does not need salt");new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(r)||S.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=t,this._encryptionSecret=r,i&&(this._encryptionSalt=Nc(i))}async renewToken(t){pr(t,"token",1,2047);const r=wt.reportApiInvoke(this._sessionId,{name:de.RENEW_TOKEN,options:[t],tag:zt.TRACER});if(!this._key){const i=new P(D.INVALID_OPERATION,"renewToken should not be called before user join");return r.onError(i),i.throw()}this._key=t;try{await this._gateway.renewToken(t)}catch(i){throw r.onError(i),S.error("[".concat(this._clientId,"] renewToken failed"),i.toString()),i}S.debug("[".concat(this._clientId,"] renewToken success")),r.onSuccess()}enableAudioVolumeIndicator(){const t=wt.reportApiInvoke(this._sessionId,{name:de.ENABLE_AUDIO_VOLUME_INDICATOR,options:[],tag:zt.TRACER});if(this._audioVolumeIndicationInterval)return S.warning("you have already enabled audio volume indicator!"),t.onSuccess();this._audioVolumeIndicationInterval=be(()=>{var r,i,s;let l=Ua(r=pt(i=Qe(ia(s=this._remoteStream).call(s))).call(i,d=>({level:d.user.audioTrack?100*d.user.audioTrack._source.getAccurateVolumeLevel():0,uid:d.getUserId()}))).call(r,(d,h)=>d.level-h.level);this._highStream&&this._highStream.audioTrack&&(l.push({level:100*this._highStream.audioTrack._source.getAccurateVolumeLevel(),uid:this._highStream._userId}),l=Ua(l).call(l,(d,h)=>d.level-h.level)),this.emit(we.VOLUME_INDICATOR,l)},it("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3),t.onSuccess()}getRTCStats(){const t=this._statsCollector.getRTCStats(),r=this._gateway.getInChannelInfo();return t.Duration=Math.round(r.duration/1e3),t}startLiveStreaming(t,r){const i=wt.reportApiInvoke(this._sessionId,{name:de.START_LIVE_STREAMING,options:[t,r],tag:zt.TRACER});if(!r){if(this._codec!=="h264"){const l=new P(D.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");return i.onError(l),ct.reject(l)}if(!this._highStream){const l=new P(D.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming");return i.onError(l),ct.reject(l)}}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t)){const l=new P(D.LIVE_STREAMING_TASK_CONFLICT);return i.onError(l),ct.reject(l)}const s=r?Vo.TRANSCODE:Vo.RAW;return this._createLiveStreamingClient(s).startLiveStreamingTask(t,s).then(()=>i.onSuccess()).catch(l=>{throw i.onError(l),l})}setLiveTranscoding(t){const r=wt.reportApiInvoke(this._sessionId,{name:de.SET_LIVE_TRANSCODING,options:[t],tag:zt.TRACER});return this._createLiveStreamingClient(Vo.TRANSCODE).setTranscodingConfig(t).then(()=>r.onSuccess()).catch(i=>{throw r.onError(i),i})}stopLiveStreaming(t){var r;const i=wt.reportApiInvoke(this._sessionId,{name:de.STOP_LIVE_STREAMING,options:[t],tag:zt.TRACER}),s=kt(r=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient]).call(r,l=>l&&l.hasUrl(t));if(!s.length){const l=new P(D.INVALID_PARAMS,"can not find live streaming url to stop");return i.onError(l),ct.reject(l)}return ct.all(pt(s).call(s,l=>l&&l.stopLiveStreamingTask(t))).then(()=>i.onSuccess()).catch(l=>{throw i.onError(l),l})}async addInjectStreamUrl(t,r){const i=wt.reportApiInvoke(this._sessionId,{name:de.ADD_INJECT_STREAM_URL,options:[t,r],tag:zt.TRACER});try{if(!this._joinInfo)throw new P(D.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");const s=this._createLiveStreamingClient(Vo.INJECT);s.setInjectStreamConfig(r,0),await s.startLiveStreamingTask(t,Vo.INJECT)}catch(s){throw i.onError(s),s}i.onSuccess()}async removeInjectStreamUrl(){const t=wt.reportApiInvoke(this._sessionId,{name:de.REMOVE_INJECT_STREAM_URL,options:[],tag:zt.TRACER});try{var r,i;const s=this._createLiveStreamingClient(Vo.INJECT),l=ft(r=Qe(ia(i=s.streamingTasks).call(i))).call(r,d=>d.mode===Vo.INJECT);if(!this._joinInfo||!l)throw new P(D.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");await s.stopLiveStreamingTask(l.url)}catch(s){throw t.onError(s),s}t.onSuccess()}async startChannelMediaRelay(t){const r=wt.reportApiInvoke(this._sessionId,{name:de.START_CHANNEL_MEDIA_RELAY,options:[t],tag:zt.TRACER});try{IA(t),await this._createChannelMediaRelayClient().startChannelMediaRelay(t)}catch(i){return r.onError(i),i.throw()}r.onSuccess()}async updateChannelMediaRelay(t){const r=wt.reportApiInvoke(this._sessionId,{name:de.UPDATE_CHANNEL_MEDIA_RELAY,options:[t],tag:zt.TRACER});try{IA(t),await this._createChannelMediaRelayClient().updateChannelMediaRelay(t)}catch(i){return r.onError(i),i.throw()}r.onSuccess()}async stopChannelMediaRelay(){const t=wt.reportApiInvoke(this._sessionId,{name:de.STOP_CHANNEL_MEDIA_RELAY,options:[],tag:zt.TRACER});try{await this._createChannelMediaRelayClient().stopChannelMediaRelay()}catch(r){return t.onError(r),r.throw()}t.onSuccess()}sendStreamMessage(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new P(D.INVALID_OPERATION,"can not send data stream, not joined");if(typeof t=="string"&&(t=new TextEncoder().encode(t)),new Blob([t]).size>1024)throw new P(D.INVALID_PARAMS,"stream message out of range.");return this._gateway.signal.request(fr.DATA_STREAM,{payload:Nc(t)},!r)}sendMetadata(t){if(!this._joinInfo)throw new P(D.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([t]).size>1024)throw new P(D.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(fr.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Nc(t)})}async sendCustomReportMessage(t){tn(t)||(t=[t]),V(t).call(t,G7);const r=wt.reportApiInvoke(this._sessionId,{name:de.SEND_CUSTOM_REPORT_MESSAGE,options:[St(t)],tag:zt.TRACER});if(!this._joinInfo){const i=new P(D.INVALID_OPERATION,"can not send custom report, not joined");return r.onError(i),i.throw()}await wt.sendCustomReportMessage(this._joinInfo.sid,t),r.onSuccess()}getLocalAudioStats(){if(!this._highStream)return vb;const t=this._statsCollector.getLocalAudioTrackStats(this._highStream.connectionId);return Ri()&&this._highStream&&this._highStream.audioTrack&&(this._highStream.audioTrack instanceof ni?!this._highStream.audioTrack.isActive:!this._highStream.audioTrack.enabled)&&(t.sendVolumeLevel=0),t}getRemoteAudioStats(){var t;const r={};return V(t=this._remoteStream).call(t,(i,s)=>{r[s]=this._statsCollector.getRemoteAudioTrackStats(i.connectionId)}),r}getLocalVideoStats(){return this._highStream?this._statsCollector.getLocalVideoTrackStats(this._highStream.connectionId):Cb}getRemoteVideoStats(){var t;const r={};return V(t=this._remoteStream).call(t,(i,s)=>{r[s]=this._statsCollector.getRemoteVideoTrackStats(i.connectionId)}),r}getRemoteNetworkQuality(){var t;const r={};return V(t=this._remoteStream).call(t,(i,s)=>{r[s]=this._statsCollector.getRemoteNetworkQualityStats(i.connectionId)}),r}async pickSVCLayer(t,r){Pr(r.spatialLayer,"spatialLayer",[0,1,2,3]),Pr(r.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(t,r)}catch(i){throw S.error("[".concat(this._clientId,"] pick SVC layer failed"),i.toString()),i}}_reset(){var t,r,i;S.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=wo.CancelToken.source(),this._streamFallbackTypeCacheMap=new $t,this._remoteStreamTypeCacheMap=new $t,this._configDistribute.stopGetConfigDistribute(),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,V(t=this._users).call(t,s=>{s.audioTrack&&(s.audioTrack.stop(),s.audioTrack._isDestroyed=!0),s.videoTrack&&(s.videoTrack.stop(),s.videoTrack._isDestroyed=!0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._highStream&&(this._highStream.closeP2PConnection(!0),this._highStream=void 0),V(r=this._bindEnabledTracks).call(r,s=>{s.off(ue.NEED_ADD_TRACK,this._handleLocalTrackEnable),s.off(ue.NEED_REMOVE_TRACK,this._handleLocalTrackDisable)}),this._bindEnabledTracks=[],this._lowStream&&(this._lowStream.closeP2PConnection(!0),this._lowStream=void 0),V(i=this._remoteStream).call(i,s=>{s.closeP2PConnection(!0)}),this._remoteStream=new $t,this._publishMutex=new wn("client-publish"),this._subscribeMutex=new $t,this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0)}_startSession(t,r){var i,s,l;const d=t||Hp();t?S.debug(k(i="[".concat(this._clientId,"] new Session ")).call(i,d)):S.debug(k(s=k(l="[".concat(this._clientId,"] renewSession ")).call(l,this._sessionId," => ")).call(s,d)),this._sessionId=d,r?wt.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:r.channel,appid:r.appId,mode:this._mode}):this._joinInfo?wt.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:this._joinInfo.cname,appid:this._joinInfo.appId,mode:this._mode}):this._gateway.joinInfo&&wt.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId,mode:this._mode}),this._joinInfo&&(this._joinInfo.sid=d),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=d)}async _publishHighStream(t){if(!this._joinInfo)throw new P(D.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new P(D.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&it("FORCE_TURN")&&!it("TURN_ENABLE_TCP")&&!it("TURN_ENABLE_UDP"))throw new P(D.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");if(S.debug("[".concat(this._clientId,"] publish high stream")),this._highStream)return await this._highStream.addTracks(t),this._highStream;this._highStream=new oN(this._statsCollector,this._joinInfo,this._codec),this._highStream.on(oe.P2P_LOST,()=>{this._highStream&&this.emit(we.P2P_LOST,this._highStream.getUserId())}),await this._highStream.addTracks(t);try{await this._gateway.publish(this._highStream,"high")}catch(r){throw this._highStream=void 0,r}return this._highStream.on(oe.CONNECTION_STATE_CHANGE,(r,i)=>{this._highStream&&(r==="connected"?this.emit(we.MEDIA_RECONNECT_END,this._highStream.getUserId()):r==="connecting"&&this.emit(we.MEDIA_RECONNECT_START,this._highStream.getUserId()))}),this._highStream}async _publishLowStream(t){if(!this._joinInfo)throw new P(D.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new P(D.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(!this._highStream||this._highStream.connectionState!=="connected")throw new P(D.UNEXPECTED_ERROR,"Could not find high stream");if(this._lowStream)return new P(D.UNEXPECTED_ERROR,"[".concat(this._clientId,"] Can't publish low stream when stream already publish")).throw();S.debug("[".concat(this._clientId,"] publish low stream")),this._lowStream=new oN(this._statsCollector,this._joinInfo,this._codec,!0);const r=this._configDistribute.getLowStreamConfigDistribute();r&&r.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&r.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=r.bitrate)),this._lowStream.lowStreamParameter=this._lowStreamParameter,await this._lowStream.addTracks([t]);try{await this._gateway.publish(this._lowStream,"low")}catch(i){throw this._lowStream=void 0,i}this._highStream.lowStreamConnection=this._lowStream}_createLiveStreamingClient(t){if(!this._joinInfo||!this._appId)return new P(D.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const r=()=>new aw(this._joinInfo,this._config.websocketRetryConfig||Ne,this._config.httpRetryConfig||Ne),i=s=>{s.onLiveStreamError=(l,d)=>{wt.reportApiInvoke(this._sessionId,{name:de.ON_LIVE_STREAM_ERROR,options:[l,d],tag:zt.TRACER}).onSuccess(),this.emit(we.LIVE_STREAMING_ERROR,l,d)},s.onLiveStreamWarning=(l,d)=>{wt.reportApiInvoke(this._sessionId,{name:de.ON_LIVE_STREAM_WARNING,options:[l,d],tag:zt.TRACER}).onSuccess(),this.emit(we.LIVE_STREAMING_WARNING,l,d)},s.on(PA.REQUEST_WORKER_MANAGER_LIST,(l,d,h)=>{if(!this._joinInfo)return h(new P(D.INVALID_OPERATION,"can not find join info to get worker manager"));Yb(l,this._joinInfo,this._axiosCancelSource.token,Ne).then(d).catch(h)})};switch(t){case Vo.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=r(),i(this._liveRawStreamingClient)),this._liveRawStreamingClient;case Vo.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=r(),i(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case Vo.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=r(),this._injectStreamingClient.on(PA.REQUEST_WORKER_MANAGER_LIST,(s,l,d)=>{if(!this._joinInfo)return d(new P(D.INVALID_OPERATION,"can not find join info to get worker manager"));Yb(s,this._joinInfo,this._axiosCancelSource.token,Ne).then(l).catch(d)}),this._injectStreamingClient.onInjectStatusChange=(s,l,d)=>{this.emit(we.INJECT_STREAM_STATUS,s,l,d)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){return this._joinInfo?(this._channelMediaRelayClient||(this._channelMediaRelayClient=new lw(this._joinInfo,this._clientId,this._config.websocketRetryConfig||Ne,this._config.httpRetryConfig||Ne),this._channelMediaRelayClient.on("state",t=>{t==="RELAY_STATE_FAILURE"&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.emit(we.CHANNEL_MEDIA_RELAY_STATE,t)}),this._channelMediaRelayClient.on("event",t=>{this.emit(we.CHANNEL_MEDIA_RELAY_EVENT,t)})),this._channelMediaRelayClient):new P(D.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw()}_handleGatewayEvents(){this._gateway.on(vr.DISCONNECT_P2P,()=>{var t;S.debug("[".concat(this._clientId,"] start full reconnect")),this._highStream&&this._highStream.connectionState!=="disconnected"&&(S.debug("[".concat(this._clientId,"] ready to reconnect high stream")),this._highStream.readyToReconnectPC()),this._lowStream&&this._lowStream.connectionState!=="disconnected"&&(S.debug("[".concat(this._clientId,"] ready to reconnect low stream")),this._lowStream.readyToReconnectPC()),V(t=this._remoteStream).call(t,(r,i)=>{var s;S.debug(k(s="[".concat(this._clientId,"] ready to reconnect remote stream ")).call(s,i)),r.readyToReconnectPC()})}),this._gateway.on(vr.CONNECTION_STATE_CHANGE,(t,r,i)=>{var s,l;const d=()=>{this.emit(we.CONNECTION_STATE_CHANGE,t,r,i)};if(S.info(k(s=k(l="[".concat(this._clientId,"] connection state change: ")).call(l,r," -> ")).call(s,t)),t==="DISCONNECTED")return this._reset(),void d();var h,p;if(t==="RECONNECTING")this._highStream&&this._highStream.connectionState==="connecting"&&(S.debug("[".concat(this._clientId,"] ready to reconnect high stream")),this._highStream.readyToReconnectPC()),this._lowStream&&this._lowStream.connectionState==="connecting"&&(S.debug("[".concat(this._clientId,"] ready to reconnect low stream")),this._lowStream.readyToReconnectPC()),V(h=this._remoteStream).call(h,(_,v)=>{var T;_.connectionState==="connecting"&&(S.debug(k(T="[".concat(this._clientId,"] ready to reconnect remote stream ")).call(T,v)),_.readyToReconnectPC())}),V(p=this._users).call(p,_=>{_._trust_in_room_=!1,_._trust_audio_enabled_state_=!1,_._trust_video_enabled_state_=!1,_._trust_audio_mute_state_=!1,_._trust_video_mute_state_=!1,_._trust_stream_added_state_=!1}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(t==="CONNECTED"){var m,f;V(m=this._streamFallbackTypeCacheMap).call(m,(_,v)=>{this._gateway.setStreamFallbackOption(v,_).catch(T=>S.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),T))}),V(f=this._remoteStreamTypeCacheMap).call(f,(_,v)=>{this._gateway.setRemoteVideoStreamType(v,_).catch(T=>S.warning("[".concat(this._clientId,"] auto set remote stream type failed"),T))}),this._highStream&&this._highStream.connectionState==="connecting"?this._highStream.reconnectPC().then(()=>{this._lowStream&&this._lowStream.connectionState==="connecting"&&this._lowStream.reconnectPC().catch(_=>{S.error("[".concat(this._clientId,"] republish low stream error"),_.toString()),this.emit(we.ERROR,{reason:_})})}).catch(_=>{S.error("[".concat(this._clientId,"] republish high stream error"),_.toString()),this.emit(we.ERROR,{reason:_})}):this._lowStream&&this._lowStream.connectionState==="connecting"&&this._lowStream.reconnectPC().catch(_=>{S.error("[".concat(this._clientId,"] republish low stream error"),_.toString()),this.emit(we.ERROR,{reason:_})}),this._userOfflineTimeout=ar(()=>{var _;if(this.connectionState!=="CONNECTED")return;this._userOfflineTimeout=void 0;const v=kt(_=this._users).call(_,T=>!T._trust_in_room_);V(v).call(v,T=>{var R;S.debug(k(R="[".concat(this._clientId,"] user offline timeout, emit user offline ")).call(R,T.uid)),this._handleUserOffline({uid:T.uid})})},3e3),this._streamRemovedTimeout=ar(()=>{var _;this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,V(_=this._users).call(_,v=>{var T,R,w,O,B;v._trust_audio_mute_state_||(S.debug(k(T="[".concat(this._clientId,"] auto dispatch audio unmute event ")).call(T,v.uid)),this._handleMuteStream(v.uid,"audio",!1)),v._trust_video_mute_state_||(S.debug(k(R="[".concat(this._clientId,"] auto dispatch video unmute event ")).call(R,v.uid)),this._handleMuteStream(v.uid,"video",!1)),v._trust_audio_enabled_state_||(S.debug(k(w="[".concat(this._clientId,"] auto dispatch enable local audio ")).call(w,v.uid)),this._handleSetStreamLocalEnable("audio",v.uid,!0)),!v._trust_video_enabled_state_&&v._video_enabled_&&(S.debug(k(O="[".concat(this._clientId,"] auto dispatch enable local video ")).call(O,v.uid)),this._handleSetStreamLocalEnable("video",v.uid,!0)),v._trust_stream_added_state_||(S.debug(k(B="[".concat(this._clientId,"] auto dispatch stream remove ")).call(B,v.uid)),this._handleRemoveStream({uid:v.uid,uint_id:v._uintid}))}))},1e3)}d()}),this._gateway.on(vr.REQUEST_NEW_GATEWAY_LIST,(t,r)=>{if(!this._joinInfo)return r(new P(D.UNEXPECTED_ERROR,"can not recover, no join info"));xu(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Ne).then(i=>{var s;this._joinInfo&&(this._joinInfo.apResponse=i.gatewayInfo.res),t(pt(s=i.gatewayInfo.gatewayAddrs).call(s,l=>{if(this._joinInfo&&this._joinInfo.proxyServer){var d,h;const p=l.split(":");return k(d=k(h="wss://".concat(this._joinInfo.proxyServer,"/ws/?h=")).call(h,p[0],"&p=")).call(d,p[1])}return"wss://".concat(l)}))}).catch(r)}),this._gateway.on(vr.NETWORK_QUALITY,t=>{this._networkQualitySensitivity==="normal"&&this.emit(we.NETWORK_QUALITY,t)}),this._gateway.on(vr.STREAM_TYPE_CHANGE,(t,r)=>{this.emit(we.STREAM_TYPE_CHANGED,t,r),wt.reportApiInvoke(this._sessionId,{name:de.STREAM_TYPE_CHANGE,options:[t,r],tag:zt.TRACER}).onSuccess(St({uid:t,streamType:r}))}),this._gateway.on(vr.IS_P2P_DISCONNECTED,t=>{var r,i,s;const l=[];return this._highStream&&l.push(this._highStream),V(r=this._remoteStream).call(r,d=>l.push(d)),l.length===0||kt(l).call(l,d=>d.connectionState==="connected").length===0?t(!0):(S.debug(k(i="[".concat(this._clientId,"] ")).call(i,pt(s=kt(l).call(l,d=>d.connectionState==="connected")).call(s,d=>d.connectionId)," is connected")),void t(!1))}),this._gateway.on(vr.NEED_RENEW_SESSION,()=>{this._startSession()}),this._gateway.signal.on(nr.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(nr.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(nr.ON_ADD_AUDIO_STREAM,t=>this._handleAddAudioOrVideoStream("audio",t.uid,t.uint_id)),this._gateway.signal.on(nr.ON_ADD_VIDEO_STREAM,t=>this._handleAddAudioOrVideoStream("video",t.uid,t.uint_id)),this._gateway.signal.on(nr.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(nr.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(nr.MUTE_AUDIO,t=>this._handleMuteStream(t.uid,"audio",!0)),this._gateway.signal.on(nr.UNMUTE_AUDIO,t=>this._handleMuteStream(t.uid,"audio",!1)),this._gateway.signal.on(nr.MUTE_VIDEO,t=>this._handleMuteStream(t.uid,"video",!0)),this._gateway.signal.on(nr.UNMUTE_VIDEO,t=>this._handleMuteStream(t.uid,"video",!1)),this._gateway.signal.on(nr.RECEIVE_METADATA,t=>{const r=mu(t.metadata);this.emit(we.RECEIVE_METADATA,t.uid,r)}),this._gateway.signal.on(nr.ON_DATA_STREAM,t=>{t.seq&&delete t.seq,t.payload=mu(t.payload),this.emit(we.STREAM_MESSAGE,t.uid,t.payload),this.onStreamMessage&&this.onStreamMessage(t)}),this._gateway.signal.on(nr.ON_CRYPT_ERROR,()=>{ys(()=>{S.warning("[".concat(this._clientId,"] on crypt error")),this.emit(we.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(nr.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(nr.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{S.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._reset(),this._gateway.leave(!0),this.emit(we.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this._gateway.signal.on(nr.ON_STREAM_FALLBACK_UPDATE,t=>{var r,i;S.debug(k(r=k(i="[".concat(this._clientId,"] stream fallback peerId: ")).call(i,t.stream_id,", attr: ")).call(r,t.stream_type)),this.emit(we.STREAM_FALLBACK,t.stream_id,t.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(nr.ON_PUBLISH_STREAM,t=>{var r;this.uid===this._uid&&(this._highStream&&this._highStream._waitingSuccessResponse&&this._highStream.connectionState==="connected"?(this._highStream.reportPublishEvent(!0,null,St({proxy:t.proxy})),S.info(k(r="[".concat(this._clientId,"] on publish stream, ")).call(r,St(t))),t.proxy!==void 0&&this.emit(we.IS_USING_CLOUD_PROXY,!!t.proxy)):this._lowStream?this._lowStream.reportPublishEvent(!0,null,St({proxy:t.proxy})):S.warning("get on_publish_stream message but cannot handle"))}),this._gateway.signal.on(nr.ENABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!0)}),this._gateway.signal.on(nr.DISABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!1)}),this._gateway.signal.on(Oe.REQUEST_TIMEOUT,(t,r)=>{if(this._joinInfo)switch(t){case fr.PUBLISH:{var i;if(!r)return;const s=r.stream_type==="high"?this._highStream:this._lowStream;if(!s)return;r.state==="offer"&&wt.publish(this._joinInfo.sid,{lts:s.startTime,succ:!1,ec:D.TIMEOUT,audio:r.audio,video:r.video,p2pid:r.p2p_id,publishRequestid:s.ID,screenshare:!(!s.videoTrack||xt(i=s.videoTrack._hints).call(i,ks.SCREEN_TRACK)===-1),audioName:s.audioTrack&&(s.audioTrack instanceof ni?s.audioTrack.getSubTrackLabels().join(","):s.audioTrack.getTrackLabel()),videoName:s.videoTrack&&s.videoTrack.getTrackLabel()});break}case fr.SUBSCRIBE:{const s=r.stream_id,l=this._remoteStream.get(s);if(!l)return;r&&wt.subscribe(this._joinInfo.sid,{lts:l.startTime,succ:!1,ec:D.TIMEOUT,audio:!!r.audio,video:!!r.video,peerid:r.stream_id,subscribeRequestid:l.ID,p2pid:l.pc.ID});break}}})}}async function lN(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;t.addTransceiver("video",{direction:"recvonly"}),t.addTransceiver("audio",{direction:"recvonly"});const r=(await t.createOffer()).sdp;if(!r)return e;t.close(),t=null,e=function(i){const s={video:[],audio:[]};return i.match(/ VP8/i)&&s.video.push("VP8"),i.match(/ VP9/i)&&s.video.push("VP9"),i.match(/ AV1X/i)&&s.video.push("AV1"),i.match(/ H264/i)&&s.video.push("H264"),i.match(/ opus/i)&&s.audio.push("OPUS"),s}(r)}catch(t){throw new P(D.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e}function dN(){const e=At.reportApiInvoke(null,{name:Ht.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Wt.TRACER});let t=!1;try{const l=window.RTCPeerConnection,d=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,h=window.WebSocket;t=!!(l&&d&&h)}catch(l){return S.error("check system requirement failed: ",l),!1}let r=!1;const i=Se();i.name===ye.CHROME&&Number(i.version)>=58&&(!W4()||K4())&&(r=!0),i.name===ye.FIREFOX&&Number(i.version)>=56&&(r=!0),i.name===ye.OPERA&&Number(i.version)>=45&&(r=!0),i.name===ye.SAFARI&&Number(i.version)>=11&&(r=!0),(mp()||Se().name===ye.QQ)&&(r=!0),S.debug("checkSystemRequirements, api:",t,"browser",r);const s=t&&r;return e.onSuccess(s),s}Gu([BA({report:wt}),bi("design:type",Function),bi("design:paramtypes",[String]),bi("design:returntype",void 0)],rd.prototype,"setProxyServer",null),Gu([BA(),bi("design:type",Function),bi("design:paramtypes",[Object]),bi("design:returntype",void 0)],rd.prototype,"setTurnServer",null),Gu([BA({report:wt}),bi("design:type",Function),bi("design:paramtypes",[Array,String]),bi("design:returntype",void 0)],rd.prototype,"setLocalAccessPoints",null),Gu([BA({report:wt}),bi("design:type",Function),bi("design:paramtypes",[String,String,Uint8Array]),bi("design:returntype",void 0)],rd.prototype,"setEncryptionConfig",null),Gu([Nb({report:wt}),bi("design:type",Function),bi("design:paramtypes",[Object,Object]),bi("design:returntype",ct)],rd.prototype,"pickSVCLayer",null);class uN extends Ay{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),this.startPlayTime=0,this.startPlayOffset=0,this.pausePlayTime=0,this.currentLoopCount=0,this._currentState="stopped",this.audioBuffer=t,this.options=r,this.startPlayOffset=this.options.startPlayTime||0}set currentState(t){t!==this._currentState&&(this._currentState=t,this.emit(Oo.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer.duration}get currentTime(){return this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:(this.context.currentTime-this.startPlayTime+this.startPlayOffset)%this.audioBuffer.duration}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):S.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}startSourceNode(){var t;this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=Lr(t=this.handleSourceNodeEnded).call(t,this))}createSourceNode(){const t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const hN=new $t;async function pN(e,t){let r=null;if(typeof e=="string"){const s=hN.get(e);if(s)return S.debug("use cached audio resource: ",e),s;try{r=(await Wn(()=>wo.get(e,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(l){throw new P(D.FETCH_AUDIO_FILE_FAILED,l.toString())}}else r=await new ct((l,d)=>{const h=new FileReader;h.onload=p=>{p.target?l(p.target.result):d(new P(D.READ_LOCAL_AUDIO_FILE_ERROR))},h.onerror=()=>{d(new P(D.READ_LOCAL_AUDIO_FILE_ERROR))},h.readAsArrayBuffer(e)});const i=await function(s){const l=Ol();return new ct((d,h)=>{l.decodeAudioData(s,p=>{d(p)},p=>{h(new P(D.DECODE_AUDIO_FILE_FAILED,p.toString()))})})}(r);return typeof e=="string"&&t&&hN.set(e,i),i}function AN(e,t){var r=ae(e);if(Xt){var i=Xt(e);t&&(i=kt(i).call(i,function(s){return jt(e,s).enumerable})),r.push.apply(r,i)}return r}function jA(e){for(var t=1;t<arguments.length;t++){var r,i,s=arguments[t]!=null?arguments[t]:{};t%2?V(r=AN(Object(s),!0)).call(r,function(l){mr(e,l,s[l])}):Zt?ur(e,Zt(s)):V(i=AN(Object(s))).call(i,function(l){ie(e,l,jt(s,l))})}return e}function N_(e,t,r,i){r.optimizationMode&&(i&&i.width&&i.height?(r.encoderConfig=jA(jA({},i),{},{bitrateMin:i.bitrateMin,bitrateMax:i.bitrateMax}),r.optimizationMode!=="motion"&&r.optimizationMode!=="detail"||(t.contentHint=r.optimizationMode,t.contentHint===r.optimizationMode?S.debug("[".concat(e,"] set content hint to"),r.optimizationMode):S.debug("[".concat(e,"] set content hint failed")))):S.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}function fN(e,t){var r=ae(e);if(Xt){var i=Xt(e);t&&(i=kt(i).call(i,function(s){return jt(e,s).enumerable})),r.push.apply(r,i)}return r}function HA(e){for(var t=1;t<arguments.length;t++){var r,i,s=arguments[t]!=null?arguments[t]:{};t%2?V(r=fN(Object(s),!0)).call(r,function(l){mr(e,l,s[l])}):Zt?ur(e,Zt(s)):V(i=fN(Object(s))).call(i,function(l){ie(e,l,jt(s,l))})}return e}function O_(e,t,r,i){r.optimizationMode&&(i&&i.width&&i.height?(r.encoderConfig=HA(HA({},i),{},{bitrateMin:i.bitrateMin,bitrateMax:i.bitrateMax}),r.optimizationMode!=="motion"&&r.optimizationMode!=="detail"||(t.contentHint=r.optimizationMode,t.contentHint===r.optimizationMode?S.debug("[".concat(e,"] set content hint to"),r.optimizationMode):S.debug("[".concat(e,"] set content hint failed")))):S.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}const sG=Se().name;function aG(e,t,r,i){let s,l=0,d=null;return new ct((h,p)=>{ar(()=>{s&&(s(),h(l))},t),s=xp(()=>{(function(){l>i&&s&&(s(),h(l));const m=r.getContext("2d");if(!m){const v=new P(D.UNEXPECTED_ERROR,"can not get canvas 2d context.");return S.error(v.toString()),void p(v)}m.drawImage(e,0,0,160,120);const f=m.getImageData(0,0,r.width,r.height),_=Math.floor(f.data.length/3);if(d){for(let v=0;v<_;v+=3)if(f.data[v]!==d[v])return l+=1,void(d=f.data);d=f.data}else d=f.data})()},30)})}const cG=Se().name;function lG(e,t,r,i){let s,l=0,d=null;return new ct((h,p)=>{ar(()=>{s&&(s(),h(l))},t),s=xp(()=>{(function(){l>i&&s&&(s(),h(l));const m=r.getContext("2d");if(!m){const v=new P(Ze.UNEXPECTED_ERROR,"can not get canvas 2d context.");return S.error(v.toString()),void p(v)}m.drawImage(e,0,0,160,120);const f=m.getImageData(0,0,r.width,r.height),_=Math.floor(f.data.length/3);if(d){for(let v=0;v<_;v+=3)if(f.data[v]!==d[v])return l+=1,void(d=f.data);d=f.data}else d=f.data})()},30)})}class ju{constructor(t,r){this.id=0,ju.count+=1,this.id=ju.count,this.element=t,this.context=r}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{const r=document.createElement("audio");r.srcObject=new MediaStream([t.track]),r.play(),this.audioPlayerElement=r}}async switchSdp(){if(!this.peerPair)return;const t=async(i,s)=>{const l=s==="offer"?await i.createOffer():await i.createAnswer();return await i.setLocalDescription(l),i.iceGatheringState==="complete"?i.localDescription:new ct(d=>{i.onicegatheringstatechange=()=>{i.iceGatheringState==="complete"&&d(i.localDescription)}})},r=async(i,s)=>await i.setRemoteDescription(s);try{const i=await t(this.peerPair[0],"offer");await r(this.peerPair[1],i);const s=await t(this.peerPair[1],"answer");await r(this.peerPair[0],s)}catch(i){throw new P(D.LOCAL_AEC_ERROR,i.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let r;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),r=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(r)}catch(s){throw new P(D.LOCAL_AEC_ERROR,s.toString()).print()}if(!r)throw new P(D.LOCAL_AEC_ERROR,"no dest node when local aec").print();const i=r.stream.getAudioTracks()[0];return this.audioTrack=i,i}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const t=this.element,r=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(r),await this.switchSdp()}close(){var t;S.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&V(t=this.peerPair).call(t,r=>{r.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}ju.count=0;var dG=function(e,t,r,i){var s,l=arguments.length,d=l<3?t:i===null?i=jt(t,r):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(e,t,r,i);else for(var h=e.length-1;h>=0;h--)(s=e[h])&&(d=(l<3?s(d):l>3?s(t,r,d):s(t,r))||d);return l>3&&d&&ie(t,r,d),d},k_=function(e,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(e,t)};const uG=window.AudioContext||window.webkitAudioContext;class gN{constructor(){this.units=[]}processExternalMediaAEC(t){var r;if(!this._doesEnvironmentNeedAEC())return S.debug("the system does not need to process local aec"),-1;this.context||(this.context=new uG);let i=ft(r=this.units).call(r,s=>s&&s.getElement()===t);return i||(i=new ju(t,this.context),this.units.push(i)),i.startEchoCancellation(),S.debug("start processing local audio echo cancellation, id is",i.id),i.id}_doesEnvironmentNeedAEC(){return Se().name!==ye.SAFARI}}dG([Au({report:At}),k_("design:type",Function),k_("design:paramtypes",[HTMLAudioElement]),k_("design:returntype",Number)],gN.prototype,"processExternalMediaAEC",null);const hG=new gN;var mN,EN,_N,IN;function vN(e){return dn.enumerateDevices(!0,!0,e)}function CN(e){return dn.getRecordingDevices(e)}function SN(e){return dn.getCamerasDevices(e)}function TN(e){return dn.getSpeakers(e)}function RN(){return new cw}function yN(e){S.setLogLevel(e)}function wN(){S.enableLogUpload()}function bN(){S.disableLogUpload()}async function NN(e,t){var r;if(S.debug(k(r="loadModule: ".concat(e.name,", loadOption: ")).call(r,St(t))),!e.moduleInit)throw S.debug("Invalid Plugin"),new P(D.INVALID_PLUGIN,"invalid plugin");try{await e.moduleInit({logger:S,report:At},t)}catch(i){throw new P(D.UNEXPECTED_ERROR,"unexpected error in loadModule",i)}}function ON(e){hG.processExternalMediaAEC(e)}jr("PROCESS_ID",k(mN=k(EN=k(_N=k(IN="process-".concat(Pe(8,""),"-")).call(IN,Pe(4,""),"-")).call(_N,Pe(4,""),"-")).call(EN,Pe(4,""),"-")).call(mN,Pe(12,""))),function(){const e=Se();Ai.getDisplayMedia=function(t){return!!(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)}(),Ai.getStreamFromExtension=e.name===ye.CHROME&&Number(e.version)>34,Ai.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t=new RTCPeerConnection;let r=!1;try{t.addTransceiver("audio"),r=!0}catch{}return t.close(),r}(),Ai.supportMinBitrate=e.name===ye.CHROME||e.name===ye.EDGE,Ai.supportSetRtpSenderParameters=function(){const t=Se();return!window.RTCRtpSender||!window.RTCRtpSender.prototype.setParameters||!window.RTCRtpSender.prototype.getParameters?!1:!!El()||!(!Ri()&&!$d())||t.name===ye.FIREFOX&&Number(t.version)>=64}(),e.name===ye.SAFARI&&(Number(e.version)>=14?Ai.supportDualStream=!0:Ai.supportDualStream=!1),Ai.webAudioMediaStreamDest=function(){const t=Se();return!(t.name===ye.SAFARI&&Number(t.version)<12)}(),Ai.supportReplaceTrack=function(){return window.RTCRtpSender?typeof RTCRtpSender.prototype.replaceTrack=="function":!1}(),Ai.supportWebGL=typeof WebGLRenderingContext!="undefined",Ai.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,El()||(Ai.webAudioWithAEC=!0),Ai.supportShareAudio=function(){const t=Se();return(t.os===mn.WIN_10||t.os===mn.WIN_81||t.os===mn.WIN_7||t.os===mn.LINUX||t.os===mn.MAC_OS)&&t.name===ye.CHROME&&Number(t.version)>=74}(),Ai.supportDualStreamEncoding=function(){const t=Se();return t.name==="Safari"&&Number(t.version)>=14}(),S.info("browser compatibility",St(Ai),St(e))}(),function(){const e=window.localStorage.getItem("websdk_ng_global_parameter");if(e)try{var t;const r=JSON.parse(window.atob(e)),i=ht();S.debug("Loading global parameters from cache",r),V(t=ae(r)).call(t,s=>{if(Object.prototype.hasOwnProperty.call(hi,s)){const{value:l,expires:d}=r[s];if(d&&d<=i)return;Um[s]=l,hi[s]=l}})}catch(r){S.error("Error loading mutableParamsCache: ".concat(e),r.message)}}();const pG={__CLIENT_LIST__:ts,__TRACK_LIST__:Zs,VERSION:Tn,BUILD:vl,setParameter:jr,getParameter:it,getSupportedCodec:lN,checkSystemRequirements:dN,getDevices:vN,getMicrophones:CN,getCameras:SN,getElectronScreenSources:fE,getPlaybackDevices:TN,createClient:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",mode:"rtc"};const t=At.reportApiInvoke(null,{name:Ht.CREATE_CLIENT,options:[e],tag:Wt.TRACER});try{iV(e)}catch(r){throw t.onError(r),r}return t.onSuccess(),new Xl(Jl(Jl({forceWaitGatewayResponse:!0},e),{},{role:e.mode==="rtc"?"host":e.role}))},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{encoderConfig:"480p_1"};const t=At.reportApiInvoke(null,{tag:Wt.TRACER,name:Ht.CREATE_CAM_VIDEO_TRACK,options:[jA({},e)]}),r=Kl(e),i=Pe(8,"track-cam-");let s=null;S.info("start create camera video track with config",St(e),"trackId",i);try{s=(await on({video:r},i)).getVideoTracks()[0]||null}catch(d){throw t.onError(d),d}if(!s){const d=new P(D.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(d),d.throw()}e.optimizationMode&&N_(i,s,e,e.encoderConfig&&$o(e.encoderConfig));const l=new Nu(s,e,r,e.scalabiltyMode?Ba(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i);return t.onSuccess(l.getTrackId()),S.info("create camera video success, trackId:",i),l},createCustomVideoTrack:function(e){const t=At.reportApiInvoke(null,{tag:Wt.TRACER,name:Ht.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),r=new cr(e.mediaStreamTrack,{bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?Ba(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode);return t.onSuccess(r.getTrackId()),S.info("create custom video track success with config",e,"trackId",r.getTrackId()),r},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const r=At.reportApiInvoke(null,{tag:Wt.TRACER,name:Ht.CREATE_SCREEN_VIDEO_TRACK,options:[jA({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const i=fw(e),s=Pe(8,"track-scr");let l=null,d=null;const h=Dr();if(!h.supportShareAudio&&t==="enable"){const f=new P(D.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return r.onError(f),f.throw()}S.info("start create screen video track with config",e,"withAudio",t,"trackId",s);try{const f=await on({screen:i,screenAudio:t==="auto"?h.supportShareAudio:t==="enable"},s);l=f.getVideoTracks()[0]||null,d=f.getAudioTracks()[0]||null}catch(f){throw r.onError(f),f}if(!l){const f=new P(D.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(f),f.throw()}if(!d&&t==="enable"){l&&l.stop();const f=new P(D.SHARE_AUDIO_NOT_ALLOWED);return r.onError(f),f.throw()}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(N_(s,l,e,e.encoderConfig&&nu(e.encoderConfig)),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const p=new cr(l,e.encoderConfig?nu(e.encoderConfig):{},e.scalabiltyMode?Ba(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,s);if(p._hints.push(Kn.SCREEN_TRACK),!d)return r.onSuccess(p.getTrackId()),S.info("create screen video track success","video:",p.getTrackId()),p;const m=new qr(d);return r.onSuccess([p.getTrackId(),m.getTrackId()]),S.info("create screen video track success","video:",p.getTrackId(),"audio:",m.getTrackId()),[p,m]},createMicrophoneAndCameraTracks:async function(){var e,t,r,i;let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{encoderConfig:"480p_1"};const d=At.reportApiInvoke(null,{tag:Wt.TRACER,name:Ht.CREATE_MIC_AND_CAM_TRACKS,options:[s,l]}),h=Kl(l),p=SA(s),m=Pe(8,"track-mic-"),f=Pe(8,"track-cam-");let _=null,v=null;S.info(k(e=k(t=k(r="start create camera video track(".concat(f,") and microphone audio track(")).call(r,m,") with config, audio: ")).call(t,St(s),", video: ")).call(e,St(l)));try{var T;const O=await on({audio:p,video:h},k(T="".concat(m,"-")).call(T,f));_=O.getAudioTracks()[0],v=O.getVideoTracks()[0]}catch(O){throw d.onError(O),O}if(!_||!v){const O=new P(D.UNEXPECTED_ERROR,"can not find tracks in media stream");return d.onError(O),O.throw()}l.optimizationMode&&N_(f,v,l,l.encoderConfig&&$o(l.encoderConfig));const R=new gu(_,s,p,m),w=new Nu(v,l,h,l.scalabiltyMode?Ba(l.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},l.optimizationMode,f);return d.onSuccess([R.getTrackId(),w.getTrackId()]),S.info(k(i="create camera video track(".concat(f,") and microphone audio track(")).call(i,m,") success")),[R,w]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=At.reportApiInvoke(null,{tag:Wt.TRACER,name:Ht.CREATE_MIC_AUDIO_TRACK,options:[e]}),r=SA(e),i=Pe(8,"track-mic-");let s=null;S.info("start create microphone audio track with config",St(e),"trackId",i);try{s=(await on({audio:r},i)).getAudioTracks()[0]||null}catch(d){throw t.onError(d),d}if(!s){const d=new P(D.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(d),d.throw()}const l=new gu(s,e,r,i);return t.onSuccess(l.getTrackId()),S.info("create microphone audio track success, trackId:",i),l},createCustomAudioTrack:function(e){const t=At.reportApiInvoke(null,{tag:Wt.TRACER,name:Ht.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),r=new qr(e.mediaStreamTrack,e.encoderConfig?Cc(e.encoderConfig):{});return S.info("create custom audio track success with config",e,"trackId",r.getTrackId()),t.onSuccess(r.getTrackId()),r},createBufferSourceAudioTrack:async function(e){const t=At.reportApiInvoke(null,{tag:Wt.TRACER,name:Ht.CREATE_BUFFER_AUDIO_TRACK,options:[e]}),r=Pe(8,"track-buf-");S.info("start create buffer source audio track with config",St(e),"trackId",r);const i=e.source;if(!(e.source instanceof AudioBuffer))try{e.source=await pN(e.source,e.cacheOnlineFile)}catch(d){return t.onError(d),d.throw()}const s=new uN(e.source),l=new Dl(i,s,e.encoderConfig?Cc(e.encoderConfig):{},r);return S.info("create buffer source audio track success, trackId:",r),t.onSuccess(l.getTrackId()),l},setLogLevel:yN,enableLogUpload:wN,disableLogUpload:bN,createChannelMediaRelayConfiguration:RN,checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const r=At.reportApiInvoke(null,{tag:Wt.TRACER,name:Ht.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof qr||e instanceof E_)){const p=new P(D.INVALID_TRACK,"the parameter is not a audio track");return r.onError(p),p.throw()}t&&t<1e3&&(t=1e3);const i=e instanceof qr?e.getTrackLabel():"remote_track",s=e.getVolumeLevel();let l=s,d=s;const h=ht();return new ct(p=>{const m=be(()=>{const f=e.getVolumeLevel();l=f>l?f:l,d=f<d?f:d;const _=l-d>1e-4,v=ht()-h;if(_||v>t){var T;clearInterval(m);const R=_,w={duration:v,deviceLabel:i,maxVolumeLevel:l,result:R};S.info(k(T="[track-".concat(e.getTrackId(),"] check audio track active completed. ")).call(T,St(w))),r.onSuccess(w),p(R)}},200)})},checkVideoTrackIsActive:async function(e){var t;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=At.reportApiInvoke(null,{tag:Wt.TRACER,name:Ht.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[r]});if(!(e instanceof cr||e instanceof m_)){const T=new P(D.INVALID_TRACK,"the parameter is not a video track");return i.onError(T),T.throw()}const s=4;r&&r<1e3&&(r=1e3);const l=e instanceof cr?e.getTrackLabel():"remote_track",d=e.getMediaStreamTrack(!0),h=document.createElement("video");h.style.width="1px",h.style.height="1px",h.setAttribute("muted",""),h.muted=!0,h.setAttribute("playsinline",""),h.controls=!1,(Ri()||$d())&&(h.style.opacity="0.01",h.style.position="fixed",h.style.left="0",h.style.top="0",document.body.appendChild(h)),h.srcObject=new MediaStream([d]),h.play();const p=document.createElement("canvas");p.width=160,p.height=120;let m=0,f=0;try{const T=ht();m=await aG(h,r,p,s),f=ht()-T}catch(T){throw i.onError(T),T}sG===ye.SAFARI&&(h.pause(),h.remove()),h.srcObject=null;const _=m>s,v={duration:f,changedPicNum:m,deviceLabel:l,result:_};return S.info(k(t="[track-".concat(e.getTrackId(),"] check video track active completed. ")).call(t,St(v))),i.onSuccess(v),_},setArea:tw,loadModule:NN,processExternalMediaAEC:ON},AG={__CLIENT_LIST__:ts,__TRACK_LIST__:Zs,VERSION:Tn,BUILD:vl,setParameter:jr,getParameter:it,getSupportedCodec:lN,checkSystemRequirements:dN,getDevices:vN,getMicrophones:CN,getCameras:SN,getElectronScreenSources:fE,getPlaybackDevices:TN,createClient:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",mode:"rtc"};const t=wt.reportApiInvoke(null,{name:de.CREATE_CLIENT,options:[e],tag:zt.TRACER});try{V7(e)}catch(r){throw t.onError(r),r}return t.onSuccess(),new rd(ua(ua({forceWaitGatewayResponse:!0},e),{},{role:e.mode==="rtc"?"host":e.role}))},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{encoderConfig:"480p_1"};const t=wt.reportApiInvoke(null,{tag:zt.TRACER,name:de.CREATE_CAM_VIDEO_TRACK,options:[HA({},e)]}),r=Kl(e),i=Pe(8,"track-cam-");let s=null;S.info("start create camera video track with config",St(e),"trackId",i);try{s=(await on({video:r},i)).getVideoTracks()[0]||null}catch(d){throw t.onError(d),d}if(!s){const d=new P(Ze.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(d),d.throw()}e.optimizationMode&&O_(i,s,e,e.encoderConfig&&$o(e.encoderConfig));const l=new Fu(s,e,r,e.scalabiltyMode?Ba(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i);return t.onSuccess(l.getTrackId()),S.info("create camera video success, trackId:",i),l},createCustomVideoTrack:function(e){const t=wt.reportApiInvoke(null,{tag:zt.TRACER,name:de.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),r=new Fr(e.mediaStreamTrack,{bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?Ba(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode);return t.onSuccess(r.getTrackId()),S.info("create custom video track success with config",e,"trackId",r.getTrackId()),r},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const r=wt.reportApiInvoke(null,{tag:zt.TRACER,name:de.CREATE_SCREEN_VIDEO_TRACK,options:[HA({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const i=fw(e),s=Pe(8,"track-scr");let l=null,d=null;const h=Dr();if(!h.supportShareAudio&&t==="enable"){const f=new P(Ze.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return r.onError(f),f.throw()}S.info("start create screen video track with config",e,"withAudio",t,"trackId",s);try{const f=await on({screen:i,screenAudio:t==="auto"?h.supportShareAudio:t==="enable"},s);l=f.getVideoTracks()[0]||null,d=f.getAudioTracks()[0]||null}catch(f){throw r.onError(f),f}if(!l){const f=new P(Ze.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(f),f.throw()}if(!d&&t==="enable"){l&&l.stop();const f=new P(Ze.SHARE_AUDIO_NOT_ALLOWED);return r.onError(f),f.throw()}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(O_(s,l,e,e.encoderConfig&&nu(e.encoderConfig)),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const p=new Fr(l,e.encoderConfig?nu(e.encoderConfig):{},e.scalabiltyMode?Ba(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,s);if(p._hints.push(ks.SCREEN_TRACK),!d)return r.onSuccess(p.getTrackId()),S.info("create screen video track success","video:",p.getTrackId()),p;const m=new bn(d);return r.onSuccess([p.getTrackId(),m.getTrackId()]),S.info("create screen video track success","video:",p.getTrackId(),"audio:",m.getTrackId()),[p,m]},createMicrophoneAndCameraTracks:async function(){var e,t,r,i;let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{encoderConfig:"480p_1"};const d=wt.reportApiInvoke(null,{tag:zt.TRACER,name:de.CREATE_MIC_AND_CAM_TRACKS,options:[s,l]}),h=Kl(l),p=SA(s),m=Pe(8,"track-mic-"),f=Pe(8,"track-cam-");let _=null,v=null;S.info(k(e=k(t=k(r="start create camera video track(".concat(f,") and microphone audio track(")).call(r,m,") with config, audio: ")).call(t,St(s),", video: ")).call(e,St(l)));try{var T;const O=await on({audio:p,video:h},k(T="".concat(m,"-")).call(T,f));_=O.getAudioTracks()[0],v=O.getVideoTracks()[0]}catch(O){throw d.onError(O),O}if(!_||!v){const O=new P(Ze.UNEXPECTED_ERROR,"can not find tracks in media stream");return d.onError(O),O.throw()}l.optimizationMode&&O_(f,v,l,l.encoderConfig&&$o(l.encoderConfig));const R=new Bu(_,s,p,m),w=new Fu(v,l,h,l.scalabiltyMode?Ba(l.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},l.optimizationMode,f);return d.onSuccess([R.getTrackId(),w.getTrackId()]),S.info(k(i="create camera video track(".concat(f,") and microphone audio track(")).call(i,m,") success")),[R,w]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=wt.reportApiInvoke(null,{tag:zt.TRACER,name:de.CREATE_MIC_AUDIO_TRACK,options:[e]}),r=SA(e),i=Pe(8,"track-mic-");let s=null;S.info("start create microphone audio track with config",St(e),"trackId",i);try{s=(await on({audio:r},i)).getAudioTracks()[0]||null}catch(d){throw t.onError(d),d}if(!s){const d=new P(Ze.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(d),d.throw()}const l=new Bu(s,e,r,i);return t.onSuccess(l.getTrackId()),S.info("create microphone audio track success, trackId:",i),l},createCustomAudioTrack:function(e){const t=wt.reportApiInvoke(null,{tag:zt.TRACER,name:de.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),r=new bn(e.mediaStreamTrack,e.encoderConfig?Cc(e.encoderConfig):{});return S.info("create custom audio track success with config",e,"trackId",r.getTrackId()),t.onSuccess(r.getTrackId()),r},createBufferSourceAudioTrack:async function(e){const t=wt.reportApiInvoke(null,{tag:zt.TRACER,name:de.CREATE_BUFFER_AUDIO_TRACK,options:[e]}),r=Pe(8,"track-buf-");S.info("start create buffer source audio track with config",St(e),"trackId",r);const i=e.source;if(!(e.source instanceof AudioBuffer))try{e.source=await pN(e.source,e.cacheOnlineFile)}catch(d){return t.onError(d),d.throw()}const s=new uN(e.source),l=new td(i,s,e.encoderConfig?Cc(e.encoderConfig):{},r);return S.info("create buffer source audio track success, trackId:",r),t.onSuccess(l.getTrackId()),l},setLogLevel:yN,enableLogUpload:wN,disableLogUpload:bN,createChannelMediaRelayConfiguration:RN,checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const r=wt.reportApiInvoke(null,{tag:zt.TRACER,name:de.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof bn||e instanceof Vu)){const p=new P(Ze.INVALID_TRACK,"the parameter is not a audio track");return r.onError(p),p.throw()}t&&t<1e3&&(t=1e3);const i=e instanceof bn?e.getTrackLabel():"remote_track",s=e.getVolumeLevel();let l=s,d=s;const h=ht();return new ct(p=>{const m=be(()=>{const f=e.getVolumeLevel();l=f>l?f:l,d=f<d?f:d;const _=l-d>1e-4,v=ht()-h;if(_||v>t){var T;clearInterval(m);const R=_,w={duration:v,deviceLabel:i,maxVolumeLevel:l,result:R};S.info(k(T="[track-".concat(e.getTrackId(),"] check audio track active completed. ")).call(T,St(w))),r.onSuccess(w),p(R)}},200)})},checkVideoTrackIsActive:async function(e){var t;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=wt.reportApiInvoke(null,{tag:zt.TRACER,name:de.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[r]});if(!(e instanceof Fr||e instanceof Qu)){const T=new P(Ze.INVALID_TRACK,"the parameter is not a video track");return i.onError(T),T.throw()}const s=4;r&&r<1e3&&(r=1e3);const l=e instanceof Fr?e.getTrackLabel():"remote_track",d=e.getMediaStreamTrack(!0),h=document.createElement("video");h.style.width="1px",h.style.height="1px",h.setAttribute("muted",""),h.muted=!0,h.setAttribute("playsinline",""),h.controls=!1,(Ri()||$d())&&(h.style.opacity="0.01",h.style.position="fixed",h.style.left="0",h.style.top="0",document.body.appendChild(h)),h.srcObject=new MediaStream([d]),h.play();const p=document.createElement("canvas");p.width=160,p.height=120;let m=0,f=0;try{const T=ht();m=await lG(h,r,p,s),f=ht()-T}catch(T){throw i.onError(T),T}cG===zl.SAFARI&&(h.pause(),h.remove()),h.srcObject=null;const _=m>s,v={duration:f,changedPicNum:m,deviceLabel:l,result:_};return S.info(k(t="[track-".concat(e.getTrackId(),"] check video track active completed. ")).call(t,St(v))),i.onSuccess(v),_},setArea:tw,loadModule:NN,processExternalMediaAEC:ON},ha=it("SDK_FALLBACK")?AG:pG;return ur(ha,{onAudioAutoplayFailed:{get:()=>Hi.onAudioAutoplayFailed,set:e=>{Hi.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>Hi.onAutoplayFailed,set:e=>{Hi.onAutoplayFailed=e}}}),dn.on($s.CAMERA_DEVICE_CHANGED,e=>{S.info("camera device changed",St(e)),ha.onCameraChanged&&ha.onCameraChanged(e)}),dn.on($s.RECORDING_DEVICE_CHANGED,e=>{S.info("microphone device changed",St(e)),ha.onMicrophoneChanged&&ha.onMicrophoneChanged(e)}),dn.on($s.PLAYOUT_DEVICE_CHANGED,e=>{S.debug("playout device changed",St(e)),ha.onPlaybackDeviceChanged&&ha.onPlaybackDeviceChanged(e)}),Yr.onAutoplayFailed=()=>{S.info("detect audio element autoplay failed"),Hi.onAudioAutoplayFailed&&Hi.onAudioAutoplayFailed()},le.on("autoplay-failed",()=>{S.info("detect webaudio autoplay failed"),Hi.onAudioAutoplayFailed&&Hi.onAudioAutoplayFailed()}),window&&(window.__ARTC__=ha),ha})})(bD);var oI=DG(bD.exports);const zX=(o={token:null,channelName:null})=>{const n=MI(),a=o.token||n.token;return ij.request({url:"client/user/pub/videoToken",params:{uni_id_token:a,channelName:o.channelName}})},XX={props:{id:{type:String,default:""}},setup(o){const n=o,a=oj();MI();let c=Yu({});const u=Yu({uid:1,name:"a",hasOpenVideo:Wc(!1),hasOpenAudio:Wc(!1),videoTrack:null,audioTrack:null,isShow:!0}),A=async lt=>{lt.isShow=!1,lt.hasOpenVideo&&lt.videoTrack&&(lt.videoTrack.stop(),lt.videoTrack.close(),lt.uid===u.uid&&I.unpublish(u.videoTrack)),lt.hasOpenAudio&&lt.audioTrack&&(lt.audioTrack.stop(),lt.audioTrack.close(),lt.uid===u.uid&&I.unpublish(u.audioTrack))},g=async lt=>{const et=lt.uid;if(et===u.uid){if(!u.audioTrack){await L();return}u.hasOpenAudio?(u.audioTrack.setEnabled(!1),u.hasOpenAudio=!1):(u.audioTrack.setEnabled(!0),u.hasOpenAudio=!0);return}c[et].hasAudio?c[et].hasOpenAudio?(c[et].audioTrack.stop(),c[et].hasOpenAudio=!1):(c[et].audioTrack.play(),c[et].hasOpenAudio=!0):c[et].hasOpenAudio=!1},E=async lt=>{const et=lt.uid;if(et===u.uid){if(!u.videoTrack){await N();return}u.hasOpenVideo?(u.videoTrack.setEnabled(!1),u.hasOpenVideo=!1):(u.videoTrack.setEnabled(!0),u.hasOpenVideo=!0);return}c[et].hasVideo&&(c[et].hasOpenVideo?(c[et].videoTrack.stop(),c[et].hasOpenVideo=!1):(c[et].videoTrack.play(`player-${et}`),c[et].hasOpenVideo=!0))};let I=null,C=Yu({audioTrack:null,videoTrack:null});LI(async()=>{I=oI.createClient({codec:"vp8",mode:"rtc"}),I.on("user-published",b),I.on("user-unpublished",G),I.on("user-left",Z);const lt=await zX({channelName:n.id}),{token:et,uid:Dt}=lt.data;u.uid=await I.join(a.liveOptions.APPID,n.id,et,Dt),await N(),await L()}),l2(async()=>{await dt()});async function b(lt,et){const Dt=lt.uid;c[Dt]||(c[Dt]=lt),Q(lt,et)}async function N(){C.videoTrack=await oI.createCameraVideoTrack().catch(lt=>{}),C.videoTrack&&(u.hasOpenVideo=!0,u.isShow=!0,C.videoTrack.play("player-"+u.uid),u.videoTrack=C.videoTrack,I.publish(C.videoTrack))}async function L(){C.audioTrack=await oI.createMicrophoneAudioTrack().catch(lt=>{}),C.audioTrack&&(u.hasOpenAudio=!0,u.audioTrack=C.audioTrack,I.publish(C.audioTrack))}async function Q(lt,et){const Dt=lt.uid;await I.subscribe(lt,et),et==="video"&&(c[Dt].isShow=!0,await o2(),c[Dt].videoTrack.play(`player-${Dt}`),c[Dt].hasOpenVideo=!0),et==="audio"&&(c[Dt].audioTrack.play(),c[Dt].hasOpenAudio=!0)}async function G(lt){const et=lt.uid;c[et].hasVideo?c[et].hasAudio||(c[et].hasOpenAudio=!1):c[et].isShow=!1}async function Z(lt){const et=lt.uid;c[et].isShow=!1,c[et].hasOpenVideo&&c[et].videoTrack&&c[et].videoTrack.stop(),c[et].hasOpenAudio&&c[et].audioTrack&&c[et].audioTrack.stop(),delete c[et];for(const Dt in c)if(Object.hasOwnProperty.call(c,Dt)){const J=c[Dt];if(J.hasVideo){Q(J,"video");break}}}async function dt(){for(const lt in C){let et=C[lt];et&&(et.stop(),et.close(),C[lt]=void 0)}c={},await I.leave()}return(lt,et)=>(vn(),ki(Ea,null,[(vn(!0),ki(Ea,null,BI(ds(c),(Dt,J,Ft)=>(vn(),ki(Ea,{key:Dt.uid},[Dt.isShow?(vn(),ud(i2,{key:0,"live-user":Dt,onVideo:Ot=>E(Dt),onAudio:Ot=>g(Dt),onClose:Ot=>A(Dt),name:Dt.uid+"","class-name":"w-80 h-60 "+(Ft==0?"bottom-[calc(100vh-19rem)]":"bottom-[calc(100vh-34.6rem)]")},null,8,["live-user","onVideo","onAudio","onClose","name","class-name"])):sI("",!0)],64))),128)),ds(u).isShow?(vn(),ud(i2,{key:0,"live-user":ds(u),onVideo:et[0]||(et[0]=Dt=>E(ds(u))),onAudio:et[1]||(et[1]=Dt=>g(ds(u))),onClose:et[2]||(et[2]=Dt=>A(ds(u)))},null,8,["live-user"])):sI("",!0)],64))}},ZX={class:"pt-16 w-screen h-screen overflow-hidden"},iZ={props:{id:{type:String,default:""}},setup(o){return(n,a)=>(vn(),ki(Ea,null,[Oi(QX),br("div",ZX,[Oi(IX,{class:"h-full"})]),(vn(),ud(LG,null,{default:cd(()=>[Oi(XX,{id:o.id},null,8,["id"])]),_:1}))],64))}};export{iZ as default};
