var WN=Object.defineProperty,YN=Object.defineProperties;var qN=Object.getOwnPropertyDescriptors;var Td=Object.getOwnPropertySymbols;var oC=Object.prototype.hasOwnProperty,sC=Object.prototype.propertyIsEnumerable;var aC=(t,e,r)=>e in t?WN(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,re=(t,e)=>{for(var r in e||(e={}))oC.call(e,r)&&aC(t,r,e[r]);if(Td)for(var r of Td(e))sC.call(e,r)&&aC(t,r,e[r]);return t},Hn=(t,e)=>YN(t,qN(e));var cC=(t,e)=>{var r={};for(var o in t)oC.call(t,o)&&e.indexOf(o)<0&&(r[o]=t[o]);if(t!=null&&Td)for(var o of Td(t))e.indexOf(o)<0&&sC.call(t,o)&&(r[o]=t[o]);return r};import{h as Nn,l as On,P as Ol,S as Rd,U as fa,w as JN,V as lC,b as Oo,W as uC,X as wd,k as Aa,Y as zN,Z as XN,r as co,o as bt,c as mr,g as er,s as hn,F as ts,p as Df,n as ko,_ as dC,j as lt,x as Nd,y as _s,e as vc,q as Ss,$ as $N,a0 as ZN,a1 as eO,a2 as Bf,a3 as Ec,i as oi,a4 as Od,R as Mf,a5 as tO,a6 as hC,H as pC,a7 as fC,T as rO,a8 as AC,a9 as nO,aa as iO,ab as oO,t as gC,v as mC,Q as sO,ac as aO,ad as vC,ae as Lf}from"./vendor.c6b01104.js";import{j as cO,G as lO,H as uO,I as dO,J as EC,K as IC,S as CC,L as hO,Y as rs,M as pO,N as Ts,P as fO,Q as AO,R as gO,z as kl,T as mO,U as yC,V as vO,W as EO,X as IO,E as Pf,Z as xf,_ as Qf,D as CO,$ as yO,C as _O,a0 as SO,s as TO,a1 as RO,a2 as bl,a3 as _C,a4 as SC,a5 as wO,a6 as NO,a7 as OO,c as Uf,a8 as kO}from"./mutex.1833576a.js";import{_ as Dl,S as ga,u as bO}from"./index.12f8053d.js";const DO=t=>class{constructor(r){this._=r}destroy(){t(this._)}},BO=DO(clearTimeout),MO=(t,e)=>new BO(setTimeout(e,t));function kn(t){this.content=t}kn.prototype={constructor:kn,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return e==-1?void 0:this.content[e+1]},update:function(t,e,r){var o=r&&r!=t?this.remove(r):this,a=o.find(t),l=o.content.slice();return a==-1?l.push(r||t,e):(l[a+1]=e,r&&(l[a]=r)),new kn(l)},remove:function(t){var e=this.find(t);if(e==-1)return this;var r=this.content.slice();return r.splice(e,2),new kn(r)},addToStart:function(t,e){return new kn([t,e].concat(this.remove(t).content))},addToEnd:function(t,e){var r=this.remove(t).content.slice();return r.push(t,e),new kn(r)},addBefore:function(t,e,r){var o=this.remove(e),a=o.content.slice(),l=o.find(t);return a.splice(l==-1?a.length:l,0,e,r),new kn(a)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(t){return t=kn.from(t),t.size?new kn(t.content.concat(this.subtract(t).content)):this},append:function(t){return t=kn.from(t),t.size?new kn(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var e=this;t=kn.from(t);for(var r=0;r<t.content.length;r+=2)e=e.remove(t.content[r]);return e},get size(){return this.content.length>>1}};kn.from=function(t){if(t instanceof kn)return t;var e=[];if(t)for(var r in t)e.push(r,t[r]);return new kn(e)};var TC=kn;function RC(t,e,r){for(var o=0;;o++){if(o==t.childCount||o==e.childCount)return t.childCount==e.childCount?null:r;var a=t.child(o),l=e.child(o);if(a==l){r+=a.nodeSize;continue}if(!a.sameMarkup(l))return r;if(a.isText&&a.text!=l.text){for(var d=0;a.text[d]==l.text[d];d++)r++;return r}if(a.content.size||l.content.size){var p=RC(a.content,l.content,r+1);if(p!=null)return p}r+=a.nodeSize}}function wC(t,e,r,o){for(var a=t.childCount,l=e.childCount;;){if(a==0||l==0)return a==l?null:{a:r,b:o};var d=t.child(--a),p=e.child(--l),g=d.nodeSize;if(d==p){r-=g,o-=g;continue}if(!d.sameMarkup(p))return{a:r,b:o};if(d.isText&&d.text!=p.text){for(var v=0,C=Math.min(d.text.length,p.text.length);v<C&&d.text[d.text.length-v-1]==p.text[p.text.length-v-1];)v++,r--,o--;return{a:r,b:o}}if(d.content.size||p.content.size){var y=wC(d.content,p.content,r-1,o-1);if(y)return y}r-=g,o-=g}}var ee=function(e,r){if(this.content=e,this.size=r||0,r==null)for(var o=0;o<e.length;o++)this.size+=e[o].nodeSize},kd={firstChild:{configurable:!0},lastChild:{configurable:!0},childCount:{configurable:!0}};ee.prototype.nodesBetween=function(e,r,o,a,l){a===void 0&&(a=0);for(var d=0,p=0;p<r;d++){var g=this.content[d],v=p+g.nodeSize;if(v>e&&o(g,a+p,l,d)!==!1&&g.content.size){var C=p+1;g.nodesBetween(Math.max(0,e-C),Math.min(g.content.size,r-C),o,a+C)}p=v}};ee.prototype.descendants=function(e){this.nodesBetween(0,this.size,e)};ee.prototype.textBetween=function(e,r,o,a){var l="",d=!0;return this.nodesBetween(e,r,function(p,g){p.isText?(l+=p.text.slice(Math.max(e,g)-g,r-g),d=!o):p.isLeaf&&a?(l+=typeof a=="function"?a(p):a,d=!o):!d&&p.isBlock&&(l+=o,d=!0)},0),l};ee.prototype.append=function(e){if(!e.size)return this;if(!this.size)return e;var r=this.lastChild,o=e.firstChild,a=this.content.slice(),l=0;for(r.isText&&r.sameMarkup(o)&&(a[a.length-1]=r.withText(r.text+o.text),l=1);l<e.content.length;l++)a.push(e.content[l]);return new ee(a,this.size+e.size)};ee.prototype.cut=function(e,r){if(r==null&&(r=this.size),e==0&&r==this.size)return this;var o=[],a=0;if(r>e)for(var l=0,d=0;d<r;l++){var p=this.content[l],g=d+p.nodeSize;g>e&&((d<e||g>r)&&(p.isText?p=p.cut(Math.max(0,e-d),Math.min(p.text.length,r-d)):p=p.cut(Math.max(0,e-d-1),Math.min(p.content.size,r-d-1))),o.push(p),a+=p.nodeSize),d=g}return new ee(o,a)};ee.prototype.cutByIndex=function(e,r){return e==r?ee.empty:e==0&&r==this.content.length?this:new ee(this.content.slice(e,r))};ee.prototype.replaceChild=function(e,r){var o=this.content[e];if(o==r)return this;var a=this.content.slice(),l=this.size+r.nodeSize-o.nodeSize;return a[e]=r,new ee(a,l)};ee.prototype.addToStart=function(e){return new ee([e].concat(this.content),this.size+e.nodeSize)};ee.prototype.addToEnd=function(e){return new ee(this.content.concat(e),this.size+e.nodeSize)};ee.prototype.eq=function(e){if(this.content.length!=e.content.length)return!1;for(var r=0;r<this.content.length;r++)if(!this.content[r].eq(e.content[r]))return!1;return!0};kd.firstChild.get=function(){return this.content.length?this.content[0]:null};kd.lastChild.get=function(){return this.content.length?this.content[this.content.length-1]:null};kd.childCount.get=function(){return this.content.length};ee.prototype.child=function(e){var r=this.content[e];if(!r)throw new RangeError("Index "+e+" out of range for "+this);return r};ee.prototype.maybeChild=function(e){return this.content[e]};ee.prototype.forEach=function(e){for(var r=0,o=0;r<this.content.length;r++){var a=this.content[r];e(a,o,r),o+=a.nodeSize}};ee.prototype.findDiffStart=function(e,r){return r===void 0&&(r=0),RC(this,e,r)};ee.prototype.findDiffEnd=function(e,r,o){return r===void 0&&(r=this.size),o===void 0&&(o=e.size),wC(this,e,r,o)};ee.prototype.findIndex=function(e,r){if(r===void 0&&(r=-1),e==0)return bd(0,e);if(e==this.size)return bd(this.content.length,e);if(e>this.size||e<0)throw new RangeError("Position "+e+" outside of fragment ("+this+")");for(var o=0,a=0;;o++){var l=this.child(o),d=a+l.nodeSize;if(d>=e)return d==e||r>0?bd(o+1,d):bd(o,a);a=d}};ee.prototype.toString=function(){return"<"+this.toStringInner()+">"};ee.prototype.toStringInner=function(){return this.content.join(", ")};ee.prototype.toJSON=function(){return this.content.length?this.content.map(function(e){return e.toJSON()}):null};ee.fromJSON=function(e,r){if(!r)return ee.empty;if(!Array.isArray(r))throw new RangeError("Invalid input for Fragment.fromJSON");return new ee(r.map(e.nodeFromJSON))};ee.fromArray=function(e){if(!e.length)return ee.empty;for(var r,o=0,a=0;a<e.length;a++){var l=e[a];o+=l.nodeSize,a&&l.isText&&e[a-1].sameMarkup(l)?(r||(r=e.slice(0,a)),r[r.length-1]=l.withText(r[r.length-1].text+l.text)):r&&r.push(l)}return new ee(r||e,o)};ee.from=function(e){if(!e)return ee.empty;if(e instanceof ee)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new ee([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))};Object.defineProperties(ee.prototype,kd);var Ff={index:0,offset:0};function bd(t,e){return Ff.index=t,Ff.offset=e,Ff}ee.empty=new ee([],0);function Dd(t,e){if(t===e)return!0;if(!(t&&typeof t=="object")||!(e&&typeof e=="object"))return!1;var r=Array.isArray(t);if(Array.isArray(e)!=r)return!1;if(r){if(t.length!=e.length)return!1;for(var o=0;o<t.length;o++)if(!Dd(t[o],e[o]))return!1}else{for(var a in t)if(!(a in e)||!Dd(t[a],e[a]))return!1;for(var l in e)if(!(l in t))return!1}return!0}var Ct=function(e,r){this.type=e,this.attrs=r};Ct.prototype.addToSet=function(e){for(var r,o=!1,a=0;a<e.length;a++){var l=e[a];if(this.eq(l))return e;if(this.type.excludes(l.type))r||(r=e.slice(0,a));else{if(l.type.excludes(this.type))return e;!o&&l.type.rank>this.type.rank&&(r||(r=e.slice(0,a)),r.push(this),o=!0),r&&r.push(l)}}return r||(r=e.slice()),o||r.push(this),r};Ct.prototype.removeFromSet=function(e){for(var r=0;r<e.length;r++)if(this.eq(e[r]))return e.slice(0,r).concat(e.slice(r+1));return e};Ct.prototype.isInSet=function(e){for(var r=0;r<e.length;r++)if(this.eq(e[r]))return!0;return!1};Ct.prototype.eq=function(e){return this==e||this.type==e.type&&Dd(this.attrs,e.attrs)};Ct.prototype.toJSON=function(){var e={type:this.type.name};for(var r in this.attrs){e.attrs=this.attrs;break}return e};Ct.fromJSON=function(e,r){if(!r)throw new RangeError("Invalid input for Mark.fromJSON");var o=e.marks[r.type];if(!o)throw new RangeError("There is no mark type "+r.type+" in this schema");return o.create(r.attrs)};Ct.sameSet=function(e,r){if(e==r)return!0;if(e.length!=r.length)return!1;for(var o=0;o<e.length;o++)if(!e[o].eq(r[o]))return!1;return!0};Ct.setFrom=function(e){if(!e||e.length==0)return Ct.none;if(e instanceof Ct)return[e];var r=e.slice();return r.sort(function(o,a){return o.type.rank-a.type.rank}),r};Ct.none=[];function bo(t){var e=Error.call(this,t);return e.__proto__=bo.prototype,e}bo.prototype=Object.create(Error.prototype);bo.prototype.constructor=bo;bo.prototype.name="ReplaceError";var ye=function(e,r,o){this.content=e,this.openStart=r,this.openEnd=o},NC={size:{configurable:!0}};NC.size.get=function(){return this.content.size-this.openStart-this.openEnd};ye.prototype.insertAt=function(e,r){var o=kC(this.content,e+this.openStart,r,null);return o&&new ye(o,this.openStart,this.openEnd)};ye.prototype.removeBetween=function(e,r){return new ye(OC(this.content,e+this.openStart,r+this.openStart),this.openStart,this.openEnd)};ye.prototype.eq=function(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd};ye.prototype.toString=function(){return this.content+"("+this.openStart+","+this.openEnd+")"};ye.prototype.toJSON=function(){if(!this.content.size)return null;var e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e};ye.fromJSON=function(e,r){if(!r)return ye.empty;var o=r.openStart||0,a=r.openEnd||0;if(typeof o!="number"||typeof a!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new ye(ee.fromJSON(e,r.content),o,a)};ye.maxOpen=function(e,r){r===void 0&&(r=!0);for(var o=0,a=0,l=e.firstChild;l&&!l.isLeaf&&(r||!l.type.spec.isolating);l=l.firstChild)o++;for(var d=e.lastChild;d&&!d.isLeaf&&(r||!d.type.spec.isolating);d=d.lastChild)a++;return new ye(e,o,a)};Object.defineProperties(ye.prototype,NC);function OC(t,e,r){var o=t.findIndex(e),a=o.index,l=o.offset,d=t.maybeChild(a),p=t.findIndex(r),g=p.index,v=p.offset;if(l==e||d.isText){if(v!=r&&!t.child(g).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(r))}if(a!=g)throw new RangeError("Removing non-flat range");return t.replaceChild(a,d.copy(OC(d.content,e-l-1,r-l-1)))}function kC(t,e,r,o){var a=t.findIndex(e),l=a.index,d=a.offset,p=t.maybeChild(l);if(d==e||p.isText)return o&&!o.canReplace(l,l,r)?null:t.cut(0,e).append(r).append(t.cut(e));var g=kC(p.content,e-d-1,r);return g&&t.replaceChild(l,p.copy(g))}ye.empty=new ye(ee.empty,0,0);function LO(t,e,r){if(r.openStart>t.depth)throw new bo("Inserted content deeper than insertion position");if(t.depth-r.openStart!=e.depth-r.openEnd)throw new bo("Inconsistent open depths");return bC(t,e,r,0)}function bC(t,e,r,o){var a=t.index(o),l=t.node(o);if(a==e.index(o)&&o<t.depth-r.openStart){var d=bC(t,e,r,o+1);return l.copy(l.content.replaceChild(a,d))}else if(r.content.size)if(!r.openStart&&!r.openEnd&&t.depth==o&&e.depth==o){var p=t.parent,g=p.content;return va(p,g.cut(0,t.parentOffset).append(r.content).append(g.cut(e.parentOffset)))}else{var v=PO(r,t),C=v.start,y=v.end;return va(l,BC(t,C,y,e,o))}else return va(l,Bd(t,e,o))}function DC(t,e){if(!e.type.compatibleContent(t.type))throw new bo("Cannot join "+e.type.name+" onto "+t.type.name)}function Vf(t,e,r){var o=t.node(r);return DC(o,e.node(r)),o}function ma(t,e){var r=e.length-1;r>=0&&t.isText&&t.sameMarkup(e[r])?e[r]=t.withText(e[r].text+t.text):e.push(t)}function Bl(t,e,r,o){var a=(e||t).node(r),l=0,d=e?e.index(r):a.childCount;t&&(l=t.index(r),t.depth>r?l++:t.textOffset&&(ma(t.nodeAfter,o),l++));for(var p=l;p<d;p++)ma(a.child(p),o);e&&e.depth==r&&e.textOffset&&ma(e.nodeBefore,o)}function va(t,e){if(!t.type.validContent(e))throw new bo("Invalid content for node "+t.type.name);return t.copy(e)}function BC(t,e,r,o,a){var l=t.depth>a&&Vf(t,e,a+1),d=o.depth>a&&Vf(r,o,a+1),p=[];return Bl(null,t,a,p),l&&d&&e.index(a)==r.index(a)?(DC(l,d),ma(va(l,BC(t,e,r,o,a+1)),p)):(l&&ma(va(l,Bd(t,e,a+1)),p),Bl(e,r,a,p),d&&ma(va(d,Bd(r,o,a+1)),p)),Bl(o,null,a,p),new ee(p)}function Bd(t,e,r){var o=[];if(Bl(null,t,r,o),t.depth>r){var a=Vf(t,e,r+1);ma(va(a,Bd(t,e,r+1)),o)}return Bl(e,null,r,o),new ee(o)}function PO(t,e){for(var r=e.depth-t.openStart,o=e.node(r),a=o.copy(t.content),l=r-1;l>=0;l--)a=e.node(l).copy(ee.from(a));return{start:a.resolveNoCache(t.openStart+r),end:a.resolveNoCache(a.content.size-t.openEnd-r)}}var sr=function(e,r,o){this.pos=e,this.path=r,this.depth=r.length/3-1,this.parentOffset=o},Ic={parent:{configurable:!0},doc:{configurable:!0},textOffset:{configurable:!0},nodeAfter:{configurable:!0},nodeBefore:{configurable:!0}};sr.prototype.resolveDepth=function(e){return e==null?this.depth:e<0?this.depth+e:e};Ic.parent.get=function(){return this.node(this.depth)};Ic.doc.get=function(){return this.node(0)};sr.prototype.node=function(e){return this.path[this.resolveDepth(e)*3]};sr.prototype.index=function(e){return this.path[this.resolveDepth(e)*3+1]};sr.prototype.indexAfter=function(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)};sr.prototype.start=function(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1};sr.prototype.end=function(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size};sr.prototype.before=function(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]};sr.prototype.after=function(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize};Ic.textOffset.get=function(){return this.pos-this.path[this.path.length-1]};Ic.nodeAfter.get=function(){var t=this.parent,e=this.index(this.depth);if(e==t.childCount)return null;var r=this.pos-this.path[this.path.length-1],o=t.child(e);return r?t.child(e).cut(r):o};Ic.nodeBefore.get=function(){var t=this.index(this.depth),e=this.pos-this.path[this.path.length-1];return e?this.parent.child(t).cut(0,e):t==0?null:this.parent.child(t-1)};sr.prototype.posAtIndex=function(e,r){r=this.resolveDepth(r);for(var o=this.path[r*3],a=r==0?0:this.path[r*3-1]+1,l=0;l<e;l++)a+=o.child(l).nodeSize;return a};sr.prototype.marks=function(){var e=this.parent,r=this.index();if(e.content.size==0)return Ct.none;if(this.textOffset)return e.child(r).marks;var o=e.maybeChild(r-1),a=e.maybeChild(r);if(!o){var l=o;o=a,a=l}for(var d=o.marks,p=0;p<d.length;p++)d[p].type.spec.inclusive===!1&&(!a||!d[p].isInSet(a.marks))&&(d=d[p--].removeFromSet(d));return d};sr.prototype.marksAcross=function(e){var r=this.parent.maybeChild(this.index());if(!r||!r.isInline)return null;for(var o=r.marks,a=e.parent.maybeChild(e.index()),l=0;l<o.length;l++)o[l].type.spec.inclusive===!1&&(!a||!o[l].isInSet(a.marks))&&(o=o[l--].removeFromSet(o));return o};sr.prototype.sharedDepth=function(e){for(var r=this.depth;r>0;r--)if(this.start(r)<=e&&this.end(r)>=e)return r;return 0};sr.prototype.blockRange=function(e,r){if(e===void 0&&(e=this),e.pos<this.pos)return e.blockRange(this);for(var o=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);o>=0;o--)if(e.pos<=this.end(o)&&(!r||r(this.node(o))))return new Ml(this,e,o)};sr.prototype.sameParent=function(e){return this.pos-this.parentOffset==e.pos-e.parentOffset};sr.prototype.max=function(e){return e.pos>this.pos?e:this};sr.prototype.min=function(e){return e.pos<this.pos?e:this};sr.prototype.toString=function(){for(var e="",r=1;r<=this.depth;r++)e+=(e?"/":"")+this.node(r).type.name+"_"+this.index(r-1);return e+":"+this.parentOffset};sr.resolve=function(e,r){if(!(r>=0&&r<=e.content.size))throw new RangeError("Position "+r+" out of range");for(var o=[],a=0,l=r,d=e;;){var p=d.content.findIndex(l),g=p.index,v=p.offset,C=l-v;if(o.push(d,g,a+v),!C||(d=d.child(g),d.isText))break;l=C-1,a+=v+1}return new sr(r,o,l)};sr.resolveCached=function(e,r){for(var o=0;o<Gf.length;o++){var a=Gf[o];if(a.pos==r&&a.doc==e)return a}var l=Gf[jf]=sr.resolve(e,r);return jf=(jf+1)%xO,l};Object.defineProperties(sr.prototype,Ic);var Gf=[],jf=0,xO=12,Ml=function(e,r,o){this.$from=e,this.$to=r,this.depth=o},Cc={start:{configurable:!0},end:{configurable:!0},parent:{configurable:!0},startIndex:{configurable:!0},endIndex:{configurable:!0}};Cc.start.get=function(){return this.$from.before(this.depth+1)};Cc.end.get=function(){return this.$to.after(this.depth+1)};Cc.parent.get=function(){return this.$from.node(this.depth)};Cc.startIndex.get=function(){return this.$from.index(this.depth)};Cc.endIndex.get=function(){return this.$to.indexAfter(this.depth)};Object.defineProperties(Ml.prototype,Cc);var QO=Object.create(null),wt=function(e,r,o,a){this.type=e,this.attrs=r,this.content=o||ee.empty,this.marks=a||Ct.none},yi={nodeSize:{configurable:!0},childCount:{configurable:!0},textContent:{configurable:!0},firstChild:{configurable:!0},lastChild:{configurable:!0},isBlock:{configurable:!0},isTextblock:{configurable:!0},inlineContent:{configurable:!0},isInline:{configurable:!0},isText:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};yi.nodeSize.get=function(){return this.isLeaf?1:2+this.content.size};yi.childCount.get=function(){return this.content.childCount};wt.prototype.child=function(e){return this.content.child(e)};wt.prototype.maybeChild=function(e){return this.content.maybeChild(e)};wt.prototype.forEach=function(e){this.content.forEach(e)};wt.prototype.nodesBetween=function(e,r,o,a){a===void 0&&(a=0),this.content.nodesBetween(e,r,o,a,this)};wt.prototype.descendants=function(e){this.nodesBetween(0,this.content.size,e)};yi.textContent.get=function(){return this.textBetween(0,this.content.size,"")};wt.prototype.textBetween=function(e,r,o,a){return this.content.textBetween(e,r,o,a)};yi.firstChild.get=function(){return this.content.firstChild};yi.lastChild.get=function(){return this.content.lastChild};wt.prototype.eq=function(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)};wt.prototype.sameMarkup=function(e){return this.hasMarkup(e.type,e.attrs,e.marks)};wt.prototype.hasMarkup=function(e,r,o){return this.type==e&&Dd(this.attrs,r||e.defaultAttrs||QO)&&Ct.sameSet(this.marks,o||Ct.none)};wt.prototype.copy=function(e){return e===void 0&&(e=null),e==this.content?this:new this.constructor(this.type,this.attrs,e,this.marks)};wt.prototype.mark=function(e){return e==this.marks?this:new this.constructor(this.type,this.attrs,this.content,e)};wt.prototype.cut=function(e,r){return e==0&&r==this.content.size?this:this.copy(this.content.cut(e,r))};wt.prototype.slice=function(e,r,o){if(r===void 0&&(r=this.content.size),o===void 0&&(o=!1),e==r)return ye.empty;var a=this.resolve(e),l=this.resolve(r),d=o?0:a.sharedDepth(r),p=a.start(d),g=a.node(d),v=g.content.cut(a.pos-p,l.pos-p);return new ye(v,a.depth-d,l.depth-d)};wt.prototype.replace=function(e,r,o){return LO(this.resolve(e),this.resolve(r),o)};wt.prototype.nodeAt=function(e){for(var r=this;;){var o=r.content.findIndex(e),a=o.index,l=o.offset;if(r=r.maybeChild(a),!r)return null;if(l==e||r.isText)return r;e-=l+1}};wt.prototype.childAfter=function(e){var r=this.content.findIndex(e),o=r.index,a=r.offset;return{node:this.content.maybeChild(o),index:o,offset:a}};wt.prototype.childBefore=function(e){if(e==0)return{node:null,index:0,offset:0};var r=this.content.findIndex(e),o=r.index,a=r.offset;if(a<e)return{node:this.content.child(o),index:o,offset:a};var l=this.content.child(o-1);return{node:l,index:o-1,offset:a-l.nodeSize}};wt.prototype.resolve=function(e){return sr.resolveCached(this,e)};wt.prototype.resolveNoCache=function(e){return sr.resolve(this,e)};wt.prototype.rangeHasMark=function(e,r,o){var a=!1;return r>e&&this.nodesBetween(e,r,function(l){return o.isInSet(l.marks)&&(a=!0),!a}),a};yi.isBlock.get=function(){return this.type.isBlock};yi.isTextblock.get=function(){return this.type.isTextblock};yi.inlineContent.get=function(){return this.type.inlineContent};yi.isInline.get=function(){return this.type.isInline};yi.isText.get=function(){return this.type.isText};yi.isLeaf.get=function(){return this.type.isLeaf};yi.isAtom.get=function(){return this.type.isAtom};wt.prototype.toString=function(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);var e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),MC(this.marks,e)};wt.prototype.contentMatchAt=function(e){var r=this.type.contentMatch.matchFragment(this.content,0,e);if(!r)throw new Error("Called contentMatchAt on a node with invalid content");return r};wt.prototype.canReplace=function(e,r,o,a,l){o===void 0&&(o=ee.empty),a===void 0&&(a=0),l===void 0&&(l=o.childCount);var d=this.contentMatchAt(e).matchFragment(o,a,l),p=d&&d.matchFragment(this.content,r);if(!p||!p.validEnd)return!1;for(var g=a;g<l;g++)if(!this.type.allowsMarks(o.child(g).marks))return!1;return!0};wt.prototype.canReplaceWith=function(e,r,o,a){if(a&&!this.type.allowsMarks(a))return!1;var l=this.contentMatchAt(e).matchType(o),d=l&&l.matchFragment(this.content,r);return d?d.validEnd:!1};wt.prototype.canAppend=function(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)};wt.prototype.check=function(){if(!this.type.validContent(this.content))throw new RangeError("Invalid content for node "+this.type.name+": "+this.content.toString().slice(0,50));for(var e=Ct.none,r=0;r<this.marks.length;r++)e=this.marks[r].addToSet(e);if(!Ct.sameSet(e,this.marks))throw new RangeError("Invalid collection of marks for node "+this.type.name+": "+this.marks.map(function(o){return o.type.name}));this.content.forEach(function(o){return o.check()})};wt.prototype.toJSON=function(){var e={type:this.type.name};for(var r in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(function(o){return o.toJSON()})),e};wt.fromJSON=function(e,r){if(!r)throw new RangeError("Invalid input for Node.fromJSON");var o=null;if(r.marks){if(!Array.isArray(r.marks))throw new RangeError("Invalid mark data for Node.fromJSON");o=r.marks.map(e.markFromJSON)}if(r.type=="text"){if(typeof r.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(r.text,o)}var a=ee.fromJSON(e,r.content);return e.nodeType(r.type).create(r.attrs,a,o)};Object.defineProperties(wt.prototype,yi);var UO=function(t){function e(o,a,l,d){if(t.call(this,o,a,null,d),!l)throw new RangeError("Empty text nodes are not allowed");this.text=l}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={textContent:{configurable:!0},nodeSize:{configurable:!0}};return e.prototype.toString=function(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):MC(this.marks,JSON.stringify(this.text))},r.textContent.get=function(){return this.text},e.prototype.textBetween=function(a,l){return this.text.slice(a,l)},r.nodeSize.get=function(){return this.text.length},e.prototype.mark=function(a){return a==this.marks?this:new e(this.type,this.attrs,this.text,a)},e.prototype.withText=function(a){return a==this.text?this:new e(this.type,this.attrs,a,this.marks)},e.prototype.cut=function(a,l){return a===void 0&&(a=0),l===void 0&&(l=this.text.length),a==0&&l==this.text.length?this:this.withText(this.text.slice(a,l))},e.prototype.eq=function(a){return this.sameMarkup(a)&&this.text==a.text},e.prototype.toJSON=function(){var a=t.prototype.toJSON.call(this);return a.text=this.text,a},Object.defineProperties(e.prototype,r),e}(wt);function MC(t,e){for(var r=t.length-1;r>=0;r--)e=t[r].type.name+"("+e+")";return e}var bn=function(e){this.validEnd=e,this.next=[],this.wrapCache=[]},Md={inlineContent:{configurable:!0},defaultType:{configurable:!0},edgeCount:{configurable:!0}};bn.parse=function(e,r){var o=new Ld(e,r);if(o.next==null)return bn.empty;var a=PC(o);o.next&&o.err("Unexpected trailing text");var l=WO(KO(a));return YO(l,o),l};bn.prototype.matchType=function(e){for(var r=0;r<this.next.length;r+=2)if(this.next[r]==e)return this.next[r+1];return null};bn.prototype.matchFragment=function(e,r,o){r===void 0&&(r=0),o===void 0&&(o=e.childCount);for(var a=this,l=r;a&&l<o;l++)a=a.matchType(e.child(l).type);return a};Md.inlineContent.get=function(){var t=this.next[0];return t?t.isInline:!1};Md.defaultType.get=function(){for(var t=0;t<this.next.length;t+=2){var e=this.next[t];if(!(e.isText||e.hasRequiredAttrs()))return e}};bn.prototype.compatible=function(e){for(var r=0;r<this.next.length;r+=2)for(var o=0;o<e.next.length;o+=2)if(this.next[r]==e.next[o])return!0;return!1};bn.prototype.fillBefore=function(e,r,o){r===void 0&&(r=!1),o===void 0&&(o=0);var a=[this];function l(d,p){var g=d.matchFragment(e,o);if(g&&(!r||g.validEnd))return ee.from(p.map(function(k){return k.createAndFill()}));for(var v=0;v<d.next.length;v+=2){var C=d.next[v],y=d.next[v+1];if(!(C.isText||C.hasRequiredAttrs())&&a.indexOf(y)==-1){a.push(y);var w=l(y,p.concat(C));if(w)return w}}}return l(this,[])};bn.prototype.findWrapping=function(e){for(var r=0;r<this.wrapCache.length;r+=2)if(this.wrapCache[r]==e)return this.wrapCache[r+1];var o=this.computeWrapping(e);return this.wrapCache.push(e,o),o};bn.prototype.computeWrapping=function(e){for(var r=Object.create(null),o=[{match:this,type:null,via:null}];o.length;){var a=o.shift(),l=a.match;if(l.matchType(e)){for(var d=[],p=a;p.type;p=p.via)d.push(p.type);return d.reverse()}for(var g=0;g<l.next.length;g+=2){var v=l.next[g];!v.isLeaf&&!v.hasRequiredAttrs()&&!(v.name in r)&&(!a.type||l.next[g+1].validEnd)&&(o.push({match:v.contentMatch,type:v,via:a}),r[v.name]=!0)}}};Md.edgeCount.get=function(){return this.next.length>>1};bn.prototype.edge=function(e){var r=e<<1;if(r>=this.next.length)throw new RangeError("There's no "+e+"th edge in this content match");return{type:this.next[r],next:this.next[r+1]}};bn.prototype.toString=function(){var e=[];function r(o){e.push(o);for(var a=1;a<o.next.length;a+=2)e.indexOf(o.next[a])==-1&&r(o.next[a])}return r(this),e.map(function(o,a){for(var l=a+(o.validEnd?"*":" ")+" ",d=0;d<o.next.length;d+=2)l+=(d?", ":"")+o.next[d].name+"->"+e.indexOf(o.next[d+1]);return l}).join(`
`)};Object.defineProperties(bn.prototype,Md);bn.empty=new bn(!0);var Ld=function(e,r){this.string=e,this.nodeTypes=r,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()},LC={next:{configurable:!0}};LC.next.get=function(){return this.tokens[this.pos]};Ld.prototype.eat=function(e){return this.next==e&&(this.pos++||!0)};Ld.prototype.err=function(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")};Object.defineProperties(Ld.prototype,LC);function PC(t){var e=[];do e.push(FO(t));while(t.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function FO(t){var e=[];do e.push(VO(t));while(t.next&&t.next!=")"&&t.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function VO(t){for(var e=HO(t);;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else if(t.eat("{"))e=GO(t,e);else break;return e}function xC(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");var e=Number(t.next);return t.pos++,e}function GO(t,e){var r=xC(t),o=r;return t.eat(",")&&(t.next!="}"?o=xC(t):o=-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:r,max:o,expr:e}}function jO(t,e){var r=t.nodeTypes,o=r[e];if(o)return[o];var a=[];for(var l in r){var d=r[l];d.groups.indexOf(e)>-1&&a.push(d)}return a.length==0&&t.err("No node type or group '"+e+"' found"),a}function HO(t){if(t.eat("(")){var e=PC(t);return t.eat(")")||t.err("Missing closing paren"),e}else if(/\W/.test(t.next))t.err("Unexpected token '"+t.next+"'");else{var r=jO(t,t.next).map(function(o){return t.inline==null?t.inline=o.isInline:t.inline!=o.isInline&&t.err("Mixing inline and block content"),{type:"name",value:o}});return t.pos++,r.length==1?r[0]:{type:"choice",exprs:r}}}function KO(t){var e=[[]];return a(l(t,0),r()),e;function r(){return e.push([])-1}function o(d,p,g){var v={term:g,to:p};return e[d].push(v),v}function a(d,p){d.forEach(function(g){return g.to=p})}function l(d,p){if(d.type=="choice")return d.exprs.reduce(function(Y,H){return Y.concat(l(H,p))},[]);if(d.type=="seq")for(var g=0;;g++){var v=l(d.exprs[g],p);if(g==d.exprs.length-1)return v;a(v,p=r())}else if(d.type=="star"){var C=r();return o(p,C),a(l(d.expr,C),C),[o(C)]}else if(d.type=="plus"){var y=r();return a(l(d.expr,p),y),a(l(d.expr,y),y),[o(y)]}else{if(d.type=="opt")return[o(p)].concat(l(d.expr,p));if(d.type=="range"){for(var w=p,k=0;k<d.min;k++){var M=r();a(l(d.expr,w),M),w=M}if(d.max==-1)a(l(d.expr,w),w);else for(var x=d.min;x<d.max;x++){var V=r();o(w,V),a(l(d.expr,w),V),w=V}return[o(w)]}else if(d.type=="name")return[o(p,null,d.value)]}}}function QC(t,e){return e-t}function UC(t,e){var r=[];return o(e),r.sort(QC);function o(a){var l=t[a];if(l.length==1&&!l[0].term)return o(l[0].to);r.push(a);for(var d=0;d<l.length;d++){var p=l[d],g=p.term,v=p.to;!g&&r.indexOf(v)==-1&&o(v)}}}function WO(t){var e=Object.create(null);return r(UC(t,0));function r(o){var a=[];o.forEach(function(g){t[g].forEach(function(v){var C=v.term,y=v.to;if(!!C){var w=a.indexOf(C),k=w>-1&&a[w+1];UC(t,y).forEach(function(M){k||a.push(C,k=[]),k.indexOf(M)==-1&&k.push(M)})}})});for(var l=e[o.join(",")]=new bn(o.indexOf(t.length-1)>-1),d=0;d<a.length;d+=2){var p=a[d+1].sort(QC);l.next.push(a[d],e[p.join(",")]||r(p))}return l}}function YO(t,e){for(var r=0,o=[t];r<o.length;r++){for(var a=o[r],l=!a.validEnd,d=[],p=0;p<a.next.length;p+=2){var g=a.next[p],v=a.next[p+1];d.push(g.name),l&&!(g.isText||g.hasRequiredAttrs())&&(l=!1),o.indexOf(v)==-1&&o.push(v)}l&&e.err("Only non-generatable nodes ("+d.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function FC(t){var e=Object.create(null);for(var r in t){var o=t[r];if(!o.hasDefault)return null;e[r]=o.default}return e}function VC(t,e){var r=Object.create(null);for(var o in t){var a=e&&e[o];if(a===void 0){var l=t[o];if(l.hasDefault)a=l.default;else throw new RangeError("No value supplied for attribute "+o)}r[o]=a}return r}function GC(t){var e=Object.create(null);if(t)for(var r in t)e[r]=new jC(t[r]);return e}var Kn=function(e,r,o){this.name=e,this.schema=r,this.spec=o,this.groups=o.group?o.group.split(" "):[],this.attrs=GC(o.attrs),this.defaultAttrs=FC(this.attrs),this.contentMatch=null,this.markSet=null,this.inlineContent=null,this.isBlock=!(o.inline||e=="text"),this.isText=e=="text"},Ll={isInline:{configurable:!0},isTextblock:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};Ll.isInline.get=function(){return!this.isBlock};Ll.isTextblock.get=function(){return this.isBlock&&this.inlineContent};Ll.isLeaf.get=function(){return this.contentMatch==bn.empty};Ll.isAtom.get=function(){return this.isLeaf||this.spec.atom};Kn.prototype.hasRequiredAttrs=function(){for(var e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1};Kn.prototype.compatibleContent=function(e){return this==e||this.contentMatch.compatible(e.contentMatch)};Kn.prototype.computeAttrs=function(e){return!e&&this.defaultAttrs?this.defaultAttrs:VC(this.attrs,e)};Kn.prototype.create=function(e,r,o){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new wt(this,this.computeAttrs(e),ee.from(r),Ct.setFrom(o))};Kn.prototype.createChecked=function(e,r,o){if(r=ee.from(r),!this.validContent(r))throw new RangeError("Invalid content for node "+this.name);return new wt(this,this.computeAttrs(e),r,Ct.setFrom(o))};Kn.prototype.createAndFill=function(e,r,o){if(e=this.computeAttrs(e),r=ee.from(r),r.size){var a=this.contentMatch.fillBefore(r);if(!a)return null;r=a.append(r)}var l=this.contentMatch.matchFragment(r).fillBefore(ee.empty,!0);return l?new wt(this,e,r.append(l),Ct.setFrom(o)):null};Kn.prototype.validContent=function(e){var r=this.contentMatch.matchFragment(e);if(!r||!r.validEnd)return!1;for(var o=0;o<e.childCount;o++)if(!this.allowsMarks(e.child(o).marks))return!1;return!0};Kn.prototype.allowsMarkType=function(e){return this.markSet==null||this.markSet.indexOf(e)>-1};Kn.prototype.allowsMarks=function(e){if(this.markSet==null)return!0;for(var r=0;r<e.length;r++)if(!this.allowsMarkType(e[r].type))return!1;return!0};Kn.prototype.allowedMarks=function(e){if(this.markSet==null)return e;for(var r,o=0;o<e.length;o++)this.allowsMarkType(e[o].type)?r&&r.push(e[o]):r||(r=e.slice(0,o));return r?r.length?r:Ct.empty:e};Kn.compile=function(e,r){var o=Object.create(null);e.forEach(function(d,p){return o[d]=new Kn(d,r,p)});var a=r.spec.topNode||"doc";if(!o[a])throw new RangeError("Schema is missing its top node type ('"+a+"')");if(!o.text)throw new RangeError("Every schema needs a 'text' type");for(var l in o.text.attrs)throw new RangeError("The text node type should not have attributes");return o};Object.defineProperties(Kn.prototype,Ll);var jC=function(e){this.hasDefault=Object.prototype.hasOwnProperty.call(e,"default"),this.default=e.default},HC={isRequired:{configurable:!0}};HC.isRequired.get=function(){return!this.hasDefault};Object.defineProperties(jC.prototype,HC);var Rs=function(e,r,o,a){this.name=e,this.schema=o,this.spec=a,this.attrs=GC(a.attrs),this.rank=r,this.excluded=null;var l=FC(this.attrs);this.instance=l&&new Ct(this,l)};Rs.prototype.create=function(e){return!e&&this.instance?this.instance:new Ct(this,VC(this.attrs,e))};Rs.compile=function(e,r){var o=Object.create(null),a=0;return e.forEach(function(l,d){return o[l]=new Rs(l,a++,r,d)}),o};Rs.prototype.removeFromSet=function(e){for(var r=0;r<e.length;r++)e[r].type==this&&(e=e.slice(0,r).concat(e.slice(r+1)),r--);return e};Rs.prototype.isInSet=function(e){for(var r=0;r<e.length;r++)if(e[r].type==this)return e[r]};Rs.prototype.excludes=function(e){return this.excluded.indexOf(e)>-1};var Ea=function(e){this.spec={};for(var r in e)this.spec[r]=e[r];this.spec.nodes=TC.from(e.nodes),this.spec.marks=TC.from(e.marks),this.nodes=Kn.compile(this.spec.nodes,this),this.marks=Rs.compile(this.spec.marks,this);var o=Object.create(null);for(var a in this.nodes){if(a in this.marks)throw new RangeError(a+" can not be both a node and a mark");var l=this.nodes[a],d=l.spec.content||"",p=l.spec.marks;l.contentMatch=o[d]||(o[d]=bn.parse(d,this.nodes)),l.inlineContent=l.contentMatch.inlineContent,l.markSet=p=="_"?null:p?KC(this,p.split(" ")):p==""||!l.inlineContent?[]:null}for(var g in this.marks){var v=this.marks[g],C=v.spec.excludes;v.excluded=C==null?[v]:C==""?[]:KC(this,C.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached=Object.create(null),this.cached.wrappings=Object.create(null)};Ea.prototype.node=function(e,r,o,a){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof Kn){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(r,o,a)};Ea.prototype.text=function(e,r){var o=this.nodes.text;return new UO(o,o.defaultAttrs,e,Ct.setFrom(r))};Ea.prototype.mark=function(e,r){return typeof e=="string"&&(e=this.marks[e]),e.create(r)};Ea.prototype.nodeFromJSON=function(e){return wt.fromJSON(this,e)};Ea.prototype.markFromJSON=function(e){return Ct.fromJSON(this,e)};Ea.prototype.nodeType=function(e){var r=this.nodes[e];if(!r)throw new RangeError("Unknown node type: "+e);return r};function KC(t,e){for(var r=[],o=0;o<e.length;o++){var a=e[o],l=t.marks[a],d=l;if(l)r.push(l);else for(var p in t.marks){var g=t.marks[p];(a=="_"||g.spec.group&&g.spec.group.split(" ").indexOf(a)>-1)&&r.push(d=g)}if(!d)throw new SyntaxError("Unknown mark type: '"+e[o]+"'")}return r}var lo=function(e,r){var o=this;this.schema=e,this.rules=r,this.tags=[],this.styles=[],r.forEach(function(a){a.tag?o.tags.push(a):a.style&&o.styles.push(a)}),this.normalizeLists=!this.tags.some(function(a){if(!/^(ul|ol)\b/.test(a.tag)||!a.node)return!1;var l=e.nodes[a.node];return l.contentMatch.matchType(l)})};lo.prototype.parse=function(e,r){r===void 0&&(r={});var o=new tr(this,r,!1);return o.addAll(e,null,r.from,r.to),o.finish()};lo.prototype.parseSlice=function(e,r){r===void 0&&(r={});var o=new tr(this,r,!0);return o.addAll(e,null,r.from,r.to),ye.maxOpen(o.finish())};lo.prototype.matchTag=function(e,r,o){for(var a=o?this.tags.indexOf(o)+1:0;a<this.tags.length;a++){var l=this.tags[a];if(zO(e,l.tag)&&(l.namespace===void 0||e.namespaceURI==l.namespace)&&(!l.context||r.matchesContext(l.context))){if(l.getAttrs){var d=l.getAttrs(e);if(d===!1)continue;l.attrs=d}return l}}};lo.prototype.matchStyle=function(e,r,o,a){for(var l=a?this.styles.indexOf(a)+1:0;l<this.styles.length;l++){var d=this.styles[l];if(!(d.style.indexOf(e)!=0||d.context&&!o.matchesContext(d.context)||d.style.length>e.length&&(d.style.charCodeAt(e.length)!=61||d.style.slice(e.length+1)!=r))){if(d.getAttrs){var p=d.getAttrs(r);if(p===!1)continue;d.attrs=p}return d}}};lo.schemaRules=function(e){var r=[];function o(g){for(var v=g.priority==null?50:g.priority,C=0;C<r.length;C++){var y=r[C],w=y.priority==null?50:y.priority;if(w<v)break}r.splice(C,0,g)}var a=function(g){var v=e.marks[g].spec.parseDOM;v&&v.forEach(function(C){o(C=qC(C)),C.mark=g})};for(var l in e.marks)a(l);var d=function(g){var v=e.nodes[p].spec.parseDOM;v&&v.forEach(function(C){o(C=qC(C)),C.node=p})};for(var p in e.nodes)d();return r};lo.fromSchema=function(e){return e.cached.domParser||(e.cached.domParser=new lo(e,lo.schemaRules(e)))};var Hf={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},qO={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},WC={ol:!0,ul:!0},Kf=1,Wf=2,Pl=4;function YC(t){return(t?Kf:0)|(t==="full"?Wf:0)}var ns=function(e,r,o,a,l,d,p){this.type=e,this.attrs=r,this.solid=l,this.match=d||(p&Pl?null:e.contentMatch),this.options=p,this.content=[],this.marks=o,this.activeMarks=Ct.none,this.pendingMarks=a,this.stashMarks=[]};ns.prototype.findWrapping=function(e){if(!this.match){if(!this.type)return[];var r=this.type.contentMatch.fillBefore(ee.from(e));if(r)this.match=this.type.contentMatch.matchFragment(r);else{var o=this.type.contentMatch,a;return(a=o.findWrapping(e.type))?(this.match=o,a):null}}return this.match.findWrapping(e.type)};ns.prototype.finish=function(e){if(!(this.options&Kf)){var r=this.content[this.content.length-1],o;r&&r.isText&&(o=/[ \t\r\n\u000c]+$/.exec(r.text))&&(r.text.length==o[0].length?this.content.pop():this.content[this.content.length-1]=r.withText(r.text.slice(0,r.text.length-o[0].length)))}var a=ee.from(this.content);return!e&&this.match&&(a=a.append(this.match.fillBefore(ee.empty,!0))),this.type?this.type.create(this.attrs,a,this.marks):a};ns.prototype.popFromStashMark=function(e){for(var r=this.stashMarks.length-1;r>=0;r--)if(e.eq(this.stashMarks[r]))return this.stashMarks.splice(r,1)[0]};ns.prototype.applyPending=function(e){for(var r=0,o=this.pendingMarks;r<o.length;r++){var a=o[r];(this.type?this.type.allowsMarkType(a.type):$O(a.type,e))&&!a.isInSet(this.activeMarks)&&(this.activeMarks=a.addToSet(this.activeMarks),this.pendingMarks=a.removeFromSet(this.pendingMarks))}};ns.prototype.inlineContext=function(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!Hf.hasOwnProperty(e.parentNode.nodeName.toLowerCase())};var tr=function(e,r,o){this.parser=e,this.options=r,this.isOpen=o;var a=r.topNode,l,d=YC(r.preserveWhitespace)|(o?Pl:0);a?l=new ns(a.type,a.attrs,Ct.none,Ct.none,!0,r.topMatch||a.type.contentMatch,d):o?l=new ns(null,null,Ct.none,Ct.none,!0,null,d):l=new ns(e.schema.topNodeType,null,Ct.none,Ct.none,!0,null,d),this.nodes=[l],this.open=0,this.find=r.findPositions,this.needsBlock=!1},Yf={top:{configurable:!0},currentPos:{configurable:!0}};Yf.top.get=function(){return this.nodes[this.open]};tr.prototype.addDOM=function(e){if(e.nodeType==3)this.addTextNode(e);else if(e.nodeType==1){var r=e.getAttribute("style"),o=r?this.readStyles(XO(r)):null,a=this.top;if(o!=null)for(var l=0;l<o.length;l++)this.addPendingMark(o[l]);if(this.addElement(e),o!=null)for(var d=0;d<o.length;d++)this.removePendingMark(o[d],a)}};tr.prototype.addTextNode=function(e){var r=e.nodeValue,o=this.top;if(o.options&Wf||o.inlineContext(e)||/[^ \t\r\n\u000c]/.test(r)){if(o.options&Kf)o.options&Wf?r=r.replace(/\r\n?/g,`
`):r=r.replace(/\r?\n|\r/g," ");else if(r=r.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(r)&&this.open==this.nodes.length-1){var a=o.content[o.content.length-1],l=e.previousSibling;(!a||l&&l.nodeName=="BR"||a.isText&&/[ \t\r\n\u000c]$/.test(a.text))&&(r=r.slice(1))}r&&this.insertNode(this.parser.schema.text(r)),this.findInText(e)}else this.findInside(e)};tr.prototype.addElement=function(e,r){var o=e.nodeName.toLowerCase(),a;WC.hasOwnProperty(o)&&this.parser.normalizeLists&&JO(e);var l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(a=this.parser.matchTag(e,this,r));if(l?l.ignore:qO.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);var d,p=this.top,g=this.needsBlock;if(Hf.hasOwnProperty(o))d=!0,p.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e);return}this.addAll(e),d&&this.sync(p),this.needsBlock=g}else this.addElementByRule(e,l,l.consuming===!1?a:null)};tr.prototype.leafFallback=function(e){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`))};tr.prototype.ignoreFallback=function(e){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"))};tr.prototype.readStyles=function(e){var r=Ct.none;e:for(var o=0;o<e.length;o+=2)for(var a=null;;){var l=this.parser.matchStyle(e[o],e[o+1],this,a);if(!l)continue e;if(l.ignore)return null;if(r=this.parser.schema.marks[l.mark].create(l.attrs).addToSet(r),l.consuming===!1)a=l;else break}return r};tr.prototype.addElementByRule=function(e,r,o){var a=this,l,d,p,g;r.node?(d=this.parser.schema.nodes[r.node],d.isLeaf?this.insertNode(d.create(r.attrs))||this.leafFallback(e):l=this.enter(d,r.attrs,r.preserveWhitespace)):(p=this.parser.schema.marks[r.mark],g=p.create(r.attrs),this.addPendingMark(g));var v=this.top;if(d&&d.isLeaf)this.findInside(e);else if(o)this.addElement(e,o);else if(r.getContent)this.findInside(e),r.getContent(e,this.parser.schema).forEach(function(y){return a.insertNode(y)});else{var C=r.contentElement;typeof C=="string"?C=e.querySelector(C):typeof C=="function"&&(C=C(e)),C||(C=e),this.findAround(e,C,!0),this.addAll(C,l)}l&&(this.sync(v),this.open--),g&&this.removePendingMark(g,v)};tr.prototype.addAll=function(e,r,o,a){for(var l=o||0,d=o?e.childNodes[o]:e.firstChild,p=a==null?null:e.childNodes[a];d!=p;d=d.nextSibling,++l)this.findAtPoint(e,l),this.addDOM(d),r&&Hf.hasOwnProperty(d.nodeName.toLowerCase())&&this.sync(r);this.findAtPoint(e,l)};tr.prototype.findPlace=function(e){for(var r,o,a=this.open;a>=0;a--){var l=this.nodes[a],d=l.findWrapping(e);if(d&&(!r||r.length>d.length)&&(r=d,o=l,!d.length)||l.solid)break}if(!r)return!1;this.sync(o);for(var p=0;p<r.length;p++)this.enterInner(r[p],null,!1);return!0};tr.prototype.insertNode=function(e){if(e.isInline&&this.needsBlock&&!this.top.type){var r=this.textblockFromContext();r&&this.enterInner(r)}if(this.findPlace(e)){this.closeExtra();var o=this.top;o.applyPending(e.type),o.match&&(o.match=o.match.matchType(e.type));for(var a=o.activeMarks,l=0;l<e.marks.length;l++)(!o.type||o.type.allowsMarkType(e.marks[l].type))&&(a=e.marks[l].addToSet(a));return o.content.push(e.mark(a)),!0}return!1};tr.prototype.enter=function(e,r,o){var a=this.findPlace(e.create(r));return a&&this.enterInner(e,r,!0,o),a};tr.prototype.enterInner=function(e,r,o,a){this.closeExtra();var l=this.top;l.applyPending(e),l.match=l.match&&l.match.matchType(e,r);var d=a==null?l.options&~Pl:YC(a);l.options&Pl&&l.content.length==0&&(d|=Pl),this.nodes.push(new ns(e,r,l.activeMarks,l.pendingMarks,o,null,d)),this.open++};tr.prototype.closeExtra=function(e){var r=this.nodes.length-1;if(r>this.open){for(;r>this.open;r--)this.nodes[r-1].content.push(this.nodes[r].finish(e));this.nodes.length=this.open+1}};tr.prototype.finish=function(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)};tr.prototype.sync=function(e){for(var r=this.open;r>=0;r--)if(this.nodes[r]==e){this.open=r;return}};Yf.currentPos.get=function(){this.closeExtra();for(var t=0,e=this.open;e>=0;e--){for(var r=this.nodes[e].content,o=r.length-1;o>=0;o--)t+=r[o].nodeSize;e&&t++}return t};tr.prototype.findAtPoint=function(e,r){if(this.find)for(var o=0;o<this.find.length;o++)this.find[o].node==e&&this.find[o].offset==r&&(this.find[o].pos=this.currentPos)};tr.prototype.findInside=function(e){if(this.find)for(var r=0;r<this.find.length;r++)this.find[r].pos==null&&e.nodeType==1&&e.contains(this.find[r].node)&&(this.find[r].pos=this.currentPos)};tr.prototype.findAround=function(e,r,o){if(e!=r&&this.find){for(var a=0;a<this.find.length;a++)if(this.find[a].pos==null&&e.nodeType==1&&e.contains(this.find[a].node)){var l=r.compareDocumentPosition(this.find[a].node);l&(o?2:4)&&(this.find[a].pos=this.currentPos)}}};tr.prototype.findInText=function(e){if(this.find)for(var r=0;r<this.find.length;r++)this.find[r].node==e&&(this.find[r].pos=this.currentPos-(e.nodeValue.length-this.find[r].offset))};tr.prototype.matchesContext=function(e){var r=this;if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);var o=e.split("/"),a=this.options.context,l=!this.isOpen&&(!a||a.parent.type==this.nodes[0].type),d=-(a?a.depth+1:0)+(l?0:1),p=function(g,v){for(;g>=0;g--){var C=o[g];if(C==""){if(g==o.length-1||g==0)continue;for(;v>=d;v--)if(p(g-1,v))return!0;return!1}else{var y=v>0||v==0&&l?r.nodes[v].type:a&&v>=d?a.node(v-d).type:null;if(!y||y.name!=C&&y.groups.indexOf(C)==-1)return!1;v--}}return!0};return p(o.length-1,this.open)};tr.prototype.textblockFromContext=function(){var e=this.options.context;if(e)for(var r=e.depth;r>=0;r--){var o=e.node(r).contentMatchAt(e.indexAfter(r)).defaultType;if(o&&o.isTextblock&&o.defaultAttrs)return o}for(var a in this.parser.schema.nodes){var l=this.parser.schema.nodes[a];if(l.isTextblock&&l.defaultAttrs)return l}};tr.prototype.addPendingMark=function(e){var r=ZO(e,this.top.pendingMarks);r&&this.top.stashMarks.push(r),this.top.pendingMarks=e.addToSet(this.top.pendingMarks)};tr.prototype.removePendingMark=function(e,r){for(var o=this.open;o>=0;o--){var a=this.nodes[o],l=a.pendingMarks.lastIndexOf(e);if(l>-1)a.pendingMarks=e.removeFromSet(a.pendingMarks);else{a.activeMarks=e.removeFromSet(a.activeMarks);var d=a.popFromStashMark(e);d&&a.type&&a.type.allowsMarkType(d.type)&&(a.activeMarks=d.addToSet(a.activeMarks))}if(a==r)break}};Object.defineProperties(tr.prototype,Yf);function JO(t){for(var e=t.firstChild,r=null;e;e=e.nextSibling){var o=e.nodeType==1?e.nodeName.toLowerCase():null;o&&WC.hasOwnProperty(o)&&r?(r.appendChild(e),e=r):o=="li"?r=e:o&&(r=null)}}function zO(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function XO(t){for(var e=/\s*([\w-]+)\s*:\s*([^;]+)/g,r,o=[];r=e.exec(t);)o.push(r[1],r[2].trim());return o}function qC(t){var e={};for(var r in t)e[r]=t[r];return e}function $O(t,e){var r=e.schema.nodes,o=function(d){var p=r[d];if(!!p.allowsMarkType(t)){var g=[],v=function(C){g.push(C);for(var y=0;y<C.edgeCount;y++){var w=C.edge(y),k=w.type,M=w.next;if(k==e||g.indexOf(M)<0&&v(M))return!0}};if(v(p.contentMatch))return{v:!0}}};for(var a in r){var l=o(a);if(l)return l.v}}function ZO(t,e){for(var r=0;r<e.length;r++)if(t.eq(e[r]))return e[r]}var pn=function(e,r){this.nodes=e||{},this.marks=r||{}};pn.prototype.serializeFragment=function(e,r,o){var a=this;r===void 0&&(r={}),o||(o=qf(r).createDocumentFragment());var l=o,d=null;return e.forEach(function(p){if(d||p.marks.length){d||(d=[]);for(var g=0,v=0;g<d.length&&v<p.marks.length;){var C=p.marks[v];if(!a.marks[C.type.name]){v++;continue}if(!C.eq(d[g])||C.type.spec.spanning===!1)break;g+=2,v++}for(;g<d.length;)l=d.pop(),d.pop();for(;v<p.marks.length;){var y=p.marks[v++],w=a.serializeMark(y,p.isInline,r);w&&(d.push(y,l),l.appendChild(w.dom),l=w.contentDOM||w.dom)}}l.appendChild(a.serializeNodeInner(p,r))}),o};pn.prototype.serializeNodeInner=function(e,r){r===void 0&&(r={});var o=pn.renderSpec(qf(r),this.nodes[e.type.name](e)),a=o.dom,l=o.contentDOM;if(l){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");r.onContent?r.onContent(e,l,r):this.serializeFragment(e.content,r,l)}return a};pn.prototype.serializeNode=function(e,r){r===void 0&&(r={});for(var o=this.serializeNodeInner(e,r),a=e.marks.length-1;a>=0;a--){var l=this.serializeMark(e.marks[a],e.isInline,r);l&&((l.contentDOM||l.dom).appendChild(o),o=l.dom)}return o};pn.prototype.serializeMark=function(e,r,o){o===void 0&&(o={});var a=this.marks[e.type.name];return a&&pn.renderSpec(qf(o),a(e,r))};pn.renderSpec=function(e,r,o){if(o===void 0&&(o=null),typeof r=="string")return{dom:e.createTextNode(r)};if(r.nodeType!=null)return{dom:r};if(r.dom&&r.dom.nodeType!=null)return r;var a=r[0],l=a.indexOf(" ");l>0&&(o=a.slice(0,l),a=a.slice(l+1));var d=null,p=o?e.createElementNS(o,a):e.createElement(a),g=r[1],v=1;if(g&&typeof g=="object"&&g.nodeType==null&&!Array.isArray(g)){v=2;for(var C in g)if(g[C]!=null){var y=C.indexOf(" ");y>0?p.setAttributeNS(C.slice(0,y),C.slice(y+1),g[C]):p.setAttribute(C,g[C])}}for(var w=v;w<r.length;w++){var k=r[w];if(k===0){if(w<r.length-1||w>v)throw new RangeError("Content hole must be the only child of its parent node");return{dom:p,contentDOM:p}}else{var M=pn.renderSpec(e,k,o),x=M.dom,V=M.contentDOM;if(p.appendChild(x),V){if(d)throw new RangeError("Multiple content holes");d=V}}}return{dom:p,contentDOM:d}};pn.fromSchema=function(e){return e.cached.domSerializer||(e.cached.domSerializer=new pn(this.nodesFromSchema(e),this.marksFromSchema(e)))};pn.nodesFromSchema=function(e){var r=JC(e.nodes);return r.text||(r.text=function(o){return o.text}),r};pn.marksFromSchema=function(e){return JC(e.marks)};function JC(t){var e={};for(var r in t){var o=t[r].spec.toDOM;o&&(e[r]=o)}return e}function qf(t){return t.document||window.document}var zC=65535,XC=Math.pow(2,16);function ek(t,e){return t+e*XC}function $C(t){return t&zC}function tk(t){return(t-(t&zC))/XC}var Jf=function(e,r,o){r===void 0&&(r=!1),o===void 0&&(o=null),this.pos=e,this.deleted=r,this.recover=o},fn=function(e,r){r===void 0&&(r=!1),this.ranges=e,this.inverted=r};fn.prototype.recover=function(e){var r=0,o=$C(e);if(!this.inverted)for(var a=0;a<o;a++)r+=this.ranges[a*3+2]-this.ranges[a*3+1];return this.ranges[o*3]+r+tk(e)};fn.prototype.mapResult=function(e,r){return r===void 0&&(r=1),this._map(e,r,!1)};fn.prototype.map=function(e,r){return r===void 0&&(r=1),this._map(e,r,!0)};fn.prototype._map=function(e,r,o){for(var a=0,l=this.inverted?2:1,d=this.inverted?1:2,p=0;p<this.ranges.length;p+=3){var g=this.ranges[p]-(this.inverted?a:0);if(g>e)break;var v=this.ranges[p+l],C=this.ranges[p+d],y=g+v;if(e<=y){var w=v?e==g?-1:e==y?1:r:r,k=g+a+(w<0?0:C);if(o)return k;var M=e==(r<0?g:y)?null:ek(p/3,e-g);return new Jf(k,r<0?e!=g:e!=y,M)}a+=C-v}return o?e+a:new Jf(e+a)};fn.prototype.touches=function(e,r){for(var o=0,a=$C(r),l=this.inverted?2:1,d=this.inverted?1:2,p=0;p<this.ranges.length;p+=3){var g=this.ranges[p]-(this.inverted?o:0);if(g>e)break;var v=this.ranges[p+l],C=g+v;if(e<=C&&p==a*3)return!0;o+=this.ranges[p+d]-v}return!1};fn.prototype.forEach=function(e){for(var r=this.inverted?2:1,o=this.inverted?1:2,a=0,l=0;a<this.ranges.length;a+=3){var d=this.ranges[a],p=d-(this.inverted?l:0),g=d+(this.inverted?0:l),v=this.ranges[a+r],C=this.ranges[a+o];e(p,p+v,g,g+C),l+=C-v}};fn.prototype.invert=function(){return new fn(this.ranges,!this.inverted)};fn.prototype.toString=function(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)};fn.offset=function(e){return e==0?fn.empty:new fn(e<0?[0,-e,0]:[0,0,e])};fn.empty=new fn([]);var Dn=function(e,r,o,a){this.maps=e||[],this.from=o||0,this.to=a==null?this.maps.length:a,this.mirror=r};Dn.prototype.slice=function(e,r){return e===void 0&&(e=0),r===void 0&&(r=this.maps.length),new Dn(this.maps,this.mirror,e,r)};Dn.prototype.copy=function(){return new Dn(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)};Dn.prototype.appendMap=function(e,r){this.to=this.maps.push(e),r!=null&&this.setMirror(this.maps.length-1,r)};Dn.prototype.appendMapping=function(e){for(var r=0,o=this.maps.length;r<e.maps.length;r++){var a=e.getMirror(r);this.appendMap(e.maps[r],a!=null&&a<r?o+a:null)}};Dn.prototype.getMirror=function(e){if(this.mirror){for(var r=0;r<this.mirror.length;r++)if(this.mirror[r]==e)return this.mirror[r+(r%2?-1:1)]}};Dn.prototype.setMirror=function(e,r){this.mirror||(this.mirror=[]),this.mirror.push(e,r)};Dn.prototype.appendMappingInverted=function(e){for(var r=e.maps.length-1,o=this.maps.length+e.maps.length;r>=0;r--){var a=e.getMirror(r);this.appendMap(e.maps[r].invert(),a!=null&&a>r?o-a-1:null)}};Dn.prototype.invert=function(){var e=new Dn;return e.appendMappingInverted(this),e};Dn.prototype.map=function(e,r){if(r===void 0&&(r=1),this.mirror)return this._map(e,r,!0);for(var o=this.from;o<this.to;o++)e=this.maps[o].map(e,r);return e};Dn.prototype.mapResult=function(e,r){return r===void 0&&(r=1),this._map(e,r,!1)};Dn.prototype._map=function(e,r,o){for(var a=!1,l=this.from;l<this.to;l++){var d=this.maps[l],p=d.mapResult(e,r);if(p.recover!=null){var g=this.getMirror(l);if(g!=null&&g>l&&g<this.to){l=g,e=this.maps[g].recover(p.recover);continue}}p.deleted&&(a=!0),e=p.pos}return o?e:new Jf(e,a)};function yc(t){var e=Error.call(this,t);return e.__proto__=yc.prototype,e}yc.prototype=Object.create(Error.prototype);yc.prototype.constructor=yc;yc.prototype.name="TransformError";var wr=function(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new Dn},zf={before:{configurable:!0},docChanged:{configurable:!0}};zf.before.get=function(){return this.docs.length?this.docs[0]:this.doc};wr.prototype.step=function(e){var r=this.maybeStep(e);if(r.failed)throw new yc(r.failed);return this};wr.prototype.maybeStep=function(e){var r=e.apply(this.doc);return r.failed||this.addStep(e,r.doc),r};zf.docChanged.get=function(){return this.steps.length>0};wr.prototype.addStep=function(e,r){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=r};Object.defineProperties(wr.prototype,zf);function Pd(){throw new Error("Override me")}var Xf=Object.create(null),Bn=function(){};Bn.prototype.apply=function(e){return Pd()};Bn.prototype.getMap=function(){return fn.empty};Bn.prototype.invert=function(e){return Pd()};Bn.prototype.map=function(e){return Pd()};Bn.prototype.merge=function(e){return null};Bn.prototype.toJSON=function(){return Pd()};Bn.fromJSON=function(e,r){if(!r||!r.stepType)throw new RangeError("Invalid input for Step.fromJSON");var o=Xf[r.stepType];if(!o)throw new RangeError("No step type "+r.stepType+" defined");return o.fromJSON(e,r)};Bn.jsonID=function(e,r){if(e in Xf)throw new RangeError("Duplicate use of step JSON ID "+e);return Xf[e]=r,r.prototype.jsonID=e,r};var Wn=function(e,r){this.doc=e,this.failed=r};Wn.ok=function(e){return new Wn(e,null)};Wn.fail=function(e){return new Wn(null,e)};Wn.fromReplace=function(e,r,o,a){try{return Wn.ok(e.replace(r,o,a))}catch(l){if(l instanceof bo)return Wn.fail(l.message);throw l}};var is=function(t){function e(r,o,a,l){t.call(this),this.from=r,this.to=o,this.slice=a,this.structure=!!l}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(o){return this.structure&&$f(o,this.from,this.to)?Wn.fail("Structure replace would overwrite content"):Wn.fromReplace(o,this.from,this.to,this.slice)},e.prototype.getMap=function(){return new fn([this.from,this.to-this.from,this.slice.size])},e.prototype.invert=function(o){return new e(this.from,this.from+this.slice.size,o.slice(this.from,this.to))},e.prototype.map=function(o){var a=o.mapResult(this.from,1),l=o.mapResult(this.to,-1);return a.deleted&&l.deleted?null:new e(a.pos,Math.max(a.pos,l.pos),this.slice)},e.prototype.merge=function(o){if(!(o instanceof e)||o.structure||this.structure)return null;if(this.from+this.slice.size==o.from&&!this.slice.openEnd&&!o.slice.openStart){var a=this.slice.size+o.slice.size==0?ye.empty:new ye(this.slice.content.append(o.slice.content),this.slice.openStart,o.slice.openEnd);return new e(this.from,this.to+(o.to-o.from),a,this.structure)}else if(o.to==this.from&&!this.slice.openStart&&!o.slice.openEnd){var l=this.slice.size+o.slice.size==0?ye.empty:new ye(o.slice.content.append(this.slice.content),o.slice.openStart,this.slice.openEnd);return new e(o.from,this.to,l,this.structure)}else return null},e.prototype.toJSON=function(){var o={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(o.slice=this.slice.toJSON()),this.structure&&(o.structure=!0),o},e.fromJSON=function(o,a){if(typeof a.from!="number"||typeof a.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new e(a.from,a.to,ye.fromJSON(o,a.slice),!!a.structure)},e}(Bn);Bn.jsonID("replace",is);var si=function(t){function e(r,o,a,l,d,p,g){t.call(this),this.from=r,this.to=o,this.gapFrom=a,this.gapTo=l,this.slice=d,this.insert=p,this.structure=!!g}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(o){if(this.structure&&($f(o,this.from,this.gapFrom)||$f(o,this.gapTo,this.to)))return Wn.fail("Structure gap-replace would overwrite content");var a=o.slice(this.gapFrom,this.gapTo);if(a.openStart||a.openEnd)return Wn.fail("Gap is not a flat range");var l=this.slice.insertAt(this.insert,a.content);return l?Wn.fromReplace(o,this.from,this.to,l):Wn.fail("Content does not fit in gap")},e.prototype.getMap=function(){return new fn([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])},e.prototype.invert=function(o){var a=this.gapTo-this.gapFrom;return new e(this.from,this.from+this.slice.size+a,this.from+this.insert,this.from+this.insert+a,o.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)},e.prototype.map=function(o){var a=o.mapResult(this.from,1),l=o.mapResult(this.to,-1),d=o.map(this.gapFrom,-1),p=o.map(this.gapTo,1);return a.deleted&&l.deleted||d<a.pos||p>l.pos?null:new e(a.pos,l.pos,d,p,this.slice,this.insert,this.structure)},e.prototype.toJSON=function(){var o={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(o.slice=this.slice.toJSON()),this.structure&&(o.structure=!0),o},e.fromJSON=function(o,a){if(typeof a.from!="number"||typeof a.to!="number"||typeof a.gapFrom!="number"||typeof a.gapTo!="number"||typeof a.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new e(a.from,a.to,a.gapFrom,a.gapTo,ye.fromJSON(o,a.slice),a.insert,!!a.structure)},e}(Bn);Bn.jsonID("replaceAround",si);function $f(t,e,r){for(var o=t.resolve(e),a=r-e,l=o.depth;a>0&&l>0&&o.indexAfter(l)==o.node(l).childCount;)l--,a--;if(a>0)for(var d=o.node(l).maybeChild(o.indexAfter(l));a>0;){if(!d||d.isLeaf)return!0;d=d.firstChild,a--}return!1}function rk(t,e,r){return(e==0||t.canReplace(e,t.childCount))&&(r==t.childCount||t.canReplace(0,r))}function _c(t){for(var e=t.parent,r=e.content.cutByIndex(t.startIndex,t.endIndex),o=t.depth;;--o){var a=t.$from.node(o),l=t.$from.index(o),d=t.$to.indexAfter(o);if(o<t.depth&&a.canReplace(l,d,r))return o;if(o==0||a.type.spec.isolating||!rk(a,l,d))break}}wr.prototype.lift=function(t,e){for(var r=t.$from,o=t.$to,a=t.depth,l=r.before(a+1),d=o.after(a+1),p=l,g=d,v=ee.empty,C=0,y=a,w=!1;y>e;y--)w||r.index(y)>0?(w=!0,v=ee.from(r.node(y).copy(v)),C++):p--;for(var k=ee.empty,M=0,x=a,V=!1;x>e;x--)V||o.after(x+1)<o.end(x)?(V=!0,k=ee.from(o.node(x).copy(k)),M++):g++;return this.step(new si(p,g,l,d,new ye(v.append(k),C,M),v.size-C,!0))};function Zf(t,e,r,o){o===void 0&&(o=t);var a=nk(t,e),l=a&&ik(o,e);return l?a.map(ZC).concat({type:e,attrs:r}).concat(l.map(ZC)):null}function ZC(t){return{type:t,attrs:null}}function nk(t,e){var r=t.parent,o=t.startIndex,a=t.endIndex,l=r.contentMatchAt(o).findWrapping(e);if(!l)return null;var d=l.length?l[0]:e;return r.canReplaceWith(o,a,d)?l:null}function ik(t,e){var r=t.parent,o=t.startIndex,a=t.endIndex,l=r.child(o),d=e.contentMatch.findWrapping(l.type);if(!d)return null;for(var p=d.length?d[d.length-1]:e,g=p.contentMatch,v=o;g&&v<a;v++)g=g.matchType(r.child(v).type);return!g||!g.validEnd?null:d}wr.prototype.wrap=function(t,e){for(var r=ee.empty,o=e.length-1;o>=0;o--)r=ee.from(e[o].type.create(e[o].attrs,r));var a=t.start,l=t.end;return this.step(new si(a,l,a,l,new ye(r,0,0),e.length,!0))};wr.prototype.setBlockType=function(t,e,r,o){var a=this;if(e===void 0&&(e=t),!r.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");var l=this.steps.length;return this.doc.nodesBetween(t,e,function(d,p){if(d.isTextblock&&!d.hasMarkup(r,o)&&ok(a.doc,a.mapping.slice(l).map(p),r)){a.clearIncompatible(a.mapping.slice(l).map(p,1),r);var g=a.mapping.slice(l),v=g.map(p,1),C=g.map(p+d.nodeSize,1);return a.step(new si(v,C,v+1,C-1,new ye(ee.from(r.create(o,null,d.marks)),0,0),1,!0)),!1}}),this};function ok(t,e,r){var o=t.resolve(e),a=o.index();return o.parent.canReplaceWith(a,a+1,r)}wr.prototype.setNodeMarkup=function(t,e,r,o){var a=this.doc.nodeAt(t);if(!a)throw new RangeError("No node at given position");e||(e=a.type);var l=e.create(r,null,o||a.marks);if(a.isLeaf)return this.replaceWith(t,t+a.nodeSize,l);if(!e.validContent(a.content))throw new RangeError("Invalid content for node type "+e.name);return this.step(new si(t,t+a.nodeSize,t+1,t+a.nodeSize-1,new ye(ee.from(l),0,0),1,!0))};function ss(t,e,r,o){r===void 0&&(r=1);var a=t.resolve(e),l=a.depth-r,d=o&&o[o.length-1]||a.parent;if(l<0||a.parent.type.spec.isolating||!a.parent.canReplace(a.index(),a.parent.childCount)||!d.type.validContent(a.parent.content.cutByIndex(a.index(),a.parent.childCount)))return!1;for(var p=a.depth-1,g=r-2;p>l;p--,g--){var v=a.node(p),C=a.index(p);if(v.type.spec.isolating)return!1;var y=v.content.cutByIndex(C,v.childCount),w=o&&o[g]||v;if(w!=v&&(y=y.replaceChild(0,w.type.create(w.attrs))),!v.canReplace(C+1,v.childCount)||!w.type.validContent(y))return!1}var k=a.indexAfter(l),M=o&&o[0];return a.node(l).canReplaceWith(k,k,M?M.type:a.node(l+1).type)}wr.prototype.split=function(t,e,r){e===void 0&&(e=1);for(var o=this.doc.resolve(t),a=ee.empty,l=ee.empty,d=o.depth,p=o.depth-e,g=e-1;d>p;d--,g--){a=ee.from(o.node(d).copy(a));var v=r&&r[g];l=ee.from(v?v.type.create(v.attrs,l):o.node(d).copy(l))}return this.step(new is(t,t,new ye(a.append(l),e,e),!0))};function eA(t,e){var r=t.resolve(e),o=r.index();return sk(r.nodeBefore,r.nodeAfter)&&r.parent.canReplace(o,o+1)}function sk(t,e){return t&&e&&!t.isLeaf&&t.canAppend(e)}wr.prototype.join=function(t,e){e===void 0&&(e=1);var r=new is(t-e,t+e,ye.empty,!0);return this.step(r)};function ak(t,e,r){var o=t.resolve(e);if(o.parent.canReplaceWith(o.index(),o.index(),r))return e;if(o.parentOffset==0)for(var a=o.depth-1;a>=0;a--){var l=o.index(a);if(o.node(a).canReplaceWith(l,l,r))return o.before(a+1);if(l>0)return null}if(o.parentOffset==o.parent.content.size)for(var d=o.depth-1;d>=0;d--){var p=o.indexAfter(d);if(o.node(d).canReplaceWith(p,p,r))return o.after(d+1);if(p<o.node(d).childCount)return null}}function e0(t,e,r){var o=t.resolve(e);if(!r.content.size)return e;for(var a=r.content,l=0;l<r.openStart;l++)a=a.firstChild.content;for(var d=1;d<=(r.openStart==0&&r.size?2:1);d++)for(var p=o.depth;p>=0;p--){var g=p==o.depth?0:o.pos<=(o.start(p+1)+o.end(p+1))/2?-1:1,v=o.index(p)+(g>0?1:0),C=o.node(p),y=!1;if(d==1)y=C.canReplace(v,v,a);else{var w=C.contentMatchAt(v).findWrapping(a.firstChild.type);y=w&&C.canReplaceWith(v,v,w[0])}if(y)return g==0?o.pos:g<0?o.before(p+1):o.after(p+1)}return null}function tA(t,e,r){for(var o=[],a=0;a<t.childCount;a++){var l=t.child(a);l.content.size&&(l=l.copy(tA(l.content,e,l))),l.isInline&&(l=e(l,r,a)),o.push(l)}return ee.fromArray(o)}var rA=function(t){function e(r,o,a){t.call(this),this.from=r,this.to=o,this.mark=a}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(o){var a=this,l=o.slice(this.from,this.to),d=o.resolve(this.from),p=d.node(d.sharedDepth(this.to)),g=new ye(tA(l.content,function(v,C){return!v.isAtom||!C.type.allowsMarkType(a.mark.type)?v:v.mark(a.mark.addToSet(v.marks))},p),l.openStart,l.openEnd);return Wn.fromReplace(o,this.from,this.to,g)},e.prototype.invert=function(){return new xl(this.from,this.to,this.mark)},e.prototype.map=function(o){var a=o.mapResult(this.from,1),l=o.mapResult(this.to,-1);return a.deleted&&l.deleted||a.pos>=l.pos?null:new e(a.pos,l.pos,this.mark)},e.prototype.merge=function(o){if(o instanceof e&&o.mark.eq(this.mark)&&this.from<=o.to&&this.to>=o.from)return new e(Math.min(this.from,o.from),Math.max(this.to,o.to),this.mark)},e.prototype.toJSON=function(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},e.fromJSON=function(o,a){if(typeof a.from!="number"||typeof a.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new e(a.from,a.to,o.markFromJSON(a.mark))},e}(Bn);Bn.jsonID("addMark",rA);var xl=function(t){function e(r,o,a){t.call(this),this.from=r,this.to=o,this.mark=a}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(o){var a=this,l=o.slice(this.from,this.to),d=new ye(tA(l.content,function(p){return p.mark(a.mark.removeFromSet(p.marks))}),l.openStart,l.openEnd);return Wn.fromReplace(o,this.from,this.to,d)},e.prototype.invert=function(){return new rA(this.from,this.to,this.mark)},e.prototype.map=function(o){var a=o.mapResult(this.from,1),l=o.mapResult(this.to,-1);return a.deleted&&l.deleted||a.pos>=l.pos?null:new e(a.pos,l.pos,this.mark)},e.prototype.merge=function(o){if(o instanceof e&&o.mark.eq(this.mark)&&this.from<=o.to&&this.to>=o.from)return new e(Math.min(this.from,o.from),Math.max(this.to,o.to),this.mark)},e.prototype.toJSON=function(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},e.fromJSON=function(o,a){if(typeof a.from!="number"||typeof a.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new e(a.from,a.to,o.markFromJSON(a.mark))},e}(Bn);Bn.jsonID("removeMark",xl);wr.prototype.addMark=function(t,e,r){var o=this,a=[],l=[],d=null,p=null;return this.doc.nodesBetween(t,e,function(g,v,C){if(!!g.isInline){var y=g.marks;if(!r.isInSet(y)&&C.type.allowsMarkType(r.type)){for(var w=Math.max(v,t),k=Math.min(v+g.nodeSize,e),M=r.addToSet(y),x=0;x<y.length;x++)y[x].isInSet(M)||(d&&d.to==w&&d.mark.eq(y[x])?d.to=k:a.push(d=new xl(w,k,y[x])));p&&p.to==w?p.to=k:l.push(p=new rA(w,k,r))}}}),a.forEach(function(g){return o.step(g)}),l.forEach(function(g){return o.step(g)}),this};wr.prototype.removeMark=function(t,e,r){var o=this;r===void 0&&(r=null);var a=[],l=0;return this.doc.nodesBetween(t,e,function(d,p){if(!!d.isInline){l++;var g=null;if(r instanceof Rs)for(var v=d.marks,C;C=r.isInSet(v);)(g||(g=[])).push(C),v=C.removeFromSet(v);else r?r.isInSet(d.marks)&&(g=[r]):g=d.marks;if(g&&g.length)for(var y=Math.min(p+d.nodeSize,e),w=0;w<g.length;w++){for(var k=g[w],M=void 0,x=0;x<a.length;x++){var V=a[x];V.step==l-1&&k.eq(a[x].style)&&(M=V)}M?(M.to=y,M.step=l):a.push({style:k,from:Math.max(p,t),to:y,step:l})}}}),a.forEach(function(d){return o.step(new xl(d.from,d.to,d.style))}),this};wr.prototype.clearIncompatible=function(t,e,r){r===void 0&&(r=e.contentMatch);for(var o=this.doc.nodeAt(t),a=[],l=t+1,d=0;d<o.childCount;d++){var p=o.child(d),g=l+p.nodeSize,v=r.matchType(p.type,p.attrs);if(!v)a.push(new is(l,g,ye.empty));else{r=v;for(var C=0;C<p.marks.length;C++)e.allowsMarkType(p.marks[C].type)||this.step(new xl(l,g,p.marks[C]))}l=g}if(!r.validEnd){var y=r.fillBefore(ee.empty,!0);this.replace(l,l,new ye(y,0,0))}for(var w=a.length-1;w>=0;w--)this.step(a[w]);return this};function ck(t,e,r,o){if(r===void 0&&(r=e),o===void 0&&(o=ye.empty),e==r&&!o.size)return null;var a=t.resolve(e),l=t.resolve(r);return t0(a,l,o)?new is(e,r,o):new Gi(a,l,o).fit()}wr.prototype.replace=function(t,e,r){e===void 0&&(e=t),r===void 0&&(r=ye.empty);var o=ck(this.doc,t,e,r);return o&&this.step(o),this};wr.prototype.replaceWith=function(t,e,r){return this.replace(t,e,new ye(ee.from(r),0,0))};wr.prototype.delete=function(t,e){return this.replace(t,e,ye.empty)};wr.prototype.insert=function(t,e){return this.replaceWith(t,t,e)};function t0(t,e,r){return!r.openStart&&!r.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),r.content)}var Gi=function(e,r,o){this.$to=r,this.$from=e,this.unplaced=o,this.frontier=[];for(var a=0;a<=e.depth;a++){var l=e.node(a);this.frontier.push({type:l.type,match:l.contentMatchAt(e.indexAfter(a))})}this.placed=ee.empty;for(var d=e.depth;d>0;d--)this.placed=ee.from(e.node(d).copy(this.placed))},r0={depth:{configurable:!0}};r0.depth.get=function(){return this.frontier.length-1};Gi.prototype.fit=function(){for(;this.unplaced.size;){var e=this.findFittable();e?this.placeNodes(e):this.openMore()||this.dropNode()}var r=this.mustMoveInline(),o=this.placed.size-this.depth-this.$from.depth,a=this.$from,l=this.close(r<0?this.$to:a.doc.resolve(r));if(!l)return null;for(var d=this.placed,p=a.depth,g=l.depth;p&&g&&d.childCount==1;)d=d.firstChild.content,p--,g--;var v=new ye(d,p,g);if(r>-1)return new si(a.pos,r,this.$to.pos,this.$to.end(),v,o);if(v.size||a.pos!=this.$to.pos)return new is(a.pos,l.pos,v)};Gi.prototype.findFittable=function(){for(var e=1;e<=2;e++)for(var r=this.unplaced.openStart;r>=0;r--){var o=void 0,a=void 0;r?(a=nA(this.unplaced.content,r-1).firstChild,o=a.content):o=this.unplaced.content;for(var l=o.firstChild,d=this.depth;d>=0;d--){var p=this.frontier[d],g=p.type,v=p.match,C=void 0,y=void 0;if(e==1&&(l?v.matchType(l.type)||(y=v.fillBefore(ee.from(l),!1)):g.compatibleContent(a.type)))return{sliceDepth:r,frontierDepth:d,parent:a,inject:y};if(e==2&&l&&(C=v.findWrapping(l.type)))return{sliceDepth:r,frontierDepth:d,parent:a,wrap:C};if(a&&v.matchType(a.type))break}}};Gi.prototype.openMore=function(){var e=this.unplaced,r=e.content,o=e.openStart,a=e.openEnd,l=nA(r,o);return!l.childCount||l.firstChild.isLeaf?!1:(this.unplaced=new ye(r,o+1,Math.max(a,l.size+o>=r.size-a?o+1:0)),!0)};Gi.prototype.dropNode=function(){var e=this.unplaced,r=e.content,o=e.openStart,a=e.openEnd,l=nA(r,o);if(l.childCount<=1&&o>0){var d=r.size-o<=o+l.size;this.unplaced=new ye(Ql(r,o-1,1),o-1,d?o-1:a)}else this.unplaced=new ye(Ql(r,o,1),o,a)};Gi.prototype.placeNodes=function(e){for(var r=e.sliceDepth,o=e.frontierDepth,a=e.parent,l=e.inject,d=e.wrap;this.depth>o;)this.closeFrontierNode();if(d)for(var p=0;p<d.length;p++)this.openFrontierNode(d[p]);var g=this.unplaced,v=a?a.content:g.content,C=g.openStart-r,y=0,w=[],k=this.frontier[o],M=k.match,x=k.type;if(l){for(var V=0;V<l.childCount;V++)w.push(l.child(V));M=M.matchFragment(l)}for(var Y=v.size+r-(g.content.size-g.openEnd);y<v.childCount;){var H=v.child(y),he=M.matchType(H.type);if(!he)break;y++,(y>1||C==0||H.content.size)&&(M=he,w.push(n0(H.mark(x.allowedMarks(H.marks)),y==1?C:0,y==v.childCount?Y:-1)))}var Q=y==v.childCount;Q||(Y=-1),this.placed=Ul(this.placed,o,ee.from(w)),this.frontier[o].match=M,Q&&Y<0&&a&&a.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(var pe=0,oe=v;pe<Y;pe++){var me=oe.lastChild;this.frontier.push({type:me.type,match:me.contentMatchAt(me.childCount)}),oe=me.content}this.unplaced=Q?r==0?ye.empty:new ye(Ql(g.content,r-1,1),r-1,Y<0?g.openEnd:r-1):new ye(Ql(g.content,r,y),g.openStart,g.openEnd)};Gi.prototype.mustMoveInline=function(){if(!this.$to.parent.isTextblock||this.$to.end()==this.$to.pos)return-1;var e=this.frontier[this.depth],r;if(!e.type.isTextblock||!iA(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(r=this.findCloseLevel(this.$to))&&r.depth==this.depth)return-1;for(var o=this.$to,a=o.depth,l=this.$to.after(a);a>1&&l==this.$to.end(--a);)++l;return l};Gi.prototype.findCloseLevel=function(e){e:for(var r=Math.min(this.depth,e.depth);r>=0;r--){var o=this.frontier[r],a=o.match,l=o.type,d=r<e.depth&&e.end(r+1)==e.pos+(e.depth-(r+1)),p=iA(e,r,l,a,d);if(!!p){for(var g=r-1;g>=0;g--){var v=this.frontier[g],C=v.match,y=v.type,w=iA(e,g,y,C,!0);if(!w||w.childCount)continue e}return{depth:r,fit:p,move:d?e.doc.resolve(e.after(r+1)):e}}}};Gi.prototype.close=function(e){var r=this.findCloseLevel(e);if(!r)return null;for(;this.depth>r.depth;)this.closeFrontierNode();r.fit.childCount&&(this.placed=Ul(this.placed,r.depth,r.fit)),e=r.move;for(var o=r.depth+1;o<=e.depth;o++){var a=e.node(o),l=a.type.contentMatch.fillBefore(a.content,!0,e.index(o));this.openFrontierNode(a.type,a.attrs,l)}return e};Gi.prototype.openFrontierNode=function(e,r,o){var a=this.frontier[this.depth];a.match=a.match.matchType(e),this.placed=Ul(this.placed,this.depth,ee.from(e.create(r,o))),this.frontier.push({type:e,match:e.contentMatch})};Gi.prototype.closeFrontierNode=function(){var e=this.frontier.pop(),r=e.match.fillBefore(ee.empty,!0);r.childCount&&(this.placed=Ul(this.placed,this.frontier.length,r))};Object.defineProperties(Gi.prototype,r0);function Ql(t,e,r){return e==0?t.cutByIndex(r):t.replaceChild(0,t.firstChild.copy(Ql(t.firstChild.content,e-1,r)))}function Ul(t,e,r){return e==0?t.append(r):t.replaceChild(t.childCount-1,t.lastChild.copy(Ul(t.lastChild.content,e-1,r)))}function nA(t,e){for(var r=0;r<e;r++)t=t.firstChild.content;return t}function n0(t,e,r){if(e<=0)return t;var o=t.content;return e>1&&(o=o.replaceChild(0,n0(o.firstChild,e-1,o.childCount==1?r-1:0))),e>0&&(o=t.type.contentMatch.fillBefore(o).append(o),r<=0&&(o=o.append(t.type.contentMatch.matchFragment(o).fillBefore(ee.empty,!0)))),t.copy(o)}function iA(t,e,r,o,a){var l=t.node(e),d=a?t.indexAfter(e):t.index(e);if(d==l.childCount&&!r.compatibleContent(l.type))return null;var p=o.fillBefore(l.content,!0,d);return p&&!lk(r,l.content,d)?p:null}function lk(t,e,r){for(var o=r;o<e.childCount;o++)if(!t.allowsMarks(e.child(o).marks))return!0;return!1}wr.prototype.replaceRange=function(t,e,r){if(!r.size)return this.deleteRange(t,e);var o=this.doc.resolve(t),a=this.doc.resolve(e);if(t0(o,a,r))return this.step(new is(t,e,r));var l=o0(o,this.doc.resolve(e));l[l.length-1]==0&&l.pop();var d=-(o.depth+1);l.unshift(d);for(var p=o.depth,g=o.pos-1;p>0;p--,g--){var v=o.node(p).type.spec;if(v.defining||v.isolating)break;l.indexOf(p)>-1?d=p:o.before(p)==g&&l.splice(1,0,-p)}for(var C=l.indexOf(d),y=[],w=r.openStart,k=r.content,M=0;;M++){var x=k.firstChild;if(y.push(x),M==r.openStart)break;k=x.content}w>0&&y[w-1].type.spec.defining&&o.node(C).type!=y[w-1].type?w-=1:w>=2&&y[w-1].isTextblock&&y[w-2].type.spec.defining&&o.node(C).type!=y[w-2].type&&(w-=2);for(var V=r.openStart;V>=0;V--){var Y=(V+w+1)%(r.openStart+1),H=y[Y];if(!!H)for(var he=0;he<l.length;he++){var Q=l[(he+C)%l.length],pe=!0;Q<0&&(pe=!1,Q=-Q);var oe=o.node(Q-1),me=o.index(Q-1);if(oe.canReplaceWith(me,me,H.type,H.marks))return this.replace(o.before(Q),pe?a.after(Q):e,new ye(i0(r.content,0,r.openStart,Y),Y,r.openEnd))}}for(var xe=this.steps.length,Pe=l.length-1;Pe>=0&&(this.replace(t,e,r),!(this.steps.length>xe));Pe--){var De=l[Pe];De<0||(t=o.before(De),e=a.after(De))}return this};function i0(t,e,r,o,a){if(e<r){var l=t.firstChild;t=t.replaceChild(0,l.copy(i0(l.content,e+1,r,o,l)))}if(e>o){var d=a.contentMatchAt(0),p=d.fillBefore(t).append(t);t=p.append(d.matchFragment(p).fillBefore(ee.empty,!0))}return t}wr.prototype.replaceRangeWith=function(t,e,r){if(!r.isInline&&t==e&&this.doc.resolve(t).parent.content.size){var o=ak(this.doc,t,r.type);o!=null&&(t=e=o)}return this.replaceRange(t,e,new ye(ee.from(r),0,0))};wr.prototype.deleteRange=function(t,e){for(var r=this.doc.resolve(t),o=this.doc.resolve(e),a=o0(r,o),l=0;l<a.length;l++){var d=a[l],p=l==a.length-1;if(p&&d==0||r.node(d).type.contentMatch.validEnd)return this.delete(r.start(d),o.end(d));if(d>0&&(p||r.node(d-1).canReplace(r.index(d-1),o.indexAfter(d-1))))return this.delete(r.before(d),o.after(d))}for(var g=1;g<=r.depth&&g<=o.depth;g++)if(t-r.start(g)==r.depth-g&&e>r.end(g)&&o.end(g)-e!=o.depth-g)return this.delete(r.before(g),e);return this.delete(t,e)};function o0(t,e){for(var r=[],o=Math.min(t.depth,e.depth),a=o;a>=0;a--){var l=t.start(a);if(l<t.pos-(t.depth-a)||e.end(a)>e.pos+(e.depth-a)||t.node(a).type.spec.isolating||e.node(a).type.spec.isolating)break;(l==e.start(a)||a==t.depth&&a==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&a&&e.start(a-1)==l-1)&&r.push(a)}return r}var oA=Object.create(null),ot=function(e,r,o){this.ranges=o||[new uk(e.min(r),e.max(r))],this.$anchor=e,this.$head=r},ws={anchor:{configurable:!0},head:{configurable:!0},from:{configurable:!0},to:{configurable:!0},$from:{configurable:!0},$to:{configurable:!0},empty:{configurable:!0}};ws.anchor.get=function(){return this.$anchor.pos};ws.head.get=function(){return this.$head.pos};ws.from.get=function(){return this.$from.pos};ws.to.get=function(){return this.$to.pos};ws.$from.get=function(){return this.ranges[0].$from};ws.$to.get=function(){return this.ranges[0].$to};ws.empty.get=function(){for(var t=this.ranges,e=0;e<t.length;e++)if(t[e].$from.pos!=t[e].$to.pos)return!1;return!0};ot.prototype.content=function(){return this.$from.node(0).slice(this.from,this.to,!0)};ot.prototype.replace=function(e,r){r===void 0&&(r=ye.empty);for(var o=r.content.lastChild,a=null,l=0;l<r.openEnd;l++)a=o,o=o.lastChild;for(var d=e.steps.length,p=this.ranges,g=0;g<p.length;g++){var v=p[g],C=v.$from,y=v.$to,w=e.mapping.slice(d);e.replaceRange(w.map(C.pos),w.map(y.pos),g?ye.empty:r),g==0&&s0(e,d,(o?o.isInline:a&&a.isTextblock)?-1:1)}};ot.prototype.replaceWith=function(e,r){for(var o=e.steps.length,a=this.ranges,l=0;l<a.length;l++){var d=a[l],p=d.$from,g=d.$to,v=e.mapping.slice(o),C=v.map(p.pos),y=v.map(g.pos);l?e.deleteRange(C,y):(e.replaceRangeWith(C,y,r),s0(e,o,r.isInline?-1:1))}};ot.findFrom=function(e,r,o){var a=e.parent.inlineContent?new Dt(e):Sc(e.node(0),e.parent,e.pos,e.index(),r,o);if(a)return a;for(var l=e.depth-1;l>=0;l--){var d=r<0?Sc(e.node(0),e.node(l),e.before(l+1),e.index(l),r,o):Sc(e.node(0),e.node(l),e.after(l+1),e.index(l)+1,r,o);if(d)return d}};ot.near=function(e,r){return r===void 0&&(r=1),this.findFrom(e,r)||this.findFrom(e,-r)||new as(e.node(0))};ot.atStart=function(e){return Sc(e,e,0,0,1)||new as(e)};ot.atEnd=function(e){return Sc(e,e,e.content.size,e.childCount,-1)||new as(e)};ot.fromJSON=function(e,r){if(!r||!r.type)throw new RangeError("Invalid input for Selection.fromJSON");var o=oA[r.type];if(!o)throw new RangeError("No selection type "+r.type+" defined");return o.fromJSON(e,r)};ot.jsonID=function(e,r){if(e in oA)throw new RangeError("Duplicate use of selection JSON ID "+e);return oA[e]=r,r.prototype.jsonID=e,r};ot.prototype.getBookmark=function(){return Dt.between(this.$anchor,this.$head).getBookmark()};Object.defineProperties(ot.prototype,ws);ot.prototype.visible=!0;var uk=function(e,r){this.$from=e,this.$to=r},Dt=function(t){function e(o,a){a===void 0&&(a=o),t.call(this,o,a)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={$cursor:{configurable:!0}};return r.$cursor.get=function(){return this.$anchor.pos==this.$head.pos?this.$head:null},e.prototype.map=function(a,l){var d=a.resolve(l.map(this.head));if(!d.parent.inlineContent)return t.near(d);var p=a.resolve(l.map(this.anchor));return new e(p.parent.inlineContent?p:d,d)},e.prototype.replace=function(a,l){if(l===void 0&&(l=ye.empty),t.prototype.replace.call(this,a,l),l==ye.empty){var d=this.$from.marksAcross(this.$to);d&&a.ensureMarks(d)}},e.prototype.eq=function(a){return a instanceof e&&a.anchor==this.anchor&&a.head==this.head},e.prototype.getBookmark=function(){return new Fl(this.anchor,this.head)},e.prototype.toJSON=function(){return{type:"text",anchor:this.anchor,head:this.head}},e.fromJSON=function(a,l){if(typeof l.anchor!="number"||typeof l.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new e(a.resolve(l.anchor),a.resolve(l.head))},e.create=function(a,l,d){d===void 0&&(d=l);var p=a.resolve(l);return new this(p,d==l?p:a.resolve(d))},e.between=function(a,l,d){var p=a.pos-l.pos;if((!d||p)&&(d=p>=0?1:-1),!l.parent.inlineContent){var g=t.findFrom(l,d,!0)||t.findFrom(l,-d,!0);if(g)l=g.$head;else return t.near(l,d)}return a.parent.inlineContent||(p==0?a=l:(a=(t.findFrom(a,-d,!0)||t.findFrom(a,d,!0)).$anchor,a.pos<l.pos!=p<0&&(a=l))),new e(a,l)},Object.defineProperties(e.prototype,r),e}(ot);ot.jsonID("text",Dt);var Fl=function(e,r){this.anchor=e,this.head=r};Fl.prototype.map=function(e){return new Fl(e.map(this.anchor),e.map(this.head))};Fl.prototype.resolve=function(e){return Dt.between(e.resolve(this.anchor),e.resolve(this.head))};var tt=function(t){function e(r){var o=r.nodeAfter,a=r.node(0).resolve(r.pos+o.nodeSize);t.call(this,r,a),this.node=o}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.map=function(o,a){var l=a.mapResult(this.anchor),d=l.deleted,p=l.pos,g=o.resolve(p);return d?t.near(g):new e(g)},e.prototype.content=function(){return new ye(ee.from(this.node),0,0)},e.prototype.eq=function(o){return o instanceof e&&o.anchor==this.anchor},e.prototype.toJSON=function(){return{type:"node",anchor:this.anchor}},e.prototype.getBookmark=function(){return new xd(this.anchor)},e.fromJSON=function(o,a){if(typeof a.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new e(o.resolve(a.anchor))},e.create=function(o,a){return new this(o.resolve(a))},e.isSelectable=function(o){return!o.isText&&o.type.spec.selectable!==!1},e}(ot);tt.prototype.visible=!1;ot.jsonID("node",tt);var xd=function(e){this.anchor=e};xd.prototype.map=function(e){var r=e.mapResult(this.anchor),o=r.deleted,a=r.pos;return o?new Fl(a,a):new xd(a)};xd.prototype.resolve=function(e){var r=e.resolve(this.anchor),o=r.nodeAfter;return o&&tt.isSelectable(o)?new tt(r):ot.near(r)};var as=function(t){function e(r){t.call(this,r.resolve(0),r.resolve(r.content.size))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.replace=function(o,a){if(a===void 0&&(a=ye.empty),a==ye.empty){o.delete(0,o.doc.content.size);var l=t.atStart(o.doc);l.eq(o.selection)||o.setSelection(l)}else t.prototype.replace.call(this,o,a)},e.prototype.toJSON=function(){return{type:"all"}},e.fromJSON=function(o){return new e(o)},e.prototype.map=function(o){return new e(o)},e.prototype.eq=function(o){return o instanceof e},e.prototype.getBookmark=function(){return dk},e}(ot);ot.jsonID("all",as);var dk={map:function(){return this},resolve:function(e){return new as(e)}};function Sc(t,e,r,o,a,l){if(e.inlineContent)return Dt.create(t,r);for(var d=o-(a>0?0:1);a>0?d<e.childCount:d>=0;d+=a){var p=e.child(d);if(p.isAtom){if(!l&&tt.isSelectable(p))return tt.create(t,r-(a<0?p.nodeSize:0))}else{var g=Sc(t,p,r+a,a<0?p.childCount:0,a,l);if(g)return g}r+=p.nodeSize*a}}function s0(t,e,r){var o=t.steps.length-1;if(!(o<e)){var a=t.steps[o];if(a instanceof is||a instanceof si){var l=t.mapping.maps[o],d;l.forEach(function(p,g,v,C){d==null&&(d=C)}),t.setSelection(ot.near(t.doc.resolve(d),r))}}}var a0=1,Qd=2,c0=4,hk=function(t){function e(o){t.call(this,o.doc),this.time=Date.now(),this.curSelection=o.selection,this.curSelectionFor=0,this.storedMarks=o.storedMarks,this.updated=0,this.meta=Object.create(null)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={selection:{configurable:!0},selectionSet:{configurable:!0},storedMarksSet:{configurable:!0},isGeneric:{configurable:!0},scrolledIntoView:{configurable:!0}};return r.selection.get=function(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection},e.prototype.setSelection=function(a){if(a.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=a,this.curSelectionFor=this.steps.length,this.updated=(this.updated|a0)&~Qd,this.storedMarks=null,this},r.selectionSet.get=function(){return(this.updated&a0)>0},e.prototype.setStoredMarks=function(a){return this.storedMarks=a,this.updated|=Qd,this},e.prototype.ensureMarks=function(a){return Ct.sameSet(this.storedMarks||this.selection.$from.marks(),a)||this.setStoredMarks(a),this},e.prototype.addStoredMark=function(a){return this.ensureMarks(a.addToSet(this.storedMarks||this.selection.$head.marks()))},e.prototype.removeStoredMark=function(a){return this.ensureMarks(a.removeFromSet(this.storedMarks||this.selection.$head.marks()))},r.storedMarksSet.get=function(){return(this.updated&Qd)>0},e.prototype.addStep=function(a,l){t.prototype.addStep.call(this,a,l),this.updated=this.updated&~Qd,this.storedMarks=null},e.prototype.setTime=function(a){return this.time=a,this},e.prototype.replaceSelection=function(a){return this.selection.replace(this,a),this},e.prototype.replaceSelectionWith=function(a,l){var d=this.selection;return l!==!1&&(a=a.mark(this.storedMarks||(d.empty?d.$from.marks():d.$from.marksAcross(d.$to)||Ct.none))),d.replaceWith(this,a),this},e.prototype.deleteSelection=function(){return this.selection.replace(this),this},e.prototype.insertText=function(a,l,d){d===void 0&&(d=l);var p=this.doc.type.schema;if(l==null)return a?this.replaceSelectionWith(p.text(a),!0):this.deleteSelection();if(!a)return this.deleteRange(l,d);var g=this.storedMarks;if(!g){var v=this.doc.resolve(l);g=d==l?v.marks():v.marksAcross(this.doc.resolve(d))}return this.replaceRangeWith(l,d,p.text(a,g)),this.selection.empty||this.setSelection(ot.near(this.selection.$to)),this},e.prototype.setMeta=function(a,l){return this.meta[typeof a=="string"?a:a.key]=l,this},e.prototype.getMeta=function(a){return this.meta[typeof a=="string"?a:a.key]},r.isGeneric.get=function(){for(var o in this.meta)return!1;return!0},e.prototype.scrollIntoView=function(){return this.updated|=c0,this},r.scrolledIntoView.get=function(){return(this.updated&c0)>0},Object.defineProperties(e.prototype,r),e}(wr);function l0(t,e){return!e||!t?t:t.bind(e)}var Vl=function(e,r,o){this.name=e,this.init=l0(r.init,o),this.apply=l0(r.apply,o)},pk=[new Vl("doc",{init:function(e){return e.doc||e.schema.topNodeType.createAndFill()},apply:function(e){return e.doc}}),new Vl("selection",{init:function(e,r){return e.selection||ot.atStart(r.doc)},apply:function(e){return e.selection}}),new Vl("storedMarks",{init:function(e){return e.storedMarks||null},apply:function(e,r,o,a){return a.selection.$cursor?e.storedMarks:null}}),new Vl("scrollToSelection",{init:function(){return 0},apply:function(e,r){return e.scrolledIntoView?r+1:r}})],sA=function(e,r){var o=this;this.schema=e,this.fields=pk.concat(),this.plugins=[],this.pluginsByKey=Object.create(null),r&&r.forEach(function(a){if(o.pluginsByKey[a.key])throw new RangeError("Adding different instances of a keyed plugin ("+a.key+")");o.plugins.push(a),o.pluginsByKey[a.key]=a,a.spec.state&&o.fields.push(new Vl(a.key,a.spec.state,a))})},Mn=function(e){this.config=e},Ud={schema:{configurable:!0},plugins:{configurable:!0},tr:{configurable:!0}};Ud.schema.get=function(){return this.config.schema};Ud.plugins.get=function(){return this.config.plugins};Mn.prototype.apply=function(e){return this.applyTransaction(e).state};Mn.prototype.filterTransaction=function(e,r){r===void 0&&(r=-1);for(var o=0;o<this.config.plugins.length;o++)if(o!=r){var a=this.config.plugins[o];if(a.spec.filterTransaction&&!a.spec.filterTransaction.call(a,e,this))return!1}return!0};Mn.prototype.applyTransaction=function(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};for(var r=[e],o=this.applyInner(e),a=null;;){for(var l=!1,d=0;d<this.config.plugins.length;d++){var p=this.config.plugins[d];if(p.spec.appendTransaction){var g=a?a[d].n:0,v=a?a[d].state:this,C=g<r.length&&p.spec.appendTransaction.call(p,g?r.slice(g):r,v,o);if(C&&o.filterTransaction(C,d)){if(C.setMeta("appendedTransaction",e),!a){a=[];for(var y=0;y<this.config.plugins.length;y++)a.push(y<d?{state:o,n:r.length}:{state:this,n:0})}r.push(C),o=o.applyInner(C),l=!0}a&&(a[d]={state:o,n:r.length})}}if(!l)return{state:o,transactions:r}}};Mn.prototype.applyInner=function(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");for(var r=new Mn(this.config),o=this.config.fields,a=0;a<o.length;a++){var l=o[a];r[l.name]=l.apply(e,this[l.name],this,r)}for(var d=0;d<Gl.length;d++)Gl[d](this,e,r);return r};Ud.tr.get=function(){return new hk(this)};Mn.create=function(e){for(var r=new sA(e.doc?e.doc.type.schema:e.schema,e.plugins),o=new Mn(r),a=0;a<r.fields.length;a++)o[r.fields[a].name]=r.fields[a].init(e,o);return o};Mn.prototype.reconfigure=function(e){for(var r=new sA(this.schema,e.plugins),o=r.fields,a=new Mn(r),l=0;l<o.length;l++){var d=o[l].name;a[d]=this.hasOwnProperty(d)?this[d]:o[l].init(e,a)}return a};Mn.prototype.toJSON=function(e){var r={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(r.storedMarks=this.storedMarks.map(function(d){return d.toJSON()})),e&&typeof e=="object")for(var o in e){if(o=="doc"||o=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");var a=e[o],l=a.spec.state;l&&l.toJSON&&(r[o]=l.toJSON.call(a,this[a.key]))}return r};Mn.fromJSON=function(e,r,o){if(!r)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");var a=new sA(e.schema,e.plugins),l=new Mn(a);return a.fields.forEach(function(d){if(d.name=="doc")l.doc=wt.fromJSON(e.schema,r.doc);else if(d.name=="selection")l.selection=ot.fromJSON(l.doc,r.selection);else if(d.name=="storedMarks")r.storedMarks&&(l.storedMarks=r.storedMarks.map(e.schema.markFromJSON));else{if(o)for(var p in o){var g=o[p],v=g.spec.state;if(g.key==d.name&&v&&v.fromJSON&&Object.prototype.hasOwnProperty.call(r,p)){l[d.name]=v.fromJSON.call(g,e,r[p],l);return}}l[d.name]=d.init(e,l)}}),l};Mn.addApplyListener=function(e){Gl.push(e)};Mn.removeApplyListener=function(e){var r=Gl.indexOf(e);r>-1&&Gl.splice(r,1)};Object.defineProperties(Mn.prototype,Ud);var Gl=[];function u0(t,e,r){for(var o in t){var a=t[o];a instanceof Function?a=a.bind(e):o=="handleDOMEvents"&&(a=u0(a,e,{})),r[o]=a}return r}var An=function(e){this.props={},e.props&&u0(e.props,this,this.props),this.spec=e,this.key=e.key?e.key.key:d0("plugin")};An.prototype.getState=function(e){return e[this.key]};var aA=Object.create(null);function d0(t){return t in aA?t+"$"+ ++aA[t]:(aA[t]=0,t+"$")}var ai=function(e){e===void 0&&(e="key"),this.key=d0(e)};ai.prototype.get=function(e){return e.config.pluginsByKey[this.key]};ai.prototype.getState=function(e){return e[this.key]};function cA(t,e){return t.selection.empty?!1:(e&&e(t.tr.deleteSelection().scrollIntoView()),!0)}function h0(t,e,r){var o=t.selection,a=o.$cursor;if(!a||(r?!r.endOfTextblock("backward",t):a.parentOffset>0))return!1;var l=f0(a);if(!l){var d=a.blockRange(),p=d&&_c(d);return p==null?!1:(e&&e(t.tr.lift(d,p).scrollIntoView()),!0)}var g=l.nodeBefore;if(!g.type.spec.isolating&&_0(t,l,e))return!0;if(a.parent.content.size==0&&(Tc(g,"end")||tt.isSelectable(g))){if(e){var v=t.tr.deleteRange(a.before(),a.after());v.setSelection(Tc(g,"end")?ot.findFrom(v.doc.resolve(v.mapping.map(l.pos,-1)),-1):tt.create(v.doc,l.pos-g.nodeSize)),e(v.scrollIntoView())}return!0}return g.isAtom&&l.depth==a.depth-1?(e&&e(t.tr.delete(l.pos-g.nodeSize,l.pos).scrollIntoView()),!0):!1}function Tc(t,e,r){for(;t;t=e=="start"?t.firstChild:t.lastChild){if(t.isTextblock)return!0;if(r&&t.childCount!=1)return!1}return!1}function p0(t,e,r){var o=t.selection,a=o.$head,l=o.empty,d=a;if(!l)return!1;if(a.parent.isTextblock){if(r?!r.endOfTextblock("backward",t):a.parentOffset>0)return!1;d=f0(a)}var p=d&&d.nodeBefore;return!p||!tt.isSelectable(p)?!1:(e&&e(t.tr.setSelection(tt.create(t.doc,d.pos-p.nodeSize)).scrollIntoView()),!0)}function f0(t){if(!t.parent.type.spec.isolating)for(var e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}function A0(t,e,r){var o=t.selection,a=o.$cursor;if(!a||(r?!r.endOfTextblock("forward",t):a.parentOffset<a.parent.content.size))return!1;var l=m0(a);if(!l)return!1;var d=l.nodeAfter;if(_0(t,l,e))return!0;if(a.parent.content.size==0&&(Tc(d,"start")||tt.isSelectable(d))){if(e){var p=t.tr.deleteRange(a.before(),a.after());p.setSelection(Tc(d,"start")?ot.findFrom(p.doc.resolve(p.mapping.map(l.pos)),1):tt.create(p.doc,p.mapping.map(l.pos))),e(p.scrollIntoView())}return!0}return d.isAtom&&l.depth==a.depth-1?(e&&e(t.tr.delete(l.pos,l.pos+d.nodeSize).scrollIntoView()),!0):!1}function g0(t,e,r){var o=t.selection,a=o.$head,l=o.empty,d=a;if(!l)return!1;if(a.parent.isTextblock){if(r?!r.endOfTextblock("forward",t):a.parentOffset<a.parent.content.size)return!1;d=m0(a)}var p=d&&d.nodeAfter;return!p||!tt.isSelectable(p)?!1:(e&&e(t.tr.setSelection(tt.create(t.doc,d.pos)).scrollIntoView()),!0)}function m0(t){if(!t.parent.type.spec.isolating)for(var e=t.depth-1;e>=0;e--){var r=t.node(e);if(t.index(e)+1<r.childCount)return t.doc.resolve(t.after(e+1));if(r.type.spec.isolating)break}return null}function v0(t,e){var r=t.selection,o=r.$from,a=r.$to,l=o.blockRange(a),d=l&&_c(l);return d==null?!1:(e&&e(t.tr.lift(l,d).scrollIntoView()),!0)}function E0(t,e){var r=t.selection,o=r.$head,a=r.$anchor;return!o.parent.type.spec.code||!o.sameParent(a)?!1:(e&&e(t.tr.insertText(`
`).scrollIntoView()),!0)}function lA(t){for(var e=0;e<t.edgeCount;e++){var r=t.edge(e),o=r.type;if(o.isTextblock&&!o.hasRequiredAttrs())return o}return null}function I0(t,e){var r=t.selection,o=r.$head,a=r.$anchor;if(!o.parent.type.spec.code||!o.sameParent(a))return!1;var l=o.node(-1),d=o.indexAfter(-1),p=lA(l.contentMatchAt(d));if(!l.canReplaceWith(d,d,p))return!1;if(e){var g=o.after(),v=t.tr.replaceWith(g,g,p.createAndFill());v.setSelection(ot.near(v.doc.resolve(g),1)),e(v.scrollIntoView())}return!0}function C0(t,e){var r=t.selection,o=r.$from,a=r.$to;if(r instanceof as||o.parent.inlineContent||a.parent.inlineContent)return!1;var l=lA(a.parent.contentMatchAt(a.indexAfter()));if(!l||!l.isTextblock)return!1;if(e){var d=(!o.parentOffset&&a.index()<a.parent.childCount?o:a).pos,p=t.tr.insert(d,l.createAndFill());p.setSelection(Dt.create(p.doc,d+1)),e(p.scrollIntoView())}return!0}function y0(t,e){var r=t.selection,o=r.$cursor;if(!o||o.parent.content.size)return!1;if(o.depth>1&&o.after()!=o.end(-1)){var a=o.before();if(ss(t.doc,a))return e&&e(t.tr.split(a).scrollIntoView()),!0}var l=o.blockRange(),d=l&&_c(l);return d==null?!1:(e&&e(t.tr.lift(l,d).scrollIntoView()),!0)}function fk(t,e){var r=t.selection,o=r.$from,a=r.$to;if(t.selection instanceof tt&&t.selection.node.isBlock)return!o.parentOffset||!ss(t.doc,o.pos)?!1:(e&&e(t.tr.split(o.pos).scrollIntoView()),!0);if(!o.parent.isBlock)return!1;if(e){var l=a.parentOffset==a.parent.content.size,d=t.tr;(t.selection instanceof Dt||t.selection instanceof as)&&d.deleteSelection();var p=o.depth==0?null:lA(o.node(-1).contentMatchAt(o.indexAfter(-1))),g=l&&p?[{type:p}]:null,v=ss(d.doc,d.mapping.map(o.pos),1,g);if(!g&&!v&&ss(d.doc,d.mapping.map(o.pos),1,p&&[{type:p}])&&(g=[{type:p}],v=!0),v&&(d.split(d.mapping.map(o.pos),1,g),!l&&!o.parentOffset&&o.parent.type!=p)){var C=d.mapping.map(o.before()),y=d.doc.resolve(C);o.node(-1).canReplaceWith(y.index(),y.index()+1,p)&&d.setNodeMarkup(d.mapping.map(o.before()),p)}e(d.scrollIntoView())}return!0}function Ak(t,e){var r=t.selection,o=r.$from,a=r.to,l,d=o.sharedDepth(a);return d==0?!1:(l=o.before(d),e&&e(t.tr.setSelection(tt.create(t.doc,l))),!0)}function gk(t,e){return e&&e(t.tr.setSelection(new as(t.doc))),!0}function mk(t,e,r){var o=e.nodeBefore,a=e.nodeAfter,l=e.index();return!o||!a||!o.type.compatibleContent(a.type)?!1:!o.content.size&&e.parent.canReplace(l-1,l)?(r&&r(t.tr.delete(e.pos-o.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(l,l+1)||!(a.isTextblock||eA(t.doc,e.pos))?!1:(r&&r(t.tr.clearIncompatible(e.pos,o.type,o.contentMatchAt(o.childCount)).join(e.pos).scrollIntoView()),!0)}function _0(t,e,r){var o=e.nodeBefore,a=e.nodeAfter,l,d;if(o.type.spec.isolating||a.type.spec.isolating)return!1;if(mk(t,e,r))return!0;var p=e.parent.canReplace(e.index(),e.index()+1);if(p&&(l=(d=o.contentMatchAt(o.childCount)).findWrapping(a.type))&&d.matchType(l[0]||a.type).validEnd){if(r){for(var g=e.pos+a.nodeSize,v=ee.empty,C=l.length-1;C>=0;C--)v=ee.from(l[C].create(null,v));v=ee.from(o.copy(v));var y=t.tr.step(new si(e.pos-1,g,e.pos,g,new ye(v,1,0),l.length,!0)),w=g+2*l.length;eA(y.doc,w)&&y.join(w),r(y.scrollIntoView())}return!0}var k=ot.findFrom(e,1),M=k&&k.$from.blockRange(k.$to),x=M&&_c(M);if(x!=null&&x>=e.depth)return r&&r(t.tr.lift(M,x).scrollIntoView()),!0;if(p&&Tc(a,"start",!0)&&Tc(o,"end")){for(var V=o,Y=[];Y.push(V),!V.isTextblock;)V=V.lastChild;for(var H=a,he=1;!H.isTextblock;H=H.firstChild)he++;if(V.canReplace(V.childCount,V.childCount,H.content)){if(r){for(var Q=ee.empty,pe=Y.length-1;pe>=0;pe--)Q=ee.from(Y[pe].copy(Q));var oe=t.tr.step(new si(e.pos-Y.length,e.pos+a.nodeSize,e.pos+he,e.pos+a.nodeSize-he,new ye(Q,Y.length,0),0,!0));r(oe.scrollIntoView())}return!0}}return!1}function S0(t,e){return function(r,o){var a=r.selection,l=a.$from,d=a.$to,p=l.blockRange(d),g=p&&Zf(p,t,e);return g?(o&&o(r.tr.wrap(p,g).scrollIntoView()),!0):!1}}function vk(t,e){return function(r,o){var a=r.selection,l=a.from,d=a.to,p=!1;return r.doc.nodesBetween(l,d,function(g,v){if(p)return!1;if(!(!g.isTextblock||g.hasMarkup(t,e)))if(g.type==t)p=!0;else{var C=r.doc.resolve(v),y=C.index();p=C.parent.canReplaceWith(y,y+1,t)}}),p?(o&&o(r.tr.setBlockType(l,d,t,e).scrollIntoView()),!0):!1}}function uA(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return function(r,o,a){for(var l=0;l<t.length;l++)if(t[l](r,o,a))return!0;return!1}}var dA=uA(cA,h0,p0),T0=uA(cA,A0,g0),Ns={Enter:uA(E0,C0,y0,fk),"Mod-Enter":I0,Backspace:dA,"Mod-Backspace":dA,"Shift-Backspace":dA,Delete:T0,"Mod-Delete":T0,"Mod-a":gk},Ek={"Ctrl-h":Ns.Backspace,"Alt-Backspace":Ns["Mod-Backspace"],"Ctrl-d":Ns.Delete,"Ctrl-Alt-Backspace":Ns["Mod-Delete"],"Alt-Delete":Ns["Mod-Delete"],"Alt-d":Ns["Mod-Delete"]};for(var R0 in Ns)Ek[R0]=Ns[R0];typeof navigator!="undefined"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os!="undefined"&&os.platform()=="darwin";function Ik(t,e){return function(r,o){var a=r.selection,l=a.$from,d=a.$to,p=l.blockRange(d),g=!1,v=p;if(!p)return!1;if(p.depth>=2&&l.node(p.depth-1).type.compatibleContent(t)&&p.startIndex==0){if(l.index(p.depth-1)==0)return!1;var C=r.doc.resolve(p.start-2);v=new Ml(C,C,p.depth),p.endIndex<p.parent.childCount&&(p=new Ml(l,r.doc.resolve(d.end(p.depth)),p.depth)),g=!0}var y=Zf(v,t,e,p);return y?(o&&o(Ck(r.tr,p,y,g,t).scrollIntoView()),!0):!1}}function Ck(t,e,r,o,a){for(var l=ee.empty,d=r.length-1;d>=0;d--)l=ee.from(r[d].type.create(r[d].attrs,l));t.step(new si(e.start-(o?2:0),e.end,e.start,e.end,new ye(l,0,0),r.length,!0));for(var p=0,g=0;g<r.length;g++)r[g].type==a&&(p=g+1);for(var v=r.length-p,C=e.start+r.length-(o?2:0),y=e.parent,w=e.startIndex,k=e.endIndex,M=!0;w<k;w++,M=!1)!M&&ss(t.doc,C,v)&&(t.split(C,v),C+=2*v),C+=y.child(w).nodeSize;return t}function yk(t){return function(e,r){var o=e.selection,a=o.$from,l=o.$to,d=a.blockRange(l,function(p){return p.childCount&&p.firstChild.type==t});return d?r?a.node(d.depth-1).type==t?_k(e,r,t,d):Sk(e,r,d):!0:!1}}function _k(t,e,r,o){var a=t.tr,l=o.end,d=o.$to.end(o.depth);return l<d&&(a.step(new si(l-1,d,l,d,new ye(ee.from(r.create(null,o.parent.copy())),1,0),1,!0)),o=new Ml(a.doc.resolve(o.$from.pos),a.doc.resolve(d),o.depth)),e(a.lift(o,_c(o)).scrollIntoView()),!0}function Sk(t,e,r){for(var o=t.tr,a=r.parent,l=r.end,d=r.endIndex-1,p=r.startIndex;d>p;d--)l-=a.child(d).nodeSize,o.delete(l-1,l+1);var g=o.doc.resolve(r.start),v=g.nodeAfter;if(o.mapping.map(r.end)!=r.start+g.nodeAfter.nodeSize)return!1;var C=r.startIndex==0,y=r.endIndex==a.childCount,w=g.node(-1),k=g.index(-1);if(!w.canReplace(k+(C?0:1),k+1,v.content.append(y?ee.empty:ee.from(a))))return!1;var M=g.pos,x=M+v.nodeSize;return o.step(new si(M-(C?1:0),x+(y?1:0),M+1,x-1,new ye((C?ee.empty:ee.from(a.copy(ee.empty))).append(y?ee.empty:ee.from(a.copy(ee.empty))),C?0:1,y?0:1),C?0:1)),e(o.scrollIntoView()),!0}function Tk(t){return function(e,r){var o=e.selection,a=o.$from,l=o.$to,d=a.blockRange(l,function(x){return x.childCount&&x.firstChild.type==t});if(!d)return!1;var p=d.startIndex;if(p==0)return!1;var g=d.parent,v=g.child(p-1);if(v.type!=t)return!1;if(r){var C=v.lastChild&&v.lastChild.type==g.type,y=ee.from(C?t.create():null),w=new ye(ee.from(t.create(null,ee.from(g.type.create(null,y)))),C?3:1,0),k=d.start,M=d.end;r(e.tr.step(new si(k-(C?3:1),M,k,M,w,1,!0)).scrollIntoView())}return!0}}var ce={};if(typeof navigator!="undefined"&&typeof document!="undefined"){var hA=/Edge\/(\d+)/.exec(navigator.userAgent),w0=/MSIE \d/.test(navigator.userAgent),pA=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),fA=ce.ie=!!(w0||pA||hA);ce.ie_version=w0?document.documentMode||6:pA?+pA[1]:hA?+hA[1]:null,ce.gecko=!fA&&/gecko\/(\d+)/i.test(navigator.userAgent),ce.gecko_version=ce.gecko&&+(/Firefox\/(\d+)/.exec(navigator.userAgent)||[0,0])[1];var AA=!fA&&/Chrome\/(\d+)/.exec(navigator.userAgent);ce.chrome=!!AA,ce.chrome_version=AA&&+AA[1],ce.safari=!fA&&/Apple Computer/.test(navigator.vendor),ce.ios=ce.safari&&(/Mobile\/\w+/.test(navigator.userAgent)||navigator.maxTouchPoints>2),ce.mac=ce.ios||/Mac/.test(navigator.platform),ce.android=/Android \d/.test(navigator.userAgent),ce.webkit="webkitFontSmoothing"in document.documentElement.style,ce.webkit_version=ce.webkit&&+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]}var _i=function(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e},gA=function(t){var e=t.assignedSlot||t.parentNode;return e&&e.nodeType==11?e.host:e},N0=null,cs=function(t,e,r){var o=N0||(N0=document.createRange());return o.setEnd(t,r==null?t.nodeValue.length:r),o.setStart(t,e||0),o},Fd=function(t,e,r,o){return r&&(O0(t,e,r,o,-1)||O0(t,e,r,o,1))},Rk=/^(img|br|input|textarea|hr)$/i;function O0(t,e,r,o,a){for(;;){if(t==r&&e==o)return!0;if(e==(a<0?0:Do(t))){var l=t.parentNode;if(l.nodeType!=1||Nk(t)||Rk.test(t.nodeName)||t.contentEditable=="false")return!1;e=_i(t)+(a<0?0:1),t=l}else if(t.nodeType==1){if(t=t.childNodes[e+(a<0?-1:0)],t.contentEditable=="false")return!1;e=a<0?Do(t):0}else return!1}}function Do(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function wk(t,e,r){for(var o=e==0,a=e==Do(t);o||a;){if(t==r)return!0;var l=_i(t);if(t=t.parentNode,!t)return!1;o=o&&l==0,a=a&&l==Do(t)}}function Nk(t){for(var e,r=t;r&&!(e=r.pmViewDesc);r=r.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}var mA=function(t){var e=t.isCollapsed;return e&&ce.chrome&&t.rangeCount&&!t.getRangeAt(0).collapsed&&(e=!1),e};function Rc(t,e){var r=document.createEvent("Event");return r.initEvent("keydown",!0,!0),r.keyCode=t,r.key=r.code=e,r}function Ok(t){return{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function Os(t,e){return typeof t=="number"?t:t[e]}function kk(t){var e=t.getBoundingClientRect(),r=e.width/t.offsetWidth||1,o=e.height/t.offsetHeight||1;return{left:e.left,right:e.left+t.clientWidth*r,top:e.top,bottom:e.top+t.clientHeight*o}}function k0(t,e,r){for(var o=t.someProp("scrollThreshold")||0,a=t.someProp("scrollMargin")||5,l=t.dom.ownerDocument,d=r||t.dom;d;d=gA(d))if(d.nodeType==1){var p=d==l.body||d.nodeType!=1,g=p?Ok(l):kk(d),v=0,C=0;if(e.top<g.top+Os(o,"top")?C=-(g.top-e.top+Os(a,"top")):e.bottom>g.bottom-Os(o,"bottom")&&(C=e.bottom-g.bottom+Os(a,"bottom")),e.left<g.left+Os(o,"left")?v=-(g.left-e.left+Os(a,"left")):e.right>g.right-Os(o,"right")&&(v=e.right-g.right+Os(a,"right")),v||C)if(p)l.defaultView.scrollBy(v,C);else{var y=d.scrollLeft,w=d.scrollTop;C&&(d.scrollTop+=C),v&&(d.scrollLeft+=v);var k=d.scrollLeft-y,M=d.scrollTop-w;e={left:e.left-k,top:e.top-M,right:e.right-k,bottom:e.bottom-M}}if(p)break}}function bk(t){for(var e=t.dom.getBoundingClientRect(),r=Math.max(0,e.top),o,a,l=(e.left+e.right)/2,d=r+1;d<Math.min(innerHeight,e.bottom);d+=5){var p=t.root.elementFromPoint(l,d);if(!(p==t.dom||!t.dom.contains(p))){var g=p.getBoundingClientRect();if(g.top>=r-20){o=p,a=g.top;break}}}return{refDOM:o,refTop:a,stack:b0(t.dom)}}function b0(t){for(var e=[],r=t.ownerDocument;t&&(e.push({dom:t,top:t.scrollTop,left:t.scrollLeft}),t!=r);t=gA(t));return e}function Dk(t){var e=t.refDOM,r=t.refTop,o=t.stack,a=e?e.getBoundingClientRect().top:0;D0(o,a==0?0:a-r)}function D0(t,e){for(var r=0;r<t.length;r++){var o=t[r],a=o.dom,l=o.top,d=o.left;a.scrollTop!=l+e&&(a.scrollTop=l+e),a.scrollLeft!=d&&(a.scrollLeft=d)}}var wc=null;function Bk(t){if(t.setActive)return t.setActive();if(wc)return t.focus(wc);var e=b0(t);t.focus(wc==null?{get preventScroll(){return wc={preventScroll:!0},!0}}:void 0),wc||(wc=!1,D0(e,0))}function B0(t,e){for(var r,o=2e8,a,l=0,d=e.top,p=e.top,g=t.firstChild,v=0;g;g=g.nextSibling,v++){var C=void 0;if(g.nodeType==1)C=g.getClientRects();else if(g.nodeType==3)C=cs(g).getClientRects();else continue;for(var y=0;y<C.length;y++){var w=C[y];if(w.top<=d&&w.bottom>=p){d=Math.max(w.bottom,d),p=Math.min(w.top,p);var k=w.left>e.left?w.left-e.left:w.right<e.left?e.left-w.right:0;if(k<o){r=g,o=k,a=k&&r.nodeType==3?{left:w.right<e.left?w.right:w.left,top:e.top}:e,g.nodeType==1&&k&&(l=v+(e.left>=(w.left+w.right)/2?1:0));continue}}!r&&(e.left>=w.right&&e.top>=w.top||e.left>=w.left&&e.top>=w.bottom)&&(l=v+1)}}return r&&r.nodeType==3?Mk(r,a):!r||o&&r.nodeType==1?{node:t,offset:l}:B0(r,a)}function Mk(t,e){for(var r=t.nodeValue.length,o=document.createRange(),a=0;a<r;a++){o.setEnd(t,a+1),o.setStart(t,a);var l=ks(o,1);if(l.top!=l.bottom&&vA(e,l))return{node:t,offset:a+(e.left>=(l.left+l.right)/2?1:0)}}return{node:t,offset:0}}function vA(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function Lk(t,e){var r=t.parentNode;return r&&/^li$/i.test(r.nodeName)&&e.left<t.getBoundingClientRect().left?r:t}function Pk(t,e,r){var o=B0(e,r),a=o.node,l=o.offset,d=-1;if(a.nodeType==1&&!a.firstChild){var p=a.getBoundingClientRect();d=p.left!=p.right&&r.left>(p.left+p.right)/2?1:-1}return t.docView.posFromDOM(a,l,d)}function xk(t,e,r,o){for(var a=-1,l=e;l!=t.dom;){var d=t.docView.nearestDesc(l,!0);if(!d)return null;if(d.node.isBlock&&d.parent){var p=d.dom.getBoundingClientRect();if(p.left>o.left||p.top>o.top)a=d.posBefore;else if(p.right<o.left||p.bottom<o.top)a=d.posAfter;else break}l=d.dom.parentNode}return a>-1?a:t.docView.posFromDOM(e,r)}function M0(t,e,r){var o=t.childNodes.length;if(o&&r.top<r.bottom)for(var a=Math.max(0,Math.min(o-1,Math.floor(o*(e.top-r.top)/(r.bottom-r.top))-2)),l=a;;){var d=t.childNodes[l];if(d.nodeType==1)for(var p=d.getClientRects(),g=0;g<p.length;g++){var v=p[g];if(vA(e,v))return M0(d,e,v)}if((l=(l+1)%o)==a)break}return t}function Qk(t,e){var r,o,a=t.dom.ownerDocument,l,d;if(a.caretPositionFromPoint)try{var p=a.caretPositionFromPoint(e.left,e.top);p&&(r=p,l=r.offsetNode,d=r.offset)}catch{}if(!l&&a.caretRangeFromPoint){var g=a.caretRangeFromPoint(e.left,e.top);g&&(o=g,l=o.startContainer,d=o.startOffset)}var v=(t.root.elementFromPoint?t.root:a).elementFromPoint(e.left,e.top+1),C;if(!v||!t.dom.contains(v.nodeType!=1?v.parentNode:v)){var y=t.dom.getBoundingClientRect();if(!vA(e,y)||(v=M0(t.dom,e,y),!v))return null}if(ce.safari)for(var w=v;l&&w;w=gA(w))w.draggable&&(l=d=null);if(v=Lk(v,e),l){if(ce.gecko&&l.nodeType==1&&(d=Math.min(d,l.childNodes.length),d<l.childNodes.length)){var k=l.childNodes[d],M;k.nodeName=="IMG"&&(M=k.getBoundingClientRect()).right<=e.left&&M.bottom>e.top&&d++}l==t.dom&&d==l.childNodes.length-1&&l.lastChild.nodeType==1&&e.top>l.lastChild.getBoundingClientRect().bottom?C=t.state.doc.content.size:(d==0||l.nodeType!=1||l.childNodes[d-1].nodeName!="BR")&&(C=xk(t,l,d,e))}C==null&&(C=Pk(t,v,e));var x=t.docView.nearestDesc(v,!0);return{pos:C,inside:x?x.posAtStart-x.border:-1}}function ks(t,e){var r=t.getClientRects();return r.length?r[e<0?0:r.length-1]:t.getBoundingClientRect()}var Uk=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function L0(t,e,r){var o=t.docView.domFromPos(e,r<0?-1:1),a=o.node,l=o.offset,d=ce.webkit||ce.gecko;if(a.nodeType==3)if(d&&(Uk.test(a.nodeValue)||(r<0?!l:l==a.nodeValue.length))){var p=ks(cs(a,l,l),r);if(ce.gecko&&l&&/\s/.test(a.nodeValue[l-1])&&l<a.nodeValue.length){var g=ks(cs(a,l-1,l-1),-1);if(g.top==p.top){var v=ks(cs(a,l,l+1),-1);if(v.top!=p.top)return jl(v,v.left<g.left)}}return p}else{var C=l,y=l,w=r<0?1:-1;return r<0&&!l?(y++,w=-1):r>=0&&l==a.nodeValue.length?(C--,w=1):r<0?C--:y++,jl(ks(cs(a,C,y),w),w<0)}if(!t.state.doc.resolve(e).parent.inlineContent){if(l&&(r<0||l==Do(a))){var k=a.childNodes[l-1];if(k.nodeType==1)return EA(k.getBoundingClientRect(),!1)}if(l<Do(a)){var M=a.childNodes[l];if(M.nodeType==1)return EA(M.getBoundingClientRect(),!0)}return EA(a.getBoundingClientRect(),r>=0)}if(l&&(r<0||l==Do(a))){var x=a.childNodes[l-1],V=x.nodeType==3?cs(x,Do(x)-(d?0:1)):x.nodeType==1&&(x.nodeName!="BR"||!x.nextSibling)?x:null;if(V)return jl(ks(V,1),!1)}if(l<Do(a)){for(var Y=a.childNodes[l];Y.pmViewDesc&&Y.pmViewDesc.ignoreForCoords;)Y=Y.nextSibling;var H=Y?Y.nodeType==3?cs(Y,0,d?0:1):Y.nodeType==1?Y:null:null;if(H)return jl(ks(H,-1),!0)}return jl(ks(a.nodeType==3?cs(a):a,-r),r>=0)}function jl(t,e){if(t.width==0)return t;var r=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:r,right:r}}function EA(t,e){if(t.height==0)return t;var r=e?t.top:t.bottom;return{top:r,bottom:r,left:t.left,right:t.right}}function P0(t,e,r){var o=t.state,a=t.root.activeElement;o!=e&&t.updateState(e),a!=t.dom&&t.focus();try{return r()}finally{o!=e&&t.updateState(o),a!=t.dom&&a&&a.focus()}}function Fk(t,e,r){var o=e.selection,a=r=="up"?o.$from:o.$to;return P0(t,e,function(){for(var l=t.docView.domFromPos(a.pos,r=="up"?-1:1),d=l.node;;){var p=t.docView.nearestDesc(d,!0);if(!p)break;if(p.node.isBlock){d=p.dom;break}d=p.dom.parentNode}for(var g=L0(t,a.pos,1),v=d.firstChild;v;v=v.nextSibling){var C=void 0;if(v.nodeType==1)C=v.getClientRects();else if(v.nodeType==3)C=cs(v,0,v.nodeValue.length).getClientRects();else continue;for(var y=0;y<C.length;y++){var w=C[y];if(w.bottom>w.top+1&&(r=="up"?g.top-w.top>(w.bottom-g.top)*2:w.bottom-g.bottom>(g.bottom-w.top)*2))return!1}}return!0})}var Vk=/[\u0590-\u08ac]/;function Gk(t,e,r){var o=e.selection,a=o.$head;if(!a.parent.isTextblock)return!1;var l=a.parentOffset,d=!l,p=l==a.parent.content.size,g=t.root.getSelection();return!Vk.test(a.parent.textContent)||!g.modify?r=="left"||r=="backward"?d:p:P0(t,e,function(){var v=g.getRangeAt(0),C=g.focusNode,y=g.focusOffset,w=g.caretBidiLevel;g.modify("move",r,"character");var k=a.depth?t.docView.domAfterPos(a.before()):t.dom,M=!k.contains(g.focusNode.nodeType==1?g.focusNode:g.focusNode.parentNode)||C==g.focusNode&&y==g.focusOffset;return g.removeAllRanges(),g.addRange(v),w!=null&&(g.caretBidiLevel=w),M})}var x0=null,Q0=null,U0=!1;function jk(t,e,r){return x0==e&&Q0==r?U0:(x0=e,Q0=r,U0=r=="up"||r=="down"?Fk(t,e,r):Gk(t,e,r))}var uo=0,F0=1,Hl=2,bs=3,$t=function(e,r,o,a){this.parent=e,this.children=r,this.dom=o,o.pmViewDesc=this,this.contentDOM=a,this.dirty=uo},Bo={size:{configurable:!0},border:{configurable:!0},posBefore:{configurable:!0},posAtStart:{configurable:!0},posAfter:{configurable:!0},posAtEnd:{configurable:!0},contentLost:{configurable:!0},domAtom:{configurable:!0},ignoreForCoords:{configurable:!0}};$t.prototype.matchesWidget=function(){return!1};$t.prototype.matchesMark=function(){return!1};$t.prototype.matchesNode=function(){return!1};$t.prototype.matchesHack=function(e){return!1};$t.prototype.parseRule=function(){return null};$t.prototype.stopEvent=function(){return!1};Bo.size.get=function(){for(var t=0,e=0;e<this.children.length;e++)t+=this.children[e].size;return t};Bo.border.get=function(){return 0};$t.prototype.destroy=function(){this.parent=null,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=null);for(var e=0;e<this.children.length;e++)this.children[e].destroy()};$t.prototype.posBeforeChild=function(e){for(var r=0,o=this.posAtStart;r<this.children.length;r++){var a=this.children[r];if(a==e)return o;o+=a.size}};Bo.posBefore.get=function(){return this.parent.posBeforeChild(this)};Bo.posAtStart.get=function(){return this.parent?this.parent.posBeforeChild(this)+this.border:0};Bo.posAfter.get=function(){return this.posBefore+this.size};Bo.posAtEnd.get=function(){return this.posAtStart+this.size-2*this.border};$t.prototype.localPosFromDOM=function(e,r,o){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(o<0){var a,l;if(e==this.contentDOM)a=e.childNodes[r-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;a=e.previousSibling}for(;a&&!((l=a.pmViewDesc)&&l.parent==this);)a=a.previousSibling;return a?this.posBeforeChild(l)+l.size:this.posAtStart}else{var d,p;if(e==this.contentDOM)d=e.childNodes[r];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;d=e.nextSibling}for(;d&&!((p=d.pmViewDesc)&&p.parent==this);)d=d.nextSibling;return d?this.posBeforeChild(p):this.posAtEnd}var g;if(e==this.dom&&this.contentDOM)g=r>_i(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))g=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(r==0)for(var v=e;;v=v.parentNode){if(v==this.dom){g=!1;break}if(v.parentNode.firstChild!=v)break}if(g==null&&r==e.childNodes.length)for(var C=e;;C=C.parentNode){if(C==this.dom){g=!0;break}if(C.parentNode.lastChild!=C)break}}return(g==null?o>0:g)?this.posAtEnd:this.posAtStart};$t.prototype.nearestDesc=function(e,r){for(var o=!0,a=e;a;a=a.parentNode){var l=this.getDesc(a);if(l&&(!r||l.node))if(o&&l.nodeDOM&&!(l.nodeDOM.nodeType==1?l.nodeDOM.contains(e.nodeType==1?e:e.parentNode):l.nodeDOM==e))o=!1;else return l}};$t.prototype.getDesc=function(e){for(var r=e.pmViewDesc,o=r;o;o=o.parent)if(o==this)return r};$t.prototype.posFromDOM=function(e,r,o){for(var a=e;a;a=a.parentNode){var l=this.getDesc(a);if(l)return l.localPosFromDOM(e,r,o)}return-1};$t.prototype.descAt=function(e){for(var r=0,o=0;r<this.children.length;r++){var a=this.children[r],l=o+a.size;if(o==e&&l!=o){for(;!a.border&&a.children.length;)a=a.children[0];return a}if(e<l)return a.descAt(e-o-a.border);o=l}};$t.prototype.domFromPos=function(e,r){if(!this.contentDOM)return{node:this.dom,offset:0};for(var o=0,a=0,l=0;o<this.children.length;o++){var d=this.children[o],p=l+d.size;if(p>e||d instanceof H0){a=e-l;break}l=p}if(a)return this.children[o].domFromPos(a-this.children[o].border,r);for(var g=void 0;o&&!(g=this.children[o-1]).size&&g instanceof V0&&g.widget.type.side>=0;o--);if(r<=0){for(var v,C=!0;v=o?this.children[o-1]:null,!(!v||v.dom.parentNode==this.contentDOM);o--,C=!1);return v&&r&&C&&!v.border&&!v.domAtom?v.domFromPos(v.size,r):{node:this.contentDOM,offset:v?_i(v.dom)+1:0}}else{for(var y,w=!0;y=o<this.children.length?this.children[o]:null,!(!y||y.dom.parentNode==this.contentDOM);o++,w=!1);return y&&w&&!y.border&&!y.domAtom?y.domFromPos(0,r):{node:this.contentDOM,offset:y?_i(y.dom):this.contentDOM.childNodes.length}}};$t.prototype.parseRange=function(e,r,o){if(o===void 0&&(o=0),this.children.length==0)return{node:this.contentDOM,from:e,to:r,fromOffset:0,toOffset:this.contentDOM.childNodes.length};for(var a=-1,l=-1,d=o,p=0;;p++){var g=this.children[p],v=d+g.size;if(a==-1&&e<=v){var C=d+g.border;if(e>=C&&r<=v-g.border&&g.node&&g.contentDOM&&this.contentDOM.contains(g.contentDOM))return g.parseRange(e,r,C);e=d;for(var y=p;y>0;y--){var w=this.children[y-1];if(w.size&&w.dom.parentNode==this.contentDOM&&!w.emptyChildAt(1)){a=_i(w.dom)+1;break}e-=w.size}a==-1&&(a=0)}if(a>-1&&(v>r||p==this.children.length-1)){r=v;for(var k=p+1;k<this.children.length;k++){var M=this.children[k];if(M.size&&M.dom.parentNode==this.contentDOM&&!M.emptyChildAt(-1)){l=_i(M.dom);break}r+=M.size}l==-1&&(l=this.contentDOM.childNodes.length);break}d=v}return{node:this.contentDOM,from:e,to:r,fromOffset:a,toOffset:l}};$t.prototype.emptyChildAt=function(e){if(this.border||!this.contentDOM||!this.children.length)return!1;var r=this.children[e<0?0:this.children.length-1];return r.size==0||r.emptyChildAt(e)};$t.prototype.domAfterPos=function(e){var r=this.domFromPos(e,0),o=r.node,a=r.offset;if(o.nodeType!=1||a==o.childNodes.length)throw new RangeError("No node after pos "+e);return o.childNodes[a]};$t.prototype.setSelection=function(e,r,o,a){for(var l=Math.min(e,r),d=Math.max(e,r),p=0,g=0;p<this.children.length;p++){var v=this.children[p],C=g+v.size;if(l>g&&d<C)return v.setSelection(e-g-v.border,r-g-v.border,o,a);g=C}var y=this.domFromPos(e,e?-1:1),w=r==e?y:this.domFromPos(r,r?-1:1),k=o.getSelection(),M=!1;if((ce.gecko||ce.safari)&&e==r){var x=y.node,V=y.offset;if(x.nodeType==3){if(M=V&&x.nodeValue[V-1]==`
`,M&&V==x.nodeValue.length)for(var Y=x,H=void 0;Y;Y=Y.parentNode){if(H=Y.nextSibling){H.nodeName=="BR"&&(y=w={node:H.parentNode,offset:_i(H)+1});break}var he=Y.pmViewDesc;if(he&&he.node&&he.node.isBlock)break}}else{var Q=x.childNodes[V-1];M=Q&&(Q.nodeName=="BR"||Q.contentEditable=="false")}}if(ce.gecko&&k.focusNode&&k.focusNode!=w.node&&k.focusNode.nodeType==1){var pe=k.focusNode.childNodes[k.focusOffset];pe&&pe.contentEditable=="false"&&(a=!0)}if(!(!(a||M&&ce.safari)&&Fd(y.node,y.offset,k.anchorNode,k.anchorOffset)&&Fd(w.node,w.offset,k.focusNode,k.focusOffset))){var oe=!1;if((k.extend||e==r)&&!M){k.collapse(y.node,y.offset);try{e!=r&&k.extend(w.node,w.offset),oe=!0}catch(Pe){if(!(Pe instanceof DOMException))throw Pe}}if(!oe){if(e>r){var me=y;y=w,w=me}var xe=document.createRange();xe.setEnd(w.node,w.offset),xe.setStart(y.node,y.offset),k.removeAllRanges(),k.addRange(xe)}}};$t.prototype.ignoreMutation=function(e){return!this.contentDOM&&e.type!="selection"};Bo.contentLost.get=function(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)};$t.prototype.markDirty=function(e,r){for(var o=0,a=0;a<this.children.length;a++){var l=this.children[a],d=o+l.size;if(o==d?e<=d&&r>=o:e<d&&r>o){var p=o+l.border,g=d-l.border;if(e>=p&&r<=g){this.dirty=e==o||r==d?Hl:F0,e==p&&r==g&&(l.contentLost||l.dom.parentNode!=this.contentDOM)?l.dirty=bs:l.markDirty(e-p,r-p);return}else l.dirty=l.dom==l.contentDOM&&l.dom.parentNode==this.contentDOM?Hl:bs}o=d}this.dirty=Hl};$t.prototype.markParentsDirty=function(){for(var e=1,r=this.parent;r;r=r.parent,e++){var o=e==1?Hl:F0;r.dirty<o&&(r.dirty=o)}};Bo.domAtom.get=function(){return!1};Bo.ignoreForCoords.get=function(){return!1};Object.defineProperties($t.prototype,Bo);var Ds=[],V0=function(t){function e(o,a,l,d){var p,g=a.type.toDOM;if(typeof g=="function"&&(g=g(l,function(){if(!p)return d;if(p.parent)return p.parent.posBeforeChild(p)})),!a.type.spec.raw){if(g.nodeType!=1){var v=document.createElement("span");v.appendChild(g),g=v}g.contentEditable=!1,g.classList.add("ProseMirror-widget")}t.call(this,o,Ds,g,null),this.widget=a,p=this}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={domAtom:{configurable:!0}};return e.prototype.matchesWidget=function(a){return this.dirty==uo&&a.type.eq(this.widget.type)},e.prototype.parseRule=function(){return{ignore:!0}},e.prototype.stopEvent=function(a){var l=this.widget.spec.stopEvent;return l?l(a):!1},e.prototype.ignoreMutation=function(a){return a.type!="selection"||this.widget.spec.ignoreSelection},r.domAtom.get=function(){return!0},Object.defineProperties(e.prototype,r),e}($t),Hk=function(t){function e(o,a,l,d){t.call(this,o,Ds,a,null),this.textDOM=l,this.text=d}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={size:{configurable:!0}};return r.size.get=function(){return this.text.length},e.prototype.localPosFromDOM=function(a,l){return a!=this.textDOM?this.posAtStart+(l?this.size:0):this.posAtStart+l},e.prototype.domFromPos=function(a){return{node:this.textDOM,offset:a}},e.prototype.ignoreMutation=function(a){return a.type==="characterData"&&a.target.nodeValue==a.oldValue},Object.defineProperties(e.prototype,r),e}($t),IA=function(t){function e(r,o,a,l){t.call(this,r,[],a,l),this.mark=o}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.create=function(o,a,l,d){var p=d.nodeViews[a.type.name],g=p&&p(a,d,l);return(!g||!g.dom)&&(g=pn.renderSpec(document,a.type.spec.toDOM(a,l))),new e(o,a,g.dom,g.contentDOM||g.dom)},e.prototype.parseRule=function(){return{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}},e.prototype.matchesMark=function(o){return this.dirty!=bs&&this.mark.eq(o)},e.prototype.markDirty=function(o,a){if(t.prototype.markDirty.call(this,o,a),this.dirty!=uo){for(var l=this.parent;!l.node;)l=l.parent;l.dirty<this.dirty&&(l.dirty=this.dirty),this.dirty=uo}},e.prototype.slice=function(o,a,l){var d=e.create(this.parent,this.mark,!0,l),p=this.children,g=this.size;a<g&&(p=_A(p,a,g,l)),o>0&&(p=_A(p,0,o,l));for(var v=0;v<p.length;v++)p[v].parent=d;return d.children=p,d},e}($t),Kl=function(t){function e(o,a,l,d,p,g,v,C,y){t.call(this,o,a.isLeaf?Ds:[],p,g),this.nodeDOM=v,this.node=a,this.outerDeco=l,this.innerDeco=d,g&&this.updateChildren(C,y)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={size:{configurable:!0},border:{configurable:!0},domAtom:{configurable:!0}};return e.create=function(a,l,d,p,g,v){var C,y=g.nodeViews[l.type.name],w,k=y&&y(l,g,function(){if(!w)return v;if(w.parent)return w.parent.posBeforeChild(w)},d,p),M=k&&k.dom,x=k&&k.contentDOM;if(l.isText){if(!M)M=document.createTextNode(l.text);else if(M.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else M||(C=pn.renderSpec(document,l.type.spec.toDOM(l)),M=C.dom,x=C.contentDOM);!x&&!l.isText&&M.nodeName!="BR"&&(M.hasAttribute("contenteditable")||(M.contentEditable=!1),l.type.spec.draggable&&(M.draggable=!0));var V=M;return M=Y0(M,d,l),k?w=new Kk(a,l,d,p,M,x,V,k,g,v+1):l.isText?new j0(a,l,d,p,M,V,g):new e(a,l,d,p,M,x,V,g,v+1)},e.prototype.parseRule=function(){var a=this;if(this.node.type.spec.reparseInView)return null;var l={node:this.node.type.name,attrs:this.node.attrs};return this.node.type.spec.code&&(l.preserveWhitespace="full"),this.contentDOM&&!this.contentLost?l.contentElement=this.contentDOM:l.getContent=function(){return a.contentDOM?ee.empty:a.node.content},l},e.prototype.matchesNode=function(a,l,d){return this.dirty==uo&&a.eq(this.node)&&yA(l,this.outerDeco)&&d.eq(this.innerDeco)},r.size.get=function(){return this.node.nodeSize},r.border.get=function(){return this.node.isLeaf?0:1},e.prototype.updateChildren=function(a,l){var d=this,p=this.node.inlineContent,g=l,v=a.composing&&this.localCompositionInfo(a,l),C=v&&v.pos>-1?v:null,y=v&&v.pos<0,w=new ji(this,C&&C.node);Jk(this.node,this.innerDeco,function(k,M,x){k.spec.marks?w.syncToMarks(k.spec.marks,p,a):k.type.side>=0&&!x&&w.syncToMarks(M==d.node.childCount?Ct.none:d.node.child(M).marks,p,a),w.placeWidget(k,a,g)},function(k,M,x,V){w.syncToMarks(k.marks,p,a);var Y;w.findNodeMatch(k,M,x,V)||y&&a.state.selection.from>g&&a.state.selection.to<g+k.nodeSize&&(Y=w.findIndexWithChild(v.node))>-1&&w.updateNodeAt(k,M,x,Y,a)||w.updateNextNode(k,M,x,a,V)||w.addNode(k,M,x,a,g),g+=k.nodeSize}),w.syncToMarks(Ds,p,a),this.node.isTextblock&&w.addTextblockHacks(),w.destroyRest(),(w.changed||this.dirty==Hl)&&(C&&this.protectLocalComposition(a,C),K0(this.contentDOM,this.children,a),ce.ios&&zk(this.dom))},e.prototype.localCompositionInfo=function(a,l){var d=a.state.selection,p=d.from,g=d.to;if(!(!(a.state.selection instanceof Dt)||p<l||g>l+this.node.content.size)){var v=a.root.getSelection(),C=Xk(v.focusNode,v.focusOffset);if(!(!C||!this.dom.contains(C.parentNode)))if(this.node.inlineContent){var y=C.nodeValue,w=$k(this.node.content,y,p-l,g-l);return w<0?null:{node:C,pos:w,text:y}}else return{node:C,pos:-1}}},e.prototype.protectLocalComposition=function(a,l){var d=l.node,p=l.pos,g=l.text;if(!this.getDesc(d)){for(var v=d;v.parentNode!=this.contentDOM;v=v.parentNode){for(;v.previousSibling;)v.parentNode.removeChild(v.previousSibling);for(;v.nextSibling;)v.parentNode.removeChild(v.nextSibling);v.pmViewDesc&&(v.pmViewDesc=null)}var C=new Hk(this,v,d,g);a.compositionNodes.push(C),this.children=_A(this.children,p,p+g.length,a,C)}},e.prototype.update=function(a,l,d,p){return this.dirty==bs||!a.sameMarkup(this.node)?!1:(this.updateInner(a,l,d,p),!0)},e.prototype.updateInner=function(a,l,d,p){this.updateOuterDeco(l),this.node=a,this.innerDeco=d,this.contentDOM&&this.updateChildren(p,this.posAtStart),this.dirty=uo},e.prototype.updateOuterDeco=function(a){if(!yA(a,this.outerDeco)){var l=this.nodeDOM.nodeType!=1,d=this.dom;this.dom=W0(this.dom,this.nodeDOM,CA(this.outerDeco,this.node,l),CA(a,this.node,l)),this.dom!=d&&(d.pmViewDesc=null,this.dom.pmViewDesc=this),this.outerDeco=a}},e.prototype.selectNode=function(){this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.dom.draggable=!0)},e.prototype.deselectNode=function(){this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.dom.removeAttribute("draggable")},r.domAtom.get=function(){return this.node.isAtom},Object.defineProperties(e.prototype,r),e}($t);function G0(t,e,r,o,a){return Y0(o,e,t),new Kl(null,t,e,r,o,o,o,a,0)}var j0=function(t){function e(o,a,l,d,p,g,v){t.call(this,o,a,l,d,p,null,g,v)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={domAtom:{configurable:!0}};return e.prototype.parseRule=function(){for(var a=this.nodeDOM.parentNode;a&&a!=this.dom&&!a.pmIsDeco;)a=a.parentNode;return{skip:a||!0}},e.prototype.update=function(a,l,d,p){return this.dirty==bs||this.dirty!=uo&&!this.inParent()||!a.sameMarkup(this.node)?!1:(this.updateOuterDeco(l),(this.dirty!=uo||a.text!=this.node.text)&&a.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=a.text,p.trackWrites==this.nodeDOM&&(p.trackWrites=null)),this.node=a,this.dirty=uo,!0)},e.prototype.inParent=function(){for(var a=this.parent.contentDOM,l=this.nodeDOM;l;l=l.parentNode)if(l==a)return!0;return!1},e.prototype.domFromPos=function(a){return{node:this.nodeDOM,offset:a}},e.prototype.localPosFromDOM=function(a,l,d){return a==this.nodeDOM?this.posAtStart+Math.min(l,this.node.text.length):t.prototype.localPosFromDOM.call(this,a,l,d)},e.prototype.ignoreMutation=function(a){return a.type!="characterData"&&a.type!="selection"},e.prototype.slice=function(a,l,d){var p=this.node.cut(a,l),g=document.createTextNode(p.text);return new e(this.parent,p,this.outerDeco,this.innerDeco,g,g,d)},e.prototype.markDirty=function(a,l){t.prototype.markDirty.call(this,a,l),this.dom!=this.nodeDOM&&(a==0||l==this.nodeDOM.nodeValue.length)&&(this.dirty=bs)},r.domAtom.get=function(){return!1},Object.defineProperties(e.prototype,r),e}(Kl),H0=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={domAtom:{configurable:!0},ignoreForCoords:{configurable:!0}};return e.prototype.parseRule=function(){return{ignore:!0}},e.prototype.matchesHack=function(a){return this.dirty==uo&&this.dom.nodeName==a},r.domAtom.get=function(){return!0},r.ignoreForCoords.get=function(){return this.dom.nodeName=="IMG"},Object.defineProperties(e.prototype,r),e}($t),Kk=function(t){function e(r,o,a,l,d,p,g,v,C,y){t.call(this,r,o,a,l,d,p,g,C,y),this.spec=v}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.update=function(o,a,l,d){if(this.dirty==bs)return!1;if(this.spec.update){var p=this.spec.update(o,a,l);return p&&this.updateInner(o,a,l,d),p}else return!this.contentDOM&&!o.isLeaf?!1:t.prototype.update.call(this,o,a,l,d)},e.prototype.selectNode=function(){this.spec.selectNode?this.spec.selectNode():t.prototype.selectNode.call(this)},e.prototype.deselectNode=function(){this.spec.deselectNode?this.spec.deselectNode():t.prototype.deselectNode.call(this)},e.prototype.setSelection=function(o,a,l,d){this.spec.setSelection?this.spec.setSelection(o,a,l):t.prototype.setSelection.call(this,o,a,l,d)},e.prototype.destroy=function(){this.spec.destroy&&this.spec.destroy(),t.prototype.destroy.call(this)},e.prototype.stopEvent=function(o){return this.spec.stopEvent?this.spec.stopEvent(o):!1},e.prototype.ignoreMutation=function(o){return this.spec.ignoreMutation?this.spec.ignoreMutation(o):t.prototype.ignoreMutation.call(this,o)},e}(Kl);function K0(t,e,r){for(var o=t.firstChild,a=!1,l=0;l<e.length;l++){var d=e[l],p=d.dom;if(p.parentNode==t){for(;p!=o;)o=q0(o),a=!0;o=o.nextSibling}else a=!0,t.insertBefore(p,o);if(d instanceof IA){var g=o?o.previousSibling:t.lastChild;K0(d.contentDOM,d.children,r),o=g?g.nextSibling:t.firstChild}}for(;o;)o=q0(o),a=!0;a&&r.trackWrites==t&&(r.trackWrites=null)}function Wl(t){t&&(this.nodeName=t)}Wl.prototype=Object.create(null);var Ia=[new Wl];function CA(t,e,r){if(t.length==0)return Ia;for(var o=r?Ia[0]:new Wl,a=[o],l=0;l<t.length;l++){var d=t[l].type.attrs;if(!!d){d.nodeName&&a.push(o=new Wl(d.nodeName));for(var p in d){var g=d[p];g!=null&&(r&&a.length==1&&a.push(o=new Wl(e.isInline?"span":"div")),p=="class"?o.class=(o.class?o.class+" ":"")+g:p=="style"?o.style=(o.style?o.style+";":"")+g:p!="nodeName"&&(o[p]=g))}}}return a}function W0(t,e,r,o){if(r==Ia&&o==Ia)return e;for(var a=e,l=0;l<o.length;l++){var d=o[l],p=r[l];if(l){var g=void 0;p&&p.nodeName==d.nodeName&&a!=t&&(g=a.parentNode)&&g.tagName.toLowerCase()==d.nodeName||(g=document.createElement(d.nodeName),g.pmIsDeco=!0,g.appendChild(a),p=Ia[0]),a=g}Wk(a,p||Ia[0],d)}return a}function Wk(t,e,r){for(var o in e)o!="class"&&o!="style"&&o!="nodeName"&&!(o in r)&&t.removeAttribute(o);for(var a in r)a!="class"&&a!="style"&&a!="nodeName"&&r[a]!=e[a]&&t.setAttribute(a,r[a]);if(e.class!=r.class){for(var l=e.class?e.class.split(" ").filter(Boolean):Ds,d=r.class?r.class.split(" ").filter(Boolean):Ds,p=0;p<l.length;p++)d.indexOf(l[p])==-1&&t.classList.remove(l[p]);for(var g=0;g<d.length;g++)l.indexOf(d[g])==-1&&t.classList.add(d[g])}if(e.style!=r.style){if(e.style)for(var v=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,C;C=v.exec(e.style);)t.style.removeProperty(C[1]);r.style&&(t.style.cssText+=r.style)}}function Y0(t,e,r){return W0(t,t,Ia,CA(e,r,t.nodeType!=1))}function yA(t,e){if(t.length!=e.length)return!1;for(var r=0;r<t.length;r++)if(!t[r].type.eq(e[r].type))return!1;return!0}function q0(t){var e=t.nextSibling;return t.parentNode.removeChild(t),e}var ji=function(e,r){this.top=e,this.lock=r,this.index=0,this.stack=[],this.changed=!1,this.preMatch=Yk(e.node.content,e.children)};ji.prototype.destroyBetween=function(e,r){if(e!=r){for(var o=e;o<r;o++)this.top.children[o].destroy();this.top.children.splice(e,r-e),this.changed=!0}};ji.prototype.destroyRest=function(){this.destroyBetween(this.index,this.top.children.length)};ji.prototype.syncToMarks=function(e,r,o){for(var a=0,l=this.stack.length>>1,d=Math.min(l,e.length);a<d&&(a==l-1?this.top:this.stack[a+1<<1]).matchesMark(e[a])&&e[a].type.spec.spanning!==!1;)a++;for(;a<l;)this.destroyRest(),this.top.dirty=uo,this.index=this.stack.pop(),this.top=this.stack.pop(),l--;for(;l<e.length;){this.stack.push(this.top,this.index+1);for(var p=-1,g=this.index;g<Math.min(this.index+3,this.top.children.length);g++)if(this.top.children[g].matchesMark(e[l])){p=g;break}if(p>-1)p>this.index&&(this.changed=!0,this.destroyBetween(this.index,p)),this.top=this.top.children[this.index];else{var v=IA.create(this.top,e[l],r,o);this.top.children.splice(this.index,0,v),this.top=v,this.changed=!0}this.index=0,l++}};ji.prototype.findNodeMatch=function(e,r,o,a){var l=this.top.children,d=-1;if(a>=this.preMatch.index){for(var p=this.index;p<l.length;p++)if(l[p].matchesNode(e,r,o)){d=p;break}}else for(var g=this.index,v=Math.min(l.length,g+1);g<v;g++){var C=l[g];if(C.matchesNode(e,r,o)&&!this.preMatch.matched.has(C)){d=g;break}}return d<0?!1:(this.destroyBetween(this.index,d),this.index++,!0)};ji.prototype.updateNodeAt=function(e,r,o,a,l){var d=this.top.children[a];return d.update(e,r,o,l)?(this.destroyBetween(this.index,a),this.index=a+1,!0):!1};ji.prototype.findIndexWithChild=function(e){for(;;){var r=e.parentNode;if(!r)return-1;if(r==this.top.contentDOM){var o=e.pmViewDesc;if(o){for(var a=this.index;a<this.top.children.length;a++)if(this.top.children[a]==o)return a}return-1}e=r}};ji.prototype.updateNextNode=function(e,r,o,a,l){for(var d=this.index;d<this.top.children.length;d++){var p=this.top.children[d];if(p instanceof Kl){var g=this.preMatch.matched.get(p);if(g!=null&&g!=l)return!1;var v=p.dom,C=this.lock&&(v==this.lock||v.nodeType==1&&v.contains(this.lock.parentNode))&&!(e.isText&&p.node&&p.node.isText&&p.nodeDOM.nodeValue==e.text&&p.dirty!=bs&&yA(r,p.outerDeco));if(!C&&p.update(e,r,o,a))return this.destroyBetween(this.index,d),p.dom!=v&&(this.changed=!0),this.index++,!0;break}}return!1};ji.prototype.addNode=function(e,r,o,a,l){this.top.children.splice(this.index++,0,Kl.create(this.top,e,r,o,a,l)),this.changed=!0};ji.prototype.placeWidget=function(e,r,o){var a=this.index<this.top.children.length?this.top.children[this.index]:null;if(a&&a.matchesWidget(e)&&(e==a.widget||!a.widget.type.toDOM.parentNode))this.index++;else{var l=new V0(this.top,e,r,o);this.top.children.splice(this.index++,0,l),this.changed=!0}};ji.prototype.addTextblockHacks=function(){for(var e=this.top.children[this.index-1];e instanceof IA;)e=e.children[e.children.length-1];(!e||!(e instanceof j0)||/\n$/.test(e.node.text))&&((ce.safari||ce.chrome)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG"),this.addHackNode("BR"))};ji.prototype.addHackNode=function(e){if(this.index<this.top.children.length&&this.top.children[this.index].matchesHack(e))this.index++;else{var r=document.createElement(e);e=="IMG"&&(r.className="ProseMirror-separator"),e=="BR"&&(r.className="ProseMirror-trailingBreak"),this.top.children.splice(this.index++,0,new H0(this.top,Ds,r,null)),this.changed=!0}};function Yk(t,e){for(var r=t.childCount,o=e.length,a=new Map;r>0&&o>0;o--){var l=e[o-1],d=l.node;if(!!d){if(d!=t.child(r-1))break;--r,a.set(l,r)}}return{index:r,matched:a}}function qk(t,e){return t.type.side-e.type.side}function Jk(t,e,r,o){var a=e.locals(t),l=0;if(a.length==0){for(var d=0;d<t.childCount;d++){var p=t.child(d);o(p,a,e.forChild(l,p),d),l+=p.nodeSize}return}for(var g=0,v=[],C=null,y=0;;){if(g<a.length&&a[g].to==l){for(var w=a[g++],k=void 0;g<a.length&&a[g].to==l;)(k||(k=[w])).push(a[g++]);if(k){k.sort(qk);for(var M=0;M<k.length;M++)r(k[M],y,!!C)}else r(w,y,!!C)}var x=void 0,V=void 0;if(C)V=-1,x=C,C=null;else if(y<t.childCount)V=y,x=t.child(y++);else break;for(var Y=0;Y<v.length;Y++)v[Y].to<=l&&v.splice(Y--,1);for(;g<a.length&&a[g].from<=l&&a[g].to>l;)v.push(a[g++]);var H=l+x.nodeSize;if(x.isText){var he=H;g<a.length&&a[g].from<he&&(he=a[g].from);for(var Q=0;Q<v.length;Q++)v[Q].to<he&&(he=v[Q].to);he<H&&(C=x.cut(he-l),x=x.cut(0,he-l),H=he,V=-1)}var pe=v.length?x.isInline&&!x.isLeaf?v.filter(function(oe){return!oe.inline}):v.slice():Ds;o(x,pe,e.forChild(l,x),V),l=H}}function zk(t){if(t.nodeName=="UL"||t.nodeName=="OL"){var e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t).listStyle,t.style.cssText=e}}function Xk(t,e){for(;;){if(t.nodeType==3)return t;if(t.nodeType==1&&e>0){if(t.childNodes.length>e&&t.childNodes[e].nodeType==3)return t.childNodes[e];t=t.childNodes[e-1],e=Do(t)}else if(t.nodeType==1&&e<t.childNodes.length)t=t.childNodes[e],e=0;else return null}}function $k(t,e,r,o){for(var a=0,l=0;a<t.childCount&&l<=o;){var d=t.child(a++),p=l;if(l+=d.nodeSize,!!d.isText){for(var g=d.text;a<t.childCount;){var v=t.child(a++);if(l+=v.nodeSize,!v.isText)break;g+=v.text}if(l>=r){var C=g.lastIndexOf(e,o-p);if(C>=0&&C+e.length+p>=r)return p+C}}}return-1}function _A(t,e,r,o,a){for(var l=[],d=0,p=0;d<t.length;d++){var g=t[d],v=p,C=p+=g.size;v>=r||C<=e?l.push(g):(v<e&&l.push(g.slice(0,e-v,o)),a&&(l.push(a),a=null),C>r&&l.push(g.slice(r-v,g.size,o)))}return l}function J0(t,e){var r=t.root.getSelection(),o=t.state.doc;if(!r.focusNode)return null;var a=t.docView.nearestDesc(r.focusNode),l=a&&a.size==0,d=t.docView.posFromDOM(r.focusNode,r.focusOffset);if(d<0)return null;var p=o.resolve(d),g,v;if(mA(r)){for(g=p;a&&!a.node;)a=a.parent;if(a&&a.node.isAtom&&tt.isSelectable(a.node)&&a.parent&&!(a.node.isInline&&wk(r.focusNode,r.focusOffset,a.dom))){var C=a.posBefore;v=new tt(d==C?p:o.resolve(C))}}else{var y=t.docView.posFromDOM(r.anchorNode,r.anchorOffset);if(y<0)return null;g=o.resolve(y)}if(!v){var w=e=="pointer"||t.state.selection.head<p.pos&&!l?1:-1;v=TA(t,g,p,w)}return v}function z0(t){return t.editable?t.hasFocus():RA(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function Bs(t,e){var r=t.state.selection;if(ey(t,r),!!z0(t)){if(!e&&t.mouseDown&&t.mouseDown.allowDefault){t.mouseDown.delayedSelectionSync=!0,t.domObserver.setCurSelection();return}if(t.domObserver.disconnectSelection(),t.cursorWrapper)eb(t);else{var o=r.anchor,a=r.head,l,d;X0&&!(r instanceof Dt)&&(r.$from.parent.inlineContent||(l=$0(t,r.from)),!r.empty&&!r.$from.parent.inlineContent&&(d=$0(t,r.to))),t.docView.setSelection(o,a,t.root,e),X0&&(l&&Z0(l),d&&Z0(d)),r.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&Zk(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}var X0=ce.safari||ce.chrome&&ce.chrome_version<63;function $0(t,e){var r=t.docView.domFromPos(e,0),o=r.node,a=r.offset,l=a<o.childNodes.length?o.childNodes[a]:null,d=a?o.childNodes[a-1]:null;if(ce.safari&&l&&l.contentEditable=="false")return SA(l);if((!l||l.contentEditable=="false")&&(!d||d.contentEditable=="false")){if(l)return SA(l);if(d)return SA(d)}}function SA(t){return t.contentEditable="true",ce.safari&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function Z0(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function Zk(t){var e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.hideSelectionGuard);var r=t.root.getSelection(),o=r.anchorNode,a=r.anchorOffset;e.addEventListener("selectionchange",t.hideSelectionGuard=function(){(r.anchorNode!=o||r.anchorOffset!=a)&&(e.removeEventListener("selectionchange",t.hideSelectionGuard),setTimeout(function(){(!z0(t)||t.state.selection.visible)&&t.dom.classList.remove("ProseMirror-hideselection")},20))})}function eb(t){var e=t.root.getSelection(),r=document.createRange(),o=t.cursorWrapper.dom,a=o.nodeName=="IMG";a?r.setEnd(o.parentNode,_i(o)+1):r.setEnd(o,0),r.collapse(!1),e.removeAllRanges(),e.addRange(r),!a&&!t.state.selection.visible&&ce.ie&&ce.ie_version<=11&&(o.disabled=!0,o.disabled=!1)}function ey(t,e){if(e instanceof tt){var r=t.docView.descAt(e.from);r!=t.lastSelectedViewDesc&&(ty(t),r&&r.selectNode(),t.lastSelectedViewDesc=r)}else ty(t)}function ty(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=null)}function TA(t,e,r,o){return t.someProp("createSelectionBetween",function(a){return a(t,e,r)})||Dt.between(e,r,o)}function tb(t){return t.editable&&t.root.activeElement!=t.dom?!1:RA(t)}function RA(t){var e=t.root.getSelection();if(!e.anchorNode)return!1;try{return t.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function rb(t){var e=t.docView.domFromPos(t.state.selection.anchor,0),r=t.root.getSelection();return Fd(e.node,e.offset,r.anchorNode,r.anchorOffset)}function wA(t,e){var r=t.selection,o=r.$anchor,a=r.$head,l=e>0?o.max(a):o.min(a),d=l.parent.inlineContent?l.depth?t.doc.resolve(e>0?l.after():l.before()):null:l;return d&&ot.findFrom(d,e)}function Ca(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function ry(t,e,r){var o=t.state.selection;if(o instanceof Dt){if(!o.empty||r.indexOf("s")>-1)return!1;if(t.endOfTextblock(e>0?"right":"left")){var a=wA(t.state,e);return a&&a instanceof tt?Ca(t,a):!1}else if(!(ce.mac&&r.indexOf("m")>-1)){var l=o.$head,d=l.textOffset?null:e<0?l.nodeBefore:l.nodeAfter,p;if(!d||d.isText)return!1;var g=e<0?l.pos-d.nodeSize:l.pos;return d.isAtom||(p=t.docView.descAt(g))&&!p.contentDOM?tt.isSelectable(d)?Ca(t,new tt(e<0?t.state.doc.resolve(l.pos-d.nodeSize):l)):ce.webkit?Ca(t,new Dt(t.state.doc.resolve(e<0?g:g+d.nodeSize))):!1:!1}}else{if(o instanceof tt&&o.node.isInline)return Ca(t,new Dt(e>0?o.$to:o.$from));var v=wA(t.state,e);return v?Ca(t,v):!1}}function Vd(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function Yl(t){var e=t.pmViewDesc;return e&&e.size==0&&(t.nextSibling||t.nodeName!="BR")}function NA(t){var e=t.root.getSelection(),r=e.focusNode,o=e.focusOffset;if(!!r){var a,l,d=!1;for(ce.gecko&&r.nodeType==1&&o<Vd(r)&&Yl(r.childNodes[o])&&(d=!0);;)if(o>0){if(r.nodeType!=1)break;var p=r.childNodes[o-1];if(Yl(p))a=r,l=--o;else if(p.nodeType==3)r=p,o=r.nodeValue.length;else break}else{if(ny(r))break;for(var g=r.previousSibling;g&&Yl(g);)a=r.parentNode,l=_i(g),g=g.previousSibling;if(g)r=g,o=Vd(r);else{if(r=r.parentNode,r==t.dom)break;o=0}}d?kA(t,e,r,o):a&&kA(t,e,a,l)}}function OA(t){var e=t.root.getSelection(),r=e.focusNode,o=e.focusOffset;if(!!r){for(var a=Vd(r),l,d;;)if(o<a){if(r.nodeType!=1)break;var p=r.childNodes[o];if(Yl(p))l=r,d=++o;else break}else{if(ny(r))break;for(var g=r.nextSibling;g&&Yl(g);)l=g.parentNode,d=_i(g)+1,g=g.nextSibling;if(g)r=g,o=0,a=Vd(r);else{if(r=r.parentNode,r==t.dom)break;o=a=0}}l&&kA(t,e,l,d)}}function ny(t){var e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function kA(t,e,r,o){if(mA(e)){var a=document.createRange();a.setEnd(r,o),a.setStart(r,o),e.removeAllRanges(),e.addRange(a)}else e.extend&&e.extend(r,o);t.domObserver.setCurSelection();var l=t.state;setTimeout(function(){t.state==l&&Bs(t)},50)}function iy(t,e,r){var o=t.state.selection;if(o instanceof Dt&&!o.empty||r.indexOf("s")>-1||ce.mac&&r.indexOf("m")>-1)return!1;var a=o.$from,l=o.$to;if(!a.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){var d=wA(t.state,e);if(d&&d instanceof tt)return Ca(t,d)}if(!a.parent.inlineContent){var p=e<0?a:l,g=o instanceof as?ot.near(p,e):ot.findFrom(p,e);return g?Ca(t,g):!1}return!1}function oy(t,e){if(!(t.state.selection instanceof Dt))return!0;var r=t.state.selection,o=r.$head,a=r.$anchor,l=r.empty;if(!o.sameParent(a))return!0;if(!l)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;var d=!o.textOffset&&(e<0?o.nodeBefore:o.nodeAfter);if(d&&!d.isText){var p=t.state.tr;return e<0?p.delete(o.pos-d.nodeSize,o.pos):p.delete(o.pos,o.pos+d.nodeSize),t.dispatch(p),!0}return!1}function sy(t,e,r){t.domObserver.stop(),e.contentEditable=r,t.domObserver.start()}function nb(t){if(!(!ce.safari||t.state.selection.$head.parentOffset>0)){var e=t.root.getSelection(),r=e.focusNode,o=e.focusOffset;if(r&&r.nodeType==1&&o==0&&r.firstChild&&r.firstChild.contentEditable=="false"){var a=r.firstChild;sy(t,a,!0),setTimeout(function(){return sy(t,a,!1)},20)}}}function ib(t){var e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}function ob(t,e){var r=e.keyCode,o=ib(e);return r==8||ce.mac&&r==72&&o=="c"?oy(t,-1)||NA(t):r==46||ce.mac&&r==68&&o=="c"?oy(t,1)||OA(t):r==13||r==27?!0:r==37?ry(t,-1,o)||NA(t):r==39?ry(t,1,o)||OA(t):r==38?iy(t,-1,o)||NA(t):r==40?nb(t)||iy(t,1,o)||OA(t):o==(ce.mac?"m":"c")&&(r==66||r==73||r==89||r==90)}function sb(t,e,r){var o=t.docView.parseRange(e,r),a=o.node,l=o.fromOffset,d=o.toOffset,p=o.from,g=o.to,v=t.root.getSelection(),C=null,y=v.anchorNode;if(y&&t.dom.contains(y.nodeType==1?y:y.parentNode)&&(C=[{node:y,offset:v.anchorOffset}],mA(v)||C.push({node:v.focusNode,offset:v.focusOffset})),ce.chrome&&t.lastKeyCode===8)for(var w=d;w>l;w--){var k=a.childNodes[w-1],M=k.pmViewDesc;if(k.nodeName=="BR"&&!M){d=w;break}if(!M||M.size)break}var x=t.state.doc,V=t.someProp("domParser")||lo.fromSchema(t.state.schema),Y=x.resolve(p),H=null,he=V.parse(a,{topNode:Y.parent,topMatch:Y.parent.contentMatchAt(Y.index()),topOpen:!0,from:l,to:d,preserveWhitespace:Y.parent.type.spec.code?"full":!0,editableContent:!0,findPositions:C,ruleFromNode:ab,context:Y});if(C&&C[0].pos!=null){var Q=C[0].pos,pe=C[1]&&C[1].pos;pe==null&&(pe=Q),H={anchor:Q+p,head:pe+p}}return{doc:he,sel:H,from:p,to:g}}function ab(t){var e=t.pmViewDesc;if(e)return e.parseRule();if(t.nodeName=="BR"&&t.parentNode){if(ce.safari&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){var r=document.createElement("div");return r.appendChild(document.createElement("li")),{skip:r}}else if(t.parentNode.lastChild==t||ce.safari&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if(t.nodeName=="IMG"&&t.getAttribute("mark-placeholder"))return{ignore:!0}}function cb(t,e,r,o,a){if(e<0){var l=t.lastSelectionTime>Date.now()-50?t.lastSelectionOrigin:null,d=J0(t,l);if(d&&!t.state.selection.eq(d)){var p=t.state.tr.setSelection(d);l=="pointer"?p.setMeta("pointer",!0):l=="key"&&p.scrollIntoView(),t.dispatch(p)}return}var g=t.state.doc.resolve(e),v=g.sharedDepth(r);e=g.before(v+1),r=t.state.doc.resolve(r).after(v+1);var C=t.state.selection,y=sb(t,e,r);if(ce.chrome&&t.cursorWrapper&&y.sel&&y.sel.anchor==t.cursorWrapper.deco.from){var w=t.cursorWrapper.deco.type.toDOM.nextSibling,k=w&&w.nodeValue?w.nodeValue.length:1;y.sel={anchor:y.sel.anchor+k,head:y.sel.anchor+k}}var M=t.state.doc,x=M.slice(y.from,y.to),V,Y;t.lastKeyCode===8&&Date.now()-100<t.lastKeyCodeTime?(V=t.state.selection.to,Y="end"):(V=t.state.selection.from,Y="start"),t.lastKeyCode=null;var H=db(x.content,y.doc.content,y.from,V,Y);if(!H)if(o&&C instanceof Dt&&!C.empty&&C.$head.sameParent(C.$anchor)&&!t.composing&&!(y.sel&&y.sel.anchor!=y.sel.head))H={start:C.from,endA:C.to,endB:C.to};else if((ce.ios&&t.lastIOSEnter>Date.now()-225||ce.android)&&a.some(function(yt){return yt.nodeName=="DIV"||yt.nodeName=="P"})&&t.someProp("handleKeyDown",function(yt){return yt(t,Rc(13,"Enter"))})){t.lastIOSEnter=0;return}else{if(y.sel){var he=ay(t,t.state.doc,y.sel);he&&!he.eq(t.state.selection)&&t.dispatch(t.state.tr.setSelection(he))}return}t.domChangeCount++,t.state.selection.from<t.state.selection.to&&H.start==H.endB&&t.state.selection instanceof Dt&&(H.start>t.state.selection.from&&H.start<=t.state.selection.from+2?H.start=t.state.selection.from:H.endA<t.state.selection.to&&H.endA>=t.state.selection.to-2&&(H.endB+=t.state.selection.to-H.endA,H.endA=t.state.selection.to)),ce.ie&&ce.ie_version<=11&&H.endB==H.start+1&&H.endA==H.start&&H.start>y.from&&y.doc.textBetween(H.start-y.from-1,H.start-y.from+1)==" \xA0"&&(H.start--,H.endA--,H.endB--);var Q=y.doc.resolveNoCache(H.start-y.from),pe=y.doc.resolveNoCache(H.endB-y.from),oe=Q.sameParent(pe)&&Q.parent.inlineContent,me;if((ce.ios&&t.lastIOSEnter>Date.now()-225&&(!oe||a.some(function(yt){return yt.nodeName=="DIV"||yt.nodeName=="P"}))||!oe&&Q.pos<y.doc.content.size&&(me=ot.findFrom(y.doc.resolve(Q.pos+1),1,!0))&&me.head==pe.pos)&&t.someProp("handleKeyDown",function(yt){return yt(t,Rc(13,"Enter"))})){t.lastIOSEnter=0;return}if(t.state.selection.anchor>H.start&&ub(M,H.start,H.endA,Q,pe)&&t.someProp("handleKeyDown",function(yt){return yt(t,Rc(8,"Backspace"))})){ce.android&&ce.chrome&&t.domObserver.suppressSelectionUpdates();return}ce.chrome&&ce.android&&H.toB==H.from&&(t.lastAndroidDelete=Date.now()),ce.android&&!oe&&Q.start()!=pe.start()&&pe.parentOffset==0&&Q.depth==pe.depth&&y.sel&&y.sel.anchor==y.sel.head&&y.sel.head==H.endA&&(H.endB-=2,pe=y.doc.resolveNoCache(H.endB-y.from),setTimeout(function(){t.someProp("handleKeyDown",function(yt){return yt(t,Rc(13,"Enter"))})},20));var xe=H.start,Pe=H.endA,De,Kt,mt,rt;if(oe){if(Q.pos==pe.pos)ce.ie&&ce.ie_version<=11&&Q.parentOffset==0&&(t.domObserver.suppressSelectionUpdates(),setTimeout(function(){return Bs(t)},20)),De=t.state.tr.delete(xe,Pe),Kt=M.resolve(H.start).marksAcross(M.resolve(H.endA));else if(H.endA==H.endB&&(rt=M.resolve(H.start))&&(mt=lb(Q.parent.content.cut(Q.parentOffset,pe.parentOffset),rt.parent.content.cut(rt.parentOffset,H.endA-rt.start()))))De=t.state.tr,mt.type=="add"?De.addMark(xe,Pe,mt.mark):De.removeMark(xe,Pe,mt.mark);else if(Q.parent.child(Q.index()).isText&&Q.index()==pe.index()-(pe.textOffset?0:1)){var Er=Q.parent.textBetween(Q.parentOffset,pe.parentOffset);if(t.someProp("handleTextInput",function(yt){return yt(t,xe,Pe,Er)}))return;De=t.state.tr.insertText(Er,xe,Pe)}}if(De||(De=t.state.tr.replace(xe,Pe,y.doc.slice(H.start-y.from,H.endB-y.from))),y.sel){var Nt=ay(t,De.doc,y.sel);Nt&&!(ce.chrome&&ce.android&&t.composing&&Nt.empty&&(H.start!=H.endB||t.lastAndroidDelete<Date.now()-100)&&(Nt.head==xe||Nt.head==De.mapping.map(Pe)-1)||ce.ie&&Nt.empty&&Nt.head==xe)&&De.setSelection(Nt)}Kt&&De.ensureMarks(Kt),t.dispatch(De.scrollIntoView())}function ay(t,e,r){return Math.max(r.anchor,r.head)>e.content.size?null:TA(t,e.resolve(r.anchor),e.resolve(r.head))}function lb(t,e){for(var r=t.firstChild.marks,o=e.firstChild.marks,a=r,l=o,d,p,g,v=0;v<o.length;v++)a=o[v].removeFromSet(a);for(var C=0;C<r.length;C++)l=r[C].removeFromSet(l);if(a.length==1&&l.length==0)p=a[0],d="add",g=function(k){return k.mark(p.addToSet(k.marks))};else if(a.length==0&&l.length==1)p=l[0],d="remove",g=function(k){return k.mark(p.removeFromSet(k.marks))};else return null;for(var y=[],w=0;w<e.childCount;w++)y.push(g(e.child(w)));if(ee.from(y).eq(t))return{mark:p,type:d}}function ub(t,e,r,o,a){if(!o.parent.isTextblock||r-e<=a.pos-o.pos||bA(o,!0,!1)<a.pos)return!1;var l=t.resolve(e);if(l.parentOffset<l.parent.content.size||!l.parent.isTextblock)return!1;var d=t.resolve(bA(l,!0,!0));return!d.parent.isTextblock||d.pos>r||bA(d,!0,!1)<r?!1:o.parent.content.cut(o.parentOffset).eq(d.parent.content)}function bA(t,e,r){for(var o=t.depth,a=e?t.end():t.pos;o>0&&(e||t.indexAfter(o)==t.node(o).childCount);)o--,a++,e=!1;if(r)for(var l=t.node(o).maybeChild(t.indexAfter(o));l&&!l.isLeaf;)l=l.firstChild,a++;return a}function db(t,e,r,o,a){var l=t.findDiffStart(e,r);if(l==null)return null;var d=t.findDiffEnd(e,r+t.size,r+e.size),p=d.a,g=d.b;if(a=="end"){var v=Math.max(0,l-Math.min(p,g));o-=p+v-l}if(p<l&&t.size<e.size){var C=o<=l&&o>=p?l-o:0;l-=C,g=l+(g-p),p=l}else if(g<l){var y=o<=l&&o>=g?l-o:0;l-=y,p=l+(p-g),g=l}return{start:l,endA:p,endB:g}}function cy(t,e){for(var r=[],o=e.content,a=e.openStart,l=e.openEnd;a>1&&l>1&&o.childCount==1&&o.firstChild.childCount==1;){a--,l--;var d=o.firstChild;r.push(d.type.name,d.attrs!=d.type.defaultAttrs?d.attrs:null),o=d.content}var p=t.someProp("clipboardSerializer")||pn.fromSchema(t.state.schema),g=gy(),v=g.createElement("div");v.appendChild(p.serializeFragment(o,{document:g}));for(var C=v.firstChild,y;C&&C.nodeType==1&&(y=fy[C.nodeName.toLowerCase()]);){for(var w=y.length-1;w>=0;w--){for(var k=g.createElement(y[w]);v.firstChild;)k.appendChild(v.firstChild);v.appendChild(k),y[w]!="tbody"&&(a++,l++)}C=v.firstChild}C&&C.nodeType==1&&C.setAttribute("data-pm-slice",a+" "+l+" "+JSON.stringify(r));var M=t.someProp("clipboardTextSerializer",function(x){return x(e)})||e.content.textBetween(0,e.content.size,`

`);return{dom:v,text:M}}function ly(t,e,r,o,a){var l,d=a.parent.type.spec.code,p;if(!r&&!e)return null;var g=e&&(o||d||!r);if(g){if(t.someProp("transformPastedText",function(pe){e=pe(e,d||o)}),d)return e?new ye(ee.from(t.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0):ye.empty;var v=t.someProp("clipboardTextParser",function(pe){return pe(e,a,o)});if(v)p=v;else{var C=a.marks(),y=t.state,w=y.schema,k=pn.fromSchema(w);l=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(function(pe){var oe=l.appendChild(document.createElement("p"));pe&&oe.appendChild(k.serializeNode(w.text(pe,C)))})}}else t.someProp("transformPastedHTML",function(pe){r=pe(r)}),l=pb(r),ce.webkit&&fb(l);var M=l&&l.querySelector("[data-pm-slice]"),x=M&&/^(\d+) (\d+) (.*)/.exec(M.getAttribute("data-pm-slice"));if(!p){var V=t.someProp("clipboardParser")||t.someProp("domParser")||lo.fromSchema(t.state.schema);p=V.parseSlice(l,{preserveWhitespace:!!(g||x),context:a})}if(x)p=Ab(py(p,+x[1],+x[2]),x[3]);else if(p=ye.maxOpen(hb(p.content,a),!0),p.openStart||p.openEnd){for(var Y=0,H=0,he=p.content.firstChild;Y<p.openStart&&!he.type.spec.isolating;Y++,he=he.firstChild);for(var Q=p.content.lastChild;H<p.openEnd&&!Q.type.spec.isolating;H++,Q=Q.lastChild);p=py(p,Y,H)}return t.someProp("transformPasted",function(pe){p=pe(p)}),p}function hb(t,e){if(t.childCount<2)return t;for(var r=function(l){var d=e.node(l),p=d.contentMatchAt(e.index(l)),g=void 0,v=[];if(t.forEach(function(C){if(!!v){var y=p.findWrapping(C.type),w;if(!y)return v=null;if(w=v.length&&g.length&&dy(y,g,C,v[v.length-1],0))v[v.length-1]=w;else{v.length&&(v[v.length-1]=hy(v[v.length-1],g.length));var k=uy(C,y);v.push(k),p=p.matchType(k.type,k.attrs),g=y}}}),v)return{v:ee.from(v)}},o=e.depth;o>=0;o--){var a=r(o);if(a)return a.v}return t}function uy(t,e,r){r===void 0&&(r=0);for(var o=e.length-1;o>=r;o--)t=e[o].create(null,ee.from(t));return t}function dy(t,e,r,o,a){if(a<t.length&&a<e.length&&t[a]==e[a]){var l=dy(t,e,r,o.lastChild,a+1);if(l)return o.copy(o.content.replaceChild(o.childCount-1,l));var d=o.contentMatchAt(o.childCount);if(d.matchType(a==t.length-1?r.type:t[a+1]))return o.copy(o.content.append(ee.from(uy(r,t,a+1))))}}function hy(t,e){if(e==0)return t;var r=t.content.replaceChild(t.childCount-1,hy(t.lastChild,e-1)),o=t.contentMatchAt(t.childCount).fillBefore(ee.empty,!0);return t.copy(r.append(o))}function DA(t,e,r,o,a,l){var d=e<0?t.firstChild:t.lastChild,p=d.content;return a<o-1&&(p=DA(p,e,r,o,a+1,l)),a>=r&&(p=e<0?d.contentMatchAt(0).fillBefore(p,t.childCount>1||l<=a).append(p):p.append(d.contentMatchAt(d.childCount).fillBefore(ee.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,d.copy(p))}function py(t,e,r){return e<t.openStart&&(t=new ye(DA(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),r<t.openEnd&&(t=new ye(DA(t.content,1,r,t.openEnd,0,0),t.openStart,r)),t}var fy={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]},Ay=null;function gy(){return Ay||(Ay=document.implementation.createHTMLDocument("title"))}function pb(t){var e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));var r=gy().createElement("div"),o=/<([a-z][^>\s]+)/i.exec(t),a;if((a=o&&fy[o[1].toLowerCase()])&&(t=a.map(function(d){return"<"+d+">"}).join("")+t+a.map(function(d){return"</"+d+">"}).reverse().join("")),r.innerHTML=t,a)for(var l=0;l<a.length;l++)r=r.querySelector(a[l])||r;return r}function fb(t){for(var e=t.querySelectorAll(ce.chrome?"span:not([class]):not([style])":"span.Apple-converted-space"),r=0;r<e.length;r++){var o=e[r];o.childNodes.length==1&&o.textContent=="\xA0"&&o.parentNode&&o.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),o)}}function Ab(t,e){if(!t.size)return t;var r=t.content.firstChild.type.schema,o;try{o=JSON.parse(e)}catch{return t}for(var a=t.content,l=t.openStart,d=t.openEnd,p=o.length-2;p>=0;p-=2){var g=r.nodes[o[p]];if(!g||g.hasRequiredAttrs())break;a=ee.from(g.create(o[p+1],a)),l++,d++}return new ye(a,l,d)}var gb={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},BA=ce.ie&&ce.ie_version<=11,MA=function(){this.anchorNode=this.anchorOffset=this.focusNode=this.focusOffset=null};MA.prototype.set=function(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset};MA.prototype.eq=function(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset};var Si=function(e,r){var o=this;this.view=e,this.handleDOMChange=r,this.queue=[],this.flushingSoon=-1,this.observer=window.MutationObserver&&new window.MutationObserver(function(a){for(var l=0;l<a.length;l++)o.queue.push(a[l]);ce.ie&&ce.ie_version<=11&&a.some(function(d){return d.type=="childList"&&d.removedNodes.length||d.type=="characterData"&&d.oldValue.length>d.target.nodeValue.length})?o.flushSoon():o.flush()}),this.currentSelection=new MA,BA&&(this.onCharData=function(a){o.queue.push({target:a.target,type:"characterData",oldValue:a.prevValue}),o.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.suppressingSelectionUpdates=!1};Si.prototype.flushSoon=function(){var e=this;this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(function(){e.flushingSoon=-1,e.flush()},20))};Si.prototype.forceFlush=function(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())};Si.prototype.start=function(){this.observer&&this.observer.observe(this.view.dom,gb),BA&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()};Si.prototype.stop=function(){var e=this;if(this.observer){var r=this.observer.takeRecords();if(r.length){for(var o=0;o<r.length;o++)this.queue.push(r[o]);window.setTimeout(function(){return e.flush()},20)}this.observer.disconnect()}BA&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()};Si.prototype.connectSelection=function(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)};Si.prototype.disconnectSelection=function(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)};Si.prototype.suppressSelectionUpdates=function(){var e=this;this.suppressingSelectionUpdates=!0,setTimeout(function(){return e.suppressingSelectionUpdates=!1},50)};Si.prototype.onSelectionChange=function(){if(!!tb(this.view)){if(this.suppressingSelectionUpdates)return Bs(this.view);if(ce.ie&&ce.ie_version<=11&&!this.view.state.selection.empty){var e=this.view.root.getSelection();if(e.focusNode&&Fd(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}};Si.prototype.setCurSelection=function(){this.currentSelection.set(this.view.root.getSelection())};Si.prototype.ignoreSelectionChange=function(e){if(e.rangeCount==0)return!0;var r=e.getRangeAt(0).commonAncestorContainer,o=this.view.docView.nearestDesc(r);if(o&&o.ignoreMutation({type:"selection",target:r.nodeType==3?r.parentNode:r}))return this.setCurSelection(),!0};Si.prototype.flush=function(){if(!(!this.view.docView||this.flushingSoon>-1)){var e=this.observer?this.observer.takeRecords():[];this.queue.length&&(e=this.queue.concat(e),this.queue.length=0);var r=this.view.root.getSelection(),o=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(r)&&RA(this.view)&&!this.ignoreSelectionChange(r),a=-1,l=-1,d=!1,p=[];if(this.view.editable)for(var g=0;g<e.length;g++){var v=this.registerMutation(e[g],p);v&&(a=a<0?v.from:Math.min(v.from,a),l=l<0?v.to:Math.max(v.to,l),v.typeOver&&(d=!0))}if(ce.gecko&&p.length>1){var C=p.filter(function(k){return k.nodeName=="BR"});if(C.length==2){var y=C[0],w=C[1];y.parentNode&&y.parentNode.parentNode==w.parentNode?w.remove():y.remove()}}(a>-1||o)&&(a>-1&&(this.view.docView.markDirty(a,l),mb(this.view)),this.handleDOMChange(a,l,d,p),this.view.docView.dirty?this.view.updateState(this.view.state):this.currentSelection.eq(r)||Bs(this.view),this.currentSelection.set(r))}};Si.prototype.registerMutation=function(e,r){if(r.indexOf(e.target)>-1)return null;var o=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(o==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!o||o.ignoreMutation(e))return null;if(e.type=="childList"){for(var a=0;a<e.addedNodes.length;a++)r.push(e.addedNodes[a]);if(o.contentDOM&&o.contentDOM!=o.dom&&!o.contentDOM.contains(e.target))return{from:o.posBefore,to:o.posAfter};var l=e.previousSibling,d=e.nextSibling;if(ce.ie&&ce.ie_version<=11&&e.addedNodes.length)for(var p=0;p<e.addedNodes.length;p++){var g=e.addedNodes[p],v=g.previousSibling,C=g.nextSibling;(!v||Array.prototype.indexOf.call(e.addedNodes,v)<0)&&(l=v),(!C||Array.prototype.indexOf.call(e.addedNodes,C)<0)&&(d=C)}var y=l&&l.parentNode==e.target?_i(l)+1:0,w=o.localPosFromDOM(e.target,y,-1),k=d&&d.parentNode==e.target?_i(d):e.target.childNodes.length,M=o.localPosFromDOM(e.target,k,1);return{from:w,to:M}}else return e.type=="attributes"?{from:o.posAtStart-o.border,to:o.posAtEnd+o.border}:{from:o.posAtStart,to:o.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}};var my=!1;function mb(t){my||(my=!0,getComputedStyle(t.dom).whiteSpace=="normal"&&console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."))}var ci={},Yn={};function vb(t){t.shiftKey=!1,t.mouseDown=null,t.lastKeyCode=null,t.lastKeyCodeTime=0,t.lastClick={time:0,x:0,y:0,type:""},t.lastSelectionOrigin=null,t.lastSelectionTime=0,t.lastIOSEnter=0,t.lastIOSEnterFallbackTimeout=null,t.lastAndroidDelete=0,t.composing=!1,t.composingTimeout=null,t.compositionNodes=[],t.compositionEndedAt=-2e8,t.domObserver=new Si(t,function(o,a,l,d){return cb(t,o,a,l,d)}),t.domObserver.start(),t.domChangeCount=0,t.eventHandlers=Object.create(null);var e=function(o){var a=ci[o];t.dom.addEventListener(o,t.eventHandlers[o]=function(l){Ib(t,l)&&!PA(t,l)&&(t.editable||!(l.type in Yn))&&a(t,l)})};for(var r in ci)e(r);ce.safari&&t.dom.addEventListener("input",function(){return null}),LA(t)}function ya(t,e){t.lastSelectionOrigin=e,t.lastSelectionTime=Date.now()}function Eb(t){t.domObserver.stop();for(var e in t.eventHandlers)t.dom.removeEventListener(e,t.eventHandlers[e]);clearTimeout(t.composingTimeout),clearTimeout(t.lastIOSEnterFallbackTimeout)}function LA(t){t.someProp("handleDOMEvents",function(e){for(var r in e)t.eventHandlers[r]||t.dom.addEventListener(r,t.eventHandlers[r]=function(o){return PA(t,o)})})}function PA(t,e){return t.someProp("handleDOMEvents",function(r){var o=r[e.type];return o?o(t,e)||e.defaultPrevented:!1})}function Ib(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(var r=e.target;r!=t.dom;r=r.parentNode)if(!r||r.nodeType==11||r.pmViewDesc&&r.pmViewDesc.stopEvent(e))return!1;return!0}function Cb(t,e){!PA(t,e)&&ci[e.type]&&(t.editable||!(e.type in Yn))&&ci[e.type](t,e)}Yn.keydown=function(t,e){if(t.shiftKey=e.keyCode==16||e.shiftKey,!Ey(t,e))if(e.keyCode!=229&&t.domObserver.forceFlush(),t.lastKeyCode=e.keyCode,t.lastKeyCodeTime=Date.now(),ce.ios&&e.keyCode==13&&!e.ctrlKey&&!e.altKey&&!e.metaKey){var r=Date.now();t.lastIOSEnter=r,t.lastIOSEnterFallbackTimeout=setTimeout(function(){t.lastIOSEnter==r&&(t.someProp("handleKeyDown",function(o){return o(t,Rc(13,"Enter"))}),t.lastIOSEnter=0)},200)}else t.someProp("handleKeyDown",function(o){return o(t,e)})||ob(t,e)?e.preventDefault():ya(t,"key")};Yn.keyup=function(t,e){e.keyCode==16&&(t.shiftKey=!1)};Yn.keypress=function(t,e){if(!(Ey(t,e)||!e.charCode||e.ctrlKey&&!e.altKey||ce.mac&&e.metaKey)){if(t.someProp("handleKeyPress",function(a){return a(t,e)})){e.preventDefault();return}var r=t.state.selection;if(!(r instanceof Dt)||!r.$from.sameParent(r.$to)){var o=String.fromCharCode(e.charCode);t.someProp("handleTextInput",function(a){return a(t,r.$from.pos,r.$to.pos,o)})||t.dispatch(t.state.tr.insertText(o).scrollIntoView()),e.preventDefault()}}};function Gd(t){return{left:t.clientX,top:t.clientY}}function yb(t,e){var r=e.x-t.clientX,o=e.y-t.clientY;return r*r+o*o<100}function xA(t,e,r,o,a){if(o==-1)return!1;for(var l=t.state.doc.resolve(o),d=function(v){if(t.someProp(e,function(C){return v>l.depth?C(t,r,l.nodeAfter,l.before(v),a,!0):C(t,r,l.node(v),l.before(v),a,!1)}))return{v:!0}},p=l.depth+1;p>0;p--){var g=d(p);if(g)return g.v}return!1}function Nc(t,e,r){t.focused||t.focus();var o=t.state.tr.setSelection(e);r=="pointer"&&o.setMeta("pointer",!0),t.dispatch(o)}function _b(t,e){if(e==-1)return!1;var r=t.state.doc.resolve(e),o=r.nodeAfter;return o&&o.isAtom&&tt.isSelectable(o)?(Nc(t,new tt(r),"pointer"),!0):!1}function Sb(t,e){if(e==-1)return!1;var r=t.state.selection,o,a;r instanceof tt&&(o=r.node);for(var l=t.state.doc.resolve(e),d=l.depth+1;d>0;d--){var p=d>l.depth?l.nodeAfter:l.node(d);if(tt.isSelectable(p)){o&&r.$from.depth>0&&d>=r.$from.depth&&l.before(r.$from.depth+1)==r.$from.pos?a=l.before(r.$from.depth):a=l.before(d);break}}return a!=null?(Nc(t,tt.create(t.state.doc,a),"pointer"),!0):!1}function Tb(t,e,r,o,a){return xA(t,"handleClickOn",e,r,o)||t.someProp("handleClick",function(l){return l(t,e,o)})||(a?Sb(t,r):_b(t,r))}function Rb(t,e,r,o){return xA(t,"handleDoubleClickOn",e,r,o)||t.someProp("handleDoubleClick",function(a){return a(t,e,o)})}function wb(t,e,r,o){return xA(t,"handleTripleClickOn",e,r,o)||t.someProp("handleTripleClick",function(a){return a(t,e,o)})||Nb(t,r,o)}function Nb(t,e,r){if(r.button!=0)return!1;var o=t.state.doc;if(e==-1)return o.inlineContent?(Nc(t,Dt.create(o,0,o.content.size),"pointer"),!0):!1;for(var a=o.resolve(e),l=a.depth+1;l>0;l--){var d=l>a.depth?a.nodeAfter:a.node(l),p=a.before(l);if(d.inlineContent)Nc(t,Dt.create(o,p+1,p+1+d.content.size),"pointer");else if(tt.isSelectable(d))Nc(t,tt.create(o,p),"pointer");else continue;return!0}}function QA(t){return Hd(t)}var vy=ce.mac?"metaKey":"ctrlKey";ci.mousedown=function(t,e){t.shiftKey=e.shiftKey;var r=QA(t),o=Date.now(),a="singleClick";o-t.lastClick.time<500&&yb(e,t.lastClick)&&!e[vy]&&(t.lastClick.type=="singleClick"?a="doubleClick":t.lastClick.type=="doubleClick"&&(a="tripleClick")),t.lastClick={time:o,x:e.clientX,y:e.clientY,type:a};var l=t.posAtCoords(Gd(e));!l||(a=="singleClick"?(t.mouseDown&&t.mouseDown.done(),t.mouseDown=new jd(t,l,e,r)):(a=="doubleClick"?Rb:wb)(t,l.pos,l.inside,e)?e.preventDefault():ya(t,"pointer"))};var jd=function(e,r,o,a){var l=this;this.view=e,this.startDoc=e.state.doc,this.pos=r,this.event=o,this.flushed=a,this.selectNode=o[vy],this.allowDefault=o.shiftKey,this.delayedSelectionSync=!1;var d,p;if(r.inside>-1)d=e.state.doc.nodeAt(r.inside),p=r.inside;else{var g=e.state.doc.resolve(r.pos);d=g.parent,p=g.depth?g.before():0}this.mightDrag=null;var v=a?null:o.target,C=v?e.docView.nearestDesc(v,!0):null;this.target=C?C.dom:null;var y=e.state,w=y.selection;(o.button==0&&d.type.spec.draggable&&d.type.spec.selectable!==!1||w instanceof tt&&w.from<=p&&w.to>p)&&(this.mightDrag={node:d,pos:p,addAttr:this.target&&!this.target.draggable,setUneditable:this.target&&ce.gecko&&!this.target.hasAttribute("contentEditable")}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(function(){l.view.mouseDown==l&&l.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),ya(e,"pointer")};jd.prototype.done=function(){var e=this;this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(function(){return Bs(e.view)}),this.view.mouseDown=null};jd.prototype.up=function(e){if(this.done(),!!this.view.dom.contains(e.target.nodeType==3?e.target.parentNode:e.target)){var r=this.pos;this.view.state.doc!=this.startDoc&&(r=this.view.posAtCoords(Gd(e))),this.allowDefault||!r?ya(this.view,"pointer"):Tb(this.view,r.pos,r.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||ce.safari&&this.mightDrag&&!this.mightDrag.node.isAtom||ce.chrome&&!(this.view.state.selection instanceof Dt)&&Math.min(Math.abs(r.pos-this.view.state.selection.from),Math.abs(r.pos-this.view.state.selection.to))<=2)?(Nc(this.view,ot.near(this.view.state.doc.resolve(r.pos)),"pointer"),e.preventDefault()):ya(this.view,"pointer")}};jd.prototype.move=function(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0),ya(this.view,"pointer"),e.buttons==0&&this.done()};ci.touchdown=function(t){QA(t),ya(t,"pointer")};ci.contextmenu=function(t){return QA(t)};function Ey(t,e){return t.composing?!0:ce.safari&&Math.abs(e.timeStamp-t.compositionEndedAt)<500?(t.compositionEndedAt=-2e8,!0):!1}var Ob=ce.android?5e3:-1;Yn.compositionstart=Yn.compositionupdate=function(t){if(!t.composing){t.domObserver.flush();var e=t.state,r=e.selection.$from;if(e.selection.empty&&(e.storedMarks||!r.textOffset&&r.parentOffset&&r.nodeBefore.marks.some(function(p){return p.type.spec.inclusive===!1})))t.markCursor=t.state.storedMarks||r.marks(),Hd(t,!0),t.markCursor=null;else if(Hd(t),ce.gecko&&e.selection.empty&&r.parentOffset&&!r.textOffset&&r.nodeBefore.marks.length)for(var o=t.root.getSelection(),a=o.focusNode,l=o.focusOffset;a&&a.nodeType==1&&l!=0;){var d=l<0?a.lastChild:a.childNodes[l-1];if(!d)break;if(d.nodeType==3){o.collapse(d,d.nodeValue.length);break}else a=d,l=-1}t.composing=!0}Iy(t,Ob)};Yn.compositionend=function(t,e){t.composing&&(t.composing=!1,t.compositionEndedAt=e.timeStamp,Iy(t,20))};function Iy(t,e){clearTimeout(t.composingTimeout),e>-1&&(t.composingTimeout=setTimeout(function(){return Hd(t)},e))}function Cy(t){for(t.composing&&(t.composing=!1,t.compositionEndedAt=kb());t.compositionNodes.length>0;)t.compositionNodes.pop().markParentsDirty()}function kb(){var t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}function Hd(t,e){if(t.domObserver.forceFlush(),Cy(t),e||t.docView.dirty){var r=J0(t);return r&&!r.eq(t.state.selection)?t.dispatch(t.state.tr.setSelection(r)):t.updateState(t.state),!0}return!1}function bb(t,e){if(!!t.dom.parentNode){var r=t.dom.parentNode.appendChild(document.createElement("div"));r.appendChild(e),r.style.cssText="position: fixed; left: -10000px; top: 10px";var o=getSelection(),a=document.createRange();a.selectNodeContents(e),t.dom.blur(),o.removeAllRanges(),o.addRange(a),setTimeout(function(){r.parentNode&&r.parentNode.removeChild(r),t.focus()},50)}}var Oc=ce.ie&&ce.ie_version<15||ce.ios&&ce.webkit_version<604;ci.copy=Yn.cut=function(t,e){var r=t.state.selection,o=e.type=="cut";if(!r.empty){var a=Oc?null:e.clipboardData,l=r.content(),d=cy(t,l),p=d.dom,g=d.text;a?(e.preventDefault(),a.clearData(),a.setData("text/html",p.innerHTML),a.setData("text/plain",g)):bb(t,p),o&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))}};function Db(t){return t.openStart==0&&t.openEnd==0&&t.content.childCount==1?t.content.firstChild:null}function Bb(t,e){if(!!t.dom.parentNode){var r=t.shiftKey||t.state.selection.$from.parent.type.spec.code,o=t.dom.parentNode.appendChild(document.createElement(r?"textarea":"div"));r||(o.contentEditable="true"),o.style.cssText="position: fixed; left: -10000px; top: 10px",o.focus(),setTimeout(function(){t.focus(),o.parentNode&&o.parentNode.removeChild(o),r?UA(t,o.value,null,e):UA(t,o.textContent,o.innerHTML,e)},50)}}function UA(t,e,r,o){var a=ly(t,e,r,t.shiftKey,t.state.selection.$from);if(t.someProp("handlePaste",function(p){return p(t,o,a||ye.empty)}))return!0;if(!a)return!1;var l=Db(a),d=l?t.state.tr.replaceSelectionWith(l,t.shiftKey):t.state.tr.replaceSelection(a);return t.dispatch(d.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}Yn.paste=function(t,e){var r=Oc?null:e.clipboardData;r&&UA(t,r.getData("text/plain"),r.getData("text/html"),e)?e.preventDefault():Bb(t,e)};var Mb=function(e,r){this.slice=e,this.move=r},yy=ce.mac?"altKey":"ctrlKey";ci.dragstart=function(t,e){var r=t.mouseDown;if(r&&r.done(),!!e.dataTransfer){var o=t.state.selection,a=o.empty?null:t.posAtCoords(Gd(e));if(!(a&&a.pos>=o.from&&a.pos<=(o instanceof tt?o.to-1:o.to))){if(r&&r.mightDrag)t.dispatch(t.state.tr.setSelection(tt.create(t.state.doc,r.mightDrag.pos)));else if(e.target&&e.target.nodeType==1){var l=t.docView.nearestDesc(e.target,!0);l&&l.node.type.spec.draggable&&l!=t.docView&&t.dispatch(t.state.tr.setSelection(tt.create(t.state.doc,l.posBefore)))}}var d=t.state.selection.content(),p=cy(t,d),g=p.dom,v=p.text;e.dataTransfer.clearData(),e.dataTransfer.setData(Oc?"Text":"text/html",g.innerHTML),e.dataTransfer.effectAllowed="copyMove",Oc||e.dataTransfer.setData("text/plain",v),t.dragging=new Mb(d,!e[yy])}};ci.dragend=function(t){var e=t.dragging;window.setTimeout(function(){t.dragging==e&&(t.dragging=null)},50)};Yn.dragover=Yn.dragenter=function(t,e){return e.preventDefault()};Yn.drop=function(t,e){var r=t.dragging;if(t.dragging=null,!!e.dataTransfer){var o=t.posAtCoords(Gd(e));if(!!o){var a=t.state.doc.resolve(o.pos);if(!!a){var l=r&&r.slice;l?t.someProp("transformPasted",function(M){l=M(l)}):l=ly(t,e.dataTransfer.getData(Oc?"Text":"text/plain"),Oc?null:e.dataTransfer.getData("text/html"),!1,a);var d=r&&!e[yy];if(t.someProp("handleDrop",function(M){return M(t,e,l||ye.empty,d)})){e.preventDefault();return}if(!!l){e.preventDefault();var p=l?e0(t.state.doc,a.pos,l):a.pos;p==null&&(p=a.pos);var g=t.state.tr;d&&g.deleteSelection();var v=g.mapping.map(p),C=l.openStart==0&&l.openEnd==0&&l.content.childCount==1,y=g.doc;if(C?g.replaceRangeWith(v,v,l.content.firstChild):g.replaceRange(v,v,l),!g.doc.eq(y)){var w=g.doc.resolve(v);if(C&&tt.isSelectable(l.content.firstChild)&&w.nodeAfter&&w.nodeAfter.sameMarkup(l.content.firstChild))g.setSelection(new tt(w));else{var k=g.mapping.map(p);g.mapping.maps[g.mapping.maps.length-1].forEach(function(M,x,V,Y){return k=Y}),g.setSelection(TA(t,w,g.doc.resolve(k)))}t.focus(),t.dispatch(g.setMeta("uiEvent","drop"))}}}}}};ci.focus=function(t){t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout(function(){t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.root.getSelection())&&Bs(t)},20))};ci.blur=function(t,e){t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),e.relatedTarget&&t.dom.contains(e.relatedTarget)&&t.domObserver.currentSelection.set({}),t.focused=!1)};ci.beforeinput=function(t,e){if(ce.chrome&&ce.android&&e.inputType=="deleteContentBackward"){var r=t.domChangeCount;setTimeout(function(){if(t.domChangeCount==r&&(t.dom.blur(),t.focus(),!t.someProp("handleKeyDown",function(l){return l(t,Rc(8,"Backspace"))}))){var o=t.state.selection,a=o.$cursor;a&&a.pos>0&&t.dispatch(t.state.tr.delete(a.pos-1,a.pos).scrollIntoView())}},50)}};for(var _y in Yn)ci[_y]=Yn[_y];function ql(t,e){if(t==e)return!0;for(var r in t)if(t[r]!==e[r])return!1;for(var o in e)if(!(o in t))return!1;return!0}var Jl=function(e,r){this.spec=r||_a,this.side=this.spec.side||0,this.toDOM=e};Jl.prototype.map=function(e,r,o,a){var l=e.mapResult(r.from+a,this.side<0?-1:1),d=l.pos,p=l.deleted;return p?null:new Qr(d-o,d-o,this)};Jl.prototype.valid=function(){return!0};Jl.prototype.eq=function(e){return this==e||e instanceof Jl&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&ql(this.spec,e.spec))};var ho=function(e,r){this.spec=r||_a,this.attrs=e};ho.prototype.map=function(e,r,o,a){var l=e.map(r.from+a,this.spec.inclusiveStart?-1:1)-o,d=e.map(r.to+a,this.spec.inclusiveEnd?1:-1)-o;return l>=d?null:new Qr(l,d,this)};ho.prototype.valid=function(e,r){return r.from<r.to};ho.prototype.eq=function(e){return this==e||e instanceof ho&&ql(this.attrs,e.attrs)&&ql(this.spec,e.spec)};ho.is=function(e){return e.type instanceof ho};var zl=function(e,r){this.spec=r||_a,this.attrs=e};zl.prototype.map=function(e,r,o,a){var l=e.mapResult(r.from+a,1);if(l.deleted)return null;var d=e.mapResult(r.to+a,-1);return d.deleted||d.pos<=l.pos?null:new Qr(l.pos-o,d.pos-o,this)};zl.prototype.valid=function(e,r){var o=e.content.findIndex(r.from),a=o.index,l=o.offset,d;return l==r.from&&!(d=e.child(a)).isText&&l+d.nodeSize==r.to};zl.prototype.eq=function(e){return this==e||e instanceof zl&&ql(this.attrs,e.attrs)&&ql(this.spec,e.spec)};var Qr=function(e,r,o){this.from=e,this.to=r,this.type=o},FA={spec:{configurable:!0},inline:{configurable:!0}};Qr.prototype.copy=function(e,r){return new Qr(e,r,this.type)};Qr.prototype.eq=function(e,r){return r===void 0&&(r=0),this.type.eq(e.type)&&this.from+r==e.from&&this.to+r==e.to};Qr.prototype.map=function(e,r,o){return this.type.map(e,this,r,o)};Qr.widget=function(e,r,o){return new Qr(e,e,new Jl(r,o))};Qr.inline=function(e,r,o,a){return new Qr(e,r,new ho(o,a))};Qr.node=function(e,r,o,a){return new Qr(e,r,new zl(o,a))};FA.spec.get=function(){return this.type.spec};FA.inline.get=function(){return this.type instanceof ho};Object.defineProperties(Qr.prototype,FA);var Kd=[],_a={},Gt=function(e,r){this.local=e&&e.length?e:Kd,this.children=r&&r.length?r:Kd};Gt.create=function(e,r){return r.length?Wd(r,e,0,_a):gn};Gt.prototype.find=function(e,r,o){var a=[];return this.findInner(e==null?0:e,r==null?1e9:r,a,0,o),a};Gt.prototype.findInner=function(e,r,o,a,l){for(var d=0;d<this.local.length;d++){var p=this.local[d];p.from<=r&&p.to>=e&&(!l||l(p.spec))&&o.push(p.copy(p.from+a,p.to+a))}for(var g=0;g<this.children.length;g+=3)if(this.children[g]<r&&this.children[g+1]>e){var v=this.children[g]+1;this.children[g+2].findInner(e-v,r-v,o,a+v,l)}};Gt.prototype.map=function(e,r,o){return this==gn||e.maps.length==0?this:this.mapInner(e,r,0,0,o||_a)};Gt.prototype.mapInner=function(e,r,o,a,l){for(var d,p=0;p<this.local.length;p++){var g=this.local[p].map(e,o,a);g&&g.type.valid(r,g)?(d||(d=[])).push(g):l.onRemove&&l.onRemove(this.local[p].spec)}return this.children.length?Lb(this.children,d,e,r,o,a,l):d?new Gt(d.sort(Sa)):gn};Gt.prototype.add=function(e,r){return r.length?this==gn?Gt.create(e,r):this.addInner(e,r,0):this};Gt.prototype.addInner=function(e,r,o){var a=this,l,d=0;e.forEach(function(v,C){var y=C+o,w;if(!!(w=Ty(r,v,y))){for(l||(l=a.children.slice());d<l.length&&l[d]<C;)d+=3;l[d]==C?l[d+2]=l[d+2].addInner(v,w,y+1):l.splice(d,0,C,C+v.nodeSize,Wd(w,v,y+1,_a)),d+=3}});for(var p=Sy(d?Ry(r):r,-o),g=0;g<p.length;g++)p[g].type.valid(e,p[g])||p.splice(g--,1);return new Gt(p.length?this.local.concat(p).sort(Sa):this.local,l||this.children)};Gt.prototype.remove=function(e){return e.length==0||this==gn?this:this.removeInner(e,0)};Gt.prototype.removeInner=function(e,r){for(var o=this.children,a=this.local,l=0;l<o.length;l+=3){for(var d=void 0,p=o[l]+r,g=o[l+1]+r,v=0,C=void 0;v<e.length;v++)(C=e[v])&&C.from>p&&C.to<g&&(e[v]=null,(d||(d=[])).push(C));if(!!d){o==this.children&&(o=this.children.slice());var y=o[l+2].removeInner(d,p+1);y!=gn?o[l+2]=y:(o.splice(l,3),l-=3)}}if(a.length){for(var w=0,k=void 0;w<e.length;w++)if(k=e[w])for(var M=0;M<a.length;M++)a[M].eq(k,r)&&(a==this.local&&(a=this.local.slice()),a.splice(M--,1))}return o==this.children&&a==this.local?this:a.length||o.length?new Gt(a,o):gn};Gt.prototype.forChild=function(e,r){if(this==gn)return this;if(r.isLeaf)return Gt.empty;for(var o,a,l=0;l<this.children.length;l+=3)if(this.children[l]>=e){this.children[l]==e&&(o=this.children[l+2]);break}for(var d=e+1,p=d+r.content.size,g=0;g<this.local.length;g++){var v=this.local[g];if(v.from<p&&v.to>d&&v.type instanceof ho){var C=Math.max(d,v.from)-d,y=Math.min(p,v.to)-d;C<y&&(a||(a=[])).push(v.copy(C,y))}}if(a){var w=new Gt(a.sort(Sa));return o?new Hi([w,o]):w}return o||gn};Gt.prototype.eq=function(e){if(this==e)return!0;if(!(e instanceof Gt)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(var r=0;r<this.local.length;r++)if(!this.local[r].eq(e.local[r]))return!1;for(var o=0;o<this.children.length;o+=3)if(this.children[o]!=e.children[o]||this.children[o+1]!=e.children[o+1]||!this.children[o+2].eq(e.children[o+2]))return!1;return!0};Gt.prototype.locals=function(e){return VA(this.localsInner(e))};Gt.prototype.localsInner=function(e){if(this==gn)return Kd;if(e.inlineContent||!this.local.some(ho.is))return this.local;for(var r=[],o=0;o<this.local.length;o++)this.local[o].type instanceof ho||r.push(this.local[o]);return r};var gn=new Gt;Gt.empty=gn;Gt.removeOverlap=VA;var Hi=function(e){this.members=e};Hi.prototype.map=function(e,r){var o=this.members.map(function(a){return a.map(e,r,_a)});return Hi.from(o)};Hi.prototype.forChild=function(e,r){if(r.isLeaf)return Gt.empty;for(var o=[],a=0;a<this.members.length;a++){var l=this.members[a].forChild(e,r);l!=gn&&(l instanceof Hi?o=o.concat(l.members):o.push(l))}return Hi.from(o)};Hi.prototype.eq=function(e){if(!(e instanceof Hi)||e.members.length!=this.members.length)return!1;for(var r=0;r<this.members.length;r++)if(!this.members[r].eq(e.members[r]))return!1;return!0};Hi.prototype.locals=function(e){for(var r,o=!0,a=0;a<this.members.length;a++){var l=this.members[a].localsInner(e);if(!!l.length)if(!r)r=l;else{o&&(r=r.slice(),o=!1);for(var d=0;d<l.length;d++)r.push(l[d])}}return r?VA(o?r:r.sort(Sa)):Kd};Hi.from=function(e){switch(e.length){case 0:return gn;case 1:return e[0];default:return new Hi(e)}};function Lb(t,e,r,o,a,l,d){for(var p=t.slice(),g=function(Kt,mt,rt,Er){for(var Nt=0;Nt<p.length;Nt+=3){var yt=p[Nt+1],lr=void 0;yt==-1||Kt>yt+l||(mt>=p[Nt]+l?p[Nt+1]=-1:rt>=a&&(lr=Er-rt-(mt-Kt))&&(p[Nt]+=lr,p[Nt+1]+=lr))}},v=0;v<r.maps.length;v++)r.maps[v].forEach(g);for(var C=!1,y=0;y<p.length;y+=3)if(p[y+1]==-1){var w=r.map(t[y]+l),k=w-a;if(k<0||k>=o.content.size){C=!0;continue}var M=r.map(t[y+1]+l,-1),x=M-a,V=o.content.findIndex(k),Y=V.index,H=V.offset,he=o.maybeChild(Y);if(he&&H==k&&H+he.nodeSize==x){var Q=p[y+2].mapInner(r,he,w+1,t[y]+l+1,d);Q!=gn?(p[y]=k,p[y+1]=x,p[y+2]=Q):(p[y+1]=-2,C=!0)}else C=!0}if(C){var pe=Pb(p,t,e||[],r,a,l,d),oe=Wd(pe,o,0,d);e=oe.local;for(var me=0;me<p.length;me+=3)p[me+1]<0&&(p.splice(me,3),me-=3);for(var xe=0,Pe=0;xe<oe.children.length;xe+=3){for(var De=oe.children[xe];Pe<p.length&&p[Pe]<De;)Pe+=3;p.splice(Pe,0,oe.children[xe],oe.children[xe+1],oe.children[xe+2])}}return new Gt(e&&e.sort(Sa),p)}function Sy(t,e){if(!e||!t.length)return t;for(var r=[],o=0;o<t.length;o++){var a=t[o];r.push(new Qr(a.from+e,a.to+e,a.type))}return r}function Pb(t,e,r,o,a,l,d){function p(v,C){for(var y=0;y<v.local.length;y++){var w=v.local[y].map(o,a,C);w?r.push(w):d.onRemove&&d.onRemove(v.local[y].spec)}for(var k=0;k<v.children.length;k+=3)p(v.children[k+2],v.children[k]+C+1)}for(var g=0;g<t.length;g+=3)t[g+1]==-1&&p(t[g+2],e[g]+l+1);return r}function Ty(t,e,r){if(e.isLeaf)return null;for(var o=r+e.nodeSize,a=null,l=0,d=void 0;l<t.length;l++)(d=t[l])&&d.from>r&&d.to<o&&((a||(a=[])).push(d),t[l]=null);return a}function Ry(t){for(var e=[],r=0;r<t.length;r++)t[r]!=null&&e.push(t[r]);return e}function Wd(t,e,r,o){var a=[],l=!1;e.forEach(function(g,v){var C=Ty(t,g,v+r);if(C){l=!0;var y=Wd(C,g,r+v+1,o);y!=gn&&a.push(v,v+g.nodeSize,y)}});for(var d=Sy(l?Ry(t):t,-r).sort(Sa),p=0;p<d.length;p++)d[p].type.valid(e,d[p])||(o.onRemove&&o.onRemove(d[p].spec),d.splice(p--,1));return d.length||a.length?new Gt(d,a):gn}function Sa(t,e){return t.from-e.from||t.to-e.to}function VA(t){for(var e=t,r=0;r<e.length-1;r++){var o=e[r];if(o.from!=o.to)for(var a=r+1;a<e.length;a++){var l=e[a];if(l.from==o.from){l.to!=o.to&&(e==t&&(e=t.slice()),e[a]=l.copy(l.from,o.to),wy(e,a+1,l.copy(o.to,l.to)));continue}else{l.from<o.to&&(e==t&&(e=t.slice()),e[r]=o.copy(o.from,l.from),wy(e,a,o.copy(l.from,o.to)));break}}}return e}function wy(t,e,r){for(;e<t.length&&Sa(r,t[e])>0;)e++;t.splice(e,0,r)}function GA(t){var e=[];return t.someProp("decorations",function(r){var o=r(t.state);o&&o!=gn&&e.push(o)}),t.cursorWrapper&&e.push(Gt.create(t.state.doc,[t.cursorWrapper.deco])),Hi.from(e)}var Ur=function(e,r){this._props=r,this.state=r.state,this.directPlugins=r.plugins||[],this.directPlugins.forEach(Dy),this.dispatch=this.dispatch.bind(this),this._root=null,this.focused=!1,this.trackWrites=null,this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):e.apply?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=ky(this),this.markCursor=null,this.cursorWrapper=null,Oy(this),this.nodeViews=by(this),this.docView=G0(this.state.doc,Ny(this),GA(this),this.dom,this),this.lastSelectedViewDesc=null,this.dragging=null,vb(this),this.prevDirectPlugins=[],this.pluginViews=[],this.updatePluginViews()},jA={props:{configurable:!0},root:{configurable:!0}};jA.props.get=function(){if(this._props.state!=this.state){var t=this._props;this._props={};for(var e in t)this._props[e]=t[e];this._props.state=this.state}return this._props};Ur.prototype.update=function(e){e.handleDOMEvents!=this._props.handleDOMEvents&&LA(this),this._props=e,e.plugins&&(e.plugins.forEach(Dy),this.directPlugins=e.plugins),this.updateStateInner(e.state,!0)};Ur.prototype.setProps=function(e){var r={};for(var o in this._props)r[o]=this._props[o];r.state=this.state;for(var a in e)r[a]=e[a];this.update(r)};Ur.prototype.updateState=function(e){this.updateStateInner(e,this.state.plugins!=e.plugins)};Ur.prototype.updateStateInner=function(e,r){var o=this,a=this.state,l=!1,d=!1;if(e.storedMarks&&this.composing&&(Cy(this),d=!0),this.state=e,r){var p=by(this);Qb(p,this.nodeViews)&&(this.nodeViews=p,l=!0),LA(this)}this.editable=ky(this),Oy(this);var g=GA(this),v=Ny(this),C=r?"reset":e.scrollToSelection>a.scrollToSelection?"to selection":"preserve",y=l||!this.docView.matchesNode(e.doc,v,g);(y||!e.selection.eq(a.selection))&&(d=!0);var w=C=="preserve"&&d&&this.dom.style.overflowAnchor==null&&bk(this);if(d){this.domObserver.stop();var k=y&&(ce.ie||ce.chrome)&&!this.composing&&!a.selection.empty&&!e.selection.empty&&xb(a.selection,e.selection);if(y){var M=ce.chrome?this.trackWrites=this.root.getSelection().focusNode:null;(l||!this.docView.update(e.doc,v,g,this))&&(this.docView.updateOuterDeco([]),this.docView.destroy(),this.docView=G0(e.doc,v,g,this.dom,this)),M&&!this.trackWrites&&(k=!0)}k||!(this.mouseDown&&this.domObserver.currentSelection.eq(this.root.getSelection())&&rb(this))?Bs(this,k):(ey(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}if(this.updatePluginViews(a),C=="reset")this.dom.scrollTop=0;else if(C=="to selection"){var x=this.root.getSelection().focusNode;this.someProp("handleScrollToSelection",function(V){return V(o)})||(e.selection instanceof tt?k0(this,this.docView.domAfterPos(e.selection.from).getBoundingClientRect(),x):k0(this,this.coordsAtPos(e.selection.head,1),x))}else w&&Dk(w)};Ur.prototype.destroyPluginViews=function(){for(var e;e=this.pluginViews.pop();)e.destroy&&e.destroy()};Ur.prototype.updatePluginViews=function(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(var r=0;r<this.directPlugins.length;r++){var o=this.directPlugins[r];o.spec.view&&this.pluginViews.push(o.spec.view(this))}for(var a=0;a<this.state.plugins.length;a++){var l=this.state.plugins[a];l.spec.view&&this.pluginViews.push(l.spec.view(this))}}else for(var d=0;d<this.pluginViews.length;d++){var p=this.pluginViews[d];p.update&&p.update(this,e)}};Ur.prototype.someProp=function(e,r){var o=this._props&&this._props[e],a;if(o!=null&&(a=r?r(o):o))return a;for(var l=0;l<this.directPlugins.length;l++){var d=this.directPlugins[l].props[e];if(d!=null&&(a=r?r(d):d))return a}var p=this.state.plugins;if(p)for(var g=0;g<p.length;g++){var v=p[g].props[e];if(v!=null&&(a=r?r(v):v))return a}};Ur.prototype.hasFocus=function(){return this.root.activeElement==this.dom};Ur.prototype.focus=function(){this.domObserver.stop(),this.editable&&Bk(this.dom),Bs(this),this.domObserver.start()};jA.root.get=function(){var t=this._root;if(t==null){for(var e=this.dom.parentNode;e;e=e.parentNode)if(e.nodeType==9||e.nodeType==11&&e.host)return e.getSelection||(Object.getPrototypeOf(e).getSelection=function(){return document.getSelection()}),this._root=e}return t||document};Ur.prototype.posAtCoords=function(e){return Qk(this,e)};Ur.prototype.coordsAtPos=function(e,r){return r===void 0&&(r=1),L0(this,e,r)};Ur.prototype.domAtPos=function(e,r){return r===void 0&&(r=0),this.docView.domFromPos(e,r)};Ur.prototype.nodeDOM=function(e){var r=this.docView.descAt(e);return r?r.nodeDOM:null};Ur.prototype.posAtDOM=function(e,r,o){o===void 0&&(o=-1);var a=this.docView.posFromDOM(e,r,o);if(a==null)throw new RangeError("DOM position not inside the editor");return a};Ur.prototype.endOfTextblock=function(e,r){return jk(this,r||this.state,e)};Ur.prototype.destroy=function(){!this.docView||(Eb(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],GA(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null)};Ur.prototype.dispatchEvent=function(e){return Cb(this,e)};Ur.prototype.dispatch=function(e){var r=this._props.dispatchTransaction;r?r.call(this,e):this.updateState(this.state.apply(e))};Object.defineProperties(Ur.prototype,jA);function Ny(t){var e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),e.translate="no",t.someProp("attributes",function(r){if(typeof r=="function"&&(r=r(t.state)),r)for(var o in r)o=="class"&&(e.class+=" "+r[o]),o=="style"?e.style=(e.style?e.style+";":"")+r[o]:!e[o]&&o!="contenteditable"&&o!="nodeName"&&(e[o]=String(r[o]))}),[Qr.node(0,t.state.doc.content.size,e)]}function Oy(t){if(t.markCursor){var e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),t.cursorWrapper={dom:e,deco:Qr.widget(t.state.selection.head,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function ky(t){return!t.someProp("editable",function(e){return e(t.state)===!1})}function xb(t,e){var r=Math.min(t.$anchor.sharedDepth(t.head),e.$anchor.sharedDepth(e.head));return t.$anchor.start(r)!=e.$anchor.start(r)}function by(t){var e={};return t.someProp("nodeViews",function(r){for(var o in r)Object.prototype.hasOwnProperty.call(e,o)||(e[o]=r[o])}),e}function Qb(t,e){var r=0,o=0;for(var a in t){if(t[a]!=e[a])return!0;r++}for(var l in e)o++;return r!=o}function Dy(t){if(t.spec.state||t.spec.filterTransaction||t.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var Ms={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",229:"q"},Yd={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"',229:"Q"},By=typeof navigator!="undefined"&&/Chrome\/(\d+)/.exec(navigator.userAgent),Ub=typeof navigator!="undefined"&&/Apple Computer/.test(navigator.vendor),Fb=typeof navigator!="undefined"&&/Gecko\/\d+/.test(navigator.userAgent),My=typeof navigator!="undefined"&&/Mac/.test(navigator.platform),Vb=typeof navigator!="undefined"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),Gb=By&&(My||+By[1]<57)||Fb&&My;for(var mn=0;mn<10;mn++)Ms[48+mn]=Ms[96+mn]=String(mn);for(var mn=1;mn<=24;mn++)Ms[mn+111]="F"+mn;for(var mn=65;mn<=90;mn++)Ms[mn]=String.fromCharCode(mn+32),Yd[mn]=String.fromCharCode(mn);for(var HA in Ms)Yd.hasOwnProperty(HA)||(Yd[HA]=Ms[HA]);function jb(t){var e=Gb&&(t.ctrlKey||t.altKey||t.metaKey)||(Ub||Vb)&&t.shiftKey&&t.key&&t.key.length==1,r=!e&&t.key||(t.shiftKey?Yd:Ms)[t.keyCode]||t.key||"Unidentified";return r=="Esc"&&(r="Escape"),r=="Del"&&(r="Delete"),r=="Left"&&(r="ArrowLeft"),r=="Up"&&(r="ArrowUp"),r=="Right"&&(r="ArrowRight"),r=="Down"&&(r="ArrowDown"),r}var Hb=typeof navigator!="undefined"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!1;function Kb(t){var e=t.split(/-(?!$)/),r=e[e.length-1];r=="Space"&&(r=" ");for(var o,a,l,d,p=0;p<e.length-1;p++){var g=e[p];if(/^(cmd|meta|m)$/i.test(g))d=!0;else if(/^a(lt)?$/i.test(g))o=!0;else if(/^(c|ctrl|control)$/i.test(g))a=!0;else if(/^s(hift)?$/i.test(g))l=!0;else if(/^mod$/i.test(g))Hb?d=!0:a=!0;else throw new Error("Unrecognized modifier name: "+g)}return o&&(r="Alt-"+r),a&&(r="Ctrl-"+r),d&&(r="Meta-"+r),l&&(r="Shift-"+r),r}function Wb(t){var e=Object.create(null);for(var r in t)e[Kb(r)]=t[r];return e}function KA(t,e,r){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),r!==!1&&e.shiftKey&&(t="Shift-"+t),t}function Yb(t){return new An({props:{handleKeyDown:Ly(t)}})}function Ly(t){var e=Wb(t);return function(r,o){var a=jb(o),l=a.length==1&&a!=" ",d,p=e[KA(a,o,!l)];if(p&&p(r.state,r.dispatch,r))return!0;if(l&&(o.shiftKey||o.altKey||o.metaKey||a.charCodeAt(0)>127)&&(d=Ms[o.keyCode])&&d!=a){var g=e[KA(d,o,!0)];if(g&&g(r.state,r.dispatch,r))return!0}else if(l&&o.shiftKey){var v=e[KA(a,o,!0)];if(v&&v(r.state,r.dispatch,r))return!0}return!1}}function qb(t){return Object.prototype.toString.call(t).slice(8,-1)}function WA(t){return qb(t)!=="Object"?!1:t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function qd(t,e){const r=re({},t);return WA(t)&&WA(e)&&Object.keys(e).forEach(o=>{WA(e[o])?o in t?r[o]=qd(t[o],e[o]):Object.assign(r,{[o]:e[o]}):Object.assign(r,{[o]:e[o]})}),r}function Py(t){return typeof t=="function"}function at(t,e=void 0,...r){return Py(t)?e?t.bind(e)(...r):t(...r):t}function Ne(t,e,r){return t.config[e]===void 0&&t.parent?Ne(t.parent,e,r):typeof t.config[e]=="function"?t.config[e].bind(Hn(re({},r),{parent:t.parent?Ne(t.parent,e,r):null})):t.config[e]}class rn{constructor(e={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config=re(re({},this.config),e),this.name=this.config.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=at(Ne(this,"addOptions",{name:this.name}))),this.storage=at(Ne(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new rn(e)}configure(e={}){const r=this.extend();return r.options=qd(this.options,e),r.storage=at(Ne(r,"addStorage",{name:r.name,options:r.options})),r}extend(e={}){const r=new rn(e);return r.parent=this,this.child=r,r.name=e.name?e.name:r.parent.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${r.name}".`),r.options=e.defaultOptions?e.defaultOptions:r.parent.options,e.addOptions&&(r.options=at(Ne(r,"addOptions",{name:r.name}))),r.storage=at(Ne(r,"addStorage",{name:r.name,options:r.options})),r}}function xy(t,e,r){const{from:o,to:a}=e,{blockSeparator:l=`

`,textSerializers:d={}}=r||{};let p="",g=!0;return t.nodesBetween(o,a,(v,C,y,w)=>{var k;const M=d==null?void 0:d[v.type.name];M?(v.isBlock&&!g&&(p+=l,g=!0),p+=M({node:v,pos:C,parent:y,index:w})):v.isText?(p+=(k=v==null?void 0:v.text)===null||k===void 0?void 0:k.slice(Math.max(o,C)-C,a-C),g=!1):v.isBlock&&!g&&(p+=l,g=!0)}),p}function Qy(t){return Object.fromEntries(Object.entries(t.nodes).filter(([,e])=>e.spec.toText).map(([e,r])=>[e,r.spec.toText]))}const Jb=rn.create({name:"clipboardTextSerializer",addProseMirrorPlugins(){return[new An({key:new ai("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:t}=this,{state:e,schema:r}=t,{doc:o,selection:a}=e,{from:l,to:d}=a,p=Qy(r);return xy(o,{from:l,to:d},{textSerializers:p})}}})]}}),zb=()=>({editor:t,view:e})=>(requestAnimationFrame(()=>{t.isDestroyed||e.dom.blur()}),!0);var Xb=Object.freeze({__proto__:null,blur:zb});const $b=(t=!1)=>({commands:e})=>e.setContent("",t);var Zb=Object.freeze({__proto__:null,clearContent:$b});const eD=()=>({state:t,tr:e,dispatch:r})=>{const{selection:o}=e,{ranges:a}=o;return a.forEach(l=>{t.doc.nodesBetween(l.$from.pos,l.$to.pos,(d,p)=>{if(d.type.isText)return;const g=e.doc.resolve(e.mapping.map(p)),v=e.doc.resolve(e.mapping.map(p+d.nodeSize)),C=g.blockRange(v);if(!C)return;const y=_c(C);if(d.type.isTextblock&&r){const{defaultType:w}=g.parent.contentMatchAt(g.index());e.setNodeMarkup(C.start,w)}(y||y===0)&&r&&e.lift(C,y)})}),!0};var tD=Object.freeze({__proto__:null,clearNodes:eD});const rD=t=>e=>t(e);var nD=Object.freeze({__proto__:null,command:rD});const iD=()=>({state:t,dispatch:e})=>C0(t,e);var oD=Object.freeze({__proto__:null,createParagraphNear:iD});function nn(t,e){if(typeof t=="string"){if(!e.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return e.nodes[t]}return t}const sD=t=>({tr:e,state:r,dispatch:o})=>{const a=nn(t,r.schema),l=e.selection.$anchor;for(let d=l.depth;d>0;d-=1)if(l.node(d).type===a){if(o){const g=l.before(d),v=l.after(d);e.delete(g,v).scrollIntoView()}return!0}return!1};var aD=Object.freeze({__proto__:null,deleteNode:sD});const cD=t=>({tr:e,dispatch:r})=>{const{from:o,to:a}=t;return r&&e.delete(o,a),!0};var lD=Object.freeze({__proto__:null,deleteRange:cD});const uD=()=>({state:t,dispatch:e})=>cA(t,e);var dD=Object.freeze({__proto__:null,deleteSelection:uD});const hD=()=>({commands:t})=>t.keyboardShortcut("Enter");var pD=Object.freeze({__proto__:null,enter:hD});const fD=()=>({state:t,dispatch:e})=>I0(t,e);var AD=Object.freeze({__proto__:null,exitCode:fD});function Ls(t,e){if(typeof t=="string"){if(!e.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return e.marks[t]}return t}function YA(t){return Object.prototype.toString.call(t)==="[object RegExp]"}function Jd(t,e,r={strict:!0}){const o=Object.keys(e);return o.length?o.every(a=>r.strict?e[a]===t[a]:YA(e[a])?e[a].test(t[a]):e[a]===t[a]):!0}function qA(t,e,r={}){return t.find(o=>o.type===e&&Jd(o.attrs,r))}function gD(t,e,r={}){return!!qA(t,e,r)}function Uy(t,e,r={}){if(!t||!e)return;const o=t.parent.childAfter(t.parentOffset);if(!o.node)return;const a=qA(o.node.marks,e,r);if(!a)return;let l=t.index(),d=t.start()+o.offset,p=l+1,g=d+o.node.nodeSize;for(qA(o.node.marks,e,r);l>0&&a.isInSet(t.parent.child(l-1).marks);)l-=1,d-=t.parent.child(l).nodeSize;for(;p<t.parent.childCount&&gD(t.parent.child(p).marks,e,r);)g+=t.parent.child(p).nodeSize,p+=1;return{from:d,to:g}}const mD=(t,e={})=>({tr:r,state:o,dispatch:a})=>{const l=Ls(t,o.schema),{doc:d,selection:p}=r,{$from:g,from:v,to:C}=p;if(a){const y=Uy(g,l,e);if(y&&y.from<=v&&y.to>=C){const w=Dt.create(d,y.from,y.to);r.setSelection(w)}}return!0};var vD=Object.freeze({__proto__:null,extendMarkRange:mD});const ED=t=>e=>{const r=typeof t=="function"?t(e):t;for(let o=0;o<r.length;o+=1)if(r[o](e))return!0;return!1};var ID=Object.freeze({__proto__:null,first:ED});function Ta(t=0,e=0,r=0){return Math.min(Math.max(t,e),r)}function CD(t){var e;return((e=t.constructor)===null||e===void 0?void 0:e.toString().substring(0,5))==="class"}function JA(t){return t&&typeof t=="object"&&!Array.isArray(t)&&!CD(t)}function Fy(t){return JA(t)&&t instanceof Dt}function yD(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}function _D(t,e=null){if(!e)return null;if(e==="start"||e===!0)return{from:0,to:0};if(e==="end"){const{size:r}=t.doc.content;return{from:r,to:r}}return{from:e,to:e}}const SD=(t=null)=>({editor:e,view:r,tr:o,dispatch:a})=>{const l=()=>{yD()&&r.dom.focus(),requestAnimationFrame(()=>{e.isDestroyed||(r.focus(),e.commands.scrollIntoView())})};if(r.hasFocus()&&t===null||t===!1)return!0;if(a&&t===null&&!Fy(e.state.selection))return l(),!0;const{from:d,to:p}=_D(e.state,t)||e.state.selection,{doc:g,storedMarks:v}=o,C=ot.atStart(g).from,y=ot.atEnd(g).to,w=Ta(d,C,y),k=Ta(p,C,y),M=Dt.create(g,w,k),x=e.state.selection.eq(M);return a&&(x||o.setSelection(M),x&&v&&o.setStoredMarks(v),l()),!0};var TD=Object.freeze({__proto__:null,focus:SD});const RD=(t,e)=>r=>t.every((o,a)=>e(o,Hn(re({},r),{index:a})));var wD=Object.freeze({__proto__:null,forEach:RD});const ND=(t,e)=>({tr:r,commands:o})=>o.insertContentAt({from:r.selection.from,to:r.selection.to},t,e);var OD=Object.freeze({__proto__:null,insertContent:ND});function Vy(t){const e=`<body>${t}</body>`;return new window.DOMParser().parseFromString(e,"text/html").body}function zd(t,e,r){if(r=re({slice:!0,parseOptions:{}},r),typeof t=="object"&&t!==null)try{return Array.isArray(t)?ee.fromArray(t.map(o=>e.nodeFromJSON(o))):e.nodeFromJSON(t)}catch(o){return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",o),zd("",e,r)}if(typeof t=="string"){const o=lo.fromSchema(e);return r.slice?o.parseSlice(Vy(t),r.parseOptions).content:o.parse(Vy(t),r.parseOptions)}return zd("",e,r)}function kD(t,e,r){const o=t.steps.length-1;if(o<e)return;const a=t.steps[o];if(!(a instanceof is||a instanceof si))return;const l=t.mapping.maps[o];let d=0;l.forEach((p,g,v,C)=>{d===0&&(d=C)}),t.setSelection(ot.near(t.doc.resolve(d),r))}const bD=(t,e,r)=>({tr:o,dispatch:a,editor:l})=>{if(a){r=re({parseOptions:{},updateSelection:!0},r);const d=zd(e,l.schema,{parseOptions:re({preserveWhitespace:"full"},r.parseOptions)});if(d.toString()==="<>")return!0;const{from:p,to:g}=typeof t=="number"?{from:t,to:t}:t;o.replaceWith(p,g,d),r.updateSelection&&kD(o,o.steps.length-1,1)}return!0};var DD=Object.freeze({__proto__:null,insertContentAt:bD});const BD=()=>({state:t,dispatch:e})=>h0(t,e);var MD=Object.freeze({__proto__:null,joinBackward:BD});const LD=()=>({state:t,dispatch:e})=>A0(t,e);var PD=Object.freeze({__proto__:null,joinForward:LD});const xD=typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1;function QD(t){const e=t.split(/-(?!$)/);let r=e[e.length-1];r==="Space"&&(r=" ");let o,a,l,d;for(let p=0;p<e.length-1;p+=1){const g=e[p];if(/^(cmd|meta|m)$/i.test(g))d=!0;else if(/^a(lt)?$/i.test(g))o=!0;else if(/^(c|ctrl|control)$/i.test(g))a=!0;else if(/^s(hift)?$/i.test(g))l=!0;else if(/^mod$/i.test(g))xD?d=!0:a=!0;else throw new Error(`Unrecognized modifier name: ${g}`)}return o&&(r=`Alt-${r}`),a&&(r=`Ctrl-${r}`),d&&(r=`Meta-${r}`),l&&(r=`Shift-${r}`),r}const UD=t=>({editor:e,view:r,tr:o,dispatch:a})=>{const l=QD(t).split(/-(?!$)/),d=l.find(v=>!["Alt","Ctrl","Meta","Shift"].includes(v)),p=new KeyboardEvent("keydown",{key:d==="Space"?" ":d,altKey:l.includes("Alt"),ctrlKey:l.includes("Ctrl"),metaKey:l.includes("Meta"),shiftKey:l.includes("Shift"),bubbles:!0,cancelable:!0}),g=e.captureTransaction(()=>{r.someProp("handleKeyDown",v=>v(r,p))});return g==null||g.steps.forEach(v=>{const C=v.map(o.mapping);C&&a&&o.maybeStep(C)}),!0};var FD=Object.freeze({__proto__:null,keyboardShortcut:UD});function kc(t,e,r={}){const{from:o,to:a,empty:l}=t.selection,d=e?nn(e,t.schema):null,p=[];t.doc.nodesBetween(o,a,(y,w)=>{if(y.isText)return;const k=Math.max(o,w),M=Math.min(a,w+y.nodeSize);p.push({node:y,from:k,to:M})});const g=a-o,v=p.filter(y=>d?d.name===y.node.type.name:!0).filter(y=>Jd(y.node.attrs,r,{strict:!1}));return l?!!v.length:v.reduce((y,w)=>y+w.to-w.from,0)>=g}const VD=(t,e={})=>({state:r,dispatch:o})=>{const a=nn(t,r.schema);return kc(r,a,e)?v0(r,o):!1};var GD=Object.freeze({__proto__:null,lift:VD});const jD=()=>({state:t,dispatch:e})=>y0(t,e);var HD=Object.freeze({__proto__:null,liftEmptyBlock:jD});const KD=t=>({state:e,dispatch:r})=>{const o=nn(t,e.schema);return yk(o)(e,r)};var WD=Object.freeze({__proto__:null,liftListItem:KD});const YD=()=>({state:t,dispatch:e})=>E0(t,e);var qD=Object.freeze({__proto__:null,newlineInCode:YD});function Xd(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function Gy(t,e){const r=typeof e=="string"?[e]:e;return Object.keys(t).reduce((o,a)=>(r.includes(a)||(o[a]=t[a]),o),{})}const JD=(t,e)=>({tr:r,state:o,dispatch:a})=>{let l=null,d=null;const p=Xd(typeof t=="string"?t:t.name,o.schema);return p?(p==="node"&&(l=nn(t,o.schema)),p==="mark"&&(d=Ls(t,o.schema)),a&&r.selection.ranges.forEach(g=>{o.doc.nodesBetween(g.$from.pos,g.$to.pos,(v,C)=>{l&&l===v.type&&r.setNodeMarkup(C,void 0,Gy(v.attrs,e)),d&&v.marks.length&&v.marks.forEach(y=>{d===y.type&&r.addMark(C,C+v.nodeSize,d.create(Gy(y.attrs,e)))})})}),!0):!1};var zD=Object.freeze({__proto__:null,resetAttributes:JD});const XD=()=>({tr:t,dispatch:e})=>(e&&t.scrollIntoView(),!0);var $D=Object.freeze({__proto__:null,scrollIntoView:XD});const ZD=()=>({tr:t,commands:e})=>e.setTextSelection({from:0,to:t.doc.content.size});var eB=Object.freeze({__proto__:null,selectAll:ZD});const tB=()=>({state:t,dispatch:e})=>p0(t,e);var rB=Object.freeze({__proto__:null,selectNodeBackward:tB});const nB=()=>({state:t,dispatch:e})=>g0(t,e);var iB=Object.freeze({__proto__:null,selectNodeForward:nB});const oB=()=>({state:t,dispatch:e})=>Ak(t,e);var sB=Object.freeze({__proto__:null,selectParentNode:oB});function jy(t,e,r={}){return zd(t,e,{slice:!1,parseOptions:r})}const aB=(t,e=!1,r={})=>({tr:o,editor:a,dispatch:l})=>{const{doc:d}=o,p=jy(t,a.schema,r),g=Dt.create(d,0,d.content.size);return l&&o.setSelection(g).replaceSelectionWith(p,!1).setMeta("preventUpdate",!e),!0};var cB=Object.freeze({__proto__:null,setContent:aB});function Hy(t,e){const r=Ls(e,t.schema),{from:o,to:a,empty:l}=t.selection,d=[];l?(t.storedMarks&&d.push(...t.storedMarks),d.push(...t.selection.$head.marks())):t.doc.nodesBetween(o,a,g=>{d.push(...g.marks)});const p=d.find(g=>g.type.name===r.name);return p?re({},p.attrs):{}}const lB=(t,e={})=>({tr:r,state:o,dispatch:a})=>{const{selection:l}=r,{empty:d,ranges:p}=l,g=Ls(t,o.schema);if(a)if(d){const v=Hy(o,g);r.addStoredMark(g.create(re(re({},v),e)))}else p.forEach(v=>{const C=v.$from.pos,y=v.$to.pos;o.doc.nodesBetween(C,y,(w,k)=>{const M=Math.max(k,C),x=Math.min(k+w.nodeSize,y);w.marks.find(Y=>Y.type===g)?w.marks.forEach(Y=>{g===Y.type&&r.addMark(M,x,g.create(re(re({},Y.attrs),e)))}):r.addMark(M,x,g.create(e))})});return!0};var uB=Object.freeze({__proto__:null,setMark:lB});const dB=(t,e)=>({tr:r})=>(r.setMeta(t,e),!0);var hB=Object.freeze({__proto__:null,setMeta:dB});const pB=(t,e={})=>({state:r,dispatch:o})=>{const a=nn(t,r.schema);return vk(a,e)(r,o)};var fB=Object.freeze({__proto__:null,setNode:pB});const AB=t=>({tr:e,dispatch:r})=>{if(r){const{doc:o}=e,a=ot.atStart(o).from,l=ot.atEnd(o).to,d=Ta(t,a,l),p=tt.create(o,d);e.setSelection(p)}return!0};var gB=Object.freeze({__proto__:null,setNodeSelection:AB});const mB=t=>({tr:e,dispatch:r})=>{if(r){const{doc:o}=e,{from:a,to:l}=typeof t=="number"?{from:t,to:t}:t,d=ot.atStart(o).from,p=ot.atEnd(o).to,g=Ta(a,d,p),v=Ta(l,d,p),C=Dt.create(o,g,v);e.setSelection(C)}return!0};var vB=Object.freeze({__proto__:null,setTextSelection:mB});const EB=t=>({state:e,dispatch:r})=>{const o=nn(t,e.schema);return Tk(o)(e,r)};var IB=Object.freeze({__proto__:null,sinkListItem:EB});function $d(t,e,r){return Object.fromEntries(Object.entries(r).filter(([o])=>{const a=t.find(l=>l.type===e&&l.name===o);return a?a.attribute.keepOnSplit:!1}))}function CB(t){for(let e=0;e<t.edgeCount;e+=1){const{type:r}=t.edge(e);if(r.isTextblock&&!r.hasRequiredAttrs())return r}return null}function Ky(t,e){const r=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(r){const o=r.filter(a=>e==null?void 0:e.includes(a.type.name));t.tr.ensureMarks(o)}}const yB=({keepMarks:t=!0}={})=>({tr:e,state:r,dispatch:o,editor:a})=>{const{selection:l,doc:d}=e,{$from:p,$to:g}=l,v=a.extensionManager.attributes,C=$d(v,p.node().type.name,p.node().attrs);if(l instanceof tt&&l.node.isBlock)return!p.parentOffset||!ss(d,p.pos)?!1:(o&&(t&&Ky(r,a.extensionManager.splittableMarks),e.split(p.pos).scrollIntoView()),!0);if(!p.parent.isBlock)return!1;if(o){const y=g.parentOffset===g.parent.content.size;l instanceof Dt&&e.deleteSelection();const w=p.depth===0?void 0:CB(p.node(-1).contentMatchAt(p.indexAfter(-1)));let k=y&&w?[{type:w,attrs:C}]:void 0,M=ss(e.doc,e.mapping.map(p.pos),1,k);if(!k&&!M&&ss(e.doc,e.mapping.map(p.pos),1,w?[{type:w}]:void 0)&&(M=!0,k=w?[{type:w,attrs:C}]:void 0),M&&(e.split(e.mapping.map(p.pos),1,k),w&&!y&&!p.parentOffset&&p.parent.type!==w)){const x=e.mapping.map(p.before()),V=e.doc.resolve(x);p.node(-1).canReplaceWith(V.index(),V.index()+1,w)&&e.setNodeMarkup(e.mapping.map(p.before()),w)}t&&Ky(r,a.extensionManager.splittableMarks),e.scrollIntoView()}return!0};var _B=Object.freeze({__proto__:null,splitBlock:yB});const SB=t=>({tr:e,state:r,dispatch:o,editor:a})=>{var l;const d=nn(t,r.schema),{$from:p,$to:g}=r.selection,v=r.selection.node;if(v&&v.isBlock||p.depth<2||!p.sameParent(g))return!1;const C=p.node(-1);if(C.type!==d)return!1;const y=a.extensionManager.attributes;if(p.parent.content.size===0&&p.node(-1).childCount===p.indexAfter(-1)){if(p.depth===2||p.node(-3).type!==d||p.index(-2)!==p.node(-2).childCount-1)return!1;if(o){let V=ee.empty;const Y=p.index(-1)?1:p.index(-2)?2:3;for(let me=p.depth-Y;me>=p.depth-3;me-=1)V=ee.from(p.node(me).copy(V));const H=p.indexAfter(-1)<p.node(-2).childCount?1:p.indexAfter(-2)<p.node(-3).childCount?2:3,he=$d(y,p.node().type.name,p.node().attrs),Q=((l=d.contentMatch.defaultType)===null||l===void 0?void 0:l.createAndFill(he))||void 0;V=V.append(ee.from(d.createAndFill(null,Q)||void 0));const pe=p.before(p.depth-(Y-1));e.replace(pe,p.after(-H),new ye(V,4-Y,0));let oe=-1;e.doc.nodesBetween(pe,e.doc.content.size,(me,xe)=>{if(oe>-1)return!1;me.isTextblock&&me.content.size===0&&(oe=xe+1)}),oe>-1&&e.setSelection(Dt.near(e.doc.resolve(oe))),e.scrollIntoView()}return!0}const w=g.pos===p.end()?C.contentMatchAt(0).defaultType:null,k=$d(y,C.type.name,C.attrs),M=$d(y,p.node().type.name,p.node().attrs);e.delete(p.pos,g.pos);const x=w?[{type:d,attrs:k},{type:w,attrs:M}]:[{type:d,attrs:k}];return ss(e.doc,p.pos,2)?(o&&e.split(p.pos,2,x).scrollIntoView(),!0):!1};var TB=Object.freeze({__proto__:null,splitListItem:SB});function RB(t,e){for(let r=t.depth;r>0;r-=1){const o=t.node(r);if(e(o))return{pos:r>0?t.before(r):0,start:t.start(r),depth:r,node:o}}}function wB(t){return e=>RB(e.$from,t)}function Zd(t){const e=t.filter(a=>a.type==="extension"),r=t.filter(a=>a.type==="node"),o=t.filter(a=>a.type==="mark");return{baseExtensions:e,nodeExtensions:r,markExtensions:o}}function Wy(t,e){const{nodeExtensions:r}=Zd(e),o=r.find(d=>d.name===t);if(!o)return!1;const a={name:o.name,options:o.options,storage:o.storage},l=at(Ne(o,"group",a));return typeof l!="string"?!1:l.split(" ").includes("list")}const NB=(t,e)=>({editor:r,tr:o,state:a,dispatch:l,chain:d,commands:p,can:g})=>{const{extensions:v}=r.extensionManager,C=nn(t,a.schema),y=nn(e,a.schema),{selection:w}=a,{$from:k,$to:M}=w,x=k.blockRange(M);if(!x)return!1;const V=wB(H=>Wy(H.type.name,v))(w);if(x.depth>=1&&V&&x.depth-V.depth<=1){if(V.node.type===C)return p.liftListItem(y);if(Wy(V.node.type.name,v)&&C.validContent(V.node.content)&&l)return o.setNodeMarkup(V.pos,C),!0}return g().wrapInList(C)?p.wrapInList(C):d().clearNodes().wrapInList(C).run()};var OB=Object.freeze({__proto__:null,toggleList:NB});function zA(t,e,r={}){const{empty:o,ranges:a}=t.selection,l=e?Ls(e,t.schema):null;if(o)return!!(t.storedMarks||t.selection.$from.marks()).filter(y=>l?l.name===y.type.name:!0).find(y=>Jd(y.attrs,r,{strict:!1}));let d=0;const p=[];if(a.forEach(({$from:y,$to:w})=>{const k=y.pos,M=w.pos;t.doc.nodesBetween(k,M,(x,V)=>{if(!x.isText&&!x.marks.length)return;const Y=Math.max(k,V),H=Math.min(M,V+x.nodeSize);d+=H-Y,p.push(...x.marks.map(Q=>({mark:Q,from:Y,to:H})))})}),d===0)return!1;const g=p.filter(y=>l?l.name===y.mark.type.name:!0).filter(y=>Jd(y.mark.attrs,r,{strict:!1})).reduce((y,w)=>y+w.to-w.from,0),v=p.filter(y=>l?y.mark.type!==l&&y.mark.type.excludes(l):!0).reduce((y,w)=>y+w.to-w.from,0);return(g>0?g+v:g)>=d}const kB=(t,e={},r={})=>({state:o,commands:a})=>{const{extendEmptyMarkRange:l=!1}=r,d=Ls(t,o.schema);return zA(o,d,e)?a.unsetMark(d,{extendEmptyMarkRange:l}):a.setMark(d,e)};var bB=Object.freeze({__proto__:null,toggleMark:kB});const DB=(t,e,r={})=>({state:o,commands:a})=>{const l=nn(t,o.schema),d=nn(e,o.schema);return kc(o,l,r)?a.setNode(d):a.setNode(l,r)};var BB=Object.freeze({__proto__:null,toggleNode:DB});const MB=(t,e={})=>({state:r,dispatch:o})=>{const a=nn(t,r.schema);return kc(r,a,e)?v0(r,o):S0(a,e)(r,o)};var LB=Object.freeze({__proto__:null,toggleWrap:MB});const PB=()=>({state:t,dispatch:e})=>{const r=t.plugins;for(let o=0;o<r.length;o+=1){const a=r[o];let l;if(a.spec.isInputRules&&(l=a.getState(t))){if(e){const d=t.tr,p=l.transform;for(let g=p.steps.length-1;g>=0;g-=1)d.step(p.steps[g].invert(p.docs[g]));if(l.text){const g=d.doc.resolve(l.from).marks();d.replaceWith(l.from,l.to,t.schema.text(l.text,g))}else d.delete(l.from,l.to)}return!0}}return!1};var xB=Object.freeze({__proto__:null,undoInputRule:PB});const QB=()=>({tr:t,state:e,dispatch:r})=>{const{selection:o}=t,{empty:a,ranges:l}=o;return a||r&&Object.entries(e.schema.marks).forEach(([,d])=>{l.forEach(p=>{t.removeMark(p.$from.pos,p.$to.pos,d)})}),!0};var UB=Object.freeze({__proto__:null,unsetAllMarks:QB});const FB=(t,e={})=>({tr:r,state:o,dispatch:a})=>{var l;const{extendEmptyMarkRange:d=!1}=e,{selection:p}=r,g=Ls(t,o.schema),{$from:v,empty:C,ranges:y}=p;if(!a)return!0;if(C&&d){let{from:w,to:k}=p;const M=(l=v.marks().find(V=>V.type===g))===null||l===void 0?void 0:l.attrs,x=Uy(v,g,M);x&&(w=x.from,k=x.to),r.removeMark(w,k,g)}else y.forEach(w=>{r.removeMark(w.$from.pos,w.$to.pos,g)});return r.removeStoredMark(g),!0};var VB=Object.freeze({__proto__:null,unsetMark:FB});const GB=(t,e={})=>({tr:r,state:o,dispatch:a})=>{let l=null,d=null;const p=Xd(typeof t=="string"?t:t.name,o.schema);return p?(p==="node"&&(l=nn(t,o.schema)),p==="mark"&&(d=Ls(t,o.schema)),a&&r.selection.ranges.forEach(g=>{const v=g.$from.pos,C=g.$to.pos;o.doc.nodesBetween(v,C,(y,w)=>{l&&l===y.type&&r.setNodeMarkup(w,void 0,re(re({},y.attrs),e)),d&&y.marks.length&&y.marks.forEach(k=>{if(d===k.type){const M=Math.max(w,v),x=Math.min(w+y.nodeSize,C);r.addMark(M,x,d.create(re(re({},k.attrs),e)))}})})}),!0):!1};var jB=Object.freeze({__proto__:null,updateAttributes:GB});const HB=(t,e={})=>({state:r,dispatch:o})=>{const a=nn(t,r.schema);return kc(r,a,e)?!1:S0(a,e)(r,o)};var KB=Object.freeze({__proto__:null,wrapIn:HB});const WB=(t,e={})=>({state:r,dispatch:o})=>{const a=nn(t,r.schema);return Ik(a,e)(r,o)};var YB=Object.freeze({__proto__:null,wrapInList:WB});const qB=rn.create({name:"commands",addCommands(){return re(re(re(re(re(re(re(re(re(re(re(re(re(re(re(re(re(re(re(re(re(re(re(re(re(re(re(re(re(re(re(re(re(re(re(re(re(re(re(re(re(re(re(re(re(re(re(re({},Xb),Zb),tD),nD),oD),aD),lD),dD),pD),AD),vD),ID),TD),wD),OD),DD),MD),PD),FD),GD),HD),WD),qD),zD),$D),eB),rB),iB),sB),cB),uB),hB),fB),gB),vB),IB),_B),TB),OB),bB),BB),LB),xB),UB),VB),jB),KB),YB)}}),JB=rn.create({name:"editable",addProseMirrorPlugins(){return[new An({key:new ai("editable"),props:{editable:()=>this.editor.options.editable}})]}}),zB=rn.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:t}=this;return[new An({key:new ai("focusEvents"),props:{handleDOMEvents:{focus:(e,r)=>{t.isFocused=!0;const o=t.state.tr.setMeta("focus",{event:r}).setMeta("addToHistory",!1);return e.dispatch(o),!1},blur:(e,r)=>{t.isFocused=!1;const o=t.state.tr.setMeta("blur",{event:r}).setMeta("addToHistory",!1);return e.dispatch(o),!1}}}})]}}),XB=rn.create({name:"keymap",addKeyboardShortcuts(){const t=()=>this.editor.commands.first(({commands:r})=>[()=>r.undoInputRule(),()=>r.deleteSelection(),()=>r.joinBackward(),()=>r.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:r})=>[()=>r.deleteSelection(),()=>r.joinForward(),()=>r.selectNodeForward()]);return{Enter:()=>this.editor.commands.first(({commands:r})=>[()=>r.newlineInCode(),()=>r.createParagraphNear(),()=>r.liftEmptyBlock(),()=>r.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()}}}),$B=rn.create({name:"tabindex",addProseMirrorPlugins(){return[new An({key:new ai("tabindex"),props:{attributes:{tabindex:"0"}}})]}});var ZB=Object.freeze({__proto__:null,ClipboardTextSerializer:Jb,Commands:qB,Editable:JB,FocusEvents:zB,Keymap:XB,Tabindex:$B});function eM(t,e){const r=nn(e,t.schema),{from:o,to:a}=t.selection,l=[];t.doc.nodesBetween(o,a,p=>{l.push(p)});const d=l.reverse().find(p=>p.type.name===r.name);return d?re({},d.attrs):{}}function tM(t,e){const r=Xd(typeof e=="string"?e:e.name,t.schema);return r==="node"?eM(t,e):r==="mark"?Hy(t,e):{}}function rM(t,e,r={}){if(!e)return kc(t,null,r)||zA(t,null,r);const o=Xd(e,t.schema);return o==="node"?kc(t,e,r):o==="mark"?zA(t,e,r):!1}function nM(t){(t==null?void 0:t.parentNode)&&t.parentNode.removeChild(t)}function iM(t,e){const r=pn.fromSchema(e).serializeFragment(t),a=document.implementation.createHTMLDocument().createElement("div");return a.appendChild(r),a.innerHTML}function oM(t,e){const r={from:0,to:t.content.size};return xy(t,r,e)}function sM(t){var e;const r=(e=t.type.createAndFill())===null||e===void 0?void 0:e.toJSON(),o=t.toJSON();return JSON.stringify(r)===JSON.stringify(o)}function aM(t){const e=document.querySelector("style[data-tiptap-style]");if(e!==null)return e;const r=document.createElement("style");return r.setAttribute("data-tiptap-style",""),r.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(r),r}function XA(t){const{state:e,transaction:r}=t;let{selection:o}=r,{doc:a}=r,{storedMarks:l}=r;return Hn(re({},e),{schema:e.schema,plugins:e.plugins,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return l},get selection(){return o},get doc(){return a},get tr(){return o=r.selection,a=r.doc,l=r.storedMarks,r}})}class $A{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:r,state:o}=this,{view:a}=r,{tr:l}=o,d=this.buildProps(l);return Object.fromEntries(Object.entries(e).map(([p,g])=>[p,(...C)=>{const y=g(...C)(d);return!l.getMeta("preventDispatch")&&!this.hasCustomState&&a.dispatch(l),y}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,r=!0){const{rawCommands:o,editor:a,state:l}=this,{view:d}=a,p=[],g=!!e,v=e||l.tr,C=()=>(!g&&r&&!v.getMeta("preventDispatch")&&!this.hasCustomState&&d.dispatch(v),p.every(w=>w===!0)),y=Hn(re({},Object.fromEntries(Object.entries(o).map(([w,k])=>[w,(...x)=>{const V=this.buildProps(v,r),Y=k(...x)(V);return p.push(Y),y}]))),{run:C});return y}createCan(e){const{rawCommands:r,state:o}=this,a=void 0,l=e||o.tr,d=this.buildProps(l,a),p=Object.fromEntries(Object.entries(r).map(([g,v])=>[g,(...C)=>v(...C)(Hn(re({},d),{dispatch:a}))]));return Hn(re({},p),{chain:()=>this.createChain(l,a)})}buildProps(e,r=!0){const{rawCommands:o,editor:a,state:l}=this,{view:d}=a;l.storedMarks&&e.setStoredMarks(l.storedMarks);const p={tr:e,editor:a,view:d,state:XA({state:l,transaction:e}),dispatch:r?()=>{}:void 0,chain:()=>this.createChain(e),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(o).map(([g,v])=>[g,(...C)=>v(...C)(p)]))}};return p}}class eh{constructor(e){this.find=e.find,this.handler=e.handler}}const cM=(t,e)=>{if(YA(e))return e.exec(t);const r=e(t);if(!r)return null;const o=[];return o.push(r.text),o.index=r.index,o.input=t,o.data=r.data,r.replaceWith&&(r.text.includes(r.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),o.push(r.replaceWith)),o};function ZA(t){var e;const{editor:r,from:o,to:a,text:l,rules:d,plugin:p}=t,{view:g}=r;if(g.composing)return!1;const v=g.state.doc.resolve(o);if(v.parent.type.spec.code||!!((e=v.nodeBefore||v.nodeAfter)===null||e===void 0?void 0:e.marks.find(k=>k.type.spec.code)))return!1;let C=!1;const y=500,w=v.parent.textBetween(Math.max(0,v.parentOffset-y),v.parentOffset,void 0,"\uFFFC")+l;return d.forEach(k=>{if(C)return;const M=cM(w,k.find);if(!M)return;const x=g.state.tr,V=XA({state:g.state,transaction:x}),Y={from:o-(M[0].length-l.length),to:a},{commands:H,chain:he,can:Q}=new $A({editor:r,state:V});k.handler({state:V,range:Y,match:M,commands:H,chain:he,can:Q}),!!x.steps.length&&(x.setMeta(p,{transform:x,from:o,to:a,text:l}),g.dispatch(x),C=!0)}),C}function lM(t){const{editor:e,rules:r}=t,o=new An({state:{init(){return null},apply(a,l){const d=a.getMeta(this);return d||(a.selectionSet||a.docChanged?null:l)}},props:{handleTextInput(a,l,d,p){return ZA({editor:e,from:l,to:d,text:p,rules:r,plugin:o})},handleDOMEvents:{compositionend:a=>(setTimeout(()=>{const{$cursor:l}=a.state.selection;l&&ZA({editor:e,from:l.pos,to:l.pos,text:"",rules:r,plugin:o})}),!1)},handleKeyDown(a,l){if(l.key!=="Enter")return!1;const{$cursor:d}=a.state.selection;return d?ZA({editor:e,from:d.pos,to:d.pos,text:`
`,rules:r,plugin:o}):!1}},isInputRules:!0});return o}function uM(t){return typeof t=="number"}class dM{constructor(e){this.find=e.find,this.handler=e.handler}}const hM=(t,e)=>{if(YA(e))return[...t.matchAll(e)];const r=e(t);return r?r.map(o=>{const a=[];return a.push(o.text),a.index=o.index,a.input=t,a.data=o.data,o.replaceWith&&(o.text.includes(o.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),a.push(o.replaceWith)),a}):[]};function pM(t){const{editor:e,state:r,from:o,to:a,rules:l}=t,{commands:d,chain:p,can:g}=new $A({editor:e,state:r});r.doc.nodesBetween(o,a,(v,C)=>{if(!v.isTextblock||v.type.spec.code)return;const y=Math.max(o,C),w=Math.min(a,C+v.content.size),k=v.textBetween(y-C,w-C,void 0,"\uFFFC");l.forEach(M=>{hM(k,M.find).forEach(V=>{if(V.index===void 0)return;const Y=y+V.index+1,H=Y+V[0].length,he={from:r.tr.mapping.map(Y),to:r.tr.mapping.map(H)};M.handler({state:r,range:he,match:V,commands:d,chain:p,can:g})})})})}function fM(t){const{editor:e,rules:r}=t;let o=!1;const a=new An({props:{handlePaste:(l,d)=>{var p;const g=(p=d.clipboardData)===null||p===void 0?void 0:p.getData("text/html");return o=!!(g==null?void 0:g.includes("data-pm-slice")),!1}},appendTransaction:(l,d,p)=>{const g=l[0];if(!g.getMeta("paste")||o)return;const{doc:v,before:C}=g,y=C.content.findDiffStart(v.content),w=C.content.findDiffEnd(v.content);if(!uM(y)||!w||y===w.b)return;const k=p.tr,M=XA({state:p,transaction:k});if(pM({editor:e,state:M,from:Math.max(y-1,0),to:w.b,rules:r,plugin:a}),!!k.steps.length)return k},isPasteRules:!0});return a}function Yy(t){const e=[],{nodeExtensions:r,markExtensions:o}=Zd(t),a=[...r,...o],l={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0};return t.forEach(d=>{const p={name:d.name,options:d.options,storage:d.storage},g=Ne(d,"addGlobalAttributes",p);if(!g)return;g().forEach(C=>{C.types.forEach(y=>{Object.entries(C.attributes).forEach(([w,k])=>{e.push({type:y,name:w,attribute:re(re({},l),k)})})})})}),a.forEach(d=>{const p={name:d.name,options:d.options,storage:d.storage},g=Ne(d,"addAttributes",p);if(!g)return;const v=g();Object.entries(v).forEach(([C,y])=>{e.push({type:d.name,name:C,attribute:re(re({},l),y)})})}),e}function vn(...t){return t.filter(e=>!!e).reduce((e,r)=>{const o=re({},e);return Object.entries(r).forEach(([a,l])=>{if(!o[a]){o[a]=l;return}a==="class"?o[a]=[o[a],l].join(" "):a==="style"?o[a]=[o[a],l].join("; "):o[a]=l}),o},{})}function eg(t,e){return e.filter(r=>r.attribute.rendered).map(r=>r.attribute.renderHTML?r.attribute.renderHTML(t.attrs)||{}:{[r.name]:t.attrs[r.name]}).reduce((r,o)=>vn(r,o),{})}function AM(t={}){return Object.keys(t).length===0&&t.constructor===Object}function gM(t){return typeof t!="string"?t:t.match(/^\d*(\.\d+)?$/)?Number(t):t==="true"?!0:t==="false"?!1:t}function qy(t,e){return t.style?t:Hn(re({},t),{getAttrs:r=>{const o=t.getAttrs?t.getAttrs(r):t.attrs;if(o===!1)return!1;const a=e.filter(l=>l.attribute.rendered).reduce((l,d)=>{const p=d.attribute.parseHTML?d.attribute.parseHTML(r):gM(r.getAttribute(d.name));return JA(p)&&console.warn(`[tiptap warn]: BREAKING CHANGE: "parseHTML" for your attribute "${d.name}" returns an object but should return the value itself. If this is expected you can ignore this message. This warning will be removed in one of the next releases. Further information: https://github.com/ueberdosis/tiptap/issues/1863`),p==null?l:Hn(re({},l),{[d.name]:p})},{});return re(re({},o),a)}})}function Jy(t){return Object.fromEntries(Object.entries(t).filter(([e,r])=>e==="attrs"&&AM(r)?!1:r!=null))}function mM(t){var e;const r=Yy(t),{nodeExtensions:o,markExtensions:a}=Zd(t),l=(e=o.find(g=>Ne(g,"topNode")))===null||e===void 0?void 0:e.name,d=Object.fromEntries(o.map(g=>{const v=r.filter(V=>V.type===g.name),C={name:g.name,options:g.options,storage:g.storage},y=t.reduce((V,Y)=>{const H=Ne(Y,"extendNodeSchema",C);return re(re({},V),H?H(g):{})},{}),w=Jy(Hn(re({},y),{content:at(Ne(g,"content",C)),marks:at(Ne(g,"marks",C)),group:at(Ne(g,"group",C)),inline:at(Ne(g,"inline",C)),atom:at(Ne(g,"atom",C)),selectable:at(Ne(g,"selectable",C)),draggable:at(Ne(g,"draggable",C)),code:at(Ne(g,"code",C)),defining:at(Ne(g,"defining",C)),isolating:at(Ne(g,"isolating",C)),attrs:Object.fromEntries(v.map(V=>{var Y;return[V.name,{default:(Y=V==null?void 0:V.attribute)===null||Y===void 0?void 0:Y.default}]}))})),k=at(Ne(g,"parseHTML",C));k&&(w.parseDOM=k.map(V=>qy(V,v)));const M=Ne(g,"renderHTML",C);M&&(w.toDOM=V=>M({node:V,HTMLAttributes:eg(V,v)}));const x=Ne(g,"renderText",C);return x&&(w.toText=x),[g.name,w]})),p=Object.fromEntries(a.map(g=>{const v=r.filter(x=>x.type===g.name),C={name:g.name,options:g.options,storage:g.storage},y=t.reduce((x,V)=>{const Y=Ne(V,"extendMarkSchema",C);return re(re({},x),Y?Y(g):{})},{}),w=Jy(Hn(re({},y),{inclusive:at(Ne(g,"inclusive",C)),excludes:at(Ne(g,"excludes",C)),group:at(Ne(g,"group",C)),spanning:at(Ne(g,"spanning",C)),code:at(Ne(g,"code",C)),attrs:Object.fromEntries(v.map(x=>{var V;return[x.name,{default:(V=x==null?void 0:x.attribute)===null||V===void 0?void 0:V.default}]}))})),k=at(Ne(g,"parseHTML",C));k&&(w.parseDOM=k.map(x=>qy(x,v)));const M=Ne(g,"renderHTML",C);return M&&(w.toDOM=x=>M({mark:x,HTMLAttributes:eg(x,v)})),[g.name,w]}));return new Ea({topNode:l,nodes:d,marks:p})}function tg(t,e){return e.nodes[t]||e.marks[t]||null}function vM(t){const e=t.filter((r,o)=>t.indexOf(r)!==o);return[...new Set(e)]}class bc{constructor(e,r){this.splittableMarks=[],this.editor=r,this.extensions=bc.resolve(e),this.schema=mM(this.extensions),this.extensions.forEach(o=>{var a;this.editor.extensionStorage[o.name]=o.storage;const l={name:o.name,options:o.options,storage:o.storage,editor:this.editor,type:tg(o.name,this.schema)};o.type==="mark"&&((a=at(Ne(o,"keepOnSplit",l)))!==null&&a!==void 0?a:!0)&&this.splittableMarks.push(o.name);const d=Ne(o,"onBeforeCreate",l);d&&this.editor.on("beforeCreate",d);const p=Ne(o,"onCreate",l);p&&this.editor.on("create",p);const g=Ne(o,"onUpdate",l);g&&this.editor.on("update",g);const v=Ne(o,"onSelectionUpdate",l);v&&this.editor.on("selectionUpdate",v);const C=Ne(o,"onTransaction",l);C&&this.editor.on("transaction",C);const y=Ne(o,"onFocus",l);y&&this.editor.on("focus",y);const w=Ne(o,"onBlur",l);w&&this.editor.on("blur",w);const k=Ne(o,"onDestroy",l);k&&this.editor.on("destroy",k)})}static resolve(e){const r=bc.sort(bc.flatten(e)),o=vM(r.map(a=>a.name));return o.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${o.map(a=>`'${a}'`).join(", ")}]. This can lead to issues.`),r}static flatten(e){return e.map(r=>{const o={name:r.name,options:r.options,storage:r.storage},a=Ne(r,"addExtensions",o);return a?[r,...this.flatten(a())]:r}).flat(10)}static sort(e){const r=100;return e.sort((o,a)=>{const l=Ne(o,"priority")||r,d=Ne(a,"priority")||r;return l>d?-1:l<d?1:0})}get commands(){return this.extensions.reduce((e,r)=>{const o={name:r.name,options:r.options,storage:r.storage,editor:this.editor,type:tg(r.name,this.schema)},a=Ne(r,"addCommands",o);return a?re(re({},e),a()):e},{})}get plugins(){const{editor:e}=this,r=bc.sort([...this.extensions].reverse()),o=[],a=[],l=r.map(d=>{const p={name:d.name,options:d.options,storage:d.storage,editor:e,type:tg(d.name,this.schema)},g=[],v=Ne(d,"addKeyboardShortcuts",p);if(v){const k=Object.fromEntries(Object.entries(v()).map(([x,V])=>[x,()=>V({editor:e})])),M=Yb(k);g.push(M)}const C=Ne(d,"addInputRules",p);e.options.enableInputRules&&C&&o.push(...C());const y=Ne(d,"addPasteRules",p);e.options.enablePasteRules&&y&&a.push(...y());const w=Ne(d,"addProseMirrorPlugins",p);if(w){const k=w();g.push(...k)}return g}).flat();return[lM({editor:e,rules:o}),fM({editor:e,rules:a}),...l]}get attributes(){return Yy(this.extensions)}get nodeViews(){const{editor:e}=this,{nodeExtensions:r}=Zd(this.extensions);return Object.fromEntries(r.filter(o=>!!Ne(o,"addNodeView")).map(o=>{const a=this.attributes.filter(g=>g.type===o.name),l={name:o.name,options:o.options,storage:o.storage,editor:e,type:nn(o.name,this.schema)},d=Ne(o,"addNodeView",l);if(!d)return[];const p=(g,v,C,y)=>{const w=eg(g,a);return d()({editor:e,node:g,getPos:C,decorations:y,HTMLAttributes:w,extension:o})};return[o.name,p]}))}}class EM{constructor(){this.callbacks={}}on(e,r){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(r),this}emit(e,...r){const o=this.callbacks[e];return o&&o.forEach(a=>a.apply(this,r)),this}off(e,r){const o=this.callbacks[e];return o&&(r?this.callbacks[e]=o.filter(a=>a!==r):delete this.callbacks[e]),this}removeAllListeners(){this.callbacks={}}}const IM=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 1px !important;
  height: 1px !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}

.tippy-box[data-animation=fade][data-state=hidden] {
  opacity: 0
}`;class CM extends EM{constructor(e={}){super();this.isFocused=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(e),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}))},0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=aM(IM))}setOptions(e={}){this.options=re(re({},this.options),e),!(!this.view||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(e){this.setOptions({editable:e})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(e,r){const o=Py(r)?r(e,this.state.plugins):[...this.state.plugins,e],a=this.state.reconfigure({plugins:o});this.view.updateState(a)}unregisterPlugin(e){if(this.isDestroyed)return;const r=typeof e=="string"?`${e}$`:e.key,o=this.state.reconfigure({plugins:this.state.plugins.filter(a=>!a.key.startsWith(r))});this.view.updateState(o)}createExtensionManager(){const r=[...this.options.enableCoreExtensions?Object.values(ZB):[],...this.options.extensions].filter(o=>["extension","node","mark"].includes(o==null?void 0:o.type));this.extensionManager=new bc(r,this)}createCommandManager(){this.commandManager=new $A({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){this.view=new Ur(this.options.element,Hn(re({},this.options.editorProps),{dispatchTransaction:this.dispatchTransaction.bind(this),state:Mn.create({doc:jy(this.options.content,this.schema,this.options.parseOptions)})}));const e=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(e),this.createNodeViews();const r=this.view.dom;r.editor=this}createNodeViews(){this.view.setProps({nodeViews:this.extensionManager.nodeViews})}captureTransaction(e){this.isCapturingTransaction=!0,e(),this.isCapturingTransaction=!1;const r=this.capturedTransaction;return this.capturedTransaction=null,r}dispatchTransaction(e){if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=e;return}e.steps.forEach(d=>{var p;return(p=this.capturedTransaction)===null||p===void 0?void 0:p.step(d)});return}const r=this.state.apply(e),o=!this.state.selection.eq(r.selection);this.view.updateState(r),this.emit("transaction",{editor:this,transaction:e}),o&&this.emit("selectionUpdate",{editor:this,transaction:e});const a=e.getMeta("focus"),l=e.getMeta("blur");a&&this.emit("focus",{editor:this,event:a.event,transaction:e}),l&&this.emit("blur",{editor:this,event:l.event,transaction:e}),!(!e.docChanged||e.getMeta("preventUpdate"))&&this.emit("update",{editor:this,transaction:e})}getAttributes(e){return tM(this.state,e)}isActive(e,r){const o=typeof e=="string"?e:null,a=typeof e=="string"?r:e;return rM(this.state,o,a)}getJSON(){return this.state.doc.toJSON()}getHTML(){return iM(this.state.doc.content,this.schema)}getText(e){const{blockSeparator:r=`

`,textSerializers:o={}}=e||{};return oM(this.state.doc,{blockSeparator:r,textSerializers:re(re({},o),Qy(this.schema))})}get isEmpty(){return sM(this.state.doc)}getCharacterCount(){return this.state.doc.content.size-2}destroy(){this.emit("destroy"),this.view&&this.view.destroy(),this.removeAllListeners(),nM(this.css)}get isDestroyed(){var e;return!((e=this.view)===null||e===void 0?void 0:e.docView)}}class Ln{constructor(e={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config=re(re({},this.config),e),this.name=this.config.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=at(Ne(this,"addOptions",{name:this.name}))),this.storage=at(Ne(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Ln(e)}configure(e={}){const r=this.extend();return r.options=qd(this.options,e),r.storage=at(Ne(r,"addStorage",{name:r.name,options:r.options})),r}extend(e={}){const r=new Ln(e);return r.parent=this,this.child=r,r.name=e.name?e.name:r.parent.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${r.name}".`),r.options=e.defaultOptions?e.defaultOptions:r.parent.options,e.addOptions&&(r.options=at(Ne(r,"addOptions",{name:r.name}))),r.storage=at(Ne(r,"addStorage",{name:r.name,options:r.options})),r}}class Ps{constructor(e={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config=re(re({},this.config),e),this.name=this.config.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=at(Ne(this,"addOptions",{name:this.name}))),this.storage=at(Ne(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Ps(e)}configure(e={}){const r=this.extend();return r.options=qd(this.options,e),r.storage=at(Ne(r,"addStorage",{name:r.name,options:r.options})),r}extend(e={}){const r=new Ps(e);return r.parent=this,this.child=r,r.name=e.name?e.name:r.parent.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${r.name}".`),r.options=e.defaultOptions?e.defaultOptions:r.parent.options,e.addOptions&&(r.options=at(Ne(r,"addOptions",{name:r.name}))),r.storage=at(Ne(r,"addStorage",{name:r.name,options:r.options})),r}}function yM(t){return new eh({find:t.find,handler:({state:e,range:r,match:o})=>{const a=at(t.getAttributes,void 0,o)||{},{tr:l}=e,d=r.from;let p=r.to;if(o[1]){const g=o[0].lastIndexOf(o[1]);let v=d+g;v>p?v=p:p=v+o[1].length;const C=o[0][o[0].length-1];l.insertText(C,d+o[0].length-1),l.replaceWith(v,p,t.type.create(a))}else o[0]&&l.replaceWith(d,p,t.type.create(a))}})}function zy(t,e,r){const o=[];return r.doc.nodesBetween(t,e,(a,l)=>{o.push(...a.marks.map(d=>({from:l,to:l+a.nodeSize,mark:d})))}),o}function Ra(t){return new eh({find:t.find,handler:({state:e,range:r,match:o})=>{const a=at(t.getAttributes,void 0,o);if(a===!1||a===null)return;const{tr:l}=e,d=o[o.length-1],p=o[0];let g=r.to;if(d){const v=p.search(/\S/),C=r.from+p.indexOf(d),y=C+d.length;if(zy(r.from,r.to,e).filter(k=>k.mark.type.excluded.find(x=>x===t.type&&x!==k.mark.type)).filter(k=>k.to>C).length)return null;y<r.to&&l.delete(y,r.to),C>r.from&&l.delete(r.from+v,C),g=r.from+v+d.length,l.addMark(r.from+v,g,t.type.create(a||{})),l.removeStoredMark(t.type)}}})}function rg(t){return new eh({find:t.find,handler:({state:e,range:r,match:o})=>{const a=e.doc.resolve(r.from),l=at(t.getAttributes,void 0,o)||{};if(!a.node(-1).canReplaceWith(a.index(-1),a.indexAfter(-1),t.type))return null;e.tr.delete(r.from,r.to).setBlockType(r.from,r.from,t.type,l)}})}function th(t){return new eh({find:t.find,handler:({state:e,range:r,match:o})=>{const a=at(t.getAttributes,void 0,o)||{},l=e.tr.delete(r.from,r.to),p=l.doc.resolve(r.from).blockRange(),g=p&&Zf(p,t.type,a);if(!g)return null;l.wrap(p,g);const v=l.doc.resolve(r.from-1).nodeBefore;v&&v.type===t.type&&eA(l.doc,r.from-1)&&(!t.joinPredicate||t.joinPredicate(o,v))&&l.join(r.from-1)}})}function wa(t){return new dM({find:t.find,handler:({state:e,range:r,match:o})=>{const a=at(t.getAttributes,void 0,o);if(a===!1||a===null)return;const{tr:l}=e,d=o[o.length-1],p=o[0];let g=r.to;if(d){const v=p.search(/\S/),C=r.from+p.indexOf(d),y=C+d.length;if(zy(r.from,r.to,e).filter(k=>k.mark.type.excluded.find(x=>x===t.type&&x!==k.mark.type)).filter(k=>k.to>C).length)return null;y<r.to&&l.delete(y,r.to),C>r.from&&l.delete(r.from+v,C),g=r.from+v+d.length,l.addMark(r.from+v,g,t.type.create(a||{})),l.removeStoredMark(t.type)}}})}function _M(t){return JA(t)&&t instanceof tt}function Xy(t,e,r){const o=0,a=t.state.doc.content.size,l=Ta(e,o,a),d=Ta(r,o,a),p=t.coordsAtPos(l),g=t.coordsAtPos(d,-1),v=Math.min(p.top,g.top),C=Math.max(p.bottom,g.bottom),y=Math.min(p.left,g.left),w=Math.max(p.right,g.right),k=w-y,M=C-v,Y={top:v,bottom:C,left:y,right:w,width:k,height:M,x:y,y:v};return Hn(re({},Y),{toJSON:()=>Y})}var Ti="top",Ki="bottom",Wi="right",Ri="left",ng="auto",Xl=[Ti,Ki,Wi,Ri],Dc="start",$l="end",SM="clippingParents",$y="viewport",Zl="popper",TM="reference",Zy=Xl.reduce(function(t,e){return t.concat([e+"-"+Dc,e+"-"+$l])},[]),e_=[].concat(Xl,[ng]).reduce(function(t,e){return t.concat([e,e+"-"+Dc,e+"-"+$l])},[]),RM="beforeRead",wM="read",NM="afterRead",OM="beforeMain",kM="main",bM="afterMain",DM="beforeWrite",BM="write",MM="afterWrite",LM=[RM,wM,NM,OM,kM,bM,DM,BM,MM];function Mo(t){return t?(t.nodeName||"").toLowerCase():null}function po(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function eu(t){var e=po(t).Element;return t instanceof e||t instanceof Element}function Yi(t){var e=po(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function t_(t){if(typeof ShadowRoot=="undefined")return!1;var e=po(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function PM(t){var e=t.state;Object.keys(e.elements).forEach(function(r){var o=e.styles[r]||{},a=e.attributes[r]||{},l=e.elements[r];!Yi(l)||!Mo(l)||(Object.assign(l.style,o),Object.keys(a).forEach(function(d){var p=a[d];p===!1?l.removeAttribute(d):l.setAttribute(d,p===!0?"":p)}))})}function xM(t){var e=t.state,r={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,r.popper),e.styles=r,e.elements.arrow&&Object.assign(e.elements.arrow.style,r.arrow),function(){Object.keys(e.elements).forEach(function(o){var a=e.elements[o],l=e.attributes[o]||{},d=Object.keys(e.styles.hasOwnProperty(o)?e.styles[o]:r[o]),p=d.reduce(function(g,v){return g[v]="",g},{});!Yi(a)||!Mo(a)||(Object.assign(a.style,p),Object.keys(l).forEach(function(g){a.removeAttribute(g)}))})}}var r_={name:"applyStyles",enabled:!0,phase:"write",fn:PM,effect:xM,requires:["computeStyles"]};function Lo(t){return t.split("-")[0]}function Bc(t,e){var r=t.getBoundingClientRect(),o=1,a=1;return{width:r.width/o,height:r.height/a,top:r.top/a,right:r.right/o,bottom:r.bottom/a,left:r.left/o,x:r.left/o,y:r.top/a}}function ig(t){var e=Bc(t),r=t.offsetWidth,o=t.offsetHeight;return Math.abs(e.width-r)<=1&&(r=e.width),Math.abs(e.height-o)<=1&&(o=e.height),{x:t.offsetLeft,y:t.offsetTop,width:r,height:o}}function n_(t,e){var r=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(r&&t_(r)){var o=e;do{if(o&&t.isSameNode(o))return!0;o=o.parentNode||o.host}while(o)}return!1}function ls(t){return po(t).getComputedStyle(t)}function QM(t){return["table","td","th"].indexOf(Mo(t))>=0}function xs(t){return((eu(t)?t.ownerDocument:t.document)||window.document).documentElement}function rh(t){return Mo(t)==="html"?t:t.assignedSlot||t.parentNode||(t_(t)?t.host:null)||xs(t)}function i_(t){return!Yi(t)||ls(t).position==="fixed"?null:t.offsetParent}function UM(t){var e=navigator.userAgent.toLowerCase().indexOf("firefox")!==-1,r=navigator.userAgent.indexOf("Trident")!==-1;if(r&&Yi(t)){var o=ls(t);if(o.position==="fixed")return null}for(var a=rh(t);Yi(a)&&["html","body"].indexOf(Mo(a))<0;){var l=ls(a);if(l.transform!=="none"||l.perspective!=="none"||l.contain==="paint"||["transform","perspective"].indexOf(l.willChange)!==-1||e&&l.willChange==="filter"||e&&l.filter&&l.filter!=="none")return a;a=a.parentNode}return null}function tu(t){for(var e=po(t),r=i_(t);r&&QM(r)&&ls(r).position==="static";)r=i_(r);return r&&(Mo(r)==="html"||Mo(r)==="body"&&ls(r).position==="static")?e:r||UM(t)||e}function og(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}var Qs=Math.max,ru=Math.min,nh=Math.round;function ih(t,e,r){return Qs(t,ru(e,r))}function o_(){return{top:0,right:0,bottom:0,left:0}}function s_(t){return Object.assign({},o_(),t)}function a_(t,e){return e.reduce(function(r,o){return r[o]=t,r},{})}var FM=function(e,r){return e=typeof e=="function"?e(Object.assign({},r.rects,{placement:r.placement})):e,s_(typeof e!="number"?e:a_(e,Xl))};function VM(t){var e,r=t.state,o=t.name,a=t.options,l=r.elements.arrow,d=r.modifiersData.popperOffsets,p=Lo(r.placement),g=og(p),v=[Ri,Wi].indexOf(p)>=0,C=v?"height":"width";if(!(!l||!d)){var y=FM(a.padding,r),w=ig(l),k=g==="y"?Ti:Ri,M=g==="y"?Ki:Wi,x=r.rects.reference[C]+r.rects.reference[g]-d[g]-r.rects.popper[C],V=d[g]-r.rects.reference[g],Y=tu(l),H=Y?g==="y"?Y.clientHeight||0:Y.clientWidth||0:0,he=x/2-V/2,Q=y[k],pe=H-w[C]-y[M],oe=H/2-w[C]/2+he,me=ih(Q,oe,pe),xe=g;r.modifiersData[o]=(e={},e[xe]=me,e.centerOffset=me-oe,e)}}function GM(t){var e=t.state,r=t.options,o=r.element,a=o===void 0?"[data-popper-arrow]":o;a!=null&&(typeof a=="string"&&(a=e.elements.popper.querySelector(a),!a)||!n_(e.elements.popper,a)||(e.elements.arrow=a))}var jM={name:"arrow",enabled:!0,phase:"main",fn:VM,effect:GM,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Mc(t){return t.split("-")[1]}var HM={top:"auto",right:"auto",bottom:"auto",left:"auto"};function KM(t){var e=t.x,r=t.y,o=window,a=o.devicePixelRatio||1;return{x:nh(nh(e*a)/a)||0,y:nh(nh(r*a)/a)||0}}function c_(t){var e,r=t.popper,o=t.popperRect,a=t.placement,l=t.variation,d=t.offsets,p=t.position,g=t.gpuAcceleration,v=t.adaptive,C=t.roundOffsets,y=C===!0?KM(d):typeof C=="function"?C(d):d,w=y.x,k=w===void 0?0:w,M=y.y,x=M===void 0?0:M,V=d.hasOwnProperty("x"),Y=d.hasOwnProperty("y"),H=Ri,he=Ti,Q=window;if(v){var pe=tu(r),oe="clientHeight",me="clientWidth";pe===po(r)&&(pe=xs(r),ls(pe).position!=="static"&&p==="absolute"&&(oe="scrollHeight",me="scrollWidth")),pe=pe,(a===Ti||(a===Ri||a===Wi)&&l===$l)&&(he=Ki,x-=pe[oe]-o.height,x*=g?1:-1),(a===Ri||(a===Ti||a===Ki)&&l===$l)&&(H=Wi,k-=pe[me]-o.width,k*=g?1:-1)}var xe=Object.assign({position:p},v&&HM);if(g){var Pe;return Object.assign({},xe,(Pe={},Pe[he]=Y?"0":"",Pe[H]=V?"0":"",Pe.transform=(Q.devicePixelRatio||1)<=1?"translate("+k+"px, "+x+"px)":"translate3d("+k+"px, "+x+"px, 0)",Pe))}return Object.assign({},xe,(e={},e[he]=Y?x+"px":"",e[H]=V?k+"px":"",e.transform="",e))}function WM(t){var e=t.state,r=t.options,o=r.gpuAcceleration,a=o===void 0?!0:o,l=r.adaptive,d=l===void 0?!0:l,p=r.roundOffsets,g=p===void 0?!0:p,v={placement:Lo(e.placement),variation:Mc(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:a};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,c_(Object.assign({},v,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:d,roundOffsets:g})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,c_(Object.assign({},v,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:g})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}var YM={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:WM,data:{}},oh={passive:!0};function qM(t){var e=t.state,r=t.instance,o=t.options,a=o.scroll,l=a===void 0?!0:a,d=o.resize,p=d===void 0?!0:d,g=po(e.elements.popper),v=[].concat(e.scrollParents.reference,e.scrollParents.popper);return l&&v.forEach(function(C){C.addEventListener("scroll",r.update,oh)}),p&&g.addEventListener("resize",r.update,oh),function(){l&&v.forEach(function(C){C.removeEventListener("scroll",r.update,oh)}),p&&g.removeEventListener("resize",r.update,oh)}}var JM={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:qM,data:{}},zM={left:"right",right:"left",bottom:"top",top:"bottom"};function sh(t){return t.replace(/left|right|bottom|top/g,function(e){return zM[e]})}var XM={start:"end",end:"start"};function l_(t){return t.replace(/start|end/g,function(e){return XM[e]})}function sg(t){var e=po(t),r=e.pageXOffset,o=e.pageYOffset;return{scrollLeft:r,scrollTop:o}}function ag(t){return Bc(xs(t)).left+sg(t).scrollLeft}function $M(t){var e=po(t),r=xs(t),o=e.visualViewport,a=r.clientWidth,l=r.clientHeight,d=0,p=0;return o&&(a=o.width,l=o.height,/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||(d=o.offsetLeft,p=o.offsetTop)),{width:a,height:l,x:d+ag(t),y:p}}function ZM(t){var e,r=xs(t),o=sg(t),a=(e=t.ownerDocument)==null?void 0:e.body,l=Qs(r.scrollWidth,r.clientWidth,a?a.scrollWidth:0,a?a.clientWidth:0),d=Qs(r.scrollHeight,r.clientHeight,a?a.scrollHeight:0,a?a.clientHeight:0),p=-o.scrollLeft+ag(t),g=-o.scrollTop;return ls(a||r).direction==="rtl"&&(p+=Qs(r.clientWidth,a?a.clientWidth:0)-l),{width:l,height:d,x:p,y:g}}function cg(t){var e=ls(t),r=e.overflow,o=e.overflowX,a=e.overflowY;return/auto|scroll|overlay|hidden/.test(r+a+o)}function u_(t){return["html","body","#document"].indexOf(Mo(t))>=0?t.ownerDocument.body:Yi(t)&&cg(t)?t:u_(rh(t))}function nu(t,e){var r;e===void 0&&(e=[]);var o=u_(t),a=o===((r=t.ownerDocument)==null?void 0:r.body),l=po(o),d=a?[l].concat(l.visualViewport||[],cg(o)?o:[]):o,p=e.concat(d);return a?p:p.concat(nu(rh(d)))}function lg(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function eL(t){var e=Bc(t);return e.top=e.top+t.clientTop,e.left=e.left+t.clientLeft,e.bottom=e.top+t.clientHeight,e.right=e.left+t.clientWidth,e.width=t.clientWidth,e.height=t.clientHeight,e.x=e.left,e.y=e.top,e}function d_(t,e){return e===$y?lg($M(t)):Yi(e)?eL(e):lg(ZM(xs(t)))}function tL(t){var e=nu(rh(t)),r=["absolute","fixed"].indexOf(ls(t).position)>=0,o=r&&Yi(t)?tu(t):t;return eu(o)?e.filter(function(a){return eu(a)&&n_(a,o)&&Mo(a)!=="body"}):[]}function rL(t,e,r){var o=e==="clippingParents"?tL(t):[].concat(e),a=[].concat(o,[r]),l=a[0],d=a.reduce(function(p,g){var v=d_(t,g);return p.top=Qs(v.top,p.top),p.right=ru(v.right,p.right),p.bottom=ru(v.bottom,p.bottom),p.left=Qs(v.left,p.left),p},d_(t,l));return d.width=d.right-d.left,d.height=d.bottom-d.top,d.x=d.left,d.y=d.top,d}function h_(t){var e=t.reference,r=t.element,o=t.placement,a=o?Lo(o):null,l=o?Mc(o):null,d=e.x+e.width/2-r.width/2,p=e.y+e.height/2-r.height/2,g;switch(a){case Ti:g={x:d,y:e.y-r.height};break;case Ki:g={x:d,y:e.y+e.height};break;case Wi:g={x:e.x+e.width,y:p};break;case Ri:g={x:e.x-r.width,y:p};break;default:g={x:e.x,y:e.y}}var v=a?og(a):null;if(v!=null){var C=v==="y"?"height":"width";switch(l){case Dc:g[v]=g[v]-(e[C]/2-r[C]/2);break;case $l:g[v]=g[v]+(e[C]/2-r[C]/2);break}}return g}function iu(t,e){e===void 0&&(e={});var r=e,o=r.placement,a=o===void 0?t.placement:o,l=r.boundary,d=l===void 0?SM:l,p=r.rootBoundary,g=p===void 0?$y:p,v=r.elementContext,C=v===void 0?Zl:v,y=r.altBoundary,w=y===void 0?!1:y,k=r.padding,M=k===void 0?0:k,x=s_(typeof M!="number"?M:a_(M,Xl)),V=C===Zl?TM:Zl,Y=t.rects.popper,H=t.elements[w?V:C],he=rL(eu(H)?H:H.contextElement||xs(t.elements.popper),d,g),Q=Bc(t.elements.reference),pe=h_({reference:Q,element:Y,strategy:"absolute",placement:a}),oe=lg(Object.assign({},Y,pe)),me=C===Zl?oe:Q,xe={top:he.top-me.top+x.top,bottom:me.bottom-he.bottom+x.bottom,left:he.left-me.left+x.left,right:me.right-he.right+x.right},Pe=t.modifiersData.offset;if(C===Zl&&Pe){var De=Pe[a];Object.keys(xe).forEach(function(Kt){var mt=[Wi,Ki].indexOf(Kt)>=0?1:-1,rt=[Ti,Ki].indexOf(Kt)>=0?"y":"x";xe[Kt]+=De[rt]*mt})}return xe}function nL(t,e){e===void 0&&(e={});var r=e,o=r.placement,a=r.boundary,l=r.rootBoundary,d=r.padding,p=r.flipVariations,g=r.allowedAutoPlacements,v=g===void 0?e_:g,C=Mc(o),y=C?p?Zy:Zy.filter(function(M){return Mc(M)===C}):Xl,w=y.filter(function(M){return v.indexOf(M)>=0});w.length===0&&(w=y);var k=w.reduce(function(M,x){return M[x]=iu(t,{placement:x,boundary:a,rootBoundary:l,padding:d})[Lo(x)],M},{});return Object.keys(k).sort(function(M,x){return k[M]-k[x]})}function iL(t){if(Lo(t)===ng)return[];var e=sh(t);return[l_(t),e,l_(e)]}function oL(t){var e=t.state,r=t.options,o=t.name;if(!e.modifiersData[o]._skip){for(var a=r.mainAxis,l=a===void 0?!0:a,d=r.altAxis,p=d===void 0?!0:d,g=r.fallbackPlacements,v=r.padding,C=r.boundary,y=r.rootBoundary,w=r.altBoundary,k=r.flipVariations,M=k===void 0?!0:k,x=r.allowedAutoPlacements,V=e.options.placement,Y=Lo(V),H=Y===V,he=g||(H||!M?[sh(V)]:iL(V)),Q=[V].concat(he).reduce(function(yn,Vr){return yn.concat(Lo(Vr)===ng?nL(e,{placement:Vr,boundary:C,rootBoundary:y,padding:v,flipVariations:M,allowedAutoPlacements:x}):Vr)},[]),pe=e.rects.reference,oe=e.rects.popper,me=new Map,xe=!0,Pe=Q[0],De=0;De<Q.length;De++){var Kt=Q[De],mt=Lo(Kt),rt=Mc(Kt)===Dc,Er=[Ti,Ki].indexOf(mt)>=0,Nt=Er?"width":"height",yt=iu(e,{placement:Kt,boundary:C,rootBoundary:y,altBoundary:w,padding:v}),lr=Er?rt?Wi:Ri:rt?Ki:Ti;pe[Nt]>oe[Nt]&&(lr=sh(lr));var Ir=sh(lr),li=[];if(l&&li.push(yt[mt]<=0),p&&li.push(yt[lr]<=0,yt[Ir]<=0),li.every(function(yn){return yn})){Pe=Kt,xe=!1;break}me.set(Kt,li)}if(xe)for(var $n=M?3:1,ui=function(Vr){var di=Q.find(function(go){var _n=me.get(go);if(_n)return _n.slice(0,Vr).every(function(Ue){return Ue})});if(di)return Pe=di,"break"},on=$n;on>0;on--){var ki=ui(on);if(ki==="break")break}e.placement!==Pe&&(e.modifiersData[o]._skip=!0,e.placement=Pe,e.reset=!0)}}var sL={name:"flip",enabled:!0,phase:"main",fn:oL,requiresIfExists:["offset"],data:{_skip:!1}};function p_(t,e,r){return r===void 0&&(r={x:0,y:0}),{top:t.top-e.height-r.y,right:t.right-e.width+r.x,bottom:t.bottom-e.height+r.y,left:t.left-e.width-r.x}}function f_(t){return[Ti,Wi,Ki,Ri].some(function(e){return t[e]>=0})}function aL(t){var e=t.state,r=t.name,o=e.rects.reference,a=e.rects.popper,l=e.modifiersData.preventOverflow,d=iu(e,{elementContext:"reference"}),p=iu(e,{altBoundary:!0}),g=p_(d,o),v=p_(p,a,l),C=f_(g),y=f_(v);e.modifiersData[r]={referenceClippingOffsets:g,popperEscapeOffsets:v,isReferenceHidden:C,hasPopperEscaped:y},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":C,"data-popper-escaped":y})}var cL={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:aL};function lL(t,e,r){var o=Lo(t),a=[Ri,Ti].indexOf(o)>=0?-1:1,l=typeof r=="function"?r(Object.assign({},e,{placement:t})):r,d=l[0],p=l[1];return d=d||0,p=(p||0)*a,[Ri,Wi].indexOf(o)>=0?{x:p,y:d}:{x:d,y:p}}function uL(t){var e=t.state,r=t.options,o=t.name,a=r.offset,l=a===void 0?[0,0]:a,d=e_.reduce(function(C,y){return C[y]=lL(y,e.rects,l),C},{}),p=d[e.placement],g=p.x,v=p.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=g,e.modifiersData.popperOffsets.y+=v),e.modifiersData[o]=d}var dL={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:uL};function hL(t){var e=t.state,r=t.name;e.modifiersData[r]=h_({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}var pL={name:"popperOffsets",enabled:!0,phase:"read",fn:hL,data:{}};function fL(t){return t==="x"?"y":"x"}function AL(t){var e=t.state,r=t.options,o=t.name,a=r.mainAxis,l=a===void 0?!0:a,d=r.altAxis,p=d===void 0?!1:d,g=r.boundary,v=r.rootBoundary,C=r.altBoundary,y=r.padding,w=r.tether,k=w===void 0?!0:w,M=r.tetherOffset,x=M===void 0?0:M,V=iu(e,{boundary:g,rootBoundary:v,padding:y,altBoundary:C}),Y=Lo(e.placement),H=Mc(e.placement),he=!H,Q=og(Y),pe=fL(Q),oe=e.modifiersData.popperOffsets,me=e.rects.reference,xe=e.rects.popper,Pe=typeof x=="function"?x(Object.assign({},e.rects,{placement:e.placement})):x,De={x:0,y:0};if(!!oe){if(l||p){var Kt=Q==="y"?Ti:Ri,mt=Q==="y"?Ki:Wi,rt=Q==="y"?"height":"width",Er=oe[Q],Nt=oe[Q]+V[Kt],yt=oe[Q]-V[mt],lr=k?-xe[rt]/2:0,Ir=H===Dc?me[rt]:xe[rt],li=H===Dc?-xe[rt]:-me[rt],$n=e.elements.arrow,ui=k&&$n?ig($n):{width:0,height:0},on=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:o_(),ki=on[Kt],yn=on[mt],Vr=ih(0,me[rt],ui[rt]),di=he?me[rt]/2-lr-Vr-ki-Pe:Ir-Vr-ki-Pe,go=he?-me[rt]/2+lr+Vr+yn+Pe:li+Vr+yn+Pe,_n=e.elements.arrow&&tu(e.elements.arrow),Ue=_n?Q==="y"?_n.clientTop||0:_n.clientLeft||0:0,Ot=e.modifiersData.offset?e.modifiersData.offset[e.placement][Q]:0,ir=oe[Q]+di-Ot-Ue,rr=oe[Q]+go-Ot;if(l){var Wr=ih(k?ru(Nt,ir):Nt,Er,k?Qs(yt,rr):yt);oe[Q]=Wr,De[Q]=Wr-Er}if(p){var mo=Q==="x"?Ti:Ri,Je=Q==="x"?Ki:Wi,Vo=oe[pe],vo=Vo+V[mo],Ks=Vo-V[Je],zi=ih(k?ru(vo,ir):vo,Vo,k?Qs(Ks,rr):Ks);oe[pe]=zi,De[pe]=zi-Vo}}e.modifiersData[o]=De}}var gL={name:"preventOverflow",enabled:!0,phase:"main",fn:AL,requiresIfExists:["offset"]};function mL(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function vL(t){return t===po(t)||!Yi(t)?sg(t):mL(t)}function EL(t){var e=t.getBoundingClientRect(),r=e.width/t.offsetWidth||1,o=e.height/t.offsetHeight||1;return r!==1||o!==1}function IL(t,e,r){r===void 0&&(r=!1);var o=Yi(e);Yi(e)&&EL(e);var a=xs(e),l=Bc(t),d={scrollLeft:0,scrollTop:0},p={x:0,y:0};return(o||!o&&!r)&&((Mo(e)!=="body"||cg(a))&&(d=vL(e)),Yi(e)?(p=Bc(e),p.x+=e.clientLeft,p.y+=e.clientTop):a&&(p.x=ag(a))),{x:l.left+d.scrollLeft-p.x,y:l.top+d.scrollTop-p.y,width:l.width,height:l.height}}function CL(t){var e=new Map,r=new Set,o=[];t.forEach(function(l){e.set(l.name,l)});function a(l){r.add(l.name);var d=[].concat(l.requires||[],l.requiresIfExists||[]);d.forEach(function(p){if(!r.has(p)){var g=e.get(p);g&&a(g)}}),o.push(l)}return t.forEach(function(l){r.has(l.name)||a(l)}),o}function yL(t){var e=CL(t);return LM.reduce(function(r,o){return r.concat(e.filter(function(a){return a.phase===o}))},[])}function _L(t){var e;return function(){return e||(e=new Promise(function(r){Promise.resolve().then(function(){e=void 0,r(t())})})),e}}function SL(t){var e=t.reduce(function(r,o){var a=r[o.name];return r[o.name]=a?Object.assign({},a,o,{options:Object.assign({},a.options,o.options),data:Object.assign({},a.data,o.data)}):o,r},{});return Object.keys(e).map(function(r){return e[r]})}var A_={placement:"bottom",modifiers:[],strategy:"absolute"};function g_(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return!e.some(function(o){return!(o&&typeof o.getBoundingClientRect=="function")})}function TL(t){t===void 0&&(t={});var e=t,r=e.defaultModifiers,o=r===void 0?[]:r,a=e.defaultOptions,l=a===void 0?A_:a;return function(p,g,v){v===void 0&&(v=l);var C={placement:"bottom",orderedModifiers:[],options:Object.assign({},A_,l),modifiersData:{},elements:{reference:p,popper:g},attributes:{},styles:{}},y=[],w=!1,k={state:C,setOptions:function(Y){var H=typeof Y=="function"?Y(C.options):Y;x(),C.options=Object.assign({},l,C.options,H),C.scrollParents={reference:eu(p)?nu(p):p.contextElement?nu(p.contextElement):[],popper:nu(g)};var he=yL(SL([].concat(o,C.options.modifiers)));return C.orderedModifiers=he.filter(function(Q){return Q.enabled}),M(),k.update()},forceUpdate:function(){if(!w){var Y=C.elements,H=Y.reference,he=Y.popper;if(!!g_(H,he)){C.rects={reference:IL(H,tu(he),C.options.strategy==="fixed"),popper:ig(he)},C.reset=!1,C.placement=C.options.placement,C.orderedModifiers.forEach(function(De){return C.modifiersData[De.name]=Object.assign({},De.data)});for(var Q=0;Q<C.orderedModifiers.length;Q++){if(C.reset===!0){C.reset=!1,Q=-1;continue}var pe=C.orderedModifiers[Q],oe=pe.fn,me=pe.options,xe=me===void 0?{}:me,Pe=pe.name;typeof oe=="function"&&(C=oe({state:C,options:xe,name:Pe,instance:k})||C)}}}},update:_L(function(){return new Promise(function(V){k.forceUpdate(),V(C)})}),destroy:function(){x(),w=!0}};if(!g_(p,g))return k;k.setOptions(v).then(function(V){!w&&v.onFirstUpdate&&v.onFirstUpdate(V)});function M(){C.orderedModifiers.forEach(function(V){var Y=V.name,H=V.options,he=H===void 0?{}:H,Q=V.effect;if(typeof Q=="function"){var pe=Q({state:C,name:Y,instance:k,options:he}),oe=function(){};y.push(pe||oe)}})}function x(){y.forEach(function(V){return V()}),y=[]}return k}}var RL=[JM,pL,YM,r_,dL,sL,gL,jM,cL],wL=TL({defaultModifiers:RL}),NL="tippy-box",m_="tippy-content",OL="tippy-backdrop",v_="tippy-arrow",E_="tippy-svg-arrow",Na={passive:!0,capture:!0},I_=function(){return document.body};function ug(t,e,r){if(Array.isArray(t)){var o=t[e];return o==null?Array.isArray(r)?r[e]:r:o}return t}function dg(t,e){var r={}.toString.call(t);return r.indexOf("[object")===0&&r.indexOf(e+"]")>-1}function C_(t,e){return typeof t=="function"?t.apply(void 0,e):t}function y_(t,e){if(e===0)return t;var r;return function(o){clearTimeout(r),r=setTimeout(function(){t(o)},e)}}function kL(t){return t.split(/\s+/).filter(Boolean)}function ou(t){return[].concat(t)}function __(t,e){t.indexOf(e)===-1&&t.push(e)}function bL(t){return t.filter(function(e,r){return t.indexOf(e)===r})}function DL(t){return t.split("-")[0]}function ah(t){return[].slice.call(t)}function S_(t){return Object.keys(t).reduce(function(e,r){return t[r]!==void 0&&(e[r]=t[r]),e},{})}function su(){return document.createElement("div")}function ch(t){return["Element","Fragment"].some(function(e){return dg(t,e)})}function BL(t){return dg(t,"NodeList")}function ML(t){return dg(t,"MouseEvent")}function LL(t){return!!(t&&t._tippy&&t._tippy.reference===t)}function PL(t){return ch(t)?[t]:BL(t)?ah(t):Array.isArray(t)?t:ah(document.querySelectorAll(t))}function hg(t,e){t.forEach(function(r){r&&(r.style.transitionDuration=e+"ms")})}function T_(t,e){t.forEach(function(r){r&&r.setAttribute("data-state",e)})}function xL(t){var e,r=ou(t),o=r[0];return(o==null||(e=o.ownerDocument)==null?void 0:e.body)?o.ownerDocument:document}function QL(t,e){var r=e.clientX,o=e.clientY;return t.every(function(a){var l=a.popperRect,d=a.popperState,p=a.props,g=p.interactiveBorder,v=DL(d.placement),C=d.modifiersData.offset;if(!C)return!0;var y=v==="bottom"?C.top.y:0,w=v==="top"?C.bottom.y:0,k=v==="right"?C.left.x:0,M=v==="left"?C.right.x:0,x=l.top-o+y>g,V=o-l.bottom-w>g,Y=l.left-r+k>g,H=r-l.right-M>g;return x||V||Y||H})}function pg(t,e,r){var o=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(a){t[o](a,r)})}function R_(t,e){for(var r=e;r;){var o;if(t.contains(r))return!0;r=(o=r.getRootNode==null?void 0:r.getRootNode())==null?void 0:o.host}return!1}var Po={isTouch:!1},w_=0;function UL(){Po.isTouch||(Po.isTouch=!0,window.performance&&document.addEventListener("mousemove",N_))}function N_(){var t=performance.now();t-w_<20&&(Po.isTouch=!1,document.removeEventListener("mousemove",N_)),w_=t}function FL(){var t=document.activeElement;if(LL(t)){var e=t._tippy;t.blur&&!e.state.isVisible&&t.blur()}}function VL(){document.addEventListener("touchstart",UL,Na),window.addEventListener("blur",FL)}var GL=typeof window!="undefined"&&typeof document!="undefined",jL=GL?!!window.msCrypto:!1,HL={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},KL={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},fo=Object.assign({appendTo:I_,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},HL,{},KL),WL=Object.keys(fo),YL=function(e){var r=Object.keys(e);r.forEach(function(o){fo[o]=e[o]})};function O_(t){var e=t.plugins||[],r=e.reduce(function(o,a){var l=a.name,d=a.defaultValue;if(l){var p;o[l]=t[l]!==void 0?t[l]:(p=fo[l])!=null?p:d}return o},{});return Object.assign({},t,{},r)}function qL(t,e){var r=e?Object.keys(O_(Object.assign({},fo,{plugins:e}))):WL,o=r.reduce(function(a,l){var d=(t.getAttribute("data-tippy-"+l)||"").trim();if(!d)return a;if(l==="content")a[l]=d;else try{a[l]=JSON.parse(d)}catch{a[l]=d}return a},{});return o}function k_(t,e){var r=Object.assign({},e,{content:C_(e.content,[t])},e.ignoreAttributes?{}:qL(t,e.plugins));return r.aria=Object.assign({},fo.aria,{},r.aria),r.aria={expanded:r.aria.expanded==="auto"?e.interactive:r.aria.expanded,content:r.aria.content==="auto"?e.interactive?null:"describedby":r.aria.content},r}var JL=function(){return"innerHTML"};function fg(t,e){t[JL()]=e}function b_(t){var e=su();return t===!0?e.className=v_:(e.className=E_,ch(t)?e.appendChild(t):fg(e,t)),e}function D_(t,e){ch(e.content)?(fg(t,""),t.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?fg(t,e.content):t.textContent=e.content)}function Ag(t){var e=t.firstElementChild,r=ah(e.children);return{box:e,content:r.find(function(o){return o.classList.contains(m_)}),arrow:r.find(function(o){return o.classList.contains(v_)||o.classList.contains(E_)}),backdrop:r.find(function(o){return o.classList.contains(OL)})}}function B_(t){var e=su(),r=su();r.className=NL,r.setAttribute("data-state","hidden"),r.setAttribute("tabindex","-1");var o=su();o.className=m_,o.setAttribute("data-state","hidden"),D_(o,t.props),e.appendChild(r),r.appendChild(o),a(t.props,t.props);function a(l,d){var p=Ag(e),g=p.box,v=p.content,C=p.arrow;d.theme?g.setAttribute("data-theme",d.theme):g.removeAttribute("data-theme"),typeof d.animation=="string"?g.setAttribute("data-animation",d.animation):g.removeAttribute("data-animation"),d.inertia?g.setAttribute("data-inertia",""):g.removeAttribute("data-inertia"),g.style.maxWidth=typeof d.maxWidth=="number"?d.maxWidth+"px":d.maxWidth,d.role?g.setAttribute("role",d.role):g.removeAttribute("role"),(l.content!==d.content||l.allowHTML!==d.allowHTML)&&D_(v,t.props),d.arrow?C?l.arrow!==d.arrow&&(g.removeChild(C),g.appendChild(b_(d.arrow))):g.appendChild(b_(d.arrow)):C&&g.removeChild(C)}return{popper:e,onUpdate:a}}B_.$$tippy=!0;var zL=1,lh=[],gg=[];function XL(t,e){var r=k_(t,Object.assign({},fo,{},O_(S_(e)))),o,a,l,d=!1,p=!1,g=!1,v=!1,C,y,w,k=[],M=y_(mo,r.interactiveDebounce),x,V=zL++,Y=null,H=bL(r.plugins),he={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},Q={id:V,reference:t,popper:su(),popperInstance:Y,props:r,state:he,plugins:H,clearDelayTimeouts:Gc,setProps:ds,setContent:jc,show:Ma,hide:La,hideWithInteractivity:Yr,enable:Eo,disable:_u,unmount:hs,destroy:Ge};if(!r.render)return Q;var pe=r.render(Q),oe=pe.popper,me=pe.onUpdate;oe.setAttribute("data-tippy-root",""),oe.id="tippy-"+Q.id,Q.popper=oe,t._tippy=Q,oe._tippy=Q;var xe=H.map(function(X){return X.fn(Q)}),Pe=t.hasAttribute("aria-expanded");return ir(),$n(),lr(),Ir("onCreate",[Q]),r.showOnCreate&&xn(),oe.addEventListener("mouseenter",function(){Q.props.interactive&&Q.state.isVisible&&Q.clearDelayTimeouts()}),oe.addEventListener("mouseleave",function(X){Q.props.interactive&&Q.props.trigger.indexOf("mouseenter")>=0&&(Er().addEventListener("mousemove",M),M(X))}),Q;function De(){var X=Q.props.touch;return Array.isArray(X)?X:[X,0]}function Kt(){return De()[0]==="hold"}function mt(){var X;return!!((X=Q.props.render)==null?void 0:X.$$tippy)}function rt(){return x||t}function Er(){var X=rt().parentNode;return X?xL(X):document}function Nt(){return Ag(oe)}function yt(X){return Q.state.isMounted&&!Q.state.isVisible||Po.isTouch||C&&C.type==="focus"?0:ug(Q.props.delay,X?0:1,fo.delay)}function lr(){oe.style.pointerEvents=Q.props.interactive&&Q.state.isVisible?"":"none",oe.style.zIndex=""+Q.props.zIndex}function Ir(X,we,qe){if(qe===void 0&&(qe=!0),xe.forEach(function(_t){_t[X]&&_t[X].apply(void 0,we)}),qe){var Lt;(Lt=Q.props)[X].apply(Lt,we)}}function li(){var X=Q.props.aria;if(!!X.content){var we="aria-"+X.content,qe=oe.id,Lt=ou(Q.props.triggerTarget||t);Lt.forEach(function(_t){var kr=_t.getAttribute(we);if(Q.state.isVisible)_t.setAttribute(we,kr?kr+" "+qe:qe);else{var Qn=kr&&kr.replace(qe,"").trim();Qn?_t.setAttribute(we,Qn):_t.removeAttribute(we)}})}}function $n(){if(!(Pe||!Q.props.aria.expanded)){var X=ou(Q.props.triggerTarget||t);X.forEach(function(we){Q.props.interactive?we.setAttribute("aria-expanded",Q.state.isVisible&&we===rt()?"true":"false"):we.removeAttribute("aria-expanded")})}}function ui(){Er().removeEventListener("mousemove",M),lh=lh.filter(function(X){return X!==M})}function on(X){if(!(Po.isTouch&&(g||X.type==="mousedown"))){var we=X.composedPath&&X.composedPath()[0]||X.target;if(!(Q.props.interactive&&R_(oe,we))){if(R_(rt(),we)){if(Po.isTouch||Q.state.isVisible&&Q.props.trigger.indexOf("click")>=0)return}else Ir("onClickOutside",[Q,X]);Q.props.hideOnClick===!0&&(Q.clearDelayTimeouts(),Q.hide(),p=!0,setTimeout(function(){p=!1}),Q.state.isMounted||di())}}}function ki(){g=!0}function yn(){g=!1}function Vr(){var X=Er();X.addEventListener("mousedown",on,!0),X.addEventListener("touchend",on,Na),X.addEventListener("touchstart",yn,Na),X.addEventListener("touchmove",ki,Na)}function di(){var X=Er();X.removeEventListener("mousedown",on,!0),X.removeEventListener("touchend",on,Na),X.removeEventListener("touchstart",yn,Na),X.removeEventListener("touchmove",ki,Na)}function go(X,we){Ue(X,function(){!Q.state.isVisible&&oe.parentNode&&oe.parentNode.contains(oe)&&we()})}function _n(X,we){Ue(X,we)}function Ue(X,we){var qe=Nt().box;function Lt(_t){_t.target===qe&&(pg(qe,"remove",Lt),we())}if(X===0)return we();pg(qe,"remove",y),pg(qe,"add",Lt),y=Lt}function Ot(X,we,qe){qe===void 0&&(qe=!1);var Lt=ou(Q.props.triggerTarget||t);Lt.forEach(function(_t){_t.addEventListener(X,we,qe),k.push({node:_t,eventType:X,handler:we,options:qe})})}function ir(){Kt()&&(Ot("touchstart",Wr,{passive:!0}),Ot("touchend",Je,{passive:!0})),kL(Q.props.trigger).forEach(function(X){if(X!=="manual")switch(Ot(X,Wr),X){case"mouseenter":Ot("mouseleave",Je);break;case"focus":Ot(jL?"focusout":"blur",Vo);break;case"focusin":Ot("focusout",Vo);break}})}function rr(){k.forEach(function(X){var we=X.node,qe=X.eventType,Lt=X.handler,_t=X.options;we.removeEventListener(qe,Lt,_t)}),k=[]}function Wr(X){var we,qe=!1;if(!(!Q.state.isEnabled||vo(X)||p)){var Lt=((we=C)==null?void 0:we.type)==="focus";C=X,x=X.currentTarget,$n(),!Q.state.isVisible&&ML(X)&&lh.forEach(function(_t){return _t(X)}),X.type==="click"&&(Q.props.trigger.indexOf("mouseenter")<0||d)&&Q.props.hideOnClick!==!1&&Q.state.isVisible?qe=!0:xn(X),X.type==="click"&&(d=!qe),qe&&!Lt&&bi(X)}}function mo(X){var we=X.target,qe=rt().contains(we)||oe.contains(we);if(!(X.type==="mousemove"&&qe)){var Lt=Or().concat(oe).map(function(_t){var kr,Qn=_t._tippy,Xi=(kr=Qn.popperInstance)==null?void 0:kr.state;return Xi?{popperRect:_t.getBoundingClientRect(),popperState:Xi,props:r}:null}).filter(Boolean);QL(Lt,X)&&(ui(),bi(X))}}function Je(X){var we=vo(X)||Q.props.trigger.indexOf("click")>=0&&d;if(!we){if(Q.props.interactive){Q.hideWithInteractivity(X);return}bi(X)}}function Vo(X){Q.props.trigger.indexOf("focusin")<0&&X.target!==rt()||Q.props.interactive&&X.relatedTarget&&oe.contains(X.relatedTarget)||bi(X)}function vo(X){return Po.isTouch?Kt()!==X.type.indexOf("touch")>=0:!1}function Ks(){zi();var X=Q.props,we=X.popperOptions,qe=X.placement,Lt=X.offset,_t=X.getReferenceClientRect,kr=X.moveTransition,Qn=mt()?Ag(oe).arrow:null,Xi=_t?{getBoundingClientRect:_t,contextElement:_t.contextElement||rt()}:t,Hc={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(Go){var jo=Go.state;if(mt()){var Su=Nt(),ps=Su.box;["placement","reference-hidden","escaped"].forEach(function(yr){yr==="placement"?ps.setAttribute("data-placement",jo.placement):jo.attributes.popper["data-popper-"+yr]?ps.setAttribute("data-"+yr,""):ps.removeAttribute("data-"+yr)}),jo.attributes.popper={}}}},hi=[{name:"offset",options:{offset:Lt}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!kr}},Hc];mt()&&Qn&&hi.push({name:"arrow",options:{element:Qn,padding:3}}),hi.push.apply(hi,(we==null?void 0:we.modifiers)||[]),Q.popperInstance=wL(Xi,oe,Object.assign({},we,{placement:qe,onFirstUpdate:w,modifiers:hi}))}function zi(){Q.popperInstance&&(Q.popperInstance.destroy(),Q.popperInstance=null)}function Ws(){var X=Q.props.appendTo,we,qe=rt();Q.props.interactive&&X===I_||X==="parent"?we=qe.parentNode:we=C_(X,[qe]),we.contains(oe)||we.appendChild(oe),Ks()}function Or(){return ah(oe.querySelectorAll("[data-tippy-root]"))}function xn(X){Q.clearDelayTimeouts(),X&&Ir("onTrigger",[Q,X]),Vr();var we=yt(!0),qe=De(),Lt=qe[0],_t=qe[1];Po.isTouch&&Lt==="hold"&&_t&&(we=_t),we?o=setTimeout(function(){Q.show()},we):Q.show()}function bi(X){if(Q.clearDelayTimeouts(),Ir("onUntrigger",[Q,X]),!Q.state.isVisible){di();return}if(!(Q.props.trigger.indexOf("mouseenter")>=0&&Q.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(X.type)>=0&&d)){var we=yt(!1);we?a=setTimeout(function(){Q.state.isVisible&&Q.hide()},we):l=requestAnimationFrame(function(){Q.hide()})}}function Eo(){Q.state.isEnabled=!0}function _u(){Q.hide(),Q.state.isEnabled=!1}function Gc(){clearTimeout(o),clearTimeout(a),cancelAnimationFrame(l)}function ds(X){if(!Q.state.isDestroyed){Ir("onBeforeUpdate",[Q,X]),rr();var we=Q.props,qe=k_(t,Object.assign({},we,{},S_(X),{ignoreAttributes:!0}));Q.props=qe,ir(),we.interactiveDebounce!==qe.interactiveDebounce&&(ui(),M=y_(mo,qe.interactiveDebounce)),we.triggerTarget&&!qe.triggerTarget?ou(we.triggerTarget).forEach(function(Lt){Lt.removeAttribute("aria-expanded")}):qe.triggerTarget&&t.removeAttribute("aria-expanded"),$n(),lr(),me&&me(we,qe),Q.popperInstance&&(Ks(),Or().forEach(function(Lt){requestAnimationFrame(Lt._tippy.popperInstance.forceUpdate)})),Ir("onAfterUpdate",[Q,X])}}function jc(X){Q.setProps({content:X})}function Ma(){var X=Q.state.isVisible,we=Q.state.isDestroyed,qe=!Q.state.isEnabled,Lt=Po.isTouch&&!Q.props.touch,_t=ug(Q.props.duration,0,fo.duration);if(!(X||we||qe||Lt)&&!rt().hasAttribute("disabled")&&(Ir("onShow",[Q],!1),Q.props.onShow(Q)!==!1)){if(Q.state.isVisible=!0,mt()&&(oe.style.visibility="visible"),lr(),Vr(),Q.state.isMounted||(oe.style.transition="none"),mt()){var kr=Nt(),Qn=kr.box,Xi=kr.content;hg([Qn,Xi],0)}w=function(){var hi;if(!(!Q.state.isVisible||v)){if(v=!0,oe.offsetHeight,oe.style.transition=Q.props.moveTransition,mt()&&Q.props.animation){var Ys=Nt(),Go=Ys.box,jo=Ys.content;hg([Go,jo],_t),T_([Go,jo],"visible")}li(),$n(),__(gg,Q),(hi=Q.popperInstance)==null||hi.forceUpdate(),Q.state.isMounted=!0,Ir("onMount",[Q]),Q.props.animation&&mt()&&_n(_t,function(){Q.state.isShown=!0,Ir("onShown",[Q])})}},Ws()}}function La(){var X=!Q.state.isVisible,we=Q.state.isDestroyed,qe=!Q.state.isEnabled,Lt=ug(Q.props.duration,1,fo.duration);if(!(X||we||qe)&&(Ir("onHide",[Q],!1),Q.props.onHide(Q)!==!1)){if(Q.state.isVisible=!1,Q.state.isShown=!1,v=!1,d=!1,mt()&&(oe.style.visibility="hidden"),ui(),di(),lr(),mt()){var _t=Nt(),kr=_t.box,Qn=_t.content;Q.props.animation&&(hg([kr,Qn],Lt),T_([kr,Qn],"hidden"))}li(),$n(),Q.props.animation?mt()&&go(Lt,Q.unmount):Q.unmount()}}function Yr(X){Er().addEventListener("mousemove",M),__(lh,M),M(X)}function hs(){Q.state.isVisible&&Q.hide(),!!Q.state.isMounted&&(zi(),Or().forEach(function(X){X._tippy.unmount()}),oe.parentNode&&oe.parentNode.removeChild(oe),gg=gg.filter(function(X){return X!==Q}),Q.state.isMounted=!1,Ir("onHidden",[Q]))}function Ge(){Q.state.isDestroyed||(Q.clearDelayTimeouts(),Q.unmount(),rr(),delete t._tippy,Q.state.isDestroyed=!0,Ir("onDestroy",[Q]))}}function Lc(t,e){e===void 0&&(e={});var r=fo.plugins.concat(e.plugins||[]);VL();var o=Object.assign({},e,{plugins:r}),a=PL(t),l=a.reduce(function(d,p){var g=p&&XL(p,o);return g&&d.push(g),d},[]);return ch(t)?l[0]:l}Lc.defaultProps=fo;Lc.setDefaultProps=YL;Lc.currentInput=Po;Object.assign({},r_,{effect:function(e){var r=e.state,o={popper:{position:r.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(r.elements.popper.style,o.popper),r.styles=o,r.elements.arrow&&Object.assign(r.elements.arrow.style,o.arrow)}});Lc.setDefaultProps({render:B_});class $L{constructor({editor:e,element:r,view:o,tippyOptions:a={},shouldShow:l}){this.preventHide=!1,this.shouldShow=({state:d,from:p,to:g})=>{const{doc:v,selection:C}=d,{empty:y}=C,w=!v.textBetween(p,g).length&&Fy(d.selection);return!(y||w)},this.mousedownHandler=()=>{this.preventHide=!0},this.dragstartHandler=()=>{this.hide()},this.focusHandler=()=>{setTimeout(()=>this.update(this.editor.view))},this.blurHandler=({event:d})=>{var p;if(this.preventHide){this.preventHide=!1;return}(d==null?void 0:d.relatedTarget)&&((p=this.element.parentNode)===null||p===void 0?void 0:p.contains(d.relatedTarget))||this.hide()},this.editor=e,this.element=r,this.view=o,l&&(this.shouldShow=l),this.element.addEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.view.dom.addEventListener("dragstart",this.dragstartHandler),this.editor.on("focus",this.focusHandler),this.editor.on("blur",this.blurHandler),this.tippyOptions=a,this.element.remove(),this.element.style.visibility="visible"}createTooltip(){const{element:e}=this.editor.options,r=!!e.parentElement;this.tippy||!r||(this.tippy=Lc(e,re({duration:0,getReferenceClientRect:null,content:this.element,interactive:!0,trigger:"manual",placement:"top",hideOnClick:"toggle"},this.tippyOptions)))}update(e,r){var o,a;const{state:l,composing:d}=e,{doc:p,selection:g}=l,v=r&&r.doc.eq(p)&&r.selection.eq(g);if(d||v)return;this.createTooltip();const{ranges:C}=g,y=Math.min(...C.map(M=>M.$from.pos)),w=Math.max(...C.map(M=>M.$to.pos));if(!((o=this.shouldShow)===null||o===void 0?void 0:o.call(this,{editor:this.editor,view:e,state:l,oldState:r,from:y,to:w}))){this.hide();return}(a=this.tippy)===null||a===void 0||a.setProps({getReferenceClientRect:()=>{if(_M(l.selection)){const M=e.nodeDOM(y);if(M)return M.getBoundingClientRect()}return Xy(e,y,w)}}),this.show()}show(){var e;(e=this.tippy)===null||e===void 0||e.show()}hide(){var e;(e=this.tippy)===null||e===void 0||e.hide()}destroy(){var e;(e=this.tippy)===null||e===void 0||e.destroy(),this.element.removeEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.view.dom.removeEventListener("dragstart",this.dragstartHandler),this.editor.off("focus",this.focusHandler),this.editor.off("blur",this.blurHandler)}}const M_=t=>new An({key:typeof t.pluginKey=="string"?new ai(t.pluginKey):t.pluginKey,view:e=>new $L(re({view:e},t))});rn.create({name:"bubbleMenu",addOptions(){return{element:null,tippyOptions:{},pluginKey:"bubbleMenu",shouldShow:null}},addProseMirrorPlugins(){return this.options.element?[M_({pluginKey:this.options.pluginKey,editor:this.editor,element:this.options.element,tippyOptions:this.options.tippyOptions,shouldShow:this.options.shouldShow})]:[]}});class ZL{constructor({editor:e,element:r,view:o,tippyOptions:a={},shouldShow:l}){this.preventHide=!1,this.shouldShow=({state:d})=>{const{selection:p}=d,{$anchor:g,empty:v}=p,C=g.depth===1,y=g.parent.isTextblock&&!g.parent.type.spec.code&&!g.parent.textContent;return!(!v||!C||!y)},this.mousedownHandler=()=>{this.preventHide=!0},this.focusHandler=()=>{setTimeout(()=>this.update(this.editor.view))},this.blurHandler=({event:d})=>{var p;if(this.preventHide){this.preventHide=!1;return}(d==null?void 0:d.relatedTarget)&&((p=this.element.parentNode)===null||p===void 0?void 0:p.contains(d.relatedTarget))||this.hide()},this.editor=e,this.element=r,this.view=o,l&&(this.shouldShow=l),this.element.addEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.editor.on("focus",this.focusHandler),this.editor.on("blur",this.blurHandler),this.tippyOptions=a,this.element.remove(),this.element.style.visibility="visible"}createTooltip(){const{element:e}=this.editor.options,r=!!e.parentElement;this.tippy||!r||(this.tippy=Lc(e,re({duration:0,getReferenceClientRect:null,content:this.element,interactive:!0,trigger:"manual",placement:"right",hideOnClick:"toggle"},this.tippyOptions)))}update(e,r){var o,a;const{state:l,composing:d}=e,{doc:p,selection:g}=l,{from:v,to:C}=g,y=r&&r.doc.eq(p)&&r.selection.eq(g);if(d||y)return;if(this.createTooltip(),!((o=this.shouldShow)===null||o===void 0?void 0:o.call(this,{editor:this.editor,view:e,state:l,oldState:r}))){this.hide();return}(a=this.tippy)===null||a===void 0||a.setProps({getReferenceClientRect:()=>Xy(e,v,C)}),this.show()}show(){var e;(e=this.tippy)===null||e===void 0||e.show()}hide(){var e;(e=this.tippy)===null||e===void 0||e.hide()}destroy(){var e;(e=this.tippy)===null||e===void 0||e.destroy(),this.element.removeEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.editor.off("focus",this.focusHandler),this.editor.off("blur",this.blurHandler)}}const L_=t=>new An({key:typeof t.pluginKey=="string"?new ai(t.pluginKey):t.pluginKey,view:e=>new ZL(re({view:e},t))});rn.create({name:"floatingMenu",addOptions(){return{element:null,tippyOptions:{},pluginKey:"floatingMenu",shouldShow:null}},addProseMirrorPlugins(){return this.options.element?[L_({pluginKey:this.options.pluginKey,editor:this.editor,element:this.options.element,tippyOptions:this.options.tippyOptions,shouldShow:this.options.shouldShow})]:[]}});Nn({name:"BubbleMenu",props:{pluginKey:{type:null,default:"bubbleMenu"},editor:{type:Object,required:!0},tippyOptions:{type:Object,default:()=>({})},shouldShow:{type:Function,default:null}},setup(t,{slots:e}){const r=On(null);return Ol(()=>{const{pluginKey:o,editor:a,tippyOptions:l,shouldShow:d}=t;a.registerPlugin(M_({pluginKey:o,editor:a,element:r.value,tippyOptions:l,shouldShow:d}))}),Rd(()=>{const{pluginKey:o,editor:a}=t;a.unregisterPlugin(o)}),()=>{var o;return fa("div",{ref:r},(o=e.default)===null||o===void 0?void 0:o.call(e))}}});function P_(t){return zN((e,r)=>({get(){return e(),t},set(o){t=o,requestAnimationFrame(()=>{requestAnimationFrame(()=>{r()})})}}))}class eP extends CM{constructor(e={}){super(e);return this.vueRenderers=Aa(new Map),this.contentComponent=null,this.reactiveState=P_(this.view.state),this.reactiveExtensionStorage=P_(this.extensionStorage),this.on("transaction",()=>{this.reactiveState.value=this.view.state,this.reactiveExtensionStorage.value=this.extensionStorage}),XN(this)}get state(){return this.reactiveState?this.reactiveState.value:this.view.state}get storage(){return this.reactiveExtensionStorage?this.reactiveExtensionStorage.value:super.storage}registerPlugin(e,r){super.registerPlugin(e,r),this.reactiveState.value=this.view.state}unregisterPlugin(e){super.unregisterPlugin(e),this.reactiveState.value=this.view.state}}const tP=Nn({name:"EditorContent",props:{editor:{default:null,type:Object}},setup(t){const e=On(),r=wd();return JN(()=>{const o=t.editor;o&&o.options.element&&e.value&&lC(()=>{if(!e.value||!o.options.element.firstChild)return;const a=Oo(e.value);e.value.append(...o.options.element.childNodes),o.contentComponent=r.ctx._,o.setOptions({element:a}),o.createNodeViews()})}),Rd(()=>{const o=t.editor;if(!o||(o.isDestroyed||o.view.setProps({nodeViews:{}}),o.contentComponent=null,!o.options.element.firstChild))return;const a=document.createElement("div");a.append(...o.options.element.childNodes),o.setOptions({element:a})}),{rootEl:e}},render(){const t=[];return this.editor&&this.editor.vueRenderers.forEach(e=>{const r=fa(uC,{to:e.teleportElement,key:e.id},fa(e.component,re({ref:e.id},e.props)));t.push(r)}),fa("div",{ref:e=>{this.rootEl=e}},...t)}});Nn({name:"FloatingMenu",props:{pluginKey:{type:null,default:"floatingMenu"},editor:{type:Object,required:!0},tippyOptions:{type:Object,default:()=>({})},shouldShow:{type:Function,default:null}},setup(t,{slots:e}){const r=On(null);return Ol(()=>{const{pluginKey:o,editor:a,tippyOptions:l,shouldShow:d}=t;a.registerPlugin(L_({pluginKey:o,editor:a,element:r.value,tippyOptions:l,shouldShow:d}))}),Rd(()=>{const{pluginKey:o,editor:a}=t;a.unregisterPlugin(o)}),()=>{var o;return fa("div",{ref:r},(o=e.default)===null||o===void 0?void 0:o.call(e))}}});Nn({props:{as:{type:String,default:"div"}},inject:["onDragStart","decorationClasses"],render(){var t,e;return fa(this.as,{class:this.decorationClasses.value,style:{whiteSpace:"normal"},"data-node-view-wrapper":"",onDragstart:this.onDragStart},(e=(t=this.$slots).default)===null||e===void 0?void 0:e.call(t))}});Nn({props:{as:{type:String,default:"div"}},render(){return fa(this.as,{style:{whiteSpace:"pre-wrap"},"data-node-view-content":""})}});const rP=/^\s*>\s$/,nP=Ln.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block*",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:t}){return["blockquote",vn(this.options.HTMLAttributes,t),0]},addCommands(){return{setBlockquote:()=>({commands:t})=>t.wrapIn("blockquote"),toggleBlockquote:()=>({commands:t})=>t.toggleWrap("blockquote"),unsetBlockquote:()=>({commands:t})=>t.lift("blockquote")}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[th({find:rP,type:this.type})]}}),iP=/(?:^|\s)((?:\*\*)((?:[^*]+))(?:\*\*))$/,oP=/(?:^|\s)((?:\*\*)((?:[^*]+))(?:\*\*))/g,sP=/(?:^|\s)((?:__)((?:[^__]+))(?:__))$/,aP=/(?:^|\s)((?:__)((?:[^__]+))(?:__))/g,cP=Ps.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:t=>t.style.fontWeight!=="normal"&&null},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}]},renderHTML({HTMLAttributes:t}){return["strong",vn(this.options.HTMLAttributes,t),0]},addCommands(){return{setBold:()=>({commands:t})=>t.setMark("bold"),toggleBold:()=>({commands:t})=>t.toggleMark("bold"),unsetBold:()=>({commands:t})=>t.unsetMark("bold")}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold()}},addInputRules(){return[Ra({find:iP,type:this.type}),Ra({find:sP,type:this.type})]},addPasteRules(){return[wa({find:oP,type:this.type}),wa({find:aP,type:this.type})]}}),lP=/^\s*([-+*])\s$/,uP=Ln.create({name:"bulletList",addOptions(){return{HTMLAttributes:{}}},group:"block list",content:"listItem+",parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:t}){return["ul",vn(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleBulletList:()=>({commands:t})=>t.toggleList("bulletList","listItem")}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){return[th({find:lP,type:this.type})]}}),dP=/(?:^|\s)((?:`)((?:[^`]+))(?:`))$/,hP=/(?:^|\s)((?:`)((?:[^`]+))(?:`))/g,pP=Ps.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:t}){return["code",vn(this.options.HTMLAttributes,t),0]},addCommands(){return{setCode:()=>({commands:t})=>t.setMark("code"),toggleCode:()=>({commands:t})=>t.toggleMark("code"),unsetCode:()=>({commands:t})=>t.unsetMark("code")}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[Ra({find:dP,type:this.type})]},addPasteRules(){return[wa({find:hP,type:this.type})]}}),fP=/^```(?<language>[a-z]*)?[\s\n]$/,AP=/^~~~(?<language>[a-z]*)?[\s\n]$/,gP=Ln.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:null,parseHTML:t=>{var e;const{languageClassPrefix:r}=this.options,l=[...((e=t.firstElementChild)===null||e===void 0?void 0:e.classList)||[]].filter(d=>d.startsWith(r)).map(d=>d.replace(r,""))[0];return l||null},renderHTML:t=>t.language?{class:this.options.languageClassPrefix+t.language}:null}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({HTMLAttributes:t}){return["pre",this.options.HTMLAttributes,["code",t,0]]},addCommands(){return{setCodeBlock:t=>({commands:e})=>e.setNode("codeBlock",t),toggleCodeBlock:t=>({commands:e})=>e.toggleNode("codeBlock","paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:t,$anchor:e}=this.editor.state.selection,r=e.pos===1;return!t||e.parent.type.name!==this.name?!1:r||!e.parent.textContent.length?this.editor.commands.clearNodes():!1}}},addInputRules(){return[rg({find:fP,type:this.type,getAttributes:({groups:t})=>t}),rg({find:AP,type:this.type,getAttributes:({groups:t})=>t})]},addProseMirrorPlugins(){return[new An({key:new ai("codeBlockVSCodeHandler"),props:{handlePaste:(t,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const r=e.clipboardData.getData("text/plain"),o=e.clipboardData.getData("vscode-editor-data"),a=o?JSON.parse(o):void 0,l=a==null?void 0:a.mode;if(!r||!l)return!1;const{tr:d}=t.state;return d.replaceSelectionWith(this.type.create({language:l})),d.setSelection(Dt.near(d.doc.resolve(Math.max(0,d.selection.from-2)))),d.insertText(r.replace(/\r\n?/g,`
`)),d.setMeta("paste",!0),t.dispatch(d),!0}}})]}}),mP=Ln.create({name:"doc",topNode:!0,content:"block+"});function vP(t){return t===void 0&&(t={}),new An({view:function(r){return new xo(r,t)}})}var xo=function(e,r){var o=this;this.editorView=e,this.width=r.width||1,this.color=r.color||"black",this.class=r.class,this.cursorPos=null,this.element=null,this.timeout=null,this.handlers=["dragover","dragend","drop","dragleave"].map(function(a){var l=function(d){return o[a](d)};return e.dom.addEventListener(a,l),{name:a,handler:l}})};xo.prototype.destroy=function(){var e=this;this.handlers.forEach(function(r){var o=r.name,a=r.handler;return e.editorView.dom.removeEventListener(o,a)})};xo.prototype.update=function(e,r){this.cursorPos!=null&&r.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())};xo.prototype.setCursor=function(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())};xo.prototype.updateOverlay=function(){var e=this.editorView.state.doc.resolve(this.cursorPos),r;if(!e.parent.inlineContent){var o=e.nodeBefore,a=e.nodeAfter;if(o||a){var l=this.editorView.nodeDOM(this.cursorPos-(o?o.nodeSize:0)).getBoundingClientRect(),d=o?l.bottom:l.top;o&&a&&(d=(d+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),r={left:l.left,right:l.right,top:d-this.width/2,bottom:d+this.width/2}}}if(!r){var p=this.editorView.coordsAtPos(this.cursorPos);r={left:p.left-this.width/2,right:p.left+this.width/2,top:p.top,bottom:p.bottom}}var g=this.editorView.dom.offsetParent;this.element||(this.element=g.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none; background-color: "+this.color);var v,C;if(!g||g==document.body&&getComputedStyle(g).position=="static")v=-pageXOffset,C=-pageYOffset;else{var y=g.getBoundingClientRect();v=y.left-g.scrollLeft,C=y.top-g.scrollTop}this.element.style.left=r.left-v+"px",this.element.style.top=r.top-C+"px",this.element.style.width=r.right-r.left+"px",this.element.style.height=r.bottom-r.top+"px"};xo.prototype.scheduleRemoval=function(e){var r=this;clearTimeout(this.timeout),this.timeout=setTimeout(function(){return r.setCursor(null)},e)};xo.prototype.dragover=function(e){if(!!this.editorView.editable){var r=this.editorView.posAtCoords({left:e.clientX,top:e.clientY});if(r){var o=r.pos;if(this.editorView.dragging&&this.editorView.dragging.slice&&(o=e0(this.editorView.state.doc,o,this.editorView.dragging.slice),o==null))return this.setCursor(null);this.setCursor(o),this.scheduleRemoval(5e3)}}};xo.prototype.dragend=function(){this.scheduleRemoval(20)};xo.prototype.drop=function(){this.scheduleRemoval(20)};xo.prototype.dragleave=function(e){(e.target==this.editorView.dom||!this.editorView.dom.contains(e.relatedTarget))&&this.setCursor(null)};const EP=rn.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:null}},addProseMirrorPlugins(){return[vP(this.options)]}});var Ao=function(t){function e(r){t.call(this,r,r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.map=function(o,a){var l=o.resolve(a.map(this.head));return e.valid(l)?new e(l):t.near(l)},e.prototype.content=function(){return ye.empty},e.prototype.eq=function(o){return o instanceof e&&o.head==this.head},e.prototype.toJSON=function(){return{type:"gapcursor",pos:this.head}},e.fromJSON=function(o,a){if(typeof a.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new e(o.resolve(a.pos))},e.prototype.getBookmark=function(){return new uh(this.anchor)},e.valid=function(o){var a=o.parent;if(a.isTextblock||!IP(o)||!CP(o))return!1;var l=a.type.spec.allowGapCursor;if(l!=null)return l;var d=a.contentMatchAt(o.index()).defaultType;return d&&d.isTextblock},e.findFrom=function(o,a,l){e:for(;;){if(!l&&e.valid(o))return o;for(var d=o.pos,p=null,g=o.depth;;g--){var v=o.node(g);if(a>0?o.indexAfter(g)<v.childCount:o.index(g)>0){p=v.child(a>0?o.indexAfter(g):o.index(g)-1);break}else if(g==0)return null;d+=a;var C=o.doc.resolve(d);if(e.valid(C))return C}for(;;){var y=a>0?p.firstChild:p.lastChild;if(!y){if(p.isAtom&&!p.isText&&!tt.isSelectable(p)){o=o.doc.resolve(d+p.nodeSize*a),l=!1;continue e}break}p=y,d+=a;var w=o.doc.resolve(d);if(e.valid(w))return w}return null}},e}(ot);Ao.prototype.visible=!1;ot.jsonID("gapcursor",Ao);var uh=function(e){this.pos=e};uh.prototype.map=function(e){return new uh(e.map(this.pos))};uh.prototype.resolve=function(e){var r=e.resolve(this.pos);return Ao.valid(r)?new Ao(r):ot.near(r)};function IP(t){for(var e=t.depth;e>=0;e--){var r=t.index(e);if(r!=0)for(var o=t.node(e).child(r-1);;o=o.lastChild){if(o.childCount==0&&!o.inlineContent||o.isAtom||o.type.spec.isolating)return!0;if(o.inlineContent)return!1}}return!0}function CP(t){for(var e=t.depth;e>=0;e--){var r=t.indexAfter(e),o=t.node(e);if(r!=o.childCount)for(var a=o.child(r);;a=a.firstChild){if(a.childCount==0&&!a.inlineContent||a.isAtom||a.type.spec.isolating)return!0;if(a.inlineContent)return!1}}return!0}var yP=function(){return new An({props:{decorations:TP,createSelectionBetween:function(e,r,o){if(r.pos==o.pos&&Ao.valid(o))return new Ao(o)},handleClick:SP,handleKeyDown:_P}})},_P=Ly({ArrowLeft:dh("horiz",-1),ArrowRight:dh("horiz",1),ArrowUp:dh("vert",-1),ArrowDown:dh("vert",1)});function dh(t,e){var r=t=="vert"?e>0?"down":"up":e>0?"right":"left";return function(o,a,l){var d=o.selection,p=e>0?d.$to:d.$from,g=d.empty;if(d instanceof Dt){if(!l.endOfTextblock(r)||p.depth==0)return!1;g=!1,p=o.doc.resolve(e>0?p.after():p.before())}var v=Ao.findFrom(p,e,g);return v?(a&&a(o.tr.setSelection(new Ao(v))),!0):!1}}function SP(t,e,r){if(!t.editable)return!1;var o=t.state.doc.resolve(e);if(!Ao.valid(o))return!1;var a=t.posAtCoords({left:r.clientX,top:r.clientY}),l=a.inside;return l>-1&&tt.isSelectable(t.state.doc.nodeAt(l))?!1:(t.dispatch(t.state.tr.setSelection(new Ao(o))),!0)}function TP(t){if(!(t.selection instanceof Ao))return null;var e=document.createElement("div");return e.className="ProseMirror-gapcursor",Gt.create(t.doc,[Qr.widget(t.selection.head,e,{key:"gapcursor"})])}const RP=rn.create({name:"gapCursor",addProseMirrorPlugins(){return[yP()]},extendNodeSchema(t){var e;const r={name:t.name,options:t.options,storage:t.storage};return{allowGapCursor:(e=at(Ne(t,"allowGapCursor",r)))!==null&&e!==void 0?e:null}}}),wP=Ln.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:t}){return["br",vn(this.options.HTMLAttributes,t)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:t,chain:e,state:r,editor:o})=>t.first([()=>t.exitCode(),()=>t.command(()=>{const{keepMarks:a}=this.options,{splittableMarks:l}=o.extensionManager,d=r.storedMarks||r.selection.$to.parentOffset&&r.selection.$from.marks();return e().insertContent({type:this.name}).command(({tr:p,dispatch:g})=>{if(g&&d&&a){const v=d.filter(C=>l.includes(C.type.name));p.ensureMarks(v)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),NP=Ln.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(t=>({tag:`h${t}`,attrs:{level:t}}))},renderHTML({node:t,HTMLAttributes:e}){return[`h${this.options.levels.includes(t.attrs.level)?t.attrs.level:this.options.levels[0]}`,vn(this.options.HTMLAttributes,e),0]},addCommands(){return{setHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.setNode("heading",t):!1,toggleHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.toggleNode("heading","paragraph",t):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((t,e)=>Hn(re({},t),{[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(t=>rg({find:new RegExp(`^(#{1,${t}})\\s$`),type:this.type,getAttributes:{level:t}}))}});var hh=200,En=function(){};En.prototype.append=function(e){return e.length?(e=En.from(e),!this.length&&e||e.length<hh&&this.leafAppend(e)||this.length<hh&&e.leafPrepend(this)||this.appendInner(e)):this};En.prototype.prepend=function(e){return e.length?En.from(e).append(this):this};En.prototype.appendInner=function(e){return new OP(this,e)};En.prototype.slice=function(e,r){return e===void 0&&(e=0),r===void 0&&(r=this.length),e>=r?En.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,r))};En.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};En.prototype.forEach=function(e,r,o){r===void 0&&(r=0),o===void 0&&(o=this.length),r<=o?this.forEachInner(e,r,o,0):this.forEachInvertedInner(e,r,o,0)};En.prototype.map=function(e,r,o){r===void 0&&(r=0),o===void 0&&(o=this.length);var a=[];return this.forEach(function(l,d){return a.push(e(l,d))},r,o),a};En.from=function(e){return e instanceof En?e:e&&e.length?new x_(e):En.empty};var x_=function(t){function e(o){t.call(this),this.values=o}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(a,l){return a==0&&l==this.length?this:new e(this.values.slice(a,l))},e.prototype.getInner=function(a){return this.values[a]},e.prototype.forEachInner=function(a,l,d,p){for(var g=l;g<d;g++)if(a(this.values[g],p+g)===!1)return!1},e.prototype.forEachInvertedInner=function(a,l,d,p){for(var g=l-1;g>=d;g--)if(a(this.values[g],p+g)===!1)return!1},e.prototype.leafAppend=function(a){if(this.length+a.length<=hh)return new e(this.values.concat(a.flatten()))},e.prototype.leafPrepend=function(a){if(this.length+a.length<=hh)return new e(a.flatten().concat(this.values))},r.length.get=function(){return this.values.length},r.depth.get=function(){return 0},Object.defineProperties(e.prototype,r),e}(En);En.empty=new x_([]);var OP=function(t){function e(r,o){t.call(this),this.left=r,this.right=o,this.length=r.length+o.length,this.depth=Math.max(r.depth,o.depth)+1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(o){return o<this.left.length?this.left.get(o):this.right.get(o-this.left.length)},e.prototype.forEachInner=function(o,a,l,d){var p=this.left.length;if(a<p&&this.left.forEachInner(o,a,Math.min(l,p),d)===!1||l>p&&this.right.forEachInner(o,Math.max(a-p,0),Math.min(this.length,l)-p,d+p)===!1)return!1},e.prototype.forEachInvertedInner=function(o,a,l,d){var p=this.left.length;if(a>p&&this.right.forEachInvertedInner(o,a-p,Math.max(l,p)-p,d+p)===!1||l<p&&this.left.forEachInvertedInner(o,Math.min(a,p),l,d)===!1)return!1},e.prototype.sliceInner=function(o,a){if(o==0&&a==this.length)return this;var l=this.left.length;return a<=l?this.left.slice(o,a):o>=l?this.right.slice(o-l,a-l):this.left.slice(o,l).append(this.right.slice(0,a-l))},e.prototype.leafAppend=function(o){var a=this.right.leafAppend(o);if(a)return new e(this.left,a)},e.prototype.leafPrepend=function(o){var a=this.left.leafPrepend(o);if(a)return new e(a,this.right)},e.prototype.appendInner=function(o){return this.left.depth>=Math.max(this.right.depth,o.depth)+1?new e(this.left,new e(this.right,o)):new e(this,o)},e}(En),Q_=En,kP=500,In=function(e,r){this.items=e,this.eventCount=r};In.prototype.popEvent=function(e,r){var o=this;if(this.eventCount==0)return null;for(var a=this.items.length;;a--){var l=this.items.get(a-1);if(l.selection){--a;break}}var d,p;r&&(d=this.remapping(a,this.items.length),p=d.maps.length);var g=e.tr,v,C,y=[],w=[];return this.items.forEach(function(k,M){if(!k.step){d||(d=o.remapping(a,M+1),p=d.maps.length),p--,w.push(k);return}if(d){w.push(new Qo(k.map));var x=k.step.map(d.slice(p)),V;x&&g.maybeStep(x).doc&&(V=g.mapping.maps[g.mapping.maps.length-1],y.push(new Qo(V,null,null,y.length+w.length))),p--,V&&d.appendMap(V,p)}else g.maybeStep(k.step);if(k.selection)return v=d?k.selection.map(d.slice(p)):k.selection,C=new In(o.items.slice(0,a).append(w.reverse().concat(y)),o.eventCount-1),!1},this.items.length,0),{remaining:C,transform:g,selection:v}};In.prototype.addTransform=function(e,r,o,a){for(var l=[],d=this.eventCount,p=this.items,g=!a&&p.length?p.get(p.length-1):null,v=0;v<e.steps.length;v++){var C=e.steps[v].invert(e.docs[v]),y=new Qo(e.mapping.maps[v],C,r),w=void 0;(w=g&&g.merge(y))&&(y=w,v?l.pop():p=p.slice(0,p.length-1)),l.push(y),r&&(d++,r=null),a||(g=y)}var k=d-o.depth;return k>DP&&(p=bP(p,k),d-=k),new In(p.append(l),d)};In.prototype.remapping=function(e,r){var o=new Dn;return this.items.forEach(function(a,l){var d=a.mirrorOffset!=null&&l-a.mirrorOffset>=e?o.maps.length-a.mirrorOffset:null;o.appendMap(a.map,d)},e,r),o};In.prototype.addMaps=function(e){return this.eventCount==0?this:new In(this.items.append(e.map(function(r){return new Qo(r)})),this.eventCount)};In.prototype.rebased=function(e,r){if(!this.eventCount)return this;var o=[],a=Math.max(0,this.items.length-r),l=e.mapping,d=e.steps.length,p=this.eventCount;this.items.forEach(function(k){k.selection&&p--},a);var g=r;this.items.forEach(function(k){var M=l.getMirror(--g);if(M!=null){d=Math.min(d,M);var x=l.maps[M];if(k.step){var V=e.steps[M].invert(e.docs[M]),Y=k.selection&&k.selection.map(l.slice(g+1,M));Y&&p++,o.push(new Qo(x,V,Y))}else o.push(new Qo(x))}},a);for(var v=[],C=r;C<d;C++)v.push(new Qo(l.maps[C]));var y=this.items.slice(0,a).append(v).append(o),w=new In(y,p);return w.emptyItemCount()>kP&&(w=w.compress(this.items.length-o.length)),w};In.prototype.emptyItemCount=function(){var e=0;return this.items.forEach(function(r){r.step||e++}),e};In.prototype.compress=function(e){e===void 0&&(e=this.items.length);var r=this.remapping(0,e),o=r.maps.length,a=[],l=0;return this.items.forEach(function(d,p){if(p>=e)a.push(d),d.selection&&l++;else if(d.step){var g=d.step.map(r.slice(o)),v=g&&g.getMap();if(o--,v&&r.appendMap(v,o),g){var C=d.selection&&d.selection.map(r.slice(o));C&&l++;var y=new Qo(v.invert(),g,C),w,k=a.length-1;(w=a.length&&a[k].merge(y))?a[k]=w:a.push(y)}}else d.map&&o--},this.items.length,0),new In(Q_.from(a.reverse()),l)};In.empty=new In(Q_.empty,0);function bP(t,e){var r;return t.forEach(function(o,a){if(o.selection&&e--==0)return r=a,!1}),t.slice(r)}var Qo=function(e,r,o,a){this.map=e,this.step=r,this.selection=o,this.mirrorOffset=a};Qo.prototype.merge=function(e){if(this.step&&e.step&&!e.selection){var r=e.step.merge(this.step);if(r)return new Qo(r.getMap().invert(),r,this.selection)}};var Us=function(e,r,o,a){this.done=e,this.undone=r,this.prevRanges=o,this.prevTime=a},DP=20;function BP(t,e,r,o){var a=r.getMeta(Fs),l;if(a)return a.historyState;r.getMeta(LP)&&(t=new Us(t.done,t.undone,null,0));var d=r.getMeta("appendedTransaction");if(r.steps.length==0)return t;if(d&&d.getMeta(Fs))return d.getMeta(Fs).redo?new Us(t.done.addTransform(r,null,o,ph(e)),t.undone,U_(r.mapping.maps[r.steps.length-1]),t.prevTime):new Us(t.done,t.undone.addTransform(r,null,o,ph(e)),null,t.prevTime);if(r.getMeta("addToHistory")!==!1&&!(d&&d.getMeta("addToHistory")===!1)){var p=t.prevTime==0||!d&&(t.prevTime<(r.time||0)-o.newGroupDelay||!MP(r,t.prevRanges)),g=d?mg(t.prevRanges,r.mapping):U_(r.mapping.maps[r.steps.length-1]);return new Us(t.done.addTransform(r,p?e.selection.getBookmark():null,o,ph(e)),In.empty,g,r.time)}else return(l=r.getMeta("rebased"))?new Us(t.done.rebased(r,l),t.undone.rebased(r,l),mg(t.prevRanges,r.mapping),t.prevTime):new Us(t.done.addMaps(r.mapping.maps),t.undone.addMaps(r.mapping.maps),mg(t.prevRanges,r.mapping),t.prevTime)}function MP(t,e){if(!e)return!1;if(!t.docChanged)return!0;var r=!1;return t.mapping.maps[0].forEach(function(o,a){for(var l=0;l<e.length;l+=2)o<=e[l+1]&&a>=e[l]&&(r=!0)}),r}function U_(t){var e=[];return t.forEach(function(r,o,a,l){return e.push(a,l)}),e}function mg(t,e){if(!t)return null;for(var r=[],o=0;o<t.length;o+=2){var a=e.map(t[o],1),l=e.map(t[o+1],-1);a<=l&&r.push(a,l)}return r}function F_(t,e,r,o){var a=ph(e),l=Fs.get(e).spec.config,d=(o?t.undone:t.done).popEvent(e,a);if(!!d){var p=d.selection.resolve(d.transform.doc),g=(o?t.done:t.undone).addTransform(d.transform,e.selection.getBookmark(),l,a),v=new Us(o?g:d.remaining,o?d.remaining:g,null,0);r(d.transform.setSelection(p).setMeta(Fs,{redo:o,historyState:v}).scrollIntoView())}}var vg=!1,V_=null;function ph(t){var e=t.plugins;if(V_!=e){vg=!1,V_=e;for(var r=0;r<e.length;r++)if(e[r].spec.historyPreserveItems){vg=!0;break}}return vg}var Fs=new ai("history"),LP=new ai("closeHistory");function PP(t){return t={depth:t&&t.depth||100,newGroupDelay:t&&t.newGroupDelay||500},new An({key:Fs,state:{init:function(){return new Us(In.empty,In.empty,null,0)},apply:function(r,o,a){return BP(o,a,r,t)}},config:t,props:{handleDOMEvents:{beforeinput:function(r,o){var a=o.inputType=="historyUndo"?G_(r.state,r.dispatch):o.inputType=="historyRedo"?j_(r.state,r.dispatch):!1;return a&&o.preventDefault(),a}}}})}function G_(t,e){var r=Fs.getState(t);return!r||r.done.eventCount==0?!1:(e&&F_(r,t,e,!1),!0)}function j_(t,e){var r=Fs.getState(t);return!r||r.undone.eventCount==0?!1:(e&&F_(r,t,e,!0),!0)}const xP=rn.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:t,dispatch:e})=>G_(t,e),redo:()=>({state:t,dispatch:e})=>j_(t,e)}},addProseMirrorPlugins(){return[PP(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Mod-y":()=>this.editor.commands.redo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-\u044F":()=>this.editor.commands.undo(),"Shift-Mod-\u044F":()=>this.editor.commands.redo()}}}),QP=Ln.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:t}){return["hr",vn(this.options.HTMLAttributes,t)]},addCommands(){return{setHorizontalRule:()=>({chain:t})=>t().command(({tr:e,dispatch:r})=>{const{selection:o}=e,{empty:a,$anchor:l}=o,d=l.parent.isTextblock&&!l.parent.type.spec.code&&!l.parent.textContent;if(!a||!d||!r)return!0;const p=l.before(),g=l.start();return e.deleteRange(p,g),e.setSelection(Dt.create(e.doc,p)),!0}).insertContent({type:this.name}).command(({tr:e,dispatch:r})=>{var o;if(r){const{parent:a,pos:l}=e.selection.$from,d=l+1;if(!e.doc.nodeAt(d)){const g=(o=a.type.contentMatch.defaultType)===null||o===void 0?void 0:o.create();g&&(e.insert(d,g),e.setSelection(Dt.create(e.doc,d)))}e.scrollIntoView()}return!0}).run()}},addInputRules(){return[yM({find:/^(?:---|—-|___\s|\*\*\*\s)$/,type:this.type})]}}),UP=/(?:^|\s)((?:\*)((?:[^*]+))(?:\*))$/,FP=/(?:^|\s)((?:\*)((?:[^*]+))(?:\*))/g,VP=/(?:^|\s)((?:_)((?:[^_]+))(?:_))$/,GP=/(?:^|\s)((?:_)((?:[^_]+))(?:_))/g,jP=Ps.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:t=>t.style.fontStyle!=="normal"&&null},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:t}){return["em",vn(this.options.HTMLAttributes,t),0]},addCommands(){return{setItalic:()=>({commands:t})=>t.setMark("italic"),toggleItalic:()=>({commands:t})=>t.toggleMark("italic"),unsetItalic:()=>({commands:t})=>t.unsetMark("italic")}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[Ra({find:UP,type:this.type}),Ra({find:VP,type:this.type})]},addPasteRules(){return[wa({find:FP,type:this.type}),wa({find:GP,type:this.type})]}}),HP=Ln.create({name:"listItem",addOptions(){return{HTMLAttributes:{}}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",vn(this.options.HTMLAttributes,t),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem("listItem"),Tab:()=>this.editor.commands.sinkListItem("listItem"),"Shift-Tab":()=>this.editor.commands.liftListItem("listItem")}}}),KP=/^(\d+)\.\s$/,WP=Ln.create({name:"orderedList",addOptions(){return{HTMLAttributes:{}}},group:"block list",content:"listItem+",addAttributes(){return{start:{default:1,parseHTML:t=>t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:t}){const o=t,{start:e}=o,r=cC(o,["start"]);return e===1?["ol",vn(this.options.HTMLAttributes,r),0]:["ol",vn(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleOrderedList:()=>({commands:t})=>t.toggleList("orderedList","listItem")}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){return[th({find:KP,type:this.type,getAttributes:t=>({start:+t[1]}),joinPredicate:(t,e)=>e.childCount+e.attrs.start===+t[1]})]}}),YP=Ln.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",vn(this.options.HTMLAttributes,t),0]},addCommands(){return{setParagraph:()=>({commands:t})=>t.setNode("paragraph")}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),qP=/(?:^|\s)((?:~~)((?:[^~]+))(?:~~))$/,JP=/(?:^|\s)((?:~~)((?:[^~]+))(?:~~))/g,zP=Ps.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["s",vn(this.options.HTMLAttributes,t),0]},addCommands(){return{setStrike:()=>({commands:t})=>t.setMark("strike"),toggleStrike:()=>({commands:t})=>t.toggleMark("strike"),unsetStrike:()=>({commands:t})=>t.unsetMark("strike")}},addKeyboardShortcuts(){return{"Mod-Shift-x":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[Ra({find:qP,type:this.type})]},addPasteRules(){return[wa({find:JP,type:this.type})]}}),XP=Ln.create({name:"text",group:"inline"}),$P=rn.create({name:"starterKit",addExtensions(){var t,e,r,o,a,l,d,p,g,v,C,y,w,k,M,x,V,Y;const H=[];return this.options.blockquote!==!1&&H.push(nP.configure((t=this.options)===null||t===void 0?void 0:t.blockquote)),this.options.bold!==!1&&H.push(cP.configure((e=this.options)===null||e===void 0?void 0:e.bold)),this.options.bulletList!==!1&&H.push(uP.configure((r=this.options)===null||r===void 0?void 0:r.bulletList)),this.options.code!==!1&&H.push(pP.configure((o=this.options)===null||o===void 0?void 0:o.code)),this.options.codeBlock!==!1&&H.push(gP.configure((a=this.options)===null||a===void 0?void 0:a.codeBlock)),this.options.document!==!1&&H.push(mP.configure((l=this.options)===null||l===void 0?void 0:l.document)),this.options.dropcursor!==!1&&H.push(EP.configure((d=this.options)===null||d===void 0?void 0:d.dropcursor)),this.options.gapcursor!==!1&&H.push(RP.configure((p=this.options)===null||p===void 0?void 0:p.gapcursor)),this.options.hardBreak!==!1&&H.push(wP.configure((g=this.options)===null||g===void 0?void 0:g.hardBreak)),this.options.heading!==!1&&H.push(NP.configure((v=this.options)===null||v===void 0?void 0:v.heading)),this.options.history!==!1&&H.push(xP.configure((C=this.options)===null||C===void 0?void 0:C.history)),this.options.horizontalRule!==!1&&H.push(QP.configure((y=this.options)===null||y===void 0?void 0:y.horizontalRule)),this.options.italic!==!1&&H.push(jP.configure((w=this.options)===null||w===void 0?void 0:w.italic)),this.options.listItem!==!1&&H.push(HP.configure((k=this.options)===null||k===void 0?void 0:k.listItem)),this.options.orderedList!==!1&&H.push(WP.configure((M=this.options)===null||M===void 0?void 0:M.orderedList)),this.options.paragraph!==!1&&H.push(YP.configure((x=this.options)===null||x===void 0?void 0:x.paragraph)),this.options.strike!==!1&&H.push(zP.configure((V=this.options)===null||V===void 0?void 0:V.strike)),this.options.text!==!1&&H.push(XP.configure((Y=this.options)===null||Y===void 0?void 0:Y.text)),H}}),ZP=(t,e)=>{let r=0,o=0;for(;r<t.length&&r<e.length&&t[r]===e[r];)r++;if(r!==t.length||r!==e.length)for(;o+r<t.length&&o+r<e.length&&t[t.length-o-1]===e[e.length-o-1];)o++;return{index:r,remove:t.length-r-o,insert:e.slice(r,e.length-o)}},e3=ZP,Fr=new ai("y-sync"),Oa=new ai("y-undo"),fh=new ai("yjs-cursor"),Ah=(t,e)=>e===void 0?!t.deleted:e.sv.has(t.id.client)&&e.sv.get(t.id.client)>t.id.clock&&!hO(e.ds,t.id),t3=[{light:"#ecd44433",dark:"#ecd444"}],r3=(t,e,r)=>{if(!t.has(r)){if(t.size<e.length){const o=IO();t.forEach(a=>o.add(a)),e=e.filter(a=>!o.has(a))}t.set(r,mO(e))}return t.get(r)},n3=(t,{colors:e=t3,colorMapping:r=new Map,permanentUserData:o=null}={})=>{let a=!1;const l=new An({props:{editable:d=>{const p=Fr.getState(d);return p.snapshot==null&&p.prevSnapshot==null}},key:Fr,state:{init:(d,p)=>({type:t,doc:t.doc,binding:null,snapshot:null,prevSnapshot:null,isChangeOrigin:!1,colors:e,colorMapping:r,permanentUserData:o}),apply:(d,p)=>{const g=d.getMeta(Fr);if(g!==void 0){p=Object.assign({},p);for(const v in g)p[v]=g[v]}return p.isChangeOrigin=g!==void 0&&!!g.isChangeOrigin,p.binding!==null&&g!==void 0&&(g.snapshot!=null||g.prevSnapshot!=null)&&setTimeout(()=>{g.restore==null?p.binding._renderSnapshot(g.snapshot,g.prevSnapshot,p):(p.binding._renderSnapshot(g.snapshot,g.snapshot,p),delete p.restore,delete p.snapshot,delete p.prevSnapshot,p.binding._prosemirrorChanged(p.binding.prosemirrorView.state.doc))},0),p}},view:d=>{const p=new o3(t,d);return setTimeout(()=>{p._forceRerender(),d.dispatch(d.state.tr.setMeta(Fr,{binding:p}))},0),{update:()=>{const g=l.getState(d.state);g.snapshot==null&&g.prevSnapshot==null&&(a||d.state.doc.content.findDiffStart(d.state.doc.type.createAndFill().content)!==null)&&(a=!0,p._prosemirrorChanged(d.state.doc))},destroy:()=>{p.destroy()}}}});return l},i3=(t,e,r)=>{if(e!==null&&e.anchor!==null&&e.head!==null){const o=lu(r.doc,r.type,e.anchor,r.mapping),a=lu(r.doc,r.type,e.head,r.mapping);o!==null&&a!==null&&(t=t.setSelection(Dt.create(t.doc,o,a)))}},Eg=(t,e)=>({anchor:Eh(e.selection.anchor,t.type,t.mapping),head:Eh(e.selection.head,t.type,t.mapping)});class o3{constructor(e,r){this.type=e,this.prosemirrorView=r,this.mux=cO(),this.mapping=new Map,this._observeFunction=this._typeChanged.bind(this),this.doc=e.doc,this.beforeTransactionSelection=null,this.beforeAllTransactions=()=>{this.beforeTransactionSelection===null&&(this.beforeTransactionSelection=Eg(this,r.state))},this.afterAllTransactions=()=>{this.beforeTransactionSelection=null},this.doc.on("beforeAllTransactions",this.beforeAllTransactions),this.doc.on("afterAllTransactions",this.afterAllTransactions),e.observeDeep(this._observeFunction),this._domSelectionInView=null}_isLocalCursorInView(){return this.prosemirrorView.hasFocus()?(lO&&this._domSelectionInView===null&&(setTimeout(()=>{this._domSelectionInView=null},0),this._domSelectionInView=this._isDomSelectionInView()),this._domSelectionInView):!1}_isDomSelectionInView(){const e=this.prosemirrorView._root.getSelection(),r=this.prosemirrorView._root.createRange();r.setStart(e.anchorNode,e.anchorOffset),r.setEnd(e.focusNode,e.focusOffset),r.getClientRects().length===0&&r.startContainer&&r.collapsed&&r.selectNodeContents(r.startContainer);const a=r.getBoundingClientRect(),l=uO.documentElement;return a.bottom>=0&&a.right>=0&&a.left<=(window.innerWidth||l.clientWidth||0)&&a.top<=(window.innerHeight||l.clientHeight||0)}renderSnapshot(e,r){r||(r=AO(gO(),new Map)),this.prosemirrorView.dispatch(this.prosemirrorView.state.tr.setMeta(Fr,{snapshot:e,prevSnapshot:r}))}unrenderSnapshot(){this.mapping=new Map,this.mux(()=>{const e=this.type.toArray().map(o=>gh(o,this.prosemirrorView.state.schema,this.mapping)).filter(o=>o!==null),r=this.prosemirrorView.state.tr.replace(0,this.prosemirrorView.state.doc.content.size,new ye(new ee(e),0,0));r.setMeta(Fr,{snapshot:null,prevSnapshot:null}),this.prosemirrorView.dispatch(r)})}_forceRerender(){this.mapping=new Map,this.mux(()=>{const e=this.type.toArray().map(o=>gh(o,this.prosemirrorView.state.schema,this.mapping)).filter(o=>o!==null),r=this.prosemirrorView.state.tr.replace(0,this.prosemirrorView.state.doc.content.size,new ye(new ee(e),0,0));this.prosemirrorView.dispatch(r)})}_renderSnapshot(e,r,o){e||(e=dO(this.doc)),this.mapping=new Map,this.mux(()=>{this.doc.transact(a=>{const l=o.permanentUserData;l&&l.dss.forEach(v=>{EC(a,v,C=>{})});const d=(v,C)=>{const y=v==="added"?l.getUserByClientId(C.client):l.getUserByDeletedId(C);return{user:y,type:v,color:r3(o.colorMapping,o.colors,y)}},p=IC(this.type,new CC(r.ds,e.sv)).map(v=>!v._item.deleted||Ah(v._item,e)||Ah(v._item,r)?gh(v,this.prosemirrorView.state.schema,new Map,e,r,d):null).filter(v=>v!==null),g=this.prosemirrorView.state.tr.replace(0,this.prosemirrorView.state.doc.content.size,new ye(new ee(p),0,0));this.prosemirrorView.dispatch(g)},Fr)})}_typeChanged(e,r){const o=Fr.getState(this.prosemirrorView.state);if(e.length===0||o.snapshot!=null||o.prevSnapshot!=null){this.renderSnapshot(o.snapshot,o.prevSnapshot);return}this.mux(()=>{const a=(p,g)=>this.mapping.delete(g);EC(r,r.deleteSet,p=>p.constructor===yC&&this.mapping.delete(p.content.type)),r.changed.forEach(a),r.changedParentTypes.forEach(a);const l=this.type.toArray().map(p=>H_(p,this.prosemirrorView.state.schema,this.mapping)).filter(p=>p!==null);let d=this.prosemirrorView.state.tr.replace(0,this.prosemirrorView.state.doc.content.size,new ye(new ee(l),0,0));i3(d,this.beforeTransactionSelection,this),d=d.setMeta(Fr,{isChangeOrigin:!0}),this.beforeTransactionSelection!==null&&this._isLocalCursorInView()&&d.scrollIntoView(),this.prosemirrorView.dispatch(d)})}_prosemirrorChanged(e){this.mux(()=>{this.doc.transact(()=>{yg(this.doc,this.type,e,this.mapping),this.beforeTransactionSelection=Eg(this,this.prosemirrorView.state)},Fr)})}destroy(){this.type.unobserveDeep(this._observeFunction),this.doc.off("beforeAllTransactions",this.beforeAllTransactions),this.doc.off("afterAllTransactions",this.afterAllTransactions)}}const H_=(t,e,r,o,a,l)=>{const d=r.get(t);if(d===void 0){if(t instanceof rs)return gh(t,e,r,o,a,l);throw pO()}return d},gh=(t,e,r,o,a,l)=>{const d=[],p=g=>{if(g.constructor===rs){const v=H_(g,e,r,o,a,l);v!==null&&d.push(v)}else{const v=s3(g,e,r,o,a,l);v!==null&&v.forEach(C=>{C!==null&&d.push(C)})}};o===void 0||a===void 0?t.toArray().forEach(p):IC(t,new CC(a.ds,o.sv)).forEach(p);try{const g=t.getAttributes(o);o!==void 0&&(Ah(t._item,o)?Ah(t._item,a)||(g.ychange=l?l("added",t._item.id):{type:"added"}):g.ychange=l?l("removed",t._item.id):{type:"removed"});const v=e.node(t.nodeName,g,d);return r.set(t,v),v}catch{return t.doc.transact(v=>{t._item.delete(v)},Fr),r.delete(t),null}},s3=(t,e,r,o,a,l)=>{const d=[],p=t.toDelta(o,a,l);try{for(let g=0;g<p.length;g++){const v=p[g],C=[];for(const y in v.attributes)C.push(e.mark(y,v.attributes[y]));d.push(e.text(v.insert,C))}}catch{return t.doc.transact(v=>{t._item.delete(v)},Fr),null}return d},a3=(t,e)=>{const r=new Ts,o=t.map(a=>({insert:a.text,attributes:Y_(a.marks)}));return r.applyDelta(o),e.set(r,t),r},c3=(t,e)=>{const r=new rs(t.type.name);for(const o in t.attrs){const a=t.attrs[o];a!==null&&o!=="ychange"&&r.setAttribute(o,a)}return r.insert(0,mh(t).map(o=>Ig(o,e))),e.set(r,t),r},Ig=(t,e)=>t instanceof Array?a3(t,e):c3(t,e),Cg=(t,e)=>{const r=Object.keys(t).filter(a=>t[a]!==null);let o=r.length===Object.keys(e).filter(a=>e[a]!==null).length;for(let a=0;a<r.length&&o;a++){const l=r[a],d=t[l],p=e[l];o=l==="ychange"||d===p||typeof d=="object"&&typeof p=="object"&&Cg(d,p)}return o},mh=t=>{const e=t.content.content,r=[];for(let o=0;o<e.length;o++){const a=e[o];if(a.isText){const l=[];for(let d=e[o];o<e.length&&d.isText;d=e[++o])l.push(d);o--,r.push(l)}else r.push(a)}return r},K_=(t,e)=>{const r=t.toDelta();return r.length===e.length&&r.every((o,a)=>o.insert===e[a].text&&fO(o.attributes||{}).length===e[a].marks.length&&e[a].marks.every(l=>Cg(o.attributes[l.type.name]||{},l.attrs)))},au=(t,e)=>{if(t instanceof rs&&!(e instanceof Array)&&_g(t,e)){const r=mh(e);return t._length===r.length&&Cg(t.getAttributes(),e.attrs)&&t.toArray().every((o,a)=>au(o,r[a]))}return t instanceof Ts&&e instanceof Array&&K_(t,e)},vh=(t,e)=>t===e||t instanceof Array&&e instanceof Array&&t.length===e.length&&t.every((r,o)=>e[o]===r),W_=(t,e,r)=>{const o=t.toArray(),a=mh(e),l=a.length,d=o.length,p=kl(d,l);let g=0,v=0,C=!1;for(;g<p;g++){const y=o[g],w=a[g];if(vh(r.get(y),w))C=!0;else if(!au(y,w))break}for(;g+v<p;v++){const y=o[d-v-1],w=a[l-v-1];if(vh(r.get(y),w))C=!0;else if(!au(y,w))break}return{equalityFactor:g+v,foundMappedChild:C}},l3=t=>{let e="",r=t._start;const o={};for(;r!==null;)r.deleted||(r.countable&&r.content instanceof vO?e+=r.content.str:r.content instanceof EO&&(o[r.content.key]=null)),r=r.right;return{str:e,nAttrs:o}},u3=(t,e,r)=>{r.set(t,e);const{nAttrs:o,str:a}=l3(t),l=e.map(v=>({insert:v.text,attributes:Object.assign({},o,Y_(v.marks))})),{insert:d,remove:p,index:g}=e3(a,l.map(v=>v.insert).join(""));t.delete(g,p),t.insert(g,d),t.applyDelta(l.map(v=>({retain:v.insert.length,attributes:v.attributes})))},Y_=t=>{const e={};return t.forEach(r=>{r.type.name!=="ychange"&&(e[r.type.name]=r.attrs)}),e},yg=(t,e,r,o)=>{if(e instanceof rs&&e.nodeName!==r.type.name)throw new Error("node name mismatch!");if(o.set(e,r),e instanceof rs){const y=e.getAttributes(),w=r.attrs;for(const k in w)w[k]!==null?y[k]!==w[k]&&k!=="ychange"&&e.setAttribute(k,w[k]):e.removeAttribute(k);for(const k in y)w[k]===void 0&&e.removeAttribute(k)}const a=mh(r),l=a.length,d=e.toArray(),p=d.length,g=kl(l,p);let v=0,C=0;for(;v<g;v++){const y=d[v],w=a[v];if(!vh(o.get(y),w))if(au(y,w))o.set(y,w);else break}for(;C+v+1<g;C++){const y=d[p-C-1],w=a[l-C-1];if(!vh(o.get(y),w))if(au(y,w))o.set(y,w);else break}t.transact(()=>{for(;p-v-C>0&&l-v-C>0;){const w=d[v],k=a[v],M=d[p-C-1],x=a[l-C-1];if(w instanceof Ts&&k instanceof Array)K_(w,k)||u3(w,k,o),v+=1;else{let V=w instanceof rs&&_g(w,k),Y=M instanceof rs&&_g(M,x);if(V&&Y){const H=W_(w,k,o),he=W_(M,x,o);H.foundMappedChild&&!he.foundMappedChild?Y=!1:!H.foundMappedChild&&he.foundMappedChild||H.equalityFactor<he.equalityFactor?V=!1:Y=!1}V?(yg(t,w,k,o),v+=1):Y?(yg(t,M,x,o),C+=1):(e.delete(v,1),e.insert(v,[Ig(k,o)]),v+=1)}}const y=p-v-C;if(y>0&&e.delete(v,y),v+C<l){const w=[];for(let k=v;k<l-C;k++)w.push(Ig(a[k],o));e.insert(v,w)}},Fr)},_g=(t,e)=>!(e instanceof Array)&&t.nodeName===e.type.name;let cu=null;const d3=()=>{const t=cu;cu=null,t.forEach((e,r)=>{const o=r.state.tr;e.forEach((a,l)=>{o.setMeta(l,a)}),r.dispatch(o)})},h3=(t,e,r)=>{cu||(cu=new Map,MO(0,d3)),TO(cu,t,RO).set(e,r)},Eh=(t,e,r)=>{if(t===0)return Pf(e,0);let o=e._first===null?null:e._first.content.type;for(;o!==null&&e!==o;){if(o.constructor===Ts){if(o._length>=t)return Pf(o,t);if(t-=o._length,o._item!==null&&o._item.next!==null)o=o._item.next.content.type;else{do o=o._item===null?null:o._item.parent,t--;while(o!==e&&o!==null&&o._item!==null&&o._item.next===null);o!==null&&o!==e&&(o=o._item===null?null:o._item.next.content.type)}}else{const a=(r.get(o)||{nodeSize:0}).nodeSize;if(o._first!==null&&t<a)o=o._first.content.type,t--;else{if(t===1&&o._length===0&&a>1)return new xf(o._item===null?null:o._item.id,o._item===null?Qf(o):null,null);if(t-=a,o._item!==null&&o._item.next!==null)o=o._item.next.content.type;else{if(t===0)return o=o._item===null?o:o._item.parent,new xf(o._item===null?null:o._item.id,o._item===null?Qf(o):null,null);do o=o._item.parent,t--;while(o!==e&&o._item.next===null);o!==e&&(o=o._item.next.content.type)}}}if(o===null)throw CO();if(t===0&&o.constructor!==Ts&&o!==e)return p3(o._item.parent,o._item)}return Pf(e,e._length)},p3=(t,e)=>{let r=null,o=null;return t._item===null?o=Qf(t):r=yO(t._item.id.client,t._item.id.clock),new xf(r,o,e.id)},lu=(t,e,r,o)=>{const a=_O(r,t);if(a===null||a.type!==e&&!SO(e,a.type._item))return null;let l=a.type,d=0;if(l.constructor===Ts)d=a.index;else if(l._item===null||!l._item.deleted){let p=l._first,g=0;for(;g<l._length&&g<a.index&&p!==null;){if(!p.deleted){const v=p.content.type;g++,v.constructor===Ts?d+=v._length:d+=o.get(v).nodeSize}p=p.right}d+=1}for(;l!==e&&l._item!==null;){const p=l._item.parent;if(p._item===null||!p._item.deleted){d+=1;let g=p._first;for(;g!==null;){const v=g.content.type;if(v===l)break;g.deleted||(v.constructor===Ts?d+=v._length:d+=o.get(v).nodeSize),g=g.right}}l=p}return d-1},f3=t=>{const e=document.createElement("span");e.classList.add("ProseMirror-yjs-cursor"),e.setAttribute("style",`border-color: ${t.color}`);const r=document.createElement("div");return r.setAttribute("style",`background-color: ${t.color}`),r.insertBefore(document.createTextNode(t.name),null),e.insertBefore(r,null),e},q_=(t,e,r)=>{const o=Fr.getState(t),a=o.doc,l=[];return o.snapshot!=null||o.prevSnapshot!=null||o.binding===null?Gt.create(t.doc,[]):(e.getStates().forEach((d,p)=>{if(p!==a.clientID&&d.cursor!=null){const g=d.user||{};g.color==null&&(g.color="#ffa500"),g.name==null&&(g.name=`User: ${p}`);let v=lu(a,o.type,bl(d.cursor.anchor),o.binding.mapping),C=lu(a,o.type,bl(d.cursor.head),o.binding.mapping);if(v!==null&&C!==null){const y=_C(t.doc.content.size-1,0);v=kl(v,y),C=kl(C,y),l.push(Qr.widget(C,()=>r(g),{key:p+"",side:10}));const w=kl(v,C),k=_C(v,C);l.push(Qr.inline(w,k,{style:`background-color: ${g.color}70`},{inclusiveEnd:!0,inclusiveStart:!1}))}}}),Gt.create(t.doc,l))},A3=(t,{cursorBuilder:e=f3,getSelection:r=a=>a.selection}={},o="cursor")=>new An({key:fh,state:{init(a,l){return q_(l,t,e)},apply(a,l,d,p){const g=Fr.getState(p),v=a.getMeta(fh);return g&&g.isChangeOrigin||v&&v.awarenessUpdated?q_(p,t,e):l.map(a.mapping,a.doc)}},props:{decorations:a=>fh.getState(a)},view:a=>{const l=()=>{a.docView&&h3(a,fh,{awarenessUpdated:!0})},d=()=>{const p=Fr.getState(a.state),g=t.getLocalState()||{};if(a.hasFocus()&&p.binding!==null){const v=r(a.state),C=Eh(v.anchor,p.type,p.binding.mapping),y=Eh(v.head,p.type,p.binding.mapping);(g.cursor==null||!SC(bl(g.cursor.anchor),C)||!SC(bl(g.cursor.head),y))&&t.setLocalStateField(o,{anchor:C,head:y})}else g.cursor!=null&&lu(p.doc,p.type,bl(g.cursor.anchor),p.binding.mapping)!==null&&t.setLocalStateField(o,null)};return t.on("change",l),a.dom.addEventListener("focusin",d),a.dom.addEventListener("focusout",d),{update:d,destroy:()=>{a.dom.removeEventListener("focusin",d),a.dom.removeEventListener("focusout",d),t.off("change",l),t.setLocalStateField(o,null)}}}}),g3=t=>{const e=Oa.getState(t).undoManager;if(e!=null)return e.undo(),!0},m3=t=>{const e=Oa.getState(t).undoManager;if(e!=null)return e.redo(),!0},v3=({protectedNodes:t=new Set(["paragraph"]),trackedOrigins:e=[]}={})=>new An({key:Oa,state:{init:(r,o)=>{const a=Fr.getState(o),l=new wO(a.type,{trackedOrigins:new Set([Fr].concat(e)),deleteFilter:d=>!(d instanceof yC)||!(d.content instanceof NO)||!(d.content.type instanceof OO||d.content.type instanceof rs&&t.has(d.content.type.nodeName))||d.content.type._length===0});return{undoManager:l,prevSel:null,hasUndoOps:l.undoStack.length>0,hasRedoOps:l.redoStack.length>0}},apply:(r,o,a,l)=>{const d=Fr.getState(l).binding,p=o.undoManager,g=p.undoStack.length>0,v=p.redoStack.length>0;return d?{undoManager:p,prevSel:Eg(d,a),hasUndoOps:g,hasRedoOps:v}:g!==o.hasUndoOps||v!==o.hasRedoOps?Object.assign({},o,{hasUndoOps:p.undoStack.length>0,hasRedoOps:p.redoStack.length>0}):o}},view:r=>{const o=Fr.getState(r.state),a=Oa.getState(r.state).undoManager;return a.on("stack-item-added",({stackItem:l})=>{const d=o.binding;d&&l.meta.set(d,Oa.getState(r.state).prevSel)}),a.on("stack-item-popped",({stackItem:l})=>{const d=o.binding;d&&(d.beforeTransactionSelection=l.meta.get(d)||d.beforeTransactionSelection)}),{destroy:()=>{a.destroy()}}}});rn.create({name:"collaboration",priority:1e3,addOptions(){return{document:null,field:"default",fragment:null}},onCreate(){this.editor.extensionManager.extensions.find(t=>t.name==="history")&&console.warn('[tiptap warn]: "@tiptap/extension-collaboration" comes with its own history support and is not compatible with "@tiptap/extension-history".')},addCommands(){return{undo:()=>({tr:t,state:e,dispatch:r})=>(t.setMeta("preventDispatch",!0),Oa.getState(e).undoManager.undoStack.length===0?!1:r?g3(e):!0),redo:()=>({tr:t,state:e,dispatch:r})=>(t.setMeta("preventDispatch",!0),Oa.getState(e).undoManager.redoStack.length===0?!1:r?m3(e):!0)}},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Mod-y":()=>this.editor.commands.redo(),"Shift-Mod-z":()=>this.editor.commands.redo()}},addProseMirrorPlugins(){const t=this.options.fragment?this.options.fragment:this.options.document.getXmlFragment(this.options.field);return[n3(t),v3()]}});const J_=t=>Array.from(t.entries()).map(([e,r])=>re({clientId:e},r.user)),z_=()=>null;rn.create({name:"collaborationCursor",addOptions(){return{provider:null,user:{name:null,color:null},render:t=>{const e=document.createElement("span");e.classList.add("collaboration-cursor__caret"),e.setAttribute("style",`border-color: ${t.color}`);const r=document.createElement("div");return r.classList.add("collaboration-cursor__label"),r.setAttribute("style",`background-color: ${t.color}`),r.insertBefore(document.createTextNode(t.name),null),e.insertBefore(r,null),e},onUpdate:z_}},onCreate(){this.options.onUpdate!==z_&&console.warn('[tiptap warn]: DEPRECATED: The "onUpdate" option is deprecated. Please use `editor.storage.collaborationCursor.users` instead. Read more: https://tiptap.dev/api/extensions/collaboration-cursor')},addStorage(){return{users:[]}},addCommands(){return{updateUser:t=>()=>(this.options.user=t,this.options.provider.awareness.setLocalStateField("user",this.options.user),!0),user:t=>({editor:e})=>(console.warn('[tiptap warn]: DEPRECATED: The "user" command is deprecated. Please use "updateUser" instead. Read more: https://tiptap.dev/api/extensions/collaboration-cursor'),e.commands.updateUser(t))}},addProseMirrorPlugins(){return[A3((()=>(this.options.provider.awareness.setLocalStateField("user",this.options.user),this.storage.users=J_(this.options.provider.awareness.states),this.options.provider.awareness.on("update",()=>{this.storage.users=J_(this.options.provider.awareness.states)}),this.options.provider.awareness))(),{cursorBuilder:this.options.render})]}});const E3=Ln.create({name:"taskList",addOptions(){return{HTMLAttributes:{}}},group:"block list",content:"taskItem+",parseHTML(){return[{tag:'ul[data-type="taskList"]',priority:51}]},renderHTML({HTMLAttributes:t}){return["ul",vn(this.options.HTMLAttributes,t,{"data-type":"taskList"}),0]},addCommands(){return{toggleTaskList:()=>({commands:t})=>t.toggleList("taskList","taskItem")}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}}),I3=/^\s*(\[([ |x])\])\s$/,C3=Ln.create({name:"taskItem",addOptions(){return{nested:!1,HTMLAttributes:{}}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:t=>t.getAttribute("data-checked")==="true",renderHTML:t=>({"data-checked":t.checked})}}},parseHTML(){return[{tag:'li[data-type="taskItem"]',priority:51}]},renderHTML({HTMLAttributes:t}){return["li",vn(this.options.HTMLAttributes,t,{"data-type":"taskItem"}),0]},addKeyboardShortcuts(){const t={Enter:()=>this.editor.commands.splitListItem("taskItem"),"Shift-Tab":()=>this.editor.commands.liftListItem("taskItem")};return this.options.nested?Hn(re({},t),{Tab:()=>this.editor.commands.sinkListItem("taskItem")}):t},addNodeView(){return({node:t,HTMLAttributes:e,getPos:r,editor:o})=>{const a=document.createElement("li"),l=document.createElement("label"),d=document.createElement("span"),p=document.createElement("input"),g=document.createElement("div");return l.contentEditable="false",p.type="checkbox",p.addEventListener("change",v=>{if(!o.isEditable){p.checked=!p.checked;return}const{checked:C}=v.target;o.isEditable&&typeof r=="function"&&o.chain().focus().command(({tr:y})=>(y.setNodeMarkup(r(),void 0,{checked:C}),!0)).run()}),Object.entries(this.options.HTMLAttributes).forEach(([v,C])=>{a.setAttribute(v,C)}),a.dataset.checked=t.attrs.checked,t.attrs.checked&&p.setAttribute("checked","checked"),l.append(p,d),a.append(l,g),Object.entries(e).forEach(([v,C])=>{a.setAttribute(v,C)}),{dom:a,contentDOM:g,update:v=>v.type!==this.type?!1:(a.dataset.checked=v.attrs.checked,v.attrs.checked?p.setAttribute("checked","checked"):p.removeAttribute("checked"),!0)}}},addInputRules(){return[th({find:I3,type:this.type,getAttributes:t=>({checked:t[t.length-1]==="x"})})]}}),y3=/(?:^|\s)((?:==)((?:[^~]+))(?:==))$/,_3=/(?:^|\s)((?:==)((?:[^~]+))(?:==))/g,S3=Ps.create({name:"highlight",addOptions(){return{multicolor:!1,HTMLAttributes:{}}},addAttributes(){return this.options.multicolor?{color:{default:null,parseHTML:t=>t.getAttribute("data-color")||t.style.backgroundColor,renderHTML:t=>t.color?{"data-color":t.color,style:`background-color: ${t.color}`}:{}}}:{}},parseHTML(){return[{tag:"mark"}]},renderHTML({HTMLAttributes:t}){return["mark",vn(this.options.HTMLAttributes,t),0]},addCommands(){return{setHighlight:t=>({commands:e})=>e.setMark("highlight",t),toggleHighlight:t=>({commands:e})=>e.toggleMark("highlight",t),unsetHighlight:()=>({commands:t})=>t.unsetMark("highlight")}},addKeyboardShortcuts(){return{"Mod-Shift-h":()=>this.editor.commands.toggleHighlight()}},addInputRules(){return[Ra({find:y3,type:this.type})]},addPasteRules(){return[wa({find:_3,type:this.type})]}});function X_(t,e,r){for(var o=0;;o++){if(o==t.childCount||o==e.childCount)return t.childCount==e.childCount?null:r;var a=t.child(o),l=e.child(o);if(a==l){r+=a.nodeSize;continue}if(!a.sameMarkup(l))return r;if(a.isText&&a.text!=l.text){for(var d=0;a.text[d]==l.text[d];d++)r++;return r}if(a.content.size||l.content.size){var p=X_(a.content,l.content,r+1);if(p!=null)return p}r+=a.nodeSize}}function $_(t,e,r,o){for(var a=t.childCount,l=e.childCount;;){if(a==0||l==0)return a==l?null:{a:r,b:o};var d=t.child(--a),p=e.child(--l),g=d.nodeSize;if(d==p){r-=g,o-=g;continue}if(!d.sameMarkup(p))return{a:r,b:o};if(d.isText&&d.text!=p.text){for(var v=0,C=Math.min(d.text.length,p.text.length);v<C&&d.text[d.text.length-v-1]==p.text[p.text.length-v-1];)v++,r--,o--;return{a:r,b:o}}if(d.content.size||p.content.size){var y=$_(d.content,p.content,r-1,o-1);if(y)return y}r-=g,o-=g}}var ge=function(e,r){if(this.content=e,this.size=r||0,r==null)for(var o=0;o<e.length;o++)this.size+=e[o].nodeSize},Ih={firstChild:{configurable:!0},lastChild:{configurable:!0},childCount:{configurable:!0}};ge.prototype.nodesBetween=function(e,r,o,a,l){a===void 0&&(a=0);for(var d=0,p=0;p<r;d++){var g=this.content[d],v=p+g.nodeSize;if(v>e&&o(g,a+p,l,d)!==!1&&g.content.size){var C=p+1;g.nodesBetween(Math.max(0,e-C),Math.min(g.content.size,r-C),o,a+C)}p=v}};ge.prototype.descendants=function(e){this.nodesBetween(0,this.size,e)};ge.prototype.textBetween=function(e,r,o,a){var l="",d=!0;return this.nodesBetween(e,r,function(p,g){p.isText?(l+=p.text.slice(Math.max(e,g)-g,r-g),d=!o):p.isLeaf&&a?(l+=typeof a=="function"?a(p):a,d=!o):!d&&p.isBlock&&(l+=o,d=!0)},0),l};ge.prototype.append=function(e){if(!e.size)return this;if(!this.size)return e;var r=this.lastChild,o=e.firstChild,a=this.content.slice(),l=0;for(r.isText&&r.sameMarkup(o)&&(a[a.length-1]=r.withText(r.text+o.text),l=1);l<e.content.length;l++)a.push(e.content[l]);return new ge(a,this.size+e.size)};ge.prototype.cut=function(e,r){if(r==null&&(r=this.size),e==0&&r==this.size)return this;var o=[],a=0;if(r>e)for(var l=0,d=0;d<r;l++){var p=this.content[l],g=d+p.nodeSize;g>e&&((d<e||g>r)&&(p.isText?p=p.cut(Math.max(0,e-d),Math.min(p.text.length,r-d)):p=p.cut(Math.max(0,e-d-1),Math.min(p.content.size,r-d-1))),o.push(p),a+=p.nodeSize),d=g}return new ge(o,a)};ge.prototype.cutByIndex=function(e,r){return e==r?ge.empty:e==0&&r==this.content.length?this:new ge(this.content.slice(e,r))};ge.prototype.replaceChild=function(e,r){var o=this.content[e];if(o==r)return this;var a=this.content.slice(),l=this.size+r.nodeSize-o.nodeSize;return a[e]=r,new ge(a,l)};ge.prototype.addToStart=function(e){return new ge([e].concat(this.content),this.size+e.nodeSize)};ge.prototype.addToEnd=function(e){return new ge(this.content.concat(e),this.size+e.nodeSize)};ge.prototype.eq=function(e){if(this.content.length!=e.content.length)return!1;for(var r=0;r<this.content.length;r++)if(!this.content[r].eq(e.content[r]))return!1;return!0};Ih.firstChild.get=function(){return this.content.length?this.content[0]:null};Ih.lastChild.get=function(){return this.content.length?this.content[this.content.length-1]:null};Ih.childCount.get=function(){return this.content.length};ge.prototype.child=function(e){var r=this.content[e];if(!r)throw new RangeError("Index "+e+" out of range for "+this);return r};ge.prototype.maybeChild=function(e){return this.content[e]};ge.prototype.forEach=function(e){for(var r=0,o=0;r<this.content.length;r++){var a=this.content[r];e(a,o,r),o+=a.nodeSize}};ge.prototype.findDiffStart=function(e,r){return r===void 0&&(r=0),X_(this,e,r)};ge.prototype.findDiffEnd=function(e,r,o){return r===void 0&&(r=this.size),o===void 0&&(o=e.size),$_(this,e,r,o)};ge.prototype.findIndex=function(e,r){if(r===void 0&&(r=-1),e==0)return Ch(0,e);if(e==this.size)return Ch(this.content.length,e);if(e>this.size||e<0)throw new RangeError("Position "+e+" outside of fragment ("+this+")");for(var o=0,a=0;;o++){var l=this.child(o),d=a+l.nodeSize;if(d>=e)return d==e||r>0?Ch(o+1,d):Ch(o,a);a=d}};ge.prototype.toString=function(){return"<"+this.toStringInner()+">"};ge.prototype.toStringInner=function(){return this.content.join(", ")};ge.prototype.toJSON=function(){return this.content.length?this.content.map(function(e){return e.toJSON()}):null};ge.fromJSON=function(e,r){if(!r)return ge.empty;if(!Array.isArray(r))throw new RangeError("Invalid input for Fragment.fromJSON");return new ge(r.map(e.nodeFromJSON))};ge.fromArray=function(e){if(!e.length)return ge.empty;for(var r,o=0,a=0;a<e.length;a++){var l=e[a];o+=l.nodeSize,a&&l.isText&&e[a-1].sameMarkup(l)?(r||(r=e.slice(0,a)),r[r.length-1]=l.withText(r[r.length-1].text+l.text)):r&&r.push(l)}return new ge(r||e,o)};ge.from=function(e){if(!e)return ge.empty;if(e instanceof ge)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new ge([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))};Object.defineProperties(ge.prototype,Ih);var Sg={index:0,offset:0};function Ch(t,e){return Sg.index=t,Sg.offset=e,Sg}ge.empty=new ge([],0);function yh(t,e){if(t===e)return!0;if(!(t&&typeof t=="object")||!(e&&typeof e=="object"))return!1;var r=Array.isArray(t);if(Array.isArray(e)!=r)return!1;if(r){if(t.length!=e.length)return!1;for(var o=0;o<t.length;o++)if(!yh(t[o],e[o]))return!1}else{for(var a in t)if(!(a in e)||!yh(t[a],e[a]))return!1;for(var l in e)if(!(l in t))return!1}return!0}var Bt=function(e,r){this.type=e,this.attrs=r};Bt.prototype.addToSet=function(e){for(var r,o=!1,a=0;a<e.length;a++){var l=e[a];if(this.eq(l))return e;if(this.type.excludes(l.type))r||(r=e.slice(0,a));else{if(l.type.excludes(this.type))return e;!o&&l.type.rank>this.type.rank&&(r||(r=e.slice(0,a)),r.push(this),o=!0),r&&r.push(l)}}return r||(r=e.slice()),o||r.push(this),r};Bt.prototype.removeFromSet=function(e){for(var r=0;r<e.length;r++)if(this.eq(e[r]))return e.slice(0,r).concat(e.slice(r+1));return e};Bt.prototype.isInSet=function(e){for(var r=0;r<e.length;r++)if(this.eq(e[r]))return!0;return!1};Bt.prototype.eq=function(e){return this==e||this.type==e.type&&yh(this.attrs,e.attrs)};Bt.prototype.toJSON=function(){var e={type:this.type.name};for(var r in this.attrs){e.attrs=this.attrs;break}return e};Bt.fromJSON=function(e,r){if(!r)throw new RangeError("Invalid input for Mark.fromJSON");var o=e.marks[r.type];if(!o)throw new RangeError("There is no mark type "+r.type+" in this schema");return o.create(r.attrs)};Bt.sameSet=function(e,r){if(e==r)return!0;if(e.length!=r.length)return!1;for(var o=0;o<e.length;o++)if(!e[o].eq(r[o]))return!1;return!0};Bt.setFrom=function(e){if(!e||e.length==0)return Bt.none;if(e instanceof Bt)return[e];var r=e.slice();return r.sort(function(o,a){return o.type.rank-a.type.rank}),r};Bt.none=[];function Uo(t){var e=Error.call(this,t);return e.__proto__=Uo.prototype,e}Uo.prototype=Object.create(Error.prototype);Uo.prototype.constructor=Uo;Uo.prototype.name="ReplaceError";var Ve=function(e,r,o){this.content=e,this.openStart=r,this.openEnd=o},Z_={size:{configurable:!0}};Z_.size.get=function(){return this.content.size-this.openStart-this.openEnd};Ve.prototype.insertAt=function(e,r){var o=tS(this.content,e+this.openStart,r,null);return o&&new Ve(o,this.openStart,this.openEnd)};Ve.prototype.removeBetween=function(e,r){return new Ve(eS(this.content,e+this.openStart,r+this.openStart),this.openStart,this.openEnd)};Ve.prototype.eq=function(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd};Ve.prototype.toString=function(){return this.content+"("+this.openStart+","+this.openEnd+")"};Ve.prototype.toJSON=function(){if(!this.content.size)return null;var e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e};Ve.fromJSON=function(e,r){if(!r)return Ve.empty;var o=r.openStart||0,a=r.openEnd||0;if(typeof o!="number"||typeof a!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new Ve(ge.fromJSON(e,r.content),o,a)};Ve.maxOpen=function(e,r){r===void 0&&(r=!0);for(var o=0,a=0,l=e.firstChild;l&&!l.isLeaf&&(r||!l.type.spec.isolating);l=l.firstChild)o++;for(var d=e.lastChild;d&&!d.isLeaf&&(r||!d.type.spec.isolating);d=d.lastChild)a++;return new Ve(e,o,a)};Object.defineProperties(Ve.prototype,Z_);function eS(t,e,r){var o=t.findIndex(e),a=o.index,l=o.offset,d=t.maybeChild(a),p=t.findIndex(r),g=p.index,v=p.offset;if(l==e||d.isText){if(v!=r&&!t.child(g).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(r))}if(a!=g)throw new RangeError("Removing non-flat range");return t.replaceChild(a,d.copy(eS(d.content,e-l-1,r-l-1)))}function tS(t,e,r,o){var a=t.findIndex(e),l=a.index,d=a.offset,p=t.maybeChild(l);if(d==e||p.isText)return o&&!o.canReplace(l,l,r)?null:t.cut(0,e).append(r).append(t.cut(e));var g=tS(p.content,e-d-1,r);return g&&t.replaceChild(l,p.copy(g))}Ve.empty=new Ve(ge.empty,0,0);function T3(t,e,r){if(r.openStart>t.depth)throw new Uo("Inserted content deeper than insertion position");if(t.depth-r.openStart!=e.depth-r.openEnd)throw new Uo("Inconsistent open depths");return rS(t,e,r,0)}function rS(t,e,r,o){var a=t.index(o),l=t.node(o);if(a==e.index(o)&&o<t.depth-r.openStart){var d=rS(t,e,r,o+1);return l.copy(l.content.replaceChild(a,d))}else if(r.content.size)if(!r.openStart&&!r.openEnd&&t.depth==o&&e.depth==o){var p=t.parent,g=p.content;return ba(p,g.cut(0,t.parentOffset).append(r.content).append(g.cut(e.parentOffset)))}else{var v=R3(r,t),C=v.start,y=v.end;return ba(l,iS(t,C,y,e,o))}else return ba(l,_h(t,e,o))}function nS(t,e){if(!e.type.compatibleContent(t.type))throw new Uo("Cannot join "+e.type.name+" onto "+t.type.name)}function Tg(t,e,r){var o=t.node(r);return nS(o,e.node(r)),o}function ka(t,e){var r=e.length-1;r>=0&&t.isText&&t.sameMarkup(e[r])?e[r]=t.withText(e[r].text+t.text):e.push(t)}function uu(t,e,r,o){var a=(e||t).node(r),l=0,d=e?e.index(r):a.childCount;t&&(l=t.index(r),t.depth>r?l++:t.textOffset&&(ka(t.nodeAfter,o),l++));for(var p=l;p<d;p++)ka(a.child(p),o);e&&e.depth==r&&e.textOffset&&ka(e.nodeBefore,o)}function ba(t,e){if(!t.type.validContent(e))throw new Uo("Invalid content for node "+t.type.name);return t.copy(e)}function iS(t,e,r,o,a){var l=t.depth>a&&Tg(t,e,a+1),d=o.depth>a&&Tg(r,o,a+1),p=[];return uu(null,t,a,p),l&&d&&e.index(a)==r.index(a)?(nS(l,d),ka(ba(l,iS(t,e,r,o,a+1)),p)):(l&&ka(ba(l,_h(t,e,a+1)),p),uu(e,r,a,p),d&&ka(ba(d,_h(r,o,a+1)),p)),uu(o,null,a,p),new ge(p)}function _h(t,e,r){var o=[];if(uu(null,t,r,o),t.depth>r){var a=Tg(t,e,r+1);ka(ba(a,_h(t,e,r+1)),o)}return uu(e,null,r,o),new ge(o)}function R3(t,e){for(var r=e.depth-t.openStart,o=e.node(r),a=o.copy(t.content),l=r-1;l>=0;l--)a=e.node(l).copy(ge.from(a));return{start:a.resolveNoCache(t.openStart+r),end:a.resolveNoCache(a.content.size-t.openEnd-r)}}var ar=function(e,r,o){this.pos=e,this.path=r,this.depth=r.length/3-1,this.parentOffset=o},Pc={parent:{configurable:!0},doc:{configurable:!0},textOffset:{configurable:!0},nodeAfter:{configurable:!0},nodeBefore:{configurable:!0}};ar.prototype.resolveDepth=function(e){return e==null?this.depth:e<0?this.depth+e:e};Pc.parent.get=function(){return this.node(this.depth)};Pc.doc.get=function(){return this.node(0)};ar.prototype.node=function(e){return this.path[this.resolveDepth(e)*3]};ar.prototype.index=function(e){return this.path[this.resolveDepth(e)*3+1]};ar.prototype.indexAfter=function(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)};ar.prototype.start=function(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1};ar.prototype.end=function(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size};ar.prototype.before=function(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]};ar.prototype.after=function(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize};Pc.textOffset.get=function(){return this.pos-this.path[this.path.length-1]};Pc.nodeAfter.get=function(){var t=this.parent,e=this.index(this.depth);if(e==t.childCount)return null;var r=this.pos-this.path[this.path.length-1],o=t.child(e);return r?t.child(e).cut(r):o};Pc.nodeBefore.get=function(){var t=this.index(this.depth),e=this.pos-this.path[this.path.length-1];return e?this.parent.child(t).cut(0,e):t==0?null:this.parent.child(t-1)};ar.prototype.posAtIndex=function(e,r){r=this.resolveDepth(r);for(var o=this.path[r*3],a=r==0?0:this.path[r*3-1]+1,l=0;l<e;l++)a+=o.child(l).nodeSize;return a};ar.prototype.marks=function(){var e=this.parent,r=this.index();if(e.content.size==0)return Bt.none;if(this.textOffset)return e.child(r).marks;var o=e.maybeChild(r-1),a=e.maybeChild(r);if(!o){var l=o;o=a,a=l}for(var d=o.marks,p=0;p<d.length;p++)d[p].type.spec.inclusive===!1&&(!a||!d[p].isInSet(a.marks))&&(d=d[p--].removeFromSet(d));return d};ar.prototype.marksAcross=function(e){var r=this.parent.maybeChild(this.index());if(!r||!r.isInline)return null;for(var o=r.marks,a=e.parent.maybeChild(e.index()),l=0;l<o.length;l++)o[l].type.spec.inclusive===!1&&(!a||!o[l].isInSet(a.marks))&&(o=o[l--].removeFromSet(o));return o};ar.prototype.sharedDepth=function(e){for(var r=this.depth;r>0;r--)if(this.start(r)<=e&&this.end(r)>=e)return r;return 0};ar.prototype.blockRange=function(e,r){if(e===void 0&&(e=this),e.pos<this.pos)return e.blockRange(this);for(var o=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);o>=0;o--)if(e.pos<=this.end(o)&&(!r||r(this.node(o))))return new oS(this,e,o)};ar.prototype.sameParent=function(e){return this.pos-this.parentOffset==e.pos-e.parentOffset};ar.prototype.max=function(e){return e.pos>this.pos?e:this};ar.prototype.min=function(e){return e.pos<this.pos?e:this};ar.prototype.toString=function(){for(var e="",r=1;r<=this.depth;r++)e+=(e?"/":"")+this.node(r).type.name+"_"+this.index(r-1);return e+":"+this.parentOffset};ar.resolve=function(e,r){if(!(r>=0&&r<=e.content.size))throw new RangeError("Position "+r+" out of range");for(var o=[],a=0,l=r,d=e;;){var p=d.content.findIndex(l),g=p.index,v=p.offset,C=l-v;if(o.push(d,g,a+v),!C||(d=d.child(g),d.isText))break;l=C-1,a+=v+1}return new ar(r,o,l)};ar.resolveCached=function(e,r){for(var o=0;o<Rg.length;o++){var a=Rg[o];if(a.pos==r&&a.doc==e)return a}var l=Rg[wg]=ar.resolve(e,r);return wg=(wg+1)%w3,l};Object.defineProperties(ar.prototype,Pc);var Rg=[],wg=0,w3=12,oS=function(e,r,o){this.$from=e,this.$to=r,this.depth=o},xc={start:{configurable:!0},end:{configurable:!0},parent:{configurable:!0},startIndex:{configurable:!0},endIndex:{configurable:!0}};xc.start.get=function(){return this.$from.before(this.depth+1)};xc.end.get=function(){return this.$to.after(this.depth+1)};xc.parent.get=function(){return this.$from.node(this.depth)};xc.startIndex.get=function(){return this.$from.index(this.depth)};xc.endIndex.get=function(){return this.$to.indexAfter(this.depth)};Object.defineProperties(oS.prototype,xc);var N3=Object.create(null),Mt=function(e,r,o,a){this.type=e,this.attrs=r,this.content=o||ge.empty,this.marks=a||Bt.none},wi={nodeSize:{configurable:!0},childCount:{configurable:!0},textContent:{configurable:!0},firstChild:{configurable:!0},lastChild:{configurable:!0},isBlock:{configurable:!0},isTextblock:{configurable:!0},inlineContent:{configurable:!0},isInline:{configurable:!0},isText:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};wi.nodeSize.get=function(){return this.isLeaf?1:2+this.content.size};wi.childCount.get=function(){return this.content.childCount};Mt.prototype.child=function(e){return this.content.child(e)};Mt.prototype.maybeChild=function(e){return this.content.maybeChild(e)};Mt.prototype.forEach=function(e){this.content.forEach(e)};Mt.prototype.nodesBetween=function(e,r,o,a){a===void 0&&(a=0),this.content.nodesBetween(e,r,o,a,this)};Mt.prototype.descendants=function(e){this.nodesBetween(0,this.content.size,e)};wi.textContent.get=function(){return this.textBetween(0,this.content.size,"")};Mt.prototype.textBetween=function(e,r,o,a){return this.content.textBetween(e,r,o,a)};wi.firstChild.get=function(){return this.content.firstChild};wi.lastChild.get=function(){return this.content.lastChild};Mt.prototype.eq=function(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)};Mt.prototype.sameMarkup=function(e){return this.hasMarkup(e.type,e.attrs,e.marks)};Mt.prototype.hasMarkup=function(e,r,o){return this.type==e&&yh(this.attrs,r||e.defaultAttrs||N3)&&Bt.sameSet(this.marks,o||Bt.none)};Mt.prototype.copy=function(e){return e===void 0&&(e=null),e==this.content?this:new this.constructor(this.type,this.attrs,e,this.marks)};Mt.prototype.mark=function(e){return e==this.marks?this:new this.constructor(this.type,this.attrs,this.content,e)};Mt.prototype.cut=function(e,r){return e==0&&r==this.content.size?this:this.copy(this.content.cut(e,r))};Mt.prototype.slice=function(e,r,o){if(r===void 0&&(r=this.content.size),o===void 0&&(o=!1),e==r)return Ve.empty;var a=this.resolve(e),l=this.resolve(r),d=o?0:a.sharedDepth(r),p=a.start(d),g=a.node(d),v=g.content.cut(a.pos-p,l.pos-p);return new Ve(v,a.depth-d,l.depth-d)};Mt.prototype.replace=function(e,r,o){return T3(this.resolve(e),this.resolve(r),o)};Mt.prototype.nodeAt=function(e){for(var r=this;;){var o=r.content.findIndex(e),a=o.index,l=o.offset;if(r=r.maybeChild(a),!r)return null;if(l==e||r.isText)return r;e-=l+1}};Mt.prototype.childAfter=function(e){var r=this.content.findIndex(e),o=r.index,a=r.offset;return{node:this.content.maybeChild(o),index:o,offset:a}};Mt.prototype.childBefore=function(e){if(e==0)return{node:null,index:0,offset:0};var r=this.content.findIndex(e),o=r.index,a=r.offset;if(a<e)return{node:this.content.child(o),index:o,offset:a};var l=this.content.child(o-1);return{node:l,index:o-1,offset:a-l.nodeSize}};Mt.prototype.resolve=function(e){return ar.resolveCached(this,e)};Mt.prototype.resolveNoCache=function(e){return ar.resolve(this,e)};Mt.prototype.rangeHasMark=function(e,r,o){var a=!1;return r>e&&this.nodesBetween(e,r,function(l){return o.isInSet(l.marks)&&(a=!0),!a}),a};wi.isBlock.get=function(){return this.type.isBlock};wi.isTextblock.get=function(){return this.type.isTextblock};wi.inlineContent.get=function(){return this.type.inlineContent};wi.isInline.get=function(){return this.type.isInline};wi.isText.get=function(){return this.type.isText};wi.isLeaf.get=function(){return this.type.isLeaf};wi.isAtom.get=function(){return this.type.isAtom};Mt.prototype.toString=function(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);var e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),O3(this.marks,e)};Mt.prototype.contentMatchAt=function(e){var r=this.type.contentMatch.matchFragment(this.content,0,e);if(!r)throw new Error("Called contentMatchAt on a node with invalid content");return r};Mt.prototype.canReplace=function(e,r,o,a,l){o===void 0&&(o=ge.empty),a===void 0&&(a=0),l===void 0&&(l=o.childCount);var d=this.contentMatchAt(e).matchFragment(o,a,l),p=d&&d.matchFragment(this.content,r);if(!p||!p.validEnd)return!1;for(var g=a;g<l;g++)if(!this.type.allowsMarks(o.child(g).marks))return!1;return!0};Mt.prototype.canReplaceWith=function(e,r,o,a){if(a&&!this.type.allowsMarks(a))return!1;var l=this.contentMatchAt(e).matchType(o),d=l&&l.matchFragment(this.content,r);return d?d.validEnd:!1};Mt.prototype.canAppend=function(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)};Mt.prototype.check=function(){if(!this.type.validContent(this.content))throw new RangeError("Invalid content for node "+this.type.name+": "+this.content.toString().slice(0,50));for(var e=Bt.none,r=0;r<this.marks.length;r++)e=this.marks[r].addToSet(e);if(!Bt.sameSet(e,this.marks))throw new RangeError("Invalid collection of marks for node "+this.type.name+": "+this.marks.map(function(o){return o.type.name}));this.content.forEach(function(o){return o.check()})};Mt.prototype.toJSON=function(){var e={type:this.type.name};for(var r in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(function(o){return o.toJSON()})),e};Mt.fromJSON=function(e,r){if(!r)throw new RangeError("Invalid input for Node.fromJSON");var o=null;if(r.marks){if(!Array.isArray(r.marks))throw new RangeError("Invalid mark data for Node.fromJSON");o=r.marks.map(e.markFromJSON)}if(r.type=="text"){if(typeof r.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(r.text,o)}var a=ge.fromJSON(e,r.content);return e.nodeType(r.type).create(r.attrs,a,o)};Object.defineProperties(Mt.prototype,wi);function O3(t,e){for(var r=t.length-1;r>=0;r--)e=t[r].type.name+"("+e+")";return e}var qn=function(e){this.validEnd=e,this.next=[],this.wrapCache=[]},Sh={inlineContent:{configurable:!0},defaultType:{configurable:!0},edgeCount:{configurable:!0}};qn.parse=function(e,r){var o=new Th(e,r);if(o.next==null)return qn.empty;var a=aS(o);o.next&&o.err("Unexpected trailing text");var l=P3(L3(a));return x3(l,o),l};qn.prototype.matchType=function(e){for(var r=0;r<this.next.length;r+=2)if(this.next[r]==e)return this.next[r+1];return null};qn.prototype.matchFragment=function(e,r,o){r===void 0&&(r=0),o===void 0&&(o=e.childCount);for(var a=this,l=r;a&&l<o;l++)a=a.matchType(e.child(l).type);return a};Sh.inlineContent.get=function(){var t=this.next[0];return t?t.isInline:!1};Sh.defaultType.get=function(){for(var t=0;t<this.next.length;t+=2){var e=this.next[t];if(!(e.isText||e.hasRequiredAttrs()))return e}};qn.prototype.compatible=function(e){for(var r=0;r<this.next.length;r+=2)for(var o=0;o<e.next.length;o+=2)if(this.next[r]==e.next[o])return!0;return!1};qn.prototype.fillBefore=function(e,r,o){r===void 0&&(r=!1),o===void 0&&(o=0);var a=[this];function l(d,p){var g=d.matchFragment(e,o);if(g&&(!r||g.validEnd))return ge.from(p.map(function(k){return k.createAndFill()}));for(var v=0;v<d.next.length;v+=2){var C=d.next[v],y=d.next[v+1];if(!(C.isText||C.hasRequiredAttrs())&&a.indexOf(y)==-1){a.push(y);var w=l(y,p.concat(C));if(w)return w}}}return l(this,[])};qn.prototype.findWrapping=function(e){for(var r=0;r<this.wrapCache.length;r+=2)if(this.wrapCache[r]==e)return this.wrapCache[r+1];var o=this.computeWrapping(e);return this.wrapCache.push(e,o),o};qn.prototype.computeWrapping=function(e){for(var r=Object.create(null),o=[{match:this,type:null,via:null}];o.length;){var a=o.shift(),l=a.match;if(l.matchType(e)){for(var d=[],p=a;p.type;p=p.via)d.push(p.type);return d.reverse()}for(var g=0;g<l.next.length;g+=2){var v=l.next[g];!v.isLeaf&&!v.hasRequiredAttrs()&&!(v.name in r)&&(!a.type||l.next[g+1].validEnd)&&(o.push({match:v.contentMatch,type:v,via:a}),r[v.name]=!0)}}};Sh.edgeCount.get=function(){return this.next.length>>1};qn.prototype.edge=function(e){var r=e<<1;if(r>=this.next.length)throw new RangeError("There's no "+e+"th edge in this content match");return{type:this.next[r],next:this.next[r+1]}};qn.prototype.toString=function(){var e=[];function r(o){e.push(o);for(var a=1;a<o.next.length;a+=2)e.indexOf(o.next[a])==-1&&r(o.next[a])}return r(this),e.map(function(o,a){for(var l=a+(o.validEnd?"*":" ")+" ",d=0;d<o.next.length;d+=2)l+=(d?", ":"")+o.next[d].name+"->"+e.indexOf(o.next[d+1]);return l}).join(`
`)};Object.defineProperties(qn.prototype,Sh);qn.empty=new qn(!0);var Th=function(e,r){this.string=e,this.nodeTypes=r,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()},sS={next:{configurable:!0}};sS.next.get=function(){return this.tokens[this.pos]};Th.prototype.eat=function(e){return this.next==e&&(this.pos++||!0)};Th.prototype.err=function(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")};Object.defineProperties(Th.prototype,sS);function aS(t){var e=[];do e.push(k3(t));while(t.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function k3(t){var e=[];do e.push(b3(t));while(t.next&&t.next!=")"&&t.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function b3(t){for(var e=M3(t);;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else if(t.eat("{"))e=D3(t,e);else break;return e}function cS(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");var e=Number(t.next);return t.pos++,e}function D3(t,e){var r=cS(t),o=r;return t.eat(",")&&(t.next!="}"?o=cS(t):o=-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:r,max:o,expr:e}}function B3(t,e){var r=t.nodeTypes,o=r[e];if(o)return[o];var a=[];for(var l in r){var d=r[l];d.groups.indexOf(e)>-1&&a.push(d)}return a.length==0&&t.err("No node type or group '"+e+"' found"),a}function M3(t){if(t.eat("(")){var e=aS(t);return t.eat(")")||t.err("Missing closing paren"),e}else if(/\W/.test(t.next))t.err("Unexpected token '"+t.next+"'");else{var r=B3(t,t.next).map(function(o){return t.inline==null?t.inline=o.isInline:t.inline!=o.isInline&&t.err("Mixing inline and block content"),{type:"name",value:o}});return t.pos++,r.length==1?r[0]:{type:"choice",exprs:r}}}function L3(t){var e=[[]];return a(l(t,0),r()),e;function r(){return e.push([])-1}function o(d,p,g){var v={term:g,to:p};return e[d].push(v),v}function a(d,p){d.forEach(function(g){return g.to=p})}function l(d,p){if(d.type=="choice")return d.exprs.reduce(function(Y,H){return Y.concat(l(H,p))},[]);if(d.type=="seq")for(var g=0;;g++){var v=l(d.exprs[g],p);if(g==d.exprs.length-1)return v;a(v,p=r())}else if(d.type=="star"){var C=r();return o(p,C),a(l(d.expr,C),C),[o(C)]}else if(d.type=="plus"){var y=r();return a(l(d.expr,p),y),a(l(d.expr,y),y),[o(y)]}else{if(d.type=="opt")return[o(p)].concat(l(d.expr,p));if(d.type=="range"){for(var w=p,k=0;k<d.min;k++){var M=r();a(l(d.expr,w),M),w=M}if(d.max==-1)a(l(d.expr,w),w);else for(var x=d.min;x<d.max;x++){var V=r();o(w,V),a(l(d.expr,w),V),w=V}return[o(w)]}else if(d.type=="name")return[o(p,null,d.value)]}}}function lS(t,e){return e-t}function uS(t,e){var r=[];return o(e),r.sort(lS);function o(a){var l=t[a];if(l.length==1&&!l[0].term)return o(l[0].to);r.push(a);for(var d=0;d<l.length;d++){var p=l[d],g=p.term,v=p.to;!g&&r.indexOf(v)==-1&&o(v)}}}function P3(t){var e=Object.create(null);return r(uS(t,0));function r(o){var a=[];o.forEach(function(g){t[g].forEach(function(v){var C=v.term,y=v.to;if(!!C){var w=a.indexOf(C),k=w>-1&&a[w+1];uS(t,y).forEach(function(M){k||a.push(C,k=[]),k.indexOf(M)==-1&&k.push(M)})}})});for(var l=e[o.join(",")]=new qn(o.indexOf(t.length-1)>-1),d=0;d<a.length;d+=2){var p=a[d+1].sort(lS);l.next.push(a[d],e[p.join(",")]||r(p))}return l}}function x3(t,e){for(var r=0,o=[t];r<o.length;r++){for(var a=o[r],l=!a.validEnd,d=[],p=0;p<a.next.length;p+=2){var g=a.next[p],v=a.next[p+1];d.push(g.name),l&&!(g.isText||g.hasRequiredAttrs())&&(l=!1),o.indexOf(v)==-1&&o.push(v)}l&&e.err("Only non-generatable nodes ("+d.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function dS(t){var e=Object.create(null);for(var r in t){var o=t[r];if(!o.hasDefault)return null;e[r]=o.default}return e}function hS(t,e){var r=Object.create(null);for(var o in t){var a=e&&e[o];if(a===void 0){var l=t[o];if(l.hasDefault)a=l.default;else throw new RangeError("No value supplied for attribute "+o)}r[o]=a}return r}function pS(t){var e=Object.create(null);if(t)for(var r in t)e[r]=new fS(t[r]);return e}var Ni=function(e,r,o){this.name=e,this.schema=r,this.spec=o,this.groups=o.group?o.group.split(" "):[],this.attrs=pS(o.attrs),this.defaultAttrs=dS(this.attrs),this.contentMatch=null,this.markSet=null,this.inlineContent=null,this.isBlock=!(o.inline||e=="text"),this.isText=e=="text"},du={isInline:{configurable:!0},isTextblock:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};du.isInline.get=function(){return!this.isBlock};du.isTextblock.get=function(){return this.isBlock&&this.inlineContent};du.isLeaf.get=function(){return this.contentMatch==qn.empty};du.isAtom.get=function(){return this.isLeaf||this.spec.atom};Ni.prototype.hasRequiredAttrs=function(){for(var e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1};Ni.prototype.compatibleContent=function(e){return this==e||this.contentMatch.compatible(e.contentMatch)};Ni.prototype.computeAttrs=function(e){return!e&&this.defaultAttrs?this.defaultAttrs:hS(this.attrs,e)};Ni.prototype.create=function(e,r,o){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Mt(this,this.computeAttrs(e),ge.from(r),Bt.setFrom(o))};Ni.prototype.createChecked=function(e,r,o){if(r=ge.from(r),!this.validContent(r))throw new RangeError("Invalid content for node "+this.name);return new Mt(this,this.computeAttrs(e),r,Bt.setFrom(o))};Ni.prototype.createAndFill=function(e,r,o){if(e=this.computeAttrs(e),r=ge.from(r),r.size){var a=this.contentMatch.fillBefore(r);if(!a)return null;r=a.append(r)}var l=this.contentMatch.matchFragment(r).fillBefore(ge.empty,!0);return l?new Mt(this,e,r.append(l),Bt.setFrom(o)):null};Ni.prototype.validContent=function(e){var r=this.contentMatch.matchFragment(e);if(!r||!r.validEnd)return!1;for(var o=0;o<e.childCount;o++)if(!this.allowsMarks(e.child(o).marks))return!1;return!0};Ni.prototype.allowsMarkType=function(e){return this.markSet==null||this.markSet.indexOf(e)>-1};Ni.prototype.allowsMarks=function(e){if(this.markSet==null)return!0;for(var r=0;r<e.length;r++)if(!this.allowsMarkType(e[r].type))return!1;return!0};Ni.prototype.allowedMarks=function(e){if(this.markSet==null)return e;for(var r,o=0;o<e.length;o++)this.allowsMarkType(e[o].type)?r&&r.push(e[o]):r||(r=e.slice(0,o));return r?r.length?r:Bt.empty:e};Ni.compile=function(e,r){var o=Object.create(null);e.forEach(function(d,p){return o[d]=new Ni(d,r,p)});var a=r.spec.topNode||"doc";if(!o[a])throw new RangeError("Schema is missing its top node type ('"+a+"')");if(!o.text)throw new RangeError("Every schema needs a 'text' type");for(var l in o.text.attrs)throw new RangeError("The text node type should not have attributes");return o};Object.defineProperties(Ni.prototype,du);var fS=function(e){this.hasDefault=Object.prototype.hasOwnProperty.call(e,"default"),this.default=e.default},AS={isRequired:{configurable:!0}};AS.isRequired.get=function(){return!this.hasDefault};Object.defineProperties(fS.prototype,AS);var Da=function(e,r,o,a){this.name=e,this.schema=o,this.spec=a,this.attrs=pS(a.attrs),this.rank=r,this.excluded=null;var l=dS(this.attrs);this.instance=l&&new Bt(this,l)};Da.prototype.create=function(e){return!e&&this.instance?this.instance:new Bt(this,hS(this.attrs,e))};Da.compile=function(e,r){var o=Object.create(null),a=0;return e.forEach(function(l,d){return o[l]=new Da(l,a++,r,d)}),o};Da.prototype.removeFromSet=function(e){for(var r=0;r<e.length;r++)e[r].type==this&&(e=e.slice(0,r).concat(e.slice(r+1)),r--);return e};Da.prototype.isInSet=function(e){for(var r=0;r<e.length;r++)if(e[r].type==this)return e[r]};Da.prototype.excludes=function(e){return this.excluded.indexOf(e)>-1};var Ng={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},Q3={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},gS={ol:!0,ul:!0},Og=1,kg=2,hu=4;function mS(t){return(t?Og:0)|(t==="full"?kg:0)}var us=function(e,r,o,a,l,d,p){this.type=e,this.attrs=r,this.solid=l,this.match=d||(p&hu?null:e.contentMatch),this.options=p,this.content=[],this.marks=o,this.activeMarks=Bt.none,this.pendingMarks=a,this.stashMarks=[]};us.prototype.findWrapping=function(e){if(!this.match){if(!this.type)return[];var r=this.type.contentMatch.fillBefore(ge.from(e));if(r)this.match=this.type.contentMatch.matchFragment(r);else{var o=this.type.contentMatch,a;return(a=o.findWrapping(e.type))?(this.match=o,a):null}}return this.match.findWrapping(e.type)};us.prototype.finish=function(e){if(!(this.options&Og)){var r=this.content[this.content.length-1],o;r&&r.isText&&(o=/[ \t\r\n\u000c]+$/.exec(r.text))&&(r.text.length==o[0].length?this.content.pop():this.content[this.content.length-1]=r.withText(r.text.slice(0,r.text.length-o[0].length)))}var a=ge.from(this.content);return!e&&this.match&&(a=a.append(this.match.fillBefore(ge.empty,!0))),this.type?this.type.create(this.attrs,a,this.marks):a};us.prototype.popFromStashMark=function(e){for(var r=this.stashMarks.length-1;r>=0;r--)if(e.eq(this.stashMarks[r]))return this.stashMarks.splice(r,1)[0]};us.prototype.applyPending=function(e){for(var r=0,o=this.pendingMarks;r<o.length;r++){var a=o[r];(this.type?this.type.allowsMarkType(a.type):V3(a.type,e))&&!a.isInSet(this.activeMarks)&&(this.activeMarks=a.addToSet(this.activeMarks),this.pendingMarks=a.removeFromSet(this.pendingMarks))}};us.prototype.inlineContext=function(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!Ng.hasOwnProperty(e.parentNode.nodeName.toLowerCase())};var cr=function(e,r,o){this.parser=e,this.options=r,this.isOpen=o;var a=r.topNode,l,d=mS(r.preserveWhitespace)|(o?hu:0);a?l=new us(a.type,a.attrs,Bt.none,Bt.none,!0,r.topMatch||a.type.contentMatch,d):o?l=new us(null,null,Bt.none,Bt.none,!0,null,d):l=new us(e.schema.topNodeType,null,Bt.none,Bt.none,!0,null,d),this.nodes=[l],this.open=0,this.find=r.findPositions,this.needsBlock=!1},bg={top:{configurable:!0},currentPos:{configurable:!0}};bg.top.get=function(){return this.nodes[this.open]};cr.prototype.addDOM=function(e){if(e.nodeType==3)this.addTextNode(e);else if(e.nodeType==1){var r=e.getAttribute("style"),o=r?this.readStyles(F3(r)):null,a=this.top;if(o!=null)for(var l=0;l<o.length;l++)this.addPendingMark(o[l]);if(this.addElement(e),o!=null)for(var d=0;d<o.length;d++)this.removePendingMark(o[d],a)}};cr.prototype.addTextNode=function(e){var r=e.nodeValue,o=this.top;if(o.options&kg||o.inlineContext(e)||/[^ \t\r\n\u000c]/.test(r)){if(o.options&Og)o.options&kg?r=r.replace(/\r\n?/g,`
`):r=r.replace(/\r?\n|\r/g," ");else if(r=r.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(r)&&this.open==this.nodes.length-1){var a=o.content[o.content.length-1],l=e.previousSibling;(!a||l&&l.nodeName=="BR"||a.isText&&/[ \t\r\n\u000c]$/.test(a.text))&&(r=r.slice(1))}r&&this.insertNode(this.parser.schema.text(r)),this.findInText(e)}else this.findInside(e)};cr.prototype.addElement=function(e,r){var o=e.nodeName.toLowerCase(),a;gS.hasOwnProperty(o)&&this.parser.normalizeLists&&U3(e);var l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(a=this.parser.matchTag(e,this,r));if(l?l.ignore:Q3.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);var d,p=this.top,g=this.needsBlock;if(Ng.hasOwnProperty(o))d=!0,p.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e);return}this.addAll(e),d&&this.sync(p),this.needsBlock=g}else this.addElementByRule(e,l,l.consuming===!1?a:null)};cr.prototype.leafFallback=function(e){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`))};cr.prototype.ignoreFallback=function(e){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"))};cr.prototype.readStyles=function(e){var r=Bt.none;e:for(var o=0;o<e.length;o+=2)for(var a=null;;){var l=this.parser.matchStyle(e[o],e[o+1],this,a);if(!l)continue e;if(l.ignore)return null;if(r=this.parser.schema.marks[l.mark].create(l.attrs).addToSet(r),l.consuming===!1)a=l;else break}return r};cr.prototype.addElementByRule=function(e,r,o){var a=this,l,d,p,g;r.node?(d=this.parser.schema.nodes[r.node],d.isLeaf?this.insertNode(d.create(r.attrs))||this.leafFallback(e):l=this.enter(d,r.attrs,r.preserveWhitespace)):(p=this.parser.schema.marks[r.mark],g=p.create(r.attrs),this.addPendingMark(g));var v=this.top;if(d&&d.isLeaf)this.findInside(e);else if(o)this.addElement(e,o);else if(r.getContent)this.findInside(e),r.getContent(e,this.parser.schema).forEach(function(y){return a.insertNode(y)});else{var C=r.contentElement;typeof C=="string"?C=e.querySelector(C):typeof C=="function"&&(C=C(e)),C||(C=e),this.findAround(e,C,!0),this.addAll(C,l)}l&&(this.sync(v),this.open--),g&&this.removePendingMark(g,v)};cr.prototype.addAll=function(e,r,o,a){for(var l=o||0,d=o?e.childNodes[o]:e.firstChild,p=a==null?null:e.childNodes[a];d!=p;d=d.nextSibling,++l)this.findAtPoint(e,l),this.addDOM(d),r&&Ng.hasOwnProperty(d.nodeName.toLowerCase())&&this.sync(r);this.findAtPoint(e,l)};cr.prototype.findPlace=function(e){for(var r,o,a=this.open;a>=0;a--){var l=this.nodes[a],d=l.findWrapping(e);if(d&&(!r||r.length>d.length)&&(r=d,o=l,!d.length)||l.solid)break}if(!r)return!1;this.sync(o);for(var p=0;p<r.length;p++)this.enterInner(r[p],null,!1);return!0};cr.prototype.insertNode=function(e){if(e.isInline&&this.needsBlock&&!this.top.type){var r=this.textblockFromContext();r&&this.enterInner(r)}if(this.findPlace(e)){this.closeExtra();var o=this.top;o.applyPending(e.type),o.match&&(o.match=o.match.matchType(e.type));for(var a=o.activeMarks,l=0;l<e.marks.length;l++)(!o.type||o.type.allowsMarkType(e.marks[l].type))&&(a=e.marks[l].addToSet(a));return o.content.push(e.mark(a)),!0}return!1};cr.prototype.enter=function(e,r,o){var a=this.findPlace(e.create(r));return a&&this.enterInner(e,r,!0,o),a};cr.prototype.enterInner=function(e,r,o,a){this.closeExtra();var l=this.top;l.applyPending(e),l.match=l.match&&l.match.matchType(e,r);var d=a==null?l.options&~hu:mS(a);l.options&hu&&l.content.length==0&&(d|=hu),this.nodes.push(new us(e,r,l.activeMarks,l.pendingMarks,o,null,d)),this.open++};cr.prototype.closeExtra=function(e){var r=this.nodes.length-1;if(r>this.open){for(;r>this.open;r--)this.nodes[r-1].content.push(this.nodes[r].finish(e));this.nodes.length=this.open+1}};cr.prototype.finish=function(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)};cr.prototype.sync=function(e){for(var r=this.open;r>=0;r--)if(this.nodes[r]==e){this.open=r;return}};bg.currentPos.get=function(){this.closeExtra();for(var t=0,e=this.open;e>=0;e--){for(var r=this.nodes[e].content,o=r.length-1;o>=0;o--)t+=r[o].nodeSize;e&&t++}return t};cr.prototype.findAtPoint=function(e,r){if(this.find)for(var o=0;o<this.find.length;o++)this.find[o].node==e&&this.find[o].offset==r&&(this.find[o].pos=this.currentPos)};cr.prototype.findInside=function(e){if(this.find)for(var r=0;r<this.find.length;r++)this.find[r].pos==null&&e.nodeType==1&&e.contains(this.find[r].node)&&(this.find[r].pos=this.currentPos)};cr.prototype.findAround=function(e,r,o){if(e!=r&&this.find){for(var a=0;a<this.find.length;a++)if(this.find[a].pos==null&&e.nodeType==1&&e.contains(this.find[a].node)){var l=r.compareDocumentPosition(this.find[a].node);l&(o?2:4)&&(this.find[a].pos=this.currentPos)}}};cr.prototype.findInText=function(e){if(this.find)for(var r=0;r<this.find.length;r++)this.find[r].node==e&&(this.find[r].pos=this.currentPos-(e.nodeValue.length-this.find[r].offset))};cr.prototype.matchesContext=function(e){var r=this;if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);var o=e.split("/"),a=this.options.context,l=!this.isOpen&&(!a||a.parent.type==this.nodes[0].type),d=-(a?a.depth+1:0)+(l?0:1),p=function(g,v){for(;g>=0;g--){var C=o[g];if(C==""){if(g==o.length-1||g==0)continue;for(;v>=d;v--)if(p(g-1,v))return!0;return!1}else{var y=v>0||v==0&&l?r.nodes[v].type:a&&v>=d?a.node(v-d).type:null;if(!y||y.name!=C&&y.groups.indexOf(C)==-1)return!1;v--}}return!0};return p(o.length-1,this.open)};cr.prototype.textblockFromContext=function(){var e=this.options.context;if(e)for(var r=e.depth;r>=0;r--){var o=e.node(r).contentMatchAt(e.indexAfter(r)).defaultType;if(o&&o.isTextblock&&o.defaultAttrs)return o}for(var a in this.parser.schema.nodes){var l=this.parser.schema.nodes[a];if(l.isTextblock&&l.defaultAttrs)return l}};cr.prototype.addPendingMark=function(e){var r=G3(e,this.top.pendingMarks);r&&this.top.stashMarks.push(r),this.top.pendingMarks=e.addToSet(this.top.pendingMarks)};cr.prototype.removePendingMark=function(e,r){for(var o=this.open;o>=0;o--){var a=this.nodes[o],l=a.pendingMarks.lastIndexOf(e);if(l>-1)a.pendingMarks=e.removeFromSet(a.pendingMarks);else{a.activeMarks=e.removeFromSet(a.activeMarks);var d=a.popFromStashMark(e);d&&a.type&&a.type.allowsMarkType(d.type)&&(a.activeMarks=d.addToSet(a.activeMarks))}if(a==r)break}};Object.defineProperties(cr.prototype,bg);function U3(t){for(var e=t.firstChild,r=null;e;e=e.nextSibling){var o=e.nodeType==1?e.nodeName.toLowerCase():null;o&&gS.hasOwnProperty(o)&&r?(r.appendChild(e),e=r):o=="li"?r=e:o&&(r=null)}}function F3(t){for(var e=/\s*([\w-]+)\s*:\s*([^;]+)/g,r,o=[];r=e.exec(t);)o.push(r[1],r[2].trim());return o}function V3(t,e){var r=e.schema.nodes,o=function(d){var p=r[d];if(!!p.allowsMarkType(t)){var g=[],v=function(C){g.push(C);for(var y=0;y<C.edgeCount;y++){var w=C.edge(y),k=w.type,M=w.next;if(k==e||g.indexOf(M)<0&&v(M))return!0}};if(v(p.contentMatch))return{v:!0}}};for(var a in r){var l=o(a);if(l)return l.v}}function G3(t,e){for(var r=0;r<e.length;r++)if(t.eq(e[r]))return e[r]}var vS=65535,ES=Math.pow(2,16);function j3(t,e){return t+e*ES}function IS(t){return t&vS}function H3(t){return(t-(t&vS))/ES}var Dg=function(e,r,o){r===void 0&&(r=!1),o===void 0&&(o=null),this.pos=e,this.deleted=r,this.recover=o},Cn=function(e,r){r===void 0&&(r=!1),this.ranges=e,this.inverted=r};Cn.prototype.recover=function(e){var r=0,o=IS(e);if(!this.inverted)for(var a=0;a<o;a++)r+=this.ranges[a*3+2]-this.ranges[a*3+1];return this.ranges[o*3]+r+H3(e)};Cn.prototype.mapResult=function(e,r){return r===void 0&&(r=1),this._map(e,r,!1)};Cn.prototype.map=function(e,r){return r===void 0&&(r=1),this._map(e,r,!0)};Cn.prototype._map=function(e,r,o){for(var a=0,l=this.inverted?2:1,d=this.inverted?1:2,p=0;p<this.ranges.length;p+=3){var g=this.ranges[p]-(this.inverted?a:0);if(g>e)break;var v=this.ranges[p+l],C=this.ranges[p+d],y=g+v;if(e<=y){var w=v?e==g?-1:e==y?1:r:r,k=g+a+(w<0?0:C);if(o)return k;var M=e==(r<0?g:y)?null:j3(p/3,e-g);return new Dg(k,r<0?e!=g:e!=y,M)}a+=C-v}return o?e+a:new Dg(e+a)};Cn.prototype.touches=function(e,r){for(var o=0,a=IS(r),l=this.inverted?2:1,d=this.inverted?1:2,p=0;p<this.ranges.length;p+=3){var g=this.ranges[p]-(this.inverted?o:0);if(g>e)break;var v=this.ranges[p+l],C=g+v;if(e<=C&&p==a*3)return!0;o+=this.ranges[p+d]-v}return!1};Cn.prototype.forEach=function(e){for(var r=this.inverted?2:1,o=this.inverted?1:2,a=0,l=0;a<this.ranges.length;a+=3){var d=this.ranges[a],p=d-(this.inverted?l:0),g=d+(this.inverted?0:l),v=this.ranges[a+r],C=this.ranges[a+o];e(p,p+v,g,g+C),l+=C-v}};Cn.prototype.invert=function(){return new Cn(this.ranges,!this.inverted)};Cn.prototype.toString=function(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)};Cn.offset=function(e){return e==0?Cn.empty:new Cn(e<0?[0,-e,0]:[0,0,e])};Cn.empty=new Cn([]);var Jn=function(e,r,o,a){this.maps=e||[],this.from=o||0,this.to=a==null?this.maps.length:a,this.mirror=r};Jn.prototype.slice=function(e,r){return e===void 0&&(e=0),r===void 0&&(r=this.maps.length),new Jn(this.maps,this.mirror,e,r)};Jn.prototype.copy=function(){return new Jn(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)};Jn.prototype.appendMap=function(e,r){this.to=this.maps.push(e),r!=null&&this.setMirror(this.maps.length-1,r)};Jn.prototype.appendMapping=function(e){for(var r=0,o=this.maps.length;r<e.maps.length;r++){var a=e.getMirror(r);this.appendMap(e.maps[r],a!=null&&a<r?o+a:null)}};Jn.prototype.getMirror=function(e){if(this.mirror){for(var r=0;r<this.mirror.length;r++)if(this.mirror[r]==e)return this.mirror[r+(r%2?-1:1)]}};Jn.prototype.setMirror=function(e,r){this.mirror||(this.mirror=[]),this.mirror.push(e,r)};Jn.prototype.appendMappingInverted=function(e){for(var r=e.maps.length-1,o=this.maps.length+e.maps.length;r>=0;r--){var a=e.getMirror(r);this.appendMap(e.maps[r].invert(),a!=null&&a>r?o-a-1:null)}};Jn.prototype.invert=function(){var e=new Jn;return e.appendMappingInverted(this),e};Jn.prototype.map=function(e,r){if(r===void 0&&(r=1),this.mirror)return this._map(e,r,!0);for(var o=this.from;o<this.to;o++)e=this.maps[o].map(e,r);return e};Jn.prototype.mapResult=function(e,r){return r===void 0&&(r=1),this._map(e,r,!1)};Jn.prototype._map=function(e,r,o){for(var a=!1,l=this.from;l<this.to;l++){var d=this.maps[l],p=d.mapResult(e,r);if(p.recover!=null){var g=this.getMirror(l);if(g!=null&&g>l&&g<this.to){l=g,e=this.maps[g].recover(p.recover);continue}}p.deleted&&(a=!0),e=p.pos}return o?e:new Dg(e,a)};function Qc(t){var e=Error.call(this,t);return e.__proto__=Qc.prototype,e}Qc.prototype=Object.create(Error.prototype);Qc.prototype.constructor=Qc;Qc.prototype.name="TransformError";var Nr=function(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new Jn},Bg={before:{configurable:!0},docChanged:{configurable:!0}};Bg.before.get=function(){return this.docs.length?this.docs[0]:this.doc};Nr.prototype.step=function(e){var r=this.maybeStep(e);if(r.failed)throw new Qc(r.failed);return this};Nr.prototype.maybeStep=function(e){var r=e.apply(this.doc);return r.failed||this.addStep(e,r.doc),r};Bg.docChanged.get=function(){return this.steps.length>0};Nr.prototype.addStep=function(e,r){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=r};Object.defineProperties(Nr.prototype,Bg);function Rh(){throw new Error("Override me")}var Mg=Object.create(null),Pn=function(){};Pn.prototype.apply=function(e){return Rh()};Pn.prototype.getMap=function(){return Cn.empty};Pn.prototype.invert=function(e){return Rh()};Pn.prototype.map=function(e){return Rh()};Pn.prototype.merge=function(e){return null};Pn.prototype.toJSON=function(){return Rh()};Pn.fromJSON=function(e,r){if(!r||!r.stepType)throw new RangeError("Invalid input for Step.fromJSON");var o=Mg[r.stepType];if(!o)throw new RangeError("No step type "+r.stepType+" defined");return o.fromJSON(e,r)};Pn.jsonID=function(e,r){if(e in Mg)throw new RangeError("Duplicate use of step JSON ID "+e);return Mg[e]=r,r.prototype.jsonID=e,r};var zn=function(e,r){this.doc=e,this.failed=r};zn.ok=function(e){return new zn(e,null)};zn.fail=function(e){return new zn(null,e)};zn.fromReplace=function(e,r,o,a){try{return zn.ok(e.replace(r,o,a))}catch(l){if(l instanceof Uo)return zn.fail(l.message);throw l}};var Vs=function(t){function e(r,o,a,l){t.call(this),this.from=r,this.to=o,this.slice=a,this.structure=!!l}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(o){return this.structure&&Lg(o,this.from,this.to)?zn.fail("Structure replace would overwrite content"):zn.fromReplace(o,this.from,this.to,this.slice)},e.prototype.getMap=function(){return new Cn([this.from,this.to-this.from,this.slice.size])},e.prototype.invert=function(o){return new e(this.from,this.from+this.slice.size,o.slice(this.from,this.to))},e.prototype.map=function(o){var a=o.mapResult(this.from,1),l=o.mapResult(this.to,-1);return a.deleted&&l.deleted?null:new e(a.pos,Math.max(a.pos,l.pos),this.slice)},e.prototype.merge=function(o){if(!(o instanceof e)||o.structure||this.structure)return null;if(this.from+this.slice.size==o.from&&!this.slice.openEnd&&!o.slice.openStart){var a=this.slice.size+o.slice.size==0?Ve.empty:new Ve(this.slice.content.append(o.slice.content),this.slice.openStart,o.slice.openEnd);return new e(this.from,this.to+(o.to-o.from),a,this.structure)}else if(o.to==this.from&&!this.slice.openStart&&!o.slice.openEnd){var l=this.slice.size+o.slice.size==0?Ve.empty:new Ve(o.slice.content.append(this.slice.content),o.slice.openStart,this.slice.openEnd);return new e(o.from,this.to,l,this.structure)}else return null},e.prototype.toJSON=function(){var o={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(o.slice=this.slice.toJSON()),this.structure&&(o.structure=!0),o},e.fromJSON=function(o,a){if(typeof a.from!="number"||typeof a.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new e(a.from,a.to,Ve.fromJSON(o,a.slice),!!a.structure)},e}(Pn);Pn.jsonID("replace",Vs);var Ba=function(t){function e(r,o,a,l,d,p,g){t.call(this),this.from=r,this.to=o,this.gapFrom=a,this.gapTo=l,this.slice=d,this.insert=p,this.structure=!!g}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(o){if(this.structure&&(Lg(o,this.from,this.gapFrom)||Lg(o,this.gapTo,this.to)))return zn.fail("Structure gap-replace would overwrite content");var a=o.slice(this.gapFrom,this.gapTo);if(a.openStart||a.openEnd)return zn.fail("Gap is not a flat range");var l=this.slice.insertAt(this.insert,a.content);return l?zn.fromReplace(o,this.from,this.to,l):zn.fail("Content does not fit in gap")},e.prototype.getMap=function(){return new Cn([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])},e.prototype.invert=function(o){var a=this.gapTo-this.gapFrom;return new e(this.from,this.from+this.slice.size+a,this.from+this.insert,this.from+this.insert+a,o.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)},e.prototype.map=function(o){var a=o.mapResult(this.from,1),l=o.mapResult(this.to,-1),d=o.map(this.gapFrom,-1),p=o.map(this.gapTo,1);return a.deleted&&l.deleted||d<a.pos||p>l.pos?null:new e(a.pos,l.pos,d,p,this.slice,this.insert,this.structure)},e.prototype.toJSON=function(){var o={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(o.slice=this.slice.toJSON()),this.structure&&(o.structure=!0),o},e.fromJSON=function(o,a){if(typeof a.from!="number"||typeof a.to!="number"||typeof a.gapFrom!="number"||typeof a.gapTo!="number"||typeof a.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new e(a.from,a.to,a.gapFrom,a.gapTo,Ve.fromJSON(o,a.slice),a.insert,!!a.structure)},e}(Pn);Pn.jsonID("replaceAround",Ba);function Lg(t,e,r){for(var o=t.resolve(e),a=r-e,l=o.depth;a>0&&l>0&&o.indexAfter(l)==o.node(l).childCount;)l--,a--;if(a>0)for(var d=o.node(l).maybeChild(o.indexAfter(l));a>0;){if(!d||d.isLeaf)return!0;d=d.firstChild,a--}return!1}Nr.prototype.lift=function(t,e){for(var r=t.$from,o=t.$to,a=t.depth,l=r.before(a+1),d=o.after(a+1),p=l,g=d,v=ge.empty,C=0,y=a,w=!1;y>e;y--)w||r.index(y)>0?(w=!0,v=ge.from(r.node(y).copy(v)),C++):p--;for(var k=ge.empty,M=0,x=a,V=!1;x>e;x--)V||o.after(x+1)<o.end(x)?(V=!0,k=ge.from(o.node(x).copy(k)),M++):g++;return this.step(new Ba(p,g,l,d,new Ve(v.append(k),C,M),v.size-C,!0))};Nr.prototype.wrap=function(t,e){for(var r=ge.empty,o=e.length-1;o>=0;o--)r=ge.from(e[o].type.create(e[o].attrs,r));var a=t.start,l=t.end;return this.step(new Ba(a,l,a,l,new Ve(r,0,0),e.length,!0))};Nr.prototype.setBlockType=function(t,e,r,o){var a=this;if(e===void 0&&(e=t),!r.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");var l=this.steps.length;return this.doc.nodesBetween(t,e,function(d,p){if(d.isTextblock&&!d.hasMarkup(r,o)&&K3(a.doc,a.mapping.slice(l).map(p),r)){a.clearIncompatible(a.mapping.slice(l).map(p,1),r);var g=a.mapping.slice(l),v=g.map(p,1),C=g.map(p+d.nodeSize,1);return a.step(new Ba(v,C,v+1,C-1,new Ve(ge.from(r.create(o,null,d.marks)),0,0),1,!0)),!1}}),this};function K3(t,e,r){var o=t.resolve(e),a=o.index();return o.parent.canReplaceWith(a,a+1,r)}Nr.prototype.setNodeMarkup=function(t,e,r,o){var a=this.doc.nodeAt(t);if(!a)throw new RangeError("No node at given position");e||(e=a.type);var l=e.create(r,null,o||a.marks);if(a.isLeaf)return this.replaceWith(t,t+a.nodeSize,l);if(!e.validContent(a.content))throw new RangeError("Invalid content for node type "+e.name);return this.step(new Ba(t,t+a.nodeSize,t+1,t+a.nodeSize-1,new Ve(ge.from(l),0,0),1,!0))};Nr.prototype.split=function(t,e,r){e===void 0&&(e=1);for(var o=this.doc.resolve(t),a=ge.empty,l=ge.empty,d=o.depth,p=o.depth-e,g=e-1;d>p;d--,g--){a=ge.from(o.node(d).copy(a));var v=r&&r[g];l=ge.from(v?v.type.create(v.attrs,l):o.node(d).copy(l))}return this.step(new Vs(t,t,new Ve(a.append(l),e,e),!0))};Nr.prototype.join=function(t,e){e===void 0&&(e=1);var r=new Vs(t-e,t+e,Ve.empty,!0);return this.step(r)};function W3(t,e,r){var o=t.resolve(e);if(o.parent.canReplaceWith(o.index(),o.index(),r))return e;if(o.parentOffset==0)for(var a=o.depth-1;a>=0;a--){var l=o.index(a);if(o.node(a).canReplaceWith(l,l,r))return o.before(a+1);if(l>0)return null}if(o.parentOffset==o.parent.content.size)for(var d=o.depth-1;d>=0;d--){var p=o.indexAfter(d);if(o.node(d).canReplaceWith(p,p,r))return o.after(d+1);if(p<o.node(d).childCount)return null}}function Pg(t,e,r){for(var o=[],a=0;a<t.childCount;a++){var l=t.child(a);l.content.size&&(l=l.copy(Pg(l.content,e,l))),l.isInline&&(l=e(l,r,a)),o.push(l)}return ge.fromArray(o)}var xg=function(t){function e(r,o,a){t.call(this),this.from=r,this.to=o,this.mark=a}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(o){var a=this,l=o.slice(this.from,this.to),d=o.resolve(this.from),p=d.node(d.sharedDepth(this.to)),g=new Ve(Pg(l.content,function(v,C){return!v.isAtom||!C.type.allowsMarkType(a.mark.type)?v:v.mark(a.mark.addToSet(v.marks))},p),l.openStart,l.openEnd);return zn.fromReplace(o,this.from,this.to,g)},e.prototype.invert=function(){return new pu(this.from,this.to,this.mark)},e.prototype.map=function(o){var a=o.mapResult(this.from,1),l=o.mapResult(this.to,-1);return a.deleted&&l.deleted||a.pos>=l.pos?null:new e(a.pos,l.pos,this.mark)},e.prototype.merge=function(o){if(o instanceof e&&o.mark.eq(this.mark)&&this.from<=o.to&&this.to>=o.from)return new e(Math.min(this.from,o.from),Math.max(this.to,o.to),this.mark)},e.prototype.toJSON=function(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},e.fromJSON=function(o,a){if(typeof a.from!="number"||typeof a.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new e(a.from,a.to,o.markFromJSON(a.mark))},e}(Pn);Pn.jsonID("addMark",xg);var pu=function(t){function e(r,o,a){t.call(this),this.from=r,this.to=o,this.mark=a}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.apply=function(o){var a=this,l=o.slice(this.from,this.to),d=new Ve(Pg(l.content,function(p){return p.mark(a.mark.removeFromSet(p.marks))}),l.openStart,l.openEnd);return zn.fromReplace(o,this.from,this.to,d)},e.prototype.invert=function(){return new xg(this.from,this.to,this.mark)},e.prototype.map=function(o){var a=o.mapResult(this.from,1),l=o.mapResult(this.to,-1);return a.deleted&&l.deleted||a.pos>=l.pos?null:new e(a.pos,l.pos,this.mark)},e.prototype.merge=function(o){if(o instanceof e&&o.mark.eq(this.mark)&&this.from<=o.to&&this.to>=o.from)return new e(Math.min(this.from,o.from),Math.max(this.to,o.to),this.mark)},e.prototype.toJSON=function(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},e.fromJSON=function(o,a){if(typeof a.from!="number"||typeof a.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new e(a.from,a.to,o.markFromJSON(a.mark))},e}(Pn);Pn.jsonID("removeMark",pu);Nr.prototype.addMark=function(t,e,r){var o=this,a=[],l=[],d=null,p=null;return this.doc.nodesBetween(t,e,function(g,v,C){if(!!g.isInline){var y=g.marks;if(!r.isInSet(y)&&C.type.allowsMarkType(r.type)){for(var w=Math.max(v,t),k=Math.min(v+g.nodeSize,e),M=r.addToSet(y),x=0;x<y.length;x++)y[x].isInSet(M)||(d&&d.to==w&&d.mark.eq(y[x])?d.to=k:a.push(d=new pu(w,k,y[x])));p&&p.to==w?p.to=k:l.push(p=new xg(w,k,r))}}}),a.forEach(function(g){return o.step(g)}),l.forEach(function(g){return o.step(g)}),this};Nr.prototype.removeMark=function(t,e,r){var o=this;r===void 0&&(r=null);var a=[],l=0;return this.doc.nodesBetween(t,e,function(d,p){if(!!d.isInline){l++;var g=null;if(r instanceof Da)for(var v=d.marks,C;C=r.isInSet(v);)(g||(g=[])).push(C),v=C.removeFromSet(v);else r?r.isInSet(d.marks)&&(g=[r]):g=d.marks;if(g&&g.length)for(var y=Math.min(p+d.nodeSize,e),w=0;w<g.length;w++){for(var k=g[w],M=void 0,x=0;x<a.length;x++){var V=a[x];V.step==l-1&&k.eq(a[x].style)&&(M=V)}M?(M.to=y,M.step=l):a.push({style:k,from:Math.max(p,t),to:y,step:l})}}}),a.forEach(function(d){return o.step(new pu(d.from,d.to,d.style))}),this};Nr.prototype.clearIncompatible=function(t,e,r){r===void 0&&(r=e.contentMatch);for(var o=this.doc.nodeAt(t),a=[],l=t+1,d=0;d<o.childCount;d++){var p=o.child(d),g=l+p.nodeSize,v=r.matchType(p.type,p.attrs);if(!v)a.push(new Vs(l,g,Ve.empty));else{r=v;for(var C=0;C<p.marks.length;C++)e.allowsMarkType(p.marks[C].type)||this.step(new pu(l,g,p.marks[C]))}l=g}if(!r.validEnd){var y=r.fillBefore(ge.empty,!0);this.replace(l,l,new Ve(y,0,0))}for(var w=a.length-1;w>=0;w--)this.step(a[w]);return this};function Y3(t,e,r,o){if(r===void 0&&(r=e),o===void 0&&(o=Ve.empty),e==r&&!o.size)return null;var a=t.resolve(e),l=t.resolve(r);return CS(a,l,o)?new Vs(e,r,o):new qi(a,l,o).fit()}Nr.prototype.replace=function(t,e,r){e===void 0&&(e=t),r===void 0&&(r=Ve.empty);var o=Y3(this.doc,t,e,r);return o&&this.step(o),this};Nr.prototype.replaceWith=function(t,e,r){return this.replace(t,e,new Ve(ge.from(r),0,0))};Nr.prototype.delete=function(t,e){return this.replace(t,e,Ve.empty)};Nr.prototype.insert=function(t,e){return this.replaceWith(t,t,e)};function CS(t,e,r){return!r.openStart&&!r.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),r.content)}var qi=function(e,r,o){this.$to=r,this.$from=e,this.unplaced=o,this.frontier=[];for(var a=0;a<=e.depth;a++){var l=e.node(a);this.frontier.push({type:l.type,match:l.contentMatchAt(e.indexAfter(a))})}this.placed=ge.empty;for(var d=e.depth;d>0;d--)this.placed=ge.from(e.node(d).copy(this.placed))},yS={depth:{configurable:!0}};yS.depth.get=function(){return this.frontier.length-1};qi.prototype.fit=function(){for(;this.unplaced.size;){var e=this.findFittable();e?this.placeNodes(e):this.openMore()||this.dropNode()}var r=this.mustMoveInline(),o=this.placed.size-this.depth-this.$from.depth,a=this.$from,l=this.close(r<0?this.$to:a.doc.resolve(r));if(!l)return null;for(var d=this.placed,p=a.depth,g=l.depth;p&&g&&d.childCount==1;)d=d.firstChild.content,p--,g--;var v=new Ve(d,p,g);if(r>-1)return new Ba(a.pos,r,this.$to.pos,this.$to.end(),v,o);if(v.size||a.pos!=this.$to.pos)return new Vs(a.pos,l.pos,v)};qi.prototype.findFittable=function(){for(var e=1;e<=2;e++)for(var r=this.unplaced.openStart;r>=0;r--){var o=void 0,a=void 0;r?(a=Qg(this.unplaced.content,r-1).firstChild,o=a.content):o=this.unplaced.content;for(var l=o.firstChild,d=this.depth;d>=0;d--){var p=this.frontier[d],g=p.type,v=p.match,C=void 0,y=void 0;if(e==1&&(l?v.matchType(l.type)||(y=v.fillBefore(ge.from(l),!1)):g.compatibleContent(a.type)))return{sliceDepth:r,frontierDepth:d,parent:a,inject:y};if(e==2&&l&&(C=v.findWrapping(l.type)))return{sliceDepth:r,frontierDepth:d,parent:a,wrap:C};if(a&&v.matchType(a.type))break}}};qi.prototype.openMore=function(){var e=this.unplaced,r=e.content,o=e.openStart,a=e.openEnd,l=Qg(r,o);return!l.childCount||l.firstChild.isLeaf?!1:(this.unplaced=new Ve(r,o+1,Math.max(a,l.size+o>=r.size-a?o+1:0)),!0)};qi.prototype.dropNode=function(){var e=this.unplaced,r=e.content,o=e.openStart,a=e.openEnd,l=Qg(r,o);if(l.childCount<=1&&o>0){var d=r.size-o<=o+l.size;this.unplaced=new Ve(fu(r,o-1,1),o-1,d?o-1:a)}else this.unplaced=new Ve(fu(r,o,1),o,a)};qi.prototype.placeNodes=function(e){for(var r=e.sliceDepth,o=e.frontierDepth,a=e.parent,l=e.inject,d=e.wrap;this.depth>o;)this.closeFrontierNode();if(d)for(var p=0;p<d.length;p++)this.openFrontierNode(d[p]);var g=this.unplaced,v=a?a.content:g.content,C=g.openStart-r,y=0,w=[],k=this.frontier[o],M=k.match,x=k.type;if(l){for(var V=0;V<l.childCount;V++)w.push(l.child(V));M=M.matchFragment(l)}for(var Y=v.size+r-(g.content.size-g.openEnd);y<v.childCount;){var H=v.child(y),he=M.matchType(H.type);if(!he)break;y++,(y>1||C==0||H.content.size)&&(M=he,w.push(_S(H.mark(x.allowedMarks(H.marks)),y==1?C:0,y==v.childCount?Y:-1)))}var Q=y==v.childCount;Q||(Y=-1),this.placed=Au(this.placed,o,ge.from(w)),this.frontier[o].match=M,Q&&Y<0&&a&&a.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(var pe=0,oe=v;pe<Y;pe++){var me=oe.lastChild;this.frontier.push({type:me.type,match:me.contentMatchAt(me.childCount)}),oe=me.content}this.unplaced=Q?r==0?Ve.empty:new Ve(fu(g.content,r-1,1),r-1,Y<0?g.openEnd:r-1):new Ve(fu(g.content,r,y),g.openStart,g.openEnd)};qi.prototype.mustMoveInline=function(){if(!this.$to.parent.isTextblock||this.$to.end()==this.$to.pos)return-1;var e=this.frontier[this.depth],r;if(!e.type.isTextblock||!Ug(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(r=this.findCloseLevel(this.$to))&&r.depth==this.depth)return-1;for(var o=this.$to,a=o.depth,l=this.$to.after(a);a>1&&l==this.$to.end(--a);)++l;return l};qi.prototype.findCloseLevel=function(e){e:for(var r=Math.min(this.depth,e.depth);r>=0;r--){var o=this.frontier[r],a=o.match,l=o.type,d=r<e.depth&&e.end(r+1)==e.pos+(e.depth-(r+1)),p=Ug(e,r,l,a,d);if(!!p){for(var g=r-1;g>=0;g--){var v=this.frontier[g],C=v.match,y=v.type,w=Ug(e,g,y,C,!0);if(!w||w.childCount)continue e}return{depth:r,fit:p,move:d?e.doc.resolve(e.after(r+1)):e}}}};qi.prototype.close=function(e){var r=this.findCloseLevel(e);if(!r)return null;for(;this.depth>r.depth;)this.closeFrontierNode();r.fit.childCount&&(this.placed=Au(this.placed,r.depth,r.fit)),e=r.move;for(var o=r.depth+1;o<=e.depth;o++){var a=e.node(o),l=a.type.contentMatch.fillBefore(a.content,!0,e.index(o));this.openFrontierNode(a.type,a.attrs,l)}return e};qi.prototype.openFrontierNode=function(e,r,o){var a=this.frontier[this.depth];a.match=a.match.matchType(e),this.placed=Au(this.placed,this.depth,ge.from(e.create(r,o))),this.frontier.push({type:e,match:e.contentMatch})};qi.prototype.closeFrontierNode=function(){var e=this.frontier.pop(),r=e.match.fillBefore(ge.empty,!0);r.childCount&&(this.placed=Au(this.placed,this.frontier.length,r))};Object.defineProperties(qi.prototype,yS);function fu(t,e,r){return e==0?t.cutByIndex(r):t.replaceChild(0,t.firstChild.copy(fu(t.firstChild.content,e-1,r)))}function Au(t,e,r){return e==0?t.append(r):t.replaceChild(t.childCount-1,t.lastChild.copy(Au(t.lastChild.content,e-1,r)))}function Qg(t,e){for(var r=0;r<e;r++)t=t.firstChild.content;return t}function _S(t,e,r){if(e<=0)return t;var o=t.content;return e>1&&(o=o.replaceChild(0,_S(o.firstChild,e-1,o.childCount==1?r-1:0))),e>0&&(o=t.type.contentMatch.fillBefore(o).append(o),r<=0&&(o=o.append(t.type.contentMatch.matchFragment(o).fillBefore(ge.empty,!0)))),t.copy(o)}function Ug(t,e,r,o,a){var l=t.node(e),d=a?t.indexAfter(e):t.index(e);if(d==l.childCount&&!r.compatibleContent(l.type))return null;var p=o.fillBefore(l.content,!0,d);return p&&!q3(r,l.content,d)?p:null}function q3(t,e,r){for(var o=r;o<e.childCount;o++)if(!t.allowsMarks(e.child(o).marks))return!0;return!1}Nr.prototype.replaceRange=function(t,e,r){if(!r.size)return this.deleteRange(t,e);var o=this.doc.resolve(t),a=this.doc.resolve(e);if(CS(o,a,r))return this.step(new Vs(t,e,r));var l=TS(o,this.doc.resolve(e));l[l.length-1]==0&&l.pop();var d=-(o.depth+1);l.unshift(d);for(var p=o.depth,g=o.pos-1;p>0;p--,g--){var v=o.node(p).type.spec;if(v.defining||v.isolating)break;l.indexOf(p)>-1?d=p:o.before(p)==g&&l.splice(1,0,-p)}for(var C=l.indexOf(d),y=[],w=r.openStart,k=r.content,M=0;;M++){var x=k.firstChild;if(y.push(x),M==r.openStart)break;k=x.content}w>0&&y[w-1].type.spec.defining&&o.node(C).type!=y[w-1].type?w-=1:w>=2&&y[w-1].isTextblock&&y[w-2].type.spec.defining&&o.node(C).type!=y[w-2].type&&(w-=2);for(var V=r.openStart;V>=0;V--){var Y=(V+w+1)%(r.openStart+1),H=y[Y];if(!!H)for(var he=0;he<l.length;he++){var Q=l[(he+C)%l.length],pe=!0;Q<0&&(pe=!1,Q=-Q);var oe=o.node(Q-1),me=o.index(Q-1);if(oe.canReplaceWith(me,me,H.type,H.marks))return this.replace(o.before(Q),pe?a.after(Q):e,new Ve(SS(r.content,0,r.openStart,Y),Y,r.openEnd))}}for(var xe=this.steps.length,Pe=l.length-1;Pe>=0&&(this.replace(t,e,r),!(this.steps.length>xe));Pe--){var De=l[Pe];De<0||(t=o.before(De),e=a.after(De))}return this};function SS(t,e,r,o,a){if(e<r){var l=t.firstChild;t=t.replaceChild(0,l.copy(SS(l.content,e+1,r,o,l)))}if(e>o){var d=a.contentMatchAt(0),p=d.fillBefore(t).append(t);t=p.append(d.matchFragment(p).fillBefore(ge.empty,!0))}return t}Nr.prototype.replaceRangeWith=function(t,e,r){if(!r.isInline&&t==e&&this.doc.resolve(t).parent.content.size){var o=W3(this.doc,t,r.type);o!=null&&(t=e=o)}return this.replaceRange(t,e,new Ve(ge.from(r),0,0))};Nr.prototype.deleteRange=function(t,e){for(var r=this.doc.resolve(t),o=this.doc.resolve(e),a=TS(r,o),l=0;l<a.length;l++){var d=a[l],p=l==a.length-1;if(p&&d==0||r.node(d).type.contentMatch.validEnd)return this.delete(r.start(d),o.end(d));if(d>0&&(p||r.node(d-1).canReplace(r.index(d-1),o.indexAfter(d-1))))return this.delete(r.before(d),o.after(d))}for(var g=1;g<=r.depth&&g<=o.depth;g++)if(t-r.start(g)==r.depth-g&&e>r.end(g)&&o.end(g)-e!=o.depth-g)return this.delete(r.before(g),e);return this.delete(t,e)};function TS(t,e){for(var r=[],o=Math.min(t.depth,e.depth),a=o;a>=0;a--){var l=t.start(a);if(l<t.pos-(t.depth-a)||e.end(a)>e.pos+(e.depth-a)||t.node(a).type.spec.isolating||e.node(a).type.spec.isolating)break;(l==e.start(a)||a==t.depth&&a==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&a&&e.start(a-1)==l-1)&&r.push(a)}return r}var Fg=Object.create(null),vr=function(e,r,o){this.ranges=o||[new J3(e.min(r),e.max(r))],this.$anchor=e,this.$head=r},Gs={anchor:{configurable:!0},head:{configurable:!0},from:{configurable:!0},to:{configurable:!0},$from:{configurable:!0},$to:{configurable:!0},empty:{configurable:!0}};Gs.anchor.get=function(){return this.$anchor.pos};Gs.head.get=function(){return this.$head.pos};Gs.from.get=function(){return this.$from.pos};Gs.to.get=function(){return this.$to.pos};Gs.$from.get=function(){return this.ranges[0].$from};Gs.$to.get=function(){return this.ranges[0].$to};Gs.empty.get=function(){for(var t=this.ranges,e=0;e<t.length;e++)if(t[e].$from.pos!=t[e].$to.pos)return!1;return!0};vr.prototype.content=function(){return this.$from.node(0).slice(this.from,this.to,!0)};vr.prototype.replace=function(e,r){r===void 0&&(r=Ve.empty);for(var o=r.content.lastChild,a=null,l=0;l<r.openEnd;l++)a=o,o=o.lastChild;for(var d=e.steps.length,p=this.ranges,g=0;g<p.length;g++){var v=p[g],C=v.$from,y=v.$to,w=e.mapping.slice(d);e.replaceRange(w.map(C.pos),w.map(y.pos),g?Ve.empty:r),g==0&&RS(e,d,(o?o.isInline:a&&a.isTextblock)?-1:1)}};vr.prototype.replaceWith=function(e,r){for(var o=e.steps.length,a=this.ranges,l=0;l<a.length;l++){var d=a[l],p=d.$from,g=d.$to,v=e.mapping.slice(o),C=v.map(p.pos),y=v.map(g.pos);l?e.deleteRange(C,y):(e.replaceRangeWith(C,y,r),RS(e,o,r.isInline?-1:1))}};vr.findFrom=function(e,r,o){var a=e.parent.inlineContent?new gu(e):Fc(e.node(0),e.parent,e.pos,e.index(),r,o);if(a)return a;for(var l=e.depth-1;l>=0;l--){var d=r<0?Fc(e.node(0),e.node(l),e.before(l+1),e.index(l),r,o):Fc(e.node(0),e.node(l),e.after(l+1),e.index(l)+1,r,o);if(d)return d}};vr.near=function(e,r){return r===void 0&&(r=1),this.findFrom(e,r)||this.findFrom(e,-r)||new vu(e.node(0))};vr.atStart=function(e){return Fc(e,e,0,0,1)||new vu(e)};vr.atEnd=function(e){return Fc(e,e,e.content.size,e.childCount,-1)||new vu(e)};vr.fromJSON=function(e,r){if(!r||!r.type)throw new RangeError("Invalid input for Selection.fromJSON");var o=Fg[r.type];if(!o)throw new RangeError("No selection type "+r.type+" defined");return o.fromJSON(e,r)};vr.jsonID=function(e,r){if(e in Fg)throw new RangeError("Duplicate use of selection JSON ID "+e);return Fg[e]=r,r.prototype.jsonID=e,r};vr.prototype.getBookmark=function(){return gu.between(this.$anchor,this.$head).getBookmark()};Object.defineProperties(vr.prototype,Gs);vr.prototype.visible=!0;var J3=function(e,r){this.$from=e,this.$to=r},gu=function(t){function e(o,a){a===void 0&&(a=o),t.call(this,o,a)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={$cursor:{configurable:!0}};return r.$cursor.get=function(){return this.$anchor.pos==this.$head.pos?this.$head:null},e.prototype.map=function(a,l){var d=a.resolve(l.map(this.head));if(!d.parent.inlineContent)return t.near(d);var p=a.resolve(l.map(this.anchor));return new e(p.parent.inlineContent?p:d,d)},e.prototype.replace=function(a,l){if(l===void 0&&(l=Ve.empty),t.prototype.replace.call(this,a,l),l==Ve.empty){var d=this.$from.marksAcross(this.$to);d&&a.ensureMarks(d)}},e.prototype.eq=function(a){return a instanceof e&&a.anchor==this.anchor&&a.head==this.head},e.prototype.getBookmark=function(){return new mu(this.anchor,this.head)},e.prototype.toJSON=function(){return{type:"text",anchor:this.anchor,head:this.head}},e.fromJSON=function(a,l){if(typeof l.anchor!="number"||typeof l.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new e(a.resolve(l.anchor),a.resolve(l.head))},e.create=function(a,l,d){d===void 0&&(d=l);var p=a.resolve(l);return new this(p,d==l?p:a.resolve(d))},e.between=function(a,l,d){var p=a.pos-l.pos;if((!d||p)&&(d=p>=0?1:-1),!l.parent.inlineContent){var g=t.findFrom(l,d,!0)||t.findFrom(l,-d,!0);if(g)l=g.$head;else return t.near(l,d)}return a.parent.inlineContent||(p==0?a=l:(a=(t.findFrom(a,-d,!0)||t.findFrom(a,d,!0)).$anchor,a.pos<l.pos!=p<0&&(a=l))),new e(a,l)},Object.defineProperties(e.prototype,r),e}(vr);vr.jsonID("text",gu);var mu=function(e,r){this.anchor=e,this.head=r};mu.prototype.map=function(e){return new mu(e.map(this.anchor),e.map(this.head))};mu.prototype.resolve=function(e){return gu.between(e.resolve(this.anchor),e.resolve(this.head))};var Uc=function(t){function e(r){var o=r.nodeAfter,a=r.node(0).resolve(r.pos+o.nodeSize);t.call(this,r,a),this.node=o}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.map=function(o,a){var l=a.mapResult(this.anchor),d=l.deleted,p=l.pos,g=o.resolve(p);return d?t.near(g):new e(g)},e.prototype.content=function(){return new Ve(ge.from(this.node),0,0)},e.prototype.eq=function(o){return o instanceof e&&o.anchor==this.anchor},e.prototype.toJSON=function(){return{type:"node",anchor:this.anchor}},e.prototype.getBookmark=function(){return new wh(this.anchor)},e.fromJSON=function(o,a){if(typeof a.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new e(o.resolve(a.anchor))},e.create=function(o,a){return new this(o.resolve(a))},e.isSelectable=function(o){return!o.isText&&o.type.spec.selectable!==!1},e}(vr);Uc.prototype.visible=!1;vr.jsonID("node",Uc);var wh=function(e){this.anchor=e};wh.prototype.map=function(e){var r=e.mapResult(this.anchor),o=r.deleted,a=r.pos;return o?new mu(a,a):new wh(a)};wh.prototype.resolve=function(e){var r=e.resolve(this.anchor),o=r.nodeAfter;return o&&Uc.isSelectable(o)?new Uc(r):vr.near(r)};var vu=function(t){function e(r){t.call(this,r.resolve(0),r.resolve(r.content.size))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.replace=function(o,a){if(a===void 0&&(a=Ve.empty),a==Ve.empty){o.delete(0,o.doc.content.size);var l=t.atStart(o.doc);l.eq(o.selection)||o.setSelection(l)}else t.prototype.replace.call(this,o,a)},e.prototype.toJSON=function(){return{type:"all"}},e.fromJSON=function(o){return new e(o)},e.prototype.map=function(o){return new e(o)},e.prototype.eq=function(o){return o instanceof e},e.prototype.getBookmark=function(){return z3},e}(vr);vr.jsonID("all",vu);var z3={map:function(){return this},resolve:function(e){return new vu(e)}};function Fc(t,e,r,o,a,l){if(e.inlineContent)return gu.create(t,r);for(var d=o-(a>0?0:1);a>0?d<e.childCount:d>=0;d+=a){var p=e.child(d);if(p.isAtom){if(!l&&Uc.isSelectable(p))return Uc.create(t,r-(a<0?p.nodeSize:0))}else{var g=Fc(t,p,r+a,a<0?p.childCount:0,a,l);if(g)return g}r+=p.nodeSize*a}}function RS(t,e,r){var o=t.steps.length-1;if(!(o<e)){var a=t.steps[o];if(a instanceof Vs||a instanceof Ba){var l=t.mapping.maps[o],d;l.forEach(function(p,g,v,C){d==null&&(d=C)}),t.setSelection(vr.near(t.doc.resolve(d),r))}}}var wS=1,Nh=2,NS=4,X3=function(t){function e(o){t.call(this,o.doc),this.time=Date.now(),this.curSelection=o.selection,this.curSelectionFor=0,this.storedMarks=o.storedMarks,this.updated=0,this.meta=Object.create(null)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={selection:{configurable:!0},selectionSet:{configurable:!0},storedMarksSet:{configurable:!0},isGeneric:{configurable:!0},scrolledIntoView:{configurable:!0}};return r.selection.get=function(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection},e.prototype.setSelection=function(a){if(a.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=a,this.curSelectionFor=this.steps.length,this.updated=(this.updated|wS)&~Nh,this.storedMarks=null,this},r.selectionSet.get=function(){return(this.updated&wS)>0},e.prototype.setStoredMarks=function(a){return this.storedMarks=a,this.updated|=Nh,this},e.prototype.ensureMarks=function(a){return Bt.sameSet(this.storedMarks||this.selection.$from.marks(),a)||this.setStoredMarks(a),this},e.prototype.addStoredMark=function(a){return this.ensureMarks(a.addToSet(this.storedMarks||this.selection.$head.marks()))},e.prototype.removeStoredMark=function(a){return this.ensureMarks(a.removeFromSet(this.storedMarks||this.selection.$head.marks()))},r.storedMarksSet.get=function(){return(this.updated&Nh)>0},e.prototype.addStep=function(a,l){t.prototype.addStep.call(this,a,l),this.updated=this.updated&~Nh,this.storedMarks=null},e.prototype.setTime=function(a){return this.time=a,this},e.prototype.replaceSelection=function(a){return this.selection.replace(this,a),this},e.prototype.replaceSelectionWith=function(a,l){var d=this.selection;return l!==!1&&(a=a.mark(this.storedMarks||(d.empty?d.$from.marks():d.$from.marksAcross(d.$to)||Bt.none))),d.replaceWith(this,a),this},e.prototype.deleteSelection=function(){return this.selection.replace(this),this},e.prototype.insertText=function(a,l,d){d===void 0&&(d=l);var p=this.doc.type.schema;if(l==null)return a?this.replaceSelectionWith(p.text(a),!0):this.deleteSelection();if(!a)return this.deleteRange(l,d);var g=this.storedMarks;if(!g){var v=this.doc.resolve(l);g=d==l?v.marks():v.marksAcross(this.doc.resolve(d))}return this.replaceRangeWith(l,d,p.text(a,g)),this.selection.empty||this.setSelection(vr.near(this.selection.$to)),this},e.prototype.setMeta=function(a,l){return this.meta[typeof a=="string"?a:a.key]=l,this},e.prototype.getMeta=function(a){return this.meta[typeof a=="string"?a:a.key]},r.isGeneric.get=function(){for(var o in this.meta)return!1;return!0},e.prototype.scrollIntoView=function(){return this.updated|=NS,this},r.scrolledIntoView.get=function(){return(this.updated&NS)>0},Object.defineProperties(e.prototype,r),e}(Nr);function OS(t,e){return!e||!t?t:t.bind(e)}var Eu=function(e,r,o){this.name=e,this.init=OS(r.init,o),this.apply=OS(r.apply,o)},$3=[new Eu("doc",{init:function(e){return e.doc||e.schema.topNodeType.createAndFill()},apply:function(e){return e.doc}}),new Eu("selection",{init:function(e,r){return e.selection||vr.atStart(r.doc)},apply:function(e){return e.selection}}),new Eu("storedMarks",{init:function(e){return e.storedMarks||null},apply:function(e,r,o,a){return a.selection.$cursor?e.storedMarks:null}}),new Eu("scrollToSelection",{init:function(){return 0},apply:function(e,r){return e.scrolledIntoView?r+1:r}})],Vg=function(e,r){var o=this;this.schema=e,this.fields=$3.concat(),this.plugins=[],this.pluginsByKey=Object.create(null),r&&r.forEach(function(a){if(o.pluginsByKey[a.key])throw new RangeError("Adding different instances of a keyed plugin ("+a.key+")");o.plugins.push(a),o.pluginsByKey[a.key]=a,a.spec.state&&o.fields.push(new Eu(a.key,a.spec.state,a))})},Xn=function(e){this.config=e},Oh={schema:{configurable:!0},plugins:{configurable:!0},tr:{configurable:!0}};Oh.schema.get=function(){return this.config.schema};Oh.plugins.get=function(){return this.config.plugins};Xn.prototype.apply=function(e){return this.applyTransaction(e).state};Xn.prototype.filterTransaction=function(e,r){r===void 0&&(r=-1);for(var o=0;o<this.config.plugins.length;o++)if(o!=r){var a=this.config.plugins[o];if(a.spec.filterTransaction&&!a.spec.filterTransaction.call(a,e,this))return!1}return!0};Xn.prototype.applyTransaction=function(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};for(var r=[e],o=this.applyInner(e),a=null;;){for(var l=!1,d=0;d<this.config.plugins.length;d++){var p=this.config.plugins[d];if(p.spec.appendTransaction){var g=a?a[d].n:0,v=a?a[d].state:this,C=g<r.length&&p.spec.appendTransaction.call(p,g?r.slice(g):r,v,o);if(C&&o.filterTransaction(C,d)){if(C.setMeta("appendedTransaction",e),!a){a=[];for(var y=0;y<this.config.plugins.length;y++)a.push(y<d?{state:o,n:r.length}:{state:this,n:0})}r.push(C),o=o.applyInner(C),l=!0}a&&(a[d]={state:o,n:r.length})}}if(!l)return{state:o,transactions:r}}};Xn.prototype.applyInner=function(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");for(var r=new Xn(this.config),o=this.config.fields,a=0;a<o.length;a++){var l=o[a];r[l.name]=l.apply(e,this[l.name],this,r)}for(var d=0;d<Iu.length;d++)Iu[d](this,e,r);return r};Oh.tr.get=function(){return new X3(this)};Xn.create=function(e){for(var r=new Vg(e.doc?e.doc.type.schema:e.schema,e.plugins),o=new Xn(r),a=0;a<r.fields.length;a++)o[r.fields[a].name]=r.fields[a].init(e,o);return o};Xn.prototype.reconfigure=function(e){for(var r=new Vg(this.schema,e.plugins),o=r.fields,a=new Xn(r),l=0;l<o.length;l++){var d=o[l].name;a[d]=this.hasOwnProperty(d)?this[d]:o[l].init(e,a)}return a};Xn.prototype.toJSON=function(e){var r={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(r.storedMarks=this.storedMarks.map(function(d){return d.toJSON()})),e&&typeof e=="object")for(var o in e){if(o=="doc"||o=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");var a=e[o],l=a.spec.state;l&&l.toJSON&&(r[o]=l.toJSON.call(a,this[a.key]))}return r};Xn.fromJSON=function(e,r,o){if(!r)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");var a=new Vg(e.schema,e.plugins),l=new Xn(a);return a.fields.forEach(function(d){if(d.name=="doc")l.doc=Mt.fromJSON(e.schema,r.doc);else if(d.name=="selection")l.selection=vr.fromJSON(l.doc,r.selection);else if(d.name=="storedMarks")r.storedMarks&&(l.storedMarks=r.storedMarks.map(e.schema.markFromJSON));else{if(o)for(var p in o){var g=o[p],v=g.spec.state;if(g.key==d.name&&v&&v.fromJSON&&Object.prototype.hasOwnProperty.call(r,p)){l[d.name]=v.fromJSON.call(g,e,r[p],l);return}}l[d.name]=d.init(e,l)}}),l};Xn.addApplyListener=function(e){Iu.push(e)};Xn.removeApplyListener=function(e){var r=Iu.indexOf(e);r>-1&&Iu.splice(r,1)};Object.defineProperties(Xn.prototype,Oh);var Iu=[];function kS(t,e,r){for(var o in t){var a=t[o];a instanceof Function?a=a.bind(e):o=="handleDOMEvents"&&(a=kS(a,e,{})),r[o]=a}return r}var bS=function(e){this.props={},e.props&&kS(e.props,this,this.props),this.spec=e,this.key=e.key?e.key.key:DS("plugin")};bS.prototype.getState=function(e){return e[this.key]};var Gg=Object.create(null);function DS(t){return t in Gg?t+"$"+ ++Gg[t]:(Gg[t]=0,t+"$")}var jg=function(e){e===void 0&&(e="key"),this.key=DS(e)};jg.prototype.get=function(e){return e.config.pluginsByKey[this.key]};jg.prototype.getState=function(e){return e[this.key]};const Z3=new jg("characterLimit");rn.create({name:"characterCount",addOptions(){return{limit:0}},addProseMirrorPlugins(){const{options:t}=this;return[new bS({key:Z3,appendTransaction:(e,r,o)=>{const a=o.doc.content.size;if(t.limit&&a>t.limit)return o.tr.insertText("",t.limit+1,a)}})]}});const e4={props:{icon:{type:String,required:!0},title:{type:String,required:!0},action:{type:Function,required:!0},isActive:{type:Function,default:null}},components:{SvgIcon:ga}},t4=["title"];function r4(t,e,r,o,a,l){const d=co("SvgIcon");return bt(),mr("button",{class:hn(["menu-item",{"is-active":r.isActive?r.isActive():null}]),onClick:e[0]||(e[0]=(...p)=>r.action&&r.action(...p)),title:r.title},[er(d,{name:"tiptap-"+r.icon},null,8,["name"])],10,t4)}var n4=Dl(e4,[["render",r4],["__scopeId","data-v-d2d2a634"]]);const i4={components:{MenuItem:n4},props:{editor:{type:Object,required:!0}},data(){return{items:[{icon:"bold",title:"Bold",action:()=>this.editor.chain().focus().toggleBold().run(),isActive:()=>this.editor.isActive("bold")},{icon:"italic",title:"Italic",action:()=>this.editor.chain().focus().toggleItalic().run(),isActive:()=>this.editor.isActive("italic")},{icon:"strikethrough",title:"Strike",action:()=>this.editor.chain().focus().toggleStrike().run(),isActive:()=>this.editor.isActive("strike")},{icon:"code-view",title:"Code",action:()=>this.editor.chain().focus().toggleCode().run(),isActive:()=>this.editor.isActive("code")},{icon:"mark-pen-line",title:"Highlight",action:()=>this.editor.chain().focus().toggleHighlight().run(),isActive:()=>this.editor.isActive("highlight")},{type:"divider"},{icon:"h-1",title:"Heading 1",action:()=>this.editor.chain().focus().toggleHeading({level:1}).run(),isActive:()=>this.editor.isActive("heading",{level:1})},{icon:"h-2",title:"Heading 2",action:()=>this.editor.chain().focus().toggleHeading({level:2}).run(),isActive:()=>this.editor.isActive("heading",{level:2})},{icon:"paragraph",title:"Paragraph",action:()=>this.editor.chain().focus().setParagraph().run(),isActive:()=>this.editor.isActive("paragraph")},{icon:"list-unordered",title:"Bullet List",action:()=>this.editor.chain().focus().toggleBulletList().run(),isActive:()=>this.editor.isActive("bulletList")},{icon:"list-ordered",title:"Ordered List",action:()=>this.editor.chain().focus().toggleOrderedList().run(),isActive:()=>this.editor.isActive("orderedList")},{icon:"list-check-2",title:"Task List",action:()=>this.editor.chain().focus().toggleTaskList().run(),isActive:()=>this.editor.isActive("taskList")},{icon:"code-box-line",title:"Code Block",action:()=>this.editor.chain().focus().toggleCodeBlock().run(),isActive:()=>this.editor.isActive("codeBlock")},{type:"divider"},{icon:"double-quotes-l",title:"Blockquote",action:()=>this.editor.chain().focus().toggleBlockquote().run(),isActive:()=>this.editor.isActive("blockquote")},{icon:"separator",title:"Horizontal Rule",action:()=>this.editor.chain().focus().setHorizontalRule().run()},{type:"divider"},{icon:"text-wrap",title:"Hard Break",action:()=>this.editor.chain().focus().setHardBreak().run()},{icon:"format-clear",title:"Clear Format",action:()=>this.editor.chain().focus().clearNodes().unsetAllMarks().run()},{type:"divider"},{icon:"arrow-go-back-line",title:"Undo",action:()=>this.editor.chain().focus().undo().run()},{icon:"arrow-go-forward-line",title:"Redo",action:()=>this.editor.chain().focus().redo().run()}]}}};function o4(t,e,r,o,a,l){const d=co("menu-item");return bt(),mr("div",null,[(bt(!0),mr(ts,null,Df(a.items,(p,g)=>(bt(),mr(ts,null,[p.type==="divider"?(bt(),mr("div",{class:"divider",key:`divider${g}`})):(bt(),ko(d,dC({key:1,key:g},p),null,16))],64))),256))])}var s4=Dl(i4,[["render",o4],["__scopeId","data-v-1ebce63e"]]);const Hg=t=>t[Math.floor(Math.random()*t.length)],a4=()=>Hg(["rooms.10","rooms.11","rooms.12"]),c4={components:{EditorContent:tP,MenuBar:s4},data(){return{currentUser:JSON.parse(localStorage.getItem("currentUser"))||{name:this.getRandomName(),color:this.getRandomColor()},provider:null,editor:null,users:[],status:"connecting",room:a4()}},mounted(){this.editor=new eP({extensions:[$P.configure({history:!1}),S3,E3,C3]}),localStorage.setItem("currentUser",JSON.stringify(this.currentUser))},methods:{setName(){const t=(window.prompt("Name")||"").trim().substring(0,32);if(t)return this.updateCurrentUser({name:t})},updateCurrentUser(t){this.currentUser=re(re({},this.currentUser),t),this.editor.chain().focus().user(this.currentUser).run(),localStorage.setItem("currentUser",JSON.stringify(this.currentUser))},getRandomColor(){return Hg(["#958DF1","#F98181","#FBBC88","#FAF594","#70CFF8","#94FADB","#B9F18D"])},getRandomName(){return Hg(["Lea Thompson","Cyndi Lauper","Tom Cruise","Madonna","Jerry Hall","Joan Collins","Winona Ryder","Christina Applegate","Alyssa Milano","Molly Ringwald","Ally Sheedy","Debbie Harry","Olivia Newton-John","Elton John","Michael J. Fox","Axl Rose","Emilio Estevez","Ralph Macchio","Rob Lowe","Jennifer Grey","Mickey Rourke","John Cusack","Matthew Broderick","Justine Bateman","Lisa Bonet"])}},beforeUnmount(){this.editor.destroy(),this.provider.destroy()}},l4={key:0,class:"editor"},u4={class:"editor__footer"},d4=Nd(" offline "),h4={class:"editor__name"};function p4(t,e,r,o,a,l){const d=co("menu-bar"),p=co("editor-content");return a.editor?(bt(),mr("div",l4,[er(d,{class:"editor__header",editor:a.editor},null,8,["editor"]),er(p,{class:"editor__content",editor:a.editor},null,8,["editor"]),lt("div",u4,[lt("div",{class:hn(`editor__status editor__status--${a.status}`)},[a.status==="connected"?(bt(),mr(ts,{key:0},[Nd(_s(a.users.length)+" user"+_s(a.users.length===1?"":"s")+" online in "+_s(a.room),1)],64)):(bt(),mr(ts,{key:1},[d4],64))],2),lt("div",h4,[lt("button",{onClick:e[0]||(e[0]=(...g)=>l.setName&&l.setName(...g))},_s(a.currentUser.name),1)])])])):vc("",!0)}var f4=Dl(c4,[["render",p4],["__scopeId","data-v-4278685a"]]);const A4={setup(t){const e=Aa([{name:"\u97F3\u9891",value:0},{name:"\u89C6\u9891",value:1}]),r=On(0),o=a=>{r.value=a};return(a,l)=>(bt(),ko(Oo(eO),{onChange:o},{default:Ss(()=>[er(Oo(ZN),{class:"flex p-1 space-x-1 bg-indigo-500 rounded-lg dark border dark:border-gray-600 transition"},{default:Ss(()=>[(bt(!0),mr(ts,null,Df(Oo(e),d=>(bt(),ko(Oo($N),{as:"template",key:d.value},{default:Ss(({selected:p})=>[lt("button",{class:hn(["w-full py-1 text-sm leading-5 font-mediumtext-white text-white font-bold rounded-md","focus:outline-none focus:ring-2 ring-offset-2 ring-offset-indigo-300",p?"bg-white shadow text-indigo-700":"hover:bg-white/[0.12]"])},_s(d.name),3)]),_:2},1024))),128))]),_:1})]),_:1}))}},BS=Object.prototype.toString;function g4(t){return BS.call(t)==="[object Array]"}function MS(t){return BS.call(t)==="[object String]"}function m4(t){return t===void 0}function Kg(t){return typeof t=="function"}const v4=Symbol("ArcoConfigProvider");var E4=Object.defineProperty,I4=Object.defineProperties,C4=Object.getOwnPropertyDescriptors,LS=Object.getOwnPropertySymbols,y4=Object.prototype.hasOwnProperty,_4=Object.prototype.propertyIsEnumerable,PS=(t,e,r)=>e in t?E4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,S4=(t,e)=>{for(var r in e||(e={}))y4.call(e,r)&&PS(t,r,e[r]);if(LS)for(var r of LS(e))_4.call(e,r)&&PS(t,r,e[r]);return t},T4=(t,e)=>I4(t,C4(e));const R4="A",w4="arco",Wg="$arco",xS=t=>{var e;return(e=t==null?void 0:t.componentPrefix)!=null?e:R4},QS=(t,e)=>{var r;e&&e.classPrefix&&(t.config.globalProperties[Wg]=T4(S4({},(r=t.config.globalProperties[Wg])!=null?r:{}),{classPrefix:e.classPrefix}))},Fo=t=>{var e,r,o;const a=wd(),l=Bf(v4,void 0),d=(o=(r=l==null?void 0:l.prefixCls)!=null?r:(e=a==null?void 0:a.appContext.config.globalProperties[Wg])==null?void 0:e.classPrefix)!=null?o:w4;return t?`${d}-${t}`:d},US=["info","success","warning","error"],N4=["top","tl","tr","bottom","bl","br","left","lt","lb","right","rt","rb"],FS=["hover","click","focus","contextMenu"];var js=(t,e)=>{for(const[r,o]of e)t[r]=o;return t};const O4=Nn({name:"IconHover",props:{prefix:{type:String},size:{type:String,default:"medium"},disabled:{type:Boolean,default:!1}},setup(){return{prefixCls:Fo("icon-hover")}}});function k4(t,e,r,o,a,l){return bt(),mr("span",{class:hn([t.prefixCls,{[`${t.prefix}-icon-hover`]:t.prefix,[`${t.prefixCls}-size-${t.size}`]:t.size!=="default",[`${t.prefixCls}-disabled`]:t.disabled}])},[Ec(t.$slots,"default")],2)}var b4=js(O4,[["render",k4]]);const D4=Nn({name:"IconClose",props:{strokeWidth:{type:Number,default:4},strokeLinecap:{type:String,default:"butt",validator:t=>["butt","round","square"].includes(t)},strokeLinejoin:{type:String,default:"miter",validator:t=>["arcs","bevel","miter","miter-clip","round"].includes(t)},spin:Boolean},setup(t){const e=Fo("icon");return{cls:oi(()=>[e,`${e}-close`,{[`${e}-spin`]:t.spin}])}}}),B4=["stroke-width","stroke-linecap","stroke-linejoin"],M4=lt("path",{d:"M9.857 9.858 24 24m0 0 14.142 14.142M24 24 38.142 9.858M24 24 9.857 38.142"},null,-1),L4=[M4];function P4(t,e,r,o,a,l){return bt(),mr("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:hn(t.cls),"stroke-width":t.strokeWidth,"stroke-linecap":t.strokeLinecap,"stroke-linejoin":t.strokeLinejoin},L4,10,B4)}var Yg=js(D4,[["render",P4]]);const x4=Object.assign(Yg,{install:(t,e)=>{var r;const o=(r=e==null?void 0:e.iconPrefix)!=null?r:"";t.component(o+Yg.name,Yg)}});var Q4=Object.defineProperty,VS=Object.getOwnPropertySymbols,U4=Object.prototype.hasOwnProperty,F4=Object.prototype.propertyIsEnumerable,GS=(t,e,r)=>e in t?Q4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Oi=(t,e)=>{for(var r in e||(e={}))U4.call(e,r)&&GS(t,r,e[r]);if(VS)for(var r of VS(e))F4.call(e,r)&&GS(t,r,e[r]);return t};const V4=()=>({width:document.documentElement.clientWidth||window.innerWidth,height:document.documentElement.clientHeight||window.innerHeight}),jS=(t,e)=>{const r=t.getBoundingClientRect();return{top:r.top,bottom:r.bottom,left:r.left,right:r.right,scrollTop:r.top-e.top,scrollBottom:r.bottom-e.top,scrollLeft:r.left-e.left,scrollRight:r.right-e.left,width:t.offsetWidth,height:t.offsetHeight}},G4=t=>{switch(t){case"top":case"tl":case"tr":return"top";case"bottom":case"bl":case"br":return"bottom";case"left":case"lt":case"lb":return"left";case"right":case"rt":case"rb":return"right";default:return"top"}},kh=(t,e)=>{switch(e){case"top":switch(t){case"bottom":return"top";case"bl":return"tl";case"br":return"tr";default:return t}case"bottom":switch(t){case"top":return"bottom";case"tl":return"bl";case"tr":return"br";default:return t}case"left":switch(t){case"right":return"left";case"rt":return"lt";case"rb":return"lb";default:return t}case"right":switch(t){case"left":return"right";case"lt":return"rt";case"lb":return"rb";default:return t}default:return t}},j4=(t,e,{containerRect:r,triggerRect:o,popupRect:a,offset:l,translate:d})=>{const p=G4(t),g=V4(),v={top:r.top+e.top,bottom:g.height-(r.top+e.top+a.height),left:r.left+e.left,right:g.width-(r.left+e.left+a.width)};let C=t;if(p==="top"&&v.top<0)if(o.top>a.height)e.top=-r.top;else{const y=Cu("bottom",o,a,{offset:l,translate:d});g.height-(r.top+y.top+a.height)>0&&(C=kh(t,"bottom"),e.top=y.top)}if(p==="bottom"&&v.bottom<0)if(g.height-o.bottom>a.height)e.top=-r.top+(g.height-a.height);else{const y=Cu("top",o,a,{offset:l,translate:d});r.top+y.top>0&&(C=kh(t,"top"),e.top=y.top)}if(p==="left"&&v.left<0)if(o.left>a.width)e.left=-r.left;else{const y=Cu("right",o,a,{offset:l,translate:d});g.width-(r.left+y.left+a.width)>0&&(C=kh(t,"right"),e.left=y.left)}if(p==="right"&&v.right<0)if(g.width-o.right>a.width)e.left=-r.left+(g.width-a.width);else{const y=Cu("left",o,a,{offset:l,translate:d});r.left+y.left>0&&(C=kh(t,"left"),e.left=y.left)}return(p==="top"||p==="bottom")&&(v.left<0?e.left=-r.left:v.right<0&&(e.left=-r.left+(g.width-a.width))),(p==="left"||p==="right")&&(v.top<0?e.top=-r.top:v.bottom<0&&(e.top=-r.top+(g.height-a.height))),{popupPosition:e,position:C}},Cu=(t,e,r,{offset:o=0,translate:a=[0,0]}={})=>{var l;const d=(l=g4(a)?a:a[t])!=null?l:[0,0];switch(t){case"top":return{left:e.scrollLeft+Math.round(e.width/2)-Math.round(r.width/2)+d[0],top:e.scrollTop-r.height-o+d[1]};case"tl":return{left:e.scrollLeft+d[0],top:e.scrollTop-r.height-o+d[1]};case"tr":return{left:e.scrollRight-r.width+d[0],top:e.scrollTop-r.height-o+d[1]};case"bottom":return{left:e.scrollLeft+Math.round(e.width/2)-Math.round(r.width/2)+d[0],top:e.scrollBottom+o+d[1]};case"bl":return{left:e.scrollLeft+d[0],top:e.scrollBottom+o+d[1]};case"br":return{left:e.scrollRight-r.width+d[0],top:e.scrollBottom+o+d[1]};case"left":return{left:e.scrollLeft-r.width-o+d[0],top:e.scrollTop+Math.round(e.height/2)-Math.round(r.height/2)+d[1]};case"lt":return{left:e.scrollLeft-r.width-o+d[0],top:e.scrollTop+d[1]};case"lb":return{left:e.scrollLeft-r.width-o+d[0],top:e.scrollBottom-r.height+d[1]};case"right":return{left:e.scrollRight+o+d[0],top:e.scrollTop+Math.round(e.height/2)-Math.round(r.height/2)+d[1]};case"rt":return{left:e.scrollRight+o+d[0],top:e.scrollTop+d[1]};case"rb":return{left:e.scrollRight+o+d[0],top:e.scrollBottom-r.height+d[1]};default:return{left:0,top:0}}},H4=(t,e,r,o,{offset:a=0,translate:l=[0,0],customStyle:d={},autoFitPosition:p=!1,autoFitTransformOrigin:g=!1}={})=>{let v=t,C=Cu(t,r,o,{offset:a,translate:l});if(p){const w=j4(t,C,{containerRect:e,popupRect:o,triggerRect:r,offset:a,translate:l});C=w.popupPosition,v=w.position}const y=Oi({left:`${C.left}px`,top:`${C.top}px`},d);if(g){let w="0";["top","bottom"].includes(v)?w="50%":["left","lt","lb","tr","br"].includes(v)&&(w="100%");let k="0";["left","right"].includes(v)?k="50%":["top","tl","tr","lt","rt"].includes(v)&&(k="100%"),y.transformOrigin=`${w} ${k}`}return{style:y,position:v}},Ji=t=>`${t} rotate(45deg)`,K4=(t,e,{customStyle:r={}})=>{switch(t){case"top":return Oi({left:"50%",bottom:"0",transform:Ji("translate(-50%,50%)")},r);case"tl":return Oi({left:`${Math.round(e.width/2)}px`,bottom:"0",transform:Ji("translate(-50%,50%)")},r);case"tr":return Oi({right:`${Math.round(e.width/2)}px`,bottom:"0",transform:Ji("translate(50%,50%)")},r);case"bottom":return Oi({left:"50%",top:"0",transform:Ji("translate(-50%,-50%)")},r);case"bl":return Oi({left:`${Math.round(e.width/2)}px`,top:"0",transform:Ji("translate(-50%,-50%)")},r);case"br":return Oi({right:`${Math.round(e.width/2)}px`,top:"0",transform:Ji("translate(50%,-50%)")},r);case"left":return Oi({right:"0",top:"50%",transform:Ji("translate(50%,-50%)")},r);case"lt":return Oi({right:"0",top:`${Math.round(e.height/2)}px`,transform:Ji("translate(50%,-50%)")},r);case"lb":return Oi({right:"0",bottom:`${Math.round(e.height/2)}px`,transform:Ji("translate(50%,50%)")},r);case"right":return Oi({left:"0",top:"50%",transform:Ji("translate(-50%,-50%)")},r);case"rt":return Oi({left:"0",top:`${Math.round(e.height/2)}px`,transform:Ji("translate(-50%,-50%)")},r);case"rb":return Oi({left:"0",bottom:`${Math.round(e.height/2)}px`,transform:Ji("translate(-50%,50%)")},r);default:return{}}},W4=t=>t.scrollHeight>t.offsetHeight||t.scrollWidth>t.offsetWidth,Y4=t=>{const e=[];let r=t;for(;r&&r!==document.documentElement;)W4(r)&&e.push(r),r=r.parentElement;return e};var HS=function(){if(typeof Map!="undefined")return Map;function t(e,r){var o=-1;return e.some(function(a,l){return a[0]===r?(o=l,!0):!1}),o}return function(){function e(){this.__entries__=[]}return Object.defineProperty(e.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),e.prototype.get=function(r){var o=t(this.__entries__,r),a=this.__entries__[o];return a&&a[1]},e.prototype.set=function(r,o){var a=t(this.__entries__,r);~a?this.__entries__[a][1]=o:this.__entries__.push([r,o])},e.prototype.delete=function(r){var o=this.__entries__,a=t(o,r);~a&&o.splice(a,1)},e.prototype.has=function(r){return!!~t(this.__entries__,r)},e.prototype.clear=function(){this.__entries__.splice(0)},e.prototype.forEach=function(r,o){o===void 0&&(o=null);for(var a=0,l=this.__entries__;a<l.length;a++){var d=l[a];r.call(o,d[1],d[0])}},e}()}(),qg=typeof window!="undefined"&&typeof document!="undefined"&&window.document===document,bh=function(){return typeof global!="undefined"&&global.Math===Math?global:typeof self!="undefined"&&self.Math===Math?self:typeof window!="undefined"&&window.Math===Math?window:Function("return this")()}(),q4=function(){return typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(bh):function(t){return setTimeout(function(){return t(Date.now())},1e3/60)}}(),J4=2;function z4(t,e){var r=!1,o=!1,a=0;function l(){r&&(r=!1,t()),o&&p()}function d(){q4(l)}function p(){var g=Date.now();if(r){if(g-a<J4)return;o=!0}else r=!0,o=!1,setTimeout(d,e);a=g}return p}var X4=20,$4=["top","right","bottom","left","width","height","size","weight"],Z4=typeof MutationObserver!="undefined",ex=function(){function t(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=z4(this.refresh.bind(this),X4)}return t.prototype.addObserver=function(e){~this.observers_.indexOf(e)||this.observers_.push(e),this.connected_||this.connect_()},t.prototype.removeObserver=function(e){var r=this.observers_,o=r.indexOf(e);~o&&r.splice(o,1),!r.length&&this.connected_&&this.disconnect_()},t.prototype.refresh=function(){var e=this.updateObservers_();e&&this.refresh()},t.prototype.updateObservers_=function(){var e=this.observers_.filter(function(r){return r.gatherActive(),r.hasActive()});return e.forEach(function(r){return r.broadcastActive()}),e.length>0},t.prototype.connect_=function(){!qg||this.connected_||(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),Z4?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},t.prototype.disconnect_=function(){!qg||!this.connected_||(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},t.prototype.onTransitionEnd_=function(e){var r=e.propertyName,o=r===void 0?"":r,a=$4.some(function(l){return!!~o.indexOf(l)});a&&this.refresh()},t.getInstance=function(){return this.instance_||(this.instance_=new t),this.instance_},t.instance_=null,t}(),KS=function(t,e){for(var r=0,o=Object.keys(e);r<o.length;r++){var a=o[r];Object.defineProperty(t,a,{value:e[a],enumerable:!1,writable:!1,configurable:!0})}return t},Vc=function(t){var e=t&&t.ownerDocument&&t.ownerDocument.defaultView;return e||bh},WS=Bh(0,0,0,0);function Dh(t){return parseFloat(t)||0}function YS(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];return e.reduce(function(o,a){var l=t["border-"+a+"-width"];return o+Dh(l)},0)}function tx(t){for(var e=["top","right","bottom","left"],r={},o=0,a=e;o<a.length;o++){var l=a[o],d=t["padding-"+l];r[l]=Dh(d)}return r}function rx(t){var e=t.getBBox();return Bh(0,0,e.width,e.height)}function nx(t){var e=t.clientWidth,r=t.clientHeight;if(!e&&!r)return WS;var o=Vc(t).getComputedStyle(t),a=tx(o),l=a.left+a.right,d=a.top+a.bottom,p=Dh(o.width),g=Dh(o.height);if(o.boxSizing==="border-box"&&(Math.round(p+l)!==e&&(p-=YS(o,"left","right")+l),Math.round(g+d)!==r&&(g-=YS(o,"top","bottom")+d)),!ox(t)){var v=Math.round(p+l)-e,C=Math.round(g+d)-r;Math.abs(v)!==1&&(p-=v),Math.abs(C)!==1&&(g-=C)}return Bh(a.left,a.top,p,g)}var ix=function(){return typeof SVGGraphicsElement!="undefined"?function(t){return t instanceof Vc(t).SVGGraphicsElement}:function(t){return t instanceof Vc(t).SVGElement&&typeof t.getBBox=="function"}}();function ox(t){return t===Vc(t).document.documentElement}function sx(t){return qg?ix(t)?rx(t):nx(t):WS}function ax(t){var e=t.x,r=t.y,o=t.width,a=t.height,l=typeof DOMRectReadOnly!="undefined"?DOMRectReadOnly:Object,d=Object.create(l.prototype);return KS(d,{x:e,y:r,width:o,height:a,top:r,right:e+o,bottom:a+r,left:e}),d}function Bh(t,e,r,o){return{x:t,y:e,width:r,height:o}}var cx=function(){function t(e){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=Bh(0,0,0,0),this.target=e}return t.prototype.isActive=function(){var e=sx(this.target);return this.contentRect_=e,e.width!==this.broadcastWidth||e.height!==this.broadcastHeight},t.prototype.broadcastRect=function(){var e=this.contentRect_;return this.broadcastWidth=e.width,this.broadcastHeight=e.height,e},t}(),lx=function(){function t(e,r){var o=ax(r);KS(this,{target:e,contentRect:o})}return t}(),ux=function(){function t(e,r,o){if(this.activeObservations_=[],this.observations_=new HS,typeof e!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=e,this.controller_=r,this.callbackCtx_=o}return t.prototype.observe=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element=="undefined"||!(Element instanceof Object))){if(!(e instanceof Vc(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var r=this.observations_;r.has(e)||(r.set(e,new cx(e)),this.controller_.addObserver(this),this.controller_.refresh())}},t.prototype.unobserve=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element=="undefined"||!(Element instanceof Object))){if(!(e instanceof Vc(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var r=this.observations_;!r.has(e)||(r.delete(e),r.size||this.controller_.removeObserver(this))}},t.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},t.prototype.gatherActive=function(){var e=this;this.clearActive(),this.observations_.forEach(function(r){r.isActive()&&e.activeObservations_.push(r)})},t.prototype.broadcastActive=function(){if(!!this.hasActive()){var e=this.callbackCtx_,r=this.activeObservations_.map(function(o){return new lx(o.target,o.broadcastRect())});this.callback_.call(e,r,e),this.clearActive()}},t.prototype.clearActive=function(){this.activeObservations_.splice(0)},t.prototype.hasActive=function(){return this.activeObservations_.length>0},t}(),qS=typeof WeakMap!="undefined"?new WeakMap:new HS,JS=function(){function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var r=ex.getInstance(),o=new ux(e,r,this);qS.set(this,o)}return t}();["observe","unobserve","disconnect"].forEach(function(t){JS.prototype[t]=function(){var e;return(e=qS.get(this))[t].apply(e,arguments)}});var dx=function(){return typeof bh.ResizeObserver!="undefined"?bh.ResizeObserver:JS}();const Jg=()=>{},zg=(()=>{try{return!(typeof window!="undefined"&&document!==void 0)}catch{return!0}})(),hx=(()=>zg?Jg:(t,e,r,o=!1)=>{t.addEventListener(e,r,o)})(),px=(()=>zg?Jg:(t,e,r,o=!1)=>{t.removeEventListener(e,r,o)})(),zS=t=>{let e=t.el;for(;e&&!e.tagName;)e=e.nextSibling;return e},fx=t=>{const e=document.createElement("div");return e.setAttribute("class",`arco-overlay arco-overlay-${t}`),e},Ax=t=>zg?Jg():document.querySelector(t),gx=t=>MS(t)?Ax(t):t||void 0;var mx=Nn({name:"ResizeObserver",emits:["resize"],setup(t,{emit:e,slots:r}){let o;const a=g=>zS(g.vnode),l=g=>zS(g.subTree),d=g=>{!g||(o=new dx(v=>{const C=v[0];e("resize",C)}),o.observe(g))},p=()=>{o&&(o.disconnect(),o=null)};return Ol(()=>{const g=wd();if(g){const v=a(g);d(v)}}),Od(()=>{const g=wd();if(g){const v=a(g),C=l(g);v!==C&&(o&&p(),d(v))}else p()}),Mf(()=>{p()}),()=>{const g=r.default&&r.default();return g&&g.length?g[0]:null}}}),XS;(function(t){t[t.ELEMENT=1]="ELEMENT",t[t.FUNCTIONAL_COMPONENT=2]="FUNCTIONAL_COMPONENT",t[t.STATEFUL_COMPONENT=4]="STATEFUL_COMPONENT",t[t.TEXT_CHILDREN=8]="TEXT_CHILDREN",t[t.ARRAY_CHILDREN=16]="ARRAY_CHILDREN",t[t.SLOTS_CHILDREN=32]="SLOTS_CHILDREN",t[t.TELEPORT=64]="TELEPORT",t[t.SUSPENSE=128]="SUSPENSE",t[t.COMPONENT_SHOULD_KEEP_ALIVE=256]="COMPONENT_SHOULD_KEEP_ALIVE",t[t.COMPONENT_KEPT_ALIVE=512]="COMPONENT_KEPT_ALIVE",t[t.COMPONENT=6]="COMPONENT"})(XS||(XS={}));const vx=t=>(t==null?void 0:t.$)!==void 0,Ex=t=>t&&t.shapeFlag&1,Ix=(t,e)=>Boolean(t&&t.shapeFlag&6),Cx=(t,e)=>Boolean(t&&t.shapeFlag&16),yx=t=>{if(!t)return!0;for(const e of t)if(e.children)return!1;return!0},$S=(t,e)=>{for(let r=0;r<t.length;r++){const o=t[r];if(Ex(o)||Ix(o)){const a=Kg(e)?e(o):e;return t[r]=tO(o,a,!0),!0}if(Cx(o,o.children)&&$S(o.children,e))return!0}return!1};function _x(t,e){const r=On(t[e]);return Od(()=>{const o=t[e];r.value!==o&&(r.value=o)}),r}const ZS=Symbol("ArcoTrigger"),eT=Symbol("ArcoZIndex"),tT=typeof window=="undefined"?global:window,Sx=tT.requestAnimationFrame,rT=tT.cancelAnimationFrame;function Tx(t){let e=0;const r=(...o)=>{e&&rT(e),e=Sx(()=>{t(...o),e=0})};return r.cancel=()=>{rT(e),e=0},r}var Rx=Object.defineProperty,wx=Object.defineProperties,Nx=Object.getOwnPropertyDescriptors,nT=Object.getOwnPropertySymbols,Ox=Object.prototype.hasOwnProperty,kx=Object.prototype.propertyIsEnumerable,iT=(t,e,r)=>e in t?Rx(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,oT=(t,e)=>{for(var r in e||(e={}))Ox.call(e,r)&&iT(t,r,e[r]);if(nT)for(var r of nT(e))kx.call(e,r)&&iT(t,r,e[r]);return t},bx=(t,e)=>wx(t,Nx(e));function Dx(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!fC(t)}const Bx=100;var Xg=Nn({name:"Trigger",inheritAttrs:!1,props:{popupVisible:{type:Boolean,default:void 0},defaultPopupVisible:{type:Boolean,default:!1},trigger:{type:[String,Array],default:"hover",validator:t=>{const e=[].concat(t);for(const r of e)if(!FS.includes(r))return!1;return!0}},position:{type:String,default:"bottom"},disabled:{type:Boolean,default:!1},popupOffset:{type:Number,default:0},popupTranslate:{type:[Array,Object]},showArrow:{type:Boolean,default:!1},alignPoint:{type:Boolean,default:!1},popupHoverStay:{type:Boolean,default:!0},blurToClose:{type:Boolean,default:!0},clickToClose:{type:Boolean,default:!0},clickOutsideToClose:{type:Boolean,default:!0},unmountOnClose:{type:Boolean,default:!0},contentClass:{type:[String,Array,Object]},contentStyle:{type:Object},arrowClass:{type:[String,Array,Object]},arrowStyle:{type:Object},popupStyle:{type:Object},animationName:{type:String,default:"fade-in"},duration:{type:[Number,Object]},mouseEnterDelay:{type:Number,default:100},mouseLeaveDelay:{type:Number,default:100},focusDelay:{type:Number,default:0},autoFitPopupWidth:{type:Boolean,default:!1},autoFitPopupMinWidth:{type:Boolean,default:!1},autoFixPosition:{type:Boolean,default:!0},popupContainer:{type:[String,Object]},updateAtScroll:{type:Boolean,default:!1},autoFitTransformOrigin:{type:Boolean,default:!1},hideEmpty:{type:Boolean,default:!1},openedCls:{type:String},autoFitPosition:{type:Boolean,default:!0},renderToBody:{type:Boolean,default:!0},onPopupVisibleChange:{type:Function}},emits:["update:popupVisible","popupVisibleChange"],setup(t,{emit:e,slots:r,attrs:o}){var a;const l=Fo("trigger"),d=oi(()=>[].concat(t.trigger)),p=new Set,g=Bf(ZS,void 0),v=Bf(eT,void 0),C=((a=v==null?void 0:v.zIndex)!=null?a:0)+Bx,y=On(),w=oi(()=>vx(y.value)?y.value.$el:y.value),k={},M=On(),x=On(t.defaultPopupVisible),V=On(t.position),Y={},H=On({}),he=On({}),Q=oi(()=>{var Ue;return gx((Ue=t.popupContainer)!=null?Ue:document.documentElement)}),pe=On(),oe=On({top:"0px",left:"0px"}),me=oi(()=>{var Ue;return(Ue=t.popupVisible)!=null?Ue:x.value});let xe=0,Pe=!1;const De=()=>{xe&&(window.clearTimeout(xe),xe=0)},Kt=Ue=>{if(t.alignPoint){const{pageX:Ot,pageY:ir}=Ue;oe.value={top:`${ir}px`,left:`${Ot}px`}}},mt=()=>{if(t.alignPoint)H.value=oe.value;else{if(!w.value||!M.value||!Q.value)return;const Ue=Q.value.getBoundingClientRect(),Ot=jS(w.value,Ue),ir=jS(M.value,Ue),{style:rr,position:Wr}=H4(t.position,Ue,Ot,ir,{offset:t.popupOffset,translate:t.popupTranslate,customStyle:t.popupStyle,autoFitPosition:t.autoFitPosition,autoFitTransformOrigin:t.autoFitTransformOrigin});t.autoFitPopupMinWidth?rr.minWidth=`${Ot.width}px`:t.autoFitPopupWidth&&(rr.width=`${Ot.width}px`),V.value!==Wr&&(V.value=Wr),H.value=rr,t.showArrow&&(he.value=K4(Wr,Ot,{customStyle:t.arrowStyle}))}},rt=(Ue,Ot)=>{if(Ue===me.value&&xe===0)return;const ir=()=>{x.value=Ue,e("update:popupVisible",Ue),e("popupVisibleChange",Ue),Ue&&lC(()=>{mt()})};Ot?(De(),xe=window.setTimeout(ir,Ot)):ir()},Er=Ue=>{me.value&&!t.clickToClose||(Kt(Ue),rt(!me.value))},Nt=Ue=>{g==null||g.onMouseenter(),Kt(Ue),rt(!0,t.mouseEnterDelay)},yt=()=>{g==null||g.onMouseleave(),rt(!1,t.mouseLeaveDelay)},lr=()=>{g==null||g.onFocusin(),rt(!0,t.focusDelay)},Ir=()=>{g==null||g.onFocusout(),!!t.blurToClose&&rt(!1)};d.value.includes("click")&&(k.onClick=Er),d.value.includes("hover")&&(k.onMouseenter=Nt,k.onMouseleave=yt,t.popupHoverStay&&(Y.onMouseenter=Nt,Y.onMouseleave=yt)),d.value.includes("focus")&&(k.onFocusin=lr,k.onFocusout=Ir),d.value.includes("contextMenu")&&(k.onContextmenu=Ue=>{Ue.preventDefault(),Er(Ue)}),hC(ZS,Aa({onMouseenter:Nt,onMouseleave:yt,onFocusin:lr,onFocusout:Ir,addChildRef:Ue=>{p.add(Ue),g==null||g.addChildRef(Ue)},removeChildRef:Ue=>{p.delete(Ue),g==null||g.removeChildRef(Ue)}})),hC(eT,Aa({zIndex:C}));const ui=()=>{px(document.body,"mousedown",yn),Pe=!1},on=_x(r,"content"),ki=oi(()=>{var Ue;return t.hideEmpty&&yx((Ue=on.value)==null?void 0:Ue.call(on))}),yn=Ue=>{var Ot,ir,rr;if(!(((Ot=w.value)==null?void 0:Ot.contains(Ue.target))||((ir=M.value)==null?void 0:ir.contains(Ue.target)))){for(const Wr of p)if((rr=Wr.value)==null?void 0:rr.contains(Ue.target))return;ui(),rt(!1)}},Vr=Tx(()=>{me.value&&mt()}),di=()=>{me.value&&mt()};g==null||g.addChildRef(M);const go=oi(()=>me.value?t.openedCls:void 0);let _n;return pC(me,Ue=>{if(t.clickOutsideToClose){if(Pe&&!Ue){ui();return}Pe||(hx(document.body,"mousedown",yn),Pe=!0)}if(t.updateAtScroll){if(Ue){_n=Y4(w.value);for(const Ot of _n)Ot.addEventListener("scroll",Vr)}else if(_n)for(const Ot of _n)Ot.removeEventListener("scroll",Vr)}}),pC(()=>[t.autoFitPopupWidth,t.autoFitPopupMinWidth],()=>{me.value&&mt()}),Ol(()=>{me.value&&mt()}),Od(()=>{me.value&&mt()}),Rd(()=>{g==null||g.removeChildRef(M)}),()=>{var Ue,Ot,ir;const rr=(Ot=(Ue=r.default)==null?void 0:Ue.call(r))!=null?Ot:[];return!t.disabled&&rr&&$S(rr,oT({ref:y,class:go.value},k)),er(ts,null,[t.autoFixPosition?er(mx,{onResize:di},Dx(rr)?rr:{default:()=>[rr]}):rr,er(uC,{to:(ir=t.popupContainer)!=null?ir:"body",disabled:!t.renderToBody},{default:()=>[er(rO,{name:t.animationName,duration:t.duration},{default:()=>{var Wr;return[(!t.unmountOnClose||me.value)&&!ki.value&&AC(er("div",dC({ref:M,class:[`${l}-popup`,`${l}-position-${V.value}`],style:bx(oT({},H.value),{zIndex:C}),"trigger-placement":V.value},Y,{onMousedown:mo=>mo.preventDefault()},o),[er("div",{class:[`${l}-content`,t.contentClass],style:t.contentStyle},[(Wr=r.content)==null?void 0:Wr.call(r)]),t.showArrow&&er("div",{ref:pe,class:[`${l}-arrow`,t.arrowClass],style:he.value},null)]),[[nO,me.value]])]}})]})])}}});const Mx=Object.assign(Xg,{install:(t,e)=>{QS(t,e);const r=xS(e);t.component(r+Xg.name,Xg)}}),Lx=Nn({name:"IconCheckCircleFill",props:{strokeWidth:{type:Number,default:4},strokeLinecap:{type:String,default:"butt",validator:t=>["butt","round","square"].includes(t)},strokeLinejoin:{type:String,default:"miter",validator:t=>["arcs","bevel","miter","miter-clip","round"].includes(t)},spin:Boolean},setup(t){const e=Fo("icon");return{cls:oi(()=>[e,`${e}-check-circle-fill`,{[`${e}-spin`]:t.spin}])}}}),Px=["stroke-width","stroke-linecap","stroke-linejoin"],xx=lt("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M24 44c11.046 0 20-8.954 20-20S35.046 4 24 4 4 12.954 4 24s8.954 20 20 20Zm10.207-24.379a1 1 0 0 0 0-1.414l-1.414-1.414a1 1 0 0 0-1.414 0L22 26.172l-4.878-4.88a1 1 0 0 0-1.415 0l-1.414 1.415a1 1 0 0 0 0 1.414l7 7a1 1 0 0 0 1.414 0l11.5-11.5Z",fill:"currentColor",stroke:"none"},null,-1),Qx=[xx];function Ux(t,e,r,o,a,l){return bt(),mr("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:hn(t.cls),"stroke-width":t.strokeWidth,"stroke-linecap":t.strokeLinecap,"stroke-linejoin":t.strokeLinejoin},Qx,10,Px)}var $g=js(Lx,[["render",Ux]]);const Fx=Object.assign($g,{install:(t,e)=>{var r;const o=(r=e==null?void 0:e.iconPrefix)!=null?r:"";t.component(o+$g.name,$g)}}),Vx=Nn({name:"Popover",components:{Trigger:Mx},props:{popupVisible:{type:Boolean,default:void 0},defaultPopupVisible:{type:Boolean,default:!1},title:String,content:String,trigger:{type:[String,Array],default:"hover",validator:t=>{const e=[].concat(t);for(const r of e)if(!FS.includes(r))return!1;return!0}},position:{type:String,default:"top",validator:t=>N4.includes(t)},contentClass:{type:[String,Array,Object]},contentStyle:{type:Object},arrowClass:{type:[String,Array,Object]},arrowStyle:{type:Object},popupContainer:{type:[String,Object]}},emits:["update:popupVisible","popupVisibleChange"],setup(t,{emit:e}){const r=Fo("popover"),o=On(t.defaultPopupVisible),a=oi(()=>{var g;return(g=t.popupVisible)!=null?g:o.value}),l=g=>{o.value=g,e("update:popupVisible",g),e("popupVisibleChange",g)},d=oi(()=>[`${r}-popup-content`,t.contentClass]),p=oi(()=>[`${r}-popup-arrow`,t.arrowClass]);return{prefixCls:r,computedPopupVisible:a,contentCls:d,arrowCls:p,handlePopupVisibleChange:l}}});function Gx(t,e,r,o,a,l){const d=co("trigger");return bt(),ko(d,{class:hn(t.prefixCls),trigger:t.trigger,position:t.position,"popup-visible":t.computedPopupVisible,"popup-offset":10,"content-class":t.contentCls,"content-style":t.contentStyle,"arrow-class":t.arrowCls,"arrow-style":t.arrowStyle,"show-arrow":"","popup-container":t.popupContainer,onPopupVisibleChange:t.handlePopupVisibleChange},{content:Ss(()=>[lt("div",{class:hn(`${t.prefixCls}-title`)},[Ec(t.$slots,"title",{},()=>[Nd(_s(t.title),1)])],2),lt("div",{class:hn(`${t.prefixCls}-content`)},[Ec(t.$slots,"content",{},()=>[Nd(_s(t.content),1)])],2)]),default:Ss(()=>[Ec(t.$slots,"default")]),_:3},8,["class","trigger","position","popup-visible","content-class","content-style","arrow-class","arrow-style","popup-container","onPopupVisibleChange"])}var Zg=js(Vx,[["render",Gx]]);const jx=Object.assign(Zg,{install:(t,e)=>{QS(t,e);const r=xS(e);t.component(r+Zg.name,Zg)}}),Hx=Nn({name:"IconExclamationCircleFill",props:{strokeWidth:{type:Number,default:4},strokeLinecap:{type:String,default:"butt",validator:t=>["butt","round","square"].includes(t)},strokeLinejoin:{type:String,default:"miter",validator:t=>["arcs","bevel","miter","miter-clip","round"].includes(t)},spin:Boolean},setup(t){const e=Fo("icon");return{cls:oi(()=>[e,`${e}-exclamation-circle-fill`,{[`${e}-spin`]:t.spin}])}}}),Kx=["stroke-width","stroke-linecap","stroke-linejoin"],Wx=lt("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M24 44c11.046 0 20-8.954 20-20S35.046 4 24 4 4 12.954 4 24s8.954 20 20 20Zm-2-11a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1h-2a1 1 0 0 0-1 1v2Zm4-18a1 1 0 0 0-1-1h-2a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1V15Z",fill:"currentColor",stroke:"none"},null,-1),Yx=[Wx];function qx(t,e,r,o,a,l){return bt(),mr("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:hn(t.cls),"stroke-width":t.strokeWidth,"stroke-linecap":t.strokeLinecap,"stroke-linejoin":t.strokeLinejoin},Yx,10,Kx)}var em=js(Hx,[["render",qx]]);const Jx=Object.assign(em,{install:(t,e)=>{var r;const o=(r=e==null?void 0:e.iconPrefix)!=null?r:"";t.component(o+em.name,em)}}),zx=Nn({name:"IconInfoCircleFill",props:{strokeWidth:{type:Number,default:4},strokeLinecap:{type:String,default:"butt",validator:t=>["butt","round","square"].includes(t)},strokeLinejoin:{type:String,default:"miter",validator:t=>["arcs","bevel","miter","miter-clip","round"].includes(t)},spin:Boolean},setup(t){const e=Fo("icon");return{cls:oi(()=>[e,`${e}-info-circle-fill`,{[`${e}-spin`]:t.spin}])}}}),Xx=["stroke-width","stroke-linecap","stroke-linejoin"],$x=lt("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M24 44c11.046 0 20-8.954 20-20S35.046 4 24 4 4 12.954 4 24s8.954 20 20 20Zm2-30a1 1 0 0 0-1-1h-2a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1v-2Zm0 17h1a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1h-6a1 1 0 0 1-1-1v-2a1 1 0 0 1 1-1h1v-8a1 1 0 0 1-1-1v-2a1 1 0 0 1 1-1h3a1 1 0 0 1 1 1v11Z",fill:"currentColor",stroke:"none"},null,-1),Zx=[$x];function eQ(t,e,r,o,a,l){return bt(),mr("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:hn(t.cls),"stroke-width":t.strokeWidth,"stroke-linecap":t.strokeLinecap,"stroke-linejoin":t.strokeLinejoin},Zx,10,Xx)}var tm=js(zx,[["render",eQ]]);const tQ=Object.assign(tm,{install:(t,e)=>{var r;const o=(r=e==null?void 0:e.iconPrefix)!=null?r:"";t.component(o+tm.name,tm)}}),rQ=Nn({name:"IconCloseCircleFill",props:{strokeWidth:{type:Number,default:4},strokeLinecap:{type:String,default:"butt",validator:t=>["butt","round","square"].includes(t)},strokeLinejoin:{type:String,default:"miter",validator:t=>["arcs","bevel","miter","miter-clip","round"].includes(t)},spin:Boolean},setup(t){const e=Fo("icon");return{cls:oi(()=>[e,`${e}-close-circle-fill`,{[`${e}-spin`]:t.spin}])}}}),nQ=["stroke-width","stroke-linecap","stroke-linejoin"],iQ=lt("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M24 44c11.046 0 20-8.954 20-20S35.046 4 24 4 4 12.954 4 24s8.954 20 20 20Zm4.955-27.771-4.95 4.95-4.95-4.95a1 1 0 0 0-1.414 0l-1.414 1.414a1 1 0 0 0 0 1.414l4.95 4.95-4.95 4.95a1 1 0 0 0 0 1.414l1.414 1.414a1 1 0 0 0 1.414 0l4.95-4.95 4.95 4.95a1 1 0 0 0 1.414 0l1.414-1.414a1 1 0 0 0 0-1.414l-4.95-4.95 4.95-4.95a1 1 0 0 0 0-1.414l-1.414-1.414a1 1 0 0 0-1.414 0Z",fill:"currentColor",stroke:"none"},null,-1),oQ=[iQ];function sQ(t,e,r,o,a,l){return bt(),mr("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:hn(t.cls),"stroke-width":t.strokeWidth,"stroke-linecap":t.strokeLinecap,"stroke-linejoin":t.strokeLinejoin},oQ,10,nQ)}var rm=js(rQ,[["render",sQ]]);const aQ=Object.assign(rm,{install:(t,e)=>{var r;const o=(r=e==null?void 0:e.iconPrefix)!=null?r:"";t.component(o+rm.name,rm)}}),cQ=Nn({name:"Message",components:{AIconHover:b4,IconInfoCircleFill:tQ,IconCheckCircleFill:Fx,IconExclamationCircleFill:Jx,IconCloseCircleFill:aQ,IconClose:x4},props:{type:{type:String,default:"info",validator:t=>US.includes(t)},closable:{type:Boolean,default:!1},showIcon:{type:Boolean,default:!0},duration:{type:Number,default:3e3},resetOnUpdate:{type:Boolean,default:!1}},emits:["close"],setup(t,{emit:e}){const r=Fo("message");let o=0;const a=()=>{e("close")};return Ol(()=>{t.duration>0&&(o=window.setTimeout(a,t.duration))}),Od(()=>{t.resetOnUpdate&&(o&&(window.clearTimeout(o),o=0),t.duration>0&&(o=window.setTimeout(a,t.duration)))}),Mf(()=>{o&&window.clearTimeout(o)}),{prefixCls:r,handleClose:a}}});function lQ(t,e,r,o,a,l){const d=co("icon-info-circle-fill"),p=co("icon-check-circle-fill"),g=co("icon-exclamation-circle-fill"),v=co("icon-close-circle-fill"),C=co("icon-close"),y=co("a-icon-hover");return bt(),mr("li",{class:hn([t.prefixCls,`${t.prefixCls}-${t.type}`,{[`${t.prefixCls}-closable`]:t.closable}])},[t.showIcon?(bt(),mr("span",{key:0,class:hn(`${t.prefixCls}-icon`)},[Ec(t.$slots,"icon",{},()=>[t.type==="info"?(bt(),ko(d,{key:0})):t.type==="success"?(bt(),ko(p,{key:1})):t.type==="warning"?(bt(),ko(g,{key:2})):t.type==="error"?(bt(),ko(v,{key:3})):vc("v-if",!0)])],2)):vc("v-if",!0),lt("span",{class:hn(`${t.prefixCls}-content`)},[Ec(t.$slots,"default")],2),t.closable?(bt(),mr("span",{key:1,class:hn(`${t.prefixCls}-close-btn`),onClick:e[0]||(e[0]=(...w)=>t.handleClose&&t.handleClose(...w))},[er(y,null,{default:Ss(()=>[er(C)]),_:1})],2)):vc("v-if",!0)],2)}var uQ=js(cQ,[["render",lQ]]);const dQ=["top","bottom"];function hQ(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!fC(t)}var pQ=Nn({name:"MessageList",props:{messages:{type:Array,default:()=>[]},position:{type:String,default:"top",validator:t=>dQ.includes(t)}},emits:["close"],setup(t,e){const r=Fo("message-list");return()=>{let o;return er(iO,{class:[r,`${r}-${t.position}`],name:"fade-message",tag:"ul"},hQ(o=t.messages.map(a=>{const l={default:()=>Kg(a.content)?a.content():a.content,icon:()=>Kg(a.icon)?a.icon():a.icon};return er(uQ,{key:a.id,type:a.type,duration:a.duration,closable:a.closable,resetOnUpdate:a.resetOnUpdate,onClose:()=>e.emit("close",a.id)},l)}))?o:{default:()=>[o]})}}}),fQ=Object.defineProperty,AQ=Object.defineProperties,gQ=Object.getOwnPropertyDescriptors,sT=Object.getOwnPropertySymbols,mQ=Object.prototype.hasOwnProperty,vQ=Object.prototype.propertyIsEnumerable,aT=(t,e,r)=>e in t?fQ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Mh=(t,e)=>{for(var r in e||(e={}))mQ.call(e,r)&&aT(t,r,e[r]);if(sT)for(var r of sT(e))vQ.call(e,r)&&aT(t,r,e[r]);return t},cT=(t,e)=>AQ(t,gQ(e));class EQ{constructor(e,r){this.messageCount=0,this.add=l=>{var d;this.messageCount++;const p=(d=l.id)!=null?d:`__arco_message_${this.messageCount}`;if(this.messageIds.has(p))return this.update(p,l);const g=Aa(Mh({id:p},l));return this.messages.value.push(g),this.messageIds.add(p),{close:()=>this.remove(p)}},this.update=(l,d)=>{for(let p=0;p<this.messages.value.length;p++)if(this.messages.value[p].id===l){const g=!m4(d.duration);Object.assign(this.messages.value[p],cT(Mh({},d),{id:l,resetOnUpdate:g}));break}return{close:()=>this.remove(l)}},this.remove=l=>{for(let d=0;d<this.messages.value.length;d++)if(this.messages.value[d].id===l){this.messages.value.splice(d,1),this.messageIds.delete(l);break}},this.clear=()=>{this.messages.value.splice(0)};const{position:o}=e;this.container=fx("message"),this.messageIds=new Set,this.messages=On([]);const a=er(pQ,{messages:this.messages.value,position:o,onClose:this.remove});r&&(a.appContext=r),oO(a,this.container),document.body.appendChild(this.container)}}const yu={},nm=US.reduce((t,e)=>(t[e]=r=>{MS(r)&&(r={content:r});const o=Mh({type:e},r),{position:a="top"}=o;return yu[a]||(yu[a]=new EQ(o)),yu[a].add(o)},t),{});nm.clear=t=>{var e;t?(e=yu[t])==null||e.clear():Object.values(yu).forEach(r=>r.clear())};const IQ=cT(Mh({},nm),{install:t=>{t.config.globalProperties.$message=nm}});const Hs=t=>(gC("data-v-914726f0"),t=t(),mC(),t),CQ={as:"nav",class:"bg-gray-800 rounded-b-md fixed top-0 w-full z-10"},yQ={class:"max-w-7xl mx-auto px-2 sm:px-6 lg:px-8"},_Q={class:"relative flex items-center justify-between h-16"},SQ={class:"flex-1 flex items-center justify-center sm:justify-start"},TQ={class:"absolute inset-y-0 inset-x-0 right-0 flex items-center px-2 sm:static sm:inset-auto sm:pr-0"},RQ={class:"video-btn mr-4"},wQ=Hs(()=>lt("span",{class:"sr-only"},"Open live",-1)),NQ={class:"w-80"},OQ=Hs(()=>lt("div",null,"\u656C\u8BF7\u671F\u5F85~",-1)),kQ=Hs(()=>lt("hr",{class:"my-4"},null,-1)),bQ={class:"flex items-center"},DQ=Hs(()=>lt("div",{class:"w-24 text-right"},"\u5206\u4EAB\u6A21\u5F0F\uFF1A",-1)),BQ={class:"w-40"},MQ=Hs(()=>lt("button",{class:"close-btn"},"\u5173\u95ED",-1)),LQ=Hs(()=>lt("div",{class:"flex-grow"},null,-1)),PQ=Hs(()=>lt("span",{class:"sr-only"},"Copy Share Link",-1)),xQ=Hs(()=>lt("div",{class:"leave-btn"},"\u79BB\u5F00",-1)),QQ={setup(t){const e=window.location.href,r=()=>{navigator.clipboard.writeText(e),IQ.success("\u5DF2\u6210\u529F\u590D\u5236\u9080\u8BF7\u94FE\u63A5\uFF01")};return(o,a)=>(bt(),mr("nav",CQ,[lt("div",yQ,[lt("div",_Q,[lt("div",SQ,[er(ga,{name:"logo",class:"h-8 w-8"})]),lt("div",TQ,[er(Oo(jx),null,{content:Ss(()=>[lt("div",NQ,[OQ,kQ,lt("div",bQ,[DQ,lt("div",BQ,[er(A4)]),MQ])])]),default:Ss(()=>[lt("button",RQ,[wQ,er(ga,{name:"toolbar-live",class:"h-6 w-6"})])]),_:1}),LQ,lt("button",{title:"\u70B9\u51FB\u5206\u4EAB\u6B64\u623F\u95F4",class:"text-gray-300 hover:text-white cursor-pointer mr-4",onClick:r},[PQ,er(ga,{name:"toolbar-share",class:"inline-block h-5 w-5"})]),xQ])])])]))}};var UQ=Dl(QQ,[["__scopeId","data-v-914726f0"]]);const FQ=t=>(gC("data-v-5aa22a46"),t=t(),mC(),t),VQ={class:"relative"},GQ={class:"absolute flex left-0 right-0 group-hover:bg-gray-800 text-white p-1 transition"},jQ={class:"sm-btn w-5 bg-indigo-600 text-center overflow-hidden",title:"\u70B9\u51FB\u5206\u4EAB\u6B64\u623F\u95F4"},HQ={class:"sm-btn",title:"\u70B9\u51FB\u5206\u4EAB\u6B64\u623F\u95F4"},KQ={class:"sm-btn",title:"\u70B9\u51FB\u5206\u4EAB\u6B64\u623F\u95F4"},WQ=FQ(()=>lt("div",{class:"flex-1"},null,-1)),YQ=["onClick"];function qQ(t,{emit:e}){const r=t,o=On(null);sO(window,"resize",()=>{const l=window.getComputedStyle(o.value,null),d=+l.left.replace(/\px/g,""),p=+l.top.replace(/\px/g,"");(d<0||p<0)&&(o.value.style.right="8px",o.value.style.bottom="8px")});const a=()=>{};return Mf(()=>{}),(l,d)=>{const p=aO("drag");return AC((bt(),mr("div",{ref:(g,v)=>{v.target=g,o.value=g},class:hn(["fixed min-w-[10rem] min-h-[8rem] right-2 select-none z-10 bg-gray-100 rounded overflow-hidden border-4 border-indigo-300 shadow-md hover:shadow-lg transition group",t.className])},[lt("div",VQ,[lt("div",GQ,[lt("div",jQ,_s(r.name[0]),1),lt("button",HQ,[er(ga,{name:"live-camera-off",class:"w-5 h-5"})]),lt("button",KQ,[er(ga,{name:"live-mic-off",class:"w-5 h-5"})]),WQ,lt("button",{class:"close-btn",onClick:d[0]||(d[0]=g=>l.$emit("close",r.name)),title:"\u70B9\u51FB\u5206\u4EAB\u6B64\u623F\u95F4"},[er(ga,{name:"close",class:"h-5 w-5"})])]),lt("div",{class:"cursor-pointer",onMousedown:d[1]||(d[1]=vC(()=>{},["self","stop"])),onClick:vC(a,["self","stop"])},null,40,YQ)])],2)),[[p]])}}const JQ={directives:{drag:{mounted(t){t.style.cursor="move";const e=window.getComputedStyle(t,null);t.onmousedown=r=>{const o=r.clientX,a=r.clientY,l=+e.right.replace(/\px/g,""),d=+e.bottom.replace(/\px/g,""),p=+e.width.replace(/\px/g,""),g=+e.height.replace(/\px/g,""),v=window.innerWidth,C=window.innerHeight;document.onmousemove=function(y){const w=y.clientX-o,k=y.clientY-a,M=l-w,x=d-k;M<0||x<0||M>v-p||x>C-g||(t.style.right=M+"px",t.style.bottom=x+"px")},document.onmouseup=function(y){document.onmousemove=null,document.onmouseup=null}}}}}},zQ=Object.assign(JQ,{props:{name:{type:String,default:"me"},className:{type:String,default:"bottom-2"}},emits:["close"],setup:qQ});var lT=Dl(zQ,[["__scopeId","data-v-5aa22a46"]]),uT={exports:{}};(function(t,e){(function(r,o){t.exports=o()})(Uf,function(){function r(i,n,s){return i(s={path:n,exports:{},require:function(c,u){throw Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}},s.exports),s.exports}function o(i,n,s){return(i=i.match(n))&&i.length>=s&&pr(i[s],10)}function a(i,n,s){if(i.RTCPeerConnection){i=i.RTCPeerConnection.prototype;var c=i.addEventListener;i.addEventListener=function(h,f){if(h!==n)return c.apply(this,arguments);let A=m=>{(m=s(m))&&f(m)};return this._eventMap=this._eventMap||{},this._eventMap[f]=A,c.apply(this,[h,A])};var u=i.removeEventListener;i.removeEventListener=function(h,f){if(h!==n||!this._eventMap||!this._eventMap[f])return u.apply(this,arguments);let A=this._eventMap[f];return delete this._eventMap[f],u.apply(this,[h,A])},ft(i,"on"+n,{get(){return this["_on"+n]},set(h){this["_on"+n]&&(this.removeEventListener(n,this["_on"+n]),delete this["_on"+n]),h&&this.addEventListener(n,this["_on"+n]=h)},enumerable:!0,configurable:!0})}}function l(i){return typeof i!="boolean"?Error("Argument type: "+typeof i+". Please use a boolean."):(Jv=i,i?"adapter.js logging disabled":"adapter.js logging enabled")}function d(i){return typeof i!="boolean"?Error("Argument type: "+typeof i+". Please use a boolean."):(zv=!i,"adapter.js deprecation warnings "+(i?"disabled":"enabled"))}function p(){typeof window!="object"||Jv||typeof console!="undefined"&&typeof console.log=="function"&&console.log.apply(console,arguments)}function g(i,n){zv&&console.warn(i+" is deprecated, please use "+n+" instead.")}function v(i){let{navigator:n}=i,s={browser:null,version:null};if(i===void 0||!i.navigator)return s.browser="Not a browser.",s;if(n.mozGetUserMedia)s.browser="firefox",s.version=o(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||i.isSecureContext===!1&&i.webkitRTCPeerConnection&&!i.RTCIceGatherer)s.browser="chrome",s.version=o(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(n.mediaDevices&&n.userAgent.match(/Edge\/(\d+).(\d+)$/))s.browser="edge",s.version=o(n.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!i.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return s.browser="Not a supported browser.",s;s.browser="safari",s.version=o(n.userAgent,/AppleWebKit\/(\d+)\./,1),s.supportsUnifiedPlan=i.RTCRtpTransceiver&&"currentDirection"in i.RTCRtpTransceiver.prototype}return s}function C(i){var n;return Object.prototype.toString.call(i)==="[object Object]"?Ju(n=pt(i)).call(n,function(s,c){var u=Object.prototype.toString.call(i[c])==="[object Object]";let h=u?C(i[c]):i[c];return u=u&&!pt(h).length,h===void 0||u?s:cn(s,{[c]:h})},{}):i}function y(i,n,s){let c=s?"outbound-rtp":"inbound-rtp",u=new Tt;if(n===null)return u;let h=[];return K(i).call(i,f=>{f.type==="track"&&f.trackIdentifier===n.id&&h.push(f)}),K(h).call(h,f=>{K(i).call(i,A=>{A.type===c&&A.trackId===f.id&&function m(I,E,_){var S;E&&!_.has(E.id)&&(_.set(E.id,E),K(S=pt(E)).call(S,N=>{if(Vv(N).call(N,"Id"))m(I,I.get(E[N]),_);else if(Vv(N).call(N,"Ids")){var O;K(O=E[N]).call(O,B=>{m(I,I.get(B),_)})}}))}(i,A,u)})}),u}function w(i){let n=i&&i.navigator;if(n.mediaDevices){var s=v(i),c=function(A){var m;if(typeof A!="object"||A.mandatory||A.optional)return A;const I={};var E;return K(m=pt(A)).call(m,_=>{if(_!=="require"&&_!=="advanced"&&_!=="mediaSource"){var S=typeof A[_]=="object"?A[_]:{ideal:A[_]};S.exact!==void 0&&typeof S.exact=="number"&&(S.min=S.max=S.exact);var N=function(B,P){return B?B+P.charAt(0).toUpperCase()+Gr(P).call(P,1):P==="deviceId"?"sourceId":P};if(S.ideal!==void 0){I.optional=I.optional||[];let B={};typeof S.ideal=="number"?(B[N("min",_)]=S.ideal,I.optional.push(B),B={},B[N("max",_)]=S.ideal,I.optional.push(B)):(B[N("",_)]=S.ideal,I.optional.push(B))}var O;S.exact!==void 0&&typeof S.exact!="number"?(I.mandatory=I.mandatory||{},I.mandatory[N("",_)]=S.exact):K(O=["min","max"]).call(O,B=>{S[B]!==void 0&&(I.mandatory=I.mandatory||{},I.mandatory[N(B,_)]=S[B])})}}),A.advanced&&(I.optional=b(E=I.optional||[]).call(E,A.advanced)),I},u=function(A,m){if(61<=s.version)return m(A);if((A=JSON.parse(fe(A)))&&typeof A.audio=="object"){var I=function(E,_,S){_ in E&&!(S in E)&&(E[S]=E[_],delete E[_])};I((A=JSON.parse(fe(A))).audio,"autoGainControl","googAutoGainControl"),I(A.audio,"noiseSuppression","googNoiseSuppression"),A.audio=c(A.audio)}if(A&&typeof A.video=="object"){let E=A.video.facingMode;if(E=E&&(typeof E=="object"?E:{ideal:E}),I=66>s.version,!(!E||E.exact!=="user"&&E.exact!=="environment"&&E.ideal!=="user"&&E.ideal!=="environment"||n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!I)){let _;if(delete A.video.facingMode,E.exact==="environment"||E.ideal==="environment"?_=["back","rear"]:E.exact!=="user"&&E.ideal!=="user"||(_=["front"]),_)return n.mediaDevices.enumerateDevices().then(S=>{S=Qe(S).call(S,O=>O.kind==="videoinput");let N=Xe(S).call(S,O=>xE(_).call(_,B=>{var P;return vt(P=O.label.toLowerCase()).call(P,B)}));return!N&&S.length&&vt(_).call(_,"back")&&(N=S[S.length-1]),N&&(A.video.deviceId=E.exact?{exact:N.deviceId}:{ideal:N.deviceId}),A.video=c(A.video),QE("chrome: "+fe(A)),m(A)})}A.video=c(A.video)}return QE("chrome: "+fe(A)),m(A)},h=function(A){return 64<=s.version?A:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[A.name]||A.name,message:A.message,constraint:A.constraint||A.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(i=function(A,m,I){u(A,E=>{n.webkitGetUserMedia(E,m,_=>{I&&I(h(_))})})},n.getUserMedia=fr(i).call(i,n),n.mediaDevices.getUserMedia){var f;let A=fr(f=n.mediaDevices.getUserMedia).call(f,n.mediaDevices);n.mediaDevices.getUserMedia=function(m){return u(m,I=>A(I).then(E=>{var _;if(I.audio&&!E.getAudioTracks().length||I.video&&!E.getVideoTracks().length)throw K(_=E.getTracks()).call(_,S=>{S.stop()}),new DOMException("","NotFoundError");return E},E=>se.reject(h(E))))}}}}function k(i){i.MediaStream=i.MediaStream||i.webkitMediaStream}function M(i){if(typeof i!="object"||!i.RTCPeerConnection||"ontrack"in i.RTCPeerConnection.prototype)a(i,"track",n=>(n.transceiver||ft(n,"transceiver",{value:{receiver:n.receiver}}),n));else{ft(i.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(s){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=s)},enumerable:!0,configurable:!0});let n=i.RTCPeerConnection.prototype.setRemoteDescription;i.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=s=>{var c;s.stream.addEventListener("addtrack",u=>{let h;var f;i.RTCPeerConnection.prototype.getReceivers?h=Xe(f=this.getReceivers()).call(f,A=>A.track&&A.track.id===u.track.id):h={track:u.track},f=new Event("track"),f.track=u.track,f.receiver=h,f.transceiver={receiver:h},f.streams=[s.stream],this.dispatchEvent(f)}),K(c=s.stream.getTracks()).call(c,u=>{let h;var f;i.RTCPeerConnection.prototype.getReceivers?h=Xe(f=this.getReceivers()).call(f,A=>A.track&&A.track.id===u.id):h={track:u},f=new Event("track"),f.track=u,f.receiver=h,f.transceiver={receiver:h},f.streams=[s.stream],this.dispatchEvent(f)})},this.addEventListener("addstream",this._ontrackpoly)),n.apply(this,arguments)}}}function x(i){if(typeof i=="object"&&i.RTCPeerConnection&&!("getSenders"in i.RTCPeerConnection.prototype)&&"createDTMFSender"in i.RTCPeerConnection.prototype){let n=function(u,h){return{track:h,get dtmf(){return this._dtmf===void 0&&(h.kind==="audio"?this._dtmf=u.createDTMFSender(h):this._dtmf=null),this._dtmf},_pc:u}};if(!i.RTCPeerConnection.prototype.getSenders){i.RTCPeerConnection.prototype.getSenders=function(){var f;return this._senders=this._senders||[],Gr(f=this._senders).call(f)};let u=i.RTCPeerConnection.prototype.addTrack;i.RTCPeerConnection.prototype.addTrack=function(f,A){let m=u.apply(this,arguments);return m||(m=n(this,f),this._senders.push(m)),m};let h=i.RTCPeerConnection.prototype.removeTrack;i.RTCPeerConnection.prototype.removeTrack=function(f){var A;h.apply(this,arguments);let m=Ke(A=this._senders).call(A,f);var I;m!==-1&&Jr(I=this._senders).call(I,m,1)}}let s=i.RTCPeerConnection.prototype.addStream;i.RTCPeerConnection.prototype.addStream=function(u){var h;this._senders=this._senders||[],s.apply(this,[u]),K(h=u.getTracks()).call(h,f=>{this._senders.push(n(this,f))})};let c=i.RTCPeerConnection.prototype.removeStream;i.RTCPeerConnection.prototype.removeStream=function(u){var h;this._senders=this._senders||[],c.apply(this,[u]),K(h=u.getTracks()).call(h,f=>{var A;let m=Xe(A=this._senders).call(A,_=>_.track===f);var I,E;m&&Jr(I=this._senders).call(I,Ke(E=this._senders).call(E,m),1)})}}else if(typeof i=="object"&&i.RTCPeerConnection&&"getSenders"in i.RTCPeerConnection.prototype&&"createDTMFSender"in i.RTCPeerConnection.prototype&&i.RTCRtpSender&&!("dtmf"in i.RTCRtpSender.prototype)){let n=i.RTCPeerConnection.prototype.getSenders;i.RTCPeerConnection.prototype.getSenders=function(){let s=n.apply(this,[]);return K(s).call(s,c=>c._pc=this),s},ft(i.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function V(i){if(i.RTCPeerConnection){var n=i.RTCPeerConnection.prototype.getStats;i.RTCPeerConnection.prototype.getStats=function(){let[s,c,u]=arguments;if(0<arguments.length&&typeof s=="function")return n.apply(this,arguments);if(n.length===0&&(arguments.length===0||typeof s!="function"))return n.apply(this,[]);let h=function(A){const m={};return A=A.result(),K(A).call(A,I=>{var E;const _={id:I.id,timestamp:I.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[I.type]||I.type};K(E=I.names()).call(E,S=>{_[S]=I.stat(S)}),m[_.id]=_}),m},f=function(A){var m;return new Tt(Ie(m=pt(A)).call(m,I=>[I,A[I]]))};return 2<=arguments.length?n.apply(this,[function(A){c(f(h(A)))},s]):new se((A,m)=>{n.apply(this,[function(I){A(f(h(I)))},m])}).then(c,u)}}}function Y(i){if(typeof i=="object"&&i.RTCPeerConnection&&i.RTCRtpSender&&i.RTCRtpReceiver){if(!("getStats"in i.RTCRtpSender.prototype)){let s=i.RTCPeerConnection.prototype.getSenders;s&&(i.RTCPeerConnection.prototype.getSenders=function(){let u=s.apply(this,[]);return K(u).call(u,h=>h._pc=this),u});let c=i.RTCPeerConnection.prototype.addTrack;c&&(i.RTCPeerConnection.prototype.addTrack=function(){let u=c.apply(this,arguments);return u._pc=this,u}),i.RTCRtpSender.prototype.getStats=function(){let u=this;return this._pc.getStats().then(h=>y(h,u.track,!0))}}if(!("getStats"in i.RTCRtpReceiver.prototype)){let s=i.RTCPeerConnection.prototype.getReceivers;s&&(i.RTCPeerConnection.prototype.getReceivers=function(){let c=s.apply(this,[]);return K(c).call(c,u=>u._pc=this),c}),a(i,"track",c=>(c.receiver._pc=c.srcElement,c)),i.RTCRtpReceiver.prototype.getStats=function(){let c=this;return this._pc.getStats().then(u=>y(u,c.track,!1))}}if("getStats"in i.RTCRtpSender.prototype&&"getStats"in i.RTCRtpReceiver.prototype){var n=i.RTCPeerConnection.prototype.getStats;i.RTCPeerConnection.prototype.getStats=function(){if(0<arguments.length&&arguments[0]instanceof i.MediaStreamTrack){var s,c;let u=arguments[0],h,f,A;return K(s=this.getSenders()).call(s,m=>{m.track===u&&(h?A=!0:h=m)}),K(c=this.getReceivers()).call(c,m=>(m.track===u&&(f?A=!0:f=m),m.track===u)),A||h&&f?se.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):h?h.getStats():f?f.getStats():se.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return n.apply(this,arguments)}}}}function H(i){i.RTCPeerConnection.prototype.getLocalStreams=function(){var h;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Ie(h=pt(this._shimmedLocalStreams)).call(h,f=>this._shimmedLocalStreams[f][0])};let n=i.RTCPeerConnection.prototype.addTrack;i.RTCPeerConnection.prototype.addTrack=function(h,f){var A;if(!f)return n.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let m=n.apply(this,arguments);return this._shimmedLocalStreams[f.id]?Ke(A=this._shimmedLocalStreams[f.id]).call(A,m)===-1&&this._shimmedLocalStreams[f.id].push(m):this._shimmedLocalStreams[f.id]=[f,m],m};let s=i.RTCPeerConnection.prototype.addStream;i.RTCPeerConnection.prototype.addStream=function(h){var f,A,m;this._shimmedLocalStreams=this._shimmedLocalStreams||{},K(f=h.getTracks()).call(f,E=>{var _;if(Xe(_=this.getSenders()).call(_,S=>S.track===E))throw new DOMException("Track already exists.","InvalidAccessError")});let I=this.getSenders();s.apply(this,arguments),f=Qe(A=this.getSenders()).call(A,E=>Ke(I).call(I,E)===-1),this._shimmedLocalStreams[h.id]=b(m=[h]).call(m,f)};let c=i.RTCPeerConnection.prototype.removeStream;i.RTCPeerConnection.prototype.removeStream=function(h){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[h.id],c.apply(this,arguments)};let u=i.RTCPeerConnection.prototype.removeTrack;i.RTCPeerConnection.prototype.removeTrack=function(h){var f;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},h&&K(f=pt(this._shimmedLocalStreams)).call(f,A=>{var m;let I=Ke(m=this._shimmedLocalStreams[A]).call(m,h);var E;I!==-1&&Jr(E=this._shimmedLocalStreams[A]).call(E,I,1),this._shimmedLocalStreams[A].length===1&&delete this._shimmedLocalStreams[A]}),u.apply(this,arguments)}}function he(i){function n(E,_){var S;let N=_.sdp;return K(S=pt(E._reverseStreams||[])).call(S,O=>{O=E._reverseStreams[O],N=N.replace(new RegExp(E._streams[O.id].id,"g"),O.id)}),new RTCSessionDescription({type:_.type,sdp:N})}function s(E,_){var S;let N=_.sdp;return K(S=pt(E._reverseStreams||[])).call(S,O=>{O=E._reverseStreams[O],N=N.replace(new RegExp(O.id,"g"),E._streams[O.id].id)}),new RTCSessionDescription({type:_.type,sdp:N})}var c;if(i.RTCPeerConnection){var u=v(i);if(i.RTCPeerConnection.prototype.addTrack&&65<=u.version)return H(i);var h=i.RTCPeerConnection.prototype.getLocalStreams;i.RTCPeerConnection.prototype.getLocalStreams=function(){let E=h.apply(this);return this._reverseStreams=this._reverseStreams||{},Ie(E).call(E,_=>this._reverseStreams[_.id])};var f=i.RTCPeerConnection.prototype.addStream;i.RTCPeerConnection.prototype.addStream=function(E){var _;this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},K(_=E.getTracks()).call(_,S=>{var N;if(Xe(N=this.getSenders()).call(N,O=>O.track===S))throw new DOMException("Track already exists.","InvalidAccessError")}),this._reverseStreams[E.id]||(_=new i.MediaStream(E.getTracks()),this._streams[E.id]=_,this._reverseStreams[_.id]=E,E=_),f.apply(this,[E])};var A=i.RTCPeerConnection.prototype.removeStream;i.RTCPeerConnection.prototype.removeStream=function(E){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},A.apply(this,[this._streams[E.id]||E]),delete this._reverseStreams[this._streams[E.id]?this._streams[E.id].id:E.id],delete this._streams[E.id]},i.RTCPeerConnection.prototype.addTrack=function(E,_){var S,N,O;if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let B=Gr([]).call(arguments,1);if(B.length!==1||!Xe(S=B[0].getTracks()).call(S,P=>P===E))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(Xe(N=this.getSenders()).call(N,P=>P.track===E))throw new DOMException("Track already exists.","InvalidAccessError");return this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},(S=this._streams[_.id])?(S.addTrack(E),se.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))})):(S=new i.MediaStream([E]),this._streams[_.id]=S,this._reverseStreams[S.id]=_,this.addStream(S)),Xe(O=this.getSenders()).call(O,P=>P.track===E)},K(c=["createOffer","createAnswer"]).call(c,function(E){let _=i.RTCPeerConnection.prototype[E];i.RTCPeerConnection.prototype[E]={[E](){const S=arguments;return arguments.length&&typeof arguments[0]=="function"?_.apply(this,[N=>{N=n(this,N),S[0].apply(null,[N])},N=>{S[1]&&S[1].apply(null,N)},arguments[2]]):_.apply(this,arguments).then(N=>n(this,N))}}[E]});var m=i.RTCPeerConnection.prototype.setLocalDescription;i.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=s(this,arguments[0]),m.apply(this,arguments)):m.apply(this,arguments)};var I=ut(i.RTCPeerConnection.prototype,"localDescription");ft(i.RTCPeerConnection.prototype,"localDescription",{get(){let E=I.get.apply(this);return E.type===""?E:n(this,E)}}),i.RTCPeerConnection.prototype.removeTrack=function(E){var _;if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!E._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(E._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let S;this._streams=this._streams||{},K(_=pt(this._streams)).call(_,N=>{var O;Xe(O=this._streams[N].getTracks()).call(O,B=>E.track===B)&&(S=this._streams[N])}),S&&(S.getTracks().length===1?this.removeStream(this._reverseStreams[S.id]):S.removeTrack(E.track),this.dispatchEvent(new Event("negotiationneeded")))}}}function Q(i){let n=v(i);if(!i.RTCPeerConnection&&i.webkitRTCPeerConnection&&(i.RTCPeerConnection=i.webkitRTCPeerConnection),i.RTCPeerConnection){var s;53>n.version&&K(s=["setLocalDescription","setRemoteDescription","addIceCandidate"]).call(s,function(u){let h=i.RTCPeerConnection.prototype[u];i.RTCPeerConnection.prototype[u]={[u](){return arguments[0]=new(u==="addIceCandidate"?i.RTCIceCandidate:i.RTCSessionDescription)(arguments[0]),h.apply(this,arguments)}}[u]});var c=i.RTCPeerConnection.prototype.addIceCandidate;i.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?78>n.version&&arguments[0]&&arguments[0].candidate===""?se.resolve():c.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),se.resolve())}}}function pe(i){a(i,"negotiationneeded",n=>{if(n.target.signalingState==="stable")return n})}function oe(i,n,s,c,u){return n=Fe.writeRtpDescription(i.kind,n),n+=Fe.writeIceParameters(i.iceGatherer.getLocalParameters()),n+=Fe.writeDtlsParameters(i.dtlsTransport.getLocalParameters(),s==="offer"?"actpass":u||"active"),n+="a=mid:"+i.mid+`\r
`,i.rtpSender&&i.rtpReceiver?n+=`a=sendrecv\r
`:i.rtpSender?n+=`a=sendonly\r
`:i.rtpReceiver?n+=`a=recvonly\r
`:n+=`a=inactive\r
`,i.rtpSender&&(s=i.rtpSender._initialTrackId||i.rtpSender.track.id,i.rtpSender._initialTrackId=s,c="msid:"+(c?c.id:"-")+" "+s+`\r
`,n=n+("a="+c)+("a=ssrc:"+i.sendEncodingParameters[0].ssrc+" "+c),i.sendEncodingParameters[0].rtx&&(n+="a=ssrc:"+i.sendEncodingParameters[0].rtx.ssrc+" "+c,n+="a=ssrc-group:FID "+i.sendEncodingParameters[0].ssrc+" "+i.sendEncodingParameters[0].rtx.ssrc+`\r
`)),n+="a=ssrc:"+i.sendEncodingParameters[0].ssrc+" cname:"+Fe.localCName+`\r
`,i.rtpSender&&i.sendEncodingParameters[0].rtx&&(n+="a=ssrc:"+i.sendEncodingParameters[0].rtx.ssrc+" cname:"+Fe.localCName+`\r
`),n}function me(i,n){var s={codecs:[],headerExtensions:[],fecMechanisms:[]},c=function(h,f){h=parseInt(h,10);for(var A=0;A<f.length;A++)if(f[A].payloadType===h||f[A].preferredPayloadType===h)return f[A]},u=function(h,f,A,m){return h=c(h.parameters.apt,A),f=c(f.parameters.apt,m),h&&f&&h.name.toLowerCase()===f.name.toLowerCase()};return i.codecs.forEach(function(h){for(var f=0;f<n.codecs.length;f++){var A=n.codecs[f];if(h.name.toLowerCase()===A.name.toLowerCase()&&h.clockRate===A.clockRate&&(h.name.toLowerCase()!=="rtx"||!h.parameters||!A.parameters.apt||u(h,A,i.codecs,n.codecs))){(A=JSON.parse(JSON.stringify(A))).numChannels=Math.min(h.numChannels,A.numChannels),s.codecs.push(A),A.rtcpFeedback=A.rtcpFeedback.filter(function(m){for(var I=0;I<h.rtcpFeedback.length;I++)if(h.rtcpFeedback[I].type===m.type&&h.rtcpFeedback[I].parameter===m.parameter)return!0;return!1});break}}}),i.headerExtensions.forEach(function(h){for(var f=0;f<n.headerExtensions.length;f++){var A=n.headerExtensions[f];if(h.uri===A.uri){s.headerExtensions.push(A);break}}}),s}function xe(i,n,s){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[n][i].indexOf(s)!==-1}function Pe(i,n){var s=i.getRemoteCandidates().find(function(c){return n.foundation===c.foundation&&n.ip===c.ip&&n.port===c.port&&n.priority===c.priority&&n.protocol===c.protocol&&n.type===c.type});return s||i.addRemoteCandidate(n),!s}function De(i,n){return n=Error(n),n.name=i,n.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[i],n}function Kt(i){var n;i=i&&i.navigator;let s=fr(n=i.mediaDevices.getUserMedia).call(n,i.mediaDevices);i.mediaDevices.getUserMedia=function(c){return s(c).catch(u=>se.reject(function(h){return{name:{PermissionDeniedError:"NotAllowedError"}[h.name]||h.name,message:h.message,constraint:h.constraint,toString(){return this.name}}}(u)))}}function mt(i){var n;"getDisplayMedia"in i.navigator&&i.navigator.mediaDevices&&(i.navigator.mediaDevices&&"getDisplayMedia"in i.navigator.mediaDevices||(i.navigator.mediaDevices.getDisplayMedia=fr(n=i.navigator.getDisplayMedia).call(n,i.navigator)))}function rt(i){let n=v(i);if(i.RTCIceGatherer&&(i.RTCIceCandidate||(i.RTCIceCandidate=function(c){return c}),i.RTCSessionDescription||(i.RTCSessionDescription=function(c){return c}),15025>n.version)){let c=ut(i.MediaStreamTrack.prototype,"enabled");ft(i.MediaStreamTrack.prototype,"enabled",{set(u){c.set.call(this,u);let h=new Event("enabled");h.enabled=u,this.dispatchEvent(h)}})}!i.RTCRtpSender||"dtmf"in i.RTCRtpSender.prototype||ft(i.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=new i.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}}),i.RTCDtmfSender&&!i.RTCDTMFSender&&(i.RTCDTMFSender=i.RTCDtmfSender);let s=OR(i,n.version);i.RTCPeerConnection=function(c){return c&&c.iceServers&&(c.iceServers=function(u,h){let f=!1;return u=JSON.parse(fe(u)),Qe(u).call(u,A=>{if(A&&(A.urls||A.url)){var m=A.urls||A.url;A.url&&!A.urls&&g("RTCIceServer.url","RTCIceServer.urls");let I=typeof m=="string";return I&&(m=[m]),m=Qe(m).call(m,E=>Ke(E).call(E,"stun:")===0?!1:(E=ll(E).call(E,"turn")&&!ll(E).call(E,"turn:[")&&vt(E).call(E,"transport=udp"))&&!f?(f=!0,!0):E&&!f),delete A.url,A.urls=I?m[0]:m,!!m.length}})}(c.iceServers,n.version),p("ICE servers after filtering:",c.iceServers)),new s(c)},i.RTCPeerConnection.prototype=s.prototype}function Er(i){!i.RTCRtpSender||"replaceTrack"in i.RTCRtpSender.prototype||(i.RTCRtpSender.prototype.replaceTrack=i.RTCRtpSender.prototype.setTrack)}function Nt(i){let n=v(i),s=i&&i.navigator;if(i=i&&i.MediaStreamTrack,s.getUserMedia=function(u,h,f){g("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),s.mediaDevices.getUserMedia(u).then(h,f)},!(55<n.version&&"autoGainControl"in s.mediaDevices.getSupportedConstraints())){var c;let u=function(f,A,m){A in f&&!(m in f)&&(f[m]=f[A],delete f[A])},h=fr(c=s.mediaDevices.getUserMedia).call(c,s.mediaDevices);if(s.mediaDevices.getUserMedia=function(f){return typeof f=="object"&&typeof f.audio=="object"&&(f=JSON.parse(fe(f)),u(f.audio,"autoGainControl","mozAutoGainControl"),u(f.audio,"noiseSuppression","mozNoiseSuppression")),h(f)},i&&i.prototype.getSettings){let f=i.prototype.getSettings;i.prototype.getSettings=function(){let A=f.apply(this,arguments);return u(A,"mozAutoGainControl","autoGainControl"),u(A,"mozNoiseSuppression","noiseSuppression"),A}}if(i&&i.prototype.applyConstraints){let f=i.prototype.applyConstraints;i.prototype.applyConstraints=function(A){return this.kind==="audio"&&typeof A=="object"&&(A=JSON.parse(fe(A)),u(A,"autoGainControl","mozAutoGainControl"),u(A,"noiseSuppression","mozNoiseSuppression")),f.apply(this,[A])}}}}function yt(i){typeof i=="object"&&i.RTCTrackEvent&&"receiver"in i.RTCTrackEvent.prototype&&!("transceiver"in i.RTCTrackEvent.prototype)&&ft(i.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function lr(i){let n=v(i);if(typeof i=="object"&&(i.RTCPeerConnection||i.mozRTCPeerConnection)){var s;!i.RTCPeerConnection&&i.mozRTCPeerConnection&&(i.RTCPeerConnection=i.mozRTCPeerConnection),53>n.version&&K(s=["setLocalDescription","setRemoteDescription","addIceCandidate"]).call(s,function(f){let A=i.RTCPeerConnection.prototype[f];i.RTCPeerConnection.prototype[f]={[f](){return arguments[0]=new(f==="addIceCandidate"?i.RTCIceCandidate:i.RTCSessionDescription)(arguments[0]),A.apply(this,arguments)}}[f]});var c=i.RTCPeerConnection.prototype.addIceCandidate;i.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?68>n.version&&arguments[0]&&arguments[0].candidate===""?se.resolve():c.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),se.resolve())};var u={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},h=i.RTCPeerConnection.prototype.getStats;i.RTCPeerConnection.prototype.getStats=function(){let[f,A,m]=arguments;return h.apply(this,[f||null]).then(I=>{if(53>n.version&&!A)try{K(I).call(I,E=>{E.type=u[E.type]||E.type})}catch(E){if(E.name!=="TypeError")throw E;K(I).call(I,(_,S)=>{I.set(S,cn({},_,{type:u[_.type]||_.type}))})}return I}).then(A,m)}}}function Ir(i){if(typeof i=="object"&&i.RTCPeerConnection&&i.RTCRtpSender&&!(i.RTCRtpSender&&"getStats"in i.RTCRtpSender.prototype)){var n=i.RTCPeerConnection.prototype.getSenders;n&&(i.RTCPeerConnection.prototype.getSenders=function(){let c=n.apply(this,[]);return K(c).call(c,u=>u._pc=this),c});var s=i.RTCPeerConnection.prototype.addTrack;s&&(i.RTCPeerConnection.prototype.addTrack=function(){let c=s.apply(this,arguments);return c._pc=this,c}),i.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):se.resolve(new Tt)}}}function li(i){if(typeof i=="object"&&i.RTCPeerConnection&&i.RTCRtpSender&&!(i.RTCRtpSender&&"getStats"in i.RTCRtpReceiver.prototype)){var n=i.RTCPeerConnection.prototype.getReceivers;n&&(i.RTCPeerConnection.prototype.getReceivers=function(){let s=n.apply(this,[]);return K(s).call(s,c=>c._pc=this),s}),a(i,"track",s=>(s.receiver._pc=s.srcElement,s)),i.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}}function $n(i){!i.RTCPeerConnection||"removeStream"in i.RTCPeerConnection.prototype||(i.RTCPeerConnection.prototype.removeStream=function(n){var s;g("removeStream","removeTrack"),K(s=this.getSenders()).call(s,c=>{var u;c.track&&vt(u=n.getTracks()).call(u,c.track)&&this.removeTrack(c)})})}function ui(i){i.DataChannel&&!i.RTCDataChannel&&(i.RTCDataChannel=i.DataChannel)}function on(i){if(typeof i=="object"&&i.RTCPeerConnection){if("getLocalStreams"in i.RTCPeerConnection.prototype||(i.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in i.RTCPeerConnection.prototype)){let n=i.RTCPeerConnection.prototype.addTrack;i.RTCPeerConnection.prototype.addStream=function(s){var c,u,h;this._localStreams||(this._localStreams=[]),vt(c=this._localStreams).call(c,s)||this._localStreams.push(s),K(u=s.getAudioTracks()).call(u,f=>n.call(this,f,s)),K(h=s.getVideoTracks()).call(h,f=>n.call(this,f,s))},i.RTCPeerConnection.prototype.addTrack=function(s,c){var u;return c&&(this._localStreams?vt(u=this._localStreams).call(u,c)||this._localStreams.push(c):this._localStreams=[c]),n.call(this,s,c)}}"removeStream"in i.RTCPeerConnection.prototype||(i.RTCPeerConnection.prototype.removeStream=function(n){var s,c,u;this._localStreams||(this._localStreams=[]);let h=Ke(s=this._localStreams).call(s,n);if(h!==-1){Jr(c=this._localStreams).call(c,h,1);var f=n.getTracks();K(u=this.getSenders()).call(u,A=>{vt(f).call(f,A.track)&&this.removeTrack(A)})}})}}function ki(i){if(typeof i=="object"&&i.RTCPeerConnection&&("getRemoteStreams"in i.RTCPeerConnection.prototype||(i.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in i.RTCPeerConnection.prototype))){ft(i.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(s){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=s),this.addEventListener("track",this._onaddstreampoly=c=>{var u;K(u=c.streams).call(u,h=>{var f;this._remoteStreams||(this._remoteStreams=[]),vt(f=this._remoteStreams).call(f,h)||(this._remoteStreams.push(h),f=new Event("addstream"),f.stream=h,this.dispatchEvent(f))})})}});let n=i.RTCPeerConnection.prototype.setRemoteDescription;i.RTCPeerConnection.prototype.setRemoteDescription=function(){let s=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(c){var u;K(u=c.streams).call(u,h=>{var f;s._remoteStreams||(s._remoteStreams=[]),0<=Ke(f=s._remoteStreams).call(f,h)||(s._remoteStreams.push(h),f=new Event("addstream"),f.stream=h,s.dispatchEvent(f))})}),n.apply(s,arguments)}}}function yn(i){if(typeof i=="object"&&i.RTCPeerConnection){i=i.RTCPeerConnection.prototype;var n=i.createOffer,s=i.createAnswer,c=i.setLocalDescription,u=i.setRemoteDescription,h=i.addIceCandidate;i.createOffer=function(A,m){let I=n.apply(this,[2<=arguments.length?arguments[2]:arguments[0]]);return m?(I.then(A,m),se.resolve()):I},i.createAnswer=function(A,m){let I=s.apply(this,[2<=arguments.length?arguments[2]:arguments[0]]);return m?(I.then(A,m),se.resolve()):I};var f=function(A,m,I){return A=c.apply(this,[A]),I?(A.then(m,I),se.resolve()):A};i.setLocalDescription=f,f=function(A,m,I){return A=u.apply(this,[A]),I?(A.then(m,I),se.resolve()):A},i.setRemoteDescription=f,f=function(A,m,I){return A=h.apply(this,[A]),I?(A.then(m,I),se.resolve()):A},i.addIceCandidate=f}}function Vr(i){let n=i&&i.navigator;if(n.mediaDevices&&n.mediaDevices.getUserMedia){var s;i=n.mediaDevices;let u=fr(s=i.getUserMedia).call(s,i);n.mediaDevices.getUserMedia=h=>u(di(h))}var c;!n.getUserMedia&&n.mediaDevices&&n.mediaDevices.getUserMedia&&(n.getUserMedia=fr(c=function(u,h,f){n.mediaDevices.getUserMedia(u).then(h,f)}).call(c,n))}function di(i){return i&&i.video!==void 0?cn({},i,{video:C(i.video)}):i}function go(i){let n=i.RTCPeerConnection;i.RTCPeerConnection=function(s,c){if(s&&s.iceServers){let u=[];for(let h=0;h<s.iceServers.length;h++){let f=s.iceServers[h];!f.hasOwnProperty("urls")&&f.hasOwnProperty("url")?(g("RTCIceServer.url","RTCIceServer.urls"),f=JSON.parse(fe(f)),f.urls=f.url,delete f.url,u.push(f)):u.push(s.iceServers[h])}s.iceServers=u}return new n(s,c)},i.RTCPeerConnection.prototype=n.prototype,"generateCertificate"in i.RTCPeerConnection&&ft(i.RTCPeerConnection,"generateCertificate",{get:()=>n.generateCertificate})}function _n(i){typeof i=="object"&&i.RTCPeerConnection&&"receiver"in i.RTCTrackEvent.prototype&&!i.RTCTransceiver&&ft(i.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Ue(i){let n=i.RTCPeerConnection.prototype.createOffer;i.RTCPeerConnection.prototype.createOffer=function(s){if(s){var c,u;s.offerToReceiveAudio!==void 0&&(s.offerToReceiveAudio=!!s.offerToReceiveAudio);let h=Xe(c=this.getTransceivers()).call(c,f=>f.receiver.track.kind==="audio");s.offerToReceiveAudio===!1&&h?h.direction==="sendrecv"?h.setDirection?h.setDirection("sendonly"):h.direction="sendonly":h.direction==="recvonly"&&(h.setDirection?h.setDirection("inactive"):h.direction="inactive"):s.offerToReceiveAudio!==!0||h||this.addTransceiver("audio"),s.offerToReceiveVideo!==void 0&&(s.offerToReceiveVideo=!!s.offerToReceiveVideo),c=Xe(u=this.getTransceivers()).call(u,f=>f.receiver.track.kind==="video"),s.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):s.offerToReceiveVideo!==!0||c||this.addTransceiver("video")}return n.apply(this,arguments)}}function Ot(i){if(i.RTCIceCandidate&&!(i.RTCIceCandidate&&"foundation"in i.RTCIceCandidate.prototype)){var n=i.RTCIceCandidate;i.RTCIceCandidate=function(s){var c;if(typeof s=="object"&&s.candidate&&Ke(c=s.candidate).call(c,"a=")===0&&((s=JSON.parse(fe(s))).candidate=s.candidate.substr(2)),s.candidate&&s.candidate.length){c=new n(s),s=Fe.parseCandidate(s.candidate);let u=cn(c,s);return u.toJSON=function(){return{candidate:u.candidate,sdpMid:u.sdpMid,sdpMLineIndex:u.sdpMLineIndex,usernameFragment:u.usernameFragment}},u}return new n(s)},i.RTCIceCandidate.prototype=n.prototype,a(i,"icecandidate",s=>(s.candidate&&ft(s,"candidate",{value:new i.RTCIceCandidate(s.candidate),writable:"false"}),s))}}function ir(i){if(i.RTCPeerConnection){var n=v(i);"sctp"in i.RTCPeerConnection.prototype||ft(i.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});var s=function(A){return!A||!A.sdp?!1:(A=Fe.splitSections(A.sdp),A.shift(),xE(A).call(A,m=>{var I;return(m=Fe.parseMLine(m))&&m.kind==="application"&&Ke(I=m.protocol).call(I,"SCTP")!==-1}))},c=function(A){return A=A.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/),A===null||2>A.length?-1:(A=pr(A[1],10),A!=A?-1:A)},u=function(A){let m=65536;return n.browser==="firefox"&&(m=57>n.version?A===-1?16384:2147483637:60>n.version?n.version===57?65535:65536:2147483637),m},h=function(A,m){let I=65536;return n.browser==="firefox"&&n.version===57&&(I=65535),A=Fe.matchPrefix(A.sdp,"a=max-message-size:"),0<A.length?I=pr(A[0].substr(19),10):n.browser==="firefox"&&m!==-1&&(I=2147483637),I},f=i.RTCPeerConnection.prototype.setRemoteDescription;i.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,n.browser==="chrome"&&76<=n.version){var{sdpSemantics:A}=this.getConfiguration();A==="plan-b"&&ft(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(s(arguments[0])){var m=c(arguments[0]);A=u(m),m=h(arguments[0],m);let I;I=A===0&&m===0?Number.POSITIVE_INFINITY:A===0||m===0?Math.max(A,m):Math.min(A,m),A={},ft(A,"maxMessageSize",{get:()=>I}),this._sctp=A}return f.apply(this,arguments)}}}function rr(i){function n(c,u){let h=c.send;c.send=function(){var f=arguments[0];if(f=f.length||f.size||f.byteLength,c.readyState==="open"&&u.sctp&&f>u.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+u.sctp.maxMessageSize+" bytes)");return h.apply(c,arguments)}}if(i.RTCPeerConnection&&"createDataChannel"in i.RTCPeerConnection.prototype){var s=i.RTCPeerConnection.prototype.createDataChannel;i.RTCPeerConnection.prototype.createDataChannel=function(){let c=s.apply(this,arguments);return n(c,this),c},a(i,"datachannel",c=>(n(c.channel,c.target),c))}}function Wr(i){var n;if(i.RTCPeerConnection&&!("connectionState"in i.RTCPeerConnection.prototype)){var s=i.RTCPeerConnection.prototype;ft(s,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),ft(s,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(c){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),c&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=c)},enumerable:!0,configurable:!0}),K(n=["setLocalDescription","setRemoteDescription"]).call(n,c=>{let u=s[c];s[c]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=h=>{let f=h.target;if(f._lastConnectionState!==f.connectionState){f._lastConnectionState=f.connectionState;let A=new Event("connectionstatechange",h);f.dispatchEvent(A)}return h},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),u.apply(this,arguments)}})}}function mo(i){if(i.RTCPeerConnection){var n=v(i);if(!(n.browser==="chrome"&&71<=n.version)){var s=i.RTCPeerConnection.prototype.setRemoteDescription;i.RTCPeerConnection.prototype.setRemoteDescription=function(c){var u,h;return c&&c.sdp&&Ke(u=c.sdp).call(u,`
a=extmap-allow-mixed`)!==-1&&(c.sdp=Qe(h=c.sdp.split(`
`)).call(h,f=>oa(f).call(f)!=="a=extmap-allow-mixed").join(`
`)),s.apply(this,arguments)}}}}function Je(i){i&&Lp.setUA(i),Sn=Lp.getResult(),i=Vo(Sn);var n,s=(n=Sn.engine.name==="Blink"?Sn.engine.version||"":Sn.browser.version||"",n.split(".")[0]);e:switch(Sn.os.name){case"Windows":n=Sn.os.version?Sn.os.name+" "+Sn.os.version:Sn.os.name;break e;default:n=Sn.os.name||""}return{name:i,version:s,os:n,osVersion:Sn.os.version}}function Vo(i){if(i.engine.name==="Blink")return $e.CHROME;switch(i.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return $e.CHROME;case"Safari":case"Mobile Safari":return $e.SAFARI;case"Edge":return $e.EDGE;case"Firefox":return $e.FIREFOX;case"QQBrowser":return $e.QQ;case"Opera":return $e.OPERA;case"WeChat":return $e.WECHAT;default:return i.browser.name||""}}function vo(){let i=Je();return!!(Sn.engine.name==="WebKit"&&i.os===ln.MAC_OS&&navigator.maxTouchPoints&&0<navigator.maxTouchPoints&&i.name!==$e.SAFARI||xn()&&i.name!==$e.SAFARI)}function Ks(){var i=Je();return!!(vo()&&(i.os===ln.MAC_OS||i.os===ln.IOS&&((i=Sn.os.version&&Sn.os.version.split("."))&&Number(i[0])===14&&i[1]&&3<=Number(i[1])||i&&14<Number(i[0]))))}function zi(){return Je().name===$e.CHROME}function Ws(){return Je().name===$e.SAFARI}function Or(){return Je().name===$e.FIREFOX}function xn(){return Je().os===ln.IOS}function bi(){let i=Je();return i.os===ln.IOS&&Number(i.osVersion&&i.osVersion.split(".")[0])===15}function Eo(){return Ws()&&0<navigator.maxTouchPoints}function _u(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&35>=window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]}function Gc(){let i=Je();return i.name===$e.EDGE||i.name===$e.SAFARI?!1:!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function ds(i){return typeof i=="string"?cn({},bR[i]):i}function jc(i){return typeof i=="string"?cn({},DR[i]):i}function Ma(i){return typeof i=="string"?cn({},BR[i]):i}function La(i){return typeof i=="string"?cn({},MR[i]):i}function Yr(i,n){var s;vt(s=pt(te)).call(s,i)&&(te[i]=n)}function hs(i,n,s){return{sampleRate:i,stereo:n,bitrate:s}}function Ge(i,n,s,c,u){return{width:i,height:n,frameRate:s,bitrateMin:c,bitrateMax:u}}function X(i,n,s,c,u){return{width:{max:i},height:{max:n},frameRate:s,bitrateMin:c,bitrateMax:u}}function we(i,n){return{numSpatialLayers:i,numTemporalLayers:n}}function qe(i){return rc.call(i)==="[object Array]"}function Lt(i){return i!==null&&typeof i=="object"}function _t(i){return rc.call(i)==="[object Function]"}function kr(i,n){if(i!=null)if(typeof i!="object"&&(i=[i]),qe(i))for(var s=0,c=i.length;s<c;s++)n.call(null,i[s],s,i);else for(s in i)Object.prototype.hasOwnProperty.call(i,s)&&n.call(null,i[s],s,i)}function Qn(i){return encodeURIComponent(i).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Xi(){this.handlers=[]}function Hc(i,n){!We.isUndefined(i)&&We.isUndefined(i["Content-Type"])&&(i["Content-Type"]=n)}function hi(i){this.defaults=i,this.interceptors={request:new $E,response:new $E}}function Ys(i){this.message=i}function Go(i){if(typeof i!="function")throw new TypeError("executor must be a function.");var n;this.promise=new Promise(function(c){n=c});var s=this;i(function(c){s.reason||(s.reason=new t1(c),n(s.reason))})}function jo(i){i=new nd(i);var n=zE(nd.prototype.request,i);return We.extend(n,nd.prototype,i),We.extend(n,i),n}function Su(){let i=new Date;return i.toTimeString().split(" ")[0]+":"+i.getMilliseconds()}function ps(i,n){if(typeof i!="boolean")throw new L(D.INVALID_PARAMS,"Invalid ".concat(n,": The value is of the boolean type."))}function yr(i,n,s){var c;if(!vt(s).call(s,i))throw new L(D.INVALID_PARAMS,b(c="".concat(n," can only be set as ")).call(c,fe(s)))}function St(i,n,s=1,c=1e4,u=!0){if(i<s||i>c||u&&(typeof i!="number"||i%1!=0)){var h,f;throw new L(D.INVALID_PARAMS,b(h=b(f="invalid ".concat(n,": the value range is [")).call(f,s,", ")).call(h,c,"]. integer only"))}}function qr(i,n,s=1,c=255,u=!0){if(i==null)throw new L(D.INVALID_PARAMS,"".concat(n||"param"," cannot be empty"));var h,f,A;if(!om(i,s,c,u))throw new L(D.INVALID_PARAMS,b(h=b(f=b(A="Invalid ".concat(n||"string param",": Length of the string: [")).call(A,s,",")).call(f,c,"].")).call(h,u?" ASCII characters only.":""))}function Lh(i,n){if(!ro(i))throw new L(D.INVALID_PARAMS,"".concat(n," should be an array"))}function Ph(i){if(typeof i!="string"||!/^[a-zA-Z0-9 !#\$%&\(\)\+\-:;<=\.>\?@\[\]\^_\{\}\|~,]{1,64}$/.test(i))throw R.error("Invalid Channel Name ".concat(i)),new L(D.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function xh(i){var n;if(!(typeof i=="number"&&Math.floor(i)===i&&0<=i&&4294967295>=i||om(i,1,255)))throw R.error(b(n="Invalid UID ".concat(i," ")).call(n,typeof i)),new L(D.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");typeof i=="string"&&R.warning("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}function om(i,n=1,s=255,c=!0){if(n=typeof i=="string"&&i.length<=s&&i.length>=n){if(!(c=!c))e:if(typeof i!="string")c=!1;else{for(c=0;c<i.length;c+=1)if(n=i.charCodeAt(c),0>n||255<n){c=!1;break e}c=!0}n=c}return n}function dT(i){return qr(i.reportId,"params.reportId",0,100,!1),qr(i.category,"params.category",0,100,!1),qr(i.event,"params.event",0,100,!1),qr(i.label,"params.label",0,100,!1),St(i.value,"params.value",-9007199254740991,9007199254740991,!1),!0}function sm(i){return St(i.timeout,"config.timeout",0,1e5),St(i.timeoutFactor,"config.timeoutFactor",0,100,!1),St(i.maxRetryCount,"config.maxRetryConfig",0,1/0),St(i.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}function am(i){if(!ro(i)||1>i.length)return!1;try{K(i).call(i,n=>{if(!n.urls)throw Error()})}catch{return!1}return!0}function cm(i){return qr(i.turnServerURL,"turnServerURL"),qr(i.username,"username"),qr(i.password,"password"),i.udpport&&St(i.udpport,"udpport",1,99999,!0),i.forceturn&&ps(i.forceturn,"forceturn"),i.security&&ps(i.security,"security"),i.tcpport&&St(i.tcpport,"tcpport",1,99999,!0),!0}function lm(i){return i.level!==void 0&&yr(i.level,"level",[1,2,3]),!0}function Qh(i,n){qr(i.url,"".concat(n,".url"),1,1e3,!1),i.x==null||St(i.x,"".concat(n,".x"),0,1e4),i.y==null||St(i.y,"".concat(n,".y"),0,1e4),i.width==null||St(i.width,"".concat(n,".width"),0,1e4),i.height==null||St(i.height,"".concat(n,".height"),0,1e4),i.zOrder==null||St(i.zOrder,"".concat(n,".zOrder"),0,255),i.alpha==null||St(i.alpha,"".concat(n,".alpha"),0,1,!1)}function um(i){if(!i.channelName)throw new L(D.INVALID_PARAMS,"invalid channelName in info");if(!i.uid||typeof i.uid!="number")throw new L(D.INVALID_PARAMS,"invalid uid in info, uid must be a number");return i.token&&qr(i.token,"info.token",1,2047),xh(i.uid),Ph(i.channelName),!0}function dm(i){return yr(i,"mediaSource",["screen","window","application"]),!0}function hm(i,n){var s=pt(i);if(Qt){var c=Qt(i);n&&(c=Qe(c).call(c,function(u){return ut(i,u).enumerable})),s.push.apply(s,c)}return s}function $i(i,n,s){return new se((c,u)=>{n.timeout=n.timeout||te.HTTP_CONNECT_TIMEOUT,n.responseType=n.responseType||"json",n.data&&!s?(n.data=fe(n.data),ad+=xa(n.data)):s&&(n.data.size?ad+=n.data.size:n.data instanceof FormData?ad+=function(h){let f=0;return/DingTalk/i.test(navigator.userAgent)&&h.realFormData&&(h=h.realFormData),K(h).call(h,A=>{f+=typeof A=="string"?xa(A):A.size}),f+138}(n.data):ad+=xa(fe(n.data))),n.headers=n.headers||{},n.headers["Content-Type"]=n.headers["Content-Type"]||"application/json",n.method="POST",n.url=i,To.request(n).then(h=>{typeof h.data=="string"?$p+=xa(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?$p+=h.data.byteLength:$p+=xa(fe(h.data)),c(h.data)}).catch(h=>{To.isCancel(h)?u(new L(D.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new L(D.NETWORK_TIMEOUT,h.message)):h.response?u(new L(D.NETWORK_RESPONSE_ERROR,h.response.status)):u(new L(D.NETWORK_ERROR,h.message))})})}async function hT(i,n){let s=new Blob([n.data],{type:"buffer"});return await $i(i,function(c){for(var u=1;u<arguments.length;u++){var h,f=arguments[u]!=null?arguments[u]:{};if(u%2)K(h=hm(Object(f),!0)).call(h,function(m){wn(c,m,f[m])});else if(xt)Tn(c,xt(f));else{var A;K(A=hm(Object(f))).call(A,function(m){ft(c,m,ut(f,m))})}}return c}({},n,{data:s,headers:{"Content-Type":"application/octet-stream"}}),!0)}function Io(i,n,s,c){let u=cn({},Mr,c),h=u.timeout,f=async()=>{await Un(h),h*=u.timeoutFactor,h=Math.min(u.maxRetryTimeout,h)},A=!1;return c=new se(async(m,I)=>{n=n||(()=>!1),s=s||(()=>!0);for(let E=0;E<u.maxRetryCount;E+=1){if(A)return I(new L(D.OPERATION_ABORTED));try{const _=await i();if(!n(_,E)||E+1===u.maxRetryCount)return m(_);await f()}catch(_){if(!s(_,E)||E+1===u.maxRetryCount)return I(_);await f()}}}),c.cancel=()=>A=!0,c}function pm(i,n){var s=pt(i);if(Qt){var c=Qt(i);n&&(c=Qe(c).call(c,function(u){return ut(i,u).enumerable})),s.push.apply(s,c)}return s}function _r(i){for(var n=1;n<arguments.length;n++){var s,c=arguments[n]!=null?arguments[n]:{};if(n%2)K(s=pm(Object(c),!0)).call(s,function(h){wn(i,h,c[h])});else if(xt)Tn(i,xt(c));else{var u;K(u=pm(Object(c))).call(u,function(h){ft(i,h,ut(c,h))})}}return i}function Kc(i={report:z}){return function(n,s,c){let u=n[s];if(typeof u=="function"){let h=n.constructor.name==="AgoraRTCClient"?"Client":n.constructor.name;c.value=function(...f){var A;let m=i.report.reportApiInvoke(this._sessionId||null,{name:b(A="".concat(h,".")).call(A,s),options:f,tag:Te.TRACER});try{let I=u.apply(this,f);return m.onSuccess(),I}catch(I){throw m.onError(I),I}}}return c}}function Uh(i={report:z}){return function(n,s,c){let u=n[s];if(typeof u=="function"){let h=n.constructor.name==="AgoraRTCClient"?"Client":n.constructor.name;c.value=async function(...f){var A;let m=i.report.reportApiInvoke(this._sessionId||null,{name:b(A="".concat(h,".")).call(A,s),options:f,tag:Te.TRACER});try{let I=await u.apply(this,f);return m.onSuccess(),I}catch(I){throw m.onError(I),I}}}return c}}function pT(){S1?(R.info("create audio context"),so=new S1,At.curState=so.state,so.onstatechange=()=>{var i;At.prevState=At.curState,At.curState=so?so.state:void 0,R.debug("AudioContext State Change",b(i="".concat(At.prevState,"=>")).call(i,At.curState)),(xn()||Eo())&&At.prevState==="running"&&At.curState==="interrupted"&&(R.info("ios-interruption-start"),At.emit(en.IOS_INTERRUPTION_START)),(xn()||Eo())&&At.prevState==="interrupted"&&At.curState==="running"&&(R.info("ios-interruption-end"),At.emit(en.IOS_INTERRUPTION_END)),At.emit("state-change")},async function(i){function n(O){i.state==="running"?s(!1):xn()||Eo()?i.state==="suspended"&&(s(!0),O?i.resume().then(c,c):s(!1)):i.state!=="closed"&&(s(!0),O?i.resume().then(c,c):s(!1))}function s(O){if(_!==O){_=O;for(let B=0,P=I;B<P.length;B+=1){let J=P[B];O?window.addEventListener(J,u,{capture:!0,passive:!0}):window.removeEventListener(J,u,{capture:!0,passive:!0})}}}function c(){n(!1)}function u(){n(!0)}function h(O){if(!N)if(E.paused)if(O){f(!1),N=!0,O=void 0;try{(O=E.play())?O.then(A,A):(E.addEventListener("playing",A),E.addEventListener("abort",A),E.addEventListener("error",A))}catch{A()}}else f(!0);else f(!1)}function f(O){if(S!==O){S=O;for(let B=0,P=I;B<P.length;B++){let J=P[B];O?window.addEventListener(J,m,{capture:!0,passive:!0}):window.removeEventListener(J,m,{capture:!0,passive:!0})}}}function A(){E.removeEventListener("playing",A),E.removeEventListener("abort",A),E.removeEventListener("error",A),N=!1,h(!1)}function m(){h(!0)}let I="click contextmenu auxclick dblclick mousedown mouseup touchend keydown keyup".split(" "),E,_=!1,S=!1,N=!1;if(xn()){let O=i.createMediaStreamDestination(),B=document.createElement("div");B.innerHTML="<audio x-webkit-airplay='deny'></audio>",E=B.children.item(0),E.controls=!1,E.disableRemotePlayback=!0,E.preload="auto",E.srcObject=O.stream,h(!0)}At.on("state-change",function(){n(!0)}),n(!1)}(so)):R.error("your browser is not support web audio")}function Wc(){if(!so&&(pT(),!so))throw new L(D.NOT_SUPPORTED,"can not create audio context");return so}function Yc(i){if(!function(){if(Zp!==null)return Zp;var c=Wc();let u=c.createBufferSource(),h=c.createGain();c=c.createGain(),u.connect(h),u.connect(c),u.disconnect(h),c=!1;try{u.disconnect(h)}catch{c=!0}return u.disconnect(),Zp=c,c}()){R.debug("polyfill audio node");var n=i.connect,s=i.disconnect;i.connect=(c,u,h)=>{var f;return i._inputNodes||(i._inputNodes=[]),vt(f=i._inputNodes).call(f,c)||(c instanceof AudioNode?(i._inputNodes.push(c),n.call(i,c,u,h)):n.call(i,c,u)),i},i.disconnect=(c,u,h)=>{s.call(i),c?Js(i._inputNodes,c):i._inputNodes=[];for(let f of i._inputNodes)n.call(i,f)}}}function Fh(i,n){let s=1/n,c=Wc(),u=c.createGain();u.gain.value=0,u.connect(c.destination);let h=!1,f=()=>{if(h)return void(u=null);const A=c.createOscillator();A.onended=f,A.connect(u),A.start(0),A.stop(c.currentTime+s),i(c.currentTime)};return f(),()=>{h=!0}}async function fm(i,n){let s=(c,u)=>c?typeof c!="number"?c.max||c.exact||c.ideal||c.min||u:c:u;return i={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxHeight:s(n.height,1080),maxWidth:s(n.width,1920)}}},n.frameRate&&typeof n.frameRate!="number"?(i.video.mandatory.maxFrameRate=n.frameRate.max,i.video.mandatory.minFrameRate=n.frameRate.min):typeof n.frameRate=="number"&&(i.video.mandatory.maxFrameRate=n.frameRate),await navigator.mediaDevices.getUserMedia(i)}async function fT(i){let n=await function(s){return new se((c,u)=>{const h=document.createElement("div");h.innerText="share screen",h.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const f=document.createElement("div");f.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const A=document.createElement("div");A.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",A.setAttribute("style","height: 12%;");const m=document.createElement("div");m.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const I=document.createElement("div");I.setAttribute("style","text-align: right; padding: 16px 0;");const E=document.createElement("button");E.innerHTML="cancel",E.setAttribute("style","width: 85px;"),E.onclick=()=>{document.body.removeChild(_);const S=Error("NotAllowedError");S.name="NotAllowedError",u(S)},I.appendChild(E),f.appendChild(A),f.appendChild(m),f.appendChild(I);const _=document.createElement("div");_.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),_.appendChild(h),_.appendChild(f),document.body.appendChild(_),Ie(s).call(s,S=>{if(S.id){const N=document.createElement("div");N.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let O=S.thumbnail;const{width:B}=O.getSize();1920<B&&(O=O.resize({width:1920})),N.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+O.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+(S.name.replace(/[\u00A0-\u9999<>&]/g,function(P){return"&#"+P.charCodeAt(0)+";"})+"</span>"),N.onclick=()=>{document.body.removeChild(_),c(S.id)},m.appendChild(N)}})})}(await Am(i.mediaSource));return await fm(n,i)}async function Am(i){let n=["window","screen"];i!=="application"&&i!=="window"||(n=["window"]),i==="screen"&&(n=["screen"]);let s=gm();if(!s)throw new L(D.ELECTRON_IS_NULL);i=null;try{i=s.desktopCapturer.getSources({types:n})}catch{i=null}i&&i.then||(i=new se((c,u)=>{s.desktopCapturer.getSources({types:n},(h,f)=>{h?u(h):c(f)})}));try{return await i}catch(c){throw new L(D.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,c.toString())}}function gm(){if(ld)return ld;try{return ld=window.require("electron"),ld}catch{return null}}async function Di(i,n){let s=0,c=null;for(;2>s;)try{c=await AT(i,n,0<s);break}catch(f){var u,h;if(f instanceof L)throw R.error(b(h="[".concat(n,"] ")).call(h,f.toString())),f;let A=Tu(f.name||f.code||f,f.message);if(A.code===D.MEDIA_OPTION_INVALID)R.debug("[".concat(n,"] detect media option invalid, retry")),s+=1,await Un(500);else throw R.error(b(u="[".concat(n,"] ")).call(u,A.toString())),A}if(!c)throw new L(D.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return c}async function AT(i,n,s){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new L(D.NOT_SUPPORTED,"can not find getUserMedia");s&&(i.video&&(delete i.video.width,delete i.video.height),i.screen&&(delete i.screen.width,delete i.screen.height));var c=Pt;if(s=new MediaStream,i.audioSource&&s.addTrack(i.audioSource),i.videoSource&&s.addTrack(i.videoSource),!i.audio&&!i.video&&!i.screen)return R.debug("Using Video Source/ Audio Source"),s;if(i.screen)if(gm())i.screen.sourceId?Pa(s,await fm(i.screen.sourceId,i.screen)):Pa(s,await fT(i.screen));else if(zi()&&i.screen.extensionId&&i.screen.mandatory){if(!c.getStreamFromExtension)throw new L(D.NOT_SUPPORTED,"This browser does not support screen sharing");R.debug("[".concat(n,'] Screen access on chrome stable, looking for extension"'));var u=await(h=i.screen.extensionId,f=n,new se((m,I)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},_=>{if(!_||!_.streamId)return R.error("[".concat(f,"] No response from Chrome Plugin. Plugin not installed properly"),_),void I(new L(D.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));m(_.streamId)})}catch(_){var E;R.error(b(E="[".concat(f,"] AgoraRTC screensharing plugin is not accessible(")).call(E,h,")"),_.toString()),I(new L(D.CHROME_PLUGIN_NOT_INSTALL))}}));i.screen.mandatory.chromeMediaSourceId=u,Pa(s,await navigator.mediaDevices.getUserMedia({video:{mandatory:i.screen.mandatory}}))}else if(c.getDisplayMedia)i.screen.mediaSource&&dm(i.screen.mediaSource),u={width:i.screen.width,height:i.screen.height,frameRate:i.screen.frameRate,displaySurface:i.screen.mediaSource==="screen"?"monitor":i.screen.mediaSource},R.debug("[".concat(n,"] getDisplayMedia:"),fe({video:u,audio:!!i.screenAudio})),Pa(s,await navigator.mediaDevices.getDisplayMedia({video:u,audio:!!i.screenAudio}));else{if(!Or())throw R.error("[".concat(n,"] This browser does not support screenSharing")),new L(D.NOT_SUPPORTED,"This browser does not support screen sharing");i.screen.mediaSource&&dm(i.screen.mediaSource),c={video:{mediaSource:i.screen.mediaSource,width:i.screen.width,height:i.screen.height,frameRate:i.screen.frameRate}},R.debug(b(u="[".concat(n,"] getUserMedia: ")).call(u,fe(c))),Pa(s,await navigator.mediaDevices.getUserMedia(c))}var h,f;if(!i.video&&!i.audio)return s;i={video:i.video,audio:i.audio},R.debug("[".concat(n,"] GetUserMedia"),fe(i)),Je();let A;n=null,(Ws()||xn()||vo())&&(n=await ef.lock());try{A=await navigator.mediaDevices.getUserMedia(i)}catch(m){throw n&&n(),m}return i.audio&&(w1=!0),i.video&&(N1=!0),Pa(s,A),n&&n(),s}function Tu(i,n){switch(i){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":var s;return new L(D.MEDIA_OPTION_INVALID,b(s="".concat(i,": ")).call(s,n));case"NotFoundError":case"DevicesNotFoundError":var c;return new L(D.DEVICE_NOT_FOUND,b(c="".concat(i,": ")).call(c,n));case"NotSupportedError":var u;return new L(D.NOT_SUPPORTED,b(u="".concat(i,": ")).call(u,n));case"NotReadableError":var h;return new L(D.NOT_READABLE,b(h="".concat(i,": ")).call(h,n));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":var f;return new L(D.PERMISSION_DENIED,b(f="".concat(i,": ")).call(f,n));case"ConstraintNotSatisfiedError":var A;return new L(D.CONSTRAINT_NOT_SATISFIED,b(A="".concat(i,": ")).call(A,n));default:var m;return R.error("getUserMedia unexpected error",i),new L(D.UNEXPECTED_ERROR,b(m="".concat(i,": ")).call(m,n))}}function Pa(i,n){let s=i.getVideoTracks()[0],c=i.getAudioTracks()[0],u=n.getVideoTracks()[0];(n=n.getAudioTracks()[0])&&(c&&i.removeTrack(c),i.addTrack(n)),u&&(s&&i.removeTrack(s),i.addTrack(u))}function mm(){if(!tf){let i=n=>{n.preventDefault(),tf=!1,document.body.removeEventListener("touchstart",i,!0),document.body.removeEventListener("mousedown",i,!0)};tf=!0,document.body.addEventListener("touchstart",i,!0),document.body.addEventListener("mousedown",i,!0),b1.emit("autoplay-failed")}}function Yt(){return function(i,n,s){let c=i[n];typeof c=="function"&&(s.value=function(...u){this._isClosed&&new L(D.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning");let h=c.apply(this,u);return h instanceof se?new se((f,A)=>{h.then(f).catch(A)}):h})}}function vm(i,n){var s=pt(i);if(Qt){var c=Qt(i);n&&(c=Qe(c).call(c,function(u){return ut(i,u).enumerable})),s.push.apply(s,c)}return s}function Ru(i){for(var n=1;n<arguments.length;n++){var s,c=arguments[n]!=null?arguments[n]:{};if(n%2)K(s=vm(Object(c),!0)).call(s,function(h){wn(i,h,c[h])});else if(xt)Tn(i,xt(c));else{var u;K(u=vm(Object(c))).call(u,function(h){ft(i,h,ut(c,h))})}}return i}function Em(i,n){var s=pt(i);if(Qt){var c=Qt(i);n&&(c=Qe(c).call(c,function(u){return ut(i,u).enumerable})),s.push.apply(s,c)}return s}function Co(i){for(var n=1;n<arguments.length;n++){var s,c=arguments[n]!=null?arguments[n]:{};if(n%2)K(s=Em(Object(c),!0)).call(s,function(h){wn(i,h,c[h])});else if(xt)Tn(i,xt(c));else{var u;K(u=Em(Object(c))).call(u,function(h){ft(i,h,ut(c,h))})}}return i}function Im(i,n){var s=pt(i);if(Qt){var c=Qt(i);n&&(c=Qe(c).call(c,function(u){return ut(i,u).enumerable})),s.push.apply(s,c)}return s}function Cm(i){for(var n=1;n<arguments.length;n++){var s,c=arguments[n]!=null?arguments[n]:{};if(n%2)K(s=Im(Object(c),!0)).call(s,function(h){wn(i,h,c[h])});else if(xt)Tn(i,xt(c));else{var u;K(u=Im(Object(c))).call(u,function(h){ft(i,h,ut(c,h))})}}return i}function gT(i){if(!i.address||!i.tcp)throw new L(D.UNEXPECTED_RESPONSE,"Invalid address format ".concat(i));return i.address.match(/^[\.:\d]+$/)?"".concat(i.address.replace(/[^\d]/g,"-"),".edge.agora.io"):(R.info("Cannot recognized as IP address ".concat(i.address,". Used As Host instead")),b(n="".concat(i.address,":")).call(n,i.tcp));var n}function ym(i,n){var s;let c=te.GATEWAY_DOMAINS,u=c[1]&&Ke(n).call(n,c[1])!==-1?1:0;return i.addresses=i.addresses||[],{gatewayAddrs:Ie(s=i.addresses).call(s,h=>{var f,A,m;return h.ip.match(/^[\.:\d]+$/)?b(f=b(A="".concat(h.ip.replace(/[^\d]/g,"-"),".")).call(A,c[u++%c.length],":")).call(f,h.port):(R.info("Cannot recognized as IP address ".concat(h.ip,". Used As Host instead")),b(m="".concat(h.ip,":")).call(m,h.port))}),uid:i.uid,cid:i.cid,vid:i.detail&&i.detail[8],uni_lbs_ip:i.detail&&i.detail[1],res:i,csIp:i.detail&&i.detail[502]}}function fs(i){return typeof i=="number"?i:i.exact||i.ideal||i.max||i.min||0}function _m(i,n){let s=i.videoSend[0];return s?(n=n&&n.videoSend[0]?n.videoSend[0].inputFrame:void 0,i={id:or(10,""),timestamp:new Date(i.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:s.ssrc.toString()},s.inputFrame&&(n&&s.inputFrame.height===n.height||(i.A_fhi=s.inputFrame.height?s.inputFrame.height.toString():"0"),n&&s.inputFrame.width===n.width||(i.A_fwi=s.inputFrame.width?s.inputFrame.width.toString():"0"),n&&s.inputFrame.frameRate===n.frameRate||(i.A_fri=s.inputFrame.frameRate?s.inputFrame.frameRate.toString():"0")),i):null}function Sm(i){return 0<=i&&.17>i?1:.17<=i&&.36>i?2:.36<=i&&.59>i?3:.59<=i&&1>=i?4:1<i?5:0}function mT(i,n){let s={};return i.height&&i.width&&(n=n._videoHeight||n.getMediaStreamTrack(!0).getSettings().height,s.scaleResolutionDownBy=n?n/fs(i.height):4),s.maxFramerate=i.framerate?fs(i.framerate):void 0,s.maxBitrate=i.bitrate?1e3*i.bitrate:void 0,s}function Vh(i,n){var s;let c,u;switch(n){case Rn.CHOOSE_SERVER:c=4096,n="choose server";break;case Rn.CLOUD_PROXY:c=1048576,n="proxy";break;case Rn.CLOUD_PROXY_5:c=4194304,n="proxy5";break;default:throw new L(D.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:i.detail&&i.detail[502],retry:!1})}if(K(s=i.response_body).call(s,h=>{var f;h.buffer&&h.buffer.flag===c&&(u={code:h.buffer.code,addresses:Ie(f=h.buffer.edges_services).call(f,A=>Cm({},A,{ticket:h.buffer.cert})),server_ts:i.enter_ts,uid:h.buffer.uid,cid:h.buffer.cid,cname:h.buffer.cname,detail:Cm({},h.buffer.detail,{},i.detail),flag:h.buffer.flag,opid:i.opid})}),!u)throw new L(D.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(n," from multi unilbs response"),{csIp:i.detail&&i.detail[502]});return u}function vT(i){var n;return Ie(n=i.addresses).call(n,s=>({address:s.ip,tcpport:s.port,udpport:s.port,username:jr.username,password:jr.password}))}function Tm(i,n){var s=pt(i);if(Qt){var c=Qt(i);n&&(c=Qe(c).call(c,function(u){return ut(i,u).enumerable})),s.push.apply(s,c)}return s}function Gh(i){for(var n=1;n<arguments.length;n++){var s,c=arguments[n]!=null?arguments[n]:{};if(n%2)K(s=Tm(Object(c),!0)).call(s,function(h){wn(i,h,c[h])});else if(xt)Tn(i,xt(c));else{var u;K(u=Tm(Object(c))).call(u,function(h){ft(i,h,ut(c,h))})}}return i}function xa(i){return window.TextEncoder?new TextEncoder().encode(i).length:i.length}function Un(i){return new se(n=>{window.setTimeout(n,i)})}function ET(i){let n=new L(D.TIMEOUT,"timeout");return new se((s,c)=>{window.setTimeout(()=>c(n),i)})}function or(i=7,n){var s,c;let u=Math.random().toString(16).substr(2,i).toLowerCase();return u.length===i?b(s="".concat(n)).call(s,u):b(c="".concat(n)).call(c,u)+or(i-u.length,"")}function Rm(i){return new se((n,s)=>{let c=!1,u=document.createElement("video");u.setAttribute("autoplay",""),u.setAttribute("muted",""),u.muted=!0,u.autoplay=!0,u.setAttribute("playsinline",""),u.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(u),s=xn()?"canplay":"playing",u.addEventListener(s,()=>{let h=u.videoWidth,f=u.videoHeight;!h&&Or()||(c=!0,u.srcObject=null,u.remove(),n([h,f]))}),u.srcObject=new MediaStream([i]),u.play().catch(ud),gi(()=>{c||(u.srcObject=null,u.remove(),n([u.videoWidth,u.videoHeight]))},4e3)})}function Qa(i){return se.all(Ie(i).call(i,n=>n.then(s=>{throw s},s=>s))).then(n=>{throw n},n=>n)}function br(i,n,...s){return i.getListeners(n).length===0?se.reject(new L(D.UNEXPECTED_ERROR,"can not emit promise")):new se((c,u)=>{i.emit(n,...s,c,u)})}function sn(i,n,...s){return i.getListeners(n).length===0?se.resolve():br(i,n,...s)}function qs(i,n,...s){return i.getListeners(n).length===0?null:qc(i,n,...s)}function qc(i,n,...s){let c=null,u=null;if(i.emit(n,...s,h=>{c=h},h=>{u=h}),u!==null)throw u;if(c===null)throw new L(D.UNEXPECTED_ERROR,"handler is not sync");return c}function Js(i,n){n=Ke(i).call(i,n),n!==-1&&Jr(i).call(i,n,1)}function wm(i){let n=[];return K(i).call(i,s=>{Ke(n).call(n,s)===-1&&n.push(s)}),n}function pi(i){se.resolve().then(i)}function Jc(i,n){L1[n]||(L1[n]=!0,i())}function jh(i){i=window.atob(i);let n=new Uint8Array(new ArrayBuffer(i.length));for(let s=0;s<i.length;s+=1)n[s]=i.charCodeAt(s);return n}function wu(i){let n="";for(let s=0;s<i.length;s+=1)n+=String.fromCharCode(i[s]);return window.btoa(n)}function Nu(i){var n=fw[Math.floor(i/1e4)];if(!n)return{desc:"unkonw error",retry:!1};if(n=n[i%1e4],!n){if(Math.floor(i/1e4)===nc.ACCESS_POINT){if(n=i%1e4,n.toString()[0]==="1")return{desc:i.toString(),retry:!1};if(n.toString()[0]==="2")return{desc:i.toString(),retry:!0}}return{desc:"unkonw error",retry:!1}}return n}function Nm(i){return Aw[i]||{desc:"UNKNOW_ERROR_".concat(i),action:"failed"}}async function IT(){function i(de){let Le=A["_"+de];var _e;return _e="Cannot call unknown function "+de+", make sure it is exported",Le||s("Assertion failed: "+_e),Le}function n(de,Le,_e,Tr,ha){ha={string:function(st){let Xt=0;if(st!=null&&st!==0){var xr=1+(st.length<<2);Xt=ue(xr);var Rr=ne,gr=Xt;if(0<xr){xr=gr+xr-1;for(let ao=0;ao<st.length;++ao){let Kr=st.charCodeAt(ao);if(55296<=Kr&&57343>=Kr&&(Kr=65536+((1023&Kr)<<10)|1023&st.charCodeAt(++ao)),127>=Kr){if(gr>=xr)break;Rr[gr++]=Kr}else{if(2047>=Kr){if(gr+1>=xr)break;Rr[gr++]=192|Kr>>6}else{if(65535>=Kr){if(gr+2>=xr)break;Rr[gr++]=224|Kr>>12}else{if(gr+3>=xr)break;Rr[gr++]=240|Kr>>18,Rr[gr++]=128|Kr>>12&63}Rr[gr++]=128|Kr>>6&63}Rr[gr++]=128|63&Kr}}Rr[gr]=0}}return Xt},array:function(st){const Xt=ue(st.length);return J.set(st,Xt),Xt}};let pa=i(de),pc=[];if(de=0,Tr)for(let st=0;st<Tr.length;st++){let Xt=ha[_e[st]];Xt?(de===0&&(de=q()),pc[st]=Xt(Tr[st])):pc[st]=Tr[st]}return _e=pa.apply(null,pc),_e=function(st){if(Le==="string")if(Rr=st){st=ne;var Xt=Rr+xr,xr=Rr;let gr="";for(;st[xr]&&!(xr>=Xt);)++xr;if(16<xr-Rr&&st.subarray&&P)st=P.decode(st.subarray(Rr,xr));else{for(;Rr<xr;){if(Xt=st[Rr++],!(128&Xt)){gr+=String.fromCharCode(Xt);continue}let ao=63&st[Rr++];if((224&Xt)==192){gr+=String.fromCharCode((31&Xt)<<6|ao);continue}let Kr=63&st[Rr++];Xt=(240&Xt)==224?(15&Xt)<<12|ao<<6|Kr:(7&Xt)<<18|ao<<12|Kr<<6|63&st[Rr++],65536>Xt?gr+=String.fromCharCode(Xt):(Xt-=65536,gr+=String.fromCharCode(55296|Xt>>10,56320|1023&Xt))}st=gr}}else st="";else st=Le==="boolean"?!!st:st;return st;var Rr}(_e),de!==0&&Z(de),_e}function s(de){throw A.onAbort&&A.onAbort(de),N(de+=""),B=!0,new WebAssembly.RuntimeError("abort("+de+"). Build with -s ASSERTIONS=1 for more info.")}function c(de){for(;0<de.length;){let Le=de.shift();if(typeof Le=="function"){Le(A);continue}let _e=Le.func;typeof _e=="number"?Le.arg===void 0?Ae.get(_e)():Ae.get(_e)(Le.arg):_e(Le.arg===void 0?null:Le.arg)}}function u(de){function Le(){if(!Vt&&(Vt=!0,A.calledRun=!0,!B)){if(c(be),c(Rt),A.onRuntimeInitialized&&A.onRuntimeInitialized(),A.postRun)for(typeof A.postRun=="function"&&(A.postRun=[A.postRun]);A.postRun.length;){var _e=A.postRun.shift();ve.unshift(_e)}c(ve)}}0<et||(function(){if(A.preRun)for(typeof A.preRun=="function"&&(A.preRun=[A.preRun]);A.preRun.length;){var _e=A.preRun.shift();Me.unshift(_e)}c(Me)}(),0<et||(A.setStatus?(A.setStatus("Running..."),gi(function(){gi(function(){A.setStatus("")},1),Le()},1)):Le()))}var h,f;if(of)return of;let A={},m,I={};for(m in A)Object.prototype.hasOwnProperty.call(A,m)&&(I[m]=A[m]);let E=!1,_=!1;E=typeof window=="object",_=typeof importScripts=="function";let S="";(E||_)&&(_?S=self.location.href:typeof document!="undefined"&&document.currentScript&&(S=document.currentScript.src),S=Ke(S).call(S,"blob:")!==0?S.substr(0,ww(S).call(S,"/")+1):""),A.print||fr(h=console.log).call(h,console);let N=A.printErr||fr(f=console.warn).call(f,console);for(m in I)Object.prototype.hasOwnProperty.call(I,m)&&(A[m]=I[m]);let O;I=null,typeof WebAssembly!="object"&&s("no native wasm support detected");let B=!1,P=typeof TextDecoder!="undefined"?new TextDecoder("utf8"):void 0;typeof TextDecoder!="undefined"&&new TextDecoder("utf-16le");let J,ne,Ae,Me=[],be=[],Rt=[],ve=[];be.push({func:function(){dn()}});let et=0,It=null;A.preloadedImages={},A.preloadedAudios={},h="deflate.wasm";var zt;ll(zt=h).call(zt,"data:application/octet-stream;base64,")||(h=function(de){return A.locateFile?A.locateFile(de,S):S+de}(h));let Pr={emscripten_memcpy_big:function(de,Le,_e){var Tr=ne.copyWithin;(ne===Q1||ne instanceof Array&&Tr===Q1.copyWithin?vw:Tr).call(ne,de,Le,Le+_e)},emscripten_resize_heap:function(de){s("OOM")}};await async function(){function de(_e,Tr){A.asm=_e.exports,O=A.asm.memory,_e=O.buffer,A.HEAP8=J=new Int8Array(_e),A.HEAP16=new Int16Array(_e),A.HEAP32=new Int32Array(_e),A.HEAPU8=ne=new Uint8Array(_e),A.HEAPU16=new Uint16Array(_e),A.HEAPU32=new Uint32Array(_e),A.HEAPF32=new Float32Array(_e),A.HEAPF64=new Float64Array(_e),Ae=A.asm.__indirect_function_table,et--,A.monitorRunDependencies&&A.monitorRunDependencies(et),et==0&&It&&(_e=It,It=null,_e())}let Le={env:Pr,wasi_snapshot_preview1:Pr};if(et++,A.monitorRunDependencies&&A.monitorRunDependencies(et),A.instantiateWasm)try{return A.instantiateWasm(Le,de)}catch(_e){return N("Module.instantiateWasm callback failed with error: "+_e),!1}return await function(_e){return new se((Tr,ha)=>{Tr(Nw().buffer)}).then(function(Tr){return WebAssembly.instantiate(Tr,Le)}).then(_e,function(Tr){N("failed to asynchronously prepare wasm: "+Tr),s(Tr)})}(function(_e){de(_e.instance)}),{}}();let Vt,dn=A.___wasm_call_ctors=function(){return(dn=A.___wasm_call_ctors=A.asm.__wasm_call_ctors).apply(null,arguments)},G=A._malloc=function(){return(G=A._malloc=A.asm.malloc).apply(null,arguments)};A._free=function(){return(A._free=A.asm.free).apply(null,arguments)},A.___errno_location=function(){return(A.___errno_location=A.asm.__errno_location).apply(null,arguments)},A._zlibCompress=function(){return(A._zlibCompress=A.asm.zlibCompress).apply(null,arguments)};let q=A.stackSave=function(){return(q=A.stackSave=A.asm.stackSave).apply(null,arguments)},Z=A.stackRestore=function(){return(Z=A.stackRestore=A.asm.stackRestore).apply(null,arguments)},ue=A.stackAlloc=function(){return(ue=A.stackAlloc=A.asm.stackAlloc).apply(null,arguments)};if(A.ccall=n,A.cwrap=function(de,Le,_e,Tr){let ha=Iw(_e=_e||[]).call(_e,function(pa){return pa==="number"});return Le!=="string"&&ha&&!Tr?i(de):function(){return n(de,Le,_e,arguments)}},A.allocate=function(de,Le){let _e;return _e=Le==1?ue(de.length):G(de.length),de.subarray||Gr(de)?ne.set(de,_e):ne.set(new Uint8Array(de),_e),_e},It=function de(){Vt||u(),Vt||(It=de)},A.run=u,A.preInit)for(typeof A.preInit=="function"&&(A.preInit=[A.preInit]);0<A.preInit.length;)A.preInit.pop()();return u(),of=A,A}function Om(i,n){var s=pt(i);if(Qt){var c=Qt(i);n&&(c=Qe(c).call(c,function(u){return ut(i,u).enumerable})),s.push.apply(s,c)}return s}function Hh(i){for(var n=1;n<arguments.length;n++){var s,c=arguments[n]!=null?arguments[n]:{};if(n%2)K(s=Om(Object(c),!0)).call(s,function(h){wn(i,h,c[h])});else if(xt)Tn(i,xt(c));else{var u;K(u=Om(Object(c))).call(u,function(h){ft(i,h,ut(c,h))})}}return i}function km(i,n){var s=pt(i);if(Qt){var c=Qt(i);n&&(c=Qe(c).call(c,function(u){return ut(i,u).enumerable})),s.push.apply(s,c)}return s}function CT(i,n,s,c,u){Rf+=1;let h={sid:s.sid,command:"convergeAllocateEdge",uid:"666",appId:s.appId,ts:Math.floor(le()/1e3),seq:Rf,requestId:Rf,version:ei,cname:s.cname},f={service_name:n,json_body:fe(h)},A,m,I=i[0];return Io(async()=>{A=le();var E=await $i(I,{data:f,cancelToken:c,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(m=le()-A,E.code!==0){var _=new L(D.UNEXPECTED_RESPONSE,"live streaming ap error, code"+E.code,{retry:!0,responseTime:m});throw R.error(_.toString()),_}if(E=JSON.parse(E.json_body),E.code!==200)throw E=new L(D.UNEXPECTED_RESPONSE,b(_="live streaming app center error, code: ".concat(E.code,", reason: ")).call(_,E.reason),{code:E.code,responseTime:m}),R.error(E.toString()),E;if(!E.servers||E.servers.length===0)throw _=new L(D.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:E.code,responseTime:m}),R.error(_.toString()),_;return _=function(S,N){var O;return{addressList:Ie(O=S.servers).call(O,B=>{var P,J;return b(P=b(J="wss://".concat(B.address.replace(/\./g,"-"),".edge.agora.io:")).call(J,B.wss,"?serviceName=")).call(P,encodeURIComponent(N))}),workerToken:S.workerToken,vid:S.vid}}(E,n),te.LIVE_STREAMING_ADDRESS&&(_.addressList=te.LIVE_STREAMING_ADDRESS instanceof Array?te.LIVE_STREAMING_ADDRESS:[te.LIVE_STREAMING_ADDRESS]),function(S){for(var N=1;N<arguments.length;N++){var O,B=arguments[N]!=null?arguments[N]:{};if(N%2)K(O=km(Object(B),!0)).call(O,function(J){wn(S,J,B[J])});else if(xt)Tn(S,xt(B));else{var P;K(P=km(Object(B))).call(P,function(J){ft(S,J,ut(B,J))})}}return S}({},_,{responseTime:m})},(E,_)=>(z.apworkerEvent(s.sid,{success:!0,sc:200,serviceName:n,responseDetail:fe(E.addressList),firstSuccess:_===0,responseTime:m,serverIp:i[_%i.length]}),!1),(E,_)=>(z.apworkerEvent(s.sid,{success:!1,sc:E.data&&E.data.code||200,serviceName:n,responseTime:m,serverIp:i[_%i.length]}),!!(E.code!==D.OPERATION_ABORTED&&E.code!==D.UNEXPECTED_RESPONSE||E.data&&E.data.retry)&&(I=i[(_+1)%i.length],!0)),u)}function bm({url:i,areaCode:n},s,c,u){let h=le(),[f,A]=kI(s,n,[Rn.CHOOSE_SERVER]),m=ni.networkState;return Io(async()=>{m&&ni.networkState===Fi.OFFLINE&&ni.onlineWaiter&&await se.race([ni.onlineWaiter,Un(u&&u.maxRetryTimeout||Mr.maxRetryTimeout)]),m=ni.networkState;var I=await $i(i,{data:f,cancelToken:c,headers:{"Content-Type":"multipart/form-data;"}},!0);return NI(I,i,s,h,[Rn.CHOOSE_SERVER]),I=Vh(I,Rn.CHOOSE_SERVER),OI(I),ym(I,i)},I=>(I&&z.joinChooseServer(s.sid,{lts:h,succ:!0,csAddr:i,opid:A,serverList:I.gatewayAddrs,ec:null,cid:I.cid.toString(),uid:I.uid.toString(),csIp:I.csIp,unilbsServerIds:[Rn.CHOOSE_SERVER].toString()}),!1),I=>I.code!==D.OPERATION_ABORTED&&(I.code===D.CAN_NOT_GET_GATEWAY_SERVER?I.data.retry:(z.joinChooseServer(s.sid,{lts:h,succ:!1,csAddr:i,serverList:null,opid:A,ec:I.code,csIp:I.data&&I.data.csIp,unilbsServerIds:[Rn.CHOOSE_SERVER].toString(),extend:fe({networkState:m})}),R.warning("[".concat(s.clientId,"] Choose server network error, retry"),I),!0)),u)}function Dm({url:i,areaCode:n,serviceIds:s},c,u,h){let f=le(),[A,m]=kI(c,n,s),I;return Io(async()=>{I&&ni.networkState===Fi.OFFLINE&&ni.onlineWaiter&&await se.race([ni.onlineWaiter,Un(h&&h.maxRetryTimeout||Mr.maxRetryTimeout)]),I=ni.networkState;var E=await $i(i,{data:A,cancelToken:u,headers:{"Content-Type":"multipart/form-data;"}},!0);NI(E,i,c,f,s);let _=Vh(E,Rn.CHOOSE_SERVER);return E=Vh(E,c.cloudProxyServer==="proxy5"?Rn.CLOUD_PROXY_5:Rn.CLOUD_PROXY),OI(_),{gatewayInfo:ym(_,i),proxyInfo:E,url:i}},E=>{var _;return E.gatewayInfo&&z.joinChooseServer(c.sid,{lts:f,succ:!0,csAddr:i,serverList:E.gatewayInfo.gatewayAddrs,ec:null,opid:m,cid:E.gatewayInfo.cid.toString(),uid:E.gatewayInfo.uid.toString(),csIp:E.gatewayInfo.csIp,unilbsServerIds:s.toString()}),E.proxyInfo&&z.joinWebProxyAP(c.sid,{lts:f,sucess:1,apServerAddr:i,turnServerAddrList:Ie(_=E.proxyInfo.addresses).call(_,S=>S.ip).join(","),errorCode:null,eventType:c.cloudProxyServer,unilbsServerIds:s.toString()}),!1},E=>E.code!==D.OPERATION_ABORTED&&(E.code===D.CAN_NOT_GET_GATEWAY_SERVER?E.data.retry:(z.joinWebProxyAP(c.sid,{lts:f,sucess:0,apServerAddr:i,turnServerAddrList:null,errorCode:E.code,eventType:c.cloudProxyServer,unilbsServerIds:s.toString(),extend:fe({networkState:I})}),R.warning("[".concat(c.clientId,"] multi unilbs network error, retry"),E),!0)),h)}async function zc(i,n,s){return{gatewayInfo:await async function(c,u,h){var f,A;const m=Ie(f=Gr(A=te.WEBCS_DOMAIN).call(A,0,te.AJAX_REQUEST_CONCURRENT)).call(f,_=>{var S;return{url:c.proxyServer?b(S="https://".concat(c.proxyServer,"/ap/?url=")).call(S,_+"/api/v2/transpond/webrtc?v=2"):"https://".concat(_,"/api/v2/transpond/webrtc?v=2"),areaCode:yl()}});let I=null;const E=[];return I=await Qa([(async()=>await cc({fragementLength:te.FRAGEMENT_LENGTH,referenceList:m,asyncMapHandler:_=>(R.debug("[".concat(c.clientId,"] Connect to choose_server:"),_.url),bm(_,c,u,h)),allFailedhandler:_=>{throw _[0]},promisesCollector:E}))(),(async()=>{var _;if(await Un(1e3),I!==null)return I;const S=Ie(_=te.WEBCS_DOMAIN_BACKUP_LIST).call(_,N=>{var O;return{url:c.proxyServer?b(O="https://".concat(c.proxyServer,"/ap/?url=")).call(O,N+"/api/v2/transpond/webrtc?v=2"):"https://".concat(N,"/api/v2/transpond/webrtc?v=2"),areaCode:yl()}});return await cc({fragementLength:te.FRAGEMENT_LENGTH,referenceList:S,asyncMapHandler:N=>(R.debug("[".concat(c.clientId,"] Connect to backup choose_server:"),N.url),bm(N,c,u,h)),allFailedhandler:N=>{throw N[0]},promisesCollector:E})})()]),E.length&&K(E).call(E,_=>_.cancel&&typeof _.cancel=="function"&&_.cancel()),I}(i,n,s)}}async function Bm(i,n,s,c){var u,h;if(i.cloudProxyServer==="disabled")return c?await zc(i,n,s):void 0;let f;if(i.cloudProxyServer==="443only"||i.cloudProxyServer==="normal"){var A;let m;c?i.cloudProxyServer!=="normal"?[m,f]=await se.all([Ou(i,n,s),zc(i,n,s)]):(m=await Ou(i,n,s),i.proxyServer=m.addresses[0],z.setProxyServer(i.proxyServer),R.setProxyServer(i.proxyServer),f=await zc(i,n,s)):(f=void 0,i.cloudProxyServer!=="normal"?m=await Ou(i,n,s):(m=await Ou(i,n,s),i.proxyServer=m.addresses[0],z.setProxyServer(i.proxyServer),R.setProxyServer(i.proxyServer))),i.turnServer={mode:"manual",servers:Ie(A=m.addresses).call(A,I=>({turnServerURL:I,tcpport:i.cloudProxyServer==="proxy3"?void 0:m.serverResponse.tcpport?m.serverResponse.tcpport:jr.tcpport,udpport:i.cloudProxyServer==="proxy4"?void 0:m.serverResponse.udpport?m.serverResponse.udpport:jr.udpport,username:m.serverResponse.username||jr.username,password:m.serverResponse.password||jr.password,forceturn:i.cloudProxyServer!=="proxy4"&&i.cloudProxyServer!=="proxy5",security:i.cloudProxyServer==="proxy5"}))}}else{let{proxyInfo:m,gatewayInfo:I}=await async function(E,_,S){var N,O;const B=te.PROXY_SERVER_TYPE3,P=(ve,et)=>{var It;let zt=B;return ro(zt)&&(zt=et%2==0?B[1]:B[0]),b(It="https://".concat(zt,"/ap/?url=")).call(It,ve)},J=Ie(N=Gr(O=te.WEBCS_DOMAIN).call(O,0,te.AJAX_REQUEST_CONCURRENT)).call(N,(ve,et)=>({url:P("".concat(ve,"/api/v2/transpond/webrtc?v=2"),et),areaCode:yl(),serviceIds:[Rn.CHOOSE_SERVER,E.cloudProxyServer==="proxy5"?Rn.CLOUD_PROXY_5:Rn.CLOUD_PROXY]}));let ne=null;const Ae=[],{gatewayInfo:Me,proxyInfo:be,url:Rt}=await Qa([(async()=>await cc({fragementLength:te.FRAGEMENT_LENGTH,referenceList:J,asyncMapHandler:ve=>(R.debug("[".concat(E.clientId,"] Connect to choose_server:"),ve.url),Dm(ve,E,_,S)),allFailedhandler:ve=>{throw ve[0]},promisesCollector:Ae}))(),(async()=>{var ve;if(await Un(1e3),ne!==null)return ne;const et=Ie(ve=te.WEBCS_DOMAIN_BACKUP_LIST).call(ve,(It,zt)=>({url:P("".concat(It,"/api/v2/transpond/webrtc?v=2"),zt),areaCode:yl(),serviceIds:[11,18]}));return await cc({fragementLength:te.FRAGEMENT_LENGTH,referenceList:et,asyncMapHandler:It=>(R.debug("[".concat(E.clientId,"] Connect to backup choose_server:"),It.url),Dm(It,E,_,S)),allFailedhandler:It=>{throw It[0]},promisesCollector:Ae})})()]);if(Ae.length&&K(Ae).call(Ae,ve=>ve.cancel&&typeof ve.cancel=="function"&&ve.cancel()),!Me||!be)throw new L(D.UNEXPECTED_ERROR,"missing gateway or proxy response").print();return ro(B)&&Rt&&(N=new cN(Rt).host,vt(B).call(B,N)&&(E.proxyServer=N,R.setProxyServer(N),z.setProxyServer(N))),ne={gatewayInfo:Me,proxyInfo:vT(be)},ne}(i,n,s);f={gatewayInfo:I},i.turnServer={mode:"manual",servers:Ie(m).call(m,E=>({turnServerURL:E.address,tcpport:i.cloudProxyServer==="proxy3"?void 0:E.tcpport?E.tcpport:jr.tcpport,udpport:i.cloudProxyServer==="proxy4"?void 0:E.udpport?E.udpport:jr.udpport,username:E.username||jr.username,password:E.password||jr.password,forceturn:i.cloudProxyServer!=="proxy4"&&i.cloudProxyServer!=="proxy5",security:i.cloudProxyServer==="proxy5"}))}}return R.debug(b(u=b(h="[".concat(i.clientId,"] set proxy server: ")).call(h,i.proxyServer,", mode: ")).call(u,i.cloudProxyServer)),f}async function Kh(i,n,s,c){var u;let h=Gr(u=te.ACCOUNT_REGISTER).call(u,0,te.AJAX_REQUEST_CONCURRENT);return u=[],u=n.proxyServer?Ie(h).call(h,f=>{var A;return b(A="https://".concat(n.proxyServer,"/ap/?url=")).call(A,f+"/api/v1")}):Ie(h).call(h,f=>"https://".concat(f,"/api/v1")),(await async function(f,A,m,I,E){let _=le(),S={sid:m.sid,opid:10,appid:m.appId,string_uid:A},N=f[0];if(m=await Io(()=>$i(N+"".concat(Ke(N).call(N,"?")===-1?"?":"&","action=stringuid"),{data:S,cancelToken:I,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(O,B)=>{if(O.code===0){var P;if(0>=O.uid||O.uid>=Math.pow(2,32))throw R.error(b(P="Invalid Uint Uid ".concat(A," => ")).call(P,O.uid),O),z.reqUserAccount(S.sid,{lts:_,success:!1,serverAddr:N,stringUid:S.string_uid,uid:O.uid,errorCode:D.INVALID_UINT_UID_FROM_STRING_UID,extend:S}),new L(D.INVALID_UINT_UID_FROM_STRING_UID);return z.reqUserAccount(S.sid,{lts:_,success:!0,serverAddr:N,stringUid:S.string_uid,uid:O.uid,errorCode:null,extend:S}),!1}return P=Nu(O.code),P.retry&&(N=f[(B+1)%f.length]),z.reqUserAccount(S.sid,{lts:_,success:!1,serverAddr:N,stringUid:S.string_uid,uid:O.uid,errorCode:P.desc,extend:S}),P.retry},(O,B)=>O.code!==D.OPERATION_ABORTED&&(z.reqUserAccount(S.sid,{lts:_,success:!1,serverAddr:N,stringUid:S.string_uid,uid:null,errorCode:O.code,extend:S}),N=f[(B+1)%f.length],!0),E),m.code!==0)throw m=Nu(m.code),new L(D.UNEXPECTED_RESPONSE,m.desc);return m}(u,i,n,s,c)).uid}async function Ou(i,n,s){var c,u=le(),h=Ie(c=te[i.cloudProxyServer==="normal"?"PROXY_CS":"WEBCS_DOMAIN"]).call(c,A=>{var m;return i.proxyServer?b(m="https://".concat(i.proxyServer,"/ap/?url=")).call(m,A+"/api/v1"):"https://".concat(A,"/api/v1")});if(i.cloudProxyServer==="proxy3"||i.cloudProxyServer==="proxy4"||i.cloudProxyServer==="proxy5"){u=Ie(h).call(h,A=>({url:A,areaCode:yl()}));var f=null;if(f=await cc({fragementLength:te.FRAGEMENT_LENGTH,referenceList:u,asyncMapHandler:A=>function({url:m,areaCode:I},E,_,S){let N=le(),O={opid:133,flag:E.cloudProxyServer==="proxy5"?4194304:1048576,ts:+new Date,key:E.token,cname:E.cname,sid:E.sid,detail:{6:E.stringUid,11:I},uid:E.uid||0};return Io(async()=>await $i(m,{data:O,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":69}}),B=>{var P;if(B.code===0)return z.joinWebProxyAP(E.sid,{lts:N,sucess:1,apServerAddr:m,turnServerAddrList:Ie(P=B.addresses).call(P,J=>J.ip).join(","),errorCode:null,eventType:E.cloudProxyServer}),!1;throw B=Nu(B.code),new L(D.CAN_NOT_GET_GATEWAY_SERVER,B.desc,{retry:B.retry})},B=>{return B.code!==D.OPERATION_ABORTED&&(B.code===D.CAN_NOT_GET_GATEWAY_SERVER?(z.joinWebProxyAP(O.sid,{lts:N,sucess:0,apServerAddr:m,turnServerAddrList:null,errorCode:B.code,eventType:E.cloudProxyServer}),R.warning(b(P=b(J=b(ne="[".concat(E.clientId,"] proxy ap server ")).call(ne,m," failed, message: ")).call(J,B.message,", retry: ")).call(P,B.data.retry)),B.data.retry):(z.joinWebProxyAP(O.sid,{lts:N,sucess:0,apServerAddr:m,turnServerAddrList:null,errorCode:B.code,eventType:E.cloudProxyServer}),!0));var P,J,ne},S)}(A,i,n,s),allFailedhandler:()=>{throw R.error("[".concat(i.clientId,"] can not get proxy server after trying several times")),new L(D.CAN_NOT_GET_PROXY_SERVER)}}),u=f.addresses,!u||u.length===0)throw R.error("[".concat(i.clientId,"] can not get proxy server, empty proxy server list")),new L(D.CAN_NOT_GET_PROXY_SERVER,"empty proxy server list");return{addresses:Ie(u).call(u,A=>A.ip),serverResponse:{tcpport:u[0].port||443,udpport:u[0].port||jr.udpport,username:jr.username,password:jr.password}}}if(c=null,c=await cc({fragementLength:te.FRAGEMENT_LENGTH,referenceList:h,asyncMapHandler:A=>function(m,I,E,_){let S=le(),N={command:"convergeAllocateEdge",sid:I.sid,appId:I.appId,token:I.token,uid:I.uid,cname:I.cname,ts:Math.floor(le()/1e3),version:ei,seq:0,requestId:1};return Io(async()=>({res:await $i(m,{data:{service_name:"webrtc_proxy",json_body:fe(N)},cancelToken:E,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}}),url:m}),O=>{if(!O.res.json_body)throw R.debug("[".concat(I.clientId,"] Get proxy server failed: no json_body")),new L(D.UNEXPECTED_RESPONSE,fe(O.res));let B=JSON.parse(O.res.json_body);var P,J;if(B.code!==200)throw R.debug(b(P=b(J="[".concat(I.clientId,"] Get proxy server failed: response code [")).call(J,B.code,"], reason [")).call(P,B.reason,"]")),new L(D.UNEXPECTED_RESPONSE,fe(O.res));return R.debug("[".concat(I.clientId,"] App return server length"),B.servers.length),!1},O=>O.code!==D.OPERATION_ABORTED&&(z.requestProxyAppCenter(N.sid,{lts:S,succ:!1,APAddr:m,workerManagerList:null,ec:O.code,response:O.message}),!0),_)}(A,i,n,s),allFailedhandler:()=>{throw R.error("[".concat(i.clientId,"] can not get proxy server after trying several times")),new L(D.CAN_NOT_GET_PROXY_SERVER)}}),h=JSON.parse(c.res.json_body),h=Ie(f=h.servers).call(f,gT),i.cloudProxyServer==="443only")return{addresses:h,serverResponse:{tcpport:443,udpport:jr.udpport,username:jr.username,password:jr.password}};z.requestProxyAppCenter(i.sid,{lts:u,succ:!0,APAddr:c.url,workerManagerList:fe(h),ec:null,response:fe(c.res)}),u=le(),f=Ie(h).call(h,A=>function(m,I,E,_){const S=le();let N=m;ll(m).call(m,"http")||(N="https://".concat(m,":4000/v2/machine"));const O={command:"request",gatewayType:"http",appId:I.appId,cname:I.cname,uid:(I.uid||"").toString(),sdkVersion:"2.3.1",sid:I.sid,seq:1,ts:le(),requestId:3,clientRequest:{appId:I.appId,cname:I.cname,uid:(I.uid||"").toString(),sid:I.sid}};return Io(async()=>({res:await $i(N,{data:O,cancelToken:E}),url:m}),B=>{if(!B.res.serverResponse)throw new L(D.UNEXPECTED_RESPONSE,"requeet worker manager server failed: serverResponse is undefined");return!1},B=>B.code!==D.OPERATION_ABORTED&&(z.requestProxyWorkerManager(O.sid,{lts:S,succ:!1,workerManagerAddr:m,ec:B.code,response:B.message}),!0),_)}(A,i,n,s)),c=null;try{c=await Qa(f)}catch{throw R.error("[".concat(i.clientId,"] can not get worker manager after trying several times")),new L(D.CAN_NOT_GET_PROXY_SERVER)}return K(f).call(f,A=>A.cancel()),z.requestProxyWorkerManager(i.sid,{lts:u,succ:!0,workerManagerAddr:c.url,ec:null,response:fe(c.res)}),{addresses:[c.url],serverResponse:c.res.serverResponse}}async function yT(i,n,s){var c,u,h=Ie(c=Gr(u=te.CDS_AP).call(u,0,te.AJAX_REQUEST_CONCURRENT)).call(c,A=>{var m;return i.proxyServer?b(m="https://".concat(i.proxyServer,"/ap/?url=")).call(m,A+"/api/v1"):"https://".concat(A,"/api/v1?action=config")});c=Ie(h).call(h,A=>function(m,I,E,_){const S=Je(),N={flag:64,cipher_method:0,features:{device:S.name,system:S.os,vendor:I.appId,version:ei,cname:I.cname,sid:I.sid,session_id:I.sid,detail:"",proxyServer:I.proxyServer}};return Io(()=>$i(m,{data:N,timeout:1e3,cancelToken:E,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,O=>O.code!==D.OPERATION_ABORTED,_)}(A,i,n,s)),h=u=null;let f={};try{u=await Qa(c)}catch(A){if(A.code===D.OPERATION_ABORTED)throw A;h=A}if(K(c).call(c,A=>A.cancel()),z.reportApiInvoke(i.sid,{name:Re.REQUEST_CONFIG_DISTRIBUTE,options:{error:h,res:u}}).onSuccess(),u&&u.test_tags)try{f=function(A){if(!A.test_tags)return{};let m=A.test_tags;A=pt(m);let I={};return K(A).call(A,E=>{var _;let S=oa(_=Gr(E).call(E,4)).call(_);E=JSON.parse(m[E])[1],I[S]=E}),I}(u)}catch{}return f}async function Mm(i,n,s,c){var u,h;let f=Ie(u=Gr(h=te.UAP_AP).call(h,0,te.AJAX_REQUEST_CONCURRENT)).call(u,A=>{var m;return n.proxyServer?b(m="https://".concat(n.proxyServer,"/ap/?url=")).call(m,A+"/api/v1?action=uap"):"https://".concat(A,"/api/v1?action=uap")});return await CT(f,i,n,s,c)}async function _T(i,n,s){var c,u;let h=Ie(c=Gr(u=te.UAP_AP).call(u,0,te.AJAX_REQUEST_CONCURRENT)).call(c,f=>{var A;return i.proxyServer?b(A="https://".concat(i.proxyServer,"/ap/?url=")).call(A,f+"/api/v1?action=uap"):"https://".concat(f,"/api/v1?action=uap")});c=Ie(h).call(h,f=>function(A,m,I,E){m={command:"convergeAllocateEdge",sid:m.sid,appId:m.appId,token:m.token,ts:le(),version:ei,cname:m.cname,uid:m.uid.toString(),requestId:wf,seq:wf},wf+=1;const _={service_name:"tele_channel",json_body:fe(m)};return Io(async()=>{var S=await $i(A,{data:_,cancelToken:I,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(S.code!==0){var N=new L(D.UNEXPECTED_RESPONSE,"cross channel ap error, code"+S.code,{retry:!0});throw R.error(N.toString()),N}if(S=JSON.parse(S.json_body),S.code!==200){var O=new L(D.UNEXPECTED_RESPONSE,b(N="cross channel app center error, code: ".concat(S.code,", reason: ")).call(N,S.reason));throw R.error(O.toString()),O}if(!S.servers||S.servers.length===0)throw N=new L(D.UNEXPECTED_RESPONSE,"cross channel app center empty server"),R.error(N.toString()),N;return{vid:S.vid,workerToken:S.workerToken,addressList:Ie(O=S.servers).call(O,B=>{var P;return b(P="wss://".concat(B.address.replace(/\./g,"-"),".edge.agora.io:")).call(P,B.wss)})}},void 0,S=>!!(S.code!==D.OPERATION_ABORTED&&S.code!==D.UNEXPECTED_RESPONSE||S.data&&S.data.retry),E)}(f,i,n,s));try{let f=await Qa(c);return K(c).call(c,A=>A.cancel()),f}catch(f){throw f[0]}}function Lm(i,n){var s=pt(i);if(Qt){var c=Qt(i);n&&(c=Qe(c).call(c,function(u){return ut(i,u).enumerable})),s.push.apply(s,c)}return s}function Bi(i){if(Array.isArray(i))return i.map(function(c){return c});if(!Pm(i))return i;var n={},s;for(s in i)Pm(i[s])||Array.isArray(i[s])?n[s]=Bi(i[s]):n[s]=i[s];return n}function Pm(i){return!(typeof i!="object"||Array.isArray(i)||!i)}function Wh(i,n){function s(){this.constructor=i}bI(i,n),i.prototype=n===null?Object.create(n):(s.prototype=n.prototype,new s)}function Yh(i,n,s,c){return new(s||(s=Promise))(function(u,h){function f(I){try{m(c.next(I))}catch(E){h(E)}}function A(I){try{m(c.throw(I))}catch(E){h(E)}}function m(I){I.done?u(I.value):new s(function(E){E(I.value)}).then(f,A)}m((c=c.apply(i,n||[])).next())})}function qh(i,n){function s(m){return function(I){return function(E){if(c)throw new TypeError("Generator is already executing.");for(;A;)try{if(c=1,u&&(h=2&E[0]?u.return:E[0]?u.throw||((h=u.return)&&h.call(u),0):u.next)&&!(h=h.call(u,E[1])).done)return h;switch(u=0,h&&(E=[2&E[0],h.value]),E[0]){case 0:case 1:h=E;break;case 4:return A.label++,{value:E[1],done:!1};case 5:A.label++,u=E[1],E=[0];continue;case 7:E=A.ops.pop(),A.trys.pop();continue;default:if(h=A.trys,!((h=0<h.length&&h[h.length-1])||E[0]!==6&&E[0]!==2)){A=0;continue}if(E[0]===3&&(!h||E[1]>h[0]&&E[1]<h[3]))A.label=E[1];else if(E[0]===6&&A.label<h[1])A.label=h[1],h=E;else if(h&&A.label<h[2])A.label=h[2],A.ops.push(E);else{h[2]&&A.ops.pop(),A.trys.pop();continue}}E=n.call(i,A)}catch(_){E=[6,_],u=0}finally{c=h=0}if(5&E[0])throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}([m,I])}}var c,u,h,f,A={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return f={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f}function ST(i,n,s){return s=i.createShader(s),s?(i.shaderSource(s,n),i.compileShader(s),i.getShaderParameter(s,i.COMPILE_STATUS)?s:(n=i.getShaderInfoLog(s),i.deleteShader(s),new L(D.WEBGL_INTERNAL_ERROR,"error compiling shader:"+n).throw())):new L(D.WEBGL_INTERNAL_ERROR,"can not create shader").throw()}function TT(i,n,s,c){let u=[];for(let h=0;h<n.length;++h)u.push(ST(i,n[h],h===0?i.VERTEX_SHADER:i.FRAGMENT_SHADER));return function(h,f,A,m){let I=h.createProgram();if(!I)throw new L(D.WEBGL_INTERNAL_ERROR,"can not create webgl program");if(K(f).call(f,E=>{h.attachShader(I,E)}),A&&K(A).call(A,(E,_)=>{h.bindAttribLocation(I,m?m[_]:_,E)}),h.linkProgram(I),!h.getProgramParameter(I,h.LINK_STATUS))throw f=h.getProgramInfoLog(I),h.deleteProgram(I),new L(D.WEBGL_INTERNAL_ERROR,"error in program linking:"+f);return I}(i,u,s,c)}function xm(i){var n=new Uint8Array([99,114,121,112,116,105,105]),s=n.length;let c=i.length,u=new Uint8Array(c),h=new Uint8Array(256);for(var f=0;256>f;f++)h[f]=f;f=0;for(var A=0;256>A;A++)f=(f+h[A]+n[A%s])%256,[h[A],h[f]]=[h[f],h[A]];for(f=s=0,A=0;A<0+c;A++)s=(s+1)%256,f=(f+h[s])%256,[h[s],h[f]]=[h[f],h[s]],n=h[(h[s]+h[f])%256],0<=A&&(u[A-0]=i[A-0]^n);return i=String.fromCharCode.apply(null,oo(u)),Function("var winSize = 5; return `"+i+"`")()}function Jh(i){let n={};return i.facingMode&&(n.facingMode=i.facingMode),i.cameraId&&(n.deviceId={exact:i.cameraId}),i.encoderConfig?(i=ds(i.encoderConfig),n.width=i.width,n.height=i.height,!_u()&&i.frameRate&&(n.frameRate=i.frameRate),Je().name===$e.EDGE&&typeof n.frameRate=="object"&&(n.frameRate.max=60),Or()&&(n.frameRate={ideal:30,max:30}),n):n}function Qm(i){let n={};if(_u()||(i.AGC!==void 0&&(n.autoGainControl=i.AGC,zi()&&(n.googAutoGainControl=i.AGC,n.googAutoGainControl2=i.AGC)),i.AEC!==void 0&&(n.echoCancellation=i.AEC),i.ANS!==void 0&&(n.noiseSuppression=i.ANS,zi()&&(n.googNoiseSuppression=i.ANS))),i.encoderConfig){let s=La(i.encoderConfig);n.channelCount=s.stereo?2:1,n.sampleRate=s.sampleRate,n.sampleSize=s.sampleSize}return i.microphoneId&&(n.deviceId={exact:i.microphoneId}),zi()&&n.channelCount===2&&(n.googAutoGainControl=!1,n.googAutoGainControl2=!1,n.echoCancellation=!1,n.googNoiseSuppression=!1),Je().os===ln.ANDROID&&(n.sampleRate=void 0),n}function Um(i,n){var s=pt(i);if(Qt){var c=Qt(i);n&&(c=Qe(c).call(c,function(u){return ut(i,u).enumerable})),s.push.apply(s,c)}return s}function Xc(i){for(var n=1;n<arguments.length;n++){var s,c=arguments[n]!=null?arguments[n]:{};if(n%2)K(s=Um(Object(c),!0)).call(s,function(h){wn(i,h,c[h])});else if(xt)Tn(i,xt(c));else{var u;K(u=Um(Object(c))).call(u,function(h){ft(i,h,ut(c,h))})}}return i}function Fm(i){let n={video:[],audio:[]};return i.match(/ VP8/i)&&n.video.push("VP8"),i.match(/ VP9/i)&&n.video.push("VP9"),i.match(/ AV1X/i)&&n.video.push("AV1"),i.match(/ H264/i)&&n.video.push("H264"),i.match(/ opus/i)&&n.audio.push("OPUS"),n}function zh(i,n){var s=i.match(/a=rtpmap:(\d+) opus/);if(!s||!s[0]||!s[1])return i;var c=s[1];if(s=i.match("a=fmtp:".concat(c,`.*\r
`)),!s||!s[0])return i;c="a=fmtp:".concat(c," minptime=10;useinbandfec=1;");var u;return n.bitrate&&!Or()&&(c+="maxaveragebitrate=".concat(Math.floor(1e3*n.bitrate),";")),n.sampleRate&&(c+=b(u="maxplaybackrate=".concat(n.sampleRate,";sprop-maxcapturerate=")).call(u,n.sampleRate,";")),n.stereo&&(c+="stereo=1;sprop-stereo-1;"),c+=`\r
`,i.replace(s[0],c)}function Vm(i){return i.replace("minptime=10","minptime=10;stereo=1;sprop-stereo=1")}function Gm(i,n,s){var c=!1;switch(n){case"h264":return i;case"vp8":if(!te.SIMULCAST)return i;s&&(s.numSpatialLayers=2);case"vp9":case"av1":c=!0}if(c){var u;let Ae=fr(u=RegExp.prototype.test).call(u,/^([a-z])=(.*)/),Me=i.split("m="),be,Rt,ve=null,et=null,It=null,zt=[];u=[];var h;n=[];let Pr=c=null;var f;let Vt=[],dn=[];for(var A=0;A<Me.length;++A)if(ve=Me[A].match(/a=msid-semantic:/),ve){ve=Me[A];break}for(A=0;A<Me.length;++A)if(et=Me[A].match(/audio /),et){be=A,et="m="+Me[A];break}for(A=0;A<Me.length;++A)if(It=Me[A].match(/video /),It){Rt=A,It="m="+Me[A];break}if(ve&&(zt=Qe(h=ve.split(/(\r\n|\r|\n)/)).call(h,Ae)),0<zt.length&&(n=b(n).call(n,zt)),et&&(u=Qe(f=et.split(/(\r\n|\r|\n)/)).call(f,Ae)),!It)return i;var m;for(h=Qe(m=It.split(/(\r\n|\r|\n)/)).call(m,Ae),m=0;m<h.length;++m)if(c===null&&(c=h[m].match(/cname:/),c!==null)){c="cname:"+h[m].split("cname:")[1];break}for(f=0;f<h.length;++f)if(Pr===null&&(Pr=h[f].match(/a=msid:/),Pr!==null&&(Pr="msid:"+h[f].split(":")[1])),h[f].match(/a=ssrc-group:FID/)){m=h[f].split(" "),Vt.push(Number(m[1])),m[2]&&dn.push(Number(m[2])),h.length=f;break}for(m=1;m<s.numSpatialLayers;++m)Vt.push(Vt[0]+m),0<dn.length&&dn.push(dn[0]+m);for(m="a=ssrc-group:SIM ",f=0;f<Vt.length;++f)m=b(m).call(m,String(Vt[f])),f<Vt.length-1&&(m=b(m).call(m," "));for(h.push(m),m=0;m<s.numSpatialLayers;++m){var I,E;f=b(I=b(E=b("a=ssrc-group:FID ").call("a=ssrc-group:FID ",String(Vt[m]))).call(E," ")).call(I,String(dn[m])),h.push(f)}for(I=0;I<s.numSpatialLayers;++I){var _,S,N,O;if(c===null||Pr===null)return i;E=b(_=b(S="a=ssrc:".concat(String(Vt[I]))).call(S," ")).call(_,c),m=b(N=b(O="a=ssrc:".concat(String(Vt[I]))).call(O," ")).call(N,Pr),h.push(E),h.push(m)}for(_=0;_<s.numSpatialLayers;++_){var B,P,J,ne;if(c===null||Pr===null)return i;S=b(B=b(P="a=ssrc:".concat(String(dn[_]))).call(P," ")).call(B,c),N=b(J=b(ne="a=ssrc:".concat(String(dn[_]))).call(ne," ")).call(J,Pr),h.push(S),h.push(N)}be&&Rt&&be>Rt?(n=b(n).call(n,h),n=b(n).call(n,u)):(n=b(n).call(n,u),n=b(n).call(n,h)),i=n.join(`\r
`)+`\r
`}return i}function Xh(i,n){let s=(u,h)=>{const f=JI(u,h);return f?s(c(u,f),h):u},c=(u,h)=>{var f,A;const m=fr(f=RegExp.prototype.test).call(f,/^([a-z])=(.*)/),I=["a=rtpmap:".concat(h),"a=rtcp-fb:".concat(h),"a=fmtp:".concat(h)],E=Qe(A=u.split(/(\r\n|\r|\n)/)).call(A,m),_=[];if(K(E).call(E,(N,O)=>{K(I).call(I,B=>{vt(N).call(N,B)&&_.push(O)})}),u=yd(E).call(E,N=>vt(N).call(N,"apt=".concat(h))),u){_.push(u,u-1);var S=(S=E[u-1].match(/a=rtpmap:(\d+) rtx.*/))&&S[1]}return K(_).call(_,N=>{E[N]=""}),u=yd(E).call(E,N=>vt(N).call(N,"m=video")),E[u]=E[u].replace(" ".concat(h),""),S&&(E[u]=E[u].replace(" ".concat(S),"")),Qe(E).call(E,N=>!!N).join(`\r
`)+`\r
`};return K(n).call(n,u=>{i=s(i,u)}),i}function RT(i,n){let s=document.createElement("video"),c=document.createElement("canvas");s.setAttribute("style","display:none"),c.setAttribute("style","display:none"),s.setAttribute("muted",""),s.muted=!0,s.setAttribute("autoplay",""),s.autoplay=!0,s.setAttribute("playsinline",""),c.width=fs(n.width),c.height=fs(n.height),n=fs(n.framerate||15),document.body.append(s),document.body.append(c);let u=i._mediaStreamTrack;s.srcObject=new MediaStream([u]),s.play();let h=c.getContext("2d");if(!h)throw new L(D.UNEXPECTED_ERROR,"can not get canvas context");let f=c.captureStream(Pt.supportRequestFrame?0:n).getVideoTracks()[0],A=Fh(()=>{if(s.paused&&s.play(),2<s.videoHeight&&2<s.videoWidth){const S=s.videoHeight/s.videoWidth*c.width;var I,E,_;2<=Math.abs(S-c.height)&&(R.debug("adjust low stream resolution",b(I=b(E=b(_="".concat(c.width,"x")).call(_,c.height," -> ")).call(E,c.width,"x")).call(I,S)),c.height=S)}h.drawImage(s,0,0,c.width,c.height),f.requestFrame&&f.requestFrame(),u!==i._mediaStreamTrack&&(u=i._mediaStreamTrack,s.srcObject=new MediaStream([u]))},n),m=f.stop;return f.stop=()=>{m.call(f),A(),s.remove(),c.width=0,c.remove(),s=c=null,R.debug("clean low stream renderer")},f}function jm(i,n){var s=pt(i);if(Qt){var c=Qt(i);n&&(c=Qe(c).call(c,function(u){return ut(i,u).enumerable})),s.push.apply(s,c)}return s}function Hm(i){for(var n=1;n<arguments.length;n++){var s,c=arguments[n]!=null?arguments[n]:{};if(n%2)K(s=jm(Object(c),!0)).call(s,function(h){wn(i,h,c[h])});else if(xt)Tn(i,xt(c));else{var u;K(u=jm(Object(c))).call(u,function(h){ft(i,h,ut(c,h))})}}return i}function Km(i,n){var s=pt(i);if(Qt){var c=Qt(i);n&&(c=Qe(c).call(c,function(u){return ut(i,u).enumerable})),s.push.apply(s,c)}return s}function $h(i){for(var n=1;n<arguments.length;n++){var s,c=arguments[n]!=null?arguments[n]:{};if(n%2)K(s=Km(Object(c),!0)).call(s,function(h){wn(i,h,c[h])});else if(xt)Tn(i,xt(c));else{var u;K(u=Km(Object(c))).call(u,function(h){ft(i,h,ut(c,h))})}}return i}function Wm(i,n){var s=pt(i);if(Qt){var c=Qt(i);n&&(c=Qe(c).call(c,function(u){return ut(i,u).enumerable})),s.push.apply(s,c)}return s}function Zh(i){for(var n=1;n<arguments.length;n++){var s,c=arguments[n]!=null?arguments[n]:{};if(n%2)K(s=Wm(Object(c),!0)).call(s,function(h){wn(i,h,c[h])});else if(xt)Tn(i,xt(c));else{var u;K(u=Wm(Object(c))).call(u,function(h){ft(i,h,ut(c,h))})}}return i}function Ym(i,n){var s=pt(i);if(Qt){var c=Qt(i);n&&(c=Qe(c).call(c,function(u){return ut(i,u).enumerable})),s.push.apply(s,c)}return s}function As(i){for(var n=1;n<arguments.length;n++){var s,c=arguments[n]!=null?arguments[n]:{};if(n%2)K(s=Ym(Object(c),!0)).call(s,function(h){wn(i,h,c[h])});else if(xt)Tn(i,xt(c));else{var u;K(u=Ym(Object(c))).call(u,function(h){ft(i,h,ut(c,h))})}}return i}function qm(i){if(!(i instanceof $I))return new L(D.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();let n=i.getSrcChannelMediaInfo();if(i=i.getDestChannelMediaInfo(),!n)return new L(D.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(i.size===0)return new L(D.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}function Jm(i,n){var s=pt(i);if(Qt){var c=Qt(i);n&&(c=Qe(c).call(c,function(u){return ut(i,u).enumerable})),s.push.apply(s,c)}return s}function Ua(i){for(var n=1;n<arguments.length;n++){var s,c=arguments[n]!=null?arguments[n]:{};if(n%2)K(s=Jm(Object(c),!0)).call(s,function(h){wn(i,h,c[h])});else if(xt)Tn(i,xt(c));else{var u;K(u=Jm(Object(c))).call(u,function(h){ft(i,h,ut(c,h))})}}return i}async function wT(i,n){var s=null;if(typeof i=="string"){let c=ZI.get(i);if(c)return R.debug("use cached audio resource: ",i),c;try{s=(await Io(()=>To.get(i,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(u){throw new L(D.FETCH_AUDIO_FILE_FAILED,u.toString())}}else s=await new se((c,u)=>{const h=new FileReader;h.onload=f=>{f.target?c(f.target.result):u(new L(D.READ_LOCAL_AUDIO_FILE_ERROR))},h.onerror=()=>{u(new L(D.READ_LOCAL_AUDIO_FILE_ERROR))},h.readAsArrayBuffer(i)});return s=await function(c){const u=Wc();return new se((h,f)=>{u.decodeAudioData(c,A=>{h(A)},A=>{f(new L(D.DECODE_AUDIO_FILE_FAILED,A.toString()))})})}(s),typeof i=="string"&&n&&ZI.set(i,s),s}function zm(i,n){var s=pt(i);if(Qt){var c=Qt(i);n&&(c=Qe(c).call(c,function(u){return ut(i,u).enumerable})),s.push.apply(s,c)}return s}function ep(i){for(var n=1;n<arguments.length;n++){var s,c=arguments[n]!=null?arguments[n]:{};if(n%2)K(s=zm(Object(c),!0)).call(s,function(h){wn(i,h,c[h])});else if(xt)Tn(i,xt(c));else{var u;K(u=zm(Object(c))).call(u,function(h){ft(i,h,ut(c,h))})}}return i}function tp(i,n,s,c){s.optimizationMode&&(c&&c.width&&c.height?(s.encoderConfig=ep({},c,{bitrateMin:c.bitrateMin,bitrateMax:c.bitrateMax}),s.optimizationMode!=="motion"&&s.optimizationMode!=="detail"||(n.contentHint=s.optimizationMode,n.contentHint===s.optimizationMode?R.debug("[".concat(i,"] set content hint to"),s.optimizationMode):R.debug("[".concat(i,"] set content hint failed")))):R.warning("[".concat(i,"] can not apply optimization mode bitrate config, no encoderConfig")))}var $c=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof Uf!="undefined"?Uf:typeof self!="undefined"?self:{},ku=function(i){return i&&i.Math==Math&&i},He=ku(typeof globalThis=="object"&&globalThis)||ku(typeof window=="object"&&window)||ku(typeof self=="object"&&self)||ku(typeof $c=="object"&&$c)||Function("return this")(),ur=function(i){try{return!!i()}catch{return!0}},jt=!ur(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7}),Xm={}.propertyIsEnumerable,$m=Object.getOwnPropertyDescriptor,bu=$m&&!Xm.call({1:2},1)?function(i){return i=$m(this,i),!!i&&i.enumerable}:Xm,Ho=function(i,n){return{enumerable:!(1&i),configurable:!(2&i),writable:!(4&i),value:n}},NT={}.toString,yo=function(i){return NT.call(i).slice(8,-1)},OT="".split,Du=ur(function(){return!Object("z").propertyIsEnumerable(0)})?function(i){return yo(i)=="String"?OT.call(i,""):Object(i)}:Object,zs=function(i){if(i==null)throw TypeError("Can't call method on "+i);return i},fi=function(i){return Du(zs(i))},qt=function(i){return typeof i=="object"?i!==null:typeof i=="function"},Fa=function(i,n){if(!qt(i))return i;var s,c;if(n&&typeof(s=i.toString)=="function"&&!qt(c=s.call(i))||typeof(s=i.valueOf)=="function"&&!qt(c=s.call(i))||!n&&typeof(s=i.toString)=="function"&&!qt(c=s.call(i)))return c;throw TypeError("Can't convert object to primitive value")},kT={}.hasOwnProperty,nt=function(i,n){return kT.call(i,n)},Va=He.document,Bu=qt(Va)&&qt(Va.createElement),Zm=!jt&&!ur(function(){return Object.defineProperty(Bu?Va.createElement("div"):{},"a",{get:function(){return 7}}).a!=7}),ev=Object.getOwnPropertyDescriptor,Ga=jt?ev:function(i,n){if(i=fi(i),n=Fa(n,!0),Zm)try{return ev(i,n)}catch{}if(nt(i,n))return Ho(!bu.call(i,n),i[n])},bT=/#|\.prototype\./,ja=function(i,n){return i=BT[DT(i)],i==LT||i!=MT&&(typeof n=="function"?ur(n):!!n)},DT=ja.normalize=function(i){return String(i).replace(bT,".").toLowerCase()},BT=ja.data={},MT=ja.NATIVE="N",LT=ja.POLYFILL="P",Ft={},Zi=function(i){if(typeof i!="function")throw TypeError(String(i)+" is not a function");return i},gs=function(i,n,s){if(Zi(i),n===void 0)return i;switch(s){case 0:return function(){return i.call(n)};case 1:return function(c){return i.call(n,c)};case 2:return function(c,u){return i.call(n,c,u)};case 3:return function(c,u,h){return i.call(n,c,u,h)}}return function(){return i.apply(n,arguments)}},an=function(i){if(!qt(i))throw TypeError(String(i)+" is not an object");return i},tv=Object.defineProperty,Mi={f:jt?tv:function(i,n,s){if(an(i),n=Fa(n,!0),an(s),Zm)try{return tv(i,n,s)}catch{}if("get"in s||"set"in s)throw TypeError("Accessors not supported");return"value"in s&&(i[n]=s.value),i}},eo=jt?function(i,n,s){return Mi.f(i,n,Ho(1,s))}:function(i,n,s){return i[n]=s,i},PT=Ga,xT=function(i){var n=function(s,c,u){if(this instanceof i){switch(arguments.length){case 0:return new i;case 1:return new i(s);case 2:return new i(s,c)}return new i(s,c,u)}return i.apply(this,arguments)};return n.prototype=i.prototype,n},je=function(i,n){var s,c,u,h,f,A=i.target,m=i.global,I=i.stat,E=i.proto,_=m?He:I?He[A]:(He[A]||{}).prototype,S=m?Ft:Ft[A]||(Ft[A]={}),N=S.prototype;for(c in n){var O=!ja(m?c:A+(I?".":"#")+c,i.forced)&&_&&nt(_,c),B=S[c];O&&(u=i.noTargetGet?(f=PT(_,c))&&f.value:_[c]);var P=O&&u?u:n[c];O&&typeof B==typeof P||(h=i.bind&&O?gs(P,He):i.wrap&&O?xT(P):E&&typeof P=="function"?gs(Function.call,P):P,(i.sham||P&&P.sham||B&&B.sham)&&eo(h,"sham",!0),S[c]=h,E&&(nt(Ft,s=A+"Prototype")||eo(Ft,s,{}),Ft[s][c]=P,i.real&&N&&!N[c]&&eo(N,c,P)))}},rv=function(i){return typeof i=="function"?i:void 0},to=function(i,n){return 2>arguments.length?rv(Ft[i])||rv(He[i]):Ft[i]&&Ft[i][n]||He[i]&&He[i][n]},Mu=to("JSON","stringify"),QT=/[\uD800-\uDFFF]/g,nv=/^[\uD800-\uDBFF]$/,iv=/^[\uDC00-\uDFFF]$/,UT=function(i,n,s){var c=s.charAt(n-1);return n=s.charAt(n+1),nv.test(i)&&!iv.test(n)||iv.test(i)&&!nv.test(c)?"\\u"+i.charCodeAt(0).toString(16):i},FT=ur(function(){return Mu("\uDF06\uD834")!=='"\\udf06\\ud834"'||Mu("\uDEAD")!=='"\\udead"'});Mu&&je({target:"JSON",stat:!0,forced:FT},{stringify:function(i,n,s){var c=Mu.apply(null,arguments);return typeof c=="string"?c.replace(QT,UT):c}}),Ft.JSON||(Ft.JSON={stringify:JSON.stringify});var Ha,Lu,fe=function(i,n,s){return Ft.JSON.stringify.apply(null,arguments)},Xs=Array.isArray||function(i){return yo(i)=="Array"},Li=function(i){return Object(zs(i))},VT=Math.ceil,GT=Math.floor,Zc=function(i){return isNaN(i=+i)?0:(0<i?GT:VT)(i)},jT=Math.min,Ai=function(i){return 0<i?jT(Zc(i),9007199254740991):0},$s=function(i,n,s){n=Fa(n),n in i?Mi.f(i,n,Ho(0,s)):i[n]=s},ov=He["__core-js_shared__"]||function(i,n){try{eo(He,i,n)}catch{He[i]=n}return n}("__core-js_shared__",{}),Ko=r(function(i){(i.exports=function(n,s){return ov[n]||(ov[n]=s!==void 0?s:{})})("versions",[]).push({version:"3.4.3",mode:"pure",copyright:"\xA9 2019 Denis Pushkarev (zloirock.ru)"})}),HT=0,KT=Math.random(),Pu=function(i){return"Symbol("+String(i===void 0?"":i)+")_"+(++HT+KT).toString(36)},_o=!!Object.getOwnPropertySymbols&&!ur(function(){return!String(Symbol())}),sv=_o&&!Symbol.sham&&typeof Symbol()=="symbol",xu=Ko("wks"),rp=He.Symbol,WT=sv?rp:Pu,dr=function(i){return nt(xu,i)||(_o&&nt(rp,i)?xu[i]=rp[i]:xu[i]=WT("Symbol."+i)),xu[i]},YT=dr("species"),np=function(i,n){var s;return Xs(i)&&(typeof(s=i.constructor)!="function"||s!==Array&&!Xs(s.prototype)?qt(s)&&(s=s[YT])===null&&(s=void 0):s=void 0),new(s===void 0?Array:s)(n===0?0:n)},el=to("navigator","userAgent")||"",av=He.process,cv=av&&av.versions,lv=cv&&cv.v8;lv?Lu=(Ha=lv.split("."))[0]+Ha[1]:el&&(!(Ha=el.match(/Edge\/(\d+)/))||74<=Ha[1])&&(Ha=el.match(/Chrome\/(\d+)/))&&(Lu=Ha[1]);var Qu=Lu&&+Lu,qT=dr("species"),tl=function(i){return 51<=Qu||!ur(function(){var n=[];return(n.constructor={})[qT]=function(){return{foo:1}},n[i](Boolean).foo!==1})},uv=dr("isConcatSpreadable"),JT=51<=Qu||!ur(function(){var i=[];return i[uv]=!1,i.concat()[0]!==i}),zT=tl("concat");je({target:"Array",proto:!0,forced:!JT||!zT},{concat:function(i){var n,s,c=Li(this),u=np(c,0),h=0,f=-1;for(n=arguments.length;f<n;f++){var A=s=f===-1?c:arguments[f];if(qt(A)){var m=A[uv];A=m!==void 0?!!m:Xs(A)}else A=!1;if(A){if(9007199254740991<h+(m=Ai(s.length)))throw TypeError("Maximum allowed index exceeded");for(A=0;A<m;A++,h++)A in s&&$s(u,h,s[A])}else{if(9007199254740991<=h)throw TypeError("Maximum allowed index exceeded");$s(u,h++,s)}}return u.length=h,u}});var hr=function(i){return Ft[i+"Prototype"]},XT=hr("Array").concat,dv=Array.prototype,b=function(i){var n=i.concat;return i===dv||i instanceof Array&&n===dv.concat?XT:n},Ka={},$T=!ur(function(){return Object.isExtensible(Object.preventExtensions({}))}),Uu=r(function(i){var n=Mi.f,s=Pu("meta"),c=0,u=Object.isExtensible||function(){return!0},h=function(A){n(A,s,{value:{objectID:"O"+ ++c,weakData:{}}})},f=i.exports={REQUIRED:!1,fastKey:function(A,m){if(!qt(A))return typeof A=="symbol"?A:(typeof A=="string"?"S":"P")+A;if(!nt(A,s)){if(!u(A))return"F";if(!m)return"E";h(A)}return A[s].objectID},getWeakData:function(A,m){if(!nt(A,s)){if(!u(A))return!0;if(!m)return!1;h(A)}return A[s].weakData},onFreeze:function(A){return $T&&f.REQUIRED&&u(A)&&!nt(A,s)&&h(A),A}};Ka[s]=!0}),Wo={},ZT=dr("iterator"),e2=Array.prototype,hv=function(i){return i!==void 0&&(Wo.Array===i||e2[ZT]===i)},pv={};pv[dr("toStringTag")]="z";var ip=String(pv)==="[object z]",t2=dr("toStringTag"),r2=yo(function(){return arguments}())=="Arguments",Wa=ip?yo:function(i){var n;if(i===void 0)var s="Undefined";else{if(i===null)var c="Null";else{e:{var u=i=Object(i);try{c=u[t2];break e}catch{}c=void 0}c=typeof(s=c)=="string"?s:r2?yo(i):(n=yo(i))=="Object"&&typeof i.callee=="function"?"Arguments":n}s=c}return s},n2=dr("iterator"),Fu=function(i){if(i!=null)return i[n2]||i["@@iterator"]||Wo[Wa(i)]},fv=function(i,n,s,c){try{return c?n(an(s)[0],s[1]):n(s)}catch(u){throw n=i.return,n!==void 0&&an(n.call(i)),u}},Ya=r(function(i){var n=function(s,c){this.stopped=s,this.result=c};(i.exports=function(s,c,u,h,f){var A,m;if(c=gs(c,u,h?2:1),!f){if(typeof(f=Fu(s))!="function")throw TypeError("Target is not iterable");if(hv(f)){for(f=0,u=Ai(s.length);u>f;f++)if((A=h?c(an(m=s[f])[0],m[1]):c(s[f]))&&A instanceof n)return A;return new n(!1)}s=f.call(s)}for(f=s.next;!(m=f.call(s)).done;)if(typeof(A=fv(s,c,m.value,h))=="object"&&A&&A instanceof n)return A;return new n(!1)}).stop=function(s){return new n(!0,s)}}),qa=function(i,n,s){if(!(i instanceof n))throw TypeError("Incorrect "+(s?s+" ":"")+"invocation");return i},i2=ip?{}.toString:function(){return"[object "+Wa(this)+"]"},o2=Mi.f,Av=dr("toStringTag"),Zs=function(i,n,s,c){i&&(i=s?i:i.prototype,nt(i,Av)||o2(i,Av,{configurable:!0,value:n}),c&&!ip&&eo(i,"toString",i2))},s2=[].push,ea=function(i){var n=i==1,s=i==2,c=i==3,u=i==4,h=i==6,f=i==5||h;return function(A,m,I,E){var _,S,N=Li(A),O=Du(N);m=gs(m,I,3),I=Ai(O.length);var B=0;for(E=E||np,A=n?E(A,I):s?E(A,0):void 0;I>B;B++)if((f||B in O)&&(S=m(_=O[B],B,N),i)){if(n)A[B]=S;else if(S)switch(i){case 3:return!0;case 5:return _;case 6:return B;case 2:s2.call(A,_)}else if(u)return!1}return h?-1:c||u?u:A}},Ja=ea(0),a2=ea(1),c2=ea(2),l2=ea(3),u2=ea(4),gv=ea(5),mv=ea(6),d2=Ko("native-function-to-string",Function.toString),vv=He.WeakMap,Ev=typeof vv=="function"&&/native code/.test(d2.call(vv)),Iv=Ko("keys"),Vu=function(i){return Iv[i]||(Iv[i]=Pu(i))},h2=He.WeakMap;if(Ev)var za=new h2,p2=za.get,f2=za.has,A2=za.set,op=function(i,n){return A2.call(za,i,n),n},Gu=function(i){return p2.call(za,i)||{}},sp=function(i){return f2.call(za,i)};else{var rl=Vu("state");Ka[rl]=!0,op=function(i,n){return eo(i,rl,n),n},Gu=function(i){return nt(i,rl)?i[rl]:{}},sp=function(i){return nt(i,rl)}}var Sr={set:op,get:Gu,has:sp,enforce:function(i){return sp(i)?Gu(i):op(i,{})},getterFor:function(i){return function(n){var s;if(!qt(n)||(s=Gu(n)).type!==i)throw TypeError("Incompatible receiver, "+i+" required");return s}}},g2=Mi.f,m2=Sr.set,v2=Sr.getterFor,Cv=function(i,n,s){var c=i.indexOf("Map")!==-1,u=i.indexOf("Weak")!==-1,h=c?"set":"add",f=He[i],A=f&&f.prototype,m={};if(jt&&typeof f=="function"&&(u||A.forEach&&!ur(function(){new f().entries().next()}))){var I=n(function(_,S){m2(qa(_,I,i),{type:i,collection:new f}),S!=null&&Ya(S,_[h],_,c)}),E=v2(i);Ja("add clear delete forEach get has set keys values entries".split(" "),function(_){var S=_=="add"||_=="set";!(_ in A)||u&&_=="clear"||eo(I.prototype,_,function(N,O){var B=E(this).collection;return!S&&u&&!qt(N)?_=="get"&&void 0:(N=B[_](N===0?0:N,O),S?this:N)})}),u||g2(I.prototype,"size",{configurable:!0,get:function(){return E(this).collection.size}})}else I=s.getConstructor(n,i,c,h),Uu.REQUIRED=!0;return Zs(I,i,!1,!0),m[i]=I,je({global:!0,forced:!0},m),u||s.setStrong(I,i,c),I},E2=Math.max,I2=Math.min,ta=function(i,n){return i=Zc(i),0>i?E2(i+n,0):I2(i,n)},yv=function(i){return function(n,s,c){var u;n=fi(n);var h=Ai(n.length);if(c=ta(c,h),i&&s!=s){for(;h>c;)if((u=n[c++])!=u)return!0}else for(;h>c;c++)if((i||c in n)&&n[c]===s)return i||c||0;return!i&&-1}},C2=yv(!0),_v=yv(!1),Sv=function(i,n){var s;i=fi(i);var c=0,u=[];for(s in i)!nt(Ka,s)&&nt(i,s)&&u.push(s);for(;n.length>c;)nt(i,s=n[c++])&&(~_v(u,s)||u.push(s));return u},ju="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),ms=Object.keys||function(i){return Sv(i,ju)},ap=jt?Object.defineProperties:function(i,n){an(i);for(var s,c=ms(n),u=c.length,h=0;u>h;)Mi.f(i,s=c[h++],n[s]);return i},cp=to("document","documentElement"),Tv=Vu("IE_PROTO"),lp=function(){},Hu=function(){var i=Bu?Va.createElement("iframe"):{},n=ju.length;for(i.style.display="none",cp.appendChild(i),i.src="javascript:",(i=i.contentWindow.document).open(),i.write("<script>document.F=Object<\/script>"),i.close(),Hu=i.F;n--;)delete Hu.prototype[ju[n]];return Hu()},vs=Object.create||function(i,n){var s;return i!==null?(lp.prototype=an(i),s=new lp,lp.prototype=null,s[Tv]=i):s=Hu(),n===void 0?s:ap(s,n)};Ka[Tv]=!0;var Ku,Rv,wv,Yo=function(i,n,s,c){c&&c.enumerable?i[n]=s:eo(i,n,s)},ra=function(i,n,s){for(var c in n)s&&s.unsafe&&i[c]?i[c]=n[c]:Yo(i,c,n[c],s);return i},y2=!ur(function(){function i(){}return i.prototype.constructor=null,Object.getPrototypeOf(new i)!==i.prototype}),Nv=Vu("IE_PROTO"),_2=Object.prototype,up=y2?Object.getPrototypeOf:function(i){return i=Li(i),nt(i,Nv)?i[Nv]:typeof i.constructor=="function"&&i instanceof i.constructor?i.constructor.prototype:i instanceof Object?_2:null},Ov=(dr("iterator"),!1);[].keys&&("next"in(wv=[].keys())?(Rv=up(up(wv)))!==Object.prototype&&(Ku=Rv):Ov=!0),Ku==null&&(Ku={});var kv=Ku,Wu=Ov,S2=function(){return this},bv=function(i,n,s){return n+=" Iterator",i.prototype=vs(kv,{next:Ho(1,s)}),Zs(i,n,!1,!0),Wo[n]=S2,i},T2=(Object.setPrototypeOf||"__proto__"in{}&&function(){var i={};try{Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set.call(i,[])}catch{}}(),kv),dp=dr("iterator"),R2=function(){return this},hp=function(i,n,s,c,u,h,f){bv(s,n,c);var A,m,I;c=function(P){if(P===u&&O)return O;if(!Wu&&P in S)return S[P];switch(P){case"keys":case"values":case"entries":return function(){return new s(this,P)}}return function(){return new s(this)}};var E=n+" Iterator",_=!1,S=i.prototype,N=S[dp]||S["@@iterator"]||u&&S[u],O=!Wu&&N||c(u),B=n=="Array"&&S.entries||N;if(B&&(A=up(B.call(new i)),T2!==Object.prototype&&A.next&&(Zs(A,E,!0,!0),Wo[E]=R2)),u=="values"&&N&&N.name!=="values"&&(_=!0,O=function(){return N.call(this)}),f&&S[dp]!==O&&eo(S,dp,O),Wo[n]=O,u)if(m={values:c("values"),keys:h?O:c("keys"),entries:c("entries")},f)for(I in m)!Wu&&!_&&I in S||Yo(S,I,m[I]);else je({target:n,proto:!0,forced:Wu||_},m);return m},Dv=dr("species"),Bv=function(i){i=to(i);var n=Mi.f;jt&&i&&!i[Dv]&&n(i,Dv,{configurable:!0,get:function(){return this}})},w2=Mi.f,Mv=Uu.fastKey,Lv=Sr.set,pp=Sr.getterFor,Pv=(Cv("Map",function(i){return function(){return i(this,arguments.length?arguments[0]:void 0)}},{getConstructor:function(i,n,s,c){var u=i(function(m,I){qa(m,u,n),Lv(m,{type:n,index:vs(null),first:void 0,last:void 0,size:0}),jt||(m.size=0),I!=null&&Ya(I,m[c],m,s)}),h=pp(n),f=function(m,I,E){var _,S,N=h(m),O=A(m,I);return O?O.value=E:(N.last=O={index:S=Mv(I,!0),key:I,value:E,previous:_=N.last,next:void 0,removed:!1},N.first||(N.first=O),_&&(_.next=O),jt?N.size++:m.size++,S!=="F"&&(N.index[S]=O)),m},A=function(m,I){m=h(m);var E=Mv(I);if(E!=="F")return m.index[E];for(m=m.first;m;m=m.next)if(m.key==I)return m};return ra(u.prototype,{clear:function(){for(var m=h(this),I=m.index,E=m.first;E;)E.removed=!0,E.previous&&(E.previous=E.previous.next=void 0),delete I[E.index],E=E.next;m.first=m.last=void 0,jt?m.size=0:this.size=0},delete:function(m){var I=h(this);if(m=A(this,m)){var E=m.next,_=m.previous;delete I.index[m.index],m.removed=!0,_&&(_.next=E),E&&(E.previous=_),I.first==m&&(I.first=E),I.last==m&&(I.last=_),jt?I.size--:this.size--}return!!m},forEach:function(m){for(var I,E=h(this),_=gs(m,1<arguments.length?arguments[1]:void 0,3);I=I?I.next:E.first;)for(_(I.value,I.key,this);I&&I.removed;)I=I.previous},has:function(m){return!!A(this,m)}}),ra(u.prototype,s?{get:function(m){return(m=A(this,m))&&m.value},set:function(m,I){return f(this,m===0?0:m,I)}}:{add:function(m){return f(this,m=m===0?0:m,m)}}),jt&&w2(u.prototype,"size",{get:function(){return h(this).size}}),u},setStrong:function(i,n,s){var c=n+" Iterator",u=pp(n),h=pp(c);hp(i,n,function(f,A){Lv(this,{type:c,target:f,state:u(f),kind:A,last:void 0})},function(){for(var f=h(this),A=f.kind,m=f.last;m&&m.removed;)m=m.previous;return f.target&&(f.last=m=m?m.next:f.state.first)?A=="keys"?{value:m.key,done:!1}:A=="values"?{value:m.value,done:!1}:{value:[m.key,m.value],done:!1}:(f.target=void 0,{value:void 0,done:!0})},s?"entries":"values",!s,!0),Bv(n)}}),function(i){return function(n,s){var c,u;n=String(zs(n)),s=Zc(s);var h=n.length;return 0>s||s>=h?i?"":void 0:55296>(c=n.charCodeAt(s))||56319<c||s+1===h||56320>(u=n.charCodeAt(s+1))||57343<u?i?n.charAt(s):c:i?n.slice(s,s+2):u-56320+(c-55296<<10)+65536}}),N2=Pv(!1),O2=Pv(!0),k2=Sr.set,b2=Sr.getterFor("String Iterator");hp(String,"String",function(i){k2(this,{type:"String Iterator",string:String(i),index:0})},function(){var i,n=b2(this),s=n.string,c=n.index;return c>=s.length?{value:void 0,done:!0}:(i=O2(s,c),n.index+=i.length,{value:i,done:!1})});var D2=Sr.set,B2=Sr.getterFor("Array Iterator");hp(Array,"Array",function(i,n){D2(this,{type:"Array Iterator",target:fi(i),index:0,kind:n})},function(){var i=B2(this),n=i.target,s=i.kind,c=i.index++;return!n||c>=n.length?(i.target=void 0,{value:void 0,done:!0}):s=="keys"?{value:c,done:!1}:s=="values"?{value:n[c],done:!1}:{value:[c,n[c]],done:!1}},"values"),Wo.Arguments=Wo.Array;var xv=dr("toStringTag"),Yu;for(Yu in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}){var Qv=He[Yu],fp=Qv&&Qv.prototype;fp&&!fp[xv]&&eo(fp,xv,Yu),Wo[Yu]=Wo.Array}var Tt=Ft.Map,M2=dr("match"),Ap=function(i){var n;if(qt(i)&&((n=i[M2])!==void 0?n:yo(i)=="RegExp"))throw TypeError("The method doesn't accept regular expressions");return i},L2=dr("match"),gp=function(i){var n=/./;try{"/./"[i](n)}catch{try{return n[L2]=!1,"/./"[i](n)}catch{}}return!1},Uv="".endsWith,P2=Math.min,x2=gp("endsWith");je({target:"String",proto:!0,forced:!x2},{endsWith:function(i){var n=String(zs(this));Ap(i);var s=1<arguments.length?arguments[1]:void 0,c=Ai(n.length);return s=s===void 0?c:P2(Ai(s),c),c=String(i),Uv?Uv.call(n,c,s):n.slice(s-c.length,s)===c}});var Q2=hr("String").endsWith,Fv=String.prototype,Vv=function(i){var n=i.endsWith;return typeof i=="string"||i===Fv||i instanceof String&&n===Fv.endsWith?Q2:n},na=function(i,n){var s=[][i];return!s||!ur(function(){s.call(null,n||function(){throw 1},1)})},Gv=na("forEach")?function(i){return Ja(this,i,1<arguments.length?arguments[1]:void 0)}:[].forEach;je({target:"Array",proto:!0,forced:[].forEach!=Gv},{forEach:Gv});var U2=hr("Array").forEach,jv=Array.prototype,F2={DOMTokenList:!0,NodeList:!0},K=function(i){var n=i.forEach;return i===jv||i instanceof Array&&n===jv.forEach||F2.hasOwnProperty(Wa(i))?U2:n},nl={f:Object.getOwnPropertySymbols},qu=Object.assign,il=!qu||ur(function(){var i={},n={},s=Symbol();return i[s]=7,"abcdefghijklmnopqrst".split("").forEach(function(c){n[c]=c}),qu({},i)[s]!=7||ms(qu({},n)).join("")!="abcdefghijklmnopqrst"})?function(i,n){for(var s=Li(i),c=arguments.length,u=1,h=nl.f,f=bu;c>u;)for(var A,m=Du(arguments[u++]),I=h?ms(m).concat(h(m)):ms(m),E=I.length,_=0;E>_;)A=I[_++],jt&&!f.call(m,A)||(s[A]=m[A]);return s}:qu;je({target:"Object",stat:!0,forced:Object.assign!==il},{assign:il});var cn=Ft.Object.assign,V2=ur(function(){ms(1)});je({target:"Object",stat:!0,forced:V2},{keys:function(i){return ms(Li(i))}});var pt=Ft.Object.keys,Hv=function(i){return function(n,s,c,u){Zi(s),n=Li(n);var h=Du(n),f=Ai(n.length),A=i?f-1:0,m=i?-1:1;if(2>c)for(;;){if(A in h){u=h[A],A+=m;break}if(A+=m,i?0>A:f<=A)throw TypeError("Reduce of empty array with no initial value")}for(;i?0<=A:f>A;A+=m)A in h&&(u=s(u,h[A],A,n));return u}},G2={left:Hv(!1),right:Hv(!0)}.left;je({target:"Array",proto:!0,forced:na("reduce")},{reduce:function(i){return G2(this,i,arguments.length,1<arguments.length?arguments[1]:void 0)}});var j2=hr("Array").reduce,Kv=Array.prototype,Ju=function(i){var n=i.reduce;return i===Kv||i instanceof Array&&n===Kv.reduce?j2:n};je({target:"Object",stat:!0,forced:!jt,sham:!jt},{defineProperty:Mi.f});var Wv=r(function(i){var n=Ft.Object;i=i.exports=function(s,c,u){return n.defineProperty(s,c,u)},n.defineProperty.sham&&(i.sham=!0)}),ft=Wv,H2=/^[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*/,K2=/[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*$/,W2=function(i){return function(n){return n=String(zs(n)),1&i&&(n=n.replace(H2,"")),2&i&&(n=n.replace(K2,"")),n}},Yv=W2(3),zu=He.parseInt,Y2=/^[+-]?0[Xx]/,qv=zu(`	
\v\f\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF08`)!==8||zu(`	
\v\f\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF0x16`)!==22?function(i,n){return i=Yv(String(i)),zu(i,n>>>0||(Y2.test(i)?16:10))}:zu;je({global:!0,forced:parseInt!=qv},{parseInt:qv});var pr=Ft.parseInt;let Jv=!0,zv=!0;var Xv=Ga,q2=ur(function(){Xv(1)});je({target:"Object",stat:!0,forced:!jt||q2,sham:!jt},{getOwnPropertyDescriptor:function(i,n){return Xv(fi(i),n)}});var ut=r(function(i){var n=Ft.Object;i=i.exports=function(s,c){return n.getOwnPropertyDescriptor(s,c)},n.getOwnPropertyDescriptor.sham&&(i.sham=!0)});je({target:"Array",proto:!0,forced:!tl("filter")},{filter:function(i){return c2(this,i,1<arguments.length?arguments[1]:void 0)}});var J2=hr("Array").filter,$v=Array.prototype,Qe=function(i){var n=i.filter;return i===$v||i instanceof Array&&n===$v.filter?J2:n},z2=He.Promise,Zv=dr("iterator"),eE=!1;try{var X2=0,tE={next:function(){return{done:!!X2++}},return:function(){eE=!0}};tE[Zv]=function(){return this},Array.from(tE,function(){throw 2})}catch{}var Xa,rE,mp,nE=function(i,n){if(!n&&!eE)return!1;var s=!1;try{n={},n[Zv]=function(){return{next:function(){return{done:s=!0}}}},i(n)}catch{}return s},$2=dr("species"),iE=function(i,n){var s;return i=an(i).constructor,i===void 0||(s=an(i)[$2])==null?n:Zi(s)},oE=/(iphone|ipod|ipad).*applewebkit/i.test(el),sE=He.location,vp=He.setImmediate,aE=He.clearImmediate,cE=He.process,lE=He.MessageChannel,Ep=He.Dispatch,Ip=0,ol={},Cp=function(i){if(ol.hasOwnProperty(i)){var n=ol[i];delete ol[i],n()}},yp=function(i){return function(){Cp(i)}},uE=function(i){Cp(i.data)},dE=function(i){He.postMessage(i+"",sE.protocol+"//"+sE.host)};vp&&aE||(vp=function(i){for(var n=[],s=1;arguments.length>s;)n.push(arguments[s++]);return ol[++Ip]=function(){(typeof i=="function"?i:Function(i)).apply(void 0,n)},Xa(Ip),Ip},aE=function(i){delete ol[i]},yo(cE)=="process"?Xa=function(i){cE.nextTick(yp(i))}:Ep&&Ep.now?Xa=function(i){Ep.now(yp(i))}:lE&&!oE?(mp=(rE=new lE).port2,rE.port1.onmessage=uE,Xa=gs(mp.postMessage,mp,1)):!He.addEventListener||typeof postMessage!="function"||He.importScripts||ur(dE)?Xa="onreadystatechange"in(Bu?Va.createElement("script"):{})?function(i){cp.appendChild(Bu?Va.createElement("script"):{}).onreadystatechange=function(){cp.removeChild(this),Cp(i)}}:function(i){setTimeout(yp(i),0)}:(Xa=dE,He.addEventListener("message",uE,!1)));var sl,ia,al,$a,_p,Sp,Tp,hE,Rp=vp,Z2=Ga,pE=He.MutationObserver||He.WebKitMutationObserver,wp=He.process,Np=He.Promise,fE=yo(wp)=="process",AE=Z2(He,"queueMicrotask"),gE=AE&&AE.value;gE||(sl=function(){var i;for(fE&&(i=wp.domain)&&i.exit();ia;){var n=ia.fn;ia=ia.next;try{n()}catch(s){throw ia?$a():al=void 0,s}}al=void 0,i&&i.enter()},fE?$a=function(){wp.nextTick(sl)}:pE&&!oE?(_p=!0,Sp=document.createTextNode(""),new pE(sl).observe(Sp,{characterData:!0}),$a=function(){Sp.data=_p=!_p}):Np&&Np.resolve?(Tp=Np.resolve(void 0),hE=Tp.then,$a=function(){hE.call(Tp,sl)}):$a=function(){Rp.call(He,sl)});var Op,mE,vE=gE||function(i){i={fn:i,next:void 0},al&&(al.next=i),ia||(ia=i,$a()),al=i},eR=function(i){var n,s;this.promise=new i(function(c,u){if(n!==void 0||s!==void 0)throw TypeError("Bad Promise constructor");n=c,s=u}),this.resolve=Zi(n),this.reject=Zi(s)},Xu={f:function(i){return new eR(i)}},kp=function(i,n){return an(i),qt(n)&&n.constructor===i?n:(i=Xu.f(i),(0,i.resolve)(n),i.promise)},$u=function(i){try{return{error:!1,value:i()}}catch(n){return{error:!0,value:n}}},tR=dr("species"),EE=Sr.get,rR=Sr.set,nR=Sr.getterFor("Promise"),Zn=z2,IE=He.TypeError,bp=He.document,Zu=He.process,iR=Ko("inspectSource"),Za=(to("fetch"),Xu.f),oR=Za,cl=yo(Zu)=="process",sR=!!(bp&&bp.createEvent&&He.dispatchEvent),ed=ja("Promise",function(){if(iR(Zn)===String(Zn)&&(Qu===66||!cl&&typeof PromiseRejectionEvent!="function")||!Zn.prototype.finally)return!0;if(51<=Qu&&/native code/.test(Zn))return!1;var i=Zn.resolve(1),n=function(s){s(function(){},function(){})};return(i.constructor={})[tR]=n,!(i.then(function(){})instanceof n)}),aR=ed||!nE(function(i){Zn.all(i).catch(function(){})}),CE=function(i){var n;return!(!qt(i)||typeof(n=i.then)!="function")&&n},Dp=function(i,n,s){if(!n.notified){n.notified=!0;var c=n.reactions;vE(function(){for(var u=n.value,h=n.state==1,f=0;c.length>f;){var A,m,I,E=c[f++],_=h?E.ok:E.fail,S=E.resolve,N=E.reject,O=E.domain;try{_?(h||(n.rejection===2&&lR(i,n),n.rejection=1),_===!0?A=u:(O&&O.enter(),A=_(u),O&&(O.exit(),I=!0)),A===E.promise?N(IE("Promise-chain cycle")):(m=CE(A))?m.call(A,S,N):S(A)):N(u)}catch(B){O&&!I&&O.exit(),N(B)}}n.reactions=[],n.notified=!1,s&&!n.rejection&&cR(i,n)})}},yE=function(i,n,s){var c,u;sR?((c=bp.createEvent("Event")).promise=n,c.reason=s,c.initEvent(i,!1,!0),He.dispatchEvent(c)):c={promise:n,reason:s},(u=He["on"+i])?u(c):i==="unhandledrejection"&&function(h,f){var A=He.console;A&&A.error&&(arguments.length===1?A.error(h):A.error(h,f))}("Unhandled promise rejection",s)},cR=function(i,n){Rp.call(He,function(){var s,c=n.value;if(n.rejection!==1&&!n.parent&&(s=$u(function(){cl?Zu.emit("unhandledRejection",c,i):yE("unhandledrejection",i,c)}),n.rejection=cl||n.rejection!==1&&!n.parent?2:1,s.error))throw s.value})},lR=function(i,n){Rp.call(He,function(){cl?Zu.emit("rejectionHandled",i):yE("rejectionhandled",i,n.value)})},ec=function(i,n,s,c){return function(u){i(n,s,u,c)}},tc=function(i,n,s,c){n.done||(n.done=!0,c&&(n=c),n.value=s,n.state=2,Dp(i,n,!0))},Bp=function(i,n,s,c){if(!n.done){n.done=!0,c&&(n=c);try{if(i===s)throw IE("Promise can't be resolved itself");var u=CE(s);u?vE(function(){var h={done:!1};try{u.call(s,ec(Bp,i,h,n),ec(tc,i,h,n))}catch(f){tc(i,h,f,n)}}):(n.value=s,n.state=1,Dp(i,n,!1))}catch(h){tc(i,{done:!1},h,n)}}};ed&&(Zn=function(i){qa(this,Zn,"Promise"),Zi(i),Op.call(this);var n=EE(this);try{i(ec(Bp,this,n),ec(tc,this,n))}catch(s){tc(this,n,s)}},(Op=function(i){rR(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=ra(Zn.prototype,{then:function(i,n){var s=nR(this),c=Za(iE(this,Zn));return c.ok=typeof i!="function"||i,c.fail=typeof n=="function"&&n,c.domain=cl?Zu.domain:void 0,s.parent=!0,s.reactions.push(c),s.state!=0&&Dp(this,s,!1),c.promise},catch:function(i){return this.then(void 0,i)}}),mE=function(){var i=new Op,n=EE(i);this.promise=i,this.resolve=ec(Bp,i,n),this.reject=ec(tc,i,n)},Xu.f=Za=function(i){return i===Zn||i===_E?new mE(i):oR(i)}),je({global:!0,wrap:!0,forced:ed},{Promise:Zn}),Zs(Zn,"Promise",!1,!0),Bv("Promise");var _E=to("Promise");je({target:"Promise",stat:!0,forced:ed},{reject:function(i){var n=Za(this);return n.reject.call(void 0,i),n.promise}}),je({target:"Promise",stat:!0,forced:!0},{resolve:function(i){return kp(this===_E?Zn:this,i)}}),je({target:"Promise",stat:!0,forced:aR},{all:function(i){var n=this,s=Za(n),c=s.resolve,u=s.reject,h=$u(function(){var f=Zi(n.resolve),A=[],m=0,I=1;Ya(i,function(E){var _=m++,S=!1;A.push(void 0),I++,f.call(n,E).then(function(N){S||(S=!0,A[_]=N,--I||c(A))},u)}),--I||c(A)});return h.error&&u(h.value),s.promise},race:function(i){var n=this,s=Za(n),c=s.reject,u=$u(function(){var h=Zi(n.resolve);Ya(i,function(f){h.call(n,f).then(s.resolve,c)})});return u.error&&c(u.value),s.promise}}),je({target:"Promise",stat:!0},{allSettled:function(i){var n=this,s=Xu.f(n),c=s.resolve,u=s.reject,h=$u(function(){var f=Zi(n.resolve),A=[],m=0,I=1;Ya(i,function(E){var _=m++,S=!1;A.push(void 0),I++,f.call(n,E).then(function(N){S||(S=!0,A[_]={status:"fulfilled",value:N},--I||c(A))},function(N){S||(S=!0,A[_]={status:"rejected",reason:N},--I||c(A))})}),--I||c(A)});return h.error&&u(h.value),s.promise}}),je({target:"Promise",proto:!0,real:!0},{finally:function(i){var n=iE(this,to("Promise")),s=typeof i=="function";return this.then(s?function(c){return kp(n,i()).then(function(){return c})}:i,s?function(c){return kp(n,i()).then(function(){throw c})}:i)}});var se=Ft.Promise;je({target:"Array",proto:!0,forced:!tl("map")},{map:function(i){return a2(this,i,1<arguments.length?arguments[1]:void 0)}});var uR=hr("Array").map,SE=Array.prototype,Ie=function(i){var n=i.map;return i===SE||i instanceof Array&&n===SE.map?uR:n},dR=Math.max,hR=Math.min;je({target:"Array",proto:!0,forced:!tl("splice")},{splice:function(i,n){var s,c,u,h,f=Li(this),A=Ai(f.length),m=ta(i,A),I=arguments.length;if(I===0?s=c=0:I===1?(s=0,c=A-m):(s=I-2,c=hR(dR(Zc(n),0),A-m)),9007199254740991<A+s-c)throw TypeError("Maximum allowed length exceeded");for(I=np(f,c),u=0;u<c;u++)(h=m+u)in f&&$s(I,u,f[h]);if(I.length=c,s<c){for(u=m;u<A-c;u++){var E=u+s;(h=u+c)in f?f[E]=f[h]:delete f[E]}for(u=A;u>A-c+s;u--)delete f[u-1]}else if(s>c)for(u=A-c;u>m;u--)E=u+s-1,(h=u+c-1)in f?f[E]=f[h]:delete f[E];for(u=0;u<s;u++)f[u+m]=arguments[u+2];return f.length=A-c+s,I}});var pR=hr("Array").splice,TE=Array.prototype,Jr=function(i){var n=i.splice;return i===TE||i instanceof Array&&n===TE.splice?pR:n},RE=[].indexOf,wE=!!RE&&0>1/[1].indexOf(1,-0),fR=na("indexOf");je({target:"Array",proto:!0,forced:wE||fR},{indexOf:function(i){return wE?RE.apply(this,arguments)||0:_v(this,i,1<arguments.length?arguments[1]:void 0)}});var AR=hr("Array").indexOf,NE=Array.prototype,Ke=function(i){var n=i.indexOf;return i===NE||i instanceof Array&&n===NE.indexOf?AR:n},gR=dr("species"),mR=[].slice,vR=Math.max;je({target:"Array",proto:!0,forced:!tl("slice")},{slice:function(i,n){var s,c=fi(this),u=Ai(c.length);if(i=ta(i,u),n=ta(n===void 0?u:n,u),Xs(c)&&(typeof(s=c.constructor)!="function"||s!==Array&&!Xs(s.prototype)?qt(s)&&(s=s[gR])===null&&(s=void 0):s=void 0,s===Array||s===void 0))return mR.call(c,i,n);for(s=new(s===void 0?Array:s)(vR(n-i,0)),u=0;i<n;i++,u++)i in c&&$s(s,u,c[i]);return s.length=u,s}});var ER=hr("Array").slice,OE=Array.prototype,Gr=function(i){var n=i.slice;return i===OE||i instanceof Array&&n===OE.slice?ER:n},kE=!0;"find"in[]&&Array(1).find(function(){kE=!1}),je({target:"Array",proto:!0,forced:kE},{find:function(i){return gv(this,i,1<arguments.length?arguments[1]:void 0)}});var IR=hr("Array").find,bE=Array.prototype,Xe=function(i){var n=i.find;return i===bE||i instanceof Array&&n===bE.find?IR:n},DE=[].slice,Mp={};je({target:"Function",proto:!0},{bind:Function.bind||function(i){var n=Zi(this),s=DE.call(arguments,1),c=function(){var u=s.concat(DE.call(arguments));if(this instanceof c){var h=u.length;if(!(h in Mp)){for(var f=[],A=0;A<h;A++)f[A]="a["+A+"]";Mp[h]=Function("C,a","return new C("+f.join(",")+")")}u=Mp[h](n,u)}else u=n.apply(i,u);return u};return qt(n.prototype)&&(c.prototype=n.prototype),c}});var CR=hr("Function").bind,BE=Function.prototype,fr=function(i){var n=i.bind;return i===BE||i instanceof Function&&n===BE.bind?CR:n};je({target:"Array",proto:!0},{includes:function(i){return C2(this,i,1<arguments.length?arguments[1]:void 0)}});var yR=hr("Array").includes;je({target:"String",proto:!0,forced:!gp("includes")},{includes:function(i){return!!~String(zs(this)).indexOf(Ap(i),1<arguments.length?arguments[1]:void 0)}});var _R=hr("String").includes,ME=Array.prototype,LE=String.prototype,vt=function(i){var n=i.includes;return i===ME||i instanceof Array&&n===ME.includes?yR:typeof i=="string"||i===LE||i instanceof String&&n===LE.includes?_R:n};je({target:"Array",proto:!0,forced:na("some")},{some:function(i){return l2(this,i,1<arguments.length?arguments[1]:void 0)}});var SR=hr("Array").some,PE=Array.prototype,xE=function(i){var n=i.some;return i===PE||i instanceof Array&&n===PE.some?SR:n};let QE=p;var UE=Object.freeze({__proto__:null,shimMediaStream:k,shimOnTrack:M,shimGetSendersWithDtmf:x,shimGetStats:V,shimSenderReceiverGetStats:Y,shimAddTrackRemoveTrackWithNative:H,shimAddTrackRemoveTrack:he,shimPeerConnection:Q,fixNegotiationNeeded:pe,shimGetUserMedia:w,shimGetDisplayMedia:function(i,n){i.navigator.mediaDevices&&"getDisplayMedia"in i.navigator.mediaDevices||i.navigator.mediaDevices&&(typeof n=="function"?i.navigator.mediaDevices.getDisplayMedia=function(s){return n(s).then(c=>{let u=s.video&&s.video.width,h=s.video&&s.video.height;return s.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:c,maxFrameRate:s.video&&s.video.frameRate||3}},u&&(s.video.mandatory.maxWidth=u),h&&(s.video.mandatory.maxHeight=h),i.navigator.mediaDevices.getUserMedia(s)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}}),FE="".startsWith,TR=Math.min,RR=gp("startsWith");je({target:"String",proto:!0,forced:!RR},{startsWith:function(i){var n=String(zs(this));Ap(i);var s=Ai(TR(1<arguments.length?arguments[1]:void 0,n.length)),c=String(i);return FE?FE.call(n,c,s):n.slice(s,s+c.length)===c}});var wR=hr("String").startsWith,VE=String.prototype,ll=function(i){var n=i.startsWith;return typeof i=="string"||i===VE||i instanceof String&&n===VE.startsWith?wR:n};je({target:"String",proto:!0,forced:ur(function(){return`	
\v\f\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF`.trim.name!=="trim"})},{trim:function(){return Yv(this)}});var NR=hr("String").trim,GE=String.prototype,oa=function(i){var n=i.trim;return typeof i=="string"||i===GE||i instanceof String&&n===GE.trim?NR:n},Fe=r(function(i){var n={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};n.localCName=n.generateIdentifier(),n.splitLines=function(s){var c;return Ie(c=oa(s).call(s).split(`
`)).call(c,function(u){return oa(u).call(u)})},n.splitSections=function(s){return s=s.split(`
m=`),Ie(s).call(s,function(c,u){var h;return oa(h=0<u?"m="+c:c).call(h)+`\r
`})},n.getDescription=function(s){return(s=n.splitSections(s))&&s[0]},n.getMediaSections=function(s){return s=n.splitSections(s),s.shift(),s},n.matchPrefix=function(s,c){var u;return Qe(u=n.splitLines(s)).call(u,function(h){return Ke(h).call(h,c)===0})},n.parseCandidate=function(s){var c;s={foundation:(c=Ke(s).call(s,"a=candidate:")===0?s.substring(12).split(" "):s.substring(10).split(" "))[0],component:pr(c[1],10),protocol:c[2].toLowerCase(),priority:pr(c[3],10),ip:c[4],address:c[4],port:pr(c[5],10),type:c[7]};for(var u=8;u<c.length;u+=2)switch(c[u]){case"raddr":s.relatedAddress=c[u+1];break;case"rport":s.relatedPort=pr(c[u+1],10);break;case"tcptype":s.tcpType=c[u+1];break;case"ufrag":s.ufrag=c[u+1],s.usernameFragment=c[u+1];break;default:s[c[u]]=c[u+1]}return s},n.writeCandidate=function(s){var c=[];c.push(s.foundation),c.push(s.component),c.push(s.protocol.toUpperCase()),c.push(s.priority),c.push(s.address||s.ip),c.push(s.port);var u=s.type;return c.push("typ"),c.push(u),u!=="host"&&s.relatedAddress&&s.relatedPort&&(c.push("raddr"),c.push(s.relatedAddress),c.push("rport"),c.push(s.relatedPort)),s.tcpType&&s.protocol.toLowerCase()==="tcp"&&(c.push("tcptype"),c.push(s.tcpType)),(s.usernameFragment||s.ufrag)&&(c.push("ufrag"),c.push(s.usernameFragment||s.ufrag)),"candidate:"+c.join(" ")},n.parseIceOptions=function(s){return s.substr(14).split(" ")},n.parseRtpMap=function(s){s=s.substr(9).split(" ");var c={payloadType:pr(s.shift(),10)};return s=s[0].split("/"),c.name=s[0],c.clockRate=pr(s[1],10),c.channels=s.length===3?pr(s[2],10):1,c.numChannels=c.channels,c},n.writeRtpMap=function(s){var c=s.payloadType;s.preferredPayloadType!==void 0&&(c=s.preferredPayloadType);var u=s.channels||s.numChannels||1;return"a=rtpmap:"+c+" "+s.name+"/"+s.clockRate+(u!==1?"/"+u:"")+`\r
`},n.parseExtmap=function(s){var c;return s=s.substr(9).split(" "),{id:pr(s[0],10),direction:0<Ke(c=s[0]).call(c,"/")?s[0].split("/")[1]:"sendrecv",uri:s[1]}},n.writeExtmap=function(s){return"a=extmap:"+(s.id||s.preferredId)+(s.direction&&s.direction!=="sendrecv"?"/"+s.direction:"")+" "+s.uri+`\r
`},n.parseFmtp=function(s){for(var c={},u=s.substr(Ke(s).call(s," ")+1).split(";"),h=0;h<u.length;h++){var f,A;s=oa(f=u[h]).call(f).split("="),c[oa(A=s[0]).call(A)]=s[1]}return c},n.writeFmtp=function(s){var c="",u=s.payloadType;if(s.preferredPayloadType!==void 0&&(u=s.preferredPayloadType),s.parameters&&pt(s.parameters).length){var h,f=[];K(h=pt(s.parameters)).call(h,function(A){s.parameters[A]?f.push(A+"="+s.parameters[A]):f.push(A)}),c+="a=fmtp:"+u+" "+f.join(";")+`\r
`}return c},n.parseRtcpFb=function(s){return s=s.substr(Ke(s).call(s," ")+1).split(" "),{type:s.shift(),parameter:s.join(" ")}},n.writeRtcpFb=function(s){var c,u="",h=s.payloadType;return s.preferredPayloadType!==void 0&&(h=s.preferredPayloadType),s.rtcpFeedback&&s.rtcpFeedback.length&&K(c=s.rtcpFeedback).call(c,function(f){u+="a=rtcp-fb:"+h+" "+f.type+(f.parameter&&f.parameter.length?" "+f.parameter:"")+`\r
`}),u},n.parseSsrcMedia=function(s){var c=Ke(s).call(s," "),u={ssrc:pr(s.substr(7,c-7),10)},h=Ke(s).call(s,":",c);return-1<h?(u.attribute=s.substr(c+1,h-c-1),u.value=s.substr(h+1)):u.attribute=s.substr(c+1),u},n.parseSsrcGroup=function(s){return s=s.substr(13).split(" "),{semantics:s.shift(),ssrcs:Ie(s).call(s,function(c){return pr(c,10)})}},n.getMid=function(s){if(s=n.matchPrefix(s,"a=mid:")[0])return s.substr(6)},n.parseFingerprint=function(s){return s=s.substr(14).split(" "),{algorithm:s[0].toLowerCase(),value:s[1]}},n.getDtlsParameters=function(s,c){return s=n.matchPrefix(s+c,"a=fingerprint:"),{role:"auto",fingerprints:Ie(s).call(s,n.parseFingerprint)}},n.writeDtlsParameters=function(s,c){var u,h="a=setup:"+c+`\r
`;return K(u=s.fingerprints).call(u,function(f){h+="a=fingerprint:"+f.algorithm+" "+f.value+`\r
`}),h},n.getIceParameters=function(s,c){return s=n.splitLines(s),s=b(s).call(s,n.splitLines(c)),{usernameFragment:Qe(s).call(s,function(u){return Ke(u).call(u,"a=ice-ufrag:")===0})[0].substr(12),password:Qe(s).call(s,function(u){return Ke(u).call(u,"a=ice-pwd:")===0})[0].substr(10)}},n.writeIceParameters=function(s){return"a=ice-ufrag:"+s.usernameFragment+`\r
a=ice-pwd:`+s.password+`\r
`},n.parseRtpParameters=function(s){for(var c,u={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},h=n.splitLines(s)[0].split(" "),f=3;f<h.length;f++){var A=h[f],m=n.matchPrefix(s,"a=rtpmap:"+A+" ")[0];if(m){var I;m=n.parseRtpMap(m);var E=n.matchPrefix(s,"a=fmtp:"+A+" ");switch(m.parameters=E.length?n.parseFmtp(E[0]):{},m.rtcpFeedback=Ie(I=n.matchPrefix(s,"a=rtcp-fb:"+A+" ")).call(I,n.parseRtcpFb),u.codecs.push(m),m.name.toUpperCase()){case"RED":case"ULPFEC":u.fecMechanisms.push(m.name.toUpperCase())}}}return K(c=n.matchPrefix(s,"a=extmap:")).call(c,function(_){u.headerExtensions.push(n.parseExtmap(_))}),u},n.writeRtpDescription=function(s,c){var u,h,f,A="";A+="m="+s+" ",A+=0<c.codecs.length?"9":"0",A+=" UDP/TLS/RTP/SAVPF ",A+=Ie(u=c.codecs).call(u,function(E){return E.preferredPayloadType!==void 0?E.preferredPayloadType:E.payloadType}).join(" ")+`\r
`,A+=`c=IN IP4 0.0.0.0\r
`,A+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,K(h=c.codecs).call(h,function(E){A+=n.writeRtpMap(E),A+=n.writeFmtp(E),A+=n.writeRtcpFb(E)});var m,I=0;return K(f=c.codecs).call(f,function(E){E.maxptime>I&&(I=E.maxptime)}),0<I&&(A+="a=maxptime:"+I+`\r
`),A+=`a=rtcp-mux\r
`,c.headerExtensions&&K(m=c.headerExtensions).call(m,function(E){A+=n.writeExtmap(E)}),A},n.parseRtpEncodingParameters=function(s){var c,u,h,f,A,m,I,E=[],_=n.parseRtpParameters(s),S=Ke(c=_.fecMechanisms).call(c,"RED")!==-1,N=Ke(u=_.fecMechanisms).call(u,"ULPFEC")!==-1;c=Qe(h=Ie(f=n.matchPrefix(s,"a=ssrc:")).call(f,function(ne){return n.parseSsrcMedia(ne)})).call(h,function(ne){return ne.attribute==="cname"});var O=0<c.length&&c[0].ssrc;h=Ie(A=n.matchPrefix(s,"a=ssrc-group:FID")).call(A,function(ne){return ne=ne.substr(17).split(" "),Ie(ne).call(ne,function(Ae){return pr(Ae,10)})}),0<h.length&&1<h[0].length&&h[0][0]===O&&(I=h[0][1]),K(m=_.codecs).call(m,function(ne){ne.name.toUpperCase()==="RTX"&&ne.parameters.apt&&(ne={ssrc:O,codecPayloadType:pr(ne.parameters.apt,10)},O&&I&&(ne.rtx={ssrc:I}),E.push(ne),S&&((ne=JSON.parse(fe(ne))).fec={ssrc:O,mechanism:N?"red+ulpfec":"red"},E.push(ne)))}),E.length===0&&O&&E.push({ssrc:O});var B,P,J=n.matchPrefix(s,"b=");return J.length&&(J=Ke(B=J[0]).call(B,"b=TIAS:")===0?pr(J[0].substr(7),10):Ke(P=J[0]).call(P,"b=AS:")===0?950*pr(J[0].substr(5),10)-16e3:void 0,K(E).call(E,function(ne){ne.maxBitrate=J})),E},n.parseRtcpParameters=function(s){var c,u,h={},f=Qe(c=Ie(u=n.matchPrefix(s,"a=ssrc:")).call(u,function(A){return n.parseSsrcMedia(A)})).call(c,function(A){return A.attribute==="cname"})[0];return f&&(h.cname=f.value,h.ssrc=f.ssrc),c=n.matchPrefix(s,"a=rtcp-rsize"),h.reducedSize=0<c.length,h.compound=c.length===0,s=n.matchPrefix(s,"a=rtcp-mux"),h.mux=0<s.length,h},n.parseMsid=function(s){var c,u,h,f=n.matchPrefix(s,"a=msid:");return f.length===1?{stream:(h=f[0].substr(7).split(" "))[0],track:h[1]}:(s=Qe(c=Ie(u=n.matchPrefix(s,"a=ssrc:")).call(u,function(A){return n.parseSsrcMedia(A)})).call(c,function(A){return A.attribute==="msid"}),0<s.length?{stream:(h=s[0].value.split(" "))[0],track:h[1]}:void 0)},n.generateSessionId=function(){return Math.random().toString().substr(2,21)},n.writeSessionBoilerplate=function(s,c,u){return c=c!==void 0?c:2,`v=0\r
o=`+(u||"thisisadapterortc")+" "+(s||n.generateSessionId())+" "+c+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},n.writeMediaSection=function(s,c,u,h){return c=n.writeRtpDescription(s.kind,c),c+=n.writeIceParameters(s.iceGatherer.getLocalParameters()),c+=n.writeDtlsParameters(s.dtlsTransport.getLocalParameters(),u==="offer"?"actpass":"active"),c+="a=mid:"+s.mid+`\r
`,s.direction?c+="a="+s.direction+`\r
`:s.rtpSender&&s.rtpReceiver?c+=`a=sendrecv\r
`:s.rtpSender?c+=`a=sendonly\r
`:s.rtpReceiver?c+=`a=recvonly\r
`:c+=`a=inactive\r
`,s.rtpSender&&(u="msid:"+h.id+" "+s.rtpSender.track.id+`\r
`,c=c+("a="+u)+("a=ssrc:"+s.sendEncodingParameters[0].ssrc+" "+u),s.sendEncodingParameters[0].rtx&&(c+="a=ssrc:"+s.sendEncodingParameters[0].rtx.ssrc+" "+u,c+="a=ssrc-group:FID "+s.sendEncodingParameters[0].ssrc+" "+s.sendEncodingParameters[0].rtx.ssrc+`\r
`)),c+="a=ssrc:"+s.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+`\r
`,s.rtpSender&&s.sendEncodingParameters[0].rtx&&(c+="a=ssrc:"+s.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+`\r
`),c},n.getDirection=function(s,c){s=n.splitLines(s);for(var u=0;u<s.length;u++)switch(s[u]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return s[u].substr(2)}return c?n.getDirection(c):"sendrecv"},n.getKind=function(s){return n.splitLines(s)[0].split(" ")[0].substr(2)},n.isRejected=function(s){return s.split(" ",2)[1]==="0"},n.parseMLine=function(s){return s=n.splitLines(s)[0].substr(2).split(" "),{kind:s[0],port:pr(s[1],10),protocol:s[2],fmt:Gr(s).call(s,3).join(" ")}},n.parseOLine=function(s){return s=n.matchPrefix(s,"o=")[0].substr(2).split(" "),{username:s[0],sessionId:s[1],sessionVersion:pr(s[2],10),netType:s[3],addressType:s[4],address:s[5]}},n.isValidSDP=function(s){if(typeof s!="string"||s.length===0)return!1;s=n.splitLines(s);for(var c=0;c<s.length;c++)if(2>s[c].length||s[c].charAt(1)!=="=")return!1;return!0},i.exports=n}),OR=function(i,n){function s(f,A){A.addTrack(f),A.dispatchEvent(new i.MediaStreamTrackEvent("addtrack",{track:f}))}function c(f,A,m,I){var E=new Event("track");E.track=A,E.receiver=m,E.transceiver={receiver:m},E.streams=I,i.setTimeout(function(){f._dispatchEvent("track",E)})}var u=function(f){var A=this,m=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(E){A[E]=m[E].bind(m)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",f=JSON.parse(JSON.stringify(f||{})),this.usingBundle=f.bundlePolicy==="max-bundle",f.rtcpMuxPolicy==="negotiate")throw De("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(f.rtcpMuxPolicy||(f.rtcpMuxPolicy="require"),f.iceTransportPolicy){case"all":case"relay":break;default:f.iceTransportPolicy="all"}switch(f.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:f.bundlePolicy="balanced"}if(f.iceServers=function(E,_){var S=!1;return(E=JSON.parse(JSON.stringify(E))).filter(function(N){if(N&&(N.urls||N.url)){var O=N.urls||N.url;N.url&&!N.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var B=typeof O=="string";return B&&(O=[O]),O=O.filter(function(P){return P.indexOf("turn:")!==0||P.indexOf("transport=udp")===-1||P.indexOf("turn:[")!==-1||S?P.indexOf("stun:")===0&&14393<=_&&P.indexOf("?transport=udp")===-1:(S=!0,!0)}),delete N.url,N.urls=B?O[0]:O,!!O.length}})}(f.iceServers||[],n),this._iceGatherers=[],f.iceCandidatePoolSize)for(var I=f.iceCandidatePoolSize;0<I;I--)this._iceGatherers.push(new i.RTCIceGatherer({iceServers:f.iceServers,gatherPolicy:f.iceTransportPolicy}));else f.iceCandidatePoolSize=0;this._config=f,this.transceivers=[],this._sdpSessionId=Fe.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(u.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(u.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),u.prototype.onicecandidate=null,u.prototype.onaddstream=null,u.prototype.ontrack=null,u.prototype.onremovestream=null,u.prototype.onsignalingstatechange=null,u.prototype.oniceconnectionstatechange=null,u.prototype.onconnectionstatechange=null,u.prototype.onicegatheringstatechange=null,u.prototype.onnegotiationneeded=null,u.prototype.ondatachannel=null,u.prototype._dispatchEvent=function(f,A){this._isClosed||(this.dispatchEvent(A),typeof this["on"+f]=="function"&&this["on"+f](A))},u.prototype._emitGatheringStateChange=function(){var f=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",f)},u.prototype.getConfiguration=function(){return this._config},u.prototype.getLocalStreams=function(){return this.localStreams},u.prototype.getRemoteStreams=function(){return this.remoteStreams},u.prototype._createTransceiver=function(f,A){var m=0<this.transceivers.length;return f={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:f,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0},this.usingBundle&&m?(f.iceTransport=this.transceivers[0].iceTransport,f.dtlsTransport=this.transceivers[0].dtlsTransport):(m=this._createIceAndDtlsTransports(),f.iceTransport=m.iceTransport,f.dtlsTransport=m.dtlsTransport),A||this.transceivers.push(f),f},u.prototype.addTrack=function(f,A){if(this._isClosed)throw De("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var m;if(this.transceivers.find(function(E){return E.track===f}))throw De("InvalidAccessError","Track already exists.");for(var I=0;I<this.transceivers.length;I++)this.transceivers[I].track||this.transceivers[I].kind!==f.kind||(m=this.transceivers[I]);return m||(m=this._createTransceiver(f.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(A)===-1&&this.localStreams.push(A),m.track=f,m.stream=A,m.rtpSender=new i.RTCRtpSender(f,m.dtlsTransport),m.rtpSender},u.prototype.addStream=function(f){var A=this;if(15025<=n)f.getTracks().forEach(function(I){A.addTrack(I,f)});else{var m=f.clone();f.getTracks().forEach(function(I,E){var _=m.getTracks()[E];I.addEventListener("enabled",function(S){_.enabled=S.enabled})}),m.getTracks().forEach(function(I){A.addTrack(I,m)})}},u.prototype.removeTrack=function(f){if(this._isClosed)throw De("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(f instanceof i.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var A=this.transceivers.find(function(I){return I.rtpSender===f});if(!A)throw De("InvalidAccessError","Sender was not created by this connection.");var m=A.stream;A.rtpSender.stop(),A.rtpSender=null,A.track=null,A.stream=null,this.transceivers.map(function(I){return I.stream}).indexOf(m)===-1&&-1<this.localStreams.indexOf(m)&&this.localStreams.splice(this.localStreams.indexOf(m),1),this._maybeFireNegotiationNeeded()},u.prototype.removeStream=function(f){var A=this;f.getTracks().forEach(function(m){var I=A.getSenders().find(function(E){return E.track===m});I&&A.removeTrack(I)})},u.prototype.getSenders=function(){return this.transceivers.filter(function(f){return!!f.rtpSender}).map(function(f){return f.rtpSender})},u.prototype.getReceivers=function(){return this.transceivers.filter(function(f){return!!f.rtpReceiver}).map(function(f){return f.rtpReceiver})},u.prototype._createIceGatherer=function(f,A){var m=this;if(A&&0<f)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var I=new i.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(I,"state",{value:"new",writable:!0}),this.transceivers[f].bufferedCandidateEvents=[],this.transceivers[f].bufferCandidates=function(E){var _=!E.candidate||Object.keys(E.candidate).length===0;I.state=_?"completed":"gathering",m.transceivers[f].bufferedCandidateEvents!==null&&m.transceivers[f].bufferedCandidateEvents.push(E)},I.addEventListener("localcandidate",this.transceivers[f].bufferCandidates),I},u.prototype._gather=function(f,A){var m=this,I=this.transceivers[A].iceGatherer;if(!I.onlocalcandidate){var E=this.transceivers[A].bufferedCandidateEvents;this.transceivers[A].bufferedCandidateEvents=null,I.removeEventListener("localcandidate",this.transceivers[A].bufferCandidates),I.onlocalcandidate=function(_){if(!(m.usingBundle&&0<A)){var S=new Event("icecandidate");S.candidate={sdpMid:f,sdpMLineIndex:A};var N=_.candidate;(_=!N||Object.keys(N).length===0)?I.state!=="new"&&I.state!=="gathering"||(I.state="completed"):(I.state==="new"&&(I.state="gathering"),N.component=1,N.ufrag=I.getLocalParameters().usernameFragment,N=Fe.writeCandidate(N),S.candidate=Object.assign(S.candidate,Fe.parseCandidate(N)),S.candidate.candidate=N,S.candidate.toJSON=function(){return{candidate:S.candidate.candidate,sdpMid:S.candidate.sdpMid,sdpMLineIndex:S.candidate.sdpMLineIndex,usernameFragment:S.candidate.usernameFragment}}),N=Fe.getMediaSections(m._localDescription.sdp),N[S.candidate.sdpMLineIndex]+=_?`a=end-of-candidates\r
`:"a="+S.candidate.candidate+`\r
`,m._localDescription.sdp=Fe.getDescription(m._localDescription.sdp)+N.join(""),N=m.transceivers.every(function(O){return O.iceGatherer&&O.iceGatherer.state==="completed"}),m.iceGatheringState!=="gathering"&&(m.iceGatheringState="gathering",m._emitGatheringStateChange()),_||m._dispatchEvent("icecandidate",S),N&&(m._dispatchEvent("icecandidate",new Event("icecandidate")),m.iceGatheringState="complete",m._emitGatheringStateChange())}},i.setTimeout(function(){E.forEach(function(_){I.onlocalcandidate(_)})},0)}},u.prototype._createIceAndDtlsTransports=function(){var f=this,A=new i.RTCIceTransport(null);A.onicestatechange=function(){f._updateIceConnectionState(),f._updateConnectionState()};var m=new i.RTCDtlsTransport(A);return m.ondtlsstatechange=function(){f._updateConnectionState()},m.onerror=function(){Object.defineProperty(m,"state",{value:"failed",writable:!0}),f._updateConnectionState()},{iceTransport:A,dtlsTransport:m}},u.prototype._disposeIceAndDtlsTransports=function(f){var A=this.transceivers[f].iceGatherer;A&&(delete A.onlocalcandidate,delete this.transceivers[f].iceGatherer),(A=this.transceivers[f].iceTransport)&&(delete A.onicestatechange,delete this.transceivers[f].iceTransport),(A=this.transceivers[f].dtlsTransport)&&(delete A.ondtlsstatechange,delete A.onerror,delete this.transceivers[f].dtlsTransport)},u.prototype._transceive=function(f,A,m){var I=me(f.localCapabilities,f.remoteCapabilities);A&&f.rtpSender&&(I.encodings=f.sendEncodingParameters,I.rtcp={cname:Fe.localCName,compound:f.rtcpParameters.compound},f.recvEncodingParameters.length&&(I.rtcp.ssrc=f.recvEncodingParameters[0].ssrc),f.rtpSender.send(I)),m&&f.rtpReceiver&&0<I.codecs.length&&(f.kind==="video"&&f.recvEncodingParameters&&15019>n&&f.recvEncodingParameters.forEach(function(E){delete E.rtx}),f.recvEncodingParameters.length?I.encodings=f.recvEncodingParameters:I.encodings=[{}],I.rtcp={compound:f.rtcpParameters.compound},f.rtcpParameters.cname&&(I.rtcp.cname=f.rtcpParameters.cname),f.sendEncodingParameters.length&&(I.rtcp.ssrc=f.sendEncodingParameters[0].ssrc),f.rtpReceiver.receive(I))},u.prototype.setLocalDescription=function(f){var A=this;if(["offer","answer"].indexOf(f.type)===-1)return Promise.reject(De("TypeError",'Unsupported type "'+f.type+'"'));if(!xe("setLocalDescription",f.type,A.signalingState)||A._isClosed)return Promise.reject(De("InvalidStateError","Can not set local "+f.type+" in state "+A.signalingState));if(f.type==="offer"){var m=Fe.splitSections(f.sdp),I=m.shift();m.forEach(function(_,S){_=Fe.parseRtpParameters(_),A.transceivers[S].localCapabilities=_}),A.transceivers.forEach(function(_,S){A._gather(_.mid,S)})}else if(f.type==="answer"){m=Fe.splitSections(A._remoteDescription.sdp),I=m.shift();var E=0<Fe.matchPrefix(I,"a=ice-lite").length;m.forEach(function(_,S){var N=A.transceivers[S],O=N.iceGatherer,B=N.iceTransport,P=N.dtlsTransport,J=N.localCapabilities,ne=N.remoteCapabilities;if(!(Fe.isRejected(_)&&Fe.matchPrefix(_,"a=bundle-only").length===0||N.rejected)){var Ae=Fe.getIceParameters(_,I);_=Fe.getDtlsParameters(_,I),E&&(_.role="server"),A.usingBundle&&S!==0||(A._gather(N.mid,S),B.state==="new"&&B.start(O,Ae,E?"controlling":"controlled"),P.state==="new"&&P.start(_)),S=me(J,ne),A._transceive(N,0<S.codecs.length,!1)}})}return A._localDescription={type:f.type,sdp:f.sdp},f.type==="offer"?A._updateSignalingState("have-local-offer"):A._updateSignalingState("stable"),Promise.resolve()},u.prototype.setRemoteDescription=function(f){var A=this;if(["offer","answer"].indexOf(f.type)===-1)return Promise.reject(De("TypeError",'Unsupported type "'+f.type+'"'));if(!xe("setRemoteDescription",f.type,A.signalingState)||A._isClosed)return Promise.reject(De("InvalidStateError","Can not set remote "+f.type+" in state "+A.signalingState));var m={};A.remoteStreams.forEach(function(B){m[B.id]=B});var I=[],E=Fe.splitSections(f.sdp),_=E.shift(),S=0<Fe.matchPrefix(_,"a=ice-lite").length,N=0<Fe.matchPrefix(_,"a=group:BUNDLE ").length;A.usingBundle=N;var O=Fe.matchPrefix(_,"a=ice-options:")[0];return A.canTrickleIceCandidates=!!O&&0<=O.substr(14).split(" ").indexOf("trickle"),E.forEach(function(B,P){var J=Fe.splitLines(B),ne=Fe.getKind(B),Ae=Fe.isRejected(B)&&Fe.matchPrefix(B,"a=bundle-only").length===0,Me=J[0].substr(2).split(" ")[2];J=Fe.getDirection(B,_);var be=Fe.parseMsid(B),Rt=Fe.getMid(B)||Fe.generateIdentifier();if(Ae||ne==="application"&&(Me==="DTLS/SCTP"||Me==="UDP/DTLS/SCTP"))A.transceivers[P]={mid:Rt,kind:ne,protocol:Me,rejected:!0};else{var ve,et;!Ae&&A.transceivers[P]&&A.transceivers[P].rejected&&(A.transceivers[P]=A._createTransceiver(ne,!0));var It,zt,Pr=Fe.parseRtpParameters(B);Ae||(It=Fe.getIceParameters(B,_),(zt=Fe.getDtlsParameters(B,_)).role="client"),Me=Fe.parseRtpEncodingParameters(B);var Vt=Fe.parseRtcpParameters(B),dn=0<Fe.matchPrefix(B,"a=end-of-candidates",_).length;if(B=Fe.matchPrefix(B,"a=candidate:").map(function(ue){return Fe.parseCandidate(ue)}).filter(function(ue){return ue.component===1}),(f.type==="offer"||f.type==="answer")&&!Ae&&N&&0<P&&A.transceivers[P]&&(A._disposeIceAndDtlsTransports(P),A.transceivers[P].iceGatherer=A.transceivers[0].iceGatherer,A.transceivers[P].iceTransport=A.transceivers[0].iceTransport,A.transceivers[P].dtlsTransport=A.transceivers[0].dtlsTransport,A.transceivers[P].rtpSender&&A.transceivers[P].rtpSender.setTransport(A.transceivers[0].dtlsTransport),A.transceivers[P].rtpReceiver&&A.transceivers[P].rtpReceiver.setTransport(A.transceivers[0].dtlsTransport)),f.type!=="offer"||Ae){if(f.type==="answer"&&!Ae){ne=(ve=A.transceivers[P]).iceGatherer;var G=ve.iceTransport,q=ve.dtlsTransport,Z=ve.rtpReceiver;Ae=ve.sendEncodingParameters,Rt=ve.localCapabilities,A.transceivers[P].recvEncodingParameters=Me,A.transceivers[P].remoteCapabilities=Pr,A.transceivers[P].rtcpParameters=Vt,B.length&&G.state==="new"&&(!S&&!dn||N&&P!==0?B.forEach(function(ue){Pe(ve.iceTransport,ue)}):G.setRemoteCandidates(B)),N&&P!==0||(G.state==="new"&&G.start(ne,It,"controlling"),q.state==="new"&&q.start(zt)),!me(ve.localCapabilities,ve.remoteCapabilities).codecs.filter(function(ue){return ue.name.toLowerCase()==="rtx"}).length&&ve.sendEncodingParameters[0].rtx&&delete ve.sendEncodingParameters[0].rtx,A._transceive(ve,J==="sendrecv"||J==="recvonly",J==="sendrecv"||J==="sendonly"),!Z||J!=="sendrecv"&&J!=="sendonly"?delete ve.rtpReceiver:(et=Z.track,be?(m[be.stream]||(m[be.stream]=new i.MediaStream),s(et,m[be.stream]),I.push([et,Z,m[be.stream]])):(m.default||(m.default=new i.MediaStream),s(et,m.default),I.push([et,Z,m.default])))}}else(ve=A.transceivers[P]||A._createTransceiver(ne)).mid=Rt,ve.iceGatherer||(ve.iceGatherer=A._createIceGatherer(P,N)),B.length&&ve.iceTransport.state==="new"&&(!dn||N&&P!==0?B.forEach(function(ue){Pe(ve.iceTransport,ue)}):ve.iceTransport.setRemoteCandidates(B)),Rt=i.RTCRtpReceiver.getCapabilities(ne),15019>n&&(Rt.codecs=Rt.codecs.filter(function(ue){return ue.name!=="rtx"})),Ae=ve.sendEncodingParameters||[{ssrc:1001*(2*P+2)}],It=!1,J==="sendrecv"||J==="sendonly"?(It=!ve.rtpReceiver,Z=ve.rtpReceiver||new i.RTCRtpReceiver(ve.dtlsTransport,ne),It&&(et=Z.track,be&&be.stream==="-"||(be?(m[be.stream]||(m[be.stream]=new i.MediaStream,Object.defineProperty(m[be.stream],"id",{get:function(){return be.stream}})),Object.defineProperty(et,"id",{get:function(){return be.track}}),G=m[be.stream]):(m.default||(m.default=new i.MediaStream),G=m.default)),G&&(s(et,G),ve.associatedRemoteMediaStreams.push(G)),I.push([et,Z,G]))):ve.rtpReceiver&&ve.rtpReceiver.track&&(ve.associatedRemoteMediaStreams.forEach(function(ue){var de=ue.getTracks().find(function(Le){return Le.id===ve.rtpReceiver.track.id});de&&function(Le,_e){_e.removeTrack(Le),_e.dispatchEvent(new i.MediaStreamTrackEvent("removetrack",{track:Le}))}(de,ue)}),ve.associatedRemoteMediaStreams=[]),ve.localCapabilities=Rt,ve.remoteCapabilities=Pr,ve.rtpReceiver=Z,ve.rtcpParameters=Vt,ve.sendEncodingParameters=Ae,ve.recvEncodingParameters=Me,A._transceive(A.transceivers[P],!1,It)}}),A._dtlsRole===void 0&&(A._dtlsRole=f.type==="offer"?"active":"passive"),A._remoteDescription={type:f.type,sdp:f.sdp},f.type==="offer"?A._updateSignalingState("have-remote-offer"):A._updateSignalingState("stable"),Object.keys(m).forEach(function(B){var P=m[B];if(P.getTracks().length){if(A.remoteStreams.indexOf(P)===-1){A.remoteStreams.push(P);var J=new Event("addstream");J.stream=P,i.setTimeout(function(){A._dispatchEvent("addstream",J)})}I.forEach(function(ne){var Ae=ne[0],Me=ne[1];P.id===ne[2].id&&c(A,Ae,Me,[P])})}}),I.forEach(function(B){B[2]||c(A,B[0],B[1],[])}),i.setTimeout(function(){A&&A.transceivers&&A.transceivers.forEach(function(B){B.iceTransport&&B.iceTransport.state==="new"&&0<B.iceTransport.getRemoteCandidates().length&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),B.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},u.prototype.close=function(){this.transceivers.forEach(function(f){f.iceTransport&&f.iceTransport.stop(),f.dtlsTransport&&f.dtlsTransport.stop(),f.rtpSender&&f.rtpSender.stop(),f.rtpReceiver&&f.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},u.prototype._updateSignalingState=function(f){this.signalingState=f,f=new Event("signalingstatechange"),this._dispatchEvent("signalingstatechange",f)},u.prototype._maybeFireNegotiationNeeded=function(){var f=this;this.signalingState==="stable"&&this.needNegotiation!==!0&&(this.needNegotiation=!0,i.setTimeout(function(){if(f.needNegotiation){f.needNegotiation=!1;var A=new Event("negotiationneeded");f._dispatchEvent("negotiationneeded",A)}},0))},u.prototype._updateIceConnectionState=function(){var f,A={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(function(m){m.iceTransport&&!m.rejected&&A[m.iceTransport.state]++}),f="new",0<A.failed?f="failed":0<A.checking?f="checking":0<A.disconnected?f="disconnected":0<A.new?f="new":0<A.connected?f="connected":0<A.completed&&(f="completed"),f!==this.iceConnectionState&&(this.iceConnectionState=f,f=new Event("iceconnectionstatechange"),this._dispatchEvent("iceconnectionstatechange",f))},u.prototype._updateConnectionState=function(){var f,A={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(function(m){m.iceTransport&&m.dtlsTransport&&!m.rejected&&(A[m.iceTransport.state]++,A[m.dtlsTransport.state]++)}),A.connected+=A.completed,f="new",0<A.failed?f="failed":0<A.connecting?f="connecting":0<A.disconnected?f="disconnected":0<A.new?f="new":0<A.connected&&(f="connected"),f!==this.connectionState&&(this.connectionState=f,f=new Event("connectionstatechange"),this._dispatchEvent("connectionstatechange",f))},u.prototype.createOffer=function(f){var A=this;if(A._isClosed)return Promise.reject(De("InvalidStateError","Can not call createOffer after close"));var m=A.transceivers.filter(function(_){return _.kind==="audio"}).length,I=A.transceivers.filter(function(_){return _.kind==="video"}).length;if(f){if(f.mandatory||f.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");f.offerToReceiveAudio!==void 0&&(m=f.offerToReceiveAudio===!0?1:f.offerToReceiveAudio===!1?0:f.offerToReceiveAudio),f.offerToReceiveVideo!==void 0&&(I=f.offerToReceiveVideo===!0?1:f.offerToReceiveVideo===!1?0:f.offerToReceiveVideo)}for(A.transceivers.forEach(function(_){_.kind==="audio"?0>--m&&(_.wantReceive=!1):_.kind==="video"&&0>--I&&(_.wantReceive=!1)});0<m||0<I;)0<m&&(A._createTransceiver("audio"),m--),0<I&&(A._createTransceiver("video"),I--);var E=Fe.writeSessionBoilerplate(A._sdpSessionId,A._sdpSessionVersion++);return A.transceivers.forEach(function(_,S){var N=_.track,O=_.kind,B=_.mid||Fe.generateIdentifier();_.mid=B,_.iceGatherer||(_.iceGatherer=A._createIceGatherer(S,A.usingBundle)),B=i.RTCRtpSender.getCapabilities(O),15019>n&&(B.codecs=B.codecs.filter(function(P){return P.name!=="rtx"})),B.codecs.forEach(function(P){P.name==="H264"&&P.parameters["level-asymmetry-allowed"]===void 0&&(P.parameters["level-asymmetry-allowed"]="1"),_.remoteCapabilities&&_.remoteCapabilities.codecs&&_.remoteCapabilities.codecs.forEach(function(J){P.name.toLowerCase()===J.name.toLowerCase()&&P.clockRate===J.clockRate&&(P.preferredPayloadType=J.payloadType)})}),B.headerExtensions.forEach(function(P){(_.remoteCapabilities&&_.remoteCapabilities.headerExtensions||[]).forEach(function(J){P.uri===J.uri&&(P.id=J.id)})}),S=_.sendEncodingParameters||[{ssrc:1001*(2*S+1)}],N&&15019<=n&&O==="video"&&!S[0].rtx&&(S[0].rtx={ssrc:S[0].ssrc+1}),_.wantReceive&&(_.rtpReceiver=new i.RTCRtpReceiver(_.dtlsTransport,O)),_.localCapabilities=B,_.sendEncodingParameters=S}),A._config.bundlePolicy!=="max-compat"&&(E+="a=group:BUNDLE "+A.transceivers.map(function(_){return _.mid}).join(" ")+`\r
`),E+=`a=ice-options:trickle\r
`,A.transceivers.forEach(function(_,S){E+=oe(_,_.localCapabilities,"offer",_.stream,A._dtlsRole),E+=`a=rtcp-rsize\r
`,!_.iceGatherer||A.iceGatheringState==="new"||S!==0&&A.usingBundle||(_.iceGatherer.getLocalCandidates().forEach(function(N){N.component=1,E+="a="+Fe.writeCandidate(N)+`\r
`}),_.iceGatherer.state==="completed"&&(E+=`a=end-of-candidates\r
`))}),f=new i.RTCSessionDescription({type:"offer",sdp:E}),Promise.resolve(f)},u.prototype.createAnswer=function(){var f=this;if(f._isClosed)return Promise.reject(De("InvalidStateError","Can not call createAnswer after close"));if(f.signalingState!=="have-remote-offer"&&f.signalingState!=="have-local-pranswer")return Promise.reject(De("InvalidStateError","Can not call createAnswer in signalingState "+f.signalingState));var A=Fe.writeSessionBoilerplate(f._sdpSessionId,f._sdpSessionVersion++);f.usingBundle&&(A+="a=group:BUNDLE "+f.transceivers.map(function(E){return E.mid}).join(" ")+`\r
`),A+=`a=ice-options:trickle\r
`;var m=Fe.getMediaSections(f._remoteDescription.sdp).length;f.transceivers.forEach(function(E,_){if(!(_+1>m)){if(E.rejected)return E.kind==="application"?E.protocol==="DTLS/SCTP"?A+=`m=application 0 DTLS/SCTP 5000\r
`:A+="m=application 0 "+E.protocol+` webrtc-datachannel\r
`:E.kind==="audio"?A+=`m=audio 0 UDP/TLS/RTP/SAVPF 0\r
a=rtpmap:0 PCMU/8000\r
`:E.kind==="video"&&(A+=`m=video 0 UDP/TLS/RTP/SAVPF 120\r
a=rtpmap:120 VP8/90000\r
`),void(A+=`c=IN IP4 0.0.0.0\r
a=inactive\r
a=mid:`+E.mid+`\r
`);var S;E.stream&&(E.kind==="audio"?S=E.stream.getAudioTracks()[0]:E.kind==="video"&&(S=E.stream.getVideoTracks()[0]),S&&15019<=n&&E.kind==="video"&&!E.sendEncodingParameters[0].rtx&&(E.sendEncodingParameters[0].rtx={ssrc:E.sendEncodingParameters[0].ssrc+1})),_=me(E.localCapabilities,E.remoteCapabilities),!_.codecs.filter(function(N){return N.name.toLowerCase()==="rtx"}).length&&E.sendEncodingParameters[0].rtx&&delete E.sendEncodingParameters[0].rtx,A+=oe(E,_,"answer",E.stream,f._dtlsRole),E.rtcpParameters&&E.rtcpParameters.reducedSize&&(A+=`a=rtcp-rsize\r
`)}});var I=new i.RTCSessionDescription({type:"answer",sdp:A});return Promise.resolve(I)},u.prototype.addIceCandidate=function(f){var A,m=this;return f&&f.sdpMLineIndex===void 0&&!f.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(I,E){if(!m._remoteDescription)return E(De("InvalidStateError","Can not add ICE candidate without a remote description"));if(f&&f.candidate!==""){var _=f.sdpMLineIndex;if(f.sdpMid){for(var S=0;S<m.transceivers.length;S++)if(m.transceivers[S].mid===f.sdpMid){_=S;break}}var N=m.transceivers[_];if(!N)return E(De("OperationError","Can not add ICE candidate"));if(N.rejected||(S=0<Object.keys(f.candidate).length?Fe.parseCandidate(f.candidate):{},S.protocol==="tcp"&&(S.port===0||S.port===9)||S.component&&S.component!==1))return I();if((_===0||0<_&&N.iceTransport!==m.transceivers[0].iceTransport)&&!Pe(N.iceTransport,S))return E(De("OperationError","Can not add ICE candidate"));E=f.candidate.trim(),E.indexOf("a=")===0&&(E=E.substr(2)),(A=Fe.getMediaSections(m._remoteDescription.sdp))[_]+="a="+(S.type?E:"end-of-candidates")+`\r
`,m._remoteDescription.sdp=Fe.getDescription(m._remoteDescription.sdp)+A.join("")}else for(_=0;_<m.transceivers.length&&(m.transceivers[_].rejected||(m.transceivers[_].iceTransport.addRemoteCandidate({}),(A=Fe.getMediaSections(m._remoteDescription.sdp))[_]+=`a=end-of-candidates\r
`,m._remoteDescription.sdp=Fe.getDescription(m._remoteDescription.sdp)+A.join(""),!m.usingBundle));_++);I()})},u.prototype.getStats=function(f){if(f&&f instanceof i.MediaStreamTrack){var A=null;if(this.transceivers.forEach(function(I){I.rtpSender&&I.rtpSender.track===f?A=I.rtpSender:I.rtpReceiver&&I.rtpReceiver.track===f&&(A=I.rtpReceiver)}),!A)throw De("InvalidAccessError","Invalid selector.");return A.getStats()}var m=[];return this.transceivers.forEach(function(I){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(E){I[E]&&m.push(I[E].getStats())})}),Promise.all(m).then(function(I){var E=new Map;return I.forEach(function(_){_.forEach(function(S){E.set(S.id,S)})}),E})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(f){if((f=i[f])&&f.prototype&&f.prototype.getStats){var A=f.prototype.getStats;f.prototype.getStats=function(){return A.apply(this).then(function(m){var I=new Map;return Object.keys(m).forEach(function(E){var _;m[E].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(_=m[E]).type]||_.type,I.set(E,m[E])}),I})}}});var h=["createOffer","createAnswer"];return h.forEach(function(f){var A=u.prototype[f];u.prototype[f]=function(){var m=arguments;return typeof m[0]=="function"||typeof m[1]=="function"?A.apply(this,[arguments[2]]).then(function(I){typeof m[0]=="function"&&m[0].apply(null,[I])},function(I){typeof m[1]=="function"&&m[1].apply(null,[I])}):A.apply(this,arguments)}}),(h=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(f){var A=u.prototype[f];u.prototype[f]=function(){var m=arguments;return typeof m[1]=="function"||typeof m[2]=="function"?A.apply(this,arguments).then(function(){typeof m[1]=="function"&&m[1].apply(null)},function(I){typeof m[2]=="function"&&m[2].apply(null,[I])}):A.apply(this,arguments)}}),["getStats"].forEach(function(f){var A=u.prototype[f];u.prototype[f]=function(){var m=arguments;return typeof m[1]=="function"?A.apply(this,arguments).then(function(){typeof m[1]=="function"&&m[1].apply(null)}):A.apply(this,arguments)}}),u},jE=Object.freeze({__proto__:null,shimPeerConnection:rt,shimReplaceTrack:Er,shimGetUserMedia:Kt,shimGetDisplayMedia:mt}),HE=Object.freeze({__proto__:null,shimOnTrack:yt,shimPeerConnection:lr,shimSenderGetStats:Ir,shimReceiverGetStats:li,shimRemoveStream:$n,shimRTCDataChannel:ui,shimGetUserMedia:Nt,shimGetDisplayMedia:function(i,n){i.navigator.mediaDevices&&"getDisplayMedia"in i.navigator.mediaDevices||i.navigator.mediaDevices&&(i.navigator.mediaDevices.getDisplayMedia=function(s){return s&&s.video?(s.video===!0?s.video={mediaSource:n}:s.video.mediaSource=n,i.navigator.mediaDevices.getUserMedia(s)):(s=new DOMException("getDisplayMedia without video constraints is undefined"),s.name="NotFoundError",s.code=8,se.reject(s))})}}),KE=Object.freeze({__proto__:null,shimLocalStreamsAPI:on,shimRemoteStreamsAPI:ki,shimCallbacksAPI:yn,shimGetUserMedia:Vr,shimConstraints:di,shimRTCIceServerUrls:go,shimTrackEventTransceiver:_n,shimCreateOfferLegacy:Ue}),kR=Object.freeze({__proto__:null,shimRTCIceCandidate:Ot,shimMaxMessageSize:ir,shimSendThrowTypeError:rr,shimConnectionState:Wr,removeAllowExtmapMixed:mo});(function({window:i}={},n={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){let s=v(i),c={browserDetails:s,commonShim:kR,extractVersion:o,disableLog:l,disableWarnings:d};switch(s.browser){case"chrome":if(!UE||!Q||!n.shimChrome)return p("Chrome shim is not included in this adapter release."),c;p("adapter.js shimming chrome."),c.browserShim=UE,w(i),k(i),Q(i),M(i),he(i),x(i),V(i),Y(i),pe(i),Ot(i),Wr(i),ir(i),rr(i),mo(i);break;case"firefox":if(!HE||!lr||!n.shimFirefox)return p("Firefox shim is not included in this adapter release."),c;p("adapter.js shimming firefox."),c.browserShim=HE,Nt(i),lr(i),yt(i),$n(i),Ir(i),li(i),ui(i),Ot(i),Wr(i),ir(i),rr(i);break;case"edge":if(!jE||!rt||!n.shimEdge)return p("MS edge shim is not included in this adapter release."),c;p("adapter.js shimming edge."),c.browserShim=jE,Kt(i),mt(i),rt(i),Er(i),ir(i),rr(i);break;case"safari":if(!KE||!n.shimSafari)return p("Safari shim is not included in this adapter release."),c;p("adapter.js shimming safari."),c.browserShim=KE,go(i),Ue(i),yn(i),on(i),ki(i),_n(i),Vr(i),Ot(i),ir(i),rr(i),mo(i);break;default:p("Unsupported browser!")}})({window});var ln,$e;(function(i){i.WIN_10="Windows 10",i.WIN_81="Windows 8.1",i.WIN_8="Windows 8",i.WIN_7="Windows 7",i.WIN_VISTA="Windows Vista",i.WIN_SERVER_2003="Windows Server 2003",i.WIN_XP="Windows XP",i.WIN_2000="Windows 2000",i.ANDROID="Android",i.OPEN_BSD="Open BSD",i.SUN_OS="Sun OS",i.LINUX="Linux",i.IOS="iOS",i.MAC_OS="Mac OS",i.QNX="QNX",i.UNIX="UNIX",i.BEOS="BeOS",i.OS_2="OS/2",i.SEARCH_BOT="Search Bot"})(ln||(ln={})),function(i){i.CHROME="Chrome",i.SAFARI="Safari",i.EDGE="Edge",i.FIREFOX="Firefox",i.OPERA="OPR",i.QQ="QQBrowser",i.WECHAT="MicroMessenger"}($e||($e={}));let Lp=new(r(function(i,n){(function(s,c){var u={extend:function(S,N){var O={},B;for(B in S)N[B]&&N[B].length%2==0?O[B]=N[B].concat(S[B]):O[B]=S[B];return O},has:function(S,N){return typeof S=="string"&&N.toLowerCase().indexOf(S.toLowerCase())!==-1},lowerize:function(S){return S.toLowerCase()},major:function(S){return typeof S=="string"?S.replace(/[^\d\.]/g,"").split(".")[0]:c},trim:function(S,N){return S=S.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),N===void 0?S:S.substring(0,255)}},h=function(S,N){for(var O,B,P,J,ne,Ae,Me=0;Me<N.length&&!ne;){var be=N[Me],Rt=N[Me+1];for(O=B=0;O<be.length&&!ne;)if(ne=be[O++].exec(S))for(P=0;P<Rt.length;P++)Ae=ne[++B],typeof(J=Rt[P])=="object"&&0<J.length?J.length==2?typeof J[1]=="function"?this[J[0]]=J[1].call(this,Ae):this[J[0]]=J[1]:J.length==3?typeof J[1]!="function"||J[1].exec&&J[1].test?this[J[0]]=Ae?Ae.replace(J[1],J[2]):c:this[J[0]]=Ae?J[1].call(this,Ae,J[2]):c:J.length==4&&(this[J[0]]=Ae?J[3].call(this,Ae.replace(J[1],J[2])):c):this[J]=Ae||c;Me+=2}},f=function(S,N){for(var O in N)if(typeof N[O]=="object"&&0<N[O].length){for(var B=0;B<N[O].length;B++)if(u.has(N[O][B],S))return O==="?"?c:O}else if(u.has(N[O],S))return O==="?"?c:O;return S},A={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},m={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],["version",["name","Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],["version",["name","Edge"]],[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]{3,6})\b.+version\/([\w\.-]+)/i,/(opera)(?:.+version\/|[\/\s]+)([\w\.]+)/i],["name","version"],[/opios[\/\s]+([\w\.]+)/i],["version",["name","Opera Mini"]],[/\sopr\/([\w\.]+)/i],["version",["name","Opera"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]*)/i,/(avant\s|iemobile|slim)(?:browser)?[\/\s]?([\w\.]*)/i,/(ba?idubrowser)[\/\s]?([\w\.]+)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon)\/([\w\.-]+)/i,/(rekonq|puffin|brave|whale|qqbrowserlite|qq)\/([\w\.]+)/i,/(weibo)__([\d\.]+)/i],["name","version"],[/(?:[\s\/]uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],["version",["name","UCBrowser"]],[/(?:windowswechat)?\sqbcore\/([\w\.]+)\b.*(?:windowswechat)?/i],["version",["name","WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],["version",["name","WeChat"]],[/konqueror\/([\w\.]+)/i],["version",["name","Konqueror"]],[/trident.+rv[:\s]([\w\.]{1,9})\b.+like\sgecko/i],["version",["name","IE"]],[/yabrowser\/([\w\.]+)/i],["version",["name","Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[["name",/(.+)/,"$1 Secure Browser"],"version"],[/focus\/([\w\.]+)/i],["version",["name","Firefox Focus"]],[/opt\/([\w\.]+)/i],["version",["name","Opera Touch"]],[/coc_coc_browser\/([\w\.]+)/i],["version",["name","Coc Coc"]],[/dolfin\/([\w\.]+)/i],["version",["name","Dolphin"]],[/coast\/([\w\.]+)/i],["version",["name","Opera Coast"]],[/xiaomi\/miuibrowser\/([\w\.]+)/i],["version",["name","MIUI Browser"]],[/fxios\/([\w\.-]+)/i],["version",["name","Firefox"]],[/(qihu|qhbrowser|qihoobrowser|360browser)/i],[["name","360 Browser"]],[/(oculus|samsung|sailfish)browser\/([\w\.]+)/i],[["name",/(.+)/,"$1 Browser"],"version"],[/(comodo_dragon)\/([\w\.]+)/i],[["name",/_/g," "],"version"],[/\s(electron)\/([\w\.]+)\ssafari/i,/(tesla)(?:\sqtcarbrowser|\/(20[12]\d\.[\w\.-]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/\s]?([\w\.]+)/i],["name","version"],[/(MetaSr)[\/\s]?([\w\.]+)/i,/(LBBROWSER)/i],["name"],[/;fbav\/([\w\.]+);/i],["version",["name","Facebook"]],[/FBAN\/FBIOS|FB_IAB\/FB4A/i],[["name","Facebook"]],[/safari\s(line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/\s]([\w\.-]+)/i],["name","version"],[/\bgsa\/([\w\.]+)\s.*safari\//i],["version",["name","GSA"]],[/headlesschrome(?:\/([\w\.]+)|\s)/i],["version",["name","Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[["name","Chrome WebView"],"version"],[/droid.+\sversion\/([\w\.]+)\b.+(?:mobile\ssafari|safari)/i],["version",["name","Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],["name","version"],[/version\/([\w\.]+)\s.*mobile\/\w+\s(safari)/i],["version",["name","Mobile Safari"]],[/version\/([\w\.]+)\s.*(mobile\s?safari|safari)/i],["version","name"],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],["name",["version",f,{"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],["name","version"],[/(navigator|netscape)\/([\w\.-]+)/i],[["name","Netscape"],"version"],[/ile\svr;\srv:([\w\.]+)\).+firefox/i],["version",["name","Firefox Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([\w\.-]+)$/i,/(firefox)\/([\w\.]+)\s[\w\s\-]+\/[\w\.]+$/i,/(mozilla)\/([\w\.]+)\s.+rv:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]*)/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],["name","version"]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[["architecture","amd64"]],[/(ia32(?=;))/i],[["architecture",u.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[["architecture","ia32"]],[/\b(aarch64|armv?8e?l?)\b/i],[["architecture","arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[["architecture","armhf"]],[/windows\s(ce|mobile);\sppc;/i],[["architecture","arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[["architecture",/ower/,"",u.lowerize]],[/(sun4\w)[;\)]/i],[["architecture","sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?:64|(?=v(?:[1-7]|[5-7]1)l?|;|eabi))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[["architecture",u.lowerize]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[pt]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus\s10)/i],["model",["vendor","Samsung"],["type","tablet"]],[/\b((?:s[cgp]h|gt|sm)-\w+|galaxy\snexus)/i,/\ssamsung[\s-]([\w-]+)/i,/sec-(sgh\w+)/i],["model",["vendor","Samsung"],["type","mobile"]],[/\((ip(?:hone|od)[\s\w]*);/i],["model",["vendor","Apple"],["type","mobile"]],[/\((ipad);[\w\s\),;-]+apple/i,/applecoremedia\/[\w\.]+\s\((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],["model",["vendor","Apple"],["type","tablet"]],[/\b((?:agr|ags[23]|bah2?|sht?)-a?[lw]\d{2})/i],["model",["vendor","Huawei"],["type","tablet"]],[/d\/huawei([\w\s-]+)[;\)]/i,/\b(nexus\s6p|vog-[at]?l\d\d|ane-[at]?l[x\d]\d|eml-a?l\d\da?|lya-[at]?l\d[\dc]|clt-a?l\d\di?|ele-l\d\d)/i,/\b(\w{2,4}-[atu][ln][01259][019])[;\)\s]/i],["model",["vendor","Huawei"],["type","mobile"]],[/\b(poco[\s\w]+)(?:\sbuild|\))/i,/\b;\s(\w+)\sbuild\/hm\1/i,/\b(hm[\s\-_]?note?[\s_]?(?:\d\w)?)\sbuild/i,/\b(redmi[\s\-_]?(?:note|k)?[\w\s_]+)(?:\sbuild|\))/i,/\b(mi[\s\-_]?(?:a\d|one|one[\s_]plus|note lte)?[\s_]?(?:\d?\w?)[\s_]?(?:plus)?)\sbuild/i],[["model",/_/g," "],["vendor","Xiaomi"],["type","mobile"]],[/\b(mi[\s\-_]?(?:pad)(?:[\w\s_]+))(?:\sbuild|\))/i],[["model",/_/g," "],["vendor","Xiaomi"],["type","tablet"]],[/;\s(\w+)\sbuild.+\soppo/i,/\s(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007)\b/i],["model",["vendor","OPPO"],["type","mobile"]],[/\svivo\s(\w+)(?:\sbuild|\))/i,/\s(v[12]\d{3}\w?[at])(?:\sbuild|;)/i],["model",["vendor","Vivo"],["type","mobile"]],[/\s(rmx[12]\d{3})(?:\sbuild|;)/i],["model",["vendor","Realme"],["type","mobile"]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?:?(\s4g)?)\b[\w\s]+build\//i,/\smot(?:orola)?[\s-](\w*)/i,/((?:moto[\s\w\(\)]+|xt\d{3,4}|nexus\s6)(?=\sbuild|\)))/i],["model",["vendor","Motorola"],["type","mobile"]],[/\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],["model",["vendor","Motorola"],["type","tablet"]],[/((?=lg)?[vl]k\-?\d{3})\sbuild|\s3\.[\s\w;-]{10}lg?-([06cv9]{3,4})/i],["model",["vendor","LG"],["type","tablet"]],[/(lm-?f100[nv]?|nexus\s[45])/i,/lg[e;\s\/-]+((?!browser|netcast)\w+)/i,/\blg(\-?[\d\w]+)\sbuild/i],["model",["vendor","LG"],["type","mobile"]],[/(ideatab[\w\-\s]+)/i,/lenovo\s?(s(?:5000|6000)(?:[\w-]+)|tab(?:[\s\w]+)|yt[\d\w-]{6}|tb[\d\w-]{6})/i],["model",["vendor","Lenovo"],["type","tablet"]],[/(?:maemo|nokia).*(n900|lumia\s\d+)/i,/nokia[\s_-]?([\w\.-]*)/i],[["model",/_/g," "],["vendor","Nokia"],["type","mobile"]],[/droid.+;\s(pixel\sc)[\s)]/i],["model",["vendor","Google"],["type","tablet"]],[/droid.+;\s(pixel[\s\daxl]{0,6})(?:\sbuild|\))/i],["model",["vendor","Google"],["type","mobile"]],[/droid.+\s([c-g]\d{4}|so[-l]\w+|xq-a\w[4-7][12])(?=\sbuild\/|\).+chrome\/(?![1-6]{0,1}\d\.))/i],["model",["vendor","Sony"],["type","mobile"]],[/sony\stablet\s[ps]\sbuild\//i,/(?:sony)?sgp\w+(?:\sbuild\/|\))/i],[["model","Xperia Tablet"],["vendor","Sony"],["type","tablet"]],[/\s(kb2005|in20[12]5|be20[12][59])\b/i,/\ba000(1)\sbuild/i,/\boneplus\s(a\d{4})[\s)]/i],["model",["vendor","OnePlus"],["type","mobile"]],[/(alexa)webm/i,/(kf[a-z]{2}wi)(\sbuild\/|\))/i,/(kf[a-z]+)(\sbuild\/|\)).+silk\//i],["model",["vendor","Amazon"],["type","tablet"]],[/(sd|kf)[0349hijorstuw]+(\sbuild\/|\)).+silk\//i],[["model","Fire Phone"],["vendor","Amazon"],["type","mobile"]],[/\((playbook);[\w\s\),;-]+(rim)/i],["model","vendor",["type","tablet"]],[/((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10;\s(\w+)/i],["model",["vendor","BlackBerry"],["type","mobile"]],[/(?:\b|asus_)(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus\s7|padfone|p00[cj])/i],["model",["vendor","ASUS"],["type","tablet"]],[/\s(z[es]6[027][01][km][ls]|zenfone\s\d\w?)\b/i],["model",["vendor","ASUS"],["type","mobile"]],[/(nexus\s9)/i],["model",["vendor","HTC"],["type","tablet"]],[/(htc)[;_\s-]{1,2}([\w\s]+(?=\)|\sbuild)|\w+)/i,/(zte)-(\w*)/i,/(alcatel|geeksphone|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]*)/i],["vendor",["model",/_/g," "],["type","mobile"]],[/droid[x\d\.\s;]+\s([ab][1-7]\-?[0178a]\d\d?)/i],["model",["vendor","Acer"],["type","tablet"]],[/droid.+;\s(m[1-5]\snote)\sbuild/i,/\bmz-([\w-]{2,})/i],["model",["vendor","Meizu"],["type","mobile"]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]*)/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i,/(microsoft);\s(lumia[\s\w]+)/i,/(lenovo)[_\s-]?([\w-]+)/i,/linux;.+(jolla);/i,/droid.+;\s(oppo)\s?([\w\s]+)\sbuild/i],["vendor","model",["type","mobile"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i,/[;\/]\s?(le[\s\-]+pan)[\s\-]+(\w{1,9})\sbuild/i,/[;\/]\s?(trinity)[\-\s]*(t\d{3})\sbuild/i,/\b(gigaset)[\s\-]+(q\w{1,9})\sbuild/i,/\b(vodafone)\s([\w\s]+)(?:\)|\sbuild)/i],["vendor","model",["type","tablet"]],[/\s(surface\sduo)\s/i],["model",["vendor","Microsoft"],["type","tablet"]],[/droid\s[\d\.]+;\s(fp\du?)\sbuild/i],["model",["vendor","Fairphone"],["type","mobile"]],[/\s(u304aa)\sbuild/i],["model",["vendor","AT&T"],["type","mobile"]],[/sie-(\w*)/i],["model",["vendor","Siemens"],["type","mobile"]],[/[;\/]\s?(rct\w+)\sbuild/i],["model",["vendor","RCA"],["type","tablet"]],[/[;\/\s](venue[\d\s]{2,7})\sbuild/i],["model",["vendor","Dell"],["type","tablet"]],[/[;\/]\s?(q(?:mv|ta)\w+)\sbuild/i],["model",["vendor","Verizon"],["type","tablet"]],[/[;\/]\s(?:barnes[&\s]+noble\s|bn[rt])([\w\s\+]*)\sbuild/i],["model",["vendor","Barnes & Noble"],["type","tablet"]],[/[;\/]\s(tm\d{3}\w+)\sbuild/i],["model",["vendor","NuVision"],["type","tablet"]],[/;\s(k88)\sbuild/i],["model",["vendor","ZTE"],["type","tablet"]],[/;\s(nx\d{3}j)\sbuild/i],["model",["vendor","ZTE"],["type","mobile"]],[/[;\/]\s?(gen\d{3})\sbuild.*49h/i],["model",["vendor","Swiss"],["type","mobile"]],[/[;\/]\s?(zur\d{3})\sbuild/i],["model",["vendor","Swiss"],["type","tablet"]],[/[;\/]\s?((zeki)?tb.*\b)\sbuild/i],["model",["vendor","Zeki"],["type","tablet"]],[/[;\/]\s([yr]\d{2})\sbuild/i,/[;\/]\s(dragon[\-\s]+touch\s|dt)(\w{5})\sbuild/i],[["vendor","Dragon Touch"],"model",["type","tablet"]],[/[;\/]\s?(ns-?\w{0,9})\sbuild/i],["model",["vendor","Insignia"],["type","tablet"]],[/[;\/]\s?((nxa|Next)-?\w{0,9})\sbuild/i],["model",["vendor","NextBook"],["type","tablet"]],[/[;\/]\s?(xtreme_)?(v(1[045]|2[015]|[3469]0|7[05]))\sbuild/i],[["vendor","Voice"],"model",["type","mobile"]],[/[;\/]\s?(lvtel\-)?(v1[12])\sbuild/i],[["vendor","LvTel"],"model",["type","mobile"]],[/;\s(ph-1)\s/i],["model",["vendor","Essential"],["type","mobile"]],[/[;\/]\s?(v(100md|700na|7011|917g).*\b)\sbuild/i],["model",["vendor","Envizen"],["type","tablet"]],[/[;\/]\s?(trio[\s\w\-\.]+)\sbuild/i],["model",["vendor","MachSpeed"],["type","tablet"]],[/[;\/]\s?tu_(1491)\sbuild/i],["model",["vendor","Rotor"],["type","tablet"]],[/(shield[\w\s]+)\sbuild/i],["model",["vendor","Nvidia"],["type","tablet"]],[/(sprint)\s(\w+)/i],["vendor","model",["type","mobile"]],[/(kin\.[onetw]{3})/i],[["model",/\./g," "],["vendor","Microsoft"],["type","mobile"]],[/droid\s[\d\.]+;\s(cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],["model",["vendor","Zebra"],["type","tablet"]],[/droid\s[\d\.]+;\s(ec30|ps20|tc[2-8]\d[kx])\)/i],["model",["vendor","Zebra"],["type","mobile"]],[/\s(ouya)\s/i,/(nintendo)\s([wids3utch]+)/i],["vendor","model",["type","console"]],[/droid.+;\s(shield)\sbuild/i],["model",["vendor","Nvidia"],["type","console"]],[/(playstation\s[345portablevi]+)/i],["model",["vendor","Sony"],["type","console"]],[/[\s\(;](xbox(?:\sone)?(?!;\sxbox))[\s\);]/i],["model",["vendor","Microsoft"],["type","console"]],[/smart-tv.+(samsung)/i],["vendor",["type","smarttv"]],[/hbbtv.+maple;(\d+)/i],[["model",/^/,"SmartTV"],["vendor","Samsung"],["type","smarttv"]],[/(?:linux;\snetcast.+smarttv|lg\snetcast\.tv-201\d)/i],[["vendor","LG"],["type","smarttv"]],[/(apple)\s?tv/i],["vendor",["model","Apple TV"],["type","smarttv"]],[/crkey/i],[["model","Chromecast"],["vendor","Google"],["type","smarttv"]],[/droid.+aft([\w])(\sbuild\/|\))/i],["model",["vendor","Amazon"],["type","smarttv"]],[/\(dtv[\);].+(aquos)/i],["model",["vendor","Sharp"],["type","smarttv"]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[["vendor",u.trim],["model",u.trim],["type","smarttv"]],[/[\s\/\(](android\s|smart[-\s]?|opera\s)tv[;\)\s]/i],[["type","smarttv"]],[/((pebble))app\/[\d\.]+\s/i],["vendor","model",["type","wearable"]],[/droid.+;\s(glass)\s\d/i],["model",["vendor","Google"],["type","wearable"]],[/droid\s[\d\.]+;\s(wt63?0{2,3})\)/i],["model",["vendor","Zebra"],["type","wearable"]],[/(tesla)(?:\sqtcarbrowser|\/20[12]\d\.[\w\.-]+)/i],["vendor",["type","embedded"]],[/droid .+?; ([^;]+?)(?: build|\) applewebkit).+? mobile safari/i],["model",["type","mobile"]],[/droid .+?;\s([^;]+?)(?: build|\) applewebkit).+?(?! mobile) safari/i],["model",["type","tablet"]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[["type",u.lowerize]],[/(android[\w\.\s\-]{0,9});.+build/i],["model",["vendor","Generic"]],[/(phone)/i],[["type","mobile"]]],engine:[[/windows.+\sedge\/([\w\.]+)/i],["version",["name","EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],["version",["name","Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],["name","version"],[/rv:([\w\.]{1,9})\b.+(gecko)/i],["version","name"]],os:[[/microsoft\s(windows)\s(vista|xp)/i],["name","version"],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s\w]*)/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)(?!.+xbox)/i],["name",["version",f,A]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[["name","Windows"],["version",f,A]],[/ip[honead]{2,4}\b(?:.*os\s([\w]+)\slike\smac|;\sopera)/i,/cfnetwork\/.+darwin/i],[["version",/_/g,"."],["name","iOS"]],[/(mac\sos\sx)\s?([\w\s\.]*)/i,/(macintosh|mac(?=_powerpc)\s)(?!.+haiku)/i],[["name","Mac OS"],["version",/_/g,"."]],[/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|sailfish|contiki)[\/\s-]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/\s]([\w\.]+)/i,/\((series40);/i],["name","version"],[/\(bb(10);/i],["version",["name","BlackBerry"]],[/(?:symbian\s?os|symbos|s60(?=;)|series60)[\/\s-]?([\w\.]*)/i],["version",["name","Symbian"]],[/mozilla.+\(mobile;.+gecko.+firefox/i],[["name","Firefox OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],["version",["name","webOS"]],[/crkey\/([\d\.]+)/i],["version",["name","Chromecast"]],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[["name","Chromium OS"],"version"],[/(nintendo|playstation)\s([wids345portablevuch]+)/i,/(xbox);\s+xbox\s([^\);]+)/i,/(mint)[\/\s\(\)]?(\w*)/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?=\slinux)|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus|raspbian)(?:\sgnu\/linux)?(?:\slinux)?[\/\s-]?(?!chrom|package)([\w\.-]*)/i,/(hurd|linux)\s?([\w\.]*)/i,/(gnu)\s?([\w\.]*)/i,/\s([frentopc-]{0,4}bsd|dragonfly)\s?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku)\s(\w+)/i],["name","version"],[/(sunos)\s?([\w\.\d]*)/i],[["name","Solaris"],"version"],[/((?:open)?solaris)[\/\s-]?([\w\.]*)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.])*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms|fuchsia)/i,/(unix)\s?([\w\.]*)/i],["name","version"]]},I=function(S,N){if(typeof S=="object"&&(N=S,S=c),!(this instanceof I))return new I(S,N).getResult();var O=S||(s!==void 0&&s.navigator&&s.navigator.userAgent?s.navigator.userAgent:""),B=N?u.extend(m,N):m;return this.getBrowser=function(){var P={name:c,version:c};return h.call(P,O,B.browser),P.major=u.major(P.version),P},this.getCPU=function(){var P={architecture:c};return h.call(P,O,B.cpu),P},this.getDevice=function(){var P={vendor:c,model:c,type:c};return h.call(P,O,B.device),P},this.getEngine=function(){var P={name:c,version:c};return h.call(P,O,B.engine),P},this.getOS=function(){var P={name:c,version:c};return h.call(P,O,B.os),P},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return O},this.setUA=function(P){return O=typeof P=="string"&&255<P.length?u.trim(P,255):P,this},this.setUA(O),this};I.VERSION="0.7.28",I.BROWSER={NAME:"name",MAJOR:"major",VERSION:"version"},I.CPU={ARCHITECTURE:"architecture"},I.DEVICE={MODEL:"model",VENDOR:"vendor",TYPE:"type",CONSOLE:"console",MOBILE:"mobile",SMARTTV:"smarttv",TABLET:"tablet",WEARABLE:"wearable",EMBEDDED:"embedded"},I.ENGINE={NAME:"name",VERSION:"version"},I.OS={NAME:"name",VERSION:"version"},i.exports&&(n=i.exports=I),n.UAParser=I;var E=s!==void 0&&(s.jQuery||s.Zepto);if(E&&!E.ua){var _=new I;E.ua=_.getResult(),E.ua.get=function(){return _.getUA()},E.ua.set=function(S){_.setUA(S),S=_.getResult();for(var N in S)E.ua[N]=S[N]}}})(typeof window=="object"?window:$c)})),Sn=Lp.getResult(),ei=function(i){if(i.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return i;var n=i.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(n&&n[1]&&n[2]){var s,c=n[2];return b(s="".concat(n[1],".")).call(s,c)}return(n=i.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/))&&n[1]&&n[2]?(s=n[2],b(c="".concat(n[1],".")).call(c,100*(Number(s)+1))):"4.0.0.999"}("4.7.2");try{var WE=JSON.parse("true")===!0}catch{WE=!0}let Pp=WE,jr={username:"test",password:"111111",turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1},bR={"90p":Ge(160,90),"90p_1":Ge(160,90),"120p":Ge(160,120,15,30,65),"120p_1":Ge(160,120,15,30,65),"120p_3":Ge(120,120,15,30,50),"120p_4":Ge(212,120),"180p":Ge(320,180,15,30,140),"180p_1":Ge(320,180,15,30,140),"180p_3":Ge(180,180,15,30,100),"180p_4":Ge(240,180,15,30,120),"240p":Ge(320,240,15,40,200),"240p_1":Ge(320,240,15,40,200),"240p_3":Ge(240,240,15,40,140),"240p_4":Ge(424,240,15,40,220),"360p":Ge(640,360,15,80,400),"360p_1":Ge(640,360,15,80,400),"360p_3":Ge(360,360,15,80,260),"360p_4":Ge(640,360,30,80,600),"360p_6":Ge(360,360,30,80,400),"360p_7":Ge(480,360,15,80,320),"360p_8":Ge(480,360,30,80,490),"360p_9":Ge(640,360,15,80,800),"360p_10":Ge(640,360,24,80,800),"360p_11":Ge(640,360,24,80,1e3),"480p":Ge(640,480,15,100,500),"480p_1":Ge(640,480,15,100,500),"480p_2":Ge(640,480,30,100,1e3),"480p_3":Ge(480,480,15,100,400),"480p_4":Ge(640,480,30,100,750),"480p_6":Ge(480,480,30,100,600),"480p_8":Ge(848,480,15,100,610),"480p_9":Ge(848,480,30,100,930),"480p_10":Ge(640,480,10,100,400),"720p":Ge(1280,720,15,120,1130),"720p_1":Ge(1280,720,15,120,1130),"720p_2":Ge(1280,720,30,120,2e3),"720p_3":Ge(1280,720,30,120,1710),"720p_5":Ge(960,720,15,120,910),"720p_6":Ge(960,720,30,120,1380),"1080p":Ge(1920,1080,15,120,2080),"1080p_1":Ge(1920,1080,15,120,2080),"1080p_2":Ge(1920,1080,30,120,3e3),"1080p_3":Ge(1920,1080,30,120,3150),"1080p_5":Ge(1920,1080,60,120,4780),"1440p":Ge(2560,1440,30,120,4850),"1440p_1":Ge(2560,1440,30,120,4850),"1440p_2":Ge(2560,1440,60,120,7350),"4k":Ge(3840,2160,30,120,8910),"4k_1":Ge(3840,2160,30,120,8910),"4k_3":Ge(3840,2160,60,120,13500)},DR={"480p":X(640,480,5),"480p_1":X(640,480,5),"480p_2":X(640,480,30),"480p_3":X(640,480,15),"720p":X(1280,720,5),"720p_1":X(1280,720,5),"720p_2":X(1280,720,30),"720p_3":X(1280,720,15),"1080p":X(1920,1080,5),"1080p_1":X(1920,1080,5),"1080p_2":X(1920,1080,30),"1080p_3":X(1920,1080,15)},BR={"1SL1TL":we(1,1),"3SL3TL":we(3,3),"2SL3TL":we(2,3)},MR={speech_low_quality:hs(16e3,!1),speech_standard:hs(32e3,!1,18),music_standard:hs(48e3,!1),standard_stereo:hs(48e3,!0,56),high_quality:hs(48e3,!1,128),high_quality_stereo:hs(48e3,!0,192)},te={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,HTTP_CONNECT_TIMEOUT:5e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_TIMEOUT:1e4,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],FILEPATH_LENMAX:255,SUBSCRIBE_TCC:!0,PING_PONG_TIME_OUT:10,DUALSTREAM_OPERATION_CHECK:!0,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,MEDIA_ELEMENT_EXISTS_DEPTH:3,CANDIDATE_TIMEOUT:5e3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,SHOW_REPORT_INVOKER_LOG:!1,STATS_FILTER:{transportId:!0,googTrackId:!0},JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,ENUMERATE_DEVICES_INTERVAL:!0};Pp||(te.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],te.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],te.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],te.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],te.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],te.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],te.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",te.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",te.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",te.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",te.AREAS=["NORTH_AMERICA","OVERSEA"]);let LR=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],qo=[],Es=[];var xp=[],YE=xp.sort,PR=ur(function(){xp.sort(void 0)}),xR=ur(function(){xp.sort(null)}),QR=na("sort");je({target:"Array",proto:!0,forced:PR||!xR||QR},{sort:function(i){return i===void 0?YE.call(Li(this)):YE.call(Li(this),Zi(i))}});var UR=hr("Array").sort,qE=Array.prototype,ul=function(i){var n=i.sort;return i===qE||i instanceof Array&&n===qE.sort?UR:n};je({target:"Array",stat:!0},{isArray:Xs});var D,ro=Ft.Array.isArray;(function(i){i.UNEXPECTED_ERROR="UNEXPECTED_ERROR",i.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",i.TIMEOUT="TIMEOUT",i.INVALID_PARAMS="INVALID_PARAMS",i.NOT_READABLE="NOT_READABLE",i.NOT_SUPPORTED="NOT_SUPPORTED",i.INVALID_OPERATION="INVALID_OPERATION",i.OPERATION_ABORTED="OPERATION_ABORTED",i.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",i.NETWORK_ERROR="NETWORK_ERROR",i.NETWORK_TIMEOUT="NETWORK_TIMEOUT",i.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",i.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",i.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",i.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",i.ELECTRON_IS_NULL="ELECTRON_IS_NULL",i.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",i.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",i.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",i.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",i.PERMISSION_DENIED="PERMISSION_DENIED",i.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",i.TRACK_IS_DISABLED="TRACK_IS_DISABLED",i.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",i.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",i.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",i.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",i.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",i.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",i.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",i.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",i.UID_CONFLICT="UID_CONFLICT",i.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",i.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",i.INVALID_TRACK="INVALID_TRACK",i.SENDER_NOT_FOUND="SENDER_NOT_FOUND",i.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",i.SET_ANSWER_FAILED="SET_ANSWER_FAILED",i.ICE_FAILED="ICE_FAILED",i.PC_CLOSED="PC_CLOSED",i.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",i.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",i.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",i.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",i.CAN_NOT_PUBLISH_MULTIPLE_AUDIO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_AUDIO_TRACKS",i.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",i.INVALID_REMOTE_USER="INVALID_REMOTE_USER",i.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",i.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",i.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",i.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",i.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",i.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",i.WS_ABORT="WS_ABORT",i.WS_DISCONNECT="WS_DISCONNECT",i.WS_ERR="WS_ERR",i.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",i.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",i.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",i.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",i.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",i.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",i.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",i.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",i.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",i.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",i.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",i.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",i.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",i.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",i.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",i.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",i.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",i.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",i.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",i.INVALID_PLUGIN="INVALID_PLUGIN"})(D||(D={}));var FR=[].slice,VR=/MSIE .\./.test(el),JE=function(i){return function(n,s){var c=2<arguments.length,u=c?FR.call(arguments,2):void 0;return i(c?function(){(typeof n=="function"?n:Function(n)).apply(this,u)}:n,s)}};je({global:!0,bind:!0,forced:VR},{setTimeout:JE(He.setTimeout),setInterval:JE(He.setInterval)});var gi=Ft.setTimeout;je({target:"Date",stat:!0},{now:function(){return new Date().getTime()}});var le=Ft.Date.now,zE=function(i,n){return function(){for(var s=Array(arguments.length),c=0;c<s.length;c++)s[c]=arguments[c];return i.apply(n,s)}},rc=Object.prototype.toString,We={isArray:qe,isArrayBuffer:function(i){return rc.call(i)==="[object ArrayBuffer]"},isBuffer:function(i){return i!=null&&i.constructor!=null&&typeof i.constructor.isBuffer=="function"&&i.constructor.isBuffer(i)},isFormData:function(i){return typeof FormData!="undefined"&&i instanceof FormData},isArrayBufferView:function(i){return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?ArrayBuffer.isView(i):i&&i.buffer&&i.buffer instanceof ArrayBuffer},isString:function(i){return typeof i=="string"},isNumber:function(i){return typeof i=="number"},isObject:Lt,isUndefined:function(i){return i===void 0},isDate:function(i){return rc.call(i)==="[object Date]"},isFile:function(i){return rc.call(i)==="[object File]"},isBlob:function(i){return rc.call(i)==="[object Blob]"},isFunction:_t,isStream:function(i){return Lt(i)&&_t(i.pipe)},isURLSearchParams:function(i){return typeof URLSearchParams!="undefined"&&i instanceof URLSearchParams},isStandardBrowserEnv:function(){return(typeof navigator=="undefined"||navigator.product!=="ReactNative"&&navigator.product!=="NativeScript"&&navigator.product!=="NS")&&typeof window!="undefined"&&typeof document!="undefined"},forEach:kr,merge:function i(){function n(h,f){typeof s[f]=="object"&&typeof h=="object"?s[f]=i(s[f],h):s[f]=h}for(var s={},c=0,u=arguments.length;c<u;c++)kr(arguments[c],n);return s},deepMerge:function i(){function n(h,f){typeof s[f]=="object"&&typeof h=="object"?s[f]=i(s[f],h):s[f]=typeof h=="object"?i({},h):h}for(var s={},c=0,u=arguments.length;c<u;c++)kr(arguments[c],n);return s},extend:function(i,n,s){return kr(n,function(c,u){i[u]=s&&typeof c=="function"?zE(c,s):c}),i},trim:function(i){return i.replace(/^\s*/,"").replace(/\s*$/,"")}},XE=function(i,n,s){if(!n)return i;if(s)n=s(n);else if(We.isURLSearchParams(n))n=n.toString();else{var c=[];We.forEach(n,function(u,h){u!=null&&(We.isArray(u)?h+="[]":u=[u],We.forEach(u,function(f){We.isDate(f)?f=f.toISOString():We.isObject(f)&&(f=JSON.stringify(f)),c.push(Qn(h)+"="+Qn(f))}))}),n=c.join("&")}return n&&(s=i.indexOf("#"),s!==-1&&(i=i.slice(0,s)),i+=(i.indexOf("?")===-1?"?":"&")+n),i};Xi.prototype.use=function(i,n){return this.handlers.push({fulfilled:i,rejected:n}),this.handlers.length-1},Xi.prototype.eject=function(i){this.handlers[i]&&(this.handlers[i]=null)},Xi.prototype.forEach=function(i){We.forEach(this.handlers,function(n){n!==null&&i(n)})};var $E=Xi,Qp=function(i,n,s){return We.forEach(s,function(c){i=c(i,n)}),i},ZE=function(i){return!(!i||!i.__CANCEL__)},e1=function(i,n){We.forEach(i,function(s,c){c!==n&&c.toUpperCase()===n.toUpperCase()&&(i[n]=s,delete i[c])})},td=function(i,n,s,c,u){return function(h,f,A,m,I){return h.config=f,A&&(h.code=A),h.request=m,h.response=I,h.isAxiosError=!0,h.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},h}(Error(i),n,s,c,u)},GR="age authorization content-length content-type etag expires from host if-modified-since if-unmodified-since last-modified location max-forwards proxy-authorization referer retry-after user-agent".split(" "),jR=We.isStandardBrowserEnv()?function(){function i(u){return s&&(c.setAttribute("href",u),u=c.href),c.setAttribute("href",u),{href:c.href,protocol:c.protocol?c.protocol.replace(/:$/,""):"",host:c.host,search:c.search?c.search.replace(/^\?/,""):"",hash:c.hash?c.hash.replace(/^#/,""):"",hostname:c.hostname,port:c.port,pathname:c.pathname.charAt(0)==="/"?c.pathname:"/"+c.pathname}}var n,s=/(msie|trident)/i.test(navigator.userAgent),c=document.createElement("a");return n=i(window.location.href),function(u){return u=We.isString(u)?i(u):u,u.protocol===n.protocol&&u.host===n.host}}():function(){return!0},HR=We.isStandardBrowserEnv()?{write:function(i,n,s,c,u,h){var f=[];f.push(i+"="+encodeURIComponent(n)),We.isNumber(s)&&f.push("expires="+new Date(s).toGMTString()),We.isString(c)&&f.push("path="+c),We.isString(u)&&f.push("domain="+u),h===!0&&f.push("secure"),document.cookie=f.join("; ")},read:function(i){return(i=document.cookie.match(new RegExp("(^|;\\s*)("+i+")=([^;]*)")))?decodeURIComponent(i[3]):null},remove:function(i){this.write(i,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},KR=function(i){return new Promise(function(n,s){var c=i.data,u=i.headers;We.isFormData(c)&&delete u["Content-Type"];var h=new XMLHttpRequest;if(i.auth&&(u.Authorization="Basic "+btoa((i.auth.username||"")+":"+(i.auth.password||""))),h.open(i.method.toUpperCase(),XE(i.url,i.params,i.paramsSerializer),!0),h.timeout=i.timeout,h.onreadystatechange=function(){if(h&&h.readyState===4&&(h.status!==0||h.responseURL&&h.responseURL.indexOf("file:")===0)){var A,m,I,E,_,S="getAllResponseHeaders"in h?(A=h.getAllResponseHeaders(),_={},A&&We.forEach(A.split(`
`),function(N){E=N.indexOf(":"),m=We.trim(N.substr(0,E)).toLowerCase(),I=We.trim(N.substr(E+1)),!m||_[m]&&0<=GR.indexOf(m)||(_[m]=m==="set-cookie"?(_[m]?_[m]:[]).concat([I]):_[m]?_[m]+", "+I:I)}),_):null;(function(N,O,B){var P=B.config.validateStatus;!P||P(B.status)?N(B):O(td("Request failed with status code "+B.status,B.config,null,B.request,B))})(n,s,{data:i.responseType&&i.responseType!=="text"?h.response:h.responseText,status:h.status,statusText:h.statusText,headers:S,config:i,request:h}),h=null}},h.onabort=function(){h&&(s(td("Request aborted",i,"ECONNABORTED",h)),h=null)},h.onerror=function(){s(td("Network Error",i,null,h)),h=null},h.ontimeout=function(){s(td("timeout of "+i.timeout+"ms exceeded",i,"ECONNABORTED",h)),h=null},We.isStandardBrowserEnv()){var f=(i.withCredentials||jR(i.url))&&i.xsrfCookieName?HR.read(i.xsrfCookieName):void 0;f&&(u[i.xsrfHeaderName]=f)}if("setRequestHeader"in h&&We.forEach(u,function(A,m){c===void 0&&m.toLowerCase()==="content-type"?delete u[m]:h.setRequestHeader(m,A)}),i.withCredentials&&(h.withCredentials=!0),i.responseType)try{h.responseType=i.responseType}catch(A){if(i.responseType!=="json")throw A}typeof i.onDownloadProgress=="function"&&h.addEventListener("progress",i.onDownloadProgress),typeof i.onUploadProgress=="function"&&h.upload&&h.upload.addEventListener("progress",i.onUploadProgress),i.cancelToken&&i.cancelToken.promise.then(function(A){h&&(h.abort(),s(A),h=null)}),c===void 0&&(c=null),h.send(c)})},WR={"Content-Type":"application/x-www-form-urlencoded"},rd={adapter:function(){var i;return(typeof process!="undefined"&&Object.prototype.toString.call(process)==="[object process]"||typeof XMLHttpRequest!="undefined")&&(i=KR),i}(),transformRequest:[function(i,n){return e1(n,"Accept"),e1(n,"Content-Type"),We.isFormData(i)||We.isArrayBuffer(i)||We.isBuffer(i)||We.isStream(i)||We.isFile(i)||We.isBlob(i)?i:We.isArrayBufferView(i)?i.buffer:We.isURLSearchParams(i)?(Hc(n,"application/x-www-form-urlencoded;charset=utf-8"),i.toString()):We.isObject(i)?(Hc(n,"application/json;charset=utf-8"),JSON.stringify(i)):i}],transformResponse:[function(i){if(typeof i=="string")try{i=JSON.parse(i)}catch{}return i}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(i){return 200<=i&&300>i},headers:{common:{Accept:"application/json, text/plain, */*"}}};We.forEach(["delete","get","head"],function(i){rd.headers[i]={}}),We.forEach(["post","put","patch"],function(i){rd.headers[i]=We.merge(WR)});var YR=function(i){var n,s;return i.cancelToken&&i.cancelToken.throwIfRequested(),i.baseURL&&!/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(i.url)&&(i.url=(n=i.baseURL,(s=i.url)?n.replace(/\/+$/,"")+"/"+s.replace(/^\/+/,""):n)),i.headers=i.headers||{},i.data=Qp(i.data,i.headers,i.transformRequest),i.headers=We.merge(i.headers.common||{},i.headers[i.method]||{},i.headers||{}),We.forEach("delete get head post put patch common".split(" "),function(c){delete i.headers[c]}),(i.adapter||rd.adapter)(i).then(function(c){return i.cancelToken&&i.cancelToken.throwIfRequested(),c.data=Qp(c.data,c.headers,i.transformResponse),c},function(c){return ZE(c)||(i.cancelToken&&i.cancelToken.throwIfRequested(),c&&c.response&&(c.response.data=Qp(c.response.data,c.response.headers,i.transformResponse))),Promise.reject(c)})},Up=function(i,n){n=n||{};var s={};return We.forEach(["url","method","params","data"],function(c){n[c]!==void 0&&(s[c]=n[c])}),We.forEach(["headers","auth","proxy"],function(c){We.isObject(n[c])?s[c]=We.deepMerge(i[c],n[c]):n[c]!==void 0?s[c]=n[c]:We.isObject(i[c])?s[c]=We.deepMerge(i[c]):i[c]!==void 0&&(s[c]=i[c])}),We.forEach("baseURL transformRequest transformResponse paramsSerializer timeout withCredentials adapter responseType xsrfCookieName xsrfHeaderName onUploadProgress onDownloadProgress maxContentLength validateStatus maxRedirects httpAgent httpsAgent cancelToken socketPath".split(" "),function(c){n[c]!==void 0?s[c]=n[c]:i[c]!==void 0&&(s[c]=i[c])}),s};hi.prototype.request=function(i,n){typeof i=="string"?(i=n||{}).url=i:i=i||{},(i=Up(this.defaults,i)).method=i.method?i.method.toLowerCase():"get";var s=[YR,void 0];for(i=Promise.resolve(i),this.interceptors.request.forEach(function(c){s.unshift(c.fulfilled,c.rejected)}),this.interceptors.response.forEach(function(c){s.push(c.fulfilled,c.rejected)});s.length;)i=i.then(s.shift(),s.shift());return i},hi.prototype.getUri=function(i){return i=Up(this.defaults,i),XE(i.url,i.params,i.paramsSerializer).replace(/^\?/,"")},We.forEach(["delete","get","head","options"],function(i){hi.prototype[i]=function(n,s){return this.request(We.merge(s||{},{method:i,url:n}))}}),We.forEach(["post","put","patch"],function(i){hi.prototype[i]=function(n,s,c){return this.request(We.merge(c||{},{method:i,url:n,data:s}))}});var nd=hi;Ys.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},Ys.prototype.__CANCEL__=!0;var t1=Ys;Go.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},Go.source=function(){var i;return{token:new Go(function(n){i=n}),cancel:i}};var So=jo(rd);So.Axios=nd,So.create=function(i){return jo(Up(So.defaults,i))},So.Cancel=t1,So.CancelToken=Go,So.isCancel=ZE,So.all=function(i){return Promise.all(i)},So.spread=function(i){return function(n){return i.apply(null,n)}};var To=So.default=So;let Pi={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},r1=le(),n1=i=>{for(const n in Pi)if(Object.prototype.hasOwnProperty.call(Pi,n)&&Pi[n]===i)return n;return"DEFAULT"},R=new class{constructor(){this.logLevel=Pi.DEBUG,this.uploadState="collecting",this.uploadLogWaitingList=[],this.uploadLogUploadingList=[],this.currentLogID=this.uploadErrorCount=0}debug(...i){var n;i=b(n=[Pi.DEBUG]).call(n,i),this.log.apply(this,i)}info(...i){var n;i=b(n=[Pi.INFO]).call(n,i),this.log.apply(this,i)}warning(...i){var n;i=b(n=[Pi.WARNING]).call(n,i),this.log.apply(this,i)}error(...i){var n;i=b(n=[Pi.ERROR]).call(n,i),this.log.apply(this,i)}setLogLevel(i){this.logLevel=i=Math.min(Math.max(0,i),4)}enableLogUpload(){Yr("UPLOAD_LOG",!0)}disableLogUpload(){Yr("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(i){this.proxyServerURL=i}log(...i){var n,s,c,u;if(100>le()-r1)return void gi(()=>{this.log(...i)},le()-r1);const h=Math.max(0,Math.min(4,i[0]));if(i[0]=Su()+" Agora-SDK [".concat(n1(h),"]:"),this.appendLogToWaitingList(h,i),!(h<this.logLevel)){var f=Su()+" %cAgora-SDK [".concat(n1(h),"]:"),A=[];switch(h){case Pi.DEBUG:A=b(n=[f,"color: #64B5F6;"]).call(n,Gr(i).call(i,1)),console.log.apply(console,A);break;case Pi.INFO:A=b(s=[f,"color: #1E88E5; font-weight: bold;"]).call(s,Gr(i).call(i,1)),console.log.apply(console,A);break;case Pi.WARNING:A=b(c=[f,"color: #FB8C00; font-weight: bold;"]).call(c,Gr(i).call(i,1)),console.warn.apply(console,A);break;case Pi.ERROR:A=b(u=[f,"color: #B00020; font-weight: bold;"]).call(u,Gr(i).call(i,1)),console.error.apply(console,A)}}}appendLogToWaitingList(i,...n){if(te.UPLOAD_LOG){var s="";K(n).call(n,c=>{typeof c=="object"&&(c=fe(c)),s+="".concat(c," ")}),this.uploadLogWaitingList.push({payload_str:s,log_level:i,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){var i,n={sdk_version:ei,process_id:te.PROCESS_ID,payload:fe(this.uploadLogUploadingList)};if(n=await To.post(this.url||(this.proxyServerURL?b(i="https://".concat(this.proxyServerURL,"/ls/?h=")).call(i,te.LOG_UPLOAD_SERVER,"&p=443&d=upload/v1"):"https://".concat(te.LOG_UPLOAD_SERVER,"/upload/v1")),n,{responseType:"text"}),n.data!=="OK")throw Error("unexpected upload log response: "+n.data);this.uploadLogUploadingList=[]}uploadLogInterval(){if(this.uploadLogUploadingList.length!==0||this.uploadLogWaitingList.length!==0){var i;this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=Jr(i=this.uploadLogWaitingList).call(i,0,10)),this.uploadLogs().then(()=>{this.uploadErrorCount=0,0<this.uploadLogWaitingList.length&&window.setTimeout(()=>this.uploadLogInterval(),3e3)}).catch(n=>{this.uploadErrorCount+=1,2>this.uploadErrorCount?window.setTimeout(()=>this.uploadLogInterval(),200):window.setTimeout(()=>this.uploadLogInterval(),1e3)})}}};class L{constructor(n,s="",c){var u;this.name="AgoraRTCException",this.code=n,this.message=b(u="AgoraRTCError ".concat(this.code,": ")).call(u,s),this.data=c}toString(){var n;return this.data?b(n="".concat(this.message," data: ")).call(n,fe(this.data)):this.message}print(n="error"){return n==="error"&&R.error(this.toString()),n==="warning"&&R.warning(this.toString()),this}throw(){throw this.print(),this}}var i1,Hr;(function(i){i.FREE="free",i.UPLOADING="uploading"})(i1||(i1={})),function(i){i.NONE="none",i.INIT="init",i.CANPLAY="canplay",i.PLAYING="playing",i.PAUSED="paused",i.SUSPEND="suspend",i.STALLED="stalled",i.WAITING="waiting",i.ERROR="error",i.DESTROYED="destroyed",i.ABORT="abort",i.ENDED="ended",i.EMPTIED="emptied"}(Hr||(Hr={})),je({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991}),je({target:"Number",stat:!0},{MIN_SAFE_INTEGER:-9007199254740991});let qR={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};var zr,Zt,o1,Re,Te,sa,Jo,nc,dl,ti,Xr,Oe,ze,Fn,Cr,Ze,kt,xi,Et,ke,Qi;(function(i){i.PUBLISH="publish",i.SUBSCRIBE="subscribe",i.SESSION_INIT="session_init",i.JOIN_CHOOSE_SERVER="join_choose_server",i.REQ_USER_ACCOUNT="req_user_account",i.JOIN_GATEWAY="join_gateway",i.STREAM_SWITCH="stream_switch",i.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",i.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",i.FIRST_VIDEO_RECEIVED="first_video_received",i.FIRST_AUDIO_RECEIVED="first_audio_received",i.FIRST_VIDEO_DECODE="first_video_decode",i.FIRST_AUDIO_DECODE="first_audio_decode",i.ON_ADD_AUDIO_STREAM="on_add_audio_stream",i.ON_ADD_VIDEO_STREAM="on_add_video_stream",i.ON_UPDATE_STREAM="on_update_stream",i.ON_REMOVE_STREAM="on_remove_stream",i.USER_ANALYTICS="req_user_analytics"})(zr||(zr={})),function(i){i.SESSION="io.agora.pb.Wrtc.Session",i.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",i.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",i.JOIN_GATEWAT="io.agora.pb.Wrtc.JoinGateway",i.PUBLISH="io.agora.pb.Wrtc.Publish",i.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",i.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",i.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",i.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",i.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",i.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",i.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",i.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",i.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",i.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",i.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",i.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",i.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",i.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",i.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",i.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",i.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",i.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",i.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",i.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",i.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",i.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics"}(Zt||(Zt={})),function(i){i[i.WORKER_EVENT=156]="WORKER_EVENT",i[i.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}(o1||(o1={})),function(i){i.CREATE_CLIENT="createClient",i.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",i.SET_AREA="setArea",i.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",i.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",i.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",i.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",i.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",i.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",i.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",i.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",i.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",i.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",i.START_PROXY_SERVER="Client.startProxyServer",i.STOP_PROXY_SERVER="Client.stopProxyServer",i.SET_PROXY_SERVER="Client.setProxyServer",i.SET_TURN_SERVER="Client.setTurnServer",i.SET_CLIENT_ROLE="Client.setClientRole",i.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",i.ENABLE_DUAL_STREAM="Client.enableDualStream",i.DISABLE_DUAL_STREAM="Client.disableDualStream",i.JOIN="Client.join",i.LEAVE="Client.leave",i.PUBLISH="Client.publish",i.UNPUBLISH="Client.unpublish",i.SUBSCRIBE="Client.subscribe",i.UNSUBSCRIBE="Client.unsubscribe",i.RENEW_TOKEN="Client.renewToken",i.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",i.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",i.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",i.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",i.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",i.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",i.START_LIVE_STREAMING="Client.startLiveStreaming",i.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",i.STOP_LIVE_STREAMING="Client.stopLiveStreaming",i.ADD_INJECT_STREAM_URL="Client.addInjectStreamUrl",i.REMOVE_INJECT_STREAM_URL="Client.removeInjectStreamUrl",i.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",i.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",i.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",i.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",i.SET_CONFIG_DISTRIBUTE="_configDistribute",i.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",i.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",i.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",i.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",i.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",i.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",i.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",i.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",i.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",i.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",i.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",i.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",i.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",i.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",i.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",i.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",i.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",i.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",i.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",i.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",i.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",i.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",i.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",i.STREAM_TYPE_CHANGE="streamTypeChange"}(Re||(Re={})),(Te||(Te={})).TRACER="tracer",function(i){i.IDLE="IDLE",i.INITING="INITING",i.INITEND="INITEND"}(sa||(sa={})),function(i){i.STATE_CHANGE="state_change",i.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",i.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",i.CAMERA_DEVICE_CHANGED="cameraDeviceChanged"}(Jo||(Jo={})),function(i){i[i.ACCESS_POINT=101]="ACCESS_POINT",i[i.UNILBS=201]="UNILBS",i[i.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR"}(nc||(nc={})),function(i){i[i.IIIEGAL_APPID=1]="IIIEGAL_APPID",i[i.IIIEGAL_UID=2]="IIIEGAL_UID",i[i.INTERNAL_ERROR=3]="INTERNAL_ERROR"}(dl||(dl={})),function(i){i[i.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",i[i.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",i[i.INTERNAL_ERROR=8]="INTERNAL_ERROR",i[i.NO_AUTHORIZED=9]="NO_AUTHORIZED",i[i.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",i[i.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",i[i.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",i[i.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",i[i.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",i[i.USER_OVERLOAD=16]="USER_OVERLOAD",i[i.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",i[i.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND"}(ti||(ti={})),function(i){i[i.NO_FLAG_SET=100]="NO_FLAG_SET",i[i.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",i[i.INVALID_FALG_SET=102]="INVALID_FALG_SET",i[i.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",i[i.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",i[i.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",i[i.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",i[i.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",i[i.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",i[i.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",i[i.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",i[i.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",i[i.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",i[i.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",i[i.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",i[i.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",i[i.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV"}(Xr||(Xr={})),function(i){i[i.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",i[i.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",i[i.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",i[i.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",i[i.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",i[i.K_TICKET_INVALID=7]="K_TICKET_INVALID",i[i.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",i[i.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",i[i.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",i[i.K_UID_BANNED=14]="K_UID_BANNED",i[i.K_IP_BANNED=15]="K_IP_BANNED",i[i.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",i[i.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",i[i.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",i[i.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",i[i.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",i[i.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",i[i.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",i[i.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",i[i.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",i[i.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",i[i.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",i[i.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",i[i.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",i[i.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",i[i.ERR_INVALID_UID=117]="ERR_INVALID_UID",i[i.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",i[i.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",i[i.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",i[i.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",i[i.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",i[i.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",i[i.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",i[i.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",i[i.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",i[i.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",i[i.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",i[i.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",i[i.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",i[i.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",i[i.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",i[i.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",i[i.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",i[i.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",i[i.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",i[i.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",i[i.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",i[i.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",i[i.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",i[i.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",i[i.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",i[i.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",i[i.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",i[i.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",i[i.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY"}(Oe||(Oe={})),function(i){i.CONNECTION_STATE_CHANGE="connection-state-change",i.MEDIA_RECONNECT_START="media-reconnect-start",i.MEDIA_RECONNECT_END="media-reconnect-end",i.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",i.USER_JOINED="user-joined",i.USER_LEAVED="user-left",i.USER_PUBLISHED="user-published",i.USER_UNPUBLISHED="user-unpublished",i.USER_INFO_UPDATED="user-info-updated",i.CLIENT_BANNED="client-banned",i.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",i.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",i.VOLUME_INDICATOR="volume-indicator",i.CRYPT_ERROR="crypt-error",i.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",i.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",i.NETWORK_QUALITY="network-quality",i.STREAM_TYPE_CHANGED="stream-type-changed",i.STREAM_FALLBACK="stream-fallback",i.RECEIVE_METADATA="receive-metadata",i.STREAM_MESSAGE="stream-message",i.LIVE_STREAMING_ERROR="live-streaming-error",i.LIVE_STREAMING_WARNING="live-streaming-warning",i.INJECT_STREAM_STATUS="stream-inject-status",i.EXCEPTION="exception",i.ERROR="error",i.P2P_LOST="p2p_lost"}(ze||(ze={})),function(i){i.NETWORK_ERROR="NETWORK_ERROR",i.SERVER_ERROR="SERVER_ERROR",i.MULTI_IP="MULTI_IP",i.TIMEOUT="TIMEOUT",i.OFFLINE="OFFLINE",i.LEAVE="LEAVE"}(Fn||(Fn={})),function(i){i.CONNECTING="connecting",i.CONNECTED="connected",i.RECONNECTING="reconnecting",i.CLOSED="closed"}(Cr||(Cr={})),function(i){i.WS_CONNECTED="ws_connected",i.WS_RECONNECTING="ws_reconnecting",i.WS_CLOSED="ws_closed",i.ON_BINARY_DATA="on_binary_data",i.REQUEST_RECOVER="request_recover",i.REQUEST_JOIN_INFO="request_join_info",i.REQUEST_REJOIN_INFO="req_rejoin_info",i.IS_P2P_DISCONNECTED="is_p2p_dis",i.DISCONNECT_P2P="dis_p2p",i.NEED_RENEW_SESSION="need-sid",i.REPORT_JOIN_GATEWAY="report_join_gateway",i.REQUEST_TIMEOUT="request_timeout",i.REQUEST_SUCCESS="request_success"}(Ze||(Ze={})),function(i){i.PING="ping",i.PING_BACK="ping_back",i.JOIN="join_v2",i.REJOIN="rejoin",i.LEAVE="leave",i.SET_CLIENT_ROLE="set_client_role",i.PUBLISH="publish",i.UNPUBLISH="unpublish",i.SUBSCRIBE="subscribe",i.UNSUBSCRIBE="unsubscribe",i.SUBSCRIBE_CHANGE="subscribe_change",i.TRAFFIC_STATS="traffic_stats",i.RENEW_TOKEN="renew_token",i.SWITCH_VIDEO_STREAM="switch_video_stream",i.SET_FALLBACK_OPTION="set_fallback_option",i.GATEWAY_INFO="gateway_info",i.CONTROL="control",i.SEND_METADATA="send_metadata",i.DATA_STREAM="data_stream",i.PICK_SVC_LAYER="pick_svc_layer"}(kt||(kt={})),function(i){i.PUBLISH_STATS="publish_stats",i.PUBLISH_RELATED_STATS="publish_related_stats",i.SUBSCRIBE_STATS="subscribe_stats",i.SUBSCRIBE_RELATED_STATS="subscribe_related_stats",i.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length"}(xi||(xi={})),function(i){i.ON_USER_ONLINE="on_user_online",i.ON_USER_OFFLINE="on_user_offline",i.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",i.ON_PUBLISH_STREAM="on_publish_stream",i.ON_UPLINK_STATS="on_uplink_stats",i.ON_P2P_LOST="on_p2p_lost",i.ON_REMOVE_STREAM="on_remove_stream",i.ON_ADD_AUDIO_STREAM="on_add_audio_stream",i.ON_ADD_VIDEO_STREAM="on_add_video_stream",i.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",i.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",i.ON_USER_BANNED="on_user_banned",i.ON_NOTIFICATION="on_notification",i.ON_CRYPT_ERROR="on_crypt_error",i.MUTE_AUDIO="mute_audio",i.MUTE_VIDEO="mute_video",i.UNMUTE_AUDIO="unmute_audio",i.UNMUTE_VIDEO="unmute_video",i.RECEIVE_METADATA="receive_metadata",i.ON_DATA_STREAM="on_data_stream",i.ENABLE_LOCAL_VIDEO="enable_local_video",i.DISABLE_LOCAL_VIDEO="disable_local_video",i.ENABLE_LOCAL_AUDIO="enable_local_audio",i.DISABLE_LOCAL_AUDIO="disable_local_audio"}(Et||(Et={})),function(i){i.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",i.NEED_ANSWER="NEED_ANSWER",i.NEED_RENEGOTIATE="NEED_RENEGOTIATE",i.P2P_LOST="P2P_LOST",i.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",i.NEED_UNPUB="NEED_UNPUB",i.NEED_UNSUB="NEED_UNSUB",i.NEED_UPLOAD="NEED_UPLOAD",i.NEED_CONTROL="NEED_CONTROL",i.START_RECONNECT="START_RECONNECT",i.END_RECONNECT="END_RECONNECT",i.NEED_SIGNAL_RTT="NEED_SIGNAL_RTT"}(ke||(ke={})),function(i){i.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",i.RECEIVE_TRACK_BUFFER="receive_track_buffer",i.ON_AUDIO_BUFFER="on_audio_buffer"}(Qi||(Qi={}));let id={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,currentPacketLossRate:0},od={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},Fp={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},s1={uplinkNetworkQuality:0,downlinkNetworkQuality:0},Vp={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};var dt,nr;(function(i){i.CONNECTED="websocket:connected",i.RECONNECTING="websocket:reconnecting",i.WILL_RECONNECT="websocket:will_reconnect",i.CLOSED="websocket:closed",i.FAILED="websocket:failed",i.ON_MESSAGE="websocket:on_message",i.REQUEST_NEW_URLS="websocket:request_new_urls"})(dt||(dt={})),function(i){i.TRANSCODE="mix_streaming",i.RAW="raw_streaming",i.INJECT="inject_streaming"}(nr||(nr={}));let JR={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},Gp={x:0,y:0,width:160,height:160,zOrder:255,alpha:1},zR={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},XR={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};var Ui,ic,Ht,a1,$r,Dr,Be,no,aa,hl;(function(i){i.WARNING="@live_uap-warning",i.ERROR="@line_uap-error",i.PUBLISH_STREAM_STATUS="@live_uap-publish-status",i.INJECT_STREAM_STATUS="@live_uap-inject-status",i.WORKER_STATUS="@live_uap-worker-status",i.REQUEST_NEW_ADDRESS="@live_uap-request-address"})(Ui||(Ui={})),(ic||(ic={})).REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",function(i){i[i.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",i[i.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",i[i.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",i[i.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",i[i.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",i[i.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",i[i.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",i[i.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",i[i.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",i[i.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",i[i.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",i[i.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",i[i.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",i[i.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",i[i.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",i[i.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",i[i.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",i[i.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",i[i.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",i[i.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",i[i.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(Ht||(Ht={})),function(i){i.CONNECT_FAILED="connect failed",i.CONNECT_TIMEOUT="connect timeout",i.WS_DISCONNECTED="websocket disconnected",i.REQUEST_TIMEOUT="request timeout",i.REQUEST_FAILED="request failed",i.WAIT_STATUS_TIMEOUT="wait status timeout",i.WAIT_STATUS_ERROR="wait status error",i.BAD_STATE="bad state",i.WS_ABORT="ws abort",i.AP_REQUEST_TIMEOUT="AP request timeout",i.AP_JSON_PARSE_ERROR="AP json parse error",i.AP_REQUEST_ERROR="AP request error",i.AP_REQUEST_ABORT="AP request abort"}(a1||(a1={})),function(i){i[i.SetSdkProfile=0]="SetSdkProfile",i[i.SetSourceChannel=1]="SetSourceChannel",i[i.SetSourceUserId=2]="SetSourceUserId",i[i.SetDestChannel=3]="SetDestChannel",i[i.StartPacketTransfer=4]="StartPacketTransfer",i[i.StopPacketTransfer=5]="StopPacketTransfer",i[i.UpdateDestChannel=6]="UpdateDestChannel",i[i.Reconnect=7]="Reconnect",i[i.SetVideoProfile=8]="SetVideoProfile"}($r||($r={})),function(i){i.DISCONNECT="disconnect",i.CONNECTION_STATE_CHANGE="connection-state-change",i.NETWORK_QUALITY="network-quality",i.STREAM_TYPE_CHANGE="stream-type-change",i.IS_P2P_DISCONNECTED="is-p2p-dis",i.DISCONNECT_P2P="dis-p2p",i.REQUEST_NEW_GATEWAY_LIST="req-gate-url",i.NEED_RENEW_SESSION="need-sid"}(Dr||(Dr={})),function(i){i.NEED_RENEGOTIATE="@need_renegotiate",i.NEED_REPLACE_TRACK="@need_replace_track",i.NEED_CLOSE="@need_close",i.NEED_ADD_TRACK="@need_add_track",i.NEED_REMOVE_TRACK="@need_remove_track",i.NEED_SESSION_ID="@need_sid",i.SET_OPTIMIZATION_MODE="@set_optimization_mode",i.GET_STATS="@get_stats",i.GET_LOW_VIDEO_TRACK="@get_low_video_track",i.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",i.SET_VIDEO_TRACK_MUTED="@set_video_track_muted",i.SET_AUDIO_TRACK_MUTED="@set_audio_track_muted"}(Be||(Be={})),function(i){i.SCREEN_TRACK="screen_track",i.LOW_STREAM="low_stream"}(no||(no={})),function(i){i.SOURCE_STATE_CHANGE="source-state-change",i.TRACK_ENDED="track-ended",i.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload"}(aa||(aa={})),(hl||(hl={})).FIRST_FRAME_DECODED="first-frame-decoded";let c1="AFRICA ASIA CHINA EUROPE GLOBAL INDIA JAPAN NORTH_AMERICA OCEANIA OVERSEA SOUTH_AMERICA".split(" ");var Br;(function(i){i.CHINA="CN",i.ASIA="AS",i.NORTH_AMERICA="NA",i.EUROPE="EU",i.JAPAN="JP",i.INDIA="IN",i.OCEANIA="OC",i.SOUTH_AMERICA="SA",i.AFRICA="AF",i.OVERSEA="OVERSEA",i.GLOBAL="GLOBAL"})(Br||(Br={}));let jp={CHINA:{},ASIA:{CODE:Br.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Br.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Br.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Br.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","	uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Br.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Br.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Br.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Br.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Br.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Br.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]}};var pl,Fi,oc;Pp&&(jp.CHINA={CODE:Br.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),(pl||(pl={})).UPDATE_BITRATE_LIMIT="update_bitrate_limit",function(i){i.ONLINE="ONLINE",i.OFFLINE="OFFLINE"}(Fi||(Fi={})),function(i){i.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",i.ONLINE="ONLINE",i.OFFLINE="OFFLINE"}(oc||(oc={}));let $R={join:["startJoin","startRequestAp","startJoinGateway","finishJoin"],publish:["startPublish"]},Pt={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1};je({target:"Object",stat:!0,forced:!jt,sham:!jt},{defineProperties:ap});var Tn=r(function(i){var n=Ft.Object;i=i.exports=function(s,c){return n.defineProperties(s,c)},n.defineProperties.sham&&(i.sham=!0)}),ZR=ju.concat("length","prototype"),Hp={f:Object.getOwnPropertyNames||function(i){return Sv(i,ZR)}},ew=to("Reflect","ownKeys")||function(i){var n=Hp.f(an(i)),s=nl.f;return s?n.concat(s(i)):n};je({target:"Object",stat:!0,sham:!jt},{getOwnPropertyDescriptors:function(i){var n,s;i=fi(i);for(var c=Ga,u=ew(i),h={},f=0;u.length>f;)(s=c(i,n=u[f++]))!==void 0&&$s(h,n,s);return h}});var xt=Ft.Object.getOwnPropertyDescriptors,l1=Hp.f,tw={}.toString,u1=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],d1=function(i){if(u1&&tw.call(i)=="[object Window]")try{var n=l1(i)}catch{n=u1.slice()}else n=l1(fi(i));return n},h1={f:dr},rw=Mi.f,ri=Vu("hidden"),p1=dr("toPrimitive"),nw=Sr.set,f1=Sr.getterFor("Symbol"),io=Object.prototype,mi=He.Symbol,fl=to("JSON","stringify"),A1=Ga,Is=Mi.f,g1=d1,iw=bu,zo=Ko("symbols"),Al=Ko("op-symbols"),Kp=Ko("string-to-symbol-registry"),Wp=Ko("symbol-to-string-registry"),ow=Ko("wks"),Yp=He.QObject,qp=!Yp||!Yp.prototype||!Yp.prototype.findChild,Jp=jt&&ur(function(){return vs(Is({},"a",{get:function(){return Is(this,"a",{value:7}).a}})).a!=7})?function(i,n,s){var c=A1(io,n);c&&delete io[n],Is(i,n,s),c&&i!==io&&Is(io,n,c)}:Is,m1=function(i,n){var s=zo[i]=vs(mi.prototype);return nw(s,{type:"Symbol",tag:i,description:n}),jt||(s.description=n),s},zp=_o&&typeof mi.iterator=="symbol"?function(i){return typeof i=="symbol"}:function(i){return Object(i)instanceof mi},sd=function(i,n,s){return i===io&&sd(Al,n,s),an(i),n=Fa(n,!0),an(s),nt(zo,n)?(s.enumerable?(nt(i,ri)&&i[ri][n]&&(i[ri][n]=!1),s=vs(s,{enumerable:Ho(0,!1)})):(nt(i,ri)||Is(i,ri,Ho(1,{})),i[ri][n]=!0),Jp(i,n,s)):Is(i,n,s)},v1=function(i,n){an(i);var s=fi(n);return n=ms(s).concat(Xp(s)),Ja(n,function(c){jt&&!E1.call(s,c)||sd(i,c,s[c])}),i},E1=function(i){i=Fa(i,!0);var n=iw.call(this,i);return!(this===io&&nt(zo,i)&&!nt(Al,i))&&(!(n||!nt(this,i)||!nt(zo,i)||nt(this,ri)&&this[ri][i])||n)},I1=function(i,n){if(i=fi(i),n=Fa(n,!0),i!==io||!nt(zo,n)||nt(Al,n)){var s=A1(i,n);return!s||!nt(zo,n)||nt(i,ri)&&i[ri][n]||(s.enumerable=!0),s}},C1=function(i){i=g1(fi(i));var n=[];return Ja(i,function(s){nt(zo,s)||nt(Ka,s)||n.push(s)}),n},Xp=function(i){var n=i===io;i=g1(n?Al:fi(i));var s=[];return Ja(i,function(c){!nt(zo,c)||n&&!nt(io,c)||s.push(zo[c])}),s};if(_o||(Yo((mi=function(){if(this instanceof mi)throw TypeError("Symbol is not a constructor");var i=arguments.length&&arguments[0]!==void 0?String(arguments[0]):void 0,n=Pu(i),s=function(c){this===io&&s.call(Al,c),nt(this,ri)&&nt(this[ri],n)&&(this[ri][n]=!1),Jp(this,n,Ho(1,c))};return jt&&qp&&Jp(io,n,{configurable:!0,set:s}),m1(n,i)}).prototype,"toString",function(){return f1(this).tag}),bu=E1,Mi.f=sd,Ga=I1,Hp.f=d1=C1,nl.f=Xp,jt&&Is(mi.prototype,"description",{configurable:!0,get:function(){return f1(this).description}})),sv||(h1.f=function(i){return m1(dr(i),i)}),je({global:!0,wrap:!0,forced:!_o,sham:!_o},{Symbol:mi}),Ja(ms(ow),function(i){var n=Ft.Symbol||(Ft.Symbol={});nt(n,i)||rw(n,i,{value:h1.f(i)})}),je({target:"Symbol",stat:!0,forced:!_o},{for:function(i){if(i=String(i),nt(Kp,i))return Kp[i];var n=mi(i);return Kp[i]=n,Wp[n]=i,n},keyFor:function(i){if(!zp(i))throw TypeError(i+" is not a symbol");if(nt(Wp,i))return Wp[i]},useSetter:function(){qp=!0},useSimple:function(){qp=!1}}),je({target:"Object",stat:!0,forced:!_o,sham:!jt},{create:function(i,n){return n===void 0?vs(i):v1(vs(i),n)},defineProperty:sd,defineProperties:v1,getOwnPropertyDescriptor:I1}),je({target:"Object",stat:!0,forced:!_o},{getOwnPropertyNames:C1,getOwnPropertySymbols:Xp}),je({target:"Object",stat:!0,forced:ur(function(){nl.f(1)})},{getOwnPropertySymbols:function(i){return nl.f(Li(i))}}),fl){var sw=!_o||ur(function(){var i=mi();return fl([i])!="[null]"||fl({a:i})!="{}"||fl(Object(i))!="{}"});je({target:"JSON",stat:!0,forced:sw},{stringify:function(i,n,s){for(var c,u=[i],h=1;arguments.length>h;)u.push(arguments[h++]);if(c=n,(qt(n)||i!==void 0)&&!zp(i))return Xs(n)||(n=function(f,A){if(typeof c=="function"&&(A=c.call(this,f,A)),!zp(A))return A}),u[1]=n,fl.apply(null,u)}})}mi.prototype[p1]||eo(mi.prototype,p1,mi.prototype.valueOf),Zs(mi,"Symbol"),Ka[ri]=!0;var Qt=Ft.Object.getOwnPropertySymbols,Rn,wn=function(i,n,s){return n in i?Wv(i,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[n]=s,i};(function(i){i[i.CHOOSE_SERVER=11]="CHOOSE_SERVER",i[i.CLOUD_PROXY=18]="CLOUD_PROXY",i[i.CLOUD_PROXY_5=20]="CLOUD_PROXY_5"})(Rn||(Rn={}));var aw=hr("Array").values,y1=Array.prototype,cw={DOMTokenList:!0,NodeList:!0},ca=function(i){var n=i.values;return i===y1||i instanceof Array&&n===y1.values||cw.hasOwnProperty(Wa(i))?aw:n},la=function(i){var n=Li(i),s=typeof this=="function"?this:Array,c=arguments.length,u=1<c?arguments[1]:void 0,h=u!==void 0,f=0,A=Fu(n);if(h&&(u=gs(u,2<c?arguments[2]:void 0,2)),A==null||s==Array&&hv(A))for(s=new s(c=Ai(n.length));c>f;f++)$s(s,f,h?u(n[f],f):n[f]);else for(c=(n=A.call(n)).next,s=new s;!(A=c.call(n)).done;f++)$s(s,f,h?fv(n,u,[A.value,f],!0):A.value);return s.length=f,s},lw=!nE(function(i){Array.from(i)});je({target:"Array",stat:!0,forced:lw},{from:la});var oo=Ft.Array.from;class Zr{constructor(){this._events={},this.addListener=this.on}getListeners(n){var s;return this._events[n]?Ie(s=this._events[n]).call(s,c=>c.listener):[]}on(n,s){this._events[n]||(this._events[n]=[]),n=this._events[n],this._indexOfListener(n,s)===-1&&n.push({listener:s,once:!1})}once(n,s){this._events[n]||(this._events[n]=[]),n=this._events[n],this._indexOfListener(n,s)===-1&&n.push({listener:s,once:!0})}off(n,s){if(this._events[n]){var c=this._events[n];s=this._indexOfListener(c,s),s!==-1&&Jr(c).call(c,s,1),this._events[n].length===0&&delete this._events[n]}}removeAllListeners(n){n?delete this._events[n]:this._events={}}emit(n,...s){var c;this._events[n]||(this._events[n]=[]);let u=Ie(c=this._events[n]).call(c,h=>h);for(c=0;c<u.length;c+=1){let h=u[c];h.once&&this.off(n,h.listener),h.listener.apply(this,s||[])}}_indexOfListener(n,s){let c=n.length;for(;c--;)if(n[c].listener===s)return c;return-1}}let ad=0,$p=0,ni=new class extends Zr{constructor(){super();this._moduleName="network-indicator",this._networkState=Fi.ONLINE,window.addEventListener("online",()=>{this.networkState=Fi.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Fi.OFFLINE})}set networkState(i){R.info("[".concat(this._moduleName,"]")+"network state changed, "+this._networkState+" -> "+i),this.emit(oc.NETWORK_STATE_CHANGE,i,this._networkState),i===Fi.ONLINE?this.emit(oc.ONLINE):i===Fi.OFFLINE&&(this.onlineWaiter=new se(n=>{this.once(oc.ONLINE,()=>{this.onlineWaiter=void 0,n(Fi.ONLINE)})}),this.emit(oc.OFFLINE)),this._networkState=i}get networkState(){return this._networkState}},Mr={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4},z=new class{constructor(){var i,n;this.baseInfoMap=new Tt,this.clientList=qo,this.keyEventUploadPendingItems=[],this.normalEventUploadPendingItems=[],this.apiInvokeUploadPendingItems=[],this.apiInvokeCount=0,this.ltsList=[],this.lastSendNormalEventTime=le(),this.customReportCount=0,this.eventUploadTimer=window.setInterval(fr(i=this.doSend).call(i,this),te.EVENT_REPORT_SEND_INTERVAL),this.setSessionIdTimer=window.setInterval(fr(n=this.appendSessionId).call(n,this),te.EVENT_REPORT_SEND_INTERVAL)}reportApiInvoke(i,n,s){n.timeout=n.timeout||6e4,n.reportResult=n.reportResult===void 0||n.reportResult;const c=le(),u=this.apiInvokeCount+=1,h=()=>({tag:n.tag,invokeId:u,sid:i,name:n.name,apiInvokeTime:c,options:n.options,states:n.states||null}),f=!!te.SHOW_REPORT_INVOKER_LOG;f&&R.info("".concat(n.name," start"),n.options);let A=!1;Un(n.timeout).then(()=>{A||(this.sendApiInvoke(_r({},h(),{error:D.API_INVOKE_TIMEOUT,success:!1})),R.debug("".concat(n.name," timeout")))});const m=new L(D.UNEXPECTED_ERROR,"".concat(n.name,": this api invoke is end"));return{onSuccess:I=>{const E=()=>{if(A)throw m;return A=!0,this.sendApiInvoke(_r({},h(),{success:!0},n.reportResult&&{result:I})),f&&R.info("".concat(n.name," onSuccess")),I};return s?x1(E,n.name+"Success",s,()=>A=!0):E()},onError:I=>{const E=()=>{if(A)throw I;A=!0,this.sendApiInvoke(_r({},h(),{success:!1,error:I.toString()})),f&&R.info("".concat(n.name," onFailure"),I.toString())};return s?x1(E,n.name+"Error",s,()=>A=!0):E()}}}sessionInit(i,n){if(!this.baseInfoMap.has(i)){var s=le();i=this.createBaseInfo(i,s),i.cname=n.cname;var c=cn({},{willUploadConsoleLog:te.UPLOAD_LOG,maxTouchPoints:navigator.maxTouchPoints,areaVersion:Pp?"global":"oversea",areas:te.AREAS&&te.AREAS.join(",")},n.extend),u=le();n=_r({},i,{eventType:zr.SESSION_INIT,appid:n.appid,browser:navigator.userAgent,build:"v4.7.2-0-gf83f608b(10/13/2021, 5:32:13 PM)",lts:u,elapse:u-s,extend:fe(c),mode:n.mode,process:te.PROCESS_ID,success:!0,version:ei}),this.send({type:Zt.SESSION,data:n},!0)}}joinChooseServer(i,n){if(i=this.baseInfoMap.get(i)){var s=i.info,c=le();n=_r({},s,{eventType:zr.JOIN_CHOOSE_SERVER,lts:c,eventElapse:c-n.lts,chooseServerAddr:n.csAddr,errorCode:n.ec,elapse:c-i.startTime,success:n.succ,chooseServerAddrList:fe(n.serverList),uid:n.uid?pr(n.uid):null,cid:n.cid?pr(n.cid):null,chooseServerIp:n.csIp||"",opid:n.opid,unilbsServerIds:n.unilbsServerIds,extend:n.extend||void 0}),this.send({type:Zt.JOIN_CHOOSE_SERVER,data:n},!0)}}reqUserAccount(i,n){if(i=this.baseInfoMap.get(i)){var s=i.info,c=le();n=_r({},s,{eventType:zr.REQ_USER_ACCOUNT,lts:c,success:n.success,serverAddress:n.serverAddr,stringUid:n.stringUid,uid:n.uid,errorCode:n.errorCode,elapse:c-i.startTime,eventElapse:c-n.lts,extend:fe(n.extend)}),this.send({type:Zt.REQ_USER_ACCOUNT,data:n},!0)}}joinGateway(i,n){if(i=this.baseInfoMap.get(i)){var s=i.info;n.vid&&(s.vid=n.vid),s.uid=n.uid,s.cid=n.cid;var c=le();s=_r({},s,{eventType:zr.JOIN_GATEWAY,lts:c,gatewayAddr:n.addr,success:n.succ,errorCode:n.ec,elapse:c-i.startTime,eventElapse:c-n.lts}),n.succ&&(i.lastJoinSuccessTime=c),this.send({type:Zt.JOIN_GATEWAT,data:s},!0)}}joinChannelTimeout(i,n){if(i=this.baseInfoMap.get(i)){var s=le();n=_r({},i.info,{lts:s,timeout:n,elapse:s-i.startTime}),this.send({type:Zt.JOIN_CHANNEL_TIMEOUT,data:n},!0)}}publish(i,n){if(i=this.baseInfoMap.get(i)){var s=i.info,c=le();n=_r({},s,{eventType:zr.PUBLISH,lts:c,eventElapse:c-n.lts,elapse:c-i.startTime,success:n.succ,errorCode:n.ec,videoName:n.videoName,audioName:n.audioName,screenName:n.screenName,screenshare:n.screenshare,audio:n.audio,video:n.video,p2pid:n.p2pid,publishRequestid:n.publishRequestid}),this.send({type:Zt.PUBLISH,data:n},!0)}}subscribe(i,n){if(i=this.baseInfoMap.get(i)){var s=i.info,c=le();i=_r({},s,{eventType:zr.SUBSCRIBE,lts:c,eventElapse:c-n.lts,elapse:c-i.startTime,success:n.succ,errorCode:n.ec,video:n.video,audio:n.audio,subscribeRequestid:n.subscribeRequestid,p2pid:n.p2pid}),typeof n.peerid=="string"?i.peerSuid=n.peerid:i.peer=n.peerid,this.send({type:Zt.SUBSCRIBE,data:i},!0)}}firstRemoteFrame(i,n,s,c){if(i=this.baseInfoMap.get(i)){var u=i.info,h=le();n=_r({},u,{},c,{elapse:h-i.startTime,eventType:n,lts:h}),this.send({type:s,data:n},!0)}}onGatewayStream(i,n,s,c){(i=this.baseInfoMap.get(i))&&(n=_r({},i.info,{},c,{eventType:n,lts:le()}),this.send({type:s,data:n},!0))}streamSwitch(i,n){if(i=this.baseInfoMap.get(i)){var s=i.info,c=le();n=_r({},s,{eventType:zr.STREAM_SWITCH,lts:c,isDual:n.isdual,elapse:c-i.startTime,success:n.succ}),this.send({type:Zt.STREAM_SWITCH,data:n},!0)}}requestProxyAppCenter(i,n){if(i=this.baseInfoMap.get(i)){var s=i.info,c=le();n=_r({},s,{eventType:zr.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-n.lts,elapse:c-i.startTime,APAddr:n.APAddr,workerManagerList:n.workerManagerList,response:n.response,errorCode:n.ec,success:n.succ}),this.send({type:Zt.REQUEST_PROXY_APPCENTER,data:n},!0)}}requestProxyWorkerManager(i,n){if(i=this.baseInfoMap.get(i)){var s=i.info,c=le();n=_r({},s,{eventType:zr.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-n.lts,elapse:c-i.startTime,workerManagerAddr:n.workerManagerAddr,response:n.response,errorCode:n.ec,success:n.succ}),this.send({type:Zt.REQUEST_PROXY_WORKER_MANAGER,data:n},!0)}}setProxyServer(i){(this.proxyServer=i)?R.debug("reportProxyServerurl: ".concat(i)):R.debug("disable reportProxyServerurl: ".concat(i))}peerPublishStatus(i,n){if(i=this.baseInfoMap.get(i)){var s=i.info,c=le();n=_r({},s,{subscribeElapse:n.subscribeElapse,peer:n.peer,peerPublishDuration:Math.max(n.audioPublishDuration,n.videoPublishDuration),audiotag:0<n.audioPublishDuration?1:-1,videotag:0<n.videoPublishDuration?1:-1,lts:c,elapse:c-i.startTime,joinChannelSuccessElapse:c-(i.lastJoinSuccessTime||c)}),this.send({type:Zt.PEER_PUBLISH_STATUS,data:n},!0)}}workerEvent(i,n){if(i=this.baseInfoMap.get(i)){var s=i.info,c=le();n=function(u,h,f){const A=u[h];if(!A||typeof A!="string")return[u];u[h]="";const m=xa(fe(u));let I=0;const E=[];let _=0;for(let S=0;S<A.length;S++)_+=127>=A.charCodeAt(S)?1:3,_<=f-m||(E[E.length]=Gh({},u,{[h]:A.substring(I,S)}),I=S,_=127>=A.charCodeAt(S)?1:3);return I!==A.length-1&&(E[E.length]=Gh({},u,{[h]:A.substring(I)})),E}(_r({},s,{},n,{elapse:c-i.startTime,lts:c,productType:"WebRTC"}),"payload",1300),K(n).call(n,u=>this.send({type:Zt.WORKER_EVENT,data:u},!0))}}apworkerEvent(i,n){if(i=this.baseInfoMap.get(i)){var s=i.info,c=le();n=_r({},s,{},n,{elapse:c-i.startTime,lts:c}),this.send({type:Zt.AP_WORKER_EVENT,data:n},!0)}}joinWebProxyAP(i,n){if(i=this.baseInfoMap.get(i)){var s=i.info,c=le();n=_r({},s,{},n,{elapse:c-i.startTime,lts:c,extend:n.extend||void 0}),this.send({type:Zt.JOIN_WEB_PROXY_AP,data:n},!0)}}WebSocketQuit(i,n){if(i=this.baseInfoMap.get(i)){var s=i.info,c=le();n=_r({},s,{},n,{elapse:c-i.startTime,lts:c}),this.send({type:Zt.WEBSOCKET_QUIT,data:n},!0)}}async sendCustomReportMessage(i,n){if(this.customReportCount+=n.length,this.customReportCount>te.CUSTOM_REPORT_LIMIT)throw new L(D.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3)),n=Ie(n).call(n,s=>({type:Zt.USER_ANALYTICS,data:_r({sid:i},s)})),n={msgType:"EventMessages",sentTs:Math.round(le()/1e3),payloads:Ie(n).call(n,s=>fe(s))};try{await this.postDataToStatsCollector(n)}catch(s){throw R.error("send custom report message failed",s.toString()),new L(D.CUSTOM_REPORT_SEND_FAILED,s.message)}}sendApiInvoke(i){var n=te.NOT_REPORT_EVENT;if(i.tag&&vt(n)&&vt(n).call(n,i.tag))return!1;if(i.sid===null)return this.apiInvokeUploadPendingItems.push(i),!1;if(n=this.baseInfoMap.get(i.sid),!n)return this.apiInvokeUploadPendingItems.push(i),!1;const{cname:s,uid:c,cid:u}=n.info;return i.lts=i.lts||le(),i={invokeId:i.invokeId,sid:i.sid,cname:s,cid:u,uid:c,lts:i.lts,success:i.success,elapse:i.lts-n.startTime,execElapse:i.lts-i.apiInvokeTime,apiName:i.name,options:i.options?fe(i.options):void 0,execStates:i.states?fe(i.states):void 0,execResult:i.result?fe(i.result):void 0,errorCode:i.error?fe(i.error):void 0},this.send({type:Zt.API_INVOKE,data:i},!1),!0}appendSessionId(){var i;K(i=this.clientList).call(i,n=>{if(n._sessionId){const s=this.apiInvokeUploadPendingItems.length;for(let c=0;c<s;c++){const u=this.apiInvokeUploadPendingItems.shift();u&&(u.sid=n._sessionId,this.sendApiInvoke(cn({},u)))}}})}send(i,n){if(n)return this.keyEventUploadPendingItems.push(i),void this.sendItems(this.keyEventUploadPendingItems,!0);var s;this.normalEventUploadPendingItems.push(i),this.normalEventUploadPendingItems.length>te.NORMAL_EVENT_QUEUE_CAPACITY&&Jr(s=this.normalEventUploadPendingItems).call(s,0,1),10<=this.normalEventUploadPendingItems.length&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){0<this.keyEventUploadPendingItems.length&&this.sendItems(this.keyEventUploadPendingItems,!0),0<this.normalEventUploadPendingItems.length&&5e3<=le()-this.lastSendNormalEventTime&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(i,n){const s=[];for(var c=[];i.length;){const f=i.shift();20>s.length?s.push(f):c.push(f)}i.push(...c);for(const f of[...s]){var u,h;Ke(u=this.ltsList).call(u,f.data.lts)!==-1?(f.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(f.data.lts)):(this.ltsList.push(f.data.lts),ul(h=this.ltsList).call(h,(A,m)=>A-m))}return n||(this.lastSendNormalEventTime=le()),c={msgType:"EventMessages",sentTs:Math.round(le()/1e3),payloads:Ie(s).call(s,f=>fe(f)),vid:(f=>(f=f&&f.data.sid&&this.baseInfoMap.get(f.data.sid))&&f.info.vid&&+f.info.vid||0)(s[0])},s.length&&this.postDataToStatsCollector(c).catch((f=>A=>{var m,I,E;te.EVENT_REPORT_RETRY&&(n?this.keyEventUploadPendingItems=b(m=this.keyEventUploadPendingItems).call(m,f):(this.normalEventUploadPendingItems=b(I=this.normalEventUploadPendingItems).call(I,f),this.normalEventUploadPendingItems.length>te.NORMAL_EVENT_QUEUE_CAPACITY&&(Jr(E=this.normalEventUploadPendingItems).call(E,0,this.normalEventUploadPendingItems.length-te.NORMAL_EVENT_QUEUE_CAPACITY),R.warning("report: drop normal events"))))})(s)),i}async postDataToStatsCollector(i,n=!1){var s,c,u;ni.networkState===Fi.OFFLINE&&await se.race([ni.onlineWaiter,Un(2*Mr.maxRetryTimeout)]);const h=n?"/events/proto-raws":"/events/messages";let f=this.url||(this.proxyServer?b(s=b(c="https://".concat(this.proxyServer,"/rs/?h=")).call(c,te.EVENT_REPORT_DOMAIN,"&p=6443&d=")).call(s,h):b(u="https://".concat(te.EVENT_REPORT_DOMAIN,":6443")).call(u,h));for(s=0;2>s;s+=1){var A,m,I;s===1&&(f=this.backupUrl||(this.proxyServer?b(A=b(m="https://".concat(this.proxyServer,"/rs/?h=")).call(m,te.EVENT_REPORT_BACKUP_DOMAIN,"&p=6443&d=")).call(A,h):b(I="https://".concat(te.EVENT_REPORT_BACKUP_DOMAIN,":6443")).call(I,h)));try{n?await hT(f,{timeout:1e4,data:i}):await $i(f,{timeout:1e4,data:i})}catch(E){if(s===1)throw E;continue}break}}createBaseInfo(i,n){const s=cn({},qR);return s.sid=i,this.baseInfoMap.set(i,{info:s,startTime:n}),s}};class _1 extends Zr{constructor(n,s){super();this._hints=[],this._isClosed=!1,this._ID=s||or(8,"track-"),this._mediaStreamTrack=this._originMediaStreamTrack=n,vt(Es).call(Es,this)||Es.push(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(n){return n||(n=z.reportApiInvoke(null,{name:Re.GET_MEDIA_STREAM_TRACK,options:[],tag:Te.TRACER}),this._mediaStreamTrack&&typeof this._mediaStreamTrack.label=="string"?n.onSuccess(this._mediaStreamTrack.label):n.onSuccess("")),this._mediaStreamTrack}close(){this._isClosed=!0;{let n=Ke(Es).call(Es,this);n!==-1&&Jr(Es).call(Es,n,1)}}}let uw=1;class Xo{constructor(n){var s;this.lockingPromise=se.resolve(),this.locks=0,this.name="",this.lockId=uw++,n&&(this.name=n),R.debug(b(s="[lock-".concat(this.name,"-")).call(s,this.lockId,"] is created."))}get isLocked(){return 0<this.locks}lock(){var n,s;let c;this.locks+=1,R.debug(b(n=b(s="[lock-".concat(this.name,"-")).call(s,this.lockId,"] is locked, current queue ")).call(n,this.locks,"."));let u=new se(h=>{c=()=>{var f,A;--this.locks,R.debug(b(f=b(A="[lock-".concat(this.name,"-")).call(A,this.lockId,"] is not locked, current queue ")).call(f,this.locks,".")),h()}});return n=this.lockingPromise.then(()=>c),this.lockingPromise=this.lockingPromise.then(()=>u),n}}class cd extends _1{constructor(n,s){super(n,s);this._enabled=!0,this._isClosed=this._muted=!1,this._trackProcessors=[],this._handleTrackEnded=()=>{this.onTrackEnded()},this._enabledMutex=new Xo("".concat(s)),n.addEventListener("ended",this._handleTrackEnded)}get muted(){return this._muted}get enabled(){return this._enabled}getTrackLabel(){return this._originMediaStreamTrack.label}close(){var n;this._isClosed||(this.stop(),K(n=this._trackProcessors).call(n,s=>s.destroy()),this._trackProcessors=[],this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,R.debug("[".concat(this.getTrackId(),"] close")),this.emit(Be.NEED_CLOSE),super.close())}async _registerTrackProcessor(n){var s;if(Ke(s=this._trackProcessors).call(s,n)===-1){var c=this._trackProcessors[this._trackProcessors.length-1];this._trackProcessors.push(n),n.onOutputChange=async()=>{this._mediaStreamTrack=n.output||this._originMediaStreamTrack,this._updatePlayerSource(),await sn(this,Be.NEED_REPLACE_TRACK,this._mediaStreamTrack)},c?(c.onOutputChange=async()=>{c.output&&await n.setInput(c.output)},await n.setInput(c.output||c.input||this._originMediaStreamTrack)):await n.setInput(this._originMediaStreamTrack)}}_getOutputFromProcessors(){if(this._trackProcessors.length===0)return this._originMediaStreamTrack;let n=this._trackProcessors[this._trackProcessors.length-1];return n.output||n.input||this._originMediaStreamTrack}async _updateOriginMediaStreamTrack(n,s){n!==this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),s&&this._originMediaStreamTrack.stop(),n.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=n,0<this._trackProcessors.length?(await this._trackProcessors[0].setInput(n),this._mediaStreamTrack=this._getOutputFromProcessors()):this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await sn(this,Be.NEED_REPLACE_TRACK,this._mediaStreamTrack))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){R.debug("[".concat(this.getTrackId(),"] track ended")),this.emit(aa.TRACK_ENDED)}stateCheck(n,s){var c,u,h;if(R.debug(b(c=b(u=b(h="check track state, [muted: ".concat(this._muted,", enabled: ")).call(h,this._enabled,"] to [")).call(u,n,": ")).call(c,s,"]")),n==="muted"&&!Pt.webAudioMediaStreamDest)throw new L(D.NOT_SUPPORTED,"current environment does not support set mute").print();if(ps(s,n),this._enabled&&this._muted&&n==="enabled"&&s===!1)throw new L(D.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print();if(!this._enabled&&!this._muted&&n==="muted"&&s===!0)throw new L(D.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print()}}var en;(function(i){i.IOS_15_INTERRUPTION_START="ios15-interruption-start",i.IOS_15_INTERRUPTION_END="ios15-interruption-end",i.IOS_INTERRUPTION_START="ios-interruption-start",i.IOS_INTERRUPTION_END="ios-interruption-end"})(en||(en={}));let S1=window.AudioContext||window.webkitAudioContext,so=null,At=new class extends Zr{constructor(){super(...arguments);this.onLocalAudioTrackMute=()=>{R.info("ios15-interruption-start"),this.emit(en.IOS_15_INTERRUPTION_START)},this.onLocalAudioTrackUnmute=async()=>{R.info("ios15-interruption-end"),this.curState==="running"&&(so&&await so.suspend(),this.emit(en.IOS_15_INTERRUPTION_END))}}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(i){R.debug("webaudio bindInterruptDetectorTrack ".concat(i.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=i,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(i){R.debug("webaudio unbindInterruptDetectorTrack ".concat(i.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===i&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}},Zp=null;class T1 extends Zr{constructor(){super();this.isPlayed=!1,this.audioOutputLevel=0,this.isNoAudioInput=this.isDestroyed=!1,this._noAudioInputCount=0,this.context=Wc(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Yc(this.outputNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.smoothingTimeConstant=.4,this.analyserNode.fftSize=2048}startGetAudioBuffer(n){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(n),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=s=>{this.emit(Qi.ON_AUDIO_BUFFER,function(c){for(let u=0;u<c.outputBuffer.numberOfChannels;u+=1){let h=c.outputBuffer.getChannelData(u);for(let f=0;f<h.length;f+=1)h[f]=0}return c.inputBuffer}(s))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Pt.webAudioMediaStreamDest)throw new L(D.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(n){this.context.state!=="running"&&pi(()=>{At.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=n||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){if(!this.context||xn()||Eo()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode)return 0;let n=new Uint8Array(this.analyserNode.frequencyBinCount);this.analyserNode.getByteFrequencyData(n);let s=0;for(let c=0;c<n.length;c++)s+=64>c?Math.abs(10*n[c]):Math.abs(6*n[c]/15);return s/n.length/255}async checkHasAudioInput(n=0){if(5<n)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;if(xn()||Eo()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume(),!this.analyserNode)return!1;let s=new Uint8Array(this.analyserNode.frequencyBinCount);this.analyserNode.getByteFrequencyData(s);let c=!1;for(let u=0;u<s.length;u++)s[u]!==0&&(c=!0);return c?(this.isNoAudioInput=!1,!0):(await Un(200),await this.checkHasAudioInput(n?n+1:1)&&c)}getAudioVolume(){return this.outputNode.gain.value}setVolume(n){this.outputNode.gain.setValueAtTime(n,this.context.currentTime)}setMute(n){n?(this.disconnect(),this.audioOutputLevel=0):this.connect()}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){this.sourceNode&&this.sourceNode.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){this.sourceNode&&this.sourceNode.connect(this.outputNode),this.outputNode.connect(this.analyserNode)}}class R1 extends T1{constructor(n,s){if(super(),this.isCurrentTrackCloned=!1,this.isRemoteTrack=!1,this.rebuildWebAudio=async()=>{if(R.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void R.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>R.info("resume success")),R.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();var c=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?c.stop():this.isCurrentTrackCloned=!0,c=new MediaStream([this.track]),this.sourceNode=this.context.createMediaStreamSource(c),Yc(this.sourceNode),this.analyserNode=this.context.createAnalyser();let u=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(u,this.context.currentTime),Yc(this.outputNode),this.connect(),this.audioElement.srcObject=c,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()},n.kind!=="audio")throw new L(D.UNEXPECTED_ERROR);this.track=n,n=new MediaStream([this.track]),this.isRemoteTrack=!!s,this.sourceNode=this.context.createMediaStreamSource(n),Yc(this.sourceNode),this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=n,n=Je(),s&&n.os===ln.IOS&&15>Number(n.osVersion&&n.osVersion.split(".")[0])&&(At.on("state-change",()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(c=>{c||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}get isFreeze(){return!1}updateTrack(n){this.sourceNode.disconnect(),this.track=n,this.isCurrentTrackCloned=!1,n=new MediaStream([n]),this.sourceNode=this.context.createMediaStreamSource(n),Yc(this.sourceNode),this.sourceNode.connect(this.outputNode),this.audioElement.srcObject=n}destroy(){this.audioElement.srcObject=null,this.audioElement.remove(),At.off("state-change",this.rebuildWebAudio),super.destroy()}}let ld=null,ef=new Xo("safari"),w1=!1,N1=!1,Vn=new class extends Zr{constructor(){super();this._state=sa.IDLE,this.lastAccessCameraPermission=this.lastAccessMicrophonePermission=this.isAccessCameraPermission=this.isAccessMicrophonePermission=!1,this.deviceInfoMap=new Tt,this.init().then(()=>{var i;navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",fr(i=this.updateDevicesInfo).call(i,this)),window.setInterval(()=>Je().name!==$e.WECHAT&&te.ENUMERATE_DEVICES_INTERVAL&&this.updateDevicesInfo(),6e4)}).catch(i=>R.error(i.toString()))}get state(){return this._state}set state(i){i!==this._state&&(this.emit(Jo.STATE_CHANGE,i),this._state=i)}async enumerateDevices(i,n,s=!1){if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new L(D.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();var c=await navigator.mediaDevices.enumerateDevices();c=this.checkMediaDeviceInfoIsOk(c);let u=!this.isAccessMicrophonePermission&&i,h=!this.isAccessCameraPermission&&n;c.audio&&(u=!1),c.video&&(h=!1);let f=c=null,A=null;if(!s&&(u||h)){if(ef.isLocked&&(R.debug("[device manager] wait GUM lock"),(await ef.lock())(),R.debug("[device manager] GUM unlock")),w1&&(u=!1,this.isAccessMicrophonePermission=!0),N1&&(h=!1,this.isAccessCameraPermission=!0),R.debug("[device manager] check media device permissions",i,n,u,h),u&&h){try{A=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(O){if(s=Tu(O.name||O.code||O,O.message),s.code===D.PERMISSION_DENIED)throw s;R.warning("getUserMedia failed in getDevices",s)}this.isAccessMicrophonePermission=this.isAccessCameraPermission=!0}else if(u){try{c=await navigator.mediaDevices.getUserMedia({audio:i})}catch(O){if(s=Tu(O.name||O.code||O,O.message),s.code===D.PERMISSION_DENIED)throw s;R.warning("getUserMedia failed in getDevices",s)}this.isAccessMicrophonePermission=!0}else if(h){try{f=await navigator.mediaDevices.getUserMedia({video:n})}catch(O){if(s=Tu(O.name||O.code||O,O.message),s.code===D.PERMISSION_DENIED)throw s;R.warning("getUserMedia failed in getDevices",s)}this.isAccessCameraPermission=!0}R.debug("[device manager] mic permission",i,"cam permission",n)}try{var m,I,E;const O=await navigator.mediaDevices.enumerateDevices();return c&&K(m=c.getTracks()).call(m,B=>B.stop()),f&&K(I=f.getTracks()).call(I,B=>B.stop()),A&&K(E=A.getTracks()).call(E,B=>B.stop()),c=null,f=null,A=null,O}catch(O){var _,S,N;return c&&K(_=c.getTracks()).call(_,B=>B.stop()),f&&K(S=f.getTracks()).call(S,B=>B.stop()),A&&K(N=A.getTracks()).call(N,B=>B.stop()),A=f=c=null,new L(D.ENUMERATE_DEVICES_FAILED,O.toString()).throw()}}async getRecordingDevices(i=!1){return i=await this.enumerateDevices(!0,!1,i),Qe(i).call(i,n=>n.kind==="audioinput")}async getCamerasDevices(i=!1){return i=await this.enumerateDevices(!1,!0,i),Qe(i).call(i,n=>n.kind==="videoinput")}async getSpeakers(i=!1){return i=await this.enumerateDevices(!0,!1,i),Qe(i).call(i,n=>n.kind==="audiooutput")}searchDeviceNameById(i){return(i=this.deviceInfoMap.get(i))?i.device.label||i.device.deviceId:null}searchDeviceIdByName(i){var n;let s=null;return K(n=this.deviceInfoMap).call(n,c=>{c.device.label===i&&(s=c.device.deviceId)}),s}async getDeviceById(i){var n=await this.enumerateDevices(!0,!0,!0);if(n=Xe(n).call(n,s=>s.deviceId===i),!n)throw new L(D.DEVICE_NOT_FOUND,"deviceId: ".concat(i));return n}async init(){this.state=sa.INITING;try{await this.updateDevicesInfo(),this.state=sa.INITEND}catch(n){R.warning("Device Detection functionality cannot start properly.",n.toString()),this.state=sa.IDLE;var i=typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1";throw i||new L(D.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),n}}async updateDevicesInfo(){var i;const n=await this.enumerateDevices(!0,!0,!0),s=le(),c=[],u=this.checkMediaDeviceInfoIsOk(n);if(K(n).call(n,h=>{if(h.deviceId){var f=this.deviceInfoMap.get(h.deviceId);if((f?f.state:"INACTIVE")!=="ACTIVE"){const A={initAt:s,updateAt:s,device:h,state:"ACTIVE"};this.deviceInfoMap.set(h.deviceId,A),c.push(A)}f&&(f.updateAt=s)}}),K(i=this.deviceInfoMap).call(i,(h,f)=>{h.state==="ACTIVE"&&h.updateAt!==s&&(h.state="INACTIVE",c.push(h))}),this.state!==sa.INITEND)return u.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(u.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));K(c).call(c,h=>{switch(h.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Jo.RECORDING_DEVICE_CHANGED,h);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Jo.CAMERA_DEVICE_CHANGED,h);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Jo.PLAYOUT_DEVICE_CHANGED,h)}}),u.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),u.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(i){const n=Qe(i).call(i,c=>c.kind==="audioinput");i=Qe(i).call(i,c=>c.kind==="videoinput");const s={audio:!1,video:!1};for(const c of n)if(c.label&&c.deviceId){s.audio=!0;break}for(const c of i)if(c.label&&c.deviceId){s.video=!0;break}return s}};var dw=hr("Array").entries,O1=Array.prototype,hw={DOMTokenList:!0,NodeList:!0},k1=function(i){var n=i.entries;return i===O1||i instanceof Array&&n===O1.entries||hw.hasOwnProperty(Wa(i))?dw:n};let tf=!1,b1=new Zr,D1="play playing loadeddata canplay pause stalled suspend waiting abort emptied ended".split(" "),vi=new class{constructor(){this.elementMap=new Tt,this.elementStateMap=new Tt,this.elementsNeedToResume=[],this.sinkIdMap=new Tt,this.autoResumeAfterInterruption=()=>{var i,n;K(i=oo(k1(n=this.elementMap).call(n))).call(i,([s,c])=>{s=this.elementStateMap.get(s);const u=c.srcObject.getAudioTracks()[0];bi()?u&&u.readyState==="live"&&At.curState==="running"&&(R.debug("auto resume after interruption for iOS 15"),c.pause(),c.play()):s&&s==="pause"&&u&&u.readyState==="live"&&At.curState==="running"&&(R.debug("auto resume after interruption for iOS"),c.play())})},this.autoResumeAfterInterruptionOnIOS15=()=>{var i,n;K(i=oo(k1(n=this.elementMap).call(n))).call(i,([,s])=>{const c=s.srcObject.getAudioTracks()[0];c&&c.readyState==="live"&&(R.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),s.pause(),s.play())})},this.autoResumeAudioElement(),At.on(en.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),At.on(en.IOS_15_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15)}async setSinkID(i,n){const s=this.elementMap.get(i);if(this.sinkIdMap.set(i,n),s)try{await s.setSinkId(n)}catch(c){throw new L(D.PERMISSION_DENIED,"can not set sink id: "+c.toString())}}play(i,n,s){if(!this.elementMap.has(n)){var c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([i]),this.bindAudioElementEvents(n,c),this.elementMap.set(n,c),this.elementStateMap.set(n,Hr.INIT),this.setVolume(n,s),(i=this.sinkIdMap.get(n))&&c.setSinkId(i).catch(u=>{R.warning("[".concat(n,"] set sink id failed"),u.toString())}),(i=c.play())&&i.then&&i.catch(u=>{R.warning("audio element play warning",u.toString()),this.elementMap.has(n)&&u.name==="NotAllowedError"&&(R.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),pi(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),mm()}))})}}updateTrack(i,n){(i=this.elementMap.get(i))&&(i.srcObject=new MediaStream([n]))}isPlaying(i){return this.elementMap.has(i)}setVolume(i,n){(i=this.elementMap.get(i))&&(n=Math.max(0,Math.min(100,n)),i.volume=n/100)}stop(i){var n,s;const c=this.elementMap.get(i);if(this.sinkIdMap.delete(i),c){var u=Ke(n=this.elementsNeedToResume).call(n,c);Jr(s=this.elementsNeedToResume).call(s,u,1),c.srcObject=null,c.remove(),this.elementMap.delete(i),this.elementStateMap.delete(i)}}bindAudioElementEvents(i,n){K(D1).call(D1,s=>{n.addEventListener(s,c=>{var u,h;const f=this.elementStateMap.get(i);c=c.type,R.debug(b(u=b(h="[".concat(i,"] audio-element-status change ")).call(h,f," => ")).call(u,c)),this.elementStateMap.set(i,c)})})}autoResumeAudioElement(){const i=()=>{var n;K(n=this.elementsNeedToResume).call(n,s=>{s.play().then(c=>{R.debug("Auto resume audio element success")}).catch(c=>{R.warning("Auto resume audio element failed!",c)})}),this.elementsNeedToResume=[]};new se(n=>{document.body?n():window.addEventListener("load",()=>n())}).then(()=>{document.body.addEventListener("touchstart",i,!0),document.body.addEventListener("mousedown",i,!0)})}};var ii=function(i,n,s,c){var u,h=arguments.length,f=3>h?n:c===null?c=ut(n,s):c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(i,n,s,c);else for(var A=i.length-1;0<=A;A--)(u=i[A])&&(f=(3>h?u(f):3<h?u(n,s,f):u(n,s))||f);return 3<h&&f&&ft(n,s,f),f},it=function(i,n){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,n)};class Lr extends cd{constructor(n,s,c){super(n,c);this.trackMediaType="audio",this._enabled=!0,this._volume=100,this._bypassWebAudio=this._useAudioElement=!1,this._encoderConfig=s,this._source=new R1(n)}get isPlaying(){return this._useAudioElement?vi.isPlaying(this.getTrackId()):this._source.isPlayed}setVolume(n){St(n,"volume",0,1e3);let s=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.LOCAL_AUDIO_TRACK_SET_VOLUME,options:[this.getTrackId(),n]},300);this._volume=n,this._source.setVolume(n/100),this._useAudioElement&&vi.setVolume(this.getTrackId(),n);try{if(this._bypassWebAudio)return void R.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));let c=this._source.createOutputTrack();this._mediaStreamTrack!==c&&(this._mediaStreamTrack=c,sn(this,Be.NEED_REPLACE_TRACK,this._mediaStreamTrack).then(()=>{R.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(u=>{R.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),u)}))}catch{}s.onSuccess()}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}async setPlaybackDevice(n){let s=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.REMOTE_AUDIO_SET_OUTPUT_DEVICE,options:[this.getTrackId(),n]});if(!this._useAudioElement)throw new L(D.NOT_SUPPORTED,"your browser does not support setting the audio output device");try{await vi.setSinkID(this.getTrackId(),n)}catch(c){throw s.onError(c),c}s.onSuccess()}async setEnabled(n,s,c){var u;if(!c){if(n===this._enabled)return;this.stateCheck("enabled",n)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),n),s=await this._enabledMutex.lock(),!n){this._originMediaStreamTrack.enabled=!1;try{await sn(this,Be.NEED_REMOVE_TRACK,this)}catch(h){throw R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),h.toString()),s(),h}return c||(this._enabled=!1),s()}this._originMediaStreamTrack.enabled=!0;try{await sn(this,Be.NEED_ADD_TRACK,this)}catch(h){throw R.error("[".concat(this.getTrackId(),"] setEnabled to true error"),h.toString()),s(),h}R.info(b(u="[".concat(this.getTrackId(),"] setEnabled to ")).call(u,n," success")),c||(this._enabled=!0),s()}async setMuted(n){var s,c;if(this._bypassWebAudio)return R.debug(b(c="[".concat(this.getTrackId(),"] setMuted:")).call(c,n," fallback to setEnabled because no pass through.")),void await this.setEnabled(!n);if(n!==this._muted){if(this.stateCheck("muted",n),this._muted=n,Je().name===$e.FIREFOX)return R.debug("[".concat(this.getTrackId(),"] firefox set mute fallback to set enabled")),void await this.setEnabled(!n,void 0,!0);this._mediaStreamTrack.enabled=!n,R.debug(b(s="[".concat(this.getTrackId(),"] start set muted: ")).call(s,n)),await sn(this,Be.SET_AUDIO_TRACK_MUTED,{track:this,muted:n})}}getStats(){return Jc(()=>{R.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),qs(this,Be.GET_STATS)||Ru({},id)}setAudioFrameCallback(n,s=4096){if(!n)return this._source.removeAllListeners(Qi.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(s),this._source.removeAllListeners(Qi.ON_AUDIO_BUFFER),this._source.on(Qi.ON_AUDIO_BUFFER,c=>n(c))}play(){let n=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.LOCAL_AUDIO_TRACK_PLAY,options:[this.getTrackId()]});R.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(R.debug("[".concat(this.getTrackId(),"] start audio playback in element")),vi.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play(),n.onSuccess()}stop(){let n=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.LOCAL_AUDIO_TRACK_STOP,options:[this.getTrackId()]});R.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?vi.stop(this.getTrackId()):this._source.stop(),n.onSuccess()}close(){super.close(),this._source.destroy()}_updatePlayerSource(){R.debug("[".concat(this.getTrackId(),"] update player source track")),this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&vi.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(n,s){this._originMediaStreamTrack!==n&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n.addEventListener("ended",this._handleTrackEnded),s&&this._originMediaStreamTrack.stop(),this._originMediaStreamTrack=n,this._source.updateTrack(this._originMediaStreamTrack),this._mediaStreamTrack!==this._source.outputTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await sn(this,Be.NEED_REPLACE_TRACK,this._mediaStreamTrack)))}renewMediaStreamTrack(){return se.resolve(void 0)}}ii([Yt(),it("design:type",Function),it("design:paramtypes",[String]),it("design:returntype",se)],Lr.prototype,"setPlaybackDevice",null),ii([Yt(),it("design:type",Function),it("design:paramtypes",[Boolean,Object,Boolean]),it("design:returntype",se)],Lr.prototype,"setEnabled",null),ii([Yt(),Uh({report:z}),it("design:type",Function),it("design:paramtypes",[Boolean]),it("design:returntype",se)],Lr.prototype,"setMuted",null),ii([Yt(),it("design:type",Function),it("design:paramtypes",[]),it("design:returntype",Object)],Lr.prototype,"getStats",null),ii([Yt(),it("design:type",Function),it("design:paramtypes",[Object,Number]),it("design:returntype",void 0)],Lr.prototype,"setAudioFrameCallback",null),ii([Yt(),it("design:type",Function),it("design:paramtypes",[]),it("design:returntype",void 0)],Lr.prototype,"play",null),ii([Yt(),it("design:type",Function),it("design:paramtypes",[]),it("design:returntype",void 0)],Lr.prototype,"stop",null);class gl extends Lr{constructor(n,s,c,u){super(n,s.encoderConfig?La(s.encoderConfig):{},u);this._deviceName="default",this._enabled=!0,this._config=s,this._constraints=c,this._deviceName=n.label,typeof s.bypassWebAudio=="boolean"&&(this._bypassWebAudio=s.bypassWebAudio),bi()&&At.bindInterruptDetectorTrack(this)}async setDevice(n){var s,c;let u=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.MIC_AUDIO_TRACK_SET_DEVICE,options:[this.getTrackId(),n]});if(R.info(b(s="[".concat(this.getTrackId(),"] start set device to ")).call(s,n)),this._enabled)try{let h=await Vn.getDeviceById(n);s={},s.audio=Ru({},this._constraints),s.audio.deviceId={exact:n},this._originMediaStreamTrack.stop();let f=null;try{f=await Di(s,this.getTrackId())}catch(A){throw R.error("[".concat(this.getTrackId(),"] setDevice failed"),A.toString()),f=await Di({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(f.getAudioTracks()[0],!1),A}await this._updateOriginMediaStreamTrack(f.getAudioTracks()[0],!1),this._deviceName=h.label,this._config.microphoneId=n,this._constraints.deviceId={exact:n}}catch(h){throw u.onError(h),R.error("[".concat(this.getTrackId(),"] setDevice error"),h.toString()),h}else try{this._deviceName=(await Vn.getDeviceById(n)).label,this._config.microphoneId=n,this._constraints.deviceId={exact:n}}catch(h){throw u.onError(h),R.error("[".concat(this.getTrackId(),"] setDevice error"),h.toString()),h}u.onSuccess(),R.info(b(c="[".concat(this.getTrackId(),"] set device to ")).call(c,n," success"))}async setEnabled(n,s,c){if(s)return R.debug("[".concat(this.getTrackId,"] setEnabled false (do not close microphone)")),await super.setEnabled(n);if(!c){if(n===this._enabled)return;this.stateCheck("enabled",n)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),n),s=await this._enabledMutex.lock(),!n){this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),c||(this._enabled=!1);try{await sn(this,Be.NEED_REMOVE_TRACK,this)}catch(h){throw R.error("[".concat(this.getTrackId(),"] setEnabled false failed"),h.toString()),s(),h}return void s()}n=Ru({},this._constraints);let u=Vn.searchDeviceIdByName(this._deviceName);u&&!n.deviceId&&(n.deviceId=u);try{let h=await Di({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),await sn(this,Be.NEED_ADD_TRACK,this)}catch(h){throw s(),R.error("[".concat(this.getTrackId(),"] setEnabled true failed"),h.toString()),h}c||(this._enabled=!0),R.info("[".concat(this.getTrackId(),"] setEnabled success")),s()}close(){super.close(),bi()&&At.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((xn()||Eo())&&this._enabled&&!this._isClosed&&At.duringInterruption){let n=async()=>{At.off(en.IOS_INTERRUPTION_END,n),this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};At.on(en.IOS_INTERRUPTION_END,n)}else R.debug("[".concat(this.getTrackId(),"] track ended")),this.emit(aa.TRACK_ENDED)}async renewMediaStreamTrack(){var n=Ru({},this._constraints);let s=Vn.searchDeviceIdByName(this._deviceName);s&&!n.deviceId&&(n.deviceId=s),n=await Di({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(n.getAudioTracks()[0],!0)}}ii([Yt(),it("design:type",Function),it("design:paramtypes",[String]),it("design:returntype",se)],gl.prototype,"setDevice",null),ii([Yt(),it("design:type",Function),it("design:paramtypes",[Boolean,Boolean,Boolean]),it("design:returntype",se)],gl.prototype,"setEnabled",null);class sc extends Lr{constructor(n,s,c,u){super(s.createOutputTrack(),c,u);this.source=n,this._bufferSource=s,this._bufferSource.on(Qi.AUDIO_SOURCE_STATE_CHANGE,h=>{this.emit(aa.SOURCE_STATE_CHANGE,h)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(n){let s=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.BUFFER_AUDIO_TRACK_START,options:[this.getTrackId(),n,this.duration]});n&&this._bufferSource.updateOptions(n),this._bufferSource.startProcessAudioBuffer(),s.onSuccess()}pauseProcessAudioBuffer(){let n=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.BUFFER_AUDIO_TRACK_PAUSE,options:[this.getTrackId()]});this._bufferSource.pauseProcessAudioBuffer(),n.onSuccess()}seekAudioBuffer(n){let s=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.BUFFER_AUDIO_TRACK_SEEK,options:[this.getTrackId()]});this._bufferSource.seekAudioBuffer(n),s.onSuccess()}resumeProcessAudioBuffer(){let n=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.BUFFER_AUDIO_TRACK_RESUME,options:[this.getTrackId()]});this._bufferSource.resumeProcessAudioBuffer(),n.onSuccess()}stopProcessAudioBuffer(){let n=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.BUFFER_AUDIO_TRACK_STOP,options:[this.getTrackId()]});this._bufferSource.stopProcessAudioBuffer(),n.onSuccess()}}ii([Yt(),it("design:type",Function),it("design:paramtypes",[Object]),it("design:returntype",void 0)],sc.prototype,"startProcessAudioBuffer",null),ii([Yt(),it("design:type",Function),it("design:paramtypes",[]),it("design:returntype",void 0)],sc.prototype,"pauseProcessAudioBuffer",null),ii([Yt(),it("design:type",Function),it("design:paramtypes",[Number]),it("design:returntype",void 0)],sc.prototype,"seekAudioBuffer",null),ii([Yt(),it("design:type",Function),it("design:paramtypes",[]),it("design:returntype",void 0)],sc.prototype,"resumeProcessAudioBuffer",null),ii([Yt(),it("design:type",Function),it("design:paramtypes",[]),it("design:returntype",void 0)],sc.prototype,"stopProcessAudioBuffer",null);class un extends Lr{constructor(){let n=Wc().createMediaStreamDestination();super(n.stream.getAudioTracks()[0],void 0,or(8,"track-mix-"));try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=n,this.trackList=[]}get isActive(){var n;return!(!this.trackList.length||!Xe(n=this.trackList).call(n,s=>!s.muted))}getSubTrackLabels(){var n;return Ie(n=this.trackList).call(n,s=>s.getTrackLabel())}hasAudioTrack(n){var s;return Ke(s=this.trackList).call(s,n)!==-1}addAudioTrack(n){var s;Ke(s=this.trackList).call(s,n)===-1?(R.debug("add ".concat(n.getTrackId()," to mixing track")),n._source.outputNode.connect(this.destNode),this.trackList.push(n),this.updateEncoderConfig()):R.debug("track ".concat(n.getTrackId()," is already added"))}removeAudioTrack(n){var s;if(Ke(s=this.trackList).call(s,n)!==-1){R.debug("remove ".concat(n.getTrackId()," from mixing track"));try{n._source.outputNode.disconnect(this.destNode)}catch{}Js(this.trackList,n),this.updateEncoderConfig()}}updateEncoderConfig(){var n;let s={};K(n=this.trackList).call(n,c=>{c._encoderConfig&&((c._encoderConfig.bitrate||0)>(s.bitrate||0)&&(s.bitrate=c._encoderConfig.bitrate),(c._encoderConfig.sampleRate||0)>(s.sampleRate||0)&&(s.sampleRate=c._encoderConfig.sampleRate),(c._encoderConfig.sampleSize||0)>(s.sampleSize||0)&&(s.sampleSize=c._encoderConfig.sampleSize),c._encoderConfig.stereo&&(s.stereo=!0))}),this._encoderConfig=s}}class pw extends Zr{constructor(){super(...arguments);this.resultStorage=new Tt}setLocalAudioStats(n,s,c){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",n,this.checkAudioInputLevel(c,s)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",n,this.checkSendAudioBitrate(c,s))}setLocalVideoStats(n,s,c){this.record("SEND_VIDEO_BITRATE_TOO_LOW",n,this.checkSendVideoBitrate(c,s)),this.record("FRAMERATE_INPUT_TOO_LOW",n,this.checkFramerateInput(c,s)),this.record("FRAMERATE_SENT_TOO_LOW",n,this.checkFramerateSent(c))}setRemoteAudioStats(n,s){n=n.getUserId(),this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",n,this.checkAudioOutputLevel(s))}setRemoteVideoStats(n,s){n=n.getUserId(),this.record("RECV_VIDEO_DECODE_FAILED",n,this.checkVideoDecode(s))}record(n,s,c){this.resultStorage.has(n)||this.resultStorage.set(n,{result:[],isPrevNormal:!0});let u=this.resultStorage.get(n);if(u&&(u.result.push(c),5<=u.result.length)){var h;c=vt(h=u.result).call(h,!0),u.isPrevNormal&&!c&&this.emit("exception",B1[n],n,s),!u.isPrevNormal&&c&&this.emit("exception",B1[n]+2e3,n+"_RECOVER",s),u.isPrevNormal=c,u.result=[]}}checkAudioOutputLevel(n){return!(0<n.receiveBitrate&&n.receiveLevel===0)}checkAudioInputLevel(n,s){return s instanceof un&&!s.isActive||!!s.muted||n.sendVolumeLevel!==0}checkFramerateInput(n,s){let c=null;return s._encoderConfig&&s._encoderConfig.frameRate&&(c=fs(s._encoderConfig.frameRate)),n=n.captureFrameRate,!c||!n||!(10<c&&5>n||10>c&&5<=c&&1>=n)}checkFramerateSent(n){return!(n.captureFrameRate&&n.sendFrameRate&&5<n.captureFrameRate&&1>=n.sendFrameRate)}checkSendVideoBitrate(n,s){return!!s.muted||n.sendBitrate!==0}checkSendAudioBitrate(n,s){return s instanceof un&&!s.isActive||!!s.muted||n.sendBitrate!==0}checkVideoDecode(n){return n.receiveBitrate===0||n.decodeFrameRate!==0}}let B1={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003};class ac{constructor(n){this.localConnectionsMap=new Tt,this.remoteConnectionsMap=new Tt,this.trafficStatsPeerList=[],this.updateStats=()=>{var s,c;K(s=this.remoteConnectionsMap).call(s,u=>{var h;let f=u.audioStats;var A=u.videoStats,m=u.pcStats;let I=Co({},Fp),E=Co({},Vp),_=Co({},s1),S=u.connection.pc.getStats(),N=S.audioRecv[0],O=S.videoRecv[0];m=m?m.videoRecv[0]:void 0;let B=u.connection.pc._statsFilter.videoIsReady===!0,P=this.trafficStats&&Xe(h=this.trafficStats.peer_delay).call(h,J=>J.peer_uid===u.connection.getUserId());N&&(N.codec!=="opus"&&N.codec!=="aac"||(I.codecType=N.codec),N.outputLevel?I.receiveLevel=Math.round(32767*N.outputLevel):u.connection.user.audioTrack&&(I.receiveLevel=Math.round(32767*u.connection.user.audioTrack.getVolumeLevel())),I.receiveBytes=N.bytes,I.receivePackets=N.packets,I.receivePacketsLost=N.packetsLost,I.packetLossRate=I.receivePacketsLost/(I.receivePackets+I.receivePacketsLost),I.receiveBitrate=f?8*Math.max(0,I.receiveBytes-f.receiveBytes):0,I.totalDuration=f?f.totalDuration+1:1,I.totalFreezeTime=f?f.totalFreezeTime:0,I.freezeRate=I.totalFreezeTime/I.totalDuration,I.receiveDelay=N.jitterBufferMs,h=u.connection.user.audioTrack,10<I.totalDuration&&ac.isRemoteAudioFreeze(h)&&(I.totalFreezeTime+=1)),O&&(O.codec!=="H264"&&O.codec!=="VP8"&&O.codec!=="VP9"&&O.codec!=="AV1X"||(E.codecType=O.codec),E.receiveBytes=O.bytes,E.receiveBitrate=A?8*Math.max(0,E.receiveBytes-A.receiveBytes):0,E.decodeFrameRate=O.decodeFrameRate,E.renderFrameRate=O.decodeFrameRate,O.outputFrame&&(E.renderFrameRate=O.outputFrame.frameRate),O.receivedFrame?(E.receiveFrameRate=O.receivedFrame.frameRate,E.receiveResolutionHeight=O.receivedFrame.height,E.receiveResolutionWidth=O.receivedFrame.width):u.connection.user.videoTrack&&(E.receiveResolutionHeight=u.connection.user.videoTrack._videoHeight||0,E.receiveResolutionWidth=u.connection.user.videoTrack._videoWidth||0),O.framesRateFirefox!==void 0&&(E.receiveFrameRate=Math.round(O.framesRateFirefox)),E.receivePackets=O.packets,E.receivePacketsLost=O.packetsLost,E.packetLossRate=E.receivePacketsLost/(E.receivePackets+E.receivePacketsLost),E.totalDuration=A?A.totalDuration+1:1,E.totalFreezeTime=A?A.totalFreezeTime:0,E.receiveDelay=O.jitterBufferMs||0,A=u.connection.user.videoTrack,u.connection.subscribeOptions.video&&B&&ac.isRemoteVideoFreeze(A,O,m)&&(E.totalFreezeTime+=1),E.freezeRate=E.totalFreezeTime/E.totalDuration),P&&(I.end2EndDelay=P.B_ad,E.end2EndDelay=P.B_vd,I.transportDelay=P.B_ed,E.transportDelay=P.B_ed,I.currentPacketLossRate=P.B_ealr4/100,E.currentPacketLossRate=P.B_evlr4/100,_.uplinkNetworkQuality=P.B_punq?P.B_punq:0,_.downlinkNetworkQuality=P.B_pdnq?P.B_punq:0),u.audioStats=I,u.videoStats=E,u.pcStats=S,u.networkStats=_,u.connection.user.audioTrack&&this.exceptionMonitor.setRemoteAudioStats(u.connection.user.audioTrack,I),u.connection.user.videoTrack&&this.exceptionMonitor.setRemoteVideoStats(u.connection.user.videoTrack,E)}),K(c=this.localConnectionsMap).call(c,u=>{let h=u.audioStats,f=u.videoStats,A=Co({},id),m=Co({},od);var I=u.connection.pc.getStats();let E=I.audioSend[0];I=I.videoSend[0];let _=u.connection.getUserId();E&&(E.codec!=="opus"&&E.codec!=="aac"||(A.codecType=E.codec),E.inputLevel?A.sendVolumeLevel=Math.round(32767*E.inputLevel):u.connection.audioTrack&&(A.sendVolumeLevel=Math.round(32767*u.connection.audioTrack.getVolumeLevel())),A.sendBytes=E.bytes,A.sendPackets=E.packets,A.sendPacketsLost=E.packetsLost,A.sendBitrate=h?8*Math.max(0,A.sendBytes-h.sendBytes):0),I&&(I.codec!=="H264"&&I.codec!=="VP8"&&I.codec!=="VP9"&&I.codec!=="AV1X"||(m.codecType=I.codec),m.sendBytes=I.bytes,m.sendBitrate=f?8*Math.max(0,m.sendBytes-f.sendBytes):0,I.inputFrame?(m.captureFrameRate=I.inputFrame.frameRate,m.captureResolutionHeight=I.inputFrame.height,m.captureResolutionWidth=I.inputFrame.width):u.connection.videoTrack&&(m.captureResolutionWidth=u.connection.videoTrack._videoWidth||0,m.captureResolutionHeight=u.connection.videoTrack._videoHeight||0),I.sentFrame?(m.sendFrameRate=I.sentFrame.frameRate,m.sendResolutionHeight=I.sentFrame.height,m.sendResolutionWidth=I.sentFrame.width):u.connection.videoTrack&&(m.sendResolutionWidth=u.connection.videoTrack._videoWidth||0,m.sendResolutionHeight=u.connection.videoTrack._videoHeight||0),I.avgEncodeMs&&(m.encodeDelay=I.avgEncodeMs),u.connection.videoTrack&&u.connection.videoTrack._encoderConfig&&u.connection.videoTrack._encoderConfig.bitrateMax&&(m.targetSendBitrate=1e3*u.connection.videoTrack._encoderConfig.bitrateMax),m.sendPackets=I.packets,m.sendPacketsLost=I.packetsLost,m.totalDuration=f?f.totalDuration+1:1,m.totalFreezeTime=f?f.totalFreezeTime:0,this.isLocalVideoFreeze(I)&&(m.totalFreezeTime+=1)),this.trafficStats&&(A.sendPacketsLost=this.trafficStats.B_palr4/100,m.sendPacketsLost=this.trafficStats.B_pvlr4/100),u.audioStats=A,u.videoStats=m,u.audioStats&&u.connection.audioTrack&&this.exceptionMonitor.setLocalAudioStats(_,u.connection.audioTrack,u.audioStats),u.videoStats&&u.connection.videoTrack&&this.exceptionMonitor.setLocalVideoStats(_,u.connection.videoTrack,u.videoStats)})},this.clientId=n,this.updateStatsInterval=window.setInterval(this.updateStats,1e3),this.exceptionMonitor=new pw,this.exceptionMonitor.on("exception",(s,c,u)=>{this.onStatsException&&this.onStatsException(s,c,u)})}reset(){this.localConnectionsMap=new Tt,this.remoteConnectionsMap=new Tt,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(n){return(n=this.localConnectionsMap.get(n))&&n.audioStats?n.audioStats:Co({},id)}getLocalVideoTrackStats(n){return(n=this.localConnectionsMap.get(n))&&n.videoStats?n.videoStats:Co({},od)}getRemoteAudioTrackStats(n){var s;let c=this.remoteConnectionsMap.get(n);return!c||!c.audioStats?Co({},Fp):this.trafficStats?(n=Xe(s=this.trafficStats.peer_delay).call(s,u=>u.peer_uid===c.connection.user.uid),n&&(c.audioStats.publishDuration=n.B_ppad+(le()-this.trafficStats.timestamp)),c.audioStats):c.audioStats}getRemoteNetworkQualityStats(n){return(n=this.remoteConnectionsMap.get(n))&&n.networkStats?n.networkStats:Co({},s1)}getRemoteVideoTrackStats(n){var s;let c=this.remoteConnectionsMap.get(n);return!c||!c.videoStats?Co({},Vp):this.trafficStats?(n=Xe(s=this.trafficStats.peer_delay).call(s,u=>u.peer_uid===c.connection.user.uid),n&&(c.videoStats.publishDuration=n.B_ppvd+(le()-this.trafficStats.timestamp)),c.videoStats):c.videoStats}getRTCStats(){var n,s;let c=0,u=0,h=0,f=0;return K(n=this.localConnectionsMap).call(n,A=>{A.audioStats&&(c+=A.audioStats.sendBytes,u+=A.audioStats.sendBitrate),A.videoStats&&(c+=A.videoStats.sendBytes,u+=A.videoStats.sendBitrate)}),K(s=this.remoteConnectionsMap).call(s,A=>{A.audioStats&&(h+=A.audioStats.receiveBytes,f+=A.audioStats.receiveBitrate),A.videoStats&&(h+=A.videoStats.receiveBytes,f+=A.videoStats.receiveBitrate)}),n=1,this.trafficStats&&(n+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:n,SendBitrate:u,SendBytes:c,RecvBytes:h,RecvBitrate:f,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}removeConnection(n){this.localConnectionsMap.delete(n),this.remoteConnectionsMap.delete(n)}addLocalConnection(n){let s=n.connectionId;this.localConnectionsMap.has(s)||this.localConnectionsMap.set(s,{connection:n})}addRemoteConnection(n){let s=n.connectionId;this.remoteConnectionsMap.has(s)||this.remoteConnectionsMap.set(s,{connection:n})}updateTrafficStats(n){var s;let c=Qe(s=n.peer_delay).call(s,u=>{var h;return Ke(h=this.trafficStatsPeerList).call(h,u.peer_uid)===-1});K(c).call(c,u=>{var h,f;let A=Xe(h=oo(ca(f=this.remoteConnectionsMap).call(f))).call(h,m=>m.connection._userId===u.peer_uid);u.B_ppad!==void 0&&u.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(u.peer_uid,u.B_ppad,u.B_ppvd,A?le()-A.connection.startTime:0),this.trafficStatsPeerList.push(u.peer_uid))}),this.trafficStats=n}updateUplinkStats(n){var s;this.uplinkStats&&this.uplinkStats.B_fir!==n.B_fir&&R.debug(b(s="[".concat(this.clientId,"]: Period fir changes to ")).call(s,n.B_fir)),this.uplinkStats=n}static isRemoteVideoFreeze(n,s,c){return n?(n=!c||s.framesDecodeCount>c.framesDecodeCount,!!c&&s.framesDecodeFreezeTime>c.framesDecodeFreezeTime||!n):!1}static isRemoteAudioFreeze(n){return!!n&&n._isFreeze()}isLocalVideoFreeze(n){return!(!n.inputFrame||!n.sentFrame)&&5<n.inputFrame.frameRate&&3>n.sentFrame.frameRate}}var M1;let ud=()=>{},L1={},P1=new class{constructor(){this.fnMap=new Tt}throttleByKey(i,n,s,c,...u){if(this.fnMap.has(n)){var h=this.fnMap.get(n);h.threshold!==s?(h.fn(...h.args),clearTimeout(h.timer),h=window.setTimeout(()=>{const f=this.fnMap.get(n);f&&f.fn(...f.args),this.fnMap.delete(n)},s),this.fnMap.set(n,{fn:i,threshold:s,timer:h,args:u,skipFn:c})):(h.skipFn&&h.skipFn(...h.args),this.fnMap.set(n,Gh({},h,{fn:i,args:u,skipFn:c})))}else h=window.setTimeout(()=>{const f=this.fnMap.get(n);f&&f.fn(...f.args),this.fnMap.delete(n)},s),this.fnMap.set(n,{fn:i,threshold:s,timer:h,args:u,skipFn:c})}},x1=fr(M1=P1.throttleByKey).call(M1,P1),cc=async({fragementLength:i,referenceList:n,asyncMapHandler:s,allFailedhandler:c,promisesCollector:u})=>{let h=0,f,A=0;const m=async()=>{const I=(()=>{var E=h*i;const _=E+i;return E=Gr(n).call(n,E,_),Ie(E).call(E,s)})();u&&u.push(...I);try{f=await Qa(I)}catch(E){if(A+=i,h++,!(A>=n.length))return void await m();c(E)}K(I).call(I,E=>E.cancel())};return await m(),f},fw={[nc.ACCESS_POINT]:{[Xr.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Xr.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Xr.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Xr.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Xr.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Xr.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voice service available",retry:!0},[Xr.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Xr.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Xr.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Xr.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Xr.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Xr.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Xr.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Xr.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Xr.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Xr.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[nc.UNILBS]:{[ti.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[ti.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[ti.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[ti.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[ti.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[ti.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[ti.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[ti.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[ti.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[ti.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[ti.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[ti.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[nc.STRING_UID_ALLOCATOR]:{[dl.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[dl.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[dl.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}},Aw={[Oe.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Oe.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Oe.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Oe.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Oe.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Oe.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Oe.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Oe.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Oe.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Oe.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Oe.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Oe.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Oe.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Oe.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Oe.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Oe.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Oe.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Oe.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Oe.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Oe.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Oe.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Oe.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Oe.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Oe.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Oe.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Oe.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Oe.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Oe.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Oe.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Oe.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Oe.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Oe.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Oe.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Oe.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Oe.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Oe.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Oe.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Oe.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Oe.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Oe.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Oe.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Oe.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Oe.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Oe.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Oe.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Oe.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Oe.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Oe.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Oe.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Oe.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Oe.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Oe.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Oe.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Oe.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Oe.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Oe.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"}};var gw=r(function(i,n){i.exports=function(){function s(U){for(var T=U.length,F=0,j=0;j<T;){var $=U.charCodeAt(j++);if((4294967168&$)!=0)if((4294965248&$)==0)F+=2;else{if(55296<=$&&56319>=$&&j<T){var W=U.charCodeAt(j);(64512&W)==56320&&(++j,$=((1023&$)<<10)+(1023&W)+65536)}F+=(4294901760&$)==0?3:4}else F++}return F}function c(U,T,F){F=T+F;for(var j=[],$="";T<F;){var W=U[T++];if((128&W)==0)j.push(W);else if((224&W)==192){var Ce=63&U[T++];j.push((31&W)<<6|Ce)}else if((240&W)==224){Ce=63&U[T++];var ie=63&U[T++];j.push((31&W)<<12|Ce<<6|ie)}else(248&W)==240&&(W=(7&W)<<18|(63&U[T++])<<12|(63&U[T++])<<6|63&U[T++],65535<W&&(W-=65536,j.push(W>>>10&1023|55296),W=56320|1023&W)),j.push(W);4096<=j.length&&($+=String.fromCharCode.apply(String,ve([],Rt(j))),j.length=0)}return 0<j.length&&($+=String.fromCharCode.apply(String,ve([],Rt(j)))),$}function u(U,T){return 4294967296*U.getInt32(T)+U.getUint32(T+4)}function h(U){var T,F=U.sec;if(U=U.nsec,0<=F&&0<=U&&17179869183>=F){if(U===0&&4294967295>=F){var j=new Uint8Array(4);return new DataView(j.buffer).setUint32(0,F),j}var $=F/4294967296;return F&=4294967295,j=new Uint8Array(8),(T=new DataView(j.buffer)).setUint32(0,U<<2|3&$),T.setUint32(4,F),j}return j=new Uint8Array(12),(T=new DataView(j.buffer)).setUint32(0,U),T.setUint32(4,Math.floor(F/4294967296)),T.setUint32(8,F),j}function f(U){var T=U.getTime();U=Math.floor(T/1e3),T=1e6*(T-1e3*U);var F=Math.floor(T/1e9);return{sec:U+F,nsec:T-1e9*F}}function A(U){return U instanceof Date?h(f(U)):null}function m(U){var T=new DataView(U.buffer,U.byteOffset,U.byteLength);switch(U.byteLength){case 4:return{sec:T.getUint32(0),nsec:0};case 8:return U=T.getUint32(0),{sec:4294967296*(3&U)+T.getUint32(4),nsec:U>>>2};case 12:return{sec:u(T,4),nsec:T.getUint32(0)};default:throw Error("Unrecognized data size for timestamp: "+U.length)}}function I(U){return U=m(U),new Date(1e3*U.sec+U.nsec/1e6)}function E(U){return U instanceof Uint8Array?U:ArrayBuffer.isView(U)?new Uint8Array(U.buffer,U.byteOffset,U.byteLength):U instanceof ArrayBuffer?new Uint8Array(U):Uint8Array.from(U)}function _(U,T){return T===void 0&&(T=_e),new Le(T.extensionCodec,T.context,T.maxDepth,T.initialBufferSize,T.sortKeys,T.forceFloat32,T.ignoreUndefined,T.forceIntegerToFloat).encode(U)}function S(U){return(0>U?"-":"")+"0x"+Math.abs(U).toString(16).padStart(2,"0")}function N(U,T){return T===void 0&&(T=Ac),new fc(T.extensionCodec,T.context,T.maxStrLength,T.maxBinLength,T.maxArrayLength,T.maxMapLength,T.maxExtLength).decode(U)}function O(U,T){return T===void 0&&(T=Ac),new fc(T.extensionCodec,T.context,T.maxStrLength,T.maxBinLength,T.maxArrayLength,T.maxMapLength,T.maxExtLength).decodeMulti(U)}function B(U){return U[Symbol.asyncIterator]!=null?U:function(T){return KN(this,arguments,function(){var F,j,$,W;return HN(this,function(Ce){switch(Ce.label){case 0:F=T.getReader(),Ce.label=1;case 1:Ce.trys.push([1,,9,10]),Ce.label=2;case 2:return[4,gc(F.read())];case 3:return j=Ce.sent(),$=j.done,W=j.value,$?[4,gc(void 0)]:[3,5];case 4:return[2,Ce.sent()];case 5:if(W==null)throw Error("Assertion Failure: value must not be null nor undefined");return[4,gc(W)];case 6:return[4,Ce.sent()];case 7:return Ce.sent(),[3,2];case 8:return[3,10];case 9:return F.releaseLock(),[7];case 10:return[2]}})})}(U)}function P(U,T){return T===void 0&&(T=Ac),F=this,j=void 0,W=function(){var Ce;return function(ie,Ye){function Ut(Ci){return function(mc){return function(gt){if(ae)throw new TypeError("Generator is already executing.");for(;ht;)try{if(ae=1,Se&&(Ee=2&gt[0]?Se.return:gt[0]?Se.throw||((Ee=Se.return)&&Ee.call(Se),0):Se.next)&&!(Ee=Ee.call(Se,gt[1])).done)return Ee;switch(Se=0,Ee&&(gt=[2&gt[0],Ee.value]),gt[0]){case 0:case 1:Ee=gt;break;case 4:return ht.label++,{value:gt[1],done:!1};case 5:ht.label++,Se=gt[1],gt=[0];continue;case 7:gt=ht.ops.pop(),ht.trys.pop();continue;default:if(!((Ee=0<(Ee=ht.trys).length&&Ee[Ee.length-1])||gt[0]!==6&&gt[0]!==2)){ht=0;continue}if(gt[0]===3&&(!Ee||gt[1]>Ee[0]&&gt[1]<Ee[3]))ht.label=gt[1];else if(gt[0]===6&&ht.label<Ee[1])ht.label=Ee[1],Ee=gt;else if(Ee&&ht.label<Ee[2])ht.label=Ee[2],ht.ops.push(gt);else{Ee[2]&&ht.ops.pop(),ht.trys.pop();continue}}gt=Ye.call(ie,ht)}catch(Sd){gt=[6,Sd],Se=0}finally{ae=Ee=0}if(5&gt[0])throw gt[1];return{value:gt[0]?gt[1]:void 0,done:!0}}([Ci,mc])}}var ae,Se,Ee,Wt,ht={label:0,sent:function(){if(1&Ee[0])throw Ee[1];return Ee[1]},trys:[],ops:[]};return Wt={next:Ut(0),throw:Ut(1),return:Ut(2)},typeof Symbol=="function"&&(Wt[Symbol.iterator]=function(){return this}),Wt}(this,function(ie){return Ce=B(U),[2,new fc(T.extensionCodec,T.context,T.maxStrLength,T.maxBinLength,T.maxArrayLength,T.maxMapLength,T.maxExtLength).decodeAsync(Ce)]})},new($=void 0,$=Promise)(function(Ce,ie){function Ye(Se){try{ae(W.next(Se))}catch(Ee){ie(Ee)}}function Ut(Se){try{ae(W.throw(Se))}catch(Ee){ie(Ee)}}function ae(Se){var Ee;Se.done?Ce(Se.value):(Ee=Se.value,Ee instanceof $?Ee:new $(function(Wt){Wt(Ee)})).then(Ye,Ut)}ae((W=W.apply(F,j||[])).next())});var F,j,$,W}function J(U,T){return T===void 0&&(T=Ac),U=B(U),new fc(T.extensionCodec,T.context,T.maxStrLength,T.maxBinLength,T.maxArrayLength,T.maxMapLength,T.maxExtLength).decodeArrayStream(U)}function ne(U,T){return T===void 0&&(T=Ac),U=B(U),new fc(T.extensionCodec,T.context,T.maxStrLength,T.maxBinLength,T.maxArrayLength,T.maxMapLength,T.maxExtLength).decodeStream(U)}function Ae(U,T){return T===void 0&&(T=Ac),ne(U,T)}var Me={d:function(U,T){for(var F in T)Me.o(T,F)&&!Me.o(U,F)&&Object.defineProperty(U,F,{enumerable:!0,get:T[F]})},o:function(U,T){return Object.prototype.hasOwnProperty.call(U,T)},r:function(U){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(U,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(U,"__esModule",{value:!0})}},be={};Me.r(be),Me.d(be,{DecodeError:function(){return No},Decoder:function(){return fc},EXT_TIMESTAMP:function(){return q},Encoder:function(){return Le},ExtData:function(){return G},ExtensionCodec:function(){return ue},decode:function(){return N},decodeArrayStream:function(){return J},decodeAsync:function(){return P},decodeMulti:function(){return O},decodeMultiStream:function(){return ne},decodeStream:function(){return Ae},decodeTimestampExtension:function(){return I},decodeTimestampToTimeSpec:function(){return m},encode:function(){return _},encodeDateToTimeSpec:function(){return f},encodeTimeSpecToTimestamp:function(){return h},encodeTimestampExtension:function(){return A}});var Rt=function(U,T){var F=typeof Symbol=="function"&&U[Symbol.iterator];if(!F)return U;var j;U=F.call(U);var $=[];try{for(;(T===void 0||0<T--)&&!(j=U.next()).done;)$.push(j.value)}catch(Ce){var W={error:Ce}}finally{try{j&&!j.done&&(F=U.return)&&F.call(U)}finally{if(W)throw W.error}}return $},ve=function(U,T){for(var F=0,j=T.length,$=U.length;F<j;F++,$++)U[$]=T[F];return U},et=typeof TextEncoder!="undefined"&&typeof TextDecoder!="undefined",It=et?new TextEncoder:void 0,zt=et?typeof process!="undefined"?200:0:4294967295,Pr=(It==null?0:It.encodeInto)?function(U,T,F){It.encodeInto(U,T.subarray(F))}:function(U,T,F){T.set(It.encode(U),F)},Vt=et?new TextDecoder:null,dn=et?typeof process!="undefined"?200:0:4294967295,G=function(U,T){this.type=U,this.data=T},q=-1,Z={type:q,encode:A,decode:I},ue=function(){function U(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(Z)}return U.prototype.register=function(T){var F=T.type,j=T.encode;T=T.decode,0<=F?(this.encoders[F]=j,this.decoders[F]=T):(F=1+F,this.builtInEncoders[F]=j,this.builtInDecoders[F]=T)},U.prototype.tryToEncode=function(T,F){for(var j=0;j<this.builtInEncoders.length;j++)if(($=this.builtInEncoders[j])!=null&&(W=$(T,F))!=null)return new G(-1-j,W);for(j=0;j<this.encoders.length;j++){var $,W;if(($=this.encoders[j])!=null&&(W=$(T,F))!=null)return new G(j,W)}return T instanceof G?T:null},U.prototype.decode=function(T,F,j){var $=0>F?this.builtInDecoders[-1-F]:this.decoders[F];return $?$(T,F,j):new G(F,T)},U.defaultCodec=new U,U}(),de=function(U){var T=typeof Symbol=="function"&&Symbol.iterator,F=T&&U[T],j=0;if(F)return F.call(U);if(U&&typeof U.length=="number")return{next:function(){return U&&j>=U.length&&(U=void 0),{value:U&&U[j++],done:!U}}};throw new TypeError(T?"Object is not iterable.":"Symbol.iterator is not defined.")},Le=function(){function U(T,F,j,$,W,Ce,ie,Ye){T===void 0&&(T=ue.defaultCodec),F===void 0&&(F=void 0),j===void 0&&(j=100),$===void 0&&($=2048),W===void 0&&(W=!1),Ce===void 0&&(Ce=!1),ie===void 0&&(ie=!1),Ye===void 0&&(Ye=!1),this.extensionCodec=T,this.context=F,this.maxDepth=j,this.initialBufferSize=$,this.sortKeys=W,this.forceFloat32=Ce,this.ignoreUndefined=ie,this.forceIntegerToFloat=Ye,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}return U.prototype.getUint8Array=function(){return this.bytes.subarray(0,this.pos)},U.prototype.reinitializeState=function(){this.pos=0},U.prototype.encode=function(T){return this.reinitializeState(),this.doEncode(T,1),this.getUint8Array()},U.prototype.doEncode=function(T,F){if(F>this.maxDepth)throw Error("Too deep objects in depth "+F);T==null?this.encodeNil():typeof T=="boolean"?this.encodeBoolean(T):typeof T=="number"?this.encodeNumber(T):typeof T=="string"?this.encodeString(T):this.encodeObject(T,F)},U.prototype.ensureBufferSizeToWrite=function(T){T=this.pos+T,this.view.byteLength<T&&this.resizeBuffer(2*T)},U.prototype.resizeBuffer=function(T){var F=new ArrayBuffer(T);T=new Uint8Array(F),F=new DataView(F),T.set(this.bytes),this.view=F,this.bytes=T},U.prototype.encodeNil=function(){this.writeU8(192)},U.prototype.encodeBoolean=function(T){T===!1?this.writeU8(194):this.writeU8(195)},U.prototype.encodeNumber=function(T){Number.isSafeInteger(T)&&!this.forceIntegerToFloat?0<=T?128>T?this.writeU8(T):256>T?(this.writeU8(204),this.writeU8(T)):65536>T?(this.writeU8(205),this.writeU16(T)):4294967296>T?(this.writeU8(206),this.writeU32(T)):(this.writeU8(207),this.writeU64(T)):-32<=T?this.writeU8(224|T+32):-128<=T?(this.writeU8(208),this.writeI8(T)):-32768<=T?(this.writeU8(209),this.writeI16(T)):-2147483648<=T?(this.writeU8(210),this.writeI32(T)):(this.writeU8(211),this.writeI64(T)):this.forceFloat32?(this.writeU8(202),this.writeF32(T)):(this.writeU8(203),this.writeF64(T))},U.prototype.writeStringHeader=function(T){if(32>T)this.writeU8(160+T);else if(256>T)this.writeU8(217),this.writeU8(T);else if(65536>T)this.writeU8(218),this.writeU16(T);else{if(!(4294967296>T))throw Error("Too long string: "+T+" bytes in UTF-8");this.writeU8(219),this.writeU32(T)}},U.prototype.encodeString=function(T){if(T.length>zt){var F=s(T);this.ensureBufferSizeToWrite(5+F),this.writeStringHeader(F),Pr(T,this.bytes,this.pos)}else{F=s(T),this.ensureBufferSizeToWrite(5+F),this.writeStringHeader(F);for(var j=this.bytes,$=T.length,W=this.pos,Ce=0;Ce<$;){var ie=T.charCodeAt(Ce++);if((4294967168&ie)!=0){if((4294965248&ie)==0)j[W++]=ie>>6&31|192;else{if(55296<=ie&&56319>=ie&&Ce<$){var Ye=T.charCodeAt(Ce);(64512&Ye)==56320&&(++Ce,ie=((1023&ie)<<10)+(1023&Ye)+65536)}(4294901760&ie)==0?(j[W++]=ie>>12&15|224,j[W++]=ie>>6&63|128):(j[W++]=ie>>18&7|240,j[W++]=ie>>12&63|128,j[W++]=ie>>6&63|128)}j[W++]=63&ie|128}else j[W++]=ie}}this.pos+=F},U.prototype.encodeObject=function(T,F){var j=this.extensionCodec.tryToEncode(T,this.context);if(j!=null)this.encodeExtension(j);else if(Array.isArray(T))this.encodeArray(T,F);else if(ArrayBuffer.isView(T))this.encodeBinary(T);else{if(typeof T!="object")throw Error("Unrecognized object: "+Object.prototype.toString.apply(T));this.encodeMap(T,F)}},U.prototype.encodeBinary=function(T){var F=T.byteLength;if(256>F)this.writeU8(196),this.writeU8(F);else if(65536>F)this.writeU8(197),this.writeU16(F);else{if(!(4294967296>F))throw Error("Too large binary: "+F);this.writeU8(198),this.writeU32(F)}T=E(T),this.writeU8a(T)},U.prototype.encodeArray=function(T,F){var j,$=T.length;if(16>$)this.writeU8(144+$);else if(65536>$)this.writeU8(220),this.writeU16($);else{if(!(4294967296>$))throw Error("Too large array: "+$);this.writeU8(221),this.writeU32($)}try{for(var W=de(T),Ce=W.next();!Ce.done;Ce=W.next())this.doEncode(Ce.value,F+1)}catch(Ye){var ie={error:Ye}}finally{try{Ce&&!Ce.done&&(j=W.return)&&j.call(W)}finally{if(ie)throw ie.error}}},U.prototype.countWithoutUndefined=function(T,F){var j,$=0;try{for(var W=de(F),Ce=W.next();!Ce.done;Ce=W.next())T[Ce.value]!==void 0&&$++}catch(Ye){var ie={error:Ye}}finally{try{Ce&&!Ce.done&&(j=W.return)&&j.call(W)}finally{if(ie)throw ie.error}}return $},U.prototype.encodeMap=function(T,F){var j,$=Object.keys(T);this.sortKeys&&$.sort();var W=this.ignoreUndefined?this.countWithoutUndefined(T,$):$.length;if(16>W)this.writeU8(128+W);else if(65536>W)this.writeU8(222),this.writeU16(W);else{if(!(4294967296>W))throw Error("Too large map object: "+W);this.writeU8(223),this.writeU32(W)}try{for(var Ce=de($),ie=Ce.next();!ie.done;ie=Ce.next()){var Ye=ie.value,Ut=T[Ye];this.ignoreUndefined&&Ut===void 0||(this.encodeString(Ye),this.doEncode(Ut,F+1))}}catch(Se){var ae={error:Se}}finally{try{ie&&!ie.done&&(j=Ce.return)&&j.call(Ce)}finally{if(ae)throw ae.error}}},U.prototype.encodeExtension=function(T){var F=T.data.length;if(F===1)this.writeU8(212);else if(F===2)this.writeU8(213);else if(F===4)this.writeU8(214);else if(F===8)this.writeU8(215);else if(F===16)this.writeU8(216);else if(256>F)this.writeU8(199),this.writeU8(F);else if(65536>F)this.writeU8(200),this.writeU16(F);else{if(!(4294967296>F))throw Error("Too large extension object: "+F);this.writeU8(201),this.writeU32(F)}this.writeI8(T.type),this.writeU8a(T.data)},U.prototype.writeU8=function(T){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,T),this.pos++},U.prototype.writeU8a=function(T){var F=T.length;this.ensureBufferSizeToWrite(F),this.bytes.set(T,this.pos),this.pos+=F},U.prototype.writeI8=function(T){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,T),this.pos++},U.prototype.writeU16=function(T){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,T),this.pos+=2},U.prototype.writeI16=function(T){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,T),this.pos+=2},U.prototype.writeU32=function(T){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,T),this.pos+=4},U.prototype.writeI32=function(T){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,T),this.pos+=4},U.prototype.writeF32=function(T){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,T),this.pos+=4},U.prototype.writeF64=function(T){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,T),this.pos+=8},U.prototype.writeU64=function(T){this.ensureBufferSizeToWrite(8);var F=this.view,j=this.pos;F.setUint32(j,T/4294967296),F.setUint32(j+4,T),this.pos+=8},U.prototype.writeI64=function(T){this.ensureBufferSizeToWrite(8);var F=this.view,j=this.pos;F.setUint32(j,Math.floor(T/4294967296)),F.setUint32(j+4,T),this.pos+=8},U}(),_e={},Tr;et=function(){function U(T,F){for(T===void 0&&(T=16),F===void 0&&(F=16),this.maxKeyLength=T,this.maxLengthPerKey=F,this.miss=this.hit=0,this.caches=[],T=0;T<this.maxKeyLength;T++)this.caches.push([])}return U.prototype.canBeCached=function(T){return 0<T&&T<=this.maxKeyLength},U.prototype.find=function(T,F,j){var $,W=this.caches[j-1];try{var Ce=function(Se){var Ee=typeof Symbol=="function"&&Symbol.iterator,Wt=Ee&&Se[Ee],ht=0;if(Wt)return Wt.call(Se);if(Se&&typeof Se.length=="number")return{next:function(){return Se&&ht>=Se.length&&(Se=void 0),{value:Se&&Se[ht++],done:!Se}}};throw new TypeError(Ee?"Object is not iterable.":"Symbol.iterator is not defined.")}(W),ie=Ce.next();e:for(;!ie.done;ie=Ce.next()){var Ye=ie.value,Ut=Ye.bytes;for(W=0;W<j;W++)if(Ut[W]!==T[F+W])continue e;return Ye.str}}catch(Se){var ae={error:Se}}finally{try{ie&&!ie.done&&($=Ce.return)&&$.call(Ce)}finally{if(ae)throw ae.error}}return null},U.prototype.store=function(T,F){var j=this.caches[T.length-1];T={bytes:T,str:F},j.length>=this.maxLengthPerKey?j[Math.random()*j.length|0]=T:j.push(T)},U.prototype.decode=function(T,F,j){var $=this.find(T,F,j);return $!=null?(this.hit++,$):(this.miss++,$=c(T,F,j),T=Uint8Array.prototype.slice.call(T,F,F+j),this.store(T,$),$)},U}();var ha=(Tr=function(U,T){return(Tr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,j){F.__proto__=j}||function(F,j){for(var $ in j)Object.prototype.hasOwnProperty.call(j,$)&&(F[$]=j[$])})(U,T)},function(U,T){function F(){this.constructor=U}if(typeof T!="function"&&T!==null)throw new TypeError("Class extends value "+String(T)+" is not a constructor or null");Tr(U,T),U.prototype=T===null?Object.create(T):(F.prototype=T.prototype,new F)}),pa=function(U,T){function F(Ye){return function(Ut){return function(ae){if(j)throw new TypeError("Generator is already executing.");for(;ie;)try{if(j=1,$&&(W=2&ae[0]?$.return:ae[0]?$.throw||((W=$.return)&&W.call($),0):$.next)&&!(W=W.call($,ae[1])).done)return W;switch($=0,W&&(ae=[2&ae[0],W.value]),ae[0]){case 0:case 1:W=ae;break;case 4:return ie.label++,{value:ae[1],done:!1};case 5:ie.label++,$=ae[1],ae=[0];continue;case 7:ae=ie.ops.pop(),ie.trys.pop();continue;default:if(!((W=0<(W=ie.trys).length&&W[W.length-1])||ae[0]!==6&&ae[0]!==2)){ie=0;continue}if(ae[0]===3&&(!W||ae[1]>W[0]&&ae[1]<W[3]))ie.label=ae[1];else if(ae[0]===6&&ie.label<W[1])ie.label=W[1],W=ae;else if(W&&ie.label<W[2])ie.label=W[2],ie.ops.push(ae);else{W[2]&&ie.ops.pop(),ie.trys.pop();continue}}ae=T.call(U,ie)}catch(Se){ae=[6,Se],$=0}finally{j=W=0}if(5&ae[0])throw ae[1];return{value:ae[0]?ae[1]:void 0,done:!0}}([Ye,Ut])}}var j,$,W,Ce,ie={label:0,sent:function(){if(1&W[0])throw W[1];return W[1]},trys:[],ops:[]};return Ce={next:F(0),throw:F(1),return:F(2)},typeof Symbol=="function"&&(Ce[Symbol.iterator]=function(){return this}),Ce},pc=function(U){function T($){F[$]=U[$]&&function(W){return new Promise(function(Ce,ie){(function(Ye,Ut,ae,Se){Promise.resolve(Se).then(function(Ee){Ye({value:Ee,done:ae})},Ut)})(Ce,ie,(W=U[$](W)).done,W.value)})}}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var F,j=U[Symbol.asyncIterator];return j?j.call(U):(U=typeof __values=="function"?__values(U):U[Symbol.iterator](),F={},T("next"),T("throw"),T("return"),F[Symbol.asyncIterator]=function(){return this},F)},st=function(U){return this instanceof st?(this.v=U,this):new st(U)},Xt=function(U,T,F){function j(Se){Ut[Se]&&(Ye[Se]=function(Ee){return new Promise(function(Wt,ht){1<ae.push([Se,Ee,Wt,ht])||$(Se,Ee)})})}function $(Se,Ee){try{(Wt=Ut[Se](Ee)).value instanceof st?Promise.resolve(Wt.value.v).then(W,Ce):ie(ae[0][2],Wt)}catch(ht){ie(ae[0][3],ht)}var Wt}function W(Se){$("next",Se)}function Ce(Se){$("throw",Se)}function ie(Se,Ee){Se(Ee),ae.shift(),ae.length&&$(ae[0][0],ae[0][1])}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var Ye,Ut=F.apply(U,T||[]),ae=[];return Ye={},j("next"),j("throw"),j("return"),Ye[Symbol.asyncIterator]=function(){return this},Ye},xr=new DataView(new ArrayBuffer(0)),Rr=new Uint8Array(xr.buffer);e:{try{xr.getInt8(0)}catch(U){var gr=U.constructor;break e}throw Error("never reached")}var ao=new gr("Insufficient data"),Kr=new et,No=function(U){function T(F){F=U.call(this,F)||this;var j=Object.create(T.prototype);return Object.setPrototypeOf(F,j),Object.defineProperty(F,"name",{configurable:!0,enumerable:!1,value:T.name}),F}return ha(T,U),T}(Error),fc=function(){function U(T,F,j,$,W,Ce,ie,Ye){T===void 0&&(T=ue.defaultCodec),F===void 0&&(F=void 0),j===void 0&&(j=4294967295),$===void 0&&($=4294967295),W===void 0&&(W=4294967295),Ce===void 0&&(Ce=4294967295),ie===void 0&&(ie=4294967295),Ye===void 0&&(Ye=Kr),this.extensionCodec=T,this.context=F,this.maxStrLength=j,this.maxBinLength=$,this.maxArrayLength=W,this.maxMapLength=Ce,this.maxExtLength=ie,this.keyDecoder=Ye,this.pos=this.totalPos=0,this.view=xr,this.bytes=Rr,this.headByte=-1,this.stack=[]}return U.prototype.reinitializeState=function(){this.totalPos=0,this.headByte=-1,this.stack.length=0},U.prototype.setBuffer=function(T){this.bytes=E(T),T=this.bytes,T instanceof ArrayBuffer?T=new DataView(T):(T=E(T),T=new DataView(T.buffer,T.byteOffset,T.byteLength)),this.view=T,this.pos=0},U.prototype.appendBuffer=function(T){if(this.headByte!==-1||this.hasRemaining()){var F=this.bytes.subarray(this.pos);T=E(T);var j=new Uint8Array(F.length+T.length);j.set(F),j.set(T,F.length),this.setBuffer(j)}else this.setBuffer(T)},U.prototype.hasRemaining=function(T){return T===void 0&&(T=1),this.view.byteLength-this.pos>=T},U.prototype.createExtraByteError=function(T){var F=this.view;return new RangeError("Extra "+(F.byteLength-this.pos)+" of "+F.byteLength+" byte(s) found at buffer["+T+"]")},U.prototype.decode=function(T){if(this.reinitializeState(),this.setBuffer(T),T=this.doDecodeSync(),this.hasRemaining())throw this.createExtraByteError(this.pos);return T},U.prototype.decodeMulti=function(T){return pa(this,function(F){switch(F.label){case 0:this.reinitializeState(),this.setBuffer(T),F.label=1;case 1:return this.hasRemaining()?[4,this.doDecodeSync()]:[3,3];case 2:return F.sent(),[3,1];case 3:return[2]}})},U.prototype.decodeAsync=function(T){var F,j,$,W,Ce,ie,Ye;return Ce=this,Ye=function(){var Ut,ae,Se,Ee,Wt,ht,Ci,mc;return pa(this,function(gt){switch(gt.label){case 0:Ut=!1,gt.label=1;case 1:gt.trys.push([1,6,7,12]),F=pc(T),gt.label=2;case 2:return[4,F.next()];case 3:if((j=gt.sent()).done)return[3,5];if(Se=j.value,Ut)throw this.createExtraByteError(this.totalPos);this.appendBuffer(Se);try{ae=this.doDecodeSync(),Ut=!0}catch(Sd){if(!(Sd instanceof gr))throw Sd}this.totalPos+=this.pos,gt.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return Ee=gt.sent(),$={error:Ee},[3,12];case 7:return gt.trys.push([7,,10,11]),j&&!j.done&&(W=F.return)?[4,W.call(F)]:[3,9];case 8:gt.sent(),gt.label=9;case 9:return[3,11];case 10:if($)throw $.error;return[7];case 11:return[7];case 12:if(Ut){if(this.hasRemaining())throw this.createExtraByteError(this.totalPos);return[2,ae]}throw ht=(Wt=this).headByte,Ci=Wt.pos,mc=Wt.totalPos,new RangeError("Insufficient data in parsing "+S(ht)+" at "+mc+" ("+Ci+" in the current buffer)")}})},new(ie=void 0,ie=Promise)(function(Ut,ae){function Se(ht){try{Wt(Ye.next(ht))}catch(Ci){ae(Ci)}}function Ee(ht){try{Wt(Ye.throw(ht))}catch(Ci){ae(Ci)}}function Wt(ht){var Ci;ht.done?Ut(ht.value):(Ci=ht.value,Ci instanceof ie?Ci:new ie(function(mc){mc(Ci)})).then(Se,Ee)}Wt((Ye=Ye.apply(Ce,[])).next())})},U.prototype.decodeArrayStream=function(T){return this.decodeMultiAsync(T,!0)},U.prototype.decodeStream=function(T){return this.decodeMultiAsync(T,!1)},U.prototype.decodeMultiAsync=function(T,F){return Xt(this,arguments,function(){var j,$,W,Ce,ie,Ye,Ut,ae,Se;return pa(this,function(Ee){switch(Ee.label){case 0:j=F,$=-1,Ee.label=1;case 1:Ee.trys.push([1,13,14,19]),W=pc(T),Ee.label=2;case 2:return[4,st(W.next())];case 3:if((Ce=Ee.sent()).done)return[3,12];if(ie=Ce.value,F&&$===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(ie),j&&($=this.readArraySize(),j=!1,this.complete()),Ee.label=4;case 4:Ee.trys.push([4,9,,10]),Ee.label=5;case 5:return[4,st(this.doDecodeSync())];case 6:return[4,Ee.sent()];case 7:return Ee.sent(),--$==0?[3,8]:[3,5];case 8:return[3,10];case 9:if(!((Ye=Ee.sent())instanceof gr))throw Ye;return[3,10];case 10:this.totalPos+=this.pos,Ee.label=11;case 11:return[3,2];case 12:return[3,19];case 13:return Ut=Ee.sent(),ae={error:Ut},[3,19];case 14:return Ee.trys.push([14,,17,18]),Ce&&!Ce.done&&(Se=W.return)?[4,st(Se.call(W))]:[3,16];case 15:Ee.sent(),Ee.label=16;case 16:return[3,18];case 17:if(ae)throw ae.error;return[7];case 18:return[7];case 19:return[2]}})})},U.prototype.doDecodeSync=function(){e:for(;;){var T=this.readHeadByte();if(224<=T)T-=256;else if(192>T){if(!(128>T))if(144>T){if((T-=128)!=0){this.pushMapState(T),this.complete();continue e}T={}}else if(160>T){if((T-=144)!=0){this.pushArrayState(T),this.complete();continue e}T=[]}else T-=160,T=this.decodeUtf8String(T,0)}else if(T===192)T=null;else if(T===194)T=!1;else if(T===195)T=!0;else if(T===202)T=this.readF32();else if(T===203)T=this.readF64();else if(T===204)T=this.readU8();else if(T===205)T=this.readU16();else if(T===206)T=this.readU32();else if(T===207)T=this.readU64();else if(T===208)T=this.readI8();else if(T===209)T=this.readI16();else if(T===210)T=this.readI32();else if(T===211)T=this.readI64();else if(T===217)T=this.lookU8(),T=this.decodeUtf8String(T,1);else if(T===218)T=this.lookU16(),T=this.decodeUtf8String(T,2);else if(T===219)T=this.lookU32(),T=this.decodeUtf8String(T,4);else if(T===220){if((T=this.readU16())!==0){this.pushArrayState(T),this.complete();continue e}T=[]}else if(T===221){if((T=this.readU32())!==0){this.pushArrayState(T),this.complete();continue e}T=[]}else if(T===222){if((T=this.readU16())!==0){this.pushMapState(T),this.complete();continue e}T={}}else if(T===223){if((T=this.readU32())!==0){this.pushMapState(T),this.complete();continue e}T={}}else if(T===196)T=this.lookU8(),T=this.decodeBinary(T,1);else if(T===197)T=this.lookU16(),T=this.decodeBinary(T,2);else if(T===198)T=this.lookU32(),T=this.decodeBinary(T,4);else if(T===212)T=this.decodeExtension(1,0);else if(T===213)T=this.decodeExtension(2,0);else if(T===214)T=this.decodeExtension(4,0);else if(T===215)T=this.decodeExtension(8,0);else if(T===216)T=this.decodeExtension(16,0);else if(T===199)T=this.lookU8(),T=this.decodeExtension(T,1);else if(T===200)T=this.lookU16(),T=this.decodeExtension(T,2);else{if(T!==201)throw new No("Unrecognized type byte: "+S(T));T=this.lookU32(),T=this.decodeExtension(T,4)}this.complete();for(var F=this.stack;0<F.length;){var j=F[F.length-1];if(j.type===0){if(j.array[j.position]=T,j.position++,j.position!==j.size)continue e;F.pop(),T=j.array}else{if(j.type===1){if(($=typeof T)!="string"&&$!=="number")throw new No("The type of key must be string or number but "+typeof T);if(T==="__proto__")throw new No("The key __proto__ is not allowed");j.key=T,j.type=2;continue e}if(j.map[j.key]=T,j.readCount++,j.readCount!==j.size){j.key=null,j.type=1;continue e}F.pop(),T=j.map}}return T}var $},U.prototype.readHeadByte=function(){return this.headByte===-1&&(this.headByte=this.readU8()),this.headByte},U.prototype.complete=function(){this.headByte=-1},U.prototype.readArraySize=function(){var T=this.readHeadByte();switch(T){case 220:return this.readU16();case 221:return this.readU32();default:if(160>T)return T-144;throw new No("Unrecognized array type byte: "+S(T))}},U.prototype.pushMapState=function(T){if(T>this.maxMapLength)throw new No("Max length exceeded: map length ("+T+") > maxMapLengthLength ("+this.maxMapLength+")");this.stack.push({type:1,size:T,key:null,readCount:0,map:{}})},U.prototype.pushArrayState=function(T){if(T>this.maxArrayLength)throw new No("Max length exceeded: array length ("+T+") > maxArrayLength ("+this.maxArrayLength+")");this.stack.push({type:0,size:T,array:Array(T),position:0})},U.prototype.decodeUtf8String=function(T,F){var j;if(T>this.maxStrLength)throw new No("Max length exceeded: UTF-8 byte length ("+T+") > maxStrLength ("+this.maxStrLength+")");if(this.bytes.byteLength<this.pos+F+T)throw ao;var $,W=this.pos+F;return this.stateIsMapKey()&&((j=this.keyDecoder)===null||j===void 0?0:j.canBeCached(T))?j=this.keyDecoder.decode(this.bytes,W,T):T>dn?(j=this.bytes.subarray(W,W+T),j=Vt.decode(j)):j=c(this.bytes,W,T),$=j,this.pos+=F+T,$},U.prototype.stateIsMapKey=function(){return 0<this.stack.length&&this.stack[this.stack.length-1].type===1},U.prototype.decodeBinary=function(T,F){if(T>this.maxBinLength)throw new No("Max length exceeded: bin length ("+T+") > maxBinLength ("+this.maxBinLength+")");if(!this.hasRemaining(T+F))throw ao;var j=this.pos+F;return j=this.bytes.subarray(j,j+T),this.pos+=F+T,j},U.prototype.decodeExtension=function(T,F){if(T>this.maxExtLength)throw new No("Max length exceeded: ext length ("+T+") > maxExtLength ("+this.maxExtLength+")");var j=this.view.getInt8(this.pos+F);return T=this.decodeBinary(T,F+1),this.extensionCodec.decode(T,j,this.context)},U.prototype.lookU8=function(){return this.view.getUint8(this.pos)},U.prototype.lookU16=function(){return this.view.getUint16(this.pos)},U.prototype.lookU32=function(){return this.view.getUint32(this.pos)},U.prototype.readU8=function(){var T=this.view.getUint8(this.pos);return this.pos++,T},U.prototype.readI8=function(){var T=this.view.getInt8(this.pos);return this.pos++,T},U.prototype.readU16=function(){var T=this.view.getUint16(this.pos);return this.pos+=2,T},U.prototype.readI16=function(){var T=this.view.getInt16(this.pos);return this.pos+=2,T},U.prototype.readU32=function(){var T=this.view.getUint32(this.pos);return this.pos+=4,T},U.prototype.readI32=function(){var T=this.view.getInt32(this.pos);return this.pos+=4,T},U.prototype.readU64=function(){var T,F,j=(T=this.view,F=this.pos,4294967296*T.getUint32(F)+T.getUint32(F+4));return this.pos+=8,j},U.prototype.readI64=function(){var T=u(this.view,this.pos);return this.pos+=8,T},U.prototype.readF32=function(){var T=this.view.getFloat32(this.pos);return this.pos+=4,T},U.prototype.readF64=function(){var T=this.view.getFloat64(this.pos);return this.pos+=8,T},U}(),Ac={},HN=function(U,T){function F(Ye){return function(Ut){return function(ae){if(j)throw new TypeError("Generator is already executing.");for(;ie;)try{if(j=1,$&&(W=2&ae[0]?$.return:ae[0]?$.throw||((W=$.return)&&W.call($),0):$.next)&&!(W=W.call($,ae[1])).done)return W;switch($=0,W&&(ae=[2&ae[0],W.value]),ae[0]){case 0:case 1:W=ae;break;case 4:return ie.label++,{value:ae[1],done:!1};case 5:ie.label++,$=ae[1],ae=[0];continue;case 7:ae=ie.ops.pop(),ie.trys.pop();continue;default:if(!((W=0<(W=ie.trys).length&&W[W.length-1])||ae[0]!==6&&ae[0]!==2)){ie=0;continue}if(ae[0]===3&&(!W||ae[1]>W[0]&&ae[1]<W[3]))ie.label=ae[1];else if(ae[0]===6&&ie.label<W[1])ie.label=W[1],W=ae;else if(W&&ie.label<W[2])ie.label=W[2],ie.ops.push(ae);else{W[2]&&ie.ops.pop(),ie.trys.pop();continue}}ae=T.call(U,ie)}catch(Se){ae=[6,Se],$=0}finally{j=W=0}if(5&ae[0])throw ae[1];return{value:ae[0]?ae[1]:void 0,done:!0}}([Ye,Ut])}}var j,$,W,Ce,ie={label:0,sent:function(){if(1&W[0])throw W[1];return W[1]},trys:[],ops:[]};return Ce={next:F(0),throw:F(1),return:F(2)},typeof Symbol=="function"&&(Ce[Symbol.iterator]=function(){return this}),Ce},gc=function(U){return this instanceof gc?(this.v=U,this):new gc(U)},KN=function(U,T,F){function j(Se){Ut[Se]&&(Ye[Se]=function(Ee){return new Promise(function(Wt,ht){1<ae.push([Se,Ee,Wt,ht])||$(Se,Ee)})})}function $(Se,Ee){try{(Wt=Ut[Se](Ee)).value instanceof gc?Promise.resolve(Wt.value.v).then(W,Ce):ie(ae[0][2],Wt)}catch(ht){ie(ae[0][3],ht)}var Wt}function W(Se){$("next",Se)}function Ce(Se){$("throw",Se)}function ie(Se,Ee){Se(Ee),ae.shift(),ae.length&&$(ae[0][0],ae[0][1])}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var Ye,Ut=F.apply(U,T||[]),ae=[];return Ye={},j("next"),j("throw"),j("return"),Ye[Symbol.asyncIterator]=function(){return this},Ye};return be}()}),mw=Math.min;je({target:"Array",proto:!0},{copyWithin:[].copyWithin||function(i,n){var s=Li(this),c=Ai(s.length),u=ta(i,c),h=ta(n,c),f=2<arguments.length?arguments[2]:void 0;for(c=mw((f===void 0?c:ta(f,c))-h,c-u),f=1,h<u&&u<h+c&&(f=-1,h+=c-1,u+=c-1);0<c--;)h in s?s[u]=s[h]:delete s[u],u+=f,h+=f;return s}});var vw=hr("Array").copyWithin,Q1=Array.prototype;je({target:"Array",proto:!0,forced:na("every")},{every:function(i){return u2(this,i,1<arguments.length?arguments[1]:void 0)}});var Ew=hr("Array").every,U1=Array.prototype,Iw=function(i){var n=i.every;return i===U1||i instanceof Array&&n===U1.every?Ew:n},dd=Uu.getWeakData,Cw=Sr.set,yw=Sr.getterFor,_w=0,hd=function(i){return i.frozen||(i.frozen=new F1)},F1=function(){this.entries=[]},rf=function(i,n){return gv(i.entries,function(s){return s[0]===n})};F1.prototype={get:function(i){if(i=rf(this,i))return i[1]},has:function(i){return!!rf(this,i)},set:function(i,n){var s=rf(this,i);s?s[1]=n:this.entries.push([i,n])},delete:function(i){var n=mv(this.entries,function(s){return s[0]===i});return~n&&this.entries.splice(n,1),!!~n}};var V1={getConstructor:function(i,n,s,c){var u=i(function(A,m){qa(A,u,n),Cw(A,{type:n,id:_w++,frozen:void 0}),m!=null&&Ya(m,A[c],A,s)}),h=yw(n),f=function(A,m,I){var E=h(A),_=dd(an(m),!0);return _===!0?hd(E).set(m,I):_[E.id]=I,A};return ra(u.prototype,{delete:function(A){var m=h(this);if(!qt(A))return!1;var I=dd(A);return I===!0?hd(m).delete(A):I&&nt(I,m.id)&&delete I[m.id]},has:function(A){var m=h(this);if(!qt(A))return!1;var I=dd(A);return I===!0?hd(m).has(A):I&&nt(I,m.id)}}),ra(u.prototype,s?{get:function(A){var m=h(this);if(qt(A)){var I=dd(A);return I===!0?hd(m).get(A):I?I[m.id]:void 0}},set:function(A,m){return f(this,A,m)}}:{add:function(A){return f(this,A,!0)}}),u}},Sw=(r(function(i){var n=Sr.enforce,s=!He.ActiveXObject&&"ActiveXObject"in He,c=Object.isExtensible,u=function(E){return function(){return E(this,arguments.length?arguments[0]:void 0)}};if(i=i.exports=Cv("WeakMap",u,V1),Ev&&s){var h=V1.getConstructor(u,"WeakMap",!0);Uu.REQUIRED=!0,s=i.prototype;var f=s.delete,A=s.has,m=s.get,I=s.set;ra(s,{delete:function(E){if(qt(E)&&!c(E)){var _=n(this);return _.frozen||(_.frozen=new h),f.call(this,E)||_.frozen.delete(E)}return f.call(this,E)},has:function(E){if(qt(E)&&!c(E)){var _=n(this);return _.frozen||(_.frozen=new h),A.call(this,E)||_.frozen.has(E)}return A.call(this,E)},get:function(E){if(qt(E)&&!c(E)){var _=n(this);return _.frozen||(_.frozen=new h),A.call(this,E)?m.call(this,E):_.frozen.get(E)}return m.call(this,E)},set:function(E,_){if(qt(E)&&!c(E)){var S=n(this);S.frozen||(S.frozen=new h),A.call(this,E)?I.call(this,E,_):S.frozen.set(E,_)}else I.call(this,E,_);return this}})}}),Math.min),nf=[].lastIndexOf,G1=!!nf&&0>1/[1].lastIndexOf(1,-0),Tw=na("lastIndexOf"),j1=G1||Tw?function(i){if(G1)return nf.apply(this,arguments)||0;var n=fi(this),s=Ai(n.length),c=s-1;for(1<arguments.length&&(c=Sw(c,Zc(arguments[1]))),0>c&&(c=s+c);0<=c;c--)if(c in n&&n[c]===i)return c||0;return-1}:nf;je({target:"Array",proto:!0,forced:j1!==[].lastIndexOf},{lastIndexOf:j1});var Rw=hr("Array").lastIndexOf,H1=Array.prototype,ww=function(i){var n=i.lastIndexOf;return i===H1||i instanceof Array&&n===H1.lastIndexOf?Rw:n};let Nw=()=>function(i){var n;return i=Ie(n=window.atob(i).split("")).call(n,s=>s.charCodeAt(0)),new Uint8Array(i,0,i.length/Uint8Array.BYTES_PER_ELEMENT)}("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AAA2AkAgACgCKCABKAJMQQIgACgCIBEAACECIAFBADYCwC0gASACNgJEIAFBgAg2ApwtIAEgACgCKEGACEEEIAAoAiARAAAiAjYCCCABIAEoApwtIgNBAnQ2AgwCQAJAIAEoAjhFDQAgASgCQEUNACACRQ0AIAEoAkQNAQsgAUGaBTYCBCAAQbjfACgCADYCGCAAEAgPCyABQQA2AogBIAFBCTYChAEgAUEIOgAkIAEgAiADQQNsajYCmC0gASACIANBfnFqNgKkLSAAEAkNACAAKAIcIgAgACgCLEEBdDYCPCAAKAJEIgEgACgCTEEBdEECayIDakEAOwEAIAEgAxAgIABBADYCtC0gAEKAgICAIDcCdCAAQgA3AmggAEKAgICAIDcCXCAAQQA2AkggACAAKAKEAUEMbCIBQYTIAGovAQA2ApABIAAgAUGAyABqLwEANgKMASAAIAFBgsgAai8BADYCgAEgACABQYbIAGovAQA2AnwLC6kCAQN/AkAgAEUNACAAKAIgRQ0AIAAoAiQiA0UNACAAKAIcIgFFDQAgASgCACAARw0AAkACQCABKAIEIgJBOWsOOQECAgICAgICAgICAgECAgIBAgICAgICAgICAgICAgICAgIBAgICAgICAgICAgIBAgICAgICAgICAQALIAJBmgVGDQAgAkEqRw0BCwJ/An8CfyABKAIIIgIEQCAAKAIoIAIgAxECACAAKAIcIQELIAEoAkQiAgsEQCAAKAIoIAIgACgCJBECACAAKAIcIQELIAEoAkAiAgsEQCAAKAIoIAIgACgCJBECACAAKAIcIQELIAEoAjgiAgsEQCAAKAIoIAIgACgCJBECACAAKAIcIQELIAAoAiggASAAKAIkEQIAIABBADYCHAsLlgIBA39BfiECAkAgAEUNACAAKAIgRQ0AIAAoAiRFDQAgACgCHCIBRQ0AIAEoAgAgAEcNAAJAAkAgASgCBCIDQTlrDjkBAgICAgICAgICAgIBAgICAQICAgICAgICAgICAgICAgICAQICAgICAgICAgICAQICAgICAgICAgEACyADQZoFRg0AIANBKkcNAQsgAEECNgIsIABBADYCCCAAQgA3AhQgAUEANgIUIAEgASgCCDYCECABKAIYIgJBf0wEQCABQQAgAmsiAjYCGAsgAUE5QSpB8QAgAhsgAkECRhs2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KAIIaiACQR9wIAJyQR9zOgAAIAEoAmwEQCAAKAIwIQIgASABKAIUIgNBAWo2AhQgAyABKAIIaiACQRh2OgAAIAEgASgCFCIDQQFqNgIUIAMgASgCCGogAkEQdjoAACAAKAIwIQIgASABKAIUIgNBAWo2AhQgAyABKAIIaiACQQh2OgAAIAEgASgCFCIDQQFqNgIUIAMgASgCCGogAjoAAAsgAEEAQQBBABAENgIwIAFB8QA2AgQgACgCHCICEBMCQCAAKAIQIgMgAigCFCIEIAMgBEkbIgNFDQAgACgCDCACKAIQIAMQHxogACAAKAIMIANqNgIMIAIgAigCECADajYCECAAIAAoAhQgA2o2AhQgACAAKAIQIANrNgIQIAIgAigCFCADayIDNgIUIAMNACACIAIoAgg2AhALIAEoAhQNBCABKAIEIQMLAkACQAJAAkACQAJAAkAgA0E5RgR/IABBAEEAQQAQBjYCMCABIAEoAhQiAkEBajYCFCACIAEoAghqQR86AAAgASABKAIUIgJBAWo2AhQgAiABKAIIakGLAToAACABIAEoAhQiAkEBajYCFCACIAEoAghqQQg6AAAgASgCHCICDQIgASABKAIUIgJBAWo2AhQgAiABKAIIakEAOgAAIAEgASgCFCICQQFqNgIUIAIgASgCCGpBADoAACABIAEoAhQiAkEBajYCFCACIAEoAghqQQA6AAAgASABKAIUIgJBAWo2AhQgAiABKAIIakEAOgAAIAEgASgCFCICQQFqNgIUIAIgASgCCGpBADoAAEECIQIgASgChAEiA0EJRwRAQQQgASgCiAFBAUpBAnQgA0ECSBshAgsgASABKAIUIgNBAWo2AhQgAyABKAIIaiACOgAAIAEgASgCFCICQQFqNgIUIAIgASgCCGpBAzoAACABQfEANgIEIAAoAhwiAhATAkAgACgCECIDIAIoAhQiBCADIARJGyIDRQ0AIAAoAgwgAigCECADEB8aIAAgACgCDCADajYCDCACIAIoAhAgA2o2AhAgACAAKAIUIANqNgIUIAAgACgCECADazYCECACIAIoAhQgA2siAzYCFCADDQAgAiACKAIINgIQCyABKAIUDQEgASgCBAUgAwtBxQBrDiMCBgYGAwYGBgYGBgYGBgYGBgYGBgYGBAYGBgYGBgYGBgYGBQYLIAFBfzYCKA8LIAIoAiQhAyACKAIcIQQgAigCECEFIAIoAiwhBiACKAIAIQggASABKAIUIgdBAWo2AhRBAiECIAcgASgCCGogBkEAR0EBdCAIQQBHciAFQQBHQQJ0ciAEQQBHQQN0ciADQQBHQQR0cjoAACABKAIcKAIEIQMgASABKAIUIgRBAWo2AhQgBCABKAIIaiADOgAAIAEoAhwoAgQhAyABIAEoAhQiBEEBajYCFCAEIAEoAghqIANBCHY6AAAgASgCHC8BBiEDIAEgASgCFCIEQQFqNgIUIAQgASgCCGogAzoAACABKAIcLQAHIQMgASABKAIUIgRBAWo2AhQgBCABKAIIaiADOgAAIAEoAoQBIgNBCUcEQEEEIAEoAogBQQFKQQJ0IANBAkgbIQILIAEgASgCFCIDQQFqNgIUIAMgASgCCGogAjoAACABKAIcKAIMIQIgASABKAIUIgNBAWo2AhQgAyABKAIIaiACOgAAIAEoAhwiAigCEAR/IAIoAhQhAiABIAEoAhQiA0EBajYCFCADIAEoAghqIAI6AAAgASgCHCgCFCECIAEgASgCFCIDQQFqNgIUIAMgASgCCGogAkEIdjoAACABKAIcBSACCygCLARAIAAgACgCMCABKAIIIAEoAhQQBjYCMAsgAUHFADYCBCABQQA2AiALIAEoAhwiBCgCECIDBEAgASgCFCICIAQvARQgASgCICIGayIFaiABKAIMIgRLBEADQCABKAIIIAJqIAMgBmogBCACayIEEB8aIAEgASgCDCIDNgIUAkAgAiADTw0AIAEoAhwoAixFDQAgACAAKAIwIAEoAgggAmogAyACaxAGNgIwCyABIAEoAiAgBGo2AiAgACgCHCICEBMCQCAAKAIQIgMgAigCFCIGIAMgBkkbIgNFDQAgACgCDCACKAIQIAMQHxogACAAKAIMIANqNgIMIAIgAigCECADajYCECAAIAAoAhQgA2o2AhQgACAAKAIQIANrNgIQIAIgAigCFCADayIDNgIUIAMNACACIAIoAgg2AhALIAEoAhQEQCABQX82AigPCyABKAIgIQYgASgCHCgCECEDQQAhAiAFIARrIgUgASgCDCIESw0ACwsgASgCCCACaiADIAZqIAUQHxogASABKAIUIAVqIgM2AhQCQCACIANPDQAgASgCHCgCLEUNACAAIAAoAjAgASgCCCACaiADIAJrEAY2AjALIAFBADYCIAsgAUHJADYCBAsgASgCHCgCHARAIAEoAhQiAiEFA0ACQCACIAEoAgxHDQACQCACIAVNDQAgASgCHCgCLEUNACAAIAAoAjAgASgCCCAFaiACIAVrEAY2AjALIAAoAhwiAhATAkAgACgCECIDIAIoAhQiBCADIARJGyIDRQ0AIAAoAgwgAigCECADEB8aIAAgACgCDCADajYCDCACIAIoAhAgA2o2AhAgACAAKAIUIANqNgIUIAAgACgCECADazYCECACIAIoAhQgA2siAzYCFCADDQAgAiACKAIINgIQC0EAIQJBACEFIAEoAhRFDQAgAUF/NgIoDwsgASgCHCgCHCEDIAEgASgCICIEQQFqNgIgIAMgBGotAAAhAyABIAJBAWo2AhQgASgCCCACaiADOgAAIAMEQCABKAIUIQIMAQsLAkAgASgCHCgCLEUNACABKAIUIgIgBU0NACAAIAAoAjAgASgCCCAFaiACIAVrEAY2AjALIAFBADYCIAsgAUHbADYCBAsCQCABKAIcKAIkRQ0AIAEoAhQiAiEFA0ACQCACIAEoAgxHDQACQCACIAVNDQAgASgCHCgCLEUNACAAIAAoAjAgASgCCCAFaiACIAVrEAY2AjALIAAoAhwiAhATAkAgACgCECIDIAIoAhQiBCADIARJGyIDRQ0AIAAoAgwgAigCECADEB8aIAAgACgCDCADajYCDCACIAIoAhAgA2o2AhAgACAAKAIUIANqNgIUIAAgACgCECADazYCECACIAIoAhQgA2siAzYCFCADDQAgAiACKAIINgIQC0EAIQJBACEFIAEoAhRFDQAgAUF/NgIoDwsgASgCHCgCJCEDIAEgASgCICIEQQFqNgIgIAMgBGotAAAhAyABIAJBAWo2AhQgASgCCCACaiADOgAAIAMEQCABKAIUIQIMAQsLIAEoAhwoAixFDQAgASgCFCICIAVNDQAgACAAKAIwIAEoAgggBWogAiAFaxAGNgIwCyABQecANgIECyABKAIcKAIsBEAgASgCDCABKAIUIgJBAmpJBEAgACgCHCICEBMCQCAAKAIQIgMgAigCFCIEIAMgBEkbIgNFDQAgACgCDCACKAIQIAMQHxogACAAKAIMIANqNgIMIAIgAigCECADajYCECAAIAAoAhQgA2o2AhQgACAAKAIQIANrNgIQIAIgAigCFCADayIDNgIUIAMNACACIAIoAgg2AhALIAEoAhQNBUEAIQILIAAoAjAhAyABIAJBAWo2AhQgASgCCCACaiADOgAAIAAoAjAhAiABIAEoAhQiA0EBajYCFCADIAEoAghqIAJBCHY6AAAgAEEAQQBBABAGNgIwCyABQfEANgIEIAAoAhwiAhATAkAgACgCECIDIAIoAhQiBCADIARJGyIDRQ0AIAAoAgwgAigCECADEB8aIAAgACgCDCADajYCDCACIAIoAhAgA2o2AhAgACAAKAIUIANqNgIUIAAgACgCECADazYCECACIAIoAhQgA2siAzYCFCADDQAgAiACKAIINgIQCyABKAIURQ0AIAFBfzYCKA8LIAAoAgQNAQsgASgCdA0AIAEoAgRBmgVGDQgLIAEoAoQBIgJFBEAgAUEDEAwMBAsCQAJAIAEoAogBQQJrDgIAAQQLA0ACQAJAIAEoAnQNACABEAogASgCdA0AIAFBADYCtC0MAQsgAUEANgJgIAEoAjggASgCbGotAAAhAiABKAKkLSABKAKgLSIDQQF0akEAOwEAIAEgA0EBajYCoC0gAyABKAKYLWogAjoAACABIAJBAnRqQZQBaiICIAIvAQBBAWo7AQAgASABKAJ0QQFrNgJ0IAEgASgCbEEBaiICNgJsIAEoAqAtIAEoApwtQQFrRw0BIAEgASgCXCIEQQBOBH8gASgCOCAEagVBAAsgAiAEa0EAEBQgASABKAJsNgJcIAEoAgAiAigCHCIDEBMCQCACKAIQIgQgAygCFCIFIAQgBUkbIgRFDQAgAigCDCADKAIQIAQQHxogAiACKAIMIARqNgIMIAMgAygCECAEajYCECACIAIoAhQgBGo2AhQgAiACKAIQIARrNgIQIAMgAygCFCAEayICNgIUIAINACADIAMoAgg2AhALIAEoAgAoAhANAQwHCwsgASgCoC1FDQcgASABKAJcIgNBAE4EfyABKAI4IANqBUEACyABKAJsIANrQQAQFCABIAEoAmw2AlwgASgCACICKAIcIgMQEwJAIAIoAhAiBCADKAIUIgUgBCAFSRsiBEUNACACKAIMIAMoAhAgBBAfGiACIAIoAgwgBGo2AgwgAyADKAIQIARqNgIQIAIgAigCFCAEajYCFCACIAIoAhAgBGs2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CAC2AAgAdgAIAPYACAAOAAgAjgAIAE4ACADOAAgALgAIAK4ACABuAAgA7gAIAB4ACACeAAgAXgAIAN4ACAA+AAgAvgAIAH4ACAD+AAgAAQAIAIEACABBAAgAwQAIACEACAChAAgAYQAIAOEACAARAAgAkQAIAFEACADRAAgAMQAIALEACABxAAgA8QAIAAkACACJAAgASQAIAMkACAApAAgAqQAIAGkACADpAAgAGQAIAJkACABZAAgA2QAIADkACAC5AAgAeQAIAPkACAAFAAgAhQAIAEUACADFAAgAJQAIAKUACABlAAgA5QAIABUACACVAAgAVQAIANUACAA1AAgAtQAIAHUACAD1AAgADQAIAI0ACABNAAgAzQAIAC0ACACtAAgAbQAIAO0ACAAdAAgAnQAIAF0ACADdAAgAPQAIAL0ACAB9AAgA/QAIABMACQATAQkAkwAJAJMBCQBTAAkAUwEJANMACQDTAQkAMwAJADMBCQCzAAkAswEJAHMACQBzAQkA8wAJAPMBCQALAAkACwEJAIsACQCLAQkASwAJAEsBCQDLAAkAywEJACsACQArAQkAqwAJAKsBCQBrAAkAawEJAOsACQDrAQkAGwAJABsBCQCbAAkAmwEJAFsACQBbAQkA2wAJANsBCQA7AAkAOwEJALsACQC7AQkAewAJAHsBCQD7AAkA+wEJAAcACQAHAQkAhwAJAIcBCQBHAAkARwEJAMcACQDHAQkAJwAJACcBCQCnAAkApwEJAGcACQBnAQkA5wAJAOcBCQAXAAkAFwEJAJcACQCXAQkAVwAJAFcBCQDXAAkA1wEJADcACQA3AQkAtwAJALcBCQB3AAkAdwEJAPcACQD3AQkADwAJAA8BCQCPAAkAjwEJAE8ACQBPAQkAzwAJAM8BCQAvAAkALwEJAK8ACQCvAQkAbwAJAG8BCQDvAAkA7wEJAB8ACQAfAQkAnwAJAJ8BCQBfAAkAXwEJAN8ACQDfAQkAPwAJAD8BCQC/AAkAvwEJAH8ACQB/AQkA/wAJAP8BCQAAAAcAQAAHACAABwBgAAcAEAAHAFAABwAwAAcAcAAHAAgABwBIAAcAKAAHAGgABwAYAAcAWAAHADgABwB4AAcABAAHAEQABwAkAAcAZAAHABQABwBUAAcANAAHAHQABwADAAgAgwAIAEMACADDAAgAIwAIAKMACABjAAgA4wAIAAAABQAQAAUACAAFABgABQAEAAUAFAAFAAwABQAcAAUAAgAFABIABQAKAAUAGgAFAAYABQAWAAUADgAFAB4ABQABAAUAEQAFAAkABQAZAAUABQAFABUABQANAAUAHQAFAAMABQATAAUACwAFABsABQAHAAUAFwAFAEHg2QALTQEAAAABAAAAAQAAAAEAAAACAAAAAgAAAAIAAAACAAAAAwAAAAMAAAADAAAAAwAAAAQAAAAEAAAABAAAAAQAAAAFAAAABQAAAAUAAAAFAEHQ2gALZQEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAUAAAAGAAAABgAAAAcAAAAHAAAACAAAAAgAAAAJAAAACQAAAAoAAAAKAAAACwAAAAsAAAAMAAAADAAAAA0AAAANAEGA3AALIwIAAAADAAAABwAAAAAAAAAQERIACAcJBgoFCwQMAw0CDgEPAEG03AALaQEAAAACAAAAAwAAAAQAAAAFAAAABgAAAAcAAAAIAAAACgAAAAwAAAAOAAAAEAAAABQAAAAYAAAAHAAAACAAAAAoAAAAMAAAADgAAABAAAAAUAAAAGAAAABwAAAAgAAAAKAAAADAAAAA4ABBtN0AC5oCAQAAAAIAAAADAAAABAAAAAYAAAAIAAAADAAAABAAAAAYAAAAIAAAADAAAABAAAAAYAAAAIAAAADAAAAAAAEAAIABAAAAAgAAAAMAAAAEAAAABgAAAAgAAAAMAAAAEAAAABgAAAAgAAAAMAAAAEAAAABgAABuZWVkIGRpY3Rpb25hcnkAc3RyZWFtIGVuZAAAZmlsZSBlcnJvcgBzdHJlYW0gZXJyb3IAZGF0YSBlcnJvcgBpbnN1ZmZpY2llbnQgbWVtb3J5AGJ1ZmZlciBlcnJvcgBpbmNvbXBhdGlibGUgdmVyc2lvbgAAAAAoLwAAOC8AAEMvAABELwAATy8AAFwvAABnLwAAey8AAIgvAABDLwAAMS4yLjExAEHQ3wALA9AxUA=="),of,$o,K1=Uint8Array.BYTES_PER_ELEMENT,Ow={bytesReceived:"br",frameDropped:"fd",frameReceived:"fr",googJitterReceived:"jr",isAudioMute:"am",isFreeze:"fz",mediaType:"mt",packetsLost:"pl",packetsReceived:"pr",peerId:"pid",id:"id",ssrc:"ssrc",timestamp:"ts",type:"tp",frameRateInput:"fi",frameRateSent:"fs",googRtt:"rt",isVideoMute:"vm"},kw={stats:"sts",state:"st",stream_id:"stid",session_id:"seid",stream_type:"stt",app_id:"aid",channel_key:"ck",channel_name:"cn",sdk_version:"sv",browser:"b",process_id:"pcid",mode:"m",codec:"c",role:"r",has_changed_gateway:"hcg",ap_response:"ar",extends:"es",details:"d",features:"ft",p2p_id:"ppid",sdp:"sdp",audio:"a",video:"v",attributes:"at",hq:"h",lq:"l",stereo:"str",speech:"spe",extend:"e",pingpongElapse:"ppe"},bw={_message:"m",_type:"t",_id:"id"},Dw={join_v2:"j2",publish:"pub",publish_related_stats:"prs",ping:"pi",traffic_stats:"ts",ping_back:"pib",publish_stats:"pubs"},sf;class Bw{constructor(){}async init(){sf||(sf=(await(async()=>($o||($o=await IT()),{zlibCompress:n=>{var s,c=new Uint8Array(n);const u=K1*c.byteLength;n=$o._malloc(u);const h=$o._malloc(3*u);for(let f=0;f<u;f++)$o.HEAP8[n/K1+f]=c[f];return c=$o._zlibCompress(n,u,h),c=new Uint8Array(Gr(s=$o.HEAP8).call(s,h,h+c)),$o._free(n),$o._free(h),c}}))()).zlibCompress),this.zlibCompress=sf}msgPackCompress(n){return gw.encode(n)}compress(n){let s=le(),c=this.compressKeyAndValue(JSON.parse(fe(n))),u=this.msgPackCompress(c);var h=this.zlibCompress(u);return h=new Uint8Array([49,49,49,50,...oo(h)]),{origin:cn({},n),originLength:fe(n).length,shortKeyAndValue:c,msgpackSer:u,compressed:h,compressedLength:h.length,time:le()-s}}compressKeyAndValue(n){return this._ObjectKeyCompress(this._typeCompress(n))}_typeCompress(n){let s=n._type;return s&&(n._type=Dw[s]||s),n}_ObjectKeyCompress(n){let s=n._message;if(s){let c=s.stats;c&&(s.stats=this._statsCompress(c)),n._message=this._messageCompress(s)}return this._reportCompress(n)}_statsCompress(n){return this._keyCompress(n,Ow)}_messageCompress(n){return this._keyCompress(n,kw)}_reportCompress(n){return this._keyCompress(n,bw)}_keyCompress(n,s){let c={},u=pt(n);return Ju(u).call(u,(h,f)=>(h=n[f],s[f]?c[s[f]]=h:c[f]=h,c),c),c}}class Mw extends Zr{constructor(n){super();this.lowPriorityQueue=[],this.highPriorityQueue=[],this.AgoraWebSocketManager=n}get queue(){return[...this.highPriorityQueue,...this.lowPriorityQueue]}reset(){this.lowPriorityQueue=[],this.highPriorityQueue=[]}pushMessage(n,s=!1){s?this.highPriorityQueue.push(n):this.lowPriorityQueue.push(n),this.sendMessage()}sendMessage(){let n=this.queue.length;gi(()=>{this._sendMessage()},5>n?15*n:60+3*(n-4))}_sendMessage(){var n;if(this.queue.length){var s=this.AgoraWebSocketManager.getConnection();if(s&&s.readyState===1){var c=this.queue.shift();return vt(n=this.lowPriorityQueue).call(n,c)?this.lowPriorityQueue.shift():this.highPriorityQueue.shift(),s.send(c.compressed),c}}}}class af extends Zr{constructor(n,s,c=!1){super();this.currentURLIndex=this.connectionID=0,this.reconnectMode="tryNext",this._state="closed",this.reconnectCount=0,this.isCompressorInitSuccess=!1,this.wsDeflateLength=this.wsInflateLength=0,this.name=n,this.retryConfig=s,this.useCompress=c}get url(){return this.websocket?this.websocket.url:null}get state(){return this._state}set state(n){n!==this._state&&(this._state=n,this._state==="reconnecting"?this.emit(dt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(dt.CONNECTED):this._state==="closed"?this.emit(dt.CLOSED):this._state==="failed"&&this.emit(dt.FAILED))}getConnection(){return this.websocket||void 0}init(n){let s=(c,u)=>{this.urls=n;const h=this.urls[this.currentURLIndex];this.state="connecting",this.messageSender=new Mw(this),this.createWebSocketConnection(h).then(c).catch(u),this.once(dt.CLOSED,()=>u(new L(D.WS_DISCONNECT))),this.once(dt.CONNECTED,()=>c())};return new se((c,u)=>{this.compressor=new Bw,this.compressor.init().then(()=>{var h;R.debug("websocket compressor initialized successfully"),this.isCompressorInitSuccess=!0,this.compress=fr(h=this.compressor.compress).call(h,this.compressor),s(c,u)}).catch(()=>{R.debug("websocket compressor failed to initialize"),s(c,u)})})}close(n,s){if(this.currentURLIndex=0,this.reconnectCount=0,this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;let c=this.websocket;s?gi(()=>c.close(),500):c.close(),this.websocket=void 0}this.state=n?"failed":"closed"}reconnect(n,s){if(!this.websocket)return void R.warning("[".concat(this.name,"] can not reconnect, no websocket"));n!==void 0&&(this.reconnectMode=n),R.debug("[".concat(this.name,"] reconnect is triggered initiative")),n=this.websocket.onclose,this.websocket.onclose=null,this.websocket.close(),n&&fr(n).call(n,this.websocket)({code:9999,reason:s})}sendMessage(n,s=!1){if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new L(D.WS_ABORT,"websocket is not ready");try{let c=null;if(this.isCompressorInitSuccess&&this.useCompress&&te.WEBSOCKET_COMPRESS)c=this.compress(n),this.setWsInflateData(c);else{if(this.isCompressorInitSuccess&&this.useCompress){let h=this.compress(n);this.setWsInflateData(h)}let u=fe(n);c={compressed:u,compressedLength:u.length,origin:n}}s?this.websocket.send(c.compressed):this.messageSender.pushMessage(c)}catch(c){throw new L(D.WS_ERR,"send websocket message error"+c.toString())}}setWsInflateData(n){this.wsDeflateLength+=n.originLength,this.wsInflateLength+=n.compressedLength}getWsInflateData(){let n=this.wsInflateLength,s=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:n,wsDeflateLength:s}}clearWsInflateData(){this.wsDeflateLength=this.wsInflateLength=0}async createWebSocketConnection(n){let s=this.connectionID+=1;return new se((c,u)=>{var h,f;this.websocket&&(this.websocket.onclose=null,this.websocket.close()),te.GATEWAY_WSS_ADDRESS&&ll(h=this.name).call(h,"gateway")&&(n=te.GATEWAY_WSS_ADDRESS),R.debug(b(f="[".concat(this.name,"] start connect, url: ")).call(f,n));try{this.websocket=new WebSocket(n),this.websocket.binaryType="arraybuffer"}catch(m){var A;return h=new L(D.WS_ERR,"init websocket failed! Error: ".concat(m.toString())),R.error(b(A="[".concat(this.name,"]")).call(A,h)),void u(h)}Un(5e3).then(()=>{s===this.connectionID&&this.websocket&&this.websocket.readyState!==WebSocket.OPEN&&this.websocket&&this.websocket.close()}),this.websocket.onopen=()=>{R.debug("[".concat(this.name,"] websocket opened:"),n),this.reconnectMode="retry",this.state="connected",this.reconnectCount=0,c()},this.websocket.onclose=async m=>{var I,E,_,S;if(R.debug(b(I=b(E=b(_=b(S="[".concat(this.name,"] websocket close ")).call(S,this.websocket&&this.websocket.url,", code: ")).call(_,m.code,", reason: ")).call(E,m.reason,", current mode: ")).call(I,this.reconnectMode)),this.reconnectCount<this.retryConfig.maxRetryCount){if(this.state==="connected"&&(this.reconnectReason=m.reason,this.state="reconnecting"),I=qs(this,dt.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,I=await this.reconnectWithAction(I),this.state==="closed")return void R.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!I)return u(new L(D.WS_DISCONNECT,"websocket reconnect failed: ".concat(m.code))),void this.close(!0);c()}else u(new L(D.WS_DISCONNECT,"websocket close: ".concat(m.code))),this.close()},this.websocket.onmessage=m=>{this.emit(dt.ON_MESSAGE,m)}})}async reconnectWithAction(n,s){var c,u;if(!s&&this.reconnectCount>=this.retryConfig.maxRetryCount||!this.urls||this.state==="closed"||(this.onlineReconnectListener||ni.networkState!==Fi.OFFLINE||(this.onlineReconnectListener=ni.onlineWaiter&&ni.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0})),s=function(A,m){return Math.min(m.maxRetryTimeout,m.timeout*Math.pow(m.timeoutFactor,A))}(this.reconnectCount,this.retryConfig),R.debug(b(c=b(u="[".concat(this.name,"] wait ")).call(u,s,"ms to reconnect websocket, mode: ")).call(c,n)),await se.race([Un(s),this.onlineReconnectListener||new se(()=>{})]),this.state==="closed"))return!1;this.reconnectCount+=1;try{if(n==="retry")await this.createWebSocketConnection(this.urls[this.currentURLIndex]);else if(n==="tryNext"){var h,f;if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return await this.reconnectWithAction("recover");R.debug(b(h=b(f="[".concat(this.name,"] websocket url length: ")).call(f,this.urls.length," current index: ")).call(h,this.currentURLIndex)),await this.createWebSocketConnection(this.urls[this.currentURLIndex])}else n==="recover"&&(R.debug("[".concat(this.name,"] request new urls")),this.urls=await br(this,dt.REQUEST_NEW_URLS),this.currentURLIndex=0,await this.createWebSocketConnection(this.urls[this.currentURLIndex]));return!0}catch(A){return R.error("[".concat(this.name,"] reconnect failed"),A.toString()),await this.reconnectWithAction(n)}}}class Lw{constructor(n){this.input=[],this.size=n}add(n){var s;this.input.push(n),this.input.length>this.size&&Jr(s=this.input).call(s,0,1)}mean(){var n;return this.input.length===0?0:Ju(n=this.input).call(n,(s,c)=>s+c)/this.input.length}}class Pw extends Zr{constructor(n){super();this._connectionState=Cr.CLOSED,this.openConnectionTime=le(),this.lastMsgTime=le(),this.uploadCache=[],this.rttRolling=new Lw(5),this.pingpongTimeoutCount=0,this.onWebsocketMessage=s=>{if(s.data instanceof ArrayBuffer)return void this.emit(Ze.ON_BINARY_DATA,s.data);if(s=JSON.parse(s.data),this.lastMsgTime=le(),Object.prototype.hasOwnProperty.call(s,"_id")){let c="res-@".concat(s._id);this.emit(c,s._result,s._message)}else if(Object.prototype.hasOwnProperty.call(s,"_type")&&(this.emit(s._type,s._message),s._type===Et.ON_NOTIFICATION&&this.handleNotification(s._message),s._type===Et.ON_USER_BANNED))switch(s._message.error_code){case 14:this.close("UID_BANNED");break;case 15:this.close("IP_BANNED");break;case 16:this.close("CHANNEL_BANNED")}},this.clientId=n.clientId,this.spec=n,this.websocket=new af("gateway-".concat(this.clientId),this.spec.retryConfig,!0),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Cr.CONNECTED&&this.reconnect("retry",Fn.OFFLINE)})}get connectionState(){return this._connectionState}set connectionState(n){n!==this._connectionState&&(this._connectionState=n,n===Cr.CONNECTED?this.emit(Ze.WS_CONNECTED):n===Cr.RECONNECTING?this.emit(Ze.WS_RECONNECTING,this._websocketReconnectReason):n===Cr.CLOSED&&this.emit(Ze.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}async request(n,s,c,u){var h,f,A,m,I;let E=or(6,"");var _={_id:E,_type:n,_message:s};let S=this.websocket.connectionID;var N=()=>new se((O,B)=>{if(this.connectionState===Cr.CONNECTED)return O();const P=()=>{this.off(Ze.WS_CLOSED,J),O()},J=()=>{this.off(Ze.WS_CONNECTED,P),B(new L(D.WS_ABORT))};this.once(Ze.WS_CONNECTED,P),this.once(Ze.WS_CLOSED,J)});if(this.connectionState!==Cr.CONNECTING&&this.connectionState!==Cr.RECONNECTING||n===kt.JOIN||n===kt.REJOIN||await N(),this.websocket.sendMessage(_,!0),!u){_=new se((O,B)=>{let P=!1;const J=(Ae,Me)=>{P=!0,O({isSuccess:Ae==="success",message:Me||{}}),this.off(Ze.WS_CLOSED,ne),this.off(Ze.WS_RECONNECTING,ne),this.emit(Ze.REQUEST_SUCCESS,n,s)};this.once("res-@".concat(E),J);const ne=()=>{B(new L(D.WS_ABORT,"type: ".concat(n))),this.off(Ze.WS_CLOSED,ne),this.off(Ze.WS_RECONNECTING,ne),this.off("res-@".concat(E),J)};this.once(Ze.WS_CLOSED,ne),this.once(Ze.WS_RECONNECTING,ne),Un(te.SIGNAL_REQUEST_TIMEOUT).then(()=>{this.websocket.connectionID!==S||P||(R.warning("ws request timeout, type: ".concat(n)),this.emit(Ze.REQUEST_TIMEOUT,n,s))})}),u=null;try{u=await _}catch(O){if(this.connectionState===Cr.CLOSED||n===kt.LEAVE)throw new L(D.WS_ABORT);return!this.spec.forceWaitGatewayResponse||c?O.throw():n===kt.JOIN||n===kt.REJOIN?null:(await N(),await this.request(n,s))}return u.isSuccess?u.message:(c=Number(u.message.error_code||u.message.code),N=Nm(c),_=new L(D.UNEXPECTED_RESPONSE,b(h="".concat(N.desc,": ")).call(h,u.message.error_str),{code:c,data:u.message}),N.action==="success"?u.message:(R.warning(b(f=b(A=b(m=b(I="[".concat(this.websocket.connectionID,"] unexpected response from type ")).call(I,n,", error_code: ")).call(m,c,", message: ")).call(A,N.desc,", action: ")).call(f,N.action)),N.action==="failed"?_.throw():N.action==="quit"?(this.initError=_,this.close(),_.throw()):(c===Oe.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=u.message.option,R.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Fn.MULTI_IP)):this.reconnect(N.action,Fn.SERVER_ERROR),n===kt.JOIN||n===kt.REJOIN?null:await this.request(n,s))))}}waitMessage(n,s){return new se(c=>{let u=h=>{s&&!s(h)||(this.off(n,u),c(h))};this.on(n,u)})}upload(n,s){n={_type:n,_message:s};try{this.websocket.sendMessage(n)}catch{s=te.MAX_UPLOAD_CACHE||50;var c;this.uploadCache.push(n),this.uploadCache.length>s&&Jr(c=this.uploadCache).call(c,0,1),0<this.uploadCache.length&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{var h;if(this.connectionState===Cr.CONNECTED){var f=Jr(h=this.uploadCache).call(h,0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(f._type,f._message)}},te.UPLOAD_CACHE_INTERVAL||2e3))}}send(n,s){this.websocket.sendMessage({_type:n,_message:s})}init(n){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,new se((s,c)=>{this.once(Ze.WS_CONNECTED,()=>s(this.joinResponse)),this.once(Ze.WS_CLOSED,()=>c(this.initError||new L(D.WS_ABORT))),this.connectionState=Cr.CONNECTING,this.websocket.init(n).catch(c),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.joinResponse=this.reconnectToken=void 0,this._disconnectedReason=n||"LEAVE",this.connectionState=Cr.CLOSED,this.websocket.close()}async join(){var n;if(!this.joinResponse){var s=qc(this,Ze.REQUEST_JOIN_INFO);if(s=await this.request(kt.JOIN,s),!s)return this.emit(Ze.REPORT_JOIN_GATEWAY,D.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Cr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(fr(n=this.handlePingPong).call(n,this),3e3),!0}async rejoin(){var n,s;if(!this.reconnectToken)throw new L(D.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");var c=qc(this,Ze.REQUEST_REJOIN_INFO);return c.token=this.reconnectToken,c=await this.request(kt.REJOIN,c),!!c&&(this.connectionState=Cr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(fr(n=this.handlePingPong).call(n,this),3e3),c.peers&&K(s=c.peers).call(s,u=>{this.emit(Et.ON_USER_ONLINE,{uid:u.uid}),u.audio_mute?this.emit(Et.MUTE_AUDIO,{uid:u.uid}):this.emit(Et.UNMUTE_AUDIO,{uid:u.uid}),u.video_mute?this.emit(Et.MUTE_VIDEO,{uid:u.uid}):this.emit(Et.UNMUTE_VIDEO,{uid:u.uid}),u.audio_enable_local?this.emit(Et.ENABLE_LOCAL_AUDIO,{uid:u.uid}):this.emit(Et.DISABLE_LOCAL_AUDIO,{uid:u.uid}),u.video_enable_local?this.emit(Et.ENABLE_LOCAL_VIDEO,{uid:u.uid}):this.emit(Et.DISABLE_LOCAL_VIDEO,{uid:u.uid}),u.audio||u.video||this.emit(Et.ON_REMOVE_STREAM,{uid:u.uid,uint_id:u.uint_id}),u.audio&&this.emit(Et.ON_ADD_AUDIO_STREAM,{uid:u.uid,uint_id:u.uint_id,audio:!0}),u.video&&this.emit(Et.ON_ADD_VIDEO_STREAM,{uid:u.uid,uint_id:u.uint_id,video:!0})}),!0)}reconnect(n,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(n,s)}handleNotification(n){if(R.debug("[".concat(this.clientId,"] receive notification: "),n),n=Nm(n.code),n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close("UID_BANNED"),void this.close()):void this.reconnect(n.action,Fn.SERVER_ERROR);R.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(this.websocket&&this.websocket.state==="connected"){0<this.pingpongTimeoutCount&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;var n=te.PING_PONG_TIME_OUT,s=le();this.pingpongTimeoutCount>=n&&(R.warning("PINGPONG Timeout. Last Socket Message: ".concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>te.WEBSOCKET_TIMEOUT_MIN)?this.reconnect("retry",Fn.TIMEOUT):this.request(kt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let c=le()-s;this.rttRolling.add(c),te.REPORT_STATS&&this.send(kt.PING_BACK,{pingpongElapse:c})}).catch(c=>{})}}handleWsInflateData(){let{wsInflateLength:n,wsDeflateLength:s}=this.websocket.getWsInflateData();n!==0&&s!==0&&this.upload(xi.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:s,ws_inflate_length:n})}handleWebsocketEvents(){this.websocket.on(dt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(dt.CLOSED,()=>{this.connectionState=Cr.CLOSED}),this.websocket.on(dt.FAILED,()=>{this._disconnectedReason="NETWORK_ERROR",this.connectionState=Cr.CLOSED}),this.websocket.on(dt.RECONNECTING,n=>{this._websocketReconnectReason=n,this.joinResponse=void 0,this.connectionState===Cr.CONNECTED?this.connectionState=Cr.RECONNECTING:this.connectionState=Cr.CONNECTING}),this.websocket.on(dt.WILL_RECONNECT,(n,s)=>{if(qc(this,Ze.IS_P2P_DISCONNECTED)&&n==="retry")return this.reconnectToken=void 0,this.emit(Ze.NEED_RENEW_SESSION),this.emit(Ze.DISCONNECT_P2P),s("tryNext");n!=="retry"&&(this.reconnectToken=void 0,this.emit(Ze.NEED_RENEW_SESSION),this.emit(Ze.DISCONNECT_P2P)),s(n)}),this.websocket.on(dt.CONNECTED,()=>{this.openConnectionTime=le(),this.reconnectToken?this.rejoin().catch(n=>{var s;R.warning(b(s="[".concat(this.clientId,"] rejoin failed ")).call(s,n)),this.reconnect("tryNext",Fn.SERVER_ERROR)}):this.join().catch(n=>{if(this.emit(Ze.REPORT_JOIN_GATEWAY,n.message||n.code,this.url||""),n instanceof L&&n.code===D.UNEXPECTED_RESPONSE&&n.data.code===Oe.ERR_NO_AUTHORIZED)return R.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Fn.SERVER_ERROR);R.error("[".concat(this.clientId,"] join gateway request failed"),n.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Fn.SERVER_ERROR):(this.initError=n,this.close())})}),this.websocket.on(dt.REQUEST_NEW_URLS,(n,s)=>{br(this,Ze.REQUEST_RECOVER,this.multiIpOption).then(n).catch(s)})}}let cf=new Tt;class xw extends Zr{constructor(n){super();this.inChannelInfo={joinAt:null,duration:0},this._state="DISCONNECTED",this.needToSendUnpubUnsub=new Tt,this.hasChangeBGPAddress=this.isSignalRecover=!1,this.joinGatewayStartTime=0,this._signalTimeout=!1,this.clientId=n.clientId,this.spec=n,this.signal=new Pw(Hh({},n,{retryConfig:n.websocketRetryConfig})),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}get state(){return this._state}set state(n){if(n!==this._state){var s=this._state;this._state=n,n==="DISCONNECTED"&&this._disconnectedReason?this.emit(Dr.CONNECTION_STATE_CHANGE,n,s,this._disconnectedReason):this.emit(Dr.CONNECTION_STATE_CHANGE,n,s)}}async join(n,s){var c,u;n.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);let h=le();var f=cf.get(n.cname);if(f||(f=new Tt,cf.set(n.cname,f)),f.has(n.uid))throw f=new L(D.UID_CONFLICT),z.joinGateway(n.sid,{lts:h,succ:!1,ec:f.message,addr:null,uid:n.uid,cid:n.cid}),f;f.set(n.uid,!0),this.joinInfo=n,this.key=s,s=n.proxyServer?Ie(c=n.gatewayAddrs).call(c,A=>{var m,I;return A=A.split(":"),b(m=b(I="wss://".concat(n.proxyServer,"/ws/?h=")).call(I,A[0],"&p=")).call(m,A[1])}):Ie(u=n.gatewayAddrs).call(u,A=>"wss://".concat(A)),c=0,this.joinGatewayStartTime=h;try{c=(await this.signal.init(s)).uid}catch(A){throw R.error("[".concat(this.clientId,"] User join failed"),A.toString()),z.joinGateway(n.sid,{lts:h,succ:!1,ec:A.message,addr:this.signal.url,uid:n.uid,cid:n.cid}),f.delete(n.uid),this.signal.close(),A}return this.state="CONNECTED",this.inChannelInfo.joinAt=le(),R.debug("[".concat(this.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(A=>{R.warning("[".concat(this.clientId,"] get traffic stats error"),A.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Dr.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Dr.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Dr.NETWORK_QUALITY,{uplinkNetworkQuality:Sm(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:Sm(this._statsCollector.trafficStats.B_dnq)}):this.emit(Dr.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),c}async leave(n=!1){if(this.state!=="DISCONNECTED"){this.state="DISCONNECTING";try{if(!n&&this.signal.connectionState===Cr.CONNECTED){var s=this.signal.request(kt.LEAVE,void 0,!0);await(1/0==3e3?s:se.race([s,ET(3e3)]))}}catch(c){R.warning("[".concat(this.clientId,"] leave request failed, ignore"),c)}this.signal.close(),this.reset(),this.state="DISCONNECTED"}}async publish(n,s){if(!this.joinInfo)throw new L(D.UNEXPECTED_ERROR,"publish no joinInfo");let c=n.getUserId(),u=n.videoTrack?function(h){var f;if(h=h._encoderConfig,!h)return{};const A={resolution:h.width&&h.height?b(f="".concat(fs(h.width),"x")).call(f,fs(h.height)):void 0,maxVideoBW:h.bitrateMax,minVideoBW:h.bitrateMin};return typeof h.frameRate=="number"?(A.maxFrameRate=h.frameRate,A.minFrameRate=h.frameRate):h.frameRate&&(A.maxFrameRate=h.frameRate.max||h.frameRate.ideal||h.frameRate.exact||h.frameRate.min,A.minFrameRate=h.frameRate.min||h.frameRate.ideal||h.frameRate.exact||h.frameRate.max),A}(n.videoTrack):{};if(n.on(ke.NEED_ANSWER,(h,f,A)=>{var m;let I={state:"offer",stream_type:s,p2p_id:n.pc.ID,sdp:fe(h),audio:!!n.audioTrack,video:!!n.videoTrack,screen:n.videoTrack&&Ke(m=n.videoTrack._hints).call(m,no.SCREEN_TRACK)!==-1,attributes:u,dtx:n.audioTrack instanceof gl&&n.audioTrack._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1,mode:this.spec.mode,codec:this.spec.codec,extend:te.PUB_EXTEND};n.audioTrack&&n.audioTrack instanceof un&&(n.audioTrack&&(m={stream_id:this.joinInfo&&(this.joinInfo.stringUid||this.joinInfo.uid),action:""},n.audioTrack.isActive?m.action="unmute_local_audio":m.action="mute_local_audio",this.sendControl(m)),n.videoTrack&&(m={stream_id:this.joinInfo&&(this.joinInfo.stringUid||this.joinInfo.uid),action:""},n.videoTrack.muted?m.action="mute_local_video":m.action="unmute_local_video",this.sendControl(m))),this.signal.request(kt.PUBLISH,I,!0).then(E=>{c&&this.needToSendUnpubUnsub.set(c,!0),f(JSON.parse(E.sdp))}).catch(E=>{if(h.retry&&E.data&&E.data.code===Oe.ERR_PUBLISH_REQUEST_INVALID)return R.warning("[".concat(this.clientId,"] receiver publish error code, retry"),E.toString()),br(n,ke.NEED_UNPUB).then(()=>{h.retry=!1,br(n,ke.NEED_ANSWER,h).then(f).catch(A)});E.code!==D.WS_ABORT&&A(E)})}),n.on(ke.NEED_RENEGOTIATE,(h,f,A)=>{this.signal.request(kt.PUBLISH,{state:"negotiation",stream_type:s,p2p_id:n.pc.ID,sdp:h},!0).then(m=>{f(JSON.parse(m.sdp))}).catch(m=>{m.code!==D.WS_ABORT&&A(m)})}),n.on(ke.NEED_UNPUB,h=>c&&!this.needToSendUnpubUnsub.has(c)?h(!1):this.state==="RECONNECTING"?h(!0):void this.signal.request(kt.UNPUBLISH,{stream_id:n.getUserId(),stream_type:s},!0).then(()=>h(!1)).catch(f=>{R.warning("unpublish warning: ",f),h(!0)})),n.on(ke.NEED_UPLOAD,(h,f)=>{this.signal.upload(h,{stream_type:s,stats:f})}),n.on(ke.NEED_SIGNAL_RTT,h=>{h(this.signal.rtt)}),n.on(ke.NEED_CONTROL,(h,f,A)=>{if(h.type==="video"&&h.muted)h="mute_local_video";else if(h.type!=="video"||h.muted)if(h.type==="audio"&&h.muted)h="mute_local_audio";else{if(h.type!=="audio"||h.muted)return;h="unmute_local_audio"}else h="unmute_local_video";this.sendControl({stream_id:this.joinInfo&&(this.joinInfo.stringUid||this.joinInfo.uid),action:h}).then(f).catch(A)}),this.state!=="RECONNECTING"){if(this.state!=="CONNECTED")return new L(D.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state)).throw();await n.startP2PConnection()}else n.readyToReconnectPC()}async subscribe(n){if(!this.joinInfo)throw new L(D.UNEXPECTED_ERROR,"subscribe no joinInfo");let s=n.getUserId();if(n.on(ke.NEED_ANSWER,(c,u,h)=>{var f=n.subscribeOptions;f={stream_id:n.getUserId(),audio:!!f.audio,video:!!f.video,mode:this.spec.mode,codec:this.spec.codec,p2p_id:n.pc.ID,sdp:fe(c),tcc:!!te.SUBSCRIBE_TCC,extend:te.SUB_EXTEND},this.signal.request(kt.SUBSCRIBE,f,!0).then(A=>{this.needToSendUnpubUnsub.set(s,!0),u(JSON.parse(A.sdp))}).catch(A=>{if(c.retry&&A.data&&A.data.code===Oe.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.clientId,"] receiver subscribe error code, retry"),A.toString()),br(n,ke.NEED_UNSUB).then(()=>{c.retry=!1,br(n,ke.NEED_ANSWER,c).then(u).catch(h)});A.code!==D.WS_ABORT&&h(A)})}),n.on(ke.NEED_UNSUB,c=>this.needToSendUnpubUnsub.has(s)?this.state==="RECONNECTING"?c(!0):void this.signal.request(kt.UNSUBSCRIBE,{stream_id:n.getUserId()},!0).then(()=>c(!1)).catch(u=>{R.warning("unsubscribe warning",u),c(!0)}):c(!1)),n.on(ke.NEED_UPLOAD,(c,u)=>{this.signal.upload(c,{stream_id:n.getUserId(),stats:u})}),n.on(ke.NEED_SIGNAL_RTT,c=>{c(this.signal.rtt)}),this.state!=="RECONNECTING"){if(this.state!=="CONNECTED")return new L(D.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state)).throw();await n.startP2PConnection()}else n.readyToReconnectPC()}async subscribeChange(n,s){var c,u;if(!this.joinInfo)throw new L(D.UNEXPECTED_ERROR,"subscribe no joinInfo");if(await n.setSubscribeOptions(s),this.state!=="RECONNECTING"){if(this.state!=="CONNECTED")return new L(D.INVALID_OPERATION,"can not subscribe change when connection state is ".concat(this.state)).throw();R.debug(b(c=b(u="[".concat(this.clientId,"] send subscribe change, audio: ")).call(u,s.audio,", video: ")).call(c,s.video)),await this.signal.request(kt.SUBSCRIBE_CHANGE,{stream_id:n.getUserId(),audio:!!s.audio,video:!!s.video},!0)}}async sendControl(n){this.signal.request(kt.CONTROL,n,!0,!0)}async unsubscribe(n){await n.closeP2PConnection()}getGatewayInfo(){return this.signal.request(kt.GATEWAY_INFO)}renewToken(n){return this.signal.request(kt.RENEW_TOKEN,{token:n})}async setClientRole(n,s){if(s&&(this._clientRoleOptions=cn({},s)),this.state!=="CONNECTED")return void(this.role=n);await this.signal.request(kt.SET_CLIENT_ROLE,{role:n,level:n==="audience"?this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:0}),this.role=n}async setRemoteVideoStreamType(n,s){await this.signal.request(kt.SWITCH_VIDEO_STREAM,{stream_id:n,stream_type:s})}async setStreamFallbackOption(n,s){await this.signal.request(kt.SET_FALLBACK_OPTION,{stream_id:n,fallback_type:s})}async pickSVCLayer(n,s){await this.signal.request(kt.PICK_SVC_LAYER,{stream_id:n,spatial_layer:s.spatialLayer,temporal_layer:s.temporalLayer})}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=le()-this.inChannelInfo.joinAt),Hh({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(kt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=le()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){let n=cf.get(this.joinInfo.cname);n&&n.delete(this.joinInfo.uid)}this.needToSendUnpubUnsub=new Tt,this.key=this.joinInfo=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(this.joinInfo){var n=(n=((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex])||"").match(/(wss:\/\/)?([^:]+):(\d+)/))?{username:jr.username,password:jr.password,turnServerURL:n[2],tcpport:pr(n[3])+30,udpport:pr(n[3])+30,forceturn:!1}:null;this.joinInfo.turnServer.serversFromGateway=[],n&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Hh({},jr,{turnServerURL:n.turnServerURL,tcpport:n.tcpport,udpport:n.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}}async updateTrafficStats(){var n;if(this.state==="CONNECTED"){var s=await this.signal.request(kt.TRAFFIC_STATS,void 0,!0);s.timestamp=le(),K(n=s.peer_delay).call(n,c=>{var u;let h=this._statsCollector.trafficStats&&Xe(u=this._statsCollector.trafficStats.peer_delay).call(u,f=>f.peer_uid===c.peer_uid);h&&h.B_st!==c.B_st&&pi(()=>{this.emit(Dr.STREAM_TYPE_CHANGE,c.peer_uid,c.B_st)})}),this._statsCollector.updateTrafficStats(s)}}getJoinMessage(){if(!this.joinInfo||!this.key)throw new L(D.UNEXPECTED_ERROR,"can not generate join message, no join info");let n=cn({},this.joinInfo.apResponse);var s=te.REPORT_APP_SCENARIO;if(typeof s!="string")try{s=fe(s)}catch{s=void 0}return s&&128<s.length&&(s=void 0),s={session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:ei,browser:navigator.userAgent,process_id:te.PROCESS_ID,mode:this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:n,extend:te.JOIN_EXTEND,details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:s},this.joinInfo.stringUid&&(s.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(s.aes_mode=this.joinInfo.aesmode,te.ENCRYPT_AES?(s.aes_secret=this.joinInfo.aespassword,s.aes_encrypt=!0):s.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(s.aes_salt=this.joinInfo.aessalt)),n.addresses[this.signal.websocket.currentURLIndex]&&(s.ap_response.ticket=n.addresses[this.signal.websocket.currentURLIndex].ticket,delete n.addresses),s}getRejoinMessage(){if(!this.joinInfo)throw new L(D.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Ze.WS_RECONNECTING,n=>{this.joinInfo&&z.WebSocketQuit(this.joinInfo.sid,{lts:le(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n||Fn.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",z.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode}),this.isSignalRecover=!1,this.joinGatewayStartTime=le())}),this.signal.on(Ze.WS_CLOSED,n=>{let s;switch(n){case"LEAVE":s=Fn.LEAVE;break;case"UID_BANNED":case"IP_BANNED":case"CHANNEL_BANNED":case"SERVER_ERROR":s=Fn.SERVER_ERROR;break;default:s=Fn.NETWORK_ERROR}R.debug("[signal] websocket closed, reason: ".concat(s||"undefined -> "+Fn.NETWORK_ERROR)),this.joinInfo&&z.WebSocketQuit(this.joinInfo.sid,{lts:le(),succ:n==="LEAVE"?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:s}),this.reset(),this._disconnectedReason=n,this.state="DISCONNECTED"}),this.signal.on(Ze.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){var n,s,c;if(this.role==="audience"&&this._clientRoleOptions&&this._clientRoleOptions.level&&(R.debug(b(n=b(s=b(c="[".concat(this.clientId,"] patch to send set client role, role: ")).call(c,this.role,", mode: ")).call(s,this.spec.mode,", level: ")).call(n,this._clientRoleOptions&&this._clientRoleOptions.level)),this.setClientRole(this.role,this._clientRoleOptions)),z.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid}),this.joinInfo.useLocalAccessPoint){n=this.signal.url&&this.signal.url.match(/wss:\/\/([^:]+):(\d+)/);var u;if(!n)return void R.error(b(u="[".concat(this.clientId,"] set local access point after joined failed: ")).call(u,n));Yr("EVENT_REPORT_DOMAIN",n[1]),Yr("EVENT_REPORT_BACKUP_DOMAIN",n[1]),Yr("LOG_UPLOAD_SERVER","".concat(n[1],":6444"))}}}),this.signal.on(Et.ON_UPLINK_STATS,n=>{this._statsCollector.updateUplinkStats(n)}),this.signal.on(Ze.REQUEST_RECOVER,(n,s,c)=>{if(!this.joinInfo)return c(new L(D.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));n&&(this.joinInfo.multiIP=n,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,br(this,Dr.REQUEST_NEW_GATEWAY_LIST).then(s).catch(c)}),this.signal.on(Ze.REQUEST_JOIN_INFO,n=>{n(this.getJoinMessage())}),this.signal.on(Ze.REQUEST_REJOIN_INFO,n=>{n(this.getRejoinMessage())}),this.signal.on(Ze.REPORT_JOIN_GATEWAY,(n,s)=>{this.joinInfo&&z.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:n,addr:s,uid:this.joinInfo.uid,cid:this.joinInfo.cid})}),this.signal.on(Ze.IS_P2P_DISCONNECTED,n=>{n(qc(this,Dr.IS_P2P_DISCONNECTED))}),this.signal.on(Ze.DISCONNECT_P2P,()=>{this.needToSendUnpubUnsub=new Tt,this.emit(Dr.DISCONNECT_P2P)}),this.signal.on(Ze.NEED_RENEW_SESSION,()=>{this.emit(Dr.NEED_RENEW_SESSION)}),this.signal.on(Ze.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Ze.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0})}}var Qw=dr("iterator"),lf=!ur(function(){var i=new URL("b?a=1&b=2&c=3","http://a"),n=i.searchParams,s="";return i.pathname="c%20d",n.forEach(function(c,u){n.delete("b"),s+=u+c}),!i.toJSON||!n.sort||i.href!=="http://a/c%20d?a=1&c=3"||n.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!n[Qw]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://\u0442\u0435\u0441\u0442").host!=="xn--e1aybc"||new URL("http://a#\u0431").hash!=="#%D0%B1"||s!=="a1c3"||new URL("http://x",void 0).host!=="x"}),Uw=/[^\0-\u007E]/,Fw=/[.\u3002\uFF0E\uFF61]/g,lc=Math.floor,uf=String.fromCharCode,W1=function(i){return i+22+75*(26>i)},Vw=function(i){for(var n,s=[],c=[],u=0,h=i.length;u<h;){var f=i.charCodeAt(u++);if(55296<=f&&56319>=f&&u<h){var A=i.charCodeAt(u++);(64512&A)==56320?c.push(((1023&f)<<10)+(1023&A)+65536):(c.push(f),u--)}else c.push(f)}u=(i=c).length,h=128;var m=0,I=72;for(c=0;c<i.length;c++)128>(n=i[c])&&s.push(uf(n));for((A=f=s.length)&&s.push("-");A<u;){var E=2147483647;for(c=0;c<i.length;c++)(n=i[c])>=h&&n<E&&(E=n);var _=A+1;if(E-h>lc((2147483647-m)/_))throw RangeError("Overflow: input needs wider integers to process");for(m+=(E-h)*_,h=E,c=0;c<i.length;c++){if((n=i[c])<h&&2147483647<++m)throw RangeError("Overflow: input needs wider integers to process");if(n==h){var S=m;for(E=36;;E+=36){var N=E<=I?1:E>=I+26?26:E-I;if(S<N)break;S-=N;var O=36-N;s.push(uf(W1(N+S%O))),S=lc(S/O)}for(s.push(uf(W1(S))),I=_,E=0,m=A==f?lc(m/700):m>>1,m+=lc(m/I);455<m;E+=36)m=lc(m/35);I=lc(E+36*m/(m+38)),m=0,++A}}++m,++h}return s.join("")},Y1=function(i){var n=Fu(i);if(typeof n!="function")throw TypeError(String(i)+" is not iterable");return an(n.call(i))},q1=to("fetch"),df=to("Headers"),Gw=dr("iterator"),J1=Sr.set,Ei=Sr.getterFor("URLSearchParams"),jw=Sr.getterFor("URLSearchParamsIterator"),Hw=/\+/g,z1=Array(4),Kw=function(i){return z1[i-1]||(z1[i-1]=RegExp("((?:%[\\da-f]{2}){"+i+"})","gi"))},Ww=function(i){try{return decodeURIComponent(i)}catch{return i}},X1=function(i){i=i.replace(Hw," ");var n=4;try{return decodeURIComponent(i)}catch{for(;n;)i=i.replace(Kw(n--),Ww);return i}},$1=/[!'()~]|%20/g,Yw={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},Z1=function(i){return Yw[i]},eI=function(i,n){if(n){var s,c;n=n.split("&");for(var u=0;u<n.length;)(s=n[u++]).length&&(c=s.split("="),i.push({key:X1(c.shift()),value:X1(c.join("="))}))}},qw=function(i){this.entries.length=0,eI(this.entries,i)},uc=function(i,n){if(i<n)throw TypeError("Not enough arguments")},hf=bv(function(i,n){J1(this,{type:"URLSearchParamsIterator",iterator:Y1(Ei(i).entries),kind:n})},"Iterator",function(){var i=jw(this),n=i.kind;i=i.iterator.next();var s=i.value;return i.done||(i.value=n==="keys"?s.key:n==="values"?s.value:[s.key,s.value]),i}),ml=function(){qa(this,ml,"URLSearchParams");var i,n,s,c,u,h=0<arguments.length?arguments[0]:void 0,f=[];if(J1(this,{type:"URLSearchParams",entries:f,updateURL:function(){},updateSearchParams:qw}),h!==void 0)if(qt(h))if(typeof(i=Fu(h))=="function")for(n=(i=i.call(h)).next;!(h=n.call(i)).done;){if((h=(c=(s=Y1(an(h.value))).next).call(s)).done||(u=c.call(s)).done||!c.call(s).done)throw TypeError("Expected sequence with length 2");f.push({key:h.value+"",value:u.value+""})}else for(n in h)nt(h,n)&&f.push({key:n,value:h[n]+""});else eI(f,typeof h=="string"?h.charAt(0)==="?"?h.slice(1):h:h+"")},pd=ml.prototype;ra(pd,{append:function(i,n){uc(arguments.length,2);var s=Ei(this);s.entries.push({key:i+"",value:n+""}),s.updateURL()},delete:function(i){uc(arguments.length,1);for(var n=Ei(this),s=n.entries,c=i+"",u=0;u<s.length;)s[u].key===c?s.splice(u,1):u++;n.updateURL()},get:function(i){uc(arguments.length,1);for(var n=Ei(this).entries,s=i+"",c=0;c<n.length;c++)if(n[c].key===s)return n[c].value;return null},getAll:function(i){uc(arguments.length,1);for(var n=Ei(this).entries,s=i+"",c=[],u=0;u<n.length;u++)n[u].key===s&&c.push(n[u].value);return c},has:function(i){uc(arguments.length,1);for(var n=Ei(this).entries,s=i+"",c=0;c<n.length;)if(n[c++].key===s)return!0;return!1},set:function(i,n){uc(arguments.length,1);for(var s,c=Ei(this),u=c.entries,h=!1,f=i+"",A=n+"",m=0;m<u.length;m++)(s=u[m]).key===f&&(h?u.splice(m--,1):(h=!0,s.value=A));h||u.push({key:f,value:A}),c.updateURL()},sort:function(){var i,n,s=Ei(this),c=s.entries,u=c.slice();for(n=c.length=0;n<u.length;n++){var h=u[n];for(i=0;i<n;i++)if(c[i].key>h.key){c.splice(i,0,h);break}i===n&&c.push(h)}s.updateURL()},forEach:function(i){for(var n,s=Ei(this).entries,c=gs(i,1<arguments.length?arguments[1]:void 0,3),u=0;u<s.length;)c((n=s[u++]).value,n.key,this)},keys:function(){return new hf(this,"keys")},values:function(){return new hf(this,"values")},entries:function(){return new hf(this,"entries")}},{enumerable:!0}),Yo(pd,Gw,pd.entries),Yo(pd,"toString",function(){for(var i,n=Ei(this).entries,s=[],c=0;c<n.length;)i=n[c++],s.push(encodeURIComponent(i.key).replace($1,Z1)+"="+encodeURIComponent(i.value).replace($1,Z1));return s.join("&")},{enumerable:!0}),Zs(ml,"URLSearchParams"),je({global:!0,forced:!lf},{URLSearchParams:ml}),lf||typeof q1!="function"||typeof df!="function"||je({global:!0,enumerable:!0,forced:!0},{fetch:function(i){var n,s,c,u=[i];return 1<arguments.length&&(qt(n=arguments[1])&&(s=n.body,Wa(s)==="URLSearchParams"&&((c=n.headers?new df(n.headers):new df).has("content-type")||c.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),n=vs(n,{body:Ho(0,String(s)),headers:Ho(0,c)}))),u.push(n)),q1.apply(this,u)}});var vl=He.URL,Jw=ml,zw=Sr.set,Ar=Sr.getterFor("URL"),Xw=Math.floor,tI=Math.pow,rI=/[A-Za-z]/,$w=/[\d+\-.A-Za-z]/,pf=/\d/,Zw=/^(0x|0X)/,eN=/^[0-7]+$/,tN=/^\d+$/,nI=/^[\dA-Fa-f]+$/,rN=/[\u0000\u0009\u000A\u000D #%/:?@[\\]]/,nN=/[\u0000\u0009\u000A\u000D #/:?@[\\]]/,iN=/^[\u0000-\u001F ]+|[\u0000-\u001F ]+$/g,oN=/[\u0009\u000A\u000D]/g,ff=function(i,n){var s,c;if(n.charAt(0)=="["){if(n.charAt(n.length-1)!="]"||!(s=aN(n.slice(1,-1))))return"Invalid host"}else if(tn(i)){var u=[],h=n.toLowerCase().replace(Fw,".").split(".");for(c=0;c<h.length;c++){var f=h[c];u.push(Uw.test(f)?"xn--"+Vw(f):f)}if(n=u.join("."),rN.test(n)||(s=sN(n))===null)return"Invalid host"}else{if(nN.test(n))return"Invalid host";for(s="",n=la(n),c=0;c<n.length;c++)s+=Cs(n[c],fd)}i.host=s},sN=function(i){var n,s,c,u,h=i.split(".");if(h.length&&h[h.length-1]==""&&h.pop(),4<(n=h.length))return i;var f=[];for(s=0;s<n;s++){if((c=h[s])=="")return i;if(u=10,1<c.length&&c.charAt(0)=="0"&&(u=Zw.test(c)?16:8,c=c.slice(u==8?1:2)),c==="")c=0;else{if(!(u==10?tN:u==8?eN:nI).test(c))return i;c=parseInt(c,u)}f.push(c)}for(s=0;s<n;s++)if(c=f[s],s==n-1){if(c>=tI(256,5-n))return null}else if(255<c)return null;for(i=f.pop(),s=0;s<f.length;s++)i+=f[s]*tI(256,3-s);return i},aN=function(i){var n,s,c,u=[0,0,0,0,0,0,0,0],h=0,f=null,A=0,m=function(){return i.charAt(A)};if(m()==":"){if(i.charAt(1)!=":")return;A+=2,f=++h}for(;m();){if(h==8)return;if(m()!=":"){for(n=s=0;4>s&&nI.test(m());)n=16*n+parseInt(m(),16),A++,s++;if(m()=="."){if(s==0||(A-=s,6<h))return;for(n=0;m();){if(s=null,0<n){if(!(m()=="."&&4>n))return;A++}if(!pf.test(m()))return;for(;pf.test(m());){if(c=parseInt(m(),10),s===null)s=c;else{if(s==0)return;s=10*s+c}if(255<s)return;A++}u[h]=256*u[h]+s,++n!=2&&n!=4||h++}if(n!=4)return;break}if(m()==":"){if(A++,!m())return}else if(m())return;u[h++]=n}else{if(f!==null)return;A++,f=++h}}if(f!==null)for(m=h-f,h=7;h!=0&&0<m;)n=u[h],u[h--]=u[f+m-1],u[f+--m]=n;else if(h!=8)return;return u},El=function(i){var n,s;if(typeof i=="number"){var c=[];for(n=0;4>n;n++)c.unshift(i%256),i=Xw(i/256);return c.join(".")}if(typeof i=="object"){c="",n=null;for(var u=1,h=null,f=0,A=0;8>A;A++)i[A]!==0?(f>u&&(n=h,u=f),h=null,f=0):(h===null&&(h=A),++f);for(u=(f>u&&(n=h),n),n=0;8>n;n++)s&&i[n]===0||(s&&(s=!1),u===n?(c+=n?":":"::",s=!0):(c+=i[n].toString(16),7>n&&(c+=":")));return"["+c+"]"}return i},fd={},iI=il({},fd,{" ":1,'"':1,"<":1,">":1,"`":1}),oI=il({},iI,{"#":1,"?":1,"{":1,"}":1}),Af=il({},oI,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Cs=function(i,n){var s=N2(i,0);return 32<s&&127>s&&!nt(n,i)?i:encodeURIComponent(i)},Ad={ftp:21,file:null,http:80,https:443,ws:80,wss:443},tn=function(i){return nt(Ad,i.scheme)},gf=function(i){return!i.host||i.cannotBeABaseURL||i.scheme=="file"},Il=function(i,n){var s;return i.length==2&&rI.test(i.charAt(0))&&((s=i.charAt(1))==":"||!n&&s=="|")},sI=function(i){var n;return 1<i.length&&Il(i.slice(0,2))&&(i.length==2||(n=i.charAt(2))==="/"||n==="\\"||n==="?"||n==="#")},aI=function(i){var n=i.path,s=n.length;!s||i.scheme=="file"&&s==1&&Il(n[0],!0)||n.pop()},mf={},cI={},vf={},lI={},uI={},Ef={},dI={},hI={},gd={},md={},If={},Cf={},yf={},_f={},pI={},Sf={},Cl={},Ro={},fI={},ua={},Zo={},wo=function(i,n,s,c){var u,h,f=s||mf,A=0,m="",I=!1,E=!1,_=!1;for(s||(i.scheme="",i.username="",i.password="",i.host=null,i.port=null,i.path=[],i.query=null,i.fragment=null,i.cannotBeABaseURL=!1,n=n.replace(iN,"")),n=n.replace(oN,""),n=la(n);A<=n.length;){switch(u=n[A],f){case mf:if(!u||!rI.test(u)){if(s)return"Invalid scheme";f=vf;continue}m+=u.toLowerCase(),f=cI;break;case cI:if(u&&($w.test(u)||u=="+"||u=="-"||u=="."))m+=u.toLowerCase();else{if(u!=":"){if(s)return"Invalid scheme";m="",f=vf,A=0;continue}if(s&&(tn(i)!=nt(Ad,m)||m=="file"&&(i.username!=""||i.password!=""||i.port!==null)||i.scheme=="file"&&!i.host))return;if(i.scheme=m,s)return void(tn(i)&&Ad[i.scheme]==i.port&&(i.port=null));m="",i.scheme=="file"?f=_f:tn(i)&&c&&c.scheme==i.scheme?f=lI:tn(i)?f=hI:n[A+1]=="/"?(f=uI,A++):(i.cannotBeABaseURL=!0,i.path.push(""),f=fI)}break;case vf:if(!c||c.cannotBeABaseURL&&u!="#")return"Invalid scheme";if(c.cannotBeABaseURL&&u=="#"){i.scheme=c.scheme,i.path=c.path.slice(),i.query=c.query,i.fragment="",i.cannotBeABaseURL=!0,f=Zo;break}f=c.scheme=="file"?_f:Ef;continue;case lI:if(u!="/"||n[A+1]!="/"){f=Ef;continue}f=gd,A++;break;case uI:if(u=="/"){f=md;break}f=Ro;continue;case Ef:if(i.scheme=c.scheme,u==null)i.username=c.username,i.password=c.password,i.host=c.host,i.port=c.port,i.path=c.path.slice(),i.query=c.query;else if(u=="/"||u=="\\"&&tn(i))f=dI;else if(u=="?")i.username=c.username,i.password=c.password,i.host=c.host,i.port=c.port,i.path=c.path.slice(),i.query="",f=ua;else{if(u!="#"){i.username=c.username,i.password=c.password,i.host=c.host,i.port=c.port,i.path=c.path.slice(),i.path.pop(),f=Ro;continue}i.username=c.username,i.password=c.password,i.host=c.host,i.port=c.port,i.path=c.path.slice(),i.query=c.query,i.fragment="",f=Zo}break;case dI:if(!tn(i)||u!="/"&&u!="\\"){if(u!="/"){i.username=c.username,i.password=c.password,i.host=c.host,i.port=c.port,f=Ro;continue}f=md}else f=gd;break;case hI:if(f=gd,u!="/"||m.charAt(A+1)!="/")continue;A++;break;case gd:if(u!="/"&&u!="\\"){f=md;continue}break;case md:if(u=="@"){for(I&&(m="%40"+m),I=!0,m=la(m),u=0;u<m.length;u++){var S=m[u];S!=":"||_?(S=Cs(S,Af),_?i.password+=S:i.username+=S):_=!0}m=""}else if(u==null||u=="/"||u=="?"||u=="#"||u=="\\"&&tn(i)){if(I&&m=="")return"Invalid authority";A-=la(m).length+1,m="",f=If}else m+=u;break;case If:case Cf:if(s&&i.scheme=="file"){f=Sf;continue}if(u!=":"||E){if(u==null||u=="/"||u=="?"||u=="#"||u=="\\"&&tn(i)){if(tn(i)&&m=="")return"Invalid host";if(s&&m==""&&(i.username!=""||i.password!=""||i.port!==null))return;if(f=ff(i,m))return f;if(m="",f=Cl,s)return;continue}u=="["?E=!0:u=="]"&&(E=!1),m+=u}else{if(m=="")return"Invalid host";if(f=ff(i,m))return f;if(m="",f=yf,s==Cf)return}break;case yf:if(!pf.test(u)){if(u==null||u=="/"||u=="?"||u=="#"||u=="\\"&&tn(i)||s){if(m!=""){if(f=parseInt(m,10),65535<f)return"Invalid port";i.port=tn(i)&&f===Ad[i.scheme]?null:f,m=""}if(s)return;f=Cl;continue}return"Invalid port"}m+=u;break;case _f:if(i.scheme="file",u=="/"||u=="\\")f=pI;else{if(!c||c.scheme!="file"){f=Ro;continue}if(u==null)i.host=c.host,i.path=c.path.slice(),i.query=c.query;else if(u=="?")i.host=c.host,i.path=c.path.slice(),i.query="",f=ua;else{if(u!="#"){sI(n.slice(A).join(""))||(i.host=c.host,i.path=c.path.slice(),aI(i)),f=Ro;continue}i.host=c.host,i.path=c.path.slice(),i.query=c.query,i.fragment="",f=Zo}}break;case pI:if(u=="/"||u=="\\"){f=Sf;break}c&&c.scheme=="file"&&!sI(n.slice(A).join(""))&&(Il(c.path[0],!0)?i.path.push(c.path[0]):i.host=c.host),f=Ro;continue;case Sf:if(u==null||u=="/"||u=="\\"||u=="?"||u=="#"){if(!s&&Il(m))f=Ro;else{if(m==""){if(i.host="",s)return}else{if(f=ff(i,m))return f;if(i.host=="localhost"&&(i.host=""),s)return;m=""}f=Cl}continue}m+=u;break;case Cl:if(tn(i)){if(f=Ro,u!="/"&&u!="\\")continue}else if(s||u!="?")if(s||u!="#"){if(u!=null&&(f=Ro,u!="/"))continue}else i.fragment="",f=Zo;else i.query="",f=ua;break;case Ro:if(u==null||u=="/"||u=="\\"&&tn(i)||!s&&(u=="?"||u=="#")){if((h=(h=m).toLowerCase())===".."||h==="%2e."||h===".%2e"||h==="%2e%2e"?(aI(i),u=="/"||u=="\\"&&tn(i)||i.path.push("")):m==="."||m.toLowerCase()==="%2e"?u=="/"||u=="\\"&&tn(i)||i.path.push(""):(i.scheme=="file"&&!i.path.length&&Il(m)&&(i.host&&(i.host=""),m=m.charAt(0)+":"),i.path.push(m)),m="",i.scheme=="file"&&(u==null||u=="?"||u=="#"))for(;1<i.path.length&&i.path[0]==="";)i.path.shift();u=="?"?(i.query="",f=ua):u=="#"&&(i.fragment="",f=Zo)}else m+=Cs(u,oI);break;case fI:u=="?"?(i.query="",f=ua):u=="#"?(i.fragment="",f=Zo):u!=null&&(i.path[0]+=Cs(u,fd));break;case ua:s||u!="#"?u!=null&&(u=="'"&&tn(i)?i.query+="%27":i.query+=u=="#"?"%23":Cs(u,fd)):(i.fragment="",f=Zo);break;case Zo:u!=null&&(i.fragment+=Cs(u,iI))}A++}},da=function(i){var n=qa(this,da,"URL"),s=1<arguments.length?arguments[1]:void 0,c=String(i),u=zw(n,{type:"URL"});if(s!==void 0){if(s instanceof da)var h=Ar(s);else if(s=wo(h={},String(s)))throw TypeError(s)}if(s=wo(u,c,null,h))throw TypeError(s);var f=u.searchParams=new Jw;h=Ei(f),h.updateSearchParams(u.query),h.updateURL=function(){u.query=String(f)||null},jt||(n.href=vd.call(n),n.origin=AI.call(n),n.protocol=gI.call(n),n.username=mI.call(n),n.password=vI.call(n),n.host=EI.call(n),n.hostname=II.call(n),n.port=CI.call(n),n.pathname=yI.call(n),n.search=_I.call(n),n.searchParams=SI.call(n),n.hash=TI.call(n))},Tf=da.prototype,vd=function(){var i=Ar(this),n=i.scheme,s=i.username,c=i.password,u=i.host,h=i.port,f=i.path,A=i.query,m=i.fragment,I=n+":";return u!==null?(I+="//",(i.username!=""||i.password!="")&&(I+=s+(c?":"+c:"")+"@"),I+=El(u),h!==null&&(I+=":"+h)):n=="file"&&(I+="//"),I+=i.cannotBeABaseURL?f[0]:f.length?"/"+f.join("/"):"",A!==null&&(I+="?"+A),m!==null&&(I+="#"+m),I},AI=function(){var i=Ar(this),n=i.scheme,s=i.port;if(n=="blob")try{return new URL(n.path[0]).origin}catch{return"null"}return n!="file"&&tn(i)?n+"://"+El(i.host)+(s!==null?":"+s:""):"null"},gI=function(){return Ar(this).scheme+":"},mI=function(){return Ar(this).username},vI=function(){return Ar(this).password},EI=function(){var i=Ar(this),n=i.host;return i=i.port,n===null?"":i===null?El(n):El(n)+":"+i},II=function(){var i=Ar(this).host;return i===null?"":El(i)},CI=function(){var i=Ar(this).port;return i===null?"":String(i)},yI=function(){var i=Ar(this),n=i.path;return i.cannotBeABaseURL?n[0]:n.length?"/"+n.join("/"):""},_I=function(){var i=Ar(this).query;return i?"?"+i:""},SI=function(){return Ar(this).searchParams},TI=function(){var i=Ar(this).fragment;return i?"#"+i:""},Vi=function(i,n){return{get:i,set:n,configurable:!0,enumerable:!0}};if(jt&&ap(Tf,{href:Vi(vd,function(i){var n=Ar(this);if(i=wo(n,String(i)))throw TypeError(i);Ei(n.searchParams).updateSearchParams(n.query)}),origin:Vi(AI),protocol:Vi(gI,function(i){var n=Ar(this);wo(n,String(i)+":",mf)}),username:Vi(mI,function(i){var n=Ar(this);if(i=la(String(i)),!gf(n)){n.username="";for(var s=0;s<i.length;s++)n.username+=Cs(i[s],Af)}}),password:Vi(vI,function(i){var n=Ar(this);if(i=la(String(i)),!gf(n)){n.password="";for(var s=0;s<i.length;s++)n.password+=Cs(i[s],Af)}}),host:Vi(EI,function(i){var n=Ar(this);n.cannotBeABaseURL||wo(n,String(i),If)}),hostname:Vi(II,function(i){var n=Ar(this);n.cannotBeABaseURL||wo(n,String(i),Cf)}),port:Vi(CI,function(i){var n=Ar(this);gf(n)||((i=String(i))==""?n.port=null:wo(n,i,yf))}),pathname:Vi(yI,function(i){var n=Ar(this);n.cannotBeABaseURL||(n.path=[],wo(n,i+"",Cl))}),search:Vi(_I,function(i){var n=Ar(this);(i=String(i))==""?n.query=null:(i.charAt(0)=="?"&&(i=i.slice(1)),n.query="",wo(n,i,ua)),Ei(n.searchParams).updateSearchParams(n.query)}),searchParams:Vi(SI),hash:Vi(TI,function(i){var n=Ar(this);(i=String(i))!=""?(i.charAt(0)=="#"&&(i=i.slice(1)),n.fragment="",wo(n,i,Zo)):n.fragment=null})}),Yo(Tf,"toJSON",function(){return vd.call(this)},{enumerable:!0}),Yo(Tf,"toString",function(){return vd.call(this)},{enumerable:!0}),vl){var RI=vl.createObjectURL,wI=vl.revokeObjectURL;RI&&Yo(da,"createObjectURL",function(i){return RI.apply(vl,arguments)}),wI&&Yo(da,"revokeObjectURL",function(i){return wI.apply(vl,arguments)})}Zs(da,"URL"),je({global:!0,forced:!lf,sham:!jt},{URL:da});var cN=Ft.URL;(function(){function i(G){var q=0;return function(){return q<G.length?{done:!1,value:G[q++]}:{done:!0}}}function n(G,q){if(q)e:{var Z=O;G=G.split(".");for(var ue=0;ue<G.length-1;ue++){var de=G[ue];if(!(de in Z))break e;Z=Z[de]}(q=q(ue=Z[G=G[G.length-1]]))!=ue&&q!=null&&N(Z,G,{configurable:!0,writable:!0,value:q})}}function s(G){return(G={next:G})[Symbol.iterator]=function(){return this},G}function c(G){var q=typeof Symbol!="undefined"&&Symbol.iterator&&G[Symbol.iterator];return q?q.call(G):{next:i(G)}}function u(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function h(G){if(G.m)throw new TypeError("Generator is already running");G.m=!0}function f(G,q){return G.h=3,{value:q}}function A(G){this.g=new u,this.G=G}function m(G,q,Z,ue){try{var de=q.call(G.g.j,Z);if(!(de instanceof Object))throw new TypeError("Iterator result "+de+" is not an object");if(!de.done)return G.g.m=!1,de;var Le=de.value}catch(_e){return G.g.j=null,G.g.s(_e),I(G)}return G.g.j=null,ue.call(G.g,Le),I(G)}function I(G){for(;G.g.h;)try{var q=G.G(G.g);if(q)return G.g.m=!1,{value:q.value,done:!1}}catch(Z){G.g.v=void 0,G.g.s(Z)}if(G.g.m=!1,G.g.l){if(q=G.g.l,G.g.l=null,q.F)throw q.D;return{value:q.return,done:!0}}return{value:void 0,done:!0}}function E(G){this.next=function(q){return G.o(q)},this.throw=function(q){return G.s(q)},this.return=function(q){return function(Z,ue){h(Z.g);var de=Z.g.j;return de?m(Z,"return"in de?de.return:function(Le){return{value:Le,done:!0}},ue,Z.g.return):(Z.g.return(ue),I(Z))}(G,q)},this[Symbol.iterator]=function(){return this}}function _(G,q){return q=new E(new A(q)),J&&G.prototype&&J(q,G.prototype),q}var S,N=typeof Object.defineProperties=="function"?Object.defineProperty:function(G,q,Z){return G==Array.prototype||G==Object.prototype||(G[q]=Z.value),G},O=function(G){G=[typeof globalThis=="object"&&globalThis,G,typeof window=="object"&&window,typeof self=="object"&&self,typeof $c=="object"&&$c];for(var q=0;q<G.length;++q){var Z=G[q];if(Z&&Z.Math==Math)return Z}throw Error("Cannot find global object")}(this);if(n("Symbol",function(G){function q(de,Le){this.A=de,N(this,"description",{configurable:!0,writable:!0,value:Le})}if(G)return G;q.prototype.toString=function(){return this.A};var Z="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",ue=0;return function de(Le){if(this instanceof de)throw new TypeError("Symbol is not a constructor");return new q(Z+(Le||"")+"_"+ue++,Le)}}),n("Symbol.iterator",function(G){if(G)return G;G=Symbol("Symbol.iterator");for(var q="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Z=0;Z<q.length;Z++){var ue=O[q[Z]];typeof ue=="function"&&typeof ue.prototype[G]!="function"&&N(ue.prototype,G,{configurable:!0,writable:!0,value:function(){return s(i(this))}})}return G}),typeof Object.setPrototypeOf=="function")var B=Object.setPrototypeOf;else{e:{var P={};try{P.__proto__={a:!0},B=P.a;break e}catch{}B=!1}B=B?function(G,q){if(G.__proto__=q,G.__proto__!==q)throw new TypeError(G+" is not extensible");return G}:null}var J=B;if(u.prototype.o=function(G){this.v=G},u.prototype.s=function(G){this.l={D:G,F:!0},this.h=this.C||this.u},u.prototype.return=function(G){this.l={return:G},this.h=this.u},A.prototype.o=function(G){return h(this.g),this.g.j?m(this,this.g.j.next,G,this.g.o):(this.g.o(G),I(this))},A.prototype.s=function(G){return h(this.g),this.g.j?m(this,this.g.j.throw,G,this.g.o):(this.g.s(G),I(this))},n("Array.prototype.entries",function(G){return G||function(){return function(q,Z){q instanceof String&&(q+="");var ue=0,de=!1,Le={next:function(){if(!de&&ue<q.length){var _e=ue++;return{value:Z(_e,q[_e]),done:!1}}return de=!0,{done:!0,value:void 0}}};return Le[Symbol.iterator]=function(){return Le},Le}(this,function(q,Z){return[q,Z]})}}),typeof Blob!="undefined"&&(typeof FormData=="undefined"||!FormData.prototype.keys)){var ne=function(G,q){for(var Z=0;Z<G.length;Z++)q(G[Z])},Ae=function(G){return G.replace(/\r?\n|\r/g,`\r
`)},Me=function(G,q,Z){return q instanceof Blob?(Z=Z!==void 0?String(Z+""):typeof q.name=="string"?q.name:"blob",q.name===Z&&Object.prototype.toString.call(q)!=="[object Blob]"||(q=new File([q],Z)),[String(G),q]):[String(G),String(q)]},be=function(G,q){if(G.length<q)throw new TypeError(q+" argument required, but only "+G.length+" present.")};B=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this;var Rt=B.FormData,ve=B.XMLHttpRequest&&B.XMLHttpRequest.prototype.send,et=B.Request&&B.fetch,It=B.navigator&&B.navigator.sendBeacon;P=B.Element&&B.Element.prototype;var zt=B.Symbol&&Symbol.toStringTag;zt&&(Blob.prototype[zt]||(Blob.prototype[zt]="Blob"),"File"in B&&!File.prototype[zt]&&(File.prototype[zt]="File"));try{new File([],"")}catch{B.File=function(q,Z,ue){return q=new Blob(q,ue||{}),Object.defineProperties(q,{name:{value:Z},lastModified:{value:+(ue&&ue.lastModified!==void 0?new Date(ue.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),zt&&Object.defineProperty(q,zt,{value:"File"}),q}}var Pr=function(G){return G.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Vt=function(G){this.i=[];var q=this;G&&ne(G.elements,function(Z){if(Z.name&&!Z.disabled&&Z.type!=="submit"&&Z.type!=="button"&&!Z.matches("form fieldset[disabled] *"))if(Z.type==="file"){var ue=Z.files&&Z.files.length?Z.files:[new File([],"",{type:"application/octet-stream"})];ne(ue,function(de){q.append(Z.name,de)})}else Z.type==="select-multiple"||Z.type==="select-one"?ne(Z.options,function(de){!de.disabled&&de.selected&&q.append(Z.name,de.value)}):Z.type==="checkbox"||Z.type==="radio"?Z.checked&&q.append(Z.name,Z.value):(ue=Z.type==="textarea"?Ae(Z.value):Z.value,q.append(Z.name,ue))})};if((S=Vt.prototype).append=function(G,q,Z){be(arguments,2),this.i.push(Me(G,q,Z))},S.delete=function(G){be(arguments,1);var q=[];G=String(G),ne(this.i,function(Z){Z[0]!==G&&q.push(Z)}),this.i=q},S.entries=function G(){var q,Z=this;return _(G,function(ue){if(ue.h==1&&(q=0),ue.h!=3)return q<Z.i.length?ue=f(ue,Z.i[q]):(ue.h=0,ue=void 0),ue;q++,ue.h=2})},S.forEach=function(G,q){be(arguments,1);for(var Z=c(this),ue=Z.next();!ue.done;ue=Z.next()){var de=c(ue.value);ue=de.next().value,de=de.next().value,G.call(q,de,ue,this)}},S.get=function(G){be(arguments,1);var q=this.i;G=String(G);for(var Z=0;Z<q.length;Z++)if(q[Z][0]===G)return q[Z][1];return null},S.getAll=function(G){be(arguments,1);var q=[];return G=String(G),ne(this.i,function(Z){Z[0]===G&&q.push(Z[1])}),q},S.has=function(G){be(arguments,1),G=String(G);for(var q=0;q<this.i.length;q++)if(this.i[q][0]===G)return!0;return!1},S.keys=function G(){var q,Z,ue,de,Le=this;return _(G,function(_e){if(_e.h==1&&(q=c(Le),Z=q.next()),_e.h!=3)return Z.done?void(_e.h=0):(ue=Z.value,de=c(ue),f(_e,de.next().value));Z=q.next(),_e.h=2})},S.set=function(G,q,Z){be(arguments,2),G=String(G);var ue=[],de=Me(G,q,Z),Le=!0;ne(this.i,function(_e){_e[0]===G?Le&&(Le=!ue.push(de)):ue.push(_e)}),Le&&ue.push(de),this.i=ue},S.values=function G(){var q,Z,ue,de,Le=this;return _(G,function(_e){if(_e.h==1&&(q=c(Le),Z=q.next()),_e.h!=3)return Z.done?void(_e.h=0):(ue=Z.value,(de=c(ue)).next(),f(_e,de.next().value));Z=q.next(),_e.h=2})},Vt.prototype._asNative=function(){for(var G=new Rt,q=c(this),Z=q.next();!Z.done;Z=q.next()){var ue=c(Z.value);Z=ue.next().value,ue=ue.next().value,G.append(Z,ue)}return G},Vt.prototype._blob=function(){var G="----formdata-polyfill-"+Math.random(),q=[],Z="--"+G+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(ue,de){return typeof ue=="string"?q.push(Z+Pr(Ae(de))+`"\r
\r
`+Ae(ue)+`\r
`):q.push(Z+Pr(Ae(de))+'"; filename="'+Pr(ue.name)+`"\r
Content-Type: `+(ue.type||"application/octet-stream")+`\r
\r
`,ue,`\r
`)}),q.push("--"+G+"--"),new Blob(q,{type:"multipart/form-data; boundary="+G})},Vt.prototype[Symbol.iterator]=function(){return this.entries()},Vt.prototype.toString=function(){return"[object FormData]"},P&&!P.matches&&(P.matches=P.matchesSelector||P.mozMatchesSelector||P.msMatchesSelector||P.oMatchesSelector||P.webkitMatchesSelector||function(G){for(var q=(G=(this.document||this.ownerDocument).querySelectorAll(G)).length;0<=--q&&G.item(q)!==this;);return-1<q}),zt&&(Vt.prototype[zt]="FormData"),ve){var dn=B.XMLHttpRequest.prototype.setRequestHeader;B.XMLHttpRequest.prototype.setRequestHeader=function(G,q){dn.call(this,G,q),G.toLowerCase()==="content-type"&&(this.B=!0)},B.XMLHttpRequest.prototype.send=function(G){G instanceof Vt?(G=G._blob(),this.B||this.setRequestHeader("Content-Type",G.type),ve.call(this,G)):ve.call(this,G)}}et&&(B.fetch=function(G,q){return q&&q.body&&q.body instanceof Vt&&(q.body=q.body._blob()),et.call(this,G,q)}),It&&(B.navigator.sendBeacon=function(G,q){return q instanceof Vt&&(q=q._asNative()),It.call(this,G,q)}),B.FormData=Vt}})();let Rf=1,wf=1,NI=(i,n,s,c,u)=>{var h,f,A;const m=[];if(K(h=i.response_body).call(h,I=>{var E=I.buffer.code;E!==0&&(E=Nu(E),I={error:new L(D.CAN_NOT_GET_GATEWAY_SERVER,E.desc,{retry:E.retry,csIp:i.detail[502]}),flag:I.buffer.flag},m.push(I),I.flag===4096?z.joinChooseServer(s.sid,{lts:c,succ:!1,csAddr:n,opid:i.opid,serverList:null,ec:I.error.message,csIp:I.error.data&&I.error.data.csIp,unilbsServerIds:u.toString()}):I.flag!==1048576&&I.flag!==4194304||z.joinWebProxyAP(s.sid,{lts:c,sucess:0,apServerAddr:n,turnServerAddrList:null,errorCode:I.error.code,eventType:s.cloudProxyServer,unilbsServerIds:u.toString()}))}),m.length)throw R.warning(b(f=b(A="[".concat(s.clientId,"] multi unilbs ")).call(A,n," failed, ")).call(f,Ie(m).call(m,I=>{var E,_;return b(E=b(_="flag: ".concat(I.flag,", message: ")).call(_,I.error.message,", retry: ")).call(E,I.error.data.retry)}).join(" | "))),new L(D.CAN_NOT_GET_GATEWAY_SERVER,Ie(m).call(m,I=>{var E;return b(E="flag: ".concat(I.flag,", message: ")).call(E,I.error.message)}).join(" | "),{retry:!!Xe(m).call(m,I=>I.error.data.retry),csIp:i.detail[502]})},OI=i=>{if(i.addresses&&i.addresses.length===0&&i.code===0)throw new L(D.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:i.detail&&i.detail[502]});if(te.GATEWAY_ADDRESS&&0<te.GATEWAY_ADDRESS.length){var n;R.debug("assign gateway address to",te.GATEWAY_ADDRESS);const s=Ie(n=te.GATEWAY_ADDRESS).call(n,c=>({ip:c.ip,port:c.port,ticket:i.addresses[0]&&i.addresses[0].ticket}));i.addresses=s}},kI=(i,n,s)=>{var c;const u=Math.floor(1e12*Math.random());return n={appid:i.appId,client_ts:le(),opid:u,sid:i.sid,request_bodies:[{uri:22,buffer:{cname:i.cname,detail:{6:i.stringUid,11:n},key:i.token,service_ids:s,uid:i.uid||0}}]},K(c=n.request_bodies).call(c,h=>{i.multiIP&&i.multiIP.gateway_ip&&(h.buffer.detail[5]=fe({vocs_ip:[i.multiIP.uni_lbs_ip],vos_ip:[i.multiIP.gateway_ip]}))}),c=new FormData,c.append("request",fe(n)),[c,u]},yl=()=>{const i=te.AREAS;return i.length===0&&i.push("GLOBAL"),Ju(i).call(i,(n,s,c)=>{var u,h,f,A,m;s=s==="OVERSEA"?b(u=b(h=b(f=b(A=b(m="".concat(Br.ASIA,",")).call(m,Br.EUROPE,",")).call(A,Br.AFRICA,",")).call(f,Br.NORTH_AMERICA,",")).call(h,Br.SOUTH_AMERICA,",")).call(u,Br.OCEANIA):Br[s];var I;return s?c===0?s:b(I="".concat(n,",")).call(I,s):n},"")};var Ed={ASIA:["CHINA","JAPAN","INDIA"],EUROPE:[],NORTH_AMERICA:[],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]};let dc=pt(Ed),Id="CHINA NORTH_AMERICA EUROPE ASIA JAPAN INDIA OCEANIA SOUTH_AMERICA AFRICA".split(" "),lN=function(i,n){var s=[];if(vt(i).call(i,"GLOBAL")){s=["GLOBAL","OVERSEA"];const u=pt(jp);if(n==="GLOBAL")throw new L(D.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(n==="CHINA")s=["OVERSEA"];else if(c=n,vt(dc).call(dc,c)){i=Ed[n]||[];const h=[...s,n,...i];s=Qe(u).call(u,f=>!vt(h).call(h,f))}else if(function(h){let f=!1;return K(dc).call(dc,A=>{var m;vt(m=Ed[A]).call(m,h)&&(f=!0)}),f}(n)){i=function(f){let A;return K(dc).call(dc,m=>{var I;vt(I=Ed[m]).call(I,f)&&(A=m)}),A}(n);const h=[...s,i,n];s=Qe(u).call(u,f=>!vt(h).call(h,f))}else s=i;s=function(h){const f=[];return K(Id).call(Id,A=>{vt(h).call(h,A)&&f.push(A)}),b(f).call(f,Qe(h).call(h,A=>!vt(Id).call(Id,A)))}(s)}else s=i;var c;return s};class uN extends Zr{constructor(){super();this.retryConfig={timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4},this.mutex=new Xo("config-distribute")}startGetConfigDistribute(n,s){this.joinInfo=n,this.cancelToken=s,this.interval&&this.stopGetConfigDistribute(),this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},te.CONFIG_DISTRIBUTE_INTERVAL)}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.cancelToken=this.joinInfo=this.interval=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(!this.joinInfo||!this.cancelToken||!this.retryConfig)return void R.debug("[config-distribute] get config distribute interrupted have no joininfo");let n,s=await this.mutex.lock();try{n=await yT(this.joinInfo,this.cancelToken,this.retryConfig),R.debug("[config-distribute] get config distribute",fe(n)),n.limit_bitrate&&this.handleBitrateLimit(n.limit_bitrate),this.configs=n}catch(c){let u=new L(D.NETWORK_RESPONSE_ERROR,c);R.warning("[config-distribute] ".concat(u.toString()))}finally{s()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(n){n&&n.uplink&&n.id&&n.uplink.max_bitrate!==void 0&&n.uplink.min_bitrate!==void 0&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==n.id&&this.emit(pl.UPDATE_BITRATE_LIMIT,n):this.emit(pl.UPDATE_BITRATE_LIMIT,n))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&function(n){for(var s=1;s<arguments.length;s++){var c,u=arguments[s]!=null?arguments[s]:{};if(s%2)K(c=Lm(Object(u),!0)).call(c,function(f){wn(n,f,u[f])});else if(xt)Tn(n,xt(u));else{var h;K(h=Lm(Object(u))).call(h,function(f){ft(n,f,ut(u,f))})}}return n}({},this.configs.limit_bitrate.low_stream_uplink)}}var Nf=function(){function i(n){this.input=[],this.size=n}return i.prototype.add=function(n){this.input.push(n),this.input.length>this.size&&this.input.splice(0,1)},i.prototype.diffMean=function(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length},i}(),bI=function(i,n){return(bI=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var u in c)c.hasOwnProperty(u)&&(s[u]=c[u])})(i,n)},Of=function(){return(Of=Object.assign||function(i){for(var n,s=1,c=arguments.length;s<c;s++)for(var u in n=arguments[s])Object.prototype.hasOwnProperty.call(n,u)&&(i[u]=n[u]);return i}).apply(this,arguments)},ys,_l={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[]},DI={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0},BI={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0},MI={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0},LI={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0},kf=function(){function i(n,s){var c=this;this.videoIsReady=!1,this.stats=Bi(_l),this.isFirstAudioDecoded=this.isFirstAudioReceived=this.isFirstVideoDecoded=this.isFirstVideoReceived=!1,this.lossRateWindowStats=[],this.pc=n,this.options=s,this.intervalTimer=window.setInterval(function(){return Yh(c,void 0,void 0,function(){return qh(this,function(u){return this.updateStats(),[2]})})},this.options.updateInterval)}return i.prototype.getStats=function(){return this.stats},i.prototype.setVideoIsReady=function(n){this.videoIsReady=n},i.prototype.setIsFirstAudioDecoded=function(n){this.isFirstAudioDecoded=n},i.prototype.destroy=function(){window.clearInterval(this.intervalTimer),this.pc=void 0},i.prototype.calcLossRate=function(n){var s=this;this.lossRateWindowStats.push(n),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);for(var c=this.lossRateWindowStats.length,u=0,h=0,f=0,A=0,m=function(_){n[_].forEach(function(S,N){if(s.lossRateWindowStats[c-1][_][N]&&s.lossRateWindowStats[0][_][N]){var O=s.lossRateWindowStats[c-1][_][N].packets-s.lossRateWindowStats[0][_][N].packets;N=s.lossRateWindowStats[c-1][_][N].packetsLost-s.lossRateWindowStats[0][_][N].packetsLost,_==="videoSend"||_==="audioSend"?(u+=O,f+=N):(h+=O,A+=N),Number.isNaN(O)||Number.isNaN(O)?S.packetLostRate=0:S.packetLostRate=0>=O||0>=N?0:N/(O+N)}})},I=0,E=["videoSend","audioSend","videoRecv","audioRecv"];I<E.length;I++)m(E[I]);n.sendPacketLossRate=0>=u||0>=f?0:f/(u+f),n.recvPacketLossRate=0>=h||0>=A?0:A/(h+A)},i}(),dN=function(i){function n(){var s=i!==null&&i.apply(this,arguments)||this;return s._stats=_l,s.lastDecodeVideoReceiverStats=new Map,s}return Wh(n,i),n.prototype.updateStats=function(){return Yh(this,void 0,void 0,function(){var s,c,u,h;return qh(this,function(f){switch(f.label){case 0:return[4,this._getStats()];case 1:return s=f.sent(),c=this.statsResponsesToObjects(s),this._stats=Bi(_l),u=c.filter(function(A){return A.type==="ssrc"}),this.processSSRCStats(u),(h=c.find(function(A){return A.type==="VideoBwe"}))&&this.processBandwidthStats(h),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats,[2]}})})},n.prototype.processBandwidthStats=function(s){this._stats.bitrate={actualEncoded:Number(s.googActualEncBitrate),targetEncoded:Number(s.googTargetEncBitrate),retransmit:Number(s.googRetransmitBitrate),transmit:Number(s.googTransmitBitrate)},this._stats.sendBandwidth=Number(s.googAvailableSendBandwidth)},n.prototype.processSSRCStats=function(s){var c=this;s.forEach(function(u){var h=u.id.includes("send");switch(u.mediaType+"_"+(h?"send":"recv")){case"video_send":h=Bi(BI),h.codec=u.googCodecName,h.adaptionChangeReason="none",u.googCpuLimitedResolution&&(h.adaptionChangeReason="cpu"),u.googBandwidthLimitedResolution&&(h.adaptionChangeReason="bandwidth"),h.avgEncodeMs=Number(u.googAvgEncodeMs),h.inputFrame={width:Number(u.googFrameWidthInput)||Number(u.googFrameWidthSent),height:Number(u.googFrameHeightInput)||Number(u.googFrameHeightSent),frameRate:Number(u.googFrameRateInput)},h.sentFrame={width:Number(u.googFrameWidthSent),height:Number(u.googFrameHeightSent),frameRate:Number(u.googFrameRateInput)},h.firsCount=Number(u.googFirReceived),h.nacksCount=Number(u.googNacksReceived),h.plisCount=Number(u.googPlisReceived),h.frameCount=Number(u.framesEncoded),h.bytes=Number(u.bytesSent),h.packets=Number(u.packetsSent),h.packetsLost=Number(u.packetsLost),h.ssrc=Number(u.ssrc),h.rttMs=Number(u.googRtt||0),c._stats.videoSend.push(h),c._stats.rtt=h.rttMs;break;case"video_recv":h=Bi(DI);var f=c.lastDecodeVideoReceiverStats.get(Number(u.ssrc));if(h.codec=u.googCodecName,h.targetDelayMs=Number(u.googTargetDelayMs),h.renderDelayMs=Number(u.googRenderDelayMs),h.currentDelayMs=Number(u.googCurrentDelayMs),h.minPlayoutDelayMs=Number(u.googMinPlayoutDelayMs),h.decodeMs=Number(u.googDecodeMs),h.maxDecodeMs=Number(u.googMaxDecodeMs),h.receivedFrame={width:Number(u.googFrameWidthReceived),height:Number(u.googFrameHeightReceived),frameRate:Number(u.googFrameRateReceived)},h.decodedFrame={width:Number(u.googFrameWidthReceived),height:Number(u.googFrameHeightReceived),frameRate:Number(u.googFrameRateDecoded)},h.outputFrame={width:Number(u.googFrameWidthReceived),height:Number(u.googFrameHeightReceived),frameRate:Number(u.googFrameRateOutput)},h.jitterBufferMs=Number(u.googJitterBufferMs),h.firsCount=Number(u.googFirsSent),h.nacksCount=Number(u.googNacksSent),h.plisCount=Number(u.googPlisSent),h.framesDecodeCount=Number(u.framesDecoded),h.bytes=Number(u.bytesReceived),h.packets=Number(u.packetsReceived),h.packetsLost=Number(u.packetsLost),h.ssrc=Number(u.ssrc),0<h.packets&&!c.isFirstVideoReceived&&(c.onFirstVideoReceived&&c.onFirstVideoReceived(),c.isFirstVideoReceived=!0),0<h.framesDecodeCount&&!c.isFirstVideoDecoded&&(c.onFirstVideoDecoded&&c.onFirstVideoDecoded(h.decodedFrame.width,h.decodedFrame.height),c.isFirstVideoDecoded=!0),f){u=f.stats;var A=Date.now()-f.lts;h.framesDecodeFreezeTime=u.framesDecodeFreezeTime,h.framesDecodeInterval=u.framesDecodeInterval,h.framesDecodeCount>u.framesDecodeCount&&c.isFirstVideoDecoded?(f.lts=Date.now(),h.framesDecodeInterval=A,h.framesDecodeInterval>=c.options.freezeRateLimit&&(c.videoIsReady?h.framesDecodeFreezeTime+=h.framesDecodeInterval:c.setVideoIsReady(!0))):h.framesDecodeCount<f.stats.framesDecodeCount&&(h.framesDecodeInterval=0)}c.lastDecodeVideoReceiverStats.set(h.ssrc,{stats:Of({},h),lts:Date.now()}),c._stats.videoRecv.push(h);break;case"audio_recv":h=Bi(LI),h.codec=u.googCodecName,h.outputLevel=Math.abs(Number(u.audioOutputLevel))/32767,h.decodingCNG=Number(u.googDecodingCNG),h.decodingCTN=Number(u.googDecodingCTN),h.decodingCTSG=Number(u.googDecodingCTSG),h.decodingNormal=Number(u.googDecodingNormal),h.decodingPLC=Number(u.googDecodingPLC),h.decodingPLCCNG=Number(u.googDecodingPLCCNG),h.expandRate=Number(u.googExpandRate),h.accelerateRate=Number(u.googAccelerateRate),h.preemptiveExpandRate=Number(u.googPreemptiveExpandRate),h.secondaryDecodedRate=Number(u.googSecondaryDecodedRate),h.speechExpandRate=Number(u.googSpeechExpandRate),h.preferredJitterBufferMs=Number(u.googPreferredJitterBufferMs),h.jitterBufferMs=Number(u.googJitterBufferMs),h.jitterMs=Number(u.googJitterReceived),h.bytes=Number(u.bytesReceived),h.packets=Number(u.packetsReceived),h.packetsLost=Number(u.packetsLost),h.ssrc=Number(u.ssrc),h.receivedFrames=Number(u.googDecodingCTN)||Number(u.packetsReceived),h.droppedFrames=Number(u.googDecodingPLC)+Number(u.googDecodingPLCCNG)||Number(u.packetsLost),0<h.receivedFrames&&!c.isFirstAudioReceived&&(c.onFirstAudioReceived&&c.onFirstAudioReceived(),c.isFirstAudioReceived=!0),0<h.decodingNormal&&!c.isFirstAudioDecoded&&(c.onFirstAudioDecoded&&c.onFirstAudioDecoded(),c.isFirstAudioDecoded=!0),c._stats.audioRecv.push(h);break;case"audio_send":h=Bi(MI),h.codec=u.googCodecName,h.inputLevel=Math.abs(Number(u.audioInputLevel))/32767,h.aecReturnLoss=Number(u.googEchoCancellationReturnLoss||0),h.aecReturnLossEnhancement=Number(u.googEchoCancellationReturnLossEnhancement||0),h.residualEchoLikelihood=Number(u.googResidualEchoLikelihood||0),h.residualEchoLikelihoodRecentMax=Number(u.googResidualEchoLikelihoodRecentMax||0),h.bytes=Number(u.bytesSent),h.packets=Number(u.packetsSent),h.packetsLost=Number(u.packetsLost),h.ssrc=Number(u.ssrc),h.rttMs=Number(u.googRtt||0),c._stats.rtt=h.rttMs,c._stats.audioSend.push(h)}})},n.prototype._getStats=function(){var s=this;return new Promise(function(c,u){s.pc.getStats(c,u)})},n.prototype.statsResponsesToObjects=function(s){var c=[];return s.result().forEach(function(u){var h={id:u.id,timestamp:u.timestamp.valueOf().toString(),type:u.type};u.names().forEach(function(f){h[f]=u.stat(f)}),c.push(h)}),c},n}(kf);(function(i){i.CERTIFICATE="certificate",i.CODEC="codec",i.CANDIDATE_PAIR="candidate-pair",i.LOCAL_CANDIDATE="local-candidate",i.REMOTE_CANDIDATE="remote-candidate",i.INBOUND="inbound-rtp",i.TRACK="track",i.OUTBOUND="outbound-rtp",i.PC="peer-connection",i.REMOTE_INBOUND="remote-inbound-rtp",i.REMOTE_OUTBOUND="remote-outbound-rtp",i.TRANSPORT="transport",i.CSRC="csrc",i.DATA_CHANNEL="data-channel",i.STREAM="stream",i.SENDER="sender",i.RECEIVER="receiver"})(ys||(ys={}));var PI=function(i){function n(){var s=i!==null&&i.apply(this,arguments)||this;return s._stats=_l,s.lastDecodeVideoReceiverStats=new Map,s.lastVideoFramesRecv=new Map,s.lastVideoFramesSent=new Map,s.lastVideoFramesDecode=new Map,s.lastVideoJBDelay=new Map,s.lastAudioJBDelay=new Map,s.mediaBytesSent=new Map,s.mediaBytesRetransmit=new Map,s.mediaBytesTargetEncode=new Map,s.lastEncoderMs=new Map,s}return Wh(n,i),n.prototype.updateStats=function(){return Yh(this,void 0,void 0,function(){var s,c=this;return qh(this,function(u){switch(u.label){case 0:return s=this,[4,this.pc.getStats()];case 1:return s.report=u.sent(),this._stats=Bi(_l),this.report.forEach(function(h){switch(h.type){case ys.OUTBOUND:h.mediaType==="audio"?c.processAudioOutboundStats(h):h.mediaType==="video"&&c.processVideoOutboundStats(h);break;case ys.INBOUND:h.mediaType==="audio"?c.processAudioInboundStats(h):h.mediaType==="video"&&c.processVideoInboundStats(h);break;case ys.TRANSPORT:(h=c.report.get(h.selectedCandidatePairId))&&c.processCandidatePairStats(h);break;case ys.CANDIDATE_PAIR:h.selected&&c.processCandidatePairStats(h)}}),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats,[2]}})})},n.prototype.processCandidatePairStats=function(s){this._stats.sendBandwidth=s.availableOutgoingBitrate||0,s.currentRoundTripTime&&(this._stats.rtt=1e3*s.currentRoundTripTime),this._stats.videoSend.forEach(function(c){!c.rttMs&&s.currentRoundTripTime&&(c.rttMs=1e3*s.currentRoundTripTime)}),this._stats.audioSend.forEach(function(c){!c.rttMs&&s.currentRoundTripTime&&(c.rttMs=1e3*s.currentRoundTripTime)})},n.prototype.processAudioInboundStats=function(s){var c=this._stats.audioRecv.find(function(u){return u.ssrc===s.ssrc});c||(c=Bi(LI),this._stats.audioRecv.push(c)),c.ssrc=s.ssrc,c.packets=s.packetsReceived,c.packetsLost=s.packetsLost,c.bytes=s.bytesReceived,c.jitterMs=1e3*s.jitter,s.trackId&&this.processAudioTrackReceiverStats(s.trackId,c),s.codecId&&(c.codec=this.getCodecFromCodecStats(s.codecId)),c.receivedFrames||(c.receivedFrames=s.packetsReceived),c.droppedFrames||(c.droppedFrames=s.packetsLost),0<c.receivedFrames&&!this.isFirstAudioReceived&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(),this.isFirstAudioReceived=!0),c.outputLevel&&0<c.outputLevel&&!this.isFirstAudioDecoded&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(),this.isFirstAudioDecoded=!0)},n.prototype.processVideoInboundStats=function(s){var c=this._stats.videoRecv.find(function(I){return I.ssrc===s.ssrc});c||(c=Bi(DI),this._stats.videoRecv.push(c)),c.ssrc=s.ssrc,c.packets=s.packetsReceived,c.packetsLost=s.packetsLost,c.bytes=s.bytesReceived,c.firsCount=s.firCount,c.nacksCount=s.nackCount,c.plisCount=s.pliCount,c.framesDecodeCount=s.framesDecoded;var u=this.lastDecodeVideoReceiverStats.get(c.ssrc),h=this.lastVideoFramesDecode.get(c.ssrc),f=Date.now();if(0<c.framesDecodeCount&&!this.isFirstVideoDecoded){var A=c.decodedFrame?c.decodedFrame.width:0,m=c.decodedFrame?c.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(A,m),this.isFirstVideoDecoded=!0}u&&(A=u.stats,m=f-u.lts,c.framesDecodeFreezeTime=A.framesDecodeFreezeTime,c.framesDecodeInterval=A.framesDecodeInterval,c.framesDecodeCount>A.framesDecodeCount&&this.isFirstVideoDecoded?(u.lts=Date.now(),c.framesDecodeInterval=m,c.framesDecodeInterval>=this.options.freezeRateLimit&&(this.videoIsReady?c.framesDecodeFreezeTime+=c.framesDecodeInterval:this.setVideoIsReady(!0))):c.framesDecodeCount<A.framesDecodeCount&&(c.framesDecodeInterval=0)),h&&800<=f-h.lts?(c.decodeFrameRate=Math.round((c.framesDecodeCount-h.count)/((f-h.lts)/1e3)),this.lastVideoFramesDecode.set(c.ssrc,{count:c.framesDecodeCount,lts:f,rate:c.decodeFrameRate})):h?c.decodeFrameRate=h.rate:this.lastVideoFramesDecode.set(c.ssrc,{count:c.framesDecodeCount,lts:f,rate:0}),s.totalDecodeTime&&(c.decodeMs=1e3*s.totalDecodeTime),s.trackId&&this.processVideoTrackReceiverStats(s.trackId,c),s.codecId&&(c.codec=this.getCodecFromCodecStats(s.codecId)),s.framerateMean&&(c.framesRateFirefox=s.framerateMean),0<c.packets&&!this.isFirstVideoReceived&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(),this.isFirstVideoReceived=!0),this.lastDecodeVideoReceiverStats.set(c.ssrc,{stats:Of({},c),lts:u?u.lts:Date.now()})},n.prototype.processVideoOutboundStats=function(s){var c=this._stats.videoSend.find(function(f){return f.ssrc===s.ssrc});c||(c=Bi(BI),this._stats.videoSend.push(c));var u=this.mediaBytesSent.get(s.ssrc);if(u?u.add(s.bytesSent):((h=new Nf(10)).add(s.bytesSent),this.mediaBytesSent.set(s.ssrc,h)),s.retransmittedBytesSent!==void 0&&((u=this.mediaBytesRetransmit.get(s.ssrc))?u.add(s.retransmittedBytesSent):((h=new Nf(10)).add(s.retransmittedBytesSent),this.mediaBytesRetransmit.set(s.ssrc,h))),s.totalEncodedBytesTarget){var h;(u=this.mediaBytesTargetEncode.get(s.ssrc))?u.add(s.totalEncodedBytesTarget):((h=new Nf(10)).add(s.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(s.ssrc,h))}c.ssrc=s.ssrc,c.bytes=s.bytesSent,c.packets=s.packetsSent,c.firsCount=s.firCount,c.nacksCount=s.nackCount,c.plisCount=s.pliCount,c.frameCount=s.framesEncoded,c.adaptionChangeReason=s.qualityLimitationReason,s.totalEncodeTime&&s.framesEncoded&&(u=this.lastEncoderMs.get(s.ssrc),c.avgEncodeMs=!u||u.lastFrameCount>s.framesEncoded?1e3*s.totalEncodeTime/s.framesEncoded:1e3*(s.totalEncodeTime-u.lastEncoderTime)/(s.framesEncoded-u.lastFrameCount),this.lastEncoderMs.set(s.ssrc,{lastFrameCount:s.framesEncoded,lastEncoderTime:s.totalEncodeTime,lts:Date.now()})),s.codecId&&(c.codec=this.getCodecFromCodecStats(s.codecId)),s.mediaSourceId&&this.processVideoMediaSource(s.mediaSourceId,c),s.trackId&&this.processVideoTrackSenderStats(s.trackId,c),s.remoteId?this.processRemoteInboundStats(s.remoteId,c):(u=this.findRemoteStatsId(s.ssrc,ys.REMOTE_INBOUND))&&this.processRemoteInboundStats(u,c)},n.prototype.processAudioOutboundStats=function(s){var c=this._stats.audioSend.find(function(h){return h.ssrc===s.ssrc});if(c||(c=Bi(MI),this._stats.audioSend.push(c)),c.ssrc=s.ssrc,c.packets=s.packetsSent,c.bytes=s.bytesSent,s.mediaSourceId&&this.processAudioMediaSource(s.mediaSourceId,c),s.codecId&&(c.codec=this.getCodecFromCodecStats(s.codecId)),s.trackId&&this.processAudioTrackSenderStats(s.trackId,c),s.remoteId)this.processRemoteInboundStats(s.remoteId,c);else{var u=this.findRemoteStatsId(s.ssrc,ys.REMOTE_INBOUND);u&&this.processRemoteInboundStats(u,c)}},n.prototype.findRemoteStatsId=function(s,c){var u=Array.from(this.report.values()).find(function(h){return h.type===c&&h.ssrc===s});return u?u.id:null},n.prototype.processVideoMediaSource=function(s,c){(s=this.report.get(s))&&s.width&&s.height&&s.framesPerSecond&&(c.inputFrame={width:s.width,height:s.height,frameRate:s.framesPerSecond})},n.prototype.processAudioMediaSource=function(s,c){(s=this.report.get(s))&&(c.inputLevel=s.audioLevel)},n.prototype.processVideoTrackSenderStats=function(s,c){if(s=this.report.get(s)){var u=0,h=Date.now(),f=this.lastVideoFramesSent.get(c.ssrc);f&&800<=h-f.lts?(u=Math.round((s.framesSent-f.count)/((h-f.lts)/1e3)),this.lastVideoFramesSent.set(c.ssrc,{count:s.framesSent,lts:h,rate:u})):f?u=f.rate:this.lastVideoFramesSent.set(c.ssrc,{count:s.framesSent,lts:h,rate:0}),c.sentFrame={width:s.frameWidth,height:s.frameHeight,frameRate:u}}},n.prototype.processVideoTrackReceiverStats=function(s,c){if(s=this.report.get(s)){var u=this.lastVideoFramesRecv.get(c.ssrc),h=Date.now();c.framesReceivedCount=s.framesReceived;var f=0;u&&800<=h-u.lts?(f=Math.round((s.framesReceived-u.count)/((h-u.lts)/1e3)),this.lastVideoFramesRecv.set(c.ssrc,{count:s.framesReceived,lts:h,rate:f})):u?f=u.rate:this.lastVideoFramesRecv.set(c.ssrc,{count:s.framesReceived,lts:h,rate:0}),c.receivedFrame={width:s.frameWidth||0,height:s.frameHeight||0,frameRate:f||0},c.decodedFrame={width:s.frameWidth||0,height:s.frameHeight||0,frameRate:c.decodeFrameRate||0},c.outputFrame={width:s.frameWidth||0,height:s.frameHeight||0,frameRate:c.decodeFrameRate||0},s.jitterBufferDelay&&s.jitterBufferEmittedCount&&(u=this.lastVideoJBDelay.get(c.ssrc),this.lastVideoJBDelay.set(c.ssrc,{jitterBufferDelay:s.jitterBufferDelay,jitterBufferEmittedCount:s.jitterBufferEmittedCount}),u||(u={jitterBufferDelay:0,jitterBufferEmittedCount:0}),s=1e3*(s.jitterBufferDelay-u.jitterBufferDelay)/(s.jitterBufferEmittedCount-u.jitterBufferEmittedCount),c.jitterBufferMs=s,c.currentDelayMs=Math.round(s))}},n.prototype.processAudioTrackSenderStats=function(s,c){(s=this.report.get(s))&&(c.aecReturnLoss=s.echoReturnLoss||0,c.aecReturnLossEnhancement=s.echoReturnLossEnhancement||0)},n.prototype.processAudioTrackReceiverStats=function(s,c){if(s=this.report.get(s)){if(s.removedSamplesForAcceleration&&s.totalSamplesReceived&&(c.accelerateRate=s.removedSamplesForAcceleration/s.totalSamplesReceived),s.jitterBufferDelay&&s.jitterBufferEmittedCount){var u=this.lastAudioJBDelay.get(c.ssrc);this.lastAudioJBDelay.set(c.ssrc,{jitterBufferDelay:s.jitterBufferDelay,jitterBufferEmittedCount:s.jitterBufferEmittedCount}),u||(u={jitterBufferDelay:0,jitterBufferEmittedCount:0}),c.jitterBufferMs=Math.round(1e3*(s.jitterBufferDelay-u.jitterBufferDelay)/(s.jitterBufferEmittedCount-u.jitterBufferEmittedCount))}c.outputLevel=s.audioLevel,u=1920,s.totalSamplesDuration&&s.totalSamplesReceived&&(u=s.totalSamplesReceived/s.totalSamplesDuration/50,c.receivedFrames=Math.round(s.totalSamplesReceived/u)),s.concealedSamples&&(c.droppedFrames=Math.round(s.concealedSamples/u))}},n.prototype.processRemoteInboundStats=function(s,c){(s=this.report.get(s))&&(c.packetsLost=s.packetsLost,s.roundTripTime&&(c.rttMs=1e3*s.roundTripTime))},n.prototype.getCodecFromCodecStats=function(s){return s=this.report.get(s),s&&(s=s.mimeType.match(/\/(.*)$/))&&s[1]?s[1]:""},n.prototype.updateSendBitrate=function(){var s=0,c=null,u=null;this.mediaBytesSent.forEach(function(h){s+=h.diffMean()}),this.mediaBytesRetransmit.forEach(function(h){c=c===null?h.diffMean():c+h.diffMean()}),this.mediaBytesTargetEncode.forEach(function(h){u=u===null?h.diffMean():u+h.diffMean()}),this._stats.bitrate={actualEncoded:8*(c!==null?s-c:s)/(this.options.updateInterval/1e3),transmit:8*s/(this.options.updateInterval/1e3)},c!==null&&(this._stats.bitrate.retransmit=8*c/(this.options.updateInterval/1e3)),u!==null&&(this._stats.bitrate.targetEncoded=8*u/(this.options.updateInterval/1e3))},n}(kf),hN=function(i){function n(){return i!==null&&i.apply(this,arguments)||this}return Wh(n,i),n.prototype.updateStats=function(){return Promise.resolve()},n}(kf);class xI{constructor(n){this.localCandidateCount=0,this.allCandidateReceived=!1,this.videoTrack=this.audioTrack=null,this.mediaStream=new MediaStream,this.ID=FI,FI+=1,this.spec=n,this.createPeerConnection(),n=this.pc;var s=void 0,c=void 0,u=Or()?1200:void 0;s===void 0&&(s=250),c===void 0&&(c=8),u===void 0&&(u=500);var h,f=(h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i))&&h[0]?Number(h[0].split("/")[1]):null;this.statsFilter=f?76>f?new dN(n,{updateInterval:s,lossRateInterval:c,freezeRateLimit:u}):new PI(n,{updateInterval:s,lossRateInterval:c,freezeRateLimit:u}):window.RTCStatsReport&&n.getStats()instanceof Promise?new PI(n,{updateInterval:s,lossRateInterval:c,freezeRateLimit:u}):new hN(n,{updateInterval:s,lossRateInterval:c,freezeRateLimit:u})}get _statsFilter(){return this.statsFilter}getStats(){return this.statsFilter.getStats()}async createOfferSDP(){try{let n=await this.pc.createOffer(this.offerOptions);if(!n.sdp)throw Error("offer sdp is empty");return n.sdp}catch(n){throw R.error("create offer error:",n.toString()),new L(D.CREATE_OFFER_FAILED,n.toString())}}async setOfferSDP(n){try{await this.pc.setLocalDescription({type:"offer",sdp:n})}catch(s){throw R.error("set local offer error",s.toString()),new L(D.CREATE_OFFER_FAILED,s.toString())}}async setAnswerSDP(n){try{await this.pc.setRemoteDescription({type:"answer",sdp:n})}catch(s){if(s.name!=="InvalidStateError"||this.pc.signalingState!=="stable")throw R.error("set remote answer error",s.toString()),new L(D.SET_ANSWER_FAILED,s.toString());R.debug("[pc-".concat(this.ID,"] ignore invalidstate error"))}}close(){this.onConnectionStateChange=this.onICEConnectionStateChange=void 0;try{this.pc.oniceconnectionstatechange=null,this.pc.onconnectionstatechange=null,this.pc.onsignalingstatechange=null,this.pc.onicecandidateerror=null,this.pc.onicecandidate=null,this.pc.close(),this.pc=null,this.videoTransceiver=this.audioTransceiver=void 0}catch{}this.statsFilter.destroy()}createPeerConnection(){let n={iceServers:[]},s=h=>{const f=[];return K(h).call(h,A=>{if(A.security){var m;A.tcpport&&f.push({username:A.username,credential:A.password,credentialType:"password",urls:b(m="turns:".concat((_=A.turnServerURL,_.match(/^[\.:\d]+$/)?"".concat(_.replace(/[^\d]/g,"-"),".edge.agora.io"):(R.info("Cannot recognized as IP address ".concat(_,". Used As Host instead")),_)),":")).call(m,A.tcpport,"?transport=tcp")})}else{var I,E;A.udpport&&f.push({username:A.username,credential:A.password,credentialType:"password",urls:b(I="turn:".concat(A.turnServerURL,":")).call(I,A.udpport,"?transport=udp")}),A.tcpport&&f.push({username:A.username,credential:A.password,credentialType:"password",urls:b(E="turn:".concat(A.turnServerURL,":")).call(E,A.tcpport,"?transport=tcp")})}var _}),f};var c,u;this.spec.iceServers?n.iceServers=this.spec.iceServers:this.spec.turnServer&&this.spec.turnServer.mode!=="off"&&(am(this.spec.turnServer.servers)?n.iceServers=this.spec.turnServer.servers:(n.iceServers&&n.iceServers.push(...s(this.spec.turnServer.servers)),n.iceServers&&this.spec.turnServer.serversFromGateway&&n.iceServers.push(...s(this.spec.turnServer.serversFromGateway)),K(c=b(u=this.spec.turnServer.servers).call(u,this.spec.turnServer.serversFromGateway||[])).call(c,h=>{h.forceturn&&(n.iceTransportPolicy="relay")}))),te.CHROME_FORCE_PLAN_B&&Gc()&&(n.sdpSemantics="plan-b",Pt.supportUnifiedPlan=!1),this.pc=new RTCPeerConnection(n,{optional:[{googDscp:!0}]}),this.pc.oniceconnectionstatechange=()=>{this.onICEConnectionStateChange&&this.onICEConnectionStateChange(this.pc.iceConnectionState)},this.pc.onconnectionstatechange=()=>{this.onConnectionStateChange&&this.onConnectionStateChange(this.pc.connectionState)},this.pc.onsignalingstatechange=()=>{this.pc&&this.pc.connectionState==="closed"&&this.onConnectionStateChange&&this.onConnectionStateChange(this.pc.connectionState)},this.pc.onicecandidate=h=>{if(!h.candidate)return this.pc.onicecandidate=null,this.allCandidateReceived=!0,void R.debug("[pc-".concat(this.ID,"] local candidate count"),this.localCandidateCount);this.localCandidateCount+=1},gi(()=>{this.allCandidateReceived||(this.allCandidateReceived=!0,R.debug("[pc-".concat(this.ID,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},te.CANDIDATE_TIMEOUT)}}class QI extends xI{constructor(n){super(n)}async setOfferSDP(n){let s=te.CUSTOM_PUB_OFFER_MODIFIER;return s&&(n=s(n)),await super.setOfferSDP(n)}async setAnswerSDP(n){let s=te.CUSTOM_PUB_ANSWER_MODIFIER;return s&&(n=s(n)),await super.setAnswerSDP(n)}getAnswerSDP(){return this.pc.remoteDescription}getOfferSDP(){return this.pc.localDescription}async addStream(n){n=n.getTracks();for(let s of n)await this.addTrack(s)}async replaceTrack(n){if(!Pt.supportReplaceTrack){var s=n.kind==="audio"?this.audioTrack:this.videoTrack;if(!s)throw new L(D.UNEXPECTED_ERROR,"can not find replaced track");return await this.removeTrack(s),await this.addTrack(n),!0}let c=this.getSender(n.kind),u=Xe(s=this.mediaStream.getTracks()).call(s,h=>h.kind===n.kind);u&&this.mediaStream.removeTrack(u),this.mediaStream.addTrack(n);try{await c.replaceTrack(n),n.kind==="audio"?this.audioTrack=n:this.videoTrack=n}catch(h){throw new L(D.SENDER_REPLACE_FAILED,h.toString())}return!1}async removeTrack(n){let s=this.getSender(n.kind);this.mediaStream.removeTrack(n);try{let c=Je();c.name==="Safari"&&c.version==="11"&&await s.replaceTrack(null),this.pc.removeTrack(s)}catch(c){R.warning("[pc-".concat(this.ID,"] remove track error, ignore"),c)}n.kind==="audio"?(this.audioTrack=null,this.audioSender=void 0,this.audioTransceiver&&(this.audioTransceiver.direction="inactive"),this.audioTransceiver=void 0):(this.videoTrack=null,this.videoSender=void 0,this.videoTransceiver&&(this.videoTransceiver.direction="inactive"),this.videoTransceiver=void 0)}onOfferSettled({videoActive:n,audioActive:s}){if(Or())R.debug("firefox do not set sender parameter");else{if(this.audioSender){let c={networkQuality:void 0,active:!0};te.DSCP_TYPE&&(c.networkQuality=te.DSCP_TYPE),this.audioTrack&&(c.active=!!s),this.setAudioRtpEncodingParameters(c).catch(u=>{R.debug("set audio sender`s network priority failed")})}this.videoSender&&(s={networkQuality:void 0,active:!0},te.DSCP_TYPE&&(s.networkQuality=te.DSCP_TYPE),this.videoTrack&&(s.active=!!n),this.setVideoRtpEncodingParameters(s).catch(c=>{R.debug("set video sender`s network priority failed")}))}}async addTrack(n){let s=Pt;if(n.kind==="audio"&&this.audioTrack||n.kind==="video"&&this.videoTrack)throw new L(D.UNEXPECTED_ERROR,"Can't add multiple stream");let c,u;this.mediaStream.addTrack(n),s.supportUnifiedPlan?(c=await async function(h,f,A){var m;let I=Xe(m=h.getTransceivers()).call(m,E=>E.direction==="inactive"&&E.receiver.track.kind===f.kind);return I?(I.direction="sendrecv",await I.sender.replaceTrack(f),I):h.addTransceiver(f,{direction:"sendrecv",streams:[A]})}(this.pc,n,this.mediaStream),u=c.sender):u=this.pc.addTrack(n,this.mediaStream),n.kind==="audio"?(this.audioTrack=n,this.audioSender=u,this.audioTransceiver=c):(this.videoTrack=n,this.videoSender=u,this.videoTransceiver=c)}async setRtpSenderParameters(n,s){if(n=this.videoSender||(this.videoTransceiver?this.videoTransceiver.sender:void 0)){var c=n.getParameters();c.degradationPreference=s;try{await n.setParameters(c)}catch(u){R.debug("[".concat(this.ID,"] ignore RtpSender.setParameters"),u.toString())}}}async setVideoRtpEncodingParameters(n){let s=this.videoSender||(this.videoTransceiver?this.videoTransceiver.sender:void 0);if(!s)throw new L(D.LOW_STREAM_ENCODING_ERROR,"Low stream has no video sender.");let c=s.getParameters();if(!c.encodings||!c.encodings[0])throw new L(D.LOW_STREAM_ENCODING_ERROR,"Low stream RtpEncodingParameters is empty.");n.scaleResolutionDownBy&&(c.encodings[0].scaleResolutionDownBy=n.scaleResolutionDownBy),n.maxBitrate&&(c.encodings[0].maxBitrate=n.maxBitrate),n.maxFramerate&&(c.encodings[0].maxFramerate=n.maxFramerate),n.active!==void 0&&(R.debug("set video sender encoding active:",n.active),c.encodings[0].active=n.active);let u=["very-low","low","medium","high"];return n.networkPriority&&vt(u).call(u,n.networkPriority)&&(R.debug("set video sender network quality:",n.networkPriority),c.encodings[0].networkPriority=n.networkPriority),await s.setParameters(c),s.getParameters()}async setAudioRtpEncodingParameters(n){let s=this.audioSender||(this.audioTransceiver?this.audioTransceiver.sender:void 0);if(!s)throw new L(D.SET_ENCODING_PARAMETER_ERROR,"pc has no audio sender.");let c=s.getParameters();if(!c.encodings||!c.encodings[0])throw new L(D.SET_ENCODING_PARAMETER_ERROR,"pc RtpEncodingParameters is empty.");n.active!==void 0&&(R.debug("set audio sender encoding active:",n.active),c.encodings[0].active=n.active);let u=["very-low","low","medium","high"];return n.networkPriority&&vt(u).call(u,n.networkPriority)&&(R.debug("set audio sender network quality:",n.networkPriority),c.encodings[0].networkPriority=n.networkPriority),await s.setParameters(c),s.getParameters()}getSender(n){var s=null;if(Pt.supportUnifiedPlan){var c;s=(s=Xe(c=this.pc.getTransceivers()).call(c,h=>h.sender.track&&h.sender.track.kind===n))?s.sender:null}else{var u;s=Xe(u=this.pc.getSenders()).call(u,h=>h.track&&h.track.kind===n)||null}if(!s)throw new L(D.SENDER_NOT_FOUND);return s}close(){this.videoSender=this.audioSender=void 0,super.close()}}class UI extends xI{constructor(n){super(n);this.statsFilter.onFirstAudioDecoded=()=>this.onFirstAudioDecoded&&this.onFirstAudioDecoded(),this.statsFilter.onFirstVideoDecoded=(s,c)=>this.onFirstVideoDecoded&&this.onFirstVideoDecoded(s,c),this.statsFilter.onFirstAudioReceived=()=>this.onFirstAudioReceived&&this.onFirstAudioReceived(),this.statsFilter.onFirstVideoReceived=()=>this.onFirstVideoReceived&&this.onFirstVideoReceived(),Pt.supportUnifiedPlan?(this.audioTransceiver=this.pc.addTransceiver("audio",{direction:"recvonly"}),this.videoTransceiver=this.pc.addTransceiver("video",{direction:"recvonly"})):this.offerOptions={offerToReceiveAudio:!0,offerToReceiveVideo:!0},this.pc.ontrack=s=>{s.track.kind==="audio"?this.audioTrack=s.track:this.videoTrack=s.track,this.onTrack&&this.onTrack(s.track,s.streams[0])}}async setOfferSDP(n){let s=te.CUSTOM_SUB_OFFER_MODIFIER;return s&&(n=s(n)),await super.setOfferSDP(n)}async setAnswerSDP(n){let s=te.CUSTOM_SUB_ANSWER_MODIFIER;return s&&(n=s(n)),await super.setAnswerSDP(n)}}let FI=1,VI=1;class GI extends Zr{constructor(n,s){super();this.startTime=le(),this.createTime=le(),this.readyToReconnect=!1,this._connectionState="disconnected",this.currentReconnectCount=0,this.ID=VI,VI+=1,this.joinInfo=n,this._userId=s,this.createPC()}get connectionState(){return this._connectionState}set connectionState(n){n!==this._connectionState&&(this.emit(ke.CONNECTION_STATE_CHANGE,n,this._connectionState),this._connectionState=n)}get connectionId(){var n,s;return b(n=b(s="".concat(this.joinInfo.clientId,"-")).call(s,this.type?this.type:"sub(".concat(this._userId,")"),"-")).call(n,this.ID)}getUserId(){return this._userId}startUploadStats(){this.statsUploadInterval=window.setInterval(()=>{let n=this.pc.getStats();this.uploadStats(n,this.lastUploadPCStats),this.lastUploadPCStats=n},3e3),this.statsUploadSlowInterval=window.setInterval(()=>{let n=this.pc.getStats();this.uploadSlowStats(n)},6e4),this.relatedStatsUploadInterval=window.setInterval(()=>{let n=this.pc.getStats();this.uploadRelatedStats(n,this.lastRelatedPcStats),this.lastRelatedPcStats=n},1e3)}stopUploadStats(){this.statsUploadInterval&&window.clearInterval(this.statsUploadInterval),this.relatedStatsUploadInterval&&window.clearInterval(this.relatedStatsUploadInterval),this.relatedStatsUploadInterval=this.statsUploadInterval=void 0}createWaitConnectionConnectedPromise(){return new se((n,s)=>{this.connectionState==="disconnected"?s():this.connectionState==="connected"?n():this.once(ke.CONNECTION_STATE_CHANGE,c=>{c==="connected"?n():s()})})}async reconnectPC(n){if(this.readyToReconnect=!1,n&&this.onPCDisconnected(n),1/0<this.currentReconnectCount)throw R.debug("[".concat(this.connectionId,"] cannot reconnect pc")),n||new L(D.UNEXPECTED_ERROR);if(this.stopUploadStats(),R.debug("[".concat(this.connectionId,"] start reconnect pc")),this.connectionState="connecting",this.currentReconnectCount+=1,await this.closePC())return R.debug("[".concat(this.connectionId,"] abort reconnect pc, wait ws")),void this.readyToReconnectPC();this.createPC(),await this.startP2PConnection(),this.currentReconnectCount=0}readyToReconnectPC(){this.stopUploadStats(),this.readyToReconnect=!0,this.pc.onICEConnectionStateChange=void 0,this.connectionState="connecting"}updateICEPromise(){this.removeAllListeners(ke.GATEWAY_P2P_LOST),this.icePromise=new se((n,s)=>{let c=!0;this.pc.onICEConnectionStateChange=u=>{var h,f;R.info(b(h=b(f="[".concat(this.connectionId,"] ice-state: ")).call(f,this.type," p2p ")).call(h,u)),u==="connected"&&n(),u!=="failed"&&u!=="closed"||(c&&this.emit(ke.P2P_LOST),c=!1,this.reconnectPC(new L(D.ICE_FAILED)).catch(A=>{s(A)}))},this.pc.onConnectionStateChange=u=>{var h,f;R.info(b(h=b(f="[".concat(this.connectionId,"] connection-state: ")).call(f,this.type," p2p ")).call(h,u)),u!=="failed"&&u!=="closed"||(c&&this.emit(ke.P2P_LOST),c=!1,this.reconnectPC(new L(D.PC_CLOSED)).catch(A=>{s(A)}))},this.removeAllListeners(ke.GATEWAY_P2P_LOST),this.once(ke.GATEWAY_P2P_LOST,u=>{var h;if(this.pc.ID.toString()===u.toString()){if(R.info(b(h="[".concat(this.connectionId,"] ")).call(h,this.type," p2p gateway lost")),c&&this.emit(ke.P2P_LOST),c=!1,this.pc.allCandidateReceived&&this.pc.localCandidateCount===0)return this.disconnectedReason=new L(D.NO_ICE_CANDIDATE,"can not get candidate in this pc"),void this.closeP2PConnection(!0);this.reconnectPC(new L(D.GATEWAY_P2P_LOST)).catch(f=>{s(f)})}})})}}class jI{constructor(n){this.freezeTimeCounterList=[],this.lastTimeUpdatedTime=this.playbackTime=this.freezeTime=this.timeUpdatedCount=0,this._videoElementStatus=Hr.NONE,this.isGettingVideoDimensions=!1,this.handleVideoEvents=s=>{switch(s.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=Hr.PLAYING;break;case"loadeddata":this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded();break;case"canplay":this.videoElementStatus=Hr.CANPLAY;break;case"stalled":this.videoElementStatus=Hr.STALLED;break;case"suspend":this.videoElementStatus=Hr.SUSPEND;break;case"pause":this.videoElementStatus=Hr.PAUSED,!xn()&&!Eo()&&this.videoElement&&this.videoTrack&&this.videoTrack.readyState==="live"&&(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Hr.WAITING;break;case"abort":this.videoElementStatus=Hr.ABORT;break;case"ended":this.videoElementStatus=Hr.ENDED;break;case"emptied":this.videoElementStatus=Hr.EMPTIED;break;case"timeupdate":{if(s=le(),this.timeUpdatedCount+=1,10>this.timeUpdatedCount)return void(this.lastTimeUpdatedTime=s);let c=s-this.lastTimeUpdatedTime;for(this.lastTimeUpdatedTime=s,500<c&&(this.freezeTime+=c),this.playbackTime+=c;6e3<=this.playbackTime;)this.playbackTime-=6e3,this.freezeTimeCounterList.push(Math.min(6e3,this.freezeTime)),this.freezeTime=Math.max(0,this.freezeTime-6e3)}}},this.startGetVideoDimensions=()=>{let s=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement&&4<this.videoElement.videoWidth*this.videoElement.videoHeight)return R.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);gi(s,500)};!this.isGettingVideoDimensions&&s()},this.autoResumeAfterInterruption=()=>{this.videoElement&&this.videoTrack&&this.videoTrack.readyState==="live"&&At.curState==="running"&&(bi()?(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15")),this.videoElement.pause(),this.videoElement.play()):(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play()))},this.autoResumeAfterInterruptionOnIOS15=()=>{this.videoElement&&this.videoTrack&&this.videoTrack.readyState==="live"&&(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume on iOS 15")),this.videoElement.pause(),this.videoElement.play())},this.slot=n.element,this.trackId=n.trackId,this.updateConfig(n),At.on(en.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),At.on(en.IOS_15_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15)}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(n){var s,c;n!==this._videoElementStatus&&(R.debug(b(s=b(c="[".concat(this.trackId,"] video-element-status change ")).call(c,this._videoElementStatus," => ")).call(s,n)),this._videoElementStatus=n)}updateConfig(n){this.config=n,this.trackId=n.trackId,n=n.element,n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()}updateVideoTrack(n){this.videoTrack!==n&&(this.videoTrack=n,this.createElements())}play(){if(this.videoElement){let n=this.videoElement.play();n&&n.catch&&n.catch(c=>{c.name==="NotAllowedError"?(R.warning("detected video element autoplay failed",c),this.handleAutoPlayFailed()):R.warning("[".concat(this.trackId,"] play warning: "),c)});let s=Je();(s.name==="Safari"&&Number(s.version)===15||bi())&&n&&n.finally&&n.finally(()=>{this.config.mirror&&this.videoElement&&(this.videoElement.style.transform="rotateY(180deg)")})}}getCurrentFrame(){if(!this.videoElement)return new ImageData(2,2);let n=document.createElement("canvas");n.width=this.videoElement.videoWidth,n.height=this.videoElement.videoHeight;var s=n.getContext("2d");return s?(s.drawImage(this.videoElement,0,0,n.width,n.height),s=s.getImageData(0,0,n.width,n.height),n.remove(),s):(R.error("create canvas context failed!"),new ImageData(2,2))}destroy(){if(At.off(en.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),At.off(en.IOS_15_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15),this.videoElement&&(this.videoElement.srcObject=null,this.videoElement.remove(),this.videoElement=void 0),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}this.freezeTimeCounterList=[]}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",this.createVideoElement(),this.container.appendChild(this.videoElement)):this.removeVideoElement(),this.slot.appendChild(this.container)}createVideoElement(){this.videoElement||(this.videoElementStatus=Hr.INIT,this.videoElement=document.createElement("video"),this.videoElement.onerror=()=>this.videoElementStatus=Hr.ERROR,this.container&&this.container.appendChild(this.videoElement),K(Cd).call(Cd,s=>{this.videoElement&&this.videoElement.addEventListener(s,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{!document.getElementById("video_".concat(this.trackId))&&this.videoElement&&(this.videoElementStatus=Hr.DESTROYED)},1e3)),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),this.videoElement.style.left="0",this.videoElement.style.top="0";var n=Je();n.name==="Safari"&&Number(n.version)===15||bi()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Or()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Or()&&this.videoElement.load()),n=this.videoElement.play(),n!==void 0&&n.catch(s=>{R.debug("[".concat(this.trackId,"] playback interrupted"),s.toString())})}removeVideoElement(){if(this.videoElement){K(Cd).call(Cd,n=>{this.videoElement&&this.videoElement.removeEventListener(n,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0);try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=void 0,this.videoElementStatus=Hr.NONE}}handleAutoPlayFailed(){if(this.videoElement){let n=s=>{s.preventDefault(),this.videoElement&&(this.videoElement.play().then(()=>{var c;R.debug(b(c="[".concat(this.trackId,"] Video element for trackId:")).call(c,this.trackId," autoplay resumed."))}).catch(c=>{R.error(c)}),document.body.removeEventListener("touchstart",n,!0),document.body.removeEventListener("mousedown",n,!0))};document.body.addEventListener("touchstart",n,!0),document.body.addEventListener("mousedown",n,!0),mm()}}}let Cd="play playing loadeddata canplay pause stalled suspend waiting abort emptied ended timeupdate".split(" ");var HI;!document.documentMode&&window.StyleMedia&&(HTMLCanvasElement.prototype.getContext=(HI=HTMLCanvasElement.prototype.getContext,function(){let i=arguments;return i[0]==="webgl"&&(i=Gr([]).call(arguments),i[0]="experimental-webgl"),HI.apply(null,i)}));let pN=[31,222,239,159,192,236,164,81,54,227,176,149,2,247,75,141,183,54,213,216,158,92,111,49,228,111,150,6,135,79,35,212,4,155,200,168,37,107,243,110,144,179,51,81,55,78,223,242,191,211,74,119,203,151,142,62,31,41,132,22,35,155,87,123,119,117,216,57,201,53,228,67,201,40,106,24,80,176,187,253,60,63,136,100,20,12,177,99,64,38,101,143,111,176,251,211,145,136,34,23,79,136,202,95,105,199,125,67,180,44,210,179,228,4,85,160,188,64,26,46,6,61,201,103,248,18,97,254,140,36,115,106,48,124,102,216,155,120,36,227,165,217,7,227,191,128,212,157,80,37,117,175,24,214,47,221,183,211,51,174,251,223,159,167,152,53,36,107,199,223,91,62,46,194,11,80,121,188,219,2,99,99,232,229,173,234,21,30,236,177,243,142,97,48,108,56,62,172,56,216,3,42,79,138,23,88,182,39,5,118,68,135,178,56,9,94,189,44,104,9,238,231,174,122,85,247,231,86,74,8,189,147,218,180,58,76,227,17,46,90,194,100,51,178,72,163,151,243,166,130,85,1,223,130,152,242,85,255,28,173,97,252,119,215,177,119,86,104,136,82,40,72,53,11,18,26,240,188,76,110,39,31,189],fN=[11,196,242,139,198,252,188,5,59,170,161,152,17,229,24,141,133,54,214,206,133,26,66,126,255,11,245,10,146,92,52,134,108,152,221,191,124,116,248,106,130,251,59,105,43,91,135,199,181,223,10,51,134,194,240,46,9,3,141,22,35,146,76,23,109,117,208,41,201,45,218,76,203,105,51,58,97,154,145,236,49,18,183,127,27,12,210,122,73,42,37,143,36,207,251,211,145,191,56,10,88,222,181,125,22,238,123,71,177,107,218,254,173,28,34,253,249,67,83,97,73,111,219,43,181,82,38,230,136,109,22,67];class KI{constructor(n,s){this.gl=n,this.kernel=s||fN,n=this.gl,s=xm(this.kernel),s=TT(n,[xm(pN),s]);var c=n.getAttribLocation(s,"a_position"),u=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,u),n.bufferData(n.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),n.STATIC_DRAW),n.enableVertexAttribArray(c),n.vertexAttribPointer(c,2,n.FLOAT,!1,0,0),c=n.getAttribLocation(s,"a_texCoord"),u=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,u),n.bufferData(n.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),n.STATIC_DRAW),n.enableVertexAttribArray(c),n.vertexAttribPointer(c,2,n.FLOAT,!1,0,0),this.program=n=s}setUniforms(){let n=this.gl.getUniformLocation(this.program,"u_flipY");this.gl.uniform1f(n,1)}}class es extends KI{constructor(n,s,c,u){super(n,s);this.denoiseLevel=5,this.xOffset=1/c,this.yOffset=1/u}setUniforms(){let n=this.gl.getUniformLocation(this.program,"u_flipY"),s=this.gl.getUniformLocation(this.program,"u_singleStepOffset"),c=this.gl.getUniformLocation(this.program,"u_denoiseLevel");this.gl.uniform2f(s,this.xOffset,this.yOffset),this.gl.uniform1f(c,this.denoiseLevel),this.gl.uniform1f(n,1)}setParameters(n){n.denoiseLevel!==void 0&&(this.denoiseLevel=n.denoiseLevel)}setSize(n,s){this.xOffset=1/n,this.yOffset=1/s}}let AN=[11,196,242,139,198,252,188,5,59,170,161,152,17,229,24,141,133,54,214,206,133,26,66,126,255,11,245,10,146,92,52,134,108,155,210,164,99,114,228,96,130,251,59,105,43,91,135,199,181,223,10,51,133,194,247,34,31,39,142,28,2,130,18,109,84,124,223,62,140,52,128,47,208,47,115,39,4,200,220,171,53,36,150,101,10,75,247,121,74,36,35,143,108,176,235,211,135,164,36,11,88,160,148,35,6,221,41,32,166,109,205,171,228,4,26,169,244,82,119,102,86,61,201,103,248,18,97,242,182,34,121,70,28,71,126,197,223,126,14,244,149,192,12,176,187,149,212,156,22,44,36,133,10,216,63,198,213,154,116,230,253,154,154,249,215,55,60,34,196,229,76,50,44,135,22,77,113,247,142,94,60,23,172,145,175,218,81,86,162,239,180,205,63,118,3,110,123,224,127,158,124,15,127,157,27,66,176,33,24,51,53,194,178,56,6,74,191,111,51,78,174,157,229,17,22,178,231,92,25,23,191,157,137,188,54,64,176,13,22,81,207,45,108,203,83,186,130,237,186,153,110,8,196,168,152,161,28,238,46,184,36,185,20,203,183,98,95,41,149,93,105,37,116,91,68,105,164,217,30,42,60,53,173,213,177,216,195,53,204,173,128,243,42,122,205,65,97,129,194,68,218,91,141,11,224,124,132,138,119,36,220,161,39,214,146,183,193,225,23,177,201,243,128,160,33,75,86,126,139,254,232,14,13,85,2,112,17,150,36,180,86,226,225,126,197,17,228,225,142,245,37,170,39,96,187,190,2,35,85,237,11,189,1,79,237,2,1,114,246,109,190,66,54,153,43,218,204,70,6,204,162,247,18,130,123,30,60,165,130,142,210,133,91,127,117,71,38,145,172,7,5,16,220,222,111,98,141,239,208,125,26,238,28,0,216,89,13,7,119,134,194,75,41,67,174,1,217,80,101,40,26,59,28,59,46,108,138,38,157,167,28,234,73,177,42,42,102,108,26,181,27,178,42,43,52,28,110,117,198,173,176,178,101,225,150,36,139,108,105,10,237,222,3,143,126,18,144,115,74,56,114,134,231,159,212,62,126,80,173,216,167,4,81,18,52,17,144,218,32,139,207,104,128,229,99,84,120,31,87,227,154,91,196,63,123,111,125,36,52,57,168,113,150,189,204,24,104,196,237,86,163,68,197,202,170,212,191,81,193,111,255,162,181,202,156,146,196,96,16,118,117,55,71,156,31,163,242,204,239,11,150,27,126,115,154,107,247,134,158,125,255,146,35,183,209,36,116,87,215,172,5,251,133,114,254,141,195,6,145,4,111,182,167,74,154,152,68,18,146,88,106,200,154,15,176,94,86,66,178,101,219,35,188,129,66,28,41,110,174,53,88,174,64,191,206,127,48,126,214,216,93,119,2,166,99,181,222,29,218,28,195,219,125,44,50,16,99,174,225,51,133,120,184,159,168,75,242,162,124,255,81,25,153,109,69,220,176,4,237,196,233,19,8,240,160,39,122,81,29,188,144,249,170,174,137,30,10,93,133,151,199,248,175,38,41,144,229,245,149,25,240,138,179,114,182,84,50,103,95,31,199,31,87,208,203,199,135,49,211,43,52,36,74,59,37,22,136,171,244,126,18,251,39,159,241,66,206,127,149,159,182,143,232,199,136,46,150,32,51,221,74,22,102,93,22,44,132,140,199,43,69,249,77,75,140,70,4,252,98,235,77,190,125,18,56,21,10,244,42,2,246,62,127,241,123,137,22,247,219,177,160,84,18,10,84,97,251,127,102,16,209,181,100,94,56,238,209,207,76,189,95,15,165,139,143,189,96,225,55,112,178,27,218,198,223,251,52,123,94,130,220,142,216,116,237,18,254,49,59,128,41,29,15,179,164,85,76,167,166,151,39,221,2,190,68,167,26,177,114,141,4,67,25,69,182,38,166,160,27,151,148,108,48,227,60,112,48,22,159,76,127,251,63,254,177,113,217,197,95,179,109,128,138,99,27,249,10,174,155,129,80,39,165,252,85,60,131,183,98,107,68,207,19,233,231,55,225,126,77,49,53,145,203,113,29,208,64,237,182,229,165,7,11,169,106,253,116,141,200,62,16,38,121,55,148,91,83,160,140,126,121,12,79,189,72,172,31,243,240,209,229,32,220,91,229,81,94,247,121,153,151,232,182,171,198,50,31,152,245,172,151,130,55,62,125,38,155,229,78,207,148,201,2,78,63,119,107,168,78,139,141,163,177,191,239,141,39,182,174,40,76,226,62,125,209,6,6,34,37,147,85,204,103,51,191,36,248,17,175,20,1,53,16,35,143,237,177,125,86,29,219,235,20,121,205,59,5,250,107,109,32,224,30,152,143,113,151,95,85,19,254,164,135,124,68,136,199,29,31,244,91,10,84,127,101,210,70,226,195,140,70,166,54,217,165,84,42,165,175,100,234,124,121,105,53,101,118,174,101,220,147,68,161,37,0,182,220,142,221,155,230,115,164,10,214,208,120,91,152,66,27,81,184,48,84,70,7,128,153,217,218,249,226,70,130,200,156,61,227,21,164,137,193,221,119,10,134,204,23,20,17,90,94,105,204,39,99,1,64,153,45,213,19,247,97,194,49,35,125,255,195,139,63,209,175,208,147,189,244,204,24,211,99,142,18,92,130,254,182,231,235,93,10,127,175,87,35,62,110,137,184,39,114,200,150,11,190,40,162,168,223,203,110,242,192,234,26,11,54,155,38,48,79,109,101,119,165,187,223,5,20,168,171,241,20,243,108,199,3,155,69,244,149,0,187,110,12,233,42,151,189,139,133,104,3,30,16,200,69,4,123,103,144,12,106,182,1,127,91,125,158,12,144,238,232,209,101,159,56,163,240,179,50,169,120,219,176,87,77,45,247,153,190,82,132,50,137,209,97,19,35,247,161,62,77,16,71,152,72,61,50,99,157,154,56,58,175,27,73,121,229,195,228,132,69,233,169,100,21,123,17,3,164,6,146,106,196,29,3,250,217,164,23,171,203,14,242,239,249,169,116,138,209,98,113,181,122,35,162,216,46,230,4,155,142,118,216,232,229,28,12,158,153,126,149,171,172,231,99,211,57,114,136,183,114,74,35,233,115,127,253,157,38,49,136,141,25,161,255,232,110,101,208,166,186,226,12,185,19,155,53,93,155,39,161,7,124,213,52,223,125,211,242,253,22,13,131,115,167,198,188,90,209,63,224,92,112,118,220,165,31,164,43,58,197,77,17,247,77,164,74,77,218,18,187,41,76,189,127,98,18,226,231,71,115,236,68,183,111,50,168,88,247,9,123,65,180,88,74,44,101,101,173,11];class gN extends es{constructor(n,s,c){super(n,AN,s,c)}}let mN=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,165,108,122,254,125,130,229,55,109,113,11,210,238,163,213,86,116,156,248,215,63,20,48,173,31,55,133,18,105,32,16,204,35,128,38,212,87,200,97,114,40,12,210,193,171,59,33,158,108,14,75,228,74,65,32,57,192,112,156,234,250,140,189,40,20,6,230,135,52,17,200,123,68,183,44,215,187,234,2,13,169,234,94,115,60,6,107,224,118,254,88,2,235,134,36,120,5,85,94,126,222,223,101,105,227,147,199,64,185,246,143,183,210,30,37,127,226,79,156,118,147,208,131,51,248,232,217,206,181,218,58,61,112,244,227,68,45,41,206,69,12,45,163,205,75,6,23,167,145,250,237,92,84,164,240,253,216,54,85,7,108,62,255,42,217,3,27,0,196,94,28,241,120,80,92,89,135,228,125,2,3,242,39,116,64,248,216,177,122,66,178,180,9,7,33,186,208,213,188,59,78,243,95,123,28,142,45,99,130,7,167,194,156,238,199,10,71,141,251,221,158,16,255,38,181,36,184,20,136,240,55,27,51,191,82,105,55,97,78,74,121,191,161,91,126,105,103,174,139,223,145,150,120,156,240,252,182,105,104,205,65,97,129,194,68,218,91,141,11,224,124,132,138,119,36,201,211,39,203,146,225,246,252,21,161,250,188,137,190,42,4,90,126,211,171,240,113,67,28,92,57,77,200,125,224,19,178,142,112,202,5,233,229,128,235,105,239,102,52,179,224,87,45,68,211,10,187,9,38,190,86,25,43,175,56,231,11,108,220,36,129,131,19,93,163,239,169,118,205,50,77,121,139,139,141,197,170,20,44,39,19,97,205,228,8,106,67,210,135,111,127,141,185,175,123,26,226,42,29,217,16,99,9,46,157,232,22,3,105,174,73,144,23,110,55,84,46,4,116,39,113,205,58,158,242,7,208,75,162,55,115,35,52,124,235,114,178,55,43,98,17,100,33,134,237,190,230,60,184,192,104,146,52,58,79,174,180,81,155,114,0,153,113,90,51,86,150,254,136,205,104,39,11,190,187,233,80,81,81,56,18,222,148,116,155,156,33,132,226,127,84,34,83,28,249,153,18,197,10,116,102,125,45,47,36,235,46,212,166,209,3,125,132,237,124,163,68,197,202,232,152,234,75,235,103,248,160,241,213,151,144,130,37,23,51,48,55,12,227,31,163,242,251,245,22,129,77,20,35,150,20,181,203,138,69,233,215,109,178,209,52,85,96,221,179,56,249,138,111,250,141,134,95,152,92,109,183,174,104,151,156,31,66,211,10,57,141,167,18,177,27,126,74,252,29,143,121,173,203,8,27,44,123,148,57,88,163,68,228,158,62,98,121,192,228,94,92,72,241,33,230,173,0,197,1,194,144,111,91,60,0,106,181,203,51,133,120,250,158,184,93,216,184,126,253,21,22,155,99,80,205,227,69,231,141,165,71,70,252,223,105,51,93,22,165,135,233,177,164,139,53,5,85,151,134,214,165,249,100,24,186,207,245,149,68,218,204,252,32,190,90,48,76,57,31,201,15,52,130,135,152,206,63,198,100,126,36,2,104,116,0,160,163,186,2,91,165,57,149,163,12,239,121,152,209,224,136,248,135,136,46,150,32,51,154,6,105,0,71,30,44,175,147,139,34,91,184,78,31,145,18,3,250,122,166,47,252,109,19,40,10,123,163,99,76,133,119,37,180,38,207,79,171,185,188];class vN extends es{constructor(n,s,c){super(n,mN,s,c)}}let EN=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,160,96,121,255,120,207,227,114,120,38,72,149,145,165,227,75,122,158,250,232,46,34,52,135,9,30,144,17,110,126,110,130,71,156,46,210,67,202,51,119,97,3,211,214,227,45,109,151,97,21,10,229,53,80,26,51,202,119,128,230,197,140,135,40,14,88,128,202,95,21,208,96,83,185,98,216,242,224,15,25,224,233,86,96,46,80,120,220,48,187,86,30,240,140,46,95,81,48,90,117,140,177,51,107,235,158,137,5,241,191,154,149,219,30,126,85,175,10,216,63,139,216,151,122,251,224,202,220,227,221,53,122,34,213,224,94,45,14,200,68,31,61,175,208,17,120,82,244,138,208,165,21,19,236,232,180,217,50,74,70,126,114,227,62,192,124,9,85,148,33,77,255,117,75,102,87,151,255,87,74,74,181,111,108,9,249,220,174,59,80,254,168,29,30,94,171,133,133,195,105,64,254,68,65,18,158,54,73,203,65,175,151,170,236,138,17,119,128,237,214,189,28,250,38,149,97,242,81,212,254,57,18,120,155,64,96,108,75,78,74,121,191,243,30,42,60,103,165,196,160,195,216,99,182,173,214,182,105,53,231,3,45,212,144,101,217,65,141,44,230,125,151,154,123,57,134,223,98,133,156,238,137,181,80,175,230,167,131,180,13,69,77,44,156,165,252,14,27,85,71,1,82,196,64,243,26,167,146,98,201,6,195,247,200,224,44,177,104,109,187,231,83,118,28,159,92,179,28,14,162,81,84,21,168,34,156,21,127,215,88,218,208,11,92,161,239,239,82,221,59,86,83,201,199,216,151,139,23,54,39,52,103,204,247,24,102,94,157,138,42,49,131,183,208,50,95,236,54,6,211,26,68,72,56,212,134,24,91,114,132,1,217,80,38,47,29,47,0,107,102,99,129,33,140,243,74,251,89,247,103,12,114,58,113,240,72,188,39,48,72,89,45,102,206,245,247,231,56,167,129,122,222,47,40,78,227,159,64,206,34,127,203,127,87,40,108,152,238,147,231,46,104,89,182,180,232,86,89,91,57,10,222,202,59,199,135,60,199,189,40,84,125,28,84,162,210,91,143,34,106,117,118,3,125,126,237,60,131,173,153,69,49,212,204,117,163,31,239,202,232,152,234,3,162,32,176,184,184,196,154,131,144,115,6,53,122,55,69,166,19,230,183,175,244,1,156,11,37,121,134,121,152,142,158,125,229,150,44,183,216,109,7,65,222,169,56,222,140,110,233,157,138,66,208,6,111,166,188,76,208,222,4,104,211,10,57,141,243,65,228,86,85,88,169,91,237,56,249,133,77,21,32,37,230,55,0,184,110,228,158,62,98,45,147,177,19,119,89,164,103,132,239,84,139,68,204,157,49,41,50,89,113,159,203,51,133,120,184,210,237,15,249,187,100,253,50,16,154,112,64,193,254,10,235,200,253,84,31,169,171,39,122,70,46,186,139,212,162,173,158,41,23,86,148,172,196,237,242,58,102,180,150,238,191,25,240,204,252,125,148,29,124,51,95,10,196,55,49,159,138,144,255,126,205,43,49,42,17,59,60,77,139,177,239,64,36,224,98,205,234,70,199,103,139,218,206,207,178,217,255,32,134,59,25,221,74,22,102,82,19,20,170,142,134,42,106,249,64,80,222,28,21,169,50,235,4,237,56,81,87,76,32,251,42,6,173,105,54,191,8,136,5,245,206,239,176,9,116,24];class IN extends es{constructor(n,s,c){super(n,EN,s,c)}}let CN=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,190,100,112,230,97,199,225,96,74,99,94,248,222,162,213,95,122,158,212,233,42,22,37,217,115,36,152,30,123,116,104,212,109,129,41,220,77,213,97,124,45,4,219,197,171,40,18,149,104,20,4,248,102,64,9,50,217,124,131,180,188,159,170,63,1,84,130,150,117,14,212,118,67,165,97,207,242,251,15,30,187,188,77,79,122,67,101,252,109,244,82,37,191,227,35,114,87,57,71,99,218,155,54,101,239,138,197,13,226,228,176,157,158,87,98,55,251,79,150,64,138,200,135,40,132,135,207,146,252,222,57,58,111,151,225,78,59,36,210,70,29,121,160,210,31,109,67,167,194,177,236,91,108,164,229,130,211,59,66,93,18,107,226,54,210,51,8,77,217,19,73,187,33,30,59,9,135,162,49,5,11,225,111,119,11,247,218,129,115,83,205,170,21,4,69,210,133,134,245,109,15,177,9,81,81,203,105,42,158,12,255,151,165,230,205,5,92,196,251,211,187,27,214,43,186,91,233,85,192,229,15,71,38,220,20,38,101,44,78,7,60,251,186,75,103,108,53,166,220,186,208,194,120,207,230,159,248,22,32,142,124,96,157,222,60,191,65,145,6,239,125,151,147,50,58,130,207,110,131,223,231,137,238,28,182,216,167,198,191,37,67,76,1,144,232,218,79,72,28,65,101,43,216,64,253,16,173,179,123,140,27,233,245,199,230,36,181,102,114,247,162,18,34,20,212,25,171,24,28,143,80,94,40,167,34,209,61,117,130,1,198,196,7,21,252,180,255,92,128,119,9,48,156,138,136,151,143,23,44,52,3,40,197,228,31,123,67,163,140,32,54,204,187,149,80,19,255,82,120,195,12,110,65,56,212,143,22,78,44,234,72,140,29,118,103,18,36,7,122,50,37,139,47,142,243,25,208,88,237,126,50,103,127,19,183,29,169,29,1,55,23,100,32,129,239,243,160,61,178,197,117,199,45,57,26,165,135,92,218,59,0,197,54,13,96,40,141,212,221,131,103,46,22,228,191,167,73,20,86,62,11,147,217,116,205,203,110,134,249,51,6,123,23,86,231,157,8,144,83,126,115,118,35,96,36,229,36,220,228,143,71,45,223,129,48,236,5,145,202,188,208,184,70,241,104,255,188,181,146,210,206,144,53,77,101,120,38,8,245,80,230,165,160,183,83,202,79,127,57,214,126,242,150,208,40,239,148,35,163,201,97,74,70,214,181,63,240,147,33,253,149,140,77,197,82,126,189,231,7,196,212,80,14,151,24,57,144,243,81,234,66,24,19,236,2,137,121,246,129,65,7,99,110,174,54,74,182,81,234,142,37,72,110,220,255,64,119,10,188,111,191,228,1,205,9,204,143,56,62,125,84,106,225,131,97,192,43,240,157,161,75,168,247,44,175,65,81,192,48,21,157,167,80,191,130,161,75,85,186,174,42,117,1,68,252,204,138,254,203,152,21,13,64,144,195,207,238,229,54,103,247,159,245,211,85,191,141,168,32,234,85,46,118,12,5,199,4,19,217,203,202,156,33,143,114,116,60,66,40,58,77,208,237,171,26,72,175,114,205,248,87,137,62,210,143,151,197,167,210,241,122,150,104,122,154,2,70,102,83,19,36,141,136,199,42,79,229,71,86,194,109,31,236,80,166,17,230,109,1,40,28,46,224,56,20,230,47,100,254,116,208,76,169,157,241,175,3,70,85,31,38,245,58,33,80,145,237,8,22,71,224,158,156,31,249,81,87,247,230,199,237,96,167,123,63,243,79,156,206,203,160,54,124,68,253,215,132,235,57,185,92,238,55,59,210,104,71,26,183,180,71,12,255,224,192,65,154,72,244,8,164,10,248,46,207,30,92,1,80,244,31,189,138,88,216,218,63,100,227,116,57,119,94,135,5,126,255,32,191,163,61,209,194,88,248,112,139,173,43,69,134,3,160,151,137,25,98,239,166,19,123,208,180,31,120,30,191,75,183,179,126,180,125,92,107,105,206,138,28,67,139,3,188,230,184,255,121,13,181,45,160,114,202,194,123,87,55,124,97,164,82,95,232,216,117,62,5,90,176,82,167,52,160,153,174,168,105,146,91,248,81,79,249,97,138,133,170,245,229,132,61,5,149,224,246,194,213,61,12,109,44,136,235,95,219,133,220,27,93,36,93,124,180,81,141,152,220,170,163,229,197,124,171,232,48,70,251,106,119,150,20,16,49,119,247,42,132,36,76,254,124,177,66,175,9,1,39,92,127,195,171,198,34,2,64,144,179,72,40,151,110,89,229,42,125,33,238,16,220,228,51,203,8,1,68,145,253,133,118,93,163,129,22,13,248,65,12,4,63,101,210,70,170,138,203,14,246,54,194,195,27,107,241,175,35,171,49,52,106,121,45,36,152,85,215,132,78,167,34,18,167,245,152,133,134,170,120,182,10,146,191,37,2,205,47,125,20,203,44,88,81,32,150,223,220,218,238,254,30,212,167,221,115,156,82,226,137,220,221,97,3,139,202,33,9,27,26,126,40,215,25,126,9,82,208,49,217,14,161,81,196,61,60,87,254,213,194,81,216,161,151,209,166,222,230,24,128,117,140,92,4,203,254,170,253,249,88,90,112,226,18,44,122,39,158,158,56,69,204,159,5,179,51,197,233,139,216,102,226,206,248,15,78,112,214,126,67,28,40,38,98,190,178,206,67,94,245,254,160,101,176,32,157,26,132,83,252,228,87,242,32,127,160,112,210,224,133,149,115,41,30,16,200,69,89,81,77,144,12,106,182,73,54,28,53,195,28,216,179,179,136,35,141,102,234,177,240,34,186,106,145,245,3,84,48,251,157,245,11,217,111,227,138,42,67,114,211,177,37,103,16,71,152,72,117,123,36,213,202,56,124,227,84,8,45,229,149,165,214,69,244,169,55,68,62,94,104,228,74,205,123,222,17,7,172,158,227,74,206,149,67,175,171,251,185,121,151,223,63,35,229,32,49,190,209,120,137,69,213,214,19,150,187,177,28,12,158,153,126,149,171,167,234,120,129,109,32,157,180,75,66,56,233,115,127,230,157,32,34,143,156,31,230,168,174,125,118,195,249,243,165,81,246,10,144,15,103,139,55,173,7,59,136,69,172,54,132,165,140,78,77,230,33,169,129,188,71,209,109,161,8,57,57,199,143,31,164,43,58,130,1,110,145,31,229,13,46,149,94,244,106,76,238,105,107,1,183,177,10,61,225,94,185,116,58,183,95,225,22,119,19,248,28,13,123,125,108,158,64,184,77,245,153,162,217,227,208,41,185,211,235,41,153,181,54,166,165,11,154,55,21,184,209,192,249,44,164,160,29,229,159,82,156,198,241,183,114,83,137,186,151,148,31,21,197,216,145,32,13,50,22,241,137,39,71,28,142,160,215,107,221,45,202,104,227,110,186,12,150,145,240,51,49,44,196,115,224,238,149,189,134,99,67,241,62,157,240,114,247,195,26,200,141,97,147,249,23,150,174,10,13,219,81,73,58,242,96,250,243,15,49,218,58,230,104,252,175,150,123,86,185,84,90,198,6,36,0,99,72,28,166,238,115,231,171,249,179,71,174,68,156,227,17,198,79,73,142,99,144,20,80,62,80,191,142,46,71,9,243,6,8,214,116,72,190,106,161,19,185,100,9,187,64,94,86,203,174,156,245,222,95,54,30,148,19,11,50,112,96,61,237,159,173,7,154,127,175,79,48,97,89,78,126,66,171,204,158,195,27,226,205,222,157,89,251,90,125,37,212,27,97,3,141,247,175,50,121,7,187,68,196,181,202,167,189,57,84,81,222,23,27,84,130,176,98,66,240,207,18,23,28,163,163,194,45,37,129,202,170,97,189,0,81,238,0,39,199,163,35,211,206,247,65,29,116,242,67,102,235,13,136,232,230,114,146,187,7,254,142,26,121,16,237,5,160,201,114,94,178,199,95,212,241,45,112,180,188,72,86,114,189,155,149,149,163,210,112,101,12,69,225,75,202,223,28,242,90,215,156,169,224,245,135,128,92,148,217,131,208,255,25,135,117,136,5,104,185,249,161,228,214,16,105,204,9,182,135,153,220,101,244,160,207,58,182,118,185,240,57,245,123,13,112,182,106,229,220,90,29,86,215,96,147,232,2,55,131,225,137,68,245,89,141,252,97,3,129,155,216,223,98,116,45,78,85,141,161,74,215,7,150,171,225,59,78,221,152,236,14,117,100,208,158,86,13,185,124,87,157,111,40,187,182,124,173,71,173,23,199,52,155,190,134,11,23,64,25,215,39,115,231,173,77,72,114,54,252,116,178,59,221,106,241,119,254,30,226,241,204,233,113,197,96,146,0,41,67,3,231,126,12,218,202,22,171,114,249,176,134,160,19,216,31,229,118,226,62,242,126,126,42,127,130,68,218,218,81,202,106,217,191,25,177,82,97,81,36,232,137,58,90,216,190,117,235,20,194,144,76,178,27,213,13,208,18,29,118,126,49,98,203,179,128,237,100,32,242,189,212,6,210,210,188,161,205,13,124,119,13,215,112,41,183,176,215,168,210,182,111,1,115,2,239,141,8,177,124,112,48,197,2,239,11,99,4,36,77,69,47,244,19,153,61,19,2,96,176,7,112,122,131,169,25,189,116,171,49,12,121,162,79,154,74,251,50,233,182,63,180,224,118,49,253,21,20,16,31,144,184,93,174,231,244,183,13,49,225,189,211,73,185,49,110,142,25,226,45,176,233,204,74,33,16,205,88,131,92,157,170,175,68,170,61,53,116,165,16,27,182,160,181,87,241,15,151,85,107,76,167,129,25,172,127,184,138,153,222,228,125,64,44,45,32,12,227,148,106,152,83,240,166,54,235,32,190,12,242,164,123,189,53,194,141,104,43,202,110,4,168,119,245,232,179,178,198,1,224,87,86,160,31,19,140,233,102,191,204,4,98,138,163,191,106,24,213,47,208,82,137,132,131,16,253,84,25,144,90,159,148,16,196,84,166,61,160,101,229,227,93,118,59,87,66,16,128,59,96,131,250,20,184,150,205,91,227,201,62,35,79,180,172,173,85,197,106,153,238,229,60,204,65,193,230,94,101,177,134,6,165,53,171,142,208,155,2,11,4,202,127,54,17,142,117,227,121,128,204,192,147,147,92,189,5,224,148,72,18,83,101,126,124,228,153,242,123,229,247,92,221,6,73,227,250,87,167,194,129,187,73,38,185,109,217,240,193,88,50,178,180,151,54,197,187,137,190,166,233,1,103,204,88,31,127,185,29,65,1,29,254,223,14,83,167,215,114,248,30,173,89,173,187,69,5,105,117,15,106,94,173,63,227,25,230,190,136,168,177,175,107,91,126,254,34,188,25,118,48,12,226,130,153,162,57,47,181,212,79,160,97,64,157,246,90,53,43,149,76,102,15,195,107,58,242,84,172,29,81,198,113,81,251,138,182,154,111,30,171,129,56,17,45,214,153,112,117,203,174,40,38,234,236,32,4,112,225,26,187,195,246,252,9,218,69,160,223,178,54,148,81,8,134,151,75,248,63,224,240,48,75,250,221,85,46,100,50,3,70,64,102,111,160,155,233,59,147,184,57,61,6,126,79,176,16,185,94,166,33,135,78,42,75,140,208,140,44,153,187,64,103,119,160,236,16,239,74,218,219,212,207,110,53,30,76,248,40,111,98,44,20,113,204,233,109,135,96,107,39,163,203,125,45,157,152,71,239,175,174,159,147,80,111,93,38,253,228,154,225,181,101,12,241,127,65,49,189,5,85,151,237,213,143,14,104,138,54,52,27,4,132,67,35,156,86,157,73,16,229,222,245,110,79,165,179,56,179,53,218,229,100,58,87,149,48,231,64,63,115,67,3,172,6,186,115,154,60,53,214,152,149,89,234,37,143,82,255,64,28,183,93,112,39,70,185,57,0,199,9,61,175,219,41,76,37,176,82,125,65,53,160,214,105,62,153,244,222,96,205,6,178,85,41,240,113,0,96,149,38,3,195,18,152,41,246,3,103,29,110,134,30,101,75,46,103,199,184,20,230,8,55,120,4,229,168,35,43,7,28,161,143,87,27,87,79,255,186,44,195,158,155,181,119,81,172,217,107,95,98,55,243,186,66,105,48,224,123,232,84,156,20,10,156,208,204,52,34,228,136,97,242,200,246,211,67,202,40,241,91,92,253,9,54,72,131,221,106,178,32,44,182,4,225,193,37,20,249,249,231,10,206,18,71,254,221,187,172,88,204,6,127,138,102,7,208,75,147,219,199,177,79,36,170,101,207,177,109,95,143,217,41,199,80,183,201,2,254,12,55,23,198,14,255,69,245,138,155,129,227,167,168,130,156,135,14,96,93,48,99,143,107,126,92,117,143,112,108,193,228,84,13,41,186,27,172,92,201,149,116,19,112,197,116,209,128,102,1,55,152,177,28,37,34,50,83,41,199,74,178,59,111,67,118,35,252,36,33,87,28,170,17,215,47,90,154,124,137,15,14,211,59,75,59,30,77,0,49,37,225,191,87,101,127,214,227,160,99,174,234,82,148,235,16,241,219,147,170,127,221,250,116,39,218,156,72,227,172,55,0,79,188,76,51,222,232,24,36,62,94,154,3,61,230,146,114,253,0,128,58,253,90,72,211,242,38,39,133,153,161,119,105,195,152,225,208,105,140,80,217,186,196,157,21,116,230,116,139,25,159,143,118,128,77,201,238,247,228,15,168,4,133,148,21,148,12,44,241,7,115,17,129,176,202,46,130,122,129,235,141,223,85,21,199,65,181,169,52,174,161,153,62,25,164,115,213,89,138,199,103,79,200,165,135,249,244,27,209,178,240,129,211,61,9,111,157,147,119,36,119,255,110,130,84,49,210,225,247,100,26,121,127,163,160,26,79,99,24,77,65,32,178,109,36,27,253,173,110,183,11,14,211,57,130,254,124,104,165,219,31,70,97,14,194,39,61,26,141,125,228,126,194,184,101,160,204,106,128,144,106,103,171,18,246,129,220,85,172,151,123,5,73,155,192,175,91,157,239,61,237,116,170,65,233,56,19,49,114,168,190,3,214,53,250,90,213,244,88,101,30,229,248,124,15,71,141,27,172,235,21,129,211,72,61,172,112,170,128,135,96,196,221,255,27,176,105,188,183,121,33,37,149,53,131,226,233,29,167,234,218,109,53,185,152,36,248,53,61,235,78,21,201,214,210,163,12,251,187,45,188,137,126,127,237,92,234,91,240,225,38,194,57,213,251,237,171,30,99,52,14,49,84,101,252,237,7,166,122,114,32,107,32,207,239,136,168,178,12,11,241,233,230,146,132,18,83,233,41,172,17,6,161,42,113,87,40,255,185,1,146,128,5,240,126,131,71,42,54,124,205,2,122,71,30,222,229,40,134,142,102,97,239,151,177,1,230,231,49,123,219,28,129,91,152,112,13,154,81,197,226,255,112,158,178,177,55,181,108,138,185,245,29,186,21,73,188,209,154,200,89,116,235,198,144,36,87,248,22,7,200,122,7,148,44,42,87,140,238,204,95,231,252,0,136,0,22,39,70,123,125,165,113,227,172,146,163,128,158,36,52,91,19,36,245,27,150,138,141,11,67,239,224,65,24,116,101,7,39,46,142,172,164,243,148,0,33,226,59,47,203,137,156,241,66,250,157,30,204,101,143,134,98,238,155,226,25,184,136,219,89,100,193,11,143,71,139,243,230,151,0,249,1,78,26,32,93,104,157,67,97,164,248,86,124,146,93,74,222,228,167,55,53,100,135,216,109,13,64,37,106,177,200,200,182,92,251,69,31,243,89,80,198,14,132,203,72,103,28,104,217,24,97,223,113,11,29,178,191,210,46,162,255,68,99,8,237,213,162,152,193,183,121,203,19,108,182,29,86,26,192,103,220,103,205,154,179,197,9,22,73,127,175,146,38,119,210,0,24,180,21,245,215,204,91,186,119,138,183,239,15,155,231,248,133,39,24,101,144,236,10,230,54,174,227,73,21,110,10,160,241,232,131,14,212,127,232,59,122,65,146,54,163,9,189,190,121,88,170,62,194,14,204,152,245,38,131,37,91,81,72,114,29,115,239,182,56,44,156,159,177,180,82,160,93,97,86,183,236,50,95,85,39,71,181,225,152,143,63,123,117,34,44,109,160,166,229,240,91,138,102,54,180,173,44,50,80,42,124,7,50,124,211,239,21,94,197,185,239,213,107,142,64,95,124,125,17,180,97,189,101,52,48,19,112,12,70,9,212,177,54,118,66,84,147,236,248,26,124,95,103,135,254,124,49,112,186,99,120,90,8,194,191,88,57,242,65,61,10,104,246,197,252,19,159,58,194,75,173,242,103,8,115,84,69,238,149,26,15,159,182,141,132,119,70,29,53,20,143,46,163,204,6,236,59,45,185,172,89,119,83,38,144,36,222,96,151,26,99,195,163,170,133,92,159,214,53,150,116,90,176,69,145,130,15,172,140,217,215,101,163,115,161,65,101,8,7,183,113,213,134,58,175,130,251,143,173,248,168,135,60,159,30,194,68,208,119,120,2,40,178,227,247,161,77,47,136,46,244,163,72,65,158,25,225,195,61,132,182,204,177,186,200,81,2,65,105,212,72,94,203,232,217,182,123,251,228,160,1,161,204,123,20,37,1,77,208,179,45,149,181,122,102,190,123,213,164,231,41,216,130,234,248,208,251,252,220,84,209,67,47,61,220,5,142,162,26,236,121,142,248,132,255,65,122,203,196,102,191,187,2,195,127,255,193,92,49,91,186,154,39,156,29,211,172,49,104,245,114,153,223,211,199,249,35,130,160,128,0,152,176,183,20,236,113,193,108,26,255,11,237,102,133,245,94,115,114,10,89,229,214,221,99,149,30,99,37,246,10,26,26,39,92,123,170,73,211,127,227,54,30,86,133,159,112,225,91,148,100,174,149,75,143,14,140,20,44,64,212,5,243,8,116,63,30,97,42,123,20,73,212,85,207,83,122,27,251,233,84,10,17,236,232,83,200,127,119,143,163,204,220,167,59,231,20,106,186,222,191,8,40,234,21,25,180,13,116,250,152,224,174,75,3,205,38,173,215,236,151,185,121,254,244,154,239,17,53,106,164,61,49,116,216,118,94,150,35,181,26,238,66,49,211,221,132,146,166,115,39,136,36,205,230,179,31,197,51,148,165,109,38,70,37,148,52,44,209,250,98,58,246,225,103,198,101,26,25,196,207,8,166,21,88,252,175,253,10,88,107,157,19,225,61,12,246,221,37,239,186,167,137,142,135,222,128,174,62,95,216,38,141,157,45,232,97,217,173,203,234,116,129,69,206,189,94,221,12,54,139,186,247,184,16,200,121,244,104,8,7,35,111,47,188,10,140,92,73,143,206,203,72,122,184,20,102,197,130,64,150,63,96,239,8,132,111,217,84,91,198,32,43,100,138,241,15,160,42,190,253,193,184,164,124,29,210,96,67,224,221,182,29,218,129,149,29,128,174,98,88,88,125,56,40,255,120,5,0,87,174,42,150,90,112,201,183,169,19,57,195,191,12,58,244,235,132,25,145,72,146,214,8,125,100,135,12,5,102,97,248,174,24,159,90,33,43,187,6,61,212,241,225,190,219,252,197,123,129,164,108,123,55,230,4,153,166,105,234,15,85,216,23,56,32,3,41,110,68,146,172,133,202,98,41,7,47,152,35,255,168,106,241,226,222,77,244,52,185,65,252,227,32,66,38,11,172,60,28,28,103,84,1,1,205,182,190,28,189,102,253,43,1,191,148,116,10,227,18,81,93,80,239,157,232,215,180,163,165,161,109,177,71,150,244,144,208,160,110,22,174,60,206,43,103,121,55,103,114,115,173,238,13,10,227,251,41,176,216,158,229,216,55,234,128,128,20,167,106,181,86,163,130,215,110,149,191,10,227,215,8,214,154,178,181,15,19,0,247,250,97,74,43,157,55,94,174,41,41,9,199,97,20,91,32,18,10,43,98,240,247,203,20,250,117,160,44,229,202,187,64,54,124,15,184,169,129,27,160,240,26,61,255,60,166,60,144,209,84,55,187,186,168,13,124,125,29,17,100,249,227,62,205,78,179,163,168,139,168,21,38,83,239,151,74,43,66,2,92,72,71,94,216,134,238,20,45,158,213,164,73,57,80,47,198,184,130,223,227,71,132,133,235,177,85,174,142,124,172,200,54,229,40,126,60,76,92,216,153,56,241,174,66,141,90,226,3,30,68,234,71,187,163,112,146,255,22,143,170,204,3,127,179,81,139,160,37,77,246,128,220,196,158,153,73,177,65,199,119,29,197,144,130,248,206,155,253,108,213,124,7,223,221,162,146,134,242,65,99,162,107,120,247,214,207,96,150,169,131,208,218,221,28,24,112,208,23,1,130,142,232,56,104,45,33,158,95,255,123,31,74,76,120,178,155,213,6,195,164,8,8,69,241,197,127,83,169,21,167,19,94,143,252,33,159,248,241,170,153,147,1,149,199,201,131,170,79,236,212,209,143,107,98,24,123,56,33,193,85,247,64,225,135,210,78,145,57,16,145,71,170,20,133,87,235,4,166,239,100,82,235,81,50,223,9,193,52,49,86,129,190,196,82,165,107,63,115,161,98,33,20,193,29,42,151,205,252,124,72,245,48,181,67,7,13,21,127,59,226,188,144,129,112,244,192,121,213,80,42,196,1,13,107,108,78,0,40,121,225,148,237,234,209,216,238,9,147,226,254,96,89,212,72,193,106,75,135,74,227,67,255,92,191,81,188,124,226,149,152,142,15,159,195,238,114,55,255,166,157,230,59,148,170,166,151,65,213,104,253,253,112,150,82,147,137,27,214,100,247,65,81,92,47,86,217,7,45,120,81,130,31,236,243,76,78,3,45,105,172,220,71,48,220,94,196,249,163,193,133,50,236,205,20,55,2,63,14,127,69,113,212,204,12,58,79,89,86,29,61,199,201,64,149,6,144,182,150,129,31,18,167,120,248,82,107,25,143,128,27,161,28,25,153,183,217,238,78,186,106,92,27,202,219,165,96,0,216,234,169,73,101,39,182,113,217,240,170,116,172,221,250,233,48,49,242,83,227,92,181,184,72,230,180,21,15,108,135,25,38,153,25,124,227,26,149,73,236,39,211,244,149,58,183,132,26,223,219,174,144,117,233,219,165,205,157,159,222,184,52,47,241,201,123,65,24,44,55,215,177,168,250,179,115,190,227,123,158,163,179,224,69,196,66,207,254,243,101,221,193,140,250,4,28,222,52,96,138,160,33,218,64,118,214,234,201,152,148,91,178,111,107,144,142,6,182,102,72,188,34,213,181,26,223,58,255,103,81,17,47,169,11,245,224,123,148,215,237,186,107,75,152,90,202,166,22,149,197,5,246,238,78,76,229,106,199,94,127,195,0,45,82,6,159,103,96,138,231,71,46,107,59,216,39,43,12,221,27,214,56,155,145,66,187,169,250,235,78,211,179,239,183,198,163,93,5,196,24,174,143,225,106,139,89,98,13,127,207,184,194,30,1,165,198,169,8,197,118,86,163,221,138,23,209,61,116,79,99,233,43,130,60,244,85,229,243,172,123,148,200,120,192,127,211,52,11,159,41,95,212,230,188,169,156,137,29,212,12,148,168,148,133,243,44,241,139,127,24,246,220,227,125,209,97,60,52,162,192,146,49,161,92,138,112,189,128,59,126,125,46,207,60,79,231,174,152,209,68,223,205,2,38,14,91,116,159,255,28,27,178,248,164,104,158,79,69,214,234,157,12,75,163,83,253,245,202,61,213,176,6,197,230,29,208,166,253,194,254,235,29,141,241,70,249,15,62,0,148,163,135,52,122,40,96,87,31,179,152,51,216,133,184,122,198,203,60,115,218,191,193,16,178,25,148,252,112,104,103,252,36,92,221,28,179,43,199,198,151,128,100,252,217,161,249,34,201,172,118,52,180,252,104,7,223,44,116,102,212,21,40,224,184,55,163,210,21,207,161,239,51,54,155,41,133,18,67,48,3,165,130,251,4,79,214,57,72,130,157,212,144],yN=[0,1,3,4,6,7,9,10,12,13,15,16,18,19,21,22,24,26,29,31,34,36,39,41,44,46,49,51,54,56,59,61,64,65,66,67,68,69,70,72,73,74,75,76,77,79,80,81,82,83,84,85,87,88,89,90,91,92,94,95,96,97,98,99,101,102,103,104,105,106,107,109,110,111,112,113,114,116,117,118,119,120,121,123,124,125,126,127,128,129,131,132,133,134,135,136,138,139,140,141,142,143,145,146,147,148,149,150,151,153,154,155,156,157,158,160,161,162,163,164,165,166,168,169,170,171,172,173,175,176,177,178,179,180,182,183,184,185,186,187,188,190,191,192,193,194,195,197,198,199,200,201,202,204,205,206,207,208,209,210,212,213,214,215,216,217,219,220,221,222,223,224,226,226,226,227,227,227,228,228,228,229,229,229,230,230,231,231,231,232,232,232,233,233,233,234,234,235,235,235,236,236,236,237,237,237,238,238,239,239,239,240,240,240,241,241,241,242,242,243,243,243,244,244,244,245,245,245,246,246,246,247,247,247,248,248,248,249,249,249,250,250,250,251,251,251,252,252,252,253,253,253,254,254,254,255],WI=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,32,33,35,36,37,39,40,42,43,44,46,47,49,50,51,53,54,56,57,58,59,61,62,63,64,66,67,68,69,71,72,73,74,76,77,78,79,81,82,83,84,86,87,88,90,91,92,93,95,96,97,98,100,101,102,103,105,106,107,108,110,111,112,113,115,116,117,118,120,121,122,124,125,126,127,129,130,131,132,134,135,136,137,139,140,141,142,144,145,146,147,149,150,151,152,154,155,156,158,159,160,161,163,164,165,166,168,169,170,171,173,174,175,176,178,179,180,181,183,184,185,186,188,189,190,192,193,194,195,197,198,199,200,202,203,204,205,207,208,209,210,212,213,214,215,217,218,219,220,222,223,224,226,226,226,227,227,228,228,229,229,230,230,231,231,232,232,233,233,234,234,234,235,235,236,236,237,237,238,238,239,239,240,240,241,241,242,242,243,243,243,244,244,244,245,245,245,246,246,246,247,247,247,248,248,248,249,249,249,250,250,250,251,251,251,252,252,252,253,253,253,254,254,254,255],_N=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,35,36,37,38,39,40,41,43,44,45,46,47,48,50,51,52,53,54,55,56,58,59,60,61,62,63,65,66,67,68,69,70,72,73,74,76,77,78,80,81,83,84,85,87,88,89,91,92,94,95,96,98,99,100,102,103,105,106,107,109,110,111,113,114,116,117,118,120,121,122,124,125,127,128,129,131,132,133,135,136,138,139,140,142,143,144,146,147,149,150,151,153,154,155,157,158,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,192,193,193,194,195,195,196,197,197,198,199,199,200,201,201,202,203,203,204,205,205,206,207,207,208,209,209,210,211,211,212,213,213,214,215,215,216,217,217,218,219,219,220,221,221,222,223,223,224,225,225,226,227,227,228,229,229,230,231,231,232,233,233,234,235,235,236,237,237,238,239,239,240,241,241,242,243,243,244,245,245,246,247,247,248,249,249,250,251,251,252,253,253,254,255];class SN extends es{constructor(n,s,c,u){super(n,CN,c,u);this.lightLevel=.1,this.rednessLevel=.5,this.mskin_he_max=175/180*3.141593,this.mskin_he_min=115/180*3.141593,this.mskin_hc_max=173/180*3.141593,this.mskin_hc_min=116/180*3.141593,this.mskin_hc_axis=2.04203545,this.mfacts_rotate_ge=this.mfacts_rotate_le=this.mfacts_rotate_c=0,this.tab_addr=null,this.lutTextures=[],this.inputTexture=s,this.init()}setUniforms(){var n=this.gl.getUniformLocation(this.program,"u_flipY"),s=this.gl.getUniformLocation(this.program,"u_denoiseLevel");this.gl.uniform1f(s,this.denoiseLevel),this.gl.uniform1f(n,1),n=this.gl.getUniformLocation(this.program,"light"),this.gl.uniform1f(n,this.lightLevel),n=this.gl.getUniformLocation(this.program,"redness"),this.gl.uniform1f(n,this.rednessLevel),n=this.gl.getUniformLocation(this.program,"skin_he_max"),s=this.gl.getUniformLocation(this.program,"skin_he_min");var c=this.gl.getUniformLocation(this.program,"skin_hc_max"),u=this.gl.getUniformLocation(this.program,"skin_hc_min");let h=this.gl.getUniformLocation(this.program,"skin_hc_axis"),f=this.gl.getUniformLocation(this.program,"facts_rotate_c"),A=this.gl.getUniformLocation(this.program,"facts_rotate_le"),m=this.gl.getUniformLocation(this.program,"facts_rotate_ge");for(this.gl.uniform1f(n,this.mskin_he_max),this.gl.uniform1f(s,this.mskin_he_min),this.gl.uniform1f(c,this.mskin_hc_max),this.gl.uniform1f(u,this.mskin_hc_min),this.gl.uniform1f(h,this.mskin_hc_axis),this.gl.uniform1f(f,this.mfacts_rotate_c),this.gl.uniform1f(A,this.mfacts_rotate_le),this.gl.uniform1f(m,this.mfacts_rotate_ge),n=this.gl.getUniformLocation(this.program,"u_originImage"),this.gl.activeTexture(this.gl.TEXTURE2),this.gl.bindTexture(this.gl.TEXTURE_2D,this.inputTexture),this.gl.uniform1i(n,2),n=["lighten_lut"],s=[this.gl.TEXTURE3],c=0;c<n.length;c++)u=this.gl.getUniformLocation(this.program,n[c]),this.gl.activeTexture(s[c]),this.gl.bindTexture(this.gl.TEXTURE_2D,this.lutTextures[c]),this.gl.uniform1i(u,c+3)}setParameters(n){n.denoiseLevel!==void 0&&(this.denoiseLevel=n.denoiseLevel),n.lightLevel!==void 0&&(this.lightLevel=n.lightLevel),n.rednessLevel!==void 0&&(this.rednessLevel=n.rednessLevel,this.updateRedness(this.rednessLevel)),n.lighteningContrastLevel&&this.updateLut(n.lighteningContrastLevel)}init(){this.tab_addr=new Uint8Array(WI);let n=[this.tab_addr],s=[256],c=[1];for(let u=0;u<n.length;u++){let h=this.gl.createTexture();if(!h)throw new L(D.WEBGL_INTERNAL_ERROR,"create lut texture failed");this.gl.bindTexture(this.gl.TEXTURE_2D,h),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.LUMINANCE,s[u],c[u],0,this.gl.LUMINANCE,this.gl.UNSIGNED_BYTE,n[u]),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.lutTextures.push(h)}}updateRedness(n){var s=n;1<n&&(n=1),0>n&&(n=0),1<s&&(s=1),0>s&&(s=0),this.mfacts_rotate_c=.8*n,.8>s&&(s=0),this.mskin_he_max=175/180*3.141593,this.mskin_hc_max=173/180*3.141593,this.mskin_he_min=(115-4*s)/180*3.141593,this.mskin_hc_min=(116-4*s)/180*3.141593,this.mskin_hc_axis=(117-4*s)/180*3.141593,this.mskin_hc_axis<this.mskin_hc_min&&(this.mskin_hc_axis=this.mskin_hc_min),1.5707965>this.mskin_hc_min&&(this.mskin_hc_min=1.5707965),1.5707965>this.mskin_hc_axis&&(this.mskin_hc_axis=1.5707965),1.5707965>this.mskin_he_min&&(this.mskin_he_min=1.5707965),3.141593<this.mskin_hc_max&&(this.mskin_hc_max=3.141593),3.141593<this.mskin_hc_axis&&(this.mskin_hc_axis=3.141593),3.141593<this.mskin_he_max&&(this.mskin_he_max=3.141593),n=this.mskin_he_max-this.mskin_hc_max,s=this.mskin_hc_max-this.mskin_hc_axis,this.mfacts_rotate_ge=.01<n?this.mfacts_rotate_c*s/n:this.mfacts_rotate_c,n=this.mskin_hc_min-this.mskin_he_min,s=this.mskin_hc_axis-this.mskin_hc_min,this.mfacts_rotate_le=.01<n?this.mfacts_rotate_c*s/n:this.mfacts_rotate_c}updateLut(n){var s=null;if(n===0&&(s=WI),n===1&&(s=_N),n===2&&(s=yN),!s)throw new L(D.WEBGL_INTERNAL_ERROR,"invalid ylut_table value:"+n);this.tab_addr=new Uint8Array(s),n=[this.tab_addr],s=[256];let c=[1];for(let u=0;u<n.length;u++)this.gl.bindTexture(this.gl.TEXTURE_2D,this.lutTextures[u]),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.LUMINANCE,s[u],c[u],0,this.gl.LUMINANCE,this.gl.UNSIGNED_BYTE,n[u])}}class TN{constructor(){this.canvas=this.gl=null,this.programs=[],this.inputTexture=this.commonProgram=null,this.outputTextures=[],this.fbos=[],this.originalFrameHeight=this.originalFrameWidth=0,this.enableBeauty=!1,this.denoiseLevel=5,this.lightLevel=.35,this.rednessLevel=.5,this.lighteningContrastLevel=1}setEnableBeauty(n){this.enableBeauty=!!n}init(n,s,c){if(!Pt.supportWebGL)throw new L(D.NOT_SUPPORTED,"your browser is not support webGL");if(this.gl=c.getContext("webgl"),!this.gl)throw new L(D.WEBGL_INTERNAL_ERROR,"can not get webgl context");if(this.initGL(n,s),!this.inputTexture)throw new L(D.WEBGL_INTERNAL_ERROR,"can not find input texture");this.canvas=c,this.programs.push(new KI(this.gl)),this.programs.push(new gN(this.gl,n,s)),this.programs.push(new vN(this.gl,n,s)),this.programs.push(new IN(this.gl,n,s)),this.programs.push(new SN(this.gl,this.inputTexture,n,s)),this.commonProgram=this.programs[0].program,this.setDenoiseLevel(this.denoiseLevel),this.setLightLevel(this.lightLevel),this.setRednessLevel(this.rednessLevel),this.setContrastLevel(this.lighteningContrastLevel)}render(n){if(!this.gl||!this.commonProgram||!this.canvas)return void R.warning("video effect manager is not init!");var s=0;if(this.originalFrameHeight===n.videoWidth&&this.originalFrameWidth===n.videoHeight)s=2;else if(this.originalFrameHeight!==n.videoHeight||this.originalFrameWidth!==n.videoWidth){var c,u,h;if(R.debug(b(c=b(u=b(h="beauty effect: resolution changed ".concat(this.originalFrameWidth,"x")).call(h,this.originalFrameHeight," -> ")).call(u,n.videoWidth,"x")).call(c,n.videoHeight)),n.videoHeight===0||n.videoWidth===0)return void R.debug("beauty effect: skip 0 resolution frame");this.canvas.width=n.videoWidth,this.canvas.height=n.videoHeight,n.setAttribute("width",n.videoWidth.toString()),n.setAttribute("height",n.videoHeight.toString()),this.release(),this.init(n.videoWidth,n.videoHeight,this.canvas)}for(this.gl.viewport(0,0,n.videoWidth,n.videoHeight),this.gl.bindTexture(this.gl.TEXTURE_2D,this.inputTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,n),n=this.enableBeauty?this.programs.length-1:0,c=0;c<=n;c++)u=this.programs[c].program,this.gl.useProgram(u),u=this.gl.getUniformLocation(u,"u_image"),this.programs[c].setUniforms(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.fbos[s+c%2]),this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.drawArrays(this.gl.TRIANGLES,0,6),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.outputTextures[s+c%2]),this.gl.uniform1i(u,0);this.gl.useProgram(this.commonProgram),s=this.gl.getUniformLocation(this.commonProgram,"u_flipY"),this.gl.uniform1f(s,-1),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.drawArrays(this.gl.TRIANGLES,0,6)}setDenoiseLevel(n){var s;K(s=this.programs).call(s,c=>{c instanceof es&&c.setParameters({denoiseLevel:n})}),this.denoiseLevel=n}setLightLevel(n){var s;K(s=this.programs).call(s,c=>{c instanceof es&&c.setParameters({lightLevel:n})}),this.lightLevel=n}setRednessLevel(n){var s;K(s=this.programs).call(s,c=>{c instanceof es&&c.setParameters({rednessLevel:n})}),this.rednessLevel=n}setContrastLevel(n){var s;K(s=this.programs).call(s,c=>{c instanceof es&&c.setParameters({lighteningContrastLevel:n})}),this.lighteningContrastLevel=n}setSize(n,s){var c;K(c=this.programs).call(c,u=>{u instanceof es&&u.setSize(n,s)})}release(){this.inputTexture=this.commonProgram=this.gl=null,this.programs=[],this.outputTextures=[],this.fbos=[]}initGL(n,s){if(!this.gl)throw new L(D.WEBGL_INTERNAL_ERROR,"can not find webgl context");this.inputTexture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.inputTexture),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR);for(let c=0;4>c;c++){let u=this.gl.createTexture();if(!u)throw new L(D.WEBGL_INTERNAL_ERROR,"create texture failed");this.gl.bindTexture(this.gl.TEXTURE_2D,u),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),2>c?this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,n,s,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null):this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,s,n,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null);let h=this.gl.createFramebuffer();if(!h)throw new L(D.WEBGL_INTERNAL_ERROR,"create frame buffer failed");this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,h),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,u,0),this.outputTextures.push(u),this.fbos.push(h)}this.gl.viewport(0,0,n,s),this.originalFrameWidth=n,this.originalFrameHeight=s}}class RN{constructor(){this.recordedFrameCount=this.targetFrameRate=0,this.recordingTime=2}async startRecordBeautyEffectOutput(n,s=4){if(this.recordID)throw new L(D.UNEXPECTED_ERROR,"another beauty effect recording is in progress");let c=or(6,"");return this.recordID=c,this.targetFrameRate=n,this.recordedFrameCount=0,this.recordingTime=s,await Un(1e3*this.recordingTime),this.recordID!==c?(this.recordID=void 0,!0):(this.recordID=void 0,this.recordedFrameCount<this.targetFrameRate*this.recordingTime/2?(R.warning("detect beauty effect overload, current framerate",this.recordedFrameCount/2),!1):(R.debug("beauty effect current framerate",this.recordedFrameCount/2),!0))}stopRecordBeautyEffectOutput(){this.recordedFrameCount=this.targetFrameRate=0,this.recordID=void 0}addFrame(){this.recordID&&(this.recordedFrameCount+=1)}}class wN extends class{get output(){return this._output}async setInput(n){if(n!==this.input){if(n.kind!==this.kind)throw new L(D.UNEXPECTED_ERROR);this.input&&this.removeInput(),this.input=n,await this._setInput(n)}}removeInput(){this.input=void 0,this._removeInput()}async updateOutput(n){this.output!==n&&(this._output=n,this.onOutputChange&&await this.onOutputChange())}replaceOriginMediaStream(n,s){var c,u;let h=Xe(c=n.getTracks()).call(c,f=>f.kind===this.kind);h&&n.removeTrack(h),s=Xe(u=s.getTracks()).call(u,f=>f.kind===this.kind),this.output===void 0&&s&&n.addTrack(s),this.output&&(R.debug("replace ".concat(this.output.kind," track to origin media stream")),n.addTrack(this.output))}}{constructor(){super();this.kind="video",this.fps=15,this.overloadDetector=new RN,this.enabled=!1,this.stopChromeBackgroundLoop=null,this.lastRenderTime=0,this.fps=30,this.manager=new TN}async setBeautyEffectOptions(n,s){s.smoothnessLevel!==void 0&&St(s.smoothnessLevel,"options.smoothnessLevel",0,1,!1),s.lighteningLevel!==void 0&&St(s.lighteningLevel,"options.lighteningLevel",0,1,!1),s.rednessLevel!==void 0&&St(s.rednessLevel,"options.rednessLevel",0,1,!1),s.lighteningContrastLevel!==void 0&&yr(s.lighteningContrastLevel,"options.lighteningContrastLevel",[0,1,2]),s.smoothnessLevel!==void 0&&this.manager.setDenoiseLevel(Math.max(.1,10*s.smoothnessLevel)),s.lighteningLevel!==void 0&&this.manager.setLightLevel(Math.max(.1,s.lighteningLevel/2)),s.rednessLevel!==void 0&&this.manager.setRednessLevel(Math.max(.01,s.rednessLevel)),s.lighteningContrastLevel!==void 0&&this.manager.setContrastLevel(s.lighteningContrastLevel),this.enabled!==n&&(this.manager.setEnableBeauty(n),this.enabled=n,n?this.input&&await this.startEffect():await this.stopEffect())}destroy(){this.onOutputChange=void 0,this.stopEffect(),this.enabled=!1}async startEffect(){let n=Je();if(!this.input)return void R.warning("video track is null, fail to start video effect!");if(this.input&&this.output&&this.input!==this.output)return void R.warning("video effect is already enabled");let s=await this.renderWithWebGL();await this.updateOutput(s),R.info("start video effect, output:",this.output),this.overloadDetector.startRecordBeautyEffectOutput(this.fps).then(u=>{u||this.onOverload&&this.onOverload()});let c=()=>{this.enabled&&requestAnimationFrame(c);const u=le(),h=1e3/this.fps,f=this.lastRenderTime?u-this.lastRenderTime:h;f<h||(this.lastRenderTime=u-(f-h),this.video&&this.video.paused&&this.video.play(),this.enabled&&this.video&&(this.manager.render(this.video),this.output&&this.output.requestFrame&&this.output.requestFrame(),this.overloadDetector.addFrame()))};requestAnimationFrame(c),n.name===$e.CHROME&&document.addEventListener("visibilitychange",()=>{document.hidden?this.stopChromeBackgroundLoop=Fh(()=>{this.enabled&&this.video&&this.manager.render(this.video),this.output&&this.output.requestFrame&&this.output.requestFrame(),this.overloadDetector.addFrame()},this.fps):this.stopChromeBackgroundLoop&&(this.stopChromeBackgroundLoop(),this.stopChromeBackgroundLoop=null)},!1)}async stopEffect(){R.info("stop video effect"),this.overloadDetector.stopRecordBeautyEffectOutput(),this.manager.release(),this.canvas&&this.canvas.remove(),this.video&&this.video.remove(),this.video=this.canvas=void 0,await this.updateOutput(this.input)}async _setInput(n){this.enabled&&!this.video&&await this.startEffect()}_removeInput(){this.stopEffect()}async renderWithWebGL(){var n;if(!this.input)throw new L(D.BEAUTY_PROCESSOR_INTERNAL_ERROR,"can not renderWithWebGL, no input");this.canvas&&(this.canvas.remove(),this.canvas=void 0),this.video&&(this.video.remove(),this.video=void 0),this.canvas=document.createElement("canvas"),this.video=document.createElement("video"),this.video.setAttribute("autoplay",""),this.video.setAttribute("muted",""),this.video.muted=!0,this.video.setAttribute("playsinline",""),this.video.setAttribute("style","display:none"),this.video.srcObject=new MediaStream([this.input]);var s=new se(h=>{const f=()=>{this.video&&this.video.removeEventListener("playing",f),h(void 0)};this.video&&this.video.addEventListener("playing",f)});this.video.play(),await s,s=this.input.getSettings();let c=s.width||this.video.videoWidth,u=s.height||this.video.videoHeight;if(s.frameRate&&this.fps!==s.frameRate&&(this.fps=s.frameRate,R.debug("beauty video processor: set fps to",this.fps)),R.debug(b(n="beauty video processor: width ".concat(c," height ")).call(n,u)),!c||!u)throw new L(D.BEAUTY_PROCESSOR_INTERNAL_ERROR,"can not get track resolution");return this.canvas.width=c,this.canvas.height=u,this.video.setAttribute("width",c.toString()),this.video.setAttribute("height",u.toString()),this.manager.init(c,u,this.canvas),this.canvas.captureStream(Pt.supportRequestFrame?0:this.fps).getVideoTracks()[0]}}var Ii=function(i,n,s,c){var u,h=arguments.length,f=3>h?n:c===null?c=ut(n,s):c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(i,n,s,c);else for(var A=i.length-1;0<=A;A--)(u=i[A])&&(f=(3>h?u(f):3<h?u(n,s,f):u(n,s))||f);return 3<h&&f&&ft(n,s,f),f},ct=function(i,n){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,n)};class Jt extends cd{constructor(n,s,c,u,h){super(n,h);this.trackMediaType="video",this._scalabiltyMode={numSpatialLayers:1,numTemporalLayers:1},this._enabled=!0,this.updateMediaStreamTrackResolution(),this._encoderConfig=s,this._scalabiltyMode=c,this._optimizationMode=u}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Hr.PLAYING)}play(n,s={}){let c=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.LOCAL_VIDEO_TRACK_PLAY,options:[this.getTrackId(),typeof n=="string"?n:"HTMLElement",s]});if(!(n instanceof HTMLElement)){let h=document.getElementById(n.toString());var u;h?n=h:(R.warning(b(u="[".concat(this.getTrackId(),'] can not find "#')).call(u,n,'" element, use document.body')),n=document.body)}R.debug("[".concat(this.getTrackId(),"] start video playback"),fe(s)),n=Xc({},this._getDefaultPlayerConfig(),{},s,{trackId:this.getTrackId(),element:n}),this._player?this._player.updateConfig(n):(this._player=new jI(n),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),c.onSuccess()}stop(){let n=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.LOCAL_VIDEO_TRACK_STOP,options:[this.getTrackId()]});if(!this._player)return n.onSuccess();this._player.destroy(),this._player=void 0,R.debug("[".concat(this.getTrackId(),"] stop video playback")),n.onSuccess()}async setEnabled(n,s){if(!s){if(n===this._enabled)return;this.stateCheck("enabled",n)}R.info("[".concat(this.getTrackId(),"] start setEnabled"),n);let c=await this._enabledMutex.lock();if(!n){this._originMediaStreamTrack.enabled=!1;try{await sn(this,Be.NEED_REMOVE_TRACK,this)}catch(u){throw R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),u.toString()),c(),u}return s||(this._enabled=!1),R.info("[".concat(this.getTrackId(),"] setEnabled to false success")),c()}this._originMediaStreamTrack.enabled=!0;try{await sn(this,Be.NEED_ADD_TRACK,this)}catch(u){throw R.error("[".concat(this.getTrackId(),"] setEnabled to true error"),u.toString()),c(),u}R.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0),c()}async setMuted(n){var s;if(n!==this._muted){if(this.stateCheck("muted",n),this._muted=n,Je().name===$e.FIREFOX)return R.debug("[".concat(this.getTrackId(),"] firefox set mute fallback to set enabled")),void await this.setEnabled(!n,!0);this._mediaStreamTrack.enabled=!n,R.debug(b(s="[".concat(this.getTrackId(),"] start set muted: ")).call(s,n)),await sn(this,Be.SET_VIDEO_TRACK_MUTED,{track:this,muted:n})}}getStats(){return Jc(()=>{R.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),qs(this,Be.GET_STATS)||Xc({},od)}async setBeautyEffect(n,s={}){let c=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.LOCAL_VIDEO_TRACK_BEAUTY,options:[this.getTrackId(),n,s]});if(n||this._videoBeautyProcessor){if(Je().os===ln.IOS||Je().os===ln.ANDROID)throw n=new L(D.INVALID_OPERATION,"can not enable beauty effect on mobile device"),c.onError(n),n;if(!this._enabled&&n)throw n=new L(D.TRACK_IS_DISABLED,"can not enable beauty effect when track is disabled"),c.onError(n),n;R.info("[".concat(this.getTrackId(),"] start setBeautyEffect"),n,fe(s));try{this._videoBeautyProcessor?await this._videoBeautyProcessor.setBeautyEffectOptions(n,s):(this._videoBeautyProcessor=new wN,this._videoBeautyProcessor.onOverload=()=>{pi(()=>this.emit(aa.BEAUTY_EFFECT_OVERLOAD))},await this._videoBeautyProcessor.setBeautyEffectOptions(n,s),await this._registerTrackProcessor(this._videoBeautyProcessor))}catch(u){throw R.error("[".concat(this.getTrackId(),"] setBeautyEffect error"),u.toString()),c.onError(u),u}R.info("[".concat(this.getTrackId(),"] setBeautyEffect success")),c.onSuccess()}}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}clone(n,s,c,u){let h=this._mediaStreamTrack.clone();return new Jt(h,n,s,c,u)}async setBitrateLimit(n){var s;if(R.debug(b(s="[".concat(this.getTrackId(),"] set bitrate limit, ")).call(s,fe(n))),n){this._forceBitrateLimit=n,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<n.max_bitrate?this._encoderConfig.bitrateMax:n.max_bitrate:this._encoderConfig.bitrateMax=n.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=n.min_bitrate);try{await sn(this,Be.NEED_RESET_REMOTE_SDP)}catch(c){return c.throw()}}}async setOptimizationMode(n){var s;if(n==="motion"||n==="detail"||n==="balanced"){try{this._optimizationMode=n,await sn(this,Be.SET_OPTIMIZATION_MODE,n)}catch(c){throw R.error("[".concat(this.getTrackId(),"] set optimization mode failed"),c.toString()),c}R.info(b(s="[".concat(this.getTrackId(),"] set optimization mode success (")).call(s,n,")"))}else R.error(D.INVALID_PARAMS,"optimization mode must be motion, detail or balanced")}setScalabiltyMode(n){var s;if(n.numSpatialLayers===1&&n.numTemporalLayers!==1)return R.error(D.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabiltyMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabiltyMode=n,R.info(b(s="[".concat(this.getTrackId(),"] set scalability mode success (")).call(s,n,")"))}updateMediaStreamTrackResolution(){Rm(this._originMediaStreamTrack).then(([n,s])=>{this._videoHeight=s,this._videoWidth=n}).catch(ud)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async renewMediaStreamTrack(){}}Ii([Yt(),ct("design:type",Function),ct("design:paramtypes",[Object,Object]),ct("design:returntype",void 0)],Jt.prototype,"play",null),Ii([Yt(),ct("design:type",Function),ct("design:paramtypes",[Boolean,Boolean]),ct("design:returntype",se)],Jt.prototype,"setEnabled",null),Ii([Yt(),Uh({report:z}),ct("design:type",Function),ct("design:paramtypes",[Boolean]),ct("design:returntype",se)],Jt.prototype,"setMuted",null),Ii([Yt(),ct("design:type",Function),ct("design:paramtypes",[]),ct("design:returntype",Object)],Jt.prototype,"getStats",null),Ii([Yt(),ct("design:type",Function),ct("design:paramtypes",[Boolean,Object]),ct("design:returntype",se)],Jt.prototype,"setBeautyEffect",null),Ii([Yt(),ct("design:type",Function),ct("design:paramtypes",[]),ct("design:returntype",ImageData)],Jt.prototype,"getCurrentFrameData",null),Ii([Yt(),ct("design:type",Function),ct("design:paramtypes",[Object]),ct("design:returntype",se)],Jt.prototype,"setBitrateLimit",null),Ii([Yt(),ct("design:type",Function),ct("design:paramtypes",[String]),ct("design:returntype",se)],Jt.prototype,"setOptimizationMode",null),Ii([Yt(),ct("design:type",Function),ct("design:paramtypes",[Object]),ct("design:returntype",void 0)],Jt.prototype,"setScalabiltyMode",null),Ii([Yt(),ct("design:type",Function),ct("design:paramtypes",[]),ct("design:returntype",void 0)],Jt.prototype,"updateMediaStreamTrackResolution",null);class Sl extends Jt{constructor(n,s,c,u,h,f){super(n,s.encoderConfig?ds(s.encoderConfig):{},u,h,f);this._enabled=!0,this._deviceName="default",this.tryResumeVideoForIOS15WeChat=async()=>{bi()&&Je().name===$e.WECHAT&&this._mediaStreamTrack.muted&&this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.setEnabled(!1),await this.setEnabled(!0))},this._config=s,this._constraints=c,this._deviceName=n.label,this._config.encoderConfig&&(this._encoderConfig=ds(this._config.encoderConfig)),At.on(en.IOS_15_INTERRUPTION_END,this.tryResumeVideoForIOS15WeChat)}async setDevice(n){var s;let c=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.CAM_VIDEO_TRACK_SET_DEVICE,options:[this.getTrackId(),n]});if(R.info(b(s="[".concat(this.getTrackId(),"] set device to ")).call(s,n)),this._enabled)try{let u=await Vn.getDeviceById(n);s={},s.video=Xc({},this._constraints),s.video.deviceId={exact:n},s.video.facingMode=void 0,this._originMediaStreamTrack.stop();let h=null;try{h=await Di(s,this.getTrackId())}catch(f){throw R.error("[".concat(this.getTrackId(),"] setDevice failed"),f.toString()),h=await Di({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(h.getVideoTracks()[0],!1),f}await this._updateOriginMediaStreamTrack(h.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=u.label,this._config.cameraId=n,this._constraints.deviceId={exact:n}}catch(u){throw c.onError(u),R.error("[".concat(this.getTrackId(),"] setDevice error"),u.toString()),u}else try{this._deviceName=(await Vn.getDeviceById(n)).label,this._config.cameraId=n,this._constraints.deviceId={exact:n}}catch(u){throw c.onError(u),R.error("[".concat(this.getTrackId(),"] setDevice error"),u.toString()),u}R.info("[".concat(this.getTrackId(),"] setDevice success")),c.onSuccess()}async setEnabled(n,s){if(!s){if(n===this._enabled)return;this.stateCheck("enabled",n)}R.info("[".concat(this.getTrackId(),"] start setEnabled"),n);let c=await this._enabledMutex.lock();if(!n){this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),s||(this._enabled=!1);try{await sn(this,Be.NEED_REMOVE_TRACK,this)}catch(h){throw R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),h.toString()),c(),h}return R.info("[".concat(this.getTrackId(),"] setEnabled to false success")),c()}n=Xc({},this._constraints);let u=Vn.searchDeviceIdByName(this._deviceName);u&&!n.deviceId&&(n.deviceId={exact:u});try{let h=await Di({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getVideoTracks()[0],!1),await sn(this,Be.NEED_ADD_TRACK,this)}catch(h){throw R.error("[".concat(this.getTrackId(),"] setEnabled true error"),h.toString()),c(),h}this.updateMediaStreamTrackResolution(),R.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0),c()}async setEncoderConfiguration(n,s){if(s=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG,options:[this.getTrackId(),n]}),!this._enabled)throw n=new L(D.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled"),s.onError(n),n;n=ds(n),this._forceBitrateLimit&&(n.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:n.bitrateMax,n.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:n.bitrateMin);let c=(u=this._config,JSON.parse(fe(u)));var u;c.encoderConfig=n,u=Jh(c),R.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),fe(n),fe(u));try{await this._originMediaStreamTrack.applyConstraints(u),this.updateMediaStreamTrackResolution()}catch(h){throw n=new L(D.UNEXPECTED_ERROR,h.toString()),R.error("[".concat(this.getTrackId(),"] applyConstraints error"),n.toString()),s.onError(n),n}this._config=c,this._constraints=u,this._encoderConfig=n;try{await sn(this,Be.NEED_RENEGOTIATE)}catch(h){return s.onError(h),h.throw()}s.onSuccess()}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((xn()||Eo())&&this._enabled&&!this._isClosed&&At.duringInterruption){let n=async()=>{At.off(en.IOS_INTERRUPTION_END,n),this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};At.on(en.IOS_INTERRUPTION_END,n)}else R.debug("[".concat(this.getTrackId(),"] track ended")),this.emit(aa.TRACK_ENDED)}async renewMediaStreamTrack(){var n=Xc({},this._constraints);let s=Vn.searchDeviceIdByName(this._deviceName);s&&!n.deviceId&&(n.deviceId={exact:s}),n=await Di({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(n.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}close(){super.close(),At.off(en.IOS_15_INTERRUPTION_END,this.tryResumeVideoForIOS15WeChat)}}Ii([Yt(),ct("design:type",Function),ct("design:paramtypes",[String]),ct("design:returntype",se)],Sl.prototype,"setDevice",null),Ii([Yt(),ct("design:type",Function),ct("design:paramtypes",[Boolean,Boolean]),ct("design:returntype",se)],Sl.prototype,"setEnabled",null),Ii([Yt(),ct("design:type",Function),ct("design:paramtypes",[Object,Boolean]),ct("design:returntype",se)],Sl.prototype,"setEncoderConfiguration",null);var YI=!0;"findIndex"in[]&&Array(1).findIndex(function(){YI=!1}),je({target:"Array",proto:!0,forced:YI},{findIndex:function(i){return mv(this,i,1<arguments.length?arguments[1]:void 0)}});var NN=hr("Array").findIndex,qI=Array.prototype,yd=function(i){var n=i.findIndex;return i===qI||i instanceof Array&&n===qI.findIndex?NN:n};let JI=(i,n)=>{let s=null;if(n==="h264"?s=i.match(/a=rtpmap:(\d+) H264.*\r\n/)||i.match(/a=rtpmap:(\d+) H264.*\n/):n==="vp8"?s=i.match(/a=rtpmap:(\d+) VP8.*\r\n/)||i.match(/a=rtpmap:(\d+) VP8.*\n/):n==="vp9"?s=i.match(/a=rtpmap:(\d+) VP9.*\r\n/)||i.match(/a=rtpmap:(\d+) VP9.*\n/):n==="av1"&&(s=i.match(/a=rtpmap:(\d+) AV1.*\r\n/)||i.match(/a=rtpmap:(\d+) AV1.*\n/)),s&&s[1])return s[1]};class zI extends GI{constructor(n,s,c,u){super(s,s.stringUid||s.uid);this.suspendTracks=[],this.type="pub",this._waitingSuccessResponse=this.detecting=!1,this.handleMuteVideoTrack=({muted:h},f,A)=>{this.setVideoTrackMuteState(h).then(f).catch(A)},this.handleMuteAudioTrack=({track:h,muted:f},A,m)=>{this.setAudioTrackMuteState(f,h).then(A).catch(m)},this.renegotiateWithGateway=async()=>(R.debug("[pc-".concat(this.pc.ID,"] renegotiate start")),new se(async(h,f)=>{this.connectionState="connecting";let A=E=>{E==="connected"&&(this.off(ke.CONNECTION_STATE_CHANGE,A),h()),E==="disconnected"&&(this.off(ke.CONNECTION_STATE_CHANGE,A),f(new L(D.OPERATION_ABORTED,"renegotiate abort")))};this.on(ke.CONNECTION_STATE_CHANGE,A),Or()&&te.SIMULCAST&&this.videoTrack&&this.videoTrack._scalabiltyMode&&await this.addSimulcast4Firefox(this.videoTrack._scalabiltyMode);var m=await this.pc.createOfferSDP();this.audioTrack&&this.audioTrack._encoderConfig&&(m=zh(m,this.audioTrack._encoderConfig)),this.videoTrack&&this.videoTrack._scalabiltyMode&&(this.codec!=="vp9"&&this.codec!=="vp8"?(this.videoTrack._scalabiltyMode.numSpatialLayers=1,this.videoTrack._scalabiltyMode.numTemporalLayers=1):(1<this.videoTrack._scalabiltyMode.numSpatialLayers||1<this.videoTrack._scalabiltyMode.numTemporalLayers)&&(m=Gm(m,this.codec,this.videoTrack._scalabiltyMode)),R.debug("renegoation spatial layers: ",this.videoTrack._scalabiltyMode.numSpatialLayers)),await this.pc.setOfferSDP(m),this.audioTrack instanceof un&&this.pc.onOfferSettled({videoActive:this.videoTrack&&!this.videoTrack.muted,audioActive:this.audioTrack&&this.audioTrack.isActive});let I=await br(this,ke.NEED_RENEGOTIATE,m);this.videoTrack&&!Or()&&te.SIMULCAST&&this.videoTrack._scalabiltyMode&&this.setSimulcastVideoRtpEncodingParameters(this.videoTrack._scalabiltyMode),m=function(E,_){var S,N,O;const B=fr(S=RegExp.prototype.test).call(S,/^([a-z])=(.*)/);E=Qe(N=E.split(/(\r\n|\r|\n)/)).call(N,B),_=Qe(O=_.split(/(\r\n|\r|\n)/)).call(O,B);let P=null;const J=new Tt;return K(E).call(E,ne=>{const Ae=ne.match(/m=(audio|video)/);if(Ae&&Ae[1])return void(P=Ae[1]);P&&(ne=ne.match(/=(sendrecv|recvonly|sendonly|inactive)/))&&ne[1]&&J.set(P,ne[1])}),P=null,Ie(_).call(_,ne=>{var Ae=ne.match(/m=(audio|video)/);if(Ae&&Ae[1])return P=Ae[1],ne;if(!P)return ne;if((Ae=ne.match(/=(sendrecv|recvonly|sendonly|inactive)/))&&Ae[1]){const Me=J.get(P);if(Me&&Me!==Ae[1])return ne.replace(Ae[1],Me)}return ne}).join(`\r
`)+`\r
`}(m,this.updateAnswerSDP(I.sdp)),await this.pc.setAnswerSDP(m),R.debug("[pc-".concat(this.pc.ID,"] renegotiate success")),this.connectionState="connected"})),this.handleStreamRenegotiate=(h,f)=>{this.connectionState==="connected"?this.renegotiateWithGateway().then(h).catch(f):h()},this.handleReplaceTrack=(h,f,A)=>{if(this.audioTrack instanceof un&&h.kind==="audio")return f();this.pc.replaceTrack(h).then(m=>m?this.renegotiateWithGateway():se.resolve()).then(f).catch(A)},this.handleCloseAudioTrack=h=>{},this.handleCloseVideoTrack=()=>{this.lowStreamConnection&&this.lowStreamConnection.videoTrack&&this.lowStreamConnection.videoTrack.close()},this.handleGetSessionID=h=>{h(this.joinInfo.sid)},this.handleGetLocalVideoStats=h=>{h(this.statsCollector.getLocalVideoTrackStats(this.connectionId))},this.handleGetLocalAudioStats=h=>{h(this.statsCollector.getLocalAudioTrackStats(this.connectionId))},this.handleSetOptimizationMode=(h,f,A)=>{this.videoTrack&&this.setRtpSenderParametersByTrackConfig(this.videoTrack).then(f).catch(A)},this.isLowStreamConnection=!!u,this.codec=c,this.statsCollector=n,this.statsCollector.addLocalConnection(this)}getAllTracks(){let n=[];return this.videoTrack&&n.push(this.videoTrack),this.audioTrack&&this.audioTrack instanceof un?n=b(n).call(n,this.audioTrack.trackList):this.audioTrack&&n.push(this.audioTrack),n.push(...this.suspendTracks),n}async addTracks(n){let s=Pt;if(this.connectionState==="connecting")try{return await this.createWaitConnectionConnectedPromise(),await this.addTracks(n)}catch{throw new L(D.OPERATION_ABORTED,"publish abort")}var c=!1;let u=this.getAllTracks();n=wm(n=Qe(n).call(n,f=>Ke(u).call(u,f)===-1));for(let f=0;f<n.length;f+=1){var h=n[f];if(!(h instanceof cd))return new L(D.INVALID_LOCAL_TRACK).throw();if(h instanceof Jt&&this.disabledVideoTrack){if(this.disabledVideoTrack!==h)return new L(D.EXIST_DISABLED_VIDEO_TRACK).throw();this.disabledVideoTrack=void 0}if(h instanceof Jt&&this.videoTrack)return new L(D.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw();if(h instanceof Lr){if(this.audioTrack&&this.audioTrack._bypassWebAudio)throw R.error("One of the audio track was created with config bypassWebAudio set to true, there is no way to publish multiple audio tracks."),new L(D.CAN_NOT_PUBLISH_MULTIPLE_AUDIO_TRACKS);if(this.audioTrack instanceof un)this.audioTrack.trackList.length===0&&await this.pc.setAudioRtpEncodingParameters({active:!0}),this.audioTrack.addAudioTrack(h);else if(s.webAudioMediaStreamDest)if(h._bypassWebAudio){if(this.audioTrack)throw R.error("Can not publish another audio track with bypassWebAudio set to true."),new L(D.CAN_NOT_PUBLISH_MULTIPLE_AUDIO_TRACKS);R.debug("[".concat(this.connectionId,"] audio track doesn't not pass through WebAudio, use original audio track to publish")),c=await this.addTrackWithPC(h)}else c=new un,h.muted?this.suspendTracks.push(h):c.addAudioTrack(h),c=await this.addTrackWithPC(c);else R.debug("[".concat(this.connectionId,"] your browser does not support mixing track, use original audio track to publish")),c=await this.addTrackWithPC(h)}else h instanceof Jt&&this.isLowStreamConnection?(c=Hm({},{width:160,height:120,framerate:15,bitrate:50},{},this.lowStreamParameter),s.supportDualStreamEncoding?(R.debug("[".concat(this.connectionId,"] creating low stream using rtp encoding.")),this.lowStreamEncoding=mT(c,h),h=h.clone({bitrateMax:c.bitrate,bitrateMin:c.bitrate})):(R.debug("[".concat(this.connectionId,"] creating low stream using canvas.")),h=RT(h,c),h=new Jt(h,{bitrateMax:c.bitrate,bitrateMin:c.bitrate})),h._hints.push(no.LOW_STREAM),c=await this.addTrackWithPC(h),this.bindTrackEvents(h)):(this.detecting=!0,gi(()=>{this.detecting=!1},8e3),c=await this.addTrackWithPC(h))}await this.updateControlMessage(),c&&await this.renegotiateWithGateway(),K(n).call(n,f=>this.bindTrackEvents(f))}async removeTracks(n,s){let c=this.getAllTracks();n=wm(n=Qe(n).call(n,f=>Ke(c).call(c,f)!==-1||f===this.disabledVideoTrack));let u=[];for(let f=0;f<n.length;f+=1){let A=n[f];if(this.unbindTrackEvents(A),this.audioTrack instanceof un&&A instanceof Lr)this.audioTrack.removeAudioTrack(A),Js(this.suspendTracks,A),this.audioTrack.trackList.length===0&&(u.push(this.audioTrack),this.audioTrack=void 0);else if(A instanceof Lr)u.push(A),this.audioTrack=void 0;else if(A instanceof Jt){if(s){if(this.disabledVideoTrack===A)return void(this.disabledVideoTrack=void 0)}else this.disabledVideoTrack=this.videoTrack;u.push(A),this.isLowStreamConnection&&A.close(),this.videoTrack=void 0}}if(this.videoTrack||this.audioTrack){if(u.length!==0){if(this.connectionState==="connecting")try{await this.createWaitConnectionConnectedPromise()}catch{return}for(let f of u){var h;R.debug(b(h="[".concat(this.connectionId,"] remove ")).call(h,f.trackMediaType," from pc")),await this.pc.removeTrack(f._mediaStreamTrack),n=Je(),n.name==="Safari"&&n.version==="11"&&await f.renewMediaStreamTrack()}await this.renegotiateWithGateway()}}else await this.closeP2PConnection()}async updateControlMessage(){this.audioTrack instanceof un&&this.connectionState==="connected"&&(this.audioTrack&&await br(this,ke.NEED_CONTROL,{type:"audio",muted:!this.audioTrack.isActive}),this.videoTrack&&await br(this,ke.NEED_CONTROL,{type:"video",muted:this.videoTrack.muted}))}async setSimulcastVideoRtpEncodingParameters(n){let s=this.pc.getSender("video");if(!s)throw new L(D.LOW_STREAM_ENCODING_ERROR,"Low stream has no video sender.");let c=s.getParameters();if(!c.encodings||!c.encodings[0])throw new L(D.LOW_STREAM_ENCODING_ERROR,"Low stream RtpEncodingParameters is empty.");this.videoTrack&&this.videoTrack._encoderConfig&&this.videoTrack._encoderConfig.bitrateMax&&200<this.videoTrack._encoderConfig.bitrateMax&&1<n.numSpatialLayers&&(c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:1e3*(this.videoTrack._encoderConfig.bitrateMax-50)},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:5e4,scaleResolutionDownBy:4}]),await s.setParameters(c)}startP2PConnection(){return new se(async(n,s)=>{if(!this.audioTrack&&!this.videoTrack)return s(new L(D.UNEXPECTED_ERROR,"no track to publish"));let c=h=>{if(h==="connected"&&(this.off(ke.CONNECTION_STATE_CHANGE,c),n()),h==="disconnected"){if(this.off(ke.CONNECTION_STATE_CHANGE,c),this.disconnectedReason)return s(this.disconnectedReason);s(new L(D.OPERATION_ABORTED,"publish abort"))}};this.on(ke.CONNECTION_STATE_CHANGE,c),this.disconnectedReason=void 0,this.connectionState="connecting",this._waitingSuccessResponse=!0,this.startTime=le();try{var u;!this.pc.audioTrack&&this.audioTrack&&await this.pc.addTrack(this.audioTrack._mediaStreamTrack),!this.pc.videoTrack&&this.videoTrack&&await this.pc.addTrack(this.videoTrack._mediaStreamTrack),Or()&&te.SIMULCAST&&this.videoTrack&&this.videoTrack._scalabiltyMode&&await this.addSimulcast4Firefox(this.videoTrack._scalabiltyMode);let h=await this.pc.createOfferSDP();te.REMOVE_NEW_CODECS&&(h=this.codec==="vp9"?Xh(h,["av1"]):this.codec==="av1"?Xh(h,["vp9"]):Xh(h,["vp9","av1"]));let f=Fm(h);this.videoTrack&&!vt(u=f.video).call(u,this.codec.toUpperCase())&&R.warning("current codec is not supported, support list: ".concat(f.video.join(","))),this.audioTrack&&this.audioTrack._encoderConfig&&(h=zh(h,this.audioTrack._encoderConfig)),this.videoTrack&&!Or()&&this.videoTrack._scalabiltyMode&&(this.codec!=="vp9"&&this.codec!=="vp8"?(this.videoTrack._scalabiltyMode.numSpatialLayers=1,this.videoTrack._scalabiltyMode.numTemporalLayers=1):(1<this.videoTrack._scalabiltyMode.numSpatialLayers||1<this.videoTrack._scalabiltyMode.numTemporalLayers)&&(h=Gm(h,this.codec,this.videoTrack._scalabiltyMode)),R.debug("spatial layers: ",this.videoTrack._scalabiltyMode.numSpatialLayers)),await this.pc.setOfferSDP(h),this.audioTrack instanceof un&&this.pc.onOfferSettled({videoActive:this.videoTrack&&!this.videoTrack.muted,audioActive:this.audioTrack&&this.audioTrack.isActive}),this.videoTrack&&this.setRtpSenderParametersByTrackConfig(this.videoTrack),R.debug("[".concat(this.connectionId,"] create and set offer success")),u={messageType:"OFFER",sdp:h,offererSessionId:104,retry:!0},Pt.supportDualStreamEncoding&&this.isLowStreamConnection&&this.lowStreamEncoding&&this.videoTrack&&await this.setLowStreamEncoding(this.lowStreamEncoding,this.videoTrack),this.videoTrack&&!Or()&&te.SIMULCAST&&this.videoTrack._scalabiltyMode&&this.setSimulcastVideoRtpEncodingParameters(this.videoTrack._scalabiltyMode);let A=await br(this,ke.NEED_ANSWER,u),m=this.updateAnswerSDP(A.sdp);await this.pc.setAnswerSDP(m),R.debug("[".concat(this.connectionId,"] set answer success")),await this.icePromise,this.connectionState="connected",this.startUploadStats()}catch(h){this.off(ke.CONNECTION_STATE_CHANGE,c),this.connectionState="disconnected",this.reportPublishEvent(!1,h.code),R.error("[".concat(this.connectionId,"] connection error"),h.toString()),s(h)}})}reportPublishEvent(n,s,c){var u;this._waitingSuccessResponse=!1,z.publish(this.joinInfo.sid,{lts:this.startTime,succ:n,ec:s,audioName:this.audioTrack&&(this.audioTrack instanceof un?this.audioTrack.getSubTrackLabels().join(","):this.audioTrack.getTrackLabel()),videoName:this.videoTrack&&this.videoTrack.getTrackLabel(),screenshare:!(!this.videoTrack||Ke(u=this.videoTrack._hints).call(u,no.SCREEN_TRACK)===-1),audio:!!this.audioTrack,video:!!this.videoTrack,p2pid:this.pc.ID,publishRequestid:this.ID,extend:c})}async closeP2PConnection(n){let s=this.getAllTracks();var c;K(s).call(s,u=>{this.unbindTrackEvents(u)}),this.isLowStreamConnection&&this.videoTrack&&this.videoTrack.close(),this.videoTrack=void 0,this.audioTrack instanceof un&&(K(c=this.audioTrack.trackList).call(c,u=>{this.audioTrack.removeAudioTrack(u)}),this.audioTrack.close()),this.audioTrack=void 0,this.stopUploadStats(),this.statsCollector.removeConnection(this.connectionId),await this.closePC(n),this.connectionState="disconnected",this.removeAllListeners()}getNetworkQuality(){var n,s=this.pc.getStats();if(!s.videoSend[0]&&!s.audioSend[0])return 1;var c=qs(this,ke.NEED_SIGNAL_RTT),u=s.videoSend[0]?s.videoSend[0].rttMs:void 0;let h=s.audioSend[0]?s.audioSend[0].rttMs:void 0;return u=u&&h?(u+h)/2:u||h,c=70*s.sendPacketLossRate/50+.3*((u&&c?(u+c)/2:u||c)||0)/1500,c=.17>c?1:.36>c?2:.59>c?3:.1>c?4:5,this.videoTrack&&this.videoTrack._encoderConfig&&Ke(n=this.videoTrack._hints).call(n,no.SCREEN_TRACK)===-1&&(n=this.videoTrack._encoderConfig.bitrateMax,s=s.bitrate.actualEncoded,n&&s)?(s=(1e3*n-s)/(1e3*n),LR[.15>s?0:.3>s?1:.45>s?2:.6>s?3:4][c]):c}handleUpdateBitrateLimit(n){this.videoTrack&&this.videoTrack.setBitrateLimit(n)}async setAudioTrackMuteState(n,s){if(!(this.audioTrack instanceof un))return void R.debug("[".concat(this.connectionId,"] set audio mute in unsupported environment"));let c=this.audioTrack;try{if(n){var u;c.removeAudioTrack(s),c.trackList.length===0&&(R.debug(b(u="[".concat(this.connectionId,"] set audio encoding active, id: ")).call(u,s.getTrackId(),", state: ",!1)),await this.pc.setAudioRtpEncodingParameters({active:!1})),this.suspendTracks.push(s)}else await this.pc.setAudioRtpEncodingParameters({active:!0}),c.addAudioTrack(s),Js(this.suspendTracks,s)}catch(f){var h;R.warning(b(h="[".concat(this.connectionId,"] set audio muted error ")).call(h,f,", fallback to set enabled"))}await br(this,ke.NEED_CONTROL,{type:"audio",muted:!(!this.audioTrack||this.audioTrack.isActive)})}async setVideoTrackMuteState(n){let s=!n,c=!1;if(Je().name===$e.FIREFOX)c=!0;else try{var u,h;R.debug(b(u=b(h="[".concat(this.connectionId,"] set video encoding active, id: ")).call(h,this.videoTrack&&this.videoTrack.getTrackId(),", state: ")).call(u,s)),await this.pc.setVideoRtpEncodingParameters({active:s})}catch(I){var f;R.warning(b(f="[".concat(this.connectionId,"] set video encoding active error ")).call(f,I,", fallback to set enabled")),c=!0}var A,m;c&&this.videoTrack&&(R.debug(b(A=b(m="[".concat(this.connectionId,"] set video encoding active fallback to enabled on firefox, type: ")).call(m,this.videoTrack&&this.videoTrack.getTrackId(),", state: ")).call(A,s)),this.videoTrack.getMediaStreamTrack().enabled=s),this.lowStreamConnection&&this.lowStreamConnection.setVideoTrackMuteState(n),!this.isLowStreamConnection&&await br(this,ke.NEED_CONTROL,{type:"video",muted:n})}uploadStats(n,s){let c=this.audioTrack?function(A,m){const I=A.audioSend[0];return I?(A={id:or(10,""),timestamp:new Date(A.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:I.ssrc.toString()},A.A_astd=m._originMediaStreamTrack.enabled&&m._mediaStreamTrack.enabled?"0":"1",I.inputLevel?A.A_ail=Math.round(100*I.inputLevel).toString():A.A_ail=Math.round(100*m._source.getAccurateVolumeLevel()).toString(),A.A_apil=Math.round(100*m._source.getAccurateVolumeLevel()).toString(),A):null}(n,this.audioTrack):void 0,u=this.videoTrack?function(A,m){const I=A.videoSend[0];if(!I)return null;switch(A={id:or(10,""),timestamp:new Date(A.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:I.ssrc.toString()},A.A_vstd=m._originMediaStreamTrack&&!m._originMediaStreamTrack.enabled||!m._mediaStreamTrack.enabled?"1":"0",I.sentFrame&&(A.A_fhs=I.sentFrame.height.toString(),A.A_frs=I.sentFrame.frameRate.toString(),A.A_fws=I.sentFrame.width.toString()),I.adaptionChangeReason){case"none":A.A_ac="0";break;case"cpu":A.A_ac="1";break;case"bandwidth":A.A_ac="2";break;case"other":A.A_ac="3"}return A.A_nr=I.nacksCount.toString(),I.avgEncodeMs&&(A.A_aem=I.avgEncodeMs.toFixed(0).toString()),A}(n,this.videoTrack):void 0,h=_m(n,s),f=function(A){const m={id:"bweforvideo",timestamp:new Date(A.timestamp).toISOString(),type:"VideoBwe"};return A.bitrate.retransmit&&(m.A_rb=A.bitrate.retransmit.toString()),A.bitrate.targetEncoded&&(m.A_teb=A.bitrate.targetEncoded.toString()),m.A_aeb=A.bitrate.actualEncoded.toString(),m.A_tb=A.bitrate.transmit.toString(),A.sendBandwidth!==void 0&&(m.A_asb=A.sendBandwidth.toString()),m}(n);c&&pi(()=>this.emit(ke.NEED_UPLOAD,xi.PUBLISH_STATS,c)),u&&pi(()=>this.emit(ke.NEED_UPLOAD,xi.PUBLISH_STATS,Hm({},u,{},h))),f&&pi(()=>this.emit(ke.NEED_UPLOAD,xi.PUBLISH_STATS,f))}uploadSlowStats(n){let s=_m(n);s&&pi(()=>this.emit(ke.NEED_UPLOAD,xi.PUBLISH_STATS,s))}uploadRelatedStats(n){let s=function(c){return(c=c.videoSend[0])?{mediaType:"video",isVideoMute:!1,frameRateInput:c.inputFrame&&c.inputFrame.frameRate.toString(),frameRateSent:c.sentFrame&&c.sentFrame.frameRate.toString(),googRtt:c.rttMs.toString()}:null}(n);s&&(s.isVideoMute=!(!this.videoTrack||!this.videoTrack.muted),pi(()=>{this.emit(ke.NEED_UPLOAD,xi.PUBLISH_RELATED_STATS,s)}))}async addSimulcast4Firefox(n){if(Or()&&this.videoTrack&&this.videoTrack._encoderConfig&&this.videoTrack._encoderConfig.bitrateMax&&200<this.videoTrack._encoderConfig.bitrateMax&&1<n.numSpatialLayers&&this.codec==="vp8"&&(n=this.pc.getSender("video"))){let s=n.getParameters();R.debug("getParameters : ",s),s||R.error("[".concat(this.connectionId,"] get sender parameter error.")),s.encodings=[{rid:"m",active:!0,maxBitrate:5e4,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:1e3*(this.videoTrack._encoderConfig.bitrateMax-50)}],await n.setParameters(s),R.debug("setParameters : ",s)}}bindTrackEvents(n){var s;n.addListener(Be.NEED_RESET_REMOTE_SDP,fr(s=this.handleResetRemoteSdp).call(s,this)),this.isLowStreamConnection||(n instanceof Lr?(n.addListener(Be.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Be.NEED_CLOSE,this.handleCloseAudioTrack),n.addListener(Be.SET_AUDIO_TRACK_MUTED,this.handleMuteAudioTrack)):n instanceof Jt&&(n.addListener(Be.GET_STATS,this.handleGetLocalVideoStats),n.addListener(Be.NEED_CLOSE,this.handleCloseVideoTrack),n.addListener(Be.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),n.addListener(Be.SET_VIDEO_TRACK_MUTED,this.handleMuteVideoTrack)),n.addListener(Be.NEED_RENEGOTIATE,this.handleStreamRenegotiate),n.addListener(Be.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Be.NEED_SESSION_ID,this.handleGetSessionID))}unbindTrackEvents(n){this.isLowStreamConnection||(n instanceof Lr?(n.off(Be.GET_STATS,this.handleGetLocalAudioStats),n.off(Be.NEED_CLOSE,this.handleCloseAudioTrack),n.off(Be.SET_AUDIO_TRACK_MUTED,this.handleMuteAudioTrack)):n instanceof Jt&&(n.off(Be.GET_STATS,this.handleGetLocalVideoStats),n.off(Be.NEED_CLOSE,this.handleCloseVideoTrack),n.off(Be.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),n.off(Be.SET_VIDEO_TRACK_MUTED,this.handleMuteVideoTrack)),n.off(Be.NEED_RENEGOTIATE,this.handleStreamRenegotiate),n.off(Be.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Be.NEED_SESSION_ID,this.handleGetSessionID))}async addTrackWithPC(n){if(this.connectionState==="connecting")return new L(D.INVALID_OPERATION,"last publish operation has not finished").throw();let s=this.videoTrack,c=!1;return this.audioTrack&&n instanceof un?(this.audioTrack=n,R.debug("[".concat(this.connectionId,"] replace pc audio track")),c=await this.pc.replaceTrack(n._mediaStreamTrack)):this.videoTrack&&n instanceof Jt?(this.videoTrack=n,R.debug("[".concat(this.connectionId,"] replace pc video track")),c=await this.pc.replaceTrack(n._mediaStreamTrack)):n instanceof Lr?(this.audioTrack=n,R.debug("[".concat(this.connectionId,"] add audio track to pc")),await this.pc.addTrack(n._mediaStreamTrack),c=!0):n instanceof Jt&&(this.videoTrack=n,R.debug("[".concat(this.connectionId,"] add video track to pc")),await this.pc.addTrack(n._mediaStreamTrack),c=!0),this.connectionState==="connected"&&this.videoTrack!==s&&this.videoTrack&&await this.setRtpSenderParametersByTrackConfig(this.videoTrack),this.connectionState!=="disconnected"&&c}handleResetRemoteSdp(){return new se((n,s)=>{var c;R.info("[pc-".concat(this.pc.ID,"] start reset remote sdp"));let u=this.pc.getOfferSDP();var h=this.pc.getAnswerSDP();if(!h||!u)return n();h=h.sdp;let f;this.videoTrack&&this.videoTrack._encoderConfig&&Ke(c=this.videoTrack._hints).call(c,no.SCREEN_TRACK)===-1&&(f=function(A,m){var I,E;let _=m.bitrateMin;m=m.bitrateMax;let S=fr(I=RegExp.prototype.test).call(I,/^([a-z])=(.*)/);if(A=Qe(E=A.split(/(\r\n|\r|\n)/)).call(E,S),m){let O="AS";Je().name===$e.FIREFOX&&(m=1e3*(m>>>0),O="TIAS"),E=yd(A).call(A,B=>vt(B).call(B,O));var N;0<E&&(A[E]=b(N="b=".concat(O,":")).call(N,m))}return _&&(N=yd(A).call(A,O=>vt(O).call(O,"x-google-min-bitrate")),0<N&&(A[N]=A[N].replace(/x-google-min-bitrate=(.*)/,"x-google-min-bitrate=".concat(_)))),A.join(`\r
`)+`\r
`}(h,this.videoTrack._encoderConfig)),h!==f?this.pc.setOfferSDP(u.sdp).then(()=>{if(f)return this.pc.setAnswerSDP(f)}).then(n).catch(A=>{var m;R.error(b(m="[pc-".concat(this.pc.ID,"] reset remote sdp error, ")).call(m,A)),s(A)}):R.debug("[pc-".concat(this.pc.ID,"] remote sdp have no not changed"))})}async setRtpSenderParametersByTrackConfig(n){if(!Pt.supportSetRtpSenderParameters)return void R.debug("[".concat(this.connectionId,"] do not support set pc rtp sender, skip"));let s={},c="balanced";n._optimizationMode==="motion"?c="maintain-framerate":n._optimizationMode==="detail"&&(c="maintain-resolution"),R.debug("[".concat(this.connectionId,"] set pc rtp sender"),s,c),await this.pc.setRtpSenderParameters(s,c)}updateAnswerSDP(n){var s,c;return n=n.replace(/a=x-google-flag:conference\r\n/g,""),this.videoTrack&&Ke(s=this.videoTrack._hints).call(s,no.SCREEN_TRACK),this.videoTrack&&this.videoTrack._encoderConfig&&Ke(c=this.videoTrack._hints).call(c,no.SCREEN_TRACK)===-1&&(n=function(u,h,f){let A=Pt;var m=f.bitrateMin;f=f.bitrateMax;let I=u.match(/m=video.*\r\n/)||u.match(/m=video.*\n/);if(I&&0<I.length&&A.supportMinBitrate&&m&&(h=JI(u,h)))if(te.SIMULCAST){var E,_;m=f?.7*f:300,u=u.replace(I[0],b(E=b(_="".concat(I[0],"a=fmtp:")).call(_,h," x-google-start-bitrate=")).call(E,m,`\r
`))}else{var S,N;u=u.replace(I[0],b(S=b(N="".concat(I[0],"a=fmtp:")).call(N,h," x-google-min-bitrate=")).call(S,m,`\r
`))}if(I&&0<I.length&&f){var O,B;E="AS",Je().name===$e.FIREFOX&&(f=1e3*(f>>>0),E="TIAS"),u=u.replace(I[0],b(O=b(B="".concat(I[0],"b=")).call(B,E,":")).call(O,f,`\r
`))}return u}(n,this.codec,this.videoTrack._encoderConfig)),this.audioTrack&&this.audioTrack._encoderConfig&&(n=zh(n,this.audioTrack._encoderConfig)),n=function(u){let h=Je();return h.name!==$e.SAFARI&&h.os!==ln.IOS?u:u.replace(/a=.*video-orientation\r\n/g,"")}(n)}createPC(){this.pc=new QI({turnServer:this.joinInfo.turnServer}),this.updateICEPromise()}async closePC(n){return this.pc.onICEConnectionStateChange=void 0,this.pc.close(),!n&&await br(this,ke.NEED_UNPUB)}onPCDisconnected(n){this.reportPublishEvent(!1,n.code)}async setLowStreamEncoding(n,s){try{let c=await this.pc.setVideoRtpEncodingParameters(n),u=s.getMediaStreamTrack();if(n.scaleResolutionDownBy&&c.encodings[0].scaleResolutionDownBy!==n.scaleResolutionDownBy){let h=s._videoHeight||u.getSettings().height,f=s._videoWidth||u.getSettings().width;h&&f&&await u.applyConstraints({height:h/n.scaleResolutionDownBy,width:f/n.scaleResolutionDownBy})}n.maxFramerate&&c.encodings[0].maxFramerate!==n.maxFramerate&&await u.applyConstraints({frameRate:n.maxFramerate})}catch(c){throw c instanceof L?c:new L(D.LOW_STREAM_ENCODING_ERROR,c.message)}}}class XI extends _1{constructor(n,s,c,u){var h,f;super(n,b(h=b(f="track-".concat(n.kind,"-")).call(f,s,"-")).call(h,u));this._isDestroyed=!1,this._userId=s,this._uintId=c}getUserId(){return this._userId}_updateOriginMediaStreamTrack(n){this._mediaStreamTrack=this._originMediaStreamTrack=n,this._updatePlayerSource()}_destroy(){this._isDestroyed=!0,R.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}}class Tl extends XI{constructor(n,s,c,u){super(n,s,c,u);this.trackMediaType="video",this.updateMediaStreamTrackResolution()}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Hr.PLAYING)}getStats(){return Jc(()=>{R.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),qs(this,Be.GET_STATS)||$h({},Vp)}play(n,s={}){let c=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.REMOTE_VIDEO_TRACK_PLAY,options:[this.getTrackId(),typeof n=="string"?n:"HTMLElement",s]});if(typeof n=="string"){let h=document.getElementById(n);var u;h?n=h:(R.warning(b(u="[".concat(this.getTrackId(),'] can not find "#')).call(u,n,'" element, use document.body')),n=document.body)}R.debug("[".concat(this.getTrackId(),"] start video playback"),fe(s)),n=$h({fit:"cover"},s,{trackId:this.getTrackId(),element:n}),this._player?this._player.updateConfig(n):(this._player=new jI(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.emit(hl.FIRST_FRAME_DECODED)}),this._player.play(),c.onSuccess()}stop(){let n=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.REMOTE_VIDEO_TRACK_STOP,options:[this.getTrackId()]});if(!this._player)return n.onSuccess();this._player.destroy(),this._player=void 0,R.debug("[".concat(this.getTrackId(),"] stop video playback")),n.onSuccess()}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){Rm(this._originMediaStreamTrack).then(([n,s])=>{this._videoHeight=s,this._videoWidth=n}).catch(ud)}_updatePlayerSource(){R.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}}class Rl extends XI{constructor(n,s,c,u){super(n,s,c,u);this.trackMediaType="audio",this._useAudioElement=!0,this._volume=100,this._source=new R1(n,!0),this._source.once(Qi.RECEIVE_TRACK_BUFFER,()=>{this.emit(hl.FIRST_FRAME_DECODED)})}get isPlaying(){return this._useAudioElement?vi.isPlaying(this.getTrackId()):this._source.isPlayed}setAudioFrameCallback(n,s=4096){if(!n)return this._source.removeAllListeners(Qi.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(s),this._source.removeAllListeners(Qi.ON_AUDIO_BUFFER),this._source.on(Qi.ON_AUDIO_BUFFER,c=>n(c))}setVolume(n){let s=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.REMOTE_AUDIO_SET_VOLUME,options:[this.getTrackId(),n]},300);this._volume=n,this._useAudioElement?vi.setVolume(this.getTrackId(),n):this._source.setVolume(n/100),s.onSuccess()}async setPlaybackDevice(n){let s=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.REMOTE_AUDIO_SET_OUTPUT_DEVICE,options:[this.getTrackId(),n]});if(!this._useAudioElement)throw new L(D.NOT_SUPPORTED,"your browser does not support setting the audio output device");try{await vi.setSinkID(this.getTrackId(),n)}catch(c){throw s.onError(c),c}s.onSuccess()}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Jc(()=>{R.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),qs(this,Be.GET_STATS)||$h({},Fp)}play(){let n=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.REMOTE_AUDIO_TRACK_PLAY,options:[this.getTrackId()]});R.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(R.debug("[".concat(this.getTrackId(),"] use audio element to play")),vi.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play(),n.onSuccess()}stop(){let n=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.REMOTE_AUDIO_TRACK_STOP,options:[this.getTrackId()]});R.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?vi.stop(this.getTrackId()):this._source.stop(),n.onSuccess()}_destroy(){super._destroy(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){R.debug("[".concat(this.getTrackId(),"] update player source track")),this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&vi.updateTrack(this.getTrackId(),this._mediaStreamTrack)}}class ON extends GI{constructor(n,s,c,u){super(c,n.uid);this.type="sub",this.unusedTracks=[],this.onTrack=h=>{var f,A;if(h.kind==="audio"&&!this.subscribeOptions.audio||h.kind==="video"&&!this.subscribeOptions.video)return this.unusedTracks.push(h),void R.debug(b(A="[".concat(this.connectionId,"] unused ontrack event, kind: ")).call(A,h.kind));R.debug(b(f="[".concat(this.connectionId,"] emit pc ontrack after subscribe ")).call(f,h.kind),h),f=h.kind==="audio"?this.user._audioTrack:this.user._videoTrack;var m,I;f?f._updateOriginMediaStreamTrack(h):h.kind==="audio"?(this.pc._statsFilter.setIsFirstAudioDecoded(!1),this.user._audioTrack=new Rl(h,this.getUserId(),this.user._uintid,this.joinInfo.clientId),R.info(b(m="[".concat(this.connectionId,"] create remote audio track: ")).call(m,this.user._audioTrack.getTrackId())),this.bindTrackEvents(this.user._audioTrack)):(this.user._videoTrack=new Tl(h,this.getUserId(),this.user._uintid,this.joinInfo.clientId),R.info(b(I="[".concat(this.connectionId,"] create remote video track: ")).call(I,this.user._videoTrack.getTrackId())),this.bindTrackEvents(this.user._videoTrack))},this.handleGetRemoteAudioStats=h=>{h(this.statsCollector.getRemoteAudioTrackStats(this.connectionId))},this.handleGetRemoteVideoStats=h=>{h(this.statsCollector.getRemoteVideoTrackStats(this.connectionId))},this.handleGetSessionID=h=>{h(this.joinInfo.sid)},this.user=n,this.statsCollector=s,this.statsCollector.addRemoteConnection(this),this.subscribeOptions=u}async startP2PConnection(){return new se(async(n,s)=>{let c=m=>{if(m==="connected"&&(z.subscribe(this.joinInfo.sid,{lts:this.startTime,succ:!0,video:this.subscribeOptions.video,audio:this.subscribeOptions.audio,peerid:this.user.uid,ec:null,subscribeRequestid:this.ID,p2pid:this.pc.ID}),this.off(ke.CONNECTION_STATE_CHANGE,c),n()),m==="disconnected"){if(this.off(ke.CONNECTION_STATE_CHANGE,c),this.disconnectedReason)return s(this.disconnectedReason);s(new L(D.OPERATION_ABORTED,"subscribe abort"))}};if(this.on(ke.CONNECTION_STATE_CHANGE,c),this.disconnectedReason=void 0,this.connectionState="connecting",this.startTime=le(),!this.subscribeOptions)return void s(new L(D.UNEXPECTED_ERROR,"no subscribe options"));let u=new MediaStream,h=new se(m=>{this.pc.onTrack=(I,E)=>{var _,S;if(I.kind==="audio"&&!this.subscribeOptions.audio||I.kind==="video"&&!this.subscribeOptions.video)return this.unusedTracks.push(I),void R.debug(b(S="[".concat(this.connectionId,"] unused ontrack event ")).call(S,I.kind));u.addTrack(I),S={audio:0<u.getAudioTracks().length,video:0<u.getVideoTracks().length},R.debug(b(_="[".concat(this.connectionId,"] subscribe ontrack: ")).call(_,I.kind),E,I);e:{I=this.subscribeOptions;var N,O;for(E=ul(N=pt(S)).call(N),N=ul(O=pt(I)).call(O),O=0;O<E.length;O+=1){if(E[O]!==N[O]){S=!1;break e}if(S[E[O]]!==I[E[O]]){S=!1;break e}}S=!0}S&&(this.pc.onTrack=this.onTrack,R.debug("[".concat(this.connectionId,"] get all subscribed tracks")),m(u))}});try{let m=function(N){return Je().name!==$e.FIREFOX?N:N.replace("/recvonly http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"," http://www.webrtc.org/experiments/rtp-hdrext/playout-delay")}(Vm(await this.pc.createOfferSDP()));await this.pc.setOfferSDP(m),R.debug("[".concat(this.connectionId,"] create and set offer success"));let I=await br(this,ke.NEED_ANSWER,{messageType:"OFFER",sdp:m,offererSessionId:104,retry:!0});await this.pc.setAnswerSDP(Vm(I.sdp)),R.debug("[".concat(this.connectionId,"] set answer success"));let E=await se.all([h,this.icePromise]),_=E[0].getAudioTracks()[0],S=E[0].getVideoTracks()[0];var f,A;_&&(this.user._audioTrack?this.user._audioTrack._updateOriginMediaStreamTrack(_):(this.user._audioTrack=new Rl(_,this.getUserId(),this.user._uintid,this.joinInfo.clientId),R.info(b(f="[".concat(this.connectionId,"] create remote audio track: ")).call(f,this.user._audioTrack.getTrackId())),this.bindTrackEvents(this.user._audioTrack))),S&&(this.user._videoTrack?this.user._videoTrack._updateOriginMediaStreamTrack(S):(this.user._videoTrack=new Tl(S,this.getUserId(),this.user._uintid,this.joinInfo.clientId),R.info(b(A="[".concat(this.connectionId,"] create remote video track: ")).call(A,this.user._videoTrack.getTrackId())),this.bindTrackEvents(this.user._videoTrack))),this.connectionState="connected",this.startUploadStats()}catch(m){this.off(ke.CONNECTION_STATE_CHANGE,c),this.connectionState="disconnected",z.subscribe(this.joinInfo.sid,{lts:this.startTime,succ:!1,video:this.subscribeOptions.video,audio:this.subscribeOptions.audio,peerid:this.user.uid,ec:m.code,subscribeRequestid:this.ID,p2pid:this.pc.ID}),s(m)}})}async closeP2PConnection(n){this.connectionState!=="disconnected"&&(this.stopUploadStats(),this.statsCollector.removeConnection(this.connectionId),this.connectionState="disconnected",await this.setSubscribeOptions({audio:!1,video:!1}),await this.closePC(n),this.removeAllListeners())}getNetworkQuality(){var n=this.pc.getStats();if(!n.audioRecv[0]&&!n.videoRecv[0])return 1;var s=qs(this,ke.NEED_SIGNAL_RTT),c=n.rtt;s=(c&&s?(c+s)/2:c||s)||0,c=n.audioRecv[0]?n.audioRecv[0].jitterMs:void 0,n=n.recvPacketLossRate;let u=70*n/50+.3*s/1500;return c&&(u=60*n/50+.2*s/1500+.2*c/400),.1>u?1:.17>u?2:.36>u?3:.59>u?4:5}uploadStats(n){let s=this.user.audioTrack?function(u,h){const f=u.audioRecv[0];return f?(u={id:or(10,""),timestamp:new Date(u.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:f.ssrc.toString()},u.bytesReceived=f.bytes.toString(),u.packetsLost=f.packetsLost.toString(),u.packetsReceived=f.packets.toString(),f.outputLevel?u.A_aol=Math.round(100*f.outputLevel).toString():u.A_aol=Math.round(100*h._source.getAccurateVolumeLevel()).toString(),u.A_apol=Math.round(100*h._source.getAccurateVolumeLevel()).toString(),h&&(u.A_artd=h._originMediaStreamTrack.enabled&&h._mediaStreamTrack.enabled?"0":"1"),u.A_jr=f.jitterMs.toString(),u.A_jbm=Math.floor(f.jitterBufferMs).toString(),u.A_cdm=Math.floor(f.jitterBufferMs).toString(),u):null}(n,this.user.audioTrack):void 0,c=this.user.videoTrack?function(u,h){const f=u.videoRecv[0];if(!f)return null;u={id:or(10,""),timestamp:new Date(u.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:f.ssrc.toString()};var A;return u.bytesReceived=f.bytes.toString(),u.packetsLost=f.packetsLost.toString(),u.packetsReceived=f.packets.toString(),f.framesRateFirefox&&(u.A_frr=f.framesRateFirefox.toString()),f.receivedFrame&&(u.A_frr=f.receivedFrame.frameRate.toString()),u.A_frd=f.decodeFrameRate.toString(),f.outputFrame&&(u.A_fro=f.outputFrame.frameRate.toString()),f.jitterBufferMs!==void 0&&(u.A_jbm=Math.floor(f.jitterBufferMs).toString()),f.currentDelayMs!==void 0&&(u.A_cdm=Math.floor(f.currentDelayMs).toString()),u.A_fs=f.firsCount.toString(),u.A_ns=f.nacksCount.toString(),u.A_ps=f.plisCount.toString(),h&&(u.A_vrtd=h._originMediaStreamTrack.enabled&&h._mediaStreamTrack.enabled?"0":"1"),h._player&&0<h._player.freezeTimeCounterList.length&&(u.A_vrft=Jr(A=h._player.freezeTimeCounterList).call(A,0,1)[0].toString()),u}(n,this.user.videoTrack):void 0;s&&pi(()=>this.emit(ke.NEED_UPLOAD,xi.SUBSCRIBE_STATS,s)),c&&pi(()=>this.emit(ke.NEED_UPLOAD,xi.SUBSCRIBE_STATS,c))}uploadSlowStats(n){}uploadRelatedStats(n,s){let c=this.pc._statsFilter.videoIsReady===!0,u=function(f,A,m){return f=f.audioRecv[0],f?(m=ac.isRemoteAudioFreeze(m),{mediaType:"audio",isAudioMute:!1,peerId:A,googJitterReceived:f.jitterMs.toString(),isFreeze:m,bytesReceived:f.bytes.toString(),packetsReceived:f.packets.toString(),packetsLost:f.packetsLost.toString(),frameReceived:f.receivedFrames.toString(),frameDropped:f.droppedFrames.toString()}):null}(n,this.getUserId(),this.user.audioTrack),h=function(f,A,m,I,E){return A=A.videoRecv[0],A?(f=ac.isRemoteVideoFreeze(E,A,I?I.videoRecv[0]:void 0)&&f,m={mediaType:"video",isVideoMute:!1,peerId:m,frameRateReceived:A.receivedFrame&&A.receivedFrame.frameRate.toString(),frameRateDecoded:A.decodedFrame&&A.decodedFrame.frameRate.toString(),isFreeze:f,bytesReceived:A.bytes.toString(),packetsReceived:A.packets.toString(),packetsLost:A.packetsLost.toString()},A.framesRateFirefox&&(m.frameRateDecoded=A.framesRateFirefox.toString(),m.frameRateReceived=A.framesRateFirefox.toString()),m):null}(c,n,this.getUserId(),s,this.user.videoTrack);u&&pi(()=>{this.emit(ke.NEED_UPLOAD,xi.SUBSCRIBE_RELATED_STATS,u)}),h&&pi(()=>{this.emit(ke.NEED_UPLOAD,xi.SUBSCRIBE_RELATED_STATS,h)})}emitOnTrackFromUnusedTracks(){if(this.subscribeOptions){var n=this.subscribeOptions.video;if(this.subscribeOptions.audio){var s;let u=Xe(s=this.unusedTracks).call(s,h=>h.kind==="audio"&&h.readyState==="live");Js(this.unusedTracks,u),u&&this.onTrack(u)}if(n){var c;n=Xe(c=this.unusedTracks).call(c,u=>u.kind==="video"&&u.readyState==="live"),Js(this.unusedTracks,n),n&&this.onTrack(n)}}}async setSubscribeOptions(n){var s,c,u,h;if(n.audio!==this.subscribeOptions.audio||n.video!==this.subscribeOptions.video){if(this.connectionState==="connecting")try{await this.createWaitConnectionConnectedPromise()}catch{throw new L(D.OPERATION_ABORTED,"can not update subscribe options, operation abort")}n.audio===this.subscribeOptions.audio&&n.video===this.subscribeOptions.video||(R.debug(b(s=b(c=b(u=b(h="[".concat(this.connectionId,"] update subscribe options [a: ")).call(h,this.subscribeOptions.audio,", v: ")).call(u,this.subscribeOptions.video,"] -> [a: ")).call(c,n.audio,", v: ")).call(s,n.video,"]")),this.subscribeOptions=n,!n.audio&&this.user._audioTrack&&(this.unusedTracks.push(this.user._audioTrack._originMediaStreamTrack),this.user._audioTrack._destroy(),this.unbindTrackEvents(this.user._audioTrack),this.user._audioTrack=void 0),!n.video&&this.user._videoTrack&&(this.unusedTracks.push(this.user._videoTrack._originMediaStreamTrack),this.user._videoTrack._destroy(),this.unbindTrackEvents(this.user._videoTrack),this.user._videoTrack=void 0),this.emitOnTrackFromUnusedTracks())}}createPC(){this.pc=new UI({turnServer:this.joinInfo.turnServer}),this.pc.onFirstAudioDecoded=()=>{this.user.audioTrack&&this.user.audioTrack.emit(hl.FIRST_FRAME_DECODED),z.firstRemoteFrame(this.joinInfo.sid,zr.FIRST_AUDIO_DECODE,Zt.FIRST_AUDIO_DECODE,{peer:this.user._uintid,subscribeElapse:le()-this.startTime,subscribeRequestid:this.ID,p2pid:this.pc.ID})},this.pc.onFirstAudioReceived=()=>{z.firstRemoteFrame(this.joinInfo.sid,zr.FIRST_AUDIO_RECEIVED,Zt.FIRST_AUDIO_RECEIVED,{peer:this.user._uintid,subscribeElapse:le()-this.startTime,subscribeRequestid:this.ID,p2pid:this.pc.ID})},this.pc.onFirstVideoDecoded=(n,s)=>{z.firstRemoteFrame(this.joinInfo.sid,zr.FIRST_VIDEO_DECODE,Zt.FIRST_VIDEO_DECODE,{peer:this.user._uintid,videowidth:n,videoheight:s,subscribeElapse:le()-this.startTime,subscribeRequestid:this.ID,p2pid:this.pc.ID})},this.pc.onFirstVideoReceived=()=>{z.firstRemoteFrame(this.joinInfo.sid,zr.FIRST_VIDEO_RECEIVED,Zt.FIRST_VIDEO_RECEIVED,{peer:this.user._uintid,subscribeElapse:le()-this.startTime,subscribeRequestid:this.ID,p2pid:this.pc.ID})},this.updateICEPromise()}async closePC(n){return this.pc.audioTrack&&this.pc.audioTrack.stop(),this.pc.videoTrack&&this.pc.videoTrack.stop(),this.pc.onTrack=void 0,this.pc.onICEConnectionStateChange=void 0,this.pc.close(),n?!1:await br(this,ke.NEED_UNSUB)}onPCDisconnected(n){z.subscribe(this.joinInfo.sid,{lts:this.startTime,succ:!1,video:this.subscribeOptions.video,audio:this.subscribeOptions.audio,peerid:this.user.uid,ec:n.code,subscribeRequestid:this.ID,p2pid:this.pc.ID})}bindTrackEvents(n){n instanceof Rl?n.addListener(Be.GET_STATS,this.handleGetRemoteAudioStats):n instanceof Tl&&n.addListener(Be.GET_STATS,this.handleGetRemoteVideoStats)}unbindTrackEvents(n){n instanceof Rl?n.off(Be.GET_STATS,this.handleGetRemoteAudioStats):n instanceof Tl&&n.off(Be.GET_STATS,this.handleGetRemoteVideoStats)}}class kN extends Zr{constructor(n,s,c,u){super();this.reconnectMode="retry",this.commandReqId=this.reqId=0,this.handleWebSocketOpen=()=>{this.reconnectMode="retry",this.startPingPong()},this.handleWebSocketMessage=h=>{if(h.data){h=JSON.parse(h.data);var f;h.requestId?this.emit(b(f="@".concat(h.requestId,"-")).call(f,h.sid),h):this.serviceMode===nr.INJECT?this.emit(Ui.INJECT_STREAM_STATUS,h):(z.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===nr.TRANSCODE?1:2}),this.emit(Ui.PUBLISH_STREAM_STATUS,h))}},this.spec=s,this.token=n,this.serviceMode=u,this.websocket=new af("live-streaming",c),this.websocket.on(dt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(dt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(dt.REQUEST_NEW_URLS,(h,f)=>{br(this,Ui.REQUEST_NEW_ADDRESS).then(h).catch(f)}),this.websocket.on(dt.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(n){return this.websocket.init(n)}async request(n,s,c,u){this.reqId+=1,n==="request"&&(this.commandReqId+=1);let h=this.commandReqId,f=this.reqId;if(!f||!this.websocket)throw new L(D.UNEXPECTED_ERROR);var A=Zh({command:n,sdkVersion:ei==="4.7.2"?"0.0.1":ei,seq:f,requestId:f,allocate:c,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(le()/1e3)},s);if(this.websocket.state==="closed")throw new L(D.WS_DISCONNECT);let m=()=>new se((_,S)=>{this.websocket.once(dt.CLOSED,()=>S(new L(D.WS_ABORT))),this.websocket.once(dt.CONNECTED,_)});this.websocket.state!=="connected"&&await m(),A.clientRequest&&(A.clientRequest.workerToken=this.token);let I=new se((_,S)=>{var N;const O=()=>{S(new L(D.WS_ABORT))};this.websocket.once(dt.RECONNECTING,O),this.websocket.once(dt.CLOSED,O),this.once(b(N="@".concat(f,"-")).call(N,this.spec.sid),B=>{_(B)})});u&&z.workerEvent(this.spec.sid,Zh({},u,{requestId:h,actionType:"request",payload:fe(s.clientRequest),serverCode:0,code:0}));let E=le();this.websocket.sendMessage(A),A=null;try{A=await I}catch(_){if(this.websocket.state==="closed")throw _;return await m(),await this.request(n,s,c)}return u&&z.workerEvent(this.spec.sid,Zh({},u,{requestId:h,actionType:"response",payload:fe(A.serverResponse),serverCode:A.code,success:A.code===200,responseTime:le()-E})),A.code!==200&&this.handleResponseError(A),A}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){let n=ei==="4.7.2"?"0.0.1":ei;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:n,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(le()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(n){switch(n.code){case Ht.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void R.warning("live stream response already exists stream");case Ht.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Ht.LIVE_STREAM_RESPONSE_BAD_STREAM:case Ht.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new L(D.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:n.code}).throw();case Ht.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(n.serverResponse.command==="UnpublishStream"||n.serverResponse.command==="UninjectStream")break;throw new L(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Ht.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new L(D.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:n.code}).throw();case Ht.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:var s=new L(D.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Ui.WARNING,s,n.serverResponse.url);case Ht.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:return s=new L(D.LIVE_STREAMING_WARN_FREQUENT_REQUEST),this.emit(Ui.WARNING,s,n.serverResponse.url);case Ht.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new L(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Ht.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new L(D.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:n.code}).throw();case Ht.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:return s=new L(D.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT),this.emit(Ui.WARNING,s,n.serverResponse.url);case Ht.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new L(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:n.code}).throw();case Ht.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new L(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Ht.LIVE_STREAM_RESPONSE_WORKER_LOST:case Ht.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(n.serverResponse.command==="UnpublishStream"||n.serverResponse.command==="UninjectStream")break;throw new L(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Ht.ERROR_FAIL_SEND_MESSAGE:if(n.serverResponse.command==="UnpublishStream"||n.serverResponse.command==="UninjectStream")break;if(n.serverResponse.command==="UpdateTranscoding"||n.serverResponse.command==="ControlStream")return new L(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:n.code}).throw();throw new L(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Ht.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Ht.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Ht.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Ht.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new L(D.LIVE_STREAMING_CDN_ERROR,"",{code:n.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(ud)},6e3)}}class bN extends Zr{constructor(n,s=Mr,c=Mr){super();this.retryTimeout=1e4,this.streamingTasks=new Tt,this.isStartingStreamingTask=!1,this.taskMutex=new Xo("live-streaming"),this.cancelToken=To.CancelToken.source(),this.injectConfig=As({},XR),this.injectLoopTimes=0,this.lastTaskId=1,this.statusError=new Tt,this.spec=n,this.httpRetryConfig=c,this.wsRetryConfig=s}async setTranscodingConfig(n){var s;let c=As({},zR,{},n);var u,h;c.videoCodecProfile!==66&&c.videoCodecProfile!==77&&c.videoCodecProfile!==100&&(R.debug(b(u="[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ")).call(u,c.videoCodecProfile," -> 100")),c.videoCodecProfile=100),c.transcodingUsers||(c.transcodingUsers=c.userConfigs),c.transcodingUsers&&(c.transcodingUsers=Ie(h=c.transcodingUsers).call(h,S=>As({},JR,{},S,{zOrder:S.zOrder?S.zOrder+1:1}))),function(S){var N,O;S.width==null||St(S.width,"config.width",0,1e4),S.height==null||St(S.height,"config.height",0,1e4),S.videoBitrate==null||St(S.videoBitrate,"config.videoBitrate",1,1e6),S.videoFrameRate==null||St(S.videoFrameRate,"config.videoFrameRate"),S.lowLatency==null||ps(S.lowLatency,"config.lowLatency"),S.audioSampleRate==null||yr(S.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),S.audioBitrate==null||St(S.audioBitrate,"config.audioBitrate",1,128),S.audioChannels==null||yr(S.audioChannels,"config.audioChannels",[1,2,3,4,5]),S.videoGop==null||St(S.videoGop,"config.videoGop"),S.videoCodecProfile==null||yr(S.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),S.userCount==null||St(S.userCount,"config.userCount",0,17),S.backgroundColor==null||St(S.backgroundColor,"config.backgroundColor",0,16777215),S.userConfigExtraInfo==null||qr(S.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),S.transcodingUsers&&S.transcodingUsers!=null&&(Lh(S.transcodingUsers,"config.transcodingUsers"),K(N=S.transcodingUsers).call(N,(B,P)=>{xh(B.uid),B.x==null||St(B.x,"transcodingUser[".concat(P,"].x"),0,1e4),B.y==null||St(B.y,"transcodingUser[".concat(P,"].y"),0,1e4),B.width==null||St(B.width,"transcodingUser[".concat(P,"].width"),0,1e4),B.height==null||St(B.height,"transcodingUser[".concat(P,"].height"),0,1e4),B.zOrder==null||St(B.zOrder-1,"transcodingUser[".concat(P,"].zOrder"),0,100),B.alpha==null||St(B.alpha,"transcodingUser[".concat(P,"].alpha"),0,1,!1)})),S.watermark==null||Qh(S.watermark,"watermark"),S.backgroundImage==null||Qh(S.backgroundImage,"backgroundImage"),S.images&&S.images!=null&&(Lh(S.images,"config.images"),K(O=S.images).call(O,(B,P)=>{Qh(B,"images[".concat(P,"]"))}))}(c),n=[];var f,A;if(c.images&&n.push(...Ie(f=c.images).call(f,S=>As({},Gp,{},S,{zOrder:255}))),c.backgroundImage&&(n.push(As({},Gp,{},c.backgroundImage,{zOrder:0})),delete c.backgroundImage),c.watermark&&(n.push(As({},Gp,{},c.watermark,{zOrder:255})),delete c.watermark),c.images=n,c.transcodingUsers&&(c.userConfigs=Ie(A=c.transcodingUsers).call(A,S=>As({},S)),c.userCount=c.transcodingUsers.length,delete c.transcodingUsers),f=Ie(s=c.userConfigs||[]).call(s,S=>typeof S.uid=="number"?se.resolve(S.uid):Kh(S.uid,this.spec,this.cancelToken.token,this.httpRetryConfig)),s=await se.all(f),K(s).call(s,(S,N)=>{c.userConfigs&&c.userConfigs[N]&&(c.userConfigs[N].uid=S)}),this.transcodingConfig=c,this.connection)try{var m,I,E;let S=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Ie(m=oo(ca(I=this.streamingTasks).call(I))).call(m,N=>N.taskId).join("#")});R.debug(b(E="[".concat(this.spec.clientId,"] update live transcoding config success, code: ")).call(E,S.code,", config:"),fe(this.transcodingConfig))}catch(S){var _;if(!S.data||!S.data.retry)throw S;S.data.changeAddress&&this.connection.tryNextAddress(),K(_=this.streamingTasks).call(_,N=>{R.warning("[".concat(this.spec.clientId,"] live streaming receive error"),S.toString(),"try to republish",N.url),this.startLiveStreamingTask(N.url,N.mode,S).then(()=>{var O;R.debug(b(O="[".concat(this.spec.clientId,"] live streaming republish ")).call(O,N.url," success"))}).catch(O=>{R.error("[".concat(this.spec.clientId,"] live streaming republish failed"),N.url,O.toString()),this.onLiveStreamError&&this.onLiveStreamError(N.url,O)})})}}setInjectStreamConfig(n,s){this.injectConfig=cn({},this.injectConfig,n),this.injectLoopTimes=s}async startLiveStreamingTask(n,s,c){var u,h,f,A;if(Xe(u=oo(ca(h=this.streamingTasks).call(h))).call(u,I=>I.mode===nr.INJECT)&&s===nr.INJECT)return new L(D.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!this.transcodingConfig&&s===nr.TRANSCODE)throw new L(D.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");if(u={command:"PublishStream",ts:le(),url:n,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0},R.debug(b(f=b(A="[".concat(this.spec.clientId,"] start live streaming ")).call(A,n,", mode: ")).call(f,s)),f=await this.taskMutex.lock(),!this.connection&&c)return void f();if(this.streamingTasks.get(n)&&!c)return f(),new L(D.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(s))}catch(I){throw f(),I}switch(s){case nr.TRANSCODE:u.transcodingConfig=As({},this.transcodingConfig);break;case nr.INJECT:u={cname:this.spec.cname,command:"InjectStream",sid:this.spec.sid,transcodingConfig:this.injectConfig,ts:le(),url:n,loopTimes:this.injectLoopTimes}}this.uapResponse&&this.uapResponse.vid&&(u.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0,A=this.lastTaskId++;try{var m;let I=new se((_,S)=>{Un(this.retryTimeout).then(()=>{if(c)return S(c);const N=this.statusError.get(n);return N?(this.statusError.delete(n),S(N)):void 0})}),E=await se.race([this.connection.request("request",{clientRequest:u},!0,{url:n,command:"PublishStream",workerType:s===nr.TRANSCODE?1:2,requestByUser:!c,tid:A.toString()}),I]);this.isStartingStreamingTask=!1,R.debug(b(m="[".concat(this.spec.clientId,"] live streaming started, code: ")).call(m,E.code)),this.streamingTasks.set(n,{clientRequest:u,mode:s,url:n,taskId:A}),f()}catch(I){if(f(),this.isStartingStreamingTask=!1,!I.data||!I.data.retry||c)throw I;return I.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(n,s,I)):await this.startLiveStreamingTask(n,s,I)}}stopLiveStreamingTask(n){return new se((s,c)=>{let u=this.streamingTasks.get(n);if(!u||!this.connection)return new L(D.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();let h=u.mode;u.abortTask=()=>{R.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(n),s()},this.connection.request("request",{clientRequest:{command:h===nr.INJECT?"UninjectStream":"UnpublishStream",url:u.url}},!1,{url:n,command:"UnPublishStream",workerType:h===nr.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(f=>{var A;R.debug(b(A="[".concat(this.spec.clientId,"] stop live streaming success, code: ")).call(A,f.code)),this.streamingTasks.delete(n),this.streamingTasks.size===0&&h!==nr.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),s(),h===nr.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(5,this.spec.uid,n)}).catch(c)})}async controlInjectStream(n,s,c,u){let h=this.streamingTasks.get(n);if(!h||!this.connection||h.mode!==nr.INJECT)throw new L(D.INVALID_OPERATION,"can not find inject stream task to control");return(await this.connection.request("request",{clientRequest:{command:"ControlStream",url:n,control:s,audioVolume:c,position:u}})).serverResponse}resetAllTask(){var n;let s=oo(ca(n=this.streamingTasks).call(n));this.terminate();for(let c of s)this.startLiveStreamingTask(c.url,c.mode).catch(u=>{this.onLiveStreamError&&this.onLiveStreamError(c.url,u)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Tt,this.isStartingStreamingTask=!1,this.statusError=new Tt,this.cancelToken=To.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(n){if(this.connection)throw new L(D.UNEXPECTED_ERROR,"live streaming connection has already connected");let s=await br(this,ic.REQUEST_WORKER_MANAGER_LIST,n);return this.uapResponse=s,this.connection=new kN(s.workerToken,this.spec,this.wsRetryConfig,n),this.connection.on(Ui.WARNING,(c,u)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(u,c)),this.connection.on(Ui.PUBLISH_STREAM_STATUS,c=>this.handlePublishStreamServer(c)),this.connection.on(Ui.INJECT_STREAM_STATUS,c=>this.handleInjectStreamServerStatus(c)),this.connection.on(Ui.REQUEST_NEW_ADDRESS,(c,u)=>{if(!this.connection)return u(new L(D.UNEXPECTED_ERROR,"can not get new live streaming address list"));br(this,ic.REQUEST_WORKER_MANAGER_LIST,n).then(h=>{this.uapResponse=h,c(h.addressList)}).catch(u)}),await this.connection.init(s.addressList),this.connection}handlePublishStreamServer(n){var s=n.serverStatus&&n.serverStatus.url||"empty_url";let c=this.streamingTasks.get(s),u=n.reason;switch(n.code){case Ht.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Ht.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Ht.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Ht.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:if(n=new L(D.LIVE_STREAMING_CDN_ERROR,"",{code:n.code}),c)return R.error(n.toString()),this.onLiveStreamError&&this.onLiveStreamError(s,n);if(!this.isStartingStreamingTask)break;this.statusError.set(s,n);case Ht.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:return n=new L(D.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,u),this.onLiveStreamWarning&&this.onLiveStreamWarning(s,n);case Ht.LIVE_STREAM_RESPONSE_WORKER_LOST:case Ht.LIVE_STREAM_RESPONSE_WORKER_QUIT:var h;if(this.connection){this.connection.tryNextAddress(),s=oo(ca(h=this.streamingTasks).call(h));for(let f of s)f.abortTask?f.abortTask():(R.warning("[".concat(this.spec.clientId,"] publish stream status code"),n.code,"try to republish",f.url),this.startLiveStreamingTask(f.url,f.mode,new L(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:n.code})).then(()=>{R.debug("[".concat(this.spec.clientId,"] republish live stream success"),f.url)}).catch(A=>{R.error(A.toString()),this.onLiveStreamError&&this.onLiveStreamError(f.url,A)}))}}}handleInjectStreamServerStatus(n){let s=Number(n.uid),c=n.serverStatus&&n.serverStatus.url;switch(n.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(0,s,c));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(1,s,c),void this.streamingTasks.delete(c);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(2,s,c),void this.streamingTasks.delete(c);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(10,s,c),void this.streamingTasks.delete(c);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(3,s,c),void this.streamingTasks.delete(c);default:return void R.debug("inject stream server status",n)}}hasUrl(n){return this.streamingTasks.has(n)}}class $I{constructor(){this.destChannelMediaInfos=new Tt}setSrcChannelInfo(n){um(n),this.srcChannelMediaInfo=n}addDestChannelInfo(n){um(n),this.destChannelMediaInfos.set(n.channelName,n)}removeDestChannelInfo(n){Ph(n),this.destChannelMediaInfos.delete(n)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}class DN extends Zr{constructor(n,s,c){super();this.requestId=1,this.onOpen=()=>{this.emit("open"),this.startHeartBeatCheck()},this.onClose=u=>{this.emit("close"),this.dispose()},this.onMessage=u=>{if(u=JSON.parse(u.data),!u||u.command!=="serverResponse"||!u.requestId)return u&&u.command==="serverStatus"&&u.serverStatus&&u.serverStatus.command?(this.emit("status",u.serverStatus),void this.emit(u.serverStatus.command,u.serverStatus)):void 0;this.emit("req_".concat(u.requestId),u)},this.joinInfo=n,this.clientId=s,this.ws=new af("cross-channel-".concat(this.clientId),c),this.ws.on(dt.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(dt.CONNECTED,this.onOpen),this.ws.on(dt.ON_MESSAGE,this.onMessage),this.ws.on(dt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(n){let s=this.requestId++;return n.requestId=s,n.seq=s,this.ws.sendMessage(n),s}waitStatus(n){return new se((s,c)=>{let u=window.setTimeout(()=>{c(new L(D.TIMEOUT,"wait status timeout, status: ".concat(n)))},5e3);this.once(n,h=>{window.clearTimeout(u),h.state&&h.state!==0?c(new L(D.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(n))):s(void 0)}),this.once("dispose",()=>{window.clearTimeout(u),c(new L(D.WS_ABORT))})})}async request(n){if(this.ws.state==="closed")throw new L(D.WS_DISCONNECT);let s=()=>new se((u,h)=>{this.ws.once(dt.CLOSED,()=>h(new L(D.WS_ABORT))),this.ws.once(dt.CONNECTED,u)});this.ws.state!=="connected"&&await s();let c=this.sendMessage(n);if(n=await new se((u,h)=>{const f=()=>{h(new L(D.WS_ABORT))};this.ws.once(dt.RECONNECTING,f),this.ws.once(dt.CLOSED,f),this.once("req_".concat(c),u),Un(3e3).then(()=>{this.removeAllListeners("req_".concat(c)),this.ws.off(dt.RECONNECTING,f),this.ws.off(dt.CLOSED,f),h(new L(D.TIMEOUT,"cross channel ws request timeout"))})}),!n||n.code!==200)throw new L(D.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(fe(n)));return n}async connect(n){this.ws.removeAllListeners(dt.REQUEST_NEW_URLS),this.ws.on(dt.REQUEST_NEW_URLS,s=>{s(n)}),await this.ws.init(n)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(n){let s=this.requestId++;return n.requestId=s,this.ws.sendMessage(n),s}startHeartBeatCheck(){this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class BN extends Zr{constructor(n,s,c,u){super();this.cancelToken=To.CancelToken.source(),this.requestId=0,this._state="RELAY_STATE_IDLE",this.errorCode="RELAY_OK",this.onStatus=h=>{var f;R.debug(b(f="[".concat(this.clientId,"] ChannelMediaStatus: ")).call(f,fe(h))),h&&h.command&&(h.command==="onAudioPacketReceived"&&this.emit("event","PACKET_RECEIVED_AUDIO_FROM_SRC"),h.command==="onVideoPacketReceived"&&this.emit("event","PACKET_RECEIVED_VIDEO_FROM_SRC"),h.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode="SRC_TOKEN_EXPIRED",this.state="RELAY_STATE_FAILURE"),h.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode="DEST_TOKEN_EXPIRED",this.state="RELAY_STATE_FAILURE"))},this.onReconnect=async()=>{R.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event","NETWORK_DISCONNECTED"),this.state="RELAY_STATE_IDLE",this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(h=>{this.state!=="RELAY_STATE_IDLE"&&(R.error("auto restart channel media relay failed",h.toString()),this.errorCode="SERVER_CONNECTION_LOST",this.state="RELAY_STATE_FAILURE")})},this.joinInfo=n,this.clientId=s,this.signal=new DN(this.joinInfo,this.clientId,c),this.httpRetryConfig=u}set state(n){n!==this._state&&(n!=="RELAY_STATE_FAILURE"&&(this.errorCode="RELAY_OK"),this.emit("state",n,this.errorCode),this._state=n)}get state(){return this._state}async startChannelMediaRelay(n){if(this.state!=="RELAY_STATE_IDLE")throw new L(D.INVALID_OPERATION);this.state="RELAY_STATE_CONNECTING",await this.connect(),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(n)}catch(s){throw s.data&&s.data.serverResponse&&s.data.serverResponse.command==="SetSourceChannel"?new L(D.CROSS_CHANNEL_FAILED_JOIN_SRC):s.data&&s.data.serverResponse&&s.serverResponse.command==="SetDestChannelStatus"?new L(D.CROSS_CHANNEL_FAILED_JOIN_DEST):s.data&&s.data.serverResponse&&s.serverResponse.command==="StartPacketTransfer"?new L(D.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):s}this.prevChannelMediaConfig=n}async updateChannelMediaRelay(n){if(this.state!=="RELAY_STATE_RUNNING")throw new L(D.INVALID_OPERATION);await this.sendUpdateMessage(n),this.prevChannelMediaConfig=n}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),R.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state="RELAY_STATE_IDLE",this.dispose()}dispose(){R.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=To.CancelToken.source(),this.state="RELAY_STATE_IDLE",this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){let n=await _T(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=n.workerToken,await this.signal.connect(n.addressList),this.emit("event","NETWORK_CONNECTED"),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(n){var s=this.genMessage($r.StopPacketTransfer);await this.signal.request(s),await this.signal.waitStatus("Normal Quit"),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success")),s=this.genMessage($r.SetSdkProfile,n),await this.signal.request(s),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success")),s=this.genMessage($r.SetSourceChannel,n),await this.signal.request(s),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event","PACKET_JOINED_SRC_CHANNEL"),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success")),s=this.genMessage($r.SetSourceUserId,n),await this.signal.request(s),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success")),s=this.genMessage($r.SetDestChannel,n),await this.signal.request(s),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event","PACKET_JOINED_DEST_CHANNEL"),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success")),n=this.genMessage($r.StartPacketTransfer,n),await this.signal.request(n),this.emit("event","PACKET_SENT_TO_DEST_CHANNEL"),this.state="RELAY_STATE_RUNNING",R.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success"))}async sendUpdateMessage(n){n=this.genMessage($r.UpdateDestChannel,n),await this.signal.request(n),this.emit("event","PACKET_UPDATE_DEST_CHANNEL"),R.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){let n=this.genMessage($r.StopPacketTransfer);await this.signal.request(n),R.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(n,s){let c=[],u=[],h=[];this.requestId+=1;let f={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:ei,sid:this.joinInfo.sid,ts:le(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};f.sdkVersion==="4.7.2"&&(f.sdkVersion="0.0.1");let A=null,m=null;switch(n){case $r.SetSdkProfile:return f.clientRequest={command:"SetSdkProfile",type:"multi_channel"},f;case $r.SetSourceChannel:if(m=s&&s.getSrcChannelMediaInfo(),!m)throw new L(D.UNEXPECTED_ERROR,"can not find source config");return f.clientRequest={command:"SetSourceChannel",uid:"0",channelName:m.channelName,token:m.token||this.joinInfo.appId},f;case $r.SetSourceUserId:if(m=s&&s.getSrcChannelMediaInfo(),!m)throw new L(D.UNEXPECTED_ERROR,"can not find source config");return f.clientRequest={command:"SetSourceUserId",uid:m.uid+""},f;case $r.SetDestChannel:if(A=s&&s.getDestChannelMediaInfo(),!A)throw new L(D.UNEXPECTED_ERROR,"can not find dest config");return K(A).call(A,I=>{c.push(I.channelName),u.push(I.uid+""),h.push(I.token||this.joinInfo.appId)}),f.clientRequest={command:"SetDestChannel",channelName:c,uid:u,token:h},f;case $r.StartPacketTransfer:return f.clientRequest={command:"StartPacketTransfer"},f;case $r.Reconnect:return f.clientRequest={command:"Reconnect"},f;case $r.StopPacketTransfer:return f.clientRequest={command:"StopPacketTransfer"},f;case $r.UpdateDestChannel:if(A=s&&s.getDestChannelMediaInfo(),!A)throw new L(D.UNEXPECTED_ERROR,"can not find dest config");return K(A).call(A,I=>{c.push(I.channelName),u.push(I.uid+""),h.push(I.token||this.joinInfo.appId)}),f.clientRequest={command:"UpdateDestChannel",channelName:c,uid:u,token:h},f}return f}}class MN{constructor(n,s){this._trust_stream_added_state_=this._trust_video_mute_state_=this._trust_audio_mute_state_=this._trust_video_enabled_state_=this._trust_audio_enabled_state_=this._trust_in_room_=!0,this._video_muted_=this._audio_muted_=!1,this._video_enabled_=this._audio_enabled_=!0,this._video_added_=this._audio_added_=!1,this.uid=n,this._uintid=s}get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio)return this._audioTrack}get videoTrack(){if(this.hasVideo)return this._videoTrack}}let LN=async i=>{var n=jh(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`);n=await window.crypto.subtle.importKey("spki",n,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),i=(s=i,new TextEncoder().encode(s));var s;return s=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},n,i),wu(new Uint8Array(s))},_d;class PN{constructor(n,s){var c;this.name=n,this.time=performance.now(),this.sequence=Ke(c=$R[s]).call(c,n)}setElapse(n){this.elapse=n}}let xN=new Tt;class QN{constructor(n,s){this.records=[],this._id=n,this._group=s,this._localTimeStamp=le(),this._performanceTimeStamp=performance.now()}checkPoint(n){var s;let c=new PN(n,this._group);c.sequence===-1&&R.warning("[".concat(this._id,"] check point record failed, cannot get the sequence")),this.records.push(c),(n=Xe(s=this.records).call(s,u=>u.sequence===c.sequence-1))&&c.setElapse(c.time-n.time)}getRecord(n){var s;return Xe(s=this.records).call(s,c=>c&&c.name===n)}resetRecords(){this.records.length=0}}var wl=function(i,n,s,c){var u,h=arguments.length,f=3>h?n:c===null?c=ut(n,s):c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(i,n,s,c);else for(var A=i.length-1;0<=A;A--)(u=i[A])&&(f=(3>h?u(f):3<h?u(n,s,f):u(n,s))||f);return 3<h&&f&&ft(n,s,f),f},Gn=function(i,n){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,n)};class hc extends Zr{constructor(n){var s,c,u,h;let f;if(super(),this._users=[],this._sessionId=null,this._bindEnabledTracks=[],this._leaveMutex=new Xo("client-leave"),this._publishMutex=new Xo("client-publish"),this._subscribeMutex=new Tt,this._remoteStream=new Tt,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._turnServer={servers:[],mode:"auto"},this._cloudProxyServerMode="disabled",this._isDualStreamEnabled=!1,this._streamFallbackTypeCacheMap=new Tt,this._remoteStreamTypeCacheMap=new Tt,this._axiosCancelSource=To.CancelToken.source(),this._networkQualitySensitivity="normal",this._useLocalAccessPoint=!1,this._handleLocalTrackEnable=(m,I,E)=>{this.publish(m,!1).then(I).catch(E)},this._handleLocalTrackDisable=(m,I,E)=>{this.unpublish(m,!1).then(I).catch(E)},this._handleUserOnline=m=>{var I;this.isStringUID&&typeof m.uid!="string"&&R.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));let E=Xe(I=this._users).call(I,_=>_.uid===m.uid);E?E._trust_in_room_=!0:(I=new MN(m.uid,m.uint_id||m.uid),this._users.push(I),R.debug("[".concat(this._clientId,"] user online"),m.uid),this.emit(ze.USER_JOINED,I))},this._handleUserOffline=m=>{var I;let E=Xe(I=this._users).call(I,_=>_.uid===m.uid);E&&(this._handleRemoveStream(m),Js(this._users,E),this._remoteStreamTypeCacheMap.delete(E.uid),this._streamFallbackTypeCacheMap.delete(E.uid),R.debug("[".concat(this._clientId,"] user offline"),m.uid,"reason:",m.reason),this.emit(ze.USER_LEAVED,E,m.reason))},this._handleAddAudioOrVideoStream=(m,I,E)=>{var _,S,N;let O=Xe(_=this._users).call(_,J=>J.uid===I);if(!O)return void R.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));R.debug(b(S=b(N="[".concat(this._clientId,"] stream added with uid ")).call(N,I,", type ")).call(S,m)),_=m==="audio"?O.hasAudio:O.hasVideo;var B,P;O._uintid||(O._uintid=E||I),O._trust_stream_added_state_=!0,m==="audio"?O._audio_added_=!0:O._video_added_=!0,(m==="audio"?O.hasAudio:O.hasVideo)&&!_&&(R.info(b(B=b(P="[".concat(this._clientId,"] remote user ")).call(P,O.uid," published ")).call(B,m)),this.emit(ze.USER_PUBLISHED,O,m)),m==="video"?z.onGatewayStream(this._sessionId,zr.ON_ADD_VIDEO_STREAM,Zt.ON_ADD_VIDEO_STREAM,{peer:E||I}):z.onGatewayStream(this._sessionId,zr.ON_ADD_AUDIO_STREAM,Zt.ON_ADD_AUDIO_STREAM,{peer:E||I}),(m=this._remoteStream.get(I))&&m.readyToReconnect&&m.connectionState==="connecting"&&m.reconnectPC().catch(J=>{R.error("[".concat(this._clientId,"] resubscribe error"),J.toString())})},this._handleRemoveStream=m=>{var I,E;let _=Xe(I=this._users).call(I,S=>S.uid===m.uid);if(!_)return void R.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));R.debug(b(E="[".concat(this._clientId,"] stream removed with uid ")).call(E,m.uid)),I=()=>{},_.hasAudio&&_.hasVideo?I=()=>{var S,N;R.info(b(S="[".concat(this._clientId,"] remote user ")).call(S,_.uid," unpublished audio track")),this.emit(ze.USER_UNPUBLISHED,_,"audio"),R.info(b(N="[".concat(this._clientId,"] remote user ")).call(N,_.uid," unpublished video track")),this.emit(ze.USER_UNPUBLISHED,_,"video")}:_.hasVideo?I=()=>{var S;R.info(b(S="[".concat(this._clientId,"] remote user ")).call(S,_.uid," unpublished video track")),this.emit(ze.USER_UNPUBLISHED,_,"video")}:_.hasAudio&&(I=()=>{var S;R.info(b(S="[".concat(this._clientId,"] remote user ")).call(S,_.uid," unpublished audio track")),this.emit(ze.USER_UNPUBLISHED,_,"audio")}),_._trust_stream_added_state_=!0,_._audio_added_=!1,_._video_added_=!1,(E=this._remoteStream.get(_.uid))&&(E.closeP2PConnection(),this._remoteStream.delete(_.uid)),z.onGatewayStream(this._sessionId,zr.ON_REMOVE_STREAM,Zt.ON_REMOVE_STREAM,{peer:m.uint_id||m.uid}),I()},this._handleSetStreamLocalEnable=(m,I,E)=>{var _,S,N,O,B,P;let J=Xe(_=this._users).call(_,et=>et.uid===I);if(!J)return void R.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));if(R.debug(b(S=b(N=b(O="[".concat(this._clientId,"] local ")).call(O,m," ")).call(N,E?"enabled":"disabled"," with uid ")).call(S,I)),_=m==="audio"?J.hasAudio:J.hasVideo,m==="audio"){J._trust_audio_enabled_state_=!0;var ne=J._audio_enabled_;if(J._audio_enabled_=E,J._audio_enabled_===ne)return;var Ae,Me;E=J._audio_enabled_?"enable-local-audio":"disable-local-audio",R.debug(b(Ae=b(Me="[".concat(this._clientId,"] user-info-updated, uid: ")).call(Me,I,", msg: ")).call(Ae,E)),this.emit(ze.USER_INFO_UPDATED,I,E)}else{if(J._trust_video_enabled_state_=!0,Ae=J._video_enabled_,J._video_enabled_=E,J._video_enabled_===Ae)return;var be;E=J._video_enabled_?"enable-local-video":"disable-local-video",R.debug(b(ne=b(be="[".concat(this._clientId,"] user-info-update, uid: ")).call(be,I,", msg: ")).call(ne,E)),this.emit(ze.USER_INFO_UPDATED,I,E)}if(E=m==="audio"?J.hasAudio:J.hasVideo,_!==E){var Rt,ve;if(!_&&E)return R.info(b(Rt=b(ve="[".concat(this._clientId,"] remote user ")).call(ve,I," published ")).call(Rt,m)),void this.emit(ze.USER_PUBLISHED,J,m);(Rt=this._remoteStream.get(I))&&(ve=Ua({},Rt.subscribeOptions),ve.audio=!!J.hasAudio&&ve.audio,ve.video=!!J.hasVideo&&ve.video,ve.audio||ve.video?Rt.setSubscribeOptions(ve):(Rt.closeP2PConnection().catch(et=>{R.warning("close sub pc error",et)}),this._remoteStream.delete(J.uid))),R.info(b(B=b(P="[".concat(this._clientId,"] remote user ")).call(P,J.uid," unpublished ")).call(B,m)),this.emit(ze.USER_UNPUBLISHED,J,m)}},this._handleMuteStream=(m,I,E)=>{var _,S,N;R.debug("[".concat(this._clientId,"] receive mute message"),m,I,E);let O=Xe(_=this._users).call(_,Rt=>Rt.uid===m);var B;if(!O)return void R.warning(b(B="[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ")).call(B,m));if(_=I==="audio"?O.hasAudio:O.hasVideo,I==="audio"){O._trust_audio_mute_state_=!0;var P=O._audio_muted_;if(O._audio_muted_=E,O._audio_muted_===P)return;var J,ne;E=O._audio_muted_?"mute-audio":"unmute-audio",R.debug(b(J=b(ne="[".concat(this._clientId,"] user-info-update, uid: ")).call(ne,m,", msg: ")).call(J,E)),this.emit(ze.USER_INFO_UPDATED,m,E)}else{if(O._trust_video_mute_state_=!0,J=O._video_muted_,O._video_muted_=E,O._video_muted_===J)return;var Ae;E=O._video_muted_?"mute-video":"unmute-video",R.debug(b(P=b(Ae="[".concat(this._clientId,"] user-info-update, uid: ")).call(Ae,m,", msg: ")).call(P,E)),this.emit(ze.USER_INFO_UPDATED,m,E)}if(E=I==="audio"?O.hasAudio:O.hasVideo,_!==E){var Me,be;if(!_&&E)return R.info(b(Me=b(be="[".concat(this._clientId,"] remote user ")).call(be,m," published ")).call(Me,I)),void this.emit(ze.USER_PUBLISHED,O,I);(Me=this._remoteStream.get(m))&&(be=Ua({},Me.subscribeOptions),be.audio=!!O.hasAudio&&be.audio,be.video=!!O.hasVideo&&be.video,I==="video"&&Me.pc._statsFilter.setVideoIsReady(!1),be.audio||be.video?Me.setSubscribeOptions(be):(Me.closeP2PConnection().catch(Rt=>{R.warning("close sub pc error",Rt)}),this._remoteStream.delete(O.uid))),R.info(b(S=b(N="[".concat(this._clientId,"] remote user ")).call(N,m," unpublished ")).call(S,I)),this.emit(ze.USER_UNPUBLISHED,O,I)}},this._handleP2PLost=m=>{R.debug("[".concat(this._clientId,"] receive p2p lost"),m);let I=null;if(this._highStream&&this._highStream.pc.ID===m.p2pid)I=this._highStream;else if(this._lowStream&&this._lowStream.pc.ID===m.p2pid)I=this._lowStream;else{var E;K(E=this._remoteStream).call(E,_=>{_.pc.ID===m.p2pid&&(I=_)})}I?I.emit(ke.GATEWAY_P2P_LOST,m.p2pid):R.warning("P2PLost stream not found",m)},this._handleTokenWillExpire=()=>{R.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.emit(ze.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)},this._handleBeforeUnload=m=>{m.returnValue!==void 0&&m.returnValue!==""||(this.leave(),R.info("[".concat(this._clientId,"] auto leave onbeforeunload")))},this._handleUpdateNetworkQuality=()=>{var m;if(this._networkQualitySensitivity!=="normal"){if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.emit(ze.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});var I={downlinkNetworkQuality:0,uplinkNetworkQuality:0};this._highStream&&!this._highStream.detecting&&(I.uplinkNetworkQuality=this._highStream.getNetworkQuality());var E=0;K(m=this._remoteStream).call(m,_=>E+=_.getNetworkQuality()),0<this._remoteStream.size&&(I.downlinkNetworkQuality=Math.round(E/this._remoteStream.size)),this.emit(ze.NETWORK_QUALITY,I)}},this._codec=n.codec,this._mode=n.mode,n.proxyServer&&(this._proxyServer=n.proxyServer,z.setProxyServer(this._proxyServer),R.setProxyServer(this._proxyServer)),n.turnServer&&(this._turnServer=Ua({},this._turnServer,{mode:"manual"},n.turnServer)),this._clientId=or(5,"client-"),R.info(b(s=b(c=b(u=b(h="[".concat(this._clientId,"] Initializing AgoraRTC client v")).call(h,ei," build: ")).call(u,"v4.7.2-0-gf83f608b(10/13/2021, 5:32:13 PM)",", mode: ")).call(c,this._mode,", codec: ")).call(s,this._codec)),this._performanceRecorder=function(m,I){return I=new QN(m,I),xN.set(m,I),I}(this._clientId,"join"),n.clientRoleOptions)try{lm(n.clientRoleOptions),f=cn({},n.clientRoleOptions)}catch(m){var A;R.warning(b(A="[".concat(this._clientId,"] ")).call(A,m.toString()))}this._statsCollector=new ac(this._clientId),this._statsCollector.onStatsException=(m,I,E)=>{var _,S,N;R.debug(b(_=b(S=b(N="[".concat(this._clientId,"] receive exception msg, code: ")).call(N,m,", msg: ")).call(S,I,", uid: ")).call(_,E)),this.emit(ze.EXCEPTION,{code:m,msg:I,uid:E})},this._statsCollector.onUploadPublishDuration=(m,I,E,_)=>{var S;let N=Xe(S=this._users).call(S,O=>O.uid===m);N&&z.peerPublishStatus(this._sessionId,{subscribeElapse:_,audioPublishDuration:I,videoPublishDuration:E,peer:N._uintid})},this._gateway=new xw({clientId:this._clientId,mode:this._mode,codec:this._codec,websocketRetryConfig:n.websocketRetryConfig||Mr,httpRetryConfig:n.httpRetryConfig||Mr,forceWaitGatewayResponse:n.forceWaitGatewayResponse===void 0||n.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:n.role,clientRoleOptions:f}),this._config=n,this._configDistribute=new uN,this._handleGatewayEvents()}get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._highStream?this._highStream.getAllTracks():[]}get uid(){return this._uid}get channelName(){return this._channelName}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}async join(n,s,c,u,h){var f;this._performanceRecorder.checkPoint("startJoin");var A=(_d||_d||(_d=(window.location.protocol.split(":")[0]||"").toUpperCase(),_d))==="HTTPS";let m=window.isSecureContext!==void 0?window.isSecureContext:"Browser Not Support",I=()=>{R.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser")};window.isSecureContext!==void 0?window.isSecureContext||I():A||I(),A=z.reportApiInvoke(this._sessionId,{name:Re.JOIN,options:[n,s,c,u],states:{isHttps:A,isSecureContext:m},tag:Te.TRACER});try{if(!c&&c!==null)throw new L(D.INVALID_PARAMS,"Invalid token: ".concat(c,". If you don not use token, set it to null"));c&&qr(c,"token",1,2047),qr(n,"appid",1,2047),Ph(s),u&&xh(u),h&&qr(h,"optionalInfo",1,2047)}catch(O){throw A.onError(O),O}if(R.info(b(f="[".concat(this._clientId,"] start join channel ")).call(f,s)),this._leaveMutex.isLocked&&(R.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),R.debug("[".concat(this._clientId,"] join: continue"))),this.connectionState!=="DISCONNECTED")throw n=new L(D.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state")),A.onError(n),n;this._sessionId||(this._sessionId=or(32,"").toUpperCase()),this._gateway.state="CONNECTING",h={clientId:this._clientId,appId:n,sid:this._sessionId,cname:s,uid:typeof u!="string"?u:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:c||n,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:h,useLocalAccessPoint:this._useLocalAccessPoint},typeof u=="string"&&(h.stringUid=u,this._uintUid?(h.uid=this._uintUid,this._uintUid=void 0):h.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret&&(h.aesmode=this._encryptionMode,h.aespassword=await LN(this._encryptionSecret),this._encryptionSalt&&(h.aessalt=this._encryptionSalt)),this._startSession(this._sessionId,{channel:s,appId:n}),gi(()=>{this.connectionState==="CONNECTING"&&z.joinChannelTimeout(this._sessionId,5)},5e3);try{var E;let O;if(h.cloudProxyServer==="443only")h.proxyServer=te.PROXY_SERVER_TYPE2;else if(h.cloudProxyServer==="proxy3"||h.cloudProxyServer==="proxy4"||h.cloudProxyServer==="proxy5"){let P=te.PROXY_SERVER_TYPE3;ro(P)?h.proxyServer=P[0]:h.proxyServer=P}if(z.setProxyServer(h.proxyServer),R.setProxyServer(h.proxyServer),this._performanceRecorder.checkPoint("startRequestAp"),h.stringUid&&!h.uid&&h.cloudProxyServer==="normal"){var _;await Bm(h,this._axiosCancelSource.token,this._config.httpRetryConfig||Mr,!1);let P=await Kh(h.stringUid,h,this._axiosCancelSource.token,this._config.httpRetryConfig||Mr);R.debug(b(_="getUserAccount Success ".concat(h.stringUid," => ")).call(_,P)),h.uid=P,O=await zc(h,this._axiosCancelSource.token,this._config.httpRetryConfig||Mr)}else{if(h.stringUid&&!h.uid){var S;let P=await Kh(h.stringUid,h,this._axiosCancelSource.token,this._config.httpRetryConfig||Mr);R.debug(b(S="getUserAccount Success ".concat(h.stringUid," => ")).call(S,P)),h.uid=P}O=await Bm(h,this._axiosCancelSource.token,this._config.httpRetryConfig||Mr,!0)}this._performanceRecorder.checkPoint("startJoinGateway"),this._configDistribute.startGetConfigDistribute(h,this._axiosCancelSource.token),this._configDistribute.on(pl.UPDATE_BITRATE_LIMIT,P=>{this._highStream&&this._highStream.handleUpdateBitrateLimit(P.uplink),P.low_stream_uplink&&this._lowStream&&this._lowStream.handleUpdateBitrateLimit({max_bitrate:P.low_stream_uplink.bitrate,min_bitrate:P.low_stream_uplink.bitrate||0})}),this._key=c||n,this._joinInfo=Ua({},h,{cid:O.gatewayInfo.cid,uid:h.uid?h.uid:O.gatewayInfo.uid,vid:O.gatewayInfo.vid,apResponse:O.gatewayInfo.res,uni_lbs_ip:O.gatewayInfo.uni_lbs_ip,gatewayAddrs:O.gatewayInfo.gatewayAddrs});let B=await this._gateway.join(this._joinInfo,this._key);return A.onSuccess(B),this._appId=n,this._channelName=h.cname,this._uid=B,this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener("beforeunload",this._handleBeforeUnload),R.info(b(E="[".concat(this._clientId,"] Joining channel success: ")).call(E,s)),gi(()=>{R.startUpload()},5e3),this._performanceRecorder.checkPoint("finishJoin"),N=this,vt(qo).call(qo,N)||qo.push(N),B}catch(O){throw n=ro(O)?O[0]:O,R.error("[".concat(this._clientId,"] Joining channel failed, rollback"),n),n.code!==D.OPERATION_ABORTED&&(this._gateway.state="DISCONNECTED",this._reset()),A.onError(n),n}var N}async leave(){let n=z.reportApiInvoke(this._sessionId,{name:Re.LEAVE,options:[],tag:Te.TRACER});R.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener("beforeunload",this._handleBeforeUnload),this._reset();var s=Ke(qo).call(qo,this);if(s!==-1&&Jr(qo).call(qo,s,1),s=await this._leaveMutex.lock(),this.connectionState==="DISCONNECTED")return R.info("[".concat(this._clientId,"] Leaving channel repeated, success")),s(),n.onSuccess();await this._gateway.leave(this.connectionState!=="CONNECTED"),R.info("[".concat(this._clientId,"] Leaving channel success")),s(),n.onSuccess()}async publish(n,s=!0){var c,u;ro(n)||(n=[n]);let h=z.reportApiInvoke(this._sessionId,{name:Re.PUBLISH,options:Ie(n).call(n,f=>f?Object(f).toString():"null"),tag:Te.TRACER});if(n.length===0)return n=new L(D.INVALID_PARAMS,"track list is empty"),h.onError(n),n.throw();if(this._gateway.role==="audience")return n=new L(D.INVALID_OPERATION,"audience can not publish stream"),h.onError(n),n.throw();for(let f of n){if(!(f instanceof cd))return n=new L(D.INVALID_PARAMS,"pamameter is not local track"),h.onError(n),n.throw();if(!f._enabled&&s)return n=new L(D.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(f.getTrackId())),h.onError(n),n.throw()}if(R.info(b(c="[".concat(this._clientId,"] Publishing tracks, id ")).call(c,Ie(n).call(n,f=>"".concat(f.getTrackId()," ")))),await this._configDistribute.awaitConfigDistributeComplete(),s&&K(n).call(n,f=>{var A;let m=this._configDistribute.getBitrateLimit();var I;f instanceof Jt&&m&&f.setBitrateLimit(m.uplink),Ke(A=this._bindEnabledTracks).call(A,f)===-1&&(f.addListener(Be.NEED_ADD_TRACK,this._handleLocalTrackEnable),f.addListener(Be.NEED_REMOVE_TRACK,this._handleLocalTrackDisable),this._bindEnabledTracks.push(f),Or()&&f.muted&&R.debug(b(I="[".concat(this._clientId,"] on firefox publish a muted track ")).call(I,f.getTrackId(),", skip the pub operation and wait unmute")))}),Or()&&(n=Qe(n).call(n,f=>!f.muted)).length===0)return void h.onSuccess(Ie(n).call(n,f=>f.trackMediaType+":"+f.getTrackLabel()).toString());c=await this._publishMutex.lock();try{let f=await this._publishHighStream(n),A=(f.audioTrack,f.videoTrack);this._isDualStreamEnabled&&A&&!this._lowStream&&await this._publishLowStream(A),c(),h.onSuccess(Ie(n).call(n,m=>m.trackMediaType+":"+m.getTrackLabel()).toString())}catch(f){throw c(),s&&K(n).call(n,A=>{var m,I;let E=Ke(m=this._bindEnabledTracks).call(m,A);E!==-1&&(A.off(Be.NEED_ADD_TRACK,this._handleLocalTrackEnable),A.off(Be.NEED_REMOVE_TRACK,this._handleLocalTrackDisable),Jr(I=this._bindEnabledTracks).call(I,E,1))}),h.onError(f),R.error("[".concat(this._clientId,"] publish error"),f.toString()),f}R.info(b(u="[".concat(this._clientId,"] Publish success, id ")).call(u,Ie(n).call(n,f=>"".concat(f.getTrackId()," "))))}async unpublish(n,s=!0){var c;let u=await this._publishMutex.lock(),h,f,A;try{var m,I;if(!this._highStream||(h=this._highStream.getAllTracks(),n?ro(n)||(n=[n]):n=this._highStream.getAllTracks(),f=function(E,_){if(E.length!==_.length)return!1;for(let S=0;S<E.length;S+=1){let N=E[S];if(Qe(E).call(E,O=>O===N).length!==Qe(_).call(_,O=>O===N).length)return!1}return!0}(h,n),A=z.reportApiInvoke(this._sessionId,{name:Re.UNPUBLISH,options:Ie(n).call(n,E=>E.getTrackId()),tag:Te.TRACER}),R.info(b(m=b(I="[".concat(this._clientId,"] Unpublish tracks, tracks ")).call(I,Ie(n).call(n,E=>"".concat(E.getTrackId()," ")),", isClosePC: ")).call(m,f)),!this._highStream))return R.warning("[".concat(this._clientId,"] Could not find tracks to unpublish")),void(u&&u())}catch(E){throw u&&u(),E}try{this._lowStream&&0<Qe(n).call(n,E=>E.trackMediaType==="video").length&&(await this._lowStream.closeP2PConnection(),this._lowStream=void 0),f?await this._highStream.closeP2PConnection():await this._highStream.removeTracks(n,s),u&&u()}catch(E){if(E.code!==D.OPERATION_ABORTED)throw A.onError(E),R.error("[".concat(this._clientId,"] unpublish error"),E.toString()),u&&u(),E;R.debug("[".concat(this._clientId,"] ignore unpub operation abort")),u&&u()}this._highStream&&this._highStream.connectionState==="disconnected"&&(this._highStream=void 0,this._lowStream=void 0),s&&K(n).call(n,E=>{var _,S;let N=Ke(_=this._bindEnabledTracks).call(_,E);N!==-1&&(E.off(Be.NEED_ADD_TRACK,this._handleLocalTrackEnable),E.off(Be.NEED_REMOVE_TRACK,this._handleLocalTrackDisable),Jr(S=this._bindEnabledTracks).call(S,N,1))}),R.info(b(c="[".concat(this._clientId,"] Unpublish success,tracks ")).call(c,Ie(n).call(n,E=>"".concat(E.getTrackId())))),A.onSuccess()}async subscribe(n,s){var c,u,h,f;yr(s,"mediaType",["audio","video"]);let A=z.reportApiInvoke(this._sessionId,{name:Re.SUBSCRIBE,options:[n.uid,s],tag:Te.TRACER});if(!this._joinInfo)throw s=new L(D.INVALID_OPERATION,"Can't subscribe stream, not joined"),A.onError(s),s;if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw s=new L(D.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state")),A.onError(s),s;if(!Xe(c=this._users).call(c,O=>O===n)){var m;throw s=new L(D.INVALID_REMOTE_USER,"user is not in the channel"),R.error(b(m="[".concat(this._clientId,"] can not subscribe ")).call(m,n.uid,", this user is not in the channel")),A.onError(s),s}if(!n.hasAudio&&!n.hasVideo){var I;throw s=new L(D.INVALID_REMOTE_USER,"user is not published"),R.error(b(I="[".concat(this._clientId,"] can not subscribe ")).call(I,n.uid,", user is not published")),A.onError(s),s}if(m={audio:s==="audio",video:s==="video"},!n.hasAudio&&m.audio||!n.hasVideo&&m.video){var E,_,S=new L(D.REMOTE_USER_IS_NOT_PUBLISHED);throw R.error(b(E=b(_="[".concat(this._clientId,"] can not subscribe ")).call(_,n.uid," with mediaType ")).call(E,s,", remote track is not published")),A.onError(S),S}(E=this._subscribeMutex.get(n.uid))||(E=new Xo("sub-".concat(n.uid)),this._subscribeMutex.set(n.uid,E)),R.info(b(u=b(h="[".concat(this._clientId,"] subscribe user ")).call(h,n.uid,", mediaType: ")).call(u,s)),u=await E.lock(),h=this._remoteStream.get(n.uid);try{if(h)m.audio=m.audio||h.subscribeOptions.audio,m.video=m.video||h.subscribeOptions.video,await this._gateway.subscribeChange(h,m);else{h=new ON(n,this._statsCollector,this._joinInfo,m),this._remoteStream.set(n.uid,h);try{await this._gateway.subscribe(h)}catch(O){throw this._remoteStream.delete(n.uid),O}h.on(ke.CONNECTION_STATE_CHANGE,(O,B)=>{O==="connecting"?this.emit(ze.MEDIA_RECONNECT_START,n.uid):O==="connected"&&this.emit(ze.MEDIA_RECONNECT_END,n.uid)})}u()}catch(O){var N;throw A.onError(O),u(),R.error(b(N="[".concat(this._clientId,"] subscribe user ")).call(N,n.uid," error"),O),O}return R.info(b(S=b(f="[".concat(this._clientId,"] subscribe success user ")).call(f,n.uid,", mediaType: ")).call(S,s)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(n.uid,this._defaultStreamFallbackType).catch(O=>{R.warning("[".concat(this._clientId,"] auto set fallback failed"),O)}),s=s==="audio"?n.audioTrack:n.videoTrack,s?(A.onSuccess(s.getTrackId()),s):(s=new L(D.UNEXPECTED_ERROR,"can not find remote track in user object"),A.onError(s),s.throw())}async unsubscribe(n,s){var c,u,h,f,A;s&&yr(s,"mediaType",["audio","video"]);let m=z.reportApiInvoke(this._sessionId,{name:Re.UNSUBSCRIBE,options:[n.uid,s],tag:Te.TRACER});if(!Xe(c=this._users).call(c,S=>S===n)){var I;throw s=new L(D.INVALID_REMOTE_USER,"user is not in the channel"),R.error(b(I="[".concat(this._clientId,"] can not subscribe ")).call(I,n.uid,", user is not in the channel")),m.onError(s),s}R.info(b(u=b(h="[".concat(this._clientId,"] unsubscribe uid: ")).call(h,n.uid,", mediaType: ")).call(u,s)),(I=this._subscribeMutex.get(n.uid))||(I=new Xo("sub-".concat(n.uid)),this._subscribeMutex.set(n.uid,I)),I=await I.lock(),c=this._remoteStream.get(n.uid);var E;if(!c)return R.warning(b(E="[".concat(this._clientId,"]: you have not subscribe the remote user ")).call(E,n.uid)),m.onSuccess(),void I();E=Ua({},c.subscribeOptions),s==="audio"?E.audio=!1:s==="video"?(E.video=!1,c.pc._statsFilter.setVideoIsReady(!1)):(E.audio=!1,E.video=!1);try{E.audio||E.video?await this._gateway.subscribeChange(c,E):(await c.closeP2PConnection(),this._remoteStream.delete(n.uid)),I()}catch(S){var _;if(S.code!==D.OPERATION_ABORTED)throw m.onError(S),I(),R.error(b(_="[".concat(this._clientId,"] unsubscribe user ")).call(_,n.uid," error"),S.toString()),S;I(),R.debug("[".concat(this._clientId,"] ignore unsub operation abort"))}R.info(b(f=b(A="[".concat(this._clientId,"] unsubscribe success uid: ")).call(A,n.uid,", mediaType: ")).call(f,s)),m.onSuccess()}setLowStreamParameter(n){if(!n)throw new L(D.INVALID_PARAMS);n.width==null||St(n.width,"streamParameter.width"),n.height==null||St(n.height,"streamParameter.height"),n.framerate==null||St(n.framerate,"streamParameter.framerate"),n.bitrate==null||St(n.bitrate,"streamParameter.bitrate");let s=z.reportApiInvoke(this._sessionId,{name:Re.SET_LOW_STREAM_PARAMETER,options:[n],tag:Te.TRACER});(!n.width&&n.height||n.width&&!n.height)&&R.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),R.info("[".concat(this._clientId,"] set low stream parameter to"),fe(n));let c=this._configDistribute.getLowStreamConfigDistribute();c&&c.bitrate&&n.bitrate&&c.bitrate<n.bitrate&&(n.bitrate=c.bitrate),this._lowStreamParameter=n,s.onSuccess()}async enableDualStream(){let n=z.reportApiInvoke(this._sessionId,{name:Re.ENABLE_DUAL_STREAM,options:[],tag:Te.TRACER});if(!Pt.supportDualStream){z.streamSwitch(this._sessionId,{lts:le(),isdual:!0,succ:!1});var s=new L(D.NOT_SUPPORTED,"Your browser is not support dual stream");throw n.onError(s),s}if(this._isDualStreamEnabled)throw s=new L(D.INVALID_OPERATION,"Dual stream is already enabled"),n.onError(s),s;if(this._highStream&&this._highStream.connectionState==="connected"&&this._highStream.videoTrack)try{await this._publishLowStream(this._highStream.videoTrack)}catch(c){throw z.streamSwitch(this._sessionId,{lts:le(),isdual:!0,succ:!1}),n.onError(c),c}this._isDualStreamEnabled=!0,z.streamSwitch(this._sessionId,{lts:le(),isdual:!0,succ:!0}),R.info("[".concat(this._clientId,"] enable dual stream")),n.onSuccess()}async disableDualStream(){let n=z.reportApiInvoke(this._sessionId,{name:Re.DISABLE_DUAL_STREAM,options:[],tag:Te.TRACER});if(this._lowStream)try{await this._lowStream.closeP2PConnection()}catch(s){throw z.streamSwitch(this._sessionId,{lts:le(),isdual:!1,succ:!1}),n.onError(s),s}this._lowStream=void 0,this._isDualStreamEnabled=!1,this._highStream&&(this._highStream.lowStreamConnection=void 0),z.streamSwitch(this._sessionId,{lts:le(),isdual:!1,succ:!0}),R.info("[".concat(this._clientId,"] disable dual stream")),n.onSuccess()}async setClientRole(n,s){yr(n,"role",["audience","host"]),s&&lm(s);let c=z.reportApiInvoke(this._sessionId,{name:Re.SET_CLIENT_ROLE,options:[n,s],tag:Te.TRACER});if(this._mode==="rtc")return R.warning("[".concat(this._clientId,"]rtc mode can not use setClientRole")),n=new L(D.INVALID_OPERATION,"rtc mode can not use setClientRole"),c.onError(n),n.throw();if(s&&s.level&&n==="host")return n=new L(D.INVALID_OPERATION,"host mode can not set audience latency level"),c.onError(n),n.throw();try{var u,h;if(n==="audience"&&this._highStream){let f=new L(D.INVALID_OPERATION,"can not set client role to audience when publishing stream");return c.onError(f),f.throw()}await this._gateway.setClientRole(n,s),R.info(b(u=b(h="[".concat(this._clientId,"] set client role to ")).call(h,n,", level: ")).call(u,s&&s.level)),c.onSuccess()}catch(f){throw c.onError(f),f}}setProxyServer(n){if(qr(n,"proxyServer"),this.connectionState!=="DISCONNECTED")throw new L(D.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new L(D.INVALID_OPERATION,"You have already set the proxy");this._proxyServer=n,z.setProxyServer(this._proxyServer),R.setProxyServer(this._proxyServer)}setTurnServer(n){if(ro(n)||(n=[n]),this.connectionState!=="DISCONNECTED")throw new L(D.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new L(D.INVALID_OPERATION,"You have already set the proxy");var s;if(am(n))return this._turnServer={servers:n,mode:"original-manual"},void R.info(b(s="[".concat(this._clientId,"] Set original turnserver success: ")).call(s,Ie(n).call(n,c=>c.urls).join(","),"."));K(n).call(n,c=>cm(c)),this._turnServer={servers:n,mode:"manual"},R.info("[".concat(this._clientId,"] Set turnserver success."))}startProxyServer(n){let s=z.reportApiInvoke(this._sessionId,{name:Re.START_PROXY_SERVER,options:[],tag:Te.TRACER});if(this.connectionState!=="DISCONNECTED")throw n=new L(D.INVALID_OPERATION,"Start proxy server before join channel"),s.onError(n),n;if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw n=new L(D.INVALID_OPERATION,"You have already set the proxy"),s.onError(n),n;let c=[1,2,3,4,5];switch(n===void 0&&(n=1),n){case 1:this._cloudProxyServerMode="normal";break;case 2:this._cloudProxyServerMode="443only";break;case 3:this._cloudProxyServerMode="proxy3";break;case 4:this._cloudProxyServerMode="proxy4";break;case 5:this._cloudProxyServerMode="proxy5";break;default:throw n=new L(D.INVALID_PARAMS,"proxy server mode must be ".concat(c.join("|"))),s.onError(n),n}R.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),s.onSuccess()}stopProxyServer(){let n=z.reportApiInvoke(this._sessionId,{name:Re.STOP_PROXY_SERVER,options:[],tag:Te.TRACER});if(this.connectionState!=="DISCONNECTED")throw new L(D.INVALID_OPERATION,"Stop proxy server after leave channel");z.setProxyServer(),R.setProxyServer(),this._cloudProxyServerMode="disabled",R.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]},n.onSuccess()}setLocalAccessPoints(n,s){if(Lh(n,"serverList"),qr(s,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new L(D.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");let c=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;n=Ie(n).call(n,u=>{var h;return c.test(u)?b(h="".concat(u.replace(/\./g,"-"),".")).call(h,s):u}),this._useLocalAccessPoint=!0,Yr("WEBCS_DOMAIN",n),Yr("WEBCS_DOMAIN_BACKUP_LIST",n),Yr("GATEWAY_DOMAINS",[s]),Yr("EVENT_REPORT_DOMAIN",n[0]),Yr("EVENT_REPORT_BACKUP_DOMAIN",n[1]||n[0]),Yr("LOG_UPLOAD_SERVER","".concat(n[0],":6444")),R.info("set local access point success")}async setRemoteVideoStreamType(n,s){var c,u;yr(s,"streamType",[0,1]);let h=z.reportApiInvoke(this._sessionId,{name:Re.SET_REMOTE_VIDEO_STREAM_TYPE,options:[n,s],tag:Te.TRACER});try{await this._gateway.setRemoteVideoStreamType(n,s),gi(()=>{var f;let A=Xe(f=this._users).call(f,m=>m.uid===n);A&&A.videoTrack&&A.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(f){throw h.onError(f),R.error("[".concat(this._clientId,"] set remote video stream type error"),f.toString()),f}R.info(b(c=b(u="[".concat(this._clientId,"] set remote ")).call(u,n," video stream type to ")).call(c,s)),this._remoteStreamTypeCacheMap.set(n,s),h.onSuccess()}async setStreamFallbackOption(n,s){var c,u;yr(s,"fallbackType",[0,1,2]);let h=z.reportApiInvoke(this._sessionId,{name:Re.SET_STREAM_FALLBACK_OPTION,options:["too long to show",s],tag:Te.TRACER});try{await this._gateway.setStreamFallbackOption(n,s)}catch(f){throw h.onError(f),R.error("[".concat(this._clientId,"] set stream fallback option"),f.toString()),f}R.info(b(c=b(u="[".concat(this._clientId,"] set remote ")).call(u,n," stream fallback type to ")).call(c,s)),this._streamFallbackTypeCacheMap.set(n,s),h.onSuccess()}setEncryptionConfig(n,s,c){yr(n,"encryptionMode","aes-128-xts aes-256-xts aes-128-ecb sm4-128-ecb aes-128-gcm aes-256-gcm aes-128-gcm2 aes-256-gcm2 none".split(" ")),qr(s,"secret");let u=["aes-128-gcm2","aes-256-gcm2"];if(vt(u).call(u,n)){if(!(c&&c instanceof Uint8Array&&c.length===32))throw new L(D.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(c)throw new L(D.INVALID_PARAMS,"current encrypt mode does not need salt");/^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\[\]])(?=.{8,})/.test(s)||R.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=n,this._encryptionSecret=s,c&&(this._encryptionSalt=wu(c))}async renewToken(n){qr(n,"token",1,2047);let s=z.reportApiInvoke(this._sessionId,{name:Re.RENEW_TOKEN,options:[n],tag:Te.TRACER});if(!this._key)return n=new L(D.INVALID_OPERATION,"renewToken should not be called before user join"),s.onError(n),n.throw();this._key=n;try{await this._gateway.renewToken(n)}catch(c){throw s.onError(c),R.error("[".concat(this._clientId,"] renewToken failed"),c.toString()),c}R.debug("[".concat(this._clientId,"] renewToken success")),s.onSuccess()}enableAudioVolumeIndicator(){let n=z.reportApiInvoke(this._sessionId,{name:Re.ENABLE_AUDIO_VOLUME_INDICATOR,options:[],tag:Te.TRACER});if(this._audioVolumeIndicationInterval)return R.warning("you have already enabled audio volume indicator!"),n.onSuccess();this._audioVolumeIndicationInterval=window.setInterval(()=>{var s,c,u;let h=ul(s=Ie(c=oo(ca(u=this._remoteStream).call(u))).call(c,f=>({level:f.user.audioTrack?100*f.user.audioTrack._source.getAccurateVolumeLevel():0,uid:f.getUserId()}))).call(s,(f,A)=>f.level-A.level);this._highStream&&this._highStream.audioTrack&&(h.push({level:100*this._highStream.audioTrack._source.getAccurateVolumeLevel(),uid:this._highStream._userId}),h=ul(h).call(h,(f,A)=>f.level-A.level)),this.emit(ze.VOLUME_INDICATOR,h)},te.AUDIO_VOLUME_INDICATION_INTERVAL||2e3),n.onSuccess()}getRTCStats(){let n=this._statsCollector.getRTCStats(),s=this._gateway.getInChannelInfo();return n.Duration=Math.round(s.duration/1e3),n}startLiveStreaming(n,s){let c=z.reportApiInvoke(this._sessionId,{name:Re.START_LIVE_STREAMING,options:[n,s],tag:Te.TRACER});if(!s){if(this._codec!=="h264")return n=new L(D.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264"),c.onError(n),se.reject(n);if(!this._highStream)return n=new L(D.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming"),c.onError(n),se.reject(n)}return this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(n)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(n)?(n=new L(D.LIVE_STREAMING_TASK_CONFLICT),c.onError(n),se.reject(n)):(s=s?nr.TRANSCODE:nr.RAW,this._createLiveStreamingClient(s).startLiveStreamingTask(n,s).then(()=>c.onSuccess()).catch(u=>{throw c.onError(u),u}))}setLiveTranscoding(n){let s=z.reportApiInvoke(this._sessionId,{name:Re.SET_LIVE_TRANSCODING,options:[n],tag:Te.TRACER});return this._createLiveStreamingClient(nr.TRANSCODE).setTranscodingConfig(n).then(()=>s.onSuccess()).catch(c=>{throw s.onError(c),c})}stopLiveStreaming(n){var s;let c=z.reportApiInvoke(this._sessionId,{name:Re.STOP_LIVE_STREAMING,options:[n],tag:Te.TRACER}),u=Qe(s=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient]).call(s,h=>h&&h.hasUrl(n));return u.length?se.all(Ie(u).call(u,h=>h&&h.stopLiveStreamingTask(n))).then(()=>c.onSuccess()).catch(h=>{throw c.onError(h),h}):(s=new L(D.INVALID_PARAMS,"can not find live streaming url to stop"),c.onError(s),se.reject(s))}async addInjectStreamUrl(n,s){let c=z.reportApiInvoke(this._sessionId,{name:Re.ADD_INJECT_STREAM_URL,options:[n,s],tag:Te.TRACER});try{if(!this._joinInfo)throw new L(D.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");let u=this._createLiveStreamingClient(nr.INJECT);u.setInjectStreamConfig(s,0),await u.startLiveStreamingTask(n,nr.INJECT)}catch(u){throw c.onError(u),u}c.onSuccess()}async removeInjectStreamUrl(){let n=z.reportApiInvoke(this._sessionId,{name:Re.REMOVE_INJECT_STREAM_URL,options:[],tag:Te.TRACER});try{var s,c;let u=this._createLiveStreamingClient(nr.INJECT),h=Xe(s=oo(ca(c=u.streamingTasks).call(c))).call(s,f=>f.mode===nr.INJECT);if(!this._joinInfo||!h)throw new L(D.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");await u.stopLiveStreamingTask(h.url)}catch(u){throw n.onError(u),u}n.onSuccess()}async startChannelMediaRelay(n){let s=z.reportApiInvoke(this._sessionId,{name:Re.START_CHANNEL_MEDIA_RELAY,options:[n],tag:Te.TRACER});try{qm(n),await this._createChannelMediaRelayClient().startChannelMediaRelay(n)}catch(c){return s.onError(c),c.throw()}s.onSuccess()}async updateChannelMediaRelay(n){let s=z.reportApiInvoke(this._sessionId,{name:Re.UPDATE_CHANNEL_MEDIA_RELAY,options:[n],tag:Te.TRACER});try{qm(n),await this._createChannelMediaRelayClient().updateChannelMediaRelay(n)}catch(c){return s.onError(c),c.throw()}s.onSuccess()}async stopChannelMediaRelay(){let n=z.reportApiInvoke(this._sessionId,{name:Re.STOP_CHANNEL_MEDIA_RELAY,options:[],tag:Te.TRACER});try{await this._createChannelMediaRelayClient().stopChannelMediaRelay()}catch(s){return n.onError(s),s.throw()}n.onSuccess()}sendStreamMessage(n,s=!0){if(!this._joinInfo)throw new L(D.INVALID_OPERATION,"can not send data stream, not joined");if(typeof n=="string"&&(n=new TextEncoder().encode(n)),1024<new Blob([n]).size)throw new L(D.INVALID_PARAMS,"stream message out of range.");return this._gateway.signal.request(kt.DATA_STREAM,{payload:wu(n)},!s)}sendMetadata(n){if(!this._joinInfo)throw new L(D.INVALID_OPERATION,"can not send metadata, not joined");if(1024<new Blob([n]).size)throw new L(D.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(kt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:wu(n)})}async sendCustomReportMessage(n){ro(n)||(n=[n]),K(n).call(n,dT);let s=z.reportApiInvoke(this._sessionId,{name:Re.SEND_CUSTOM_REPORT_MESSAGE,options:[fe(n)],tag:Te.TRACER});if(!this._joinInfo)return n=new L(D.INVALID_OPERATION,"can not send custom report, not joined"),s.onError(n),n.throw();await z.sendCustomReportMessage(this._joinInfo.sid,n),s.onSuccess()}getLocalAudioStats(){if(!this._highStream)return id;let n=this._statsCollector.getLocalAudioTrackStats(this._highStream.connectionId);return Ws()&&this._highStream&&this._highStream.audioTrack&&(this._highStream.audioTrack instanceof un?!this._highStream.audioTrack.isActive:!this._highStream.audioTrack.enabled)&&(n.sendVolumeLevel=0),n}getRemoteAudioStats(){var n;let s={};return K(n=this._remoteStream).call(n,(c,u)=>{s[u]=this._statsCollector.getRemoteAudioTrackStats(c.connectionId)}),s}getLocalVideoStats(){return this._highStream?this._statsCollector.getLocalVideoTrackStats(this._highStream.connectionId):od}getRemoteVideoStats(){var n;let s={};return K(n=this._remoteStream).call(n,(c,u)=>{s[u]=this._statsCollector.getRemoteVideoTrackStats(c.connectionId)}),s}getRemoteNetworkQuality(){var n;let s={};return K(n=this._remoteStream).call(n,(c,u)=>{s[u]=this._statsCollector.getRemoteNetworkQualityStats(c.connectionId)}),s}async pickSVCLayer(n,s){yr(s.spatialLayer,"spatialLayer",[0,1,2,3]),yr(s.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(n,s)}catch(c){throw R.error("[".concat(this._clientId,"] pick SVC layer failed"),c.toString()),c}}_reset(){var n,s,c;R.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=To.CancelToken.source(),this._streamFallbackTypeCacheMap=new Tt,this._remoteStreamTypeCacheMap=new Tt,this._configDistribute.stopGetConfigDistribute(),this._defaultStreamFallbackType=this._proxyServer=this._joinInfo=void 0,this._sessionId=null,this._statsCollector.reset(),this._channelName=this._uid=this._appId=this._key=void 0,this._encryptionMode="none",this._encryptionSalt=this._encryptionSecret=null,K(n=this._users).call(n,u=>{u.audioTrack&&(u.audioTrack.stop(),u.audioTrack._isDestroyed=!0),u.videoTrack&&(u.videoTrack.stop(),u.videoTrack._isDestroyed=!0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._highStream&&(this._highStream.closeP2PConnection(!0),this._highStream=void 0),K(s=this._bindEnabledTracks).call(s,u=>{u.off(Be.NEED_ADD_TRACK,this._handleLocalTrackEnable),u.off(Be.NEED_REMOVE_TRACK,this._handleLocalTrackDisable)}),this._bindEnabledTracks=[],this._lowStream&&(this._lowStream.closeP2PConnection(!0),this._lowStream=void 0),K(c=this._remoteStream).call(c,u=>{u.closeP2PConnection(!0)}),this._remoteStream=new Tt,this._publishMutex=new Xo("client-publish"),this._subscribeMutex=new Tt,this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0)}_startSession(n,s){var c,u,h;let f=n||or(32,"").toUpperCase();n?R.debug(b(c="[".concat(this._clientId,"] new Session ")).call(c,f)):R.debug(b(u=b(h="[".concat(this._clientId,"] renewSession ")).call(h,this._sessionId," => ")).call(u,f)),this._sessionId=f,s?z.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:s.channel,appid:s.appId,mode:this._mode}):this._joinInfo?z.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:this._joinInfo.cname,appid:this._joinInfo.appId,mode:this._mode}):this._gateway.joinInfo&&z.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId,mode:this._mode}),this._joinInfo&&(this._joinInfo.sid=f),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=f)}async _publishHighStream(n){if(!this._joinInfo)throw new L(D.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new L(D.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&te.FORCE_TURN&&!te.TURN_ENABLE_TCP&&!te.TURN_ENABLE_UDP)throw new L(D.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");if(R.debug("[".concat(this._clientId,"] publish high stream")),this._highStream)return await this._highStream.addTracks(n),this._highStream;this._highStream=new zI(this._statsCollector,this._joinInfo,this._codec),this._highStream.on(ke.P2P_LOST,()=>{this._highStream&&this.emit(ze.P2P_LOST,this._highStream.getUserId())}),await this._highStream.addTracks(n);try{await this._gateway.publish(this._highStream,"high")}catch(s){throw this._highStream=void 0,s}return this._highStream.on(ke.CONNECTION_STATE_CHANGE,(s,c)=>{this._highStream&&(s==="connected"?this.emit(ze.MEDIA_RECONNECT_END,this._highStream.getUserId()):s==="connecting"&&this.emit(ze.MEDIA_RECONNECT_START,this._highStream.getUserId()))}),this._highStream}async _publishLowStream(n){if(!this._joinInfo)throw new L(D.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new L(D.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(!this._highStream||this._highStream.connectionState!=="connected")throw new L(D.UNEXPECTED_ERROR,"Could not find high stream");if(this._lowStream)return new L(D.UNEXPECTED_ERROR,"[".concat(this._clientId,"] Can't publish low stream when stream already publish")).throw();R.debug("[".concat(this._clientId,"] publish low stream")),this._lowStream=new zI(this._statsCollector,this._joinInfo,this._codec,!0);let s=this._configDistribute.getLowStreamConfigDistribute();s&&s.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&s.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=s.bitrate)),this._lowStream.lowStreamParameter=this._lowStreamParameter,await this._lowStream.addTracks([n]);try{await this._gateway.publish(this._lowStream,"low")}catch(c){throw this._lowStream=void 0,c}this._highStream.lowStreamConnection=this._lowStream}_createLiveStreamingClient(n){if(!this._joinInfo||!this._appId)return new L(D.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();let s=()=>new bN(this._joinInfo,this._config.websocketRetryConfig||Mr,this._config.httpRetryConfig||Mr),c=u=>{u.onLiveStreamError=(h,f)=>{z.reportApiInvoke(this._sessionId,{name:Re.ON_LIVE_STREAM_ERROR,options:[h,f],tag:Te.TRACER}).onSuccess(),this.emit(ze.LIVE_STREAMING_ERROR,h,f)},u.onLiveStreamWarning=(h,f)=>{z.reportApiInvoke(this._sessionId,{name:Re.ON_LIVE_STREAM_WARNING,options:[h,f],tag:Te.TRACER}).onSuccess(),this.emit(ze.LIVE_STREAMING_WARNING,h,f)},u.on(ic.REQUEST_WORKER_MANAGER_LIST,(h,f,A)=>{if(!this._joinInfo)return A(new L(D.INVALID_OPERATION,"can not find join info to get worker manager"));Mm(h,this._joinInfo,this._axiosCancelSource.token,Mr).then(f).catch(A)})};switch(n){case nr.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=s(),c(this._liveRawStreamingClient)),this._liveRawStreamingClient;case nr.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=s(),c(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case nr.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=s(),this._injectStreamingClient.on(ic.REQUEST_WORKER_MANAGER_LIST,(u,h,f)=>{if(!this._joinInfo)return f(new L(D.INVALID_OPERATION,"can not find join info to get worker manager"));Mm(u,this._joinInfo,this._axiosCancelSource.token,Mr).then(h).catch(f)}),this._injectStreamingClient.onInjectStatusChange=(u,h,f)=>{this.emit(ze.INJECT_STREAM_STATUS,u,h,f)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){return this._joinInfo?(this._channelMediaRelayClient||(this._channelMediaRelayClient=new BN(this._joinInfo,this._clientId,this._config.websocketRetryConfig||Mr,this._config.httpRetryConfig||Mr),this._channelMediaRelayClient.on("state",n=>{n==="RELAY_STATE_FAILURE"&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.emit(ze.CHANNEL_MEDIA_RELAY_STATE,n)}),this._channelMediaRelayClient.on("event",n=>{this.emit(ze.CHANNEL_MEDIA_RELAY_EVENT,n)})),this._channelMediaRelayClient):new L(D.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw()}_handleGatewayEvents(){this._gateway.on(Dr.DISCONNECT_P2P,()=>{var n;R.debug("[".concat(this._clientId,"] start full reconnect")),this._highStream&&this._highStream.connectionState!=="disconnected"&&(R.debug("[".concat(this._clientId,"] ready to reconnect high stream")),this._highStream.readyToReconnectPC()),this._lowStream&&this._lowStream.connectionState!=="disconnected"&&(R.debug("[".concat(this._clientId,"] ready to reconnect low stream")),this._lowStream.readyToReconnectPC()),K(n=this._remoteStream).call(n,(s,c)=>{var u;R.debug(b(u="[".concat(this._clientId,"] ready to reconnect remote stream ")).call(u,c)),s.readyToReconnectPC()})}),this._gateway.on(Dr.CONNECTION_STATE_CHANGE,(n,s,c)=>{var u,h;let f=()=>{this.emit(ze.CONNECTION_STATE_CHANGE,n,s,c)};if(R.info(b(u=b(h="[".concat(this._clientId,"] connection state change: ")).call(h,s," -> ")).call(u,n)),n==="DISCONNECTED")return this._reset(),void f();var A,m;if(n==="RECONNECTING")this._highStream&&this._highStream.connectionState==="connecting"&&(R.debug("[".concat(this._clientId,"] ready to reconnect high stream")),this._highStream.readyToReconnectPC()),this._lowStream&&this._lowStream.connectionState==="connecting"&&(R.debug("[".concat(this._clientId,"] ready to reconnect low stream")),this._lowStream.readyToReconnectPC()),K(A=this._remoteStream).call(A,(_,S)=>{var N;_.connectionState==="connecting"&&(R.debug(b(N="[".concat(this._clientId,"] ready to reconnect remote stream ")).call(N,S)),_.readyToReconnectPC())}),K(m=this._users).call(m,_=>{_._trust_in_room_=!1,_._trust_audio_enabled_state_=!1,_._trust_video_enabled_state_=!1,_._trust_audio_mute_state_=!1,_._trust_video_mute_state_=!1,_._trust_stream_added_state_=!1}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._streamRemovedTimeout=this._userOfflineTimeout=void 0;else if(n==="CONNECTED"){var I,E;K(I=this._streamFallbackTypeCacheMap).call(I,(_,S)=>{this._gateway.setStreamFallbackOption(S,_).catch(N=>R.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),N))}),K(E=this._remoteStreamTypeCacheMap).call(E,(_,S)=>{this._gateway.setRemoteVideoStreamType(S,_).catch(N=>R.warning("[".concat(this._clientId,"] auto set remote stream type failed"),N))}),this._highStream&&this._highStream.connectionState==="connecting"?this._highStream.reconnectPC().then(()=>{this._lowStream&&this._lowStream.connectionState==="connecting"&&this._lowStream.reconnectPC().catch(_=>{R.error("[".concat(this._clientId,"] republish low stream error"),_.toString()),this.emit(ze.ERROR,{reason:_})})}).catch(_=>{R.error("[".concat(this._clientId,"] republish high stream error"),_.toString()),this.emit(ze.ERROR,{reason:_})}):this._lowStream&&this._lowStream.connectionState==="connecting"&&this._lowStream.reconnectPC().catch(_=>{R.error("[".concat(this._clientId,"] republish low stream error"),_.toString()),this.emit(ze.ERROR,{reason:_})}),this._userOfflineTimeout=window.setTimeout(()=>{var _;if(this.connectionState==="CONNECTED"){this._userOfflineTimeout=void 0;var S=Qe(_=this._users).call(_,N=>!N._trust_in_room_);K(S).call(S,N=>{var O;R.debug(b(O="[".concat(this._clientId,"] user offline timeout, emit user offline ")).call(O,N.uid)),this._handleUserOffline({uid:N.uid})})}},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{var _;this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,K(_=this._users).call(_,S=>{var N,O,B,P,J;S._trust_audio_mute_state_||(R.debug(b(N="[".concat(this._clientId,"] auto dispatch audio unmute event ")).call(N,S.uid)),this._handleMuteStream(S.uid,"audio",!1)),S._trust_video_mute_state_||(R.debug(b(O="[".concat(this._clientId,"] auto dispatch video unmute event ")).call(O,S.uid)),this._handleMuteStream(S.uid,"video",!1)),S._trust_audio_enabled_state_||(R.debug(b(B="[".concat(this._clientId,"] auto dispatch enable local audio ")).call(B,S.uid)),this._handleSetStreamLocalEnable("audio",S.uid,!0)),!S._trust_video_enabled_state_&&S._video_enabled_&&(R.debug(b(P="[".concat(this._clientId,"] auto dispatch enable local video ")).call(P,S.uid)),this._handleSetStreamLocalEnable("video",S.uid,!0)),S._trust_stream_added_state_||(R.debug(b(J="[".concat(this._clientId,"] auto dispatch stream remove ")).call(J,S.uid)),this._handleRemoveStream({uid:S.uid,uint_id:S._uintid}))}))},1e3)}f()}),this._gateway.on(Dr.REQUEST_NEW_GATEWAY_LIST,(n,s)=>{if(!this._joinInfo)return s(new L(D.UNEXPECTED_ERROR,"can not recover, no join info"));zc(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Mr).then(c=>{var u;this._joinInfo&&(this._joinInfo.apResponse=c.gatewayInfo.res),n(Ie(u=c.gatewayInfo.gatewayAddrs).call(u,h=>{if(this._joinInfo&&this._joinInfo.proxyServer){var f,A;return h=h.split(":"),b(f=b(A="wss://".concat(this._joinInfo.proxyServer,"/ws/?h=")).call(A,h[0],"&p=")).call(f,h[1])}return"wss://".concat(h)}))}).catch(s)}),this._gateway.on(Dr.NETWORK_QUALITY,n=>{this._networkQualitySensitivity==="normal"&&this.emit(ze.NETWORK_QUALITY,n)}),this._gateway.on(Dr.STREAM_TYPE_CHANGE,(n,s)=>{this.emit(ze.STREAM_TYPE_CHANGED,n,s),z.reportApiInvoke(this._sessionId,{name:Re.STREAM_TYPE_CHANGE,options:[n,s],tag:Te.TRACER}).onSuccess(fe({uid:n,streamType:s}))}),this._gateway.on(Dr.IS_P2P_DISCONNECTED,n=>{var s,c,u;let h=[];return this._highStream&&h.push(this._highStream),K(s=this._remoteStream).call(s,f=>h.push(f)),h.length===0||Qe(h).call(h,f=>f.connectionState==="connected").length===0?n(!0):(R.debug(b(c="[".concat(this._clientId,"] ")).call(c,Ie(u=Qe(h).call(h,f=>f.connectionState==="connected")).call(u,f=>f.connectionId)," is connected")),void n(!1))}),this._gateway.on(Dr.NEED_RENEW_SESSION,()=>{this._startSession()}),this._gateway.signal.on(Et.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Et.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Et.ON_ADD_AUDIO_STREAM,n=>this._handleAddAudioOrVideoStream("audio",n.uid,n.uint_id)),this._gateway.signal.on(Et.ON_ADD_VIDEO_STREAM,n=>this._handleAddAudioOrVideoStream("video",n.uid,n.uint_id)),this._gateway.signal.on(Et.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Et.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Et.MUTE_AUDIO,n=>this._handleMuteStream(n.uid,"audio",!0)),this._gateway.signal.on(Et.UNMUTE_AUDIO,n=>this._handleMuteStream(n.uid,"audio",!1)),this._gateway.signal.on(Et.MUTE_VIDEO,n=>this._handleMuteStream(n.uid,"video",!0)),this._gateway.signal.on(Et.UNMUTE_VIDEO,n=>this._handleMuteStream(n.uid,"video",!1)),this._gateway.signal.on(Et.RECEIVE_METADATA,n=>{let s=jh(n.metadata);this.emit(ze.RECEIVE_METADATA,n.uid,s)}),this._gateway.signal.on(Et.ON_DATA_STREAM,n=>{n.seq&&delete n.seq,n.payload=jh(n.payload),this.emit(ze.STREAM_MESSAGE,n.uid,n.payload),this.onStreamMessage&&this.onStreamMessage(n)}),this._gateway.signal.on(Et.ON_CRYPT_ERROR,()=>{Jc(()=>{R.warning("[".concat(this._clientId,"] on crypt error")),this.emit(ze.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Et.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Et.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{R.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._reset(),this._gateway.leave(!0),this.emit(ze.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this._gateway.signal.on(Et.ON_STREAM_FALLBACK_UPDATE,n=>{var s,c;R.debug(b(s=b(c="[".concat(this._clientId,"] stream fallback peerId: ")).call(c,n.stream_id,", attr: ")).call(s,n.stream_type)),this.emit(ze.STREAM_FALLBACK,n.stream_id,n.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(Et.ON_PUBLISH_STREAM,n=>{var s;this.uid===this._uid&&(this._highStream&&this._highStream._waitingSuccessResponse&&this._highStream.connectionState==="connected"?(this._highStream.reportPublishEvent(!0,null,fe({proxy:n.proxy})),R.info(b(s="[".concat(this._clientId,"] on publish stream, ")).call(s,fe(n))),n.proxy!==void 0&&this.emit(ze.IS_USING_CLOUD_PROXY,!!n.proxy)):this._lowStream?this._lowStream.reportPublishEvent(!0,null,fe({proxy:n.proxy})):R.warning("get on_publish_stream message but cannot handle"))}),this._gateway.signal.on(Et.ENABLE_LOCAL_VIDEO,n=>{this._handleSetStreamLocalEnable("video",n.uid,!0)}),this._gateway.signal.on(Et.DISABLE_LOCAL_VIDEO,n=>{this._handleSetStreamLocalEnable("video",n.uid,!1)}),this._gateway.signal.on(Ze.REQUEST_TIMEOUT,(n,s)=>{if(this._joinInfo)switch(n){case kt.PUBLISH:var c;if(!s||(n=s.stream_type==="high"?this._highStream:this._lowStream,!n))break;s.state==="offer"&&z.publish(this._joinInfo.sid,{lts:n.startTime,succ:!1,ec:D.TIMEOUT,audio:s.audio,video:s.video,p2pid:s.p2p_id,publishRequestid:n.ID,screenshare:!(!n.videoTrack||Ke(c=n.videoTrack._hints).call(c,no.SCREEN_TRACK)===-1),audioName:n.audioTrack&&(n.audioTrack instanceof un?n.audioTrack.getSubTrackLabels().join(","):n.audioTrack.getTrackLabel()),videoName:n.videoTrack&&n.videoTrack.getTrackLabel()});break;case kt.SUBSCRIBE:(c=this._remoteStream.get(s.stream_id))&&s&&z.subscribe(this._joinInfo.sid,{lts:c.startTime,succ:!1,ec:D.TIMEOUT,audio:!!s.audio,video:!!s.video,peerid:s.stream_id,subscribeRequestid:c.ID,p2pid:c.pc.ID})}})}}wl([Kc({report:z}),Gn("design:type",Function),Gn("design:paramtypes",[String]),Gn("design:returntype",void 0)],hc.prototype,"setProxyServer",null),wl([Kc(),Gn("design:type",Function),Gn("design:paramtypes",[Object]),Gn("design:returntype",void 0)],hc.prototype,"setTurnServer",null),wl([Kc({report:z}),Gn("design:type",Function),Gn("design:paramtypes",[Array,String]),Gn("design:returntype",void 0)],hc.prototype,"setLocalAccessPoints",null),wl([Kc({report:z}),Gn("design:type",Function),Gn("design:paramtypes",[String,String,Uint8Array]),Gn("design:returntype",void 0)],hc.prototype,"setEncryptionConfig",null),wl([Uh({report:z}),Gn("design:type",Function),Gn("design:paramtypes",[Object,Object]),Gn("design:returntype",se)],hc.prototype,"pickSVCLayer",null);class UN extends T1{constructor(n,s={}){super();this.currentLoopCount=this.pausePlayTime=this.startPlayOffset=this.startPlayTime=0,this._currentState="stopped",this.audioBuffer=n,this.options=s,this.startPlayOffset=this.options.startPlayTime||0}set currentState(n){n!==this._currentState&&(this._currentState=n,this.emit(Qi.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer.duration}get currentTime(){return this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:(this.context.currentTime-this.startPlayTime+this.startPlayOffset)%this.audioBuffer.duration}updateOptions(n){this.currentState==="stopped"?(this.options=n,this.startPlayOffset=this.options.startPlayTime||0):R.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(n){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=n,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=n))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}startSourceNode(){var n;this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=fr(n=this.handleSourceNodeEnded).call(n,this))}createSourceNode(){let n=this.context.createBufferSource();return n.buffer=this.audioBuffer,n.loop=!!this.options.loop,n.connect(this.outputNode),n}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}let ZI=new Tt;var FN=Ft.setInterval;let VN=Je().name;class Nl{constructor(n,s){this.id=0,Nl.count+=1,this.id=Nl.count,this.element=n,this.context=s}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=n=>{let s=document.createElement("audio");s.srcObject=new MediaStream([n.track]),s.play(),this.audioPlayerElement=s}}async switchSdp(){if(this.peerPair){var n=async(c,u)=>(u=u==="offer"?await c.createOffer():await c.createAnswer(),await c.setLocalDescription(u),c.iceGatheringState==="complete"?c.localDescription:new se(h=>{c.onicegatheringstatechange=()=>{c.iceGatheringState==="complete"&&h(c.localDescription)}})),s=async(c,u)=>await c.setRemoteDescription(u);try{let c=await n(this.peerPair[0],"offer");await s(this.peerPair[1],c);let u=await n(this.peerPair[1],"answer");await s(this.peerPair[0],u)}catch(c){throw new L(D.LOCAL_AEC_ERROR,c.toString()).print()}}}async getTracksFromMediaElement(n){if(this.audioTrack)return this.audioTrack;let s;try{n instanceof HTMLVideoElement&&(n.captureStream?n.captureStream():n.mozCaptureStream()),s=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(n).connect(s)}catch(c){throw new L(D.LOCAL_AEC_ERROR,c.toString()).print()}if(!s)throw new L(D.LOCAL_AEC_ERROR,"no dest node when local aec").print();return n=s.stream.getAudioTracks()[0],this.audioTrack=n,n}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();let n=await this.getTracksFromMediaElement(this.element);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){var n;R.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&K(n=this.peerPair).call(n,s=>{s.close()}),this.audioPlayerElement=this.peerPair=void 0}}Nl.count=0;var bf=function(i,n){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,n)};let GN=window.AudioContext||window.webkitAudioContext;class eC{constructor(){this.units=[]}processExternalMediaAEC(n){var s;if(!this._doesEnvironmentNeedAEC())return R.debug("the system does not need to process local aec"),-1;this.context||(this.context=new GN);let c=Xe(s=this.units).call(s,u=>u&&u.getElement()===n);return c||(c=new Nl(n,this.context),this.units.push(c)),c.startEchoCancellation(),R.debug("start processing local audio echo cancellation, id is",c.id),c.id}_doesEnvironmentNeedAEC(){return Je().name!==$e.SAFARI}}(function(i,n,s,c){var u,h=arguments.length,f=3>h?n:c===null?c=ut(n,s):c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(i,n,s,c);else for(var A=i.length-1;0<=A;A--)(u=i[A])&&(f=(3>h?u(f):3<h?u(n,s,f):u(n,s))||f);return 3<h&&f&&ft(n,s,f),f})([Kc({report:z}),bf("design:type",Function),bf("design:paramtypes",[HTMLAudioElement]),bf("design:returntype",Number)],eC.prototype,"processExternalMediaAEC",null);let jN=new eC;var tC,rC,nC,iC;Yr("PROCESS_ID",b(tC=b(rC=b(nC=b(iC="process-".concat(or(8,""),"-")).call(iC,or(4,""),"-")).call(nC,or(4,""),"-")).call(rC,or(4,""),"-")).call(tC,or(12,""))),function(){let i=Je();var n=!!(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia);Pt.getDisplayMedia=n,Pt.getStreamFromExtension=i.name===$e.CHROME&&34<Number(i.version),Pt.supportUnifiedPlan=function(){if(!(window.RTCRtpTransceiver&&"currentDirection"in RTCRtpTransceiver.prototype))return!1;let s=new RTCPeerConnection,c=!1;try{s.addTransceiver("audio"),c=!0}catch{}return s.close(),c}(),Pt.supportMinBitrate=i.name===$e.CHROME||i.name===$e.EDGE,Pt.supportSetRtpSenderParameters=function(){let s=Je();return window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters?!!Gc()||!(!Ws()&&!vo())||s.name===$e.FIREFOX&&64<=Number(s.version):!1}(),i.name===$e.SAFARI&&(14<=Number(i.version)?Pt.supportDualStream=!0:Pt.supportDualStream=!1),Pt.webAudioMediaStreamDest=function(){let s=Je();return!(s.name===$e.SAFARI&&12>Number(s.version))}(),Pt.supportReplaceTrack=window.RTCRtpSender?typeof RTCRtpSender.prototype.replaceTrack=="function":!1,Pt.supportWebGL=typeof WebGLRenderingContext!="undefined",Pt.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Gc()||(Pt.webAudioWithAEC=!0),Pt.supportShareAudio=function(){let s=Je();return(s.os===ln.WIN_10||s.os===ln.WIN_81||s.os===ln.WIN_7||s.os===ln.LINUX||s.os===ln.MAC_OS)&&s.name===$e.CHROME&&74<=Number(s.version)}(),Pt.supportDualStreamEncoding=function(){let s=Je();return s.name==="Safari"&&14<=Number(s.version)}(),R.info("browser compatibility",fe(Pt),fe(i))}();let jn={__CLIENT_LIST__:qo,__TRACK_LIST__:Es,VERSION:ei,BUILD:"v4.7.2-0-gf83f608b(10/13/2021, 5:32:13 PM)",setParameter:Yr,getParameter:function(i){return te[i]},getSupportedCodec:async function(i){let n=null;return i?(n=new QI({}),n.addStream(i)):n=new UI({}),i=Fm(await n.createOfferSDP()),n.close(),i},checkSystemRequirements:function(){const i=z.reportApiInvoke(null,{name:Re.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Te.TRACER});var n=!1;try{var s=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,c=window.WebSocket;n=!!(window.RTCPeerConnection&&s&&c)}catch(u){return R.error("check system requirement failed: ",u),!1}return s=!1,c=Je(),c.name===$e.CHROME&&58<=Number(c.version)&&(Sn.engine.name!=="WebKit"||Ks())&&(s=!0),c.name===$e.FIREFOX&&56<=Number(c.version)&&(s=!0),c.name===$e.OPERA&&45<=Number(c.version)&&(s=!0),c.name===$e.SAFARI&&11<=Number(c.version)&&(s=!0),Je().name!==$e.WECHAT&&Je().name!==$e.QQ||(s=!0),R.debug("checkSystemRequirements, api:",n,"browser",s),n=n&&s,i.onSuccess(n),n},getDevices:function(i){return Vn.enumerateDevices(!0,!0,i)},getMicrophones:function(i){return Vn.getRecordingDevices(i)},getCameras:function(i){return Vn.getCamerasDevices(i)},getElectronScreenSources:Am,getPlaybackDevices:function(i){return Vn.getSpeakers(i)},createClient:function(i={codec:"vp8",mode:"rtc"}){const n=z.reportApiInvoke(null,{name:Re.CREATE_CLIENT,options:[i],tag:Te.TRACER});try{yr(i.codec,"config.codec",["vp8","vp9","av1","h264"]),yr(i.mode,"config.mode",["rtc","live"]),i.proxyServer!==void 0&&qr(i.proxyServer,"config.proxyServer",1,1e4),i.turnServer!==void 0&&cm(i.turnServer),i.httpRetryConfig!==void 0&&sm(i.httpRetryConfig),i.websocketRetryConfig!==void 0&&sm(i.websocketRetryConfig)}catch(s){throw n.onError(s),s}return n.onSuccess(),new hc(Ua({forceWaitGatewayResponse:!0},i,{role:i.mode==="rtc"?"host":i.role}))},createCameraVideoTrack:async function(i={encoderConfig:"480p_1"}){const n=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.CREATE_CAM_VIDEO_TRACK,options:[ep({},i)]}),s=Jh(i);var c=or(8,"track-cam-");let u=null;R.info("start create camera video track with config",fe(i),"trackId",c);try{u=(await Di({video:s},c)).getVideoTracks()[0]||null}catch(h){throw n.onError(h),h}return u?(i.optimizationMode&&tp(c,u,i,i.encoderConfig&&ds(i.encoderConfig)),i=new Sl(u,i,s,i.scalabiltyMode?Ma(i.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},i.optimizationMode,c),n.onSuccess(i.getTrackId()),R.info("create camera video success, trackId:",c),i):(c=new L(D.UNEXPECTED_ERROR,"can not find track in media stream"),n.onError(c),c.throw())},createCustomVideoTrack:function(i){const n=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.CREATE_CUSTOM_VIDEO_TRACK,options:[i]}),s=new Jt(i.mediaStreamTrack,{bitrateMax:i.bitrateMax,bitrateMin:i.bitrateMin},i.scalabiltyMode?Ma(i.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},i.optimizationMode);return n.onSuccess(s.getTrackId()),R.info("create custom video track success with config",i,"trackId",s.getTrackId()),s},createScreenVideoTrack:async function(i={},n="disable"){const s=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.CREATE_SCREEN_VIDEO_TRACK,options:[ep({},i),n]});i.encoderConfig?typeof i.encoderConfig=="string"||i.encoderConfig.width&&i.encoderConfig.height||(i.encoderConfig.width={max:1920},i.encoderConfig.height={max:1080}):i.encoderConfig="1080p_2";var c={};i.screenSourceType&&(c.mediaSource=i.screenSourceType),i.extensionId&&zi()&&(c.extensionId=i.extensionId),i.electronScreenSourceId&&(c.sourceId=i.electronScreenSourceId);var u=i.encoderConfig?jc(i.encoderConfig):null;u=(c.mandatory={chromeMediaSource:"desktop",maxWidth:u?u.width:void 0,maxHeight:u?u.height:void 0},u&&u.frameRate&&(typeof u.frameRate=="number"?(c.mandatory.maxFrameRate=u.frameRate,c.mandatory.minFrameRate=u.frameRate):(c.mandatory.maxFrameRate=u.frameRate.max||u.frameRate.ideal||u.frameRate.exact||void 0,c.mandatory.minFrameRate=u.frameRate.min||u.frameRate.ideal||u.frameRate.exact||void 0),c.frameRate=u.frameRate),u&&u.width&&(c.width=u.width),u&&u.height&&(c.height=u.height),c);const h=or(8,"track-scr");let f=null;c=null;const A=Pt;if(!A.supportShareAudio&&n==="enable")return i=new L(D.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio"),s.onError(i),i.throw();R.info("start create screen video track with config",i,"withAudio",n,"trackId",h);try{const m=await Di({screen:u,screenAudio:n==="auto"?A.supportShareAudio:n==="enable"},h);f=m.getVideoTracks()[0]||null,c=m.getAudioTracks()[0]||null}catch(m){throw s.onError(m),m}return f?!c&&n==="enable"?(f&&f.stop(),i=new L(D.SHARE_AUDIO_NOT_ALLOWED),s.onError(i),i.throw()):(i.optimizationMode||(i.optimizationMode="detail"),i.optimizationMode&&(tp(h,f,i,i.encoderConfig&&jc(i.encoderConfig)),i.encoderConfig&&typeof i.encoderConfig!="string"&&(i.encoderConfig.bitrateMin=i.encoderConfig.bitrateMax)),i=new Jt(f,i.encoderConfig?jc(i.encoderConfig):{},i.scalabiltyMode?Ma(i.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},i.optimizationMode,h),i._hints.push(no.SCREEN_TRACK),c?(n=new Lr(c),s.onSuccess([i.getTrackId(),n.getTrackId()]),R.info("create screen video track success","video:",i.getTrackId(),"audio:",n.getTrackId()),[i,n]):(s.onSuccess(i.getTrackId()),R.info("create screen video track success","video:",i.getTrackId()),i)):(i=new L(D.UNEXPECTED_ERROR,"can not find track in media stream"),s.onError(i),i.throw())},createMicrophoneAndCameraTracks:async function(i={},n={encoderConfig:"480p_1"}){var s,c,u;const h=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.CREATE_MIC_AND_CAM_TRACKS,options:[i,n]}),f=Jh(n),A=Qm(i),m=or(8,"track-mic-"),I=or(8,"track-cam-");let E=null,_=null;R.info(b(s=b(c=b(u="start create camera video track(".concat(I,") and microphone audio track(")).call(u,m,") with config, audio: ")).call(c,fe(i),", video: ")).call(s,fe(n)));try{var S;const O=await Di({audio:A,video:f},b(S="".concat(m,"-")).call(S,I));E=O.getAudioTracks()[0],_=O.getVideoTracks()[0]}catch(O){throw h.onError(O),O}if(!E||!_){var N=new L(D.UNEXPECTED_ERROR,"can not find tracks in media stream");return h.onError(N),N.throw()}return n.optimizationMode&&tp(I,_,n,n.encoderConfig&&ds(n.encoderConfig)),i=new gl(E,i,A,m),n=new Sl(_,n,f,n.scalabiltyMode?Ma(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,I),h.onSuccess([i.getTrackId(),n.getTrackId()]),R.info(b(N="create camera video track(".concat(I,") and microphone audio track(")).call(N,m,") success")),[i,n]},createMicrophoneAudioTrack:async function(i={}){const n=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.CREATE_MIC_AUDIO_TRACK,options:[i]}),s=Qm(i);var c=or(8,"track-mic-");let u=null;R.info("start create microphone audio track with config",fe(i),"trackId",c);try{u=(await Di({audio:s},c)).getAudioTracks()[0]||null}catch(h){throw n.onError(h),h}return u?(i=new gl(u,i,s,c),n.onSuccess(i.getTrackId()),R.info("create microphone audio track success, trackId:",c),i):(c=new L(D.UNEXPECTED_ERROR,"can not find track in media stream"),n.onError(c),c.throw())},createCustomAudioTrack:function(i){const n=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.CREATE_CUSTOM_AUDIO_TRACK,options:[i]}),s=new Lr(i.mediaStreamTrack,i.encoderConfig?La(i.encoderConfig):{});return R.info("create custom audio track success with config",i,"trackId",s.getTrackId()),n.onSuccess(s.getTrackId()),s},createBufferSourceAudioTrack:async function(i){const n=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.CREATE_BUFFER_AUDIO_TRACK,options:[i]}),s=or(8,"track-buf-");R.info("start create buffer source audio track with config",fe(i),"trackId",s);const c=i.source;if(!(i.source instanceof AudioBuffer))try{i.source=await wT(i.source,i.cacheOnlineFile)}catch(h){return n.onError(h),h.throw()}const u=new UN(i.source);return i=new sc(c,u,i.encoderConfig?La(i.encoderConfig):{},s),R.info("create buffer source audio track success, trackId:",s),n.onSuccess(i.getTrackId()),i},setLogLevel:function(i){R.setLogLevel(i)},enableLogUpload:function(){R.enableLogUpload()},disableLogUpload:function(){R.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new $I},checkAudioTrackIsActive:async function(i,n=5e3){const s=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[n]});if(!(i instanceof Lr||i instanceof Rl)){var c=new L(D.INVALID_TRACK,"the parameter is not a audio track");return s.onError(c),c.throw()}n&&1e3>n&&(n=1e3);const u=i instanceof Lr?i.getTrackLabel():"remote_track";let h=c=i.getVolumeLevel(),f=c;const A=le();return new se(m=>{const I=FN(()=>{var E=i.getVolumeLevel();h=E>h?E:h,f=E<f?E:f,E=1e-4<h-f;var _=le()-A;if(E||_>n){var S;clearInterval(I),_={duration:_,deviceLabel:u,maxVolumeLevel:h,result:E},R.info(b(S="[track-".concat(i.getTrackId(),"] check audio track active completed. ")).call(S,fe(_))),s.onSuccess(_),m(E)}},200)})},checkVideoTrackIsActive:async function(i,n=5e3){var s;const c=z.reportApiInvoke(null,{tag:Te.TRACER,name:Re.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[n]});if(!(i instanceof Jt||i instanceof Tl))return i=new L(D.INVALID_TRACK,"the parameter is not a video track"),c.onError(i),i.throw();n&&1e3>n&&(n=1e3);var u=i instanceof Jt?i.getTrackLabel():"remote_track",h=i.getMediaStreamTrack(!0);const f=document.createElement("video");f.style.width="1px",f.style.height="1px",f.setAttribute("muted",""),f.muted=!0,f.setAttribute("playsinline",""),f.controls=!1,(Ws()||vo())&&(f.style.opacity="0.01",f.style.position="fixed",f.style.left="0",f.style.top="0",document.body.appendChild(f)),f.srcObject=new MediaStream([h]),f.play();const A=document.createElement("canvas");A.width=160,A.height=120;let m=h=0;try{const I=le();h=await function(E,_,S,N){let O,B=0,P=null;return new se((J,ne)=>{gi(()=>{O&&(O(),J(B))},_),O=Fh(()=>{e:{B>N&&O&&(O(),J(B));var Ae=S.getContext("2d");if(Ae){Ae.drawImage(E,0,0,160,120),Ae=Ae.getImageData(0,0,S.width,S.height);var Me=Math.floor(Ae.data.length/3);if(P){for(let be=0;be<Me;be+=3)if(Ae.data[be]!==P[be]){B+=1,P=Ae.data;break e}}P=Ae.data}else Ae=new L(D.UNEXPECTED_ERROR,"can not get canvas 2d context."),R.error(Ae.toString()),ne(Ae)}},30)})}(f,n,A,4),m=le()-I}catch(I){throw c.onError(I),I}return VN===$e.SAFARI&&(f.pause(),f.remove()),f.srcObject=null,n=4<h,u={duration:m,changedPicNum:h,deviceLabel:u,result:n},R.info(b(s="[track-".concat(i.getTrackId(),"] check video track active completed. ")).call(s,fe(u))),c.onSuccess(u),n},setArea:function(i){const n=z.reportApiInvoke(null,{name:Re.SET_AREA,options:i,tag:Te.TRACER});try{var s;let c=[];if(typeof i=="string"&&(c=[i]),ro(i)&&(K(i).call(i,h=>{if(!vt(c1).call(c1,h))throw new L(D.INVALID_PARAMS,"invalid area code")}),c=i),Object.prototype.toString.call(i)==="[object Object]"){const{areaCode:h,excludedArea:f}=i;if(!h)throw new L(D.INVALID_PARAMS,"area code is needed");i=h,typeof h=="string"&&(i=[h]),c=f?lN(i,f):i}Yr("AREAS",c);const u=(h=>{const f={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return Ie(h).call(h,A=>{const m=jp[A];(A=pt(m))&&Ie(A).call(A,I=>{var E;I!=="CODE"&&(f[I]=b(E=f[I]).call(E,m[I]))})}),f})(c);Ie(s=pt(u)).call(s,h=>{h==="LOG_UPLOAD_SERVER"||h==="EVENT_REPORT_DOMAIN"||h==="EVENT_REPORT_BACKUP_DOMAIN"||h==="PROXY_SERVER_TYPE3"?Yr(h,u[h][0]):Yr(h,u[h])}),R.debug("set area success:",c.join(","))}catch(c){throw n.onError(c),c}n.onSuccess()},loadModule:async function(i,n){var s;if(R.debug(b(s="loadModule: ".concat(i.name,", loadOption: ")).call(s,fe(n))),!i.moduleInit)throw R.debug("Invalid Plugin"),new L(D.INVALID_PLUGIN,"invalid plugin");try{await i.moduleInit({logger:R,report:z},n)}catch(c){throw new L(D.UNEXPECTED_ERROR,"unexpected error in loadModule",c)}},processExternalMediaAEC:function(i){jN.processExternalMediaAEC(i)}};return Vn.on(Jo.CAMERA_DEVICE_CHANGED,i=>{R.info("camera device changed",fe(i)),jn.onCameraChanged&&jn.onCameraChanged(i)}),Vn.on(Jo.RECORDING_DEVICE_CHANGED,i=>{R.info("microphone device changed",fe(i)),jn.onMicrophoneChanged&&jn.onMicrophoneChanged(i)}),Vn.on(Jo.PLAYOUT_DEVICE_CHANGED,i=>{R.debug("playout device changed",fe(i)),jn.onPlaybackDeviceChanged&&jn.onPlaybackDeviceChanged(i)}),vi.onAutoplayFailed=()=>{R.info("detect audio element autoplay failed"),jn.onAudioAutoplayFailed&&jn.onAudioAutoplayFailed()},At.on("autoplay-failed",()=>{R.info("detect webaudio autoplay failed"),jn.onAudioAutoplayFailed&&jn.onAudioAutoplayFailed()}),b1.on("autoplay-failed",()=>{R.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),jn.onAutoplayFailed?jn.onAutoplayFailed():jn.onAudioAutoplayFailed?R.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):R.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`)}),window&&(window.__ARTC__=jn),jn})})(uT);var im=kO(uT.exports);const XQ={class:"pt-16 w-screen h-screen overflow-hidden"},n5={props:{id:{type:String,default:""}},async setup(t){let e,r;const o=t,a=bO(),l=im.createClient({codec:"vp8",mode:"rtc"}),d="0062d9d90feddea4eada2ebb4b318b487bfIACA6If+xkXqXCwnQgNuKdwdgzE54Hk/r4eQ63Rwqvf83z6Lgv4AAAAAEAC3nyPhhGCCYQEAAQCEYIJh";try{const y=([e,r]=Lf(()=>l.join(a.liveOptions.APPID,o.id,d,null)),e=await e,r(),e)}catch{}let p=null,g=null;try{p=([e,r]=Lf(()=>im.createCameraVideoTrack()),e=await e,r(),e)}catch{}try{g=([e,r]=Lf(()=>im.createMicrophoneAudioTrack()),e=await e,r(),e)}catch{}p!=null&&l.publish(p),g!=null&&l.publish(g);const v=Aa({id:1,name:"a",openVideo:!1,openRadio:!1,isShow:!0}),C=Aa([{id:1,name:"a",openVideo:!1,openRadio:!1,isShow:!0},{id:2,name:"111",openVideo:!1,openRadio:!1,isShow:!0}]);return(y,w)=>(bt(),mr(ts,null,[er(UQ),lt("div",XQ,[er(f4,{class:"h-full"}),(bt(!0),mr(ts,null,Df(Oo(C),(k,M)=>(bt(),mr(ts,null,[k.isShow?(bt(),ko(lT,{onClose:x=>k.isShow=!1,name:k.name,"class-name":"w-80 h-60 "+(M==0?"bottom-[calc(100vh-19rem)]":"bottom-[calc(100vh-34.6rem)]"),key:k.id},null,8,["onClose","name","class-name"])):vc("",!0)],64))),256)),Oo(v).isShow?(bt(),ko(lT,{onClose:w[0]||(w[0]=k=>Oo(v).isShow=!1),name:"\u6211",key:Oo(v).name})):vc("",!0)])],64))}};export{n5 as default};
